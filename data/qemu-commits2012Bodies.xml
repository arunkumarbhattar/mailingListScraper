<?xml version="1.0" encoding="utf-8"?>
<emails><email><emailId>20121203200008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-03 20:00:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu]</subject><body>



----==_mimepart_50bd04c8e3cf0_5003fcaae416422
Date: Mon, 03 Dec 2012 12:00:08 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50bd04c8e50bc_5003fcaae4165b1@sh2.rs.github.com.mail&gt;

  Branch: refs/tags/v1.3.0
  Home:   https://github.com/qemu/qemu


----==_mimepart_50bd04c8e3cf0_5003fcaae416422--


</body></email><email><emailId>20120812183012</emailId><senderName>Anthony Liguori</senderName><senderEmail>aliguori@us.ibm.com</senderEmail><timestampReceived>2012-08-12 18:30:12-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 730a9c: virtio-blk: fix use-after-free while handling scsi...</subject><body>



----==_mimepart_5027f634a6462_324c195baf456857
Date: Sun, 12 Aug 2012 11:30:12 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;5027f634a7fa6_324c195baf456944@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 730a9c53b4e52681fcfe31cf38854cbf91e132c7
      https://github.com/qemu/qemu/commit/730a9c53b4e52681fcfe31cf38854cbf91e132c7
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-08-10 (Fri, 10 Aug 2012)

  Changed paths:
    M hw/virtio-blk.c

  Log Message:
  -----------
  virtio-blk: fix use-after-free while handling scsi commands

The scsi passthrough handler falls through after completing a
request into the failure path, resulting in a use after free.

Reproducible by running a guest with aio=native on a block device.

Reported-by: Stefan Priebe &lt;s.priebe@profihost.ag&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 61f52e06f0a21bab782f98ef3ea789aa6d0aa046
      https://github.com/qemu/qemu/commit/61f52e06f0a21bab782f98ef3ea789aa6d0aa046
  Author: Jason Baron &lt;jbaron@redhat.com&gt;
  Date:   2012-08-10 (Fri, 10 Aug 2012)

  Changed paths:
    M hw/ide/ahci.c
    M hw/ide/internal.h

  Log Message:
  -----------
  ahci: Fix ahci cdrom read corruptions for reads &gt; 128k

While testing q35, which has its cdrom attached to the ahci controller, I found
that the Fedora 17 install would panic on boot. The panic occurs while
squashfs is trying to read from the cdrom. The errors are:

[    8.622711] SQUASHFS error: xz_dec_run error, data probably corrupt
[    8.625180] SQUASHFS error: squashfs_read_data failed to read block
0x20be48a

I was also able to produce corrupt data reads using an installed piix based
qemu machine, using 'dd'. I found that the corruptions were only occuring when
then read size was greater than 128k. For example, the following command
results in corrupted reads:

dd if=/dev/sr0 of=/tmp/blah bs=256k iflag=direct

The &gt; 128k size reads exercise a different code path than 128k and below. In
ide_atapi_cmd_read_dma_cb() s-&gt;io_buffer_size is capped at 128k. Thus,
ide_atapi_cmd_read_dma_cb() is called a second time when the read is &gt; 128k.
However, ahci_dma_rw_buf() restart the read from offset 0, instead of at 128k.
Thus, resulting in a corrupted read.

To fix this, I've introduced 'io_buffer_offset' field in IDEState to keep
track of the offset. I've also modified ahci_populate_sglist() to take a new
3rd offset argument, so that the sglist is property initialized.

I've tested this patch using 'dd' testing, and Fedora 17 now correctly boots
and installs on q35 with the cdrom ahci controller.

Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Tested-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: ea8d82a1ed72634f089ed1bccccd9c84cc1ab855
      https://github.com/qemu/qemu/commit/ea8d82a1ed72634f089ed1bccccd9c84cc1ab855
  Author: Jason Baron &lt;jbaron@redhat.com&gt;
  Date:   2012-08-10 (Fri, 10 Aug 2012)

  Changed paths:
    M dma-helpers.c
    M hw/ide/ahci.c

  Log Message:
  -----------
  ahci: Fix sglist memleak in ahci_dma_rw_buf()

I noticed that in hw/ide/ahci:ahci_dma_rw_buf() we do not free the sglist. Thus,
I've added a call to qemu_sglist_destroy() to fix this memory leak.

In addition, I've adeed a call in qemu_sglist_destroy() to 0 all of the sglist
fields, in case there is some other codepath that tries to free the sglist.

Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 353a41be05f9616f7bd7120456f706b3c85683ea
      https://github.com/qemu/qemu/commit/353a41be05f9616f7bd7120456f706b3c85683ea
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-08-10 (Fri, 10 Aug 2012)

  Changed paths:
    M tests/qemu-iotests/common.rc

  Log Message:
  -----------
  qemu-iotests: Save some sed processes

Instead of building a huge pipeline, just pass all expressions to a
single sed process.

Suggested-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;


  Commit: 13e3dce068773c971ff2f19d986378c55897c4a3
      https://github.com/qemu/qemu/commit/13e3dce068773c971ff2f19d986378c55897c4a3
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-08-10 (Fri, 10 Aug 2012)

  Changed paths:
    M hw/virtio-blk.c
    M hw/virtio-blk.h

  Log Message:
  -----------
  virtio-blk: support VIRTIO_BLK_F_CONFIG_WCE

Also rename VIRTIO_BLK_F_WCACHE to VIRTIO_BLK_F_WCE for consistency with
the spec.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 9315cbfd8d7074eca44fbc5f93902e97b27d5240
      https://github.com/qemu/qemu/commit/9315cbfd8d7074eca44fbc5f93902e97b27d5240
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-08-10 (Fri, 10 Aug 2012)

  Changed paths:
    M hw/virtio-blk.c

  Log Message:
  -----------
  virtio-blk: disable write cache if not negotiated

If the guest does not support flushes, we should run in writethrough mode.
The setting is temporary until the next reset, so that for example the
BIOS will run in writethrough mode while Linux will run with a writeback
cache.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 1f212b9d3edd8679bafd3bcf0301795206438724
      https://github.com/qemu/qemu/commit/1f212b9d3edd8679bafd3bcf0301795206438724
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-08-10 (Fri, 10 Aug 2012)

  Changed paths:
    M blockdev.c

  Log Message:
  -----------
  blockdev: flip default cache mode from writethrough to writeback

Now all major device models (IDE, SCSI, virtio) can choose between
writethrough and writeback at run-time, and virtio will even revert
to writethrough if the guest is not capable of sending flushes.  So
we can change the default to writeback at last.

Tested, for lack of a better idea, with a breakpoint on bdrv_open
and all cache choices one by one.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: b10170aca0616df85482dcc7ddda03437bc07cca
      https://github.com/qemu/qemu/commit/b10170aca0616df85482dcc7ddda03437bc07cca
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-08-10 (Fri, 10 Aug 2012)

  Changed paths:
    M block/qed-check.c
    M block/qed.c
    M block/qed.h

  Log Message:
  -----------
  qed: mark image clean after repair succeeds

The dirty bit is cleared after image repair succeeds in qed_open().
Move this into qed_check() so that all callers benefit from this
behavior when fix=true.

This is necessary so qemu-img check can call .bdrv_check() and mark the
image clean.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: acbe59829e448aa63bdccc6ee484b7e1ac605e25
      https://github.com/qemu/qemu/commit/acbe59829e448aa63bdccc6ee484b7e1ac605e25
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-08-10 (Fri, 10 Aug 2012)

  Changed paths:
    M block/qcow2.c

  Log Message:
  -----------
  qcow2: mark image clean after repair succeeds

The dirty bit is cleared after image repair succeeds in qcow2_open().
Move this into qcow2_check() so that all callers benefit from this
behavior when fix mode is enabled.

This is necessary so qemu-img check can call .bdrv_check() and mark the
image clean.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 058f8f16db0c1c528b665a6283457f019c8b0926
      https://github.com/qemu/qemu/commit/058f8f16db0c1c528b665a6283457f019c8b0926
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-08-10 (Fri, 10 Aug 2012)

  Changed paths:
    M block.h
    M block/qcow2.c
    M block/qed.c
    M qemu-img.c
    M tests/qemu-iotests/039.out

  Log Message:
  -----------
  block: add BLOCK_O_CHECK for qemu-img check

Image formats with a dirty bit, like qed and qcow2, repair dirty image
files upon open with BDRV_O_RDWR.  Performing automatic repair when
qemu-img check runs is not ideal because the bdrv_open() call repairs
the image before the actual bdrv_check() call from qemu-img.c.

Fix this "double repair" since it leads to confusing output from
qemu-img check.  Tell the block driver that this image is being opened
just for bdrv_check().  This skips automatic repair and qemu-img.c can
invoke it manually with bdrv_check().

Update the golden output for qemu-iotests 039 to reflect the new
qemu-img check output.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 166f3c7b7026f9cd55a7daeec3b3444ec41092ab
      https://github.com/qemu/qemu/commit/166f3c7b7026f9cd55a7daeec3b3444ec41092ab
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-08-10 (Fri, 10 Aug 2012)

  Changed paths:
    M tests/qemu-iotests/039
    M tests/qemu-iotests/common.rc

  Log Message:
  -----------
  qemu-iotests: skip 039 with ./check -nocache

When the qemu-io --nocache option is used the 039 test case cannot abort
QEMU at a point where the image is dirty.  Skip the test case.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: fb7c269ed694c103397c5fffbfcccd3e90aed23c
      https://github.com/qemu/qemu/commit/fb7c269ed694c103397c5fffbfcccd3e90aed23c
  Author: Dunrong Huang &lt;riegamaths@gmail.com&gt;
  Date:   2012-08-10 (Fri, 10 Aug 2012)

  Changed paths:
    M vl.c

  Log Message:
  -----------
  vl.c: Exit QEMU early if no machine is found

We check whether the variable machine is NULL or not before accessing
it. If machine is NULL, exit QEMU with an error, this can avoids a
segfault error.

Markus Armbruster &lt;armbru@redhat.com&gt; adds that the segfault can be
reproduced as follows:

  $ qemu-system-xtensa -cpu help

Signed-off-by: Dunrong Huang &lt;riegamaths@gmail.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 656267413c17db3344c443fcf2b954a456a6863e
      https://github.com/qemu/qemu/commit/656267413c17db3344c443fcf2b954a456a6863e
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-08-10 (Fri, 10 Aug 2012)

  Changed paths:
    M target-arm/translate.c

  Log Message:
  -----------
  arm: translate: comment typo - s/middel/middle/

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: b90372ad2a69a9cdad2a40766eb46f0a89d98535
      https://github.com/qemu/qemu/commit/b90372ad2a69a9cdad2a40766eb46f0a89d98535
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-10 (Fri, 10 Aug 2012)

  Changed paths:
    M target-arm/arm-semi.c
    M target-arm/cpu.h
    M target-arm/helper.c
    M target-arm/neon_helper.c
    M target-arm/op_helper.c
    M target-arm/translate.c

  Log Message:
  -----------
  target-arm: Fix typos in comments

Fix a variety of typos in comments in target-arm files.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Peter Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 53810bab3acd73b9844807e53f02d867c1ad1d2a
      https://github.com/qemu/qemu/commit/53810bab3acd73b9844807e53f02d867c1ad1d2a
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-11 (Sat, 11 Aug 2012)

  Changed paths:
    M block.h
    M block/qcow2.c
    M block/qed-check.c
    M block/qed.c
    M block/qed.h
    M blockdev.c
    M dma-helpers.c
    M hw/ide/ahci.c
    M hw/ide/internal.h
    M hw/virtio-blk.c
    M hw/virtio-blk.h
    M qemu-img.c
    M tests/qemu-iotests/039
    M tests/qemu-iotests/039.out
    M tests/qemu-iotests/common.rc

  Log Message:
  -----------
  Merge remote-tracking branch 'kwolf/for-anthony' into staging

* kwolf/for-anthony:
  qemu-iotests: skip 039 with ./check -nocache
  block: add BLOCK_O_CHECK for qemu-img check
  qcow2: mark image clean after repair succeeds
  qed: mark image clean after repair succeeds
  blockdev: flip default cache mode from writethrough to writeback
  virtio-blk: disable write cache if not negotiated
  virtio-blk: support VIRTIO_BLK_F_CONFIG_WCE
  qemu-iotests: Save some sed processes
  ahci: Fix sglist memleak in ahci_dma_rw_buf()
  ahci: Fix ahci cdrom read corruptions for reads &gt; 128k
  virtio-blk: fix use-after-free while handling scsi commands


  Commit: 346fe0c4c0b88f11a3d0c01c34d9a170d73429cc
      https://github.com/qemu/qemu/commit/346fe0c4c0b88f11a3d0c01c34d9a170d73429cc
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-11 (Sat, 11 Aug 2012)

  Changed paths:
    M target-arm/arm-semi.c
    M target-arm/cpu.h
    M target-arm/helper.c
    M target-arm/neon_helper.c
    M target-arm/op_helper.c
    M target-arm/translate.c
    M vl.c

  Log Message:
  -----------
  Merge remote-tracking branch 'stefanha/trivial-patches' into staging

* stefanha/trivial-patches:
  target-arm: Fix typos in comments
  arm: translate: comment typo - s/middel/middle/
  vl.c: Exit QEMU early if no machine is found


Compare: https://github.com/qemu/qemu/compare/312942619af7...346fe0c4c0b8

----==_mimepart_5027f634a6462_324c195baf456857--


</body></email><email><emailId>20120901120007</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-01 12:00:07-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] e7eee6: target-xtensa: return ENOSYS for unimplemented sim...</subject><body>



----==_mimepart_5041f8c7310de_309719ecaf4885a9
Date: Sat, 01 Sep 2012 05:00:07 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5041f8c7325fa_309719ecaf488689@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: e7eee62a90c671d22d50964b7de05e3f4fd96f5f
      https://github.com/qemu/qemu/commit/e7eee62a90c671d22d50964b7de05e3f4fd96f5f
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-09-01 (Sat, 01 Sep 2012)

  Changed paths:
    M target-xtensa/xtensa-semi.c

  Log Message:
  -----------
  target-xtensa: return ENOSYS for unimplemented simcalls

This prevents guest from proceeding with uninitialised garbage returned
from unimplemented simcalls.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;




----==_mimepart_5041f8c7310de_309719ecaf4885a9--


</body></email><email><emailId>20121001163009</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-01 16:30:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] a9321a: x86: Implement SMEP and SMAP</subject><body>



----==_mimepart_5069c51173c29_8b5106aae454485
Date: Mon, 01 Oct 2012 09:30:09 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5069c511761e8_8b5106aae454550@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: a9321a4d49d65d29c2926a51aedc5b91a01f3591
      https://github.com/qemu/qemu/commit/a9321a4d49d65d29c2926a51aedc5b91a01f3591
  Author: H. Peter Anvin &lt;hpa@linux.intel.com&gt;
  Date:   2012-10-01 (Mon, 01 Oct 2012)

  Changed paths:
    M target-i386/cc_helper.c
    M target-i386/cpu.c
    M target-i386/cpu.h
    M target-i386/helper.c
    M target-i386/helper.h
    M target-i386/translate.c

  Log Message:
  -----------
  x86: Implement SMEP and SMAP

This patch implements Supervisor Mode Execution Prevention (SMEP) and
Supervisor Mode Access Prevention (SMAP) for x86.  The purpose of the
patch, obviously, is to help kernel developers debug the support for
those features.

A fair bit of the code relates to the handling of CPUID features.  The
CPUID code probably would get greatly simplified if all the feature
bit words were unified into a single vector object, but in the
interest of producing a minimal patch for SMEP/SMAP, and because I had
very limited time for this project, I followed the existing style.

[ v2: don't change the definition of the qemu64 CPU shorthand, since
  that breaks loading old snapshots.  Per Anthony Liguori this can be
  fixed once the CPU feature set is snapshot.

  Change the coding style slightly to conform to checkpatch.pl. ]

Signed-off-by: H. Peter Anvin &lt;hpa@linux.intel.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: df8c1b0207689a4bcc2396bf5327d5ea135a45bb
      https://github.com/qemu/qemu/commit/df8c1b0207689a4bcc2396bf5327d5ea135a45bb
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-01 (Mon, 01 Oct 2012)

  Changed paths:
    M scripts/update-linux-headers.sh

  Log Message:
  -----------
  Update kernel header script to include vfio

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;
Acked-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 883f0b85f0cbb8c31baeadfcbfd144a1ed29d935
      https://github.com/qemu/qemu/commit/883f0b85f0cbb8c31baeadfcbfd144a1ed29d935
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-01 (Mon, 01 Oct 2012)

  Changed paths:
    A linux-headers/linux/vfio.h

  Log Message:
  -----------
  Update Linux kernel headers

Based on Linux as of 1a95620.

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;
Acked-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 65501a745dbaf28284e099f724aa5fc478eae0e7
      https://github.com/qemu/qemu/commit/65501a745dbaf28284e099f724aa5fc478eae0e7
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-01 (Mon, 01 Oct 2012)

  Changed paths:
    A hw/vfio_pci.c
    A hw/vfio_pci_int.h

  Log Message:
  -----------
  vfio: vfio-pci device assignment driver

This adds the core of the QEMU VFIO-based PCI device assignment driver.
To make use of this driver, enable CONFIG_VFIO, CONFIG_VFIO_IOMMU_TYPE1,
and CONFIG_VFIO_PCI in your host Linux kernel config.  Load the vfio-pci
module.  To assign device 0000:05:00.0 to a guest, do the following:

for dev in $(ls /sys/bus/pci/devices/0000:05:00.0/iommu_group/devices); do
    vendor=$(cat /sys/bus/pci/devices/$dev/vendor)
    device=$(cat /sys/bus/pci/devices/$dev/device)
    if [ -e /sys/bus/pci/devices/$dev/driver ]; then
  echo $dev &gt; /sys/bus/pci/devices/$dev/driver/unbind
    fi
    echo $vendor $device &gt; /sys/bus/pci/drivers/vfio-pci/new_id
done

See Documentation/vfio.txt in the Linux kernel tree for further
description of IOMMU groups and VFIO.

Then launch qemu including the option:

-device vfio-pci,host=0000:05:00.0

Legacy PCI interrupts (INTx) currently makes use of a kludge where we
trap BAR accesses and assume the access is in response to an interrupt,
therefore de-asserting and unmasking the interrupt.  It's not quite as
targetted as using the EOI for this, but it's self contained and seems
to work across all architectures.  The side-effect is a significant
performance slow-down for device in INTx mode.  Some devices, like
graphics cards, don't really use their interrupt, so this can be turned
off with the x-intx=off option, which disables INTx alltogether.  This
should be considered an experimental option until we refine this code.
Both MSI and MSI-X are supported and avoid these issues.

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;
Acked-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 92e1fb5ed1a26d09ee754845d5691d473410c1dc
      https://github.com/qemu/qemu/commit/92e1fb5ed1a26d09ee754845d5691d473410c1dc
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-01 (Mon, 01 Oct 2012)

  Changed paths:
    M MAINTAINERS
    M hw/Makefile.objs

  Log Message:
  -----------
  vfio: Enable vfio-pci and mark supported

Enabled for all softmmu guests supporting PCI on Linux hosts.  Note
that currently only x86 hosts have the kernel side VFIO IOMMU support
for this.  PPC (g3beige) is the only non-x86 guest known to work.
ARM (veratile) hangs in firmware, others untested.

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/4a19e505df65...92e1fb5ed1a2

----==_mimepart_5069c51173c29_8b5106aae454485--


</body></email><email><emailId>20121101163013</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-01 16:30:13-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 0e8153: hw/armv7m_nvic: Implement byte/halfword access for...</subject><body>



----==_mimepart_5092a395dcd49_331c18e7af09251a
Date: Thu, 01 Nov 2012 09:30:13 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5092a395e3827_331c18e7af0926ac@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 0e8153dde7824e672127765914db30eb301f1aa4
      https://github.com/qemu/qemu/commit/0e8153dde7824e672127765914db30eb301f1aa4
  Author: Andre Beckus &lt;mikemail98-qemu@yahoo.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/armv7m_nvic.c

  Log Message:
  -----------
  hw/armv7m_nvic: Implement byte/halfword access for NVIC SCB_SHPRx registers

Implement byte/halfword read and write for the NVIC SCB_SHPRx
(System Handler Priority Registers).  Do this by removing SHPR word access
from nvic_readl/writel and adding common code to hande all access
sizes in nvic_sysreg_read/write.

Because the "nvic_state *s" variable now needs to be declared in
nvic_sysreg_read/write, the "void *opaque" parameter of
nvic_readl/writel is changed to "nvic_state *s".

Signed-off-by: Andre Beckus &lt;mikemail98-qemu@yahoo.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: f3cdbc329fa7621ece7e673f23c3101e6b0c952b
      https://github.com/qemu/qemu/commit/f3cdbc329fa7621ece7e673f23c3101e6b0c952b
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/vexpress.c

  Log Message:
  -----------
  hw/vexpress.c: Don't prematurely explode QEMUMachineInitArgs

Don't explode QEMUMachineInitArgs before passing it to the vexpress
common init function.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: db4ff6f111c42e2b33eddcf5f20cc53cceda60a2
      https://github.com/qemu/qemu/commit/db4ff6f111c42e2b33eddcf5f20cc53cceda60a2
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/realview.c

  Log Message:
  -----------
  hw/realview.c: Don't prematurely explode QEMUMachineInitArgs

Don't explode QEMUMachineInitArgs in every realview init
function; just pass it to the common realview_init() code
instead.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 1b523b5bfc83b4d7e3c1971e0a8d34aff0a9ecf6
      https://github.com/qemu/qemu/commit/1b523b5bfc83b4d7e3c1971e0a8d34aff0a9ecf6
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/versatilepb.c

  Log Message:
  -----------
  hw/versatilepb: Don't prematurely explode QEMUMachineInitArgs

Don't explode QEMUMachineInitArgs before passing it to the common
versatile init function.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 72a9f5b7c33dfe8832951af1f1e67de10be1a0ce
      https://github.com/qemu/qemu/commit/72a9f5b7c33dfe8832951af1f1e67de10be1a0ce
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/spitz.c

  Log Message:
  -----------
  hw/spitz: Don't prematurely explode QEMUMachineInitArgs

Don't explode QEMUMachineInitArgs before calling common init function.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 6952625da87175ca9170335803633f91de7f2f2a
      https://github.com/qemu/qemu/commit/6952625da87175ca9170335803633f91de7f2f2a
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/omap_sx1.c

  Log Message:
  -----------
  hw/omap_sx1: Don't prematurely explode QEMUMachineInitArgs

Don't explode QEMUMachineInitArgs before passing it to the
omap_sx1 common init function.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 462b69bba32e35c546b6b588f299f1f794409d22
      https://github.com/qemu/qemu/commit/462b69bba32e35c546b6b588f299f1f794409d22
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/nseries.c

  Log Message:
  -----------
  hw/nseries: Don't prematurely explode QEMUMachineInitArgs

Don't explode QEMUMachineInitArgs before passing it to n8x0_init().

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 6efa6d50387f5f1401c6f1612fb80cba31f7dca4
      https://github.com/qemu/qemu/commit/6efa6d50387f5f1401c6f1612fb80cba31f7dca4
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/mainstone.c

  Log Message:
  -----------
  hw/mainstone: Don't prematurely explode QEMUMachineInitArgs

Don't explode QEMUMachineInitArgs before passing it to mainstone_init().

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 7f0f774003e4c6885b34d4c0006f7beff2b529eb
      https://github.com/qemu/qemu/commit/7f0f774003e4c6885b34d4c0006f7beff2b529eb
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/exynos4_boards.c

  Log Message:
  -----------
  hw/exynos4_boards: Don't prematurely explode QEMUMachineInitArgs

Don't explode QEMUMachineInitArgs before passing it to
exynos4_boards_init_common().

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: fbfecf43e9d354cfae04496563f7bb87d2ccde46
      https://github.com/qemu/qemu/commit/fbfecf43e9d354cfae04496563f7bb87d2ccde46
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/pl050.c

  Log Message:
  -----------
  hw/pl050: Use LOG_GUEST_ERROR

Use LOG_GUEST_ERROR for reporting guest attempts to access invalid register
offsets.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: abff909c9456103b54277318675fff8997fd71af
      https://github.com/qemu/qemu/commit/abff909c9456103b54277318675fff8997fd71af
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/pl061.c

  Log Message:
  -----------
  hw/pl061: Use LOG_GUEST_ERROR

Use LOG_GUEST_ERROR to report guest attempts to access bad register offsets.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: df37416218a91a4ae962dfafbc8208af8087ebc0
      https://github.com/qemu/qemu/commit/df37416218a91a4ae962dfafbc8208af8087ebc0
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/pl080.c

  Log Message:
  -----------
  hw/pl080: Use LOG_GUEST_ERROR and LOG_UNIMP

Use LOG_GUEST_ERROR and LOG_UNIMP in preference to hw_error().

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 375cb560295484b88898262ebf400eff9a011206
      https://github.com/qemu/qemu/commit/375cb560295484b88898262ebf400eff9a011206
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/pl110.c

  Log Message:
  -----------
  hw/pl110: Use LOG_GUEST_ERROR rather than hw_error()

Use LOG_GUEST_ERROR to report guest accesses to invalid register
offsets.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 2d746989bf5e146df9205de3fd4ad0d48a318165
      https://github.com/qemu/qemu/commit/2d746989bf5e146df9205de3fd4ad0d48a318165
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/pl190.c

  Log Message:
  -----------
  hw/pl190: Use LOG_UNIMP rather than hw_error()

Use LOG_UNIMP to report attempts to use the unimplemented test mode.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: f9fe7bdad82a1262e9352393b03d7f4586366209
      https://github.com/qemu/qemu/commit/f9fe7bdad82a1262e9352393b03d7f4586366209
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/arm11mpcore.c

  Log Message:
  -----------
  hw/arm11mpcore: Use LOG_GUEST_ERROR rather than hw_error()

Use LOG_GUEST_ERROR to report guest accesses to bad offsets.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 8c8dc39fa60f782f988bc08113f3abfddebbfebd
      https://github.com/qemu/qemu/commit/8c8dc39fa60f782f988bc08113f3abfddebbfebd
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/arm_gic.c

  Log Message:
  -----------
  hw/arm_gic: Use LOG_GUEST_ERROR

Use LOG_GUEST_ERROR to report guest accesses to bad offsets.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: edb94a41e30f1b2ca241bfdfd7f7e90badfa6192
      https://github.com/qemu/qemu/commit/edb94a41e30f1b2ca241bfdfd7f7e90badfa6192
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/arm_timer.c

  Log Message:
  -----------
  hw/arm_timer: Use LOG_GUEST_ERROR and LOG_UNIMP

Use LOG_GUEST_ERROR to report guest accesses to bad register
offsets, and LOG_UNIMP for access to the unimplemented
test registers.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: e72e3ffc3d13176c44eb21af0c6468867458cb4a
      https://github.com/qemu/qemu/commit/e72e3ffc3d13176c44eb21af0c6468867458cb4a
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/armv7m_nvic.c

  Log Message:
  -----------
  hw/armv7m_nvic: Use LOG_GUEST_ERROR and LOG_UNIMP

Use LOG_GUEST_ERROR and LOG_UNIMP rather than hw_error() where
appropriate.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 0c896f066213fcb06063f68ad7bfc75800591846
      https://github.com/qemu/qemu/commit/0c896f066213fcb06063f68ad7bfc75800591846
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/arm_sysctl.c

  Log Message:
  -----------
  hw/arm_sysctl: Use LOG_GUEST_ERROR

Use LOG_GUEST_ERROR to report bad guest accesses.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: a35d4e422328eeb770b7b0c08bb073e8940b158e
      https://github.com/qemu/qemu/commit/a35d4e422328eeb770b7b0c08bb073e8940b158e
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/arm_l2x0.c

  Log Message:
  -----------
  hw/arm_l2x0: Use LOG_GUEST_ERROR

Use LOG_GUEST_ERROR to report bad guest accesses.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 5170d661dc1a2a28e1a242f6814bea4dcc29ad23
      https://github.com/qemu/qemu/commit/5170d661dc1a2a28e1a242f6814bea4dcc29ad23
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/versatile_i2c.c

  Log Message:
  -----------
  hw/versatile_i2c: Use LOG_GUEST_ERROR

Use LOG_GUEST_ERROR to report bad guest accesses.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: b7dff23a487fffccd7c395da95e9b02bebe48bee
      https://github.com/qemu/qemu/commit/b7dff23a487fffccd7c395da95e9b02bebe48bee
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/pflash_cfi01.c
    M hw/pflash_cfi02.c

  Log Message:
  -----------
  pflash_cfi0x: remove unused base field

This field is completely unused. The base address should also be abstracted
away from the device anyway. Removed.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: be65f89992afd1366ce51db95f26b63cc90e309d
      https://github.com/qemu/qemu/commit/be65f89992afd1366ce51db95f26b63cc90e309d
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/pflash_cfi01.c

  Log Message:
  -----------
  pflash_cfi01: remove unused total_len field

This field is completely unused.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 368a354f02b7c3845d8b4bcdebc0840a515e953b
      https://github.com/qemu/qemu/commit/368a354f02b7c3845d8b4bcdebc0840a515e953b
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/pflash_cfi01.c
    M hw/pflash_cfi02.c

  Log Message:
  -----------
  pflash_cfi0x: QOMified

QOMified the pflash_cfi0x so machine models can connect them up in custom ways.

Kept the pflash_cfi0x_register functions as is. They can still be used to
create a flash straight onto system memory.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: fc5b64d0829297c7a525ddf6c0bb08ef0a9af5b6
      https://github.com/qemu/qemu/commit/fc5b64d0829297c7a525ddf6c0bb08ef0a9af5b6
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/pflash_cfi01.c

  Log Message:
  -----------
  pflash_cfi01: Fix debug mode printfery

This DPRINTF was throwing a warning due to a missing cast.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: f2d189d38436a8ccdedd94de01673b04aa008e11
      https://github.com/qemu/qemu/commit/f2d189d38436a8ccdedd94de01673b04aa008e11
  Author: Igor Mitsyanko &lt;i.mitsyanko@gmail.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/sd.c
    M hw/sd.h

  Log Message:
  -----------
  hw/sd.c: Fix erase for high capacity cards

Standard capacity cards SDSC use byte unit address while SDHC and SDXC cards use
block unit address (512 bytes) when setting ERASE_START and ERASE_END with CMD32
and CMD33, we have to account for this.

Signed-off-by: Igor Mitsyanko &lt;i.mitsyanko@samsung.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 08e99e296fbe695d13c8ac944867d9def7f7c5d0
      https://github.com/qemu/qemu/commit/08e99e296fbe695d13c8ac944867d9def7f7c5d0
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M savevm.c
    M vmstate.h

  Log Message:
  -----------
  vmstate: Add support for saving/loading bitmaps

Add support for saving/loading bitmap.h bitmaps in vmstate.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Tested-by: Igor Mitsyanko &lt;i.mitsyanko@samsung.com&gt;
Reviewed-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 50a5be6c3d50c7684a417da4eb5f9587dace0a44
      https://github.com/qemu/qemu/commit/50a5be6c3d50c7684a417da4eb5f9587dace0a44
  Author: Igor Mitsyanko &lt;i.mitsyanko@gmail.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/sd.c

  Log Message:
  -----------
  hw/sd.c: add SD card save/load support

This patch updates SD card model to support save/load of card's state.

Signed-off-by: Igor Mitsyanko &lt;i.mitsyanko@samsung.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: a3cfa18eb075c7ef78358ca1956fe7b01caa1724
      https://github.com/qemu/qemu/commit/a3cfa18eb075c7ef78358ca1956fe7b01caa1724
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/spapr_pci.c
    M hw/spapr_pci.h

  Log Message:
  -----------
  Revert "PPC: pseries: Remove hack for PIO window"

This reverts commit a178274efabcbbc5d44805b51def874e47051325.

Contrary to that commit's message, the users of old_portio are not all
gone.  In particular VGA still uses it via portio_list_add().

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: ac7d12ba256b7c9d4e122d0d6877e2312d6c19ed
      https://github.com/qemu/qemu/commit/ac7d12ba256b7c9d4e122d0d6877e2312d6c19ed
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M target-ppc/cpu.h

  Log Message:
  -----------
  target-ppc: Rework storage of VPA registration state

We change the storage of the VPA information to explicitly use fixed
size integer types which will make life easier for syncing this data with
KVM, which we will need in future.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
[agraf: fix commit message]
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 3030442054e04b2538016920f0da6e94743f48be
      https://github.com/qemu/qemu/commit/3030442054e04b2538016920f0da6e94743f48be
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M target-ppc/cpu.h
    M target-ppc/machine.c
    M target-ppc/translate.c

  Log Message:
  -----------
  target-ppc: Extend FPU state for newer POWER CPUs

This patch adds some extra FPU state to CPUPPCState.  Specifically,
fpscr is extended to a target_ulong bits, since some recent (64 bit)
CPUs now have more status bits than fit inside 32 bits.  Also, we add
the 32 VSR registers present on CPUs with VSX (these extend the
standard FP regs, which together with the Altivec/VMX registers form a
64 x 128bit register file for VSX).

We don't actually support the instructions using these extra registers
in TCG yet, but we still need a place to store the state so we can
sync it with KVM and savevm/loadvm it.  This patch updates the savevm
code to not fail on the extended state, but also does not actually
save it - that's a project for another patch.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: bf0175de6c76779d4c8b0606de7bd2a5a0b87c7a
      https://github.com/qemu/qemu/commit/bf0175de6c76779d4c8b0606de7bd2a5a0b87c7a
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/xics.c

  Log Message:
  -----------
  pseries: Clean up inconsistent variable name in xics.c

Throughout xics.c 'nr' is used to refer to a global interrupt number, and
'server' is used to refer to an interrupt server number (i.e. CPU number).
Except in icp_set_mfrr(), where 'nr' is used as a server number.  Fix this
confusing inconsistency.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 1ecbbab46925d4810fc35aba45cf93cb80ff0734
      https://github.com/qemu/qemu/commit/1ecbbab46925d4810fc35aba45cf93cb80ff0734
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/xics.c

  Log Message:
  -----------
  pseries: Cleanup duplications of ics_valid_irq() code

A couple of places in xics.c open-coded the same logic as is already
implemented in ics_valid_irq().  This patch fixes the code duplication.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 735c1eeb85450acd551c5990952f7ed8512d8547
      https://github.com/qemu/qemu/commit/735c1eeb85450acd551c5990952f7ed8512d8547
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/arm11mpcore.c
    M hw/arm_gic.c
    M hw/arm_l2x0.c
    M hw/arm_sysctl.c
    M hw/arm_timer.c
    M hw/armv7m_nvic.c
    M hw/exynos4_boards.c
    M hw/mainstone.c
    M hw/nseries.c
    M hw/omap_sx1.c
    M hw/pflash_cfi01.c
    M hw/pflash_cfi02.c
    M hw/pl050.c
    M hw/pl061.c
    M hw/pl080.c
    M hw/pl110.c
    M hw/pl190.c
    M hw/realview.c
    M hw/sd.c
    M hw/sd.h
    M hw/spitz.c
    M hw/versatile_i2c.c
    M hw/versatilepb.c
    M hw/vexpress.c
    M savevm.c
    M vmstate.h

  Log Message:
  -----------
  Merge branch 'arm-devs.for-upstream' of git://git.linaro.org/people/pmaydell/qemu-arm

* 'arm-devs.for-upstream' of git://git.linaro.org/people/pmaydell/qemu-arm: (28 commits)
  hw/sd.c: add SD card save/load support
  vmstate: Add support for saving/loading bitmaps
  hw/sd.c: Fix erase for high capacity cards
  pflash_cfi01: Fix debug mode printfery
  pflash_cfi0x: QOMified
  pflash_cfi01: remove unused total_len field
  pflash_cfi0x: remove unused base field
  hw/versatile_i2c: Use LOG_GUEST_ERROR
  hw/arm_l2x0: Use LOG_GUEST_ERROR
  hw/arm_sysctl: Use LOG_GUEST_ERROR
  hw/armv7m_nvic: Use LOG_GUEST_ERROR and LOG_UNIMP
  hw/arm_timer: Use LOG_GUEST_ERROR and LOG_UNIMP
  hw/arm_gic: Use LOG_GUEST_ERROR
  hw/arm11mpcore: Use LOG_GUEST_ERROR rather than hw_error()
  hw/pl190: Use LOG_UNIMP rather than hw_error()
  hw/pl110: Use LOG_GUEST_ERROR rather than hw_error()
  hw/pl080: Use LOG_GUEST_ERROR and LOG_UNIMP
  hw/pl061: Use LOG_GUEST_ERROR
  hw/pl050: Use LOG_GUEST_ERROR
  hw/exynos4_boards: Don't prematurely explode QEMUMachineInitArgs
  ...


  Commit: 46a3f234134a708883c4ace95d739f6226bb17f0
      https://github.com/qemu/qemu/commit/46a3f234134a708883c4ace95d739f6226bb17f0
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/spapr_pci.c
    M hw/spapr_pci.h
    M hw/xics.c
    M target-ppc/cpu.h
    M target-ppc/machine.c
    M target-ppc/translate.c

  Log Message:
  -----------
  Merge branch 'ppc-for-upstream' of git://repo.or.cz/qemu/agraf

* 'ppc-for-upstream' of git://repo.or.cz/qemu/agraf:
  pseries: Cleanup duplications of ics_valid_irq() code
  pseries: Clean up inconsistent variable name in xics.c
  target-ppc: Extend FPU state for newer POWER CPUs
  target-ppc: Rework storage of VPA registration state
  Revert "PPC: pseries: Remove hack for PIO window"


  Commit: fc53b7d4b7fe409acae7d8d55a868eb5c696d71c
      https://github.com/qemu/qemu/commit/fc53b7d4b7fe409acae7d8d55a868eb5c696d71c
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/arm-misc.h
    M hw/arm_boot.c

  Log Message:
  -----------
  arm_boot: Change initrd load address to "halfway through RAM"

To avoid continually having to bump the initrd load address
to account for larger kernel images, put the initrd halfway
through RAM. This allows large kernels on new boards with lots
of RAM to work OK, without breaking existing usecases for
boards with only 32MB of RAM.

Note that this change fixes in passing a bug where we were
passing an overly large max_size to load_image_targphys()
for the initrd, which meant that we wouldn't correctly refuse
to load an enormous initrd that didn't actually fit into RAM.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Reviewed-by: Igor Mitsyanko &lt;i.mitsyanko@samsung.com&gt;
Tested-by: Cole Robinson &lt;crobinso@redhat.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


Compare: https://github.com/qemu/qemu/compare/286d52ebfc0d...fc53b7d4b7fe

----==_mimepart_5092a395dcd49_331c18e7af09251a--


</body></email><email><emailId>20121101193025</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-01 19:30:25-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 019125: janitor: move iovector functions out of cutils.c</subject><body>



----==_mimepart_5092cdd1638f4_5b741480ae8686c0
Date: Thu, 01 Nov 2012 12:30:25 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;5092cdd16897f_5b741480ae86875f@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 0191253ceaf442e595cdd12ce80233b9de28cd13
      https://github.com/qemu/qemu/commit/0191253ceaf442e595cdd12ce80233b9de28cd13
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M Makefile
    M Makefile.objs
    M cutils.c
    M iov.c
    M tests/Makefile

  Log Message:
  -----------
  janitor: move iovector functions out of cutils.c

This removes the dependency of cutils.c on iov.c, and lets us remove
iov.o from several builds.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: f3192e8fb28529dd4fd777f916c437f49098ad39
      https://github.com/qemu/qemu/commit/f3192e8fb28529dd4fd777f916c437f49098ad39
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M Makefile
    M Makefile.objs

  Log Message:
  -----------
  build: move cutils.o and qemu-timer-common.o to oslib-obj-y

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 67d223be90178f7142b4f566358cea446af8df74
      https://github.com/qemu/qemu/commit/67d223be90178f7142b4f566358cea446af8df74
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M arch_init.h
    M compiler.h
    M qmp.c

  Log Message:
  -----------
  compiler: use weak aliases to provide default definitions

This is simpler and more portable.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: d249e1fc4fda57399fe64b3c0290d5d585fdf2e5
      https://github.com/qemu/qemu/commit/d249e1fc4fda57399fe64b3c0290d5d585fdf2e5
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M qemu-sockets.c
    M qemu-tool.c

  Log Message:
  -----------
  sockets: use weak aliases instead of qemu-tool.c

qemu-tool.c has its own (largeish) set of dependencies.  Weak aliases
can be placed directly where people use them, and do not contribute
to increasing the dependencies of generic utility files.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 0100fbbe73f1455ac66ec172627ff251a1f25302
      https://github.com/qemu/qemu/commit/0100fbbe73f1455ac66ec172627ff251a1f25302
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M cutils.c
    M osdep.c
    M qemu-common.h
    M qemu-tool.c
    M qemu-user.c

  Log Message:
  -----------
  fdsets: use weak aliases instead of qemu-tool.c/qemu-user.c

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 462016d2da393b743ba97552521378e7de2a4c7f
      https://github.com/qemu/qemu/commit/462016d2da393b743ba97552521378e7de2a4c7f
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M qemu-sockets.c

  Log Message:
  -----------
  iohandler: add weak alias in qemu-sockets.c, for qemu-ga

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: dbb5f3802e20af9a9971aa98d27c58839ea79a94
      https://github.com/qemu/qemu/commit/dbb5f3802e20af9a9971aa98d27c58839ea79a94
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M oslib-win32.c

  Log Message:
  -----------
  win32: add weak version of qemu_fd_register

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 744ca8e3754e6808c6b5331d287adc533fca0ad3
      https://github.com/qemu/qemu/commit/744ca8e3754e6808c6b5331d287adc533fca0ad3
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M qemu-timer.c

  Log Message:
  -----------
  qemu-timer: make initialization functions idempotent

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 172061a0a0d98c974ea8d5ed715195237bc44225
      https://github.com/qemu/qemu/commit/172061a0a0d98c974ea8d5ed715195237bc44225
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M main-loop.c
    M main-loop.h
    M qemu-tool.c
    M vl.c

  Log Message:
  -----------
  main-loop: unify qemu_init_main_loop between QEMU and tools

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 3f4cdf151145f7eaa3480aea5d81d7def2f85a68
      https://github.com/qemu/qemu/commit/3f4cdf151145f7eaa3480aea5d81d7def2f85a68
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M qemu-tool.c

  Log Message:
  -----------
  qemu-tool: do not depend on qemu-timer.c

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 63186e56c8b5f1c988bfb0d707e76f0f0dceef90
      https://github.com/qemu/qemu/commit/63186e56c8b5f1c988bfb0d707e76f0f0dceef90
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M qapi/Makefile.objs

  Log Message:
  -----------
  build: opts-visitor is not really part of QAPI

It is only used by QEMU itself, do not build it into the tests.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 136594f19aa6370e77a50bd9bba5db77def6ec8f
      https://github.com/qemu/qemu/commit/136594f19aa6370e77a50bd9bba5db77def6ec8f
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M Makefile
    M Makefile.objs
    M tests/Makefile

  Log Message:
  -----------
  build: do not include main loop where it is not actually used

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: fc97a652de3e54394ca4d0e5e5d689fd8aba8b6f
      https://github.com/qemu/qemu/commit/fc97a652de3e54394ca4d0e5e5d689fd8aba8b6f
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M Makefile.objs
    A event_notifier-posix.c
    A event_notifier-win32.c
    R event_notifier.c
    M event_notifier.h
    M qemu-os-win32.h

  Log Message:
  -----------
  event_notifier: add Win32 implementation

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: d0cc2fbfa607678866475383c508be84818ceb64
      https://github.com/qemu/qemu/commit/d0cc2fbfa607678866475383c508be84818ceb64
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M event_notifier-posix.c
    M event_notifier.h

  Log Message:
  -----------
  event_notifier: enable it to use pipes

This takes the eventfd emulation code from the main loop.  When the
EventNotifier is used for the main loop too, we need this compatibility
code.

Without CONFIG_EVENTFD, event_notifier_get_fd is only usable for the
"read" side of the notifier, for example to set a select() handler.

The return value of event_notifier_set changes to the cleaner 0/-errno.
No caller is actually checking the return value.

Reviewed-by: Anthony Liguori &lt;anthony@codemonkey.ws&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 1c53786fbdbdf20a3a6c556e09abb4d63ee7843e
      https://github.com/qemu/qemu/commit/1c53786fbdbdf20a3a6c556e09abb4d63ee7843e
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M vl.c

  Log Message:
  -----------
  vl: init main loop earlier

Otherwise, chardevs will not be able to create a bottom half as soon
as that will require an AioContext.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: b078dc3cfec2d6d037caef91204ebf0a78e7ac06
      https://github.com/qemu/qemu/commit/b078dc3cfec2d6d037caef91204ebf0a78e7ac06
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M aio.c
    M qemu-aio.h

  Log Message:
  -----------
  aio: change qemu_aio_set_fd_handler to return void

Reviewed-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 9958c351eee5b34051fd8061fe24f490ceca1334
      https://github.com/qemu/qemu/commit/9958c351eee5b34051fd8061fe24f490ceca1334
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M Makefile.objs
    M aio.c
    M qemu-aio.h

  Log Message:
  -----------
  aio: provide platform-independent API

This adds to aio.c a platform-independent API based on EventNotifiers, that
can be used by both POSIX and Win32.

Reviewed-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: f627aab1ccea119fd94ca9e9df120cea6aab0c67
      https://github.com/qemu/qemu/commit/f627aab1ccea119fd94ca9e9df120cea6aab0c67
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M aio.c
    M async.c
    M hw/hw.h
    M iohandler.c
    M linux-aio.c
    M main-loop.c
    M main-loop.h
    M qemu-aio.h
    M qemu-char.h
    M qemu-common.h
    M qemu-coroutine-lock.c

  Log Message:
  -----------
  aio: introduce AioContext, move bottom halves there

Start introducing AioContext, which will let us remove globals from
aio.c/async.c, and introduce multiple I/O threads.

The bottom half functions now take an additional AioContext argument.
A bottom half is created with a specific AioContext that remains the
same throughout the lifetime.  qemu_bh_new is just a wrapper that
uses a global context.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: a915f4bc977c4f3aab08a78023c1303664d1c606
      https://github.com/qemu/qemu/commit/a915f4bc977c4f3aab08a78023c1303664d1c606
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M aio.c
    M async.c
    M main-loop.c
    M qemu-aio.h

  Log Message:
  -----------
  aio: add I/O handlers to the AioContext interface

With this patch, I/O handlers (including event notifier handlers) can be
attached to a single AioContext.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 4231c88d27d9e46e6ad6e6b7bbb6e442bcf9cd05
      https://github.com/qemu/qemu/commit/4231c88d27d9e46e6ad6e6b7bbb6e442bcf9cd05
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M aio.c

  Log Message:
  -----------
  aio: test node-&gt;deleted before calling io_flush

Otherwise, there could be a case where io_flush accesses freed
memory because it should not have been called.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 7c0628b20e7c56b7e04abb8b5f8d7da3f7cb87e8
      https://github.com/qemu/qemu/commit/7c0628b20e7c56b7e04abb8b5f8d7da3f7cb87e8
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M aio.c
    M async.c
    M main-loop.c
    M qemu-aio.h

  Log Message:
  -----------
  aio: add non-blocking variant of aio_wait

This will be used when polling the GSource attached to an AioContext.

Reviewed-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: cd9ba1ebcf0439457f22b75b38533f6634f23c5f
      https://github.com/qemu/qemu/commit/cd9ba1ebcf0439457f22b75b38533f6634f23c5f
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M aio.c
    M qemu-aio.h

  Log Message:
  -----------
  aio: prepare for introducing GSource-based dispatch

This adds a GPollFD to each AioHandler.  It will then be possible to
attach these GPollFDs to a GSource, and from there to the main loop.
aio_wait examines the GPollFDs and avoids calling select() if any
is set (similar to what it does if bottom halves are available).

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: f42b22077bc63a482d7a8755b54e33475ab78541
      https://github.com/qemu/qemu/commit/f42b22077bc63a482d7a8755b54e33475ab78541
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M Makefile.objs
    A aio-posix.c
    A aio-win32.c
    R aio.c
    M block/Makefile.objs
    M main-loop.c

  Log Message:
  -----------
  aio: add Win32 implementation

The Win32 implementation will only accept EventNotifiers, thus a few
drivers are disabled under Windows.  EventNotifiers are a good match
for the GSource implementation, too, because the Win32 port of glib
allows to place their HANDLEs in a GPollFD.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: e3713e001fb7d4d82f6de82800c1463e758e4289
      https://github.com/qemu/qemu/commit/e3713e001fb7d4d82f6de82800c1463e758e4289
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M aio-posix.c
    M aio-win32.c
    M async.c
    M qemu-aio.h

  Log Message:
  -----------
  aio: make AioContexts GSources

This lets AioContexts be used (optionally) with a glib main loop.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 2f4dc3c1b2a453a8255d9b97c7cb87860123e495
      https://github.com/qemu/qemu/commit/2f4dc3c1b2a453a8255d9b97c7cb87860123e495
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M async.c
    M qemu-aio.h

  Log Message:
  -----------
  aio: add aio_notify

With this change async.c does not rely anymore on any service from
main-loop.c, i.e. it is completely self-contained.

Reviewed-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 7ed2b24ce17f8fb7e36e4e8d113f2a30cbea142f
      https://github.com/qemu/qemu/commit/7ed2b24ce17f8fb7e36e4e8d113f2a30cbea142f
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M aio-posix.c
    M aio-win32.c

  Log Message:
  -----------
  aio: call aio_notify after setting I/O handlers

In the current code, this is done by qemu_set_fd_handler2, which is
called by qemu_aio_set_fd_handler.  We need to keep the same behavior
even after removing the call to qemu_set_fd_handler2.

Reviewed-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 82cbbdc6a0958b49c77639a60906e30d02e6bb7b
      https://github.com/qemu/qemu/commit/82cbbdc6a0958b49c77639a60906e30d02e6bb7b
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M main-loop.c
    M main-loop.h

  Log Message:
  -----------
  main-loop: use GSource to poll AIO file descriptors

This lets us remove the hooks for the main loop in async.c.

Reviewed-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 4c8d0d27676778febad3802a95218d5ceaca171e
      https://github.com/qemu/qemu/commit/4c8d0d27676778febad3802a95218d5ceaca171e
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M main-loop.c

  Log Message:
  -----------
  main-loop: use aio_notify for qemu_notify_event

Reviewed-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 22bfa75eafc21522afbb265091faa9cc0649e9fb
      https://github.com/qemu/qemu/commit/22bfa75eafc21522afbb265091faa9cc0649e9fb
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M async.c
    M oslib-posix.c
    M qemu-aio.h
    M qemu-common.h

  Log Message:
  -----------
  aio: clean up now-unused functions

Some cleanups can now be made, now that the main loop does not anymore need
hooks into the bottom half code.

Reviewed-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: c90caf25e2b6945ae13560476a5ecd7992e9f945
      https://github.com/qemu/qemu/commit/c90caf25e2b6945ae13560476a5ecd7992e9f945
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M linux-aio.c

  Log Message:
  -----------
  linux-aio: use event notifiers

Since linux-aio already uses an eventfd, converting it to use the
EventNotifier-based API simplifies the code even though it is not
meant to be portable.

Reviewed-by: Anthony Liguori &lt;anthony@codemonkey.ws&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 18eb473f892642ae869f77403289167f30de2022
      https://github.com/qemu/qemu/commit/18eb473f892642ae869f77403289167f30de2022
  Author: Igor Mammedov &lt;imammedo@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: cpu_x86_register(): report error from property setter

Signed-off-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Reviewed-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: ff287bbdda016b37990be7ed52339750aaa8a5e4
      https://github.com/qemu/qemu/commit/ff287bbdda016b37990be7ed52339750aaa8a5e4
  Author: Igor Mammedov &lt;imammedo@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/helper.c

  Log Message:
  -----------
  target-i386: If x86_cpu_realize() failed, report error and do cleanup

Signed-off-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: bdeec802170d5dc9f0f8a01235c3488dca3ff83b
      https://github.com/qemu/qemu/commit/bdeec802170d5dc9f0f8a01235c3488dca3ff83b
  Author: Igor Mammedov &lt;imammedo@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/pc.c
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: Initialize APIC at CPU level

(L)APIC is a part of cpu [1] so move APIC initialization inside of
x86_cpu object. Since cpu_model and override flags currently specify
whether APIC should be created or not, APIC creation&amp;initialization is
moved into x86_cpu_apic_init() which is called from x86_cpu_realize().

[1] - all x86 cpus have integrated APIC if we overlook existence of i486,
and it's more convenient to model after majority of them.

Signed-off-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 449994eb58a4175a2e7656175b18c65ead6c09ca
      https://github.com/qemu/qemu/commit/449994eb58a4175a2e7656175b18c65ead6c09ca
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/apic_common.c
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: Inline APIC cpu_env property setting

This prepares for changing the variable type from void*.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Reviewed-by: Igor Mammedov &lt;imammedo@redhat.com&gt;


  Commit: 60671e583c2bfb09746f59268fdc7d88eaa24deb
      https://github.com/qemu/qemu/commit/60671e583c2bfb09746f59268fdc7d88eaa24deb
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/apic.c
    M hw/apic_common.c
    M hw/apic_internal.h
    M hw/kvm/apic.c
    M target-i386/cpu.c

  Log Message:
  -----------
  apic: Store X86CPU in APICCommonState

Prepares for using a link&lt;&gt; property to connect APIC with CPU and for
changing the CPU APIs to CPUState.

Resolve Coding Style warnings by moving the closing parenthesis of
foreach_apic() macro to next line.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Reviewed-by: Igor Mammedov &lt;imammedo@redhat.com&gt;


  Commit: e9f9d6b16510776ae3d07e91b1cfb4d412701270
      https://github.com/qemu/qemu/commit/e9f9d6b16510776ae3d07e91b1cfb4d412701270
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/apic.c
    M target-i386/cpu.h

  Log Message:
  -----------
  target-i386: Pass X86CPU to cpu_x86_load_seg_cache_sipi()

Simplifies the call in apic_sipi() again and needed for moving halted
field to CPUState.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Reviewed-by: Igor Mammedov &lt;imammedo@redhat.com&gt;


  Commit: 60e82579c75068cb49af95595aa99d727e657a0a
      https://github.com/qemu/qemu/commit/60e82579c75068cb49af95595aa99d727e657a0a
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M cpus.c
    M exec.c
    M hw/apic.c
    M include/qemu/cpu.h
    M kvm-all.c
    M qemu-common.h
    M target-i386/kvm.c

  Log Message:
  -----------
  cpus: Pass CPUState to qemu_cpu_is_self()

Change return type to bool, move to include/qemu/cpu.h and
add documentation.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Reviewed-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
[AF: Updated new caller qemu_in_vcpu_thread()]


  Commit: 2ff09a40a8399a6f9807ebdb72423ec0a581c3b3
      https://github.com/qemu/qemu/commit/2ff09a40a8399a6f9807ebdb72423ec0a581c3b3
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M cpus.c

  Log Message:
  -----------
  cpus: Pass CPUState to qemu_cpu_kick_thread()

CPUArchState is no longer needed there.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Reviewed-by: Igor Mammedov &lt;imammedo@redhat.com&gt;


  Commit: 61a4621784a808f5ad7d63f60e2c5e8b2488c213
      https://github.com/qemu/qemu/commit/61a4621784a808f5ad7d63f60e2c5e8b2488c213
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M cpu-defs.h
    M cpus.c
    M include/qemu/cpu.h

  Log Message:
  -----------
  cpu: Move created field to CPUState

Change its type to bool.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 4fdeee7cd4c8f90ef765537b9346a195d9483ab5
      https://github.com/qemu/qemu/commit/4fdeee7cd4c8f90ef765537b9346a195d9483ab5
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M cpu-defs.h
    M cpus.c
    M include/qemu/cpu.h

  Log Message:
  -----------
  cpu: Move stop field to CPUState

Change its type to bool.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: b6444a42c06371d5abba78d2553a088a8490a65b
      https://github.com/qemu/qemu/commit/b6444a42c06371d5abba78d2553a088a8490a65b
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/ppce500_spin.c

  Log Message:
  -----------
  ppce500_spin: Store PowerPCCPU in SpinKick

Needed for moving stopped field to CPUState.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: f324e7667a3c1f1aed9a5169a63aaac628feef47
      https://github.com/qemu/qemu/commit/f324e7667a3c1f1aed9a5169a63aaac628feef47
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M cpu-defs.h
    M cpus.c
    M hw/ppce500_spin.c
    M include/qemu/cpu.h

  Log Message:
  -----------
  cpu: Move stopped field to CPUState

Change its type to bool.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 2fa45344a92444439c081cad2342ffc048c381ad
      https://github.com/qemu/qemu/commit/2fa45344a92444439c081cad2342ffc048c381ad
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M cpu-all.h
    M cpus.c
    M include/qemu/cpu.h
    M target-i386/kvm.c

  Log Message:
  -----------
  cpus: Pass CPUState to cpu_is_stopped()

CPUArchState is no longer needed there.

Also change the return type to bool.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: a1fcaa73b1be5d8f0c6682d0f8d268f6e3194ead
      https://github.com/qemu/qemu/commit/a1fcaa73b1be5d8f0c6682d0f8d268f6e3194ead
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M cpus.c

  Log Message:
  -----------
  cpus: Pass CPUState to cpu_can_run()

CPUArchState is no longer needed there.

Also change its return type to bool.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: f5c121b85832f69fde5ad8939274e04ad21c1bd6
      https://github.com/qemu/qemu/commit/f5c121b85832f69fde5ad8939274e04ad21c1bd6
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M cpu-defs.h
    M cpus.c
    M include/qemu/cpu.h

  Log Message:
  -----------
  cpu: Move halt_cond to CPUState

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: c3586ba73fd4523a38c658f730cc38ec17b60491
      https://github.com/qemu/qemu/commit/c3586ba73fd4523a38c658f730cc38ec17b60491
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M cpus.c

  Log Message:
  -----------
  cpus: Pass CPUState to qemu_tcg_cpu_thread_fn

CPUArchState is no longer needed except for iterating the CPUs.

Needed for qemu_tcg_init_vcpu().

KVM and dummy threads still need CPUArchState for cpu_single_env.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: e5ab30a2e6ee5f649af0639f93b6e8f6587e7ba1
      https://github.com/qemu/qemu/commit/e5ab30a2e6ee5f649af0639f93b6e8f6587e7ba1
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M cpus.c

  Log Message:
  -----------
  cpus: Pass CPUState to qemu_tcg_init_vcpu()

CPUArchState is no longer needed.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: a096124571b71f02d49a97ca99f4bf7b97b6912a
      https://github.com/qemu/qemu/commit/a096124571b71f02d49a97ca99f4bf7b97b6912a
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/ppc.c

  Log Message:
  -----------
  ppc: Pass PowerPCCPU to {ppc6xx,ppc970,power7,ppc40x,ppce500}_set_irq()

Needed for changing qemu_cpu_kick() argument type to CPUState and
for moving halted field into CPUState.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: d5a6814697014561dd0a2e2871df0e6c62a0ce59
      https://github.com/qemu/qemu/commit/d5a6814697014561dd0a2e2871df0e6c62a0ce59
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-ppc/kvm.c

  Log Message:
  -----------
  target-ppc: Rename kvm_kick_{env =&gt; cpu} and pass PowerPCCPU

Needed for changing qemu_cpu_kick() argument type to CPUState.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: c08d7424d600dce915a5506e95d55a359c243c66
      https://github.com/qemu/qemu/commit/c08d7424d600dce915a5506e95d55a359c243c66
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M cpus.c
    M exec.c
    M hw/ppc.c
    M hw/ppce500_spin.c
    M hw/spapr_rtas.c
    M hw/sun4m.c
    M hw/sun4u.c
    M include/qemu/cpu.h
    M kvm-all.c
    M qemu-common.h
    M target-ppc/kvm.c
    M target-s390x/kvm.c

  Log Message:
  -----------
  cpus: Pass CPUState to qemu_cpu_kick()

CPUArchState is no longer needed there.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: c64ca8140e9c21cd0d44c10fbe1247cb4ade8e6e
      https://github.com/qemu/qemu/commit/c64ca8140e9c21cd0d44c10fbe1247cb4ade8e6e
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M cpu-defs.h
    M cpus.c
    M include/qemu/cpu.h

  Log Message:
  -----------
  cpu: Move queued_work_{first,last} to CPUState

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 6d45b109a6869084abd0f9aba01fa5107e926b60
      https://github.com/qemu/qemu/commit/6d45b109a6869084abd0f9aba01fa5107e926b60
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M cpus.c

  Log Message:
  -----------
  cpus: Pass CPUState to flush_queued_work()

CPUArchState is no longer needed there.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 509a0d78c7c3927b9ec8e176abef09ddd28ff0b3
      https://github.com/qemu/qemu/commit/509a0d78c7c3927b9ec8e176abef09ddd28ff0b3
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M cpus.c

  Log Message:
  -----------
  cpus: Pass CPUState to qemu_wait_io_event_common()

CPUArchState is no longer needed there.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 79bbf20bcaf2ee5d8e3f93a5151d992fc9a5fd89
      https://github.com/qemu/qemu/commit/79bbf20bcaf2ee5d8e3f93a5151d992fc9a5fd89
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/xtensa_pic.c

  Log Message:
  -----------
  xtensa_pic: Pass XtensaCPU to xtensa_ccompare_cb()

Needed for changing cpu_has_work() argument type to CPUState.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Acked-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;


  Commit: 5c26a5b3033fbbbfc033f7d8d0b50713c31517d1
      https://github.com/qemu/qemu/commit/5c26a5b3033fbbbfc033f7d8d0b50713c31517d1
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-ppc/excp_helper.c

  Log Message:
  -----------
  target-ppc: Pass PowerPCCPU to powerpc_excp()

Needed for changing cpu_ppc_hypercall() argument type to PowerPCCPU.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 1b14670a38a2265d3dd573b5e2d611621a5929f0
      https://github.com/qemu/qemu/commit/1b14670a38a2265d3dd573b5e2d611621a5929f0
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/spapr.c
    M target-ppc/cpu.h
    M target-ppc/excp_helper.c

  Log Message:
  -----------
  target-ppc: Pass PowerPCCPU to cpu_ppc_hypercall

Adapt emulate_spapr_hypercall() accordingly.

Needed for changing spapr_hypercall() argument type to PowerPCCPU.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: aa100fa4c9901c6a88d24f48d485dbe0147b317d
      https://github.com/qemu/qemu/commit/aa100fa4c9901c6a88d24f48d485dbe0147b317d
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/spapr.c
    M hw/spapr.h
    M hw/spapr_hcall.c
    M target-ppc/kvm.c

  Log Message:
  -----------
  spapr: Pass PowerPCCPU to spapr_hypercall()

Needed for changing the hypercall handlers' argument type to PowerPCCPU.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: b13ce26d3e8c6682044ae84920f2417b30ce356b
      https://github.com/qemu/qemu/commit/b13ce26d3e8c6682044ae84920f2417b30ce356b
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/spapr.h
    M hw/spapr_hcall.c
    M hw/spapr_iommu.c
    M hw/spapr_llan.c
    M hw/spapr_vio.c
    M hw/spapr_vty.c
    M hw/xics.c

  Log Message:
  -----------
  spapr: Pass PowerPCCPU to hypercalls

Needed for changing cpu_has_work() argument type to CPUState,
used in h_cede().

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 7b46e5ce81d5107927685e7645b1bd39a1e1cd63
      https://github.com/qemu/qemu/commit/7b46e5ce81d5107927685e7645b1bd39a1e1cd63
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/kvm.c

  Log Message:
  -----------
  i386: kvm: kvm_arch_get_supported_cpuid: move R_EDX hack outside of for loop

The for loop will become a separate function, so clean it up so it can
become independent from the bit hacking for R_EDX.

No behavior change[1], just code movement.

[1] Well, only if the kernel returned CPUID leafs 1 or 0x80000001 as
    unsupported, but there's no kernel version that does that.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 8c723b7958127b8f204dd4b278ad3c8f6f48ae17
      https://github.com/qemu/qemu/commit/8c723b7958127b8f204dd4b278ad3c8f6f48ae17
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/kvm.c

  Log Message:
  -----------
  i386: kvm: kvm_arch_get_supported_cpuid: clean up has_kvm_features check

Instead of a function-specific has_kvm_features variable, simply use a
"found" variable that will be checked in case we have to use the legacy
get_para_features() interface.

No behavior change, just code cleanup.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 47111e2cfa1a83a99ac10ed19c7c8b02be4fe973
      https://github.com/qemu/qemu/commit/47111e2cfa1a83a99ac10ed19c7c8b02be4fe973
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/kvm.c

  Log Message:
  -----------
  i386: kvm: kvm_arch_get_supported_cpuid: use 'entry' variable

The reg switch will be moved to a separate function, so store the entry
pointer in a variable.

No behavior change, just code movement.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 829ae2f9fa37bf026de556f50d58ef14a7dab9b3
      https://github.com/qemu/qemu/commit/829ae2f9fa37bf026de556f50d58ef14a7dab9b3
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/kvm.c

  Log Message:
  -----------
  i386: kvm: extract register switch to cpuid_entry_get_reg() function

No behavior change: just code movement.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 4fb73f1d3be285caeb52a58fa5eaea49bd918650
      https://github.com/qemu/qemu/commit/4fb73f1d3be285caeb52a58fa5eaea49bd918650
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/kvm.c

  Log Message:
  -----------
  i386: kvm: extract CPUID entry lookup to cpuid_find_entry() function

No behavior change, just code movement.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: dd87f8a690330777363f9a8680fce8f2ec544414
      https://github.com/qemu/qemu/commit/dd87f8a690330777363f9a8680fce8f2ec544414
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/kvm.c

  Log Message:
  -----------
  i386: kvm: extract try_get_cpuid() loop to get_supported_cpuid() function

No behavior change, just code movement.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: c2acb022c83fbaf7fdd7ab9538d44ae6e0e94f94
      https://github.com/qemu/qemu/commit/c2acb022c83fbaf7fdd7ab9538d44ae6e0e94f94
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/kvm.c

  Log Message:
  -----------
  i386: kvm: kvm_arch_get_supported_cpuid: replace if+switch with single 'if'

Additional fixups will be added, and making them a single 'if/else if'
chain makes it clearer than two nested switch statements.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 84bd945cf298650096691509e7e9170036605e02
      https://github.com/qemu/qemu/commit/84bd945cf298650096691509e7e9170036605e02
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/kvm.c

  Log Message:
  -----------
  i386: kvm: set CPUID_EXT_HYPERVISOR on kvm_arch_get_supported_cpuid()

Full grep for kvm_arch_get_supported_cpuid:

   kvm.h:uint32_t kvm_arch_get_supported_cpuid(KVMState *env, uint32_t function,
   target-i386/cpu.c:        x86_cpu_def-&gt;cpuid_7_0_ebx_features = \
kvm_arch_get_supported_cpuid(kvm_state, 0x7, 0, R_EBX);  target-i386/cpu.c:           \
*eax = kvm_arch_get_supported_cpuid(s, 0xA, count, R_EAX);  target-i386/cpu.c:        \
*ebx = kvm_arch_get_supported_cpuid(s, 0xA, count, R_EBX);  target-i386/cpu.c:        \
*ecx = kvm_arch_get_supported_cpuid(s, 0xA, count, R_ECX);  target-i386/cpu.c:        \
*edx = kvm_arch_get_supported_cpuid(s, 0xA, count, R_EDX);  target-i386/cpu.c:        \
*eax = kvm_arch_get_supported_cpuid(s, 0xd, count, R_EAX);  target-i386/cpu.c:        \
*ebx = kvm_arch_get_supported_cpuid(s, 0xd, count, R_EBX);  target-i386/cpu.c:        \
*ecx = kvm_arch_get_supported_cpuid(s, 0xd, count, R_ECX);  target-i386/cpu.c:        \
*edx = kvm_arch_get_supported_cpuid(s, 0xd, count, R_EDX);  \
target-i386/kvm.c:uint32_t kvm_arch_get_supported_cpuid(KVMState *s, uint32_t \
function,  target-i386/kvm.c:        cpuid_1_edx = kvm_arch_get_supported_cpuid(s, 1, \
0, R_EDX);  target-i386/kvm.c:    env-&gt;cpuid_features &amp;= \
                kvm_arch_get_supported_cpuid(s, 1, 0, R_EDX);
 * target-i386/kvm.c:    env-&gt;cpuid_ext_features &amp;= kvm_arch_get_supported_cpuid(s, \
1, 0, R_ECX);  target-i386/kvm.c:    env-&gt;cpuid_ext2_features &amp;= \
kvm_arch_get_supported_cpuid(s, 0x80000001,  target-i386/kvm.c:    \
env-&gt;cpuid_ext3_features &amp;= kvm_arch_get_supported_cpuid(s, 0x80000001,  \
target-i386/kvm.c:    env-&gt;cpuid_svm_features  &amp;= kvm_arch_get_supported_cpuid(s, \
0x8000000A,  target-i386/kvm.c:        kvm_arch_get_supported_cpuid(s, \
KVM_CPUID_FEATURES, 0, R_EAX);  target-i386/kvm.c:            \
kvm_arch_get_supported_cpuid(s, 0xC0000001, 0, R_EDX);

Note that there is only one call for CPUID[1].ECX above (*), and it is
the one that gets hacked to include CPUID_EXT_HYPERVISOR, so we can
simply make kvm_arch_get_supported_cpuid() set it, to let the rest of
the code automatically know that the flag can be safely set by QEMU.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: ac67ee260ae8e353314b6995ed5dccf1bb94fa9d
      https://github.com/qemu/qemu/commit/ac67ee260ae8e353314b6995ed5dccf1bb94fa9d
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/kvm.c

  Log Message:
  -----------
  i386: kvm: set CPUID_EXT_TSC_DEADLINE_TIMER on kvm_arch_get_supported_cpuid()

This moves the CPUID_EXT_TSC_DEADLINE_TIMER CPUID flag hacking from
kvm_arch_init_vcpu() to kvm_arch_get_supported_cpuid().

Full git grep for kvm_arch_get_supported_cpuid:

   kvm.h:uint32_t kvm_arch_get_supported_cpuid(KVMState *env, uint32_t function,
   target-i386/cpu.c:        x86_cpu_def-&gt;cpuid_7_0_ebx_features = \
kvm_arch_get_supported_cpuid(kvm_state, 0x7, 0, R_EBX);  target-i386/cpu.c:           \
*eax = kvm_arch_get_supported_cpuid(s, 0xA, count, R_EAX);  target-i386/cpu.c:        \
*ebx = kvm_arch_get_supported_cpuid(s, 0xA, count, R_EBX);  target-i386/cpu.c:        \
*ecx = kvm_arch_get_supported_cpuid(s, 0xA, count, R_ECX);  target-i386/cpu.c:        \
*edx = kvm_arch_get_supported_cpuid(s, 0xA, count, R_EDX);  target-i386/cpu.c:        \
*eax = kvm_arch_get_supported_cpuid(s, 0xd, count, R_EAX);  target-i386/cpu.c:        \
*ebx = kvm_arch_get_supported_cpuid(s, 0xd, count, R_EBX);  target-i386/cpu.c:        \
*ecx = kvm_arch_get_supported_cpuid(s, 0xd, count, R_ECX);  target-i386/cpu.c:        \
*edx = kvm_arch_get_supported_cpuid(s, 0xd, count, R_EDX);  \
target-i386/kvm.c:uint32_t kvm_arch_get_supported_cpuid(KVMState *s, uint32_t \
function,  target-i386/kvm.c:        cpuid_1_edx = kvm_arch_get_supported_cpuid(s, 1, \
0, R_EDX);  target-i386/kvm.c:    env-&gt;cpuid_features &amp;= \
                kvm_arch_get_supported_cpuid(s, 1, 0, R_EDX);
 * target-i386/kvm.c:    env-&gt;cpuid_ext_features &amp;= kvm_arch_get_supported_cpuid(s, \
1, 0, R_ECX);  target-i386/kvm.c:    env-&gt;cpuid_ext2_features &amp;= \
kvm_arch_get_supported_cpuid(s, 0x80000001,  target-i386/kvm.c:    \
env-&gt;cpuid_ext3_features &amp;= kvm_arch_get_supported_cpuid(s, 0x80000001,  \
target-i386/kvm.c:    env-&gt;cpuid_svm_features  &amp;= kvm_arch_get_supported_cpuid(s, \
0x8000000A,  target-i386/kvm.c:        kvm_arch_get_supported_cpuid(s, \
KVM_CPUID_FEATURES, 0, R_EAX);  target-i386/kvm.c:            \
kvm_arch_get_supported_cpuid(s, 0xC0000001, 0, R_EDX);

Note that there is only one call for CPUID[1].ECX above (*), and it is
the one that gets hacked to include CPUID_EXT_TSC_DEADLINE_TIMER, so we
can simply make kvm_arch_get_supported_cpuid() set it, to let the rest
of the code know the flag can be safely set by QEMU.

One thing I was worrying about when doing this is that now
kvm_arch_get_supported_cpuid() depends on kvm_irqchip_in_kernel(). But
the 'kvm_kernel_irqchip' global variable is initialized during
kvm_init(), that is called very early, and kvm_init() is already a
requirement to run the GET_SUPPORTED_CPUID ioctl() (as kvm_init() is the
function that initializes the 'kvm_state' global variable).

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 41e5e76db07b52591d9c9b88826278b8a5112258
      https://github.com/qemu/qemu/commit/41e5e76db07b52591d9c9b88826278b8a5112258
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/kvm.c

  Log Message:
  -----------
  i386: kvm: x2apic is not supported without in-kernel irqchip

This is necessary so that x2apic is not improperly enabled when the
in-kernel irqchip is disabled.

This won't generate a warning with "-cpu ...,check" because the current
check/enforce code is broken (it checks the host CPU data directly,
instead of using kvm_arch_get_supported_cpuid()), but it will be
eventually fixed to properly report the missing x2apic flag.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: ea85c9e45655c5e3a665a5295e5338b995e4a29c
      https://github.com/qemu/qemu/commit/ea85c9e45655c5e3a665a5295e5338b995e4a29c
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/kvm.c

  Log Message:
  -----------
  i386: kvm: mask cpuid_kvm_features earlier

Instead of masking the KVM feature bits very late (while building the
KVM_SET_CPUID2 data), mask it out on env-&gt;cpuid_kvm_features, at the
same point where the other feature words are masked out.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: c9da8382c1432fbafb8705e7faecdf783c0b1821
      https://github.com/qemu/qemu/commit/c9da8382c1432fbafb8705e7faecdf783c0b1821
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/kvm.c

  Log Message:
  -----------
  i386: kvm: mask cpuid_ext4_features bits earlier

This way all the filtering by GET_SUPPORTED_CPUID is being done at the
same place in the code.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: bc74b7db86bc84d3e027ac7b536e8e39140d984f
      https://github.com/qemu/qemu/commit/bc74b7db86bc84d3e027ac7b536e8e39140d984f
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M kvm.h
    M target-i386/cpu.c
    M target-i386/kvm.c

  Log Message:
  -----------
  i386: kvm: filter CPUID feature words earlier, on cpu.c

cpu.c contains the code that will check if all requested CPU features
are available, so the filtering of KVM features must be there, so we can
implement "check" and "enforce" properly.

The only point where kvm_arch_init_vcpu() is called on i386 is:

- cpu_x86_init()
  - x86_cpu_realize() (after cpu_x86_register() is called)
    - qemu_init_vcpu()
      - qemu_kvm_start_vcpu()
  - qemu_kvm_thread_fn() (on a new thread)
    - kvm_init_vcpu()
      - kvm_arch_init_vcpu()

With this patch, the filtering will be done earlier, at:
- cpu_x86_init()
  - cpu_x86_register() (before x86_cpu_realize() is called)

Also, the KVM CPUID filtering will now be done at the same place where
the TCG CPUID feature filtering is done. Later, the code can be changed
to use the same filtering code for the "check" and "enforce" modes, as
now the cpu.c code knows exactly which CPU features are going to be
exposed to the guest (and much earlier).

One thing I was worrying about when doing this is that
kvm_arch_get_supported_cpuid() depends on kvm_irqchip_in_kernel(), and
maybe the 'kvm_kernel_irqchip' global variable wasn't initialized yet at
CPU creation time. But kvm_kernel_irqchip is initialized during
kvm_init(), that is called very early (much earlier than the machine
init function), and kvm_init() is already a requirement to run the
GET_SUPPORTED_CPUID ioctl() (as kvm_init() initializes the kvm_state
global variable).

Side note: it would be nice to keep KVM-specific code inside kvm.c. The
problem is that properly implementing -cpu check/enforce code (that's
inside cpu.c) depends directly on the feature bit filtering done using
kvm_arch_get_supported_cpuid(). Currently -cpu check/enforce is broken
because it simply uses the host CPU feature bits instead of
GET_SUPPORTED_CPUID, and we need to fix that.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: b8091f245d36da604219db42552cc28400698446
      https://github.com/qemu/qemu/commit/b8091f245d36da604219db42552cc28400698446
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  i386: kvm: reformat filter_features_for_kvm() code

Cosmetic, but it will also help to make futher patches easier to review.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: ffa8c11f0bbf47e1b7a3a62f97bc1da591c6734a
      https://github.com/qemu/qemu/commit/ffa8c11f0bbf47e1b7a3a62f97bc1da591c6734a
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  i386: kvm: filter CPUID leaf 7 based on GET_SUPPORTED_CPUID, too

Now that CPUID leaf 7 features can be enabled/disabled on the
command-line, we need to filter them properly using GET_SUPPORTED_CPUID,
at the same place where other features are filtered out.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 811a8ae09e179d0a4d8cde13ba9f72e7c782c9ff
      https://github.com/qemu/qemu/commit/811a8ae09e179d0a4d8cde13ba9f72e7c782c9ff
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  i386: cpu: add missing CPUID[EAX=7,ECX=0] flag names

This makes QEMU recognize the following CPU flag names:

 Flags            | Corresponding KVM kernel commit
 -----------------+----------------------------------------
 FSGSBASE         | 176f61da82435eae09cc96f70b530d1ba0746b8b
 AVX2, BMI1, BMI2 | fb215366b3c7320ac25dca766a0152df16534932
 HLE, RTM         | 83c529151ab0d4a813e3f6a3e293fff75d468519
 INVPCID          | ad756a1603c5fac207758faaac7f01c34c9d0b7b
 ERMS             | a01c8f9b4e266df1d7166d23216f2060648f862d

Reviewed-by: Don Slutz &lt;Don@CloudSwitch.com&gt;
Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: c3d3980794124508e0bd4eaa406d7fa0e832a221
      https://github.com/qemu/qemu/commit/c3d3980794124508e0bd4eaa406d7fa0e832a221
  Author: Don Slutz &lt;Don@CloudSwitch.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: Add missing kvm cpuid feature name

Currently "-cpu host,-kvmclock,-kvm_nopiodelay,-kvm_mmu" does not
turn off all bits in CPUID 0x40000001 EAX.

The missing ones is KVM_FEATURE_STEAL_TIME.

This adds the name kvm_steal_time.

Signed-off-by: Don Slutz &lt;Don@CloudSwitch.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 19403a68fb8eaefb2e1245b6a8384d3a3ffa7ca0
      https://github.com/qemu/qemu/commit/19403a68fb8eaefb2e1245b6a8384d3a3ffa7ca0
  Author: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/cirrus_vga.c

  Log Message:
  -----------
  cirrus_vga: allow configurable vram size

Allow RAM size to be configurable for cirrus, to allow migration
compatibility from qemu-kvm.

Acked-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: e43d594ee55038442d59d301eb34fdf0c378d3a4
      https://github.com/qemu/qemu/commit/e43d594ee55038442d59d301eb34fdf0c378d3a4
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M qemu-options.hx
    M vl.c

  Log Message:
  -----------
  Use machine options to emulate -no-kvm-irqchip

Releases of qemu-kvm will be interrupted at qemu 1.3.0.
Users should switch to plain qemu releases.
To avoid breaking scenarios which are setup with command line
options specific to qemu-kvm, port these switches from qemu-kvm
to qemu.git.

Port -no-kvm-irqchip option.

Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 4086bde8c08746913d7ca6dcbc5e18a49a627cdc
      https://github.com/qemu/qemu/commit/4086bde8c08746913d7ca6dcbc5e18a49a627cdc
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M qemu-options.hx
    M vl.c

  Log Message:
  -----------
  Issue warning when deprecated -no-kvm-pit is used

Releases of qemu-kvm will be interrupted at qemu 1.3.0.
Users should switch to plain qemu releases.
To avoid breaking scenarios which are setup with command line
options specific to qemu-kvm, port these switches from qemu-kvm
to qemu.git.

Port -no-kvm-pit option.

Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: c21fb4f8b802108697f9353a8f807079507b586c
      https://github.com/qemu/qemu/commit/c21fb4f8b802108697f9353a8f807079507b586c
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M qemu-options.hx
    M vl.c

  Log Message:
  -----------
  Use global properties to emulate -no-kvm-pit-reinjection

Releases of qemu-kvm will be interrupted at qemu 1.3.0.
Users should switch to plain qemu releases.
To avoid breaking scenarios which are setup with command line
options specific to qemu-kvm, port these switches from qemu-kvm
to qemu.git.

Port -no-kvm-pit-reinjection.

Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 0d92d17a6d0d65af8cb905bdd5f9e04e210564ff
      https://github.com/qemu/qemu/commit/0d92d17a6d0d65af8cb905bdd5f9e04e210564ff
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M blockdev.c
    M qemu-config.c

  Log Message:
  -----------
  Issue warning when deprecated drive parameter boot=on|off is used

Releases of qemu-kvm will be interrupted at qemu 1.3.0.
Users should switch to plain qemu releases.
To avoid breaking scenarios which are setup with command line
options specific to qemu-kvm, port these switches from qemu-kvm
to qemu.git.

Port drive boot option. From the qemu-kvm original commit message:

We do not want to maintain this option forever. It will be removed after
a grace period of a few releases. So warn the user that this option has
no effect and will become invalid soon.

Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 88eed34a6b3eba46397de5aaf24ed66ea290794b
      https://github.com/qemu/qemu/commit/88eed34a6b3eba46397de5aaf24ed66ea290794b
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M qemu-options.hx
    M vl.c

  Log Message:
  -----------
  Issue warning when deprecated -tdf option is used

Releases of qemu-kvm will be interrupted at qemu 1.3.0.
Users should switch to plain qemu releases.
To avoid breaking scenarios which are setup with command line
options specific to qemu-kvm, port these switches from qemu-kvm
to qemu.git.

Port -tdf option.

Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: a0dac021fa4b8b87160192c1f60ee26fc6c5ce2e
      https://github.com/qemu/qemu/commit/a0dac021fa4b8b87160192c1f60ee26fc6c5ce2e
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M qemu-options.hx
    M vl.c

  Log Message:
  -----------
  Emulate qemu-kvms -no-kvm option

Releases of qemu-kvm will be interrupted at qemu 1.3.0.
Users should switch to plain qemu releases.
To avoid breaking scenarios which are setup with command line
options specific to qemu-kvm, port these switches from qemu-kvm
to qemu.git.

Port -no-kvm option.

Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 1aefc6b8cbe66e5adb3e6b160f6790171e0a7785
      https://github.com/qemu/qemu/commit/1aefc6b8cbe66e5adb3e6b160f6790171e0a7785
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: make cpu_x86_fill_host() void

The return value of that function is always 0, and is always ignored.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 6e746f30558cb1331598575918c2a8808be2a75b
      https://github.com/qemu/qemu/commit/6e746f30558cb1331598575918c2a8808be2a75b
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: cpu: make -cpu host/check/enforce code KVM-specific

Rationale:
 * "-cpu host" is available only when using KVM
 * The current implementation of -cpu check/enforce
   (check_features_against_host()) makes sense only when using KVM.

So this makes the functions check_features_against_host() and
cpu_x86_fill_host() KVM-specific, document them as such, and rename them
to kvm_check_features_against_host() and kvm_cpu_fill_host().

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 12869995ea4f436ab76af5059fd2e9ae83c6cf9d
      https://github.com/qemu/qemu/commit/12869995ea4f436ab76af5059fd2e9ae83c6cf9d
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: kvm_cpu_fill_host: use GET_SUPPORTED_CPUID

Change the kvm_cpu_fill_host() function to use
kvm_arch_get_supported_cpuid() instead of running the CPUID instruction
directly, when checking for supported CPUID features.

This should solve two problems at the same time:

 * "-cpu host" was not enabling features that don't need support on
   the host CPU (e.g. x2apic);
 * "check" and "enforce" options were not detecting problems when the
   host CPU did support a feature, but the KVM kernel code didn't
   support it.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: b55f546eefe79cb6e6b15ebb23f352a736bafc39
      https://github.com/qemu/qemu/commit/b55f546eefe79cb6e6b15ebb23f352a736bafc39
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M scripts/update-linux-headers.sh

  Log Message:
  -----------
  update-linux-headers.sh: Handle new kernel uapi/ directories

Recent kernels have moved to keeping the userspace headers
in uapi/ subdirectories. This breaks the detection of whether an
architecture has KVM support in the kernel because kvm.h has
moved in the kernel source tree. Update the check to support
both the old and new locations.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 3993c6bddf6da21977349ba1b14b86294ef4f7ff
      https://github.com/qemu/qemu/commit/3993c6bddf6da21977349ba1b14b86294ef4f7ff
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M cpu-all.h
    M cpu-exec.c
    M cpus.c
    M hw/spapr_hcall.c
    M hw/xtensa_pic.c
    M include/qemu/cpu.h
    M target-alpha/cpu.c
    M target-alpha/cpu.h
    M target-arm/cpu.h
    M target-cris/cpu.h
    M target-i386/cpu.h
    M target-lm32/cpu.h
    M target-m68k/cpu.h
    M target-microblaze/cpu.h
    M target-mips/cpu.h
    M target-openrisc/cpu.h
    M target-ppc/cpu.h
    M target-s390x/cpu.h
    M target-sh4/cpu.h
    M target-sparc/cpu.h
    M target-unicore32/cpu.c
    M target-unicore32/cpu.h
    M target-xtensa/cpu.h

  Log Message:
  -----------
  cpus: Pass CPUState to [qemu_]cpu_has_work()

For target-mips also change the return type to bool.

Make include paths for cpu-qom.h consistent for alpha and unicore32.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
[AF: Updated new target-openrisc function accordingly]
Acked-by: Richard Henderson &lt;rth@twiddle.net&gt; (for alpha)


  Commit: bee615d4b945e6d88dc37a39e40be9f105622f8d
      https://github.com/qemu/qemu/commit/bee615d4b945e6d88dc37a39e40be9f105622f8d
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/kvm.c

  Log Message:
  -----------
  target-i386: Pass X86CPU to kvm_mce_inject()

Needed for changing cpu_x86_inject_mce() argument to X86CPU.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
[AF: Rebased onto hwaddr]


  Commit: 8c5cf3b6219d5d5fb61a9d6e59022fc72dab8f85
      https://github.com/qemu/qemu/commit/8c5cf3b6219d5d5fb61a9d6e59022fc72dab8f85
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M monitor.c
    M target-i386/cpu.h
    M target-i386/helper.c
    M target-i386/kvm.c

  Log Message:
  -----------
  target-i386: Pass X86CPU to cpu_x86_inject_mce()

Needed for changing run_on_cpu() argument to CPUState.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: f100f0b38fe43c683f437a8fa3e449d6752f6a58
      https://github.com/qemu/qemu/commit/f100f0b38fe43c683f437a8fa3e449d6752f6a58
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M cpu-all.h
    M cpus.c
    M hw/kvm/apic.c
    M hw/kvmvapic.c
    M hw/ppce500_spin.c
    M include/qemu/cpu.h
    M kvm-all.c
    M target-i386/helper.c

  Log Message:
  -----------
  cpus: Pass CPUState to run_on_cpu()

CPUArchState is no longer needed.

Move the declaration to include/qemu/cpu.h and add documentation.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 9f09e18a6df39ab11cd80e203c5736af1823f3b3
      https://github.com/qemu/qemu/commit/9f09e18a6df39ab11cd80e203c5736af1823f3b3
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M cpu-defs.h
    M cpus.c
    M exec.c
    M include/qemu/cpu.h

  Log Message:
  -----------
  cpu: Move thread_id to CPUState

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 23d02d9b4bbe362a5b9cfc3ce1e5cc106eff5664
      https://github.com/qemu/qemu/commit/23d02d9b4bbe362a5b9cfc3ce1e5cc106eff5664
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/kvm.c

  Log Message:
  -----------
  target-i386: Pass X86CPU to kvm_get_mp_state()

Needed for moving halted field to CPUState.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 839b5630cd4f49ce10618a7bf0b705b76f3a01ca
      https://github.com/qemu/qemu/commit/839b5630cd4f49ce10618a7bf0b705b76f3a01ca
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-i386/kvm.c

  Log Message:
  -----------
  target-i386: Pass X86CPU to kvm_handle_halt()

Needed for moving interrupt_request and halted fields to CPUState.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 38b14db34e16bb0ae1f28b7ddccb6aa11a2a96a1
      https://github.com/qemu/qemu/commit/38b14db34e16bb0ae1f28b7ddccb6aa11a2a96a1
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M qemu-thread-posix.c
    M qemu-thread-posix.h
    M qemu-thread-win32.c
    M qemu-thread-win32.h
    M qemu-thread.h

  Log Message:
  -----------
  qemu-thread: add QemuSemaphore

The new thread pool will use semaphores instead of condition
variables, because QemuCond does not have qemu_cond_timedwait.
(I also like it more this way).

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: d354c7eccf5466ec2715a03d3f33dbfd6680dcc5
      https://github.com/qemu/qemu/commit/d354c7eccf5466ec2715a03d3f33dbfd6680dcc5
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M Makefile.objs
    A thread-pool.c
    A thread-pool.h
    M trace-events

  Log Message:
  -----------
  aio: add generic thread-pool facility

Add a generic thread-pool.  The code is roughly based on posix-aio-compat.c,
with some changes, especially the following:

- use QemuSemaphore instead of QemuCond;

- separate the state of the thread from the return code of the worker
function.  The return code is totally opaque for the thread pool;

- do not busy wait when doing cancellation.

A more generic threadpool (but still specific to I/O so that in the future
it can use special scheduling classes or PI mutexes) can have many uses:
it allows more flexibility in raw-posix.c and can more easily be extended
to Win32, and it will also be used to do an msync of the persistent bitmap.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 19d092cf9ba3c01b0e22ef65c499ae7ddc28d0e8
      https://github.com/qemu/qemu/commit/19d092cf9ba3c01b0e22ef65c499ae7ddc28d0e8
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M thread-pool.c

  Log Message:
  -----------
  threadpool: do not take lock in event_notifier_ready

The ordering is:

    worker thread                         consumer thread
    -------------------------------------------------------------------
    write ret                             event_notifier_test_and_clear
    wmb()                                 read state
    write state                           rmb()
    event_notifier_set                    read ret

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 47e6b251a5e9a47c406f2f2c0b01bb88854c98ec
      https://github.com/qemu/qemu/commit/47e6b251a5e9a47c406f2f2c0b01bb88854c98ec
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M block/raw-posix-aio.h
    M block/raw-posix.c
    M posix-aio-compat.c

  Log Message:
  -----------
  block: switch posix-aio-compat to threadpool

This is not meant for portability, but to remove code duplication.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: de81a169366c2e3e0c47d0be637cc450b71aac67
      https://github.com/qemu/qemu/commit/de81a169366c2e3e0c47d0be637cc450b71aac67
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M Makefile.objs
    M block/raw-posix-aio.h
    M block/raw-posix.c
    R posix-aio-compat.c

  Log Message:
  -----------
  raw: merge posix-aio-compat.c into block/raw-posix.c

Making the qemu_paiocb specific to raw devices will let us access members
of the BDRVRawState arbitrarily.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 9f8540ecef6fc5ededa825d766c8bcd1987884dd
      https://github.com/qemu/qemu/commit/9f8540ecef6fc5ededa825d766c8bcd1987884dd
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    A block/raw-aio.h
    R block/raw-posix-aio.h
    M block/raw-posix.c
    M linux-aio.c

  Log Message:
  -----------
  raw-posix: rename raw-posix-aio.h, hide unavailable prototypes

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: fc4edb84bfc49e4ed6c1a54c8ac037e9a7479fc8
      https://github.com/qemu/qemu/commit/fc4edb84bfc49e4ed6c1a54c8ac037e9a7479fc8
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M block/raw-win32.c

  Log Message:
  -----------
  raw-win32: add emulated AIO support

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 10fb6e06825743bd517d4b5bb0e7b9e05e0fe92c
      https://github.com/qemu/qemu/commit/10fb6e06825743bd517d4b5bb0e7b9e05e0fe92c
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M Makefile.objs
    M block/Makefile.objs
    A block/linux-aio.c
    R linux-aio.c

  Log Message:
  -----------
  raw-posix: move linux-aio.c to block/

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: a27365265cc2fed1178bf25a205e8ee02a9c0caf
      https://github.com/qemu/qemu/commit/a27365265cc2fed1178bf25a205e8ee02a9c0caf
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M block/Makefile.objs
    M block/raw-aio.h
    M block/raw-win32.c
    A block/win32-aio.c

  Log Message:
  -----------
  raw-win32: implement native asynchronous I/O

With the new support for EventNotifiers in the AIO event loop, we
can hook a completion port to every opened file and use asynchronous
I/O on them.

Wine's support is extremely inefficient, also because it really does
the I/O synchronously on regular files. (!)  But it works, and it is
good to keep the Win32 and POSIX ports as similar as possible.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: f563a5d7a820424756f358e747238f03e866838a
      https://github.com/qemu/qemu/commit/f563a5d7a820424756f358e747238f03e866838a
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M Makefile
    M QMP/qmp-events.txt
    M QMP/qmp.py
    M block.c
    M block.h
    M block/Makefile.objs
    M block/commit.c
    A block/mirror.c
    M block/stream.c
    M block_int.h
    M blockdev.c
    M blockjob.c
    M blockjob.h
    M configure
    M default-configs/sparc64-softmmu.mak
    M hmp-commands.hx
    M hmp.c
    M hmp.h
    M hw/ac97.c
    M hw/es1370.c
    M hw/i8254.c
    M hw/kvm/pci-assign.c
    M hw/m25p80.c
    M hw/m48t59.c
    M hw/mc146818rtc.c
    M hw/msi.c
    M hw/msi.h
    M hw/nseries.c
    M hw/pc.c
    M hw/pc_piix.c
    M hw/pci.c
    M hw/pci.h
    M hw/pci_bridge.c
    M hw/pci_ids.h
    M hw/pci_internals.h
    M hw/pcie_host.c
    M hw/pcie_host.h
    M hw/pckbd.c
    M hw/ppc/Makefile.objs
    M hw/ppc/e500.c
    M hw/ppc440_bamboo.c
    M hw/ppc_newworld.c
    M hw/ppc_oldworld.c
    M hw/ppc_prep.c
    M hw/ppce500_pci.c
    M hw/pxa2xx.c
    M hw/realview.c
    M hw/rtl8139.c
    M hw/s390-virtio.c
    M hw/s390x/Makefile.objs
    A hw/s390x/event-facility.c
    A hw/s390x/event-facility.h
    A hw/s390x/sclp.c
    A hw/s390x/sclp.h
    A hw/s390x/sclpconsole.c
    A hw/s390x/sclpquiesce.c
    M hw/serial.c
    M hw/spapr.c
    M hw/spapr.h
    A hw/spapr_events.c
    M hw/spapr_hcall.c
    M hw/spapr_pci.c
    M hw/spapr_pci.h
    M hw/spapr_rtas.c
    M hw/usb.h
    M hw/usb/bus.c
    M hw/usb/core.c
    M hw/usb/hcd-ehci.c
    M hw/usb/hcd-musb.c
    M hw/usb/hcd-ohci.c
    M hw/usb/hcd-uhci.c
    M hw/usb/hcd-xhci.c
    M hw/usb/host-linux.c
    M hw/usb/redirect.c
    M hw/versatilepb.c
    M hw/vhost_net.c
    M hw/virtio-net.c
    M hw/virtio-pci.c
    M hw/vmport.c
    M hw/xen_platform.c
    M hw/xilinx_spips.c
    M hw/xilinx_zynq.c
    M hw/xtensa_lx60.c
    M hw/xtensa_sim.c
    M iov.c
    M iov.h
    M memory.c
    M migration.c
    M monitor.c
    M monitor.h
    M net/tap-win32.c
    M osdep.c
    M qapi-schema.json
    M qemu-config.c
    M qemu-img-cmds.hx
    M qemu-img.c
    M qemu-img.texi
    M qemu-options.hx
    M qemu-timer.c
    M qerror.h
    M qmp-commands.hx
    M qmp.c
    M scripts/kvm/kvm_stat
    M sysemu.h
    M target-alpha/helper.h
    M target-arm/arm-semi.c
    M target-arm/helper.c
    M target-arm/helper.h
    M target-arm/neon_helper.c
    M target-arm/op_helper.c
    M target-arm/translate.c
    M target-cris/helper.h
    M target-i386/cpu.c
    M target-i386/cpu.h
    M target-i386/helper.h
    M target-microblaze/helper.h
    M target-mips/helper.h
    M target-mips/translate.c
    M target-ppc/cpu.h
    M target-ppc/helper.h
    M target-ppc/mmu_helper.c
    M target-ppc/translate_init.c
    M target-s390x/cpu.h
    M target-s390x/helper.h
    M target-s390x/kvm.c
    M target-s390x/misc_helper.c
    M target-sh4/helper.h
    M target-sparc/helper.h
    M target-sparc/translate.c
    M target-xtensa/helper.h
    M tcg/README
    M tcg/i386/tcg-target.c
    M tcg/mips/tcg-target.c
    M tcg/optimize.c
    M tcg/tcg-op.h
    M tcg/tcg-opc.h
    M tcg/tcg.c
    M tcg/tcg.h
    M tests/qemu-iotests/040
    M tests/qemu-iotests/040.out
    A tests/qemu-iotests/041
    A tests/qemu-iotests/041.out
    A tests/qemu-iotests/042
    A tests/qemu-iotests/042.out
    A tests/qemu-iotests/043
    A tests/qemu-iotests/043.out
    M tests/qemu-iotests/common.rc
    M tests/qemu-iotests/group
    M tests/qemu-iotests/iotests.py
    M tests/tcg/hello-i386.c
    M tests/tcg/test-i386.c
    M tests/tcg/test-mmap.c
    M tests/tcg/testthread.c
    M trace-events
    M vl.c

  Log Message:
  -----------
  Merge remote-tracking branch 'origin/master' into threadpool

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: e5b8b0d4ba29fe1268ba049519a1b0cf8552a21a
      https://github.com/qemu/qemu/commit/e5b8b0d4ba29fe1268ba049519a1b0cf8552a21a
  Author: Dmitry Fleytman &lt;dmitry@daynix.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/e1000.c

  Log Message:
  -----------
  e1000: drop check_rxov, always treat RX ring with RDH == RDT as empty

Real HW always treats RX ring with RDH == RDT as empty.
Emulation is supposed to behave the same.

Reported-by: Chris Webb &lt;chris.webb@elastichosts.com&gt;
Reported-by: Richard Davies &lt;richard.davies@elastichosts.com&gt;
Signed-off-by: Dmitry Fleytman &lt;dmitry@daynix.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: f0e3ac70341febed02591b61b579723279783053
      https://github.com/qemu/qemu/commit/f0e3ac70341febed02591b61b579723279783053
  Author: Lei Li &lt;lilei@linux.vnet.ibm.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M net/socket.c

  Log Message:
  -----------
  net: use "socket" model name for UDP sockets

Fix the problem that can not delete the udp socket.
It's caused by passing "udp" model to net_socket_udp_init,
but we do not have "udp" model in our model list.
Pass the right model "socket" to init function.

https://bugs.launchpad.net/qemu/+bug/1073585?comments=all

Signed-off-by: Lei Li &lt;lilei@linux.vnet.ibm.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 645c9496f7083c105ecd32f32532496af6aadf62
      https://github.com/qemu/qemu/commit/645c9496f7083c105ecd32f32532496af6aadf62
  Author: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M net.c

  Log Message:
  -----------
  net: Reject non-netdevs in qmp_netdev_del()

The netdev_del command crashes when given a -net device, because it
calls qemu_opts_del(NULL).

Check that this is a -netdev before attempting to delete it and the
QemuOpts.

Note the subtle change from qemu_find_opts_err("netdev", errp) to
qemu_find_opts_err("netdev", NULL).  Since "netdev" is a built in
options group and we don't check for NULL return anyway, there's no use
in passing errp here.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 372254c6e5c078fb13b236bb648d2b9b2b0c70f1
      https://github.com/qemu/qemu/commit/372254c6e5c078fb13b236bb648d2b9b2b0c70f1
  Author: Gabriel L. Somlo &lt;gsomlo@gmail.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/e1000.c

  Log Message:
  -----------
  e1000: pre-initialize RAH/RAL registers

Some guest operating systems' drivers (Mac OS X in particular) fail to
properly initialize the Receive Address registers (probably expecting
them to be pre-initialized by an earlier component, such as a specific
proprietary BIOS). This patch pre-initializes the RA registers, allowing
OS X networking to function properly. Other guest operating systems are
not affected, and free to (re)initialize these registers during boot.

[According to the datasheet the Address Valid bits in the RA registers
are cleared on PCI or software reset.  This patch adds the NIC's MAC
address and sets Address Valid on reset.  So we diverge from real
hardware behavior here. -- Stefan]

Signed-off-by: Gabriel Somlo &lt;somlo@cmu.edu&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 87e487a14bd9f3fb4a2b27179377e011bdda7c51
      https://github.com/qemu/qemu/commit/87e487a14bd9f3fb4a2b27179377e011bdda7c51
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M console.h
    M hw/xenfb.c
    M vl.c

  Log Message:
  -----------
  console: QLIST-ify display change listeners.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 35c9e0a5c2804b94d1a452a0a9a12d7a893b5318
      https://github.com/qemu/qemu/commit/35c9e0a5c2804b94d1a452a0a9a12d7a893b5318
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M console.h
    M vl.c

  Log Message:
  -----------
  console: add unregister_displaychangelistener

Also change the way the gui_timer is initialized: each time a
displaychangelistener is registered or unregistered we'll check
whether we need a timer (due to dpy_refresh callback being present)
and if so setup a timer, otherwise zap it.  This way the gui timer
works correctly with displaychangelisteners coming and going.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: bf2fde70fea6b3245dab44253deafba95f2979e5
      https://github.com/qemu/qemu/commit/bf2fde70fea6b3245dab44253deafba95f2979e5
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M console.c
    M console.h
    M hw/jazz_led.c
    M hw/qxl-render.c
    M hw/vga.c
    M hw/vmware_vga.c
    M ui/sdl.c
    M ui/spice-display.c
    M ui/vnc.c

  Log Message:
  -----------
  console: move set_mouse + cursor_define callbacks

When adding DisplayChangeListeners the set_mouse and cursor_define
callbacks have been left in DisplayState for some reason.  Fix it.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 76ffb0b4d048aac18b54f8555c60b6d3b0e2bc37
      https://github.com/qemu/qemu/commit/76ffb0b4d048aac18b54f8555c60b6d3b0e2bc37
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M console.c
    M qemu-common.h

  Log Message:
  -----------
  console: s/TextConsole/QemuConsole/

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: a93a4a226a2afba147ba5df688b85d844f537c68
      https://github.com/qemu/qemu/commit/a93a4a226a2afba147ba5df688b85d844f537c68
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M console.c
    M console.h
    M hw/blizzard.c
    M hw/exynos4210_fimd.c
    M hw/g364fb.c
    M hw/jazz_led.c
    M hw/milkymist-vgafb.c
    M hw/musicpal.c
    M hw/nseries.c
    M hw/omap_lcdc.c
    M hw/palm.c
    M hw/pl110.c
    M hw/pxa2xx_lcd.c
    M hw/qxl-render.c
    M hw/qxl.c
    M hw/sm501.c
    M hw/ssd0303.c
    M hw/ssd0323.c
    M hw/tc6393xb.c
    M hw/tcx.c
    M hw/vga.c
    M hw/vmware_vga.c
    M ui/curses.c
    M ui/sdl.c
    M ui/spice-display.c
    M ui/vnc.c
    M vl.c

  Log Message:
  -----------
  console: untangle gfx &amp; txt updates

Stop abusing displaysurface fields for text mode displays.
(bpp = 0, width = cols, height = lines).

Add flags to displaystate indicating whenever text mode display
(curses) or gfx mode displays (sdl, vnc, ...) are present.

Add separate displaychangelistener callbacks for text / gfx mode
resize &amp; updates.

This allows to enable gfx and txt diplays at the same time and also
paves the way for more cleanups in the future.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: e250d949feb1334828f27f0d145c35f29c4b7639
      https://github.com/qemu/qemu/commit/e250d949feb1334828f27f0d145c35f29c4b7639
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M console.h
    M vl.c

  Log Message:
  -----------
  console: init displaychangelisteners on register

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 9678aedd8e76978465698b9edeb069ccee15e975
      https://github.com/qemu/qemu/commit/9678aedd8e76978465698b9edeb069ccee15e975
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/vga.c
    M hw/vga_int.h

  Log Message:
  -----------
  vga: fix text mode updating

With both text (curses) and graphics (vnc/sdl/spice/...) display active
vga text mode emulation fails to update both correctly.  Depending on
whenever vga_update_text() or vga_draw_text() happens to be called first
only the text display or only the graphics display will see display
resolution changes and full redraws.

Fix it by calling both text/gfx resize functions in both code paths and
keep track of full screen redraws needed in VGACommonState fields.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 4dc6a39bbd1a03f86797e0df2db285318f086aee
      https://github.com/qemu/qemu/commit/4dc6a39bbd1a03f86797e0df2db285318f086aee
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M console.h
    M ui/sdl.c

  Log Message:
  -----------
  console: remove dpy_gfx_fill

Unused code.  'nuff said.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 187cd1d9f30d13f0d0ef682e4d91cfa3e4cbd472
      https://github.com/qemu/qemu/commit/187cd1d9f30d13f0d0ef682e4d91cfa3e4cbd472
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M console.c
    M console.h
    M qemu-common.h
    M ui/sdl.c

  Log Message:
  -----------
  console: remove DisplayAllocator

Causes [temporary] preformance regression with 24bpp vga modes @ sdl.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 9f2c7d7d67c228ae6a02f50082f0c6d10703f483
      https://github.com/qemu/qemu/commit/9f2c7d7d67c228ae6a02f50082f0c6d10703f483
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M .gitmodules
    A pixman

  Log Message:
  -----------
  pixman: add submodule

Add pixman submodule as fallback for old distros.
Picking version 0.18.4.  This is shipped by rhel6
and also the minimum version needed by spice so this
should serve well as baseline.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: e2134eb9223edac82cc7aa2281779c92c920d579
      https://github.com/qemu/qemu/commit/e2134eb9223edac82cc7aa2281779c92c920d579
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M Makefile
    M configure

  Log Message:
  -----------
  pixman: windup in configure &amp; makefiles

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: d2ec7e24a270ba72a151b506ac57c6cd21e3c587
      https://github.com/qemu/qemu/commit/d2ec7e24a270ba72a151b506ac57c6cd21e3c587
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M Makefile.objs
    A qemu-pixman.c
    A qemu-pixman.h

  Log Message:
  -----------
  pixman: helper functions

Add some helper functions which will be put
into use by following patches.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 69c7777720c18d8afca7d9685c6dced1aae3a056
      https://github.com/qemu/qemu/commit/69c7777720c18d8afca7d9685c6dced1aae3a056
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M console.c
    M console.h

  Log Message:
  -----------
  pixman: add pixman image to DisplaySurface

Surfaces are now allocated using pixman.  DisplaySurface gets new
struct fields with pixman image and data.  DisplayChangeListeners
can easily start using pixman now.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 537a43913c19973adc4153d30498591f92a90359
      https://github.com/qemu/qemu/commit/537a43913c19973adc4153d30498591f92a90359
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M console.c
    M console.h

  Log Message:
  -----------
  console: make qemu_alloc_display static

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 09bbb0ae8226c71aba440bdfa6fca300acd9e5d4
      https://github.com/qemu/qemu/commit/09bbb0ae8226c71aba440bdfa6fca300acd9e5d4
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M console.c

  Log Message:
  -----------
  console: don't set PixelFormat alpha fields for 32bpp

Currently it is inconstent, PixelFormat-&gt;amask is left unset whereas
abits and amax and ashift are filled.  As an alpha channel doesn't make
sense for the vga framebuffer leave all alpha fields clear.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: b6e9f63711ea19b110574e384477bad4ea74f4a2
      https://github.com/qemu/qemu/commit/b6e9f63711ea19b110574e384477bad4ea74f4a2
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/qxl-render.c

  Log Message:
  -----------
  qxl: stop direct access to DisplaySurface fields.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 1fd2510a3786fb557919cdd71e8e65c504439ddc
      https://github.com/qemu/qemu/commit/1fd2510a3786fb557919cdd71e8e65c504439ddc
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/vga.c

  Log Message:
  -----------
  vga: stop direct access to DisplaySurface fields.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: b12f32c408ef8cb9b3a4dfcb3710b382fd24a3ee
      https://github.com/qemu/qemu/commit/b12f32c408ef8cb9b3a4dfcb3710b382fd24a3ee
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/vga.c

  Log Message:
  -----------
  pixman: switch screendump function.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 9f64916da20eea67121d544698676295bbb105a7
      https://github.com/qemu/qemu/commit/9f64916da20eea67121d544698676295bbb105a7
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M ui/vnc-enc-hextile-template.h
    M ui/vnc-enc-hextile.c
    M ui/vnc-enc-tight.c
    M ui/vnc-enc-zrle.c
    M ui/vnc-jobs.c
    M ui/vnc.c
    M ui/vnc.h

  Log Message:
  -----------
  pixman/vnc: use pixman images in vnc.

The vnc code uses *three* DisplaySurfaces:

First is the surface of the actual QemuConsole, usually the guest
screen, but could also be a text console (monitor/serial reachable via
Ctrl-Alt-&lt;nr&gt; keys).  This is left as-is.

Second is the current server's view of the screen content.  The vnc code
uses this to figure which parts of the guest screen did _really_ change
to reduce the amount of updates sent to the vnc clients.  It is also
used as data source when sending out the updates to the clients.  This
surface gets replaced by a pixman image.  The format changes too,
instead of using the guest screen format we'll use fixed 32bit rgb
framebuffer and convert the pixels on the fly when comparing and
updating the server framebuffer.

Third surface carries the format expected by the vnc client.  That isn't
used to store image data.  This surface is switched to PixelFormat and a
boolean for bigendian byte order.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 47683d669f993308c2b84bed4ce64aafb5d7ced4
      https://github.com/qemu/qemu/commit/47683d669f993308c2b84bed4ce64aafb5d7ced4
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M ui/vnc-enc-tight.c

  Log Message:
  -----------
  pixman/vnc: remove rgb_prepare_row* functions

Let pixman do it instead.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 94362682d31eb7c9bfd6bf74cd615d0616a09361
      https://github.com/qemu/qemu/commit/94362682d31eb7c9bfd6bf74cd615d0616a09361
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M ui/vnc-enc-hextile.c
    M ui/vnc-enc-tight.c
    M ui/vnc.c

  Log Message:
  -----------
  pixman/vnc: remove dead code.

Switching the vnc server framebuffer to use 32bpp unconditionally
turns the code bits which handle 8 and 16 bpp into dead code.
Remove them.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 64f735920ad319aee860e56bb9bad6cfccf4ad40
      https://github.com/qemu/qemu/commit/64f735920ad319aee860e56bb9bad6cfccf4ad40
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M console.c
    M console.h

  Log Message:
  -----------
  pixman: drop obsolete fields from DisplaySurface

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 98c8a73b2e82eecac359b0b55a2d9d69f0a916ff
      https://github.com/qemu/qemu/commit/98c8a73b2e82eecac359b0b55a2d9d69f0a916ff
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M cpu-all.h
    M cpu-defs.h
    M cpu-exec.c
    M cpus.c
    M exec.c
    M hw/apic.c
    M hw/apic_common.c
    M hw/apic_internal.h
    M hw/kvm/apic.c
    M hw/kvmvapic.c
    M hw/pc.c
    M hw/ppc.c
    M hw/ppce500_spin.c
    M hw/spapr.c
    M hw/spapr.h
    M hw/spapr_hcall.c
    M hw/spapr_iommu.c
    M hw/spapr_llan.c
    M hw/spapr_rtas.c
    M hw/spapr_vio.c
    M hw/spapr_vty.c
    M hw/sun4m.c
    M hw/sun4u.c
    M hw/xics.c
    M hw/xtensa_pic.c
    M include/qemu/cpu.h
    M kvm-all.c
    M monitor.c
    M qemu-common.h
    M target-alpha/cpu.c
    M target-alpha/cpu.h
    M target-arm/cpu.h
    M target-cris/cpu.h
    M target-i386/cpu.c
    M target-i386/cpu.h
    M target-i386/helper.c
    M target-i386/kvm.c
    M target-lm32/cpu.h
    M target-m68k/cpu.h
    M target-microblaze/cpu.h
    M target-mips/cpu.h
    M target-openrisc/cpu.h
    M target-ppc/cpu.h
    M target-ppc/excp_helper.c
    M target-ppc/kvm.c
    M target-s390x/cpu.h
    M target-s390x/kvm.c
    M target-sh4/cpu.h
    M target-sparc/cpu.h
    M target-unicore32/cpu.c
    M target-unicore32/cpu.h
    M target-xtensa/cpu.h

  Log Message:
  -----------
  Merge remote-tracking branch 'afaerber/qom-cpu' into staging

* afaerber/qom-cpu: (35 commits)
  target-i386: Pass X86CPU to kvm_handle_halt()
  target-i386: Pass X86CPU to kvm_get_mp_state()
  cpu: Move thread_id to CPUState
  cpus: Pass CPUState to run_on_cpu()
  target-i386: Pass X86CPU to cpu_x86_inject_mce()
  target-i386: Pass X86CPU to kvm_mce_inject()
  cpus: Pass CPUState to [qemu_]cpu_has_work()
  spapr: Pass PowerPCCPU to hypercalls
  spapr: Pass PowerPCCPU to spapr_hypercall()
  target-ppc: Pass PowerPCCPU to cpu_ppc_hypercall
  target-ppc: Pass PowerPCCPU to powerpc_excp()
  xtensa_pic: Pass XtensaCPU to xtensa_ccompare_cb()
  cpus: Pass CPUState to qemu_wait_io_event_common()
  cpus: Pass CPUState to flush_queued_work()
  cpu: Move queued_work_{first,last} to CPUState
  cpus: Pass CPUState to qemu_cpu_kick()
  target-ppc: Rename kvm_kick_{env =&gt; cpu} and pass PowerPCCPU
  ppc: Pass PowerPCCPU to {ppc6xx,ppc970,power7,ppc40x,ppce500}_set_irq()
  cpus: Pass CPUState to qemu_tcg_init_vcpu()
  cpus: Pass CPUState to qemu_tcg_cpu_thread_fn
  ...

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 43552994c468d37d1e0e81b9f759338dcdbc5cc0
      https://github.com/qemu/qemu/commit/43552994c468d37d1e0e81b9f759338dcdbc5cc0
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M blockdev.c
    M hw/cirrus_vga.c
    M kvm.h
    M qemu-config.c
    M qemu-options.hx
    M scripts/update-linux-headers.sh
    M target-i386/cpu.c
    M target-i386/kvm.c
    M vl.c

  Log Message:
  -----------
  Merge remote-tracking branch 'qemu-kvm/uq/master' into staging

* qemu-kvm/uq/master: (28 commits)
  update-linux-headers.sh: Handle new kernel uapi/ directories
  target-i386: kvm_cpu_fill_host: use GET_SUPPORTED_CPUID
  target-i386: cpu: make -cpu host/check/enforce code KVM-specific
  target-i386: make cpu_x86_fill_host() void
  Emulate qemu-kvms -no-kvm option
  Issue warning when deprecated -tdf option is used
  Issue warning when deprecated drive parameter boot=on|off is used
  Use global properties to emulate -no-kvm-pit-reinjection
  Issue warning when deprecated -no-kvm-pit is used
  Use machine options to emulate -no-kvm-irqchip
  cirrus_vga: allow configurable vram size
  target-i386: Add missing kvm cpuid feature name
  i386: cpu: add missing CPUID[EAX=7,ECX=0] flag names
  i386: kvm: filter CPUID leaf 7 based on GET_SUPPORTED_CPUID, too
  i386: kvm: reformat filter_features_for_kvm() code
  i386: kvm: filter CPUID feature words earlier, on cpu.c
  i386: kvm: mask cpuid_ext4_features bits earlier
  i386: kvm: mask cpuid_kvm_features earlier
  i386: kvm: x2apic is not supported without in-kernel irqchip
  i386: kvm: set CPUID_EXT_TSC_DEADLINE_TIMER on kvm_arch_get_supported_cpuid()
  ...

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 5a34dbb55994ddb8e3f4cc465abbb85aa2e6dfaf
      https://github.com/qemu/qemu/commit/5a34dbb55994ddb8e3f4cc465abbb85aa2e6dfaf
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M Makefile
    M Makefile.objs
    A aio-posix.c
    A aio-win32.c
    R aio.c
    M arch_init.h
    M async.c
    M block/Makefile.objs
    A block/linux-aio.c
    A block/raw-aio.h
    R block/raw-posix-aio.h
    M block/raw-posix.c
    M block/raw-win32.c
    A block/win32-aio.c
    M compiler.h
    M cutils.c
    A event_notifier-posix.c
    A event_notifier-win32.c
    R event_notifier.c
    M event_notifier.h
    M hw/hw.h
    M iohandler.c
    M iov.c
    R linux-aio.c
    M main-loop.c
    M main-loop.h
    M osdep.c
    M oslib-posix.c
    M oslib-win32.c
    R posix-aio-compat.c
    M qapi/Makefile.objs
    M qemu-aio.h
    M qemu-char.h
    M qemu-common.h
    M qemu-coroutine-lock.c
    M qemu-os-win32.h
    M qemu-sockets.c
    M qemu-thread-posix.c
    M qemu-thread-posix.h
    M qemu-thread-win32.c
    M qemu-thread-win32.h
    M qemu-thread.h
    M qemu-timer.c
    M qemu-tool.c
    M qemu-user.c
    M qmp.c
    M tests/Makefile
    A thread-pool.c
    A thread-pool.h
    M trace-events
    M vl.c

  Log Message:
  -----------
  Merge remote-tracking branch 'bonzini/threadpool' into staging

* bonzini/threadpool: (39 commits)
  raw-win32: implement native asynchronous I/O
  raw-posix: move linux-aio.c to block/
  raw-win32: add emulated AIO support
  raw-posix: rename raw-posix-aio.h, hide unavailable prototypes
  raw: merge posix-aio-compat.c into block/raw-posix.c
  block: switch posix-aio-compat to threadpool
  threadpool: do not take lock in event_notifier_ready
  aio: add generic thread-pool facility
  qemu-thread: add QemuSemaphore
  linux-aio: use event notifiers
  aio: clean up now-unused functions
  main-loop: use aio_notify for qemu_notify_event
  main-loop: use GSource to poll AIO file descriptors
  aio: call aio_notify after setting I/O handlers
  aio: add aio_notify
  aio: make AioContexts GSources
  aio: add Win32 implementation
  aio: prepare for introducing GSource-based dispatch
  aio: add non-blocking variant of aio_wait
  aio: test node-&gt;deleted before calling io_flush
  ...

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: d971919f08ca300e7b3595a4c5ddaea2ce8fc3ba
      https://github.com/qemu/qemu/commit/d971919f08ca300e7b3595a4c5ddaea2ce8fc3ba
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/e1000.c
    M net.c
    M net/socket.c

  Log Message:
  -----------
  Merge remote-tracking branch 'stefanha/net' into staging

* stefanha/net:
  e1000: pre-initialize RAH/RAL registers
  net: Reject non-netdevs in qmp_netdev_del()
  net: use "socket" model name for UDP sockets
  e1000: drop check_rxov, always treat RX ring with RDH == RDT as empty

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 4ba79505f43bd0ace35c3fe42197eb02e7e0478e
      https://github.com/qemu/qemu/commit/4ba79505f43bd0ace35c3fe42197eb02e7e0478e
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M .gitmodules
    M Makefile
    M Makefile.objs
    M configure
    M console.c
    M console.h
    M hw/blizzard.c
    M hw/exynos4210_fimd.c
    M hw/g364fb.c
    M hw/jazz_led.c
    M hw/milkymist-vgafb.c
    M hw/musicpal.c
    M hw/nseries.c
    M hw/omap_lcdc.c
    M hw/palm.c
    M hw/pl110.c
    M hw/pxa2xx_lcd.c
    M hw/qxl-render.c
    M hw/qxl.c
    M hw/sm501.c
    M hw/ssd0303.c
    M hw/ssd0323.c
    M hw/tc6393xb.c
    M hw/tcx.c
    M hw/vga.c
    M hw/vga_int.h
    M hw/vmware_vga.c
    M hw/xenfb.c
    A pixman
    M qemu-common.h
    A qemu-pixman.c
    A qemu-pixman.h
    M ui/curses.c
    M ui/sdl.c
    M ui/spice-display.c
    M ui/vnc-enc-hextile-template.h
    M ui/vnc-enc-hextile.c
    M ui/vnc-enc-tight.c
    M ui/vnc-enc-zrle.c
    M ui/vnc-jobs.c
    M ui/vnc.c
    M ui/vnc.h
    M vl.c

  Log Message:
  -----------
  Merge remote-tracking branch 'kraxel/pixman.v3' into staging

* kraxel/pixman.v3: (22 commits)
  pixman: drop obsolete fields from DisplaySurface
  pixman/vnc: remove dead code.
  pixman/vnc: remove rgb_prepare_row* functions
  pixman/vnc: use pixman images in vnc.
  pixman: switch screendump function.
  vga: stop direct access to DisplaySurface fields.
  qxl: stop direct access to DisplaySurface fields.
  console: don't set PixelFormat alpha fields for 32bpp
  console: make qemu_alloc_display static
  pixman: add pixman image to DisplaySurface
  pixman: helper functions
  pixman: windup in configure &amp; makefiles
  pixman: add submodule
  console: remove DisplayAllocator
  console: remove dpy_gfx_fill
  vga: fix text mode updating
  console: init displaychangelisteners on register
  console: untangle gfx &amp; txt updates
  console: s/TextConsole/QemuConsole/
  console: move set_mouse + cursor_define callbacks
  ...

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/fc53b7d4b7fe...4ba79505f43b

----==_mimepart_5092cdd1638f4_5b741480ae8686c0--


</body></email><email><emailId>20121102193013</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-02 19:30:13-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 85e05d: xhci: add {get, set}_field macros &amp; enum for pls</subject><body>



----==_mimepart_50941f457f06f_27b4f61ae441280
Date: Fri, 02 Nov 2012 12:30:13 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50941f4585862_27b4f61ae44134d@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 85e05d825f7a9ecc1b5100bdd553fcc682c8366e
      https://github.com/qemu/qemu/commit/85e05d825f7a9ecc1b5100bdd553fcc682c8366e
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: add {get,set}_field macros &amp; enum for pls

Add {get,set}_field macros (simliar to ehci) to read and update
some bits of a word.  Put them into use for updating pls (port
link state) values.  Also add a enum for pls values.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: f321402785f443d7b95e746aae686e28d74e344c
      https://github.com/qemu/qemu/commit/f321402785f443d7b95e746aae686e28d74e344c
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: s/xhci_update_port/xhci_port_update/

Rename the function for xhci_port_* naming scheme, also drop
the xhci parameter as port carries a pointer to xhci anyway.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 6a32f80f056b577d275268e4f6f3477ba721c94f
      https://github.com/qemu/qemu/commit/6a32f80f056b577d275268e4f6f3477ba721c94f
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: add xhci_port_have_device

Factor out the code which checks whenever a usb device is attached
to the port in question.  No functional change.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: f705a362800733c363f0458f75942f8dc61b7abb
      https://github.com/qemu/qemu/commit/f705a362800733c363f0458f75942f8dc61b7abb
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: add xhci_port_notify

Create a function to notify the guest about port
status changes and put it into use.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 40030130d167f2bf762155a1a7e0073de5545e8b
      https://github.com/qemu/qemu/commit/40030130d167f2bf762155a1a7e0073de5545e8b
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: add xhci_port_reset

Move port reset logic to its own function.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: b62b08282d9539a109b02e217d0cc7f7dcdb87ac
      https://github.com/qemu/qemu/commit/b62b08282d9539a109b02e217d0cc7f7dcdb87ac
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: set pls in xhci_port_update &amp; xhci_port_reset

Set the port link state to the correct values in xhci_port_update and
xhci_port_reset functions.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 4f47f0f82eccbda44bac929df94fa244bf3452bd
      https://github.com/qemu/qemu/commit/4f47f0f82eccbda44bac929df94fa244bf3452bd
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c
    M trace-events

  Log Message:
  -----------
  xhci: add port trace points

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 0bc85da69e01f25c27f575ef0d57d29be4154d71
      https://github.com/qemu/qemu/commit/0bc85da69e01f25c27f575ef0d57d29be4154d71
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: allow address slot being called multiple times

win8 guests do that for some reason ...

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 27a11324e07f23587abfac3f0fd2fd6fb536aa74
      https://github.com/qemu/qemu/commit/27a11324e07f23587abfac3f0fd2fd6fb536aa74
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  usb/ehci: parameterise the register region offsets

The capabilities register and operational register offsets can vary from one
EHCI implementation to the next. Parameterise accordingly.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 7ae6ce0258096d3ad974d274aafcf130d5a31bb7
      https://github.com/qemu/qemu/commit/7ae6ce0258096d3ad974d274aafcf130d5a31bb7
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  usb/ehci: Abstract away PCI DMA API

Pull the DMAContext for the PCI DMA out at device init time and put it into
the device state. Use dma_memory_read/write() instead of pci specific versions.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 5010d4dc618b6b8e7c21129c487c06f6493f71fc
      https://github.com/qemu/qemu/commit/5010d4dc618b6b8e7c21129c487c06f6493f71fc
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  usb/ehci: seperate out PCIisms

Seperate the PCI stuff from the EHCI components. Extracted the PCIDevice
out into a new wrapper struct to make EHCIState non-PCI-specific. Seperated
tho non PCI init component out into a seperate "common" init function.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 569c7fc8400ea3a7b13589af889003208aaae2ed
      https://github.com/qemu/qemu/commit/569c7fc8400ea3a7b13589af889003208aaae2ed
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  usb/ehci: Guard definition of EHCI_DEBUG

Guard against re-definition of EHCI_DEBUG. Allows for turning on of debug info
from configure (using --qemu-extra-cflags="-DEHCI_DEBUG=1") rather than source
code hacking.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 0bf96f9457cdaf620bb8195a971bbdcc732ba32b
      https://github.com/qemu/qemu/commit/0bf96f9457cdaf620bb8195a971bbdcc732ba32b
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/Makefile.objs
    A hw/usb/hcd-ehci-pci.c
    M hw/usb/hcd-ehci.c
    A hw/usb/hcd-ehci.h

  Log Message:
  -----------
  usb/ehci: split into multiple source files

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: e433785a768391795e88fbbdd75bbd34859666d3
      https://github.com/qemu/qemu/commit/e433785a768391795e88fbbdd75bbd34859666d3
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/Makefile.objs
    A hw/usb/hcd-ehci-sysbus.c

  Log Message:
  -----------
  usb/ehci: add sysbus variant

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 892776ce02e3915b8db9d85935ea144ee5a1a41a
      https://github.com/qemu/qemu/commit/892776ce02e3915b8db9d85935ea144ee5a1a41a
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/xilinx_zynq.c

  Log Message:
  -----------
  xilinx_zynq: add USB controllers

Add the two usb controllers in Zynq.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 2c2e852509de3fecf606e8f2dcbca0ebd1eddc10
      https://github.com/qemu/qemu/commit/2c2e852509de3fecf606e8f2dcbca0ebd1eddc10
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: dynamic type generation

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 8f3f90b0c7d095ba11b1ad558a0b7c2eeb36c8dc
      https://github.com/qemu/qemu/commit/8f3f90b0c7d095ba11b1ad558a0b7c2eeb36c8dc
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: stick irq routing info into UHCIInfo too.

Kills the ugly "switch (device_id) { ... }" struct and makes it easier
to figure what the differences between the uhci variants are.

Need our own DeviceClass struct for that so we can allocate some space
to store UHCIInfo.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 74625ea27c39df7047ebefb11c4a04c3a3513f16
      https://github.com/qemu/qemu/commit/74625ea27c39df7047ebefb11c4a04c3a3513f16
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: add ich9 00:1a.* variants

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: df013187777efc62faeea979cfec2ca4470cc34b
      https://github.com/qemu/qemu/commit/df013187777efc62faeea979cfec2ca4470cc34b
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/hcd-ehci-pci.c

  Log Message:
  -----------
  usb/ehci-pci: dynamic type generation

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: ba07630c79807147786d3fd033e2762ae84eb132
      https://github.com/qemu/qemu/commit/ba07630c79807147786d3fd033e2762ae84eb132
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/hcd-ehci-pci.c

  Log Message:
  -----------
  usb/ehci-pci: add ich9 00:1a.* variant

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: bb4d2b2f0aad4a940db86eb469de0bf91c1c6837
      https://github.com/qemu/qemu/commit/bb4d2b2f0aad4a940db86eb469de0bf91c1c6837
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb.h
    M hw/usb/hcd-ehci-pci.c

  Log Message:
  -----------
  usb/ehci-pci: add helper to create ich9 usb controllers

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: faccca000f27bb63fce0c71dc4ca68be1c23a8b0
      https://github.com/qemu/qemu/commit/faccca000f27bb63fce0c71dc4ca68be1c23a8b0
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Add a uhci_handle_td_error() helper function

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 7f102ebeb5bad7b723a25557234b0feb493f6134
      https://github.com/qemu/qemu/commit/7f102ebeb5bad7b723a25557234b0feb493f6134
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Don't crash on device disconnect

My recent uhci cleanup series has introduced a regression, where
qemu sometimes crashes on a device disconnect. The problem is that
the uhci code never checked for a device not / no longer existing, instead
it was relying on usb_handle_packet accepting a NULL device.

But since we now pass usb_handle_packet q-&gt;ep-&gt;dev, rather then just
a local dev variable, we crash as q-&gt;ep == NULL due to the device no longer
existing.

This patch fixes this. Note that this patch also improves over
the old behavior were we would:
1) create a queue for the device
2) create an async for the packet
3) have usb_handle_packet fail
4) destroy the async
5) wait for the queue to be idle for 32 frames
6) destroy the queue

Which was rather sub-optimal.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: a552a966f16b7b39c5df16fc17e12d02c4fa5954
      https://github.com/qemu/qemu/commit/a552a966f16b7b39c5df16fc17e12d02c4fa5954
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb.h
    M hw/usb/Makefile.objs
    A hw/usb/combined-packet.c
    M hw/usb/core.c

  Log Message:
  -----------
  usb: Add packet combining functions

Currently we only do pipelining for output endpoints, since to properly
support short-not-ok semantics we can only have one outstanding input
packet. Since the ehci and uhci controllers have a limited per td packet
size guests will split large input transfers to into multiple packets,
and since we don't pipeline these, this comes with a serious performance
penalty.

This patch adds helper functions to (re-)combine packets which belong to 1
transfer at the guest device-driver level into 1 large transger. This can be
used by (redirection) usb-devices to enable pipelining for input endpoints.

This patch will combine packets together until a transfer terminating packet
is encountered. A terminating packet is a packet which meets one or more of
the following conditions:
1) The packet size is *not* a multiple of the endpoint max packet size
2) The packet does *not* have its short-not-ok flag set
3) The packet has its interrupt-on-complete flag set

The short-not-ok flag of the combined packet is that of the terminating packet.
Multiple combined packets may be submitted to the device, if the combined
packets do not have their short-not-ok flag set, enabling true pipelining.

If a combined packet does have its short-not-ok flag set the queue will
wait with submitting further packets to the device until that packet has
completed.

Once enabled in the usb-redir and ehci code, this improves the speed (MB/s)
of a Linux guest reading from a USB mass storage device by a factor of
1.2 - 1.5.

And the main reason why I started working on this, when reading from a pl2303
USB&lt;-&gt;serial converter, it combines the previous 4 packets submitted per
device-driver level read into 1 big read, reducing the number of packets / sec
by a factor 4, and it allows to have multiple reads outstanding. This allows
for much better latency tolerance without the pl2303's internal buffer
overflowing (which was happening at 115200 bps, without serial flow control).

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 579967bea69bf1b32faee13ff76b19ba641a2618
      https://github.com/qemu/qemu/commit/579967bea69bf1b32faee13ff76b19ba641a2618
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/combined-packet.c

  Log Message:
  -----------
  combined-packet: Add a workaround for Linux usbfs + live migration

Older versions (anything but the latest) of Linux usbfs + libusb(x),
will submit larger (bulk) transfers split into multiple 16k submissions,
which means that rather then all tds getting linked into the queue in
one atomic operarion they get linked in a bunch at a time, which could
cause problems if:
1) We scan the queue while libusb is in the middle of submitting a split
   bulk transfer
2) While this bulk transfer is pending we migrate to another host.

The problem is that after 2, the new host will rescan the queue and
combine the packets in one large transfer, where as 1) has caused the
original host to see them as 2 transfers. This patch fixes this by stopping
combinging if we detect a 16k transfer with its int_req flag set.

This should not adversely effect performance for other cases as:
1) Linux never sets the interrupt flag on packets other then the last
2) Windows does set the in_req flag on each td, but will submit large
transfers in 20k tds thus never triggering the check

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: c19a798133e936a15ee0175ebc973d777c4c62ed
      https://github.com/qemu/qemu/commit/c19a798133e936a15ee0175ebc973d777c4c62ed
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M configure
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Add support for 32 bits bulk packet length

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 1b36c4d826b586de40efd0c2d3c269b14ca8e150
      https://github.com/qemu/qemu/commit/1b36c4d826b586de40efd0c2d3c269b14ca8e150
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Add support for input pipelining

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 7e03d1781690c9e9ad67a671237dbcc0d159f528
      https://github.com/qemu/qemu/commit/7e03d1781690c9e9ad67a671237dbcc0d159f528
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Add an usbredir_setup_usb_eps() helper function

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 24ac283aa293f9bd8ca4137775506edf33e45eae
      https://github.com/qemu/qemu/commit/24ac283aa293f9bd8ca4137775506edf33e45eae
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Use reject rather the disconnect on bad ep info

So that the client gets a notification about us disconnecting the device.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: cdfd3530fafbef441ab6b86da64151f74073e5bd
      https://github.com/qemu/qemu/commit/cdfd3530fafbef441ab6b86da64151f74073e5bd
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Allow to attach USB 2.0 devices to 1.1 host controller

This follows the logic of host-linux: If a 2.0 device has no ISO
endpoint and no interrupt endpoint with a packet size &gt; 64, we can
attach it also to an 1.1 host controller. In case the redir server does
not report endpoint sizes, play safe and remove the 1.1 compatibility as
well. Moreover, if we detect a conflicting change in the configuration
after the device was already attached, it will be disconnected
immediately.

HdG: Several small cleanups and fixes

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 95a59dc03988d190bbc72d980a149be3a79592fb
      https://github.com/qemu/qemu/commit/95a59dc03988d190bbc72d980a149be3a79592fb
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Allow redirecting super speed devices to high speed controllers

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: de0a36cd01dab524ee6507c1bd644f0775d341fe
      https://github.com/qemu/qemu/commit/de0a36cd01dab524ee6507c1bd644f0775d341fe
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M configure
    M hw/usb.h
    M hw/usb/Makefile.objs
    A hw/usb/combined-packet.c
    M hw/usb/core.c
    A hw/usb/hcd-ehci-pci.c
    A hw/usb/hcd-ehci-sysbus.c
    M hw/usb/hcd-ehci.c
    A hw/usb/hcd-ehci.h
    M hw/usb/hcd-uhci.c
    M hw/usb/hcd-xhci.c
    M hw/usb/redirect.c
    M hw/xilinx_zynq.c
    M trace-events

  Log Message:
  -----------
  Merge remote-tracking branch 'kraxel/usb.69' into staging

* kraxel/usb.69: (31 commits)
  usb-redir: Allow redirecting super speed devices to high speed controllers
  usb-redir: Allow to attach USB 2.0 devices to 1.1 host controller
  usb-redir: Use reject rather the disconnect on bad ep info
  usb-redir: Add an usbredir_setup_usb_eps() helper function
  usb-redir: Add support for input pipelining
  usb-redir: Add support for 32 bits bulk packet length
  combined-packet: Add a workaround for Linux usbfs + live migration
  usb: Add packet combining functions
  uhci: Don't crash on device disconnect
  uhci: Add a uhci_handle_td_error() helper function
  usb/ehci-pci: add helper to create ich9 usb controllers
  usb/ehci-pci: add ich9 00:1a.* variant
  usb/ehci-pci: dynamic type generation
  uhci: add ich9 00:1a.* variants
  uhci: stick irq routing info into UHCIInfo too.
  uhci: dynamic type generation
  xilinx_zynq: add USB controllers
  usb/ehci: add sysbus variant
  usb/ehci: split into multiple source files
  usb/ehci: Guard definition of EHCI_DEBUG
  ...

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: dc63936df7cc4c6f07b8c8c4ba0bf177b8df085e
      https://github.com/qemu/qemu/commit/dc63936df7cc4c6f07b8c8c4ba0bf177b8df085e
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M hw/xenfb.c

  Log Message:
  -----------
  xenfb: fix build breakage caused by console cleanup series

Console cleanup series renamed dpy_resize and dpy_update all over the
tree, but hw/xenfb.c was forgotten.  Update it too so it builds again.

Reported-by: Jan Kiszka &lt;jan.kiszka@web.de&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 1d8ddda045b4b72dc95a325debb6df0fc19ec821
      https://github.com/qemu/qemu/commit/1d8ddda045b4b72dc95a325debb6df0fc19ec821
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M ui/cocoa.m

  Log Message:
  -----------
  ui/cocoa.m: Update to new DisplayChangeListener member names

Commit a93a4a2 changed the names of some fields in DisplayChangeListener
and broke compilation of the cocoa UI. Update to the new names.

Acked-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Reviewed-by: Andreas FÃ¤rber &lt;andreas.faerber@web.de&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: e4ab0d6b0d1118a90238d8194eedb91aab15ebe1
      https://github.com/qemu/qemu/commit/e4ab0d6b0d1118a90238d8194eedb91aab15ebe1
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: cpu: fix --disable-kvm compilation

This fixes the following:
  target-i386/cpu.o: In function `kvm_cpu_fill_host':
  target-i386/cpu.c:783: undefined reference to `kvm_state'

I didn't notice the problem before because GCC was optimizing the entire
kvm_cpu_fill_host() function out (because all calls are conditional on
kvm_enabled()).

* cpu_x86_fill_model_id() is used only if CONFIG_KVM is set, so #ifdef it
  entirely to avoid compiler warnings.

* kvm_cpu_fill_host() should be called only if KVM is enabled, so
  use #ifdef CONFIG_KVM around the entire function body.

Reported-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 5f0ebf1b4d58be0c0bb05beb195b6f42942eeee8
      https://github.com/qemu/qemu/commit/5f0ebf1b4d58be0c0bb05beb195b6f42942eeee8
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M savevm.c

  Log Message:
  -----------
  migration: unify stdio-based QEMUFile operations

Now that qemu_fseek does not exist anymore, there is no reason to do
an fseek before fread/fwrite when operating on an stdio file.
Thus, unify the get/put_buffer callbacks used by qemu_fopen
with those used for pipes.

Reviewed-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 9229bf3c2d7afcd1adce7258843d9bc82b066b08
      https://github.com/qemu/qemu/commit/9229bf3c2d7afcd1adce7258843d9bc82b066b08
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M buffered_file.c
    M qemu-file.h
    M savevm.c

  Log Message:
  -----------
  migration: consolidate QEMUFile methods in a single QEMUFileOps struct

Reviewed-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 70eb6330343ebc61e5fb22be3d137df40f4bb058
      https://github.com/qemu/qemu/commit/70eb6330343ebc61e5fb22be3d137df40f4bb058
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M buffered_file.c
    M qemu-file.h
    M savevm.c

  Log Message:
  -----------
  migration: add qemu_get_fd

Reviewed-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: d263a20bcfc94a59c87176df6c2d29d65a7e4e6a
      https://github.com/qemu/qemu/commit/d263a20bcfc94a59c87176df6c2d29d65a7e4e6a
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M migration-exec.c
    M migration-fd.c
    M qemu-file.h
    M savevm.c

  Log Message:
  -----------
  migration: replace qemu_stdio_fd with qemu_get_fd

Reviewed-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: a6ef29096b89640acaa5edc3a74c2e3efbfa306f
      https://github.com/qemu/qemu/commit/a6ef29096b89640acaa5edc3a74c2e3efbfa306f
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M migration-exec.c
    M migration-fd.c
    M migration-tcp.c
    M migration-unix.c

  Log Message:
  -----------
  migration: clean up server sockets and handlers before invoking process_incoming_migration

A first step towards making a common "suffix" for all migration protocols,
and moving it to process_incoming_migration.

Reviewed-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 8dc592e620b45c4745380b0694ec1aedc073bda2
      https://github.com/qemu/qemu/commit/8dc592e620b45c4745380b0694ec1aedc073bda2
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M migration.c

  Log Message:
  -----------
  migration: use migrate_fd_close in migrate_fd_cleanup

migrate_fd_cleanup will usually close the file descriptor via
buffered_file_close's call to migrate_fd_close.  However, in the case
of s-&gt;file == NULL it is "inlining" migrate_fd_close (almost: there is a
direct close() instead of using s-&gt;close(s)).  To fix the inconsistency
and clean up the code, allow multiple calls to migrate_fd_close and use
the function in migrate_fd_cleanup.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 09bac73c13b57acd304efb54a361c244d60d375c
      https://github.com/qemu/qemu/commit/09bac73c13b57acd304efb54a361c244d60d375c
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M migration-tcp.c

  Log Message:
  -----------
  migration: use closesocket, not close

Windows requires this.  Migration does not quite work under Windows
but let's be uniform across QEMU.

Reviewed-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 6c3601361ff22cb8bda3f483ea11c4f7bd095094
      https://github.com/qemu/qemu/commit/6c3601361ff22cb8bda3f483ea11c4f7bd095094
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M migration-exec.c
    M migration-fd.c
    M migration-tcp.c
    M migration-unix.c

  Log Message:
  -----------
  migration: xxx_close will only be called once

No need to test s-&gt;fd again, it is tested in the caller.

Reviewed-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: ab52a824a496f4459539a9a11152d6da68703ea0
      https://github.com/qemu/qemu/commit/ab52a824a496f4459539a9a11152d6da68703ea0
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M migration-tcp.c
    M migration-unix.c
    M savevm.c

  Log Message:
  -----------
  migration: close socket QEMUFile from socket_close

The common suffix now is process_incoming_migration+qemu_fclose.

Reviewed-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 1c12e1f5b2ce215ee25b4a4e365e76269edf911c
      https://github.com/qemu/qemu/commit/1c12e1f5b2ce215ee25b4a4e365e76269edf911c
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M migration-exec.c
    M migration-fd.c
    M migration-tcp.c
    M migration-unix.c
    M migration.c

  Log Message:
  -----------
  migration: move qemu_fclose to process_incoming_migration

The common suffix is now just process_incoming_migration.

Reviewed-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 595ab64169be9063d64c3b1aa1c249fbe2662221
      https://github.com/qemu/qemu/commit/595ab64169be9063d64c3b1aa1c249fbe2662221
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M savevm.c

  Log Message:
  -----------
  migration: handle EAGAIN while reading QEMUFile

This will never happen right now (the assertion would fail).  The
next patch will set the socket or pipe in non-blocking mode, thus
enabling this part of the code.

Coroutines can just stop whenever they want with qemu_coroutine_yield.
As soon as select tells the main loop that the migration stream is
readable, the coroutine is re-entered directly in qemu_get_buffer,
where it will read more data and pass it to the loading routines.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 82a4da79fd6c108400637143f8439c2364bdb21e
      https://github.com/qemu/qemu/commit/82a4da79fd6c108400637143f8439c2364bdb21e
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M migration.c

  Log Message:
  -----------
  migration: move process_incoming_migration to a coroutine

The final part of incoming migration, which now consists of
process_incoming_migration for all protocols, is thus made non-blocking.

Reviewed-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 1ef2a82e8f60779bebdae59f7dad8205cc93db30
      https://github.com/qemu/qemu/commit/1ef2a82e8f60779bebdae59f7dad8205cc93db30
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  Merge remote-tracking branch 'afaerber/qom-cpu' into staging

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;

* afaerber/qom-cpu:
  target-i386: cpu: fix --disable-kvm compilation


  Commit: 2a0dfd004d9fae4adf2ccfcb2e3b1a76906b48a0
      https://github.com/qemu/qemu/commit/2a0dfd004d9fae4adf2ccfcb2e3b1a76906b48a0
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M buffered_file.c
    M migration-exec.c
    M migration-fd.c
    M migration-tcp.c
    M migration-unix.c
    M migration.c
    M qemu-file.h
    M savevm.c

  Log Message:
  -----------
  Merge remote-tracking branch 'bonzini/migr-coroutine' into staging

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;

* bonzini/migr-coroutine:
  migration: move process_incoming_migration to a coroutine
  migration: handle EAGAIN while reading QEMUFile
  migration: move qemu_fclose to process_incoming_migration
  migration: close socket QEMUFile from socket_close
  migration: xxx_close will only be called once
  migration: use closesocket, not close
  migration: use migrate_fd_close in migrate_fd_cleanup
  migration: clean up server sockets and handlers before invoking process_incoming_migration
  migration: replace qemu_stdio_fd with qemu_get_fd
  migration: add qemu_get_fd
  migration: consolidate QEMUFile methods in a single QEMUFileOps struct
  migration: unify stdio-based QEMUFile operations


  Commit: 1f001dc7bc9e435bf231a5b0edcad1c7c2bd6214
      https://github.com/qemu/qemu/commit/1f001dc7bc9e435bf231a5b0edcad1c7c2bd6214
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M compiler.h
    M osdep.c
    M oslib-win32.c
    M qemu-sockets.c
    M qmp.c

  Log Message:
  -----------
  compiler: support Darwin weak references

Weakrefs only tell you if the symbol was defined elsewhere, so you
need a further check at runtime to pick the default definition
when needed.

This could be automated by the compiler, but it does not do it.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: c166cb72f1676855816340666c3b618beef4b976
      https://github.com/qemu/qemu/commit/c166cb72f1676855816340666c3b618beef4b976
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M qemu-thread-posix.c
    M qemu-thread-posix.h

  Log Message:
  -----------
  semaphore: implement fallback counting semaphores with mutex+condvar

OpenBSD and Darwin do not have sem_timedwait.  Implement a fallback
for them.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: c8122c35e611385b31e2d8ccb059d0687540244a
      https://github.com/qemu/qemu/commit/c8122c35e611385b31e2d8ccb059d0687540244a
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M qemu-timer.c

  Log Message:
  -----------
  qemu-timer: reinitialize timers after fork

Timers are not inherited by the child of a fork(2), so just use
pthread_atfork to reinstate them after daemonize.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: f9ab4654e370ceedb745523b607a628e297cb6ab
      https://github.com/qemu/qemu/commit/f9ab4654e370ceedb745523b607a628e297cb6ab
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M main-loop.c
    M vl.c

  Log Message:
  -----------
  vl: unify calls to init_timer_alarm

init_timer_alarm was being called twice.  This is not needed.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 49cf57281b74ccb64587ccc0626fc55a01227a15
      https://github.com/qemu/qemu/commit/49cf57281b74ccb64587ccc0626fc55a01227a15
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-02 (Fri, 02 Nov 2012)

  Changed paths:
    M main-loop.c
    M vl.c

  Log Message:
  -----------
  vl: delay thread initialization after daemonization

Commit ac4119c (chardev: Use timer instead of bottom-half to postpone
open event, 2012-10-12) moved the alarm timer initialization to an earlier
point but failed to consider that it depends on qemu_init_main_loop.

Later, commit 1c53786 (vl: init main loop earlier, 2012-10-30) fixed
this, but left -daemonize in two different ways.  First, timers need to
be reinitialized after forking.  Second, the global mutex was being held
by the parent, and thus dropped after forking.

The first is now fixed using pthread_atfork.  For the second part,
make sure that the global mutex is not taken before daemonization,
and similarly delay qemu_thread_self.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/4ba79505f43b...49cf57281b74

----==_mimepart_50941f457f06f_27b4f61ae441280--


</body></email><email><emailId>20121103130009</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-03 13:00:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] aed91c: m68k: Return semihosting errno values correctly</subject><body>



----==_mimepart_5095155988a9c_46fa1930ae829316
Date: Sat, 03 Nov 2012 06:00:09 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;5095155989ce1_46fa1930ae829419@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: aed91c1bff5e568c7b0fbd0e1e7e2f9e62409e73
      https://github.com/qemu/qemu/commit/aed91c1bff5e568c7b0fbd0e1e7e2f9=
e62409e73
  Author: Meador Inge &lt;meadori@codesourcery.com&gt;
  Date:   2012-11-03 (Sat, 03 Nov 2012)

  Changed paths:
    M target-m68k/m68k-semi.c

  Log Message:
  -----------
  m68k: Return semihosting errno values correctly

Fixing a simple typo, s/errno/err/, that caused
the error status from GDB semihosted system calls
to be returned incorrectly.

Signed-off-by: Meador Inge &lt;meadori@codesourcery.com&gt;
Reviewed-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 7ba6c10490cf57608045eb2b6351f185d600f4ea
      https://github.com/qemu/qemu/commit/7ba6c10490cf57608045eb2b6351f18=
5d600f4ea
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-11-03 (Sat, 03 Nov 2012)

  Changed paths:
    M target-m68k/m68k-semi.c

  Log Message:
  -----------
  target-m68k/m68k-semi: Handle get_user failure

Handle failure of get_user accessing the semihosting
argument block, rather than simply ignoring the failures.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 1073bfd8c0829be06e6ad1cbb4a2f48f8bb594bc
      https://github.com/qemu/qemu/commit/1073bfd8c0829be06e6ad1cbb4a2f48=
f8bb594bc
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-11-03 (Sat, 03 Nov 2012)

  Changed paths:
    M target-m68k/m68k-semi.c

  Log Message:
  -----------
  target-m68k/m68k-semi.c: Log when put_user for returning values fails

Abstract out the use of put_user for returning semihosting call results,
so that we can log when a guest erroneously attempts a semihosting call
with an unwritable argument block.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 32761257c0b9fa7ee04d2871a6e48a41f119c469
      https://github.com/qemu/qemu/commit/32761257c0b9fa7ee04d2871a6e48a4=
1f119c469
  Author: Yeongkyoon Lee &lt;yeongkyoon.lee@samsung.com&gt;
  Date:   2012-11-03 (Sat, 03 Nov 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: Add CONFIG_QEMU_LDST_OPTIMIZATION for TCG qemu_ld/st optimiz=
ation

Enable CONFIG_QEMU_LDST_OPTIMIZATION for TCG qemu_ld/st optimization only=
 when
a host is i386 or x86_64.

Signed-off-by: Yeongkyoon Lee &lt;yeongkyoon.lee@samsung.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: fdbb84d1332ae0827d60f1a2ca03c7d5678c6edd
      https://github.com/qemu/qemu/commit/fdbb84d1332ae0827d60f1a2ca03c7d=
5678c6edd
  Author: Yeongkyoon Lee &lt;yeongkyoon.lee@samsung.com&gt;
  Date:   2012-11-03 (Sat, 03 Nov 2012)

  Changed paths:
    M exec-all.h
    M exec.c
    M softmmu_template.h

  Log Message:
  -----------
  tcg: Add extended GETPC mechanism for MMU helpers with ldst optimizatio=
n

Add GETPC_EXT which is used by MMU helpers to selectively calculate the c=
ode
address of accessing guest memory when called from a qemu_ld/st optimized=
 code
or a C function. Currently, it supports only i386 and x86-64 hosts.

Signed-off-by: Yeongkyoon Lee &lt;yeongkyoon.lee@samsung.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: b76f0d8c2e3eac94bc7fd90a510cb7426b2a2699
      https://github.com/qemu/qemu/commit/b76f0d8c2e3eac94bc7fd90a510cb74=
26b2a2699
  Author: Yeongkyoon Lee &lt;yeongkyoon.lee@samsung.com&gt;
  Date:   2012-11-03 (Sat, 03 Nov 2012)

  Changed paths:
    M tcg/i386/tcg-target.c
    M tcg/tcg.c
    M tcg/tcg.h

  Log Message:
  -----------
  tcg: Optimize qemu_ld/st by generating slow paths at the end of a block=


Add optimized TCG qemu_ld/st generation which locates the code of TLB mis=
s
cases at the end of a block after generating the other IRs.
Currently, this optimization supports only i386 and x86_64 hosts.

Signed-off-by: Yeongkyoon Lee &lt;yeongkyoon.lee@samsung.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/49cf57281b74...b76f0d8c2e3e=


----==_mimepart_5095155988a9c_46fa1930ae829316--


</body></email><email><emailId>20121103153011</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-03 15:30:11-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 2ddef1: cadence_uart: More debug information</subject><body>



----==_mimepart_509538836653e_45981ad2af4369d6
Date: Sat, 03 Nov 2012 08:30:11 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;509538836792d_45981ad2af43706e@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 2ddef11bede823b068b59a66b4c5c62377e69b2f
      https://github.com/qemu/qemu/commit/2ddef11bede823b068b59a66b4c5c62=
377e69b2f
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/cadence_uart.c

  Log Message:
  -----------
  cadence_uart: More debug information

Add more helpful debug information to the cadence UART.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: e88a676e916bd29c1224ea46e037f354776fa3c8
      https://github.com/qemu/qemu/commit/e88a676e916bd29c1224ea46e037f35=
4776fa3c8
  Author: Meador Inge &lt;meadori@codesourcery.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M target-m68k/m68k-semi.c

  Log Message:
  -----------
  m68k: Return semihosting errno values correctly

Fixing a simple typo, s/errno/err/, that caused
the error status from GDB semihosted system calls
to be returned incorrectly.

Signed-off-by: Meador Inge &lt;meadori@codesourcery.com&gt;
Reviewed-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 8f7219675353f909a1ff1fa4542626a5dc4553cf
      https://github.com/qemu/qemu/commit/8f7219675353f909a1ff1fa4542626a=
5dc4553cf
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M target-sparc/cpu.h
    M target-sparc/ldst_helper.c

  Log Message:
  -----------
  target-sparc: make do_unaligned_access static

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 4fdcac0e2b102c8017cf81eb6dfb3e5e1c490949
      https://github.com/qemu/qemu/commit/4fdcac0e2b102c8017cf81eb6dfb3e5=
e1c490949
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M sysemu.h
    M vl.c

  Log Message:
  -----------
  vl.c: add missing static

Add missing 'static' qualifiers.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 71a8cdeca095acb2a67924de870f4ee8da5b8803
      https://github.com/qemu/qemu/commit/71a8cdeca095acb2a67924de870f4ee=
8da5b8803
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M console.h
    M ui/vnc-jobs.c
    M ui/vnc-jobs.h
    M ui/vnc.c
    M ui/vnc.h

  Log Message:
  -----------
  vnc: add missing static

Add missing 'static' qualifiers.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 434482925ee11091fc111bd2a86de0b677b3e943
      https://github.com/qemu/qemu/commit/434482925ee11091fc111bd2a86de0b=
677b3e943
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/adb.c
    M hw/adb.h
    M hw/nvram.h
    M hw/ppc.c
    M target-ppc/cpu.h

  Log Message:
  -----------
  ppc: add missing static

Add missing 'static' qualifiers.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Acked-by: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 6575c289f8c9820a7a0d2de2b0c3c58b13d9abc8
      https://github.com/qemu/qemu/commit/6575c289f8c9820a7a0d2de2b0c3c58=
b13d9abc8
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M target-ppc/cpu.h
    M target-ppc/mmu_helper.c

  Log Message:
  -----------
  target-ppc: make some functions static

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Acked-by: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 8b9c99d9dcbf532649f8e614becfa15d2ac4ea75
      https://github.com/qemu/qemu/commit/8b9c99d9dcbf532649f8e614becfa15=
d2ac4ea75
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M cpu-common.h
    M exec-all.h
    M exec.c
    M memory-internal.h

  Log Message:
  -----------
  exec: make some functions static

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 0d3cf3b6ff469bba95ae235021a3be232af4068d
      https://github.com/qemu/qemu/commit/0d3cf3b6ff469bba95ae235021a3be2=
32af4068d
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-11-01 (Thu, 01 Nov 2012)

  Changed paths:
    M hw/pc_piix.c

  Log Message:
  -----------
  pc: Drop redundant test for ROM memory region

Just a few lines above, we already initialize rom_memory accordingly.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: ef84755ebb38b4f5629b24440bb00f1ef5287707
      https://github.com/qemu/qemu/commit/ef84755ebb38b4f5629b24440bb00f1=
ef5287707
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-11-03 (Sat, 03 Nov 2012)

  Changed paths:
    M console.h
    M cpu-common.h
    M exec-all.h
    M exec.c
    M hw/adb.c
    M hw/adb.h
    M hw/cadence_uart.c
    M hw/nvram.h
    M hw/pc_piix.c
    M hw/ppc.c
    M memory-internal.h
    M sysemu.h
    M target-ppc/cpu.h
    M target-ppc/mmu_helper.c
    M target-sparc/cpu.h
    M target-sparc/ldst_helper.c
    M ui/vnc-jobs.c
    M ui/vnc-jobs.h
    M ui/vnc.c
    M ui/vnc.h
    M vl.c

  Log Message:
  -----------
  Merge branch 'trivial-patches' of git://github.com/stefanha/qemu

* 'trivial-patches' of git://github.com/stefanha/qemu:
  pc: Drop redundant test for ROM memory region
  exec: make some functions static
  target-ppc: make some functions static
  ppc: add missing static
  vnc: add missing static
  vl.c: add missing static
  target-sparc: make do_unaligned_access static
  m68k: Return semihosting errno values correctly
  cadence_uart: More debug information

Conflicts:
	target-m68k/m68k-semi.c


  Commit: 0d7937974cd0504f30ad483c3368b21da426ddf9
      https://github.com/qemu/qemu/commit/0d7937974cd0504f30ad483c3368b21=
da426ddf9
  Author: BALATON Zoltan &lt;balaton@eik.bme.hu&gt;
  Date:   2012-11-03 (Sat, 03 Nov 2012)

  Changed paths:
    M hw/vmware_vga.c

  Log Message:
  -----------
  vmware_vga: Coding style cleanup

Fix coding style as suggested by checkpatch.pl

Signed-off-by: BALATON Zoltan &lt;balaton@eik.bme.hu&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: aa32b38c5b2eb1afe30b3292454411bb760a432d
      https://github.com/qemu/qemu/commit/aa32b38c5b2eb1afe30b3292454411b=
b760a432d
  Author: BALATON Zoltan &lt;balaton@eik.bme.hu&gt;
  Date:   2012-11-03 (Sat, 03 Nov 2012)

  Changed paths:
    M console.h
    M hw/vmware_vga.c

  Log Message:
  -----------
  vmware_vga: Remove duplicated info from local state

Removed info from vmsvga_state that is available from elsewhere and
thus was duplicated here unnecessarily.

Signed-off-by: BALATON Zoltan &lt;balaton@eik.bme.hu&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 5b9575c8b7873dee4ab233e065888bbce6dfbaa8
      https://github.com/qemu/qemu/commit/5b9575c8b7873dee4ab233e065888bb=
ce6dfbaa8
  Author: BALATON Zoltan &lt;balaton@eik.bme.hu&gt;
  Date:   2012-11-03 (Sat, 03 Nov 2012)

  Changed paths:
    M hw/vmware_vga.c

  Log Message:
  -----------
  vmware_vga: Return a value for FB_SIZE before the device is enabled

According to the documentation drivers using this device should read
FB_SIZE before enabling the device to know what memory to map. This
would not work if we return 0 before enabled. The docs also mention
reading SVGA_REG_DEPTH but not writing it. (Only SVGA_REG_BITS_PER_PIXEL
can be written but we don't really support that either.)

Signed-off-by: BALATON Zoltan &lt;balaton@eik.bme.hu&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: b51d7b2e10564aedc83513d3961a69f22509eaa9
      https://github.com/qemu/qemu/commit/b51d7b2e10564aedc83513d3961a69f=
22509eaa9
  Author: BALATON Zoltan &lt;balaton@eik.bme.hu&gt;
  Date:   2012-11-03 (Sat, 03 Nov 2012)

  Changed paths:
    M hw/vga.c
    M hw/vga_int.h
    M hw/vmware_vga.c

  Log Message:
  -----------
  vmware_vga: Allow simple drivers to work without using the fifo

Postpone stopping the dirty log to the point where the command fifo is
configured to allow drivers which don't use the fifo to work too.
(Without this the picture rendered into the vram never got to the
screen and the DIRECT_VRAM option meant to support this case was
removed a year ago.)

Signed-off-by: BALATON Zoltan &lt;balaton@eik.bme.hu&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/b76f0d8c2e3e...b51d7b2e1056=


----==_mimepart_509538836653e_45981ad2af4369d6--


</body></email><email><emailId>20121103163008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-03 16:30:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] ed224a: tcg/ppc: ld/st optimization</subject><body>



----==_mimepart_5095469052a3_5d10153caf4604f8
Date: Sat, 03 Nov 2012 09:30:08 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;509546906468_5d10153caf46058c@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: ed224a56b3b3234d99832a063ee3aaee3613d115
      https://github.com/qemu/qemu/commit/ed224a56b3b3234d99832a063ee3aaee3613d115
  Author: malc &lt;av1474@comtv.ru&gt;
  Date:   2012-11-03 (Sat, 03 Nov 2012)

  Changed paths:
    M configure
    M exec-all.h
    M tcg/ppc/tcg-target.c

  Log Message:
  -----------
  tcg/ppc: ld/st optimization

Signed-off-by: malc &lt;av1474@comtv.ru&gt;




----==_mimepart_5095469052a3_5d10153caf4604f8--


</body></email><email><emailId>20121104203006</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-04 20:30:06-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 30ea83: build: pthread_atfork() needs include of pthread.h</subject><body>



----==_mimepart_5096d04e65a80_5be4d54ae41386fe
Date: Sun, 04 Nov 2012 12:30:06 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5096d04e66bd7_5be4d54ae4138794@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 30ea833941a7de51454cf99913f5edb3e7e21c0d
      https://github.com/qemu/qemu/commit/30ea833941a7de51454cf99913f5edb3e7e21c0d
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-04 (Sun, 04 Nov 2012)

  Changed paths:
    M qemu-timer.c

  Log Message:
  -----------
  build: pthread_atfork() needs include of pthread.h

Cc: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;




----==_mimepart_5096d04e65a80_5be4d54ae41386fe--


</body></email><email><emailId>20121105073007</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-05 07:30:07-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 1cfd98: target-mips: use ULL for 64 bit constants</subject><body>



----==_mimepart_50976aff877ec_12481a88ae46377f
Date: Sun, 04 Nov 2012 23:30:07 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50976aff88eb9_12481a88ae463848@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 1cfd981ff1e8ff0858cd71cfae0c7c7ba741f380
      https://github.com/qemu/qemu/commit/1cfd981ff1e8ff0858cd71cfae0c7c7ba741f380
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-11-04 (Sun, 04 Nov 2012)

  Changed paths:
    M target-mips/dsp_helper.c

  Log Message:
  -----------
  target-mips: use ULL for 64 bit constants

Fix build on a 32 bit host:
  CC    mips-softmmu/target-mips/dsp_helper.o
/src/qemu/target-mips/dsp_helper.c: In function 'helper_dextr_rs_w':
/src/qemu/target-mips/dsp_helper.c:3556: error: integer constant is too large for 'long' type
/src/qemu/target-mips/dsp_helper.c: In function 'helper_extr_s_h':
/src/qemu/target-mips/dsp_helper.c:3656: error: integer constant is too large for 'long' type

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;




----==_mimepart_50976aff877ec_12481a88ae46377f--


</body></email><email><emailId>20121106010011</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-06 01:00:11-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] c878da: tcg/ppc32: Use trampolines to trim the code size f...</subject><body>



----==_mimepart_5098611b70ede_359f13abaf09034d
Date: Mon, 05 Nov 2012 17:00:11 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5098611b72d41_359f13abaf0904eb@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: c878da3b27ceeed953c9f9a1eb002d59e9dcb4c6
      https://github.com/qemu/qemu/commit/c878da3b27ceeed953c9f9a1eb002d59e9dcb4c6
  Author: malc &lt;av1474@comtv.ru&gt;
  Date:   2012-11-05 (Mon, 05 Nov 2012)

  Changed paths:
    M exec-all.h
    M tcg/ppc/tcg-target.c

  Log Message:
  -----------
  tcg/ppc32: Use trampolines to trim the code size for mmu slow path accessors

mmu access looks something like:

&lt;check tlb&gt;
if miss goto slow_path
&lt;fast path&gt;
done:
...

; end of the TB
slow_path:
 &lt;pre process&gt;
 mr r3, r27         ; move areg0 to r3
              ; (r3 holds the first argument for all the PPC32 ABIs)
 &lt;call mmu_helper&gt;
 b $+8
 .long done
 &lt;post process&gt;
 b done

On ppc32 &lt;call mmu_helper&gt; is:

(SysV and Darwin)

mmu_helper is most likely not within direct branching distance from
the call site, necessitating

a. moving 32 bit offset of mmu_helper into a GPR ; 8 bytes
b. moving GPR to CTR/LR                          ; 4 bytes
c. (finally) branching to CTR/LR                 ; 4 bytes

r3 setting              - 4 bytes
call                    - 16 bytes
dummy jump over retaddr - 4 bytes
embedded retaddr        - 4 bytes
   Total overhead - 28 bytes

(PowerOpen (AIX))
a. moving 32 bit offset of mmu_helper's TOC into a GPR1 ; 8 bytes
b. loading 32 bit function pointer into GPR2            ; 4 bytes
c. moving GPR2 to CTR/LR                                ; 4 bytes
d. loading 32 bit small area pointer into R2            ; 4 bytes
e. (finally) branching to CTR/LR                        ; 4 bytes

r3 setting              - 4 bytes
call                    - 24 bytes
dummy jump over retaddr - 4 bytes
embedded retaddr        - 4 bytes
   Total overhead - 36 bytes

Following is done to trim the code size of slow path sections:

In tcg_target_qemu_prologue trampolines are emitted that look like this:

trampoline:
mfspr r3, LR
addi  r3, 4
mtspr LR, r3      ; fixup LR to point over embedded retaddr
mr    r3, r27
&lt;jump mmu_helper&gt; ; tail call of sorts

And slow path becomes:

slow_path:
 &lt;pre process&gt;
 &lt;call trampoline&gt;
 .long done
 &lt;post process&gt;
 b done

call                    - 4 bytes (trampoline is within code gen buffer
                             and most likely accessible via
                             direct branch)
embedded retaddr        - 4 bytes
   Total overhead - 8 bytes

In the end the icache pressure is decreased by 20/28 bytes at the cost
of an extra jump to trampoline and adjusting LR (to skip over embedded
retaddr) once inside.

Signed-off-by: malc &lt;av1474@comtv.ru&gt;


  Commit: 2592c59a66d456fe98fe96cb5787b356c40ee66f
      https://github.com/qemu/qemu/commit/2592c59a66d456fe98fe96cb5787b356c40ee66f
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-05 (Mon, 05 Nov 2012)

  Changed paths:
    M qemu-img.c
    M qemu-io.c

  Log Message:
  -----------
  tools: initialize main loop before block layer

Tools were broken because they initialized the block layer while
qemu_aio_context was still NULL.

Reported-by: malc &lt;av1474@comtv.ru&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;


Compare: https://github.com/qemu/qemu/compare/1cfd981ff1e8...2592c59a66d4

----==_mimepart_5098611b70ede_359f13abaf09034d--


</body></email><email><emailId>20121001193008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-01 19:30:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 0f41dc: vfio_pci: fix build on 32-bit systems</subject><body>



----==_mimepart_5069ef40eb498_970117baf074191
Date: Mon, 01 Oct 2012 12:30:08 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5069ef40ec65d_970117baf0742be@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 0f41dc182c7e4e2ae160641552101a2a199f7c4c
      https://github.com/qemu/qemu/commit/0f41dc182c7e4e2ae160641552101a2a199f7c4c
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-01 (Mon, 01 Oct 2012)

  Changed paths:
    M hw/vfio_pci.c

  Log Message:
  -----------
  vfio_pci: fix build on 32-bit systems

We cannot cast directly from pointer to uint64.

Cc: Alex Williamson &lt;alex.williamson@redhat.com&gt;
Cc: Alex Barcelo &lt;abarcelo@ac.upc.edu&gt;
Reported-by: Alex Barcelo &lt;abarcelo@ac.upc.edu&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;




----==_mimepart_5069ef40eb498_970117baf074191--


</body></email><email><emailId>20120904110008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-04 11:00:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] de1887: qemu-timer: properly arm alarm timer for timers se...</subject><body>



----==_mimepart_5045df388497a_68a2d74aec13465
Date: Tue, 04 Sep 2012 04:00:08 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5045df38861d7_68a2d74aec1359@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: de188751da8db3c77a681bf903035a0e5218c463
      https://github.com/qemu/qemu/commit/de188751da8db3c77a681bf903035a0e5218c463
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-04 (Tue, 04 Sep 2012)

  Changed paths:
    M qemu-timer.c

  Log Message:
  -----------
  qemu-timer: properly arm alarm timer for timers set by device initialization

QEMU will hang when fed the following command-line

  qemu-system-mips -kernel vmlinux-2.6.32-5-4kc-malta -append "console=ttyS0" -nographic -net none

The -net none is important otherwise it seems some events are generated
causing the things to work. When it doesn't work, the guest hangs when
measuring the CPU frequency, after the following line:

  [    0.000000] NR_IRQS:256

Pressing a key on the serial port unblocks it, hinting that the problem
is due to the recent elimination of the 1 second timeout in the main
loop.

The problem is that because init_timer_alarm sets the timer's pending
flag to true, the alarm timer is never armed until after the first time
through the main loop.  Thus the bug started when QEMU started testing
the pending flag in qemu_mod_timer (commit 1828be3, more alarm timer
cleanup, 2010-03-10).

But actually, it isn't true at all that a timer is pending when the
alarm timer is created, and the real bug has been latent forever: the
fix is to remove the bogus setting of pending flag.

Reported-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Tested-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Tested-by: Michael Tokarev &lt;mjt@tls.msk.ru&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;




----==_mimepart_5045df388497a_68a2d74aec13465--


</body></email><email><emailId>20120905130007</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-05 13:00:07-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 3eea54: console: bounds check whenever changing the cursor...</subject><body>



----==_mimepart_50474cd7eee99_4f25eb2ae41711a7
Date: Wed, 05 Sep 2012 06:00:07 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50474cd7f02a4_4f25eb2ae41712f9@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 3eea5498ca501922520b3447ba94815bfc109743
      https://github.com/qemu/qemu/commit/3eea5498ca501922520b3447ba94815bfc109743
  Author: Ian Campbell &lt;ian.campbell@citrix.com&gt;
  Date:   2012-09-04 (Tue, 04 Sep 2012)

  Changed paths:
    M console.c

  Log Message:
  -----------
  console: bounds check whenever changing the cursor due to an escape code

This is XSA-17 / CVE-2012-3515

Signed-off-by: Ian Campbell &lt;ian.campbell@citrix.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 8db972cfa469b4e4afd9c65e54e796b83b5ce3a2
      https://github.com/qemu/qemu/commit/8db972cfa469b4e4afd9c65e54e796b83b5ce3a2
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M VERSION

  Log Message:
  -----------
  Update version for 1.2.0

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/de188751da8d...8db972cfa469

----==_mimepart_50474cd7eee99_4f25eb2ae41711a7--


</body></email><email><emailId>20120905130009</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-05 13:00:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu]</subject><body>



----==_mimepart_50474cd9c2840_26b01085aec18966f
Date: Wed, 05 Sep 2012 06:00:09 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50474cd9c3b98_26b01085aec1897a1@sh2.rs.github.com.mail&gt;

  Branch: refs/tags/v1.2.0
  Home:   https://github.com/qemu/qemu


----==_mimepart_50474cd9c2840_26b01085aec18966f--


</body></email><email><emailId>20120905170008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-05 17:00:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] f45ddd: Open up 1.3 development tree</subject><body>



----==_mimepart_50478518a9f78_2a9d17d8aec122711
Date: Wed, 05 Sep 2012 10:00:08 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50478518ab49e_2a9d17d8aec1228ab@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: f45ddd14209a4d1b95a4096d50a561b7f6270118
      https://github.com/qemu/qemu/commit/f45ddd14209a4d1b95a4096d50a561b7f6270118
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M VERSION

  Log Message:
  -----------
  Open up 1.3 development tree

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;




----==_mimepart_50478518a9f78_2a9d17d8aec122711--


</body></email><email><emailId>20120905200009</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-05 20:00:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] a99ac0: CHECKPATCH: Add --debug adv_dcs</subject><body>



----==_mimepart_5047af497553c_6886ed7aec145060
Date: Wed, 05 Sep 2012 13:00:09 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5047af497740d_6886ed7aec14514a@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: a99ac041e9f30dafb0afa326ddbeb8a481ba3f81
      https://github.com/qemu/qemu/commit/a99ac041e9f30dafb0afa326ddbeb8a481ba3f81
  Author: Don Slutz &lt;Don@CloudSwitch.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M scripts/checkpatch.pl

  Log Message:
  -----------
  CHECKPATCH: Add --debug adv_dcs

Add debug options to find this issue.  They were not listed
in the help because the are not simple to understand the output of.

Signed-off-by: Don Slutz &lt;Don@CloudSwitch.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 5424302e56ca587b665e3f409c4daa1bc2ff1cf7
      https://github.com/qemu/qemu/commit/5424302e56ca587b665e3f409c4daa1bc2ff1cf7
  Author: Don Slutz &lt;Don@CloudSwitch.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M scripts/checkpatch.pl

  Log Message:
  -----------
  CHECKPATCH: Add --debug adv_checking

Add debug options to find this issue.  They were not listed
in the help because the are not simple to understand the output of.

Signed-off-by: Don Slutz &lt;Don@CloudSwitch.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 69402a6944f506f51efee13c9db94bd1605eb478
      https://github.com/qemu/qemu/commit/69402a6944f506f51efee13c9db94bd1605eb478
  Author: Don Slutz &lt;Don@CloudSwitch.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M scripts/checkpatch.pl

  Log Message:
  -----------
  CHECKPATCH: Add --debug adv_apw

Add debug options to find this issue.  They were not listed
in the help because the are not simple to understand the output of.

Signed-off-by: Don Slutz &lt;Don@CloudSwitch.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: dfe7053a34353079503bf350f83cb8b6101a450d
      https://github.com/qemu/qemu/commit/dfe7053a34353079503bf350f83cb8b6101a450d
  Author: Don Slutz &lt;Don@CloudSwitch.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M scripts/checkpatch.pl

  Log Message:
  -----------
  CHECKPATCH: Add warning for single else statement.

For an example:

WARNING: braces {} are necessary even for single statement blocks
+    } else
+        return env-&gt;regs[R_EAX];

total: 0 errors, 1 warnings, 41 lines checked
Signed-off-by: Don Slutz &lt;Don@CloudSwitch.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: d6ce52c1f183add6f60509bc3344a61104489613
      https://github.com/qemu/qemu/commit/d6ce52c1f183add6f60509bc3344a61104489613
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M target-xtensa/xtensa-semi.c

  Log Message:
  -----------
  target-xtensa: convert host errno values to guest

Guest errno values are taken from the newlib. Convert only those errno
values that can be returned from used system calls.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/f45ddd14209a...d6ce52c1f183

----==_mimepart_5047af497553c_6886ed7aec145060--


</body></email><email><emailId>20120906153009</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-06 15:30:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 6e4c0d: hw/pl110: Fix spelling of 'palette'</subject><body>



----==_mimepart_5048c181aca2_603e5faec197260
Date: Thu, 06 Sep 2012 08:30:09 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5048c181c033_603e5faec197399@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 6e4c0d1f03d6ab407509c32fab7cb4b8230f57ff
      https://github.com/qemu/qemu/commit/6e4c0d1f03d6ab407509c32fab7cb4b8230f57ff
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-09-06 (Thu, 06 Sep 2012)

  Changed paths:
    M hw/pl110.c
    M hw/pl110_template.h

  Log Message:
  -----------
  hw/pl110: Fix spelling of 'palette'

Fix the spelling of 'palette' used in various local variables,
structure members and comments.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;




----==_mimepart_5048c181aca2_603e5faec197260--


</body></email><email><emailId>20120907143009</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-07 14:30:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 7e9c7f: fix entry pointer for ELF kernels loaded with -ker...</subject><body>



----==_mimepart_504a04f1aede2_132c14caae442727
Date: Fri, 07 Sep 2012 07:30:09 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;504a04f1b002d_132c14caae4428ca@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 7e9c7ffe9fd9dfc3d0168dd584936db8144b230b
      https://github.com/qemu/qemu/commit/7e9c7ffe9fd9dfc3d0168dd584936db8144b230b
  Author: Henning Schild &lt;henning@hennsch.de&gt;
  Date:   2012-09-07 (Fri, 07 Sep 2012)

  Changed paths:
    M hw/elf_ops.h

  Log Message:
  -----------
  fix entry pointer for ELF kernels loaded with -kernel option

 Find a hopefully proper patch attached. Take it or leave it.

Reviewed-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Signed-off-by: Henning Schild &lt;henning@hennsch.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;




----==_mimepart_504a04f1aede2_132c14caae442727--


</body></email><email><emailId>20120813100011</emailId><senderName>Anthony Liguori</senderName><senderEmail>aliguori@us.ibm.com</senderEmail><timestampReceived>2012-08-13 10:00:11-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 669b49: xilinx_axi*: Re-implemented interconnect</subject><body>



----==_mimepart_5028d02b71d68_324c195baf4156421
Date: Mon, 13 Aug 2012 03:00:11 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5028d02b7399c_324c195baf415652b@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 669b4983018cf13e2adafe1b1b4e1e4053eeb90b
      https://github.com/qemu/qemu/commit/669b4983018cf13e2adafe1b1b4e1e4053eeb90b
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M hw/Makefile.objs
    M hw/petalogix_ml605_mmu.c
    A hw/stream.c
    A hw/stream.h
    M hw/xilinx.h
    M hw/xilinx_axidma.c
    R hw/xilinx_axidma.h
    M hw/xilinx_axienet.c

  Log Message:
  -----------
  xilinx_axi*: Re-implemented interconnect

Re-implemented the interconnect between the Xilinx AXI ethernet and DMA
controllers. A QOM interface "stream" is created, for the two stream interfaces.

As per Edgars request, this is designed to be more generic than AXI-stream,
so in the future we may see more clients of this interface beyond AXI stream.

This is based primarily on Paolos original refactoring of the interconnect.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Peter A.G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
Signed-off-by: Edgar E. Iglesias &lt;edgar.iglesias@gmail.com&gt;


  Commit: 33e95c6328a3149a52615176617997c4f8f7088b
      https://github.com/qemu/qemu/commit/33e95c6328a3149a52615176617997c4f8f7088b
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M include/qemu/object.h
    M qom/object.c

  Log Message:
  -----------
  qom: Reimplement Interfaces

The current implementation of Interfaces is poorly designed.  Each interface
that an object implements ends up being an object that's tracked by the
implementing object.  There's all sorts of gymnastics to deal with casting
between these objects.

But an interface shouldn't be associated with an Object.  Interfaces are global
to a class.  This patch moves all Interface knowledge to ObjectClass eliminating
the relationship between Object and Interfaces.

Interfaces are now abstract (as they should be) but this is okay.  Interfaces
essentially act as additional parents for the classes and are treated as such.

With this new implementation, we should fully support derived interfaces
including reimplementing an inherited interface.

PC: Rebased against qom-next merge Jun-2012.

PC: Removed replication of cast logic for interfaces, i.e. there is only
one cast function - object_dynamic_cast() (and object_dynamic_cast_assert())

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
Acked-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Edgar E. Iglesias &lt;edgar.iglesias@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/346fe0c4c0b8...33e95c6328a3

----==_mimepart_5028d02b71d68_324c195baf4156421--


</body></email><email><emailId>20120813210013</emailId><senderName>Anthony Liguori</senderName><senderEmail>aliguori@us.ibm.com</senderEmail><timestampReceived>2012-08-13 21:00:13-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 3ed444: kvm: Check if smp_cpus exceeds max cpus supported ...</subject><body>



----==_mimepart_50296add55618_7d321516ae85270
Date: Mon, 13 Aug 2012 14:00:13 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50296add59b09_7d321516ae85288b@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 3ed444e949cd2f0938759836c0991dfabe86f485
      https://github.com/qemu/qemu/commit/3ed444e949cd2f0938759836c0991dfabe86f485
  Author: Dunrong Huang &lt;riegamaths@gmail.com&gt;
  Date:   2012-08-09 (Thu, 09 Aug 2012)

  Changed paths:
    M kvm-all.c

  Log Message:
  -----------
  kvm: Check if smp_cpus exceeds max cpus supported by kvm

Add a helper function for fetching max cpus supported by kvm.

Make QEMU exit with an error message if smp_cpus exceeds limit
of VCPU count retrieved by invoking this helper function.

Signed-off-by: Dunrong Huang &lt;riegamaths@gmail.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 08312a63b77df45ad056d2e8d9e2cbe8f683a23c
      https://github.com/qemu/qemu/commit/08312a63b77df45ad056d2e8d9e2cbe8f683a23c
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-09 (Thu, 09 Aug 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: Don't implicitly hardcode list of KVM architectures

The code creating the symlink from linux-headers/asm to the
architecture specific linux-headers/asm-$arch directory was
implicitly hardcoding a list of KVM supporting architectures.
Add a default case for the common "Linux architecture name and
QEMU CPU name match" case, so future architectures will only
need to add code if they've managed to get mismatched names.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 7ae26bd484a50810f8d29cb5399bc48108e50bec
      https://github.com/qemu/qemu/commit/7ae26bd484a50810f8d29cb5399bc48108e50bec
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-09 (Thu, 09 Aug 2012)

  Changed paths:
    M cpus.c
    M kvm-all.c
    M kvm-stub.c
    M kvm.h

  Log Message:
  -----------
  kvm: Decouple 'async interrupt delivery' from 'kernel irqchip'

On x86 userspace delivers interrupts to the kernel asynchronously
(and therefore VCPU idle management is done in the kernel) if and
only if there is an in-kernel irqchip. On other architectures this
isn't necessarily true (they may always send interrupts
asynchronously), so define a new kvm_async_interrupts_enabled()
function instead of misusing kvm_irqchip_in_kernel().

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 3889c3fab10b63e170ab5193d2ce6be99a704e93
      https://github.com/qemu/qemu/commit/3889c3fab10b63e170ab5193d2ce6be99a704e93
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-09 (Thu, 09 Aug 2012)

  Changed paths:
    M hw/kvm/i8259.c
    M hw/kvm/ioapic.c
    M kvm-all.c
    M kvm.h

  Log Message:
  -----------
  kvm: Rename kvm_irqchip_set_irq() to kvm_set_irq()

Rename the function kvm_irqchip_set_irq() to kvm_set_irq(),
since it can be used for sending (asynchronous) interrupts whether
there is a full irqchip model in the kernel or not. (We don't
include 'async' in the function name since asynchronous is the
normal case.)

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 1d31f66bbc886af56d2def349012a358dc3ada06
      https://github.com/qemu/qemu/commit/1d31f66bbc886af56d2def349012a358dc3ada06
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-09 (Thu, 09 Aug 2012)

  Changed paths:
    M hw/pc.c
    M kvm-all.c
    M kvm-stub.c
    M kvm.h
    M target-i386/Makefile.objs
    A target-i386/kvm-stub.c
    M target-i386/kvm.c
    A target-i386/kvm_i386.h

  Log Message:
  -----------
  kvm: Move kvm_allows_irq0_override() to target-i386, fix return type

kvm_allows_irq0_override() is a totally x86 specific concept:
move it to the target-specific source file where it belongs.
This means we need a new header file for the prototype:
kvm_i386.h, in line with the existing kvm_ppc.h.

While we are moving it, fix the return type to be 'bool' rather
than 'int'.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: cc7e0ddf5a2307015eacfac2ac6a6a765898fcc3
      https://github.com/qemu/qemu/commit/cc7e0ddf5a2307015eacfac2ac6a6a765898fcc3
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-09 (Thu, 09 Aug 2012)

  Changed paths:
    M kvm-all.c
    M kvm-stub.c
    M kvm.h
    M target-i386/kvm.c

  Log Message:
  -----------
  kvm: Decouple 'irqfds usable' from 'kernel irqchip'

Instead of assuming that we can use irqfds if and only if
kvm_irqchip_in_kernel(), add a bool to the KVMState which
indicates this, and is set only on x86 and only if the
irqchip is in the kernel.

The kernel documentation implies that the only thing
you need to use KVM_IRQFD is that KVM_CAP_IRQFD is
advertised, but this seems to be untrue. In particular
the kernel does not (alas) return a sensible error if you
try to set up an irqfd when you haven't created an irqchip.
If it did we could remove all this nonsense and let the
kernel return the error code.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Acked-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 614e41bc26dda751321da47acb1f9cb287b52085
      https://github.com/qemu/qemu/commit/614e41bc26dda751321da47acb1f9cb287b52085
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-09 (Thu, 09 Aug 2012)

  Changed paths:
    M hw/virtio-pci.c
    M kvm-all.c
    M kvm-stub.c
    M kvm.h
    M target-i386/kvm.c

  Log Message:
  -----------
  kvm: Decouple 'MSI routing via irqfds' from 'kernel irqchip'

Decouple another x86-specific assumption about what irqchips imply.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: f3e1bed8daa35726d2731dd2a010fb91a5bb3792
      https://github.com/qemu/qemu/commit/f3e1bed8daa35726d2731dd2a010fb91a5bb3792
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-09 (Thu, 09 Aug 2012)

  Changed paths:
    M kvm-all.c
    M kvm-stub.c
    M kvm.h
    M target-i386/kvm.c

  Log Message:
  -----------
  kvm: Decouple 'GSI routing' from 'kernel irqchip'

Don't assume having an in-kernel irqchip means that GSI
routing is enabled.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 96fda35ac477e954eee989d6a3ae9e686cc361d6
      https://github.com/qemu/qemu/commit/96fda35ac477e954eee989d6a3ae9e686cc361d6
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-09 (Thu, 09 Aug 2012)

  Changed paths:
    M kvm.h

  Log Message:
  -----------
  kvm: Add documentation comment for kvm_irqchip_in_kernel()

Now we've cleared out the architecture-independent uses of
kvm_irqchip_in_kernel(), we can add a doc comment describing
what it means.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: d517872ec289f5bfa6bd9f385a90e09483e9949c
      https://github.com/qemu/qemu/commit/d517872ec289f5bfa6bd9f385a90e09483e9949c
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M configure
    M cpus.c
    M hw/kvm/i8259.c
    M hw/kvm/ioapic.c
    M hw/pc.c
    M hw/virtio-pci.c
    M kvm-all.c
    M kvm-stub.c
    M kvm.h
    M target-i386/Makefile.objs
    A target-i386/kvm-stub.c
    M target-i386/kvm.c
    A target-i386/kvm_i386.h

  Log Message:
  -----------
  Merge remote-tracking branch 'qemu-kvm/uq/master' into staging

* qemu-kvm/uq/master:
  kvm: Add documentation comment for kvm_irqchip_in_kernel()
  kvm: Decouple 'GSI routing' from 'kernel irqchip'
  kvm: Decouple 'MSI routing via irqfds' from 'kernel irqchip'
  kvm: Decouple 'irqfds usable' from 'kernel irqchip'
  kvm: Move kvm_allows_irq0_override() to target-i386, fix return type
  kvm: Rename kvm_irqchip_set_irq() to kvm_set_irq()
  kvm: Decouple 'async interrupt delivery' from 'kernel irqchip'
  configure: Don't implicitly hardcode list of KVM architectures
  kvm: Check if smp_cpus exceeds max cpus supported by kvm


Compare: https://github.com/qemu/qemu/compare/33e95c6328a3...d517872ec289

----==_mimepart_50296add55618_7d321516ae85270--


</body></email><email><emailId>20120814003018</emailId><senderName>Anthony Liguori</senderName><senderEmail>aliguori@us.ibm.com</senderEmail><timestampReceived>2012-08-14 00:30:18-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] bbf6da: Add migration capabilities</subject><body>



----==_mimepart_50299c1a911e0_455d12c2ae43680
Date: Mon, 13 Aug 2012 17:30:18 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50299c1a963d8_455d12c2ae436972@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: bbf6da32b5bd32018069e4eaeda59a02855903f2
      https://github.com/qemu/qemu/commit/bbf6da32b5bd32018069e4eaeda59a0=
2855903f2
  Author: Orit Wasserman &lt;owasserm@redhat.com&gt;
  Date:   2012-08-08 (Wed, 08 Aug 2012)

  Changed paths:
    M hmp-commands.hx
    M hmp.c
    M hmp.h
    M migration.c
    M migration.h
    M monitor.c
    M qapi-schema.json
    M qmp-commands.hx

  Log Message:
  -----------
  Add migration capabilities

The management can query the current migration capabilities using
query-migrate-capabilities QMP command.
The user can use 'info migrate_capabilities' HMP command.
Currently only XBZRLE capability is available.

Signed-off-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;


  Commit: 00458433242dbfb6348d8e0bb6d356603d3e0067
      https://github.com/qemu/qemu/commit/00458433242dbfb6348d8e0bb6d3566=
03d3e0067
  Author: Orit Wasserman &lt;owasserm@redhat.com&gt;
  Date:   2012-08-08 (Wed, 08 Aug 2012)

  Changed paths:
    M hmp-commands.hx
    M hmp.c
    M hmp.h
    M migration.c
    M qapi-schema.json
    M qmp-commands.hx

  Log Message:
  -----------
  Add migrate-set-capabilities

The management can enable/disable a capability for the next migration by =
using
migrate-set-capabilities QMP command.
The user can use migrate_set_capability HMP command.

Signed-off-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;


  Commit: 34c26412b76840e0cab9808047e29aebd429c139
      https://github.com/qemu/qemu/commit/34c26412b76840e0cab9808047e29ae=
bd429c139
  Author: Orit Wasserman &lt;owasserm@redhat.com&gt;
  Date:   2012-08-08 (Wed, 08 Aug 2012)

  Changed paths:
    A docs/xbzrle.txt

  Log Message:
  -----------
  Add XBZRLE documentation

Signed-off-by: Orit Wasserman &lt;owasserm@redhat.com&gt;

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;


  Commit: 9fb26641ab497eda9138f9af75cbeb02ed59b5ae
      https://github.com/qemu/qemu/commit/9fb26641ab497eda9138f9af75cbeb0=
2ed59b5ae
  Author: Orit Wasserman &lt;owasserm@redhat.com&gt;
  Date:   2012-08-08 (Wed, 08 Aug 2012)

  Changed paths:
    M Makefile.objs
    M cutils.c
    A include/qemu/page_cache.h
    A page_cache.c
    M qemu-common.h

  Log Message:
  -----------
  Add cache handling functions

Add MRU page cache mechanism.
The page are accessed by their address.

Signed-off-by: Benoit Hudzia &lt;benoit.hudzia@sap.com&gt;
Signed-off-by: Petter Svard &lt;petters@cs.umu.se&gt;
Signed-off-by: Aidan Shribman &lt;aidan.shribman@sap.com&gt;
Signed-off-by: Orit Wasserman &lt;owasserm@redhat.com&gt;

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;


  Commit: e6546bb938f5326269b6669d6cbb44d72458caa4
      https://github.com/qemu/qemu/commit/e6546bb938f5326269b6669d6cbb44d=
72458caa4
  Author: Orit Wasserman &lt;owasserm@redhat.com&gt;
  Date:   2012-08-08 (Wed, 08 Aug 2012)

  Changed paths:
    M cutils.c
    M qemu-common.h

  Log Message:
  -----------
  Add uleb encoding/decoding functions

Implement Unsigned Little Endian Base 128.

Signed-off-by: Orit Wasserman &lt;owasserm@redhat.com&gt;

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;


  Commit: 302dfbeb21fc5154c24ca50d296e865a3778c7da
      https://github.com/qemu/qemu/commit/302dfbeb21fc5154c24ca50d296e865=
a3778c7da
  Author: Orit Wasserman &lt;owasserm@redhat.com&gt;
  Date:   2012-08-08 (Wed, 08 Aug 2012)

  Changed paths:
    M migration.h
    M savevm.c

  Log Message:
  -----------
  Add xbzrle_encode_buffer and xbzrle_decode_buffer functions

For performance we are encoding long word at a time.
For nzrun we use long-word-at-a-time NULL-detection tricks from strcmp():=

using ((lword - 0x0101010101010101) &amp; (~lword) &amp; 0x8080808080808080) test=

to find out if any byte in the long word is zero.

Signed-off-by: Benoit Hudzia &lt;benoit.hudzia@sap.com&gt;
Signed-off-by: Petter Svard &lt;petters@cs.umu.se&gt;
Signed-off-by: Aidan Shribman &lt;aidan.shribman@sap.com&gt;
Signed-off-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Eric Blake &lt;eblake@redhat.com&gt;

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;


  Commit: 17ad9b358bceba78ae80f2963c6036eab726010c
      https://github.com/qemu/qemu/commit/17ad9b358bceba78ae80f2963c6036e=
ab726010c
  Author: Orit Wasserman &lt;owasserm@redhat.com&gt;
  Date:   2012-08-08 (Wed, 08 Aug 2012)

  Changed paths:
    M arch_init.c
    M migration.c
    M migration.h

  Log Message:
  -----------
  Add XBZRLE to ram_save_block and ram_save_live

In the outgoing migration check to see if the page is cached and
changed, then send compressed page by using save_xbrle_page function.
In the incoming migration check to see if RAM_SAVE_FLAG_XBZRLE is set
and decompress the page (by using load_xbrle function).

Signed-off-by: Benoit Hudzia &lt;benoit.hudzia@sap.com&gt;
Signed-off-by: Petter Svard &lt;petters@cs.umu.se&gt;
Signed-off-by: Aidan Shribman &lt;aidan.shribman@sap.com&gt;
Signed-off-by: Orit Wasserman &lt;owasserm@redhat.com&gt;

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;


  Commit: 9e1ba4cc4e2536d9650e84e2614c5691ed45938f
      https://github.com/qemu/qemu/commit/9e1ba4cc4e2536d9650e84e2614c569=
1ed45938f
  Author: Orit Wasserman &lt;owasserm@redhat.com&gt;
  Date:   2012-08-08 (Wed, 08 Aug 2012)

  Changed paths:
    M arch_init.c
    M hmp-commands.hx
    M hmp.c
    M hmp.h
    M migration.c
    M migration.h
    M monitor.c
    M qapi-schema.json
    M qmp-commands.hx

  Log Message:
  -----------
  Add migrate_set_cache_size command

Change XBZRLE cache size in bytes (the size should be a power of 2, it wi=
ll be
rounded down to the nearest power of 2).
If XBZRLE cache size is too small there will be many cache miss.

New query-migrate-cache-size QMP command and 'info migrate_cache_size' HM=
P
command to query cache value.

Signed-off-by: Benoit Hudzia &lt;benoit.hudzia@sap.com&gt;
Signed-off-by: Petter Svard &lt;petters@cs.umu.se&gt;
Signed-off-by: Aidan Shribman &lt;aidan.shribman@sap.com&gt;
Signed-off-by: Orit Wasserman &lt;owasserm@redhat.com&gt;

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;


  Commit: 62d4e3fe31844ee76bf2314bf1c22d25bad37589
      https://github.com/qemu/qemu/commit/62d4e3fe31844ee76bf2314bf1c22d2=
5bad37589
  Author: Orit Wasserman &lt;owasserm@redhat.com&gt;
  Date:   2012-08-08 (Wed, 08 Aug 2012)

  Changed paths:
    M qapi-schema.json
    M qmp-commands.hx

  Log Message:
  -----------
  Change total_time to total-time in MigrationStats

migration total_time was introduced in commit
d5f8a5701d3690b5ec0c34b6a5c0b5a24d274540 for QEMU 1.2

Signed-off-by: Orit Wasserman &lt;owasserm@redhat.com&gt;

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;


  Commit: 004d4c10aee9d64869ca3a8ef21f56c0045bf31b
      https://github.com/qemu/qemu/commit/004d4c10aee9d64869ca3a8ef21f56c=
0045bf31b
  Author: Orit Wasserman &lt;owasserm@redhat.com&gt;
  Date:   2012-08-08 (Wed, 08 Aug 2012)

  Changed paths:
    M arch_init.c
    M hmp.c
    M migration.c
    M migration.h
    M qapi-schema.json
    M qmp-commands.hx

  Log Message:
  -----------
  Add migration accounting for normal and duplicate pages

Signed-off-by: Benoit Hudzia &lt;benoit.hudzia@sap.com&gt;
Signed-off-by: Petter Svard &lt;petters@cs.umu.se&gt;
Signed-off-by: Aidan Shribman &lt;aidan.shribman@sap.com&gt;
Signed-off-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;


  Commit: f36d55af7408abceeee2543f697647ff86bd8a24
      https://github.com/qemu/qemu/commit/f36d55af7408abceeee2543f697647f=
f86bd8a24
  Author: Orit Wasserman &lt;owasserm@redhat.com&gt;
  Date:   2012-08-08 (Wed, 08 Aug 2012)

  Changed paths:
    M arch_init.c
    M hmp.c
    M migration.c
    M migration.h
    M qapi-schema.json
    M qmp-commands.hx

  Log Message:
  -----------
  Add XBZRLE statistics

Signed-off-by: Benoit Hudzia &lt;benoit.hudzia@sap.com&gt;
Signed-off-by: Petter Svard &lt;petters@cs.umu.se&gt;
Signed-off-by: Aidan Shribman &lt;aidan.shribman@sap.com&gt;
Signed-off-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;


  Commit: dd051c7217eae04191169ac62f6ffb7531c8da32
      https://github.com/qemu/qemu/commit/dd051c7217eae04191169ac62f6ffb7=
531c8da32
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-08-08 (Wed, 08 Aug 2012)

  Changed paths:
    M arch_init.c

  Log Message:
  -----------
  Restart optimization on stage3 update version

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;


  Commit: 55e00a19b6dc8f20e5688866451bb4a60e649459
      https://github.com/qemu/qemu/commit/55e00a19b6dc8f20e5688866451bb4a=
60e649459
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M hw/armv7m_nvic.c

  Log Message:
  -----------
  hw/armv7m_nvic: Fix incorrect default for num-irqs property

Fix an incorrect default value for the num-irqs property (we were
attempting to override it from the default set by the parent class
but not succeeding, which meant that the lm3s6965evb model would
assert on startup attempting to wire up nonexistent irq lines).
Instead of trying to override the parent's Property array, we
define an instance_init function which runs after default setup
but before user property setting and can just fix up the default
value in the gic_state struct.

Reported-by: Peter Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
Tested-by: Peter Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 01fd41ab3fb69971c24a69ed49cde96086d81278
      https://github.com/qemu/qemu/commit/01fd41ab3fb69971c24a69ed49cde96=
086d81278
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M hw/armv7m.c

  Log Message:
  -----------
  armv7m: Guard against no -kernel argument

A -kernel argument must be specified for this machine. Guard against no -=
kernel
argument. Previously gave an unhelpful "bad address" error message.

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
Tested-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: a9c0183059d6a4e4d940cd86ac0f9402b0655d24
      https://github.com/qemu/qemu/commit/a9c0183059d6a4e4d940cd86ac0f940=
2b0655d24
  Author: Mitsyanko Igor &lt;i.mitsyanko@samsung.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M hw/sd.c

  Log Message:
  -----------
  hw/sd.c: convert wp_groups in SDState to bitfield

Representing each group write protection flag with only one bit instead o=
f int
variable significantly reduces memory consumption.

Signed-off-by: Igor Mitsyanko &lt;i.mitsyanko@samsung.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 347cab1a762ff8542016f574c5eb32f0c4588ea2
      https://github.com/qemu/qemu/commit/347cab1a762ff8542016f574c5eb32f=
0c4588ea2
  Author: Mitsyanko Igor &lt;i.mitsyanko@samsung.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M hw/sd.c

  Log Message:
  -----------
  hw/sd.c: make sd_wp_addr() accept 64 bit address argument

Currently sd_wp_addr() accepts 32 bit address arguments therefore implici=
tly
restricting SD card address range. Change address argument type to uint64=
_t.

Signed-off-by: Igor Mitsyanko &lt;i.mitsyanko@samsung.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: b7202b8870ebb8e9b0246361c96e129172738f82
      https://github.com/qemu/qemu/commit/b7202b8870ebb8e9b0246361c96e129=
172738f82
  Author: Mitsyanko Igor &lt;i.mitsyanko@samsung.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M hw/sd.c

  Log Message:
  -----------
  hw/sd.c: introduce wrapper for conversion address to wp group

Add wrapper function sd_addr_to_wpnum() to replace long address--&gt;wg_grou=
p
conversion line.

Signed-off-by: Igor Mitsyanko &lt;i.mitsyanko@samsung.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: bebd12717c76b251514098bb9682d0309642e565
      https://github.com/qemu/qemu/commit/bebd12717c76b251514098bb9682d03=
09642e565
  Author: Mitsyanko Igor &lt;i.mitsyanko@samsung.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M hw/sd.c
    M hw/sd.h

  Log Message:
  -----------
  hw/sd.c: convert binary variables to bool

Several members of SDState have type int when they actually are binary va=
riables.
Change type of these variables to bool to improve code readability. Chang=
e SD API
to be in consistency with new variables type.

Signed-off-by: Igor Mitsyanko &lt;i.mitsyanko@samsung.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 879bf4a716410c9c7933dea5a5f3d3867734efb6
      https://github.com/qemu/qemu/commit/879bf4a716410c9c7933dea5a5f3d38=
67734efb6
  Author: Mitsyanko Igor &lt;i.mitsyanko@samsung.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M hw/sd.c
    M hw/sd.h

  Log Message:
  -----------
  hw/sd.c: make sd_dataready() return bool

For the sake of code clarity

Signed-off-by: Igor Mitsyanko &lt;i.mitsyanko@samsung.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 4e8f1be21287a101996c56fc2e22737692e2868d
      https://github.com/qemu/qemu/commit/4e8f1be21287a101996c56fc2e22737=
692e2868d
  Author: Mitsyanko Igor &lt;i.mitsyanko@samsung.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M hw/sd.c

  Log Message:
  -----------
  hw/sd.c: make sd_wp_addr() return bool

For the sake of code clarity

Signed-off-by: Igor Mitsyanko &lt;i.mitsyanko@samsung.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: b1c265424abfa5a1b2589e606b4e4dafbb5108f0
      https://github.com/qemu/qemu/commit/b1c265424abfa5a1b2589e606b4e4da=
fbb5108f0
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M hw/ssd0323.c

  Log Message:
  -----------
  ssd0323: abort() instead of exit(1) on error.

To be more consistent with the newer ways of error signalling. That and S=
IGABT
is easier to debug with than exit(1).

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 58f9b98f8a341c8b7bb0c9b38e492a01fe71d666
      https://github.com/qemu/qemu/commit/58f9b98f8a341c8b7bb0c9b38e492a0=
1fe71d666
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M default-configs/arm-softmmu.mak
    M hw/Makefile.objs
    M hw/arm/Makefile.objs

  Log Message:
  -----------
  arm: Move some ARM devices into libhw

Avoids some unnecessary dependencies on cpu.h and prepares for
a future armeb-softmmu where most machines would not be built.

Defer touching the SoC devices since most have implicit or explicit
dependencies on the CPU.

Signed-off-by: Andreas F=C3=A4rber &lt;andreas.faerber@suse.de&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 74ee59a825f9c0e6b5a95bea3b7ac4627526f42d
      https://github.com/qemu/qemu/commit/74ee59a825f9c0e6b5a95bea3b7ac46=
27526f42d
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M configure
    M monitor.c

  Log Message:
  -----------
  monitor: drop unused monitor debug code

In the old QMP days, this code was used to find out QMP commands that
might be calling monitor_printf() down its call chain.

This is almost impossible to happen today, because the qapi converted
commands don't even have a monitor object. Besides, it's been more than
a year since I used this last time.

Let's just drop it.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 484051b9960736a6ebff3cfed78c4b29758e63c0
      https://github.com/qemu/qemu/commit/484051b9960736a6ebff3cfed78c4b2=
9758e63c0
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M qerror.c

  Log Message:
  -----------
  qerror: QERR_AMBIGUOUS_PATH: drop %(object) from human msg

Actually, renames it to 'object'. This must be what the original author
meant to write, as there's no 'object' in the error's data member.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: b5d90f0424ea27eb126a4eaed2554908fc463d9f
      https://github.com/qemu/qemu/commit/b5d90f0424ea27eb126a4eaed255490=
8fc463d9f
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M qerror.c

  Log Message:
  -----------
  qerror: QERR_DEVICE_ENCRYPTED: change error message

Match what HMP commands print on DeviceEncrypted errors.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 2a74440547ea0a15195224fa2b7784b267cbfe15
      https://github.com/qemu/qemu/commit/2a74440547ea0a15195224fa2b7784b=
267cbfe15
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M qerror.c
    M qerror.h

  Log Message:
  -----------
  qerror: reduce public exposure

qerror will be dropped in a near future, let's reduce its public
exposure by making functions only used in qerror.c static.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: fbe0a831f68348d228acd9a4ec8a25582396282a
      https://github.com/qemu/qemu/commit/fbe0a831f68348d228acd9a4ec8a255=
82396282a
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M qerror.c

  Log Message:
  -----------
  qerror: drop qerror_abort()

qerror_abort() depends on the 'file', 'func' and 'linenr' members of
QError. However, these members are going to be dropped by the next
commit, so let's drop qerror_abort() in favor of printing an error
message to stderr plus a call to abort().

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: f2dd1d69edf0080d7d08dd3e8c7bfc6b488d59e4
      https://github.com/qemu/qemu/commit/f2dd1d69edf0080d7d08dd3e8c7bfc6=
b488d59e4
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M qerror.c

  Log Message:
  -----------
  qerror: avoid passing qerr pointer

Helps dropping/modifying qerror functions.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 5f0f0e13e1f714704d96f04050674c3102376409
      https://github.com/qemu/qemu/commit/5f0f0e13e1f714704d96f04050674c3=
102376409
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M qerror.c
    M qerror.h

  Log Message:
  -----------
  qerror: QError: drop file, linenr, func

They have never been fully used and conflict with future error
improvements.

Also makes qerror_report() a proper function, as there's no point
in having it as a macro anymore.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 2b38cf2e033d90fb50fc967f535935b170dc507d
      https://github.com/qemu/qemu/commit/2b38cf2e033d90fb50fc967f535935b=
170dc507d
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M error.c
    M qerror.c
    M qerror.h

  Log Message:
  -----------
  qerror: qerror_format(): return an allocated string

Simplifies current and future users.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 18da7c0f1f24cc00f7c2f80c27cb85e4b234e091
      https://github.com/qemu/qemu/commit/18da7c0f1f24cc00f7c2f80c27cb85e=
4b234e091
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M qerror.c
    M qerror.h

  Log Message:
  -----------
  qerror: don't delay error message construction

Today, the error message is only constructed when it's used. This commit
changes qerror to construct the error message when the error object is
built (ie. when the error is reported).

This eliminates the need of storing a pointer to qerror_table[], which
will be dropped soon, and also simplifies the code.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: dd7520f0646985b08024c73ba2285c31d7318755
      https://github.com/qemu/qemu/commit/dd7520f0646985b08024c73ba2285c3=
1d7318755
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M error.c
    M qerror.c

  Log Message:
  -----------
  error: don't delay error message construction

Today, the error message is only constructed when it's used. This commit
changes that to construct the error message when the error object is
built (ie. when the error is reported).

This simplifies the Error object.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: c75a1a8a5a34ef10f704c521c475a6dd4de5e887
      https://github.com/qemu/qemu/commit/c75a1a8a5a34ef10f704c521c475a6d=
d4de5e887
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M block.c
    M qapi-schema.json

  Log Message:
  -----------
  qmp: query-block: add 'encryption_key_missing' field

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 8b7f6fbbdc5545f749864fdf295f2fae14c7ef0a
      https://github.com/qemu/qemu/commit/8b7f6fbbdc5545f749864fdf295f2fa=
e14c7ef0a
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M hmp.c

  Log Message:
  -----------
  hmp: hmp_cont(): don't rely on QERR_DEVICE_ENCRYPTED

This commit changes hmp_cont() to loop through all block devices
and proactively set an encryption key for any encrypted device
missing a key.

This change is needed because QERR_DEVICE_ENCRYPTED is going to be
dropped by a future commit.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: eef5ad1086403d8ac8d91208a0e8dc34734b671c
      https://github.com/qemu/qemu/commit/eef5ad1086403d8ac8d91208a0e8dc3=
4734b671c
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M hmp.c

  Log Message:
  -----------
  hmp_change(): don't access DeviceEncrypted's data

It's not needed. As the device name is already known, we can replace
the duplicated password prompting code by monitor_read_block_device_key()=
.

This overly simplifies hmp_change().

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 02a08fef079469c005d48fe2d181f0e0eb5752ae
      https://github.com/qemu/qemu/commit/02a08fef079469c005d48fe2d181f0e=
0eb5752ae
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M migration-tcp.c
    M nbd.c
    M qemu-char.c
    M qemu-sockets.c
    M qemu_socket.h
    M ui/vnc.c

  Log Message:
  -----------
  net: inet_connect(), inet_connect_opts(): add in_progress argument

It's used to indicate the special case where a valid file-descriptor
is returned (ie. success) but the connection can't be completed
w/o blocking.

This is needed because QERR_SOCKET_CONNECT_IN_PROGRESS is not
treated like an error and a future commit will drop it.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 540c79fec9e8b6a6582ec4c65aa2c4c5366e4b89
      https://github.com/qemu/qemu/commit/540c79fec9e8b6a6582ec4c65aa2c4c=
5366e4b89
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M migration-tcp.c
    M qemu-sockets.c

  Log Message:
  -----------
  migration: don't rely on any QERR_SOCKET_*

Use the in_progress argument for QERR_SOCKET_CONNECT_IN_PROGRESS. The
other errors are handled the same by checking if the error is set and
then calling migrate_fd_error() if it's.

It's also necessary to change inet_connect_opts() not to set
QERR_SOCKET_CONNECT_IN_PROGRESS. This error is only used by
tcp_start_outgoing_migration() and not changing it along with the
usage of in_progress would break migration.

Furthermore this commit fixes a bug. Today, there's a spurious error
report when migration succeeds:

(qemu) migrate tcp:0:4444
migrate: Connection can not be completed immediately
(qemu)

After this commit no spurious error is reported anymore.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 75b81cf0f26f5bb7ada583fc434835adf03f8b77
      https://github.com/qemu/qemu/commit/75b81cf0f26f5bb7ada583fc434835a=
df03f8b77
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M qerror.c
    M qerror.h

  Log Message:
  -----------
  qerror: drop QERR_SOCKET_CONNECT_IN_PROGRESS

Unused since last commit.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 9aeaddff26d02633b228aceadecf36d28ac18823
      https://github.com/qemu/qemu/commit/9aeaddff26d02633b228aceadecf36d=
28ac18823
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M block_int.h

  Log Message:
  -----------
  block: block_int: include qerror.h

Several block/ files are relying on qerror.h being provided by
qapi-types.h. Fix this, as a future commit will change qapi-types.h
not to provide qerror.h.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: ff2f990b8212c8822d6a2f66ab4baeb48dae86bd
      https://github.com/qemu/qemu/commit/ff2f990b8212c8822d6a2f66ab4baeb=
48dae86bd
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M hmp.h

  Log Message:
  -----------
  hmp: hmp.h: include qdict.h

hmp.h is relying on qdict.h being provided by qapi-types.h. Fix this,
as a future commit will change qapi-types.h not to provide qdict.h.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: b68a8472c17d2d2127afcf1a8dc57884e6584173
      https://github.com/qemu/qemu/commit/b68a8472c17d2d2127afcf1a8dc5788=
4e6584173
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M scripts/qapi-types.py

  Log Message:
  -----------
  qapi: qapi-types.h: don't include qapi/qapi-types-core.h

qapi-types.h needs only qemu-common.h. Including qapi-types-core.h
causes problems when qerror.h or error.h includes qapi-types.h.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: f01f594b63becfc17cb23b4c15193230d01592e4
      https://github.com/qemu/qemu/commit/f01f594b63becfc17cb23b4c1519323=
0d01592e4
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M scripts/qapi-types.py

  Log Message:
  -----------
  qapi: generate correct enum names for camel case enums

An enum like GenericError in the schema, should generate
GENERIC_ERROR and not GENERICERROR.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: ac4ff701d88c4c742b4a53b83eed7ce356535ef8
      https://github.com/qemu/qemu/commit/ac4ff701d88c4c742b4a53b83eed7ce=
356535ef8
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M scripts/qapi-types.py

  Log Message:
  -----------
  qapi: don't convert enum strings to lowercase

Next commit will introduce enum strings in camel case.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: dcafd32348a08490cc378bfc50b260e5229ad738
      https://github.com/qemu/qemu/commit/dcafd32348a08490cc378bfc50b260e=
5229ad738
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M qapi-schema.json

  Log Message:
  -----------
  qapi-schema: add ErrorClass enum

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 85465051e0e8a79c3c1df3187c2acaacb10d6232
      https://github.com/qemu/qemu/commit/85465051e0e8a79c3c1df3187c2acaa=
cb10d6232
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M qerror.c
    M qerror.h

  Log Message:
  -----------
  qerror: qerror_table: don't use C99 struct initializers

This allows for changing QERR_ macros to initialize two struct members
at the same time. See next commit for more details.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 13f59ae8157e8ec238fa8aefe5309909a1eeb7e2
      https://github.com/qemu/qemu/commit/13f59ae8157e8ec238fa8aefe530990=
9a1eeb7e2
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M error.c
    M error.h
    M qerror.c
    M qerror.h

  Log Message:
  -----------
  error, qerror: add ErrorClass argument to error functions

The new argument is added to functions qerror_report() and error_set().
It's stored in Error and QError. qerror_report_err() is also updated to
take care of it.

The QERR_ macros are changed to contain a place holder value for the
new argument, so that the value is used on all current calls to
qerror_report() and error_set() (and also to initialize qerror_table[]).

Next commit will update the QERR_ macros with a proper ErrorClass
value.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 0f32cf6abcea8006fbf1f9c9bc8bc5bedcf6e431
      https://github.com/qemu/qemu/commit/0f32cf6abcea8006fbf1f9c9bc8bc5b=
edcf6e431
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M qerror.h

  Log Message:
  -----------
  qerror: add proper ErrorClass value for QERR_ macros

This commit replaces the place holder value for the ErrorClass
argument with a proper ErrorClass value for all QERR_ macros.

All current errors are mapped to GenericError, except for errors
CommandNotFound, DeviceEncrypted, DeviceNotActive, DeviceNotFound,
KVMMissingCap and MigrationExpected, which are maintained as they
are today.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: ea25fbca88b223877c45c776b6c0e17e0247439f
      https://github.com/qemu/qemu/commit/ea25fbca88b223877c45c776b6c0e17=
e0247439f
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M error.c
    M error.h

  Log Message:
  -----------
  error: add error_get_class()

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: ab878ddfeee722db8e7f78a9c6e9882864c2fd66
      https://github.com/qemu/qemu/commit/ab878ddfeee722db8e7f78a9c6e9882=
864c2fd66
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M hmp.c

  Log Message:
  -----------
  hmp: hmp_change(): use error_get_class()

The error_is_type() function is going to be dropped.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: a8cb2d302ea20d7ba1be184973fef29d7cab9407
      https://github.com/qemu/qemu/commit/a8cb2d302ea20d7ba1be184973fef29=
d7cab9407
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M error.c
    M error.h
    M error_int.h

  Log Message:
  -----------
  error: drop unused functions

Besides being unused, they operate on the current error format,
which is going to be replaced soon.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: de253f14912e88f45dbe66984440d27221a75a60
      https://github.com/qemu/qemu/commit/de253f14912e88f45dbe66984440d27=
221a75a60
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M QMP/qmp-spec.txt
    M monitor.c
    M qapi-schema.json
    M qmp-commands.hx

  Log Message:
  -----------
  qmp: switch to the new error format on the wire

IMPORTANT: this BREAKS QMP's compatibility for the error response.

This commit changes QMP's wire protocol to make use of the simpler
error format introduced by previous commits.

There are two important (and mostly incompatible) changes:

 1. Almost all error classes have been replaced by GenericError. The
    only classes that are still supported for compatibility with
    libvirt are: CommandNotFound, DeviceNotActive, KVMMissingCap,
    DeviceNotFound and MigrationExpected

 2. The 'data' field of the error dictionary is gone

As an example, an error response like:

  { "error": { "class": "DeviceNotRemovable",
         "data": { "device": "virtio0" },
         "desc": "Device 'virtio0' is not removable" } }

Will now be emitted as:

  { "error": { "class": "GenericError",
         "desc": "Device 'virtio0' is not removable" } }

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 93b91c59dbccde6e4d25661150c1529bd5ee4a06
      https://github.com/qemu/qemu/commit/93b91c59dbccde6e4d25661150c1529=
bd5ee4a06
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M Makefile.objs
    M qapi/qmp-core.h
    M qapi/qmp-dispatch.c
    M qemu-ga.c

  Log Message:
  -----------
  qemu-ga: switch to the new error format on the wire

IMPORTANT: this BREAKS qemu-ga compatibility for the error response.

Instead of returning something like:

{ "error": { "class": "InvalidParameterValue",
       "data": {"name": "mode", "expected": "halt|powerdown|reboot" } } }=


qemu-ga now returns:

 { "error": { "class": "GenericError",
        "desc": "Parameter 'mode' expects halt|powerdown|reboot" } }

Notice that this is also a bug fix, as qemu-ga wasn't returning the
human message.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 7795b166d9d1e2b33d428f5acab6d0d5e617ee91
      https://github.com/qemu/qemu/commit/7795b166d9d1e2b33d428f5acab6d0d=
5e617ee91
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M error.c
    R error_int.h
    M qapi/qmp-dispatch.c
    M qemu-ga.c

  Log Message:
  -----------
  error: drop error_get_qobject()/error_set_qobject()

error_get_qobject() is unused since last commit, error_set_qobject()
has never been used. Also drops error_int.h.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: df1e608a01eb0d55d6639d97f575dba37a44ac4a
      https://github.com/qemu/qemu/commit/df1e608a01eb0d55d6639d97f575dba=
37a44ac4a
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M error.c
    M error.h
    M qerror.c
    M qerror.h

  Log Message:
  -----------
  error, qerror: pass desc string to error calls

This commit changes all QERR_ macros to contain a human message (ie.
the desc string found in qerr_table[]) instead of a json dictionary
in string format.

Before this commit, error_set() and qerror_report() would receive
a json dictionary in string format and build a qobject from it. Now,
both function receive a human message instead and the qobject is
not built anymore.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 3647f5c161dddb5ec22c2d8e0ab27811959e3ada
      https://github.com/qemu/qemu/commit/3647f5c161dddb5ec22c2d8e0ab2781=
1959e3ada
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M qerror.c
    M qerror.h

  Log Message:
  -----------
  qerror: drop qerror_table and qerror_format()

They are unused since last commit.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 6d3f0dbb304d59759b2faf1e50db94d996f51f8a
      https://github.com/qemu/qemu/commit/6d3f0dbb304d59759b2faf1e50db94d=
996f51f8a
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M error.c
    M qerror.c
    M qerror.h

  Log Message:
  -----------
  error, qerror: drop QDict member

Used to store error information, but it's unused now.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: adb2072ed0fd595b05f6571e985b271a3cfa872d
      https://github.com/qemu/qemu/commit/adb2072ed0fd595b05f6571e985b271=
a3cfa872d
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M docs/writing-qmp-commands.txt

  Log Message:
  -----------
  docs: writing-qmp-commands.txt: update error section

Add information about the new error format and improve the text a bit.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 08b76b9fc3f0c25f062216955411aefaefabff89
      https://github.com/qemu/qemu/commit/08b76b9fc3f0c25f062216955411aef=
aefabff89
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M scripts/qapi-commands.py

  Log Message:
  -----------
  scripts: qapi-commands.py: qmp-commands.h: include qdict.h

qmp-commands.h declares several functions that have arguments of
type QDict. However, qdict.h is not included. This will cause a
build breakage when a file includes qmp-commands.h but doesn't
include qdict.h.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 1405819637f53ed8021067eb3ea52e32bef2870b
      https://github.com/qemu/qemu/commit/1405819637f53ed8021067eb3ea52e3=
2bef2870b
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M vl.c

  Log Message:
  -----------
  qmp: don't emit the RESET event on wakeup from S3

QEMU is basically using reset logic when waking up from S3. This
causes the QMP RESET event to be emitted, which is wrong. Also,
the runstate checks done in reset are not necessary for S3 wakeup.

Fix this by untangling wakeup from reset logic and passing
VMRESET_SILENT to qemu_system_reset() to avoid emitting the RESET
event.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Acked-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 17c8660b0b2be17d389e2ffd5681d535cc0d8912
      https://github.com/qemu/qemu/commit/17c8660b0b2be17d389e2ffd5681d53=
5cc0d8912
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M QMP/qmp-events.txt
    M vl.c

  Log Message:
  -----------
  qmp: emit the WAKEUP event when the guest is put to run

Today, the WAKEUP event is emitted when a wakeup _request_ is made.
This could be the system_wakeup command, for example.

A better semantic would be to emit the event when the guest is
already running, as that's what matters in the end. This commit does
that change.

In theory, this could break compatibility. In practice, it shouldn't
happen though, as clients shouldn't rely on timing characteristics of
the events. That is, a client relying that the guest is not running
when the event arrives may break if the event arrives after the guest
is already running.

This commit also adds the missing documentation for the WAKEUP event.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Acked-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: cb8900fe0d0b5ea33fc31a01b1c4fb41dd6368aa
      https://github.com/qemu/qemu/commit/cb8900fe0d0b5ea33fc31a01b1c4fb4=
1dd6368aa
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M QMP/qmp-events.txt

  Log Message:
  -----------
  qmp: qmp-events.txt: put events in alphabetical order

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Acked-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 67e3cf2664b3fc858a895d1e0e4b8d81c3400823
      https://github.com/qemu/qemu/commit/67e3cf2664b3fc858a895d1e0e4b8d8=
1c3400823
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M QMP/qmp-events.txt

  Log Message:
  -----------
  qmp: qmp-events.txt: add missing doc for the SUSPEND event

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Acked-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 25df49f6eb113081f48fdb3a3dd17bf1c0b25600
      https://github.com/qemu/qemu/commit/25df49f6eb113081f48fdb3a3dd17bf=
1c0b25600
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M QMP/qmp-events.txt
    M hw/acpi.c
    M monitor.c
    M monitor.h

  Log Message:
  -----------
  qmp: add SUSPEND_DISK event

Emitted when the guest makes a request to enter S4 state.

There are three possible ways of having this event, as described here:

 http://lists.gnu.org/archive/html/qemu-devel/2012-07/msg02307.html

I've decided to add a new event and make it indepedent of SHUTDOWN.
This means that the SHUTDOWN event will eventually follow the
SUSPEND_DISK event.

I've choosen this way because of two reasons:

 1. Having an indepedent event makes it possible to query for its
    existence by using query-events

 2. In the future, we may allow the user to change what QEMU should
    do as a result of the guest entering S4. So it's a good idea to
    keep both events separated

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 1daa31b9dbec60a7a06690749d73ddeeb35f506d
      https://github.com/qemu/qemu/commit/1daa31b9dbec60a7a06690749d73dde=
eb35f506d
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M qapi-schema.json
    M qmp-commands.hx
    M qmp.c

  Log Message:
  -----------
  qmp: introduce device-list-properties command

This can be used in conjunction with qom-list-types to determine the supp=
orted
set of devices and their parameters.

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 5192082097549c5b3aa7c913c6853d97a68172cb
      https://github.com/qemu/qemu/commit/5192082097549c5b3aa7c913c6853d9=
7a68172cb
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M qapi-schema.json

  Log Message:
  -----------
  qapi: mark QOM commands stable

We've had a cycle to tweak.  It is time to commit to supporting them.

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 01d3c80d6876c7de6b07bee92b1b2440b48e60c9
      https://github.com/qemu/qemu/commit/01d3c80d6876c7de6b07bee92b1b244=
0b48e60c9
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M qapi-schema.json
    M qmp-commands.hx
    M vl.c

  Log Message:
  -----------
  qapi: add query-machines command

This provides the same output as -M ? but in a structured way.

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 6ee373a0032b8fa6b630c6df9cd6618a7a02902b
      https://github.com/qemu/qemu/commit/6ee373a0032b8fa6b630c6df9cd6618=
a7a02902b
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M compiler.h

  Log Message:
  -----------
  compiler: add macro for GCC weak symbols

This lets us provide a default implementation of a symbol which targets c=
an
override.

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: e4e31c6324af480a22bf4150266b278368eaa336
      https://github.com/qemu/qemu/commit/e4e31c6324af480a22bf4150266b278=
368eaa336
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M qapi-schema.json
    M qmp-commands.hx
    M qmp.c

  Log Message:
  -----------
  qapi: add query-cpu-definitions command (v2)

This command attempts to map to the behavior of -cpu ?.  Unfortunately, t=
he
output of this command differs wildly across targets.

To accommodate this, we use a weak symbol to implement a default version =
of the
command that fails with a QERR_NOT_SUPPORTED error code.  Targets can the=
n
override and implement this command if it makes sense for them.

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: e3966126d077ef60997f651d8e42b71c623b44a6
      https://github.com/qemu/qemu/commit/e3966126d077ef60997f651d8e42b71=
c623b44a6
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: add implementation of query-cpu-definitions (v2)

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 70b7660a4ed0ca3891ee51bda78e10b4c36cd358
      https://github.com/qemu/qemu/commit/70b7660a4ed0ca3891ee51bda78e10b=
4c36cd358
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M target-ppc/translate_init.c

  Log Message:
  -----------
  target-ppc: add implementation of query-cpu-definitions (v2)

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 6a1f9d0c1fbf186d3d68cb2af43d047637c93072
      https://github.com/qemu/qemu/commit/6a1f9d0c1fbf186d3d68cb2af43d047=
637c93072
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M default-configs/arm-softmmu.mak
    M hw/Makefile.objs
    M hw/arm/Makefile.objs
    M hw/armv7m.c
    M hw/armv7m_nvic.c
    M hw/sd.c
    M hw/sd.h
    M hw/ssd0323.c

  Log Message:
  -----------
  Merge remote-tracking branch 'pmaydell/arm-devs.next' into staging

* pmaydell/arm-devs.next:
  arm: Move some ARM devices into libhw
  ssd0323: abort() instead of exit(1) on error.
  hw/sd.c: make sd_wp_addr() return bool
  hw/sd.c: make sd_dataready() return bool
  hw/sd.c: convert binary variables to bool
  hw/sd.c: introduce wrapper for conversion address to wp group
  hw/sd.c: make sd_wp_addr() accept 64 bit address argument
  hw/sd.c: convert wp_groups in SDState to bitfield
  armv7m: Guard against no -kernel argument
  hw/armv7m_nvic: Fix incorrect default for num-irqs property


  Commit: ac839ccd8c30fe5706cc43f00e056049d6e55377
      https://github.com/qemu/qemu/commit/ac839ccd8c30fe5706cc43f00e05604=
9d6e55377
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M Makefile.objs
    M arch_init.c
    M cutils.c
    A docs/xbzrle.txt
    M hmp-commands.hx
    M hmp.c
    M hmp.h
    A include/qemu/page_cache.h
    M migration.c
    M migration.h
    M monitor.c
    A page_cache.c
    M qapi-schema.json
    M qemu-common.h
    M qmp-commands.hx
    M savevm.c

  Log Message:
  -----------
  Merge remote-tracking branch 'quintela/migration-next-20120808' into st=
aging

* quintela/migration-next-20120808:
  Restart optimization on stage3 update version
  Add XBZRLE statistics
  Add migration accounting for normal and duplicate pages
  Change total_time to total-time in MigrationStats
  Add migrate_set_cache_size command
  Add XBZRLE to ram_save_block and ram_save_live
  Add xbzrle_encode_buffer and xbzrle_decode_buffer functions
  Add uleb encoding/decoding functions
  Add cache handling functions
  Add XBZRLE documentation
  Add migrate-set-capabilities
  Add migration capabilities


  Commit: 633decd71119a4293e5e53e6059026c517a8bef0
      https://github.com/qemu/qemu/commit/633decd71119a4293e5e53e6059026c=
517a8bef0
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M Makefile.objs
    M QMP/qmp-events.txt
    M QMP/qmp-spec.txt
    M block.c
    M block_int.h
    M compiler.h
    M configure
    M docs/writing-qmp-commands.txt
    M error.c
    M error.h
    R error_int.h
    M hmp.c
    M hmp.h
    M hw/acpi.c
    M migration-tcp.c
    M monitor.c
    M monitor.h
    M nbd.c
    M qapi-schema.json
    M qapi/qmp-core.h
    M qapi/qmp-dispatch.c
    M qemu-char.c
    M qemu-ga.c
    M qemu-sockets.c
    M qemu_socket.h
    M qerror.c
    M qerror.h
    M qmp-commands.hx
    M qmp.c
    M scripts/qapi-commands.py
    M scripts/qapi-types.py
    M target-i386/cpu.c
    M target-ppc/translate_init.c
    M ui/vnc.c
    M vl.c

  Log Message:
  -----------
  Merge remote-tracking branch 'qmp/queue/qmp' into staging

* qmp/queue/qmp: (48 commits)
  target-ppc: add implementation of query-cpu-definitions (v2)
  target-i386: add implementation of query-cpu-definitions (v2)
  qapi: add query-cpu-definitions command (v2)
  compiler: add macro for GCC weak symbols
  qapi: add query-machines command
  qapi: mark QOM commands stable
  qmp: introduce device-list-properties command
  qmp: add SUSPEND_DISK event
  qmp: qmp-events.txt: add missing doc for the SUSPEND event
  qmp: qmp-events.txt: put events in alphabetical order
  qmp: emit the WAKEUP event when the guest is put to run
  qmp: don't emit the RESET event on wakeup from S3
  scripts: qapi-commands.py: qmp-commands.h: include qdict.h
  docs: writing-qmp-commands.txt: update error section
  error, qerror: drop QDict member
  qerror: drop qerror_table and qerror_format()
  error, qerror: pass desc string to error calls
  error: drop error_get_qobject()/error_set_qobject()
  qemu-ga: switch to the new error format on the wire
  qmp: switch to the new error format on the wire
  ...


Compare: https://github.com/qemu/qemu/compare/d517872ec289...633decd71119=


----==_mimepart_50299c1a911e0_455d12c2ae43680--


</body></email><email><emailId>20121203200009</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-03 20:00:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] b0d9ff: e1000: Discard packets that are too long if !SBP a...</subject><body>



----==_mimepart_50bd04c983c75_139cddbae4472d7
Date: Mon, 03 Dec 2012 12:00:09 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50bd04c988cdc_139cddbae4473f6@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: b0d9ffcd0251161c7c92f94804dcf599dfa3edeb
      https://github.com/qemu/qemu/commit/b0d9ffcd0251161c7c92f94804dcf599dfa3edeb
  Author: Michael Contreras &lt;michael@inetric.com&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M hw/e1000.c

  Log Message:
  -----------
  e1000: Discard packets that are too long if !SBP and !LPE

The e1000_receive function for the e1000 needs to discard packets longer than
1522 bytes if the SBP and LPE flags are disabled. The linux driver assumes
this behavior and allocates memory based on this assumption.

Signed-off-by: Michael Contreras &lt;michael@inetric.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 6d6c9f59ca1b1a76ade7ad868bef191818f58819
      https://github.com/qemu/qemu/commit/6d6c9f59ca1b1a76ade7ad868bef191818f58819
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M VERSION

  Log Message:
  -----------
  Update version for 1.3.0 release

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/01bbd8bf2cac...6d6c9f59ca1b

----==_mimepart_50bd04c983c75_139cddbae4472d7--


</body></email><email><emailId>20121203203008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-03 20:30:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 16c6c8: Open up 1.4 development branch</subject><body>



----==_mimepart_50bd0bd0c3eef_202d90ae4106960
Date: Mon, 03 Dec 2012 12:30:08 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50bd0bd0c4f42_202d90ae41070ef@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 16c6c80ac3a772b42a87b77dfdf0fdac7c607b0e
      https://github.com/qemu/qemu/commit/16c6c80ac3a772b42a87b77dfdf0fdac7c607b0e
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M VERSION

  Log Message:
  -----------
  Open up 1.4 development branch

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;




----==_mimepart_50bd0bd0c3eef_202d90ae4106960--


</body></email><email><emailId>20121205090010</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-05 09:00:10-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] d4d230: xilinx_axienet: Implement R_IS behaviour</subject><body>



----==_mimepart_50bf0d1a95ae5_7101affaf4179313
Date: Wed, 05 Dec 2012 01:00:10 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50bf0d1a9738c_7101affaf41794e5@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: d4d230da08918183929c7d6cb54824b391536904
      https://github.com/qemu/qemu/commit/d4d230da08918183929c7d6cb54824b391536904
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-12-05 (Wed, 05 Dec 2012)

  Changed paths:
    M hw/xilinx_axienet.c

  Log Message:
  -----------
  xilinx_axienet: Implement R_IS behaviour

The interrupt status register R_IS is the standard clear-on-write behaviour.
This was unimplemented and defaulting to updating the register to the written
value. Implemented clear-on-write.

Reported-by: Jason Wu &lt;huanyu@xilinx.com&gt;
Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Signed-off-by: Edgar E. Iglesias &lt;edgar.iglesias@gmail.com&gt;


  Commit: 859cc10d23e619153670fc58683373fa24d25b68
      https://github.com/qemu/qemu/commit/859cc10d23e619153670fc58683373fa24d25b68
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-12-05 (Wed, 05 Dec 2012)

  Changed paths:
    M hw/xilinx_uartlite.c

  Log Message:
  -----------
  xilinx_uartlite: suppress "cannot receive message"

This message is not an error condition, its just informing the user that
the device is corking the uart traffic to not drop characters.

Reported-by: Jason Wu &lt;huanyu@xilinx.com&gt;
Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Signed-off-by: Edgar E. Iglesias &lt;edgar.iglesias@gmail.com&gt;


  Commit: 80625b97b52836b944a6438e8e3e9d992e6a00b6
      https://github.com/qemu/qemu/commit/80625b97b52836b944a6438e8e3e9d992e6a00b6
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-12-05 (Wed, 05 Dec 2012)

  Changed paths:
    M hw/xilinx_uartlite.c

  Log Message:
  -----------
  xilinx_uartlite: Accept input after rx FIFO pop

The device return false from the can receive function when the FIFO is
full. This mean the device should check for buffered input whenever a byte is
popped from the FIFO.

Reported-by: Jason Wu &lt;huanyu@xilinx.com&gt;
Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Signed-off-by: Edgar E. Iglesias &lt;edgar.iglesias@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/16c6c80ac3a7...80625b97b528

----==_mimepart_50bf0d1a95ae5_7101affaf4179313--


</body></email><email><emailId>20121206083010</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-06 08:30:10-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 34f560: target-mips: Fix incorrect code and test for INSV</subject><body>



----==_mimepart_50c057921d709_51451312ae41845b5
Date: Thu, 06 Dec 2012 00:30:10 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50c057921ef9f_51451312ae4184624@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 34f5606ee101f82a247d09d05644ad2a63c8e342
      https://github.com/qemu/qemu/commit/34f5606ee101f82a247d09d05644ad2a63c8e342
  Author: Petar Jovanovic &lt;petarj@mips.com&gt;
  Date:   2012-12-05 (Wed, 05 Dec 2012)

  Changed paths:
    M target-mips/dsp_helper.c
    M tests/tcg/mips/mips32-dsp/insv.c

  Log Message:
  -----------
  target-mips: Fix incorrect code and test for INSV

Content of register rs should be shifted for pos before applying a mask.
This change contains both fix for the instruction and to the existing test.

Signed-off-by: Petar Jovanovic &lt;petarj@mips.com&gt;
Reviewed-by: Eric Johnson &lt;ericj@mips.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 19e6c50d2d843220efbdd3b2db21d83c122c364a
      https://github.com/qemu/qemu/commit/19e6c50d2d843220efbdd3b2db21d83c122c364a
  Author: Petar Jovanovic &lt;petarj@mips.com&gt;
  Date:   2012-12-05 (Wed, 05 Dec 2012)

  Changed paths:
    M target-mips/dsp_helper.c
    M tests/tcg/mips/mips32-dsp/shilo.c
    M tests/tcg/mips/mips32-dsp/shilov.c

  Log Message:
  -----------
  target-mips: Fix incorrect shift for SHILO and SHILOV

helper_shilo has not been shifting an accumulator value correctly for negative
values in 'shift' field. Minor optimization for shift=0 case.
This change also adds tests that will trigger issue and check for regressions.

Signed-off-by: Petar Jovanovic &lt;petarj@mips.com&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Reviewed-by: Eric Johnson &lt;ericj@mips.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


Compare: https://github.com/qemu/qemu/compare/80625b97b528...19e6c50d2d84

----==_mimepart_50c057921d709_51451312ae41845b5--


</body></email><email><emailId>20121206113007</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-06 11:30:07-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu]</subject><body>



----==_mimepart_50c081bff033d_763018fdae4108120
Date: Thu, 06 Dec 2012 03:30:07 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50c081bff1ca6_763018fdae41082a3@sh3.rs.github.com.mail&gt;

  Branch: refs/tags/v1.1.1
  Home:   https://github.com/qemu/qemu


----==_mimepart_50c081bff033d_763018fdae4108120--


</body></email><email><emailId>201212061130070</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-06 11:30:07-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu]</subject><body>



----==_mimepart_50c081bfa3f36_40de1977aec8942f
Date: Thu, 06 Dec 2012 03:30:07 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50c081bfa4fbe_40de1977aec895cd@sh2.rs.github.com.mail&gt;

  Branch: refs/tags/v1.2.1
  Home:   https://github.com/qemu/qemu


----==_mimepart_50c081bfa3f36_40de1977aec8942f--


</body></email><email><emailId>20121206113008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-06 11:30:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu]</subject><body>



----==_mimepart_50c081c0582c7_75be149caf492334
Date: Thu, 06 Dec 2012 03:30:08 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50c081c059395_75be149caf492457@sh2.rs.github.com.mail&gt;

  Branch: refs/tags/v1.1.2
  Home:   https://github.com/qemu/qemu


----==_mimepart_50c081c0582c7_75be149caf492334--


</body></email><email><emailId>20121208180013</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-08 18:00:13-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] ac1002: isa: Add isa_address_space_io()</subject><body>



----==_mimepart_50c3802d32dee_6d6f15a5af4864c2
Date: Sat, 08 Dec 2012 10:00:13 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50c3802d3420d_6d6f15a5af4865e1@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: ac10027327e27c9b360452e01af3ef2147f5a26f
      https://github.com/qemu/qemu/commit/ac10027327e27c9b360452e01af3ef2=
147f5a26f
  Author: Julien Grall &lt;julien.grall@citrix.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/isa-bus.c
    M hw/isa.h

  Log Message:
  -----------
  isa: Add isa_address_space_io()

This function permits to retrieve ISA IO address space.
It will be usefull when we need to pass IO address space as argument.

Signed-off-by: Julien Grall &lt;julien.grall@citrix.com&gt;
Acked-by: Avi Kivity &lt;avi@redhat.com&gt;
Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 42d8a3cf960659069bd2b2d9c443dafd7585607f
      https://github.com/qemu/qemu/commit/42d8a3cf960659069bd2b2d9c443daf=
d7585607f
  Author: Julien Grall &lt;julien.grall@citrix.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/acpi_piix4.c
    M hw/apm.c
    M hw/apm.h
    M hw/lpc_ich9.c
    M hw/vt82c686.c

  Log Message:
  -----------
  hw/apm.c: Replace register_ioport_*

Replace all register_ioport_*() with a MemoryRegion.
This permits to use the new Memory stuff like listeners.

Moreover, the PCI device is added as an argument for apm_init(),
so we can register IO inside the PCI IO address space.

Signed-off-by: Julien Grall &lt;julien.grall@citrix.com&gt;
Acked-by: Avi Kivity &lt;avi@redhat.com&gt;
[AF: Rebased onto hwaddr and q35]
Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: c75e6d8e354c44e76045cb0de20cda1a4ce4d575
      https://github.com/qemu/qemu/commit/c75e6d8e354c44e76045cb0de20cda1=
a4ce4d575
  Author: Julien Grall &lt;julien.grall@citrix.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/cirrus_vga.c

  Log Message:
  -----------
  hw/cirrus_vga.c: Replace register_ioport_*

Replace all register_ioport_*() with the new Memory API.
This permits to use the new Memory stuff like listeners.

Signed-off-by: Julien Grall &lt;julien.grall@citrix.com&gt;
Acked-by: Avi Kivity &lt;avi@redhat.com&gt;
[AF: Rebased onto hwaddr]
Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 568fd159e4ca82d213706acd2cf4c94f27537096
      https://github.com/qemu/qemu/commit/568fd159e4ca82d213706acd2cf4c94=
f27537096
  Author: Julien Grall &lt;julien.grall@citrix.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/mips_mipssim.c
    M hw/serial.c
    M hw/serial.h

  Log Message:
  -----------
  serial: Replace register_ioport_*

Replace all register_ioport_*() with a MemoryRegion.
This permits to use the new Memory stuff like listeners.

For more flexibility, the IO address space is passed as an argument.

Signed-off-by: Julien Grall &lt;julien.grall@citrix.com&gt;
Acked-by: Avi Kivity &lt;avi@redhat.com&gt;
[AF: Rebased onto serial split]
Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 258711c6448c44b60b0fecef1d3b09c71e23e304
      https://github.com/qemu/qemu/commit/258711c6448c44b60b0fecef1d3b09c=
71e23e304
  Author: Julien Grall &lt;julien.grall@citrix.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/pc.c

  Log Message:
  -----------
  hw/pc.c: Replace register_ioport_*

Replace all register_ioport_*() with portio_*() or a MemoryRegion.
This permits to use the new Memory stuff like listeners.

Signed-off-by: Julien Grall &lt;julien.grall@citrix.com&gt;
Acked-by: Avi Kivity &lt;avi@redhat.com&gt;
[AF: Rebased onto hwaddr]
Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 582299336879504353e60c7937fbc70fea93f3da
      https://github.com/qemu/qemu/commit/582299336879504353e60c7937fbc70=
fea93f3da
  Author: Julien Grall &lt;julien.grall@citrix.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/dma.c

  Log Message:
  -----------
  hw/dma.c: Replace register_ioport_*

Replace all register_ioport_*() with the new Memory API functions.
This permits to use the new Memory stuff like listeners.

Signed-off-by: Julien Grall &lt;julien.grall@citrix.com&gt;
Acked-by: Avi Kivity &lt;avi@redhat.com&gt;
[AF: Rebased onto hwaddr]
Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 0be4835b4932f38167b611c2b311ebaaec98a8eb
      https://github.com/qemu/qemu/commit/0be4835b4932f38167b611c2b311eba=
aec98a8eb
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M exec.c

  Log Message:
  -----------
  exec: Advise huge pages for the TCG code gen buffer

After allocating 32MB or more contiguous memory, huge pages
would seem to be ideal.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 2aa1cb514cdce31ca68902d464cd03d31a76e998
      https://github.com/qemu/qemu/commit/2aa1cb514cdce31ca68902d464cd03d=
31a76e998
  Author: Brad Smith &lt;brad@comstyle.com&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M ui/curses.c

  Log Message:
  -----------
  curses: Remove OpenBSD workaround

I removed the same sort of workaround for OpenBSD within the
configure script with commit 4dcc3f5876fa638d5c35bd47be3b717ea74cc2e7
but didn't bother to grep further to come across this same chunk
of code in the curses code itself. So the following diff removes
the same workaround chunk within the curses code.

Signed-off-by: Brad Smith &lt;brad@comstyle.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: c3a43607d927e6a0ecce0b61e8297c1cfe604c14
      https://github.com/qemu/qemu/commit/c3a43607d927e6a0ecce0b61e8297c1=
cfe604c14
  Author: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M tcg/tcg.h

  Log Message:
  -----------
  tcg/tcg.h: Duplicate global TCG gen_opc_ arrays into TCGContext.

Signed-off-by: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 25983cad31969e3003eef77bc03a6700f46899d2
      https://github.com/qemu/qemu/commit/25983cad31969e3003eef77bc03a670=
0f46899d2
  Author: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M target-alpha/translate.c
    M target-arm/translate.c
    M target-cris/translate.c
    M target-i386/translate.c
    M target-lm32/translate.c
    M target-m68k/translate.c
    M target-microblaze/translate.c
    M target-mips/translate.c
    M target-openrisc/translate.c
    M target-ppc/translate.c
    M target-s390x/translate.c
    M target-sh4/translate.c
    M target-sparc/translate.c
    M target-unicore32/translate.c
    M target-xtensa/translate.c

  Log Message:
  -----------
  TCG: Use gen_opc_pc from context instead of global variable.

Signed-off-by: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: c9c99c22d5f8e9cfa83260fbe236a57e7383d673
      https://github.com/qemu/qemu/commit/c9c99c22d5f8e9cfa83260fbe236a57=
e7383d673
  Author: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M target-alpha/translate.c
    M target-arm/translate.c
    M target-cris/translate.c
    M target-i386/translate.c
    M target-lm32/translate.c
    M target-m68k/translate.c
    M target-microblaze/translate.c
    M target-mips/translate.c
    M target-openrisc/translate.c
    M target-ppc/translate.c
    M target-s390x/translate.c
    M target-sh4/translate.c
    M target-sparc/translate.c
    M target-unicore32/translate.c
    M target-xtensa/translate.c
    M translate-all.c

  Log Message:
  -----------
  TCG: Use gen_opc_icount from context instead of global variable.

Signed-off-by: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: ab1103def476d985c08362df97ff9cb9c112adfc
      https://github.com/qemu/qemu/commit/ab1103def476d985c08362df97ff9cb=
9c112adfc
  Author: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M target-alpha/translate.c
    M target-arm/translate.c
    M target-cris/translate.c
    M target-i386/translate.c
    M target-lm32/translate.c
    M target-m68k/translate.c
    M target-microblaze/translate.c
    M target-mips/translate.c
    M target-openrisc/translate.c
    M target-ppc/translate.c
    M target-s390x/translate.c
    M target-sh4/translate.c
    M target-sparc/translate.c
    M target-unicore32/translate.c
    M target-xtensa/translate.c
    M translate-all.c

  Log Message:
  -----------
  TCG: Use gen_opc_instr_start from context instead of global variable.

Signed-off-by: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 94788f54e9deeaa2c82891a7d216fdd6e0e58749
      https://github.com/qemu/qemu/commit/94788f54e9deeaa2c82891a7d216fdd=
6e0e58749
  Author: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M exec-all.h
    M translate-all.c

  Log Message:
  -----------
  TCG: Remove unused global gen_opc_ arrays.

Signed-off-by: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 288fa40736e6eb63132d01aa6dc21ee831b796ae
      https://github.com/qemu/qemu/commit/288fa40736e6eb63132d01aa6dc21ee=
831b796ae
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  pixman: require 0.18.4 or newer

When older versions are found the internal pixman version is prefered.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 475363176c80feedb8feb5e335ba64de68c7b055
      https://github.com/qemu/qemu/commit/475363176c80feedb8feb5e335ba64d=
e68c7b055
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M HACKING

  Log Message:
  -----------
  HACKING: List areas where we may rely on impdef C behaviour

Add a section to HACKING saying which version of the C spec
we use and describing the bits of implementation defined C
compiler behaviour which C code in QEMU is allowed to rely on.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 4cdd2e665ec4bd10c20c26432ee9ffe4db7bcc1c
      https://github.com/qemu/qemu/commit/4cdd2e665ec4bd10c20c26432ee9ffe=
4db7bcc1c
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M hw/acpi_piix4.c
    M hw/apm.c
    M hw/apm.h
    M hw/cirrus_vga.c
    M hw/dma.c
    M hw/isa-bus.c
    M hw/isa.h
    M hw/lpc_ich9.c
    M hw/mips_mipssim.c
    M hw/pc.c
    M hw/serial.c
    M hw/serial.h
    M hw/vt82c686.c

  Log Message:
  -----------
  Merge branch 'memory-ioport' of git://github.com/afaerber/qemu-cpu

* 'memory-ioport' of git://github.com/afaerber/qemu-cpu:
  hw/dma.c: Replace register_ioport_*
  hw/pc.c: Replace register_ioport_*
  serial: Replace register_ioport_*
  hw/cirrus_vga.c: Replace register_ioport_*
  hw/apm.c: Replace register_ioport_*
  isa: Add isa_address_space_io()


  Commit: 511c68d3af626cb0a39034cb77e7ac64d3a26c0c
      https://github.com/qemu/qemu/commit/511c68d3af626cb0a39034cb77e7ac6=
4d3a26c0c
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M qemu-config.c

  Log Message:
  -----------
  finally kill cpudef config section support

The external CPU models were removed on QEMU 1.2, and the support for
the "cpudef" config sections was documented as deprecated, but the
actual removal of the config section was pending.

Now that QEMU 1.3 was released, we can finally kill the support for
cpudef config sections, and support only the built-in CPU models from
target-i386/cpu.c.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 536b558f5896ebbd635b57fa393e82faaa32ad52
      https://github.com/qemu/qemu/commit/536b558f5896ebbd635b57fa393e82f=
aaa32ad52
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M hw/xilinx_axienet.c
    M hw/xilinx_uartlite.c
    M target-mips/dsp_helper.c
    M tests/tcg/mips/mips32-dsp/insv.c
    M tests/tcg/mips/mips32-dsp/shilo.c
    M tests/tcg/mips/mips32-dsp/shilov.c

  Log Message:
  -----------
  Merge branch 'master' of git.qemu-project.org:/pub/git/qemu

* 'master' of git.qemu-project.org:/pub/git/qemu:
  target-mips: Fix incorrect shift for SHILO and SHILOV
  target-mips: Fix incorrect code and test for INSV
  xilinx_uartlite: Accept input after rx FIFO pop
  xilinx_uartlite: suppress "cannot receive message"
  xilinx_axienet: Implement R_IS behaviour


Compare: https://github.com/qemu/qemu/compare/19e6c50d2d84...536b558f5896=


----==_mimepart_50c3802d32dee_6d6f15a5af4864c2--


</body></email><email><emailId>20121208203008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-08 20:30:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] fcc803: target-xtensa: implement ATOMCTL SR</subject><body>



----==_mimepart_50c3a350cdc96_31e216d5af0668f0
Date: Sat, 08 Dec 2012 12:30:08 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50c3a350d0b10_31e216d5af0669c9@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: fcc803d119a4c01a9b0ee5bda35fda1eeabffa33
      https://github.com/qemu/qemu/commit/fcc803d119a4c01a9b0ee5bda35fda1eeabffa33
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M target-xtensa/cpu.c
    M target-xtensa/cpu.h
    M target-xtensa/helper.c
    M target-xtensa/helper.h
    M target-xtensa/op_helper.c
    M target-xtensa/overlay_tool.h
    M target-xtensa/translate.c

  Log Message:
  -----------
  target-xtensa: implement ATOMCTL SR

ATOMCTL SR controls s32c1i opcode behavior depending on targeted memory
type. See ISA, 4.3.12.4 for details.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 4e41d2f5830a76d3fe92b3d3b18cc9f2ee927770
      https://github.com/qemu/qemu/commit/4e41d2f5830a76d3fe92b3d3b18cc9f2ee927770
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M target-xtensa/cpu.c
    M target-xtensa/cpu.h
    M target-xtensa/helper.c
    M target-xtensa/overlay_tool.h
    M target-xtensa/translate.c

  Log Message:
  -----------
  target-xtensa: implement CACHEATTR SR

In XEA1, the Options for Memory Protection and Translation and the
corresponding TLB management instructions are not available. Instead,
functionality similar to the Region Protection Option is available
through the cache attribute register. See ISA, A.2.14 for details.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: fe0bd475aa31e60674f7f53b85dc293108026202
      https://github.com/qemu/qemu/commit/fe0bd475aa31e60674f7f53b85dc293108026202
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M target-xtensa/cpu.h
    M target-xtensa/overlay_tool.h
    M target-xtensa/translate.c

  Log Message:
  -----------
  target-xtensa: restrict available SRs by enabled options

Beginning with the RA-2004.1 release, SR access instructions (rsr, wsr,
xsr) are associated with their corresponding SR and raise illegal opcode
exception in case the register is not configured for the core.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 53593e90d13264dc88b3281ddf75ceaa641df05a
      https://github.com/qemu/qemu/commit/53593e90d13264dc88b3281ddf75ceaa641df05a
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M target-xtensa/translate.c

  Log Message:
  -----------
  target-xtensa: better control rsr/wsr/xsr access to SRs

There are read-only (DEBUGCAUSE, PRID) and write-only (INTCLEAR) SRs,
and INTERRUPT/INTSET SR allows rsr/wsr, but not xsr. Raise illeagal
opcode exception on illegal access to these SRs.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: b7909d81f7658f64bba0faed83e7c2fd6a52fcba
      https://github.com/qemu/qemu/commit/b7909d81f7658f64bba0faed83e7c2fd6a52fcba
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M target-xtensa/cpu.h
    M target-xtensa/overlay_tool.h
    M target-xtensa/translate.c

  Log Message:
  -----------
  target-xtensa: implement MISC SR

The Miscellaneous Special Registers Option provides zero to four scratch
registers within the processor readable and writable by RSR, WSR, and
XSR. These registers are privileged. They may be useful for some
application-specific exception and interrupt processing tasks in the
kernel. The MISC registers are undefined after reset.
See ISA, 4.7.3 for details.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: efdfac94f48f8589a0d60b650c7bed989a341eaa
      https://github.com/qemu/qemu/commit/efdfac94f48f8589a0d60b650c7bed989a341eaa
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M tests/tcg/xtensa/Makefile
    M tests/tcg/xtensa/macros.inc
    A tests/tcg/xtensa/test_sr.S

  Log Message:
  -----------
  target-xtensa: add SR accessibility unit tests

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 5dacd229ebb46c236cb1dd0c65a4e4f2cfb55dfb
      https://github.com/qemu/qemu/commit/5dacd229ebb46c236cb1dd0c65a4e4f2cfb55dfb
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M tests/tcg/xtensa/Makefile
    A tests/tcg/xtensa/test_s32c1i.S

  Log Message:
  -----------
  target-xtensa: add s32c1i unit tests

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: f877d09e63bd94424dab049da75bc1cd601a7609
      https://github.com/qemu/qemu/commit/f877d09e63bd94424dab049da75bc1cd601a7609
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M target-xtensa/translate.c

  Log Message:
  -----------
  target-xtensa: use movcond where possible

Use movcond for all sorts of conditional moves, ABS, CLAMPS, MIN/MAX
opcodes.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 24c35a504e8b09e697d0268bbefb2a329b901611
      https://github.com/qemu/qemu/commit/24c35a504e8b09e697d0268bbefb2a329b901611
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M linux-user/arm/syscall_nr.h
    M linux-user/i386/syscall_nr.h
    M linux-user/sparc/syscall_nr.h
    M linux-user/strace.list
    M linux-user/syscall.c
    M linux-user/unicore32/syscall_nr.h

  Log Message:
  -----------
  linux-user: Merge pread/pwrite into pread64/pwrite64

The Linux syscalls underlying pread() and pwrite() take a 64 bit
offset on all architectures, even if some of them name the syscall
"pread/pwrite" rather than "pread64/pwrite64" for historical reasons.
So move the four QEMU target architectures (arm, i386, sparc,
unicore32) which were defining TARGET_NR_pread/pwrite to define
TARGET_NR_pread64/pwrite64 instead, and drop the TARGET_NR_pread/pwrite
implementation code completely.

(Based on examination of the kernel sources for the four architectures
this patch affects.)

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: e49d021e574c3ee8e443bcc84d1fb7dfb4c87c42
      https://github.com/qemu/qemu/commit/e49d021e574c3ee8e443bcc84d1fb7dfb4c87c42
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-12-08 (Sat, 08 Dec 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: Default to 'cc', not 'gcc'

Default to 'cc' as our compiler, rather than 'gcc'. We used to have
to insist on gcc when we still kept the CPU env in a fixed global
register, but this is no longer necessary and we will now compile OK
on clang as well as gcc.  Using 'cc' should generally result in us
using the most standard and maintained system compiler for the
platform.  (For instance on newer MacOS X 'gcc' exists but is an
elderly compiler provided mostly for legacy reasons, and 'cc'
(which is clang) is definitely the better choice.) On Linux there
will generally be no user-visible change since cc will be gcc.

This changeover necessitates a slight reworking of how we set the
'cc' variable, because GNU cross toolchains generally provide a
'${cross_prefix}gcc' but not a '${cross_prefix}cc'.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/536b558f5896...e49d021e574c

----==_mimepart_50c3a350cdc96_31e216d5af0668f0--


</body></email><email><emailId>20121210170013</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-10 17:00:13-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] af1111: apci: switch piix4 to memory api</subject><body>



----==_mimepart_50c6151db05d1_73d017b5aec75132
Date: Mon, 10 Dec 2012 09:00:13 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50c6151db51b8_73d017b5aec7527b@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: af11110bb83166473064389faa27e8c6703b2008
      https://github.com/qemu/qemu/commit/af11110bb83166473064389faa27e8c=
6703b2008
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/acpi_piix4.c

  Log Message:
  -----------
  apci: switch piix4 to memory api

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: cacaab8bdd74608361a488aac600d609dafd53e5
      https://github.com/qemu/qemu/commit/cacaab8bdd74608361a488aac600d60=
9dafd53e5
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/acpi_ich9.c
    M hw/acpi_ich9.h

  Log Message:
  -----------
  apci: switch ich9 to memory api

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: a29028214c1d5d3571b27e6745f14534e6d8a662
      https://github.com/qemu/qemu/commit/a29028214c1d5d3571b27e6745f1453=
4e6d8a662
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/vt82c686.c

  Log Message:
  -----------
  apci: switch vt82c686 to memory api

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 77d58b1e47c8d1c661f98f12b47ab519d3561488
      https://github.com/qemu/qemu/commit/77d58b1e47c8d1c661f98f12b47ab51=
9d3561488
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/acpi.c
    M hw/acpi.h
    M hw/acpi_ich9.c
    M hw/acpi_piix4.c
    M hw/vt82c686.c

  Log Message:
  -----------
  apci: switch timer to memory api

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: afafe4bbe0cf7d3318e1ac7b40925561f86a6bd4
      https://github.com/qemu/qemu/commit/afafe4bbe0cf7d3318e1ac7b4092556=
1f86a6bd4
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/acpi.c
    M hw/acpi.h
    M hw/acpi_ich9.c
    M hw/acpi_piix4.c
    M hw/vt82c686.c

  Log Message:
  -----------
  apci: switch cnt to memory api

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: b5a7c024d2606e84e0bbe4a0e87d252dfda41479
      https://github.com/qemu/qemu/commit/b5a7c024d2606e84e0bbe4a0e87d252=
dfda41479
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/acpi.c
    M hw/acpi.h
    M hw/acpi_ich9.c
    M hw/acpi_piix4.c
    M hw/vt82c686.c

  Log Message:
  -----------
  apci: switch evt to memory api

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: ca5d64b4b4fbb01e403f89ec9b399aaa69104b1e
      https://github.com/qemu/qemu/commit/ca5d64b4b4fbb01e403f89ec9b399aa=
a69104b1e
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/acpi_piix4.c

  Log Message:
  -----------
  acpi: cleanup piix4 memory region

Nothing left to do, everything handled by subregions,
we can zap the reaw/write handlers now.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: a0f95659da77c8818ebd146bb1546ad152d0833e
      https://github.com/qemu/qemu/commit/a0f95659da77c8818ebd146bb1546ad=
152d0833e
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/vt82c686.c

  Log Message:
  -----------
  acpi: cleanup vt82c686 memory region

Nothing left to do, everything handled by subregions,
we can zap the reaw/write handlers now.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 76a7daf97458c55b8d8e6d4eadc5c46b16c705ce
      https://github.com/qemu/qemu/commit/76a7daf97458c55b8d8e6d4eadc5c46=
b16c705ce
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/acpi_ich9.c
    M hw/acpi_ich9.h

  Log Message:
  -----------
  apci: switch ich9 gpe to memory api

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 10cc69b0de8e1756e6fbda4592c9d0ba3bce58fc
      https://github.com/qemu/qemu/commit/10cc69b0de8e1756e6fbda4592c9d0b=
a3bce58fc
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/acpi_ich9.c
    M hw/acpi_ich9.h

  Log Message:
  -----------
  apci: switch ich9 smi to memory api

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 4a522de0905c88160b6f93eb5d35883382a0c333
      https://github.com/qemu/qemu/commit/4a522de0905c88160b6f93eb5d35883=
382a0c333
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/acpi_ich9.c

  Log Message:
  -----------
  acpi: cleanup ich9 memory region

Nothing left to do, everything handled by subregions,
we can zap the reaw/write handlers now.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 798512e5522685163c8d5fc5093aea19ae9cce06
      https://github.com/qemu/qemu/commit/798512e5522685163c8d5fc5093aea1=
9ae9cce06
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/acpi_piix4.c
    M hw/pm_smbus.c
    M hw/pm_smbus.h
    M hw/smbus_ich9.c
    M hw/vt82c686.c

  Log Message:
  -----------
  acpi: switch smbus to memory api

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 24fe083de67e0f736c54da4abda05f23ec37c51d
      https://github.com/qemu/qemu/commit/24fe083de67e0f736c54da4abda05f2=
3ec37c51d
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/acpi_piix4.c

  Log Message:
  -----------
  acpi: fix piix4 smbus mapping

Make write to the smbus base register and enable bit actually work.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: b65b93f24cb84923d2d7d43cf87d40bc88b6bdcd
      https://github.com/qemu/qemu/commit/b65b93f24cb84923d2d7d43cf87d40b=
c88b6bdcd
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/acpi_piix4.c

  Log Message:
  -----------
  apci: switch piix4 gpe to memory api

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: c84649ca66a32aadba20a8202062b02247270ee5
      https://github.com/qemu/qemu/commit/c84649ca66a32aadba20a8202062b02=
247270ee5
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/acpi.c
    M hw/acpi.h
    M hw/acpi_ich9.c
    M hw/acpi_piix4.c

  Log Message:
  -----------
  acpi: remove acpi_gpe_blk

With gpe being switched to memory api this is no longer needed.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: c177684c753a0b1337acebb7dbc6f3f3a9700321
      https://github.com/qemu/qemu/commit/c177684c753a0b1337acebb7dbc6f3f=
3a9700321
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/acpi_piix4.c

  Log Message:
  -----------
  apci: switch piix4 pci hotplug to memory api

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 3f5bc9e8af8c9ee617b143e42ad4bd2feb379a19
      https://github.com/qemu/qemu/commit/3f5bc9e8af8c9ee617b143e42ad4bd2=
feb379a19
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/ich9.h
    M hw/lpc_ich9.c
    M hw/smbus_ich9.c

  Log Message:
  -----------
  q35: update lpc pci config space according to configured devices

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 3e43749882c558875f70ac5deda39cdc9797e245
      https://github.com/qemu/qemu/commit/3e43749882c558875f70ac5deda39cd=
c9797e245
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/acpi_piix4.c

  Log Message:
  -----------
  acpi: drop debug port

I'm pretty sure this isn't needed any more.  I think this predates the
switch to seabios, and the seabios DSDT table has a DBUG() aml macro
which writes stuff to the seabios debug port (0x402).

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: f1ae2e3883c4ee3a9f91f484690abe42f5063d64
      https://github.com/qemu/qemu/commit/f1ae2e3883c4ee3a9f91f484690abe4=
2f5063d64
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/pc_piix.c

  Log Message:
  -----------
  add pc-1.4

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 8beba9304391189666df1b62b23a5101b3831317
      https://github.com/qemu/qemu/commit/8beba9304391189666df1b62b23a510=
1b3831317
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/usb/dev-hub.c
    M hw/usb/dev-network.c
    M hw/usb/dev-wacom.c
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb: Call wakeup when data becomes available for all devices with int e=
ps

This is necessary for proper interaction with the xhci controller, and it=

will allow other hcds to lower there frame timer while waiting for interr=
upt
data.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: be41efde3ca0372dbf7543e09ff473b4eec25057
      https://github.com/qemu/qemu/commit/be41efde3ca0372dbf7543e09ff473b=
4eec25057
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/usb.h
    M hw/usb/core.c
    M hw/usb/host-bsd.c
    M hw/usb/host-linux.c

  Log Message:
  -----------
  usb: Don't allow USB_RET_ASYNC for interrupt packets

It is tempting to use USB_RET_ASYNC for interrupt packets, rather then th=
e
current NAK + polling approach, but this causes issues for migration, as
an async completed packet will not getting written back to guest memory u=
ntil
the next poll time, and if a migration happens in between it will get los=
t!

Make an exception for host devices, because:
1) host-linux actually uses async completion for interrupt endpoints
2) host devices don't migrate anyways

Ideally we would convert host-linux.c to handle (input) interrupt endpoin=
ts in
a buffered manner like it does for isoc endpoints, keeping multiple urbs
submitted to ensure the devices timing requirements are met, as well as m=
aking
its interrupt ep handling the same as other usb-devices.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 386ab487ebc25d780ddfc4a9aea0b21c4a9aaa94
      https://github.com/qemu/qemu/commit/386ab487ebc25d780ddfc4a9aea0b21=
c4a9aaa94
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/usb.h
    M hw/usb/bus.c

  Log Message:
  -----------
  usb: Allow overriding of usb_desc at the device level

This allows devices to present a different set of descriptors based on
device properties.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 8082624099bce56a3139e6b9f72016c00fd10227
      https://github.com/qemu/qemu/commit/8082624099bce56a3139e6b9f72016c=
00fd10227
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c
    M hw/usb/hcd-ehci.h

  Log Message:
  -----------
  ehci: Lower timer freq when the periodic schedule is idle

Lower the timer freq if no iso schedule packets complete for 64 frames in=

a row.

We can safely do this, without adding latency, because:
1) If there is isoc traffic this will never trigger
2) For async handled interrupt packets (only usb-host), the completion ha=
ndler
   will immediately schedule the frame_timer from a bh
3) All devices using NAK to signal no data for interrupt endpoints now us=
e
   wakeup, which will immediately schedule the frame_timer from a bh

The advantage of this is that when we only have interrupt packets in the
periodic schedule, async_stepdown can do its work and significantly lower=

the frequency at which the frame_timer runs.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 427e3aa151c749225364d0c30640e2e3c1756d9d
      https://github.com/qemu/qemu/commit/427e3aa151c749225364d0c30640e2e=
3c1756d9d
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-12-04 (Tue, 04 Dec 2012)

  Changed paths:
    M hw/pc_piix.c
    M hw/usb/dev-hid.c

  Log Message:
  -----------
  usb-tablet: Allow connecting to ehci

Our ehci code has is capable of significantly lowering the wakeup rate
for the hcd emulation while the device is idle. It is possible to add
similar code ot the uhci emulation, but that simply is not there atm,
and there is no reason why a (virtual) usb-tablet can not be a USB-2 devi=
ce.

Making usb-hid devices connect to the emulated ehci controller instead
of the emulated uhci controller on vms which have both lowers the cpuload=

for a fully idle vm from 20% to 2-3% (on my laptop).

An alternative implementation to using a property to select the tablet
type, would be simply making it a new device type, ie usb-tablet2, but th=
e
downside of that is that this will require libvirt changes to be availabl=
e
through libvirt at all, and then management tools changes to become the
default for new vms, where as using a property will automatically get
any pc-1.3 type vms the lower cpuload.

[ kraxel: adapt compat property for post-1.3 merge ]

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;

tablet compat fixup

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 9fd2ecdc8cb2dc1a8a7c57b6c9c60bc9947b6a73
      https://github.com/qemu/qemu/commit/9fd2ecdc8cb2dc1a8a7c57b6c9c60bc=
9947b6a73
  Author: Paolo Bonzini &lt;pbonini@redhat.com&gt;
  Date:   2012-12-05 (Wed, 05 Dec 2012)

  Changed paths:
    M fsdev/virtfs-proxy-helper.c

  Log Message:
  -----------
  virtfs-proxy-helper: use setresuid and setresgid

The setfsuid and setfsgid system calls are obscure and they complicate
the error checking (that glibc's warn_unused_result "feature" forces
us to do).  Switch to the standard setresuid and setresgid functions.

Signed-off-by: Paolo Bonzini &lt;pbonini@redhat.com
Signed-off-by: Aneesh Kumar K.V &lt;aneesh.kumar@linux.vnet.ibm.com&gt;


  Commit: 89e0e9c71e608f3679f30e88d988903536c6f7f3
      https://github.com/qemu/qemu/commit/89e0e9c71e608f3679f30e88d988903=
536c6f7f3
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-12-06 (Thu, 06 Dec 2012)

  Changed paths:
    R bsd-user/qemu-types.h
    R linux-user/qemu-types.h
    A qemu-types.h

  Log Message:
  -----------
  user: Move *-user/qemu-types.h to main directory

The bsd-user/qemu-types.h and linux-user/qemu-types.h files are almost
the same, but linux-user has the additional definitions of tswapal().

This moves the linux-user file to the main directory, so the same file
can be used by linux-user and bsd-user.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: ee9baa00f2623f1f627913f62d60f2888286319a
      https://github.com/qemu/qemu/commit/ee9baa00f2623f1f627913f62d60f28=
88286319a
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-12-06 (Thu, 06 Dec 2012)

  Changed paths:
    M bsd-user/qemu.h
    M cpu-all.h
    M linux-user/qemu.h
    R qemu-types.h
    A qemu-user-types.h

  Log Message:
  -----------
  user: Rename qemu-types.h to qemu-user-types.h

The header file is specific for *-user, but I plan to introduce a more
generic qemu-types.h file, so I'm renaming it.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 90f0cfa410544727ac4e9c130f9e5032e1fb9b71
      https://github.com/qemu/qemu/commit/90f0cfa410544727ac4e9c130f9e503=
2e1fb9b71
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-12-06 (Thu, 06 Dec 2012)

  Changed paths:
    M ui/vnc-palette.c

  Log Message:
  -----------
  ui/vnc-palette.c: Include headers it needs

Include:
 - &lt;glib.h&gt; for g_malloc0()
 - &lt;string.h&gt; for memset()

Some of those headers were probably being included by accident because
some other headers were including qemu-common.h, but those headers
should eventually stop including qemu-common.h.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: ccff63cac4f0d391187c9ee9aa2cab754df80c41
      https://github.com/qemu/qemu/commit/ccff63cac4f0d391187c9ee9aa2cab7=
54df80c41
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-12-06 (Thu, 06 Dec 2012)

  Changed paths:
    M qapi/qmp-registry.c

  Log Message:
  -----------
  qapi/qmp-registry.c: Include headers it needs

Include:
- &lt;glib.h&gt; for g_malloc0()
- &lt;string.h&gt; for strcmp()

Some of those headers were probably being included by accident because
some other headers were including qemu-common.h, but those headers
should eventually stop including qemu-common.h.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 4d4922c339abf67e47c79068d343ed41a020b8e2
      https://github.com/qemu/qemu/commit/4d4922c339abf67e47c79068d343ed4=
1a020b8e2
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-12-06 (Thu, 06 Dec 2012)

  Changed paths:
    M qga/channel-posix.c

  Log Message:
  -----------
  qga/channel-posix.c: Include headers it needs

Include:
 - &lt;errno.h&gt; for errno
 - &lt;unistd.h&gt; &amp; &lt;fcntl.h&gt; for fcntl()
 - &lt;stdlib.h&gt; for exit()
 - "osdep.h" for qemu_open()

Some of those headers were probably being included by accident because
some other headers were including qemu-common.h, but those headers
should eventually stop including qemu-common.h.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: cad32159663c5910098e10d64f4b5b10648b0095
      https://github.com/qemu/qemu/commit/cad32159663c5910098e10d64f4b5b1=
0648b0095
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-12-06 (Thu, 06 Dec 2012)

  Changed paths:
    M qlist.h

  Log Message:
  -----------
  qlist.h: Do not include qemu-common.h

I don't know why it was including it, as I don't see any code that
depends on anything from qemu-common.h.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 394e1bb79591c2fbfc873e5ccc38e92a3ba992cf
      https://github.com/qemu/qemu/commit/394e1bb79591c2fbfc873e5ccc38e92=
a3ba992cf
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-12-06 (Thu, 06 Dec 2012)

  Changed paths:
    M hw/qdev-core.h
    M qemu-common.h
    A qemu-types.h

  Log Message:
  -----------
  Create qemu-types.h for struct typedefs

Instead of keeping all those struct typedefs in qemu-common.h, move it
to a header that can be safely included by other headers, containing
only the struct typedefs and not pulling in other dependencies.

Also, move some of the qdev-core.h typedefs to the new file, too, so
other headers don't need to include qdev-core.h only because of
DeviceState and other typedefs.

This will help us remove qemu-common.h dependencies from some headers
later.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: bcf7930105c26d09ae83cbd8b982d01bb421f215
      https://github.com/qemu/qemu/commit/bcf7930105c26d09ae83cbd8b982d01=
bb421f215
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-12-06 (Thu, 06 Dec 2012)

  Changed paths:
    M sysemu.h

  Log Message:
  -----------
  sysemu.h: Include qemu-types.h instead of qemu-common.h

It just needs the Monitor and DeviceState typedefs, so it doesn't need
all of qemu-common.h.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 23e3fbec3355e67dbf26e98bbe33ef354097df8e
      https://github.com/qemu/qemu/commit/23e3fbec3355e67dbf26e98bbe33ef3=
54097df8e
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-12-06 (Thu, 06 Dec 2012)

  Changed paths:
    M hw/qdev.c

  Log Message:
  -----------
  qdev: qdev_create(): use error_report() instead of hw_error()

hw_error() is specific for fatal hardware emulation errors, not for
internal errors related to the qdev object/class abstraction or object
initialization.

Replace it with an error_report() call, followed by abort().

This will also help reduce dependencies of the qdev code (as hw_error()
is from cpus.o, and depends on the CPU list from exec.o).

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 9f3fb5657b2133a408ccf40b4ab57dec9b4ce771
      https://github.com/qemu/qemu/commit/9f3fb5657b2133a408ccf40b4ab57de=
c9b4ce771
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-12-06 (Thu, 06 Dec 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386/cpu.c: Coding style fixes

- Use spaces instead of tabs on cpu_x86_cpuid().
- Use braces on 'if' statement cpu_x86_find_by_name().

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Reviewed-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 8f961357d06a0beeb7d3efbde1d754d82ff6a300
      https://github.com/qemu/qemu/commit/8f961357d06a0beeb7d3efbde1d754d=
82ff6a300
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-12-06 (Thu, 06 Dec 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: Separate feature string parsing from CPU model lookup

Instead of parsing the whole cpu_model string inside
cpu_x86_find_by_name(), first split it into the CPU model name and the
full feature string, then parse the feature string into pieces.

When using CPU model classes, those two pieces of information will be
used at different moments (CPU model name will be used to find CPU
class, feature string will be used after CPU object was created), so
making the split in two steps will make it easier to refactor the code
later.

This should also help on the CPU properties work, that will just need to
replace the cpu_x86_parse_featurestr() logic (and can keep the CPU model
lookup code as-is).

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Reviewed-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 9df694eeb8447ae5a302b4d40df9a8b91dfc61da
      https://github.com/qemu/qemu/commit/9df694eeb8447ae5a302b4d40df9a8b=
91dfc61da
  Author: Igor Mammedov &lt;imammedo@redhat.com&gt;
  Date:   2012-12-06 (Thu, 06 Dec 2012)

  Changed paths:
    M target-i386/cpu.c
    M target-i386/cpu.h

  Log Message:
  -----------
  target-i386: Use define for cpuid vendor string size

Signed-off-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Reviewed-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 038d3d44598232f5aad40d1c84c215f38a21576c
      https://github.com/qemu/qemu/commit/038d3d44598232f5aad40d1c84c215f=
38a21576c
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-12-07 (Fri, 07 Dec 2012)

  Changed paths:
    M hw/sd.c

  Log Message:
  -----------
  sd: Send debug printfery to stderr not stdout

Some debug printfs for SD are coming up in stdout. Redirected them to std=
err
instead.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: bb5b5c20b7f68c79e036cd3ec5e9e6362c112670
      https://github.com/qemu/qemu/commit/bb5b5c20b7f68c79e036cd3ec5e9e63=
62c112670
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-12-07 (Fri, 07 Dec 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: Remove stray debug output

Rather than printing a message saying we're silently falling
back to gthread coroutines when running on MacOS, actually
do it silently.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: eac29d87c883fcbb54913ae20ed2bdccb4bcf7a3
      https://github.com/qemu/qemu/commit/eac29d87c883fcbb54913ae20ed2bdc=
cb4bcf7a3
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-12-07 (Fri, 07 Dec 2012)

  Changed paths:
    M configure
    M net/tap-win32.c

  Log Message:
  -----------
  Fix spelling (prefered -&gt; preferred)

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: a93cf9dfba171aa94e3c4002d58abef2a3732bfb
      https://github.com/qemu/qemu/commit/a93cf9dfba171aa94e3c4002d58abef=
2a3732bfb
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-12-07 (Fri, 07 Dec 2012)

  Changed paths:
    M slirp/ip_icmp.c
    M tcg/tcg.h
    M uri.c

  Log Message:
  -----------
  Fix comments (adress -&gt; address, layed -&gt; laid, wierd -&gt; weird)

Remove also a duplicated 'the'.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 8367a14fd3c1ecd5551c91cd3f951ffc61ad7c12
      https://github.com/qemu/qemu/commit/8367a14fd3c1ecd5551c91cd3f951ff=
c61ad7c12
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-12-07 (Fri, 07 Dec 2012)

  Changed paths:
    M hw/s390x/sclp.h
    M hw/s390x/sclpconsole.c

  Log Message:
  -----------
  s390x: Spelling fixes (endianess -&gt; endianness, occured -&gt; occurred)

Replace also "write into" by "write to".

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: c47d08ceff8ac76ff857016c80a8864fcf45a7d6
      https://github.com/qemu/qemu/commit/c47d08ceff8ac76ff857016c80a8864=
fcf45a7d6
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-12-07 (Fri, 07 Dec 2012)

  Changed paths:
    M target-alpha/cpu.h

  Log Message:
  -----------
  target-alpha: Remove t0, t1 from CPUAlphaState

These fields are no longer (or were never?) used.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: d694516440ca31bbcc7ad73f5e99b45fbeb2a6e6
      https://github.com/qemu/qemu/commit/d694516440ca31bbcc7ad73f5e99b45=
fbeb2a6e6
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-12-07 (Fri, 07 Dec 2012)

  Changed paths:
    M target-m68k/cpu.h

  Log Message:
  -----------
  target-m68k: Remove t1 from CPUM68KState

This field is no longer used.

Cc: Paul Brook &lt;paul@codesourcery.com&gt;
Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: dee17bf9e5d29bd08592c6fc47541aad70444bbc
      https://github.com/qemu/qemu/commit/dee17bf9e5d29bd08592c6fc47541aa=
d70444bbc
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-12-07 (Fri, 07 Dec 2012)

  Changed paths:
    M target-sparc/cpu.h

  Log Message:
  -----------
  target-sparc: Remove t0, t1 from CPUSPARCState

These fields are no longer used.

Cc: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 036f0f8356936dba36b952c16f477b3f04f54e37
      https://github.com/qemu/qemu/commit/036f0f8356936dba36b952c16f477b3=
f04f54e37
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-12-07 (Fri, 07 Dec 2012)

  Changed paths:
    M hw/a9mpcore.c

  Log Message:
  -----------
  arm: a9mpcore: remove un-used ptimer_iomem field

I'm guessing this is a hangover from a previous coreification of the mpti=
mer
sub-module. This field is completely unused - removed.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 4dbd84e26f53d3283baa463f390f9623e8913e8f
      https://github.com/qemu/qemu/commit/4dbd84e26f53d3283baa463f390f962=
3e8913e8f
  Author: Markus Armbruster &lt;armbru@redhat.com&gt;
  Date:   2012-12-07 (Fri, 07 Dec 2012)

  Changed paths:
    M hw/device-hotplug.c
    M hw/pci-hotplug.c
    M sysemu.h

  Log Message:
  -----------
  Clean up pci_drive_hot_add()'s use of BlockInterfaceType

pci_drive_hot_add() parameter type has the wrong type: int instead of
BlockInterfaceType.  It's actually redundant, so we can just drop it.

Signed-off-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 993d46ce7e54f3d035d344ed1b145b13f9ac54b9
      https://github.com/qemu/qemu/commit/993d46ce7e54f3d035d344ed1b145b1=
3f9ac54b9
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-12-07 (Fri, 07 Dec 2012)

  Changed paths:
    M hw/usb.h
    M tests/qemu-iotests/iotests.py

  Log Message:
  -----------
  Fix spelling in comments and documentation

These spelling bugs were found by codespell:

supressing -&gt; suppressing
transfered -&gt; transferred

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 3528a3cba1f59de520fad7b1c843759e8655ea2c
      https://github.com/qemu/qemu/commit/3528a3cba1f59de520fad7b1c843759=
e8655ea2c
  Author: Michal Privoznik &lt;mprivozn@redhat.com&gt;
  Date:   2012-12-07 (Fri, 07 Dec 2012)

  Changed paths:
    M qemu-options.hx

  Log Message:
  -----------
  qemu-options: Fix space at EOL

There's no need to add a space at the end of line.
Moreover, it can make problems in some projects that
store the help output into a file (and run couple of
tests based on that) and have space at EOL forbidden.

Signed-off-by: Michal Privoznik &lt;mprivozn@redhat.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 654598c944aa31cdbea435bd468055af9c918d16
      https://github.com/qemu/qemu/commit/654598c944aa31cdbea435bd468055a=
f9c918d16
  Author: Markus Armbruster &lt;armbru@redhat.com&gt;
  Date:   2012-12-07 (Fri, 07 Dec 2012)

  Changed paths:
    M hw/pc_sysfw.c

  Log Message:
  -----------
  pc_sysfw: Plug memory leak on pc_fw_add_pflash_drv() error path

Harmless, because we the error inevitably leads to another, fatal one
in pc_system_flash_init(): PC system firmware (pflash) not available.
Fix it anyway.

Signed-off-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: b34d12d153e6e5c5e5e00eac510b054a94409deb
      https://github.com/qemu/qemu/commit/b34d12d153e6e5c5e5e00eac510b054=
a94409deb
  Author: Igor Mammedov &lt;imammedo@redhat.com&gt;
  Date:   2012-12-07 (Fri, 07 Dec 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: Postpone cpuid_level update to realize time

Delay capping cpuid_level to 7 to realize time so property setters
for cpuid_7_0_ebx_features and "level" could be used in any order/time
between x86_cpu_initfn() and x86_cpu_realize().

Signed-off-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: c62adbee15deae473aa02a37193ddd6b054b0c9f
      https://github.com/qemu/qemu/commit/c62adbee15deae473aa02a37193ddd6=
b054b0c9f
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-12-10 (Mon, 10 Dec 2012)

  Changed paths:
    M hw/pc_piix.c
    M hw/usb.h
    M hw/usb/bus.c
    M hw/usb/core.c
    M hw/usb/dev-hid.c
    M hw/usb/dev-hub.c
    M hw/usb/dev-network.c
    M hw/usb/dev-wacom.c
    M hw/usb/hcd-ehci.c
    M hw/usb/hcd-ehci.h
    M hw/usb/host-bsd.c
    M hw/usb/host-linux.c
    M hw/usb/redirect.c

  Log Message:
  -----------
  Merge remote-tracking branch 'kraxel/usb.74' into staging

* kraxel/usb.74:
  usb-tablet: Allow connecting to ehci
  ehci: Lower timer freq when the periodic schedule is idle
  usb: Allow overriding of usb_desc at the device level
  usb: Don't allow USB_RET_ASYNC for interrupt packets
  usb: Call wakeup when data becomes available for all devices with int e=
ps
  add pc-1.4

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 16ef55ca85ac8c8fcac46547108bd1c8b44943a2
      https://github.com/qemu/qemu/commit/16ef55ca85ac8c8fcac46547108bd1c=
8b44943a2
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-12-10 (Mon, 10 Dec 2012)

  Changed paths:
    M fsdev/virtfs-proxy-helper.c

  Log Message:
  -----------
  Merge remote-tracking branch 'aneesh/for-upstream' into staging

* aneesh/for-upstream:
  virtfs-proxy-helper: use setresuid and setresgid

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 8385b173a0ca4c2345434104e6cc2a7259adc4b9
      https://github.com/qemu/qemu/commit/8385b173a0ca4c2345434104e6cc2a7=
259adc4b9
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-12-10 (Mon, 10 Dec 2012)

  Changed paths:
    M hw/acpi.c
    M hw/acpi.h
    M hw/acpi_ich9.c
    M hw/acpi_ich9.h
    M hw/acpi_piix4.c
    M hw/ich9.h
    M hw/lpc_ich9.c
    M hw/pm_smbus.c
    M hw/pm_smbus.h
    M hw/smbus_ich9.c
    M hw/vt82c686.c

  Log Message:
  -----------
  Merge remote-tracking branch 'kraxel/acpi.1' into staging

* kraxel/acpi.1:
  acpi: drop debug port
  q35: update lpc pci config space according to configured devices
  apci: switch piix4 pci hotplug to memory api
  acpi: remove acpi_gpe_blk
  apci: switch piix4 gpe to memory api
  acpi: fix piix4 smbus mapping
  acpi: switch smbus to memory api
  acpi: cleanup ich9 memory region
  apci: switch ich9 smi to memory api
  apci: switch ich9 gpe to memory api
  acpi: cleanup vt82c686 memory region
  acpi: cleanup piix4 memory region
  apci: switch evt to memory api
  apci: switch cnt to memory api
  apci: switch timer to memory api
  apci: switch vt82c686 to memory api
  apci: switch ich9 to memory api
  apci: switch piix4 to memory api

Conflicts:
	hw/lpc_ich9.c

Resolved merge conflict due to apm_init adding an argument.

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 7c12fd9b29c6ca2119396f143d84706f2fba6222
      https://github.com/qemu/qemu/commit/7c12fd9b29c6ca2119396f143d84706=
f2fba6222
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-12-10 (Mon, 10 Dec 2012)

  Changed paths:
    M configure
    M hw/a9mpcore.c
    M hw/device-hotplug.c
    M hw/pc_sysfw.c
    M hw/pci-hotplug.c
    M hw/s390x/sclp.h
    M hw/s390x/sclpconsole.c
    M hw/sd.c
    M hw/usb.h
    M net/tap-win32.c
    M qemu-options.hx
    M slirp/ip_icmp.c
    M sysemu.h
    M target-alpha/cpu.h
    M target-m68k/cpu.h
    M target-sparc/cpu.h
    M tcg/tcg.h
    M tests/qemu-iotests/iotests.py
    M uri.c

  Log Message:
  -----------
  Merge remote-tracking branch 'stefanha/trivial-patches' into staging

* stefanha/trivial-patches:
  pc_sysfw: Plug memory leak on pc_fw_add_pflash_drv() error path
  qemu-options: Fix space at EOL
  Fix spelling in comments and documentation
  Clean up pci_drive_hot_add()'s use of BlockInterfaceType
  arm: a9mpcore: remove un-used ptimer_iomem field
  target-sparc: Remove t0, t1 from CPUSPARCState
  target-m68k: Remove t1 from CPUM68KState
  target-alpha: Remove t0, t1 from CPUAlphaState
  s390x: Spelling fixes (endianess -&gt; endianness, occured -&gt; occurred)
  Fix comments (adress -&gt; address, layed -&gt; laid, wierd -&gt; weird)
  Fix spelling (prefered -&gt; preferred)
  configure: Remove stray debug output
  sd: Send debug printfery to stderr not stdout

Conflicts:
	configure

Resolve spelling conflict in configure.

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 1c97e303d4ea80a2691334b0febe87a50660f99d
      https://github.com/qemu/qemu/commit/1c97e303d4ea80a2691334b0febe87a=
50660f99d
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-12-10 (Mon, 10 Dec 2012)

  Changed paths:
    R bsd-user/qemu-types.h
    M bsd-user/qemu.h
    M cpu-all.h
    M hw/qdev-core.h
    M hw/qdev.c
    R linux-user/qemu-types.h
    M linux-user/qemu.h
    M qapi/qmp-registry.c
    M qemu-common.h
    A qemu-types.h
    A qemu-user-types.h
    M qga/channel-posix.c
    M qlist.h
    M sysemu.h
    M target-i386/cpu.c
    M target-i386/cpu.h
    M ui/vnc-palette.c

  Log Message:
  -----------
  Merge remote-tracking branch 'afaerber/qom-cpu' into staging

* afaerber/qom-cpu:
  target-i386: Postpone cpuid_level update to realize time
  target-i386: Use define for cpuid vendor string size
  target-i386: Separate feature string parsing from CPU model lookup
  target-i386/cpu.c: Coding style fixes
  qdev: qdev_create(): use error_report() instead of hw_error()
  sysemu.h: Include qemu-types.h instead of qemu-common.h
  Create qemu-types.h for struct typedefs
  qlist.h: Do not include qemu-common.h
  qga/channel-posix.c: Include headers it needs
  qapi/qmp-registry.c: Include headers it needs
  ui/vnc-palette.c: Include headers it needs
  user: Rename qemu-types.h to qemu-user-types.h
  user: Move *-user/qemu-types.h to main directory

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/e49d021e574c...1c97e303d4ea=


----==_mimepart_50c6151db05d1_73d017b5aec75132--


</body></email><email><emailId>20121211223011</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-11 22:30:11-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 029eae: configure: Fix CONFIG_QEMU_HELPERDIR generation</subject><body>



----==_mimepart_50c7b3f3ab78a_750a11baae85797a
Date: Tue, 11 Dec 2012 14:30:11 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50c7b3f3b0303_750a11baae85803a@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/stable-1.2
  Home:   https://github.com/qemu/qemu
  Commit: 029eae1a7575bcb163f23a3676df1d1c7f7eb709
      https://github.com/qemu/qemu/commit/029eae1a7575bcb163f23a3676df1d1c7f7eb709
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: Fix CONFIG_QEMU_HELPERDIR generation

We need to evaluate $libexecdir in configure, otherwise we literally end
up with "${prefix}/libexec" instead of the absolute path as
CONFIG_QEMU_HELPERDIR.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit 38f419f35225decdbaea9fe1fd00218f8924ce84)

Conflicts:

	configure

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 5a99c8ca011b10bc80f2f91a864e28cdd800e005
      https://github.com/qemu/qemu/commit/5a99c8ca011b10bc80f2f91a864e28cdd800e005
  Author: Michael Tokarev &lt;mjt@tls.msk.ru&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  fix CONFIG_QEMU_HELPERDIR generation again

commit 38f419f35225 fixed a breakage with CONFIG_QEMU_HELPERDIR
which has been introduced by 8bf188aa18ef7a8.  But while techinically
that fix has been correct, all other similar variables are handled
differently.  Make it consistent, and let scripts/create_config
expand and capitalize the variable properly like for all other
qemu_*dir variables.

Signed-off-by: Michael Tokarev &lt;mjt@tls.msk.ru&gt;
(cherry picked from commit f354b1a1ee7a1c72d51b42808724a2b10eec315f)

Conflicts:

	configure

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 0ae18b369cbd7c8bae26193349878bab4c12c3d1
      https://github.com/qemu/qemu/commit/0ae18b369cbd7c8bae26193349878bab4c12c3d1
  Author: Joel Martin &lt;github@martintribe.org&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M ui/vnc.c

  Log Message:
  -----------
  ui/vnc: Only report/use TIGHT_PNG encoding if enabled.

If TIGHT_PNG is not enabled by the --enable-vnc-png configure flag
then do not report to the client that it is supported.

Also, since TIGHT_PNG is the same as the TIGHT encoding but with the
filter/copy replaced with PNG data, adding it to the supported
encodings list when it is disabled will cause the TIGHT encoding to be
used even though the client requested TIGHT_PNG.

Signed-off-by: Joel Martin &lt;github@martintribe.org&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
(cherry picked from commit fe3e7f2dc05225cdd2ba40defcd4e2581bebc5e0)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 5af7caaadd1d11c7f061c914e34a5d917015b733
      https://github.com/qemu/qemu/commit/5af7caaadd1d11c7f061c914e34a5d917015b733
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M ui/vnc.c

  Log Message:
  -----------
  vnc: fix "info vnc" with "-vnc ..., reverse=on"

When reverse connection is in use, there is no active VNC server
socket.  Because of this, getsockopt(-1, ...) is attempted and
the following error is emitted:

    $ socat TCP-LISTEN:5900,reuseaddr TCP-LISTEN:5901,reuseaddr &amp;
    $ x86_64-softmmu/qemu-system-x86_64 -vnc localhost:5900,reverse -monitor stdio
    QEMU 1.2.50 monitor - type 'help' for more information
    (qemu) info vnc
    An undefined error has occurred

Because however the host, family, service and auth fields are
optional, we can just exit if there is no active server socket.

    $ x86_64-softmmu/qemu-system-x86_64 -vnc localhost:5900,reverse -monitor stdio
    QEMU 1.2.50 monitor - type 'help' for more information
    (qemu) info vnc
    Server:
    Client:
   address: 127.0.0.1:5900
      x509_dname: none
  username: none

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
(cherry picked from commit 417b0b88904fe1dd8c41bff8092dfbab0134d9cb)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 85c91ea7e2500d44a8381a6018f3f7e9aab1abe6
      https://github.com/qemu/qemu/commit/85c91ea7e2500d44a8381a6018f3f7e9aab1abe6
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Raise interrupt when requested even for non active tds

According to the spec we must raise an interrupt when one is requested
even for non active tds.

Linux depends on this, for bulk transfers it runs an inactivity timer
to work around a bug in early uhci revisions, when we take longer then
200 ms to process a packet, this timer goes of, and as part of the
handling Linux then unlinks the qh, and relinks it after the frindex
has increased by atleast 1, the problem is Linux only checks for the
frindex increases on an interrupt, and we don't send that, causing
the qh to go inactive for more then 32 frames, at which point we
consider the packet cancelled.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 883bca776daa43111e9c39008f0038f7c62ae723)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 472da83043f72e1730fe93332c55eca357bb6982
      https://github.com/qemu/qemu/commit/472da83043f72e1730fe93332c55eca357bb6982
  Author: Alon Levy &lt;alevy@redhat.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  hw/qxl: qxl_dirty_surfaces: use uintptr_t

As suggested by Paolo Bonzini, to avoid possible integer overflow issues.

Signed-off-by: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit c5825ac6c861bfe1a4adfa27517931b56079e298)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: a106eaa3a6e6303fba80d763e806102fec28c943
      https://github.com/qemu/qemu/commit/a106eaa3a6e6303fba80d763e806102fec28c943
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M hw/qxl-render.c

  Log Message:
  -----------
  qxl: always update displaysurface on resize

Don't try to be clever and skip displaysurface reinitialization in case
the size hasn't changed.  Other parameters might have changed
nevertheless, for example depth or stride, resulting in rendering being
broken then.

Trigger: boot linux guest with vesafb, start X11, make sure both vesafb
and X11 use the display same resolution.  Then watch X11 screen being
upside down.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 0ec8df3974d2a4ff95b5fd4785b9bd3def7252f3)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 4843c928f92f6658e71bc100662be9bb585c7d1b
      https://github.com/qemu/qemu/commit/4843c928f92f6658e71bc100662be9bb585c7d1b
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M cutils.c
    M tests/rtc-test.c

  Log Message:
  -----------
  rtc: fix overflow in mktimegm

When setting a date in 1980, Linux is actually disregarding the century
byte and setting the year to 2080.  This causes a year-2038 overflow
in mktimegm.  Fix this by doing the days-to-seconds computation in
64-bit math.

Reported-by: Lucas Meneghel Rodrigues &lt;lookkas@gmail.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit b6db4aca20e9af4f62c9c9e08b9b9672a6ed3390)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: eb63b0c2da53caf1681ca0123a4e0aa893ffe238
      https://github.com/qemu/qemu/commit/eb63b0c2da53caf1681ca0123a4e0aa893ffe238
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M hw/nand.c
    M hw/onenand.c
    M hw/sd.c

  Log Message:
  -----------
  hw: Fix return value check for bdrv_read, bdrv_write

Those functions return -errno in case of an error.
The old code would typically only detect EPERM (1) errors.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;
(cherry picked from commit 7a608f562ebd91e811ed0b725e528c894e4f19c4)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 3dfbc51e787bbe150273595ef526167842fd94ec
      https://github.com/qemu/qemu/commit/3dfbc51e787bbe150273595ef526167842fd94ec
  Author: Don Slutz &lt;Don@CloudSwitch.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: Allow tsc-frequency to be larger then 2.147G

The check using INT_MAX (2147483647) is wrong in this case.

Signed-off-by: Fred Oliveira &lt;foliveira@cloudswitch.com&gt;
Signed-off-by: Don Slutz &lt;Don@CloudSwitch.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;
(cherry picked from commit 2e84849aa2cc7f220d3b3668f5f7e3c57bb1b590)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: e16d81df85ec6e66364770cdb5e2737b0586961c
      https://github.com/qemu/qemu/commit/e16d81df85ec6e66364770cdb5e2737b0586961c
  Author: Dmitry Fleytman &lt;dmitry@daynix.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M hw/e1000.c

  Log Message:
  -----------
  e1000: drop check_rxov, always treat RX ring with RDH == RDT as empty

Real HW always treats RX ring with RDH == RDT as empty.
Emulation is supposed to behave the same.

Reported-by: Chris Webb &lt;chris.webb@elastichosts.com&gt;
Reported-by: Richard Davies &lt;richard.davies@elastichosts.com&gt;
Signed-off-by: Dmitry Fleytman &lt;dmitry@daynix.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
(cherry picked from commit e5b8b0d4ba29fe1268ba049519a1b0cf8552a21a)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 0dfd8215c2d7023436e4bd25b68d6f00d83702e6
      https://github.com/qemu/qemu/commit/0dfd8215c2d7023436e4bd25b68d6f00d83702e6
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M memory.c

  Log Message:
  -----------
  memory: fix rendering of a region obscured by another

The memory core drops regions that are hidden by another region (for example,
during BAR sizing), but it doesn't do so correctly if the lower address of the
existing range is below the lower address of the new range.

Example (qemu-system-mips -M malta -kernel vmlinux-2.6.32-5-4kc-malta
   -append "console=ttyS0"  -nographic -vga cirrus):

Existing range: 10000000-107fffff
New range:      100a0000-100bffff

Correct behaviour: drop new range
Incorrect behaviour: add new range

Fix by taking this case into account (previously we only considered
equal lower boundaries).

Tested-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit d26a8caea3f160782841efb87b5e8bea606b512b)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 7817b8d858852adb2ae93f2af8c7f2a1198f4f61
      https://github.com/qemu/qemu/commit/7817b8d858852adb2ae93f2af8c7f2a1198f4f61
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M hw/s390-virtio.c

  Log Message:
  -----------
  s390x: fix -initrd in virtio machine

When using -initrd in the virtio machine, we need to indicate the initrd
start and size inside the kernel image. These parameters need to be stored
in native endianness.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
Acked-by: Richard Henderson &lt;rth@twiddle.net&gt;
Acked-by: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
(cherry picked from commit 235a3f0bed3584fe65079ffa07c7a842971f261e)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: db6e5ab78efd1d0c07945fcff6f42e9acb8929ed
      https://github.com/qemu/qemu/commit/db6e5ab78efd1d0c07945fcff6f42e9acb8929ed
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M hw/ppc440_bamboo.c

  Log Message:
  -----------
  PPC: Bamboo: Fix memory size DT property

Device tree properties need to be specified in big endian. Fix the
bamboo memory size property accordingly.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
CC: qemu-stable@nongnu.org
(cherry picked from commit 5232fa59b17b45c04bd24e0d38224964816bf391)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 03e044136ae6c595fec63dd21be39dbf12a24eca
      https://github.com/qemu/qemu/commit/03e044136ae6c595fec63dd21be39dbf12a24eca
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M default-configs/sparc64-softmmu.mak

  Log Message:
  -----------
  target-sparc64: disable VGA cirrus

OpenBIOS on sparc64 only support Standard VGA and not Cirrus VGA. Don't
build Cirrus VGA support so that it can't be selected.

This fixes the breakage introduced by commit f2898771.

Reported-by: Richard Henderson &lt;rth@twiddle.net&gt;
Cc: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Tested-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
(cherry picked from commit 0356404b0f1da939657cad1efeb556745cd430d5)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 3dd59b4dc77847d78d04c4cfe03d9bd574ff5918
      https://github.com/qemu/qemu/commit/3dd59b4dc77847d78d04c4cfe03d9bd574ff5918
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: fix usb name in caps

Used to be "UTB" not "USB".

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 0ebfb144e8ad3f2da436d630fdcc5aa9ab646341)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 5c0d5aebd5c9cf445fb71e01ee56efad094248f5
      https://github.com/qemu/qemu/commit/5c0d5aebd5c9cf445fb71e01ee56efad094248f5
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M qemu-img.c
    M qemu-io.c

  Log Message:
  -----------
  tools: initialize main loop before block layer

Tools were broken because they initialized the block layer while
qemu_aio_context was still NULL.

Reported-by: malc &lt;av1474@comtv.ru&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;
(cherry picked from commit 2592c59a66d456fe98fe96cb5787b356c40ee66f)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 382a582c1f4c1877968d73751dd2f1206547eda4
      https://github.com/qemu/qemu/commit/382a582c1f4c1877968d73751dd2f1206547eda4
  Author: Meador Inge &lt;meadori@codesourcery.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M target-m68k/m68k-semi.c

  Log Message:
  -----------
  m68k: Return semihosting errno values correctly

Fixing a simple typo, s/errno/err/, that caused
the error status from GDB semihosted system calls
to be returned incorrectly.

Signed-off-by: Meador Inge &lt;meadori@codesourcery.com&gt;
Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
(cherry picked from commit aed91c1bff5e568c7b0fbd0e1e7e2f9e62409e73)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 879c2648038863c30587411f90b142de05e12a3b
      https://github.com/qemu/qemu/commit/879c2648038863c30587411f90b142de05e12a3b
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M nbd.c

  Log Message:
  -----------
  nbd: fixes to read-only handling

We do not need BLKROSET if the kernel supports setting flags.
Also, always do BLKROSET even for a read-write export, otherwise
the read-only state remains "sticky" after the invocation of
"qemu-nbd -r".

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
(cherry picked from commit c8969eded252058e90e91f12f75f32aceae46ec9)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: f6b803df744f3b8fafd69fa8e8e0588ffd75f4ac
      https://github.com/qemu/qemu/commit/f6b803df744f3b8fafd69fa8e8e0588ffd75f4ac
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M hw/mips_malta.c

  Log Message:
  -----------
  mips/malta: fix CBUS UART interrupt pin

According to the MIPS Malta Developement Platform User's Manual, the
i8259 interrupt controller is supposed to be connected to the hardware
IRQ0, and the CBUS UART to the hardware interrupt 2.

In QEMU they are both connected to hardware interrupt 0, the CBUS UART
interrupt being wrong. This patch fixes that. It should be noted that
the irq array in QEMU includes the software interrupts, hence
env-&gt;irq[2] is the first hardware interrupt.

Cc: Ralf Baechle &lt;ralf@linux-mips.org&gt;
Reviewed-by: Eric Johnson &lt;ericj@mips.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit 68d001928b151a0c50f367c0bdca645b3d5e9ed3)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 357414daa4915fb2312fff2af2d4ef28147f3eeb
      https://github.com/qemu/qemu/commit/357414daa4915fb2312fff2af2d4ef28147f3eeb
  Author: é³éä»» (Wei-Ren Chen) &lt;chenwj@iis.sinica.edu.tw&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: fix wrong microMIPS opcode encoding

While reading microMIPS decoding, I found a possible wrong opcode
encoding. According to [1] page 166, the bits 13..12 for MULTU is
0x01 rather than 0x00. Please review, thanks.

[1] MIPS Architecture for Programmers VolumeIV-e: The MIPS DSP
    Application-Specific Extension to the microMIPS32 Architecture

Signed-off-by: Chen Wei-Ren &lt;chenwj@iis.sinica.edu.tw&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit 6801038bc52d61f81ac8a25fbe392f1bad982887)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ac914c1fc2f6981282e179f408d5e6af589595b8
      https://github.com/qemu/qemu/commit/ac914c1fc2f6981282e179f408d5e6af589595b8
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M tcg/arm/tcg-target.c

  Log Message:
  -----------
  tcg/arm: fix TLB access in qemu-ld/st ops

The TCG arm backend considers likely that the offset to the TLB
entries does not exceed 12 bits for mem_index = 0. In practice this is
not true for at least the MIPS target.

The current patch fixes that by loading the bits 23-12 with a separate
instruction, and using loads with address writeback, independently of
the value of mem_idx. In total this allow a 24-bit offset, which is a
lot more than needed.

Cc: Andrzej Zaborowski &lt;balrogg@gmail.com&gt;
Cc: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Cc: qemu-stable@nongnu.org
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit d17bd1d8cc27f8c1a24c65f555a77a661c332b7f)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ede76edace43dcc940e1dfaa3f5be5fe485b7254
      https://github.com/qemu/qemu/commit/ede76edace43dcc940e1dfaa3f5be5fe485b7254
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M tcg/arm/tcg-target.c

  Log Message:
  -----------
  tcg/arm: fix cross-endian qemu_st16

The bswap16 TCG opcode assumes that the high bytes of the temp equal
to 0 before calling it. The ARM backend implementation takes this
assumption to slightly optimize the generated code.

The same implementation is called for implementing the cross-endian
qemu_st16 opcode, where this assumption is not true anymore. One way to
fix that would be to zero the high bytes before calling it. Given the
store instruction just ignore them, it is possible to provide a slightly
more optimized version. With ARMv6+ the rev16 instruction does the work
correctly. For lower ARM versions the patch provides a version which
behaves correctly with non-zero high bytes, but fill them with junk.

Cc: Andrzej Zaborowski &lt;balrogg@gmail.com&gt;
Cc: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Cc: qemu-stable@nongnu.org
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit 7aab08aa786e3a8838beac758ee61c5000144937)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 4a8e490cbc15ad3fd88180ebff016cdd56242987
      https://github.com/qemu/qemu/commit/4a8e490cbc15ad3fd88180ebff016cdd56242987
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M target-openrisc/cpu.h

  Log Message:
  -----------
  target-openrisc: remove conflicting definitions from cpu.h

On an ARM host, the registers definitions from cpu.h clash
with /usr/include/sys/ucontext.h. As there are unused, just remove
them.

Cc: Jia Liu &lt;proljc@gmail.com&gt;
Cc: qemu-stable@nongnu.org
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit 44e04d3b945ba6f5cc87e65192081da4783f73fa)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ea79e157c61eb20e1065836f9d2719ffef91b8cf
      https://github.com/qemu/qemu/commit/ea79e157c61eb20e1065836f9d2719ffef91b8cf
  Author: Bruce Rogers &lt;brogers@suse.com&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: avoid compiler warning in pipe2 detection

When building qemu-kvm for openSUSE:Factory, I am getting a
warning in the pipe2 detection performed by configure, which
prevents using --enable-werror.

Change detection code to use return value of pipe2.

Signed-off-by: Bruce Rogers &lt;brogers@suse.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
(cherry picked from commit 9bca81624ef9299b9a06013fd29cd6899079aab4)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 600a9efdb1ddb749332200cab27d9240fbc0bda1
      https://github.com/qemu/qemu/commit/600a9efdb1ddb749332200cab27d9240fbc0bda1
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M block/qcow2-refcount.c

  Log Message:
  -----------
  qcow2: Fix refcount table size calculation

A missing factor for the refcount table entry size in the calculation
could mean that too little memory was allocated for the in-memory
representation of the table, resulting in a buffer overflow.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Reviewed-by: Michael Tokarev &lt;mjt@tls.msk.ru&gt;
Tested-by: Michael Tokarev &lt;mjt@tls.msk.ru&gt;
(cherry picked from commit a3548077062dd9dc2701ebffd931ba6eaef40bec)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 38c6d17e75f83363ef92582dd366a4b1d936dc2f
      https://github.com/qemu/qemu/commit/38c6d17e75f83363ef92582dd366a4b1d936dc2f
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M tci.c

  Log Message:
  -----------
  tci: Fix type of tci_read_label

Fixes the pointer truncation that was occurring for branches.

Cc: Stefan Weil &lt;sw@weilnetz.de&gt;
Cc: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Reviewed-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Tested-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
(cherry picked from commit c6c5063c7a5bb1d3fe6b9931a1ec15294e39b8b1)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 4fb9656b9d62ce348656a7184ac7861d70c490a7
      https://github.com/qemu/qemu/commit/4fb9656b9d62ce348656a7184ac7861d70c490a7
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M block.c

  Log Message:
  -----------
  block: Fix regression for MinGW (assertion caused by short string)

The local string tmp_filename is passed to function get_tmp_filename
which expects a string with minimum size MAX_PATH for w32 hosts.

MAX_PATH is 260 and PATH_MAX is 259, so tmp_filename was too short.

Commit eba25057b9a5e19d10ace2bc7716667a31297169 introduced this
regression.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
(cherry picked from commit 89c9bc3d147fdaa932db99b0463b4af1d3e7cda1)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 5e19e498b4b2a31c985dc96b1aff078c34e40488
      https://github.com/qemu/qemu/commit/5e19e498b4b2a31c985dc96b1aff078c34e40488
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M qom/object.c

  Log Message:
  -----------
  qom: dynamic_cast of NULL is always NULL

Trying to cast a NULL value will cause a crash.  Returning
NULL is also sensible, and it is also what the type-unsafe
DO_UPCAST macro does.

Reported-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit b7f43fe46029d8fd0594cd599fa2599dcce0f553)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: a99cb0d20a4868a31f294f5d1fd4fa3225ea70ab
      https://github.com/qemu/qemu/commit/a99cb0d20a4868a31f294f5d1fd4fa3225ea70ab
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M hw/pci-hotplug.c

  Log Message:
  -----------
  hmp: do not crash on invalid SCSI hotplug

Commit 0d93692 (qdev: Convert busses to QEMU Object Model, 2012-05-02)
removed a check on the type of the bus where a SCSI disk is hotplugged.
However, hot-plugging to the wrong kind of device now causes a crash
due to either a NULL pointer dereference (avoided by the previous patch)
or a failed QOM cast.

Instead, in this case we need to use object_dynamic_cast and check for
the result, similar to what was done before that commit.

Reported-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit b5007bcc9729acd995518c52eb1038c4d8416b5d)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 0aad8f1a49fe49b15858978a03b4adead669ff6d
      https://github.com/qemu/qemu/commit/0aad8f1a49fe49b15858978a03b4adead669ff6d
  Author: Julio Guerra &lt;guerr@julio.in&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M target-ppc/translate.c

  Log Message:
  -----------
  PPC: Fix missing TRACE exception

This patch fixes bug 1031698 :
https://bugs.launchpad.net/qemu/+bug/1031698

If we look at the (truncated) translation of the conditional branch
instruction in the test submitted in the bug post, the call to the
exception helper is missing in the "bne-false" chunk of translated
code :

IN:
bne-    0x1800278

OUT:
0xb544236d:  jne    0xb5442396

0xb5442373:  mov    %ebp,(%esp)
0xb5442376:  mov    $0x44,%ebx
0xb544237b:  mov    %ebx,0x4(%esp)
0xb544237f:  mov    $0x1800278,%ebx
0xb5442384:  mov    %ebx,0x25c(%ebp)
0xb544238a:  call   0x827475a
               ^^^^^^^^^^^^^^^^^^

0xb5442396:  mov    %ebp,(%esp)
0xb5442399:  mov    $0x44,%ebx
0xb544239e:  mov    %ebx,0x4(%esp)
0xb54423a2:  mov    $0x1800270,%ebx
0xb54423a7:  mov    %ebx,0x25c(%ebp)

Indeed, gen_exception(ctx, excp) called by gen_goto_tb (called by
gen_bcond) changes ctx-&gt;exception's value to excp's :

gen_bcond()
{
  gen_goto_tb(ctx, 0, ctx-&gt;nip + li - 4);
  /* ctx-&gt;exception value is POWERPC_EXCP_BRANCH */

  gen_goto_tb(ctx, 1, ctx-&gt;nip);
  /* ctx-&gt;exception now value is POWERPC_EXCP_TRACE */
}

Making the following gen_goto_tb()'s test false during the second call :

if ((ctx-&gt;singlestep_enabled &amp;
    (CPU_BRANCH_STEP | CPU_SINGLE_STEP)) &amp;&amp;
    ctx-&gt;exception == POWERPC_EXCP_BRANCH /* false...*/) {
   target_ulong tmp = ctx-&gt;nip;
   ctx-&gt;nip = dest;
   /* ... and this is the missing call */
   gen_exception(ctx, POWERPC_EXCP_TRACE);
   ctx-&gt;nip = tmp;
}

So the patch simply adds the missing matching case, fixing our problem.

Signed-off-by: Julio Guerra &lt;guerr@julio.in&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
(cherry picked from commit f0cc4aa8450376ca2aee3ebb09db71f9f2ff333b)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: f05a3da4e00d24c4540811e6fff2c4f0484771bd
      https://github.com/qemu/qemu/commit/f05a3da4e00d24c4540811e6fff2c4f0484771bd
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M qom/object.c

  Log Message:
  -----------
  qom: fix refcount of non-heap-allocated objects

The reference count for embedded objects is always one too low, because
object_initialize_with_type returns with zero references to the object.
This causes premature finalization of the object (or an assertion failure)
after calling object_ref to add an extra reference and object_unref to
remove it.

The fix is to move the initial object_ref call from object_new_with_type
to object_initialize_with_type.

Acked-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 764b63125a77dab54ed405d493452a4e05679c2e)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 54c6c5a35d8bd57b320bbba8b85604018004bd13
      https://github.com/qemu/qemu/commit/54c6c5a35d8bd57b320bbba8b85604018004bd13
  Author: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M qapi/qapi-dealloc-visitor.c

  Log Message:
  -----------
  qapi: handle visitor-&gt;type_size() in QapiDeallocVisitor

visit_type_size() requires either visitor-&gt;type_size() or
visitor_uint64() to be implemented, otherwise a NULL function pointer is
invoked.

It is possible to trigger this crash as follows:

  $ qemu-system-x86_64 -netdev tap,sndbuf=0,id=netdev0 \
                 -device virtio-blk-pci,netdev=netdev0

The 'sndbuf' option has type "size".

Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Reviewed-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 0c26f2eca40d6c65ea9edc62a10e510dc7f65cc8)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ffffff01466a0180de7632842cf583c8a9cbf959
      https://github.com/qemu/qemu/commit/ffffff01466a0180de7632842cf583c8a9cbf959
  Author: Bruce Rogers &lt;brogers@suse.com&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M qapi/qapi-dealloc-visitor.c

  Log Message:
  -----------
  qapi: fix qapi_dealloc_type_size parameter type

The second parameter to qapi_dealloc_type_size should be a uint64_t *,
not a size_t *. This was causing our 32 bit x86 build to fail, since
warnings are treated as errors.

Signed-off-by: Bruce Rogers &lt;brogers@suse.com&gt;
Reviewed-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Reviewed-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
(cherry picked from commit 1d16252652688a775b244fffa1b9ac9b719ceffc)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 972a2bf07287e4a9a4a7bd03d4e9af5d4259baef
      https://github.com/qemu/qemu/commit/972a2bf07287e4a9a4a7bd03d4e9af5d4259baef
  Author: Peter Lieven &lt;pl@dlhnet.de&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M block/iscsi.c

  Log Message:
  -----------
  iscsi: fix segfault in url parsing

If an invalid URL is specified iscsi_get_error(iscsi) is called
with iscsi == NULL.

Signed-off-by: Peter Lieven &lt;pl@kamp.de&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
(cherry picked from commit 8da1e18b0cf46b6c95c88bbad1cc50d6dd1bef4b)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 707f2b69ff97820f345e509f68155e265c7e45a4
      https://github.com/qemu/qemu/commit/707f2b69ff97820f345e509f68155e265c7e45a4
  Author: Peter Lieven &lt;pl@dlhnet.de&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M block/iscsi.c

  Log Message:
  -----------
  iscsi: fix deadlock during login

If the connection is interrupted before the first login is successfully
completed qemu-kvm is waiting forever in qemu_aio_wait().

This is fixed by performing an sync login to the target. If the
connection breaks after the first successful login errors are
handled internally by libiscsi.

Signed-off-by: Peter Lieven &lt;pl@kamp.de&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
(cherry picked from commit e829b0bb054ed3389e5b22dad61875e51674e629)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: cef2566953b967f8ff79ef6305c92728a795fdac
      https://github.com/qemu/qemu/commit/cef2566953b967f8ff79ef6305c92728a795fdac
  Author: Peter Lieven &lt;pl@dlhnet.de&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M block/iscsi.c

  Log Message:
  -----------
  iscsi: do not assume device is zero initialized

Without any complex checks we can't assume that an
iscsi target is initialized to zero.

Signed-off-by: Peter Lieven &lt;pl@kamp.de&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
(cherry picked from commit f807ecd5741325fe0d281199ff22cdda0acb6a7a)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ea08f3a4e25fe76d42a186152949516c2a63a46b
      https://github.com/qemu/qemu/commit/ea08f3a4e25fe76d42a186152949516c2a63a46b
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M hw/virtio-scsi.c

  Log Message:
  -----------
  virtio-scsi: Fix some endian bugs with virtio-scsi

The virtio-scsi specification does not specify the correct endianness for
fields in the request structure.  It's therefore best to assume that it is
"guest native" endian since that's the (stupid and poorly defined) norm in
virtio.

However, the qemu device for virtio-scsi has no byteswaps at all, and so
will break if the guest has different endianness from the host.  This patch
fixes it by adding tswap() calls for the sense_len and resid fields in
the request structure.  In theory status_qualifier needs swaps as well,
but that field is never actually touched.  The tag field is a uint64_t, but
since its value is completely arbitrary, it might as well be uint8_t[8]
and so it does not need swapping.

Cc: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Cc: Paul 'Rusty' Russell &lt;rusty@rustcorp.com.au&gt;
Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
(cherry picked from commit 474ee55a18765e7de8f0b2cc00db5d26286bb24d)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: bf47da47dbcbf2c90119ba0bd45560d5b2f1dd13
      https://github.com/qemu/qemu/commit/bf47da47dbcbf2c90119ba0bd45560d5b2f1dd13
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M hw/virtio-scsi.c

  Log Message:
  -----------
  virtio-scsi: Fix subtle (guest) endian bug

The virtio-scsi config space is, by specification, in guest endian (which
is ill-defined, but there you go).  In virtio_scsi_get_config() we set up
all the fields in there, using stl_raw().  Which is a problem for the
max_channel and max_target fields, which are 16-bit, not 32-bit.  For
little-endian targets we get away with it by accident, since the first
two bytes will still be correct, and the extra two bytes written (with
zeroes) will be overwritten correctly by the next store.

But for big-endian guests, this means the max_target field ends up as zero,
which means the guest will only recognize a single disk on the virtio-scsi
bus.  This patch fixes the problem.

Cc: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Cc: Paul 'Rusty' Russell &lt;rusty@rustcorp.com.au&gt;
Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
(cherry picked from commit 863d1050c96cff91dd478767c0da9cc288575919)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 8c9283c82a8428018b2e43c5f5381a99d1648d4b
      https://github.com/qemu/qemu/commit/8c9283c82a8428018b2e43c5f5381a99d1648d4b
  Author: Yonit Halperin &lt;yhalperi@redhat.com&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  qxl: reload memslots after migration, when qxl is in UNDEFINED mode

The devram memslot stays active when qxl enters UNDEFINED mode (i.e, no
primary surface). If migration has occurred while the device is in
UNDEFINED stae, the memslots have to be reloaded at the destination.

Fixes rhbz#874574

Signed-off-by: Yonit Halperin &lt;yhalperi@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit fa98efe932d93a15ffa867f3b05149c8d1fc7c28)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: cd00334f1ae587aee146517af295adbfd7ab702a
      https://github.com/qemu/qemu/commit/cd00334f1ae587aee146517af295adbfd7ab702a
  Author: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M hw/usb/bus.c

  Log Message:
  -----------
  usb: fail usbdevice_create() when there is no USB bus

Report an error instead of segfaulting when attaching a USB device to a
machine with no USB busses:

  $ qemu-system-arm -machine vexpress-a9 \
      -sd Fedora-17-armhfp-vexpress-mmcblk0.img \
      -kernel vmlinuz-3.4.2-3.fc17.armv7hl \
      -initrd initramfs-3.4.2-3.fc17.armv7hl.img \
      -usbdevice disk:format=raw:test.img

Note that the vexpress-a9 machine does not have a USB host controller.

Reported-by: David Abdurachmanov &lt;David.Abdurachmanov@cern.ch&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit c128d6a6d785eb9235a4f6dbd52f405ab8c60bee)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 178ef3a43ad24d074c683e2fe0658e589747c823
      https://github.com/qemu/qemu/commit/178ef3a43ad24d074c683e2fe0658e589747c823
  Author: Dietmar Maurer &lt;dietmar@proxmox.com&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M include/qemu/ratelimit.h

  Log Message:
  -----------
  stream: fix ratelimit_set_speed

The formula to compute slice_quota was wrong since commit 6ef228fc.

Signed-off-by: Dietmar Maurer &lt;dietmar@proxmox.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
(cherry picked from commit e3980e28bb888bf643054770452998d1b4319609)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: e1a0ffb95728304f962ce36b27dcd3a16f04a05d
      https://github.com/qemu/qemu/commit/e1a0ffb95728304f962ce36b27dcd3a16f04a05d
  Author: Michael Contreras &lt;michael@inetric.com&gt;
  Date:   2012-12-03 (Mon, 03 Dec 2012)

  Changed paths:
    M hw/e1000.c

  Log Message:
  -----------
  e1000: Discard packets that are too long if !SBP and !LPE

The e1000_receive function for the e1000 needs to discard packets longer than
1522 bytes if the SBP and LPE flags are disabled. The linux driver assumes
this behavior and allocates memory based on this assumption.

Signed-off-by: Michael Contreras &lt;michael@inetric.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit b0d9ffcd0251161c7c92f94804dcf599dfa3edeb)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ff0245dea25937a93878069b15eee245344eb6b9
      https://github.com/qemu/qemu/commit/ff0245dea25937a93878069b15eee245344eb6b9
  Author: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M VERSION

  Log Message:
  -----------
  update VERSION for v1.2.2

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/f4c53d94d253...ff0245dea259

----==_mimepart_50c7b3f3ab78a_750a11baae85797a--


</body></email><email><emailId>20121211223020</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-11 22:30:20-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu]</subject><body>



----==_mimepart_50c7b3fc93d2_2c0e1868ae826926
Date: Tue, 11 Dec 2012 14:30:20 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50c7b3fca436_2c0e1868ae827055@sh2.rs.github.com.mail&gt;

  Branch: refs/tags/v1.2.2
  Home:   https://github.com/qemu/qemu


----==_mimepart_50c7b3fc93d2_2c0e1868ae826926--


</body></email><email><emailId>20121214150017</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-14 15:00:17-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] d28108: vfio-pci: Don't use kvm_irqchip_in_kernel</subject><body>



----==_mimepart_50cb3f00ec5a3_38da1261af016741
Date: Fri, 14 Dec 2012 07:00:17 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50cb3f014a1d_38da1261af016870@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: d281084d3e51f03999d12a506491a0c6f31b40e8
      https://github.com/qemu/qemu/commit/d281084d3e51f03999d12a506491a0c6f31b40e8
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-12-10 (Mon, 10 Dec 2012)

  Changed paths:
    M hw/vfio_pci.c

  Log Message:
  -----------
  vfio-pci: Don't use kvm_irqchip_in_kernel

kvm_irqchip_in_kernel() has an architecture specific meaning, so
we shouldn't be using it to determine whether to enabled KVM INTx
bypass.  kvm_irqfds_enabled() seems most appropriate.  Also use this
to protect our other call to kvm_check_extension() as that explodes
when KVM isn't enabled.

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;
Cc: qemu-stable@nongnu.org


  Commit: ff1562908d1da12362aa9e3f3bfc7ba0da8114a4
      https://github.com/qemu/qemu/commit/ff1562908d1da12362aa9e3f3bfc7ba0da8114a4
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-10 (Mon, 10 Dec 2012)

  Changed paths:
    M pc-bios/acpi-dsdt.aml
    M pc-bios/bios.bin
    A pc-bios/q35-acpi-dsdt.aml
    M roms/seabios

  Log Message:
  -----------
  seabios: update to e8a76b0f225bba5ba9d63ab227e0a37b3beb1059

This patch updates seabios to latest git master.  Changes:

  (1) q35 patches merged.
  (2) some acpi cleanups.
  (3) fixes irq 8 conflict.

(3) makes this a candidate for the stable branch

Cc: qemu-stable@nongnu.org
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 9fe3781f09f94f3ce76e52899bcdeb0d5164dbb1
      https://github.com/qemu/qemu/commit/9fe3781f09f94f3ce76e52899bcdeb0d5164dbb1
  Author: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M tests/test-aio.c

  Log Message:
  -----------
  tests: use aio_poll() instead of aio_flush() in test-aio.c

There has been confusion between various aio wait and flush functions.
It's time to get rid of qemu_aio_flush() but in the aio test cases we
really do want this low-level functionality.

Therefore declare a local wait_for_aio() helper for the test cases.
Drop the aio_flush() test case.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Acked-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 8a805c222caa0e20bf11d2267f726d0bb5917d94
      https://github.com/qemu/qemu/commit/8a805c222caa0e20bf11d2267f726d0bb5917d94
  Author: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M tests/test-thread-pool.c

  Log Message:
  -----------
  tests: avoid qemu_aio_flush() in test-thread-pool.c

We need to eliminate calls to qemu_aio_flush() since the function is
being removed.  Most callers will use bdrv_drain_all() instead but
test-thread-pool.c is lower level.

Since the test uses the global AioContext we can loop on qemu_aio_wait()
to wait for aio and bh activity to complete.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Acked-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: d318aea9325c99b15c87a7c14865386c2fde0d2c
      https://github.com/qemu/qemu/commit/d318aea9325c99b15c87a7c14865386c2fde0d2c
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M block.c

  Log Message:
  -----------
  block: Improve bdrv_aio_co_cancel_em

Instead of waiting for all requests to complete, wait just for the
specific request that should be cancelled.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: c57b6656c3168bccca7f78b3f740e9149893b3da
      https://github.com/qemu/qemu/commit/c57b6656c3168bccca7f78b3f740e9149893b3da
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M async.c
    M block/commit.c
    M block/mirror.c
    M block/stream.c
    M main-loop.c
    M qemu-aio.h

  Log Message:
  -----------
  aio: Get rid of qemu_aio_flush()

There are no remaining users, and new users should probably be
using bdrv_drain_all() in the first place.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 7b272452398135e4f8e48341239705d03c82dae3
      https://github.com/qemu/qemu/commit/7b272452398135e4f8e48341239705d03c82dae3
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M block.c

  Log Message:
  -----------
  block: Factor out bdrv_open_flags

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: f500a6d3c2b9ef0bb06d0080d91d8ed3c1d68f58
      https://github.com/qemu/qemu/commit/f500a6d3c2b9ef0bb06d0080d91d8ed3c1d68f58
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M block.c

  Log Message:
  -----------
  block: Avoid second open for format probing

This fixes problems that are caused by the additional open/close cycle
of the existing format probing, for example related to qemu-nbd without
-t option or file descriptor passing.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: d567e62f98d5789ff4d273b924a0474931c71e8b
      https://github.com/qemu/qemu/commit/d567e62f98d5789ff4d273b924a0474931c71e8b
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M hw/virtio-blk.h
    M hw/virtio-pci.c

  Log Message:
  -----------
  virtio-blk: Remove duplicate property definition

For the virtio-blk device (via virtio-pci) the property "config-wce" is
defined in two places.  First, it's defined from the
DEFINE_VIRTIO_BLK_FEATURES macro, second it's defined directly in
virtio-pci, just two lines above the call to that macro.

The direct definition in virtio-pci.c is broken, since it operates on the
'config_wce' field of VirtIOBlkConf, which is never used anywhere else.
Therefore, this patch removes both the extra property definition and the
redundant field it works on.

Cc: Kevin Wolf &lt;kwolf@redhat.com&gt;
Cc: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Cc: Paul 'Rusty' Russell &lt;rusty@rustcorp.com.au&gt;

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 1fe1fa510aa3d4eb1fb4246d4951ef48e4c949c2
      https://github.com/qemu/qemu/commit/1fe1fa510aa3d4eb1fb4246d4951ef48e4c949c2
  Author: Charles Arnold &lt;carnold@suse.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M block/vpc.c

  Log Message:
  -----------
  block: vpc initialize the uuid footer field

Initialize the uuid field in the footer with a generated uuid.

Signed-off-by: Charles Arnold &lt;carnold@suse.com&gt;
Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 258d2edbcd4bb5d267c96163333820332e1c14fa
      https://github.com/qemu/qemu/commit/258d2edbcd4bb5d267c96163333820332e1c14fa
  Author: Charles Arnold &lt;carnold@suse.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M block/vpc.c

  Log Message:
  -----------
  block: vpc support for ~2 TB disks

The VHD specification allows for up to a 2 TB disk size. The current
implementation in qemu emulates EIDE and ATA-2 hardware which only allows
for up to 127 GB.  This disk size limitation can be overridden by allowing
up to 255 heads instead of the normal 4 bit limitation of 16.  Doing so
allows disk images to be created of up to nearly 2 TB.  This change does
not violate the VHD format specification nor does it change how smaller
disks (ie, &lt;=127GB) are defined.

[Charles Arnold also writes: "In analyzing a 160 GB VHD fixed disk image
created on Windows 2008 R2, it appears that MS is also ignoring the CHS
values in the footer geometry field in whatever driver they use for
accessing the image.  The CHS values are set at 65535,16,255 which
obviously doesn't represent an image size of 160 GB." -- Stefan]

Signed-off-by: Charles Arnold &lt;carnold@suse.com&gt;
Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: c208e8c2d88eea2bbafc2850d8856525637e495d
      https://github.com/qemu/qemu/commit/c208e8c2d88eea2bbafc2850d8856525637e495d
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M block/raw-posix.c

  Log Message:
  -----------
  raw-posix: inline paio_ioctl into hdev_aio_ioctl

clang now warns about an unused function:
  CC    block/raw-posix.o
block/raw-posix.c:707:26: warning: unused function paio_ioctl
[-Wunused-function]
static BlockDriverAIOCB *paio_ioctl(BlockDriverState *bs, int fd,
                   ^
1 warning generated.

because the only use of paio_ioctl() is inside a #if defined(__linux__)
guard and it is static now.

Reported-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 2d0d2837dcf786da415cf4165d37f4ddd684ff57
      https://github.com/qemu/qemu/commit/2d0d2837dcf786da415cf4165d37f4ddd684ff57
  Author: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M blockdev.c
    M blockdev.h
    M hw/boards.h
    M hw/device-hotplug.c
    M hw/highbank.c
    M hw/leon3.c
    M hw/mips_jazz.c
    M hw/pc_sysfw.c
    M hw/puv3.c
    M hw/realview.c
    M hw/s390-virtio.c
    M hw/spapr.c
    M hw/sun4m.c
    M hw/versatilepb.c
    M hw/vexpress.c
    M hw/xilinx_zynq.c
    M vl.c

  Log Message:
  -----------
  Support default block interfaces per QEMUMachine

There are QEMUMachines that have neither IF_IDE nor IF_SCSI as a
default/standard interface to their block devices / drives. Therefore,
this patch introduces a new field default_block_type per QEMUMachine
struct. The prior use_scsi field becomes thereby obsolete and is
replaced through .default_block_type = IF_SCSI.

This patch also changes the default for s390x to IF_VIRTIO and
removes an early hack that converts IF_IDE drives.
Other parties have already claimed interest (e.g. IF_SD for exynos)

To create a sane default, for machines that dont specify a
default_block_type, this patch makes IF_IDE = 0 and IF_NONE = 1.
I checked all users of IF_NONE (blockdev.c and ww/device-hotplug.c)
as well as IF_IDE and it seems that it is ok to change the defines -
in other words, I found no obvious (to me) assumption in the code
regarding IF_NONE==0. IF_NONE is only set if there is an
explicit if=none. Without if=* the interface becomes IF_DEFAULT.

I would suggest to have some additional care, e.g. by letting
this patch sit some days in the block tree.

Based on an initial patch from Einar Lueck &lt;elelueck@de.ibm.com&gt;

Signed-off-by: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
CC: Igor Mitsyanko &lt;i.mitsyanko@samsung.com&gt;
CC: Markus Armbruster &lt;armbru@redhat.com&gt;
CC: Kevin Wolf &lt;kwolf@redhat.com&gt;
Reviewed-by: Alexander Graf &lt;agraf@suse.de&gt;
Acked-by: Igor Mitsyanko &lt;i.mitsyanko@samsung.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 3c42ea66888f149d72d600bab63624b2d849e4bf
      https://github.com/qemu/qemu/commit/3c42ea66888f149d72d600bab63624b2d849e4bf
  Author: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M vl.c

  Log Message:
  -----------
  block: simplify default_drive

Markus Armbruster pointed out that there is only one caller
to default_drive with IF_DEFAULT as a type. Lets get rid
of the block_default_type parameter and adopt the caller
to do the right thing (asking the machine struct).

Signed-off-by: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 71c79813d83b5b45ba934cf995436063da458f66
      https://github.com/qemu/qemu/commit/71c79813d83b5b45ba934cf995436063da458f66
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M block.c
    M block.h
    M blockdev.c
    M qemu-img.c

  Log Message:
  -----------
  block: bdrv_img_create(): add Error ** argument

This commit adds an Error ** argument to bdrv_img_create() and set it
appropriately on error.

Callers of bdrv_img_create() pass NULL for the new argument and still
rely on bdrv_img_create()'s return value. Next commits will change
callers to use the Error object instead.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 9b37525a7dbc4f5eef0023fc92716259a3d94612
      https://github.com/qemu/qemu/commit/9b37525a7dbc4f5eef0023fc92716259a3d94612
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M qemu-img.c

  Log Message:
  -----------
  qemu-img: img_create(): pass Error object to bdrv_img_create()

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: a930091189cedcc0023dd38f705e2a46e530f4a4
      https://github.com/qemu/qemu/commit/a930091189cedcc0023dd38f705e2a46e530f4a4
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M qemu-img.c

  Log Message:
  -----------
  qemu-img: img_create(): drop unneeded goto and ret variable

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 43e17041156ddecac8a7500648e71287ba270c0a
      https://github.com/qemu/qemu/commit/43e17041156ddecac8a7500648e71287ba270c0a
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M blockdev.c

  Log Message:
  -----------
  qmp: qmp_transaction(): pass Error object to bdrv_img_create()

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: cf8f2426c55245f437a91f2fdabbed4ea24e7786
      https://github.com/qemu/qemu/commit/cf8f2426c55245f437a91f2fdabbed4ea24e7786
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M blockdev.c

  Log Message:
  -----------
  qmp: qmp_drive_mirror(): pass Error object to bdrv_img_create()

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: d92ada2202a0730e396304908ff7b870168387d2
      https://github.com/qemu/qemu/commit/d92ada2202a0730e396304908ff7b870168387d2
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M block.c
    M block.h

  Log Message:
  -----------
  block: bdrv_img_create(): drop unused error handling code

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 23e956bfe6af6f71046772478ed08d4e5c9c62d4
      https://github.com/qemu/qemu/commit/23e956bfe6af6f71046772478ed08d4e5c9c62d4
  Author: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    A tests/qemu-iotests/045
    A tests/qemu-iotests/045.out
    M tests/qemu-iotests/group
    M tests/qemu-iotests/iotests.py

  Log Message:
  -----------
  tests: Add tests for fdsets

Signed-off-by: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
Reviewed-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 791bfa35ee00ca10b13bedfb048ffda385b151c7
      https://github.com/qemu/qemu/commit/791bfa35ee00ca10b13bedfb048ffda385b151c7
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M qemu-io.c

  Log Message:
  -----------
  qemu-io: Implement write -c for compressed clusters

This makes it easier to create images with both compressed and
uncompressed clusters for testing.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 473c7f0255920bcaf37411990a3725898772817f
      https://github.com/qemu/qemu/commit/473c7f0255920bcaf37411990a3725898772817f
  Author: Stefan Priebe &lt;s.priebe@profihost.ag&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M block/rbd.c

  Log Message:
  -----------
  rbd: Fix race between aio completition and aio cancel

This one fixes a race which qemu had also in iscsi block driver
between cancellation and io completition.

qemu_rbd_aio_cancel was not synchronously waiting for the end of
the command.

To archieve this it introduces a new status flag which uses
-EINPROGRESS.

Signed-off-by: Stefan Priebe &lt;s.priebe@profihost.ag&gt;
Reviewed-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: fbcad04d6bfdff937536eb23088a01a280a1a3af
      https://github.com/qemu/qemu/commit/fbcad04d6bfdff937536eb23088a01a280a1a3af
  Author: Fabien Chouteau &lt;chouteau@adacore.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M block/raw-win32.c

  Log Message:
  -----------
  Fix error code checking for SetFilePointer() call

An error has occurred if the return value is invalid_set_file_pointer
and getlasterror doesn't return no_error.

Signed-off-by: Fabien Chouteau &lt;chouteau@adacore.com&gt;
Acked-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: bf471f7950e9dc9416747b2774eb712f63afe5a7
      https://github.com/qemu/qemu/commit/bf471f7950e9dc9416747b2774eb712f63afe5a7
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M hw/arm_boot.c
    M hw/exynos4210.c
    M hw/highbank.c

  Log Message:
  -----------
  hw/arm_boot, exynos4210, highbank: Fix secondary boot GIC init

Fix the code in the secondary CPU boot stubs so that it correctly
initialises the GIC rather than relying on bugs or implementation
dependent aspects of the QEMU GIC implementation:
 * set the GIC_PMR.Priority field to all-ones, so that all
   interrupts are passed through. The default of all-zeroes
   means all interrupts are masked, and QEMU only booted because
   of a bug in the priority masking in our GIC implementation.
 * add a barrier after GIC setup and before WFI to ensure that
   GIC config is complete before we go into a possible low power
   state. This isn't needed with the software GIC model but could
   be required when using KVM and executing this code on the
   real hardware CPU.

Note that of the three secondary stub implementations, only
the common generic one needs to support both v6 and v7 DSB
encodings; highbank and exynos4210 will always be v7 CPUs.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Igor Mitsyanko &lt;i.mitsyanko@samsung.com&gt;


  Commit: cad065f18e1ca7694385f42f560da637d4e651b6
      https://github.com/qemu/qemu/commit/cad065f18e1ca7694385f42f560da637d4e651b6
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M hw/arm_gic.c

  Log Message:
  -----------
  hw/arm_gic: Fix comparison with priority mask register

The GIC spec states that only interrupts with higher priority
than the value in the GICC_PMR priority mask register are
passed through to the processor. We were incorrectly allowing
through interrupts with a priority equal to the specified
value: correct the comparison operation to match the spec.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Igor Mitsyanko &lt;i.mitsyanko@samsung.com&gt;


  Commit: ee3f095680e4f578f4f1371a90acc20375b48966
      https://github.com/qemu/qemu/commit/ee3f095680e4f578f4f1371a90acc20375b48966
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M hw/arm_gic_common.c
    M hw/armv7m_nvic.c

  Log Message:
  -----------
  hw/arm_gic_common: Correct GICC_PMR reset value for newer GICs

The GIC architecture specification for v1 and v2 GICs (as found
on the Cortex-A9 and newer) states that the GICC_PMR reset value
is zero; this differs from the 0xf0 reset value used on 11MPCore.
The NVIC is different again in not having a CPU interface; since
we share the GIC code we must force the priority mask field to
allow through all interrupts.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Igor Mitsyanko &lt;i.mitsyanko@samsung.com&gt;


  Commit: 79f5d67e9db35d53b478699393590392f7be03ac
      https://github.com/qemu/qemu/commit/79f5d67e9db35d53b478699393590392f7be03ac
  Author: walimis &lt;walimisdev@gmail.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M hw/xilinx_zynq.c

  Log Message:
  -----------
  xilinx_zynq: Add one variable to avoid overwriting QSPI bus

commit 7b482bcf xilinx_zynq: added QSPI controller

Adds one QSPI controller, which has two spi buses, one is for
spi0, and another is for spi1. But when initializing the spi1
bus, "dev" has been overwrited by the ssi_create_slave_no_init() function,
so that qdev_get_child_bus() returns NULL and the last two m25p80 flashes
won't be attached to the spi1 bus, but to main-system-bus.

Here we add one variable to avoid overwriting.

Signed-off-by: Liming Wang &lt;walimisdev@gmail.com&gt;
Reviewed-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: f47b48fb678581d6ee369cfe26b3513100b7d53e
      https://github.com/qemu/qemu/commit/f47b48fb678581d6ee369cfe26b3513100b7d53e
  Author: Daniel Sangorrin &lt;dsl@ertl.jp&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M hw/arm_gic.c

  Log Message:
  -----------
  hw/arm_gic: fix target CPUs affected by set enable/pending ops

Fix a bug on the ARM GIC model where interrupts are not
set pending on the correct target CPUs when they are
triggered by writes to the Interrupt Set Enable or
Set Pending registers.

Signed-off-by: Daniel Sangorrin &lt;dsl@ertl.jp&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 97331270e50f5858c82a0c6d146da81f5b776535
      https://github.com/qemu/qemu/commit/97331270e50f5858c82a0c6d146da81f5b776535
  Author: Jean-Christophe DUBOIS &lt;jcd@tribudubois.net&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M hw/exynos4210_mct.c

  Log Message:
  -----------
  exynos4210/mct: Avoid infinite loop on non incremental timers

Check for a 0 "distance" value to avoid infinite loop when the
expired FCR timer was not programed with auto-increment.

With this change the behavior is coherent with the same type
of code in the exynos4210_gfrc_restart() function in the same
file.

Linux seems to mostly use this timer with auto-increment
which explain why it is not a problem most of the time.

However other OS might have a problem with this if they
don't use the auto-increment feature.

Signed-off-by: Jean-Christophe DUBOIS &lt;jcd@tribudubois.net&gt;
Reviewed-by: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: c474ced8fe6684265fbb6a3183eb0cbea561409f
      https://github.com/qemu/qemu/commit/c474ced8fe6684265fbb6a3183eb0cbea561409f
  Author: Dong Xu Wang &lt;wdongxu@linux.vnet.ibm.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M qemu-option.c

  Log Message:
  -----------
  qemu-option: opt_set(): split it up into more functions

The new functions are opts_accepts_any() and find_desc_by_name(), which
are also going to be used by qemu_opts_validate() (see next commit).

This also makes opt_set() slightly more readable.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Dong Xu Wang &lt;wdongxu@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: db97ceba1e17db59188e91b66e61bf84a6a71081
      https://github.com/qemu/qemu/commit/db97ceba1e17db59188e91b66e61bf84a6a71081
  Author: Dong Xu Wang &lt;wdongxu@linux.vnet.ibm.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M qemu-option.c

  Log Message:
  -----------
  qemu-option: qemu_opts_validate(): fix duplicated code

Use opts_accepts_any() and find_desc_by_name().

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Dong Xu Wang &lt;wdongxu@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: ad718d01ba0af531d10b0a8685cf5047edfd1891
      https://github.com/qemu/qemu/commit/ad718d01ba0af531d10b0a8685cf5047edfd1891
  Author: Dong Xu Wang &lt;wdongxu@linux.vnet.ibm.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M qemu-option.c

  Log Message:
  -----------
  qemu-option: qemu_opt_set_bool(): fix code duplication

It will set opt-&gt;str in qemu_opt_set_bool, without opt-&gt;str, there
will be some potential bugs.

These are uses of opt-&gt;str, and what happens when it isn't set:

* qemu_opt_get(): returns NULL, which means "not set".  Bug can bite
  when value isn't the default value.

* qemu_opt_parse(): passes NULL to parse_option_bool(), which treats it
  like "on".  Wrong if the value is actually false.  Bug can bite when
  qemu_opts_validate() runs after qemu_opt_set_bool().

* qemu_opt_del(): passes NULL to g_free(), which is just fine.

* qemu_opt_foreach(): passes NULL to the callback, which is unlikely to
  be prepared for it.

* qemu_opts_print(): prints NULL, which crashes on some systems.

* qemu_opts_to_qdict(): passes NULL to qstring_from_str(), which
  crashes.

It also makes qemu_opt_set_bool more readable by using find_desc_by_name
and opts_accepts_any.

It is based on Luiz's patch and uses Markus's comments. Discussions can
be found at:
http://lists.nongnu.org/archive/html/qemu-devel/2012-07/msg02716.html

Signed-off-by: Dong Xu Wang &lt;wdongxu@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: dd39244978627e41a66b98d20eceddb1d7d25def
      https://github.com/qemu/qemu/commit/dd39244978627e41a66b98d20eceddb1d7d25def
  Author: Dong Xu Wang &lt;wdongxu@linux.vnet.ibm.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M qemu-option.c
    M qemu-option.h

  Log Message:
  -----------
  introduce qemu_opts_create_nofail function

While id is NULL, qemu_opts_create can not fail, so ignore
errors is fine.

Signed-off-by: Dong Xu Wang &lt;wdongxu@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: e478b448d7c36046462733ffaeaea0961575790a
      https://github.com/qemu/qemu/commit/e478b448d7c36046462733ffaeaea0961575790a
  Author: Dong Xu Wang &lt;wdongxu@linux.vnet.ibm.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M blockdev.c
    M hw/watchdog.c
    M qemu-config.c
    M qemu-img.c
    M qemu-sockets.c
    M vl.c

  Log Message:
  -----------
  use qemu_opts_create_nofail

We will use qemu_opts_create_nofail function, it can make code
more readable.

Signed-off-by: Dong Xu Wang &lt;wdongxu@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: b83c18e225cf82a21535561270b6dfd86b1c9031
      https://github.com/qemu/qemu/commit/b83c18e225cf82a21535561270b6dfd86b1c9031
  Author: Dong Xu Wang &lt;wdongxu@linux.vnet.ibm.com&gt;
  Date:   2012-12-11 (Tue, 11 Dec 2012)

  Changed paths:
    M qemu-option.c
    M qemu-option.h

  Log Message:
  -----------
  create new function: qemu_opt_set_number

Signed-off-by: Dong Xu Wang &lt;wdongxu@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 312a2ba0eb8ab19646517aeaa785475d3fbcfd51
      https://github.com/qemu/qemu/commit/312a2ba0eb8ab19646517aeaa785475d3fbcfd51
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-12-12 (Wed, 12 Dec 2012)

  Changed paths:
    M block/blkdebug.c

  Log Message:
  -----------
  blkdebug: Allow usage without config file

As soon as new rules can be set during runtime, as introduced by the
next patch, blkdebug makes sense even without a config file.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 9e35542b0fc3871caac15ccd57548b99df2c94b7
      https://github.com/qemu/qemu/commit/9e35542b0fc3871caac15ccd57548b99df2c94b7
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-12-12 (Wed, 12 Dec 2012)

  Changed paths:
    M block/blkdebug.c

  Log Message:
  -----------
  blkdebug: Factor out remove_rule()

The cleanup work to remove a rule depends on the type of the rule. It's
easy for the existing rules as there is no data that must be cleaned up
and is specific to a type yet, but the next patch will change this.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 3c90c65d7adab49a41952ee14e1d65f81355e408
      https://github.com/qemu/qemu/commit/3c90c65d7adab49a41952ee14e1d65f81355e408
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-12-12 (Wed, 12 Dec 2012)

  Changed paths:
    M block/blkdebug.c

  Log Message:
  -----------
  blkdebug: Implement suspend/resume of AIO requests

This allows more systematic AIO testing. The patch adds three new
operations to blkdebug:

 * Setting a "breakpoint" on a blkdebug event. The next request that
   triggers this breakpoint is suspended and is tagged with a name.
   The breakpoint is removed after a request has triggered it.

 * A suspended request (identified by it's tag) can be resumed

 * It's possible to check whether a suspended request with a given
   tag exists. This can be used for waiting for an event.

Ideally, we would instead tag requests right when they are created and
set breakpoints for individual requests. However, at this point the
block layer doesn't allow this easily, and breakpoints that trigger for
any request already allow a lot of useful testing.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 41c695c749b84d40e53e64faadedc0392aaea07e
      https://github.com/qemu/qemu/commit/41c695c749b84d40e53e64faadedc0392aaea07e
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-12-12 (Wed, 12 Dec 2012)

  Changed paths:
    M block.c
    M block.h
    M block_int.h
    M qemu-io.c

  Log Message:
  -----------
  qemu-io: Add AIO debugging commands

This makes the blkdebug suspend/resume functionality available in
qemu-io. Use it like this:

  $ ./qemu-io blkdebug::/tmp/test.qcow2
  qemu-io&gt; break write_aio req_a
  qemu-io&gt; aio_write 0 4k
  qemu-io&gt; blkdebug: Suspended request 'req_a'
  qemu-io&gt; resume req_a
  blkdebug: Resuming request 'req_a'
  qemu-io&gt; wrote 4096/4096 bytes at offset 0
  4 KiB, 1 ops; 0:00:30.71 (133.359788 bytes/sec and 0.0326 ops/sec)

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 67a7a0ebe5ef0f337d5f7e7e618b08c562a55da0
      https://github.com/qemu/qemu/commit/67a7a0ebe5ef0f337d5f7e7e618b08c562a55da0
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-12-12 (Wed, 12 Dec 2012)

  Changed paths:
    M block/qcow2.c

  Log Message:
  -----------
  qcow2: Move BLKDBG_EVENT out of the lock

We want to use these events to suspend requests for testing concurrent
AIO requests. Suspending requests while they are holding the CoMutex is
rather boring for this purpose.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 91d4093dce58e343e2336324794daa93517b86c2
      https://github.com/qemu/qemu/commit/91d4093dce58e343e2336324794daa93517b86c2
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-12-12 (Wed, 12 Dec 2012)

  Changed paths:
    A tests/qemu-iotests/046
    A tests/qemu-iotests/046.out
    M tests/qemu-iotests/group

  Log Message:
  -----------
  qemu-iotests: Test concurrent cluster allocations

This adds some first tests for qcow2's dependency handling when two
parallel write requests access the same cluster.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 7ec81e56edc2b2007ce0ae3982aa5c18af9546ab
      https://github.com/qemu/qemu/commit/7ec81e56edc2b2007ce0ae3982aa5c18af9546ab
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-12-12 (Wed, 12 Dec 2012)

  Changed paths:
    M arch_init.c

  Log Message:
  -----------
  Fix off-by-1 error in RAM migration code

The code for migrating (or savevm-ing) memory pages starts off by creating
a dirty bitmap and filling it with 1s.  Except, actually, because bit
addresses are 0-based it fills every bit except bit 0 with 1s and puts an
extra 1 beyond the end of the bitmap, potentially corrupting unrelated
memory.  Oops.  This patch fixes it.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 45e6cee42b98d10e2e14885ab656541a9ffd5187
      https://github.com/qemu/qemu/commit/45e6cee42b98d10e2e14885ab656541a9ffd5187
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-12-12 (Wed, 12 Dec 2012)

  Changed paths:
    M arch_init.c

  Log Message:
  -----------
  migration: Fix madvise breakage if host and guest have different page sizes

madvise(DONTNEED) will throw away the contents of the whole page at the
given address, even if the given length is less than the page size.  One
can argue about whether that's the correct behaviour, but that's what it's
done for a long time in Linux at least.

That means that the madvise() in ram_load(), on a setup where
TARGET_PAGE_SIZE is smaller than the host page size, can throw away data
in guest pages adjacent to the one it's actually processing right now,
leading to guest memory corruption on an incoming migration.

This patch therefore, disables the madvise() if the host page size is
larger than TARGET_PAGE_SIZE.  This means we don't get the benefits of that
madvise() in this case, but a more complete fix is more difficult to
accomplish.  This at least fixes the guest memory corruption.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Reported-by: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: a7f3d65b65b8c86a5ff0c0abcfefb45e2ec6fe4c
      https://github.com/qemu/qemu/commit/a7f3d65b65b8c86a5ff0c0abcfefb45e2ec6fe4c
  Author: Pavel Hrdina &lt;phrdina@redhat.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M hw/ide/core.c

  Log Message:
  -----------
  atapi: reset cdrom tray statuses on ide_reset

Tray statuses should be also reseted. Some guests may lock the tray
and after reset before any kernel is loaded the tray should be unlocked.

Also if you reset the real computer the tray is closed. We should
do the same in qemu.

Signed-off-by: Pavel Hrdina &lt;phrdina@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 580f5c000809108f51a77ae74709100d32be6ea5
      https://github.com/qemu/qemu/commit/580f5c000809108f51a77ae74709100d32be6ea5
  Author: Antoine Mathys &lt;barsamin@gmail.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M hw/ds1338.c

  Log Message:
  -----------
  hw/ds1338.c: Correct bug in conversion to BCD.

Signed-off-by: Antoine Mathys &lt;barsamin@gmail.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 95c9361598e66de42facdac64e614e3de85186f5
      https://github.com/qemu/qemu/commit/95c9361598e66de42facdac64e614e3de85186f5
  Author: Antoine Mathys &lt;barsamin@gmail.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M hw/ds1338.c

  Log Message:
  -----------
  hw/ds1338.c: Add definitions for various flags in the RTC registers.

Signed-off-by: Antoine Mathys &lt;barsamin@gmail.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 59dda8e05b015471d456177141a7c2eeda3dab14
      https://github.com/qemu/qemu/commit/59dda8e05b015471d456177141a7c2eeda3dab14
  Author: Antoine Mathys &lt;barsamin@gmail.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M hw/ds1338.c

  Log Message:
  -----------
  hw/ds1338.c: Fix handling of HOURS register.

Per the datasheet, the mapping between 12 and 24 hours modes is:
      0      &lt;-&gt;  12   PM
      1-12   &lt;-&gt;  1-12 AM
      13-23  &lt;-&gt;  1-11 PM

Signed-off-by: Antoine Mathys &lt;barsamin@gmail.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: ed3d37d287300b7bcdb4605b921e5ec593afd214
      https://github.com/qemu/qemu/commit/ed3d37d287300b7bcdb4605b921e5ec593afd214
  Author: Antoine Mathys &lt;barsamin@gmail.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M hw/ds1338.c

  Log Message:
  -----------
  hw/ds1338.c: Ensure state is properly initialized.

Signed-off-by: Antoine Mathys &lt;barsamin@gmail.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 996e91f04b9cc55cf246052856abe9189a5a0f28
      https://github.com/qemu/qemu/commit/996e91f04b9cc55cf246052856abe9189a5a0f28
  Author: Antoine Mathys &lt;barsamin@gmail.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M hw/ds1338.c

  Log Message:
  -----------
  hw/ds1338.c: Implement support for the control register.

Signed-off-by: Antoine Mathys &lt;barsamin@gmail.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 871edc5fdba884929102b89d28ff363c94f0822d
      https://github.com/qemu/qemu/commit/871edc5fdba884929102b89d28ff363c94f0822d
  Author: Antoine Mathys &lt;barsamin@gmail.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M hw/ds1338.c

  Log Message:
  -----------
  hw/ds1338.c: Fix handling of DAY (wday) register.

Per the datasheet, the DAY (wday) register is user defined. Implement this.

Signed-off-by: Antoine Mathys &lt;barsamin@gmail.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 1d3afd649bc77aa14bc2741e2da6475822d41c5f
      https://github.com/qemu/qemu/commit/1d3afd649bc77aa14bc2741e2da6475822d41c5f
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M block/qcow2-cluster.c
    M block/qcow2.h

  Log Message:
  -----------
  qcow2: Round QCowL2Meta.offset down to cluster boundary

The offset within the cluster is already present as n_start and this is
what the code uses. QCowL2Meta.offset is only needed at a cluster
granularity.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 593fb83cacf3818a5623f31a6c04c24d87519ad0
      https://github.com/qemu/qemu/commit/593fb83cacf3818a5623f31a6c04c24d87519ad0
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M block/qcow2-cluster.c
    M block/qcow2.h

  Log Message:
  -----------
  qcow2: Introduce Qcow2COWRegion

This makes it easier to address the areas for which a COW must be
performed. As a nice side effect, the COW code in
qcow2_alloc_cluster_link_l2 becomes really trivial.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: cf5c1a231ee99ac21fe8258faf50bb1f65884343
      https://github.com/qemu/qemu/commit/cf5c1a231ee99ac21fe8258faf50bb1f65884343
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M block/qcow2.c

  Log Message:
  -----------
  qcow2: Allocate l2meta dynamically

As soon as delayed COW is introduced, the l2meta struct is needed even
after completion of the request, so it can't live on the stack.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 060bee8943c27d4d53f65570fafaa2559fcd87c3
      https://github.com/qemu/qemu/commit/060bee8943c27d4d53f65570fafaa2559fcd87c3
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M block/qcow2-cluster.c
    M block/qcow2.c
    M block/qcow2.h

  Log Message:
  -----------
  qcow2: Drop l2meta.cluster_offset

There's no real reason to have an l2meta for normal requests that don't
allocate anything. Before we can get rid of it, we must return the host
cluster offset in a different way.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: f50f88b9fea09fef12cc293126cf45dcf0ef600b
      https://github.com/qemu/qemu/commit/f50f88b9fea09fef12cc293126cf45dcf0ef600b
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M block/qcow2-cluster.c
    M block/qcow2.c
    M block/qcow2.h

  Log Message:
  -----------
  qcow2: Allocate l2meta only for cluster allocations

Even for writes to already allocated clusters, an l2meta is allocated,
though it stays effectively unused. After this patch, only allocating
requests still have one. Each l2meta now describes an in-flight request
that writes to clusters that are not yet hooked up in the L2 table.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 280d373579558f73a8b70e329d9a6206933d3809
      https://github.com/qemu/qemu/commit/280d373579558f73a8b70e329d9a6206933d3809
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M block/qcow2-cluster.c
    M block/qcow2.c
    M block/qcow2.h

  Log Message:
  -----------
  qcow2: Enable dirty flag in qcow2_alloc_cluster_link_l2

This is closer to where the dirty flag is really needed, and it avoids
having checks for special cases related to cluster allocation directly
in the writev loop.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 4e95314e2bb7baa64f2a9026df5e2649081b7060
      https://github.com/qemu/qemu/commit/4e95314e2bb7baa64f2a9026df5e2649081b7060
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M block/qcow2.c

  Log Message:
  -----------
  qcow2: Execute run_dependent_requests() without lock

There's no reason for run_dependent_requests() to hold s-&gt;lock, and a
later patch will require that in fact the lock is not held.

Also, before this patch, run_dependent_requests() not only does what its
name suggests, but also removes the l2meta from the list of in-flight
requests. When changing this, it becomes an one-liner, so just inline it
completely.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 226c3c26b9800b7c6a8d3100e1faad6d2b97b0f5
      https://github.com/qemu/qemu/commit/226c3c26b9800b7c6a8d3100e1faad6d2b97b0f5
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M block/qcow2-cluster.c

  Log Message:
  -----------
  qcow2: Factor out handle_dependencies()

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 5a58598090d1349d2bd3e9015e6999dcf87ec5b5
      https://github.com/qemu/qemu/commit/5a58598090d1349d2bd3e9015e6999dcf87ec5b5
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M hw/vfio_pci.c

  Log Message:
  -----------
  qMerge remote-tracking branch 'awilliam/tags/vfio-pci-for-qemu-20121210.0' into staging

vfio-pci: fix kvm disabled path

* awilliam/tags/vfio-pci-for-qemu-20121210.0:
  vfio-pci: Don't use kvm_irqchip_in_kernel

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: aa1246aee2914424f101a7e462bd1393ececef95
      https://github.com/qemu/qemu/commit/aa1246aee2914424f101a7e462bd1393ececef95
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M pc-bios/acpi-dsdt.aml
    M pc-bios/bios.bin
    A pc-bios/q35-acpi-dsdt.aml
    M roms/seabios

  Log Message:
  -----------
  Merge remote-tracking branch 'kraxel/seabios-e8a76b0' into staging

* kraxel/seabios-e8a76b0:
  seabios: update to e8a76b0f225bba5ba9d63ab227e0a37b3beb1059

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: df9330070e671134544f872dc5c027443878b764
      https://github.com/qemu/qemu/commit/df9330070e671134544f872dc5c027443878b764
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M hw/arm_boot.c
    M hw/arm_gic.c
    M hw/arm_gic_common.c
    M hw/armv7m_nvic.c
    M hw/ds1338.c
    M hw/exynos4210.c
    M hw/exynos4210_mct.c
    M hw/highbank.c
    M hw/xilinx_zynq.c

  Log Message:
  -----------
  Merge remote-tracking branch 'pmaydell/arm-devs.next' into staging

* pmaydell/arm-devs.next:
  hw/ds1338.c: Fix handling of DAY (wday) register.
  hw/ds1338.c: Implement support for the control register.
  hw/ds1338.c: Ensure state is properly initialized.
  hw/ds1338.c: Fix handling of HOURS register.
  hw/ds1338.c: Add definitions for various flags in the RTC registers.
  hw/ds1338.c: Correct bug in conversion to BCD.
  exynos4210/mct: Avoid infinite loop on non incremental timers
  hw/arm_gic: fix target CPUs affected by set enable/pending ops
  xilinx_zynq: Add one variable to avoid overwriting QSPI bus
  hw/arm_gic_common: Correct GICC_PMR reset value for newer GICs
  hw/arm_gic: Fix comparison with priority mask register
  hw/arm_boot, exynos4210, highbank: Fix secondary boot GIC init

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: e376a788ae130454ad5e797f60cb70d0308babb6
      https://github.com/qemu/qemu/commit/e376a788ae130454ad5e797f60cb70d0308babb6
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M async.c
    M block.c
    M block.h
    M block/blkdebug.c
    M block/commit.c
    M block/mirror.c
    M block/qcow2-cluster.c
    M block/qcow2.c
    M block/qcow2.h
    M block/raw-posix.c
    M block/raw-win32.c
    M block/rbd.c
    M block/stream.c
    M block/vpc.c
    M block_int.h
    M blockdev.c
    M blockdev.h
    M hw/boards.h
    M hw/device-hotplug.c
    M hw/highbank.c
    M hw/ide/core.c
    M hw/leon3.c
    M hw/mips_jazz.c
    M hw/pc_sysfw.c
    M hw/puv3.c
    M hw/realview.c
    M hw/s390-virtio.c
    M hw/spapr.c
    M hw/sun4m.c
    M hw/versatilepb.c
    M hw/vexpress.c
    M hw/virtio-blk.h
    M hw/virtio-pci.c
    M hw/watchdog.c
    M hw/xilinx_zynq.c
    M main-loop.c
    M qemu-aio.h
    M qemu-config.c
    M qemu-img.c
    M qemu-io.c
    M qemu-option.c
    M qemu-option.h
    M qemu-sockets.c
    A tests/qemu-iotests/045
    A tests/qemu-iotests/045.out
    A tests/qemu-iotests/046
    A tests/qemu-iotests/046.out
    M tests/qemu-iotests/group
    M tests/qemu-iotests/iotests.py
    M tests/test-aio.c
    M tests/test-thread-pool.c
    M vl.c

  Log Message:
  -----------
  Merge remote-tracking branch 'kwolf/for-anthony' into staging

* kwolf/for-anthony: (43 commits)
  qcow2: Factor out handle_dependencies()
  qcow2: Execute run_dependent_requests() without lock
  qcow2: Enable dirty flag in qcow2_alloc_cluster_link_l2
  qcow2: Allocate l2meta only for cluster allocations
  qcow2: Drop l2meta.cluster_offset
  qcow2: Allocate l2meta dynamically
  qcow2: Introduce Qcow2COWRegion
  qcow2: Round QCowL2Meta.offset down to cluster boundary
  atapi: reset cdrom tray statuses on ide_reset
  qemu-iotests: Test concurrent cluster allocations
  qcow2: Move BLKDBG_EVENT out of the lock
  qemu-io: Add AIO debugging commands
  blkdebug: Implement suspend/resume of AIO requests
  blkdebug: Factor out remove_rule()
  blkdebug: Allow usage without config file
  create new function: qemu_opt_set_number
  use qemu_opts_create_nofail
  introduce qemu_opts_create_nofail function
  qemu-option: qemu_opt_set_bool(): fix code duplication
  qemu-option: qemu_opts_validate(): fix duplicated code
  ...

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/1c97e303d4ea...e376a788ae13

----==_mimepart_50cb3f00ec5a3_38da1261af016741--


</body></email><email><emailId>20121215093009</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-15 09:30:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] fbddfc: pixman: fix version check for PIXMAN_TYPE_BGRA</subject><body>



----==_mimepart_50cc4321e9343_43d1175aae8163896
Date: Sat, 15 Dec 2012 01:30:09 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50cc4321eb8cc_43d1175aae81639c2@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: fbddfc727bde692f009a269e8e628d8c152b537b
      https://github.com/qemu/qemu/commit/fbddfc727bde692f009a269e8e628d8c152b537b
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M qemu-pixman.c

  Log Message:
  -----------
  pixman: fix version check for PIXMAN_TYPE_BGRA

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: cb1d40d7ccfc18ba1fcb9e064402d930349ee047
      https://github.com/qemu/qemu/commit/cb1d40d7ccfc18ba1fcb9e064402d930349ee047
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  Revert "pixman: require 0.18.4 or newer"

This reverts commit 288fa40736e6eb63132d01aa6dc21ee831b796ae.

The only reason old pixman versions didn't work was the missing
PIXMAN_TYPE_BGRA, which is properly #ifdef'ed now.  So we don't
have to require a minimum pixman version.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: f27b2e1dfe79f993567652411d1ba16295b99719
      https://github.com/qemu/qemu/commit/f27b2e1dfe79f993567652411d1ba16295b99719
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M pixman

  Log Message:
  -----------
  pixman: update internal copy to pixman-0.28.2

Some w64 fixes by Stefan Weil found their way into 0.28.2,
so update the internal copy to that version to improve
windows support.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: bc210eb163b162ff2e94e5c8f4307715731257f8
      https://github.com/qemu/qemu/commit/bc210eb163b162ff2e94e5c8f4307715731257f8
  Author: Gerd Hoffmann &lt;1087974@bugs.launchpad.net&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/vga.c
    M qemu-pixman.c
    M qemu-pixman.h
    M ui/vnc-enc-tight.c
    M ui/vnc.c

  Log Message:
  -----------
  pixman: fix vnc tight png/jpeg support

This patch adds an x argument to qemu_pixman_linebuf_fill so it can
also be used to convert a partial scanline.  Then fix tight + png/jpeg
encoding by passing in the x+y offset, so the data is read from the
correct screen location instead of the upper left corner.

Cc: 1087974@bugs.launchpad.net
Cc: qemu-stable@nongnu.org
Reported-by: Tim Hardeneck &lt;thardeck@suse.de&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 4b4496dbccc5f286f0ef411f0ff702d67cb95145
      https://github.com/qemu/qemu/commit/4b4496dbccc5f286f0ef411f0ff702d67cb95145
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M console.h

  Log Message:
  -----------
  console: clip update rectangle

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 659f807c0a700317a7a0fae7a6e6ebfe68bfbbc4
      https://github.com/qemu/qemu/commit/659f807c0a700317a7a0fae7a6e6ebfe68bfbbc4
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-12-15 (Sat, 15 Dec 2012)

  Changed paths:
    M target-xtensa/helper.c

  Log Message:
  -----------
  target-xtensa: fix ITLB/DTLB page protection flags

With MMU option xtensa architecture has two TLBs: ITLB and DTLB. ITLB is
only used for code access, DTLB is only for data. However TLB entries in
both TLBs have attribute field controlling write and exec access. These
bits need to be properly masked off depending on TLB type before being
used as tlb_set_page prot argument. Otherwise the following happens:

(1) ITLB entry for some PFN gets invalidated
(2) DTLB entry for the same PFN gets updated, attributes allow code
    execution
(3) code at the page with that PFN is executed (possible due to step 2),
    entry for the TB is written into the jump cache
(4) QEMU TLB entry for the PFN gets replaced with an entry for some
    other PFN
(5) code in the TB from step 3 is executed (possible due to jump cache)
    and it accesses data, for which there's no DTLB entry, causing DTLB
    miss exception
(6) re-translation of the TB from step 5 is attempted, but there's no
    QEMU TLB entry nor xtensa ITLB entry for that PFN, which causes ITLB
    miss exception at the TB start address
(7) ITLB miss exception is handled by the guest, but execution is
    resumed from the beginning of the faulting TB (the point where ITLB
    miss occured), not from the point where DTLB miss occured, which is
    wrong.

With that fix the above scenario causes ITLB miss exception (that used
to be step 7) at step 3, right at the beginning of the TB.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Cc: qemu-stable@nongnu.org
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/e376a788ae13...659f807c0a70

----==_mimepart_50cc4321e9343_43d1175aae8163896--


</body></email><email><emailId>20121215103010</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-15 10:30:10-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 044f4c: pseries: Fix incorrect initialization of interrupt...</subject><body>



----==_mimepart_50cc513251967_436816d8ae8984c7
Date: Sat, 15 Dec 2012 02:30:10 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50cc5132557da_436816d8ae8985cb@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 044f4c8b0ee90290b6cbbc616c4be3c8aeffcaab
      https://github.com/qemu/qemu/commit/044f4c8b0ee90290b6cbbc616c4be3c=
8aeffcaab
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/xics.c

  Log Message:
  -----------
  pseries: Fix incorrect initialization of interrupt controller

Currently in the reset code for the XICS interrupt controller, we
initialize the pending_priority field to 0 (most favored, by XICS
convention).  This is incorrect, since there is no pending interrupt, it
should be set to least favored - 0xff.  At the moment our XICS
implementation doesn't get hurt by this edge case, but it does confuse th=
e
upcoming kernel XICS implementation.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: bf3bc4c4e992fb9914e2f1f7e8a569394d298b57
      https://github.com/qemu/qemu/commit/bf3bc4c4e992fb9914e2f1f7e8a5693=
94d298b57
  Author: Ben Herrenschmidt &lt;benh@kernel.crashing.org&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/spapr.c
    M hw/xics.c
    M hw/xics.h

  Log Message:
  -----------
  pseries: Use #define for XICS base irq number

Currently the lowest "real" irq number for the XICS irq controller (as
opposed to numbers reserved for IPIs and other special purposes) is
hard coded as 16 in two places - in xics_system_init() and in spapr.c.

As well as being generally bad practice, we're going to need to change th=
is
number soon to fit in with the in-kernel XICS implementation.  This patch=

adds a #define for this number to avoid future breakage.

Signed-off-by: Michael Ellerman &lt;michael@ellerman.id.au&gt;
Signed-off-by: Ben Herrenschmidt &lt;benh@kernel.crashing.org&gt;
Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 4aac82c34675fcbd3722dfc3a2d04c839215ec6b
      https://github.com/qemu/qemu/commit/4aac82c34675fcbd3722dfc3a2d04c8=
39215ec6b
  Author: Michael Ellerman &lt;michael@ellerman.id.au&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/spapr.h
    M hw/spapr_rtas.c

  Log Message:
  -----------
  pseries: Return the token when we register an RTAS call

The kernel will soon be able to service some RTAS calls. However the
choice of tokens will still be up to userspace. To support this have
spapr_rtas_register() return the token that is allocated for an
RTAS call, that allows the calling code to tell the kernel what the
token value is.

Signed-off-by: Michael Ellerman &lt;michael@ellerman.id.au&gt;
Signed-off-by: Benjamin Herrenschmidt &lt;benh@kernel.crashing.org&gt;
Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: d36b66f7a420737dcc24de15b35a465ff6b1798d
      https://github.com/qemu/qemu/commit/d36b66f7a420737dcc24de15b35a465=
ff6b1798d
  Author: Ben Herrenschmidt &lt;benh@kernel.crashing.org&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/spapr_rtas.c

  Log Message:
  -----------
  pseries: Allow RTAS tokens without a qemu handler

Kernel-based RTAS calls will not have a qemu handler, but will
still be registered in qemu in order to be assigned a token
number and appear in the device-tree.

Let's test for the name being NULL rather than the handler
when deciding to skip an entry while building the device-tree

Signed-off-by: Benjamin Herrenschmidt &lt;benh@kernel.crashing.org&gt;
Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 500efa2319d1f1074b1d61e5ceb7a0fd61d0831d
      https://github.com/qemu/qemu/commit/500efa2319d1f1074b1d61e5ceb7a0f=
d61d0831d
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/xics.c
    M trace-events

  Log Message:
  -----------
  pseries: Add tracepoints to the XICS interrupt controller

This patch adds tracing / debugging calls to the XICS interrupt controlle=
r
implementation used on the pseries machine.

Signed-off-by: Ben Herrenschmidt &lt;benh@kernel.crashing.org&gt;
Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 22a2611c9cef4a8c8ad96fe17b3511a6cc5fb3a1
      https://github.com/qemu/qemu/commit/22a2611c9cef4a8c8ad96fe17b3511a=
6cc5fb3a1
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/xics.c

  Log Message:
  -----------
  pseries: Split xics irq configuration from state information

Currently the XICS irq controller code has a per-irq state structure whic=
h
amongst other things includes whether the interrupt is level or message
triggered - this is configured by the platform code, and is not directly
visible to the guest.  This leads to a slightly awkward construct at rese=
t
time where we need to reset everything in the state structure _except_ th=
e
lsi/msi flag, which needs to retain the information given at platform ini=
t
time.

More importantly this flag will make matching the qemu state to the KVM
state for the upcoming in-kernel XICS implementation more awkward.  This
patch, therefore, removes this flag from the per-irq state structure,
instead adding a parallel array giving the lsi/msi configuration per irq.=


Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 639e8102ae71ce2e46ebeffc6080767e573c0c56
      https://github.com/qemu/qemu/commit/639e8102ae71ce2e46ebeffc6080767=
e573c0c56
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/ppc/Makefile.objs
    M hw/spapr.c
    M hw/spapr.h
    A hw/spapr_nvram.c
    M qemu-config.c

  Log Message:
  -----------
  pseries: Implement PAPR NVRAM

The PAPR specification requires a certain amount of NVRAM, accessed via
RTAS, which we don't currently implement in qemu.  This patch addresses
this deficiency, implementing the NVRAM as a VIO device, with some glue t=
o
instantiate it automatically based on a machine option.

The machine option specifies a drive id, which is used to back the NVRAM,=

making it persistent.  If nothing is specified, the driver instead simply=

allocates space for the NVRAM, which will not be persistent

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 4fd50339c0b55fa6387fa3c28f755c306997064c
      https://github.com/qemu/qemu/commit/4fd50339c0b55fa6387fa3c28f755c3=
06997064c
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M pc-bios/README
    M pc-bios/slof.bin
    M roms/SLOF

  Log Message:
  -----------
  pseries: Update SLOF for NVRAM support

Now that we have implemented PAPR compatible NVRAM interfaces in qemu, th=
is
updates the SLOF firmware to actually initialize and use the NVRAM as a
PAPR guest firmware is expected to do.

This SLOF update also includes an ugly but useful workaround for a bug in=

the SLES11 installer which caused it to fail under KVM.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: dffb1dc29fb364aaafc41b34100a06517d7f065e
      https://github.com/qemu/qemu/commit/dffb1dc29fb364aaafc41b34100a065=
17d7f065e
  Author: Bharat Bhushan &lt;r65777@freescale.com&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/ppc/e500.c

  Log Message:
  -----------
  e500: Adding CCSR memory region

All devices are also placed under CCSR memory region.
The CCSR memory region is exported to pci device. The MSI interrupt
generation is the main reason to export the CCSR region to PCI device.
This put the requirement to move mpic under CCSR region, but logically
all devices should be under CCSR. So this patch places all emulated
devices under ccsr region.

Signed-off-by: Bharat Bhushan &lt;bharat.bhushan@freescale.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 3eddc1be1ccb26387f8f960f8a3d8c417064a91f
      https://github.com/qemu/qemu/commit/3eddc1be1ccb26387f8f960f8a3d8c4=
17064a91f
  Author: Bharat Bhushan &lt;r65777@freescale.com&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    A hw/ppc/e500-ccsr.h
    M hw/ppc/e500.c
    M hw/ppce500_pci.c

  Log Message:
  -----------
  Adding BAR0 for e500 PCI controller

PCI Root complex have TYPE-1 configuration header while PCI endpoint
have type-0 configuration header. The type-1 configuration header have
a BAR (BAR0). In Freescale PCI controller BAR0 is used for mapping pci
address space to CCSR address space. This can used for 2 purposes: 1)
for MSI interrupt generation 2) Allow CCSR registers access when configur=
ed
as PCI endpoint, which I am not sure is a use case with QEMU-KVM guest.

What I observed is that when guest read the size of BAR0 of host controll=
er
configuration header (TYPE1 header) then it always reads it as 0. When
looking into the QEMU hw/ppce500_pci.c, I do not find the PCI controller
device registering BAR0. I do not find any other controller also doing so=

may they do not use BAR0.

There are two issues when BAR0 is not there (which I can think of):
1) There should be BAR0 emulated for PCI Root complex (TYPE1 header) and
when reading the size of BAR0, it should give size as per real h/w.

2) Do we need this BAR0 inbound address translation?
  When BAR0 is of non-zero size then it will be configured for PCI
address space to local address(CCSR) space translation on inbound access.=

The primary use case is for MSI interrupt generation. The device is
configured with an address offsets in PCI address space, which will be
translated to MSI interrupt generation MPIC registers. Currently I do
not understand the MSI interrupt generation mechanism in QEMU and also
IIRC we do not use QEMU MSI interrupt mechanism on e500 guest machines.
But this BAR0 will be used when using MSI on e500.

I can see one more issue, There are ATMUs emulated in hw/ppce500_pci.c,
but i do not see these being used for address translation.
So far that works because pci address space and local address space are 1=
:1
mapped. BAR0 inbound translation + ATMU translation will complete the add=
ress
translation of inbound traffic.

Signed-off-by: Bharat Bhushan &lt;bharat.bhushan@freescale.com&gt;
[agraf: fix double variable assignment w/o read]
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 8b1853e7d8c2bf8c6a9f023ab98ba0e8a38bd086
      https://github.com/qemu/qemu/commit/8b1853e7d8c2bf8c6a9f023ab98ba0e=
8a38bd086
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/spapr_iommu.c

  Log Message:
  -----------
  pseries: Don't allow TCE (iommu) tables to be registered with duplicate=
 LIOBNs

The PAPR specification requires that every bus or device mediated by the
IOMMU have a unique Logical IO Bus Number (LIOBN).  This patch adds a che=
ck
to enforce this, which will help catch errors in configuration earlier.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 38898d7ed803cee5105246150725487add78cbd7
      https://github.com/qemu/qemu/commit/38898d7ed803cee5105246150725487=
add78cbd7
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/openpic.c

  Log Message:
  -----------
  openpic: Remove unused code

The openpic code had a few WIP bits left that nobody reanimated within
the last few years. Remove that code.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
Acked-by: Herv=C3=A9 Poussineau &lt;hpoussin@reactos.org&gt;


  Commit: cdbb912a6f8b5f325df3a6fd42cb2843032050c9
      https://github.com/qemu/qemu/commit/cdbb912a6f8b5f325df3a6fd42cb284=
3032050c9
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/openpic.c
    M hw/ppc/e500.c

  Log Message:
  -----------
  mpic: Unify numbering scheme

MPIC interrupt numbers in Linux (device tree) and in QEMU are different,
because QEMU takes the sparseness of the IRQ number space into account.

Remove that cleverness and instead assume a flat number space. This makes=

the code easier to understand, because we are actually aligned with Linux=

on the view of our worlds.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: b9b2aaa3c6926cf8af21fe75457ca6c6e0dc1f5d
      https://github.com/qemu/qemu/commit/b9b2aaa3c6926cf8af21fe75457ca6c=
6e0dc1f5d
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/openpic.c

  Log Message:
  -----------
  openpic: update to proper memory api

The openpic code was still using the old mmio memory api. Convert it to
be a generic memory api user and clean up some code that becomes redundan=
t
that way.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: a285f1ca703a434fa8edf584f94a1dc29067ab29
      https://github.com/qemu/qemu/commit/a285f1ca703a434fa8edf584f94a1dc=
29067ab29
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/openpic.c

  Log Message:
  -----------
  openpic: combine mpic and openpic src handlers

The MPIC source irq handler suddenly became identical to the standard
OpenPIC source irq handler. Combine them into the same function.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 780d16b77f992db81e90b7dd7474a9397ce393b9
      https://github.com/qemu/qemu/commit/780d16b77f992db81e90b7dd7474a93=
97ce393b9
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/openpic.c

  Log Message:
  -----------
  openpic: Convert subregions to memory api

The "openpic" controller is currently using one big region and does
subregion dispatching manually. Move this to the memory api.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 5861a33898bbddfd1a80c2e202cb9352e3b1ba62
      https://github.com/qemu/qemu/commit/5861a33898bbddfd1a80c2e202cb935=
2e3b1ba62
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/openpic.c
    M hw/openpic.h

  Log Message:
  -----------
  openpic: combine mpic and openpic irq raise functions

The IRQ raise mechanisms of the OpenPIC and MPIC controllers is identical=
,
just that the MPIC one can also raise critical interrupts.

Combine those two and check for critical raise capability during runtime.=


Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: c38c0b8ad0551e470984f2ae7e8e54aae304ed4b
      https://github.com/qemu/qemu/commit/c38c0b8ad0551e470984f2ae7e8e54a=
ae304ed4b
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/openpic.c

  Log Message:
  -----------
  openpic: merge mpic and openpic timer handling

The openpic and mpic timer handling code is basically the same.
Merge them.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 825463b38414c9afb657caee1ce20eff2d521317
      https://github.com/qemu/qemu/commit/825463b38414c9afb657caee1ce20ef=
f2d521317
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/openpic.c

  Log Message:
  -----------
  openpic: combine openpic and mpic reset functions

The openpic and mpic reset handlers are almost identical. Combine
them and extract the differences into state variables.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 35732cb41e8f8608bb0fd6ae023daee56d439bf1
      https://github.com/qemu/qemu/commit/35732cb41e8f8608bb0fd6ae023daee=
56d439bf1
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/openpic.c

  Log Message:
  -----------
  openpic: unify memory api subregions

The only difference between the "openpic" and "mpic" memory api subregion=

descriptors is the endianness. Unify them as openpic accessors with expli=
cit
endianness markers in their names.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: e1d10851522d7262a266f95d54c48eb2b1d8eb9b
      https://github.com/qemu/qemu/commit/e1d10851522d7262a266f95d54c48eb=
2b1d8eb9b
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/openpic.c

  Log Message:
  -----------
  openpic: remove unused type variable

The openpic source irqs are carrying around a type indicator that
is never accessed by anything. Remove it.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 1945dbc15f0f1ffdc9a10526448e9eba7c599d98
      https://github.com/qemu/qemu/commit/1945dbc15f0f1ffdc9a10526448e9eb=
a7c599d98
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/openpic.c

  Log Message:
  -----------
  openpic: convert simple reg operations to builtin bitops

The openpic code has its own bitmap code to access bits inside of a
bitmap. However, that is overkill when we simply want to check for a
bit inside of a uint32_t.

So instead, let's use normal bit masks and C builtin shifts and ands.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 6d544ee8ac2097c87fc97b53d6a1310d9daa0562
      https://github.com/qemu/qemu/commit/6d544ee8ac2097c87fc97b53d6a1310=
d9daa0562
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/openpic.c

  Log Message:
  -----------
  openpic: rename openpic_t to OpenPICState

Rename the openpic_t struct to OpenPICState, so it adheres better to
the current coding style rules.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 5bac0701113f4de4fee053a3939b0f569a04b88c
      https://github.com/qemu/qemu/commit/5bac0701113f4de4fee053a3939b0f5=
69a04b88c
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/openpic.c
    M hw/openpic.h
    M hw/ppc/e500.c
    M hw/ppc_newworld.c

  Log Message:
  -----------
  openpic: remove irq_out

The current openpic emulation contains half-ready code for bypass mode.
Remove it, so that when someone wants to finish it they can start from a
clean state.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: d0b7263134dfd4d487698b639f2069951f3fdb26
      https://github.com/qemu/qemu/commit/d0b7263134dfd4d487698b639f20699=
51f3fdb26
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/openpic.c
    M hw/openpic.h
    M hw/ppc/e500.c
    M hw/ppc_newworld.c

  Log Message:
  -----------
  openpic: convert to qdev

This patch converts the OpenPIC device to qdev. Along the way it
renames the "openpic" target to "raven" and the "mpic" target to
"fsl_mpic_20", to better reflect the actual models they implement.

This way we have a generic OpenPIC device now that can handle
different flavors of the OpenPIC specification.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: dbbbfd6058dda61f57d1f72133aa54eb27330411
      https://github.com/qemu/qemu/commit/dbbbfd6058dda61f57d1f72133aa54e=
b27330411
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/openpic.c

  Log Message:
  -----------
  openpic: make brr1 model specific

Now that we can properly distinguish between openpic model differences,
let's move brr1 out of the raven code path.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 732aa6ec2639ace8bcb0b27b9c0d71103bd1d153
      https://github.com/qemu/qemu/commit/732aa6ec2639ace8bcb0b27b9c0d711=
03bd1d153
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/openpic.c

  Log Message:
  -----------
  openpic: add Shared MSI support

The OpenPIC allows MSI access through shared MSI registers. Implement
them for the MPC8544 MPIC, so we can support MSIs.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: a911b7a92064d17b862ae85fe8e5ec91b7ba1aa9
      https://github.com/qemu/qemu/commit/a911b7a92064d17b862ae85fe8e5ec9=
1b7ba1aa9
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/ppc/e500.c

  Log Message:
  -----------
  PPC: e500: Add MSI support

Now that our interrupt controller supports MSIs, let's expose that featur=
e
to the guest through the device tree!

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 997505065dc92e533debf5cb23012ba4e673d387
      https://github.com/qemu/qemu/commit/997505065dc92e533debf5cb23012ba=
4e673d387
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/ppce500_pci.c

  Log Message:
  -----------
  PPC: e500: Declare pci bridge as bridge

The new PCI host bridge device needs to identify itself as PCI host bridg=
e.
Declare it as such.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 68d1e1f52d73ddcec4b0358f269d9a8c2ea216d9
      https://github.com/qemu/qemu/commit/68d1e1f52d73ddcec4b0358f269d9a8=
c2ea216d9
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/msix.c

  Log Message:
  -----------
  MSI-X: Fix endianness

The MSI-X vector tables are usually stored in little endian in memory,
so let's mark the accessors as such.

This fixes MSI-X on e500 for me.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
Acked-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: dbe30e13e87a71e85e88ae3ffd3460173cbc8193
      https://github.com/qemu/qemu/commit/dbe30e13e87a71e85e88ae3ffd34601=
73cbc8193
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/openpic.c

  Log Message:
  -----------
  openpic: fix minor coding style issues

This patch removes all remaining occurences of spaces before function
parameter indicating parenthesis.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 76aec1f8b6549d14576a3eb739c731df8f678ffb
      https://github.com/qemu/qemu/commit/76aec1f8b6549d14576a3eb739c731d=
f8f678ffb
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/openpic.c

  Log Message:
  -----------
  openpic: Accelerate pending irq search

When we're done with one interrupt, we need to search for the next pendin=
g
interrupt in the queue. This search has grown quite big now that we have
more than 256 possible irq lines.

So let's memorize how many interrupts we have pending in our bitmaps, so
that we can always bail out in the usual case - the one where we're all d=
one.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: eafb325fb11af21ed9df3f5a310fd26e70954318
      https://github.com/qemu/qemu/commit/eafb325fb11af21ed9df3f5a310fd26=
e70954318
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/ppce500_pci.c

  Log Message:
  -----------
  PPC: E500: PCI: Make first slot qdev settable

Today the first slot id in our e500 pci implementation is hardcoded to
0x11. Keep it there as default, but allow users to change the default to
a different id.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 05f57d9de8e99bf5f7ca762c6dc2f1e054c2074c
      https://github.com/qemu/qemu/commit/05f57d9de8e99bf5f7ca762c6dc2f1e=
054c2074c
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/ppce500_pci.c

  Log Message:
  -----------
  PPC: E500: PCI: Make IRQ calculation more generic

The IRQ line calculation is more or less hardcoded today. Instead, let's
write it as an algorithmic function that theoretically allows an arbitrar=
y
number of PCI slots.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 347dd79dccf41a679115213da673dfd06c4c8cc8
      https://github.com/qemu/qemu/commit/347dd79dccf41a679115213da673dfd=
06c4c8cc8
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/ppc/e500.c

  Log Message:
  -----------
  PPC: E500: Generate dt pci irq map dynamically

Today we're hardcoding the PCI interrupt map in the e500 machine file.
Instead, let's write it dynamically so that different machine types
can have different slot properties.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 492ec48dc2d99ca13b24d554e1970af7e2581e23
      https://github.com/qemu/qemu/commit/492ec48dc2d99ca13b24d554e1970af=
7e2581e23
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/ppc/e500.c
    M hw/ppc/e500.h
    M hw/ppc/e500plat.c
    M hw/ppc/mpc8544ds.c

  Log Message:
  -----------
  PPC: E500: Move PCI slot information into params

We have a params struct that allows us to expose differences between
e500 machine models. Include PCI slot information there, so we can have
different machines with different PCI slot topology.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 3bb7e02a9725a24e5bf915b35f914f82f5b07a1f
      https://github.com/qemu/qemu/commit/3bb7e02a9725a24e5bf915b35f914f8=
2f5b07a1f
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/ppc/e500plat.c

  Log Message:
  -----------
  PPC: E500plat: Make a lot of PCI slots available

The ppce500 machine doesn't have to stick to hardware limitations,
as it's defined as being fully device tree based.

Thus we can change the initial PCI slot ID to 0x1 which gives us a
whopping 31 PCI devices we can support with this machine now!

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 9e2c12988bebca7b99c0cd064b23fb7ea6643c86
      https://github.com/qemu/qemu/commit/9e2c12988bebca7b99c0cd064b23fb7=
ea6643c86
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/ppc/e500.c
    M hw/ppce500_pci.c
    A hw/ppce500_pci.h

  Log Message:
  -----------
  PPC: e500: pci: Export slot2irq calculation

We need the calculation method to get from a PCI slot ID to its respectiv=
e
interrupt line twice. Once in the internal map function and once when
assembling the device tree.

So let's extract the calculation to a separate function that can be calle=
d
by both users.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: b162d02e9450201c656edce290f33994a6d2ad33
      https://github.com/qemu/qemu/commit/b162d02e9450201c656edce290f3399=
4a6d2ad33
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M target-ppc/cpu.h

  Log Message:
  -----------
  target-ppc: Don't use hwaddr to represent hardware state

The hwaddr type is somewhat vaguely defined as being able to contain bus
addresses on the widest possible bus in the system.  For that reason it's=

discouraged for representing specific pieces of persistent hardware state=
,
which should instead use an explicit width type that matches the bits
available in real hardware.  In particular, because of the possibility th=
at
the size of hwaddr might change if different buses are added to the targe=
t
in future, it's not suitable for use in vm state descriptions for savevm
and migration.

This patch purges such unwise uses of hwaddr from the ppc target code,
which turns out to be just one.  The ppcemb_tlb_t struct, used on a numbe=
r
of embedded ppc models to represent a TLB entry contains a hwaddr for the=

real address field.  This patch changes it to be a fixed uint64_t which i=
s
suitable enough for all machine types which use this structure.

Other uses of hwaddr in CPUPPCState turn out not to be problematic:
htab_base and htab_mask are just used for the convenience of the TCG code=
;
the underlying machine state is the SDR1 register, which is stored with
a suitable type already.  Likewise the mpic_cpu_base field is only used
internally and does not represent fundamental hardware state which needs =
to
be saved.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: a64ae610b978dfd8ccfb7f6c5d4cfe62d7542fbd
      https://github.com/qemu/qemu/commit/a64ae610b978dfd8ccfb7f6c5d4cfe6=
2d7542fbd
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-12-14 (Fri, 14 Dec 2012)

  Changed paths:
    M hw/spapr_nvram.c

  Log Message:
  -----------
  pseries: Increase default NVRAM size

If no image file for NVRAM is specified, the pseries machine currently
creates a 16K non-persistent NVRAM by default.  This basically works, but=

is not large enough for current firmware and guest kernels to create all
the NVRAM partitions they would like to.  Increasing the default size to
64K addresses this and stops the guest generating error messages.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 6d4e18925a65306afabaad7b63a4588c18919e99
      https://github.com/qemu/qemu/commit/6d4e18925a65306afabaad7b63a4588=
c18919e99
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-12-15 (Sat, 15 Dec 2012)

  Changed paths:
    M hw/msix.c
    M hw/openpic.c
    M hw/openpic.h
    M hw/ppc/Makefile.objs
    A hw/ppc/e500-ccsr.h
    M hw/ppc/e500.c
    M hw/ppc/e500.h
    M hw/ppc/e500plat.c
    M hw/ppc/mpc8544ds.c
    M hw/ppc_newworld.c
    M hw/ppce500_pci.c
    A hw/ppce500_pci.h
    M hw/spapr.c
    M hw/spapr.h
    M hw/spapr_iommu.c
    A hw/spapr_nvram.c
    M hw/spapr_rtas.c
    M hw/xics.c
    M hw/xics.h
    M pc-bios/README
    M pc-bios/slof.bin
    M qemu-config.c
    M roms/SLOF
    M target-ppc/cpu.h
    M trace-events

  Log Message:
  -----------
  Merge branch 'ppc-for-upstream' of git://repo.or.cz/qemu/agraf

* 'ppc-for-upstream' of git://repo.or.cz/qemu/agraf: (40 commits)
  pseries: Increase default NVRAM size
  target-ppc: Don't use hwaddr to represent hardware state
  PPC: e500: pci: Export slot2irq calculation
  PPC: E500plat: Make a lot of PCI slots available
  PPC: E500: Move PCI slot information into params
  PPC: E500: Generate dt pci irq map dynamically
  PPC: E500: PCI: Make IRQ calculation more generic
  PPC: E500: PCI: Make first slot qdev settable
  openpic: Accelerate pending irq search
  openpic: fix minor coding style issues
  MSI-X: Fix endianness
  PPC: e500: Declare pci bridge as bridge
  PPC: e500: Add MSI support
  openpic: add Shared MSI support
  openpic: make brr1 model specific
  openpic: convert to qdev
  openpic: remove irq_out
  openpic: rename openpic_t to OpenPICState
  openpic: convert simple reg operations to builtin bitops
  openpic: remove unused type variable
  ...


Compare: https://github.com/qemu/qemu/compare/659f807c0a70...6d4e18925a65=


----==_mimepart_50cc513251967_436816d8ae8984c7--


</body></email><email><emailId>20121216130009</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-16 13:00:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 44209f: exec: fix coding style</subject><body>



----==_mimepart_50cdc5d95b71b_7d471782ae81371f9
Date: Sun, 16 Dec 2012 05:00:09 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50cdc5d95d149_7d471782ae8137223@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 44209fc4edfd92464eb0413acfd434b687be945a
      https://github.com/qemu/qemu/commit/44209fc4edfd92464eb0413acfd434b687be945a
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-12-16 (Sun, 16 Dec 2012)

  Changed paths:
    M exec.c

  Log Message:
  -----------
  exec: fix coding style

Fix coding style in areas to be moved by later patches.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 5a3165263ae6782a7fe712a0a0c29c17468b9b68
      https://github.com/qemu/qemu/commit/5a3165263ae6782a7fe712a0a0c29c17468b9b68
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-12-16 (Sun, 16 Dec 2012)

  Changed paths:
    M exec.c

  Log Message:
  -----------
  exec: extract TB watchpoint check

Will be moved by the next patch.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 5b6dd8683dc30e8e0970db3dd9176732dc819410
      https://github.com/qemu/qemu/commit/5b6dd8683dc30e8e0970db3dd9176732dc819410
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-12-16 (Sun, 16 Dec 2012)

  Changed paths:
    M exec.c
    M translate-all.c
    A translate-all.h

  Log Message:
  -----------
  exec: move TB handling to translate-all.c

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: a8a826a3c3b8c8a1c4def0e9e22b46e78e6163a0
      https://github.com/qemu/qemu/commit/a8a826a3c3b8c8a1c4def0e9e22b46e78e6163a0
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-12-16 (Sun, 16 Dec 2012)

  Changed paths:
    M exec-all.h
    M hw/kvmvapic.c
    M target-alpha/helper.c
    M target-alpha/mem_helper.c
    M target-arm/op_helper.c
    M target-cris/op_helper.c
    M target-i386/helper.c
    M target-i386/mem_helper.c
    M target-lm32/op_helper.c
    M target-m68k/op_helper.c
    M target-microblaze/op_helper.c
    M target-mips/op_helper.c
    M target-openrisc/mmu_helper.c
    M target-ppc/mem_helper.c
    M target-s390x/mem_helper.c
    M target-sh4/op_helper.c
    M target-sparc/cpu.h
    M target-sparc/helper.c
    M target-sparc/ldst_helper.c
    M target-unicore32/op_helper.c
    M target-xtensa/op_helper.c
    M translate-all.c
    M user-exec.c

  Log Message:
  -----------
  exec: refactor cpu_restore_state

Refactor common code around calls to cpu_restore_state().

tb_find_pc() has now no external users, make it static.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/6d4e18925a65...a8a826a3c3b8

----==_mimepart_50cdc5d95b71b_7d471782ae81371f9--


</body></email><email><emailId>20121219000013</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-19 00:00:13-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] c3587c: virtio-serial: use uint32_t to count ports</subject><body>



----==_mimepart_50d1038debd7d_5d24dbbaf040020
Date: Tue, 18 Dec 2012 16:00:13 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50d1038dee7d3_5d24dbbaf0401f3@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: c3587ca1a25862628e06cc019f91e7b2dcef40bf
      https://github.com/qemu/qemu/commit/c3587ca1a25862628e06cc019f91e7b2dcef40bf
  Author: Amit Shah &lt;amit.shah@redhat.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M hw/virtio-serial-bus.c

  Log Message:
  -----------
  virtio-serial: use uint32_t to count ports

Signed-off-by: Amit Shah &lt;amit.shah@redhat.com&gt;


  Commit: 2e575a86abc36764ef34030f423ef118914a01cc
      https://github.com/qemu/qemu/commit/2e575a86abc36764ef34030f423ef118914a01cc
  Author: Amit Shah &lt;amit.shah@redhat.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M hw/virtio-serial-bus.c

  Log Message:
  -----------
  virtio-serial: move active ports loading to separate function

The virtio_serial_load() function became too big, split the code that
gets the port info from the source into a separate function.

Signed-off-by: Amit Shah &lt;amit.shah@redhat.com&gt;


  Commit: bdb917bf8ab187b662c612ee6fb87479c0b82490
      https://github.com/qemu/qemu/commit/bdb917bf8ab187b662c612ee6fb87479c0b82490
  Author: Amit Shah &lt;amit.shah@redhat.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M hw/virtio-serial-bus.c

  Log Message:
  -----------
  virtio-serial: allocate post_load only at load-time

This saves us a few bytes in the VirtIOSerial struct.  Not a big
savings, but since the entire structure is used only during a short
while after migration, it's helpful to keep the struct cleaner and
smaller.

Signed-off-by: Amit Shah &lt;amit.shah@redhat.com&gt;


  Commit: a75bf146503a94fb900e0dfa0529bd5d1be9fec5
      https://github.com/qemu/qemu/commit/a75bf146503a94fb900e0dfa0529bd5d1be9fec5
  Author: Amit Shah &lt;amit.shah@redhat.com&gt;
  Date:   2012-12-13 (Thu, 13 Dec 2012)

  Changed paths:
    M hw/virtio-serial-bus.c

  Log Message:
  -----------
  virtio-serial: delete timer if active during exit

The post_load timer was being freed, but not deleted.  This could cause
problems when the timer is armed, but the device is hot-unplugged before
the callback is executed.

Signed-off-by: Amit Shah &lt;amit.shah@redhat.com&gt;


  Commit: 2c1d4d15f09cf95b8f832624e7aac2916f9d1865
      https://github.com/qemu/qemu/commit/2c1d4d15f09cf95b8f832624e7aac2916f9d1865
  Author: Stefano Stabellini &lt;stefano.stabellini@eu.citrix.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M hw/xen_console.c

  Log Message:
  -----------
  xen: implement support for secondary consoles in the console backend

This patch corresponds to commit
840184a106bc24e745beda5c77e392f6cecd2bc9 from
git://xenbits.xensource.com/qemu-xen-unstable.git.

Signed-off-by: Stefano Stabellini &lt;stefano.stabellini@eu.citrix.com&gt;


  Commit: 044b99c6555f562254ae70dc39f32190eecbc1f2
      https://github.com/qemu/qemu/commit/044b99c6555f562254ae70dc39f32190eecbc1f2
  Author: Stefano Stabellini &lt;stefano.stabellini@eu.citrix.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M hw/xen_pt_msi.c

  Log Message:
  -----------
  xen: fix trivial PCI passthrough MSI-X bug

We are currently passing entry-&gt;data as address parameter. Pass
entry-&gt;addr instead.

Signed-off-by: Stefano Stabellini &lt;stefano.stabellini@eu.citrix.com&gt;
Tested-by: Sander Eikelenboom &lt;linux@eikelenboom.it&gt;
Xen-devel: http://marc.info/?l=xen-devel&amp;m=135515462613715


  Commit: f1b8caf1d927f30f66054733a783651a24db4999
      https://github.com/qemu/qemu/commit/f1b8caf1d927f30f66054733a783651a24db4999
  Author: Sander Eikelenboom &lt;linux@eikelenboom.it&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M hw/xen_pt.c
    M xen-all.c

  Log Message:
  -----------
  Fix compile errors when enabling Xen debug logging.

Signed-off-by: Sander Eikelenboom &lt;linux@eikelenboom.it&gt;
Acked-by: Stefano Stabellini &lt;stefano.stabellini@eu.citrix.com&gt;


  Commit: a38648290ee277c7cb8a53eabdcdb08bb7a9f23f
      https://github.com/qemu/qemu/commit/a38648290ee277c7cb8a53eabdcdb08bb7a9f23f
  Author: Ian Jackson &lt;ian.jackson@eu.citrix.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M xen-all.c

  Log Message:
  -----------
  cpu_ioreq_pio, cpu_ioreq_move: introduce read_phys_req_item, write_phys_req_item

Replace a lot of formulaic multiplications (containing casts, no less)
with calls to a pair of functions.  This encapsulates in a single
place the operations which require care relating to integer overflow.

Cc: Dongxiao Xu &lt;dongxiao.xu@intel.com&gt;
Signed-off-by: Ian Jackson &lt;ian.jackson@eu.citrix.com&gt;
Acked-by: Stefano Stabellini &lt;stefano.stabellini@eu.citrix.com&gt;


  Commit: 249e7e0fff080df0eff54730f3b6459d92d61e5a
      https://github.com/qemu/qemu/commit/249e7e0fff080df0eff54730f3b6459d92d61e5a
  Author: Ian Jackson &lt;ian.jackson@eu.citrix.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M xen-all.c

  Log Message:
  -----------
  cpu_ioreq_pio, cpu_ioreq_move: i should be uint32_t rather than int

The current code compare i (int) with req-&gt;count (uint32_t) in a for
loop, risking an infinite loop if req-&gt;count is equal to UINT_MAX.

Also i is only used in comparisons or multiplications with unsigned
integers.

Signed-off-by: Stefano Stabellini &lt;stefano.stabellini@eu.citrix.com&gt;
Cc: Dongxiao Xu &lt;dongxiao.xu@intel.com&gt;
Cc: Stefano Stabellini &lt;stefano.stabellini@eu.citrix.com&gt;
Signed-off-by: Ian Jackson &lt;ian.jackson@eu.citrix.com&gt;


  Commit: 2f464b5a32b414adb545acc6d94b5c35c7d258ba
      https://github.com/qemu/qemu/commit/2f464b5a32b414adb545acc6d94b5c35c7d258ba
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M hw/qxl-render.c

  Log Message:
  -----------
  qxl: save qemu_create_displaysurface_from result

Spotted by Coverity.

https://bugzilla.redhat.com/show_bug.cgi?id=885644

Cc: qemu-stable@nongnu.org
Reported-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 938b8a36b65e44c44ca29245437f8d7ac0f826e8
      https://github.com/qemu/qemu/commit/938b8a36b65e44c44ca29245437f8d7ac0f826e8
  Author: Uri Lublin &lt;uril@redhat.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M ui/spice-core.c

  Log Message:
  -----------
  qxl+vnc: register a vm state change handler for dummy spice_server

When qxl + vnc are used, a dummy spice_server is initialized.
The spice_server has to be told when the VM runstate changes,
which is what this patch does.

Without it, from qxl_send_events(), the following error message is shown:
  qxl_send_events: spice-server bug: guest stopped, ignoring

Cc: qemu-stable@nongnu.org
Signed-off-by: Uri Lublin &lt;uril@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 07a54d704e62e2515db0b085d53d13a2f1b1b06a
      https://github.com/qemu/qemu/commit/07a54d704e62e2515db0b085d53d13a2f1b1b06a
  Author: Marc-AndrÃ© Lureau &lt;marcandre.lureau@gmail.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M spice-qemu-char.c

  Log Message:
  -----------
  spice-qemu-char: write to chardev whatever amount it can read

The current code waits until the chardev can read MIN(len, VMC_MAX)
But some chardev may never reach than amount, in fact some of them
will only ever accept write of 1. Fix the min computation and remove
the VMC_MAX constant.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 71b423f4b970de2622803a67a2bf39b1d1f5a12c
      https://github.com/qemu/qemu/commit/71b423f4b970de2622803a67a2bf39b1d1f5a12c
  Author: Marc-AndrÃ© Lureau &lt;marcandre.lureau@gmail.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M spice-qemu-char.c

  Log Message:
  -----------
  spice-qemu-char: factor out CharDriverState creation

Make the CharDriverState creation code reusable by spicevmc port.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 5a49d3e9a799b7e1bf87da7ae7f2a719e01da319
      https://github.com/qemu/qemu/commit/5a49d3e9a799b7e1bf87da7ae7f2a719e01da319
  Author: Marc-AndrÃ© Lureau &lt;marcandre.lureau@gmail.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M qemu-char.c
    M qemu-options.hx
    M spice-qemu-char.c
    M trace-events
    M ui/qemu-spice.h

  Log Message:
  -----------
  spice-qemu-char: add spiceport chardev

Add a new spice chardev to allow arbitrary communication between the
host and the Spice client via the spice server.

Examples:

This allows the Spice client to have a special port for the qemu
monitor:

... -chardev spiceport,name=org.qemu.monitor,id=monitorport
    -mon chardev=monitorport

v2:
- remove support for chardev to chardev linking
- conditionnaly compile with SPICE_SERVER_VERSION

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 7a5448ce6ef140a20b1a090d50aeb4248d0a9ffd
      https://github.com/qemu/qemu/commit/7a5448ce6ef140a20b1a090d50aeb4248d0a9ffd
  Author: Marc-AndrÃ© Lureau &lt;marcandre.lureau@gmail.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M spice-qemu-char.c

  Log Message:
  -----------
  spice-qemu-char: keep a list of spice chardev

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: afd0b4091fef7a1290cf76c6da8c9a24a3553d58
      https://github.com/qemu/qemu/commit/afd0b4091fef7a1290cf76c6da8c9a24a3553d58
  Author: Marc-AndrÃ© Lureau &lt;marcandre.lureau@gmail.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M spice-qemu-char.c
    M ui/qemu-spice.h
    M ui/spice-core.c

  Log Message:
  -----------
  spice-qemu-char: register spicevmc ports during qemu_spice_init()

Do the delayed registration of spicevmc ports after Spice server is
initialized.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 700f6b6a921861a8946377a9531b6d1e8b09bb51
      https://github.com/qemu/qemu/commit/700f6b6a921861a8946377a9531b6d1e8b09bb51
  Author: Marc-AndrÃ© Lureau &lt;marcandre.lureau@gmail.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    A docs/spice-port-fqdn.txt

  Log Message:
  -----------
  docs: add spice-port-fqdn.txt

Start a simple org.qemu.* registry of well known name.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 4e28976e563ad54f6adc5ae00b1fb8224f1a82ca
      https://github.com/qemu/qemu/commit/4e28976e563ad54f6adc5ae00b1fb8224f1a82ca
  Author: Amit Shah &lt;amit.shah@redhat.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M hw/virtio-serial-bus.c

  Log Message:
  -----------
  virtio-serial-bus: send_control_msg() should not deal with cpkts

Stuff the cpkt before calling send_control_msg().  This function should
not be concerned about contents of the buffer it receives.

A few code refactorings recently have made making this change easier
than earlier.

Coverity and clang have flagged this code several times in the past
(cpkt-&gt;id not set before send_control_event() passed it on to
send_control_msg()).  This will finally eliminate the false-positive.

CC: Markus Armbruster &lt;armbru@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Amit Shah &lt;amit.shah@redhat.com&gt;


  Commit: 91bdd1cf08f65b7a127c22d4d65ff9d16dcac870
      https://github.com/qemu/qemu/commit/91bdd1cf08f65b7a127c22d4d65ff9d16dcac870
  Author: Amit Shah &lt;amit.shah@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M hw/virtio-serial-bus.c

  Log Message:
  -----------
  virtio-serial-bus: assert port is non-null in remove_port()

remove_port() is called from qdev's unplug callback, and we're certain
the port will be found in our list of ports.  Adding an assert()
documents this.

This was flagged by Coverity, fix suggested by Markus.

CC: Markus Armbruster &lt;armbru@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Amit Shah &lt;amit.shah@redhat.com&gt;


  Commit: e103129b1b5746f8388b37d18317e61d6b139b69
      https://github.com/qemu/qemu/commit/e103129b1b5746f8388b37d18317e61d6b139b69
  Author: Zhi Yong Wu &lt;wuzhy@linux.vnet.ibm.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M net/hub.c

  Log Message:
  -----------
  net, hub: fix the indent in the comments

  Remove some redundant blanks in the comments of
net_hub_id_for_client().

Signed-off-by: Zhi Yong Wu &lt;wuzhy@linux.vnet.ibm.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: d96fc51cc6defcd80bdf932823dadd88be532a0b
      https://github.com/qemu/qemu/commit/d96fc51cc6defcd80bdf932823dadd88be532a0b
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M hw/pflash_cfi01.c

  Log Message:
  -----------
  pflash_cfi01: qemu_log_mask "unimplemented" msg

This printf is informing the user of unimplemented functionality. It should be
re-directed to qemu_log(LOG_UNIMP, ...) accordingly.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: ec9ea4890cd06de1648cbbfb99fcb63e01f4000f
      https://github.com/qemu/qemu/commit/ec9ea4890cd06de1648cbbfb99fcb63e01f4000f
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M hw/pflash_cfi01.c
    M hw/pflash_cfi02.c

  Log Message:
  -----------
  pflash_cfi0x: Send debug messages to stderr

These debug info messages should go to stderr rather than stdout.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 8f6038009662b481fbd1e43cd69af80aa10a8223
      https://github.com/qemu/qemu/commit/8f6038009662b481fbd1e43cd69af80aa10a8223
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M hw/zynq_slcr.c

  Log Message:
  -----------
  zynq_slcr: Compile time warning fixes.

Few warnings when compiled with debug printfs enabled. Fixed all.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 8c815fb30ed1940c66389be728b29d5ebdf05c0e
      https://github.com/qemu/qemu/commit/8c815fb30ed1940c66389be728b29d5ebdf05c0e
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M hw/arm_gic.c

  Log Message:
  -----------
  arm_gic: Add cpu nr to Raised IRQ message

Add the relevant CPU nr to this debug message to make IRQ debugging more
informative.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 887eb29930a7b48e46d16916cb050d114016f143
      https://github.com/qemu/qemu/commit/887eb29930a7b48e46d16916cb050d114016f143
  Author: Cole Robinson &lt;crobinso@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M .gitignore

  Log Message:
  -----------
  gitignore: Add virtfs-proxy-helper

Signed-off-by: Cole Robinson &lt;crobinso@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: e12cdb1b4055530c61fe99683d256c42e9e62ac8
      https://github.com/qemu/qemu/commit/e12cdb1b4055530c61fe99683d256c42e9e62ac8
  Author: John Spencer &lt;maillist-qemu@barfooze.de&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M user-exec.c

  Log Message:
  -----------
  fix build error on ARM due to wrong glibc check

the test for glibc &lt; 2 "succeeds" wrongly for any non-glibc C library,
and breaks the build on musl libc.
we must first test if __GLIBC__ is defined at all, before using it
unconditionally.

Signed-off-by: John Spencer &lt;maillist-qemu@barfooze.de&gt;
Reviewed-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: c56dc774242f902e51e2343f4472e742ef2b7838
      https://github.com/qemu/qemu/commit/c56dc774242f902e51e2343f4472e742ef2b7838
  Author: John Spencer &lt;maillist-qemu@barfooze.de&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M linux-user/syscall.c

  Log Message:
  -----------
  linux-user/syscall.c: remove wrong forward decl of setgroups()

this declaration is wrong:
the correct prototype on linux is:
int setgroups(size_t size, const gid_t *list);

since by default musl libc exposes this symbol in unistd.h
additionally to grp.h, the wrong declaration causes a build error.

the proper fix is to simply include the correct header.

Signed-off-by: John Spencer &lt;maillist-qemu@barfooze.de&gt;

Reviewed-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 5a6c7644b215060a43d94709307d86bc50e1b4b9
      https://github.com/qemu/qemu/commit/5a6c7644b215060a43d94709307d86bc50e1b4b9
  Author: Laszlo Ersek &lt;lersek@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M hw/vmmouse.c

  Log Message:
  -----------
  vmmouse_reset(): remove minimal code duplication

Commit 069ab0eb added a vmmouse_disable() call to vmmouse_reset().
vmmouse_disable() resets the status already.

Signed-off-by: Laszlo Ersek &lt;lersek@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 779ab5e3ddb9ad903f9a0ec21e148ed7bfd2d255
      https://github.com/qemu/qemu/commit/779ab5e3ddb9ad903f9a0ec21e148ed7bfd2d255
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: Earlier pkg-config probe

Probe pkg-config before it is used for the first time (libseccomp check).

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: c3a1ecd0fc565c913efc59663e7ac34b9c3c2291
      https://github.com/qemu/qemu/commit/c3a1ecd0fc565c913efc59663e7ac34b9c3c2291
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M hw/xen_console.c
    M hw/xen_pt.c
    M hw/xen_pt_msi.c
    M xen-all.c

  Log Message:
  -----------
  Merge remote-tracking branch 'sstabellini/xen-20121217' into staging

* sstabellini/xen-20121217:
  cpu_ioreq_pio, cpu_ioreq_move: i should be uint32_t rather than int
  cpu_ioreq_pio, cpu_ioreq_move: introduce read_phys_req_item, write_phys_req_item
  Fix compile errors when enabling Xen debug logging.
  xen: fix trivial PCI passthrough MSI-X bug
  xen: implement support for secondary consoles in the console backend

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 510981a097bf16ef4747c9a1dfe806edfc117177
      https://github.com/qemu/qemu/commit/510981a097bf16ef4747c9a1dfe806edfc117177
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    A docs/spice-port-fqdn.txt
    M hw/qxl-render.c
    M qemu-char.c
    M qemu-options.hx
    M spice-qemu-char.c
    M trace-events
    M ui/qemu-spice.h
    M ui/spice-core.c

  Log Message:
  -----------
  Merge remote-tracking branch 'spice/spice.v66' into staging

* spice/spice.v66:
  docs: add spice-port-fqdn.txt
  spice-qemu-char: register spicevmc ports during qemu_spice_init()
  spice-qemu-char: keep a list of spice chardev
  spice-qemu-char: add spiceport chardev
  spice-qemu-char: factor out CharDriverState creation
  spice-qemu-char: write to chardev whatever amount it can read
  qxl+vnc: register a vm state change handler for dummy spice_server
  qxl: save qemu_create_displaysurface_from result

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 5455a474d92e345df83212fd1b2f59d4a5d46ca9
      https://github.com/qemu/qemu/commit/5455a474d92e345df83212fd1b2f59d4a5d46ca9
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M hw/virtio-serial-bus.c

  Log Message:
  -----------
  Merge remote-tracking branch 'amit/master' into staging

* amit/master:
  virtio-serial-bus: assert port is non-null in remove_port()
  virtio-serial-bus: send_control_msg() should not deal with cpkts
  virtio-serial: delete timer if active during exit
  virtio-serial: allocate post_load only at load-time
  virtio-serial: move active ports loading to separate function
  virtio-serial: use uint32_t to count ports

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 914606d26e654d4c01bd5186f4d05e3fd445e219
      https://github.com/qemu/qemu/commit/914606d26e654d4c01bd5186f4d05e3fd445e219
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M .gitignore
    M configure
    M hw/arm_gic.c
    M hw/pflash_cfi01.c
    M hw/pflash_cfi02.c
    M hw/vmmouse.c
    M hw/zynq_slcr.c
    M linux-user/syscall.c
    M net/hub.c
    M user-exec.c

  Log Message:
  -----------
  Merge remote-tracking branch 'stefanha/trivial-patches' into staging

* stefanha/trivial-patches:
  configure: Earlier pkg-config probe
  vmmouse_reset(): remove minimal code duplication
  linux-user/syscall.c: remove wrong forward decl of setgroups()
  fix build error on ARM due to wrong glibc check
  gitignore: Add virtfs-proxy-helper
  arm_gic: Add cpu nr to Raised IRQ message
  zynq_slcr: Compile time warning fixes.
  pflash_cfi0x: Send debug messages to stderr
  pflash_cfi01: qemu_log_mask "unimplemented" msg
  net, hub: fix the indent in the comments

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/a8a826a3c3b8...914606d26e65

----==_mimepart_50d1038debd7d_5d24dbbaf040020--


</body></email><email><emailId>20121220010032</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-20 01:00:32-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 6f918e: Fixup q35/ich9 Licenses</subject><body>



----==_mimepart_50d2632ff2375_548c152eae4151017
Date: Wed, 19 Dec 2012 17:00:32 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50d263301b1f5_548c152eae41511a@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 6f918e40e6b7f4e3dcf89c3e3f1001e965a683a1
      https://github.com/qemu/qemu/commit/6f918e40e6b7f4e3dcf89c3e3f1001e965a683a1
  Author: Jason Baron &lt;jbaron@redhat.com&gt;
  Date:   2012-12-12 (Wed, 12 Dec 2012)

  Changed paths:
    M hw/acpi_ich9.c
    M hw/lpc_ich9.c
    M hw/smbus_ich9.c

  Log Message:
  -----------
  Fixup q35/ich9 Licenses

Cleanup the q35/ich9 license headers.

Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Acked-by: Isaku Yamahata &lt;yamahata@valinux.co.jp&gt;


  Commit: 89e6d68ef3c45b2c4e3199c3397b5525b752698d
      https://github.com/qemu/qemu/commit/89e6d68ef3c45b2c4e3199c3397b5525b752698d
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-12-12 (Wed, 12 Dec 2012)

  Changed paths:
    M net/tap-linux.c

  Log Message:
  -----------
  tap: reset vnet header size on open

For tap, we currently assume the vnet header size is 10
(the default value) but that might not be the case
if tap is persistent and has been used by qemu previously.
To fix, set vnet header size correctly on open.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: c84a2b1aa5ccdddad03d25f58be5c94eba0d9db4
      https://github.com/qemu/qemu/commit/c84a2b1aa5ccdddad03d25f58be5c94eba0d9db4
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-12-12 (Wed, 12 Dec 2012)

  Changed paths:
    M scripts/get_maintainer.pl

  Log Message:
  -----------
  get_maintainer.pl: update from linix 3.8

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 29002d9e104913998265cfff95bb49f4b4a966e2
      https://github.com/qemu/qemu/commit/29002d9e104913998265cfff95bb49f4b4a966e2
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-12-12 (Wed, 12 Dec 2012)

  Changed paths:
    M Makefile
    M Makefile.target
    M Makefile.user
    A hw/pci/hw

  Log Message:
  -----------
  pci: prepare makefiles for pci code reorganization

To make it easier to move code around without breaking
build at intermedite steps, tweak makefiles
to look in pci/ and hw/ for include files, automatically.
This will be reverted at the end of the reorganization.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: ca818cfbfd77e02ffac338866568ac07f6f5fd7d
      https://github.com/qemu/qemu/commit/ca818cfbfd77e02ffac338866568ac07f6f5fd7d
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-12-12 (Wed, 12 Dec 2012)

  Changed paths:
    M MAINTAINERS

  Log Message:
  -----------
  MAINTAINERS: add hw/pci/ to list of PCI files

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 315a1350c4a386065a73aad2ded1a11d77bf7771
      https://github.com/qemu/qemu/commit/315a1350c4a386065a73aad2ded1a11d77bf7771
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M hw/Makefile.objs
    M hw/i386/Makefile.objs
    R hw/msi.c
    R hw/msi.h
    R hw/msix.c
    R hw/msix.h
    R hw/pci-hotplug.c
    R hw/pci-stub.c
    R hw/pci.c
    R hw/pci.h
    A hw/pci/Makefile.objs
    A hw/pci/msi.c
    A hw/pci/msi.h
    A hw/pci/msix.c
    A hw/pci/msix.h
    A hw/pci/pci-hotplug.c
    A hw/pci/pci-stub.c
    A hw/pci/pci.c
    A hw/pci/pci.h
    A hw/pci/pci_bridge.c
    A hw/pci/pci_bridge.h
    A hw/pci/pci_host.c
    A hw/pci/pci_host.h
    A hw/pci/pci_ids.h
    A hw/pci/pci_internals.h
    A hw/pci/pci_regs.h
    A hw/pci/pcie.c
    A hw/pci/pcie.h
    A hw/pci/pcie_aer.c
    A hw/pci/pcie_aer.h
    A hw/pci/pcie_host.c
    A hw/pci/pcie_host.h
    A hw/pci/pcie_port.c
    A hw/pci/pcie_port.h
    A hw/pci/pcie_regs.h
    A hw/pci/shpc.c
    A hw/pci/shpc.h
    A hw/pci/slotid_cap.c
    A hw/pci/slotid_cap.h
    R hw/pci_bridge.c
    R hw/pci_bridge.h
    R hw/pci_host.c
    R hw/pci_host.h
    R hw/pci_ids.h
    R hw/pci_internals.h
    R hw/pci_regs.h
    R hw/pcie.c
    R hw/pcie.h
    R hw/pcie_aer.c
    R hw/pcie_aer.h
    R hw/pcie_host.c
    R hw/pcie_host.h
    R hw/pcie_port.c
    R hw/pcie_port.h
    R hw/pcie_regs.h
    M hw/ppc/Makefile.objs
    R hw/shpc.c
    R hw/shpc.h
    R hw/slotid_cap.c
    R hw/slotid_cap.h

  Log Message:
  -----------
  pci: move pci core code to hw/pci

Move files and modify makefiles to pick them at the
new location.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: a2cb15b0ddfa05f81a42d7b65dd0c7c50e420c33
      https://github.com/qemu/qemu/commit/a2cb15b0ddfa05f81a42d7b65dd0c7c50e420c33
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M arch_init.c
    M hw/ac97.c
    M hw/acpi_ich9.c
    M hw/acpi_piix4.c
    M hw/alpha_sys.h
    M hw/apb_pci.c
    M hw/apic.c
    M hw/apm.c
    M hw/bonito.c
    M hw/cirrus_vga.c
    M hw/dec_pci.c
    M hw/e1000.c
    M hw/eepro100.c
    M hw/es1370.c
    M hw/esp-pci.c
    M hw/grackle_pci.c
    M hw/gt64xxx.c
    M hw/hda-audio.c
    M hw/i82378.c
    M hw/i82801b11.c
    M hw/ich9.h
    M hw/ide.h
    M hw/ide/ahci.c
    M hw/ide/cmd646.c
    M hw/ide/core.c
    M hw/ide/ich.c
    M hw/ide/pci.c
    M hw/ide/piix.c
    M hw/ide/via.c
    M hw/intel-hda.c
    M hw/ioh3420.c
    M hw/ioh3420.h
    M hw/ivshmem.c
    M hw/kvm/apic.c
    M hw/kvm/pci-assign.c
    M hw/lpc_ich9.c
    M hw/lsi53c895a.c
    M hw/macio.c
    M hw/megasas.c
    M hw/mips_fulong2e.c
    M hw/mips_malta.c
    M hw/ne2000.c
    M hw/openpic.c
    M hw/pc.c
    M hw/pc_piix.c
    M hw/pci_bridge_dev.c
    M hw/pcnet-pci.c
    M hw/piix4.c
    M hw/piix_pci.c
    M hw/ppc/e500.c
    M hw/ppc440_bamboo.c
    M hw/ppc4xx.h
    M hw/ppc4xx_pci.c
    M hw/ppc_newworld.c
    M hw/ppc_oldworld.c
    M hw/ppc_prep.c
    M hw/ppce500_pci.c
    M hw/prep_pci.c
    M hw/q35.h
    M hw/qxl.h
    M hw/r2d.c
    M hw/realview.c
    M hw/rtl8139.c
    M hw/serial-pci.c
    M hw/sga.c
    M hw/sh_pci.c
    M hw/smbus_ich9.c
    M hw/spapr.c
    M hw/spapr_pci.c
    M hw/spapr_pci.h
    M hw/sun4u.c
    M hw/unin_pci.c
    M hw/usb/hcd-ehci-pci.c
    M hw/usb/hcd-ohci.c
    M hw/usb/hcd-uhci.c
    M hw/usb/hcd-xhci.c
    M hw/versatile_pci.c
    M hw/versatilepb.c
    M hw/vfio_pci.c
    M hw/vga-pci.c
    M hw/vga.c
    M hw/virtio-balloon.h
    M hw/virtio-net.h
    M hw/virtio-pci.c
    M hw/virtio-scsi.h
    M hw/vmware_vga.c
    M hw/vt82c686.c
    M hw/wdt_i6300esb.c
    M hw/xen-host-pci-device.h
    M hw/xen_apic.c
    M hw/xen_platform.c
    M hw/xen_pt.c
    M hw/xen_pt.h
    M hw/xio3130_downstream.c
    M hw/xio3130_downstream.h
    M hw/xio3130_upstream.c
    M hw/xio3130_upstream.h
    M kvm-all.c
    M kvm-stub.c
    M monitor.c
    M target-i386/kvm.c
    M xen-all.c

  Log Message:
  -----------
  pci: update all users to look in pci/

update all users so we can remove the makefile hack.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: c759b24fae08c6c333df03e1db48e13b7f5eda30
      https://github.com/qemu/qemu/commit/c759b24fae08c6c333df03e1db48e13b7f5eda30
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M hw/pci/msi.c
    M hw/pci/msi.h
    M hw/pci/msix.c
    M hw/pci/msix.h
    M hw/pci/pci-hotplug.c
    M hw/pci/pci-stub.c
    M hw/pci/pci.c
    M hw/pci/pci.h
    M hw/pci/pci_bridge.c
    M hw/pci/pci_bridge.h
    M hw/pci/pci_host.c
    M hw/pci/pci_host.h
    M hw/pci/pcie.c
    M hw/pci/pcie.h
    M hw/pci/pcie_aer.c
    M hw/pci/pcie_aer.h
    M hw/pci/pcie_host.c
    M hw/pci/pcie_host.h
    M hw/pci/pcie_port.c
    M hw/pci/pcie_port.h
    M hw/pci/shpc.c
    M hw/pci/slotid_cap.c

  Log Message:
  -----------
  pci: fix path for local includes

Include dependencies from pci core using the correct path.
This is required now that it's in the separate directory.
Need to check whether they can be minimized, for now,
keep the code as is.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: d9fb58054825ef141e6d03f455654b2e3e767bce
      https://github.com/qemu/qemu/commit/d9fb58054825ef141e6d03f455654b2e3e767bce
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M Makefile
    M Makefile.target
    M Makefile.user
    R hw/pci/hw

  Log Message:
  -----------
  Revert "pci: prepare makefiles for pci code reorganization"

This reverts commit 475d67c3bcd6ba9fef917b6e59d96ae69eb1a9b4.

Now that all users have been updated, we don't need the
makefile hack or the softlink anymore.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 06aac7bd50cd934f416fe355633c045fee832905
      https://github.com/qemu/qemu/commit/06aac7bd50cd934f416fe355633c045fee832905
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M hw/apb_pci.c
    M hw/dec_pci.c
    M hw/ich9.h
    M hw/lpc_ich9.c
    M hw/pci/pci.c
    M hw/pci/pci_bridge.c
    A hw/pci/pci_bus.h
    R hw/pci/pci_internals.h
    M hw/pci/pcie.c
    M hw/pci/pcie_aer.c
    M hw/pci/pcie_port.h
    M hw/pci/shpc.c
    M hw/pci_bridge_dev.c
    M hw/spapr_pci.c

  Log Message:
  -----------
  pci: rename pci_internals.h pci_bus.h

There are lots of external users of pci_internals.h,
apparently making it an internal interface only didn't
work out. Let's stop pretending it's an internal header.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 952deab6cff5d6d81ff7a63955e958894c07177c
      https://github.com/qemu/qemu/commit/952deab6cff5d6d81ff7a63955e958894c07177c
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M hw/pci/pci_bus.h

  Log Message:
  -----------
  pci_bus: update comment

Don't ask everyone to desist from including this header,
simply recommend using accessors.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 2059946358999da80be22494af2d5c3174142902
      https://github.com/qemu/qemu/commit/2059946358999da80be22494af2d5c3174142902
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M hw/pci/pci_bus.h

  Log Message:
  -----------
  pci_bus.h: tweak include guards

Now that header has been renamed, tweak include guards
to match.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 1dd3a74d2ee2d873cde0b390b536e45420b3fe05
      https://github.com/qemu/qemu/commit/1dd3a74d2ee2d873cde0b390b536e45420b3fe05
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M kvm-all.c

  Log Message:
  -----------
  kvm: do not flush after deleting gsi

Deleting a GSI isn't necessary: it is enough
to stop using it. Delay flush until an entry is used.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 6f991980a5e96f93a9f676959df2dcba665665ef
      https://github.com/qemu/qemu/commit/6f991980a5e96f93a9f676959df2dcba665665ef
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M MAINTAINERS
    M Makefile.objs
    M arch_init.c
    M hw/Makefile.objs
    M hw/ac97.c
    M hw/acpi_ich9.c
    M hw/acpi_piix4.c
    M hw/alpha_sys.h
    M hw/apb_pci.c
    M hw/apic.c
    M hw/apm.c
    M hw/bonito.c
    M hw/cirrus_vga.c
    M hw/dec_pci.c
    M hw/e1000.c
    M hw/eepro100.c
    M hw/es1370.c
    M hw/esp-pci.c
    M hw/grackle_pci.c
    M hw/gt64xxx.c
    M hw/hda-audio.c
    M hw/i386/Makefile.objs
    M hw/i82378.c
    M hw/i82801b11.c
    M hw/ich9.h
    M hw/ide.h
    M hw/ide/ahci.c
    M hw/ide/cmd646.c
    M hw/ide/core.c
    M hw/ide/ich.c
    M hw/ide/pci.c
    M hw/ide/piix.c
    M hw/ide/via.c
    M hw/intel-hda.c
    M hw/ioh3420.c
    M hw/ioh3420.h
    M hw/ivshmem.c
    M hw/kvm/apic.c
    M hw/kvm/pci-assign.c
    M hw/lpc_ich9.c
    M hw/lsi53c895a.c
    M hw/macio.c
    M hw/megasas.c
    M hw/mips_fulong2e.c
    M hw/mips_malta.c
    R hw/msi.c
    R hw/msi.h
    R hw/msix.c
    R hw/msix.h
    M hw/ne2000.c
    M hw/openpic.c
    M hw/pc.c
    M hw/pc_piix.c
    R hw/pci-hotplug.c
    R hw/pci-stub.c
    R hw/pci.c
    R hw/pci.h
    A hw/pci/Makefile.objs
    A hw/pci/msi.c
    A hw/pci/msi.h
    A hw/pci/msix.c
    A hw/pci/msix.h
    A hw/pci/pci-hotplug.c
    A hw/pci/pci-stub.c
    A hw/pci/pci.c
    A hw/pci/pci.h
    A hw/pci/pci_bridge.c
    A hw/pci/pci_bridge.h
    A hw/pci/pci_bus.h
    A hw/pci/pci_host.c
    A hw/pci/pci_host.h
    A hw/pci/pci_ids.h
    A hw/pci/pci_regs.h
    A hw/pci/pcie.c
    A hw/pci/pcie.h
    A hw/pci/pcie_aer.c
    A hw/pci/pcie_aer.h
    A hw/pci/pcie_host.c
    A hw/pci/pcie_host.h
    A hw/pci/pcie_port.c
    A hw/pci/pcie_port.h
    A hw/pci/pcie_regs.h
    A hw/pci/shpc.c
    A hw/pci/shpc.h
    A hw/pci/slotid_cap.c
    A hw/pci/slotid_cap.h
    R hw/pci_bridge.c
    R hw/pci_bridge.h
    M hw/pci_bridge_dev.c
    R hw/pci_host.c
    R hw/pci_host.h
    R hw/pci_ids.h
    R hw/pci_internals.h
    R hw/pci_regs.h
    R hw/pcie.c
    R hw/pcie.h
    R hw/pcie_aer.c
    R hw/pcie_aer.h
    R hw/pcie_host.c
    R hw/pcie_host.h
    R hw/pcie_port.c
    R hw/pcie_port.h
    R hw/pcie_regs.h
    M hw/pcnet-pci.c
    M hw/piix4.c
    M hw/piix_pci.c
    M hw/ppc/Makefile.objs
    M hw/ppc/e500.c
    M hw/ppc440_bamboo.c
    M hw/ppc4xx.h
    M hw/ppc4xx_pci.c
    M hw/ppc_newworld.c
    M hw/ppc_oldworld.c
    M hw/ppc_prep.c
    M hw/ppce500_pci.c
    M hw/prep_pci.c
    M hw/q35.h
    M hw/qxl.h
    M hw/r2d.c
    M hw/realview.c
    M hw/rtl8139.c
    M hw/serial-pci.c
    M hw/sga.c
    M hw/sh_pci.c
    R hw/shpc.c
    R hw/shpc.h
    R hw/slotid_cap.c
    R hw/slotid_cap.h
    M hw/smbus_ich9.c
    M hw/spapr.c
    M hw/spapr_pci.c
    M hw/spapr_pci.h
    M hw/sun4u.c
    M hw/unin_pci.c
    M hw/usb/hcd-ehci-pci.c
    M hw/usb/hcd-ohci.c
    M hw/usb/hcd-uhci.c
    M hw/usb/hcd-xhci.c
    M hw/versatile_pci.c
    M hw/versatilepb.c
    M hw/vfio_pci.c
    M hw/vga-pci.c
    M hw/vga.c
    M hw/virtio-balloon.h
    M hw/virtio-net.h
    M hw/virtio-pci.c
    M hw/virtio-scsi.h
    M hw/vmware_vga.c
    M hw/vt82c686.c
    M hw/wdt_i6300esb.c
    M hw/xen-host-pci-device.h
    M hw/xen_apic.c
    M hw/xen_platform.c
    M hw/xen_pt.c
    M hw/xen_pt.h
    M hw/xio3130_downstream.c
    M hw/xio3130_downstream.h
    M hw/xio3130_upstream.c
    M hw/xio3130_upstream.h
    M kvm-all.c
    M kvm-stub.c
    M monitor.c
    M net/tap-linux.c
    M scripts/get_maintainer.pl
    M target-i386/kvm.c
    M xen-all.c

  Log Message:
  -----------
  Merge commit '1dd3a74d2ee2d873cde0b390b536e45420b3fe05' into HEAD

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 5f0cef1aa92b98610a99125d1d1d80e9339ac7c5
      https://github.com/qemu/qemu/commit/5f0cef1aa92b98610a99125d1d1d80e9339ac7c5
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-17 (Mon, 17 Dec 2012)

  Changed paths:
    M Makefile

  Log Message:
  -----------
  libcacard: simplify rules for recursive build

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 7937e75b1aba66cf24c93e58c48cbb4d59d1c19c
      https://github.com/qemu/qemu/commit/7937e75b1aba66cf24c93e58c48cbb4d59d1c19c
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M Makefile

  Log Message:
  -----------
  vscclient: use per-target variables

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 9d9199a003b7531257836d5abb0b30c250303885
      https://github.com/qemu/qemu/commit/9d9199a003b7531257836d5abb0b30c250303885
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M Makefile
    M configure
    M rules.mak

  Log Message:
  -----------
  build: adjust setting of QEMU_INCLUDES

Make it correct for nested directories, and move the static part
from Makefile to configure.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 4e8cb28c4b536bf408c1ba01710e2a7644e144e5
      https://github.com/qemu/qemu/commit/4e8cb28c4b536bf408c1ba01710e2a7644e144e5
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M rules.mak

  Log Message:
  -----------
  build: add $(TARGET_DIR) to "GEN config-target.h" lines

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 525877c9992a07d424be4cfdd4ba13a69141a513
      https://github.com/qemu/qemu/commit/525877c9992a07d424be4cfdd4ba13a69141a513
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M Makefile
    M audio/Makefile.objs
    M block/Makefile.objs
    M hw/Makefile.objs
    M ui/Makefile.objs

  Log Message:
  -----------
  build: move rules from Makefile to */Makefile.objs

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: c1c9367216c97ca93de79e90822045a425d7e76d
      https://github.com/qemu/qemu/commit/c1c9367216c97ca93de79e90822045a425d7e76d
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    R alpha.ld
    R arm.ld
    M configure
    R hppa.ld
    R i386.ld
    R ia64.ld
    A ldscripts/alpha.ld
    A ldscripts/arm.ld
    A ldscripts/hppa.ld
    A ldscripts/i386.ld
    A ldscripts/ia64.ld
    A ldscripts/m68k.ld
    A ldscripts/mips.ld
    A ldscripts/ppc.ld
    A ldscripts/ppc64.ld
    A ldscripts/s390.ld
    A ldscripts/sparc.ld
    A ldscripts/sparc64.ld
    A ldscripts/x86_64.ld
    R m68k.ld
    R mips.ld
    R ppc.ld
    R ppc64.ld
    R s390.ld
    R sparc.ld
    R sparc64.ld
    R x86_64.ld

  Log Message:
  -----------
  build: create ldscripts/

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 76cad71136b7eb371cf2a2a4e1621cfe8d9c769a
      https://github.com/qemu/qemu/commit/76cad71136b7eb371cf2a2a4e1621cfe8d9c769a
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M .gitignore
    M Makefile
    R Makefile.dis
    M Makefile.objs
    M Makefile.target
    R alpha-dis.c
    R arm-dis.c
    M bsd-user/elfload.c
    M configure
    M cpu-exec.c
    R cris-dis.c
    R dis-asm.h
    M disas.c
    R disas.h
    A disas/Makefile.objs
    A disas/alpha.c
    A disas/arm.c
    A disas/cris.c
    A disas/hppa.c
    A disas/i386.c
    A disas/ia64.c
    A disas/lm32.c
    A disas/m68k.c
    A disas/microblaze.c
    A disas/mips.c
    A disas/ppc.c
    A disas/s390.c
    A disas/sh4.c
    A disas/sparc.c
    A disas/tci.c
    R hppa-dis.c
    M hw/loader.c
    R i386-dis.c
    R ia64-dis.c
    A include/disas/bfd.h
    A include/disas/disas.h
    M linux-user/elfload.c
    R lm32-dis.c
    R m68k-dis.c
    R microblaze-dis.c
    R mips-dis.c
    M monitor.c
    R ppc-dis.c
    M qemu-log.h
    R s390-dis.c
    R sh4-dis.c
    R sparc-dis.c
    M target-alpha/translate.c
    M target-arm/translate.c
    M target-cris/translate.c
    M target-i386/translate.c
    M target-lm32/translate.c
    M target-m68k/translate.c
    M target-microblaze/helper.c
    M target-microblaze/translate.c
    M target-mips/translate.c
    M target-openrisc/translate.c
    M target-ppc/translate.c
    M target-ppc/translate_init.c
    M target-s390x/translate.c
    M target-sh4/translate.c
    M target-sparc/translate.c
    M target-unicore32/translate.c
    M target-xtensa/translate.c
    R tci-dis.c
    M translate-all.c
    M user-exec.c
    M vl.c

  Log Message:
  -----------
  build: kill libdis, move disassemblers to disas/

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 8e98e2e80b92e08e79e27a0c20a172906cfa12d2
      https://github.com/qemu/qemu/commit/8e98e2e80b92e08e79e27a0c20a172906cfa12d2
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M Makefile
    M Makefile.objs
    M Makefile.target
    R Makefile.user
    M configure

  Log Message:
  -----------
  build: kill libuser

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 077805fa92b9089137c6b6b196d449ee05cc342f
      https://github.com/qemu/qemu/commit/077805fa92b9089137c6b6b196d449ee05cc342f
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M arch_init.c
    M audio/alsaaudio.c
    M audio/ossaudio.c
    M block/blkdebug.c
    M block/iscsi.c
    M bt-host.c
    M bt-vhci.c
    M event_notifier-posix.c
    M exec.c
    M hw/arm_boot.c
    M hw/dma.c
    M hw/fw_cfg.c
    M hw/jazz_led.c
    M hw/mac_dbdma.c
    M hw/ppc/e500.c
    M hw/puv3.c
    M hw/qdev-monitor.c
    M hw/qdev-properties.c
    M hw/s390x/sclpconsole.c
    M hw/spapr.c
    M hw/tcx.c
    M hw/usb/dev-network.c
    M net.c
    M qemu-config.h
    M spice-qemu-char.c
    M target-i386/kvm.c

  Log Message:
  -----------
  janitor: do not rely on indirect inclusions of or from qemu-char.h

Various header files rely on qemu-char.h including qemu-config.h or
main-loop.h, but they really do not need qemu-char.h at all (particularly
interesting is the case of the block layer!).  Clean this up, and also
add missing inclusions of qemu-char.h itself.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: f8fe796407d8b340def61a6b57991e47aee3cfc4
      https://github.com/qemu/qemu/commit/f8fe796407d8b340def61a6b57991e47aee3cfc4
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M audio/alsaaudio.c
    M audio/ossaudio.c
    M block/raw-posix.c
    M bt-host.c
    M bt-vhci.c
    M buffered_file.c
    M console.c
    M console.h
    M hmp.c
    M hw/9pfs/virtio-9p-coth.c
    M hw/ivshmem.c
    M hw/spapr_hcall.c
    M hw/strongarm.c
    M hw/xen_disk.c
    M hw/xen_nic.c
    M hw/xilinx_axidma.c
    M hw/xilinx_axienet.c
    M hw/xtensa_lx60.c
    M iohandler.c
    M migration-exec.c
    M migration-fd.c
    M migration-tcp.c
    M migration-unix.c
    M monitor.h
    M net/slirp.c
    M net/socket.c
    M net/tap.c
    M net/vde.c
    M qmp.c
    M savevm.c
    M ui/qemu-spice.h

  Log Message:
  -----------
  janitor: do not include qemu-char everywhere

Touching char/char.h basically causes the whole of QEMU to
be rebuilt.  Avoid this, it is usually unnecessary.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 090f7ac5ba433ef9de7004b8e8304d06bd9ffd7d
      https://github.com/qemu/qemu/commit/090f7ac5ba433ef9de7004b8e8304d06bd9ffd7d
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M bt-host.c
    M bt-host.h
    M bt-vhci.c
    M hw/bt-hci-csr.c
    M hw/bt-hci.c
    M hw/bt.c
    M hw/usb/dev-bluetooth.c
    M net.h

  Log Message:
  -----------
  net: move Bluetooth stuff out of net.h

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 7fa22f2bf7a06d5345283a00a7c6d86b8a345228
      https://github.com/qemu/qemu/commit/7fa22f2bf7a06d5345283a00a7c6d86b8a345228
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M arch_init.c
    M hw/alpha_sys.h
    M hw/device-hotplug.c
    M hw/lm32_boards.c
    M hw/milkymist-hw.h
    M hw/milkymist.c
    M hw/s390-virtio-bus.c
    M hw/spapr_vscsi.c
    M hw/virtex_ml507.c
    M hw/virtio-net.h
    M hw/virtio-pci.c
    M hw/virtio-scsi.h
    M hw/xen_backend.h
    M hw/xen_platform.c
    M input.c
    M qemu-char.c
    M qemu-timer.c

  Log Message:
  -----------
  net: do not include net.h everywhere

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: fd9400b302ef582c3ae8a8d5288338ea5f0f4c9a
      https://github.com/qemu/qemu/commit/fd9400b302ef582c3ae8a8d5288338ea5f0f4c9a
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M Makefile.objs
    R net.c
    M net/Makefile.objs
    A net/net.c

  Log Message:
  -----------
  net: move net.c to net/

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 1422e32db51ff2b1194fb24a6201c4310be5667d
      https://github.com/qemu/qemu/commit/1422e32db51ff2b1194fb24a6201c4310be5667d
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M hmp.c
    M hw/axis_dev88.c
    M hw/cadence_gem.c
    M hw/dp8393x.c
    M hw/e1000.c
    M hw/eepro100.c
    M hw/etraxfs.h
    M hw/etraxfs_eth.c
    M hw/exynos4_boards.c
    M hw/gumstix.c
    M hw/highbank.c
    M hw/integratorcp.c
    M hw/kzm.c
    M hw/lan9118.c
    M hw/lance.c
    M hw/mainstone.c
    M hw/mcf5208.c
    M hw/mcf_fec.c
    M hw/milkymist-hw.h
    M hw/milkymist-minimac2.c
    M hw/mips_fulong2e.c
    M hw/mips_jazz.c
    M hw/mips_malta.c
    M hw/mips_mipssim.c
    M hw/mips_r4k.c
    M hw/mipsnet.c
    M hw/musicpal.c
    M hw/ne2000-isa.c
    M hw/ne2000.c
    M hw/opencores_eth.c
    M hw/openrisc_sim.c
    M hw/pc.h
    M hw/pc_piix.c
    M hw/pci/pci-hotplug.c
    M hw/pci/pci.c
    M hw/pcnet-pci.c
    M hw/pcnet.c
    M hw/petalogix_ml605_mmu.c
    M hw/petalogix_s3adsp1800_mmu.c
    M hw/ppc/e500.c
    M hw/ppc440_bamboo.c
    M hw/ppc_newworld.c
    M hw/ppc_oldworld.c
    M hw/ppc_prep.c
    M hw/qdev-properties.c
    M hw/qdev.c
    M hw/r2d.c
    M hw/realview.c
    M hw/rtl8139.c
    M hw/s390-virtio.c
    M hw/smc91c111.c
    M hw/spapr.c
    M hw/spapr_llan.c
    M hw/stellaris.c
    M hw/stellaris_enet.c
    M hw/sun4m.c
    M hw/sun4u.c
    M hw/usb/dev-network.c
    M hw/versatilepb.c
    M hw/vexpress.c
    M hw/vhost_net.c
    M hw/vhost_net.h
    M hw/virtio-net.c
    M hw/virtio-net.h
    M hw/virtio.h
    M hw/xen_backend.h
    M hw/xen_nic.c
    M hw/xgmac.c
    M hw/xilinx.h
    M hw/xilinx_axienet.c
    M hw/xilinx_ethlite.c
    M hw/xilinx_zynq.c
    M hw/xtensa_lx60.c
    A include/net/checksum.h
    A include/net/net.h
    A include/net/queue.h
    A include/net/slirp.h
    A include/net/tap.h
    M monitor.c
    R net.h
    R net/checksum.h
    M net/clients.h
    M net/hub.c
    M net/hub.h
    M net/net.c
    M net/queue.c
    R net/queue.h
    M net/slirp.c
    R net/slirp.h
    M net/socket.c
    M net/tap-aix.c
    M net/tap-bsd.c
    M net/tap-haiku.c
    M net/tap-linux.c
    M net/tap-linux.h
    M net/tap-solaris.c
    M net/tap-win32.c
    M net/tap.c
    R net/tap.h
    A net/tap_int.h
    M net/util.c
    M net/vde.c
    M savevm.c
    M vl.c

  Log Message:
  -----------
  net: reorganize headers

Move public headers to include/net, and leave private headers in net/.
Put the virtio headers in include/net/tap.h, removing the multiple copies
that existed.  Leave include/net/tap.h as the interface for NICs, and
net/tap_int.h as the interface for OS-specific parts of the tap backend.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 2870dc3456c9c02debb63b0a99b3dcbbf74a1048
      https://github.com/qemu/qemu/commit/2870dc3456c9c02debb63b0a99b3dcbbf74a1048
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M Makefile
    M Makefile.objs
    R qapi-schema-guest.json
    R qemu-ga.c
    M qga/Makefile.objs
    A qga/main.c
    A qga/qapi-schema.json

  Log Message:
  -----------
  qemu-ga: move qemu-ga files to qga/

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 28ecbaeecb139a214f019207402a35d7b58aec0f
      https://github.com/qemu/qemu/commit/28ecbaeecb139a214f019207402a35d7b58aec0f
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M Makefile.objs
    R console.c
    R console.h
    R cursor.c
    R cursor_hidden.xpm
    R cursor_left_ptr.xpm
    M hmp.c
    M hw/adb.c
    M hw/ads7846.c
    M hw/applesmc.c
    M hw/blizzard.c
    M hw/bt-hid.c
    M hw/cirrus_vga.c
    M hw/escc.c
    M hw/exynos4210_fimd.c
    M hw/framebuffer.c
    M hw/g364fb.c
    M hw/hid.c
    M hw/hpet.c
    M hw/jazz_led.c
    M hw/kvm/pci-assign.c
    M hw/lm832x.c
    M hw/milkymist-softusb.c
    M hw/milkymist-vgafb.c
    M hw/msmouse.c
    M hw/musicpal.c
    M hw/nseries.c
    M hw/omap_dss.c
    M hw/omap_lcdc.c
    M hw/omap_sx1.c
    M hw/palm.c
    R hw/pixel_ops.h
    M hw/pl110.c
    M hw/ps2.c
    M hw/puv3.c
    M hw/pxa2xx_keypad.c
    M hw/pxa2xx_lcd.c
    M hw/qxl.h
    M hw/sm501.c
    M hw/spitz.c
    M hw/ssd0303.c
    M hw/ssd0323.c
    M hw/stellaris_input.c
    M hw/tc6393xb.c
    M hw/tcx.c
    M hw/tsc2005.c
    M hw/tsc210x.c
    M hw/twl92230.c
    M hw/usb/dev-hid.c
    M hw/usb/dev-storage.c
    M hw/usb/dev-wacom.c
    M hw/usb/host-stub.c
    M hw/vga-isa-mm.c
    M hw/vga-isa.c
    M hw/vga-pci.c
    M hw/vga.c
    M hw/vmmouse.c
    M hw/vmware_vga.c
    M hw/xenfb.c
    M hw/z2.c
    A include/ui/console.h
    A include/ui/pixel_ops.h
    A include/ui/qemu-pixman.h
    A include/ui/qemu-spice.h
    A include/ui/spice-display.h
    R input.c
    M monitor.c
    M qemu-char.c
    R qemu-pixman.c
    R qemu-pixman.h
    M qemu-timer.c
    R qemu-x509.h
    M target-unicore32/helper.c
    M ui/Makefile.objs
    M ui/cocoa.m
    A ui/console.c
    M ui/curses.c
    A ui/cursor.c
    A ui/cursor_hidden.xpm
    A ui/cursor_left_ptr.xpm
    A ui/input.c
    A ui/qemu-pixman.c
    R ui/qemu-spice.h
    A ui/qemu-x509.h
    M ui/sdl.c
    M ui/spice-core.c
    M ui/spice-display.c
    R ui/spice-display.h
    M ui/spice-input.c
    A ui/vgafont.h
    M ui/vnc.h
    R vgafont.h
    M vl.c

  Log Message:
  -----------
  ui: move files to ui/ and include/ui/

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 79ee7df8853c5d7085d87036420b6b388dda2595
      https://github.com/qemu/qemu/commit/79ee7df8853c5d7085d87036420b6b388dda2595
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M qapi/opts-visitor.c
    M qapi/qapi-types-core.h
    M qapi/qapi-visit-core.c
    M qemu-error.h
    M scripts/qapi-commands.py
    M scripts/qapi-visit.py
    M tests/test-qmp-commands.c
    M tests/test-qmp-input-strict.c
    M tests/test-qmp-input-visitor.c
    M tests/test-qmp-output-visitor.c
    M tests/test-string-input-visitor.c
    M tests/test-string-output-visitor.c
    M tests/test-visitor-serialization.c

  Log Message:
  -----------
  qapi: move inclusions of qemu-common.h from headers to .c files

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 4167c42c5eb79add9252547efe92df7e5c2d1abd
      https://github.com/qemu/qemu/commit/4167c42c5eb79add9252547efe92df7e5c2d1abd
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M qapi/opts-visitor.c
    M qapi/qapi-dealloc-visitor.c
    R qapi/qapi-types-core.h
    M qapi/qapi-visit-core.c
    M qapi/qapi-visit-core.h
    M qapi/qapi-visit-impl.h
    M qemu-option-internal.h
    M qom/object.c
    M scripts/qapi-commands.py
    M target-i386/cpu.c

  Log Message:
  -----------
  qapi: remove qapi/qapi-types-core.h

The file is only including error.h and qerror.h.  Prefer explicit
inclusion of whatever files are needed.
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 7edd63f1b179c18f0f1a4664ddbabe4fe5b2be2f
      https://github.com/qemu/qemu/commit/7edd63f1b179c18f0f1a4664ddbabe4fe5b2be2f
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M qapi/qapi-visit-core.h
    M qapi/qapi-visit-impl.h

  Log Message:
  -----------
  qapi: make struct Visitor opaque

Move its definition from qapi-visit-core.h to qapi-visit-impl.h.
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: cb9c377f54a756b04ef92c1c2e0453613ee863cf
      https://github.com/qemu/qemu/commit/cb9c377f54a756b04ef92c1c2e0453613ee863cf
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M gen-icount.h
    M host-utils.h
    M hw/9pfs/virtio-9p-synth.h
    M hw/audiodev.h
    M hw/baum.h
    M hw/bt.h
    M hw/cris-boot.h
    M hw/empty_slot.h
    M hw/escc.h
    M hw/etraxfs.h
    M hw/etraxfs_dma.h
    M hw/flash.h
    M hw/lm32.h
    M hw/mac_dbdma.h
    M hw/msmouse.h
    M hw/ne2000.h
    M hw/pci/pci_ids.h
    M hw/pcmcia.h
    M hw/pcnet.h
    M hw/ppc.h
    M hw/qdev-addr.h
    M hw/qxl.h
    M hw/s390-virtio-bus.h
    M hw/scsi-defs.h
    M hw/serial.h
    M hw/soc_dma.h
    M hw/usb/hcd-ehci.h
    M hw/vga_int.h
    M hw/xilinx.h
    M iov.h
    M linux-user/cris/syscall.h
    M linux-user/microblaze/syscall.h
    M linux-user/syscall_defs.h
    M slirp/bootp.h
    M slirp/main.h
    M slirp/tftp.h
    M softmmu-semi.h
    M target-cris/crisv32-decode.h
    M tcg/arm/tcg-target.h
    M tcg/hppa/tcg-target.h
    M tcg/i386/tcg-target.h
    M tcg/ia64/tcg-target.h
    M tcg/mips/tcg-target.h
    M tcg/ppc/tcg-target.h
    M tcg/ppc64/tcg-target.h
    M tcg/s390/tcg-target.h
    M tcg/sparc/tcg-target.h
    M tests/tcg/cris/crisutils.h
    M ui/curses_keys.h
    M ui/d3des.h

  Log Message:
  -----------
  janitor: add guards to headers

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 7b1b5d191385ca52e96caae2a05c64f3a63855d9
      https://github.com/qemu/qemu/commit/7b1b5d191385ca52e96caae2a05c64f3a63855d9
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M backends/rng-egd.c
    M backends/rng-random.c
    M backends/rng.c
    M balloon.c
    M block.c
    M block.h
    M block/qcow2.c
    M block/qed.c
    M block_int.h
    M blockdev-nbd.c
    M blockdev.c
    M blockdev.h
    M blockjob.c
    M dump-stub.c
    M dump.c
    M error.c
    R error.h
    M hmp.h
    M hw/ivshmem.c
    M hw/mc146818rtc.c
    M hw/pci/pci-hotplug.c
    M hw/pci/pcie_aer.c
    M hw/qdev-addr.c
    M hw/qdev-core.h
    M hw/qdev-properties.c
    M hw/qdev.c
    M hw/vga_int.h
    M hw/watchdog.c
    M include/net/net.h
    M include/net/slirp.h
    A include/qapi/dealloc-visitor.h
    A include/qapi/error.h
    A include/qapi/opts-visitor.h
    A include/qapi/qmp-input-visitor.h
    A include/qapi/qmp-output-visitor.h
    A include/qapi/qmp/dispatch.h
    A include/qapi/qmp/json-lexer.h
    A include/qapi/qmp/json-parser.h
    A include/qapi/qmp/json-streamer.h
    A include/qapi/qmp/qbool.h
    A include/qapi/qmp/qdict.h
    A include/qapi/qmp/qerror.h
    A include/qapi/qmp/qfloat.h
    A include/qapi/qmp/qint.h
    A include/qapi/qmp/qjson.h
    A include/qapi/qmp/qlist.h
    A include/qapi/qmp/qobject.h
    A include/qapi/qmp/qstring.h
    A include/qapi/qmp/types.h
    A include/qapi/string-input-visitor.h
    A include/qapi/string-output-visitor.h
    A include/qapi/visitor-impl.h
    A include/qapi/visitor.h
    M include/qemu/rng.h
    M include/ui/console.h
    M json-lexer.c
    R json-lexer.h
    M json-parser.c
    R json-parser.h
    M json-streamer.c
    R json-streamer.h
    M migration.h
    M monitor.c
    M monitor.h
    M net/net.c
    M pixman
    M qapi/opts-visitor.c
    R qapi/opts-visitor.h
    M qapi/qapi-dealloc-visitor.c
    R qapi/qapi-dealloc-visitor.h
    M qapi/qapi-visit-core.c
    R qapi/qapi-visit-core.h
    R qapi/qapi-visit-impl.h
    R qapi/qmp-core.h
    M qapi/qmp-dispatch.c
    M qapi/qmp-input-visitor.c
    R qapi/qmp-input-visitor.h
    M qapi/qmp-output-visitor.c
    R qapi/qmp-output-visitor.h
    M qapi/qmp-registry.c
    M qapi/string-input-visitor.c
    R qapi/string-input-visitor.h
    M qapi/string-output-visitor.c
    R qapi/string-output-visitor.h
    M qbool.c
    R qbool.h
    M qdict.c
    R qdict.h
    M qemu-char.h
    M qemu-config.c
    M qemu-config.h
    M qemu-img.c
    R qemu-objects.h
    M qemu-option.c
    M qemu-option.h
    M qemu_socket.h
    M qerror.c
    R qerror.h
    M qfloat.c
    R qfloat.h
    M qga/commands-posix.c
    M qga/commands-win32.c
    M qga/commands.c
    M qga/guest-agent-core.h
    M qga/main.c
    M qint.c
    R qint.h
    M qjson.c
    R qjson.h
    M qlist.c
    R qlist.h
    R qobject.h
    M qom/object.c
    M qom/qom-qobject.c
    M qstring.c
    R qstring.h
    M scripts/qapi-commands.py
    M scripts/qapi-types.py
    M scripts/qapi-visit.py
    M stubs/arch-query-cpu-def.c
    M target-i386/cpu-qom.h
    M target-i386/cpu.c
    M target-openrisc/cpu.h
    M tests/check-qdict.c
    M tests/check-qfloat.c
    M tests/check-qint.c
    M tests/check-qjson.c
    M tests/check-qlist.c
    M tests/check-qstring.c
    M tests/test-qmp-commands.c
    M tests/test-qmp-input-strict.c
    M tests/test-qmp-input-visitor.c
    M tests/test-qmp-output-visitor.c
    M tests/test-string-input-visitor.c
    M tests/test-string-output-visitor.c
    M tests/test-visitor-serialization.c
    M ui/input.c
    M ui/spice-core.c
    M ui/vnc-enc-tight.c
    M ui/vnc-palette.h
    M ui/vnc.c
    M vl.c

  Log Message:
  -----------
  qapi: move include files to include/qobject/

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 737e150e89c44c6b33691a627e24bac7fb58f349
      https://github.com/qemu/qemu/commit/737e150e89c44c6b33691a627e24bac7fb58f349
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M aes.c
    R aes.h
    M aio-posix.c
    M aio-win32.c
    M async.c
    M block-migration.c
    M block.c
    R block.h
    M block/blkdebug.c
    M block/blkverify.c
    M block/bochs.c
    M block/cloop.c
    M block/commit.c
    M block/cow.c
    M block/curl.c
    M block/dmg.c
    M block/gluster.c
    M block/iscsi.c
    M block/linux-aio.c
    M block/mirror.c
    M block/nbd.c
    M block/parallels.c
    M block/qcow.c
    M block/qcow2-cache.c
    M block/qcow2-cluster.c
    M block/qcow2-refcount.c
    M block/qcow2-snapshot.c
    M block/qcow2.c
    M block/qcow2.h
    M block/qed.h
    M block/raw-posix.c
    M block/raw-win32.c
    M block/raw.c
    M block/rbd.c
    M block/sheepdog.c
    M block/stream.c
    M block/vdi.c
    M block/vmdk.c
    M block/vpc.c
    M block/vvfat.c
    M block/win32-aio.c
    R block_int.h
    M blockdev-nbd.c
    M blockdev.c
    M blockdev.h
    M blockjob.c
    R blockjob.h
    M cmd.c
    M coroutine-gthread.c
    M coroutine-sigaltstack.c
    M coroutine-ucontext.c
    M coroutine-win32.c
    M dma.h
    M hw/9pfs/codir.c
    M hw/9pfs/cofile.c
    M hw/9pfs/cofs.c
    M hw/9pfs/coxattr.c
    M hw/9pfs/virtio-9p-coth.c
    M hw/9pfs/virtio-9p-coth.h
    M hw/9pfs/virtio-9p.h
    M hw/hd-geometry.c
    M hw/hw.h
    M hw/ide/cmd646.c
    M hw/ide/ich.c
    M hw/ide/isa.c
    M hw/ide/macio.c
    M hw/ide/microdrive.c
    M hw/ide/mmio.c
    M hw/ide/pci.c
    M hw/ide/via.c
    M hw/mips_fulong2e.c
    M hw/mips_malta.c
    M hw/musicpal.c
    M hw/pflash_cfi01.c
    M hw/pflash_cfi02.c
    M hw/ppc405_boards.c
    M hw/s390-virtio-bus.c
    M hw/s390-virtio.c
    M hw/scsi.h
    M hw/sd.c
    M hw/spitz.c
    M hw/tosa.c
    A include/block/aes.h
    A include/block/aio.h
    A include/block/block.h
    A include/block/block_int.h
    A include/block/blockjob.h
    A include/block/coroutine.h
    A include/block/coroutine_int.h
    A include/block/nbd.h
    A include/block/thread-pool.h
    M iohandler.c
    M main-loop.c
    M main-loop.h
    M migration-exec.c
    M migration-fd.c
    M migration-tcp.c
    M migration-unix.c
    M migration.c
    M monitor.h
    M nbd.c
    R nbd.h
    R qemu-aio.h
    M qemu-char.h
    R qemu-coroutine-int.h
    M qemu-coroutine-io.c
    M qemu-coroutine-lock.c
    M qemu-coroutine-sleep.c
    M qemu-coroutine.c
    R qemu-coroutine.h
    M qemu-img.c
    M qemu-io.c
    M qemu-nbd.c
    M tests/test-aio.c
    M tests/test-coroutine.c
    M tests/test-thread-pool.c
    M thread-pool.c
    R thread-pool.h

  Log Message:
  -----------
  block: move include files to include/block/

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 022c62cbbcf1ff40b23c92874f8670cddfec2414
      https://github.com/qemu/qemu/commit/022c62cbbcf1ff40b23c92874f8670cddfec2414
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M arch_init.c
    M balloon.c
    M bsd-user/qemu.h
    R cpu-all.h
    R cpu-common.h
    R cpu-defs.h
    M cpus.c
    M cputlb.c
    R cputlb.h
    R def-helper.h
    M dma.h
    M dump.c
    R exec-all.h
    R exec-memory.h
    M exec.c
    M gdbstub.c
    R gdbstub.h
    R gen-icount.h
    M hw/acpi_ich9.c
    M hw/acpi_piix4.c
    M hw/alpha_typhoon.c
    M hw/an5206.c
    M hw/apb_pci.c
    M hw/apic_internal.h
    M hw/apm.h
    M hw/arm-misc.h
    M hw/armv7m_nvic.c
    M hw/axis_dev88.c
    M hw/bonito.c
    M hw/collie.c
    M hw/dummy_m68k.c
    M hw/etraxfs_dma.c
    M hw/exynos4210.h
    M hw/exynos4210_fimd.c
    M hw/exynos4_boards.c
    M hw/flash.h
    M hw/framebuffer.h
    M hw/gt64xxx.c
    M hw/gumstix.c
    M hw/highbank.c
    M hw/hw.h
    M hw/ide.h
    M hw/ide/ahci.c
    M hw/ide/internal.h
    M hw/integratorcp.c
    M hw/ioapic_internal.h
    M hw/isa-bus.c
    M hw/isa.h
    M hw/isa_mmio.c
    M hw/kzm.c
    M hw/leon3.c
    M hw/lm32_boards.c
    M hw/loader.c
    M hw/lpc_ich9.c
    M hw/m48t59.c
    M hw/mac_dbdma.h
    M hw/mainstone.c
    M hw/mcf5206.c
    M hw/mcf5208.c
    M hw/mcf_fec.c
    M hw/mcf_intc.c
    M hw/mcf_uart.c
    M hw/milkymist.c
    M hw/mips.h
    M hw/mips_fulong2e.c
    M hw/mips_jazz.c
    M hw/mips_malta.c
    M hw/mips_mipssim.c
    M hw/mips_r4k.c
    M hw/musicpal.c
    M hw/ne2000-isa.c
    M hw/nseries.c
    M hw/omap.h
    M hw/omap_gpmc.c
    M hw/omap_sx1.c
    M hw/omap_uart.c
    M hw/onenand.c
    M hw/openrisc_sim.c
    M hw/palm.c
    M hw/pam.h
    M hw/pc.c
    M hw/pc.h
    M hw/pc_piix.c
    M hw/pc_q35.c
    M hw/pci/pci.c
    M hw/pci/pci.h
    M hw/pci/pcie_host.c
    M hw/pci/pcie_host.h
    M hw/pci/shpc.h
    M hw/pci_bridge_dev.c
    M hw/pcnet.h
    M hw/petalogix_ml605_mmu.c
    M hw/petalogix_s3adsp1800_mmu.c
    M hw/pflash_cfi01.c
    M hw/pflash_cfi02.c
    M hw/ppc/e500.c
    M hw/ppc405_boards.c
    M hw/ppc405_uc.c
    M hw/ppc440_bamboo.c
    M hw/ppc4xx_devs.c
    M hw/ppc4xx_pci.c
    M hw/ppc_mac.h
    M hw/ppc_newworld.c
    M hw/ppc_oldworld.c
    M hw/ppc_prep.c
    M hw/ppce500_pci.c
    M hw/prep_pci.c
    M hw/puv3.c
    M hw/pxa.h
    M hw/qdev-addr.c
    M hw/r2d.c
    M hw/realview.c
    M hw/s390-virtio.c
    M hw/s390x/sclp.c
    M hw/serial.c
    M hw/serial.h
    M hw/sh7750.c
    M hw/sh_intc.h
    M hw/sh_pci.c
    M hw/sh_serial.c
    M hw/sh_timer.c
    M hw/shix.c
    M hw/soc_dma.h
    M hw/spapr.c
    M hw/spapr_iommu.c
    M hw/spapr_pci.c
    M hw/spitz.c
    M hw/stellaris.c
    M hw/strongarm.h
    M hw/sun4u.c
    M hw/sysbus.c
    M hw/sysbus.h
    M hw/tosa.c
    M hw/usb/libhw.c
    M hw/versatile_pci.c
    M hw/versatilepb.c
    M hw/vexpress.c
    M hw/vfio_pci.c
    M hw/vga_int.h
    M hw/vhost.c
    M hw/vhost.h
    M hw/virtex_ml507.c
    M hw/virtio-balloon.c
    M hw/vt82c686.c
    M hw/xen_platform.c
    M hw/xen_pt.c
    M hw/xilinx_zynq.c
    M hw/xtensa_lx60.c
    M hw/xtensa_sim.c
    M hw/z2.c
    R hwaddr.h
    A include/exec/address-spaces.h
    A include/exec/cpu-all.h
    A include/exec/cpu-common.h
    A include/exec/cpu-defs.h
    A include/exec/cputlb.h
    A include/exec/def-helper.h
    A include/exec/exec-all.h
    A include/exec/gdbstub.h
    A include/exec/gen-icount.h
    A include/exec/hwaddr.h
    A include/exec/ioport.h
    A include/exec/iorange.h
    A include/exec/memory-internal.h
    A include/exec/memory.h
    A include/exec/poison.h
    A include/exec/softmmu-semi.h
    A include/exec/softmmu_defs.h
    A include/exec/softmmu_exec.h
    A include/exec/softmmu_header.h
    A include/exec/softmmu_template.h
    A include/exec/spinlock.h
    A include/exec/user/abitypes.h
    A include/exec/user/thunk.h
    M ioport.c
    R ioport.h
    R iorange.h
    M kvm-all.c
    M kvm-stub.c
    M linux-user/qemu.h
    R memory-internal.h
    M memory.c
    R memory.h
    M memory_mapping-stub.c
    M memory_mapping.c
    M monitor.c
    R poison.h
    R qemu-lock.h
    R qemu-user-types.h
    M qtest.c
    M savevm.c
    M scripts/feature_to_c.sh
    R softmmu-semi.h
    R softmmu_defs.h
    R softmmu_exec.h
    R softmmu_header.h
    R softmmu_template.h
    M target-alpha/cpu.h
    M target-alpha/helper.h
    M target-alpha/mem_helper.c
    M target-alpha/translate.c
    M target-arm/arm-semi.c
    M target-arm/cpu.h
    M target-arm/helper.c
    M target-arm/helper.h
    M target-arm/iwmmxt_helper.c
    M target-arm/neon_helper.c
    M target-arm/op_helper.c
    M target-arm/translate.c
    M target-cris/cpu.h
    M target-cris/helper.h
    M target-cris/op_helper.c
    M target-cris/translate.c
    M target-i386/arch_dump.c
    M target-i386/arch_memory_mapping.c
    M target-i386/cpu.h
    M target-i386/fpu_helper.c
    M target-i386/helper.h
    M target-i386/ioport-user.c
    M target-i386/kvm.c
    M target-i386/mem_helper.c
    M target-i386/misc_helper.c
    M target-i386/seg_helper.c
    M target-i386/svm_helper.c
    M target-i386/translate.c
    M target-lm32/cpu.h
    M target-lm32/helper.h
    M target-lm32/op_helper.c
    M target-lm32/translate.c
    M target-m68k/cpu.h
    M target-m68k/helper.c
    M target-m68k/helpers.h
    M target-m68k/m68k-semi.c
    M target-m68k/op_helper.c
    M target-m68k/translate.c
    M target-microblaze/cpu.h
    M target-microblaze/helper.h
    M target-microblaze/op_helper.c
    M target-microblaze/translate.c
    M target-mips/cpu.h
    M target-mips/helper.h
    M target-mips/op_helper.c
    M target-mips/translate.c
    M target-openrisc/cpu.h
    M target-openrisc/helper.h
    M target-openrisc/interrupt.c
    M target-openrisc/mmu.c
    M target-openrisc/mmu_helper.c
    M target-openrisc/translate.c
    M target-ppc/cpu.h
    M target-ppc/helper.h
    M target-ppc/kvm_ppc.h
    M target-ppc/mem_helper.c
    M target-ppc/translate.c
    M target-ppc/translate_init.c
    M target-s390x/cpu.h
    M target-s390x/fpu_helper.c
    M target-s390x/helper.c
    M target-s390x/helper.h
    M target-s390x/mem_helper.c
    M target-s390x/misc_helper.c
    M target-s390x/translate.c
    M target-sh4/cpu.h
    M target-sh4/helper.h
    M target-sh4/op_helper.c
    M target-sh4/translate.c
    M target-sparc/cpu.h
    M target-sparc/helper.h
    M target-sparc/ldst_helper.c
    M target-sparc/mmu_helper.c
    M target-sparc/translate.c
    M target-unicore32/cpu.h
    M target-unicore32/helper.c
    M target-unicore32/helper.h
    M target-unicore32/op_helper.c
    M target-unicore32/translate.c
    M target-xtensa/core-dc232b.c
    M target-xtensa/core-dc233c.c
    M target-xtensa/core-fsf.c
    M target-xtensa/cpu.h
    M target-xtensa/helper.c
    M target-xtensa/helper.h
    M target-xtensa/op_helper.c
    M target-xtensa/translate.c
    M tcg/arm/tcg-target.c
    M tcg/hppa/tcg-target.c
    M tcg/i386/tcg-target.c
    M tcg/ia64/tcg-target.c
    M tcg/mips/tcg-target.c
    M tcg/ppc/tcg-target.c
    M tcg/ppc64/tcg-target.c
    M tcg/s390/tcg-target.c
    M tcg/sparc/tcg-target.c
    M tci.c
    M thunk.c
    R thunk.h
    M translate-all.c
    M vl.c
    M xen-all.c
    M xen-stub.c

  Log Message:
  -----------
  exec: move include files to include/exec/

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 83c9089e73b81c69dc1ecdf859fa84d2c500fb5f
      https://github.com/qemu/qemu/commit/83c9089e73b81c69dc1ecdf859fa84d2c500fb5f
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M arch_init.c
    M audio/audio.c
    M audio/wavcapture.c
    M balloon.c
    M balloon.h
    M block.c
    M blockdev-nbd.c
    M blockdev.c
    M blockjob.c
    M cpus.c
    M disas.c
    M dump.c
    M gdbstub.c
    M hmp.c
    M hw/acpi.c
    M hw/ccid-card-emulated.c
    M hw/ccid-card-passthru.c
    M hw/device-hotplug.c
    M hw/i8259.c
    M hw/ide/ahci.c
    M hw/isa-bus.c
    M hw/kvm/pci-assign.c
    M hw/lm32_pic.c
    M hw/loader.c
    M hw/pc.c
    M hw/pci/pci-hotplug.c
    M hw/pci/pci-stub.c
    M hw/pci/pci.c
    M hw/pci/pcie_aer.c
    M hw/qdev-monitor.c
    M hw/qdev-monitor.h
    M hw/qxl.c
    M hw/s390-virtio-bus.c
    M hw/s390-virtio.c
    M hw/s390x/event-facility.c
    M hw/slavio_intctl.c
    M hw/spapr_vio.c
    M hw/sun4c_intctl.c
    M hw/sysbus.c
    M hw/usb/bus.c
    M hw/usb/dev-smartcard-reader.c
    M hw/usb/dev-storage.c
    M hw/usb/hcd-ehci.h
    M hw/usb/host-bsd.c
    M hw/usb/host-linux.c
    M hw/usb/host-stub.c
    M hw/usb/redirect.c
    M hw/virtio-serial-bus.c
    M hw/watchdog.c
    M include/block/block_int.h
    A include/monitor/monitor.h
    A include/monitor/readline.h
    M include/ui/console.h
    M include/ui/qemu-spice.h
    M migration-fd.c
    M migration.c
    M monitor.c
    R monitor.h
    M net/hub.c
    M net/net.c
    M net/slirp.c
    M net/socket.c
    M net/tap.c
    M osdep.c
    M qemu-char.c
    M qemu-error.c
    M qemu-sockets.c
    M qemu-timer.c
    M qemu-tool.c
    M qemu-user.c
    M qerror.c
    M readline.c
    R readline.h
    M savevm.c
    M slirp/misc.c
    M stubs/fdset-add-fd.c
    M stubs/fdset-find-fd.c
    M stubs/fdset-get-fd.c
    M stubs/fdset-remove-fd.c
    M stubs/get-fd.c
    M target-i386/helper.c
    M ui/input.c
    M ui/spice-core.c
    M ui/spice-display.c
    M ui/vnc.h
    M vl.c

  Log Message:
  -----------
  monitor: move include files to include/monitor/

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: caf71f86a3de97394bcc5b06549012b7dc65fe60
      https://github.com/qemu/qemu/commit/caf71f86a3de97394bcc5b06549012b7dc65fe60
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M arch_init.c
    M block-migration.c
    R block-migration.h
    M block/qcow.c
    M block/qed.c
    M block/vdi.c
    M block/vmdk.c
    M block/vpc.c
    M block/vvfat.c
    M buffered_file.h
    M hw/9pfs/virtio-9p.c
    M hw/hid.h
    M hw/hw.h
    M hw/ivshmem.c
    M hw/pci/shpc.h
    M hw/ptimer.h
    A include/migration/block.h
    A include/migration/migration.h
    A include/migration/page_cache.h
    A include/migration/qemu-file.h
    A include/migration/vmstate.h
    M include/net/net.h
    R include/qemu/page_cache.h
    M migration-exec.c
    M migration-fd.c
    M migration-tcp.c
    M migration-unix.c
    M migration.c
    R migration.h
    M monitor.c
    M page_cache.c
    R qemu-file.h
    M qemu-tool.c
    M savevm.c
    M ui/spice-core.c
    M vl.c
    R vmstate.h

  Log Message:
  -----------
  migration: move include files to include/migration/

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 14cccb618508a0aa70eb9ccf366703a019a45ff0
      https://github.com/qemu/qemu/commit/14cccb618508a0aa70eb9ccf366703a019a45ff0
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M hw/qdev-core.h
    M hw/stream.h
    R include/qemu/cpu.h
    R include/qemu/object.h
    R include/qemu/qom-qobject.h
    M include/qemu/rng-random.h
    M include/qemu/rng.h
    A include/qom/cpu.h
    A include/qom/object.h
    A include/qom/qom-qobject.h
    M qmp.c
    M qom/container.c
    M qom/cpu.c
    M qom/object.c
    M qom/qom-qobject.c
    M target-alpha/cpu-qom.h
    M target-arm/cpu-qom.h
    M target-cris/cpu-qom.h
    M target-i386/cpu-qom.h
    M target-lm32/cpu-qom.h
    M target-m68k/cpu-qom.h
    M target-microblaze/cpu-qom.h
    M target-mips/cpu-qom.h
    M target-openrisc/cpu.h
    M target-ppc/cpu-qom.h
    M target-s390x/cpu-qom.h
    M target-sh4/cpu-qom.h
    M target-sparc/cpu-qom.h
    M target-unicore32/cpu-qom.h
    M target-xtensa/cpu-qom.h

  Log Message:
  -----------
  qom: move include files to include/qom/

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 1de7afc984b49af164e2619e6850b9732b173b34
      https://github.com/qemu/qemu/commit/1de7afc984b49af164e2619e6850b9732b173b34
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M acl.c
    R acl.h
    M aio-posix.c
    M aio-win32.c
    M arch_init.c
    M async.c
    M audio/alsaaudio.c
    M audio/audio.c
    M audio/audio.h
    M audio/noaudio.c
    M audio/ossaudio.c
    M audio/spiceaudio.c
    M audio/wavaudio.c
    M backends/rng-random.c
    M bitmap.c
    R bitmap.h
    M bitops.c
    R bitops.h
    M block-migration.c
    M block.c
    M block/blkdebug.c
    M block/blkverify.c
    M block/bochs.c
    M block/cloop.c
    M block/cow.c
    M block/dmg.c
    M block/gluster.c
    M block/iscsi.c
    M block/linux-aio.c
    M block/nbd.c
    M block/parallels.c
    M block/qcow.c
    M block/qcow2.c
    M block/qed-table.c
    M block/qed.c
    M block/raw-posix.c
    M block/raw-win32.c
    M block/raw.c
    M block/rbd.c
    M block/sheepdog.c
    M block/vdi.c
    M block/vmdk.c
    M block/vpc.c
    M block/vvfat.c
    M block/win32-aio.c
    M blockdev-nbd.c
    M blockdev.c
    M blockdev.h
    M blockjob.c
    M bsd-user/main.c
    M bsd-user/qemu.h
    R bswap.h
    M bt-host.c
    M bt-vhci.c
    M buffered_file.c
    M cache-utils.c
    R cache-utils.h
    M cmd.c
    M compatfd.c
    R compatfd.h
    R compiler.h
    M cpu-exec.c
    M cpus.c
    M cutils.c
    M device_tree.c
    M dma-helpers.c
    M envlist.c
    R envlist.h
    M event_notifier-posix.c
    M event_notifier-win32.c
    R event_notifier.h
    M exec.c
    M fpu/softfloat.h
    M fsdev/qemu-fsdev-dummy.c
    M fsdev/qemu-fsdev.c
    M fsdev/qemu-fsdev.h
    M fsdev/virtfs-proxy-helper.c
    M fsdev/virtio-9p-marshal.c
    M gdbstub.c
    M hmp.c
    M host-utils.c
    R host-utils.h
    M hw/9pfs/codir.c
    M hw/9pfs/cofile.c
    M hw/9pfs/cofs.c
    M hw/9pfs/coxattr.c
    M hw/9pfs/virtio-9p-coth.c
    M hw/9pfs/virtio-9p-coth.h
    M hw/9pfs/virtio-9p-device.c
    M hw/9pfs/virtio-9p-handle.c
    M hw/9pfs/virtio-9p-local.c
    M hw/9pfs/virtio-9p-posix-acl.c
    M hw/9pfs/virtio-9p-xattr.h
    M hw/9pfs/virtio-9p.c
    M hw/9pfs/virtio-9p.h
    M hw/acpi.h
    M hw/acpi_ich9.c
    M hw/acpi_piix4.c
    M hw/adlib.c
    M hw/alpha_pci.c
    M hw/apic.c
    M hw/apic_internal.h
    M hw/applesmc.c
    M hw/arm11mpcore.c
    M hw/arm_boot.c
    M hw/arm_mptimer.c
    M hw/arm_sysctl.c
    M hw/arm_timer.c
    M hw/armv7m_nvic.c
    M hw/baum.c
    M hw/block-common.c
    M hw/bt-hci-csr.c
    M hw/bt-hci.c
    M hw/bt-hid.c
    M hw/bt-l2cap.c
    M hw/cadence_ttc.c
    M hw/cadence_uart.c
    M hw/ccid-card-emulated.c
    M hw/ccid-card-passthru.c
    M hw/cs4231a.c
    M hw/cuda.c
    M hw/device-hotplug.c
    M hw/dma.c
    M hw/dp8393x.c
    M hw/esp-pci.c
    M hw/esp.c
    M hw/etraxfs_ser.c
    M hw/etraxfs_timer.c
    M hw/exynos4210_fimd.c
    M hw/exynos4210_i2c.c
    M hw/exynos4210_mct.c
    M hw/exynos4210_pwm.c
    M hw/exynos4210_rtc.c
    M hw/fdc.c
    M hw/fw_cfg.c
    M hw/grlib_gptimer.c
    M hw/hid.c
    M hw/hpet.c
    M hw/hw.h
    M hw/i8254.c
    M hw/i8254_common.c
    M hw/i8259.c
    M hw/ich9.h
    M hw/ide/core.c
    M hw/ide/qdev.c
    M hw/imx_avic.c
    M hw/imx_timer.c
    M hw/intel-hda.c
    M hw/ivshmem.c
    M hw/kvm/i8254.c
    M hw/kvm/pci-assign.c
    M hw/lance.c
    M hw/leon3.c
    M hw/lm32_sys.c
    M hw/lm32_timer.c
    M hw/lm32_uart.c
    M hw/lm832x.c
    M hw/lpc_ich9.c
    M hw/m48t59.c
    M hw/mac_dbdma.c
    M hw/mc146818rtc.c
    M hw/mcf5206.c
    M hw/mcf5208.c
    M hw/megasas.c
    M hw/microblaze_boot.c
    M hw/milkymist-ac97.c
    M hw/milkymist-hpdmc.c
    M hw/milkymist-memcard.c
    M hw/milkymist-minimac2.c
    M hw/milkymist-pfpu.c
    M hw/milkymist-softusb.c
    M hw/milkymist-sysctl.c
    M hw/milkymist-tmu2.c
    M hw/milkymist-uart.c
    M hw/milkymist-vgafb.c
    M hw/mips_fulong2e.c
    M hw/mips_malta.c
    M hw/mips_r4k.c
    M hw/mips_timer.c
    M hw/musicpal.c
    M hw/nand.c
    M hw/omap1.c
    M hw/omap2.c
    M hw/omap_dma.c
    M hw/omap_gptimer.c
    M hw/omap_synctimer.c
    M hw/onenand.c
    M hw/openrisc_timer.c
    M hw/pc.c
    M hw/pci/msi.c
    M hw/pci/msix.c
    M hw/pci/pci-hotplug.c
    M hw/pci/pci.c
    M hw/pci/pci_bridge.c
    M hw/pci/pcie.c
    M hw/pci/shpc.c
    M hw/pcnet-pci.c
    M hw/pcnet.c
    M hw/pcspk.c
    M hw/pflash_cfi01.c
    M hw/pflash_cfi02.c
    M hw/piix_pci.c
    M hw/pl031.c
    M hw/ppc.c
    M hw/ppc/e500.c
    M hw/ppc405_boards.c
    M hw/ppc405_uc.c
    M hw/ppc4xx_devs.c
    M hw/ppc_booke.c
    M hw/ppc_prep.c
    M hw/ppce500_pci.c
    M hw/ptimer.c
    M hw/ptimer.h
    M hw/pxa2xx_timer.c
    M hw/q35.h
    M hw/qdev-core.h
    M hw/qdev-monitor.c
    M hw/qxl-logger.c
    M hw/qxl.c
    M hw/qxl.h
    M hw/rc4030.c
    M hw/rtl8139.c
    M hw/s390x/event-facility.h
    M hw/s390x/sclpconsole.c
    M hw/sb16.c
    M hw/scsi-bus.c
    M hw/scsi-disk.c
    M hw/scsi-generic.c
    M hw/sd.c
    M hw/serial.c
    M hw/sh_pci.c
    M hw/sh_timer.c
    M hw/slavio_timer.c
    M hw/sm501.c
    M hw/soc_dma.c
    M hw/spapr.c
    M hw/spitz.c
    M hw/stellaris.c
    M hw/strongarm.c
    M hw/sun4m.c
    M hw/sun4u.c
    M hw/tsc2005.c
    M hw/tsc210x.c
    M hw/tusb6010.c
    M hw/twl92230.c
    M hw/usb.h
    M hw/usb/combined-packet.c
    M hw/usb/core.c
    M hw/usb/dev-hid.c
    M hw/usb/dev-network.c
    M hw/usb/dev-serial.c
    M hw/usb/dev-smartcard-reader.c
    M hw/usb/dev-storage.c
    M hw/usb/dev-uas.c
    M hw/usb/hcd-ehci-pci.c
    M hw/usb/hcd-ehci.h
    M hw/usb/hcd-musb.c
    M hw/usb/hcd-ohci.c
    M hw/usb/hcd-uhci.c
    M hw/usb/hcd-xhci.c
    M hw/usb/host-linux.c
    M hw/usb/redirect.c
    M hw/vfio_pci.c
    M hw/vga-isa-mm.c
    M hw/vga-isa.c
    M hw/vga-pci.c
    M hw/vga.c
    M hw/vhost.c
    M hw/vhost_net.c
    M hw/virtex_ml507.c
    M hw/virtio-balloon.c
    M hw/virtio-blk.c
    M hw/virtio-console.c
    M hw/virtio-net.c
    M hw/virtio-pci.c
    M hw/virtio-rng.c
    M hw/virtio-serial-bus.c
    M hw/virtio.c
    M hw/virtio.h
    M hw/vt82c686.c
    M hw/watchdog.c
    M hw/watchdog.h
    M hw/wdt_i6300esb.c
    M hw/wdt_ib700.c
    M hw/xen_backend.c
    M hw/xen_common.h
    M hw/xen_domainbuild.c
    M hw/xen_pt.c
    M hw/xen_pt_config_init.c
    M hw/xgmac.c
    M hw/xilinx_axidma.c
    M hw/xilinx_axienet.c
    M hw/xilinx_spi.c
    M hw/xilinx_spips.c
    M hw/xilinx_timer.c
    M hw/xtensa_pic.c
    M hw/zynq_slcr.c
    M include/block/aio.h
    M include/block/block.h
    M include/block/block_int.h
    M include/block/coroutine.h
    M include/block/coroutine_int.h
    M include/block/thread-pool.h
    M include/exec/cpu-all.h
    M include/exec/cpu-common.h
    M include/exec/cpu-defs.h
    M include/exec/exec-all.h
    M include/exec/gen-icount.h
    M include/exec/memory.h
    M include/exec/softmmu_template.h
    M include/migration/migration.h
    M include/net/net.h
    M include/net/slirp.h
    M include/qapi/error.h
    M include/qapi/opts-visitor.h
    M include/qapi/qmp/qdict.h
    M include/qapi/qmp/qerror.h
    M include/qapi/qmp/qjson.h
    M include/qapi/qmp/qlist.h
    A include/qemu/acl.h
    A include/qemu/atomic.h
    A include/qemu/bitmap.h
    A include/qemu/bitops.h
    A include/qemu/bswap.h
    A include/qemu/cache-utils.h
    A include/qemu/compatfd.h
    A include/qemu/compiler.h
    A include/qemu/config-file.h
    A include/qemu/envlist.h
    A include/qemu/error-report.h
    A include/qemu/event_notifier.h
    A include/qemu/host-utils.h
    A include/qemu/int128.h
    A include/qemu/iov.h
    A include/qemu/log.h
    A include/qemu/main-loop.h
    A include/qemu/module.h
    A include/qemu/notify.h
    A include/qemu/option.h
    A include/qemu/option_int.h
    A include/qemu/osdep.h
    A include/qemu/queue.h
    A include/qemu/range.h
    A include/qemu/sockets.h
    A include/qemu/thread-posix.h
    A include/qemu/thread-win32.h
    A include/qemu/thread.h
    A include/qemu/timer.h
    A include/qemu/tls.h
    A include/qemu/typedefs.h
    A include/qemu/uri.h
    A include/qemu/xattr.h
    M include/qom/cpu.h
    M include/qom/object.h
    M include/ui/console.h
    M include/ui/qemu-spice.h
    M include/ui/spice-display.h
    R int128.h
    M iohandler.c
    M iov.c
    R iov.h
    M kvm-all.c
    M kvm.h
    M libcacard/event.c
    M libcacard/vreader.c
    M libcacard/vscclient.c
    M libfdt_env.h
    M linux-user/main.c
    M linux-user/qemu.h
    M linux-user/syscall.c
    M main-loop.c
    R main-loop.h
    M memory.c
    M memory_mapping.h
    M migration-exec.c
    M migration-fd.c
    M migration-tcp.c
    M migration-unix.c
    M migration.c
    M module.c
    R module.h
    M monitor.c
    M nbd.c
    M net/dump.c
    M net/hub.c
    M net/net.c
    M net/queue.c
    M net/slirp.c
    M net/socket.c
    M net/tap-bsd.c
    M net/tap-linux.c
    M net/tap-solaris.c
    M net/tap-win32.c
    M net/tap.c
    M net/vde.c
    M notify.c
    R notify.h
    M osdep.c
    R osdep.h
    M oslib-posix.c
    M oslib-win32.c
    M qapi/opts-visitor.c
    M qapi/qapi-dealloc-visitor.c
    M qapi/qmp-input-visitor.c
    M qapi/qmp-output-visitor.c
    M qdict.c
    R qemu-barrier.h
    M qemu-bridge-helper.c
    M qemu-char.c
    M qemu-char.h
    M qemu-common.h
    M qemu-config.c
    R qemu-config.h
    M qemu-coroutine-io.c
    M qemu-coroutine-lock.c
    M qemu-coroutine-sleep.c
    R qemu-error.h
    M qemu-img.c
    M qemu-io.c
    M qemu-log.c
    R qemu-log.h
    R qemu-option-internal.h
    M qemu-option.c
    R qemu-option.h
    M qemu-progress.c
    R qemu-queue.h
    M qemu-seccomp.h
    M qemu-sockets.c
    M qemu-thread-posix.c
    R qemu-thread-posix.h
    M qemu-thread-win32.c
    R qemu-thread-win32.h
    R qemu-thread.h
    M qemu-timer-common.c
    M qemu-timer.c
    R qemu-timer.h
    R qemu-tls.h
    M qemu-tool.c
    R qemu-types.h
    R qemu-xattr.h
    R qemu_socket.h
    M qga/channel-posix.c
    M qga/commands-posix.c
    M qga/main.c
    M qlist.c
    M qom/container.c
    R range.h
    M savevm.c
    M scripts/qapi-commands.py
    M slirp/if.c
    M slirp/ip_input.c
    M slirp/sbuf.c
    M slirp/slirp.c
    M slirp/slirp.h
    M spice-qemu-char.c
    M stubs/fd-register.c
    M stubs/set-fd-handler.c
    M sysemu.h
    M target-alpha/int_helper.c
    M target-alpha/sys_helper.c
    M target-alpha/translate.c
    M target-arm/helper.c
    M target-arm/translate.c
    M target-cris/helper.c
    M target-cris/op_helper.c
    M target-i386/cpu.c
    M target-i386/excp_helper.c
    M target-i386/int_helper.c
    M target-i386/kvm.c
    M target-i386/seg_helper.c
    M target-lm32/helper.c
    M target-lm32/op_helper.c
    M target-m68k/translate.c
    M target-microblaze/helper.c
    M target-microblaze/op_helper.c
    M target-mips/op_helper.c
    M target-openrisc/int_helper.c
    M target-openrisc/interrupt.c
    M target-openrisc/mmu.c
    M target-openrisc/translate.c
    M target-ppc/int_helper.c
    M target-ppc/kvm.c
    M target-ppc/kvm_ppc.c
    M target-ppc/mem_helper.c
    M target-ppc/translate.c
    M target-s390x/cpu.c
    M target-s390x/helper.c
    M target-s390x/int_helper.c
    M target-s390x/kvm.c
    M target-s390x/misc_helper.c
    M target-s390x/translate.c
    M target-sparc/cpu.h
    M target-sparc/helper.c
    M target-sparc/machine.c
    M target-unicore32/helper.c
    M target-unicore32/translate.c
    M target-xtensa/core-dc232b.c
    M target-xtensa/core-dc233c.c
    M target-xtensa/core-fsf.c
    M target-xtensa/helper.c
    M target-xtensa/op_helper.c
    M target-xtensa/translate.c
    M target-xtensa/xtensa-semi.c
    M tcg/tcg.c
    M tests/libqtest.c
    M tests/tcg/test-i386-fprem.c
    M tests/tcg/test-i386.c
    M tests/test-iov.c
    M tests/test-qmp-commands.c
    M thread-pool.c
    M trace/simple.c
    M translate-all.c
    M ui/console.c
    M ui/sdl_zoom.c
    M ui/spice-core.c
    M ui/spice-display.c
    M ui/vnc-auth-sasl.h
    M ui/vnc-enc-tight.c
    M ui/vnc-jobs.c
    M ui/vnc-palette.h
    M ui/vnc-tls.c
    M ui/vnc-tls.h
    M ui/vnc.c
    M ui/vnc.h
    M uri.c
    R uri.h
    M vl.c
    M xen-all.c
    M xen-mapcache.c

  Log Message:
  -----------
  misc: move include files to include/qemu/

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 9c17d615a66ebd655871bf891ec0fe901ad8b332
      https://github.com/qemu/qemu/commit/9c17d615a66ebd655871bf891ec0fe901ad8b332
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M arch_init.c
    R arch_init.h
    M audio/audio.c
    M audio/winwaveaudio.c
    M balloon.c
    R balloon.h
    M block-migration.c
    M block.c
    M block/vdi.c
    M blockdev-nbd.c
    M blockdev.c
    R blockdev.h
    M cpu-exec.c
    M cpus.c
    R cpus.h
    M device_tree.c
    R device_tree.h
    M dma-helpers.c
    R dma.h
    M dump-stub.c
    M dump.c
    R dump.h
    M exec.c
    M gdbstub.c
    M hw/ac97.c
    M hw/acpi.c
    M hw/acpi_ich9.c
    M hw/acpi_piix4.c
    M hw/alpha_dp264.c
    M hw/alpha_pci.c
    M hw/alpha_typhoon.c
    M hw/apb_pci.c
    M hw/apic_common.c
    M hw/arm_boot.c
    M hw/arm_sysctl.c
    M hw/axis_dev88.c
    M hw/block-common.c
    M hw/boards.h
    M hw/bonito.c
    M hw/cbus.c
    M hw/collie.c
    M hw/cuda.c
    M hw/device-hotplug.c
    M hw/e1000.c
    M hw/eepro100.c
    M hw/es1370.c
    M hw/etraxfs_dma.c
    M hw/etraxfs_timer.c
    M hw/exynos4210.c
    M hw/exynos4210_rtc.c
    M hw/exynos4210_uart.c
    M hw/exynos4_boards.c
    M hw/fdc.c
    M hw/fw_cfg.c
    M hw/gumstix.c
    M hw/highbank.c
    M hw/ide/ahci.c
    M hw/ide/cmd646.c
    M hw/ide/core.c
    M hw/ide/ich.c
    M hw/ide/internal.h
    M hw/ide/isa.c
    M hw/ide/macio.c
    M hw/ide/microdrive.c
    M hw/ide/mmio.c
    M hw/ide/pci.c
    M hw/ide/piix.c
    M hw/ide/qdev.c
    M hw/ide/via.c
    M hw/imx_ccm.c
    M hw/imx_serial.c
    M hw/integratorcp.c
    M hw/intel-hda.c
    M hw/isa-bus.c
    M hw/ivshmem.c
    M hw/kvm/apic.c
    M hw/kvm/clock.c
    M hw/kvm/i8254.c
    M hw/kvm/i8259.c
    M hw/kvm/ioapic.c
    M hw/kvm/pci-assign.c
    M hw/kvmvapic.c
    M hw/kzm.c
    M hw/lan9118.c
    M hw/leon3.c
    M hw/lm32_boards.c
    M hw/lm32_sys.c
    M hw/loader.c
    M hw/lpc_ich9.c
    M hw/lsi53c895a.c
    M hw/m25p80.c
    M hw/m48t59.c
    M hw/mac_nvram.c
    M hw/mainstone.c
    M hw/mc146818rtc.c
    M hw/mcf5206.c
    M hw/mcf5208.c
    M hw/megasas.c
    M hw/microblaze_boot.c
    M hw/milkymist-memcard.c
    M hw/milkymist-sysctl.c
    M hw/milkymist.c
    M hw/mips_fulong2e.c
    M hw/mips_jazz.c
    M hw/mips_malta.c
    M hw/mips_mipssim.c
    M hw/mips_r4k.c
    M hw/mpc8544_guts.c
    M hw/multiboot.c
    M hw/musicpal.c
    M hw/nand.c
    M hw/ne2000.c
    M hw/nseries.c
    M hw/omap1.c
    M hw/omap2.c
    M hw/omap_sx1.c
    M hw/onenand.c
    M hw/opencores_eth.c
    M hw/openrisc_sim.c
    M hw/palm.c
    M hw/pam.c
    M hw/parallel.c
    M hw/pc.c
    M hw/pc_piix.c
    M hw/pc_q35.c
    M hw/pc_sysfw.c
    M hw/pci/pci-hotplug.c
    M hw/pci/pci-stub.c
    M hw/pci/pci.c
    M hw/pci/pci.h
    M hw/pci/pcie_aer.c
    M hw/pckbd.c
    M hw/pcnet-pci.c
    M hw/pcnet.c
    M hw/petalogix_ml605_mmu.c
    M hw/petalogix_s3adsp1800_mmu.c
    M hw/pl031.c
    M hw/pl181.c
    M hw/ppc.c
    M hw/ppc/e500.c
    M hw/ppc/e500plat.c
    M hw/ppc/mpc8544ds.c
    M hw/ppc405_boards.c
    M hw/ppc405_uc.c
    M hw/ppc440_bamboo.c
    M hw/ppc_booke.c
    M hw/ppc_newworld.c
    M hw/ppc_oldworld.c
    M hw/ppc_prep.c
    M hw/ppce500_spin.c
    M hw/ps2.c
    M hw/pxa2xx.c
    M hw/pxa2xx_lcd.c
    M hw/pxa2xx_timer.c
    M hw/qdev-monitor.c
    M hw/qdev-properties.c
    M hw/qdev.c
    M hw/qxl.c
    M hw/r2d.c
    M hw/realview.c
    M hw/rtl8139.c
    M hw/s390-virtio-bus.c
    M hw/s390-virtio.c
    M hw/s390x/event-facility.c
    M hw/s390x/sclp.c
    M hw/s390x/sclpquiesce.c
    M hw/scsi-bus.c
    M hw/scsi-disk.c
    M hw/scsi-generic.c
    M hw/scsi.h
    M hw/serial.h
    M hw/sga.c
    M hw/sh7750.c
    M hw/shix.c
    M hw/slavio_misc.c
    M hw/smbios.c
    M hw/smbus_ich9.c
    M hw/spapr.c
    M hw/spapr.h
    M hw/spapr_events.c
    M hw/spapr_hcall.c
    M hw/spapr_iommu.c
    M hw/spapr_nvram.c
    M hw/spapr_rtas.c
    M hw/spapr_vio.c
    M hw/spapr_vio.h
    M hw/spitz.c
    M hw/ssi-sd.c
    M hw/strongarm.c
    M hw/sun4m.c
    M hw/sun4u.c
    M hw/tc6393xb.c
    M hw/tosa.c
    M hw/twl92230.c
    M hw/usb/bus.c
    M hw/usb/dev-network.c
    M hw/usb/dev-storage.c
    M hw/usb/hcd-ehci.h
    M hw/usb/hcd-uhci.c
    M hw/usb/host-linux.c
    M hw/usb/libhw.c
    M hw/usb/redirect.c
    M hw/versatilepb.c
    M hw/vexpress.c
    M hw/vfio_pci.c
    M hw/virtex_ml507.c
    M hw/virtio-balloon.c
    M hw/virtio-blk.c
    M hw/virtio-pci.c
    M hw/virtio.h
    M hw/vmport.c
    M hw/vt82c686.c
    M hw/watchdog.c
    M hw/xen_backend.h
    M hw/xen_devconfig.c
    M hw/xen_disk.c
    M hw/xen_machine_pv.c
    M hw/xilinx_spi.c
    M hw/xilinx_spips.c
    M hw/xilinx_zynq.c
    M hw/xtensa_lx60.c
    M hw/xtensa_sim.c
    M hw/z2.c
    M hw/zynq_slcr.c
    A include/sysemu/arch_init.h
    A include/sysemu/balloon.h
    A include/sysemu/blockdev.h
    A include/sysemu/cpus.h
    A include/sysemu/device_tree.h
    A include/sysemu/dma.h
    A include/sysemu/dump.h
    A include/sysemu/kvm.h
    A include/sysemu/memory_mapping.h
    A include/sysemu/os-posix.h
    A include/sysemu/os-win32.h
    A include/sysemu/qtest.h
    A include/sysemu/seccomp.h
    A include/sysemu/sysemu.h
    A include/sysemu/xen-mapcache.h
    M include/ui/spice-display.h
    M kvm-all.c
    M kvm-stub.c
    R kvm.h
    M memory.c
    M memory_mapping-stub.c
    M memory_mapping.c
    R memory_mapping.h
    M migration.c
    M monitor.c
    M net/tap-bsd.c
    M net/tap-linux.c
    M net/tap-solaris.c
    M net/tap-win32.c
    M net/tap.c
    M os-posix.c
    M os-win32.c
    M oslib-posix.c
    M oslib-win32.c
    M qemu-char.c
    M qemu-common.h
    M qemu-img.c
    R qemu-os-posix.h
    R qemu-os-win32.h
    M qemu-progress.c
    M qemu-seccomp.c
    R qemu-seccomp.h
    M qemu-timer.c
    M qemu-tool.c
    M qmp.c
    M qtest.c
    R qtest.h
    M savevm.c
    M stubs/arch-query-cpu-def.c
    R sysemu.h
    M target-alpha/sys_helper.c
    M target-arm/cpu.c
    M target-arm/helper.c
    M target-i386/arch_dump.c
    M target-i386/arch_memory_mapping.c
    M target-i386/cpu.c
    M target-i386/excp_helper.c
    M target-i386/helper.c
    M target-i386/kvm.c
    M target-i386/kvm_i386.h
    M target-i386/machine.c
    M target-m68k/m68k-semi.c
    M target-ppc/helper.c
    M target-ppc/kvm.c
    M target-ppc/kvm_ppc.c
    M target-ppc/machine.c
    M target-ppc/mmu_helper.c
    M target-ppc/translate_init.c
    M target-s390x/helper.c
    M target-s390x/interrupt.c
    M target-s390x/kvm.c
    M target-s390x/misc_helper.c
    M target-sparc/helper.c
    M target-sparc/int32_helper.c
    M target-xtensa/translate.c
    M ui/cocoa.m
    M ui/curses.c
    M ui/input.c
    M ui/keymaps.c
    M ui/sdl.c
    M ui/spice-core.c
    M ui/spice-display.c
    M ui/vnc.c
    M vl.c
    M xen-all.c
    M xen-mapcache.c
    R xen-mapcache.h

  Log Message:
  -----------
  softmmu: move include files to include/sysemu/

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 927d4878b0ff319ed87fed9363f314613b0a5ed9
      https://github.com/qemu/qemu/commit/927d4878b0ff319ed87fed9363f314613b0a5ed9
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M backends/rng-egd.c
    M bt-host.c
    R bt-host.h
    M bt-vhci.c
    M event_notifier-posix.c
    M gdbstub.c
    M hmp.c
    M hw/baum.c
    M hw/bt-hci-csr.c
    M hw/bt-hci.c
    M hw/bt.c
    M hw/cadence_uart.c
    M hw/ccid-card-emulated.c
    M hw/ccid-card-passthru.c
    M hw/debugcon.c
    M hw/escc.c
    M hw/etraxfs_ser.c
    M hw/exynos4210_uart.c
    M hw/grlib_apbuart.c
    M hw/imx_serial.c
    M hw/ivshmem.c
    M hw/leon3.c
    M hw/lm32_juart.c
    M hw/lm32_uart.c
    M hw/mcf_uart.c
    M hw/milkymist-uart.c
    M hw/mips_fulong2e.c
    M hw/mips_malta.c
    M hw/msmouse.c
    M hw/omap2.c
    M hw/omap_uart.c
    M hw/parallel.c
    M hw/pl011.c
    M hw/pxa2xx.c
    M hw/qdev-properties.c
    M hw/s390x/sclpconsole.c
    M hw/serial.c
    M hw/sh_serial.c
    M hw/spapr_events.c
    M hw/spapr_rtas.c
    M hw/spapr_vty.c
    M hw/strongarm.c
    M hw/usb/dev-bluetooth.c
    M hw/usb/dev-serial.c
    M hw/virtio-console.c
    M hw/xen_backend.c
    M hw/xen_console.c
    M hw/xenfb.c
    M hw/xgmac.c
    M hw/xilinx_uartlite.c
    M hw/xtensa_lx60.c
    A include/bt/bt.h
    A include/char/char.h
    M monitor.c
    M net/slirp.c
    M qemu-char.c
    R qemu-char.h
    M qmp.c
    M qtest.c
    M slirp/slirp.c
    M spice-qemu-char.c
    M ui/console.c
    M vl.c

  Log Message:
  -----------
  softmmu: move remaining include files to include/ subdirectories

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 6b4c305cbd549e9d12a6b0192fdb8d6519a9664c
      https://github.com/qemu/qemu/commit/6b4c305cbd549e9d12a6b0192fdb8d6519a9664c
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M configure
    M fpu/softfloat.c
    R fpu/softfloat.h
    A include/fpu/softfloat.h
    M include/qemu/bswap.h
    M linux-user/arm/nwfpe/double_cpdo.c
    M linux-user/arm/nwfpe/extended_cpdo.c
    M linux-user/arm/nwfpe/fpa11.h
    M linux-user/arm/nwfpe/fpa11_cpdt.c
    M linux-user/arm/nwfpe/fpa11_cprt.c
    M linux-user/arm/nwfpe/fpopcode.c
    M linux-user/arm/nwfpe/single_cpdo.c
    M target-alpha/cpu.h
    M target-alpha/fpu_helper.c
    M target-alpha/helper.c
    M target-alpha/translate.c
    M target-arm/cpu.h
    M target-i386/cpu.h
    M target-m68k/cpu.h
    M target-microblaze/cpu.h
    M target-mips/cpu.h
    M target-openrisc/cpu.h
    M target-ppc/cpu.h
    M target-s390x/cpu.h
    M target-sh4/cpu.h
    M target-sparc/cpu.h
    M target-unicore32/cpu.h

  Log Message:
  -----------
  fpu: move public header file to include/fpu

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 42dc882ff850cde22ae7d501d1dd452837fc4103
      https://github.com/qemu/qemu/commit/42dc882ff850cde22ae7d501d1dd452837fc4103
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    R a.out.h
    A hw/uboot_image.h
    R uboot_image.h

  Log Message:
  -----------
  hw: move executable format header files to hw/

Or delete a.out.h which is unused.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: ec5e016c9a68588bd01be387416923c7dcafb951
      https://github.com/qemu/qemu/commit/ec5e016c9a68588bd01be387416923c7dcafb951
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    R config.h
    R elf.h
    A include/config.h
    A include/elf.h
    A include/libfdt_env.h
    A include/qemu-common.h
    R libfdt_env.h
    R qemu-common.h

  Log Message:
  -----------
  janitor: move remaining public headers to include/

Headers in the root directory are now used only from within that
directory.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 27dd7730582be85c7d4f680f5f71146629809c86
      https://github.com/qemu/qemu/commit/27dd7730582be85c7d4f680f5f71146629809c86
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-12-19 (Wed, 19 Dec 2012)

  Changed paths:
    M .gitignore
    M MAINTAINERS
    M Makefile
    R Makefile.dis
    M Makefile.objs
    M Makefile.target
    R Makefile.user
    R a.out.h
    M acl.c
    R acl.h
    M aes.c
    R aes.h
    M aio-posix.c
    M aio-win32.c
    R alpha-dis.c
    R alpha.ld
    M arch_init.c
    R arch_init.h
    R arm-dis.c
    R arm.ld
    M async.c
    M audio/Makefile.objs
    M audio/alsaaudio.c
    M audio/audio.c
    M audio/audio.h
    M audio/noaudio.c
    M audio/ossaudio.c
    M audio/spiceaudio.c
    M audio/wavaudio.c
    M audio/wavcapture.c
    M audio/winwaveaudio.c
    M backends/rng-egd.c
    M backends/rng-random.c
    M backends/rng.c
    M balloon.c
    R balloon.h
    M bitmap.c
    R bitmap.h
    M bitops.c
    R bitops.h
    M block-migration.c
    R block-migration.h
    M block.c
    R block.h
    M block/Makefile.objs
    M block/blkdebug.c
    M block/blkverify.c
    M block/bochs.c
    M block/cloop.c
    M block/commit.c
    M block/cow.c
    M block/curl.c
    M block/dmg.c
    M block/gluster.c
    M block/iscsi.c
    M block/linux-aio.c
    M block/mirror.c
    M block/nbd.c
    M block/parallels.c
    M block/qcow.c
    M block/qcow2-cache.c
    M block/qcow2-cluster.c
    M block/qcow2-refcount.c
    M block/qcow2-snapshot.c
    M block/qcow2.c
    M block/qcow2.h
    M block/qed-table.c
    M block/qed.c
    M block/qed.h
    M block/raw-posix.c
    M block/raw-win32.c
    M block/raw.c
    M block/rbd.c
    M block/sheepdog.c
    M block/stream.c
    M block/vdi.c
    M block/vmdk.c
    M block/vpc.c
    M block/vvfat.c
    M block/win32-aio.c
    R block_int.h
    M blockdev-nbd.c
    M blockdev.c
    R blockdev.h
    M blockjob.c
    R blockjob.h
    M bsd-user/elfload.c
    M bsd-user/main.c
    M bsd-user/qemu.h
    R bswap.h
    M bt-host.c
    R bt-host.h
    M bt-vhci.c
    M buffered_file.c
    M buffered_file.h
    M cache-utils.c
    R cache-utils.h
    M cmd.c
    M compatfd.c
    R compatfd.h
    R compiler.h
    R config.h
    M configure
    R console.c
    R console.h
    M coroutine-gthread.c
    M coroutine-sigaltstack.c
    M coroutine-ucontext.c
    M coroutine-win32.c
    R cpu-all.h
    R cpu-common.h
    R cpu-defs.h
    M cpu-exec.c
    M cpus.c
    R cpus.h
    M cputlb.c
    R cputlb.h
    R cris-dis.c
    R cursor.c
    R cursor_hidden.xpm
    R cursor_left_ptr.xpm
    M cutils.c
    R def-helper.h
    M device_tree.c
    R device_tree.h
    R dis-asm.h
    M disas.c
    R disas.h
    A disas/Makefile.objs
    A disas/alpha.c
    A disas/arm.c
    A disas/cris.c
    A disas/hppa.c
    A disas/i386.c
    A disas/ia64.c
    A disas/lm32.c
    A disas/m68k.c
    A disas/microblaze.c
    A disas/mips.c
    A disas/ppc.c
    A disas/s390.c
    A disas/sh4.c
    A disas/sparc.c
    A disas/tci.c
    M dma-helpers.c
    R dma.h
    M dump-stub.c
    M dump.c
    R dump.h
    R elf.h
    M envlist.c
    R envlist.h
    M error.c
    R error.h
    M event_notifier-posix.c
    M event_notifier-win32.c
    R event_notifier.h
    R exec-all.h
    R exec-memory.h
    M exec.c
    M fpu/softfloat.c
    R fpu/softfloat.h
    M fsdev/qemu-fsdev-dummy.c
    M fsdev/qemu-fsdev.c
    M fsdev/qemu-fsdev.h
    M fsdev/virtfs-proxy-helper.c
    M fsdev/virtio-9p-marshal.c
    M gdbstub.c
    R gdbstub.h
    R gen-icount.h
    M hmp.c
    M hmp.h
    M host-utils.c
    R host-utils.h
    R hppa-dis.c
    R hppa.ld
    M hw/9pfs/codir.c
    M hw/9pfs/cofile.c
    M hw/9pfs/cofs.c
    M hw/9pfs/coxattr.c
    M hw/9pfs/virtio-9p-coth.c
    M hw/9pfs/virtio-9p-coth.h
    M hw/9pfs/virtio-9p-device.c
    M hw/9pfs/virtio-9p-handle.c
    M hw/9pfs/virtio-9p-local.c
    M hw/9pfs/virtio-9p-posix-acl.c
    M hw/9pfs/virtio-9p-synth.h
    M hw/9pfs/virtio-9p-xattr.h
    M hw/9pfs/virtio-9p.c
    M hw/9pfs/virtio-9p.h
    M hw/Makefile.objs
    M hw/ac97.c
    M hw/acpi.c
    M hw/acpi.h
    M hw/acpi_ich9.c
    M hw/acpi_piix4.c
    M hw/adb.c
    M hw/adlib.c
    M hw/ads7846.c
    M hw/alpha_dp264.c
    M hw/alpha_pci.c
    M hw/alpha_sys.h
    M hw/alpha_typhoon.c
    M hw/an5206.c
    M hw/apb_pci.c
    M hw/apic.c
    M hw/apic_common.c
    M hw/apic_internal.h
    M hw/apm.c
    M hw/apm.h
    M hw/applesmc.c
    M hw/arm-misc.h
    M hw/arm11mpcore.c
    M hw/arm_boot.c
    M hw/arm_mptimer.c
    M hw/arm_sysctl.c
    M hw/arm_timer.c
    M hw/armv7m_nvic.c
    M hw/audiodev.h
    M hw/axis_dev88.c
    M hw/baum.c
    M hw/baum.h
    M hw/blizzard.c
    M hw/block-common.c
    M hw/boards.h
    M hw/bonito.c
    M hw/bt-hci-csr.c
    M hw/bt-hci.c
    M hw/bt-hid.c
    M hw/bt-l2cap.c
    M hw/bt.c
    M hw/bt.h
    M hw/cadence_gem.c
    M hw/cadence_ttc.c
    M hw/cadence_uart.c
    M hw/cbus.c
    M hw/ccid-card-emulated.c
    M hw/ccid-card-passthru.c
    M hw/cirrus_vga.c
    M hw/collie.c
    M hw/cris-boot.h
    M hw/cs4231a.c
    M hw/cuda.c
    M hw/debugcon.c
    M hw/dec_pci.c
    M hw/device-hotplug.c
    M hw/dma.c
    M hw/dp8393x.c
    M hw/dummy_m68k.c
    M hw/e1000.c
    M hw/eepro100.c
    M hw/empty_slot.h
    M hw/es1370.c
    M hw/escc.c
    M hw/escc.h
    M hw/esp-pci.c
    M hw/esp.c
    M hw/etraxfs.h
    M hw/etraxfs_dma.c
    M hw/etraxfs_dma.h
    M hw/etraxfs_eth.c
    M hw/etraxfs_ser.c
    M hw/etraxfs_timer.c
    M hw/exynos4210.c
    M hw/exynos4210.h
    M hw/exynos4210_fimd.c
    M hw/exynos4210_i2c.c
    M hw/exynos4210_mct.c
    M hw/exynos4210_pwm.c
    M hw/exynos4210_rtc.c
    M hw/exynos4210_uart.c
    M hw/exynos4_boards.c
    M hw/fdc.c
    M hw/flash.h
    M hw/framebuffer.c
    M hw/framebuffer.h
    M hw/fw_cfg.c
    M hw/g364fb.c
    M hw/grackle_pci.c
    M hw/grlib_apbuart.c
    M hw/grlib_gptimer.c
    M hw/gt64xxx.c
    M hw/gumstix.c
    M hw/hd-geometry.c
    M hw/hda-audio.c
    M hw/hid.c
    M hw/hid.h
    M hw/highbank.c
    M hw/hpet.c
    M hw/hw.h
    M hw/i386/Makefile.objs
    M hw/i82378.c
    M hw/i8254.c
    M hw/i8254_common.c
    M hw/i8259.c
    M hw/i82801b11.c
    M hw/ich9.h
    M hw/ide.h
    M hw/ide/ahci.c
    M hw/ide/cmd646.c
    M hw/ide/core.c
    M hw/ide/ich.c
    M hw/ide/internal.h
    M hw/ide/isa.c
    M hw/ide/macio.c
    M hw/ide/microdrive.c
    M hw/ide/mmio.c
    M hw/ide/pci.c
    M hw/ide/piix.c
    M hw/ide/qdev.c
    M hw/ide/via.c
    M hw/imx_avic.c
    M hw/imx_ccm.c
    M hw/imx_serial.c
    M hw/imx_timer.c
    M hw/integratorcp.c
    M hw/intel-hda.c
    M hw/ioapic_internal.h
    M hw/ioh3420.c
    M hw/ioh3420.h
    M hw/isa-bus.c
    M hw/isa.h
    M hw/isa_mmio.c
    M hw/ivshmem.c
    M hw/jazz_led.c
    M hw/kvm/apic.c
    M hw/kvm/clock.c
    M hw/kvm/i8254.c
    M hw/kvm/i8259.c
    M hw/kvm/ioapic.c
    M hw/kvm/pci-assign.c
    M hw/kvmvapic.c
    M hw/kzm.c
    M hw/lan9118.c
    M hw/lance.c
    M hw/leon3.c
    M hw/lm32.h
    M hw/lm32_boards.c
    M hw/lm32_juart.c
    M hw/lm32_pic.c
    M hw/lm32_sys.c
    M hw/lm32_timer.c
    M hw/lm32_uart.c
    M hw/lm832x.c
    M hw/loader.c
    M hw/lpc_ich9.c
    M hw/lsi53c895a.c
    M hw/m25p80.c
    M hw/m48t59.c
    M hw/mac_dbdma.c
    M hw/mac_dbdma.h
    M hw/mac_nvram.c
    M hw/macio.c
    M hw/mainstone.c
    M hw/mc146818rtc.c
    M hw/mcf5206.c
    M hw/mcf5208.c
    M hw/mcf_fec.c
    M hw/mcf_intc.c
    M hw/mcf_uart.c
    M hw/megasas.c
    M hw/microblaze_boot.c
    M hw/milkymist-ac97.c
    M hw/milkymist-hpdmc.c
    M hw/milkymist-hw.h
    M hw/milkymist-memcard.c
    M hw/milkymist-minimac2.c
    M hw/milkymist-pfpu.c
    M hw/milkymist-softusb.c
    M hw/milkymist-sysctl.c
    M hw/milkymist-tmu2.c
    M hw/milkymist-uart.c
    M hw/milkymist-vgafb.c
    M hw/milkymist.c
    M hw/mips.h
    M hw/mips_fulong2e.c
    M hw/mips_jazz.c
    M hw/mips_malta.c
    M hw/mips_mipssim.c
    M hw/mips_r4k.c
    M hw/mips_timer.c
    M hw/mipsnet.c
    M hw/mpc8544_guts.c
    R hw/msi.c
    R hw/msi.h
    R hw/msix.c
    R hw/msix.h
    M hw/msmouse.c
    M hw/msmouse.h
    M hw/multiboot.c
    M hw/musicpal.c
    M hw/nand.c
    M hw/ne2000-isa.c
    M hw/ne2000.c
    M hw/ne2000.h
    M hw/nseries.c
    M hw/omap.h
    M hw/omap1.c
    M hw/omap2.c
    M hw/omap_dma.c
    M hw/omap_dss.c
    M hw/omap_gpmc.c
    M hw/omap_gptimer.c
    M hw/omap_lcdc.c
    M hw/omap_sx1.c
    M hw/omap_synctimer.c
    M hw/omap_uart.c
    M hw/onenand.c
    M hw/opencores_eth.c
    M hw/openpic.c
    M hw/openrisc_sim.c
    M hw/openrisc_timer.c
    M hw/palm.c
    M hw/pam.c
    M hw/pam.h
    M hw/parallel.c
    M hw/pc.c
    M hw/pc.h
    M hw/pc_piix.c
    M hw/pc_q35.c
    M hw/pc_sysfw.c
    R hw/pci-hotplug.c
    R hw/pci-stub.c
    R hw/pci.c
    R hw/pci.h
    A hw/pci/Makefile.objs
    A hw/pci/msi.c
    A hw/pci/msi.h
    A hw/pci/msix.c
    A hw/pci/msix.h
    A hw/pci/pci-hotplug.c
    A hw/pci/pci-stub.c
    A hw/pci/pci.c
    A hw/pci/pci.h
    A hw/pci/pci_bridge.c
    A hw/pci/pci_bridge.h
    A hw/pci/pci_bus.h
    A hw/pci/pci_host.c
    A hw/pci/pci_host.h
    A hw/pci/pci_ids.h
    A hw/pci/pci_regs.h
    A hw/pci/pcie.c
    A hw/pci/pcie.h
    A hw/pci/pcie_aer.c
    A hw/pci/pcie_aer.h
    A hw/pci/pcie_host.c
    A hw/pci/pcie_host.h
    A hw/pci/pcie_port.c
    A hw/pci/pcie_port.h
    A hw/pci/pcie_regs.h
    A hw/pci/shpc.c
    A hw/pci/shpc.h
    A hw/pci/slotid_cap.c
    A hw/pci/slotid_cap.h
    R hw/pci_bridge.c
    R hw/pci_bridge.h
    M hw/pci_bridge_dev.c
    R hw/pci_host.c
    R hw/pci_host.h
    R hw/pci_ids.h
    R hw/pci_internals.h
    R hw/pci_regs.h
    R hw/pcie.c
    R hw/pcie.h
    R hw/pcie_aer.c
    R hw/pcie_aer.h
    R hw/pcie_host.c
    R hw/pcie_host.h
    R hw/pcie_port.c
    R hw/pcie_port.h
    R hw/pcie_regs.h
    M hw/pckbd.c
    M hw/pcmcia.h
    M hw/pcnet-pci.c
    M hw/pcnet.c
    M hw/pcnet.h
    M hw/pcspk.c
    M hw/petalogix_ml605_mmu.c
    M hw/petalogix_s3adsp1800_mmu.c
    M hw/pflash_cfi01.c
    M hw/pflash_cfi02.c
    M hw/piix4.c
    M hw/piix_pci.c
    R hw/pixel_ops.h
    M hw/pl011.c
    M hw/pl031.c
    M hw/pl110.c
    M hw/pl181.c
    M hw/ppc.c
    M hw/ppc.h
    M hw/ppc/Makefile.objs
    M hw/ppc/e500.c
    M hw/ppc/e500plat.c
    M hw/ppc/mpc8544ds.c
    M hw/ppc405_boards.c
    M hw/ppc405_uc.c
    M hw/ppc440_bamboo.c
    M hw/ppc4xx.h
    M hw/ppc4xx_devs.c
    M hw/ppc4xx_pci.c
    M hw/ppc_booke.c
    M hw/ppc_mac.h
    M hw/ppc_newworld.c
    M hw/ppc_oldworld.c
    M hw/ppc_prep.c
    M hw/ppce500_pci.c
    M hw/ppce500_spin.c
    M hw/prep_pci.c
    M hw/ps2.c
    M hw/ptimer.c
    M hw/ptimer.h
    M hw/puv3.c
    M hw/pxa.h
    M hw/pxa2xx.c
    M hw/pxa2xx_keypad.c
    M hw/pxa2xx_lcd.c
    M hw/pxa2xx_timer.c
    M hw/q35.h
    M hw/qdev-addr.c
    M hw/qdev-addr.h
    M hw/qdev-core.h
    M hw/qdev-monitor.c
    M hw/qdev-monitor.h
    M hw/qdev-properties.c
    M hw/qdev.c
    M hw/qxl-logger.c
    M hw/qxl.c
    M hw/qxl.h
    M hw/r2d.c
    M hw/rc4030.c
    M hw/realview.c
    M hw/rtl8139.c
    M hw/s390-virtio-bus.c
    M hw/s390-virtio-bus.h
    M hw/s390-virtio.c
    M hw/s390x/event-facility.c
    M hw/s390x/event-facility.h
    M hw/s390x/sclp.c
    M hw/s390x/sclpconsole.c
    M hw/s390x/sclpquiesce.c
    M hw/sb16.c
    M hw/scsi-bus.c
    M hw/scsi-defs.h
    M hw/scsi-disk.c
    M hw/scsi-generic.c
    M hw/scsi.h
    M hw/sd.c
    M hw/serial-pci.c
    M hw/serial.c
    M hw/serial.h
    M hw/sga.c
    M hw/sh7750.c
    M hw/sh_intc.h
    M hw/sh_pci.c
    M hw/sh_serial.c
    M hw/sh_timer.c
    M hw/shix.c
    R hw/shpc.c
    R hw/shpc.h
    M hw/slavio_intctl.c
    M hw/slavio_misc.c
    M hw/slavio_timer.c
    R hw/slotid_cap.c
    R hw/slotid_cap.h
    M hw/sm501.c
    M hw/smbios.c
    M hw/smbus_ich9.c
    M hw/smc91c111.c
    M hw/soc_dma.c
    M hw/soc_dma.h
    M hw/spapr.c
    M hw/spapr.h
    M hw/spapr_events.c
    M hw/spapr_hcall.c
    M hw/spapr_iommu.c
    M hw/spapr_llan.c
    M hw/spapr_nvram.c
    M hw/spapr_pci.c
    M hw/spapr_pci.h
    M hw/spapr_rtas.c
    M hw/spapr_vio.c
    M hw/spapr_vio.h
    M hw/spapr_vscsi.c
    M hw/spapr_vty.c
    M hw/spitz.c
    M hw/ssd0303.c
    M hw/ssd0323.c
    M hw/ssi-sd.c
    M hw/stellaris.c
    M hw/stellaris_enet.c
    M hw/stellaris_input.c
    M hw/stream.h
    M hw/strongarm.c
    M hw/strongarm.h
    M hw/sun4c_intctl.c
    M hw/sun4m.c
    M hw/sun4u.c
    M hw/sysbus.c
    M hw/sysbus.h
    M hw/tc6393xb.c
    M hw/tcx.c
    M hw/tosa.c
    M hw/tsc2005.c
    M hw/tsc210x.c
    M hw/tusb6010.c
    M hw/twl92230.c
    A hw/uboot_image.h
    M hw/unin_pci.c
    M hw/usb.h
    M hw/usb/bus.c
    M hw/usb/combined-packet.c
    M hw/usb/core.c
    M hw/usb/dev-bluetooth.c
    M hw/usb/dev-hid.c
    M hw/usb/dev-network.c
    M hw/usb/dev-serial.c
    M hw/usb/dev-smartcard-reader.c
    M hw/usb/dev-storage.c
    M hw/usb/dev-uas.c
    M hw/usb/dev-wacom.c
    M hw/usb/hcd-ehci-pci.c
    M hw/usb/hcd-ehci.h
    M hw/usb/hcd-musb.c
    M hw/usb/hcd-ohci.c
    M hw/usb/hcd-uhci.c
    M hw/usb/hcd-xhci.c
    M hw/usb/host-bsd.c
    M hw/usb/host-linux.c
    M hw/usb/host-stub.c
    M hw/usb/libhw.c
    M hw/usb/redirect.c
    M hw/versatile_pci.c
    M hw/versatilepb.c
    M hw/vexpress.c
    M hw/vfio_pci.c
    M hw/vga-isa-mm.c
    M hw/vga-isa.c
    M hw/vga-pci.c
    M hw/vga.c
    M hw/vga_int.h
    M hw/vhost.c
    M hw/vhost.h
    M hw/vhost_net.c
    M hw/vhost_net.h
    M hw/virtex_ml507.c
    M hw/virtio-balloon.c
    M hw/virtio-balloon.h
    M hw/virtio-blk.c
    M hw/virtio-console.c
    M hw/virtio-net.c
    M hw/virtio-net.h
    M hw/virtio-pci.c
    M hw/virtio-rng.c
    M hw/virtio-scsi.h
    M hw/virtio-serial-bus.c
    M hw/virtio.c
    M hw/virtio.h
    M hw/vmmouse.c
    M hw/vmport.c
    M hw/vmware_vga.c
    M hw/vt82c686.c
    M hw/watchdog.c
    M hw/watchdog.h
    M hw/wdt_i6300esb.c
    M hw/wdt_ib700.c
    M hw/xen-host-pci-device.h
    M hw/xen_apic.c
    M hw/xen_backend.c
    M hw/xen_backend.h
    M hw/xen_common.h
    M hw/xen_console.c
    M hw/xen_devconfig.c
    M hw/xen_disk.c
    M hw/xen_domainbuild.c
    M hw/xen_machine_pv.c
    M hw/xen_nic.c
    M hw/xen_platform.c
    M hw/xen_pt.c
    M hw/xen_pt.h
    M hw/xen_pt_config_init.c
    M hw/xenfb.c
    M hw/xgmac.c
    M hw/xilinx.h
    M hw/xilinx_axidma.c
    M hw/xilinx_axienet.c
    M hw/xilinx_ethlite.c
    M hw/xilinx_spi.c
    M hw/xilinx_spips.c
    M hw/xilinx_timer.c
    M hw/xilinx_uartlite.c
    M hw/xilinx_zynq.c
    M hw/xio3130_downstream.c
    M hw/xio3130_downstream.h
    M hw/xio3130_upstream.c
    M hw/xio3130_upstream.h
    M hw/xtensa_lx60.c
    M hw/xtensa_pic.c
    M hw/xtensa_sim.c
    M hw/z2.c
    M hw/zynq_slcr.c
    R hwaddr.h
    R i386-dis.c
    R i386.ld
    R ia64-dis.c
    R ia64.ld
    A include/block/aes.h
    A include/block/aio.h
    A include/block/block.h
    A include/block/block_int.h
    A include/block/blockjob.h
    A include/block/coroutine.h
    A include/block/coroutine_int.h
    A include/block/nbd.h
    A include/block/thread-pool.h
    A include/bt/bt.h
    A include/char/char.h
    A include/config.h
    A include/disas/bfd.h
    A include/disas/disas.h
    A include/elf.h
    A include/exec/address-spaces.h
    A include/exec/cpu-all.h
    A include/exec/cpu-common.h
    A include/exec/cpu-defs.h
    A include/exec/cputlb.h
    A include/exec/def-helper.h
    A include/exec/exec-all.h
    A include/exec/gdbstub.h
    A include/exec/gen-icount.h
    A include/exec/hwaddr.h
    A include/exec/ioport.h
    A include/exec/iorange.h
    A include/exec/memory-internal.h
    A include/exec/memory.h
    A include/exec/poison.h
    A include/exec/softmmu-semi.h
    A include/exec/softmmu_defs.h
    A include/exec/softmmu_exec.h
    A include/exec/softmmu_header.h
    A include/exec/softmmu_template.h
    A include/exec/spinlock.h
    A include/exec/user/abitypes.h
    A include/exec/user/thunk.h
    A include/fpu/softfloat.h
    A include/libfdt_env.h
    A include/migration/block.h
    A include/migration/migration.h
    A include/migration/page_cache.h
    A include/migration/qemu-file.h
    A include/migration/vmstate.h
    A include/monitor/monitor.h
    A include/monitor/readline.h
    A include/net/checksum.h
    A include/net/net.h
    A include/net/queue.h
    A include/net/slirp.h
    A include/net/tap.h
    A include/qapi/dealloc-visitor.h
    A include/qapi/error.h
    A include/qapi/opts-visitor.h
    A include/qapi/qmp-input-visitor.h
    A include/qapi/qmp-output-visitor.h
    A include/qapi/qmp/dispatch.h
    A include/qapi/qmp/json-lexer.h
    A include/qapi/qmp/json-parser.h
    A include/qapi/qmp/json-streamer.h
    A include/qapi/qmp/qbool.h
    A include/qapi/qmp/qdict.h
    A include/qapi/qmp/qerror.h
    A include/qapi/qmp/qfloat.h
    A include/qapi/qmp/qint.h
    A include/qapi/qmp/qjson.h
    A include/qapi/qmp/qlist.h
    A include/qapi/qmp/qobject.h
    A include/qapi/qmp/qstring.h
    A include/qapi/qmp/types.h
    A include/qapi/string-input-visitor.h
    A include/qapi/string-output-visitor.h
    A include/qapi/visitor-impl.h
    A include/qapi/visitor.h
    A include/qemu-common.h
    A include/qemu/acl.h
    A include/qemu/atomic.h
    A include/qemu/bitmap.h
    A include/qemu/bitops.h
    A include/qemu/bswap.h
    A include/qemu/cache-utils.h
    A include/qemu/compatfd.h
    A include/qemu/compiler.h
    A include/qemu/config-file.h
    R include/qemu/cpu.h
    A include/qemu/envlist.h
    A include/qemu/error-report.h
    A include/qemu/event_notifier.h
    A include/qemu/host-utils.h
    A include/qemu/int128.h
    A include/qemu/iov.h
    A include/qemu/log.h
    A include/qemu/main-loop.h
    A include/qemu/module.h
    A include/qemu/notify.h
    R include/qemu/object.h
    A include/qemu/option.h
    A include/qemu/option_int.h
    A include/qemu/osdep.h
    R include/qemu/page_cache.h
    R include/qemu/qom-qobject.h
    A include/qemu/queue.h
    A include/qemu/range.h
    M include/qemu/rng-random.h
    M include/qemu/rng.h
    A include/qemu/sockets.h
    A include/qemu/thread-posix.h
    A include/qemu/thread-win32.h
    A include/qemu/thread.h
    A include/qemu/timer.h
    A include/qemu/tls.h
    A include/qemu/typedefs.h
    A include/qemu/uri.h
    A include/qemu/xattr.h
    A include/qom/cpu.h
    A include/qom/object.h
    A include/qom/qom-qobject.h
    A include/sysemu/arch_init.h
    A include/sysemu/balloon.h
    A include/sysemu/blockdev.h
    A include/sysemu/cpus.h
    A include/sysemu/device_tree.h
    A include/sysemu/dma.h
    A include/sysemu/dump.h
    A include/sysemu/kvm.h
    A include/sysemu/memory_mapping.h
    A include/sysemu/os-posix.h
    A include/sysemu/os-win32.h
    A include/sysemu/qtest.h
    A include/sysemu/seccomp.h
    A include/sysemu/sysemu.h
    A include/sysemu/xen-mapcache.h
    A include/ui/console.h
    A include/ui/pixel_ops.h
    A include/ui/qemu-pixman.h
    A include/ui/qemu-spice.h
    A include/ui/spice-display.h
    R input.c
    R int128.h
    M iohandler.c
    M ioport.c
    R ioport.h
    R iorange.h
    M iov.c
    R iov.h
    M json-lexer.c
    R json-lexer.h
    M json-parser.c
    R json-parser.h
    M json-streamer.c
    R json-streamer.h
    M kvm-all.c
    M kvm-stub.c
    R kvm.h
    A ldscripts/alpha.ld
    A ldscripts/arm.ld
    A ldscripts/hppa.ld
    A ldscripts/i386.ld
    A ldscripts/ia64.ld
    A ldscripts/m68k.ld
    A ldscripts/mips.ld
    A ldscripts/ppc.ld
    A ldscripts/ppc64.ld
    A ldscripts/s390.ld
    A ldscripts/sparc.ld
    A ldscripts/sparc64.ld
    A ldscripts/x86_64.ld
    M libcacard/event.c
    M libcacard/vreader.c
    M libcacard/vscclient.c
    R libfdt_env.h
    M linux-user/arm/nwfpe/double_cpdo.c
    M linux-user/arm/nwfpe/extended_cpdo.c
    M linux-user/arm/nwfpe/fpa11.h
    M linux-user/arm/nwfpe/fpa11_cpdt.c
    M linux-user/arm/nwfpe/fpa11_cprt.c
    M linux-user/arm/nwfpe/fpopcode.c
    M linux-user/arm/nwfpe/single_cpdo.c
    M linux-user/cris/syscall.h
    M linux-user/elfload.c
    M linux-user/main.c
    M linux-user/microblaze/syscall.h
    M linux-user/qemu.h
    M linux-user/syscall.c
    M linux-user/syscall_defs.h
    R lm32-dis.c
    R m68k-dis.c
    R m68k.ld
    M main-loop.c
    R main-loop.h
    R memory-internal.h
    M memory.c
    R memory.h
    M memory_mapping-stub.c
    M memory_mapping.c
    R memory_mapping.h
    R microblaze-dis.c
    M migration-exec.c
    M migration-fd.c
    M migration-tcp.c
    M migration-unix.c
    M migration.c
    R migration.h
    R mips-dis.c
    R mips.ld
    M module.c
    R module.h
    M monitor.c
    R monitor.h
    M nbd.c
    R nbd.h
    R net.c
    R net.h
    M net/Makefile.objs
    R net/checksum.h
    M net/clients.h
    M net/dump.c
    M net/hub.c
    M net/hub.h
    A net/net.c
    M net/queue.c
    R net/queue.h
    M net/slirp.c
    R net/slirp.h
    M net/socket.c
    M net/tap-aix.c
    M net/tap-bsd.c
    M net/tap-haiku.c
    M net/tap-linux.c
    M net/tap-linux.h
    M net/tap-solaris.c
    M net/tap-win32.c
    M net/tap.c
    R net/tap.h
    A net/tap_int.h
    M net/util.c
    M net/vde.c
    M notify.c
    R notify.h
    M os-posix.c
    M os-win32.c
    M osdep.c
    R osdep.h
    M oslib-posix.c
    M oslib-win32.c
    M page_cache.c
    M pixman
    R poison.h
    R ppc-dis.c
    R ppc.ld
    R ppc64.ld
    R qapi-schema-guest.json
    M qapi/opts-visitor.c
    R qapi/opts-visitor.h
    M qapi/qapi-dealloc-visitor.c
    R qapi/qapi-dealloc-visitor.h
    R qapi/qapi-types-core.h
    M qapi/qapi-visit-core.c
    R qapi/qapi-visit-core.h
    R qapi/qapi-visit-impl.h
    R qapi/qmp-core.h
    M qapi/qmp-dispatch.c
    M qapi/qmp-input-visitor.c
    R qapi/qmp-input-visitor.h
    M qapi/qmp-output-visitor.c
    R qapi/qmp-output-visitor.h
    M qapi/qmp-registry.c
    M qapi/string-input-visitor.c
    R qapi/string-input-visitor.h
    M qapi/string-output-visitor.c
    R qapi/string-output-visitor.h
    M qbool.c
    R qbool.h
    M qdict.c
    R qdict.h
    R qemu-aio.h
    R qemu-barrier.h
    M qemu-bridge-helper.c
    M qemu-char.c
    R qemu-char.h
    R qemu-common.h
    M qemu-config.c
    R qemu-config.h
    R qemu-coroutine-int.h
    M qemu-coroutine-io.c
    M qemu-coroutine-lock.c
    M qemu-coroutine-sleep.c
    M qemu-coroutine.c
    R qemu-coroutine.h
    M qemu-error.c
    R qemu-error.h
    R qemu-file.h
    R qemu-ga.c
    M qemu-img.c
    M qemu-io.c
    R qemu-lock.h
    M qemu-log.c
    R qemu-log.h
    M qemu-nbd.c
    R qemu-objects.h
    R qemu-option-internal.h
    M qemu-option.c
    R qemu-option.h
    R qemu-os-posix.h
    R qemu-os-win32.h
    R qemu-pixman.c
    R qemu-pixman.h
    M qemu-progress.c
    R qemu-queue.h
    M qemu-seccomp.c
    R qemu-seccomp.h
    M qemu-sockets.c
    M qemu-thread-posix.c
    R qemu-thread-posix.h
    M qemu-thread-win32.c
    R qemu-thread-win32.h
    R qemu-thread.h
    M qemu-timer-common.c
    M qemu-timer.c
    R qemu-timer.h
    R qemu-tls.h
    M qemu-tool.c
    R qemu-types.h
    R qemu-user-types.h
    M qemu-user.c
    R qemu-x509.h
    R qemu-xattr.h
    R qemu_socket.h
    M qerror.c
    R qerror.h
    M qfloat.c
    R qfloat.h
    M qga/Makefile.objs
    M qga/channel-posix.c
    M qga/commands-posix.c
    M qga/commands-win32.c
    M qga/commands.c
    M qga/guest-agent-core.h
    A qga/main.c
    A qga/qapi-schema.json
    M qint.c
    R qint.h
    M qjson.c
    R qjson.h
    M qlist.c
    R qlist.h
    M qmp.c
    R qobject.h
    M qom/container.c
    M qom/cpu.c
    M qom/object.c
    M qom/qom-qobject.c
    M qstring.c
    R qstring.h
    M qtest.c
    R qtest.h
    R range.h
    M readline.c
    R readline.h
    M rules.mak
    R s390-dis.c
    R s390.ld
    M savevm.c
    M scripts/feature_to_c.sh
    M scripts/get_maintainer.pl
    M scripts/qapi-commands.py
    M scripts/qapi-types.py
    M scripts/qapi-visit.py
    R sh4-dis.c
    M slirp/bootp.h
    M slirp/if.c
    M slirp/ip_input.c
    M slirp/main.h
    M slirp/misc.c
    M slirp/sbuf.c
    M slirp/slirp.c
    M slirp/slirp.h
    M slirp/tftp.h
    R softmmu-semi.h
    R softmmu_defs.h
    R softmmu_exec.h
    R softmmu_header.h
    R softmmu_template.h
    R sparc-dis.c
    R sparc.ld
    R sparc64.ld
    M spice-qemu-char.c
    M stubs/arch-query-cpu-def.c
    M stubs/fd-register.c
    M stubs/fdset-add-fd.c
    M stubs/fdset-find-fd.c
    M stubs/fdset-get-fd.c
    M stubs/fdset-remove-fd.c
    M stubs/get-fd.c
    M stubs/set-fd-handler.c
    R sysemu.h
    M target-alpha/cpu-qom.h
    M target-alpha/cpu.h
    M target-alpha/fpu_helper.c
    M target-alpha/helper.c
    M target-alpha/helper.h
    M target-alpha/int_helper.c
    M target-alpha/mem_helper.c
    M target-alpha/sys_helper.c
    M target-alpha/translate.c
    M target-arm/arm-semi.c
    M target-arm/cpu-qom.h
    M target-arm/cpu.c
    M target-arm/cpu.h
    M target-arm/helper.c
    M target-arm/helper.h
    M target-arm/iwmmxt_helper.c
    M target-arm/neon_helper.c
    M target-arm/op_helper.c
    M target-arm/translate.c
    M target-cris/cpu-qom.h
    M target-cris/cpu.h
    M target-cris/crisv32-decode.h
    M target-cris/helper.c
    M target-cris/helper.h
    M target-cris/op_helper.c
    M target-cris/translate.c
    M target-i386/arch_dump.c
    M target-i386/arch_memory_mapping.c
    M target-i386/cpu-qom.h
    M target-i386/cpu.c
    M target-i386/cpu.h
    M target-i386/excp_helper.c
    M target-i386/fpu_helper.c
    M target-i386/helper.c
    M target-i386/helper.h
    M target-i386/int_helper.c
    M target-i386/ioport-user.c
    M target-i386/kvm.c
    M target-i386/kvm_i386.h
    M target-i386/machine.c
    M target-i386/mem_helper.c
    M target-i386/misc_helper.c
    M target-i386/seg_helper.c
    M target-i386/svm_helper.c
    M target-i386/translate.c
    M target-lm32/cpu-qom.h
    M target-lm32/cpu.h
    M target-lm32/helper.c
    M target-lm32/helper.h
    M target-lm32/op_helper.c
    M target-lm32/translate.c
    M target-m68k/cpu-qom.h
    M target-m68k/cpu.h
    M target-m68k/helper.c
    M target-m68k/helpers.h
    M target-m68k/m68k-semi.c
    M target-m68k/op_helper.c
    M target-m68k/translate.c
    M target-microblaze/cpu-qom.h
    M target-microblaze/cpu.h
    M target-microblaze/helper.c
    M target-microblaze/helper.h
    M target-microblaze/op_helper.c
    M target-microblaze/translate.c
    M target-mips/cpu-qom.h
    M target-mips/cpu.h
    M target-mips/helper.h
    M target-mips/op_helper.c
    M target-mips/translate.c
    M target-openrisc/cpu.h
    M target-openrisc/helper.h
    M target-openrisc/int_helper.c
    M target-openrisc/interrupt.c
    M target-openrisc/mmu.c
    M target-openrisc/mmu_helper.c
    M target-openrisc/translate.c
    M target-ppc/cpu-qom.h
    M target-ppc/cpu.h
    M target-ppc/helper.c
    M target-ppc/helper.h
    M target-ppc/int_helper.c
    M target-ppc/kvm.c
    M target-ppc/kvm_ppc.c
    M target-ppc/kvm_ppc.h
    M target-ppc/machine.c
    M target-ppc/mem_helper.c
    M target-ppc/mmu_helper.c
    M target-ppc/translate.c
    M target-ppc/translate_init.c
    M target-s390x/cpu-qom.h
    M target-s390x/cpu.c
    M target-s390x/cpu.h
    M target-s390x/fpu_helper.c
    M target-s390x/helper.c
    M target-s390x/helper.h
    M target-s390x/int_helper.c
    M target-s390x/interrupt.c
    M target-s390x/kvm.c
    M target-s390x/mem_helper.c
    M target-s390x/misc_helper.c
    M target-s390x/translate.c
    M target-sh4/cpu-qom.h
    M target-sh4/cpu.h
    M target-sh4/helper.h
    M target-sh4/op_helper.c
    M target-sh4/translate.c
    M target-sparc/cpu-qom.h
    M target-sparc/cpu.h
    M target-sparc/helper.c
    M target-sparc/helper.h
    M target-sparc/int32_helper.c
    M target-sparc/ldst_helper.c
    M target-sparc/machine.c
    M target-sparc/mmu_helper.c
    M target-sparc/translate.c
    M target-unicore32/cpu-qom.h
    M target-unicore32/cpu.h
    M target-unicore32/helper.c
    M target-unicore32/helper.h
    M target-unicore32/op_helper.c
    M target-unicore32/translate.c
    M target-xtensa/core-dc232b.c
    M target-xtensa/core-dc233c.c
    M target-xtensa/core-fsf.c
    M target-xtensa/cpu-qom.h
    M target-xtensa/cpu.h
    M target-xtensa/helper.c
    M target-xtensa/helper.h
    M target-xtensa/op_helper.c
    M target-xtensa/translate.c
    M target-xtensa/xtensa-semi.c
    M tcg/arm/tcg-target.c
    M tcg/arm/tcg-target.h
    M tcg/hppa/tcg-target.c
    M tcg/hppa/tcg-target.h
    M tcg/i386/tcg-target.c
    M tcg/i386/tcg-target.h
    M tcg/ia64/tcg-target.c
    M tcg/ia64/tcg-target.h
    M tcg/mips/tcg-target.c
    M tcg/mips/tcg-target.h
    M tcg/ppc/tcg-target.c
    M tcg/ppc/tcg-target.h
    M tcg/ppc64/tcg-target.c
    M tcg/ppc64/tcg-target.h
    M tcg/s390/tcg-target.c
    M tcg/s390/tcg-target.h
    M tcg/sparc/tcg-target.c
    M tcg/sparc/tcg-target.h
    M tcg/tcg.c
    R tci-dis.c
    M tci.c
    M tests/check-qdict.c
    M tests/check-qfloat.c
    M tests/check-qint.c
    M tests/check-qjson.c
    M tests/check-qlist.c
    M tests/check-qstring.c
    M tests/libqtest.c
    M tests/tcg/cris/crisutils.h
    M tests/tcg/test-i386-fprem.c
    M tests/tcg/test-i386.c
    M tests/test-aio.c
    M tests/test-coroutine.c
    M tests/test-iov.c
    M tests/test-qmp-commands.c
    M tests/test-qmp-input-strict.c
    M tests/test-qmp-input-visitor.c
    M tests/test-qmp-output-visitor.c
    M tests/test-string-input-visitor.c
    M tests/test-string-output-visitor.c
    M tests/test-thread-pool.c
    M tests/test-visitor-serialization.c
    M thread-pool.c
    R thread-pool.h
    M thunk.c
    R thunk.h
    M trace/simple.c
    M translate-all.c
    R uboot_image.h
    M ui/Makefile.objs
    M ui/cocoa.m
    A ui/console.c
    M ui/curses.c
    M ui/curses_keys.h
    A ui/cursor.c
    A ui/cursor_hidden.xpm
    A ui/cursor_left_ptr.xpm
    M ui/d3des.h
    A ui/input.c
    M ui/keymaps.c
    A ui/qemu-pixman.c
    R ui/qemu-spice.h
    A ui/qemu-x509.h
    M ui/sdl.c
    M ui/sdl_zoom.c
    M ui/spice-core.c
    M ui/spice-display.c
    R ui/spice-display.h
    M ui/spice-input.c
    A ui/vgafont.h
    M ui/vnc-auth-sasl.h
    M ui/vnc-enc-tight.c
    M ui/vnc-jobs.c
    M ui/vnc-palette.h
    M ui/vnc-tls.c
    M ui/vnc-tls.h
    M ui/vnc.c
    M ui/vnc.h
    M uri.c
    R uri.h
    M user-exec.c
    R vgafont.h
    M vl.c
    R vmstate.h
    R x86_64.ld
    M xen-all.c
    M xen-mapcache.c
    R xen-mapcache.h
    M xen-stub.c

  Log Message:
  -----------
  Merge remote-tracking branch 'bonzini/header-dirs' into staging

* bonzini/header-dirs: (45 commits)
  janitor: move remaining public headers to include/
  hw: move executable format header files to hw/
  fpu: move public header file to include/fpu
  softmmu: move remaining include files to include/ subdirectories
  softmmu: move include files to include/sysemu/
  misc: move include files to include/qemu/
  qom: move include files to include/qom/
  migration: move include files to include/migration/
  monitor: move include files to include/monitor/
  exec: move include files to include/exec/
  block: move include files to include/block/
  qapi: move include files to include/qobject/
  janitor: add guards to headers
  qapi: make struct Visitor opaque
  qapi: remove qapi/qapi-types-core.h
  qapi: move inclusions of qemu-common.h from headers to .c files
  ui: move files to ui/ and include/ui/
  qemu-ga: move qemu-ga files to qga/
  net: reorganize headers
  net: move net.c to net/
  ...

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/914606d26e65...27dd7730582b

----==_mimepart_50d2632ff2375_548c152eae4151017--


</body></email><email><emailId>20121222023013</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-22 02:30:13-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 244eaa: migration: fix migration_bitmap leak</subject><body>



----==_mimepart_50d51b357b2a1_6ff9f59aec67450
Date: Fri, 21 Dec 2012 18:30:13 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50d51b3589661_6ff9f59aec675fe@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 244eaa7514a944b36273eb8428f32da8e9124fcf
      https://github.com/qemu/qemu/commit/244eaa7514a944b36273eb8428f32da8e9124fcf
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M arch_init.c

  Log Message:
  -----------
  migration: fix migration_bitmap leak

Cc: qemu-stable@nongnu.org
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: bde54c08b4854aceee3dee25121a2b835cb81166
      https://github.com/qemu/qemu/commit/bde54c08b4854aceee3dee25121a2b835cb81166
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M buffered_file.c

  Log Message:
  -----------
  buffered_file: do not send more than s-&gt;bytes_xfer bytes per tick

Sending more was possible if the buffer was large.

Cc: qemu-stable@nongnu.org
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 24ea1e4b4b79cef2bac6f8e0f0a212f42ef420a9
      https://github.com/qemu/qemu/commit/24ea1e4b4b79cef2bac6f8e0f0a212f42ef420a9
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M migration.c

  Log Message:
  -----------
  migration: remove double call to migrate_fd_close

The call in buffered_close is enough, because buffered_close is called
already by migrate_fd_cleanup.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 557ec5a001740d234e2b9604f0697a0d52ae90ca
      https://github.com/qemu/qemu/commit/557ec5a001740d234e2b9604f0697a0d52ae90ca
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M migration-exec.c
    M migration-fd.c
    M migration-tcp.c
    M migration-unix.c

  Log Message:
  -----------
  migration: include qemu-file.h

They don't use/know anything about buffered-file.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 803ef03257a9ee375f08ca7a89e009ea12bc17a4
      https://github.com/qemu/qemu/commit/803ef03257a9ee375f08ca7a89e009ea12bc17a4
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M migration-fd.c

  Log Message:
  -----------
  migration-fd: remove duplicate include

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 0d6d3c87a232cc27641dde3491d75c8021745d02
      https://github.com/qemu/qemu/commit/0d6d3c87a232cc27641dde3491d75c8021745d02
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M arch_init.c
    M exec.c
    M include/exec/cpu-all.h

  Log Message:
  -----------
  exec: change ramlist from MRU order to a 1-item cache

Most of the time, only 2 items will be active (from/to for a string operation,
or code/data).  But TCG guests likely won't have gigabytes of memory, so
this actually goes down to 1 item.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: a3161038a1fd17a638a0c606f71e1f799f65f41b
      https://github.com/qemu/qemu/commit/a3161038a1fd17a638a0c606f71e1f799f65f41b
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M arch_init.c
    M dump.c
    M exec.c
    M include/exec/cpu-all.h
    M memory_mapping.c
    M target-i386/arch_dump.c

  Log Message:
  -----------
  exec: change RAM list to a TAILQ

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: abb26d63e7e4492d306c13b7e0e799d4c11a067c
      https://github.com/qemu/qemu/commit/abb26d63e7e4492d306c13b7e0e799d4c11a067c
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M arch_init.c
    M exec.c

  Log Message:
  -----------
  exec: sort the memory from biggest to smallest

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: f798b07f517143df3a1e38bccc3f72ade2f080dc
      https://github.com/qemu/qemu/commit/f798b07f517143df3a1e38bccc3f72ade2f080dc
  Author: Umesh Deshpande &lt;udeshpan@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M arch_init.c
    M exec.c
    M include/exec/cpu-all.h

  Log Message:
  -----------
  add a version number to ram_list

This will be used to detect if last_block might have become invalid
across different calls to ram_save_live.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Umesh Deshpande &lt;udeshpan@redhat.com&gt;
Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Orit Wasserman &lt;owasserm@redhat.com&gt;


  Commit: b2a8658ef5dc57ea9e7a45091724a719dd4bdcd3
      https://github.com/qemu/qemu/commit/b2a8658ef5dc57ea9e7a45091724a719dd4bdcd3
  Author: Umesh Deshpande &lt;udeshpan@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M arch_init.c
    M exec.c
    M include/exec/cpu-all.h

  Log Message:
  -----------
  protect the ramlist with a separate mutex

Add the new mutex that protects shared state between ram_save_live
and the iothread.  If the iothread mutex has to be taken together
with the ramlist mutex, the iothread shall always be _outside_.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Umesh Deshpande &lt;udeshpan@redhat.com&gt;
Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Orit Wasserman &lt;owasserm@redhat.com&gt;


  Commit: c09f4cb2b3243085a86aee3c7ed4f31c77e4db87
      https://github.com/qemu/qemu/commit/c09f4cb2b3243085a86aee3c7ed4f31c77e4db87
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M buffered_file.c

  Log Message:
  -----------
  buffered_file: Move from using a timer to use a thread

We still protect everything except the wait with the iothread lock.
But we moved from a timer to a thread.  Steps one by one.

We also need to detect when we have finished with a variable "complete".

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: edfa1af52f4c69264c5a0c38da10eb372077fba3
      https://github.com/qemu/qemu/commit/edfa1af52f4c69264c5a0c38da10eb372077fba3
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M buffered_file.c
    M buffered_file.h
    M include/migration/migration.h
    M migration.c

  Log Message:
  -----------
  migration: make qemu_fopen_ops_buffered() return void

We want the file assignment to happen before the thread is created to
avoid locking, so we just do it before creating the thread.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Orit Wasserman &lt;owasserm@redhat.com&gt;


  Commit: 766bd1769e70835e0cc25f3f057f101619494b59
      https://github.com/qemu/qemu/commit/766bd1769e70835e0cc25f3f057f101619494b59
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M include/migration/migration.h
    M migration.c

  Log Message:
  -----------
  migration: move migration thread init code to migrate_fd_put_ready

This way everything related with migration is run on the migration
thread and no locking is needed.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: dd217b8732b93d97c22fa70dc15a72d92a2b2380
      https://github.com/qemu/qemu/commit/dd217b8732b93d97c22fa70dc15a72d92a2b2380
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M include/migration/qemu-file.h
    M migration-exec.c
    M migration-fd.c
    M migration-tcp.c
    M migration-unix.c
    M migration.c
    M savevm.c

  Log Message:
  -----------
  migration: make writes blocking

Move all the writes to the migration_thread, and make writings
blocking.  Notice that are still using the iothread for everything
that we do.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 188a428559f0cd0bde884d28b42e449abd744c2f
      https://github.com/qemu/qemu/commit/188a428559f0cd0bde884d28b42e449abd744c2f
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M buffered_file.c
    M include/migration/migration.h
    M migration.c

  Log Message:
  -----------
  migration: remove unfreeze logic

Now that we have a thread, and blocking writes, we don't need it.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: e76274824defce54a124e5104be3880044c698e1
      https://github.com/qemu/qemu/commit/e76274824defce54a124e5104be3880044c698e1
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M buffered_file.c
    M migration.c

  Log Message:
  -----------
  migration: just lock migrate_fd_put_ready

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 78d1d231f889f7eae3835ddaec4373011792e46f
      https://github.com/qemu/qemu/commit/78d1d231f889f7eae3835ddaec4373011792e46f
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M buffered_file.c

  Log Message:
  -----------
  buffered_file: Unfold the trick to restart generating migration data

This was needed before due to the way that the callbacks worked.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: c518dd841deb85b3ccf77ff93e1142b27b06af32
      https://github.com/qemu/qemu/commit/c518dd841deb85b3ccf77ff93e1142b27b06af32
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M buffered_file.c

  Log Message:
  -----------
  buffered_file: don't flush on put buffer

We call buffered_put_buffer with iothread held, and buffered_flush() does
synchronous writes.  We only want to do the synchronous writes outside.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: f50b4986b261fc10065289d2a03deba24d824988
      https://github.com/qemu/qemu/commit/f50b4986b261fc10065289d2a03deba24d824988
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M buffered_file.c

  Log Message:
  -----------
  buffered_file: unfold buffered_append in buffered_put_buffer

It was the only user, and now buffered_put_buffer just do the append

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: e4ed1541ac9413eac494a03532e34beaf8a7d1c5
      https://github.com/qemu/qemu/commit/e4ed1541ac9413eac494a03532e34beaf8a7d1c5
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M arch_init.c
    M block-migration.c
    M buffered_file.c
    M include/migration/migration.h
    M include/migration/vmstate.h
    M include/sysemu/sysemu.h
    M migration.c
    M savevm.c

  Log Message:
  -----------
  savevm: New save live migration method: pending

Code just now does (simplified for clarity)

    if (qemu_savevm_state_iterate(s-&gt;file) == 1) {
       vm_stop_force_state(RUN_STATE_FINISH_MIGRATE);
       qemu_savevm_state_complete(s-&gt;file);
    }

Problem here is that qemu_savevm_state_iterate() returns 1 when it
knows that remaining memory to sent takes less than max downtime.

But this means that we could end spending 2x max_downtime, one
downtime in qemu_savevm_iterate, and the other in
qemu_savevm_state_complete.

Changed code to:

    pending_size = qemu_savevm_state_pending(s-&gt;file, max_size);
    DPRINTF("pending size %lu max %lu\n", pending_size, max_size);
    if (pending_size &gt;= max_size) {
  ret = qemu_savevm_state_iterate(s-&gt;file);
     } else {
  vm_stop_force_state(RUN_STATE_FINISH_MIGRATE);
  qemu_savevm_state_complete(s-&gt;file);
     }

So what we do is: at current network speed, we calculate the maximum
number of bytes we can sent: max_size.

Then we ask every save_live section how much they have pending.  If
they are less than max_size, we move to complete phase, otherwise we
do an iterate one.

This makes things much simpler, because now individual sections don't
have to caluclate the bandwidth (it was implossible to do right from
there).

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 0d82d0e8b98cf0ea03a45f8542d835ebd3a84cd3
      https://github.com/qemu/qemu/commit/0d82d0e8b98cf0ea03a45f8542d835ebd3a84cd3
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M Makefile.objs
    R buffered_file.c
    R buffered_file.h
    M include/migration/migration.h
    M migration.c

  Log Message:
  -----------
  migration: move buffered_file.c code into migration.c

This only moves the code (also from buffered_file.h to migration.h).
Fix whitespace until checkpatch is happy.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 5b4e1eb769eee892b44d3f6b2369b05196442f59
      https://github.com/qemu/qemu/commit/5b4e1eb769eee892b44d3f6b2369b05196442f59
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M migration.c

  Log Message:
  -----------
  migration: add XFER_LIMIT_RATIO

The "magic" divisions by 10 are there because of the value of BUFFER_DELAY.
Introduce a constant to explain them better.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 0e288fa369c02df1731dc59ffbf158f5e5f2d80f
      https://github.com/qemu/qemu/commit/0e288fa369c02df1731dc59ffbf158f5e5f2d80f
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M include/migration/migration.h
    M migration.c

  Log Message:
  -----------
  migration: move migration_fd_put_ready()

Put it near its use and un-export it.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 2e450865338738300e529457879d81332939f064
      https://github.com/qemu/qemu/commit/2e450865338738300e529457879d81332939f064
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M include/migration/migration.h
    M migration.c

  Log Message:
  -----------
  migration: Inline qemu_fopen_ops_buffered into migrate_fd_connect

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 0d3b26f5488e04c01667dd12c9bd7eed54dda258
      https://github.com/qemu/qemu/commit/0d3b26f5488e04c01667dd12c9bd7eed54dda258
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M migration.c

  Log Message:
  -----------
  migration: move migration notifier

At this point, it is waranteed that state is ACTIVE.  Old position
didn't assured hat.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: b23a9a5cad356cdc8e25d4be72e53096a27ea722
      https://github.com/qemu/qemu/commit/b23a9a5cad356cdc8e25d4be72e53096a27ea722
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M arch_init.c

  Log Message:
  -----------
  ram: rename last_block to last_seen_block

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 5f718a15d0db3775bbcf2755a35dd6b019bcff8b
      https://github.com/qemu/qemu/commit/5f718a15d0db3775bbcf2755a35dd6b019bcff8b
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M arch_init.c

  Log Message:
  -----------
  ram: Add last_sent_block

This is the last block from where we have sent data.

Signed-off-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 6c279db8ee99e64e498447c67c16e987150be96b
      https://github.com/qemu/qemu/commit/6c279db8ee99e64e498447c67c16e987150be96b
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M include/exec/memory.h
    M memory.c

  Log Message:
  -----------
  memory: introduce memory_region_test_and_clear_dirty

This function avoids having to do two calls, one to test the dirty bit, and
other to reset it.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: ece7931817e03a4d946c15716fab5e4f781663c9
      https://github.com/qemu/qemu/commit/ece7931817e03a4d946c15716fab5e4f781663c9
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M arch_init.c

  Log Message:
  -----------
  ram: Use memory_region_test_and_clear_dirty

This avoids having to do two walks over the dirty bitmap, once reading
the dirty bits, and anthoer cleaning them.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 4c8ae0f60e63478aea0a1741cca95474b68fb949
      https://github.com/qemu/qemu/commit/4c8ae0f60e63478aea0a1741cca95474b68fb949
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M arch_init.c

  Log Message:
  -----------
  ram: optimize migration bitmap walking

Instead of testing each page individually, we search what is the next
dirty page with a bitmap operation.  We have to reorganize the code to
move from a "for" loop, to a while(dirty) loop.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 3f7d7b098194ec893efa037491f6231687ff043a
      https://github.com/qemu/qemu/commit/3f7d7b098194ec893efa037491f6231687ff043a
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M arch_init.c

  Log Message:
  -----------
  ram: account the amount of transferred ram better

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: b823ceaadfaad65f3a034ada394b33ca1bf1a914
      https://github.com/qemu/qemu/commit/b823ceaadfaad65f3a034ada394b33ca1bf1a914
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M arch_init.c

  Log Message:
  -----------
  ram: refactor ram_save_block() return value

It could only return 0 if we only found dirty xbzrle pages that hadn't
changed (i.e. they were written with the same content).  We don't care
about that case, it is the same than nothing dirty.

So now the return of the function is how much have it written, nothing
else. Adjust callers.

And we also made ram_save_iterate() return the number of transferred
bytes, not the number of transferred pages.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: e659586e63793a8a61efc4a658e2908ac8a2e935
      https://github.com/qemu/qemu/commit/e659586e63793a8a61efc4a658e2908ac8a2e935
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M migration.c

  Log Message:
  -----------
  migration: fix qemu_get_fd for BufferedFile

Not really used, but nice to have it correct. :)

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 9848a40427cd76628d04d918fa4751c542527915
      https://github.com/qemu/qemu/commit/9848a40427cd76628d04d918fa4751c542527915
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-12-20 (Thu, 20 Dec 2012)

  Changed paths:
    M include/migration/migration.h
    M migration.c

  Log Message:
  -----------
  migration: merge QEMUFileBuffered into MigrationState

Avoid splitting the state of outgoing migration, more or less arbitrarily,
between two data structures.  QEMUFileBuffered anyway is used only during
migration.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: bb5801f551ee8591d576d87a9290af297998e322
      https://github.com/qemu/qemu/commit/bb5801f551ee8591d576d87a9290af297998e322
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-12-21 (Fri, 21 Dec 2012)

  Changed paths:
    M .gitignore
    M MAINTAINERS
    M Makefile
    R Makefile.dis
    M Makefile.objs
    M Makefile.target
    R Makefile.user
    R a.out.h
    M acl.c
    R acl.h
    M aes.c
    R aes.h
    M aio-posix.c
    M aio-win32.c
    R alpha-dis.c
    R alpha.ld
    M arch_init.c
    R arch_init.h
    R arm-dis.c
    R arm.ld
    M async.c
    M audio/Makefile.objs
    M audio/alsaaudio.c
    M audio/audio.c
    M audio/audio.h
    M audio/noaudio.c
    M audio/ossaudio.c
    M audio/spiceaudio.c
    M audio/wavaudio.c
    M audio/wavcapture.c
    M audio/winwaveaudio.c
    M backends/rng-egd.c
    M backends/rng-random.c
    M backends/rng.c
    M balloon.c
    R balloon.h
    M bitmap.c
    R bitmap.h
    M bitops.c
    R bitops.h
    M block-migration.c
    R block-migration.h
    M block.c
    R block.h
    M block/Makefile.objs
    M block/blkdebug.c
    M block/blkverify.c
    M block/bochs.c
    M block/cloop.c
    M block/commit.c
    M block/cow.c
    M block/curl.c
    M block/dmg.c
    M block/gluster.c
    M block/iscsi.c
    M block/linux-aio.c
    M block/mirror.c
    M block/nbd.c
    M block/parallels.c
    M block/qcow.c
    M block/qcow2-cache.c
    M block/qcow2-cluster.c
    M block/qcow2-refcount.c
    M block/qcow2-snapshot.c
    M block/qcow2.c
    M block/qcow2.h
    M block/qed-table.c
    M block/qed.c
    M block/qed.h
    M block/raw-posix.c
    M block/raw-win32.c
    M block/raw.c
    M block/rbd.c
    M block/sheepdog.c
    M block/stream.c
    M block/vdi.c
    M block/vmdk.c
    M block/vpc.c
    M block/vvfat.c
    M block/win32-aio.c
    R block_int.h
    M blockdev-nbd.c
    M blockdev.c
    R blockdev.h
    M blockjob.c
    R blockjob.h
    M bsd-user/elfload.c
    M bsd-user/main.c
    M bsd-user/qemu.h
    R bswap.h
    M bt-host.c
    R bt-host.h
    M bt-vhci.c
    R buffered_file.c
    R buffered_file.h
    M cache-utils.c
    R cache-utils.h
    M cmd.c
    M compatfd.c
    R compatfd.h
    R compiler.h
    R config.h
    M configure
    R console.c
    R console.h
    M coroutine-gthread.c
    M coroutine-sigaltstack.c
    M coroutine-ucontext.c
    M coroutine-win32.c
    R cpu-all.h
    R cpu-common.h
    R cpu-defs.h
    M cpu-exec.c
    M cpus.c
    R cpus.h
    M cputlb.c
    R cputlb.h
    R cris-dis.c
    R cursor.c
    R cursor_hidden.xpm
    R cursor_left_ptr.xpm
    M cutils.c
    R def-helper.h
    M device_tree.c
    R device_tree.h
    R dis-asm.h
    M disas.c
    R disas.h
    A disas/Makefile.objs
    A disas/alpha.c
    A disas/arm.c
    A disas/cris.c
    A disas/hppa.c
    A disas/i386.c
    A disas/ia64.c
    A disas/lm32.c
    A disas/m68k.c
    A disas/microblaze.c
    A disas/mips.c
    A disas/ppc.c
    A disas/s390.c
    A disas/sh4.c
    A disas/sparc.c
    A disas/tci.c
    M dma-helpers.c
    R dma.h
    M dump-stub.c
    M dump.c
    R dump.h
    R elf.h
    M envlist.c
    R envlist.h
    M error.c
    R error.h
    M event_notifier-posix.c
    M event_notifier-win32.c
    R event_notifier.h
    R exec-all.h
    R exec-memory.h
    M exec.c
    M fpu/softfloat.c
    R fpu/softfloat.h
    M fsdev/qemu-fsdev-dummy.c
    M fsdev/qemu-fsdev.c
    M fsdev/qemu-fsdev.h
    M fsdev/virtfs-proxy-helper.c
    M fsdev/virtio-9p-marshal.c
    M gdbstub.c
    R gdbstub.h
    R gen-icount.h
    M hmp.c
    M hmp.h
    M host-utils.c
    R host-utils.h
    R hppa-dis.c
    R hppa.ld
    M hw/9pfs/codir.c
    M hw/9pfs/cofile.c
    M hw/9pfs/cofs.c
    M hw/9pfs/coxattr.c
    M hw/9pfs/virtio-9p-coth.c
    M hw/9pfs/virtio-9p-coth.h
    M hw/9pfs/virtio-9p-device.c
    M hw/9pfs/virtio-9p-handle.c
    M hw/9pfs/virtio-9p-local.c
    M hw/9pfs/virtio-9p-posix-acl.c
    M hw/9pfs/virtio-9p-synth.h
    M hw/9pfs/virtio-9p-xattr.h
    M hw/9pfs/virtio-9p.c
    M hw/9pfs/virtio-9p.h
    M hw/Makefile.objs
    M hw/ac97.c
    M hw/acpi.c
    M hw/acpi.h
    M hw/acpi_ich9.c
    M hw/acpi_piix4.c
    M hw/adb.c
    M hw/adlib.c
    M hw/ads7846.c
    M hw/alpha_dp264.c
    M hw/alpha_pci.c
    M hw/alpha_sys.h
    M hw/alpha_typhoon.c
    M hw/an5206.c
    M hw/apb_pci.c
    M hw/apic.c
    M hw/apic_common.c
    M hw/apic_internal.h
    M hw/apm.c
    M hw/apm.h
    M hw/applesmc.c
    M hw/arm-misc.h
    M hw/arm11mpcore.c
    M hw/arm_boot.c
    M hw/arm_mptimer.c
    M hw/arm_sysctl.c
    M hw/arm_timer.c
    M hw/armv7m_nvic.c
    M hw/audiodev.h
    M hw/axis_dev88.c
    M hw/baum.c
    M hw/baum.h
    M hw/blizzard.c
    M hw/block-common.c
    M hw/boards.h
    M hw/bonito.c
    M hw/bt-hci-csr.c
    M hw/bt-hci.c
    M hw/bt-hid.c
    M hw/bt-l2cap.c
    M hw/bt.c
    M hw/bt.h
    M hw/cadence_gem.c
    M hw/cadence_ttc.c
    M hw/cadence_uart.c
    M hw/cbus.c
    M hw/ccid-card-emulated.c
    M hw/ccid-card-passthru.c
    M hw/cirrus_vga.c
    M hw/collie.c
    M hw/cris-boot.h
    M hw/cs4231a.c
    M hw/cuda.c
    M hw/debugcon.c
    M hw/dec_pci.c
    M hw/device-hotplug.c
    M hw/dma.c
    M hw/dp8393x.c
    M hw/dummy_m68k.c
    M hw/e1000.c
    M hw/eepro100.c
    M hw/empty_slot.h
    M hw/es1370.c
    M hw/escc.c
    M hw/escc.h
    M hw/esp-pci.c
    M hw/esp.c
    M hw/etraxfs.h
    M hw/etraxfs_dma.c
    M hw/etraxfs_dma.h
    M hw/etraxfs_eth.c
    M hw/etraxfs_ser.c
    M hw/etraxfs_timer.c
    M hw/exynos4210.c
    M hw/exynos4210.h
    M hw/exynos4210_fimd.c
    M hw/exynos4210_i2c.c
    M hw/exynos4210_mct.c
    M hw/exynos4210_pwm.c
    M hw/exynos4210_rtc.c
    M hw/exynos4210_uart.c
    M hw/exynos4_boards.c
    M hw/fdc.c
    M hw/flash.h
    M hw/framebuffer.c
    M hw/framebuffer.h
    M hw/fw_cfg.c
    M hw/g364fb.c
    M hw/grackle_pci.c
    M hw/grlib_apbuart.c
    M hw/grlib_gptimer.c
    M hw/gt64xxx.c
    M hw/gumstix.c
    M hw/hd-geometry.c
    M hw/hda-audio.c
    M hw/hid.c
    M hw/hid.h
    M hw/highbank.c
    M hw/hpet.c
    M hw/hw.h
    M hw/i386/Makefile.objs
    M hw/i82378.c
    M hw/i8254.c
    M hw/i8254_common.c
    M hw/i8259.c
    M hw/i82801b11.c
    M hw/ich9.h
    M hw/ide.h
    M hw/ide/ahci.c
    M hw/ide/cmd646.c
    M hw/ide/core.c
    M hw/ide/ich.c
    M hw/ide/internal.h
    M hw/ide/isa.c
    M hw/ide/macio.c
    M hw/ide/microdrive.c
    M hw/ide/mmio.c
    M hw/ide/pci.c
    M hw/ide/piix.c
    M hw/ide/qdev.c
    M hw/ide/via.c
    M hw/imx_avic.c
    M hw/imx_ccm.c
    M hw/imx_serial.c
    M hw/imx_timer.c
    M hw/integratorcp.c
    M hw/intel-hda.c
    M hw/ioapic_internal.h
    M hw/ioh3420.c
    M hw/ioh3420.h
    M hw/isa-bus.c
    M hw/isa.h
    M hw/isa_mmio.c
    M hw/ivshmem.c
    M hw/jazz_led.c
    M hw/kvm/apic.c
    M hw/kvm/clock.c
    M hw/kvm/i8254.c
    M hw/kvm/i8259.c
    M hw/kvm/ioapic.c
    M hw/kvm/pci-assign.c
    M hw/kvmvapic.c
    M hw/kzm.c
    M hw/lan9118.c
    M hw/lance.c
    M hw/leon3.c
    M hw/lm32.h
    M hw/lm32_boards.c
    M hw/lm32_juart.c
    M hw/lm32_pic.c
    M hw/lm32_sys.c
    M hw/lm32_timer.c
    M hw/lm32_uart.c
    M hw/lm832x.c
    M hw/loader.c
    M hw/lpc_ich9.c
    M hw/lsi53c895a.c
    M hw/m25p80.c
    M hw/m48t59.c
    M hw/mac_dbdma.c
    M hw/mac_dbdma.h
    M hw/mac_nvram.c
    M hw/macio.c
    M hw/mainstone.c
    M hw/mc146818rtc.c
    M hw/mcf5206.c
    M hw/mcf5208.c
    M hw/mcf_fec.c
    M hw/mcf_intc.c
    M hw/mcf_uart.c
    M hw/megasas.c
    M hw/microblaze_boot.c
    M hw/milkymist-ac97.c
    M hw/milkymist-hpdmc.c
    M hw/milkymist-hw.h
    M hw/milkymist-memcard.c
    M hw/milkymist-minimac2.c
    M hw/milkymist-pfpu.c
    M hw/milkymist-softusb.c
    M hw/milkymist-sysctl.c
    M hw/milkymist-tmu2.c
    M hw/milkymist-uart.c
    M hw/milkymist-vgafb.c
    M hw/milkymist.c
    M hw/mips.h
    M hw/mips_fulong2e.c
    M hw/mips_jazz.c
    M hw/mips_malta.c
    M hw/mips_mipssim.c
    M hw/mips_r4k.c
    M hw/mips_timer.c
    M hw/mipsnet.c
    M hw/mpc8544_guts.c
    R hw/msi.c
    R hw/msi.h
    R hw/msix.c
    R hw/msix.h
    M hw/msmouse.c
    M hw/msmouse.h
    M hw/multiboot.c
    M hw/musicpal.c
    M hw/nand.c
    M hw/ne2000-isa.c
    M hw/ne2000.c
    M hw/ne2000.h
    M hw/nseries.c
    M hw/omap.h
    M hw/omap1.c
    M hw/omap2.c
    M hw/omap_dma.c
    M hw/omap_dss.c
    M hw/omap_gpmc.c
    M hw/omap_gptimer.c
    M hw/omap_lcdc.c
    M hw/omap_sx1.c
    M hw/omap_synctimer.c
    M hw/omap_uart.c
    M hw/onenand.c
    M hw/opencores_eth.c
    M hw/openpic.c
    M hw/openrisc_sim.c
    M hw/openrisc_timer.c
    M hw/palm.c
    M hw/pam.c
    M hw/pam.h
    M hw/parallel.c
    M hw/pc.c
    M hw/pc.h
    M hw/pc_piix.c
    M hw/pc_q35.c
    M hw/pc_sysfw.c
    R hw/pci-hotplug.c
    R hw/pci-stub.c
    R hw/pci.c
    R hw/pci.h
    A hw/pci/Makefile.objs
    A hw/pci/msi.c
    A hw/pci/msi.h
    A hw/pci/msix.c
    A hw/pci/msix.h
    A hw/pci/pci-hotplug.c
    A hw/pci/pci-stub.c
    A hw/pci/pci.c
    A hw/pci/pci.h
    A hw/pci/pci_bridge.c
    A hw/pci/pci_bridge.h
    A hw/pci/pci_bus.h
    A hw/pci/pci_host.c
    A hw/pci/pci_host.h
    A hw/pci/pci_ids.h
    A hw/pci/pci_regs.h
    A hw/pci/pcie.c
    A hw/pci/pcie.h
    A hw/pci/pcie_aer.c
    A hw/pci/pcie_aer.h
    A hw/pci/pcie_host.c
    A hw/pci/pcie_host.h
    A hw/pci/pcie_port.c
    A hw/pci/pcie_port.h
    A hw/pci/pcie_regs.h
    A hw/pci/shpc.c
    A hw/pci/shpc.h
    A hw/pci/slotid_cap.c
    A hw/pci/slotid_cap.h
    R hw/pci_bridge.c
    R hw/pci_bridge.h
    M hw/pci_bridge_dev.c
    R hw/pci_host.c
    R hw/pci_host.h
    R hw/pci_ids.h
    R hw/pci_internals.h
    R hw/pci_regs.h
    R hw/pcie.c
    R hw/pcie.h
    R hw/pcie_aer.c
    R hw/pcie_aer.h
    R hw/pcie_host.c
    R hw/pcie_host.h
    R hw/pcie_port.c
    R hw/pcie_port.h
    R hw/pcie_regs.h
    M hw/pckbd.c
    M hw/pcmcia.h
    M hw/pcnet-pci.c
    M hw/pcnet.c
    M hw/pcnet.h
    M hw/pcspk.c
    M hw/petalogix_ml605_mmu.c
    M hw/petalogix_s3adsp1800_mmu.c
    M hw/pflash_cfi01.c
    M hw/pflash_cfi02.c
    M hw/piix4.c
    M hw/piix_pci.c
    R hw/pixel_ops.h
    M hw/pl011.c
    M hw/pl031.c
    M hw/pl110.c
    M hw/pl181.c
    M hw/ppc.c
    M hw/ppc.h
    M hw/ppc/Makefile.objs
    M hw/ppc/e500.c
    M hw/ppc/e500plat.c
    M hw/ppc/mpc8544ds.c
    M hw/ppc405_boards.c
    M hw/ppc405_uc.c
    M hw/ppc440_bamboo.c
    M hw/ppc4xx.h
    M hw/ppc4xx_devs.c
    M hw/ppc4xx_pci.c
    M hw/ppc_booke.c
    M hw/ppc_mac.h
    M hw/ppc_newworld.c
    M hw/ppc_oldworld.c
    M hw/ppc_prep.c
    M hw/ppce500_pci.c
    M hw/ppce500_spin.c
    M hw/prep_pci.c
    M hw/ps2.c
    M hw/ptimer.c
    M hw/ptimer.h
    M hw/puv3.c
    M hw/pxa.h
    M hw/pxa2xx.c
    M hw/pxa2xx_keypad.c
    M hw/pxa2xx_lcd.c
    M hw/pxa2xx_timer.c
    M hw/q35.h
    M hw/qdev-addr.c
    M hw/qdev-addr.h
    M hw/qdev-core.h
    M hw/qdev-monitor.c
    M hw/qdev-monitor.h
    M hw/qdev-properties.c
    M hw/qdev.c
    M hw/qxl-logger.c
    M hw/qxl.c
    M hw/qxl.h
    M hw/r2d.c
    M hw/rc4030.c
    M hw/realview.c
    M hw/rtl8139.c
    M hw/s390-virtio-bus.c
    M hw/s390-virtio-bus.h
    M hw/s390-virtio.c
    M hw/s390x/event-facility.c
    M hw/s390x/event-facility.h
    M hw/s390x/sclp.c
    M hw/s390x/sclpconsole.c
    M hw/s390x/sclpquiesce.c
    M hw/sb16.c
    M hw/scsi-bus.c
    M hw/scsi-defs.h
    M hw/scsi-disk.c
    M hw/scsi-generic.c
    M hw/scsi.h
    M hw/sd.c
    M hw/serial-pci.c
    M hw/serial.c
    M hw/serial.h
    M hw/sga.c
    M hw/sh7750.c
    M hw/sh_intc.h
    M hw/sh_pci.c
    M hw/sh_serial.c
    M hw/sh_timer.c
    M hw/shix.c
    R hw/shpc.c
    R hw/shpc.h
    M hw/slavio_intctl.c
    M hw/slavio_misc.c
    M hw/slavio_timer.c
    R hw/slotid_cap.c
    R hw/slotid_cap.h
    M hw/sm501.c
    M hw/smbios.c
    M hw/smbus_ich9.c
    M hw/smc91c111.c
    M hw/soc_dma.c
    M hw/soc_dma.h
    M hw/spapr.c
    M hw/spapr.h
    M hw/spapr_events.c
    M hw/spapr_hcall.c
    M hw/spapr_iommu.c
    M hw/spapr_llan.c
    M hw/spapr_nvram.c
    M hw/spapr_pci.c
    M hw/spapr_pci.h
    M hw/spapr_rtas.c
    M hw/spapr_vio.c
    M hw/spapr_vio.h
    M hw/spapr_vscsi.c
    M hw/spapr_vty.c
    M hw/spitz.c
    M hw/ssd0303.c
    M hw/ssd0323.c
    M hw/ssi-sd.c
    M hw/stellaris.c
    M hw/stellaris_enet.c
    M hw/stellaris_input.c
    M hw/stream.h
    M hw/strongarm.c
    M hw/strongarm.h
    M hw/sun4c_intctl.c
    M hw/sun4m.c
    M hw/sun4u.c
    M hw/sysbus.c
    M hw/sysbus.h
    M hw/tc6393xb.c
    M hw/tcx.c
    M hw/tosa.c
    M hw/tsc2005.c
    M hw/tsc210x.c
    M hw/tusb6010.c
    M hw/twl92230.c
    A hw/uboot_image.h
    M hw/unin_pci.c
    M hw/usb.h
    M hw/usb/bus.c
    M hw/usb/combined-packet.c
    M hw/usb/core.c
    M hw/usb/dev-bluetooth.c
    M hw/usb/dev-hid.c
    M hw/usb/dev-network.c
    M hw/usb/dev-serial.c
    M hw/usb/dev-smartcard-reader.c
    M hw/usb/dev-storage.c
    M hw/usb/dev-uas.c
    M hw/usb/dev-wacom.c
    M hw/usb/hcd-ehci-pci.c
    M hw/usb/hcd-ehci.h
    M hw/usb/hcd-musb.c
    M hw/usb/hcd-ohci.c
    M hw/usb/hcd-uhci.c
    M hw/usb/hcd-xhci.c
    M hw/usb/host-bsd.c
    M hw/usb/host-linux.c
    M hw/usb/host-stub.c
    M hw/usb/libhw.c
    M hw/usb/redirect.c
    M hw/versatile_pci.c
    M hw/versatilepb.c
    M hw/vexpress.c
    M hw/vfio_pci.c
    M hw/vga-isa-mm.c
    M hw/vga-isa.c
    M hw/vga-pci.c
    M hw/vga.c
    M hw/vga_int.h
    M hw/vhost.c
    M hw/vhost.h
    M hw/vhost_net.c
    M hw/vhost_net.h
    M hw/virtex_ml507.c
    M hw/virtio-balloon.c
    M hw/virtio-balloon.h
    M hw/virtio-blk.c
    M hw/virtio-console.c
    M hw/virtio-net.c
    M hw/virtio-net.h
    M hw/virtio-pci.c
    M hw/virtio-rng.c
    M hw/virtio-scsi.h
    M hw/virtio-serial-bus.c
    M hw/virtio.c
    M hw/virtio.h
    M hw/vmmouse.c
    M hw/vmport.c
    M hw/vmware_vga.c
    M hw/vt82c686.c
    M hw/watchdog.c
    M hw/watchdog.h
    M hw/wdt_i6300esb.c
    M hw/wdt_ib700.c
    M hw/xen-host-pci-device.h
    M hw/xen_apic.c
    M hw/xen_backend.c
    M hw/xen_backend.h
    M hw/xen_common.h
    M hw/xen_console.c
    M hw/xen_devconfig.c
    M hw/xen_disk.c
    M hw/xen_domainbuild.c
    M hw/xen_machine_pv.c
    M hw/xen_nic.c
    M hw/xen_platform.c
    M hw/xen_pt.c
    M hw/xen_pt.h
    M hw/xen_pt_config_init.c
    M hw/xenfb.c
    M hw/xgmac.c
    M hw/xilinx.h
    M hw/xilinx_axidma.c
    M hw/xilinx_axienet.c
    M hw/xilinx_ethlite.c
    M hw/xilinx_spi.c
    M hw/xilinx_spips.c
    M hw/xilinx_timer.c
    M hw/xilinx_uartlite.c
    M hw/xilinx_zynq.c
    M hw/xio3130_downstream.c
    M hw/xio3130_downstream.h
    M hw/xio3130_upstream.c
    M hw/xio3130_upstream.h
    M hw/xtensa_lx60.c
    M hw/xtensa_pic.c
    M hw/xtensa_sim.c
    M hw/z2.c
    M hw/zynq_slcr.c
    R hwaddr.h
    R i386-dis.c
    R i386.ld
    R ia64-dis.c
    R ia64.ld
    A include/block/aes.h
    A include/block/aio.h
    A include/block/block.h
    A include/block/block_int.h
    A include/block/blockjob.h
    A include/block/coroutine.h
    A include/block/coroutine_int.h
    A include/block/nbd.h
    A include/block/thread-pool.h
    A include/bt/bt.h
    A include/char/char.h
    A include/config.h
    A include/disas/bfd.h
    A include/disas/disas.h
    A include/elf.h
    A include/exec/address-spaces.h
    A include/exec/cpu-all.h
    A include/exec/cpu-common.h
    A include/exec/cpu-defs.h
    A include/exec/cputlb.h
    A include/exec/def-helper.h
    A include/exec/exec-all.h
    A include/exec/gdbstub.h
    A include/exec/gen-icount.h
    A include/exec/hwaddr.h
    A include/exec/ioport.h
    A include/exec/iorange.h
    A include/exec/memory-internal.h
    A include/exec/memory.h
    A include/exec/poison.h
    A include/exec/softmmu-semi.h
    A include/exec/softmmu_defs.h
    A include/exec/softmmu_exec.h
    A include/exec/softmmu_header.h
    A include/exec/softmmu_template.h
    A include/exec/spinlock.h
    A include/exec/user/abitypes.h
    A include/exec/user/thunk.h
    A include/fpu/softfloat.h
    A include/libfdt_env.h
    A include/migration/block.h
    A include/migration/migration.h
    A include/migration/page_cache.h
    A include/migration/qemu-file.h
    A include/migration/vmstate.h
    A include/monitor/monitor.h
    A include/monitor/readline.h
    A include/net/checksum.h
    A include/net/net.h
    A include/net/queue.h
    A include/net/slirp.h
    A include/net/tap.h
    A include/qapi/dealloc-visitor.h
    A include/qapi/error.h
    A include/qapi/opts-visitor.h
    A include/qapi/qmp-input-visitor.h
    A include/qapi/qmp-output-visitor.h
    A include/qapi/qmp/dispatch.h
    A include/qapi/qmp/json-lexer.h
    A include/qapi/qmp/json-parser.h
    A include/qapi/qmp/json-streamer.h
    A include/qapi/qmp/qbool.h
    A include/qapi/qmp/qdict.h
    A include/qapi/qmp/qerror.h
    A include/qapi/qmp/qfloat.h
    A include/qapi/qmp/qint.h
    A include/qapi/qmp/qjson.h
    A include/qapi/qmp/qlist.h
    A include/qapi/qmp/qobject.h
    A include/qapi/qmp/qstring.h
    A include/qapi/qmp/types.h
    A include/qapi/string-input-visitor.h
    A include/qapi/string-output-visitor.h
    A include/qapi/visitor-impl.h
    A include/qapi/visitor.h
    A include/qemu-common.h
    A include/qemu/acl.h
    A include/qemu/atomic.h
    A include/qemu/bitmap.h
    A include/qemu/bitops.h
    A include/qemu/bswap.h
    A include/qemu/cache-utils.h
    A include/qemu/compatfd.h
    A include/qemu/compiler.h
    A include/qemu/config-file.h
    R include/qemu/cpu.h
    A include/qemu/envlist.h
    A include/qemu/error-report.h
    A include/qemu/event_notifier.h
    A include/qemu/host-utils.h
    A include/qemu/int128.h
    A include/qemu/iov.h
    A include/qemu/log.h
    A include/qemu/main-loop.h
    A include/qemu/module.h
    A include/qemu/notify.h
    R include/qemu/object.h
    A include/qemu/option.h
    A include/qemu/option_int.h
    A include/qemu/osdep.h
    R include/qemu/page_cache.h
    R include/qemu/qom-qobject.h
    A include/qemu/queue.h
    A include/qemu/range.h
    M include/qemu/rng-random.h
    M include/qemu/rng.h
    A include/qemu/sockets.h
    A include/qemu/thread-posix.h
    A include/qemu/thread-win32.h
    A include/qemu/thread.h
    A include/qemu/timer.h
    A include/qemu/tls.h
    A include/qemu/typedefs.h
    A include/qemu/uri.h
    A include/qemu/xattr.h
    A include/qom/cpu.h
    A include/qom/object.h
    A include/qom/qom-qobject.h
    A include/sysemu/arch_init.h
    A include/sysemu/balloon.h
    A include/sysemu/blockdev.h
    A include/sysemu/cpus.h
    A include/sysemu/device_tree.h
    A include/sysemu/dma.h
    A include/sysemu/dump.h
    A include/sysemu/kvm.h
    A include/sysemu/memory_mapping.h
    A include/sysemu/os-posix.h
    A include/sysemu/os-win32.h
    A include/sysemu/qtest.h
    A include/sysemu/seccomp.h
    A include/sysemu/sysemu.h
    A include/sysemu/xen-mapcache.h
    A include/ui/console.h
    A include/ui/pixel_ops.h
    A include/ui/qemu-pixman.h
    A include/ui/qemu-spice.h
    A include/ui/spice-display.h
    R input.c
    R int128.h
    M iohandler.c
    M ioport.c
    R ioport.h
    R iorange.h
    M iov.c
    R iov.h
    M json-lexer.c
    R json-lexer.h
    M json-parser.c
    R json-parser.h
    M json-streamer.c
    R json-streamer.h
    M kvm-all.c
    M kvm-stub.c
    R kvm.h
    A ldscripts/alpha.ld
    A ldscripts/arm.ld
    A ldscripts/hppa.ld
    A ldscripts/i386.ld
    A ldscripts/ia64.ld
    A ldscripts/m68k.ld
    A ldscripts/mips.ld
    A ldscripts/ppc.ld
    A ldscripts/ppc64.ld
    A ldscripts/s390.ld
    A ldscripts/sparc.ld
    A ldscripts/sparc64.ld
    A ldscripts/x86_64.ld
    M libcacard/event.c
    M libcacard/vreader.c
    M libcacard/vscclient.c
    R libfdt_env.h
    M linux-user/arm/nwfpe/double_cpdo.c
    M linux-user/arm/nwfpe/extended_cpdo.c
    M linux-user/arm/nwfpe/fpa11.h
    M linux-user/arm/nwfpe/fpa11_cpdt.c
    M linux-user/arm/nwfpe/fpa11_cprt.c
    M linux-user/arm/nwfpe/fpopcode.c
    M linux-user/arm/nwfpe/single_cpdo.c
    M linux-user/cris/syscall.h
    M linux-user/elfload.c
    M linux-user/main.c
    M linux-user/microblaze/syscall.h
    M linux-user/qemu.h
    M linux-user/syscall.c
    M linux-user/syscall_defs.h
    R lm32-dis.c
    R m68k-dis.c
    R m68k.ld
    M main-loop.c
    R main-loop.h
    R memory-internal.h
    M memory.c
    R memory.h
    M memory_mapping-stub.c
    M memory_mapping.c
    R memory_mapping.h
    R microblaze-dis.c
    M migration-exec.c
    M migration-fd.c
    M migration-tcp.c
    M migration-unix.c
    M migration.c
    R migration.h
    R mips-dis.c
    R mips.ld
    M module.c
    R module.h
    M monitor.c
    R monitor.h
    M nbd.c
    R nbd.h
    R net.c
    R net.h
    M net/Makefile.objs
    R net/checksum.h
    M net/clients.h
    M net/dump.c
    M net/hub.c
    M net/hub.h
    A net/net.c
    M net/queue.c
    R net/queue.h
    M net/slirp.c
    R net/slirp.h
    M net/socket.c
    M net/tap-aix.c
    M net/tap-bsd.c
    M net/tap-haiku.c
    M net/tap-linux.c
    M net/tap-linux.h
    M net/tap-solaris.c
    M net/tap-win32.c
    M net/tap.c
    R net/tap.h
    A net/tap_int.h
    M net/util.c
    M net/vde.c
    M notify.c
    R notify.h
    M os-posix.c
    M os-win32.c
    M osdep.c
    R osdep.h
    M oslib-posix.c
    M oslib-win32.c
    M page_cache.c
    M pixman
    R poison.h
    R ppc-dis.c
    R ppc.ld
    R ppc64.ld
    R qapi-schema-guest.json
    M qapi/opts-visitor.c
    R qapi/opts-visitor.h
    M qapi/qapi-dealloc-visitor.c
    R qapi/qapi-dealloc-visitor.h
    R qapi/qapi-types-core.h
    M qapi/qapi-visit-core.c
    R qapi/qapi-visit-core.h
    R qapi/qapi-visit-impl.h
    R qapi/qmp-core.h
    M qapi/qmp-dispatch.c
    M qapi/qmp-input-visitor.c
    R qapi/qmp-input-visitor.h
    M qapi/qmp-output-visitor.c
    R qapi/qmp-output-visitor.h
    M qapi/qmp-registry.c
    M qapi/string-input-visitor.c
    R qapi/string-input-visitor.h
    M qapi/string-output-visitor.c
    R qapi/string-output-visitor.h
    M qbool.c
    R qbool.h
    M qdict.c
    R qdict.h
    R qemu-aio.h
    R qemu-barrier.h
    M qemu-bridge-helper.c
    M qemu-char.c
    R qemu-char.h
    R qemu-common.h
    M qemu-config.c
    R qemu-config.h
    R qemu-coroutine-int.h
    M qemu-coroutine-io.c
    M qemu-coroutine-lock.c
    M qemu-coroutine-sleep.c
    M qemu-coroutine.c
    R qemu-coroutine.h
    M qemu-error.c
    R qemu-error.h
    R qemu-file.h
    R qemu-ga.c
    M qemu-img.c
    M qemu-io.c
    R qemu-lock.h
    M qemu-log.c
    R qemu-log.h
    M qemu-nbd.c
    R qemu-objects.h
    R qemu-option-internal.h
    M qemu-option.c
    R qemu-option.h
    R qemu-os-posix.h
    R qemu-os-win32.h
    R qemu-pixman.c
    R qemu-pixman.h
    M qemu-progress.c
    R qemu-queue.h
    M qemu-seccomp.c
    R qemu-seccomp.h
    M qemu-sockets.c
    M qemu-thread-posix.c
    R qemu-thread-posix.h
    M qemu-thread-win32.c
    R qemu-thread-win32.h
    R qemu-thread.h
    M qemu-timer-common.c
    M qemu-timer.c
    R qemu-timer.h
    R qemu-tls.h
    M qemu-tool.c
    R qemu-types.h
    R qemu-user-types.h
    M qemu-user.c
    R qemu-x509.h
    R qemu-xattr.h
    R qemu_socket.h
    M qerror.c
    R qerror.h
    M qfloat.c
    R qfloat.h
    M qga/Makefile.objs
    M qga/channel-posix.c
    M qga/commands-posix.c
    M qga/commands-win32.c
    M qga/commands.c
    M qga/guest-agent-core.h
    A qga/main.c
    A qga/qapi-schema.json
    M qint.c
    R qint.h
    M qjson.c
    R qjson.h
    M qlist.c
    R qlist.h
    M qmp.c
    R qobject.h
    M qom/container.c
    M qom/cpu.c
    M qom/object.c
    M qom/qom-qobject.c
    M qstring.c
    R qstring.h
    M qtest.c
    R qtest.h
    R range.h
    M readline.c
    R readline.h
    M rules.mak
    R s390-dis.c
    R s390.ld
    M savevm.c
    M scripts/feature_to_c.sh
    M scripts/get_maintainer.pl
    M scripts/qapi-commands.py
    M scripts/qapi-types.py
    M scripts/qapi-visit.py
    R sh4-dis.c
    M slirp/bootp.h
    M slirp/if.c
    M slirp/ip_input.c
    M slirp/main.h
    M slirp/misc.c
    M slirp/sbuf.c
    M slirp/slirp.c
    M slirp/slirp.h
    M slirp/tftp.h
    R softmmu-semi.h
    R softmmu_defs.h
    R softmmu_exec.h
    R softmmu_header.h
    R softmmu_template.h
    R sparc-dis.c
    R sparc.ld
    R sparc64.ld
    M spice-qemu-char.c
    M stubs/arch-query-cpu-def.c
    M stubs/fd-register.c
    M stubs/fdset-add-fd.c
    M stubs/fdset-find-fd.c
    M stubs/fdset-get-fd.c
    M stubs/fdset-remove-fd.c
    M stubs/get-fd.c
    M stubs/set-fd-handler.c
    R sysemu.h
    M target-alpha/cpu-qom.h
    M target-alpha/cpu.h
    M target-alpha/fpu_helper.c
    M target-alpha/helper.c
    M target-alpha/helper.h
    M target-alpha/int_helper.c
    M target-alpha/mem_helper.c
    M target-alpha/sys_helper.c
    M target-alpha/translate.c
    M target-arm/arm-semi.c
    M target-arm/cpu-qom.h
    M target-arm/cpu.c
    M target-arm/cpu.h
    M target-arm/helper.c
    M target-arm/helper.h
    M target-arm/iwmmxt_helper.c
    M target-arm/neon_helper.c
    M target-arm/op_helper.c
    M target-arm/translate.c
    M target-cris/cpu-qom.h
    M target-cris/cpu.h
    M target-cris/crisv32-decode.h
    M target-cris/helper.c
    M target-cris/helper.h
    M target-cris/op_helper.c
    M target-cris/translate.c
    M target-i386/arch_dump.c
    M target-i386/arch_memory_mapping.c
    M target-i386/cpu-qom.h
    M target-i386/cpu.c
    M target-i386/cpu.h
    M target-i386/excp_helper.c
    M target-i386/fpu_helper.c
    M target-i386/helper.c
    M target-i386/helper.h
    M target-i386/int_helper.c
    M target-i386/ioport-user.c
    M target-i386/kvm.c
    M target-i386/kvm_i386.h
    M target-i386/machine.c
    M target-i386/mem_helper.c
    M target-i386/misc_helper.c
    M target-i386/seg_helper.c
    M target-i386/svm_helper.c
    M target-i386/translate.c
    M target-lm32/cpu-qom.h
    M target-lm32/cpu.h
    M target-lm32/helper.c
    M target-lm32/helper.h
    M target-lm32/op_helper.c
    M target-lm32/translate.c
    M target-m68k/cpu-qom.h
    M target-m68k/cpu.h
    M target-m68k/helper.c
    M target-m68k/helpers.h
    M target-m68k/m68k-semi.c
    M target-m68k/op_helper.c
    M target-m68k/translate.c
    M target-microblaze/cpu-qom.h
    M target-microblaze/cpu.h
    M target-microblaze/helper.c
    M target-microblaze/helper.h
    M target-microblaze/op_helper.c
    M target-microblaze/translate.c
    M target-mips/cpu-qom.h
    M target-mips/cpu.h
    M target-mips/helper.h
    M target-mips/op_helper.c
    M target-mips/translate.c
    M target-openrisc/cpu.h
    M target-openrisc/helper.h
    M target-openrisc/int_helper.c
    M target-openrisc/interrupt.c
    M target-openrisc/mmu.c
    M target-openrisc/mmu_helper.c
    M target-openrisc/translate.c
    M target-ppc/cpu-qom.h
    M target-ppc/cpu.h
    M target-ppc/helper.c
    M target-ppc/helper.h
    M target-ppc/int_helper.c
    M target-ppc/kvm.c
    M target-ppc/kvm_ppc.c
    M target-ppc/kvm_ppc.h
    M target-ppc/machine.c
    M target-ppc/mem_helper.c
    M target-ppc/mmu_helper.c
    M target-ppc/translate.c
    M target-ppc/translate_init.c
    M target-s390x/cpu-qom.h
    M target-s390x/cpu.c
    M target-s390x/cpu.h
    M target-s390x/fpu_helper.c
    M target-s390x/helper.c
    M target-s390x/helper.h
    M target-s390x/int_helper.c
    M target-s390x/interrupt.c
    M target-s390x/kvm.c
    M target-s390x/mem_helper.c
    M target-s390x/misc_helper.c
    M target-s390x/translate.c
    M target-sh4/cpu-qom.h
    M target-sh4/cpu.h
    M target-sh4/helper.h
    M target-sh4/op_helper.c
    M target-sh4/translate.c
    M target-sparc/cpu-qom.h
    M target-sparc/cpu.h
    M target-sparc/helper.c
    M target-sparc/helper.h
    M target-sparc/int32_helper.c
    M target-sparc/ldst_helper.c
    M target-sparc/machine.c
    M target-sparc/mmu_helper.c
    M target-sparc/translate.c
    M target-unicore32/cpu-qom.h
    M target-unicore32/cpu.h
    M target-unicore32/helper.c
    M target-unicore32/helper.h
    M target-unicore32/op_helper.c
    M target-unicore32/translate.c
    M target-xtensa/core-dc232b.c
    M target-xtensa/core-dc233c.c
    M target-xtensa/core-fsf.c
    M target-xtensa/cpu-qom.h
    M target-xtensa/cpu.h
    M target-xtensa/helper.c
    M target-xtensa/helper.h
    M target-xtensa/op_helper.c
    M target-xtensa/translate.c
    M target-xtensa/xtensa-semi.c
    M tcg/arm/tcg-target.c
    M tcg/arm/tcg-target.h
    M tcg/hppa/tcg-target.c
    M tcg/hppa/tcg-target.h
    M tcg/i386/tcg-target.c
    M tcg/i386/tcg-target.h
    M tcg/ia64/tcg-target.c
    M tcg/ia64/tcg-target.h
    M tcg/mips/tcg-target.c
    M tcg/mips/tcg-target.h
    M tcg/ppc/tcg-target.c
    M tcg/ppc/tcg-target.h
    M tcg/ppc64/tcg-target.c
    M tcg/ppc64/tcg-target.h
    M tcg/s390/tcg-target.c
    M tcg/s390/tcg-target.h
    M tcg/sparc/tcg-target.c
    M tcg/sparc/tcg-target.h
    M tcg/tcg.c
    R tci-dis.c
    M tci.c
    M tests/check-qdict.c
    M tests/check-qfloat.c
    M tests/check-qint.c
    M tests/check-qjson.c
    M tests/check-qlist.c
    M tests/check-qstring.c
    M tests/libqtest.c
    M tests/tcg/cris/crisutils.h
    M tests/tcg/test-i386-fprem.c
    M tests/tcg/test-i386.c
    M tests/test-aio.c
    M tests/test-coroutine.c
    M tests/test-iov.c
    M tests/test-qmp-commands.c
    M tests/test-qmp-input-strict.c
    M tests/test-qmp-input-visitor.c
    M tests/test-qmp-output-visitor.c
    M tests/test-string-input-visitor.c
    M tests/test-string-output-visitor.c
    M tests/test-thread-pool.c
    M tests/test-visitor-serialization.c
    M thread-pool.c
    R thread-pool.h
    M thunk.c
    R thunk.h
    M trace/simple.c
    M translate-all.c
    R uboot_image.h
    M ui/Makefile.objs
    M ui/cocoa.m
    A ui/console.c
    M ui/curses.c
    M ui/curses_keys.h
    A ui/cursor.c
    A ui/cursor_hidden.xpm
    A ui/cursor_left_ptr.xpm
    M ui/d3des.h
    A ui/input.c
    M ui/keymaps.c
    A ui/qemu-pixman.c
    R ui/qemu-spice.h
    A ui/qemu-x509.h
    M ui/sdl.c
    M ui/sdl_zoom.c
    M ui/spice-core.c
    M ui/spice-display.c
    R ui/spice-display.h
    M ui/spice-input.c
    A ui/vgafont.h
    M ui/vnc-auth-sasl.h
    M ui/vnc-enc-tight.c
    M ui/vnc-jobs.c
    M ui/vnc-palette.h
    M ui/vnc-tls.c
    M ui/vnc-tls.h
    M ui/vnc.c
    M ui/vnc.h
    M uri.c
    R uri.h
    M user-exec.c
    R vgafont.h
    M vl.c
    R vmstate.h
    R x86_64.ld
    M xen-all.c
    M xen-mapcache.c
    R xen-mapcache.h
    M xen-stub.c

  Log Message:
  -----------
  Merge remote-tracking branch 'quintela/thread-20121220.next' into staging

* quintela/thread-20121220.next: (79 commits)
  migration: merge QEMUFileBuffered into MigrationState
  migration: fix qemu_get_fd for BufferedFile
  ram: refactor ram_save_block() return value
  ram: account the amount of transferred ram better
  ram: optimize migration bitmap walking
  ram: Use memory_region_test_and_clear_dirty
  memory: introduce memory_region_test_and_clear_dirty
  ram: Add last_sent_block
  ram: rename last_block to last_seen_block
  migration: move migration notifier
  migration: Inline qemu_fopen_ops_buffered into migrate_fd_connect
  migration: move migration_fd_put_ready()
  migration: add XFER_LIMIT_RATIO
  migration: move buffered_file.c code into migration.c
  savevm: New save live migration method: pending
  buffered_file: unfold buffered_append in buffered_put_buffer
  buffered_file: don't flush on put buffer
  buffered_file: Unfold the trick to restart generating migration data
  migration: just lock migrate_fd_put_ready
  migration: remove unfreeze logic
  ...

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/27dd7730582b...bb5801f551ee

----==_mimepart_50d51b357b2a1_6ff9f59aec67450--


</body></email><email><emailId>20121222160007</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-22 16:00:07-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] ca273d: build: fix includes for VNC</subject><body>



----==_mimepart_50d5d907a5eea_7a9e17c7ae4639bc
Date: Sat, 22 Dec 2012 08:00:07 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50d5d907a77c9_7a9e17c7ae464020@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: ca273d58d8a77d5cc9d42440bcdf9d7cad2054bc
      https://github.com/qemu/qemu/commit/ca273d58d8a77d5cc9d42440bcdf9d7cad2054bc
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-22 (Sat, 22 Dec 2012)

  Changed paths:
    M Makefile.target
    M configure
    M ui/Makefile.objs

  Log Message:
  -----------
  build: fix includes for VNC

vnc-tls.h is included by vnc.h, and it includes gnutls/gnutls.h.
Hence, GnuTLS header files are needed by all files that include
vnc.h, most notably qmp.c.  Move these flags to QEMU_CFLAGS for
simplicity.

Reported-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 4ad549e89e55fb48eb6feb783ee4a9ede1dea52e
      https://github.com/qemu/qemu/commit/4ad549e89e55fb48eb6feb783ee4a9ede1dea52e
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-12-22 (Sat, 22 Dec 2012)

  Changed paths:
    M xen-all.c

  Log Message:
  -----------
  xen: add missing include

xen-all needs to access CharDeviceState's filename field, so
it needs to include char/char.h.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Tested-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: b2136140f68ce05122f611eb9cde4f0365ab6a00
      https://github.com/qemu/qemu/commit/b2136140f68ce05122f611eb9cde4f0365ab6a00
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-12-22 (Sat, 22 Dec 2012)

  Changed paths:
    M net/tap-win32.c

  Log Message:
  -----------
  net: Add missing include statement (fix compiler warnings for MinGW)

These and some more compiler warnings were caused by a recent commit:

net/tap-win32.c:724: warning: no previous prototype for âtap_has_ufo'
net/tap-win32.c:729: warning: no previous prototype for âtap_has_vnet_hdr'
...

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 0c884d1659f02b4a0c704c2344f42e3fabb1f193
      https://github.com/qemu/qemu/commit/0c884d1659f02b4a0c704c2344f42e3fabb1f193
  Author: é³éä»» (Wei-Ren Chen) &lt;chenwj@iis.sinica.edu.tw&gt;
  Date:   2012-12-22 (Sat, 22 Dec 2012)

  Changed paths:
    M translate-all.c

  Log Message:
  -----------
  translate-all.c: Use tb1-&gt;phys_hash_next directly in tb_remove

  When tb_remove was first commited at fd6ce8f6, there were three different
calls pass different names to offsetof. In current codebase, the other two
calls are replaced with tb_page_remove. There is no need to have a general
tb_remove. Omit passing the third parameter and using tb1-&gt;phys_hash_next
directly.

Signed-off-by: Chen Wei-Ren &lt;chenwj@iis.sinica.edu.tw&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 3f124b687462ce3140d963a024705a89cdc8cee8
      https://github.com/qemu/qemu/commit/3f124b687462ce3140d963a024705a89cdc8cee8
  Author: Liming Wang &lt;walimisdev@gmail.com&gt;
  Date:   2012-12-22 (Sat, 22 Dec 2012)

  Changed paths:
    M net/vde.c

  Log Message:
  -----------
  net: add missing include file

To fix building error:

CC    net/vde.o
net/vde.c: In function âvde_cleanup':
net/vde.c:65:5: error: implicit declaration of function âqemu_set_fd_handler' \
[-Werror=implicit-function-declaration] net/vde.c:65:5: error: nested extern \
                declaration of âqemu_set_fd_handler' [-Werror=nested-externs]
cc1: all warnings being treated as errors

Signed-off-by: Liming Wang &lt;walimisdev@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 36f25d2537c40c6c47f4abee5d31a24863d1adf7
      https://github.com/qemu/qemu/commit/36f25d2537c40c6c47f4abee5d31a24863d1adf7
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-12-22 (Sat, 22 Dec 2012)

  Changed paths:
    M target-xtensa/translate.c

  Log Message:
  -----------
  target-xtensa: fix search_pc for the last TB opcode

Zero out tcg_ctx.gen_opc_instr_start for instructions representing the
last guest opcode in the TB.

Cc: qemu-stable@nongnu.org
Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/bb5801f551ee...36f25d2537c4

----==_mimepart_50d5d907a5eea_7a9e17c7ae4639bc--


</body></email><email><emailId>20121223213007</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-23 21:30:07-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 586502: qemu-char: Inherit ptys and improve output from -s...</subject><body>



----==_mimepart_50d777df44b36_69e812faae8613e1
Date: Sun, 23 Dec 2012 13:30:07 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50d777df46880_69e812faae86145b@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 586502189edf9fd0f89a83de96717a2ea826fdb0
      https://github.com/qemu/qemu/commit/586502189edf9fd0f89a83de96717a2ea826fdb0
  Author: Lei Li &lt;lilei@linux.vnet.ibm.com&gt;
  Date:   2012-12-23 (Sun, 23 Dec 2012)

  Changed paths:
    M qemu-char.c

  Log Message:
  -----------
  qemu-char: Inherit ptys and improve output from -serial pty

Changes since V1:
  - Avoid crashing since qemu_opts_id() may return null on some
    systems according to Markus's suggestion.

When controlling a qemu instance from another program, it's
hard to know which serial port or monitor device is redirected
to which pty. With more than one device using "pty" a lot of
guesswork is involved.

$ ./x86_64-softmmu/qemu-system-x86_64 -serial pty -serial pty -monitor pty
char device redirected to /dev/pts/5
char device redirected to /dev/pts/6
char device redirected to /dev/pts/7

Although we can find out what everything else is connected to
by the "info chardev" with "-monitor stdio" in the command line,
It'd be very useful to be able to have qemu inherit pseudo-tty
file descriptors so they could just be specified on the command
line like:

$ ./x86_64-softmmu/qemu-system-x86_64 -serial pty -serial pty -monitor pty
char device compat_monitor0 redirected to /dev/pts/5
char device serial0 redirected to /dev/pts/6
char device serial1 redirected to /dev/pts/7

Referred link: https://bugs.launchpad.net/qemu/+bug/938552

Signed-off-by: Lei Li &lt;lilei@linux.vnet.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 57f26ae72983095d0258e391041dfb8864f769e5
      https://github.com/qemu/qemu/commit/57f26ae72983095d0258e391041dfb8864f769e5
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-12-23 (Sun, 23 Dec 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: CPUID: return highest basic leaf if eax &gt; cpuid_xlevel

This fixes a subtle bug. A bug that probably won't cause trouble for any
existing OS, but a bug anyway:

Intel SDM Volume 2, CPUID Instruction states:

&gt; Two types of information are returned: basic and extended function
&gt; information. If a value entered for CPUID.EAX is higher than the maximum
&gt; input value for basic or extended function for that processor then the
&gt; data for the highest basic information leaf is returned. For example,
&gt; using the Intel Core i7 processor, the following is true:
&gt;
&gt;   CPUID.EAX = 05H (* Returns MONITOR/MWAIT leaf. *)
&gt;   CPUID.EAX = 0AH (* Returns Architectural Performance Monitoring leaf. *)
&gt;   CPUID.EAX = 0BH (* Returns Extended Topology Enumeration leaf. *)
&gt;   CPUID.EAX = 0CH (* INVALID: Returns the same information as CPUID.EAX = 0BH. *)
&gt;   CPUID.EAX = 80000008H (* Returns linear/physical address size data. *)
&gt;   CPUID.EAX = 8000000AH (* INVALID: Returns same information as CPUID.EAX = 0BH. *)

AMD's CPUID Specification, on the other hand, is less specific:

&gt; The CPUID instruction supports two sets or ranges of functions,
&gt; standard and extended.
&gt;
&gt; â¢ The smallest function number of the standard function range is
&gt;   Fn0000_0000. The largest function num- ber of the standard function
&gt;   range, for a particular implementation, is returned in CPUID
&gt;   Fn0000_0000_EAX.
&gt;
&gt; â¢ The smallest function number of the extended function range is
&gt;   Fn8000_0000. The largest function num- ber of the extended function
&gt;   range, for a particular implementation, is returned in CPUID
&gt;   Fn8000_0000_EAX.
&gt;
&gt; Functions that are neither standard nor extended are undefined and
&gt; should not be relied upon.

QEMU's behavior matched Intel's specification before, but this was
changed by commit b3baa152aaef1905876670590275c2dd0bbb088c. This patch
restores the behavior documented by Intel when cpuid_xlevel2 is 0.

The existing behavior when cpuid_xlevel2 is set (falling back to
level=cpuid_xlevel) is being kept, as I couldn't find any public
documentation on the CPUID 0xC0000000 function range on Centaur CPUs.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 6265e4ff327763b6362cba472e2b46f2dcf18762
      https://github.com/qemu/qemu/commit/6265e4ff327763b6362cba472e2b46f2dcf18762
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-12-23 (Sun, 23 Dec 2012)

  Changed paths:
    M qemu-thread-win32.c

  Log Message:
  -----------
  win32: Switch thread abstraction to us TLS variable internally

We already depend on working __thread support for coroutines, so this
complication here is no longer needed.

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: eac236ea7bfc1902126be70459e320591078df5c
      https://github.com/qemu/qemu/commit/eac236ea7bfc1902126be70459e320591078df5c
  Author: LluÃ­s Vilanova &lt;vilanova@ac.upc.edu&gt;
  Date:   2012-12-23 (Sun, 23 Dec 2012)

  Changed paths:
    M .gitignore
    M Makefile
    M Makefile.objs
    M scripts/tracetool/backend/dtrace.py
    M scripts/tracetool/format/h.py
    A trace.h
    A trace/Makefile.objs

  Log Message:
  -----------
  build: Use separate makefile for "trace/"

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: LluÃ­s Vilanova &lt;vilanova@ac.upc.edu&gt;
--
Changes in v2:

* Do not depend on "qemu-timer-common.o".
* Use "$(obj)" in rules to refer to the build sub-directory.
* Remove dependencies against "$(GENERATED_HEADERS)".

Cc: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 2915efbfa8efadaa2806e827ba92b8dba4f7cd52
      https://github.com/qemu/qemu/commit/2915efbfa8efadaa2806e827ba92b8dba4f7cd52
  Author: Alex Horn &lt;alex.horn@cs.ox.ac.uk&gt;
  Date:   2012-12-23 (Sun, 23 Dec 2012)

  Changed paths:
    M hw/i2c.h
    M hw/tmp105.c
    A hw/tmp105.h

  Log Message:
  -----------
  tmp105: Create API for TMP105 temperature sensor.

* Define enum for TMP105 registers
* Move tmp105_set() from I2C to TMP105 header
* Document units and range of temperature as preconditions

Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Alex Horn &lt;alex.horn@cs.ox.ac.uk&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 74880fe27d2120ab3861dc857ecd025db1a67038
      https://github.com/qemu/qemu/commit/74880fe27d2120ab3861dc857ecd025db1a67038
  Author: Robert Schiele &lt;rschiele@gmail.com&gt;
  Date:   2012-12-23 (Sun, 23 Dec 2012)

  Changed paths:
    M configure
    M target-unicore32/helper.c

  Log Message:
  -----------
  configure: allow disabling pixman if not needed

When we build neither any system emulation targets nor the tools there
is actually no need for pixman library.  In that case do not enforce
presence of that library on the system.

Reviewed-by: Andreas F=E4rber &lt;afaerber@suse.de&gt;
Signed-off-by: Robert Schiele &lt;rschiele@gmail.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/36f25d2537c4...74880fe27d21

----==_mimepart_50d777df44b36_69e812faae8613e1--


</body></email><email><emailId>20121223220009</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-23 22:00:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] a2685b: MAINTAINERS: Take over kvm maintenance</subject><body>



----==_mimepart_50d77ee915947_1ce61b8cae41065ed
Date: Sun, 23 Dec 2012 14:00:09 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50d77ee916b7f_1ce61b8cae4106631@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: a2685bcc80f61aa612e0d8cfd91086857ae2942e
      https://github.com/qemu/qemu/commit/a2685bcc80f61aa612e0d8cfd91086857ae2942e
  Author: Gleb Natapov &lt;gleb@redhat.com&gt;
  Date:   2012-12-23 (Sun, 23 Dec 2012)

  Changed paths:
    M MAINTAINERS

  Log Message:
  -----------
  MAINTAINERS: Take over kvm maintenance

Replace Avi with myself as kvm maintainer.

Signed-off-by: Gleb Natapov &lt;gleb@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;




----==_mimepart_50d77ee915947_1ce61b8cae41065ed--


</body></email><email><emailId>20121228203013</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-28 20:30:13-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 5f5e33: target-alpha: Let cpu_alpha_init() return AlphaCPU</subject><body>



----==_mimepart_50de015540c90_100010b6ae8580b3
Date: Fri, 28 Dec 2012 12:30:13 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50de015542700_100010b6ae858172@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 5f5e335088925cedc5b912fd8bb4e1e933094d56
      https://github.com/qemu/qemu/commit/5f5e335088925cedc5b912fd8bb4e1e=
933094d56
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M target-alpha/cpu.h
    M target-alpha/translate.c

  Log Message:
  -----------
  target-alpha: Let cpu_alpha_init() return AlphaCPU

Replace cpu_init() macro with inline function for backwards
compatibility.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Acked-by: Richard Henderson &lt;rth@twiddle.net&gt;


  Commit: ad6011775a324d7c3e2a8bd824e03c5e576dda48
      https://github.com/qemu/qemu/commit/ad6011775a324d7c3e2a8bd824e03c5=
e576dda48
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M hw/alpha_dp264.c
    M hw/alpha_sys.h
    M hw/alpha_typhoon.c

  Log Message:
  -----------
  alpha: Pass AlphaCPU array to Typhoon

Also store it in TyphoonCchip.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Acked-by: Richard Henderson &lt;rth@twiddle.net&gt;


  Commit: c92458538f501eda585b4b774c50644aed391a8a
      https://github.com/qemu/qemu/commit/c92458538f501eda585b4b774c50644=
aed391a8a
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M hw/alpha_typhoon.c
    M target-alpha/cpu-qom.h
    M target-alpha/cpu.h
    M target-alpha/sys_helper.c

  Log Message:
  -----------
  target-alpha: Avoid leaking the alarm timer over reset

Move the timer from CPUAlphaState to AlphaCPU to avoid the pointer being
zero'ed once we implement reset. Would cause a segfault in
sys_helper.c:helper_set_alarm().

This also simplifies timer initialization in Typhoon.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Acked-by: Richard Henderson &lt;rth@twiddle.net&gt;


  Commit: 0c28246fcd5ea9ccb22aa93ef2e0af14463fec58
      https://github.com/qemu/qemu/commit/0c28246fcd5ea9ccb22aa93ef2e0af1=
4463fec58
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M target-alpha/cpu.c
    M target-alpha/cpu.h
    M target-alpha/translate.c

  Log Message:
  -----------
  target-alpha: Turn CPU definitions into subclasses

Make TYPE_ALPHA_CPU abstract and add types &lt;name&gt;-alpha-cpu.
Use type inheritence, and turn "2*" models into aliases.

Move cpu_alpha_init() to cpu.c and split out CPU realization.
Default to creating type "ev67-alpha-cpu" as before.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Acked-by: Richard Henderson &lt;rth@twiddle.net&gt;


  Commit: 494342b35b55b3b126821141e15c8a49df122ff1
      https://github.com/qemu/qemu/commit/494342b35b55b3b126821141e15c8a4=
9df122ff1
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-12-18 (Tue, 18 Dec 2012)

  Changed paths:
    M target-alpha/cpu.c
    M target-alpha/cpu.h

  Log Message:
  -----------
  target-alpha: Add support for -cpu ?

Implement alphabetical listing of CPU subclasses.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Acked-by: Richard Henderson &lt;rth@twiddle.net&gt;


  Commit: 92a3136174f60ee45b113296cb2c2a5225b00369
      https://github.com/qemu/qemu/commit/92a3136174f60ee45b113296cb2c2a5=
225b00369
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-12-19 (Wed, 19 Dec 2012)

  Changed paths:
    M cpu-common.h
    M target-alpha/cpu.c
    M target-arm/helper.c
    M target-m68k/helper.c

  Log Message:
  -----------
  cpu: Introduce CPUListState struct

This generalizes {ARM,M68k,Alpha}CPUListState to avoid declaring it for
each target. Place it in cpu-common.h to avoid circular dependencies.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Reviewed-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Reviewed-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;


  Commit: 04a2d61e494532260214736ebb0f975822771643
      https://github.com/qemu/qemu/commit/04a2d61e494532260214736ebb0f975=
822771643
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-12-19 (Wed, 19 Dec 2012)

  Changed paths:
    M hw/qdev-properties.c
    M hw/qdev.c

  Log Message:
  -----------
  qdev: Coding style fixes

Add missing braces and break lines larger than 80 chars.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: a404b61244ff555ace0a1360fc22275fbeda503e
      https://github.com/qemu/qemu/commit/a404b61244ff555ace0a1360fc22275=
fbeda503e
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-12-19 (Wed, 19 Dec 2012)

  Changed paths:
    M hw/Makefile.objs
    A hw/qdev-properties-system.c
    M hw/qdev-properties.c
    M hw/qdev-properties.h
    M hw/qdev.c

  Log Message:
  -----------
  qdev-properties.c: Separate core from the code used only by qemu-system=
-*

This separates the qdev properties code in two parts:
 - qdev-properties.c, that contains most of the qdev properties code;
 - qdev-properties-system.c for code specific for qemu-system-*,
   containing:
   - Property types: drive, chr, netdev, vlan, that depend on code that
     won't be included on *-user
   - qemu_add_globals(), that depends on qemu-config.o.

This change should help on two things:
 - Allowing DeviceState to be used by *-user without pulling
   dependencies that are specific for qemu-system-*;
 - Writing qdev unit tests without pulling too many dependencies.

The copyright/license of qdev-properties.c isn't explicitly stated at
the file, so add a simple copyright/license header pointing to the
commit ID of the original file.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 8737c51c0444f832c4e97d7eb7540eae457e08e4
      https://github.com/qemu/qemu/commit/8737c51c0444f832c4e97d7eb7540ea=
e457e08e4
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-12-19 (Wed, 19 Dec 2012)

  Changed paths:
    M cpu-defs.h
    M include/qemu/cpu.h
    M kvm-all.c

  Log Message:
  -----------
  cpu: Move kvm_fd into CPUState

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 20d695a9254c1b086a456d3b79a3c311236643ba
      https://github.com/qemu/qemu/commit/20d695a9254c1b086a456d3b79a3c31=
1236643ba
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-12-19 (Wed, 19 Dec 2012)

  Changed paths:
    M cpu-defs.h
    M include/qemu/cpu.h
    M kvm-all.c
    M kvm.h
    M target-i386/kvm.c
    M target-ppc/kvm.c
    M target-s390x/kvm.c

  Log Message:
  -----------
  kvm: Pass CPUState to kvm_arch_*

Move kvm_vcpu_dirty field into CPUState to simplify things and change
its type to bool while at it.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 1bc22652d62f862a5def54f939e87fdb7a5593ae
      https://github.com/qemu/qemu/commit/1bc22652d62f862a5def54f939e87fd=
b7a5593ae
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-12-19 (Wed, 19 Dec 2012)

  Changed paths:
    M hw/kvm/apic.c
    M hw/kvm/clock.c
    M hw/ppc.c
    M hw/s390-virtio-bus.c
    M hw/spapr.c
    M kvm-all.c
    M kvm.h
    M target-i386/kvm.c
    M target-ppc/kvm.c
    M target-ppc/kvm_ppc.h
    M target-s390x/cpu.h
    M target-s390x/interrupt.c
    M target-s390x/kvm.c
    M target-s390x/misc_helper.c

  Log Message:
  -----------
  kvm: Pass CPUState to kvm_vcpu_ioctl()

Adapt helper functions to pass X86CPU / PowerPCCPU / S390CPU.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 7058581a26f4299e0b7e05677c64c1b5a50d0e75
      https://github.com/qemu/qemu/commit/7058581a26f4299e0b7e05677c64c1b=
5a50d0e75
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-12-19 (Wed, 19 Dec 2012)

  Changed paths:
    M hw/ppc.c
    M hw/ppc.h
    M hw/ppc_booke.c

  Log Message:
  -----------
  ppc: Pass PowerPCCPU to ppc_set_irq()

Adapt static caller functions.

This cleans up after passing PowerPCCPU to kvmppc_set_interrupt().

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 7e0a924734e7bfad7568bf57fec68bfecd5c2575
      https://github.com/qemu/qemu/commit/7e0a924734e7bfad7568bf57fec68bf=
ecd5c2575
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-12-19 (Wed, 19 Dec 2012)

  Changed paths:
    M hw/ppc.c

  Log Message:
  -----------
  ppc: Pass PowerPCCPU to [h]decr callbacks

Cleans up after passing PowerPCCPU to ppc_set_irq().

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 50c680f06ca81aebc91ac4a325f194b2d8396721
      https://github.com/qemu/qemu/commit/50c680f06ca81aebc91ac4a325f194b=
2d8396721
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-12-19 (Wed, 19 Dec 2012)

  Changed paths:
    M hw/ppc.c

  Log Message:
  -----------
  ppc: Pass PowerPCCPU to [h]decr timer callbacks

Cleans up after passing PowerPCCPU to [h]decr exception callbacks.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: ee0c98e650da0ce1e4e17dc1e2bbb946cde2c45c
      https://github.com/qemu/qemu/commit/ee0c98e650da0ce1e4e17dc1e2bbb94=
6cde2c45c
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-12-19 (Wed, 19 Dec 2012)

  Changed paths:
    M hw/ppc_booke.c

  Log Message:
  -----------
  ppc_booke: Pass PowerPCCPU to {decr,fit,wdt} timer callbacks

Cleans up after passing PowerPCCPU to booke_update_irq().

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 2f9859fb49cb3c6ec876bc0bf709f28afcdd2384
      https://github.com/qemu/qemu/commit/2f9859fb49cb3c6ec876bc0bf709f28=
afcdd2384
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-12-19 (Wed, 19 Dec 2012)

  Changed paths:
    M hw/ppc405_uc.c
    M hw/ppc4xx.h
    M hw/ppc4xx_devs.c

  Log Message:
  -----------
  ppc4xx_devs: Return PowerPCCPU from ppc4xx_init()

Prepares for passing PowerPCCPU to ppc_booke_timers_init().

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: a34a92b9ecd8d25bd1de9df601ed31ccd8ebcae7
      https://github.com/qemu/qemu/commit/a34a92b9ecd8d25bd1de9df601ed31c=
cd8ebcae7
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-12-19 (Wed, 19 Dec 2012)

  Changed paths:
    M hw/ppc.h
    M hw/ppc/e500.c
    M hw/ppc405_uc.c
    M hw/ppc440_bamboo.c
    M hw/ppc_booke.c
    M hw/virtex_ml507.c

  Log Message:
  -----------
  ppc_booke: Pass PowerPCCPU to ppc_booke_timers_init()

Cleans up after passing PowerPCCPU to timer callbacks.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: a60f24b56b07f46453424263b276b0879c25c4e6
      https://github.com/qemu/qemu/commit/a60f24b56b07f46453424263b276b08=
79c25c4e6
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-12-19 (Wed, 19 Dec 2012)

  Changed paths:
    M cpu-defs.h
    M include/qemu/cpu.h
    M kvm-all.c
    M kvm.h
    M target-i386/cpu.c
    M target-i386/kvm.c
    M target-ppc/kvm.c
    M target-s390x/kvm.c

  Log Message:
  -----------
  cpu: Move kvm_state field into CPUState

Adapt some functions to take CPUState / {PowerPC,S390}CPU argument.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: f7575c96c6058763fe3bd8dd26f3d09473f2df36
      https://github.com/qemu/qemu/commit/f7575c96c6058763fe3bd8dd26f3d09=
473f2df36
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-12-19 (Wed, 19 Dec 2012)

  Changed paths:
    M cpu-defs.h
    M include/qemu/cpu.h
    M kvm-all.c
    M target-i386/kvm.c
    M target-s390x/kvm.c

  Log Message:
  -----------
  cpu: Move kvm_run into CPUState

Pass CPUState / {X86,S390}CPU to helper functions.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 62e0c095450f6a7eb37914991f3f7966aa4da7a1
      https://github.com/qemu/qemu/commit/62e0c095450f6a7eb37914991f3f796=
6aa4da7a1
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-12-19 (Wed, 19 Dec 2012)

  Changed paths:
    M MAINTAINERS

  Log Message:
  -----------
  MAINTAINERS: Include X86CPU in CPU maintenance area

Document that the x86 CPU refactorings are going through the qom-cpu
tree. This does not contradict the established practice that patches
adding KVM features to the x86 CPU go through the KVM maintainers,
it merely takes it out of target-i386 TCG's Odd Fixes status.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Cc: Marcello Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 501a7ce7270955be151c442c27620fa7af2f3ce5
      https://github.com/qemu/qemu/commit/501a7ce7270955be151c442c27620fa=
7af2f3ce5
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-12-22 (Sat, 22 Dec 2012)

  Changed paths:
    M .gitignore
    M MAINTAINERS
    M Makefile
    R Makefile.dis
    M Makefile.objs
    M Makefile.target
    R Makefile.user
    R a.out.h
    M acl.c
    R acl.h
    M aes.c
    R aes.h
    M aio-posix.c
    M aio-win32.c
    R alpha-dis.c
    R alpha.ld
    M arch_init.c
    R arch_init.h
    R arm-dis.c
    R arm.ld
    M async.c
    M audio/Makefile.objs
    M audio/alsaaudio.c
    M audio/audio.c
    M audio/audio.h
    M audio/noaudio.c
    M audio/ossaudio.c
    M audio/spiceaudio.c
    M audio/wavaudio.c
    M audio/wavcapture.c
    M audio/winwaveaudio.c
    M backends/rng-egd.c
    M backends/rng-random.c
    M backends/rng.c
    M balloon.c
    R balloon.h
    M bitmap.c
    R bitmap.h
    M bitops.c
    R bitops.h
    M block-migration.c
    R block-migration.h
    M block.c
    R block.h
    M block/Makefile.objs
    M block/blkdebug.c
    M block/blkverify.c
    M block/bochs.c
    M block/cloop.c
    M block/commit.c
    M block/cow.c
    M block/curl.c
    M block/dmg.c
    M block/gluster.c
    M block/iscsi.c
    M block/linux-aio.c
    M block/mirror.c
    M block/nbd.c
    M block/parallels.c
    M block/qcow.c
    M block/qcow2-cache.c
    M block/qcow2-cluster.c
    M block/qcow2-refcount.c
    M block/qcow2-snapshot.c
    M block/qcow2.c
    M block/qcow2.h
    M block/qed-table.c
    M block/qed.c
    M block/qed.h
    M block/raw-posix.c
    M block/raw-win32.c
    M block/raw.c
    M block/rbd.c
    M block/sheepdog.c
    M block/stream.c
    M block/vdi.c
    M block/vmdk.c
    M block/vpc.c
    M block/vvfat.c
    M block/win32-aio.c
    R block_int.h
    M blockdev-nbd.c
    M blockdev.c
    R blockdev.h
    M blockjob.c
    R blockjob.h
    M bsd-user/elfload.c
    M bsd-user/main.c
    M bsd-user/qemu.h
    R bswap.h
    M bt-host.c
    R bt-host.h
    M bt-vhci.c
    R buffered_file.c
    R buffered_file.h
    M cache-utils.c
    R cache-utils.h
    M cmd.c
    M compatfd.c
    R compatfd.h
    R compiler.h
    R config.h
    M configure
    R console.c
    R console.h
    M coroutine-gthread.c
    M coroutine-sigaltstack.c
    M coroutine-ucontext.c
    M coroutine-win32.c
    R cpu-all.h
    R cpu-common.h
    R cpu-defs.h
    M cpu-exec.c
    M cpus.c
    R cpus.h
    M cputlb.c
    R cputlb.h
    R cris-dis.c
    R cursor.c
    R cursor_hidden.xpm
    R cursor_left_ptr.xpm
    M cutils.c
    R def-helper.h
    M device_tree.c
    R device_tree.h
    R dis-asm.h
    M disas.c
    R disas.h
    A disas/Makefile.objs
    A disas/alpha.c
    A disas/arm.c
    A disas/cris.c
    A disas/hppa.c
    A disas/i386.c
    A disas/ia64.c
    A disas/lm32.c
    A disas/m68k.c
    A disas/microblaze.c
    A disas/mips.c
    A disas/ppc.c
    A disas/s390.c
    A disas/sh4.c
    A disas/sparc.c
    A disas/tci.c
    M dma-helpers.c
    R dma.h
    M dump-stub.c
    M dump.c
    R dump.h
    R elf.h
    M envlist.c
    R envlist.h
    M error.c
    R error.h
    M event_notifier-posix.c
    M event_notifier-win32.c
    R event_notifier.h
    R exec-all.h
    R exec-memory.h
    M exec.c
    M fpu/softfloat.c
    R fpu/softfloat.h
    M fsdev/qemu-fsdev-dummy.c
    M fsdev/qemu-fsdev.c
    M fsdev/qemu-fsdev.h
    M fsdev/virtfs-proxy-helper.c
    M fsdev/virtio-9p-marshal.c
    M gdbstub.c
    R gdbstub.h
    R gen-icount.h
    M hmp.c
    M hmp.h
    M host-utils.c
    R host-utils.h
    R hppa-dis.c
    R hppa.ld
    M hw/9pfs/codir.c
    M hw/9pfs/cofile.c
    M hw/9pfs/cofs.c
    M hw/9pfs/coxattr.c
    M hw/9pfs/virtio-9p-coth.c
    M hw/9pfs/virtio-9p-coth.h
    M hw/9pfs/virtio-9p-device.c
    M hw/9pfs/virtio-9p-handle.c
    M hw/9pfs/virtio-9p-local.c
    M hw/9pfs/virtio-9p-posix-acl.c
    M hw/9pfs/virtio-9p-synth.h
    M hw/9pfs/virtio-9p-xattr.h
    M hw/9pfs/virtio-9p.c
    M hw/9pfs/virtio-9p.h
    M hw/Makefile.objs
    M hw/ac97.c
    M hw/acpi.c
    M hw/acpi.h
    M hw/acpi_ich9.c
    M hw/acpi_piix4.c
    M hw/adb.c
    M hw/adlib.c
    M hw/ads7846.c
    M hw/alpha_dp264.c
    M hw/alpha_pci.c
    M hw/alpha_sys.h
    M hw/alpha_typhoon.c
    M hw/an5206.c
    M hw/apb_pci.c
    M hw/apic.c
    M hw/apic_common.c
    M hw/apic_internal.h
    M hw/apm.c
    M hw/apm.h
    M hw/applesmc.c
    M hw/arm-misc.h
    M hw/arm11mpcore.c
    M hw/arm_boot.c
    M hw/arm_mptimer.c
    M hw/arm_sysctl.c
    M hw/arm_timer.c
    M hw/armv7m_nvic.c
    M hw/audiodev.h
    M hw/axis_dev88.c
    M hw/baum.c
    M hw/baum.h
    M hw/blizzard.c
    M hw/block-common.c
    M hw/boards.h
    M hw/bonito.c
    M hw/bt-hci-csr.c
    M hw/bt-hci.c
    M hw/bt-hid.c
    M hw/bt-l2cap.c
    M hw/bt.c
    M hw/bt.h
    M hw/cadence_gem.c
    M hw/cadence_ttc.c
    M hw/cadence_uart.c
    M hw/cbus.c
    M hw/ccid-card-emulated.c
    M hw/ccid-card-passthru.c
    M hw/cirrus_vga.c
    M hw/collie.c
    M hw/cris-boot.h
    M hw/cs4231a.c
    M hw/cuda.c
    M hw/debugcon.c
    M hw/dec_pci.c
    M hw/device-hotplug.c
    M hw/dma.c
    M hw/dp8393x.c
    M hw/dummy_m68k.c
    M hw/e1000.c
    M hw/eepro100.c
    M hw/empty_slot.h
    M hw/es1370.c
    M hw/escc.c
    M hw/escc.h
    M hw/esp-pci.c
    M hw/esp.c
    M hw/etraxfs.h
    M hw/etraxfs_dma.c
    M hw/etraxfs_dma.h
    M hw/etraxfs_eth.c
    M hw/etraxfs_ser.c
    M hw/etraxfs_timer.c
    M hw/exynos4210.c
    M hw/exynos4210.h
    M hw/exynos4210_fimd.c
    M hw/exynos4210_i2c.c
    M hw/exynos4210_mct.c
    M hw/exynos4210_pwm.c
    M hw/exynos4210_rtc.c
    M hw/exynos4210_uart.c
    M hw/exynos4_boards.c
    M hw/fdc.c
    M hw/flash.h
    M hw/framebuffer.c
    M hw/framebuffer.h
    M hw/fw_cfg.c
    M hw/g364fb.c
    M hw/grackle_pci.c
    M hw/grlib_apbuart.c
    M hw/grlib_gptimer.c
    M hw/gt64xxx.c
    M hw/gumstix.c
    M hw/hd-geometry.c
    M hw/hda-audio.c
    M hw/hid.c
    M hw/hid.h
    M hw/highbank.c
    M hw/hpet.c
    M hw/hw.h
    M hw/i386/Makefile.objs
    M hw/i82378.c
    M hw/i8254.c
    M hw/i8254_common.c
    M hw/i8259.c
    M hw/i82801b11.c
    M hw/ich9.h
    M hw/ide.h
    M hw/ide/ahci.c
    M hw/ide/cmd646.c
    M hw/ide/core.c
    M hw/ide/ich.c
    M hw/ide/internal.h
    M hw/ide/isa.c
    M hw/ide/macio.c
    M hw/ide/microdrive.c
    M hw/ide/mmio.c
    M hw/ide/pci.c
    M hw/ide/piix.c
    M hw/ide/qdev.c
    M hw/ide/via.c
    M hw/imx_avic.c
    M hw/imx_ccm.c
    M hw/imx_serial.c
    M hw/imx_timer.c
    M hw/integratorcp.c
    M hw/intel-hda.c
    M hw/ioapic_internal.h
    M hw/ioh3420.c
    M hw/ioh3420.h
    M hw/isa-bus.c
    M hw/isa.h
    M hw/isa_mmio.c
    M hw/ivshmem.c
    M hw/jazz_led.c
    M hw/kvm/apic.c
    M hw/kvm/clock.c
    M hw/kvm/i8254.c
    M hw/kvm/i8259.c
    M hw/kvm/ioapic.c
    M hw/kvm/pci-assign.c
    M hw/kvmvapic.c
    M hw/kzm.c
    M hw/lan9118.c
    M hw/lance.c
    M hw/leon3.c
    M hw/lm32.h
    M hw/lm32_boards.c
    M hw/lm32_juart.c
    M hw/lm32_pic.c
    M hw/lm32_sys.c
    M hw/lm32_timer.c
    M hw/lm32_uart.c
    M hw/lm832x.c
    M hw/loader.c
    M hw/lpc_ich9.c
    M hw/lsi53c895a.c
    M hw/m25p80.c
    M hw/m48t59.c
    M hw/mac_dbdma.c
    M hw/mac_dbdma.h
    M hw/mac_nvram.c
    M hw/macio.c
    M hw/mainstone.c
    M hw/mc146818rtc.c
    M hw/mcf5206.c
    M hw/mcf5208.c
    M hw/mcf_fec.c
    M hw/mcf_intc.c
    M hw/mcf_uart.c
    M hw/megasas.c
    M hw/microblaze_boot.c
    M hw/milkymist-ac97.c
    M hw/milkymist-hpdmc.c
    M hw/milkymist-hw.h
    M hw/milkymist-memcard.c
    M hw/milkymist-minimac2.c
    M hw/milkymist-pfpu.c
    M hw/milkymist-softusb.c
    M hw/milkymist-sysctl.c
    M hw/milkymist-tmu2.c
    M hw/milkymist-uart.c
    M hw/milkymist-vgafb.c
    M hw/milkymist.c
    M hw/mips.h
    M hw/mips_fulong2e.c
    M hw/mips_jazz.c
    M hw/mips_malta.c
    M hw/mips_mipssim.c
    M hw/mips_r4k.c
    M hw/mips_timer.c
    M hw/mipsnet.c
    M hw/mpc8544_guts.c
    R hw/msi.c
    R hw/msi.h
    R hw/msix.c
    R hw/msix.h
    M hw/msmouse.c
    M hw/msmouse.h
    M hw/multiboot.c
    M hw/musicpal.c
    M hw/nand.c
    M hw/ne2000-isa.c
    M hw/ne2000.c
    M hw/ne2000.h
    M hw/nseries.c
    M hw/omap.h
    M hw/omap1.c
    M hw/omap2.c
    M hw/omap_dma.c
    M hw/omap_dss.c
    M hw/omap_gpmc.c
    M hw/omap_gptimer.c
    M hw/omap_lcdc.c
    M hw/omap_sx1.c
    M hw/omap_synctimer.c
    M hw/omap_uart.c
    M hw/onenand.c
    M hw/opencores_eth.c
    M hw/openpic.c
    M hw/openrisc_sim.c
    M hw/openrisc_timer.c
    M hw/palm.c
    M hw/pam.c
    M hw/pam.h
    M hw/parallel.c
    M hw/pc.c
    M hw/pc.h
    M hw/pc_piix.c
    M hw/pc_q35.c
    M hw/pc_sysfw.c
    R hw/pci-hotplug.c
    R hw/pci-stub.c
    R hw/pci.c
    R hw/pci.h
    A hw/pci/Makefile.objs
    A hw/pci/msi.c
    A hw/pci/msi.h
    A hw/pci/msix.c
    A hw/pci/msix.h
    A hw/pci/pci-hotplug.c
    A hw/pci/pci-stub.c
    A hw/pci/pci.c
    A hw/pci/pci.h
    A hw/pci/pci_bridge.c
    A hw/pci/pci_bridge.h
    A hw/pci/pci_bus.h
    A hw/pci/pci_host.c
    A hw/pci/pci_host.h
    A hw/pci/pci_ids.h
    A hw/pci/pci_regs.h
    A hw/pci/pcie.c
    A hw/pci/pcie.h
    A hw/pci/pcie_aer.c
    A hw/pci/pcie_aer.h
    A hw/pci/pcie_host.c
    A hw/pci/pcie_host.h
    A hw/pci/pcie_port.c
    A hw/pci/pcie_port.h
    A hw/pci/pcie_regs.h
    A hw/pci/shpc.c
    A hw/pci/shpc.h
    A hw/pci/slotid_cap.c
    A hw/pci/slotid_cap.h
    R hw/pci_bridge.c
    R hw/pci_bridge.h
    M hw/pci_bridge_dev.c
    R hw/pci_host.c
    R hw/pci_host.h
    R hw/pci_ids.h
    R hw/pci_internals.h
    R hw/pci_regs.h
    R hw/pcie.c
    R hw/pcie.h
    R hw/pcie_aer.c
    R hw/pcie_aer.h
    R hw/pcie_host.c
    R hw/pcie_host.h
    R hw/pcie_port.c
    R hw/pcie_port.h
    R hw/pcie_regs.h
    M hw/pckbd.c
    M hw/pcmcia.h
    M hw/pcnet-pci.c
    M hw/pcnet.c
    M hw/pcnet.h
    M hw/pcspk.c
    M hw/petalogix_ml605_mmu.c
    M hw/petalogix_s3adsp1800_mmu.c
    M hw/pflash_cfi01.c
    M hw/pflash_cfi02.c
    M hw/piix4.c
    M hw/piix_pci.c
    R hw/pixel_ops.h
    M hw/pl011.c
    M hw/pl031.c
    M hw/pl110.c
    M hw/pl181.c
    M hw/ppc.c
    M hw/ppc.h
    M hw/ppc/Makefile.objs
    M hw/ppc/e500.c
    M hw/ppc/e500plat.c
    M hw/ppc/mpc8544ds.c
    M hw/ppc405_boards.c
    M hw/ppc405_uc.c
    M hw/ppc440_bamboo.c
    M hw/ppc4xx.h
    M hw/ppc4xx_devs.c
    M hw/ppc4xx_pci.c
    M hw/ppc_booke.c
    M hw/ppc_mac.h
    M hw/ppc_newworld.c
    M hw/ppc_oldworld.c
    M hw/ppc_prep.c
    M hw/ppce500_pci.c
    M hw/ppce500_spin.c
    M hw/prep_pci.c
    M hw/ps2.c
    M hw/ptimer.c
    M hw/ptimer.h
    M hw/puv3.c
    M hw/pxa.h
    M hw/pxa2xx.c
    M hw/pxa2xx_keypad.c
    M hw/pxa2xx_lcd.c
    M hw/pxa2xx_timer.c
    M hw/q35.h
    M hw/qdev-addr.c
    M hw/qdev-addr.h
    M hw/qdev-core.h
    M hw/qdev-monitor.c
    M hw/qdev-monitor.h
    M hw/qdev-properties-system.c
    M hw/qdev-properties.c
    M hw/qdev.c
    M hw/qxl-logger.c
    M hw/qxl.c
    M hw/qxl.h
    M hw/r2d.c
    M hw/rc4030.c
    M hw/realview.c
    M hw/rtl8139.c
    M hw/s390-virtio-bus.c
    M hw/s390-virtio-bus.h
    M hw/s390-virtio.c
    M hw/s390x/event-facility.c
    M hw/s390x/event-facility.h
    M hw/s390x/sclp.c
    M hw/s390x/sclpconsole.c
    M hw/s390x/sclpquiesce.c
    M hw/sb16.c
    M hw/scsi-bus.c
    M hw/scsi-defs.h
    M hw/scsi-disk.c
    M hw/scsi-generic.c
    M hw/scsi.h
    M hw/sd.c
    M hw/serial-pci.c
    M hw/serial.c
    M hw/serial.h
    M hw/sga.c
    M hw/sh7750.c
    M hw/sh_intc.h
    M hw/sh_pci.c
    M hw/sh_serial.c
    M hw/sh_timer.c
    M hw/shix.c
    R hw/shpc.c
    R hw/shpc.h
    M hw/slavio_intctl.c
    M hw/slavio_misc.c
    M hw/slavio_timer.c
    R hw/slotid_cap.c
    R hw/slotid_cap.h
    M hw/sm501.c
    M hw/smbios.c
    M hw/smbus_ich9.c
    M hw/smc91c111.c
    M hw/soc_dma.c
    M hw/soc_dma.h
    M hw/spapr.c
    M hw/spapr.h
    M hw/spapr_events.c
    M hw/spapr_hcall.c
    M hw/spapr_iommu.c
    M hw/spapr_llan.c
    M hw/spapr_nvram.c
    M hw/spapr_pci.c
    M hw/spapr_pci.h
    M hw/spapr_rtas.c
    M hw/spapr_vio.c
    M hw/spapr_vio.h
    M hw/spapr_vscsi.c
    M hw/spapr_vty.c
    M hw/spitz.c
    M hw/ssd0303.c
    M hw/ssd0323.c
    M hw/ssi-sd.c
    M hw/stellaris.c
    M hw/stellaris_enet.c
    M hw/stellaris_input.c
    M hw/stream.h
    M hw/strongarm.c
    M hw/strongarm.h
    M hw/sun4c_intctl.c
    M hw/sun4m.c
    M hw/sun4u.c
    M hw/sysbus.c
    M hw/sysbus.h
    M hw/tc6393xb.c
    M hw/tcx.c
    M hw/tosa.c
    M hw/tsc2005.c
    M hw/tsc210x.c
    M hw/tusb6010.c
    M hw/twl92230.c
    A hw/uboot_image.h
    M hw/unin_pci.c
    M hw/usb.h
    M hw/usb/bus.c
    M hw/usb/combined-packet.c
    M hw/usb/core.c
    M hw/usb/dev-bluetooth.c
    M hw/usb/dev-hid.c
    M hw/usb/dev-network.c
    M hw/usb/dev-serial.c
    M hw/usb/dev-smartcard-reader.c
    M hw/usb/dev-storage.c
    M hw/usb/dev-uas.c
    M hw/usb/dev-wacom.c
    M hw/usb/hcd-ehci-pci.c
    M hw/usb/hcd-ehci.h
    M hw/usb/hcd-musb.c
    M hw/usb/hcd-ohci.c
    M hw/usb/hcd-uhci.c
    M hw/usb/hcd-xhci.c
    M hw/usb/host-bsd.c
    M hw/usb/host-linux.c
    M hw/usb/host-stub.c
    M hw/usb/libhw.c
    M hw/usb/redirect.c
    M hw/versatile_pci.c
    M hw/versatilepb.c
    M hw/vexpress.c
    M hw/vfio_pci.c
    M hw/vga-isa-mm.c
    M hw/vga-isa.c
    M hw/vga-pci.c
    M hw/vga.c
    M hw/vga_int.h
    M hw/vhost.c
    M hw/vhost.h
    M hw/vhost_net.c
    M hw/vhost_net.h
    M hw/virtex_ml507.c
    M hw/virtio-balloon.c
    M hw/virtio-balloon.h
    M hw/virtio-blk.c
    M hw/virtio-console.c
    M hw/virtio-net.c
    M hw/virtio-net.h
    M hw/virtio-pci.c
    M hw/virtio-rng.c
    M hw/virtio-scsi.h
    M hw/virtio-serial-bus.c
    M hw/virtio.c
    M hw/virtio.h
    M hw/vmmouse.c
    M hw/vmport.c
    M hw/vmware_vga.c
    M hw/vt82c686.c
    M hw/watchdog.c
    M hw/watchdog.h
    M hw/wdt_i6300esb.c
    M hw/wdt_ib700.c
    M hw/xen-host-pci-device.h
    M hw/xen_apic.c
    M hw/xen_backend.c
    M hw/xen_backend.h
    M hw/xen_common.h
    M hw/xen_console.c
    M hw/xen_devconfig.c
    M hw/xen_disk.c
    M hw/xen_domainbuild.c
    M hw/xen_machine_pv.c
    M hw/xen_nic.c
    M hw/xen_platform.c
    M hw/xen_pt.c
    M hw/xen_pt.h
    M hw/xen_pt_config_init.c
    M hw/xenfb.c
    M hw/xgmac.c
    M hw/xilinx.h
    M hw/xilinx_axidma.c
    M hw/xilinx_axienet.c
    M hw/xilinx_ethlite.c
    M hw/xilinx_spi.c
    M hw/xilinx_spips.c
    M hw/xilinx_timer.c
    M hw/xilinx_uartlite.c
    M hw/xilinx_zynq.c
    M hw/xio3130_downstream.c
    M hw/xio3130_downstream.h
    M hw/xio3130_upstream.c
    M hw/xio3130_upstream.h
    M hw/xtensa_lx60.c
    M hw/xtensa_pic.c
    M hw/xtensa_sim.c
    M hw/z2.c
    M hw/zynq_slcr.c
    R hwaddr.h
    R i386-dis.c
    R i386.ld
    R ia64-dis.c
    R ia64.ld
    A include/block/aes.h
    A include/block/aio.h
    A include/block/block.h
    A include/block/block_int.h
    A include/block/blockjob.h
    A include/block/coroutine.h
    A include/block/coroutine_int.h
    A include/block/nbd.h
    A include/block/thread-pool.h
    A include/bt/bt.h
    A include/char/char.h
    A include/config.h
    A include/disas/bfd.h
    A include/disas/disas.h
    A include/elf.h
    A include/exec/address-spaces.h
    A include/exec/cpu-all.h
    A include/exec/cpu-common.h
    A include/exec/cpu-defs.h
    A include/exec/cputlb.h
    A include/exec/def-helper.h
    A include/exec/exec-all.h
    A include/exec/gdbstub.h
    A include/exec/gen-icount.h
    A include/exec/hwaddr.h
    A include/exec/ioport.h
    A include/exec/iorange.h
    A include/exec/memory-internal.h
    A include/exec/memory.h
    A include/exec/poison.h
    A include/exec/softmmu-semi.h
    A include/exec/softmmu_defs.h
    A include/exec/softmmu_exec.h
    A include/exec/softmmu_header.h
    A include/exec/softmmu_template.h
    A include/exec/spinlock.h
    A include/exec/user/abitypes.h
    A include/exec/user/thunk.h
    A include/fpu/softfloat.h
    A include/libfdt_env.h
    A include/migration/block.h
    A include/migration/migration.h
    A include/migration/page_cache.h
    A include/migration/qemu-file.h
    A include/migration/vmstate.h
    A include/monitor/monitor.h
    A include/monitor/readline.h
    A include/net/checksum.h
    A include/net/net.h
    A include/net/queue.h
    A include/net/slirp.h
    A include/net/tap.h
    A include/qapi/dealloc-visitor.h
    A include/qapi/error.h
    A include/qapi/opts-visitor.h
    A include/qapi/qmp-input-visitor.h
    A include/qapi/qmp-output-visitor.h
    A include/qapi/qmp/dispatch.h
    A include/qapi/qmp/json-lexer.h
    A include/qapi/qmp/json-parser.h
    A include/qapi/qmp/json-streamer.h
    A include/qapi/qmp/qbool.h
    A include/qapi/qmp/qdict.h
    A include/qapi/qmp/qerror.h
    A include/qapi/qmp/qfloat.h
    A include/qapi/qmp/qint.h
    A include/qapi/qmp/qjson.h
    A include/qapi/qmp/qlist.h
    A include/qapi/qmp/qobject.h
    A include/qapi/qmp/qstring.h
    A include/qapi/qmp/types.h
    A include/qapi/string-input-visitor.h
    A include/qapi/string-output-visitor.h
    A include/qapi/visitor-impl.h
    A include/qapi/visitor.h
    A include/qemu-common.h
    A include/qemu/acl.h
    A include/qemu/atomic.h
    A include/qemu/bitmap.h
    A include/qemu/bitops.h
    A include/qemu/bswap.h
    A include/qemu/cache-utils.h
    A include/qemu/compatfd.h
    A include/qemu/compiler.h
    A include/qemu/config-file.h
    R include/qemu/cpu.h
    A include/qemu/envlist.h
    A include/qemu/error-report.h
    A include/qemu/event_notifier.h
    A include/qemu/host-utils.h
    A include/qemu/int128.h
    A include/qemu/iov.h
    A include/qemu/log.h
    A include/qemu/main-loop.h
    A include/qemu/module.h
    A include/qemu/notify.h
    R include/qemu/object.h
    A include/qemu/option.h
    A include/qemu/option_int.h
    A include/qemu/osdep.h
    R include/qemu/page_cache.h
    R include/qemu/qom-qobject.h
    A include/qemu/queue.h
    A include/qemu/range.h
    M include/qemu/rng-random.h
    M include/qemu/rng.h
    A include/qemu/sockets.h
    A include/qemu/thread-posix.h
    A include/qemu/thread-win32.h
    A include/qemu/thread.h
    A include/qemu/timer.h
    A include/qemu/tls.h
    A include/qemu/typedefs.h
    A include/qemu/uri.h
    A include/qemu/xattr.h
    A include/qom/cpu.h
    A include/qom/object.h
    A include/qom/qom-qobject.h
    A include/sysemu/arch_init.h
    A include/sysemu/balloon.h
    A include/sysemu/blockdev.h
    A include/sysemu/cpus.h
    A include/sysemu/device_tree.h
    A include/sysemu/dma.h
    A include/sysemu/dump.h
    A include/sysemu/kvm.h
    A include/sysemu/memory_mapping.h
    A include/sysemu/os-posix.h
    A include/sysemu/os-win32.h
    A include/sysemu/qtest.h
    A include/sysemu/seccomp.h
    A include/sysemu/sysemu.h
    A include/sysemu/xen-mapcache.h
    A include/ui/console.h
    A include/ui/pixel_ops.h
    A include/ui/qemu-pixman.h
    A include/ui/qemu-spice.h
    A include/ui/spice-display.h
    R input.c
    R int128.h
    M iohandler.c
    M ioport.c
    R ioport.h
    R iorange.h
    M iov.c
    R iov.h
    M json-lexer.c
    R json-lexer.h
    M json-parser.c
    R json-parser.h
    M json-streamer.c
    R json-streamer.h
    M kvm-all.c
    M kvm-stub.c
    R kvm.h
    A ldscripts/alpha.ld
    A ldscripts/arm.ld
    A ldscripts/hppa.ld
    A ldscripts/i386.ld
    A ldscripts/ia64.ld
    A ldscripts/m68k.ld
    A ldscripts/mips.ld
    A ldscripts/ppc.ld
    A ldscripts/ppc64.ld
    A ldscripts/s390.ld
    A ldscripts/sparc.ld
    A ldscripts/sparc64.ld
    A ldscripts/x86_64.ld
    M libcacard/event.c
    M libcacard/vreader.c
    M libcacard/vscclient.c
    R libfdt_env.h
    M linux-user/arm/nwfpe/double_cpdo.c
    M linux-user/arm/nwfpe/extended_cpdo.c
    M linux-user/arm/nwfpe/fpa11.h
    M linux-user/arm/nwfpe/fpa11_cpdt.c
    M linux-user/arm/nwfpe/fpa11_cprt.c
    M linux-user/arm/nwfpe/fpopcode.c
    M linux-user/arm/nwfpe/single_cpdo.c
    M linux-user/cris/syscall.h
    M linux-user/elfload.c
    M linux-user/main.c
    M linux-user/microblaze/syscall.h
    M linux-user/qemu.h
    M linux-user/syscall.c
    M linux-user/syscall_defs.h
    R lm32-dis.c
    R m68k-dis.c
    R m68k.ld
    M main-loop.c
    R main-loop.h
    R memory-internal.h
    M memory.c
    R memory.h
    M memory_mapping-stub.c
    M memory_mapping.c
    R memory_mapping.h
    R microblaze-dis.c
    M migration-exec.c
    M migration-fd.c
    M migration-tcp.c
    M migration-unix.c
    M migration.c
    R migration.h
    R mips-dis.c
    R mips.ld
    M module.c
    R module.h
    M monitor.c
    R monitor.h
    M nbd.c
    R nbd.h
    R net.c
    R net.h
    M net/Makefile.objs
    R net/checksum.h
    M net/clients.h
    M net/dump.c
    M net/hub.c
    M net/hub.h
    A net/net.c
    M net/queue.c
    R net/queue.h
    M net/slirp.c
    R net/slirp.h
    M net/socket.c
    M net/tap-aix.c
    M net/tap-bsd.c
    M net/tap-haiku.c
    M net/tap-linux.c
    M net/tap-linux.h
    M net/tap-solaris.c
    M net/tap-win32.c
    M net/tap.c
    R net/tap.h
    A net/tap_int.h
    M net/util.c
    M net/vde.c
    M notify.c
    R notify.h
    M os-posix.c
    M os-win32.c
    M osdep.c
    R osdep.h
    M oslib-posix.c
    M oslib-win32.c
    M page_cache.c
    M pixman
    R poison.h
    R ppc-dis.c
    R ppc.ld
    R ppc64.ld
    R qapi-schema-guest.json
    M qapi/opts-visitor.c
    R qapi/opts-visitor.h
    M qapi/qapi-dealloc-visitor.c
    R qapi/qapi-dealloc-visitor.h
    R qapi/qapi-types-core.h
    M qapi/qapi-visit-core.c
    R qapi/qapi-visit-core.h
    R qapi/qapi-visit-impl.h
    R qapi/qmp-core.h
    M qapi/qmp-dispatch.c
    M qapi/qmp-input-visitor.c
    R qapi/qmp-input-visitor.h
    M qapi/qmp-output-visitor.c
    R qapi/qmp-output-visitor.h
    M qapi/qmp-registry.c
    M qapi/string-input-visitor.c
    R qapi/string-input-visitor.h
    M qapi/string-output-visitor.c
    R qapi/string-output-visitor.h
    M qbool.c
    R qbool.h
    M qdict.c
    R qdict.h
    R qemu-aio.h
    R qemu-barrier.h
    M qemu-bridge-helper.c
    M qemu-char.c
    R qemu-char.h
    R qemu-common.h
    M qemu-config.c
    R qemu-config.h
    R qemu-coroutine-int.h
    M qemu-coroutine-io.c
    M qemu-coroutine-lock.c
    M qemu-coroutine-sleep.c
    M qemu-coroutine.c
    R qemu-coroutine.h
    M qemu-error.c
    R qemu-error.h
    R qemu-file.h
    R qemu-ga.c
    M qemu-img.c
    M qemu-io.c
    R qemu-lock.h
    M qemu-log.c
    R qemu-log.h
    M qemu-nbd.c
    R qemu-objects.h
    R qemu-option-internal.h
    M qemu-option.c
    R qemu-option.h
    R qemu-os-posix.h
    R qemu-os-win32.h
    R qemu-pixman.c
    R qemu-pixman.h
    M qemu-progress.c
    R qemu-queue.h
    M qemu-seccomp.c
    R qemu-seccomp.h
    M qemu-sockets.c
    M qemu-thread-posix.c
    R qemu-thread-posix.h
    M qemu-thread-win32.c
    R qemu-thread-win32.h
    R qemu-thread.h
    M qemu-timer-common.c
    M qemu-timer.c
    R qemu-timer.h
    R qemu-tls.h
    M qemu-tool.c
    R qemu-types.h
    R qemu-user-types.h
    M qemu-user.c
    R qemu-x509.h
    R qemu-xattr.h
    R qemu_socket.h
    M qerror.c
    R qerror.h
    M qfloat.c
    R qfloat.h
    M qga/Makefile.objs
    M qga/channel-posix.c
    M qga/commands-posix.c
    M qga/commands-win32.c
    M qga/commands.c
    M qga/guest-agent-core.h
    A qga/main.c
    A qga/qapi-schema.json
    M qint.c
    R qint.h
    M qjson.c
    R qjson.h
    M qlist.c
    R qlist.h
    M qmp.c
    R qobject.h
    M qom/container.c
    M qom/cpu.c
    M qom/object.c
    M qom/qom-qobject.c
    M qstring.c
    R qstring.h
    M qtest.c
    R qtest.h
    R range.h
    M readline.c
    R readline.h
    M rules.mak
    R s390-dis.c
    R s390.ld
    M savevm.c
    M scripts/feature_to_c.sh
    M scripts/get_maintainer.pl
    M scripts/qapi-commands.py
    M scripts/qapi-types.py
    M scripts/qapi-visit.py
    R sh4-dis.c
    M slirp/bootp.h
    M slirp/if.c
    M slirp/ip_input.c
    M slirp/main.h
    M slirp/misc.c
    M slirp/sbuf.c
    M slirp/slirp.c
    M slirp/slirp.h
    M slirp/tftp.h
    R softmmu-semi.h
    R softmmu_defs.h
    R softmmu_exec.h
    R softmmu_header.h
    R softmmu_template.h
    R sparc-dis.c
    R sparc.ld
    R sparc64.ld
    M spice-qemu-char.c
    M stubs/arch-query-cpu-def.c
    M stubs/fd-register.c
    M stubs/fdset-add-fd.c
    M stubs/fdset-find-fd.c
    M stubs/fdset-get-fd.c
    M stubs/fdset-remove-fd.c
    M stubs/get-fd.c
    M stubs/set-fd-handler.c
    R sysemu.h
    M target-alpha/cpu-qom.h
    M target-alpha/cpu.c
    M target-alpha/cpu.h
    M target-alpha/fpu_helper.c
    M target-alpha/helper.c
    M target-alpha/helper.h
    M target-alpha/int_helper.c
    M target-alpha/mem_helper.c
    M target-alpha/sys_helper.c
    M target-alpha/translate.c
    M target-arm/arm-semi.c
    M target-arm/cpu-qom.h
    M target-arm/cpu.c
    M target-arm/cpu.h
    M target-arm/helper.c
    M target-arm/helper.h
    M target-arm/iwmmxt_helper.c
    M target-arm/neon_helper.c
    M target-arm/op_helper.c
    M target-arm/translate.c
    M target-cris/cpu-qom.h
    M target-cris/cpu.h
    M target-cris/crisv32-decode.h
    M target-cris/helper.c
    M target-cris/helper.h
    M target-cris/op_helper.c
    M target-cris/translate.c
    M target-i386/arch_dump.c
    M target-i386/arch_memory_mapping.c
    M target-i386/cpu-qom.h
    M target-i386/cpu.c
    M target-i386/cpu.h
    M target-i386/excp_helper.c
    M target-i386/fpu_helper.c
    M target-i386/helper.c
    M target-i386/helper.h
    M target-i386/int_helper.c
    M target-i386/ioport-user.c
    M target-i386/kvm.c
    M target-i386/kvm_i386.h
    M target-i386/machine.c
    M target-i386/mem_helper.c
    M target-i386/misc_helper.c
    M target-i386/seg_helper.c
    M target-i386/svm_helper.c
    M target-i386/translate.c
    M target-lm32/cpu-qom.h
    M target-lm32/cpu.h
    M target-lm32/helper.c
    M target-lm32/helper.h
    M target-lm32/op_helper.c
    M target-lm32/translate.c
    M target-m68k/cpu-qom.h
    M target-m68k/cpu.h
    M target-m68k/helper.c
    M target-m68k/helpers.h
    M target-m68k/m68k-semi.c
    M target-m68k/op_helper.c
    M target-m68k/translate.c
    M target-microblaze/cpu-qom.h
    M target-microblaze/cpu.h
    M target-microblaze/helper.c
    M target-microblaze/helper.h
    M target-microblaze/op_helper.c
    M target-microblaze/translate.c
    M target-mips/cpu-qom.h
    M target-mips/cpu.h
    M target-mips/helper.h
    M target-mips/op_helper.c
    M target-mips/translate.c
    M target-openrisc/cpu.h
    M target-openrisc/helper.h
    M target-openrisc/int_helper.c
    M target-openrisc/interrupt.c
    M target-openrisc/mmu.c
    M target-openrisc/mmu_helper.c
    M target-openrisc/translate.c
    M target-ppc/cpu-qom.h
    M target-ppc/cpu.h
    M target-ppc/helper.c
    M target-ppc/helper.h
    M target-ppc/int_helper.c
    M target-ppc/kvm.c
    M target-ppc/kvm_ppc.c
    M target-ppc/kvm_ppc.h
    M target-ppc/machine.c
    M target-ppc/mem_helper.c
    M target-ppc/mmu_helper.c
    M target-ppc/translate.c
    M target-ppc/translate_init.c
    M target-s390x/cpu-qom.h
    M target-s390x/cpu.c
    M target-s390x/cpu.h
    M target-s390x/fpu_helper.c
    M target-s390x/helper.c
    M target-s390x/helper.h
    M target-s390x/int_helper.c
    M target-s390x/interrupt.c
    M target-s390x/kvm.c
    M target-s390x/mem_helper.c
    M target-s390x/misc_helper.c
    M target-s390x/translate.c
    M target-sh4/cpu-qom.h
    M target-sh4/cpu.h
    M target-sh4/helper.h
    M target-sh4/op_helper.c
    M target-sh4/translate.c
    M target-sparc/cpu-qom.h
    M target-sparc/cpu.h
    M target-sparc/helper.c
    M target-sparc/helper.h
    M target-sparc/int32_helper.c
    M target-sparc/ldst_helper.c
    M target-sparc/machine.c
    M target-sparc/mmu_helper.c
    M target-sparc/translate.c
    M target-unicore32/cpu-qom.h
    M target-unicore32/cpu.h
    M target-unicore32/helper.c
    M target-unicore32/helper.h
    M target-unicore32/op_helper.c
    M target-unicore32/translate.c
    M target-xtensa/core-dc232b.c
    M target-xtensa/core-dc233c.c
    M target-xtensa/core-fsf.c
    M target-xtensa/cpu-qom.h
    M target-xtensa/cpu.h
    M target-xtensa/helper.c
    M target-xtensa/helper.h
    M target-xtensa/op_helper.c
    M target-xtensa/translate.c
    M target-xtensa/xtensa-semi.c
    M tcg/arm/tcg-target.c
    M tcg/arm/tcg-target.h
    M tcg/hppa/tcg-target.c
    M tcg/hppa/tcg-target.h
    M tcg/i386/tcg-target.c
    M tcg/i386/tcg-target.h
    M tcg/ia64/tcg-target.c
    M tcg/ia64/tcg-target.h
    M tcg/mips/tcg-target.c
    M tcg/mips/tcg-target.h
    M tcg/ppc/tcg-target.c
    M tcg/ppc/tcg-target.h
    M tcg/ppc64/tcg-target.c
    M tcg/ppc64/tcg-target.h
    M tcg/s390/tcg-target.c
    M tcg/s390/tcg-target.h
    M tcg/sparc/tcg-target.c
    M tcg/sparc/tcg-target.h
    M tcg/tcg.c
    R tci-dis.c
    M tci.c
    M tests/check-qdict.c
    M tests/check-qfloat.c
    M tests/check-qint.c
    M tests/check-qjson.c
    M tests/check-qlist.c
    M tests/check-qstring.c
    M tests/libqtest.c
    M tests/tcg/cris/crisutils.h
    M tests/tcg/test-i386-fprem.c
    M tests/tcg/test-i386.c
    M tests/test-aio.c
    M tests/test-coroutine.c
    M tests/test-iov.c
    M tests/test-qmp-commands.c
    M tests/test-qmp-input-strict.c
    M tests/test-qmp-input-visitor.c
    M tests/test-qmp-output-visitor.c
    M tests/test-string-input-visitor.c
    M tests/test-string-output-visitor.c
    M tests/test-thread-pool.c
    M tests/test-visitor-serialization.c
    M thread-pool.c
    R thread-pool.h
    M thunk.c
    R thunk.h
    M trace/simple.c
    M translate-all.c
    R uboot_image.h
    M ui/Makefile.objs
    M ui/cocoa.m
    A ui/console.c
    M ui/curses.c
    M ui/curses_keys.h
    A ui/cursor.c
    A ui/cursor_hidden.xpm
    A ui/cursor_left_ptr.xpm
    M ui/d3des.h
    A ui/input.c
    M ui/keymaps.c
    A ui/qemu-pixman.c
    R ui/qemu-spice.h
    A ui/qemu-x509.h
    M ui/sdl.c
    M ui/sdl_zoom.c
    M ui/spice-core.c
    M ui/spice-display.c
    R ui/spice-display.h
    M ui/spice-input.c
    A ui/vgafont.h
    M ui/vnc-auth-sasl.h
    M ui/vnc-enc-tight.c
    M ui/vnc-jobs.c
    M ui/vnc-palette.h
    M ui/vnc-tls.c
    M ui/vnc-tls.h
    M ui/vnc.c
    M ui/vnc.h
    M uri.c
    R uri.h
    M user-exec.c
    R vgafont.h
    M vl.c
    R vmstate.h
    R x86_64.ld
    M xen-all.c
    M xen-mapcache.c
    R xen-mapcache.h
    M xen-stub.c

  Log Message:
  -----------
  Merge branch 'master' of git://git.qemu.org/qemu into qom-cpu

Adapt header include paths.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;


  Commit: 4de63460ca1639bfb0e465ecdcf95551564bb3d6
      https://github.com/qemu/qemu/commit/4de63460ca1639bfb0e465ecdcf9555=
1564bb3d6
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-12-28 (Fri, 28 Dec 2012)

  Changed paths:
    M MAINTAINERS
    M hw/Makefile.objs
    M hw/alpha_dp264.c
    M hw/alpha_sys.h
    M hw/alpha_typhoon.c
    M hw/kvm/apic.c
    M hw/kvm/clock.c
    M hw/ppc.c
    M hw/ppc.h
    M hw/ppc/e500.c
    M hw/ppc405_uc.c
    M hw/ppc440_bamboo.c
    M hw/ppc4xx.h
    M hw/ppc4xx_devs.c
    M hw/ppc_booke.c
    A hw/qdev-properties-system.c
    M hw/qdev-properties.c
    M hw/qdev-properties.h
    M hw/qdev.c
    M hw/s390-virtio-bus.c
    M hw/spapr.c
    M hw/virtex_ml507.c
    M include/exec/cpu-common.h
    M include/exec/cpu-defs.h
    M include/qom/cpu.h
    M include/sysemu/kvm.h
    M kvm-all.c
    M target-alpha/cpu-qom.h
    M target-alpha/cpu.c
    M target-alpha/cpu.h
    M target-alpha/sys_helper.c
    M target-alpha/translate.c
    M target-arm/helper.c
    M target-i386/cpu.c
    M target-i386/kvm.c
    M target-m68k/helper.c
    M target-ppc/kvm.c
    M target-ppc/kvm_ppc.h
    M target-s390x/cpu.h
    M target-s390x/interrupt.c
    M target-s390x/kvm.c
    M target-s390x/misc_helper.c

  Log Message:
  -----------
  Merge branch 'qom-cpu' of git://repo.or.cz/qemu/afaerber

* 'qom-cpu' of git://repo.or.cz/qemu/afaerber:
  MAINTAINERS: Include X86CPU in CPU maintenance area
  cpu: Move kvm_run into CPUState
  cpu: Move kvm_state field into CPUState
  ppc_booke: Pass PowerPCCPU to ppc_booke_timers_init()
  ppc4xx_devs: Return PowerPCCPU from ppc4xx_init()
  ppc_booke: Pass PowerPCCPU to {decr,fit,wdt} timer callbacks
  ppc: Pass PowerPCCPU to [h]decr timer callbacks
  ppc: Pass PowerPCCPU to [h]decr callbacks
  ppc: Pass PowerPCCPU to ppc_set_irq()
  kvm: Pass CPUState to kvm_vcpu_ioctl()
  kvm: Pass CPUState to kvm_arch_*
  cpu: Move kvm_fd into CPUState
  qdev-properties.c: Separate core from the code used only by qemu-system=
-*
  qdev: Coding style fixes
  cpu: Introduce CPUListState struct
  target-alpha: Add support for -cpu ?
  target-alpha: Turn CPU definitions into subclasses
  target-alpha: Avoid leaking the alarm timer over reset
  alpha: Pass AlphaCPU array to Typhoon
  target-alpha: Let cpu_alpha_init() return AlphaCPU


  Commit: 62054c06d4d1d0d54ef87c2d9154efec00ad170c
      https://github.com/qemu/qemu/commit/62054c06d4d1d0d54ef87c2d9154efe=
c00ad170c
  Author: Alon Levy &lt;alevy@redhat.com&gt;
  Date:   2012-12-28 (Fri, 28 Dec 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb/redirect.c: unbreak compilation due to include/char/char.h

Broken since:

commit 927d4878b0ff319ed87fed9363f314613b0a5ed9
Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Date:   Mon Dec 17 18:20:05 2012 +0100

    softmmu: move remaining include files to include/ subdirectories

Signed-off-by: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 927fa909d5d5cf8c07673cd16a6d3bdc81250bc0
      https://github.com/qemu/qemu/commit/927fa909d5d5cf8c07673cd16a6d3bd=
c81250bc0
  Author: Brad Smith &lt;brad@comstyle.com&gt;
  Date:   2012-12-28 (Fri, 28 Dec 2012)

  Changed paths:
    M include/qemu/thread-posix.h
    M qemu-thread-posix.c

  Log Message:
  -----------
  Disable semaphores fallback code for OpenBSD

Disable the semaphores fallback code for OpenBSD as modern OpenBSD
releases now have sem_timedwait().

Signed-off-by: Brad Smith &lt;brad@comstyle.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/a2685bcc80f6...927fa909d5d5=


----==_mimepart_50de015540c90_100010b6ae8580b3--


</body></email><email><emailId>20121229160010</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-12-29 16:00:10-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] afcb92: tcg: Add TCGV_IS_UNUSED_*</subject><body>



----==_mimepart_50df1389f2e39_40c51764ae8167711
Date: Sat, 29 Dec 2012 08:00:10 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50df1389f41d3_40c51764ae81678d5@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: afcb92beac9e477e5ae5c36bf38830e225e2235f
      https://github.com/qemu/qemu/commit/afcb92beac9e477e5ae5c36bf38830e=
225e2235f
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-12-29 (Sat, 29 Dec 2012)

  Changed paths:
    M tcg/tcg-op.h
    M tcg/tcg.h

  Log Message:
  -----------
  tcg: Add TCGV_IS_UNUSED_*

Cc: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Reviewed-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 76a347e1cd0c2d6959461c89dda15ef5c4140da6
      https://github.com/qemu/qemu/commit/76a347e1cd0c2d6959461c89dda15ef=
5c4140da6
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-12-29 (Sat, 29 Dec 2012)

  Changed paths:
    M configure
    M tcg/i386/tcg-target.c
    M tcg/i386/tcg-target.h

  Log Message:
  -----------
  tcg-i386: Perform cmov detection at runtime for 32-bit.

Existing compile-time detection is spotty at best.  Convert
it all to runtime detection instead.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 753d99d38b5877440dde2705e30ca60e2ec62965
      https://github.com/qemu/qemu/commit/753d99d38b5877440dde2705e30ca60=
e2ec62965
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-12-29 (Sat, 29 Dec 2012)

  Changed paths:
    M tcg/hppa/tcg-target.c

  Log Message:
  -----------
  tcg-hppa: Fix typo in brcond2

Reported-by: Stuart Brady &lt;sdb@zubnet.me.uk&gt;
Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: a795ef8dcb8cbadffc996c41ff38927a97645234
      https://github.com/qemu/qemu/commit/a795ef8dcb8cbadffc996c41ff38927=
a97645234
  Author: Brad Smith &lt;brad@comstyle.com&gt;
  Date:   2012-12-29 (Sat, 29 Dec 2012)

  Changed paths:
    M qemu-thread-posix.c

  Log Message:
  -----------
  Fix semaphores fallback code

As reported in bug 1087114 the semaphores fallback code is broken which
results in QEMU crashing and making QEMU unusable.

This patch is from Paolo.

This needs to be back ported to the 1.3 stable tree as well.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Brad Smith &lt;brad@comstyle.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/927fa909d5d5...a795ef8dcb8c=


----==_mimepart_50df1389f2e39_40c51764ae8167711--


</body></email><email><emailId>20121109110008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-09 11:00:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] b8c6a5: microblaze: translate.c: Fix swaph decoding</subject><body>



----==_mimepart_509ce2388aaf3_fb01333af0155799
Date: Fri, 09 Nov 2012 03:00:08 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;509ce2388be49_fb01333af01558a3@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: b8c6a5d9d0ab426c1626cd6c228b09b9529dba31
      https://github.com/qemu/qemu/commit/b8c6a5d9d0ab426c1626cd6c228b09b9529dba31
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-11-08 (Thu, 08 Nov 2012)

  Changed paths:
    M target-microblaze/translate.c

  Log Message:
  -----------
  microblaze: translate.c: Fix swaph decoding

The swaph instruction was not decoding correctly. s/1e1/1e2 on the
9 LSBs on the instruction decode.

Reported-by: David Holsgrove &lt;david.holsgrove@xilinx.com&gt;
Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Signed-off-by: Edgar E. Iglesias &lt;edgar.iglesias@gmail.com&gt;




----==_mimepart_509ce2388aaf3_fb01333af0155799--


</body></email><email><emailId>20121110193010</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-10 19:30:10-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 5c61af: kvmvapic: Fix TB invalidation after instruction pa...</subject><body>



----==_mimepart_509eab42e6138_311e1733aec153374
Date: Sat, 10 Nov 2012 11:30:10 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;509eab42e73c1_311e1733aec15341b@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 5c61afec86e5b2597b19b4657edc404fd76e6eb9
      https://github.com/qemu/qemu/commit/5c61afec86e5b2597b19b4657edc404fd76e6eb9
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-11-10 (Sat, 10 Nov 2012)

  Changed paths:
    M hw/kvmvapic.c

  Log Message:
  -----------
  kvmvapic: Fix TB invalidation after instruction patching

Since 0b57e287, cpu_memory_rw_debug already triggers a TB invalidation.
As it doesn't (and cannot) set is_cpu_write_access=1 but "consumes" the
currently executed TB, the tb_invalidate_phys_page_range call from
patch_instruction didn't work anymore.

Fix this by open-coding the required bits to restore the CPU state from
the current TB position before patching and resume execution on the
patched instruction afterward.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Tested-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 1f202568e0553b416483e5993f1bde219c22cf72
      https://github.com/qemu/qemu/commit/1f202568e0553b416483e5993f1bde219c22cf72
  Author: BALATON Zoltan &lt;balaton@eik.bme.hu&gt;
  Date:   2012-11-10 (Sat, 10 Nov 2012)

  Changed paths:
    M hw/vmware_vga.c

  Log Message:
  -----------
  vmware_vga: Add back some info in local state partially reverting aa32b38c

Keep saving display surface parameters at init and using these cached
values instead of getting them when needed. Not sure why this is
needed (maybe due to the interaction with the vga device) but not
doing this broke the Xorg vmware driver at least.

Signed-off-by: BALATON Zoltan &lt;balaton@eik.bme.hu&gt;
Tested-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 253ecf83bcc658316bab3250401943d9b44c7898
      https://github.com/qemu/qemu/commit/253ecf83bcc658316bab3250401943d9b44c7898
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-11-10 (Sat, 10 Nov 2012)

  Changed paths:
    M qemu-timer.c

  Log Message:
  -----------
  qemu-timer: Fix compilation for non-POSIX hosts

A compiler warning is caused by the unused local function reinit_timers
on non-POSIX hosts. Include that function only for POSIX hosts.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 22bde7145495ad78c4bed8bb76d9401ec8d107b2
      https://github.com/qemu/qemu/commit/22bde7145495ad78c4bed8bb76d9401ec8d107b2
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-11-10 (Sat, 10 Nov 2012)

  Changed paths:
    M memory.c

  Log Message:
  -----------
  memory: Reintroduce dirty flag to optimize changes on disabled regions

Cirrus is triggering this, e.g. during Win2k boot: Changes only on
disabled regions require no topology update when transaction depth drops
to 0 again.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 7ea692b24055022248b895f2203a6ab1ad54859b
      https://github.com/qemu/qemu/commit/7ea692b24055022248b895f2203a6ab1ad54859b
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-11-10 (Sat, 10 Nov 2012)

  Changed paths:
    M memory.c

  Log Message:
  -----------
  memory: Don't dump disabled regions

This makes "info mtree" output readable again.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: a9523d14c47fbdecb319211afac00caa62d998a8
      https://github.com/qemu/qemu/commit/a9523d14c47fbdecb319211afac00caa62d998a8
  Author: Catalin Patulea &lt;catalinp@google.com&gt;
  Date:   2012-11-10 (Sat, 10 Nov 2012)

  Changed paths:
    M tests/tcg/Makefile
    A tests/tcg/test-i386-fprem.c

  Log Message:
  -----------
  tests/tcg: new test for i386 FPREM and FPREM1

This is setting the stage for a cleanup of FPREM and FPREM1 helpers while being
sure that they behave same as bare metal.

The test constructs operands using combinations of corner cases for the
floating-point bitfields and prints operands, result and FPU status word for
FPREM and FPREM1. The outputs can then be compared between bare metal and QEMU.
The 'run-test-i386-fprem' make target does just that.

Signed-off-by: Catalin Patulea &lt;catalinp@google.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 4d4d9b3adb0e36e75cf9b2126ee1d01b1d59f8a1
      https://github.com/qemu/qemu/commit/4d4d9b3adb0e36e75cf9b2126ee1d01b1d59f8a1
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-11-10 (Sat, 10 Nov 2012)

  Changed paths:
    M hw/m48t59.c
    M hw/nvram.h

  Log Message:
  -----------
  m48t59: remove unused m48t59_set_addr

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: e62774c41006bc8072579515b9f6782b56c33bd1
      https://github.com/qemu/qemu/commit/e62774c41006bc8072579515b9f6782b56c33bd1
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-11-10 (Sat, 10 Nov 2012)

  Changed paths:
    M hw/sun4c_intctl.c
    M hw/sun4m.h

  Log Message:
  -----------
  sun4c: remove unused functions

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 036208c9ab50b0910c24b28a440c15e66e8a2652
      https://github.com/qemu/qemu/commit/036208c9ab50b0910c24b28a440c15e66e8a2652
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-11-10 (Sat, 10 Nov 2012)

  Changed paths:
    M slirp/misc.c
    M slirp/misc.h

  Log Message:
  -----------
  slirp: remove unused function u_sleep

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: f4359b9ffe895fda6d1ec3dd441cb8a208fb4dce
      https://github.com/qemu/qemu/commit/f4359b9ffe895fda6d1ec3dd441cb8a208fb4dce
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-11-10 (Sat, 10 Nov 2012)

  Changed paths:
    M disas.c
    M disas.h
    M qemu-log.h
    M target-alpha/translate.c
    M target-arm/translate.c
    M target-cris/translate.c
    M target-i386/translate.c
    M target-lm32/translate.c
    M target-m68k/translate.c
    M target-microblaze/translate.c
    M target-mips/translate.c
    M target-openrisc/translate.c
    M target-ppc/translate.c
    M target-s390x/translate.c
    M target-sh4/translate.c
    M target-sparc/translate.c
    M target-unicore32/translate.c

  Log Message:
  -----------
  disas: avoid using cpu_single_env

Pass around CPUArchState instead of using global cpu_single_env.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Acked-by: Richard Henderson &lt;rth@twiddle.net&gt;
Acked-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Acked-by: Guan Xuetao &lt;gxt@mprc.pku.edu.cn&gt;


  Commit: 4840552601caf1779b3de34bc8ea3fc128a52d04
      https://github.com/qemu/qemu/commit/4840552601caf1779b3de34bc8ea3fc128a52d04
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-11-10 (Sat, 10 Nov 2012)

  Changed paths:
    M target-i386/kvm.c

  Log Message:
  -----------
  kvm: avoid using cpu_single_env

Pass around CPUArchState instead of using global cpu_single_env.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 447b3b60d15e1db6967a19e40284d33136a7c9e7
      https://github.com/qemu/qemu/commit/447b3b60d15e1db6967a19e40284d33136a7c9e7
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-11-10 (Sat, 10 Nov 2012)

  Changed paths:
    M target-unicore32/softmmu.c

  Log Message:
  -----------
  target-unicore32: avoid using cpu_single_env

Pass around CPUArchState instead of using global cpu_single_env.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Acked-by: Guan Xuetao &lt;gxt@mprc.pku.edu.cn&gt;
Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 0c4fabea809008702645e6b2c64926892b47f76d
      https://github.com/qemu/qemu/commit/0c4fabea809008702645e6b2c64926892b47f76d
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-11-10 (Sat, 10 Nov 2012)

  Changed paths:
    M target-xtensa/translate.c

  Log Message:
  -----------
  target-xtensa: avoid using cpu_single_env

Pass around CPUArchState instead of using global cpu_single_env.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Acked-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 0af10c86ed6656da0c9b680ec9d1c65768dd99b2
      https://github.com/qemu/qemu/commit/0af10c86ed6656da0c9b680ec9d1c65768dd99b2
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-11-10 (Sat, 10 Nov 2012)

  Changed paths:
    M target-i386/translate.c

  Log Message:
  -----------
  target-i386: avoid using cpu_single_env

Pass around CPUArchState instead of using global cpu_single_env.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


Compare: https://github.com/qemu/qemu/compare/b8c6a5d9d0ab...0af10c86ed66

----==_mimepart_509eab42e6138_311e1733aec153374--


</body></email><email><emailId>20121111163009</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-11 16:30:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 7c2c3e: target-mips: Fix seg fault for LUI when MIPS_DEBUG...</subject><body>



----==_mimepart_509fd291442a2_79f613f2af41069ac
Date: Sun, 11 Nov 2012 08:30:09 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;509fd291457f4_79f613f2af41070b1@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 7c2c3ea3fd9e108a1c174a5db021ac1d33b1a22d
      https://github.com/qemu/qemu/commit/7c2c3ea3fd9e108a1c174a5db021ac1d33b1a22d
  Author: Eric Johnson &lt;ericj@mips.com&gt;
  Date:   2012-11-11 (Sun, 11 Nov 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Fix seg fault for LUI when MIPS_DEBUG_DISAS==1.

The call to gen_logic_imm for OPC_LUI passes -1 for rs.  This
causes the MIPS_DEBUG statement to seg fault due to the deference
of regnames[rs].  This patch fixes that.

Signed-off-by: Eric Johnson &lt;ericj@mips.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(aurel32: replaced static string formating by a static string)


  Commit: 3c5645fab3c4b65d0cffbe1aaafc787e4be63d0f
      https://github.com/qemu/qemu/commit/3c5645fab3c4b65d0cffbe1aaafc787e4be63d0f
  Author: Kirill Batuzov &lt;batuzovk@ispras.ru&gt;
  Date:   2012-11-11 (Sun, 11 Nov 2012)

  Changed paths:
    M tcg/tcg.c

  Log Message:
  -----------
  tcg: properly check that op's output needs to be synced to memory

Fix typo introduced in b3a1be87bac3a6aaa59bb88c1410f170dc9b22d5.

Reported-by: Ruslan Savchenko &lt;ruslan.savchenko@gmail.com&gt;
Signed-off-by: Kirill Batuzov &lt;batuzovk@ispras.ru&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


Compare: https://github.com/qemu/qemu/compare/0af10c86ed66...3c5645fab3c4

----==_mimepart_509fd291442a2_79f613f2af41069ac--


</body></email><email><emailId>20121112163008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-12 16:30:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] f5022a: aio: fix aio_ctx_prepare with idle bottom halves</subject><body>



----==_mimepart_50a12410dd98b_4d40fd1aec408e9
Date: Mon, 12 Nov 2012 08:30:08 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50a12410dec62_4d40fd1aec40979@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: f5022a135e4309a54d433c69b2a056756b2d0d6b
      https://github.com/qemu/qemu/commit/f5022a135e4309a54d433c69b2a056756b2d0d6b
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-12 (Mon, 12 Nov 2012)

  Changed paths:
    M async.c

  Log Message:
  -----------
  aio: fix aio_ctx_prepare with idle bottom halves

Commit ed2aec4867f0d5f5de496bb765347b5d0cfe113d changed the return
value of aio_ctx_prepare from false to true when only idle bottom
halves are available.  This broke PC old-style DMA, which uses them.
Fix this by making aio_ctx_prepare return true only when non-idle
bottom halves are scheduled to run.

Reported-by: malc &lt;av1474@comtv.ru&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;




----==_mimepart_50a12410dd98b_4d40fd1aec408e9--


</body></email><email><emailId>20121114163017</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-14 16:30:17-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 48f4ba: hw/qxl: guest bug on primary create with stride %4...</subject><body>



----==_mimepart_50a3c719e4bf1_ccb1493ae4772f7
Date: Wed, 14 Nov 2012 08:30:17 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50a3c719edb16_ccb1493ae4773a9@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 48f4ba671bbb3dd212002d57b72a23375f51619b
      https://github.com/qemu/qemu/commit/48f4ba671bbb3dd212002d57b72a23375f51619b
  Author: Alon Levy &lt;alevy@redhat.com&gt;
  Date:   2012-11-05 (Mon, 05 Nov 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  hw/qxl: guest bug on primary create with stride %4 != 0

Due to usage of pixman for rendering on all spice surfaces we have
pixman's requirement that the stride be word aligned. A guest not
honoring that can crash spice and qemu with it due to failure to create
a surface (in spice-server). Avoid this early on in primary surface
creation and offscreen surface creation.

Recently windows guests got odd width support which triggers a non word
aligned primary surface in 16bit color depth. Off screen surfaces have
always been word aligned, but doesn't hurt to check them here too.

Signed-off-by: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 511aefb0c60e3063ead76d4ba6aabf619eed18ef
      https://github.com/qemu/qemu/commit/511aefb0c60e3063ead76d4ba6aabf619eed18ef
  Author: Alon Levy &lt;alevy@redhat.com&gt;
  Date:   2012-11-05 (Mon, 05 Nov 2012)

  Changed paths:
    M hw/qxl.c
    M trace-events

  Log Message:
  -----------
  hw/qxl: qxl_send_events: nop if stopped

Added a trace point for easy logging.

RHBZ: https://bugzilla.redhat.com/show_bug.cgi?id=870972

Signed-off-by: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 958c2bceba06696e9c223498aaf81d06ce95f608
      https://github.com/qemu/qemu/commit/958c2bceba06696e9c223498aaf81d06ce95f608
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-05 (Mon, 05 Nov 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  qxl: fix cursor reset

When resetting the qxl cursor notify the qemu displaystate too.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: e32c25b5f2452c7fed4dbe8962f4a9f4831fbe24
      https://github.com/qemu/qemu/commit/e32c25b5f2452c7fed4dbe8962f4a9f4831fbe24
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-05 (Mon, 05 Nov 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  qxl: call dpy_gfx_resize when entering vga mode

When entering vga mode the display size likely changes,
notify all displaychangelisteners about this.

Probably went unnoticed for a while as one if the first
things the guest does after leaving qxl native mode and
entering qxl vga mode is to set the vga video mode.  But
there is still a small window where qemu can operate on
stale data, leading to crashes now and then.

https://bugzilla.redhat.com/show_bug.cgi?id=865767

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: d9a86569ca3617a495ffb352e9a390747eaa6b24
      https://github.com/qemu/qemu/commit/d9a86569ca3617a495ffb352e9a390747eaa6b24
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-05 (Mon, 05 Nov 2012)

  Changed paths:
    M console.h
    M qemu-pixman.c
    M qemu-pixman.h
    M ui/spice-display.c
    M ui/spice-display.h

  Log Message:
  -----------
  spice: switch to pixman

Switch over spice-display.c to use the pixman library
instead of the home-grown pflib bits.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 365b1e9e3486aaa55f30df6f16ecafffaef6ec98
      https://github.com/qemu/qemu/commit/365b1e9e3486aaa55f30df6f16ecafffaef6ec98
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-05 (Mon, 05 Nov 2012)

  Changed paths:
    M Makefile.objs
    R pflib.c
    R pflib.h

  Log Message:
  -----------
  pflib: unused, remove it.

Replaced by pixman library.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: bdd4df332a1bdb20b7fa39ea741f7830e41e1187
      https://github.com/qemu/qemu/commit/bdd4df332a1bdb20b7fa39ea741f7830e41e1187
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-05 (Mon, 05 Nov 2012)

  Changed paths:
    M hw/qxl.c
    M ui/spice-display.c

  Log Message:
  -----------
  spice: fix initialization order

Register displaychangelistener last, after spice is fully initialized,
otherwise we may hit NULL pointer dereferences when qemu starts calling
our callbacks.

Commit e250d949feb1334828f27f0d145c35f29c4b7639 triggers this bug.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 9a77a0f58923443913e1071ffb47b74c54566e70
      https://github.com/qemu/qemu/commit/9a77a0f58923443913e1071ffb47b74c54566e70
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-08 (Thu, 08 Nov 2012)

  Changed paths:
    M hw/usb.h
    M hw/usb/bus.c
    M hw/usb/combined-packet.c
    M hw/usb/core.c
    M hw/usb/desc.c
    M hw/usb/desc.h
    M hw/usb/dev-audio.c
    M hw/usb/dev-bluetooth.c
    M hw/usb/dev-hid.c
    M hw/usb/dev-hub.c
    M hw/usb/dev-network.c
    M hw/usb/dev-serial.c
    M hw/usb/dev-smartcard-reader.c
    M hw/usb/dev-storage.c
    M hw/usb/dev-uas.c
    M hw/usb/dev-wacom.c
    M hw/usb/hcd-ehci.c
    M hw/usb/hcd-musb.c
    M hw/usb/hcd-ohci.c
    M hw/usb/hcd-uhci.c
    M hw/usb/hcd-xhci.c
    M hw/usb/host-bsd.c
    M hw/usb/host-linux.c
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb: split packet result into actual_length + status

Since with the ehci and xhci controllers a single packet can be larger
then maxpacketsize, it is possible for the result of a single packet
to be both having transferred some data as well as the transfer to have
an error.

An example would be an input transfer from a bulk endpoint successfully
receiving 1 or more maxpacketsize packets from the device, followed
by a packet signalling halt.

While already touching all the devices and controllers handle_packet /
handle_data / handle_control code, also change the return type of
these functions to void, solely storing the status in the packet. To
make the code paths for regular versus async packet handling more
uniform.

This patch unfortunately is somewhat invasive, since makeing the qemu
usb core deal with this requires changes everywhere. This patch only
prepares the usb core for this, all the hcd / device changes are done
in such a way that there are no functional changes.

This patch has been tested with uhci and ehci hcds, together with usb-audio,
usb-hid and usb-storage devices, as well as with usb-redir redirection
with a wide variety of real devices.

Note that there is usually no need to directly set packet-&gt;actual_length
form devices handle_data callback, as that is done by usb_packet_copy()

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: e94ca437ba92f6e0aeeb0dbda75e158479d413b7
      https://github.com/qemu/qemu/commit/e94ca437ba92f6e0aeeb0dbda75e158479d413b7
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-08 (Thu, 08 Nov 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Allow packets to have both data and an error-status

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 01e26b0ea3c289efc58d31e28408e42c3fcded22
      https://github.com/qemu/qemu/commit/01e26b0ea3c289efc58d31e28408e42c3fcded22
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-08 (Thu, 08 Nov 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Get rid of the magical PROC_ERR status

Instead make ehci_execute and ehci_fill_queue return the again value.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: e696b1da42cd80787d45f6e9a6329d9ef3c8acb2
      https://github.com/qemu/qemu/commit/e696b1da42cd80787d45f6e9a6329d9ef3c8acb2
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-08 (Thu, 08 Nov 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c
    M hw/usb/hcd-ehci.h

  Log Message:
  -----------
  ehci: Add support for packets with both data and an error status

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 9b8251c5c44a70a63c642e4e345fa8c12ed022ed
      https://github.com/qemu/qemu/commit/9b8251c5c44a70a63c642e4e345fa8c12ed022ed
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-08 (Thu, 08 Nov 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: Add support for packets with both data and an error status

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: ffd8a97fb33d3b036d61c508bd73ee7fa4051c6b
      https://github.com/qemu/qemu/commit/ffd8a97fb33d3b036d61c508bd73ee7fa4051c6b
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-08 (Thu, 08 Nov 2012)

  Changed paths:
    M hw/usb/combined-packet.c

  Log Message:
  -----------
  usb/combined-packet: Move freeing of combined to usb_combined_packet_remove()

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 616b5d53ae81a94a4aabe8a87a5d950e9d349bc5
      https://github.com/qemu/qemu/commit/616b5d53ae81a94a4aabe8a87a5d950e9d349bc5
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-11-08 (Thu, 08 Nov 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: Fix some DMA host endian bugs

The xhci device does correct endian switches on the results of some DMAs
but not all.  In particular, there are many DMAs of what are essentially
arrays of 32-bit integers which never get byteswapped.  This causes them
to be interpreted incorrectly on big-endian hosts, since (as per the xhci
spec) these arrays are always little-endian in guest memory.

This patch adds some helper functions to fix these bugs.  This may not be
all the endian bugs in the xhci code, but it's certainly some of them and
the Linux guest xhci driver certainly gets further with these fixes.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 9d1530470bba5d8bec4796c0b43b874d5f9ef017
      https://github.com/qemu/qemu/commit/9d1530470bba5d8bec4796c0b43b874d5f9ef017
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-09 (Fri, 09 Nov 2012)

  Changed paths:
    M hw/usb/hcd-ehci-pci.c

  Log Message:
  -----------
  ehci: fix migration

Commit 5010d4dc618b6b8e7c21129c487c06f6493f71fc reorganized vmstate to
split core + pci, but got two little details wrong.  Fix them.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 7e7f4a0efc81258213dc34aeeaade36b0f59d076
      https://github.com/qemu/qemu/commit/7e7f4a0efc81258213dc34aeeaade36b0f59d076
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-12 (Mon, 12 Nov 2012)

  Changed paths:
    M qemu-nbd.c

  Log Message:
  -----------
  qemu-nbd: initialize main loop before block layer

qemu-nbd was broken because they initialized the block layer while
qemu_aio_context was still NULL.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: d04b0bbbc9cf61446e5c2e159eef50891009fd9c
      https://github.com/qemu/qemu/commit/d04b0bbbc9cf61446e5c2e159eef50891009fd9c
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-12 (Mon, 12 Nov 2012)

  Changed paths:
    M block/nbd.c

  Log Message:
  -----------
  nbd: accept relative path to Unix socket

Adding the "is_unix" member now will simplify the parsing of NBD URIs.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 1d7d2a9d2191c34bd1ad69b420db9b47faa3fb8c
      https://github.com/qemu/qemu/commit/1d7d2a9d2191c34bd1ad69b420db9b47faa3fb8c
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-12 (Mon, 12 Nov 2012)

  Changed paths:
    M block/nbd.c
    M qemu-doc.texi

  Log Message:
  -----------
  nbd: accept URIs

The URI syntax is consistent with the Gluster syntax.  Export names
are specified in the path, preceded by one or more (otherwise unused)
slashes.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: fc6467eaf22f974620b5dd046afca04e619f9be9
      https://github.com/qemu/qemu/commit/fc6467eaf22f974620b5dd046afca04e619f9be9
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-12 (Mon, 12 Nov 2012)

  Changed paths:
    M blockdev-nbd.c

  Log Message:
  -----------
  nbd: fix nbd_server_stop crash when no server was running

This failed on the new assertion of qemu_set_fd_handler2:

qemu-system-x86_64: /home/pbonzini/work/upstream/qemu/iohandler.c:60: \
qemu_set_fd_handler2: Assertion `fd &gt;= 0' failed.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: e644473445177671ec408dfdec705cf931657998
      https://github.com/qemu/qemu/commit/e644473445177671ec408dfdec705cf931657998
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-12 (Mon, 12 Nov 2012)

  Changed paths:
    M blockdev-nbd.c

  Log Message:
  -----------
  nbd: force read-only export for read-only devices

This is the desired behavior for HMP, but it is a better choice for QMP as well.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 17b6be4a7fc9db4f4c56908bab137d4c491471f1
      https://github.com/qemu/qemu/commit/17b6be4a7fc9db4f4c56908bab137d4c491471f1
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-12 (Mon, 12 Nov 2012)

  Changed paths:
    M blockdev-nbd.c

  Log Message:
  -----------
  nbd: disallow nbd-server-add before nbd-server-start

It works nicely with the QMP commands, but it adds useless complication
with HMP.  In particular, see the following:

    (qemu) nbd_server_add -w scsi0-hd0
    (qemu) nbd_server_start -a localhost:10809
    NBD server already exporting device scsi0-hd0

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 4057725f35abe00ea371f85c6e27dd25eafd9ddf
      https://github.com/qemu/qemu/commit/4057725f35abe00ea371f85c6e27dd25eafd9ddf
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-12 (Mon, 12 Nov 2012)

  Changed paths:
    M hmp-commands.hx
    M hmp.c
    M hmp.h

  Log Message:
  -----------
  hmp: add NBD server commands

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: c8dcb531bcd37a4a81d2cc08a89fcd19c34348f9
      https://github.com/qemu/qemu/commit/c8dcb531bcd37a4a81d2cc08a89fcd19c34348f9
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-12 (Mon, 12 Nov 2012)

  Changed paths:
    M hw/scsi-disk.c

  Log Message:
  -----------
  scsi: do not return short responses for emulated commands

The inquiry command, for the case of VPD=1, was returning short
responses; the number of returned bytes was just the number of bytes
in the request, without padding to the specified allocation length
with zero bytes.  This is usually harmless, but it is a violation
of the SCSI specification.

To fix this, always pad with zero bytes to r-&gt;cmd.xfer in
scsi_disk_emulate_command, and return at most r-&gt;buflen bytes
(the size of the buffer for command data) rather than at most
buflen bytes (the number of bytes that was filled in).

Before this patch, "strace sg_inq -p0x83 /dev/sda" would report a
non-zero resid value.  After this patch, it reports resid=0.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: cd41a671b370a3dd603963432d2b02f1e5990fb7
      https://github.com/qemu/qemu/commit/cd41a671b370a3dd603963432d2b02f1e5990fb7
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-12 (Mon, 12 Nov 2012)

  Changed paths:
    M hw/virtio-scsi.c

  Log Message:
  -----------
  virtio-scsi: factor checks for VIRTIO_SCSI_S_DRIVER_OK when reporting events

Suggested by Laszlo Ersek.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: b5232e904fadac8af239306719be4a554f9e9263
      https://github.com/qemu/qemu/commit/b5232e904fadac8af239306719be4a554f9e9263
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-12 (Mon, 12 Nov 2012)

  Changed paths:
    M hw/scsi-disk.c

  Log Message:
  -----------
  scsi: remove superfluous call to scsi_device_set_ua

Suggested by Laszlo Ersek.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 346a3017ec8d5ac4a6961d823f1e576867dc35ef
      https://github.com/qemu/qemu/commit/346a3017ec8d5ac4a6961d823f1e576867dc35ef
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-12 (Mon, 12 Nov 2012)

  Changed paths:
    M hw/megasas.c

  Log Message:
  -----------
  megasas: do not include block_int.h

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: accfeb2dd32ece73350b06cee1b2403f47e86fe3
      https://github.com/qemu/qemu/commit/accfeb2dd32ece73350b06cee1b2403f47e86fe3
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-12 (Mon, 12 Nov 2012)

  Changed paths:
    M hw/scsi-disk.c

  Log Message:
  -----------
  scsi-disk: flush cache after disabling it

SBC says that "if an application client changes the WCE bit from one to
zero via a MODE SELECT command, then the device server shall write
any data in volatile cache to non-volatile medium before completing
the command".

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 4003e24fce1df84a2e8c992376ed2c294816c33c
      https://github.com/qemu/qemu/commit/4003e24fce1df84a2e8c992376ed2c294816c33c
  Author: Hannes Reinecke &lt;hare@suse.de&gt;
  Date:   2012-11-12 (Mon, 12 Nov 2012)

  Changed paths:
    M hw/megasas.c
    M hw/mfi.h

  Log Message:
  -----------
  megasas: Correct target/lun mapping

The structure to reference a logical drive has an unused field,
which can be used to carry the lun ID. This enabled seabios to
establish the proper target/LUN mapping.

Cc: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Cc: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Hannes Reinecke &lt;hare@suse.de&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 9e11908f12f92e31ea94dc2a4c962c836cba9f2a
      https://github.com/qemu/qemu/commit/9e11908f12f92e31ea94dc2a4c962c836cba9f2a
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-11-12 (Mon, 12 Nov 2012)

  Changed paths:
    M dma.h
    M exec.c
    M hw/usb/hcd-ohci.c

  Log Message:
  -----------
  dma: Define dma_context_memory and use in sysbus-ohci

Define a new global dma_context_memory which is a DMAContext corresponding
to the global address_space_memory AddressSpace. This can be used by
sysbus peripherals like sysbus-ohci which need to do DMA.

In particular, use it in the sysbus-ohci device, which fixes a
segfault when attempting to use that device.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;


  Commit: dd72fdd06268860a24f9f3828efade547ee2e2a9
      https://github.com/qemu/qemu/commit/dd72fdd06268860a24f9f3828efade547ee2e2a9
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-12 (Mon, 12 Nov 2012)

  Changed paths:
    M hw/virtio-scsi.c

  Log Message:
  -----------
  virtio-scsi: use dma_context_memory

Until address_space_rw was introduced, NULL was accepted as a
placeholder for DMA with no IOMMU (to address_space_memory).

This does not work anymore, and dma_context_memory needs to
be specified explicitly.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: c8969eded252058e90e91f12f75f32aceae46ec9
      https://github.com/qemu/qemu/commit/c8969eded252058e90e91f12f75f32aceae46ec9
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-13 (Tue, 13 Nov 2012)

  Changed paths:
    M nbd.c

  Log Message:
  -----------
  nbd: fixes to read-only handling

We do not need BLKROSET if the kernel supports setting flags.
Also, always do BLKROSET even for a read-write export, otherwise
the read-only state remains "sticky" after the invocation of
"qemu-nbd -r".

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 716b8e4dd2f7a1674bf77d49fd50139cb577e70f
      https://github.com/qemu/qemu/commit/716b8e4dd2f7a1674bf77d49fd50139cb577e70f
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-11-13 (Tue, 13 Nov 2012)

  Changed paths:
    M linux-headers/asm-powerpc/kvm_para.h
    M linux-headers/asm-s390/kvm_para.h
    M linux-headers/asm-x86/kvm.h
    M linux-headers/linux/kvm.h
    M linux-headers/linux/kvm_para.h
    M linux-headers/linux/vfio.h
    M linux-headers/linux/virtio_config.h
    M linux-headers/linux/virtio_ring.h

  Log Message:
  -----------
  linux-headers: Update to 3.7-rc5

update-linux-headers.sh script run against Linux tag v3.7-rc5

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;


  Commit: e1d1e5867d0bd54c4fc51ec2cddc701258314db0
      https://github.com/qemu/qemu/commit/e1d1e5867d0bd54c4fc51ec2cddc701258314db0
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-11-13 (Tue, 13 Nov 2012)

  Changed paths:
    M hw/vfio_pci.c

  Log Message:
  -----------
  vfio-pci: Add KVM INTx acceleration

This makes use of the new level irqfd support enabling bypass of qemu
userspace both on INTx injection and unmask.  This significantly
boosts the performance of devices making use of legacy interrupts (ex.
~60% better netperf TCP_RR scores for an e1000e assigned to a Linux
guest and booted with pci=nomsi).  This also avoids flipping mmaps on
and off to simulate EOIs, so greatly improves performance of device
access in addition to interrupt latency.

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;


  Commit: a771c51703cf9f91023c6570426258bdf5ec775b
      https://github.com/qemu/qemu/commit/a771c51703cf9f91023c6570426258bdf5ec775b
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-11-13 (Tue, 13 Nov 2012)

  Changed paths:
    M hw/vfio_pci.c

  Log Message:
  -----------
  vfio-pci: Use common msi_get_message

We can get rid of our local version now that a helper exists.

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;


  Commit: 5ca9388a4d22a68439a04b0735c34bdcac553e48
      https://github.com/qemu/qemu/commit/5ca9388a4d22a68439a04b0735c34bdcac553e48
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  pixman: add output dir to include path

Needed to make sure the (generated) pixman-version.h file is found.
Based on a patch from Blue Swirl.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 42da6041d5e30fcf49ba639477a05e781594a7a5
      https://github.com/qemu/qemu/commit/42da6041d5e30fcf49ba639477a05e781594a7a5
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M Makefile
    M configure

  Log Message:
  -----------
  pixman: set --host for cross builds

Set --host when calling pixman configure while doing cross builds so
pixman's autoconf picks up the cross build tools correctly.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 4d5bdd0b460ee2ff8989b0f83fa38a3af052b343
      https://github.com/qemu/qemu/commit/4d5bdd0b460ee2ff8989b0f83fa38a3af052b343
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M Makefile

  Log Message:
  -----------
  pixman: disable gtk

gtk is only needed to build test cases.
Disable it to simplify the build.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: c28fa5a0b3566b133b5e3336d04f1333970ac179
      https://github.com/qemu/qemu/commit/c28fa5a0b3566b133b5e3336d04f1333970ac179
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M Makefile

  Log Message:
  -----------
  pixman: pass cflags, add -fPIC

Pass on CFLAGS to the pixman configure script.
Add -fPIC to the cflags, needed to make the final link succeed.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: b776eca138b641a0234a957a9ff5c2ca4c6772d5
      https://github.com/qemu/qemu/commit/b776eca138b641a0234a957a9ff5c2ca4c6772d5
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  pixman: build internal version early

Signed-off-by: Eric Johnson &lt;ericj@mips.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: daa8e5a077e9d8ca2615f5590fa98b3fcc4c9f47
      https://github.com/qemu/qemu/commit/daa8e5a077e9d8ca2615f5590fa98b3fcc4c9f47
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M qemu-pixman.c
    M qemu-pixman.h

  Log Message:
  -----------
  pixman: add licensing info

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: feb33ea728a72730389bc5d4bf52d33f09c7868b
      https://github.com/qemu/qemu/commit/feb33ea728a72730389bc5d4bf52d33f09c7868b
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M Makefile

  Log Message:
  -----------
  pixman: cleanup properly on make distclean

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: bf0dfb69f860a7894958068fba45f5268dddd6be
      https://github.com/qemu/qemu/commit/bf0dfb69f860a7894958068fba45f5268dddd6be
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M Makefile.objs
    M console.h
    M hw/qxl.c
    R pflib.c
    R pflib.h
    M qemu-pixman.c
    M qemu-pixman.h
    M trace-events
    M ui/spice-display.c
    M ui/spice-display.h

  Log Message:
  -----------
  Merge remote-tracking branch 'spice/spice.v63' into staging

* spice/spice.v63:
  spice: fix initialization order
  pflib: unused, remove it.
  spice: switch to pixman
  qxl: call dpy_gfx_resize when entering vga mode
  qxl: fix cursor reset
  hw/qxl: qxl_send_events: nop if stopped
  hw/qxl: guest bug on primary create with stride %4 != 0

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: ce5e5b522e8d3b848b6445c34226b69c77c46403
      https://github.com/qemu/qemu/commit/ce5e5b522e8d3b848b6445c34226b69c77c46403
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M hw/usb.h
    M hw/usb/bus.c
    M hw/usb/combined-packet.c
    M hw/usb/core.c
    M hw/usb/desc.c
    M hw/usb/desc.h
    M hw/usb/dev-audio.c
    M hw/usb/dev-bluetooth.c
    M hw/usb/dev-hid.c
    M hw/usb/dev-hub.c
    M hw/usb/dev-network.c
    M hw/usb/dev-serial.c
    M hw/usb/dev-smartcard-reader.c
    M hw/usb/dev-storage.c
    M hw/usb/dev-uas.c
    M hw/usb/dev-wacom.c
    M hw/usb/hcd-ehci-pci.c
    M hw/usb/hcd-ehci.c
    M hw/usb/hcd-ehci.h
    M hw/usb/hcd-musb.c
    M hw/usb/hcd-ohci.c
    M hw/usb/hcd-uhci.c
    M hw/usb/hcd-xhci.c
    M hw/usb/host-bsd.c
    M hw/usb/host-linux.c
    M hw/usb/redirect.c

  Log Message:
  -----------
  Merge remote-tracking branch 'kraxel/usb.70' into staging

* kraxel/usb.70:
  ehci: fix migration
  xhci: Fix some DMA host endian bugs
  usb/combined-packet: Move freeing of combined to usb_combined_packet_remove()
  xhci: Add support for packets with both data and an error status
  ehci: Add support for packets with both data and an error status
  ehci: Get rid of the magical PROC_ERR status
  usb-redir: Allow packets to have both data and an error-status
  usb: split packet result into actual_length + status

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 5f580e9411a24b7decc07013edeb8abf8d5ae25c
      https://github.com/qemu/qemu/commit/5f580e9411a24b7decc07013edeb8abf8d5ae25c
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M dma.h
    M exec.c
    M hw/megasas.c
    M hw/mfi.h
    M hw/scsi-disk.c
    M hw/usb/hcd-ohci.c
    M hw/virtio-scsi.c

  Log Message:
  -----------
  Merge remote-tracking branch 'bonzini/scsi-next' into staging

* bonzini/scsi-next:
  virtio-scsi: use dma_context_memory
  dma: Define dma_context_memory and use in sysbus-ohci
  megasas: Correct target/lun mapping
  scsi-disk: flush cache after disabling it
  megasas: do not include block_int.h
  scsi: remove superfluous call to scsi_device_set_ua
  virtio-scsi: factor checks for VIRTIO_SCSI_S_DRIVER_OK when reporting events
  scsi: do not return short responses for emulated commands

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: de148eb79c7894178a1c2da6f2320b9ce6b0daee
      https://github.com/qemu/qemu/commit/de148eb79c7894178a1c2da6f2320b9ce6b0daee
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M block/nbd.c
    M blockdev-nbd.c
    M hmp-commands.hx
    M hmp.c
    M hmp.h
    M nbd.c
    M qemu-doc.texi
    M qemu-nbd.c

  Log Message:
  -----------
  Merge remote-tracking branch 'bonzini/nbd-next' into staging

* bonzini/nbd-next:
  nbd: fixes to read-only handling
  hmp: add NBD server commands
  nbd: disallow nbd-server-add before nbd-server-start
  nbd: force read-only export for read-only devices
  nbd: fix nbd_server_stop crash when no server was running
  nbd: accept URIs
  nbd: accept relative path to Unix socket
  qemu-nbd: initialize main loop before block layer

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 662d263f280f6cfc82263a687b8322b69d2ed7db
      https://github.com/qemu/qemu/commit/662d263f280f6cfc82263a687b8322b69d2ed7db
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M Makefile
    M configure
    M qemu-pixman.c
    M qemu-pixman.h

  Log Message:
  -----------
  Merge remote-tracking branch 'kraxel/pixman.v5' into staging

* kraxel/pixman.v5:
  pixman: cleanup properly on make distclean
  pixman: add licensing info
  pixman: build internal version early
  pixman: pass cflags, add -fPIC
  pixman: disable gtk
  pixman: set --host for cross builds
  pixman: add output dir to include path

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: ce34cf72fe508b27a78f83c184142e8d1e6a048a
      https://github.com/qemu/qemu/commit/ce34cf72fe508b27a78f83c184142e8d1e6a048a
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M hw/vfio_pci.c
    M linux-headers/asm-powerpc/kvm_para.h
    M linux-headers/asm-s390/kvm_para.h
    M linux-headers/asm-x86/kvm.h
    M linux-headers/linux/kvm.h
    M linux-headers/linux/kvm_para.h
    M linux-headers/linux/vfio.h
    M linux-headers/linux/virtio_config.h
    M linux-headers/linux/virtio_ring.h

  Log Message:
  -----------
  Merge remote-tracking branch 'awilliam/tags/vfio-pci-for-qemu-1.3.0-rc0' into \
staging

vfio-pci: KVM INTx accel &amp; common msi_get_message

* awilliam/tags/vfio-pci-for-qemu-1.3.0-rc0:
  vfio-pci: Use common msi_get_message
  vfio-pci: Add KVM INTx acceleration
  linux-headers: Update to 3.7-rc5

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/f5022a135e43...ce34cf72fe50

----==_mimepart_50a3c719e4bf1_ccb1493ae4772f7--


</body></email><email><emailId>20121115140007</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-15 14:00:07-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 68d001: mips/malta: fix CBUS UART interrupt pin</subject><body>



----==_mimepart_50a4f567325b7_138b1ae2ae4139676
Date: Thu, 15 Nov 2012 06:00:07 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50a4f56733cb8_138b1ae2ae413974b@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 68d001928b151a0c50f367c0bdca645b3d5e9ed3
      https://github.com/qemu/qemu/commit/68d001928b151a0c50f367c0bdca645=
b3d5e9ed3
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-11-15 (Thu, 15 Nov 2012)

  Changed paths:
    M hw/mips_malta.c

  Log Message:
  -----------
  mips/malta: fix CBUS UART interrupt pin

According to the MIPS Malta Developement Platform User's Manual, the
i8259 interrupt controller is supposed to be connected to the hardware
IRQ0, and the CBUS UART to the hardware interrupt 2.

In QEMU they are both connected to hardware interrupt 0, the CBUS UART
interrupt being wrong. This patch fixes that. It should be noted that
the irq array in QEMU includes the software interrupts, hence
env-&gt;irq[2] is the first hardware interrupt.

Cc: Ralf Baechle &lt;ralf@linux-mips.org&gt;
Reviewed-by: Eric Johnson &lt;ericj@mips.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 6801038bc52d61f81ac8a25fbe392f1bad982887
      https://github.com/qemu/qemu/commit/6801038bc52d61f81ac8a25fbe392f1=
bad982887
  Author: =E9=99=B3=E9=9F=8B=E4=BB=BB (Wei-Ren Chen) &lt;chenwj@iis.sinica.e=
du.tw&gt;
  Date:   2012-11-15 (Thu, 15 Nov 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: fix wrong microMIPS opcode encoding

While reading microMIPS decoding, I found a possible wrong opcode
encoding. According to [1] page 166, the bits 13..12 for MULTU is
0x01 rather than 0x00. Please review, thanks.

[1] MIPS Architecture for Programmers VolumeIV-e: The MIPS DSP
    Application-Specific Extension to the microMIPS32 Architecture

Signed-off-by: Chen Wei-Ren &lt;chenwj@iis.sinica.edu.tw&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


Compare: https://github.com/qemu/qemu/compare/ce34cf72fe50...6801038bc52d=


----==_mimepart_50a4f567325b7_138b1ae2ae4139676--


</body></email><email><emailId>20121116180011</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-16 18:00:11-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 68d98d: vl: add -object option to create QOM objects from ...</subject><body>



----==_mimepart_50a67f2bd7057_30a41005af4111060
Date: Fri, 16 Nov 2012 10:00:11 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50a67f2bd9704_30a41005af41111c8@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 68d98d3e42b2b291274537d1ae4092e11d321437
      https://github.com/qemu/qemu/commit/68d98d3e42b2b291274537d1ae4092e11d321437
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M qemu-config.c
    M qemu-options.hx
    M vl.c

  Log Message:
  -----------
  vl: add -object option to create QOM objects from the command line

This will create a new QOM object in the '/objects' path.  Note that properties
are set in order which allows for simple objects to be initialized entirely
with this option and then realized.

This option is roughly equivalent to -device but for things that are not
devices.

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 0e5588438d921b8686bbf455f400f727b2ff7b62
      https://github.com/qemu/qemu/commit/0e5588438d921b8686bbf455f400f727b2ff7b62
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M include/qemu/object.h
    M qom/object.c

  Log Message:
  -----------
  object: add object_property_add_bool (v2)

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
---
v1 -&gt; v2
 - Fix whitespace (Andreas Faerber)


  Commit: a9b7b2ad7b075dba5495271706670e5c6b1304bc
      https://github.com/qemu/qemu/commit/a9b7b2ad7b075dba5495271706670e5c6b1304bc
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M Makefile.objs
    A backends/Makefile.objs
    A backends/rng.c
    A include/qemu/rng.h

  Log Message:
  -----------
  rng: add RndBackend abstract object class

This is the backend used by devices that need to request entropy.

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 5c74521d249486fa3e749dbbf6d56a70d4d7235f
      https://github.com/qemu/qemu/commit/5c74521d249486fa3e749dbbf6d56a70d4d7235f
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M backends/Makefile.objs
    A backends/rng-random.c
    A include/qemu/rng-random.h

  Log Message:
  -----------
  rng-random: add an RNG backend that uses /dev/random (v3)

The filename can be overridden but it expects a non-blocking source of entropy.
A typical invocation would be:

qemu -object rng-random,id=rng0 -device virtio-rng-pci,rng=rng0

This can also be used with /dev/urandom by using the command line:

qemu -object rng-random,filename=/dev/urandom,id=rng0 \
     -device virtio-rng-pci,rng=rng0

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
---
v1 -&gt; v2
 - merged header split patch into this one
v2 -&gt; v3
 - bug fix in rng-random (Paolo)


  Commit: 1da2738f5566263177d09c1b9eaf7cbeeb17e815
      https://github.com/qemu/qemu/commit/1da2738f5566263177d09c1b9eaf7cbeeb17e815
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M backends/Makefile.objs
    A backends/rng-egd.c

  Log Message:
  -----------
  rng-egd: introduce EGD compliant RNG backend

This backend talks EGD to a CharDriverState.  A typical way to invoke this would
be:

qemu -chardev socket,host=localhost,port=1024,id=chr0 \
     -object rng-egd,chardev=chr0,id=egd0 \
     -device virtio-rng-pci,rng=egd0

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 16c915ba42b45df7a64a6908287f03bfa3764bed
      https://github.com/qemu/qemu/commit/16c915ba42b45df7a64a6908287f03bfa3764bed
  Author: Amit Shah &lt;amit.shah@redhat.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M hw/Makefile.objs
    M hw/pci.h
    M hw/s390-virtio-bus.c
    M hw/s390-virtio-bus.h
    M hw/virtio-pci.c
    M hw/virtio-pci.h
    A hw/virtio-rng.c
    A hw/virtio-rng.h
    M hw/virtio.h

  Log Message:
  -----------
  virtio-rng: hardware random number generator device

The Linux kernel already has a virtio-rng driver, this is the device
implementation.

When the guest asks for entropy from the virtio hwrng, it puts a buffer
in the vq.  We then put entropy into that buffer, and push it back to
the guest.

Signed-off-by: Amit Shah &lt;amit.shah@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
---
aliguori: converted to new RngBackend interface
aliguori: remove entropy needed event
aliguori: fix migration


  Commit: 904d6f588063fb5ad2b61998acdf1e73fb465067
      https://github.com/qemu/qemu/commit/904d6f588063fb5ad2b61998acdf1e73fb465067
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M hw/virtio-pci.c
    M hw/virtio-rng.c
    M hw/virtio-rng.h

  Log Message:
  -----------
  virtio-rng: add rate limiting support

This adds parameters to virtio-rng-pci to allow rate limiting the entropy a
guest receives.  An example command line:

$ qemu -device virtio-rng-pci,max-bytes=1024,period=1000

Would limit entropy collection to 1Kb/s.

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 500054f161c29ff9db125c0b872809191ad6920b
      https://github.com/qemu/qemu/commit/500054f161c29ff9db125c0b872809191ad6920b
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M hw/virtio-pci.c
    M hw/virtio-rng.h

  Log Message:
  -----------
  virtio-rng-pci: create a default backend if none exists

This allows you to specify:

  $ qemu -device virtio-rng-pci

And things will Just Work with a reasonable default.

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/6801038bc52d...500054f161c2

----==_mimepart_50a67f2bd7057_30a41005af4111060--


</body></email><email><emailId>20121116220007</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-16 22:00:07-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 9cb535: rng-egd: don't use gslist_free_full</subject><body>



----==_mimepart_50a6b767dffb5_146e1451af41028f3
Date: Fri, 16 Nov 2012 14:00:07 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50a6b767e1456_146e1451af41029ae@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 9cb535fe4ef08b01e583ec955767a0899ff79afe
      https://github.com/qemu/qemu/commit/9cb535fe4ef08b01e583ec955767a0899ff79afe
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M backends/rng-egd.c

  Log Message:
  -----------
  rng-egd: don't use gslist_free_full

This function was only introduced in glib 2.28.0.

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;




----==_mimepart_50a6b767dffb5_146e1451af41028f3--


</body></email><email><emailId>20121117183011</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-17 18:30:11-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] df9ffb: vga: fix bochs alignment issue</subject><body>



----==_mimepart_50a7d7b32a1f0_656163aaf04529
Date: Sat, 17 Nov 2012 10:30:11 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50a7d7b32cba0_656163aaf0453c1@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: df9ffb726ff13f850b8829be1bc85ed621b903ac
      https://github.com/qemu/qemu/commit/df9ffb726ff13f850b8829be1bc85ed621b903ac
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M docs/specs/standard-vga.txt
    M hw/vga.c

  Log Message:
  -----------
  vga: fix bochs alignment issue

The bochs dispi interface traditionally uses port 0x1ce as 16bit index
register and port 0x1cf as 16bit data register.  The later is unaligned,
and probably for that reason the the data register was moved to 0x1d0
for non-x86 archs.

This patch makes the data register available at 0x1d0 on x86 too.  The
old x86 location is kept for compatibility reasons, so both 0x1cf and
0x1d0 can be used as data register on x86.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: c96c53b5f10c4b34e9fe1dcb1a5aadf204c16279
      https://github.com/qemu/qemu/commit/c96c53b5f10c4b34e9fe1dcb1a5aadf204c16279
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M hw/vga-pci.c

  Log Message:
  -----------
  vga: fix mmio vga register mapping


  Commit: 7b5eff4daa65ab8672de8c126d7757cbbeb31a08
      https://github.com/qemu/qemu/commit/7b5eff4daa65ab8672de8c126d7757cbbeb31a08
  Author: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
  Date:   2012-11-17 (Sat, 17 Nov 2012)

  Changed paths:
    M target-cris/translate.c

  Log Message:
  -----------
  target-cris/translate.c: Code style clean-up

Signed-off-by: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 8232a46a165c20fdc8f6bb2d06c71be55afce051
      https://github.com/qemu/qemu/commit/8232a46a165c20fdc8f6bb2d06c71be55afce051
  Author: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
  Date:   2012-11-17 (Sat, 17 Nov 2012)

  Changed paths:
    M tcg/tcg.h

  Log Message:
  -----------
  tcg/tcg.h: Duplicate global TCG variables in TCGContext

Signed-off-by: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: efd7f48600e0e7803765d7b31cea131aae2b7329
      https://github.com/qemu/qemu/commit/efd7f48600e0e7803765d7b31cea131aae2b7329
  Author: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
  Date:   2012-11-17 (Sat, 17 Nov 2012)

  Changed paths:
    M target-alpha/translate.c
    M target-arm/translate.c
    M target-cris/translate.c
    M target-i386/translate.c
    M target-lm32/translate.c
    M target-m68k/translate.c
    M target-microblaze/translate.c
    M target-mips/translate.c
    M target-openrisc/translate.c
    M target-ppc/translate.c
    M target-s390x/translate.c
    M target-sh4/translate.c
    M target-sparc/translate.c
    M target-unicore32/translate.c
    M target-xtensa/translate.c
    M tcg/tcg-op.h
    M tcg/tcg.c

  Log Message:
  -----------
  TCG: Use gen_opc_ptr from context instead of global variable.

Signed-off-by: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: c4afe5c4d30e1dd6fc1f2b0b32ffb50f4d5ada82
      https://github.com/qemu/qemu/commit/c4afe5c4d30e1dd6fc1f2b0b32ffb50f4d5ada82
  Author: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
  Date:   2012-11-17 (Sat, 17 Nov 2012)

  Changed paths:
    M gen-icount.h
    M tcg/tcg-op.h
    M tcg/tcg.c

  Log Message:
  -----------
  TCG: Use gen_opparam_ptr from context instead of global variable.

Signed-off-by: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 92414b31e726ead5fd93a5bee5a6d1aecc66e454
      https://github.com/qemu/qemu/commit/92414b31e726ead5fd93a5bee5a6d1aecc66e454
  Author: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
  Date:   2012-11-17 (Sat, 17 Nov 2012)

  Changed paths:
    M target-alpha/translate.c
    M target-arm/translate.c
    M target-cris/translate.c
    M target-i386/translate.c
    M target-lm32/translate.c
    M target-m68k/translate.c
    M target-microblaze/translate.c
    M target-mips/translate.c
    M target-openrisc/translate.c
    M target-ppc/translate.c
    M target-s390x/translate.c
    M target-sh4/translate.c
    M target-sparc/translate.c
    M target-unicore32/translate.c
    M target-xtensa/translate.c
    M tcg/optimize.c
    M tcg/tcg.c

  Log Message:
  -----------
  TCG: Use gen_opc_buf from context instead of global variable.

Signed-off-by: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 1ff0a2c594356b134af6742b9cb5e5757c620881
      https://github.com/qemu/qemu/commit/1ff0a2c594356b134af6742b9cb5e5757c620881
  Author: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
  Date:   2012-11-17 (Sat, 17 Nov 2012)

  Changed paths:
    M tcg/tcg.c

  Log Message:
  -----------
  TCG: Use gen_opparam_buf from context instead of global variable.

Signed-off-by: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 83eeb39669a19716a44bcad5a34158543b3779b8
      https://github.com/qemu/qemu/commit/83eeb39669a19716a44bcad5a34158543b3779b8
  Author: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
  Date:   2012-11-17 (Sat, 17 Nov 2012)

  Changed paths:
    M tcg/tcg.c
    M tcg/tcg.h
    M translate-all.c

  Log Message:
  -----------
  TCG: Remove unused global variables

Signed-off-by: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: ab4dd33dc3127a3830591b597a1f42be3686e1fd
      https://github.com/qemu/qemu/commit/ab4dd33dc3127a3830591b597a1f42be3686e1fd
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-11-17 (Sat, 17 Nov 2012)

  Changed paths:
    M docs/specs/standard-vga.txt
    M hw/vga-pci.c
    M hw/vga.c

  Log Message:
  -----------
  Merge branch 'vga.1' of git://git.kraxel.org/qemu

* 'vga.1' of git://git.kraxel.org/qemu:
  vga: fix mmio vga register mapping
  vga: fix bochs alignment issue


  Commit: 2c5c4451e69a69c0fad3303c25cc7eaad6950f79
      https://github.com/qemu/qemu/commit/2c5c4451e69a69c0fad3303c25cc7eaad6950f79
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-11-17 (Sat, 17 Nov 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  libseccomp: require version 1.0.0

Debian Wheezy has version 0.1.0 which is not compatible, avoid it.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/9cb535fe4ef0...2c5c4451e69a

----==_mimepart_50a7d7b32a1f0_656163aaf04529--


</body></email><email><emailId>20121118213009</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-18 21:30:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 3bc2f5: build: replace weak symbols with a static library</subject><body>



----==_mimepart_50a953617302c_6277de0ae42166d9
Date: Sun, 18 Nov 2012 13:30:09 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50a9536174f96_6277de0ae42167c4@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 3bc2f570ec9fc930619a8ef26a22dd6d03c25dac
      https://github.com/qemu/qemu/commit/3bc2f570ec9fc930619a8ef26a22dd6d03c25dac
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-18 (Sun, 18 Nov 2012)

  Changed paths:
    M Makefile
    M Makefile.objs
    M Makefile.target
    M compiler.h
    M osdep.c
    M oslib-win32.c
    M qemu-sockets.c
    M qmp.c
    M rules.mak
    A stubs/Makefile.objs
    A stubs/arch-query-cpu-def.c
    A stubs/fd-register.c
    A stubs/fdset-add-fd.c
    A stubs/fdset-find-fd.c
    A stubs/fdset-get-fd.c
    A stubs/fdset-remove-fd.c
    A stubs/get-fd.c
    A stubs/set-fd-handler.c

  Log Message:
  -----------
  build: replace weak symbols with a static library

Weak symbols were a nice idea, but they turned out not to be a good one.
Toolchain support is just too sparse, in particular llvm-gcc is totally
broken.

This patch uses a surprisingly low-tech approach: a static library.
Symbols in a static library are always overridden by symbols in an
object file.  Furthermore, if you place each function in a separate
source file, object files for unused functions will not be taken in.
This means that each function can use all the dependencies that it needs
(especially QAPI stuff such as error_setg).

Thus, all stubs are placed in separate object files and put together in
a static library.  The library then is linked to all programs.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Tested-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Tested-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: de91f537997c96204e35fb308aacb102071f0827
      https://github.com/qemu/qemu/commit/de91f537997c96204e35fb308aacb102071f0827
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-11-18 (Sun, 18 Nov 2012)

  Changed paths:
    M exec-all.h

  Log Message:
  -----------
  tci: fix build breakage for target MIPS

commit 5f7319cd introduced GETPC() usage for MIPS, which is currently
not defined when building with --enable-tcg-interpreter. Add MIPS to
the list of targets we selectively define GETPC() for.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 13586813446054aeff71b359aa627e201094375c
      https://github.com/qemu/qemu/commit/13586813446054aeff71b359aa627e201094375c
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-11-18 (Sun, 18 Nov 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  tci: Fix build breakage (unresolved symbol tcg_out_tb_finalize)

Commit 32761257c0b9fa7ee04d2871a6e48a41f119c469 enabled
qemu_ld/st optimization unconditionally for some hosts.

The TCG interpreter still does not support this kind of
optimization. Therefore builds with TCI fail with an
unresolved symbol tcg_out_tb_finalize. This is fixed here.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: e24dc9feb0d68142d54dc3c097f57588836d1338
      https://github.com/qemu/qemu/commit/e24dc9feb0d68142d54dc3c097f57588836d1338
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-11-18 (Sun, 18 Nov 2012)

  Changed paths:
    M tcg/tci/tcg-target.c
    M tcg/tci/tcg-target.h
    M tci.c

  Log Message:
  -----------
  tci: Support deposit operations

The operations for INDEX_op_deposit_i32 and INDEX_op_deposit_i64
are now supported and enabled by default.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/2c5c4451e69a...e24dc9feb0d6

----==_mimepart_50a953617302c_6277de0ae42166d9--


</body></email><email><emailId>20121119170023</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-19 17:00:23-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 8809e2: qemu: Document GlusterFS block driver usage</subject><body>



----==_mimepart_50aa65a766cab_3c0e10d0aec129417
Date: Mon, 19 Nov 2012 09:00:23 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50aa65a769b04_3c0e10d0aec12952b@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 8809e28937b8a48ff0dfeeb93498641392f26019
      https://github.com/qemu/qemu/commit/8809e28937b8a48ff0dfeeb93498641392f26019
  Author: Bharata B Rao &lt;bharata@linux.vnet.ibm.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M qemu-doc.texi
    M qemu-options.hx

  Log Message:
  -----------
  qemu: Document GlusterFS block driver usage

Signed-off-by: Bharata B Rao &lt;bharata@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: a3548077062dd9dc2701ebffd931ba6eaef40bec
      https://github.com/qemu/qemu/commit/a3548077062dd9dc2701ebffd931ba6eaef40bec
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M block/qcow2-refcount.c

  Log Message:
  -----------
  qcow2: Fix refcount table size calculation

A missing factor for the refcount table entry size in the calculation
could mean that too little memory was allocated for the in-memory
representation of the table, resulting in a buffer overflow.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Reviewed-by: Michael Tokarev &lt;mjt@tls.msk.ru&gt;
Tested-by: Michael Tokarev &lt;mjt@tls.msk.ru&gt;


  Commit: d2ef210cb8d3e7d1dc4e1c6050d2092bda18a5a8
      https://github.com/qemu/qemu/commit/d2ef210cb8d3e7d1dc4e1c6050d2092bda18a5a8
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    A tests/qemu-iotests/044
    A tests/qemu-iotests/044.out
    M tests/qemu-iotests/group
    M tests/qemu-iotests/iotests.py
    M tests/qemu-iotests/qcow2.py

  Log Message:
  -----------
  qemu-iotests: qcow2: Test growing large refcount table

Actually writing all the content with 512 byte sector size would take
forever, therefore build the image file with a Python script and use
qemu-io for the last write that actually triggers the refcount table
growth.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 54d01a0073db56230815d16cf3e6054c1dba919a
      https://github.com/qemu/qemu/commit/54d01a0073db56230815d16cf3e6054c1dba919a
  Author: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M MAINTAINERS

  Log Message:
  -----------
  MAINTAINERS: add Stefan Hajnoczi as block and virtio-blk co-maintainer

Kevin has requested co-maintainership to give him more time to write
code.  We will alternate patch review duties on a weekly basis.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: cee40d2d2dda87fd9705ed4b85e2c0cf0e5c2ac4
      https://github.com/qemu/qemu/commit/cee40d2d2dda87fd9705ed4b85e2c0cf0e5c2ac4
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M block/win32-aio.c

  Log Message:
  -----------
  block: Workaround for older versions of MinGW gcc

Versions before gcc-4.6 don't support unnamed fields in initializers
(see http://gcc.gnu.org/bugzilla/show_bug.cgi?id=10676).

Offset and OffsetHigh belong to an unnamed struct which is part of an
unnamed union. Therefore the original code does not work with older
versions of gcc.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: a9660664fde89ef2c7bc629eda547a48b288fbb9
      https://github.com/qemu/qemu/commit/a9660664fde89ef2c7bc629eda547a48b288fbb9
  Author: Nick Thomas &lt;nick@bytemark.co.uk&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M tests/qemu-iotests/common
    M tests/qemu-iotests/common.config
    M tests/qemu-iotests/common.rc

  Log Message:
  -----------
  tests: allow qemu-iotests to be run against nbd backend

To do this, we start a qemu-nbd process at _make_test_img and kill
it in _cleanup_test_img. $TEST_IMG is changed to point at the TCP
server. We also remove the checks for existence of binaries from
common.config - they're duplicated in common, and we can make the
qemu-nbd check conditional on $IMGPROTO being "nbd" if we do it there.

Signed-off-by: Nick Thomas &lt;nick@bytemark.co.uk&gt;
Acked-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 8c82e9a4331bad42dfc01158fbd1e8f4c2f1c957
      https://github.com/qemu/qemu/commit/8c82e9a4331bad42dfc01158fbd1e8f4c2f1c957
  Author: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M qemu-aio.h

  Log Message:
  -----------
  aio: switch aiocb_size type int -&gt; size_t

Using appropriate types for variables is a good thing :).  All users
simply do sizeof(MyType) and the value is passed to a memory allocator,
it should be size_t.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: d37c975fb134e1b16f09b4e6545e2c0591fb6455
      https://github.com/qemu/qemu/commit/d37c975fb134e1b16f09b4e6545e2c0591fb6455
  Author: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M block.c
    M qemu-aio.h

  Log Message:
  -----------
  aio: use g_slice_alloc() for AIOCB pooling

AIO control blocks are frequently acquired and released because each aio
request involves at least one AIOCB.  Therefore, we pool them to avoid
heap allocation overhead.

The problem with the freelist approach in AIOPool is thread-safety.  If
we want BlockDriverStates to associate with AioContexts that execute in
multiple threads, then a global freelist becomes a problem.

This patch drops the freelist and instead uses g_slice_alloc() which is
tuned for per-thread fixed-size object pools.  qemu_aio_get() and
qemu_aio_release() are now thread-safe.

Note that the change from g_malloc0() to g_slice_alloc() should be safe
since the freelist reuse case doesn't zero the AIOCB either.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: d7331bed11f5e65b3b640aab59ab22bc61a4e77d
      https://github.com/qemu/qemu/commit/d7331bed11f5e65b3b640aab59ab22bc61a4e77d
  Author: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M block.c
    M block/blkdebug.c
    M block/blkverify.c
    M block/curl.c
    M block/gluster.c
    M block/iscsi.c
    M block/linux-aio.c
    M block/qed.c
    M block/rbd.c
    M block/sheepdog.c
    M block/win32-aio.c
    M dma-helpers.c
    M hw/ide/core.c
    M qemu-aio.h
    M thread-pool.c

  Log Message:
  -----------
  aio: rename AIOPool to AIOCBInfo

Now that AIOPool no longer keeps a freelist, it isn't really a "pool"
anymore.  Rename it to AIOCBInfo and make it const since it no longer
needs to be modified.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 34abf9a7d82cd959622996733884469a33f7e2e0
      https://github.com/qemu/qemu/commit/34abf9a7d82cd959622996733884469a33f7e2e0
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M hw/fdc.c

  Log Message:
  -----------
  fdc: Remove status0 parameter from fdctrl_set_fifo()

It decided whether an interrupt is triggered. Only one caller made use
of this functionality, so move the code there.

In this one caller, the interrupt must actually be triggered
unconditionally, like it was before commit 2fee0088. For example, a
successful read without an implied seek can result in st0 = 0, but still
triggers the interrupt.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Tested-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;


  Commit: 1f507913762c03332a06232930ebb1f753992660
      https://github.com/qemu/qemu/commit/1f507913762c03332a06232930ebb1f753992660
  Author: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M tests/fdc-test.c

  Log Message:
  -----------
  fdc-test: split test_media_change() test, so insert part can be reused

Signed-off-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 44212dcc467cfe20f0ffe89c35c1fbd7849ea924
      https://github.com/qemu/qemu/commit/44212dcc467cfe20f0ffe89c35c1fbd7849ea924
  Author: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M tests/fdc-test.c

  Log Message:
  -----------
  fdc-test: insert media before fuzzing registers

A media will be required for future fdc tests.

Signed-off-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 5f8ae8e2b5eda3c03ea49bd6d9029562f156ad07
      https://github.com/qemu/qemu/commit/5f8ae8e2b5eda3c03ea49bd6d9029562f156ad07
  Author: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M tests/fdc-test.c

  Log Message:
  -----------
  fdc-test: add tests for non-DMA READ command

Signed-off-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: d497d53497070322e04796a9958e551d88c9f3a9
      https://github.com/qemu/qemu/commit/d497d53497070322e04796a9958e551d88c9f3a9
  Author: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M hw/fdc.c

  Log Message:
  -----------
  fdc: use status0 field instead of a local variable

Signed-off-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: c5139bd9a9d78053a4da5047deb34e478a52d669
      https://github.com/qemu/qemu/commit/c5139bd9a9d78053a4da5047deb34e478a52d669
  Author: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M hw/fdc.c

  Log Message:
  -----------
  fdc: fix FD_SR0_SEEK for non-DMA transfers and multi sectors transfers

On non-DMA transfers, fdctrl_stop_transfer() used to set FD_SR0_SEEK
no matter if there actually was a seek or not. This is obviously wrong.

fdctrl_seek_to_next_sect() has this information because it performs
the seek itself.

Signed-off-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: d6ed4e21060d13a2faf7c1c9d121e68a16a411f8
      https://github.com/qemu/qemu/commit/d6ed4e21060d13a2faf7c1c9d121e68a16a411f8
  Author: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M hw/fdc.c

  Log Message:
  -----------
  fdc: fix FD_SR0_SEEK for initial seek on DMA transfers

fdctrl_start_transfer() used to set FD_SR0_SEEK no matter if
there actually was a seek or not. This is obviously wrong.

fdctrl_start_transfer() has this information because it performs
the initial seek itself.

Signed-off-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 075f5532f182a12d8c89352f876363f110722e82
      https://github.com/qemu/qemu/commit/075f5532f182a12d8c89352f876363f110722e82
  Author: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M hw/fdc.c
    M tests/fdc-test.c

  Log Message:
  -----------
  fdc: fix false FD_SR0_SEEK

Do not always set FD_SR0_SEEK, as callers already set it if needed.

Signed-off-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 67f194bd815374fa7d5cb97d415f28f98b840378
      https://github.com/qemu/qemu/commit/67f194bd815374fa7d5cb97d415f28f98b840378
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M tests/fdc-test.c

  Log Message:
  -----------
  fdc-test: Check READ ID

ST0 shouldn't include 0x20 (FD_SR0_SEEK) after READ ID.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Tested-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;


  Commit: 7ea004ed67e08462926a8559e1c6953e387e4035
      https://github.com/qemu/qemu/commit/7ea004ed67e08462926a8559e1c6953e387e4035
  Author: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M hw/fdc.c

  Log Message:
  -----------
  fdc: implement VERIFY command

VERIFY command is like a READ command, except that read data is not
transfered by DMA.
As DMA engine is not used, so we have to start data transfer ourselves.

Signed-off-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 6f442fe83821a06c5408056c7879e83a74f2ff32
      https://github.com/qemu/qemu/commit/6f442fe83821a06c5408056c7879e83a74f2ff32
  Author: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M tests/fdc-test.c

  Log Message:
  -----------
  fdc-tests: add tests for VERIFY command

Signed-off-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 27c86e24e9d6b2bbe15c16bc09eba5bd6fa094f2
      https://github.com/qemu/qemu/commit/27c86e24e9d6b2bbe15c16bc09eba5bd6fa094f2
  Author: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M hw/fdc.c

  Log Message:
  -----------
  fdc: remove double affectation of FD_MSR_CMDBUSY flag

FD_MSR_CMDBUSY flag is already set in fdctrl_write_data(), just
before calling the command handler (fdctrl_start_transfer() here).

Signed-off-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: c83f97b563b5eb8ae5d10e6653f5f3f0f8c71b02
      https://github.com/qemu/qemu/commit/c83f97b563b5eb8ae5d10e6653f5f3f0f8c71b02
  Author: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M hw/fdc.c

  Log Message:
  -----------
  fdc: fix typo in zero constant

Signed-off-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: cd30b53d22c96bddefab3f4b396e4d49da17f434
      https://github.com/qemu/qemu/commit/cd30b53d22c96bddefab3f4b396e4d49da17f434
  Author: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M hw/fdc.c

  Log Message:
  -----------
  fdc: remove last usage of FD_STATE_SEEK

Replace it by directly setting FD_SR0_SEEK if required

Signed-off-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: b1649fae49a899a222c3ac53c5009dd6f23349e1
      https://github.com/qemu/qemu/commit/b1649fae49a899a222c3ac53c5009dd6f23349e1
  Author: Gerhard Wiesinger &lt;lists@wiesinger.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M block/vmdk.c

  Log Message:
  -----------
  vmdk: Fix data corruption bug in WRITE and READ handling

Fixed a MAJOR BUG in VMDK files on file boundaries on reads
and ALSO ON WRITES WHICH MIGHT CORRUPT THE IMAGE AND DATA!!!!!!

Triggered for example with the following VMDK file (partly listed):
RW 4193792 FLAT "XP-W1-f001.vmdk" 0
RW 2097664 FLAT "XP-W1-f002.vmdk" 0
RW 4193792 FLAT "XP-W1-f003.vmdk" 0
RW 512 FLAT "XP-W1-f004.vmdk" 0
RW 4193792 FLAT "XP-W1-f005.vmdk" 0
RW 2097664 FLAT "XP-W1-f006.vmdk" 0
RW 4193792 FLAT "XP-W1-f007.vmdk" 0
RW 512 FLAT "XP-W1-f008.vmdk" 0

Patch includes:
1.) Patch fixes wrong calculation on extent boundaries. Especially it
fixes the relativeness of the sector number to the current extent.

Verfied correctness with:
1.) Converted either with Virtualbox to VDI and then with qemu-img and
    then with qemu-img only:

    VBoxManage clonehd --format vdi /VM/XP-W/new/XP-W1.vmdk \
                ~/.VirtualBox/Harddisks/XP-W1-new-test.vdi
    ./qemu-img convert -O raw ~/.VirtualBox/Harddisks/XP-W1-new-test.vdi \
/root/QEMU/VM-XP-W1/XP-W1-via-VBOX.img  md5sum /root/QEMU/VM-XP-W/XP-W1-direct.img
    md5sum /root/QEMU/VM-XP-W/XP-W1-via-VBOX.img
    =&gt; same MD5 hash

2.) Verified debug log files
3.) Run Windows XP successfully
4.) chkdsk run successfully without any errors

Signed-off-by: Gerhard Wiesinger &lt;lists@wiesinger.com&gt;
Acked-by: Fam Zheng &lt;famcool@gmail.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: b618f4a1c15d793c16c159059dd6f173e3e20f3e
      https://github.com/qemu/qemu/commit/b618f4a1c15d793c16c159059dd6f173e3e20f3e
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M hw/megasas.c

  Log Message:
  -----------
  megasas: Use bdrv_drain_all instead of qemu_aio_flush

Calling qemu_aio_flush() directly can hang when combined with I/O
throttling.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Acked-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: e7c8b094c2cf4f7e1609e24efffe3632cba84346
      https://github.com/qemu/qemu/commit/e7c8b094c2cf4f7e1609e24efffe3632cba84346
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M qemu-io.c

  Log Message:
  -----------
  qemu-io: Use bdrv_drain_all instead of qemu_aio_flush

This is harmless as of today because I/O throttling is not used in
qemu-io, however as soon as .bdrv_drain handlers will be introduced,
qemu-io must be sure to call bdrv_drain_all().

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: b0b873a07872f7ab7f66f259c73fb9dd42aa66a9
      https://github.com/qemu/qemu/commit/b0b873a07872f7ab7f66f259c73fb9dd42aa66a9
  Author: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M hw/acpi_piix4.c

  Log Message:
  -----------
  acpi_piix4: fix migration of gpe fields

Migrate 16 bytes for en/sts fields (which is the correct size),
increase version to 3, and document how to support incoming
migration from qemu-kvm 1.2.

Acked-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 78021d6d8dc50ed4d67442c3ca11eab78220e9ef
      https://github.com/qemu/qemu/commit/78021d6d8dc50ed4d67442c3ca11eab78220e9ef
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M kvm-all.c

  Log Message:
  -----------
  kvm: Actually remove software breakpoints from list on cleanup

So far we only removed them from the guest, leaving its states in the
list. This made it impossible for gdb to re-enable breakpoints on the
same address after re-attaching.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 04509ad939a7878b487b29e3500b79b5e2c1de35
      https://github.com/qemu/qemu/commit/04509ad939a7878b487b29e3500b79b5e2c1de35
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M qemu-common.h

  Log Message:
  -----------
  qemu-common.h: Comment about usage rules

Every time we make a tiny change on a header file, we often find
circular header dependency problems. To avoid this nightmare, we need to
stop including qemu-common.h from other headers, and we should gradually
move the declarations from the catch-all qemu-common.h header to their
specific headers.

This simply adds a comment documenting the rules about qemu-common.h,
hoping that people will see it before including qemu-common.h from other
header files, and before adding more declarations to qemu-common.h.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 5202ef942fb986011a31d9366fbf93a56f0056e4
      https://github.com/qemu/qemu/commit/5202ef942fb986011a31d9366fbf93a56f0056e4
  Author: Igor Mammedov &lt;imammedo@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M hw/arm-misc.h
    M hw/bt.h
    M hw/devices.h
    M hw/irq.h
    M hw/omap.h
    M hw/soc_dma.h
    M hw/xen.h
    M qemu-common.h

  Log Message:
  -----------
  Move qemu_irq typedef out of qemu-common.h

It's necessary for making CPU child of DEVICE without
causing circular header deps.

Signed-off-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
[ehabkost: re-added the typedef to hw/irq.h after rebasing]
Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 074a86fccd185616469dfcdc0e157f438aebba18
      https://github.com/qemu/qemu/commit/074a86fccd185616469dfcdc0e157f438aebba18
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M hw/mc146818rtc.c
    M hw/qdev-addr.c
    A hw/qdev-core.h
    A hw/qdev-monitor.h
    M hw/qdev-properties.c
    A hw/qdev-properties.h
    M hw/qdev.c
    M hw/qdev.h

  Log Message:
  -----------
  qdev: Split up header so it can be used in cpu.h

Header file dependency is a frickin' nightmare right now.  cpu.h tends
to get included in our 'include everything' header files but qdev also
needs to include those headers mainly for qdev-properties since it knows
about CharDriverState and friends.

We can solve this for now by splitting out qdev.h along the same lines
that we previously split the C file.  Then cpu.h just needs to include
qdev-core.h.

hw/qdev.h is split into following new headers:
    hw/qdev-core.h
    hw/qdev-properties.h
    hw/qdev-monitor.h

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;

[ehabkost: re-add DEFINE_PROP_PCI_HOST_DEVADDR, that was removed on the
 original patch (by mistake, I guess)]
[ehabkost: kill qdev_prop_set_vlan() declaration]
[ehabkost: moved get_fw_dev_path() comment to the original location
 (I don't know why it was moved)]
[ehabkost: removed qdev_exists() declaration]
[ehabkost: keep using 'QemuOpts' instead of 'struct QemuOpts', as
 qdev-core.h includes qemu-option.h]

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 017cf5b1d22f80f36dc4c5aba465b178cc209d35
      https://github.com/qemu/qemu/commit/017cf5b1d22f80f36dc4c5aba465b178cc209d35
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M fsdev/qemu-fsdev-dummy.c

  Log Message:
  -----------
  qemu-fsdev-dummy.c: Include module.h

module.h is where machine_init() is defined, but qemu-fsdev-dummy.c
doesn't include it.

The header is probably being included by accident because some other
headers are including qemu-common.h, but those headers should eventually
stop including qemu-common.h.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: bcbb78c6b6db9e784448a8b521c14af083585ce4
      https://github.com/qemu/qemu/commit/bcbb78c6b6db9e784448a8b521c14af083585ce4
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M ui/vnc-palette.h

  Log Message:
  -----------
  vnc-palette.h: Include &lt;stdbool.h&gt;

&lt;stdbool.h&gt; is needed for the 'bool' type, used in the header.

The header is probably being included by accident because some other
headers are including qemu-common.h, but those headers should eventually
stop including qemu-common.h.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: c8aba9ced945a59fe2638d34660a940a3e727038
      https://github.com/qemu/qemu/commit/c8aba9ced945a59fe2638d34660a940a3e727038
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M qemu-config.h

  Log Message:
  -----------
  qemu-config.h: Include headers it needs

Include:
- &lt;stdio.h&gt; for FILE
- qemu-option.h for QemuOptsList

Some of those headers were probably being included by accident because
some other headers were including qemu-common.h, but those headers
should eventually stop including qemu-common.h.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 17e0b6ab08bd272aee24bd1a173bf0adc708d0aa
      https://github.com/qemu/qemu/commit/17e0b6ab08bd272aee24bd1a173bf0adc708d0aa
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M osdep.h
    M qemu-common.h

  Log Message:
  -----------
  osdep: Move qemu_{open,close}() prototypes

They are implemented in osdep.c, so keep the prototypes in osdep.h.

Suggested-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Acked-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;


  Commit: da4fea066d9e08654940801d46e350a8bbd56547
      https://github.com/qemu/qemu/commit/da4fea066d9e08654940801d46e350a8bbd56547
  Author: Igor Mammedov &lt;imammedo@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M scripts/qapi-types.py

  Log Message:
  -----------
  qapi-types.h: Don't include qemu-common.h

Needed to prevent build breakage when CPUState becomes a child of
DeviceState.

Signed-off-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
[ehabkost: include &lt;stdbool.h&gt; too]
Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: c8acc380be7c7bb489037c927a2a5c217535f864
      https://github.com/qemu/qemu/commit/c8acc380be7c7bb489037c927a2a5c217535f864
  Author: Andre Przywara &lt;osp@andrep.de&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M target-i386/cpu.c
    M target-i386/cpu.h

  Log Message:
  -----------
  target-i386/cpu: Name new CPUID bits

Update QEMU's knowledge of CPUID bit names. This allows to
enable/disable those new features on QEMU's command line when
using KVM and prepares future feature enablement in QEMU.

This adds F16C, RDRAND, LWP, TBM, TopoExt, PerfCtr_Core, PerfCtr_NB,
FSGSBASE, BMI1, AVX2, BMI2, ERMS, PCID, InvPCID, RTM, RDSeed and ADX.

Sources where the AMD BKDG for Family 15h/Model 10h, Intel Software
Developer Manual, and the Linux kernel for the leaf 7 bits.

Signed-off-by: Andre Przywara &lt;osp@andrep.de&gt;
Signed-off-by: Boris Ostrovsky &lt;boris.ostrovsky@amd.com&gt;
[ehabkost: added CPUID_EXT_PCID]
[ehabkost: edited commit message]
[ehabkost: rebased against latest qemu.git master]
Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Reviewed-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 021941b9d97127bbd62a2ca39208d6a5d486b3cb
      https://github.com/qemu/qemu/commit/021941b9d97127bbd62a2ca39208d6a5d486b3cb
  Author: Andre Przywara &lt;osp@andrep.de&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386/cpu: Add new Opteron CPU model

Add a new base CPU model called Opteron_G5 to model the latest
Opteron CPUs. This increases the model value and model numbers and
adds TBM, F16C and FMA over the latest G4 model.

Signed-off-by: Andre Przywara &lt;osp@andrep.de&gt;
Signed-off-by: Boris Ostrovsky &lt;boris.ostrovsky@amd.com&gt;
[ehabkost: edited commit message]
Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Reviewed-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 37507094f350b75c62dc059f998e7185de3ab60a
      https://github.com/qemu/qemu/commit/37507094f350b75c62dc059f998e7185de3ab60a
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-11-14 (Wed, 14 Nov 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: Add Haswell CPU model

Features added to the model, in relation to SandyBridge:

fma       CPUID[1].ECX[12]
pcid      CPUID[1].ECX[17]
movbe     CPUID[1].ECX[22]
fsgsbase  CPUID[EAX=7,ECX=0].EBX[0]
bmi1      CPUID[EAX=7,ECX=0].EBX[3]
hle       CPUID[EAX=7,ECX=0].EBX[4]
avx2      CPUID[EAX=7,ECX=0].EBX[5]
smep      CPUID[EAX=7,ECX=0].EBX[7]
bmi2      CPUID[EAX=7,ECX=0].EBX[8]
erms      CPUID[EAX=7,ECX=0].EBX[9]
invpcid   CPUID[EAX=7,ECX=0].EBX[10]
rtm       CPUID[EAX=7,ECX=0].EBX[11]

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Reviewed-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 1a89b60885ccc2abf7cc50275fcee70d0347425e
      https://github.com/qemu/qemu/commit/1a89b60885ccc2abf7cc50275fcee70d0347425e
  Author: Nickolai Zeldovich &lt;nickolai@csail.mit.edu&gt;
  Date:   2012-11-15 (Thu, 15 Nov 2012)

  Changed paths:
    M slirp/arp_table.c

  Log Message:
  -----------
  slirp: Don't crash on packets from 0.0.0.0/8.

LWIP can generate packets with a source of 0.0.0.0, which triggers an
assertion failure in arp_table_add().  Instead of crashing, simply return
to avoid adding an invalid ARP table entry.

Signed-off-by: Nickolai Zeldovich &lt;nickolai@csail.mit.edu&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;


  Commit: 63d2960bc46f63137d7fbd5ff56b81e54710d195
      https://github.com/qemu/qemu/commit/63d2960bc46f63137d7fbd5ff56b81e54710d195
  Author: Klaus Stengel &lt;Klaus.Stengel@asamnet.de&gt;
  Date:   2012-11-15 (Thu, 15 Nov 2012)

  Changed paths:
    M net/slirp.c
    M qapi-schema.json
    M qemu-options.hx
    M slirp/Makefile.objs
    M slirp/bootp.c
    A slirp/dnssearch.c
    M slirp/libslirp.h
    M slirp/slirp.c
    M slirp/slirp.h

  Log Message:
  -----------
  slirp: Add domain-search option to slirp's DHCP server

This patch will allow the user to include the domain-search option in
replies from the built-in DHCP server. The domain suffixes can be
specified by adding dnssearch= entries to the "-net user" parameter.

[Jan: tiny style adjustments]

Signed-off-by: Klaus Stengel &lt;Klaus.Stengel@asamnet.de&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;


  Commit: 80dcfb8532ae76343109a48f12ba8ca1c505c179
      https://github.com/qemu/qemu/commit/80dcfb8532ae76343109a48f12ba8ca1c505c179
  Author: Alon Levy &lt;alevy@redhat.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M hw/virtio-serial-bus.c

  Log Message:
  -----------
  virtio-serial-bus: post_load send_event when vm is running

Alexander Larsson found irq injection to Windows guests stopped after a
migration.  The symptom was the mouse stopped working.

Reproduction steps are:
1. On src, start qemu with a virtio-serial port without any backend
2. On dest, start qemu with a virtio-serial port with a backend
3. Migrate.

Upon migration, the older code detected the change in backend connection
status, and sent a notification to the guest.  However, it's not
guaranteed that the apic is ready to inject irqs into the guest, and the
irq line remained high, resulting in any future interrupts going
unnoticed by the guest as well.

Add a new timer based on vm_clock for 1 ns in the future from post_load
to do the event send in case host_connected differs between migration
source and target.

RHBZ: 867366

Signed-off-by: Alon Levy &lt;alevy@redhat.com&gt;
Acked-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Amit Shah &lt;amit.shah@redhat.com&gt; # verbose commit log


  Commit: 4ea375bf37d655bbf1696239ebea8575956bb226
      https://github.com/qemu/qemu/commit/4ea375bf37d655bbf1696239ebea8575956bb226
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M hw/pci.c

  Log Message:
  -----------
  fix live migration

Commit 1c380f9460522f32c8dd2577b2a53d518ec91c6d breaks live migration.
DMA stops working for ehci (and probably for any pci device) after
restoring the guest because the bus master region never gets enabled.
Add code doing that after loading the pci config space from vmstate.

Cc: Avi Kivity &lt;avi@redhat.com&gt;
Cc: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 155de06f2480219ea99916ddb9ad61b622b8f51f
      https://github.com/qemu/qemu/commit/155de06f2480219ea99916ddb9ad61b622b8f51f
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M hw/usb/libhw.c

  Log Message:
  -----------
  usb: Fix (another) bug in usb_packet_map() for IOMMU handling

Elements in qemu SGLists can cross IOMMU page boundaries.  So, in commit
39c138c8420f51a7da7b35233a8d7400a0b589ac "usb: Fix usb_packet_map() in the
presence of IOMMUs", I changed usb_packet_map() to split up each SGList
element on IOMMU page boundaries and each resulting piece of qemu's memory
space separately to the iovec the usb code uses internally.

That was correct in concept, but the patch has a bug.  The 'base' variable
correctly steps through the dma address of each piece, but then we call
the dma_memory_map() function on the base address of the whole SGList
element every time.

This patch fixes at least one problem using XHCI on the pseries guest
machine.  It didn't affect OHCI because that doesn't use usb_packet_map().
In theory it also affects EHCI, but we haven't observed that in practice.
I think the transfers were small enough on EHCI that they never crossed an
IOMMU page boundary in practice.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: c06c68c928edd36eb56baa0d2db065bbec28af27
      https://github.com/qemu/qemu/commit/c06c68c928edd36eb56baa0d2db065bbec28af27
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M hw/usb/host-linux.c

  Log Message:
  -----------
  usb-host: scan for usb devices when the vm starts

Commit a844ed842d9a9d929645c09ae0f52f753d7a02e0 leads to usb-host
detecting devices not right after qemu startup because the guest
isn't running yet.  Instead they are found on the first of the
regular usb device poll runs.  Which is too late for seabios to see
them, so booting from usb sticks fails.

Fix this by adding a vm state change handler which triggers a device
scan when the vm is started.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 537e8f1aa838677c8efd5e0966e89c4b5423dd18
      https://github.com/qemu/qemu/commit/537e8f1aa838677c8efd5e0966e89c4b5423dd18
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M hw/usb/host-linux.c

  Log Message:
  -----------
  usb: host-linux: Ignore parsing errors of the device descriptors

The Linux is more tolerant here as well: Just stop parsing the device
descriptors when an error is detected but do not reset what was found
so far. This allows to run buggy devices with partially invalid
descriptors.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 30d68cf6e156b97fc462e18f38ce83f44702cd7f
      https://github.com/qemu/qemu/commit/30d68cf6e156b97fc462e18f38ce83f44702cd7f
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Don't access packet after freeing it

ehci_state_writeback() will free the packet, so we should not access
the packet after calling ehci_state_writeback().

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: ff80ce599e0465cc6109a38bd3a8ca1890e88891
      https://github.com/qemu/qemu/commit/ff80ce599e0465cc6109a38bd3a8ca1890e88891
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Fixup q-&gt;qtdaddr after cancelling an already completed packet

This avoids the q-&gt;qtdaddr == p-&gt;qtdaddr asserts we have triggering, when
a queue contains multiple completed packages when we cancel the queue.

I triggered this with windows7 + async interrupt endpoint handling (*)
+ not detecting circles in ehci_fill_queue() properly, which makes the qtd
validation in ehci_fill_queue fail, causing cancellation of the queue on every
mouse event ...

*) Which is not going upstream as it will cause loss of interrupt events on
migration.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 601a234731602df7c2bf6d01301c6eec4b1d1a5a
      https://github.com/qemu/qemu/commit/601a234731602df7c2bf6d01301c6eec4b1d1a5a
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Better detection for qtd-s linked in circles

Windows links interrupt qtd-s in circles, which means that when interrupt
endpoints return USB_RET_ASYNC, combined with the recent
"ehci: Retry to fill the queue while waiting for td completion" patch,
we keep adding the tds to the queue over and over again, as we detect the
circle from fill_queue, but we call it over and over again ...

This patch fixes this by changing the circle detection to also detect
circling into tds already queued up previously.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 2c7b15c1dec4b2ec17549c760df0b7a7cea3ed7d
      https://github.com/qemu/qemu/commit/2c7b15c1dec4b2ec17549c760df0b7a7cea3ed7d
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Don't verify the next pointer for periodic qh-s and qtd-s

While testing the move to async packet handling for interrupt endpoints I
noticed that Windows-XP likes to play tricks with the next pointer for
periodic qh-s, so we should not fail qh / qtd verification when it changes.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 40862309a9d733cb0e878c79f477de003897b5d2
      https://github.com/qemu/qemu/commit/40862309a9d733cb0e878c79f477de003897b5d2
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: keep the frame timer running in case the guest asked for frame list rollover \
interrupts

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 55903f1d2d8abfa8d7610ab32a4046a1ed4fdbb8
      https://github.com/qemu/qemu/commit/55903f1d2d8abfa8d7610ab32a4046a1ed4fdbb8
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M hw/usb/hcd-ehci-pci.c
    M hw/usb/hcd-ehci.c
    M trace-events

  Log Message:
  -----------
  ehci: handle dma errors

Starting with commit 1c380f9460522f32c8dd2577b2a53d518ec91c6d dma
transfers can actually fail.  This patch makes ehci keep track
of the busmaster bit in pci config space, by setting/clearing the
dma_context pointer.  Attempts to dma without context will result
in raising HSE (Host System Error) interrupt and stopping the host
controller.

This patch fixes WinXP not booting with a usb stick attached to ehci.
Root cause is seabios activating ehci so you can boot from the stick,
and WinXP clearing the busmaster bit before resetting the host
controller, leading to ehci actually trying dma while it is disabled.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 2cb343b442c98b45d1187f5691c45b3c114f3b04
      https://github.com/qemu/qemu/commit/2cb343b442c98b45d1187f5691c45b3c114f3b04
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Only add actually in flight packets to the in flight queue

Packets which are queued up, but not yet handed over to the device, are
*not* in flight.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 618fbc951d190734bac73d86abd1a77180a83050
      https://github.com/qemu/qemu/commit/618fbc951d190734bac73d86abd1a77180a83050
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Set default debug level to warning

The previous default of 0 means that even errors and warnings would not
get printed, which is really not a good default.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 8c908fca584dbf47094b63f132bb49b82eaa3e19
      https://github.com/qemu/qemu/commit/8c908fca584dbf47094b63f132bb49b82eaa3e19
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M hw/usb/host-linux.c
    M trace-events

  Log Message:
  -----------
  usb-host: update tracing

Now that we have separate status and length fields in USBPacket
update the completion tracepoint to log both.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 71e0aa3930e7ac2e039b175ffad222e3dc5b1813
      https://github.com/qemu/qemu/commit/71e0aa3930e7ac2e039b175ffad222e3dc5b1813
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M hw/usb/host-linux.c

  Log Message:
  -----------
  usb-host: fix splitted transfers

USBPacket-&gt;actual_length wasn't updated correctly for USBPackets
splitted into multiple urbs.  Fix it.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 81dee729c1a8fccaab8cd978721acca0282f43c9
      https://github.com/qemu/qemu/commit/81dee729c1a8fccaab8cd978721acca0282f43c9
  Author: Daniel P. Berrange &lt;berrange@redhat.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M scripts/tracetool/backend/dtrace.py

  Log Message:
  -----------
  Avoid all systemtap reserved words

Over time various systemtap reserved words have been blacklisted
in the trace backend generator. The list is not complete though,
so there is continued risk of problems in the future. Preempt
such problems by specifying the full list of systemtap keywords
listed in its parser as identified here:

  http://sourceware.org/ml/systemtap/2012-q4/msg00157.html

Signed-off-by: Daniel P. Berrange &lt;berrange@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: ddde8acc989d9e59b37605d438d5cb6b5ce8fbae
      https://github.com/qemu/qemu/commit/ddde8acc989d9e59b37605d438d5cb6b5ce8fbae
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M trace/control.c

  Log Message:
  -----------
  trace: allow disabling events in events file

Disable trace events prefixed with a '-'.  Useful
to enable a group of tracepoints with exceptions,
like this:

  usb_xhci_port_*
  -usb_xhci_port_read

which will enable all xhci port tracepoints except reads.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 8f5a0fb1f4e3167b893e3a4272446e2cf1568058
      https://github.com/qemu/qemu/commit/8f5a0fb1f4e3167b893e3a4272446e2cf1568058
  Author: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M docs/tracing.txt

  Log Message:
  -----------
  trace: document '-' syntax for disabling events

Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: e94c4c9287392e9c4de5e9cc3a0fa40da959ccb5
      https://github.com/qemu/qemu/commit/e94c4c9287392e9c4de5e9cc3a0fa40da959ccb5
  Author: Liming Wang &lt;walimisdev@gmail.com&gt;
  Date:   2012-11-16 (Fri, 16 Nov 2012)

  Changed paths:
    M docs/tracing.txt
    M hmp-commands.hx

  Log Message:
  -----------
  trace: Remove "info trace" from documents

commit 88affa1c monitor: remove unused do_info_trace

has removed "info trace" function from monitor, so remove it from documents.

Signed-off-by: Liming Wang &lt;walimisdev@gmail.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 31a322895851cddf648f95954af4725d71d778a4
      https://github.com/qemu/qemu/commit/31a322895851cddf648f95954af4725d71d778a4
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-19 (Mon, 19 Nov 2012)

  Changed paths:
    M libcacard/Makefile

  Log Message:
  -----------
  libcacard: make unnesting rules available to Makefile.objs

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: a636be69a8da6807a75fd441d245dcf610172a40
      https://github.com/qemu/qemu/commit/a636be69a8da6807a75fd441d245dcf610172a40
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-19 (Mon, 19 Nov 2012)

  Changed paths:
    M libcacard/Makefile

  Log Message:
  -----------
  libcacard: link in stubs

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 2b84c2be00a5d5b2fb23700fd9051657be3cc9e0
      https://github.com/qemu/qemu/commit/2b84c2be00a5d5b2fb23700fd9051657be3cc9e0
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-19 (Mon, 19 Nov 2012)

  Changed paths:
    M tests/Makefile

  Log Message:
  -----------
  tests: link in stubs

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 16529cedcef18bf116f10279e9c9abb6645467d6
      https://github.com/qemu/qemu/commit/16529cedcef18bf116f10279e9c9abb6645467d6
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-11-19 (Mon, 19 Nov 2012)

  Changed paths:
    M Makefile

  Log Message:
  -----------
  Makefile: Add missing dependency (fix parallel builds)

The executables in i386-softmmu, i386-linux-user, ...
depend on the recently added libqemustub.a.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: e75fce6cda8cd515645e0bd16ed4ef6260d777c7
      https://github.com/qemu/qemu/commit/e75fce6cda8cd515645e0bd16ed4ef6260d777c7
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-19 (Mon, 19 Nov 2012)

  Changed paths:
    M backends/Makefile.objs

  Log Message:
  -----------
  rng-random: only build on POSIX platforms

There is no /dev/random on win32.

Cc: Stefan Weil &lt;weil@mail.berlios.de&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: d167dac993bc8223eb20b45e009bff22abd83354
      https://github.com/qemu/qemu/commit/d167dac993bc8223eb20b45e009bff22abd83354
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-19 (Mon, 19 Nov 2012)

  Changed paths:
    M hw/acpi_piix4.c
    M kvm-all.c

  Log Message:
  -----------
  Merge remote-tracking branch 'qemu-kvm/uq/master' into staging

* qemu-kvm/uq/master:
  kvm: Actually remove software breakpoints from list on cleanup
  acpi_piix4: fix migration of gpe fields

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: f44d771a8cfb3a22f9de76f8aae1832ee671ecd7
      https://github.com/qemu/qemu/commit/f44d771a8cfb3a22f9de76f8aae1832ee671ecd7
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-19 (Mon, 19 Nov 2012)

  Changed paths:
    M fsdev/qemu-fsdev-dummy.c
    M hw/arm-misc.h
    M hw/bt.h
    M hw/devices.h
    M hw/irq.h
    M hw/mc146818rtc.c
    M hw/omap.h
    M hw/qdev-addr.c
    A hw/qdev-core.h
    A hw/qdev-monitor.h
    M hw/qdev-properties.c
    A hw/qdev-properties.h
    M hw/qdev.c
    M hw/qdev.h
    M hw/soc_dma.h
    M hw/xen.h
    M osdep.h
    M qemu-common.h
    M qemu-config.h
    M scripts/qapi-types.py
    M target-i386/cpu.c
    M target-i386/cpu.h
    M ui/vnc-palette.h

  Log Message:
  -----------
  Merge remote-tracking branch 'afaerber/qom-cpu' into staging

* afaerber/qom-cpu:
  target-i386: Add Haswell CPU model
  target-i386/cpu: Add new Opteron CPU model
  target-i386/cpu: Name new CPUID bits
  qapi-types.h: Don't include qemu-common.h
  osdep: Move qemu_{open,close}() prototypes
  qemu-config.h: Include headers it needs
  vnc-palette.h: Include &lt;stdbool.h&gt;
  qemu-fsdev-dummy.c: Include module.h
  qdev: Split up header so it can be used in cpu.h
  Move qemu_irq typedef out of qemu-common.h
  qemu-common.h: Comment about usage rules

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 698229eb284ae29dcaae2c686cbf5dcf02f783ad
      https://github.com/qemu/qemu/commit/698229eb284ae29dcaae2c686cbf5dcf02f783ad
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-19 (Mon, 19 Nov 2012)

  Changed paths:
    M hw/virtio-serial-bus.c

  Log Message:
  -----------
  Merge remote-tracking branch 'amit/loadvm-irq-inj-fix' into staging

* amit/loadvm-irq-inj-fix:
  virtio-serial-bus: post_load send_event when vm is running

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: c562d15d318e4ad9293032553472da71039a270f
      https://github.com/qemu/qemu/commit/c562d15d318e4ad9293032553472da71039a270f
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-19 (Mon, 19 Nov 2012)

  Changed paths:
    M docs/tracing.txt
    M hmp-commands.hx
    M scripts/tracetool/backend/dtrace.py
    M trace/control.c

  Log Message:
  -----------
  Merge remote-tracking branch 'stefanha/tracing' into staging

* stefanha/tracing:
  trace: Remove "info trace" from documents
  trace: document '-' syntax for disabling events
  trace: allow disabling events in events file
  Avoid all systemtap reserved words

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 5cc82c2d20bdf762519822d3eade5dec4846cee8
      https://github.com/qemu/qemu/commit/5cc82c2d20bdf762519822d3eade5dec4846cee8
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-19 (Mon, 19 Nov 2012)

  Changed paths:
    M hw/pci.c
    M hw/usb/hcd-ehci-pci.c
    M hw/usb/hcd-ehci.c
    M hw/usb/host-linux.c
    M hw/usb/libhw.c
    M hw/usb/redirect.c
    M trace-events

  Log Message:
  -----------
  Merge remote-tracking branch 'kraxel/usb.71' into staging

* kraxel/usb.71:
  usb-host: fix splitted transfers
  usb-host: update tracing
  usb-redir: Set default debug level to warning
  usb-redir: Only add actually in flight packets to the in flight queue
  ehci: handle dma errors
  ehci: keep the frame timer running in case the guest asked for frame list rollover \
interrupts  ehci: Don't verify the next pointer for periodic qh-s and qtd-s
  ehci: Better detection for qtd-s linked in circles
  ehci: Fixup q-&gt;qtdaddr after cancelling an already completed packet
  ehci: Don't access packet after freeing it
  usb: host-linux: Ignore parsing errors of the device descriptors
  usb-host: scan for usb devices when the vm starts
  usb: Fix (another) bug in usb_packet_map() for IOMMU handling
  fix live migration

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: ad1db3b341d3d55e6d722ad868bd48ed4425c9fb
      https://github.com/qemu/qemu/commit/ad1db3b341d3d55e6d722ad868bd48ed4425c9fb
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-19 (Mon, 19 Nov 2012)

  Changed paths:
    M MAINTAINERS
    M block.c
    M block/blkdebug.c
    M block/blkverify.c
    M block/curl.c
    M block/gluster.c
    M block/iscsi.c
    M block/linux-aio.c
    M block/qcow2-refcount.c
    M block/qed.c
    M block/rbd.c
    M block/sheepdog.c
    M block/vmdk.c
    M block/win32-aio.c
    M dma-helpers.c
    M hw/fdc.c
    M hw/ide/core.c
    M hw/megasas.c
    M qemu-aio.h
    M qemu-doc.texi
    M qemu-io.c
    M qemu-options.hx
    M tests/fdc-test.c
    A tests/qemu-iotests/044
    A tests/qemu-iotests/044.out
    M tests/qemu-iotests/common
    M tests/qemu-iotests/common.config
    M tests/qemu-iotests/common.rc
    M tests/qemu-iotests/group
    M tests/qemu-iotests/iotests.py
    M tests/qemu-iotests/qcow2.py
    M thread-pool.c

  Log Message:
  -----------
  Merge remote-tracking branch 'kwolf/for-anthony' into staging

* kwolf/for-anthony: (26 commits)
  qemu-io: Use bdrv_drain_all instead of qemu_aio_flush
  megasas: Use bdrv_drain_all instead of qemu_aio_flush
  vmdk: Fix data corruption bug in WRITE and READ handling
  fdc: remove last usage of FD_STATE_SEEK
  fdc: fix typo in zero constant
  fdc: remove double affectation of FD_MSR_CMDBUSY flag
  fdc-tests: add tests for VERIFY command
  fdc: implement VERIFY command
  fdc-test: Check READ ID
  fdc: fix false FD_SR0_SEEK
  fdc: fix FD_SR0_SEEK for initial seek on DMA transfers
  fdc: fix FD_SR0_SEEK for non-DMA transfers and multi sectors transfers
  fdc: use status0 field instead of a local variable
  fdc-test: add tests for non-DMA READ command
  fdc-test: insert media before fuzzing registers
  fdc-test: split test_media_change() test, so insert part can be reused
  fdc: Remove status0 parameter from fdctrl_set_fifo()
  aio: rename AIOPool to AIOCBInfo
  aio: use g_slice_alloc() for AIOCB pooling
  aio: switch aiocb_size type int -&gt; size_t
  ...

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 2954525b3b8474fa1d637dd3822ab35c95596856
      https://github.com/qemu/qemu/commit/2954525b3b8474fa1d637dd3822ab35c95596856
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-19 (Mon, 19 Nov 2012)

  Changed paths:
    M Makefile
    M libcacard/Makefile
    M tests/Makefile

  Log Message:
  -----------
  Merge remote-tracking branch 'bonzini/build-urgent' into staging

* bonzini/build-urgent:
  Makefile: Add missing dependency (fix parallel builds)
  tests: link in stubs
  libcacard: link in stubs
  libcacard: make unnesting rules available to Makefile.objs

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: a36e9561283e91a17cbc451835b99db35424c34b
      https://github.com/qemu/qemu/commit/a36e9561283e91a17cbc451835b99db35424c34b
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-19 (Mon, 19 Nov 2012)

  Changed paths:
    M net/slirp.c
    M qapi-schema.json
    M qemu-options.hx
    M slirp/Makefile.objs
    M slirp/arp_table.c
    M slirp/bootp.c
    A slirp/dnssearch.c
    M slirp/libslirp.h
    M slirp/slirp.c
    M slirp/slirp.h

  Log Message:
  -----------
  Merge remote-tracking branch 'kiszka/queues/slirp' into staging

* kiszka/queues/slirp:
  slirp: Add domain-search option to slirp's DHCP server
  slirp: Don't crash on packets from 0.0.0.0/8.

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/e24dc9feb0d6...a36e9561283e

----==_mimepart_50aa65a766cab_3c0e10d0aec129417--


</body></email><email><emailId>20121119183008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-19 18:30:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] ecdffb: tcg/ppc: Remove unused s_bits variable</subject><body>



----==_mimepart_50aa7ab02a207_629e101aae4481c1
Date: Mon, 19 Nov 2012 10:30:08 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50aa7ab02b64f_629e101aae448289@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: ecdffbccd783cd79eb3ce206375270de54046ea0
      https://github.com/qemu/qemu/commit/ecdffbccd783cd79eb3ce206375270de54046ea0
  Author: malc &lt;av1474@comtv.ru&gt;
  Date:   2012-11-19 (Mon, 19 Nov 2012)

  Changed paths:
    M tcg/ppc/tcg-target.c

  Log Message:
  -----------
  tcg/ppc: Remove unused s_bits variable

Thanks to Alexander Graf for heads up.

Signed-off-by: malc &lt;av1474@comtv.ru&gt;


  Commit: 456a84d156a7c42f18b1da176dd6219e2dffd043
      https://github.com/qemu/qemu/commit/456a84d156a7c42f18b1da176dd6219e2dffd043
  Author: malc &lt;av1474@comtv.ru&gt;
  Date:   2012-11-19 (Mon, 19 Nov 2012)

  Changed paths:
    M audio/wavcapture.c

  Log Message:
  -----------
  audio/wavcapture: Clarify licensing

Signed-off-by: malc &lt;av1474@comtv.ru&gt;


  Commit: 72bc6f1bf710e205f175af9b1fc8bbd83e8da71f
      https://github.com/qemu/qemu/commit/72bc6f1bf710e205f175af9b1fc8bbd83e8da71f
  Author: malc &lt;av1474@comtv.ru&gt;
  Date:   2012-11-19 (Mon, 19 Nov 2012)

  Changed paths:
    M audio/audio_pt_int.c

  Log Message:
  -----------
  audio/audio_pt_int: Clarify licensing

Signed-off-by: malc &lt;av1474@comtv.ru&gt;


Compare: https://github.com/qemu/qemu/compare/a36e9561283e...72bc6f1bf710

----==_mimepart_50aa7ab02a207_629e101aae4481c1--


</body></email><email><emailId>20121119233012</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-19 23:30:12-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 1d2a67: Update version for 1.3.0-rc0 release</subject><body>



----==_mimepart_50aac104d2176_1078ea3ae49568
Date: Mon, 19 Nov 2012 15:30:12 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50aac104d3337_1078ea3ae49578e@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 1d2a67f89abee0cef4e3d8a8dec739ef0be77120
      https://github.com/qemu/qemu/commit/1d2a67f89abee0cef4e3d8a8dec739ef0be77120
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-19 (Mon, 19 Nov 2012)

  Changed paths:
    M VERSION

  Log Message:
  -----------
  Update version for 1.3.0-rc0 release

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;




----==_mimepart_50aac104d2176_1078ea3ae49568--


</body></email><email><emailId>20121119233015</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-19 23:30:15-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu]</subject><body>



----==_mimepart_50aac1071a3fd_27971963aec6515b
Date: Mon, 19 Nov 2012 15:30:15 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50aac1071b729_27971963aec6521b@sh2.rs.github.com.mail&gt;

  Branch: refs/tags/v1.3.0-rc0
  Home:   https://github.com/qemu/qemu


----==_mimepart_50aac1071a3fd_27971963aec6515b--


</body></email><email><emailId>20121120013038</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-20 01:30:38-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 814395: target-xtensa: convert host errno values to guest</subject><body>



----==_mimepart_50aadd3edbfef_781e108aaec32445
Date: Mon, 19 Nov 2012 17:30:38 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50aadd3ee64fd_781e108aaec32517@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/stable-1.2
  Home:   https://github.com/qemu/qemu
  Commit: 814395979efbca6b5f0ec83f7c6a77d9fba22427
      https://github.com/qemu/qemu/commit/814395979efbca6b5f0ec83f7c6a77d9fba22427
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-xtensa/xtensa-semi.c

  Log Message:
  -----------
  target-xtensa: convert host errno values to guest

Guest errno values are taken from the newlib. Convert only those errno
values that can be returned from used system calls.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 631287933e55adc272c57a6f8b3c09801c10c603
      https://github.com/qemu/qemu/commit/631287933e55adc272c57a6f8b3c09801c10c603
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-cris/translate.c

  Log Message:
  -----------
  target-cris: Fix buffer overflow

Report from smatch:

target-cris/translate.c:3464 cpu_dump_state(32) error:
 buffer overflow 'env-&gt;sregs' 4 &lt;= 255

sregs is declared 'uint32_t sregs[4][16]', so the first index must be
less than 4 or ARRAY_SIZE(env-&gt;sregs).

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: dafd8866beba60d2e3e2e3af4c3ed60538051cf0
      https://github.com/qemu/qemu/commit/dafd8866beba60d2e3e2e3af4c3ed60538051cf0
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-xtensa/xtensa-semi.c

  Log Message:
  -----------
  target-xtensa: fix missing errno codes for mingw32

Put the following errno value mappings under #ifdef:

xtensa-semi.c: In function 'errno_h2g':
xtensa-semi.c:113: error: 'ENOTBLK' undeclared (first use in this function)
xtensa-semi.c:113: error: (Each undeclared identifier is reported only once
xtensa-semi.c:113: error: for each function it appears in.)
xtensa-semi.c:113: error: array index in initializer not of integer type
xtensa-semi.c:113: error: (near initialization for 'guest_errno')
xtensa-semi.c:124: error: 'ETXTBSY' undeclared (first use in this function)
xtensa-semi.c:124: error: array index in initializer not of integer type
xtensa-semi.c:124: error: (near initialization for 'guest_errno')
xtensa-semi.c:134: error: 'ELOOP' undeclared (first use in this function)
xtensa-semi.c:134: error: array index in initializer not of integer type
xtensa-semi.c:134: error: (near initialization for 'guest_errno')

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: b16148e1c6de2d71ed048c86eeb9e2c05a9eb06a
      https://github.com/qemu/qemu/commit/b16148e1c6de2d71ed048c86eeb9e2c05a9eb06a
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-sparc/fop_helper.c

  Log Message:
  -----------
  target-sparc: fix fcmp{s,d,q} instructions wrt exception

fcmp{s,d,q} instructions are supposed to ignore quiet NaN (contrary to
the fcmpe{s,d,q} instructions), but the current code is wrongly setting
the NV exception in that case. Moreover the current code is duplicated:
first the arguments are checked for NaN to generate an exception, and
later in case the comparison is unordered (which can only happens if one
of the argument is a NaN), the same check is done to generate an
exception.

Fix that by calling clear_float_exceptions() followed by
check_ieee_exceptions() as for the other floating point instructions.
Use the _compare_quiet functions for fcmp{s,d,q} and the _compare ones
for fcmpe{s,d,q}. Simplify the flag setting by not clearing a flag that
is set the line just below.

This fix allows the math glibc testsuite to pass.

Cc: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: b05900a7615a50acfa6d0d839b779d4bc14eb0e4
      https://github.com/qemu/qemu/commit/b05900a7615a50acfa6d0d839b779d4bc14eb0e4
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-s390x/helper.c
    M target-s390x/op_helper.c

  Log Message:
  -----------
  target-s390x: fix style

Before splitting op_helper.c and helper.c in the next patches,
fix style issues. No functional changes.

Replace also GCC specific __FUNCTION__ with
standard __func__.

Don't init static variable (cpu_s390x_init:inited) with 0.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 4bae8a0a900e8515fdc83aec22cb038987ada277
      https://github.com/qemu/qemu/commit/4bae8a0a900e8515fdc83aec22cb038987ada277
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-s390x/Makefile.objs
    M target-s390x/cpu.h
    A target-s390x/fpu_helper.c
    M target-s390x/op_helper.c
    M target-s390x/translate.c

  Log Message:
  -----------
  target-s390x: split FPU ops

Move floating point instructions to fpu_helper.c.

While exporting some condition code helpers,
avoid duplicate identifier conflict with translate.c.

Remove unused set_cc_nz_f64() in translate.c.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: f7c50726dd57e255b66d1369cd7883b49b0aa1aa
      https://github.com/qemu/qemu/commit/f7c50726dd57e255b66d1369cd7883b49b0aa1aa
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-s390x/Makefile.objs
    A target-s390x/cc_helper.c
    M target-s390x/cpu.h
    M target-s390x/op_helper.c

  Log Message:
  -----------
  target-s390x: split condition code helpers

Move condition code helpers to cc_helper.c.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 7dc581be443c398cb745e55a3d474286b43bd533
      https://github.com/qemu/qemu/commit/7dc581be443c398cb745e55a3d474286b43bd533
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-s390x/Makefile.objs
    A target-s390x/int_helper.c
    M target-s390x/op_helper.c

  Log Message:
  -----------
  target-s390x: split integer helpers

Move integer helpers to int_helper.c.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 84dde20eea46d8ed4a02dd3f92a7cbcc9aea75ae
      https://github.com/qemu/qemu/commit/84dde20eea46d8ed4a02dd3f92a7cbcc9aea75ae
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-s390x/Makefile.objs
    A target-s390x/mem_helper.c
    M target-s390x/op_helper.c

  Log Message:
  -----------
  target-s390x: split memory access helpers

Move memory access helpers to mem_helper.c.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
[agraf: fold softmmu include ifdefs together]
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 1a392c895791dd7f3f880419e62c48188b15f573
      https://github.com/qemu/qemu/commit/1a392c895791dd7f3f880419e62c48188b15f573
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-s390x/Makefile.objs
    M target-s390x/cpu.h
    A target-s390x/misc_helper.c
    R target-s390x/op_helper.c

  Log Message:
  -----------
  target-s390x: rename op_helper.c to misc_helper.c

Now op_helper.c contains miscellaneous helpers, rename
it to misc_helper.c.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
[agraf: fix conflict]
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 313e38b4a155df8ca806bf93ce4abe1402cd4243
      https://github.com/qemu/qemu/commit/313e38b4a155df8ca806bf93ce4abe1402cd4243
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-s390x/Makefile.objs
    M target-s390x/cc_helper.c
    M target-s390x/cpu.h
    M target-s390x/fpu_helper.c
    M target-s390x/helper.h
    M target-s390x/mem_helper.c
    M target-s390x/translate.c

  Log Message:
  -----------
  target-s390x: avoid AREG0 for FPU helpers

Make FPU helpers take a parameter for CPUState instead
of relying on global env.

Introduce temporary wrappers for FPU load and store ops.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 1f983b49f7d54780e1234f594deb66785871e2e5
      https://github.com/qemu/qemu/commit/1f983b49f7d54780e1234f594deb66785871e2e5
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-s390x/Makefile.objs
    M target-s390x/helper.h
    M target-s390x/int_helper.c
    M target-s390x/translate.c

  Log Message:
  -----------
  target-s390x: avoid AREG0 for integer helpers

Make integer helpers take a parameter for CPUState instead
of relying on global env.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 719a60ddb3d239611126ef3ae8a2caf4828cea81
      https://github.com/qemu/qemu/commit/719a60ddb3d239611126ef3ae8a2caf4828cea81
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-s390x/Makefile.objs
    M target-s390x/cc_helper.c
    M target-s390x/helper.h
    M target-s390x/translate.c

  Log Message:
  -----------
  target-s390x: avoid AREG0 for condition code helpers

Make condition code helpers take a parameter for CPUState instead
of relying on global env.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 71742e6c6803e0b623c7b5de81723e081c23b88c
      https://github.com/qemu/qemu/commit/71742e6c6803e0b623c7b5de81723e081c23b88c
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-s390x/Makefile.objs
    M target-s390x/helper.h
    M target-s390x/mem_helper.c
    M target-s390x/misc_helper.c
    M target-s390x/translate.c

  Log Message:
  -----------
  target-s390x: avoid AREG0 for misc helpers

Make misc helpers take a parameter for CPUState instead
of relying on global env.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
[agraf: fix conflict]
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 265434460ed7a2912b06819cb113c04111a29dea
      https://github.com/qemu/qemu/commit/265434460ed7a2912b06819cb113c04111a29dea
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M configure
    M target-s390x/Makefile.objs
    M target-s390x/cpu.h
    M target-s390x/fpu_helper.c
    M target-s390x/helper.c
    M target-s390x/helper.h
    M target-s390x/mem_helper.c
    M target-s390x/misc_helper.c
    M target-s390x/translate.c

  Log Message:
  -----------
  target-s390x: switch to AREG0 free mode

Add an explicit CPUState parameter instead of relying on AREG0.

Remove temporary wrappers and switch to AREG0 free mode.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
[agraf: fix conflicts]
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 3bc7da7cd7c62c16da18484f1258b323f75ace61
      https://github.com/qemu/qemu/commit/3bc7da7cd7c62c16da18484f1258b323f75ace61
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/s390/tcg-target.c

  Log Message:
  -----------
  tcg/s390: fix ld/st with CONFIG_TCG_PASS_AREG0

The load/store slow path has been broken in e141ab52d:
- We need to move 4 registers for store functions and 3 registers for
  load functions and not the reverse.
- According to the s390x calling convention the arguments of a function
  should be zero extended. This means that the register shift should be
  done with TCG_TYPE_I64 to ensure the higher word is correctly zero
  extended when needed.

I am aware that CONFIG_TCG_PASS_AREG0 is being removed and thus that
this patch can be improved, but doing so means it can also be applied to
the 1.1 and 1.2 stable branches.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 62cdb0fdd319e1cc020d5b7a15bb8727d2c88c8b
      https://github.com/qemu/qemu/commit/62cdb0fdd319e1cc020d5b7a15bb8727d2c88c8b
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-arm/helper.c

  Log Message:
  -----------
  target-arm: Fix potential buffer overflow

Report from smatch:

target-arm/helper.c:651 arm946_prbs_read(6) error:
 buffer overflow 'env-&gt;cp15.c6_region' 8 &lt;= 8
target-arm/helper.c:661 arm946_prbs_write(6) error:
 buffer overflow 'env-&gt;cp15.c6_region' 8 &lt;= 8

c7_region is an array with 8 elements, so the index must be less than 8.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: d969307261eee2dd1fc42f6c570f4ac4f056b405
      https://github.com/qemu/qemu/commit/d969307261eee2dd1fc42f6c570f4ac4f056b405
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: split expression simplification

Split expression simplification in multiple parts so that a given op
can appear multiple times. This patch should not change anything.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 6c9785fb4b32c5291abb36003bbe5384ba6d9296
      https://github.com/qemu/qemu/commit/6c9785fb4b32c5291abb36003bbe5384ba6d9296
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: simplify or/xor r, a, 0 cases

or/xor r, a, 0 is equivalent to a mov r, a.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: f66f1dab29c86f88e5904eb628b90b1be8aed61a
      https://github.com/qemu/qemu/commit/f66f1dab29c86f88e5904eb628b90b1be8aed61a
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: simplify and r, a, 0 cases

and r, a, 0 is equivalent to a movi r, 0.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 52173babad7f17fc69eebe4ad3aeee42fdea0e48
      https://github.com/qemu/qemu/commit/52173babad7f17fc69eebe4ad3aeee42fdea0e48
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: simplify shift/rot r, 0, a =&gt; movi r, 0 cases

shift/rot r, 0, a is equivalent to movi r, 0.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: decddd9021b417186901baec037cc9b4d75a58f6
      https://github.com/qemu/qemu/commit/decddd9021b417186901baec037cc9b4d75a58f6
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: swap brcond/setcond arguments when possible

brcond and setcond ops are not commutative, but it's easy to compute the
new condition after swapping the arguments. Try to always put the constant
argument in second position like for commutative ops, to help backends to
generate better code.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 2108a786ba806db778d9e51c123612888ae79313
      https://github.com/qemu/qemu/commit/2108a786ba806db778d9e51c123612888ae79313
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: add constant folding for setcond

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 97c012c76a2d990cddc0c63f5a8b96e4096cc7e6
      https://github.com/qemu/qemu/commit/97c012c76a2d990cddc0c63f5a8b96e4096cc7e6
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: add constant folding for brcond

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 578c758200c670df9fa73f4511dc44d45ee80a9d
      https://github.com/qemu/qemu/commit/578c758200c670df9fa73f4511dc44d45ee80a9d
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: fix if/else/break coding style

optimizer.c contains some cases were the break is appearing in both the
if and the else parts. Fix that by moving it to the outer part. Also
move some common code there.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 1ada516f0e067a244a0d90db4ecf2974430441c5
      https://github.com/qemu/qemu/commit/1ada516f0e067a244a0d90db4ecf2974430441c5
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-s390x/translate.c

  Log Message:
  -----------
  target-s390x: avoid cpu_single_env

Pass around CPUState instead of using global cpu_single_env.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 7a5311f64f6aebdaecaa54d6fdc84bcb2fd609c8
      https://github.com/qemu/qemu/commit/7a5311f64f6aebdaecaa54d6fdc84bcb2fd609c8
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M configure
    M target-lm32/Makefile.objs
    M target-lm32/helper.h
    M target-lm32/op_helper.c
    M target-lm32/translate.c

  Log Message:
  -----------
  target-lm32: switch to AREG0 free mode

Add an explicit CPUState parameter instead of relying on AREG0
and switch to AREG0 free mode.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 3654ef451eca2386700a70aeb0073eb7a47ec3d4
      https://github.com/qemu/qemu/commit/3654ef451eca2386700a70aeb0073eb7a47ec3d4
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M configure
    M target-m68k/Makefile.objs
    M target-m68k/helpers.h
    M target-m68k/op_helper.c
    M target-m68k/translate.c

  Log Message:
  -----------
  target-m68k: switch to AREG0 free mode

Add an explicit CPUState parameter instead of relying on AREG0
and switch to AREG0 free mode.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: e67d4921fdfe42f3bbea3eaa40c4db496d3637ea
      https://github.com/qemu/qemu/commit/e67d4921fdfe42f3bbea3eaa40c4db496d3637ea
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-m68k/translate.c

  Log Message:
  -----------
  target-m68k: avoid using cpu_single_env

Pass around CPUState instead of using global cpu_single_env.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: af411212ce32a3ba5b191795b8f74fc0c7241e14
      https://github.com/qemu/qemu/commit/af411212ce32a3ba5b191795b8f74fc0c7241e14
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M configure
    M target-unicore32/Makefile.objs
    M target-unicore32/helper.h
    M target-unicore32/op_helper.c
    M target-unicore32/translate.c

  Log Message:
  -----------
  target-unicore32: switch to AREG0 free mode

Add an explicit CPUState parameter instead of relying on AREG0
and switch to AREG0 free mode.

Tested-by: Guan Xuetao &lt;gxt@mprc.pku.edu.cn&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 6178b83f35843d1b5026c039f80595dab40920b0
      https://github.com/qemu/qemu/commit/6178b83f35843d1b5026c039f80595dab40920b0
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-arm/helper.h
    M target-arm/op_helper.c
    M target-arm/translate.c

  Log Message:
  -----------
  target-arm: convert void helpers

Add an explicit CPUState parameter instead of relying on AREG0.

For easier review, convert only op helpers which don't return any value.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 883864650e8d1ca5bc12e2c8ecf86c898f205bdc
      https://github.com/qemu/qemu/commit/883864650e8d1ca5bc12e2c8ecf86c898f205bdc
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-arm/helper.h
    M target-arm/op_helper.c
    M target-arm/translate.c

  Log Message:
  -----------
  target-arm: convert remaining helpers

Convert remaining helpers to AREG0 free mode: add an explicit
CPUState parameter instead of relying on AREG0.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 40b1f8a804a9f388b104f051b9289ac188aebf3a
      https://github.com/qemu/qemu/commit/40b1f8a804a9f388b104f051b9289ac188aebf3a
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M configure
    M target-arm/Makefile.objs
    M target-arm/cpu.h
    M target-arm/helper.c
    M target-arm/op_helper.c
    M target-arm/translate.c

  Log Message:
  -----------
  target-arm: final conversion to AREG0 free mode

Convert code load functions and switch to AREG0 free mode.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: c9b89e8224afc0cf22c96b2be0cfa706121fb301
      https://github.com/qemu/qemu/commit/c9b89e8224afc0cf22c96b2be0cfa706121fb301
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M configure
    M target-microblaze/Makefile.objs
    M target-microblaze/helper.h
    M target-microblaze/op_helper.c
    M target-microblaze/translate.c

  Log Message:
  -----------
  target-microblaze: switch to AREG0 free mode

Add an explicit CPUState parameter instead of relying on AREG0
and switch to AREG0 free mode.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: d36ae16dd4626ab0754f0a40af622ded306c30ed
      https://github.com/qemu/qemu/commit/d36ae16dd4626ab0754f0a40af622ded306c30ed
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-cris/helper.h
    M target-cris/op_helper.c
    M target-cris/translate.c
    M target-cris/translate_v10.c

  Log Message:
  -----------
  target-cris: Avoid AREG0 for helpers

Add an explicit CPUCRISState parameter instead of relying on AREG0.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: c383331e9d2351187e8462816c4f45d8f345c35f
      https://github.com/qemu/qemu/commit/c383331e9d2351187e8462816c4f45d8f345c35f
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M configure
    M target-cris/Makefile.objs
    M target-cris/helper.c
    M target-cris/op_helper.c
    M target-cris/translate.c
    M target-cris/translate_v10.c

  Log Message:
  -----------
  target-cris: Switch to AREG0 free mode

Add an explicit CPUCRISState parameter instead of relying on AREG0, and
use cpu_ld* in translation and interrupt handling. Remove AREG0 swapping
in tlb_fill(). Switch to AREG0 free mode

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ca75e568211d7546b1fc1586fa443e04c0b66f3f
      https://github.com/qemu/qemu/commit/ca75e568211d7546b1fc1586fa443e04c0b66f3f
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M configure
    M target-sh4/Makefile.objs
    M target-sh4/helper.h
    M target-sh4/op_helper.c
    M target-sh4/translate.c

  Log Message:
  -----------
  target-sh4: switch to AREG0 free mode

Add an explicit CPUState parameter instead of relying on AREG0
and switch to AREG0 free mode.

Acked-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 0c4b3c0198a4a299a34a060d0faf812d09502837
      https://github.com/qemu/qemu/commit/0c4b3c0198a4a299a34a060d0faf812d09502837
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M configure
    M target-mips/Makefile.objs
    M target-mips/cpu.h
    M target-mips/helper.h
    M target-mips/op_helper.c
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: switch to AREG0 free mode

Add an explicit CPUState parameter instead of relying on AREG0
and switch to AREG0 free mode.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Acked-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: a0969d7a4656c550fed40537aa269cc18b859a9f
      https://github.com/qemu/qemu/commit/a0969d7a4656c550fed40537aa269cc18b859a9f
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M Makefile.target
    M configure
    M cpu-all.h
    M cputlb.c
    R dyngen-exec.h
    M exec-all.h
    M hw/spapr_hcall.c
    M softmmu_defs.h
    M softmmu_header.h
    M softmmu_template.h
    M target-m68k/op_helper.c
    M target-sparc/Makefile.objs
    M tcg/arm/tcg-target.c
    M tcg/arm/tcg-target.h
    M tcg/hppa/tcg-target.c
    M tcg/hppa/tcg-target.h
    M tcg/i386/tcg-target.c
    M tcg/i386/tcg-target.h
    M tcg/ia64/tcg-target.c
    M tcg/ia64/tcg-target.h
    M tcg/mips/tcg-target.c
    M tcg/mips/tcg-target.h
    M tcg/ppc/tcg-target.c
    M tcg/ppc64/tcg-target.c
    M tcg/s390/tcg-target.c
    M tcg/s390/tcg-target.h
    M tcg/sparc/tcg-target.c
    M tcg/sparc/tcg-target.h
    M tcg/tci/tcg-target.c
    M tci.c
    M user-exec.c

  Log Message:
  -----------
  Remove unused CONFIG_TCG_PASS_AREG0 and dead code

Now that CONFIG_TCG_PASS_AREG0 is enabled for all targets,
remove dead code and support for !CONFIG_TCG_PASS_AREG0 case.

Remove dyngen-exec.h and all references to it. Although included by
hw/spapr_hcall.c, it does not seem to use it.

Remove unused HELPER_CFLAGS.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ea15fd7c1af0a87e768e1f55351eea3132653800
      https://github.com/qemu/qemu/commit/ea15fd7c1af0a87e768e1f55351eea3132653800
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/i386/tcg-target.c

  Log Message:
  -----------
  tcg/i386: allow constants in load/store ops

On x86, it is possible to move a constant value to memory. Add code to
handle a constant argument to load/store ops.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: d39d648846ea2c218542a7fdf88b783ddf3db36c
      https://github.com/qemu/qemu/commit/d39d648846ea2c218542a7fdf88b783ddf3db36c
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/tcg-opc.h
    M tcg/tcg.c

  Log Message:
  -----------
  tcg: mark set_label with TCG_OPF_BB_END flag

set_label is effectively the end of a basic block, as no optimization
can be made accross it. It was treated as such in the liveness analysis
code, but as a special case.

Mark it with TCG_OPF_BB_END flag so that this information can be used
by other parts of the TCG code, and remove the special case in the liveness
analysis code.

Cc: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 4f17bc1e89f32b63a20b8a09d225918211c12202
      https://github.com/qemu/qemu/commit/4f17bc1e89f32b63a20b8a09d225918211c12202
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/optimize.c
    M tcg/tcg.h

  Log Message:
  -----------
  revert "TCG: fix copy propagation"

Given the copy propagation breakage on 32-bit hosts has been fixed
commit e31b0a7c050711884ad570fe73df806520953618 can be reverted.

Cc: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: d25c2359deb87b58ab2b44ccfd5d844aa1724216
      https://github.com/qemu/qemu/commit/d25c2359deb87b58ab2b44ccfd5d844aa1724216
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Set opn in gen_ldst_multiple.

Used by MIPS_DEBUG, when enabled.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Acked-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: fe07dcf262e742cb3016981a9910a7040c8d69e2
      https://github.com/qemu/qemu/commit/fe07dcf262e742cb3016981a9910a7040c8d69e2
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Fix MIPS_DEBUG.

The macro uses the DisasContext.  Pass it around as needed.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Acked-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 447f11b945601632849d1fe48acca10664a90361
      https://github.com/qemu/qemu/commit/447f11b945601632849d1fe48acca10664a90361
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Always evaluate debugging macro arguments

this will prevent some of the compilation errors with debugging
enabled from creeping back in.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 5b681fffe42695ecfaa2e06d6e66eaf7a040c1ff
      https://github.com/qemu/qemu/commit/5b681fffe42695ecfaa2e06d6e66eaf7a040c1ff
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: fix end of basic block detection

Commit e31b0a7c050711884ad570fe73df806520953618 fixed copy propagation on
32-bit host by restricting the copy between different types. This was the
wrong fix.

The real problem is that the all temps states should be reset at the end
of a basic block. This was done by adding such operations in the switch,
but brcond2 was forgotten (that's why the crash was only observed on 32-bit
hosts).

Fix that by looking at the TCG_OPF_BB_END instead. We need to keep the case
for op_set_label as temps might be modified through another path.

Cc: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 44219e7df216df7c91aa6fccf650f7f847541793
      https://github.com/qemu/qemu/commit/44219e7df216df7c91aa6fccf650f7f847541793
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-xtensa/translate.c

  Log Message:
  -----------
  target-xtensa: fix extui shift amount

extui opcode only uses lowermost op1 bit for sa4.

Reported-by: malc &lt;av1474@comtv.ru&gt;
Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Cc: qemu-stable &lt;qemu-stable@nongnu.org&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: cc10061717877fc65b5c734c43c55f471913ce92
      https://github.com/qemu/qemu/commit/cc10061717877fc65b5c734c43c55f471913ce92
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-xtensa/translate.c

  Log Message:
  -----------
  target-xtensa: don't emit extra tcg_gen_goto_tb

Unconditional gen_check_loop_end at the end of disas_xtensa_insn
can emit tcg_gen_goto_tb with slot id already used in the TB (e.g. when
TB ends at LEND with a branch).

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Cc: qemu-stable &lt;qemu-stable@nongnu.org&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 6314cc0c7386888217fd857b79301866c8d9637c
      https://github.com/qemu/qemu/commit/6314cc0c7386888217fd857b79301866c8d9637c
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/README
    M tcg/arm/tcg-target.h
    M tcg/hppa/tcg-target.h
    M tcg/i386/tcg-target.h
    M tcg/ia64/tcg-target.h
    M tcg/mips/tcg-target.h
    M tcg/ppc/tcg-target.h
    M tcg/ppc64/tcg-target.h
    M tcg/s390/tcg-target.h
    M tcg/sparc/tcg-target.h
    M tcg/tcg-op.h
    M tcg/tcg-opc.h
    M tcg/tcg.c
    M tcg/tcg.h
    M tcg/tci/tcg-target.h

  Log Message:
  -----------
  tcg: Introduce movcond

Implemented with setcond if the target does not provide
the optional opcode.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 72bdbb7f46293fb4328ef4d409646dcff44b1dcc
      https://github.com/qemu/qemu/commit/72bdbb7f46293fb4328ef4d409646dcff44b1dcc
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-alpha/translate.c

  Log Message:
  -----------
  target-alpha: Use movcond

For proper cmov insns, as well as the non-goto-tb case
of conditional branch.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 52080f688bcf00585d08d8d0a15e47bbae5fe5b4
      https://github.com/qemu/qemu/commit/52080f688bcf00585d08d8d0a15e47bbae5fe5b4
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/i386/tcg-target.c
    M tcg/i386/tcg-target.h

  Log Message:
  -----------
  tcg-i386: Implement movcond

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Reviewed-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: b5b6bb16b9b104c36079a471f2d793b67a0d5e9c
      https://github.com/qemu/qemu/commit/b5b6bb16b9b104c36079a471f2d793b67a0d5e9c
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg: Optimize movcond for constant comparisons

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 1d465a94add76ea3854f9cdf803ce6124e9e0e9d
      https://github.com/qemu/qemu/commit/1d465a94add76ea3854f9cdf803ce6124e9e0e9d
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg: Optimize two-address commutative operations

While swapping constants to the second operand, swap
sources matching destinations to the first operand.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 15658ad01b413b62b70b7590a0c81197848a30c2
      https://github.com/qemu/qemu/commit/15658ad01b413b62b70b7590a0c81197848a30c2
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M gdbstub.c

  Log Message:
  -----------
  gdbstub/sh4: fix build with USE_SOFTFLOAT_STRUCT_TYPES

We have to use different type to access float values when
USE_SOFTFLOAT_STRUCT_TYPES is defined.

Rework SH4 version of cpu_gdb_{read,write}_register() using
a single case, and fixing the coding style. Use ldll_p() and
stfl_p() to access float values.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 4c8f62d3885422949db31a750a96f149db474e9d
      https://github.com/qemu/qemu/commit/4c8f62d3885422949db31a750a96f149db474e9d
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/tcg.h

  Log Message:
  -----------
  tcg: Fix !USE_DIRECT_JUMP

Commit 6375e09e changed the type of TranslationBlock.tb_next,
but failed to change the type of TCGContext.tb_next.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: fb1d48edb657e5f7cf9cf87097cc05f4d258ca04
      https://github.com/qemu/qemu/commit/fb1d48edb657e5f7cf9cf87097cc05f4d258ca04
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/hppa/tcg-target.c

  Log Message:
  -----------
  tcg-hppa: Fix brcond2 and setcond2

Neither of these functions were performing double-word
compares properly.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 707eee12fdc7e0abd0066ba04b1a2a924f823467
      https://github.com/qemu/qemu/commit/707eee12fdc7e0abd0066ba04b1a2a924f823467
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/hppa/tcg-target.c

  Log Message:
  -----------
  tcg-hppa: Fix broken load/store helpers

The CONFIG_TCG_PASS_AREG0 code for calling ld/st helpers
was not respecting the ABI requirement for 64-bit values
being aligned in registers.

Mirror the ARM port in use of helper functions to marshal
arguments into the correct registers.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: df3e097e21ee80ed7eefa62fca02a7f30f23baa2
      https://github.com/qemu/qemu/commit/df3e097e21ee80ed7eefa62fca02a7f30f23baa2
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/mips/tcg-target.c

  Log Message:
  -----------
  tcg-mips: fix wrong usage of 'Z' constraint

The 'Z' constraint has been introduced to map the zero register. However
when the op also accept a constant, there is no point to accept the zero
register in addition.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: b7505cfd52d4a5fc8bd21d898d6cd1b76f7a9b91
      https://github.com/qemu/qemu/commit/b7505cfd52d4a5fc8bd21d898d6cd1b76f7a9b91
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/mips/tcg-target.c

  Log Message:
  -----------
  tcg/mips: kill warnings in user mode

Recent versions of GCC emit warnings when compiling user mode targets.
Kill them by reordering a bit the #ifdef.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: f25f0d7751a88c3a7fbaab9979cec095c6a7cdc6
      https://github.com/qemu/qemu/commit/f25f0d7751a88c3a7fbaab9979cec095c6a7cdc6
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/mips/tcg-target.c

  Log Message:
  -----------
  tcg/mips: use TCGArg or TCGReg instead of int

Instead of int, use the correct TCGArg and TCGReg type: TCGReg when
representing a TCG target register, TCGArg when representing the latter
or a constant.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 8193cdd0d003de347e48c80e27ae0e92002dd6e5
      https://github.com/qemu/qemu/commit/8193cdd0d003de347e48c80e27ae0e92002dd6e5
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/mips/tcg-target.c

  Log Message:
  -----------
  tcg/mips: don't use global pointer

Don't use the global pointer in TCG, in case helpers try access global
variables.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: adf89e7483269563731284dc75c572efa23cfd97
      https://github.com/qemu/qemu/commit/adf89e7483269563731284dc75c572efa23cfd97
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/mips/tcg-target.c

  Log Message:
  -----------
  tcg/mips: use stack for TCG temps

Use stack instead of temp_buf array in CPUState for TCG
temps.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 86b4f7ca0571f50f5727cfaaf31aa94bb4437cc9
      https://github.com/qemu/qemu/commit/86b4f7ca0571f50f5727cfaaf31aa94bb4437cc9
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/mips/tcg-target.c

  Log Message:
  -----------
  tcg/mips: optimize brcond arg, 0

MIPS has some conditional branch instructions when comparing with zero.
Use them.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 3b63392482a72f89e08dbbd221f56fda8907803c
      https://github.com/qemu/qemu/commit/3b63392482a72f89e08dbbd221f56fda8907803c
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/mips/tcg-target.c
    M tcg/mips/tcg-target.h

  Log Message:
  -----------
  tcg/mips: optimize bswap{16,16s,32} on MIPS32R2

bswap operations can be optimized on MIPS32 Release 2 using the ROTR,
WSBH and SEH instructions. We can't use the non-R2 code to implement the
ops due to registers constraints, so don't define the corresponding
TCG_TARGET_HAS_bswap* values.

Also bswap16* operations are supposed to be called with the 16 high bits
zeroed. This is the case everywhere (including for TCG by definition)
except when called from the store helper. Remove the AND instructions from
bswap16* and move it there.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: a8067da5d1e31a1232eb836d351057ceb79161dc
      https://github.com/qemu/qemu/commit/a8067da5d1e31a1232eb836d351057ceb79161dc
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/mips/tcg-target.c
    M tcg/mips/tcg-target.h

  Log Message:
  -----------
  tcg/mips: implement rotl/rotr ops on MIPS32R2

rotr operations can be optimized on MIPS32 Release 2 using the ROTR and
ROTRV instructions. Also implemented rotl operations by subtracting the
shift from 32.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 6d82e71b6ad199c0656a29ad7625abe3d996d0fa
      https://github.com/qemu/qemu/commit/6d82e71b6ad199c0656a29ad7625abe3d996d0fa
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/mips/tcg-target.c
    M tcg/mips/tcg-target.h

  Log Message:
  -----------
  tcg/mips: implement deposit op on MIPS32R2

deposit operations can be optimized on MIPS32 Release 2 using the INS
instruction.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 7ef9bee92493b85b944e0c8a0f2bd1867e2c091c
      https://github.com/qemu/qemu/commit/7ef9bee92493b85b944e0c8a0f2bd1867e2c091c
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/mips/tcg-target.c
    M tcg/mips/tcg-target.h

  Log Message:
  -----------
  tcg/mips: implement movcond op on MIPS32R2

movcond operation can be implemented on MIPS32 Release 2 using the MOVN,
MOVZ, SLT and SLTU instructions.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ad797145ae485d64ece97ed61bc719a1e425b06a
      https://github.com/qemu/qemu/commit/ad797145ae485d64ece97ed61bc719a1e425b06a
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: remove TCG_TEMP_ANY

TCG_TEMP_ANY has no different meaning than TCG_TEMP_UNDEF, so use
the later instead.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: a4c701ee768cc9f6ff7dda4081b3293caf9ba837
      https://github.com/qemu/qemu/commit/a4c701ee768cc9f6ff7dda4081b3293caf9ba837
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: check types in copy propagation

The copy propagation doesn't check the types of the temps during copy
propagation. However TCG is using the mov_i32 for the i64 to i32
conversion and thus the two are not equivalent.

With this patch tcg_opt_gen_mov() doesn't consider two temps of
different type as copies anymore.

So far it seems the optimization was not aggressive enough to trigger
this bug, but it will be triggered later in this series once the copy
propagation is improved.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: a17f24e08ddcf740bb235232c71aac8fba2a7c19
      https://github.com/qemu/qemu/commit/a17f24e08ddcf740bb235232c71aac8fba2a7c19
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: rework copy progagation

The copy propagation pass tries to keep track what is a copy of what
and what has copy of what, and in addition it keep a circular list of
of all the copies. Unfortunately this doesn't fully work: a mov from
a temp which has a state "COPY" changed it into a state "HAS_COPY".
Later when this temp is used again, it is considered has not having
copy and thus no propagation is done.

This patch fixes that by removing the hiearchy between copies, and thus
only keeping a "COPY" state both meaning "is a copy" and "has a copy".
The decision of which copy to use is deferred to the actual temp
replacement. At this stage there is not one best choice to do, but only
better choices than others. For doing the best choice the operation
would have to be parsed in reversed to know if a temp is going to be
used later or not. That what is done by the liveness analysis. At this
stage it is known that globals will be always live, that local temps
will be dead at the end of the translation block, and that the temps
will be dead at the end of the basic block. This means that this stage
should try to replace temps by local temps or globals and local temps
by globals.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 6599e3faaea1228a1f8c9010775bb9e0c66ea552
      https://github.com/qemu/qemu/commit/6599e3faaea1228a1f8c9010775bb9e0c66ea552
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: do copy propagation for all operations

It is possible to due copy propagation for all operations, even the one
that have side effects or clobber arguments (it only concerns input
arguments). That said, the call operation should be handled differently
due to the variable number of arguments.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: d3b9fb75c601df3c8ec85af7187b7007bc635d87
      https://github.com/qemu/qemu/commit/d3b9fb75c601df3c8ec85af7187b7007bc635d87
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: optimize "op r, a, a =&gt; mov r, a"

Now that we can easily detect all copies, we can optimize the
"op r, a, a =&gt; mov r, a" case a bit more.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: f4643451e980a0da8b1a9f70b9a1355220ab9288
      https://github.com/qemu/qemu/commit/f4643451e980a0da8b1a9f70b9a1355220ab9288
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: optimize "op r, a, a =&gt; movi r, 0"

Now that it's possible to detect copies, we can optimize the case
the "op r, a, a =&gt; movi r, 0". This helps in the computation of
overflow flags when one of the two args is 0.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 26adaf07da61b9bd92cb49430611ffe5a0ca3cfd
      https://github.com/qemu/qemu/commit/26adaf07da61b9bd92cb49430611ffe5a0ca3cfd
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: further optimize brcond/movcond/setcond

When both argument of brcond/movcond/setcond are the same or when one
of the two values is a constant equal to zero, it's possible to do
further optimizations.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: cfca711212fb5a99104897a593e9ea45f140a0a2
      https://github.com/qemu/qemu/commit/cfca711212fb5a99104897a593e9ea45f140a0a2
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: prefer the "op a, a, b" form for commutative ops

The "op a, a, b" form is better handled on non-RISC host than the "op
a, b, a" form, so swap the arguments to this form when possible, and
when b is not a constant.

This reduces the number of generated instructions by a tiny bit.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ffc1c5681583f0d576855432a57e34496d2657a8
      https://github.com/qemu/qemu/commit/ffc1c5681583f0d576855432a57e34496d2657a8
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/tcg.c

  Log Message:
  -----------
  tcg: remove #ifdef #endif around TCGOpcode tests

Commit 25c4d9cc changed all TCGOpcode enums to be available, so we don't
need to #ifdef #endif the one that are available only on some targets.
This makes the code easier to read.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 2e1d09263b66dac508b308163606e22f9275a4ce
      https://github.com/qemu/qemu/commit/2e1d09263b66dac508b308163606e22f9275a4ce
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: add constant folding for deposit

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 5096a7c7d8529de2994a1bc47a1ba01d622ce0de
      https://github.com/qemu/qemu/commit/5096a7c7d8529de2994a1bc47a1ba01d622ce0de
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/README

  Log Message:
  -----------
  tcg/README: document tcg_gen_goto_tb restrictions

See
http://lists.nongnu.org/archive/html/qemu-devel/2012-09/msg03196.html
for the whole story.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: a48028b8e9ec7a2063c1ac83acda006cd7b1289a
      https://github.com/qemu/qemu/commit/a48028b8e9ec7a2063c1ac83acda006cd7b1289a
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/i386/tcg-target.c
    M tcg/i386/tcg-target.h

  Log Message:
  -----------
  w64: Fix TCG helper functions with 5 arguments

TCG uses 6 registers for function arguments on 64 bit Linux hosts,
but only 4 registers on W64 hosts.

Commit 2999a0b20074a7e4a58f56572bb1436749368f59 increased the number
of arguments for some important helper functions from 4 to 5
which triggered a bug for W64 hosts: QEMU aborts when executing
helper_lcall_real in the guest's BIOS because function
tcg_target_get_call_iarg_regs_count always returned 6.

As W64 has only 4 registers for arguments, the 5th argument must be
passed on the stack using a correct stack offset.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 6164c1274eae35ddb3036860f2d52b93f4a72d3d
      https://github.com/qemu/qemu/commit/6164c1274eae35ddb3036860f2d52b93f4a72d3d
  Author: malc &lt;av1474@comtv.ru&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/ppc/tcg-target.c
    M tcg/ppc/tcg-target.h

  Log Message:
  -----------
  tcg/ppc32: Implement movcond32

Thanks to Richard Henderson

Signed-off-by: malc &lt;av1474@comtv.ru&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ee13de285330be3c00ba0cef8b3fd65ad6b6e9e7
      https://github.com/qemu/qemu/commit/ee13de285330be3c00ba0cef8b3fd65ad6b6e9e7
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Hack in qemu_ld/st64 for 32-bit.

Not actually implemented, but at least we avoid the tcg assert at startup.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: e183eb99fa4dd0c2aa92b36dc8a00ab524ac366d
      https://github.com/qemu/qemu/commit/e183eb99fa4dd0c2aa92b36dc8a00ab524ac366d
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Fix ADDX opcode.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: e1784a4cbd441e24064b347fa85b0fc4eae6056b
      https://github.com/qemu/qemu/commit/e1784a4cbd441e24064b347fa85b0fc4eae6056b
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M exec.c

  Log Message:
  -----------
  tcg-sparc: Don't MAP_FIXED on top of the program

The address we pick in sparc64.ld is also 0x60000000, so doing a fixed map
on top of that is guaranteed to blow up.  Choosing 0x40000000 is exactly
right for the max of code_gen_buffer_size set below.

No need to ever use MAP_FIXED.  While getting our desired address helps
optimize the generated code, we won't fail if we don't get it.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 181dd0b27c3b450630b3dadb072f73423b4bf193
      https://github.com/qemu/qemu/commit/181dd0b27c3b450630b3dadb072f73423b4bf193
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M configure
    M disas.c
    M exec.c
    M qemu-timer.h
    M tcg/sparc/tcg-target.c
    M tcg/sparc/tcg-target.h
    M tcg/tcg.c

  Log Message:
  -----------
  tcg-sparc: Assume v9 cpu always, i.e. force v8plus in 32-bit mode.

Current code doesn't actually work in 32-bit mode at all.  Since
no one really noticed, drop the complication of v7 and v8 cpus.
Eliminate the --sparc_cpu configure option and standardize macro
testing on TCG_TARGET_REG_BITS / HOST_LONG_BITS

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: e85ec822e9f892587b5bf913fe6dcac8e6357a0e
      https://github.com/qemu/qemu/commit/e85ec822e9f892587b5bf913fe6dcac8e6357a0e
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Fix qemu_ld/st to handle 32-bit host.

At the same time, split out the tlb load logic to a new function.
Fixes the cases of two data registers and two address registers.
Fixes the signature of, and adds missing, qemu_ld/st opcodes.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 757ee3f9e270e9baa14a91348cd73d9c12729edb
      https://github.com/qemu/qemu/commit/757ee3f9e270e9baa14a91348cd73d9c12729edb
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M configure
    M tcg/sparc/tcg-target.c
    M tcg/sparc/tcg-target.h

  Log Message:
  -----------
  tcg-sparc: Support GUEST_BASE.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 60db655378a158ebdcb938b1d240873f3180bf74
      https://github.com/qemu/qemu/commit/60db655378a158ebdcb938b1d240873f3180bf74
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c
    M tcg/sparc/tcg-target.h

  Log Message:
  -----------
  tcg-sparc: Change AREG0 in generated code to %i0.

We can now move the TCG variable from %g[56] to a call-preserved
windowed register.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 5c7199f164a26142290b548ede30ebc9538b4573
      https://github.com/qemu/qemu/commit/5c7199f164a26142290b548ede30ebc9538b4573
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M configure
    M tcg/sparc/tcg-target.c
    M tcg/sparc/tcg-target.h

  Log Message:
  -----------
  tcg-sparc: Clean up cruft stemming from attempts to use global registers.

Don't use -ffixed-gN.  Don't link statically.  Don't save/restore
AREG0 around calls.  Don't allocate space on the stack for AREG0 save.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: db0cfd14ba6da14dba0913cdb6e6933d34283cd8
      https://github.com/qemu/qemu/commit/db0cfd14ba6da14dba0913cdb6e6933d34283cd8
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Mask shift immediates to avoid illegal insns.

The xtensa-test image generates a sra_i32 with count 0x40.
Whether this is accident of tcg constant propagation or
originating directly from the instruction stream is immaterial.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 39cbcb4b4534131d5a6d0673ce0c792e804e7d75
      https://github.com/qemu/qemu/commit/39cbcb4b4534131d5a6d0673ce0c792e804e7d75
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Use defines for temporaries.

And change from %i4/%i5 to %g1/%o7 to remove a v8plus fixme.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ba8b16fac5ce6ee871e31c09ca8b03ac9f753f1e
      https://github.com/qemu/qemu/commit/ba8b16fac5ce6ee871e31c09ca8b03ac9f753f1e
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Add %g/%o registers to alloc_order

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 38df9027cefe2a0f40a0fcf26e0730602bd5d9b2
      https://github.com/qemu/qemu/commit/38df9027cefe2a0f40a0fcf26e0730602bd5d9b2
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M exec-all.h
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Fix and enable direct TB chaining.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: fef28a4336858cf25bb61f14b2283f2093541bf5
      https://github.com/qemu/qemu/commit/fef28a4336858cf25bb61f14b2283f2093541bf5
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Preserve branch destinations during retranslation

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: df6502fac572b22c2332acc828d2503239e4cda7
      https://github.com/qemu/qemu/commit/df6502fac572b22c2332acc828d2503239e4cda7
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-alpha/translate.c

  Log Message:
  -----------
  target-alpha: Initialize env-&gt;cpu_model_str

Save the cpu_model_str so that we have a non-null value when
creating a new cpu during clone.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 6c975d03a28bb6ec7b8296ac3834ab31a25ccc43
      https://github.com/qemu/qemu/commit/6c975d03a28bb6ec7b8296ac3834ab31a25ccc43
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/mips/tcg-target.c
    M tcg/mips/tcg-target.h

  Log Message:
  -----------
  tcg/mips: fix MIPS32(R2) detection

Fix the MIPS32(R2) cpu detection so that it also works with
-march=octeon. Thanks to Andrew Pinski for the hint.

Cc: Andrew Pinski &lt;apinski@cavium.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: e1312991ed3eb9f2a177332c40f7d13d24d9c3ce
      https://github.com/qemu/qemu/commit/e1312991ed3eb9f2a177332c40f7d13d24d9c3ce
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/README

  Log Message:
  -----------
  tcg: Adjust descriptions of *cond opcodes

The README file documented the operand ordering of the tcg_gen_*
functions.  Since we're documenting opcodes here, use the true
operand ordering.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Cc: malc &lt;av1474@comtv.ru&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: c90a8840b47a1641ad6e46e4a52520e1148127c5
      https://github.com/qemu/qemu/commit/c90a8840b47a1641ad6e46e4a52520e1148127c5
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/i386/tcg-target.c

  Log Message:
  -----------
  tcg/i386: fix build with -march &lt; i686

The movcond_i32 op has to be protected with TCG_TARGET_HAS_movcond_i32
to fix the build with -march &lt; i686.

Thanks to Richard Henderson for the hint.

Reported-by: Alex Barcelo &lt;abarcelo@ac.upc.edu&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: e46258fb502546961aae5548ce388b3d7ea929f8
      https://github.com/qemu/qemu/commit/e46258fb502546961aae5548ce388b3d7ea929f8
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M def-helper.h
    M exec-all.h

  Log Message:
  -----------
  tcg: Fix MAX_OPC_PARAM_IARGS

DEF_HELPER_FLAGS_5 was added some time ago without adjusting
MAX_OPC_PARAM_IARGS.

Fixing the definition becomes more important as QEMU is using
an increasing number of helper functions called with 5 arguments.

Add also a comment to avoid future problems when DEF_HELPER_FLAGS_6
will be added.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 7fd494086b2bbc83595ea7d63ca0e54f2917c203
      https://github.com/qemu/qemu/commit/7fd494086b2bbc83595ea7d63ca0e54f2917c203
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M tcg/tci/tcg-target.c
    M tci.c

  Log Message:
  -----------
  tci: Fix for AREG0 free mode

Support for helper functions with 5 arguments was missing
in the code generator and in the interpreter.

There is no need to pass the constant TCG_AREG0 from the
code generator to the interpreter. Remove that code for
the INDEX_op_qemu_st* opcodes.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 3c82758f04af24d3f642c0b808689d0cb26840aa
      https://github.com/qemu/qemu/commit/3c82758f04af24d3f642c0b808689d0cb26840aa
  Author: Christophe Fergeau &lt;cfergeau@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M ui/spice-core.c

  Log Message:
  -----------
  spice: abort on invalid streaming cmdline params

When parsing its command line parameters, spice aborts when it
finds unexpected values, except for the 'streaming-video' option.
This happens because the parsing of the parameters for this option
is done using the 'name2enum' helper, which does not error out
on unknown values. Using the 'parse_name' helper makes sure we
error out in this case. Looking at git history, the use of
'name2enum' instead of 'parse_name' seems to have been an oversight,
so let's change to that now.

Fixes rhbz#831708

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 835cab85ad83ed8dfe1c13243aeda5959b153e3e)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: fc24f3bd2ed4c97c99ad40e747732ae46dff2009
      https://github.com/qemu/qemu/commit/fc24f3bd2ed4c97c99ad40e747732ae46dff2009
  Author: Yonit Halperin &lt;yhalperi@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M ui/spice-core.c

  Log Message:
  -----------
  spice: notify spice server on vm start/stop

Spice server needs to know about the vm state in order to prevent
attempts to write to devices when they are stopped, mainly during
the non-live stage of migration.
Instead, spice will take care of restoring this writes, on the migration
target side, after migration completes.

Signed-off-by: Yonit Halperin &lt;yhalperi@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit f5bb039c6d97ef3e664094eab3c9a4dc1824ed73)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 25bc2251ebb0fd7cfbc08d6e4bc27acac5aa7a6e
      https://github.com/qemu/qemu/commit/25bc2251ebb0fd7cfbc08d6e4bc27acac5aa7a6e
  Author: Yonit Halperin &lt;yhalperi@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/qxl.c
    M ui/spice-core.c
    M ui/spice-display.c
    M ui/spice-display.h

  Log Message:
  -----------
  spice: notify on vm state change only via spice_server_vm_start/stop

QXLWorker-&gt;start/stop are deprecated since spice-server 0.11.2

Signed-off-by: Yonit Halperin &lt;yhalperi@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 71d388d420e68ac77cd42f15f7e68cf5a6fb01b2)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 986b9a1a2ae917a61ba4016c71e0505750202985
      https://github.com/qemu/qemu/commit/986b9a1a2ae917a61ba4016c71e0505750202985
  Author: Yonit Halperin &lt;yhalperi@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M monitor.c
    M monitor.h
    M ui/spice-core.c

  Log Message:
  -----------
  spice migration: add QEVENT_SPICE_MIGRATE_COMPLETED

When migrating, libvirt queries the migration status, and upon migration
completions, it closes the migration src. On the other hand, when
migration is completed, spice transfers data from the src to destination
via the client. This data is required for keeping the spice session
after migration, without suffering from data loss and inconsistencies.
In order to allow this data transfer, we add QEVENT for signaling
libvirt that spice migration has completed, and libvirt needs to wait
for this event before quitting the src process.

Signed-off-by: Yonit Halperin &lt;yhalperi@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 2fdd16e239c2a2763aa3266e637718123328688c)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 38a01d68c6bad5a4d9859aaa3a40c6c5df4b799e
      https://github.com/qemu/qemu/commit/38a01d68c6bad5a4d9859aaa3a40c6c5df4b799e
  Author: Yonit Halperin &lt;yhalperi@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hmp.c
    M qapi-schema.json
    M ui/spice-core.c

  Log Message:
  -----------
  spice: add 'migrated' flag to spice info

The flag is 'true' when spice migration has completed on the src side.
It is needed for a case where libvirt dies before migration completes
and it misses the event QEVENT_SPICE_MIGRATE_COMPLETED.
When libvirt is restored and queries the migration status, it also needs
to query spice and check if its migration has completed.

Signed-off-by: Yonit Halperin &lt;yhalperi@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 61c4efe2cb85b0a9c6bc68f6a2dd107c8d7ec080)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 7908e4a3882e81dad38c7563541c8b9eee7f4132
      https://github.com/qemu/qemu/commit/7908e4a3882e81dad38c7563541c8b9eee7f4132
  Author: Yonit Halperin &lt;yhalperi@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M qemu-config.c
    M qemu-options.hx
    M ui/spice-core.c

  Log Message:
  -----------
  spice: adding seamless-migration option to the command line

The seamless-migration flag is required in order to identify
whether libvirt supports the new QEVENT_SPICE_MIGRATE_COMPLETED or not
(by default the flag is off).
New libvirt versions that wait for QEVENT_SPICE_MIGRATE_COMPLETED should turn on this \
flag. When this flag is off, spice fallbacks to its old migration method, which
can result in data loss.

Signed-off-by: Yonit Halperin &lt;yhalperi@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 8c9570530c819821b9b5cc3113d2b2966afe7621)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 615198836ce2b21eb0910a8d22027965d5353044
      https://github.com/qemu/qemu/commit/615198836ce2b21eb0910a8d22027965d5353044
  Author: Yonit Halperin &lt;yhalperi@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M qemu-options.hx

  Log Message:
  -----------
  spice: increase the verbosity of spice section in "qemu --help"

Added all spice options to the help string. This can be used by libvirt
to determine which spice related features are supported by qemu.

Signed-off-by: Yonit Halperin &lt;yhalperi@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 27af778828db9aa893fa1de928744141e5de20e5)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 5b7582af06bd4313a12663ac96681940edae87de
      https://github.com/qemu/qemu/commit/5b7582af06bd4313a12663ac96681940edae87de
  Author: Alon Levy &lt;alevy@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  qxl/update_area_io: guest_bug on invalid parameters

Signed-off-by: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 511b13e2c9b426b3c56060909693de5097f0b496)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: b75c71057538a5e720afa2a122721fe2e6095d02
      https://github.com/qemu/qemu/commit/b75c71057538a5e720afa2a122721fe2e6095d02
  Author: Alon Levy &lt;alevy@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M configure
    M hw/qxl.c
    M hw/qxl.h
    M trace-events
    M ui/spice-display.h

  Log Message:
  -----------
  qxl: add QXL_IO_MONITORS_CONFIG_ASYNC

Revision bumped to 4 for new IO support, enabled for spice-server &gt;=
0.11.1. New io enabled if revision is 4. Revision can be set to 4.

[ kraxel: 3 continues to be the default revision.  Once we have a new
    stable spice-server release and the qemu patches to enable
    the new bits merged we'll go flip the switch and make rev4
    the default ]

This io calls the corresponding new spice api
spice_qxl_monitors_config_async to let spice-server read a new guest set
monitors config and notify the client.

On migration reissue spice_qxl_monitors_config_async.

RHBZ: 770842

Signed-off-by: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;

fixup

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 020af1c45fec664d5d4cf3b8e5117f8bc1d691f2)

Conflicts:

	hw/qxl.c

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ea4c86551de72721d52507af252f1aa541c29ac0
      https://github.com/qemu/qemu/commit/ea4c86551de72721d52507af252f1aa541c29ac0
  Author: Alon Levy &lt;alevy@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: print spice-protocol and spice-server versions

Signed-off-by: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 2e0e3c399aa8067148055b9ea0edb822c5b584d2)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 23086b20543b71ce8e1ec435ef65923d93b1dcbb
      https://github.com/qemu/qemu/commit/23086b20543b71ce8e1ec435ef65923d93b1dcbb
  Author: Amos Kong &lt;akong@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hmp-commands.hx

  Log Message:
  -----------
  fix doc of using raw values with sendkey

(qemu) sendkey a
(qemu) sendkey 0x1e
(qemu) sendkey #0x1e
 unknown key: '#0x1e'

The last command doesn't work, '#' is not requested before
raw values, and the raw value in decimal format is not supported.

Signed-off-by: Amos Kong &lt;akong@redhat.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
(cherry picked from commit 886cc706ce5d4d3d1c296f028ddc2991cfbe3bbe)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 122b92d90af40cff485e5e9ba2a64842d1f7ff48
      https://github.com/qemu/qemu/commit/122b92d90af40cff485e5e9ba2a64842d1f7ff48
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M scripts/qapi-visit.py

  Log Message:
  -----------
  qapi: Fix potential NULL pointer segfault

Report from smatch:

qapi-visit.c:1640 visit_type_BlockdevAction(8) error:
 we previously assumed 'obj' could be null (see line 1639)
qapi-visit.c:2432 visit_type_NetClientOptions(8) error:
 we previously assumed 'obj' could be null (see line 2431)

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
(cherry picked from commit 227ccf6bff234c29974c2c18ecd3a29e6b965e3d)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 3aec24d19512bff2ffb0bf3bb97b8a48e47a8825
      https://github.com/qemu/qemu/commit/3aec24d19512bff2ffb0bf3bb97b8a48e47a8825
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M qobject.h

  Log Message:
  -----------
  json-parser: Fix potential NULL pointer segfault

Report from smatch:
json-parser.c:474 parse_object(62) error: potential null derefence 'dict'.
json-parser.c:553 parse_array(75) error: potential null derefence 'list'.

Label 'out' in json-parser.c can be called with list == NULL
which is passed to QDECREF.

Modify QDECREF to handle a NULL argument (inline function qobject_decref
already handles them, too).

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
(cherry picked from commit 149474c93490e1c66f838391bd491db83136d91d)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 6ac46e32164002183aeda3dde0b82afca72f9131
      https://github.com/qemu/qemu/commit/6ac46e32164002183aeda3dde0b82afca72f9131
  Author: Jason Baron &lt;jbaron@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/pci.c
    M hw/pcie.h

  Log Message:
  -----------
  pcie: drop version_id field for live migration

While testing q35 live migration, I found that the migration would abort with
the following error: "Unknown savevm section type 76".

The error is due to this check failing in 'vmstate_load_state()':

    while(field-&gt;name) {
  if ((field-&gt;field_exists &amp;&amp;
       field-&gt;field_exists(opaque, version_id)) ||
      (!field-&gt;field_exists &amp;&amp;
       field-&gt;version_id &lt;= version_id)) {

The VMSTATE_PCIE_DEVICE() currently has a 'version_id' set to 2. However,
'version_id' in the above check is 1. And thus we fail to load the pcie device
field. Further the code returns to 'qemu_loadvm_state()' which produces the
error that I saw.

I'm proposing to fix this by simply dropping the 'version_id' field from
VMSTATE_PCIE_DEVICE(). VMSTATE_PCI_DEVICE() defines no such field and further
the vmstate_pcie_device that VMSTATE_PCI_DEVICE() refers to is already
versioned. Thus, any versioning issues could be detected at the vmsd level.

Taking a step back, I think that the 'field-&gt;version_id' should be compared
against a saved version number for the field not the 'version_id'. Futhermore,
once vmstate_load_state() is called recursively on another vmsd, the check of:

    if (version_id &gt; vmsd-&gt;version_id) {
  return -EINVAL;
    }

Will never fail since version_id is always equal to vmsd-&gt;version_id. So I'm
wondering why we aren't storing the vmsd version id of the source in the
migration stream?

This patch also renames the 'name' field of vmstate_pcie_device from:
PCIDevice -&gt; PCIEDevice to differentiate it from vmstate_pci_device.

Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
(cherry picked from commit 1de53459272d89c52bb21b45d5d970de40fbb642)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 4382057785cc3e8c674977300dafced0e3be9f7b
      https://github.com/qemu/qemu/commit/4382057785cc3e8c674977300dafced0e3be9f7b
  Author: Jason Baron &lt;jbaron@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/pcie_aer.c

  Log Message:
  -----------
  pcie_aer: clear cmask for Advanced Error Interrupt Message Number

The Advanced Error Interrupt Message Number (bits 31:27 of the Root
Error Status Register) is updated when the number of msi messages assigned to a
device changes. Migration of windows 7 on q35 chipset failed because the check
in get_pci_config_device() fails due to cmask being set on these bits. Its valid
to update these bits and we must restore this state across migration.

Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
(cherry picked from commit 0e180d9c8a7429c55d23d2e7855f1e490a063aaa)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 4de6467cbc8f3ddff7f2dcb63f427b0e92de0e9d
      https://github.com/qemu/qemu/commit/4de6467cbc8f3ddff7f2dcb63f427b0e92de0e9d
  Author: Henning Schild &lt;henning@hennsch.de&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/elf_ops.h

  Log Message:
  -----------
  fix entry pointer for ELF kernels loaded with -kernel option

 Find a hopefully proper patch attached. Take it or leave it.

Reviewed-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Signed-off-by: Henning Schild &lt;henning@hennsch.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit 7e9c7ffe9fd9dfc3d0168dd584936db8144b230b)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 635cc81bf91135c12035f56ac5b6ce28cb19c5ab
      https://github.com/qemu/qemu/commit/635cc81bf91135c12035f56ac5b6ce28cb19c5ab
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/lan9118.c

  Log Message:
  -----------
  lan9118: fix multicast filtering

The lan9118 emulation tries to compute the multicast index by calling
directly the crc32() function from zlib, but fails to get the correct
result.

Use the common compute_mcast_idx() function instead, which gives the
correct result. This fixes IPv6 support.

Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit 449bc90e1f2e2fbafb64eb0c76d16c9352b0d2df)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 27aae39fa04c7fe714aabf18f65994538c65fb12
      https://github.com/qemu/qemu/commit/27aae39fa04c7fe714aabf18f65994538c65fb12
  Author: Maciej W. Rozycki &lt;macro@codesourcery.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M target-mips/cpu.h
    M target-mips/op_helper.c
    M target-mips/translate.c

  Log Message:
  -----------
  MIPS/user: Fix reset CPU state initialization

 This change updates the CPU reset sequence to use a common piece of code
that figures out CPU state flags, fixing the problem with MIPS_HFLAG_COP1X
not being set where applicable that causes floating-point MADD family
instructions (and other instructions from the MIPS IV FP subset) to trap.

 As compute_hflags is now shared between op_helper.c and translate.c, the
function is now moved to a common header.  There are no changes to this
function.

 The problem was seen with the 24Kf MIPS32r2 processor in user emulation.
The new approach prevents system and user emulation from diverging -- all
the hflags state is initialized in one place now.

Signed-off-by: Maciej W. Rozycki &lt;macro@codesourcery.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit 03e6e5017757645f00b2f3b4f3a257973985e455)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 2ecd8831e048b058e4b3067f33f1c436b93f850a
      https://github.com/qemu/qemu/commit/2ecd8831e048b058e4b3067f33f1c436b93f850a
  Author: Fabien Chouteau &lt;chouteau@adacore.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M MAINTAINERS

  Log Message:
  -----------
  Add MAINTAINERS entry for leon3

Signed-off-by: Fabien Chouteau &lt;chouteau@adacore.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
(cherry picked from commit ce6c760c37b9a88db87c5b9b9bf39ca866e570f6)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 47b11da1e94aa17109522f97a6188f5ecd75c25e
      https://github.com/qemu/qemu/commit/47b11da1e94aa17109522f97a6188f5ecd75c25e
  Author: Jan Kiszka &lt;jan.kiszka@web.de&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/musicpal.c

  Log Message:
  -----------
  musicpal: Fix flash mapping

The old arithmetic assumed 32 physical address bits which is no longer
true for ARM since 3cc0cd61f4.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@web.de&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
(cherry picked from commit 0c267217ca9985e6d118ec8368bebd382db7a099)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 7566759fd5896456fd6fa6d94ed388c11158dcef
      https://github.com/qemu/qemu/commit/7566759fd5896456fd6fa6d94ed388c11158dcef
  Author: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M configure
    M kvm-all.c

  Log Message:
  -----------
  qemu: Use valgrind annotations to mark kvm guest memory as defined

valgrind with kvm produces a big amount of false positives regarding
"Conditional jump or move depends on uninitialised value(s)". This
happens because the guest memory is allocated with qemu_vmalloc which
boils down posix_memalign etc. This function is (correctly) considered
by valgrind as returning undefined memory.

Since valgrind is based on jitting code, it will not be able to see
changes made by the guest to guest memory if this is done by KVM_RUN,
thus keeping most of the guest memory undefined.

Now lots of places in qemu will then use guest memory to change behaviour.
To avoid the flood of these messages, lets declare the whole guest
memory as defined. This will reduce the noise and allows us to see real
problems.

In the future we might want to make this conditional, since there
is actually something that we can use those false positives for:
These messages will point to code that depends on guest memory, so
we can use these backtraces to actually make an audit that is focussed
only at those code places. For normal development we dont want to
see those messages, though.

Signed-off-by: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;
(cherry picked from commit 62fe83318d2fc5b31f473d66326910d94c1c4907)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: bd4dba66584c36e33195e42ed4d503549b17d4d8
      https://github.com/qemu/qemu/commit/bd4dba66584c36e33195e42ed4d503549b17d4d8
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/wm8750.c

  Log Message:
  -----------
  hw/wm8750: Fix potential buffer overflow

Report from smatch:

hw/wm8750.c:369 wm8750_tx(12) error: buffer overflow 's-&gt;i2c_data' 2 &lt;= 2

It looks like the preprocessor statements were simply misplaced.

Replace also __FUNCTION__ by __func__ to please checkpatch.pl.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit 149eeb5fe57b853081e8059575d91b8a58a4f96c)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: b750d224664bd4b726c87117f51f90e47516230f
      https://github.com/qemu/qemu/commit/b750d224664bd4b726c87117f51f90e47516230f
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/mcf5206.c

  Log Message:
  -----------
  hw/mcf5206: Fix buffer overflow for MBAR read / write

Report from smatch:

mcf5206.c:384 m5206_mbar_readb(7) error: buffer overflow 'm5206_mbar_width' 128 &lt;= \
128 mcf5206.c:403 m5206_mbar_readw(8) error: buffer overflow 'm5206_mbar_width' 128 \
&lt;= 128 mcf5206.c:427 m5206_mbar_readl(8) error: buffer overflow 'm5206_mbar_width' \
128 &lt;= 128 mcf5206.c:451 m5206_mbar_writeb(9) error: buffer overflow \
'm5206_mbar_width' 128 &lt;= 128 mcf5206.c:475 m5206_mbar_writew(9) error: buffer \
overflow 'm5206_mbar_width' 128 &lt;= 128 mcf5206.c:503 m5206_mbar_writel(9) error: \
buffer overflow 'm5206_mbar_width' 128 &lt;= 128

m5206_mbar_width has 0x80 elements and supports 0 &lt;= offset &lt; 0x200.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit a32354e206895400d17c3de9a8df1de96d3df289)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 82645b9e93c649a586fdd5248f267dea474663a4
      https://github.com/qemu/qemu/commit/82645b9e93c649a586fdd5248f267dea474663a4
  Author: Michael Tokarev &lt;mjt@tls.msk.ru&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  use --libexecdir instead of ignoring it first and reinventing it later

Commit 7b93fadf3a38d1ed65ea5536a52efc2772c6e3b8 "Add basic version
of bridge helper" put the bridge helper executable into a fixed
${prefix}/libexec/ location, instead of using ${libexecdir} for
this.  At the same time, --libexecdir is being happily ignored
by ./configure.  Even more, the same patch sets unused $libexecdir
variable in the generated config-host.mak, and uses fixed string
(\${prefix}/libexecdir) for the bridge helper binary.

Fix this braindamage by introducing $libexecdir variable, using
it for the bridge helper binary, and recognizing --libexecdir.

This patch is applicable to stable-1.1.

Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Reviewed-by: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
Signed-off-by: Michael Tokarev &lt;mjt@tls.msk.ru&gt;
Cc: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
Cc: Richa Marwaha &lt;rmarwah@linux.vnet.ibm.com&gt;
Cc: qemu-stable@nongnu.org
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 8bf188aa18ef7a8355d9edbd43871d590468c4ed)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 5af6b07ab063a9d98f60965d1295cae444f257fc
      https://github.com/qemu/qemu/commit/5af6b07ab063a9d98f60965d1295cae444f257fc
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M qemu-char.c

  Log Message:
  -----------
  socket: don't attempt to reconnect a TCP socket in server mode

Commit c3767ed0eb5d0bb25fe409ae5dec06e3411ff1b6 introduced a possible SEGV when
using a socket chardev with server=on because it assumes that all TCP sockets
are in client mode.

This patch adds a check to only reconnect when in client mode.

Cc: Lei Li &lt;lilei@linux.vnet.ibm.com&gt;
Reported-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 455aa1e0818653c41fd794435b982426ce21ba2f)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: b5701820f8fb1c52d26da6bcedb0729a869a9b55
      https://github.com/qemu/qemu/commit/b5701820f8fb1c52d26da6bcedb0729a869a9b55
  Author: Daniel P. Berrange &lt;berrange@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  Add ability to force enable/disable of tools build

The qemu-img, qemu-nbd and qemu-io tools are built conditionally
based on whether any softmmu target is enabled. These are useful
self-contained tools which can be used in many other scenarios.
Add new --enable-tools/--disable-tools args to configure to allow
the user to explicitly turn on / off their build. The default
behaviour is now to build these tools are all times, regardless
of whether any softmmu target is enabled

Signed-off-by: Daniel P. Berrange &lt;berrange@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 4b1c11fd20e8901f04a2d9c225cd10fc05a762ff)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 4ebbf3229acac66085ca467d79cac38befebc28d
      https://github.com/qemu/qemu/commit/4ebbf3229acac66085ca467d79cac38befebc28d
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  usb: controllers do not need to check for babble themselves

If an (emulated) usb-device tries to write more data to a packet then
its iov len, this will trigger an assert in usb_packet_copy(), and if
a driver somehow circumvents that check and writes more data to the
iov then there is space, we have a much bigger problem then not correctly
reporting babble to the guest.

In practice babble will only happen with (real) redirected devices, and there
both the usb-host os and the qemu usb-device code already check for it.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 45b339b18c660eb85af2ba25bfcaed5469660d77)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 597330bd8d9e7d96a699749da8c8b2cd82110151
      https://github.com/qemu/qemu/commit/597330bd8d9e7d96a699749da8c8b2cd82110151
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/core.c

  Log Message:
  -----------
  usb-core: Don't set packet state to complete on a nak

This way the hcd can re-use the same packet to retry without needing
to re-init it.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit cc40997489260f405aecccd30d4626ceee862502)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: d780116ab095a3ac1e2a6b98f13ee4effde01544
      https://github.com/qemu/qemu/commit/d780116ab095a3ac1e2a6b98f13ee4effde01544
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb.h
    M hw/usb/core.c

  Log Message:
  -----------
  usb-core: Add a usb_ep_find_packet_by_id() helper function

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit c13a9e61366cc3e28299d8faeb65e65c6e5964cf)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: d6e508d3a5dacacf5b93daaf9eb4bc35e01a124d
      https://github.com/qemu/qemu/commit/d6e508d3a5dacacf5b93daaf9eb4bc35e01a124d
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/core.c

  Log Message:
  -----------
  usb-core: Allow the first packet of a pipelined ep to complete immediately

This can happen with usb-redir live-migration when the packet gets re-queued
after the migration and the original queuing from the migration source side
has already finished.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 9c1f67654ab611553bbfca54a1e0922728c25760)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: a37d5e521a948dc582c66e52e84a0348a8c11de9
      https://github.com/qemu/qemu/commit/a37d5e521a948dc582c66e52e84a0348a8c11de9
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  Revert "ehci: don't flush cache on doorbell rings."

This reverts commit 9bc3a3a216e2689bfcdd36c3e079333bbdbf3ba0, which got
added to fix an issue where the real, underlying cause was not stopping
the ep queue on an error.

Now that the underlying cause is fixed by the "usb: Halt ep queue and
cancel pending packets on a packet error" patch, the "don't flush" fix
is no longer needed.

Not only is it not needed, it causes us to see cancellations (unlinks)
done by the Linux EHCI driver too late, which in combination with the new
usb-core packet-id generation where qtd addresses are used as ids, causes
duplicate ids for in flight packets.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
(cherry picked from commit 66f092d25697e11847b61d761c38ddebedaed8d1)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 712fc762a65479e2a4c77bf51da520ec6dcf4cb5
      https://github.com/qemu/qemu/commit/712fc762a65479e2a4c77bf51da520ec6dcf4cb5
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Validate qh is not changed unexpectedly by the guest

-combine the qh check with the check for devaddr changes
-also ensure that p gets set to NULL when the queue gets cancelled on
 devaddr change, which was not done properly before this patch

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
(cherry picked from commit dafe31fc2a8653b535d58f8c7b250c0827b14420)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: c15d61b25279a9fb704cb466db85f8d91ad9d12c
      https://github.com/qemu/qemu/commit/c15d61b25279a9fb704cb466db85f8d91ad9d12c
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Update copyright headers to reflect recent work

Update copyright headers to reflect all the work Gerd and I have been doing
on the EHCI emulation.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
(cherry picked from commit 522079dd4461c38b9a88bf31a65ea038c5b2be45)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 307fea863ad31b6cd6ceb44d2585f610f33db938
      https://github.com/qemu/qemu/commit/307fea863ad31b6cd6ceb44d2585f610f33db938
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Properly cleanup packets on cancel

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
(cherry picked from commit 0e7953525f52aa6c098dc0c1ce0b4a80ce82da45)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: a8cf10d5d64c15c39ded647cf244fa45249c612e
      https://github.com/qemu/qemu/commit/a8cf10d5d64c15c39ded647cf244fa45249c612e
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Properly report completed but not yet processed packets to the guest

Reported packets which have completed before being cancelled as such to the
host. Note that the new code path this patch adds is untested since it I've
been unable to actually trigger the race which needs this code path.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
(cherry picked from commit 4b63a0df3bda8a2c278e45d9d94d9ba6d5791d8d)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 4a6cdb480704d37d9ead3972b051558c42a7d54d
      https://github.com/qemu/qemu/commit/4a6cdb480704d37d9ead3972b051558c42a7d54d
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: check for EHCI_ASYNC_FINISHED first in ehci_free_packet

Otherwise we'll see the packet free twice in the trace log even though
it actually happens only once.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 616789cde2a83fad5e634880fd20214f0c984fd5)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 62fc5e6983152380d11d88ae5d3374a6cfda6939
      https://github.com/qemu/qemu/commit/62fc5e6983152380d11d88ae5d3374a6cfda6939
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c
    M trace-events

  Log Message:
  -----------
  ehci: trace guest bugs

make qemu_queue_{cancel,reset} return the number of packets released,
so the caller can figure whenever there have been active packets even
though there shouldn't have been any.  Add tracepoint to log this.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 5c514681abbb3ae2f61f517c1aa3197f2f3ca93c)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: d294ad632382a89b8219d7bb7ae675256a39f162
      https://github.com/qemu/qemu/commit/d294ad632382a89b8219d7bb7ae675256a39f162
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c
    M trace-events

  Log Message:
  -----------
  ehci: add doorbell trace events

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 1defcbd1e81d67476b6e4e486bcd4d869162900d)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 0154d330c71bb483fdf39c766b32044921656bf3
      https://github.com/qemu/qemu/commit/0154d330c71bb483fdf39c766b32044921656bf3
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Add some additional ehci_trace_guest_bug() calls

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 3a8ca08e01ea4baafff2a513655008cdd00feebf)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 2f7ba4731bcc2d92760f291ea8b264bdc69dcc55
      https://github.com/qemu/qemu/commit/2f7ba4731bcc2d92760f291ea8b264bdc69dcc55
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Fix memory leak in handling of NAK-ed packets

Currently each time we try to execute a NAK-ed packet we redo
ehci_init_transfer, and usb_packet_map, re-allocing (without freeing) the
sg list every time.

This patch fixes this, it does this by introducing another async state, so
that we also properly cleanup a NAK-ed packet on cancel.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit ef5b234477df80700b128f561f5877a0688a70c8)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: e2ab86fe2d89db5a5dcf128f627e3b5c27fef5f5
      https://github.com/qemu/qemu/commit/e2ab86fe2d89db5a5dcf128f627e3b5c27fef5f5
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Handle USB_RET_PROCERR in ehci_fill_queue

USB_RET_PROCERR can be triggered by the guest (by for example requesting more
then BUFFSIZE bytes), so don't assert on it.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit eff6dce79bd7ad3c16d75c5e55b5a2a137ba6a60)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 77c3d59256533ea3377d33647a91f2337a9c760d
      https://github.com/qemu/qemu/commit/77c3d59256533ea3377d33647a91f2337a9c760d
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Correct a comment in fetchqtd packet processing

Since my previous comment said "Should never happen", I tried changing the
next line to an assert(0), which did not go well, which as the new comments
explains is logical if you think about it for a moment.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit cf1f81691d1998fa8fe5bfcb8b498fb3723cf3c3)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 1d5ba9a6a8051964bfdc1b36ee066f1765cf15c8
      https://github.com/qemu/qemu/commit/1d5ba9a6a8051964bfdc1b36ee066f1765cf15c8
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Never return USB_RET_NAK for async handled packets

USB_RET_NAK is not a valid response for async handled packets (and will
trigger an assert as such).

Also drop the warning when receiving a status of cancelled for packets not
cancelled by qemu itself, this can happen when a device gets unredirected
by the usbredir-host while transfers are pending.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 181133404f520fab40a3ad40d935d91cf3cf546c)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 14ecfb09faafd07263e03c5f4772083a360dc36b
      https://github.com/qemu/qemu/commit/14ecfb09faafd07263e03c5f4772083a360dc36b
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Don't delay handling of open events to a bottom half

There is no need for this, and doing so means that a backend trying to
write immediately after an open event will see qemu_chr_be_can_write
returning 0, which not all backends handle well as there is no wakeup
mechanism to detect when the frontend does become writable.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit ed9873bfbf145c084d039baab08c63b9d67e7bd3)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 57eae744d45204e5b04b5ddcd9be044fef0b7da0
      https://github.com/qemu/qemu/commit/57eae744d45204e5b04b5ddcd9be044fef0b7da0
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Get rid of async-struct get member

This is a preparation patch for completely getting rid of the async-packet
struct in usb-redir, instead relying on the (new) per ep queues in the
qemu usb core.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit cb897117cdedd488f19985c8ec5ea05971103a27)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: aa57b628e0db7756746d83c2ca16034341356bc8
      https://github.com/qemu/qemu/commit/aa57b628e0db7756746d83c2ca16034341356bc8
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Get rid of local shadow copy of packet headers

The shadow copy only serves as an extra check (besides the packet-id) to
ensure the packet we get back is a reply to the packet we think it is.

This check has never triggered in all the time usb-redir is in use now,
and since the verified data in the returned packet-header is not used
otherwise, removing the check does not open any possibilities for the
usbredirhost to confuse us.

This is a preparation patch for completely getting rid of the async-packet
struct in usb-redir, instead relying on the (new) per ep queues in the
qemu usb core.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 104981d52b63dc3d68f39d4442881c667f44bbb9)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 55a2f465b9ee17ddaa4a869f6b9733615c20f96d
      https://github.com/qemu/qemu/commit/55a2f465b9ee17ddaa4a869f6b9733615c20f96d
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Get rid of unused async-struct dev member

This is a preparation patch for completely getting rid of the async-packet
struct in usb-redir, instead relying on the (new) per ep queues in the
qemu usb core.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 206e7f20fe7b920b362bcc02608680c5d5527f2a)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 636071de92b4a559a38203ba08ebea04df5212a9
      https://github.com/qemu/qemu/commit/636071de92b4a559a38203ba08ebea04df5212a9
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Move to core packet id and queue handling

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit de550a6afb468ed3b8171019e19b63ae8254886d)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 22ba7a7488c5b6ecba901b4253184fa0815318eb
      https://github.com/qemu/qemu/commit/22ba7a7488c5b6ecba901b4253184fa0815318eb
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Return babble when getting more bulk data then requested

Babble is the appropriate error in this case (rather then signalling a stall).

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 2979a36183a3902cd75665e7c6bbc8668668fd17)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: fbcb89ddc9808ad4bb63c46d6e47ea088516a7a7
      https://github.com/qemu/qemu/commit/fbcb89ddc9808ad4bb63c46d6e47ea088516a7a7
  Author: Samuel Thibault &lt;samuel.thibault@ens-lyon.org&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/dev-serial.c

  Log Message:
  -----------
  Better name usb braille device

Windows users need to know that they have to use the Baum driver to make
the qemu braille device work.

Signed-off-by: Samuel Thibault &lt;samuel.thibault@ens-lyon.org&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 2964cd9bfa5100e433471d3e3fedcc9d62891894)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 3e3750e10ad3443defe1dce204b455e2a7368bbf
      https://github.com/qemu/qemu/commit/3e3750e10ad3443defe1dce204b455e2a7368bbf
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/dev-audio.c

  Log Message:
  -----------
  usb-audio: fix usb version

usb-audio is a full speed (1.1) device,
but bcdUSB claims it is usb 2.0.  Fix it.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 2bbd086c41a00dc4384727ec895a94890c688eb5)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 64022e9d58dc7cf48fee14ca08f4c84ac5d70fe0
      https://github.com/qemu/qemu/commit/64022e9d58dc7cf48fee14ca08f4c84ac5d70fe0
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: rip out background transfer code

original xhci code (the one which used libusb directly) used to use
'background transfers' for iso streams.  In upstream qemu the iso
stream buffering is handled by usb-host &amp; usb-redir, so we will
never ever need this.  It has been left in as reference, but is dead
code anyway.  Rip it out.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 331e9406f152b6bae6859a153d36e5076c58901d)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 640bda8df50d07daccceb646ed7d047bf1080c55
      https://github.com/qemu/qemu/commit/640bda8df50d07daccceb646ed7d047bf1080c55
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c
    M trace-events

  Log Message:
  -----------
  xhci: drop buffering

This patch splits the xhci_xfer_data function into three.
The xhci_xfer_data function used to do does two things:

  (1) copy transfer data between guest memory and a temporary buffer.
  (2) report transfer results to the guest using events.

Now we three functions to handle this:

  (1) xhci_xfer_map creates a scatter list for the transfer and
      uses that (instead of the temporary buffer) to build a
      USBPacket.
  (2) xhci_xfer_unmap undoes the mapping.
  (3) xhci_xfer_report sends out events.

The patch also fixes reporting of transaction errors which must be
reported unconditinally, not only in case the guest asks for it
using the ISP flag.

[ v2: fix warning ]

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit d5a15814b413869667b2a3215772986885be574a)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 23ba9d48381cb06e5a7e169ed8898c115094daf0
      https://github.com/qemu/qemu/commit/23ba9d48381cb06e5a7e169ed8898c115094daf0
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: fix runtime write tracepoint

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 8e9f18b6db1cd67f0a7efd7d0285bee489445197)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 03c0342cb8725f7ae50d0db93516ef546825b4ff
      https://github.com/qemu/qemu/commit/03c0342cb8725f7ae50d0db93516ef546825b4ff
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: allow bytewise capability register reads

Some guests need this according to
Alejandro Martinez Ruiz &lt;alex@securiforest.com&gt;

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 6ee021d41078844df60a3a466e3829a3e82776f3)

Conflicts:

	hw/usb/hcd-xhci.c

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: b26859ab1803dc30e9510e8d8083c18b9970e6c4
      https://github.com/qemu/qemu/commit/b26859ab1803dc30e9510e8d8083c18b9970e6c4
  Author: Dunrong Huang &lt;riegamaths@gmail.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  qxl: dont update invalid area

This patch fixes the following error:

$ ~/usr/bin/qemu-system-x86_64 -enable-kvm -m 1024 -spice port=5900,disable-ticketing \
-vga qxl -cdrom ~/Images/linuxmint-13-mate-dvd-32bit.iso \
(/home/mathslinux/usr/bin/qemu-system-x86_64:10068): SpiceWorker-CRITICAL **: \
red_worker.c:4599:red_update_area: condition `area-&gt;left &gt;= 0 &amp;&amp; area-&gt;top &gt;= 0 &amp;&amp; \
area-&gt;left &lt; area-&gt;right &amp;&amp; area-&gt;top &lt; area-&gt;bottom' failed Aborted

spice server terminates QEMU process if we pass invalid area to it,
so dont update those invalid areas.

Signed-off-by: Dunrong Huang &lt;riegamaths@gmail.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit ccc2960d654a233a6ed415b37d8ff41728d817c5)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 462ff6fda1409a8ae20772c09c6444dc3ce25d88
      https://github.com/qemu/qemu/commit/462ff6fda1409a8ae20772c09c6444dc3ce25d88
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/host-linux.c

  Log Message:
  -----------
  usb-host: allow emulated (non-async) control requests without USBPacket

xhci needs this for USB_REQ_SET_ADDRESS due to the way
usb addressing is handled by the xhci hardware.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 63587e31353b6652cadfcfb869f5692a2b69daeb)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 9a5a94de581b47189f7df5ded0523b9a6991f581
      https://github.com/qemu/qemu/commit/9a5a94de581b47189f7df5ded0523b9a6991f581
  Author: Uri Lublin &lt;uril@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  qxl: better cleanup for surface destroy

Add back a call to qxl_spice_destroy_surface_wait_complete() in \
qxl_spice_destroy_surface_wait(), that was removed by commit \
c480bb7da465186b84d8427e068ef7502e47ffbf

It is needed to complete surface-removal cleanup, for non async.
For async, qxl_spice_destroy_surface_wait_complete is called upon operation \
completion.

Signed-off-by: Uri Lublin &lt;uril@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 753b8b0d77ba1b343a35f9679cc777ea10a62bba)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 1f97f6c9fe45bcfc9e59d23076e5a39f1e22de51
      https://github.com/qemu/qemu/commit/1f97f6c9fe45bcfc9e59d23076e5a39f1e22de51
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c
    M trace-events

  Log Message:
  -----------
  ehci: switch to new-style memory ops

Also register different memory regions for capabilities,
operational registers and port status registers.  Create
separate tracepoints for operational regs and port status
regs.  Ditch a bunch of sanity checks because the memory
core will do this for us now.

Offloading the byte, word and dword access handling to the
memory core also has the side effect of fixing ehci register
access on bigendian hosts.

Cc: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 3e4f910c8d490a1490409a7e381dbbb229f9d272)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 29ecaa26a83753e67bc8ba7cacf08d3948e868af
      https://github.com/qemu/qemu/commit/29ecaa26a83753e67bc8ba7cacf08d3948e868af
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Fix interrupts stopping when Interrupt Threshold Control is 8

If Interrupt Threshold Control is 8 or a multiple of 8, then
s-&gt;usbsts_frindex can become exactly 0x4000, at which point
(s-&gt;usbsts_frindex &gt; s-&gt;frindex) will never become true, as
s-&gt;usbsts_frindex will not be lowered / reset in this case.

This patch fixes this.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit ffa1f2e088eb7e3d57f2fc35f21e7bdb23e592c5)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 349b4e90707f5cefd199c9573fe34540a6aec327
      https://github.com/qemu/qemu/commit/349b4e90707f5cefd199c9573fe34540a6aec327
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Don't process too much frames in 1 timer tick (v2)

The Linux ehci isoc scheduling code fills the entire schedule ahead of
time minus 80 frames. If we make a large jump in where we are in the
schedule, ie 40 frames, then the scheduler all of a sudden will only have
40 frames left to work in, causing it to fail packet submissions
with error -27 (-EFBIG).

Changes in v2:
-Don't hardcode a maximum number of frames to process in one tick, instead:
 -Process a minimum number of frames to ensure we do eventually catch up
 -Stop (after the minimum number) when the guest has requested an irq

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 8f74ed1e43263293301031a10e440549bab19a6e)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 1fce4135f33e748980d9f1fa2fe79a19fcf57289
      https://github.com/qemu/qemu/commit/1fce4135f33e748980d9f1fa2fe79a19fcf57289
  Author: MORITA Kazutaka &lt;morita.kazutaka@lab.ntt.co.jp&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M block/sheepdog.c

  Log Message:
  -----------
  sheepdog: fix savevm and loadvm

This patch sets data to be sent to Sheepdog correctly and fixes savevm
and loadvm operations on a Sheepdog image.

Signed-off-by: MORITA Kazutaka &lt;morita.kazutaka@lab.ntt.co.jp&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
(cherry picked from commit 1f7a48de4467f31afc51169122453318efdb0f33)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 3900d1d99267f16710762786c8e50ca83923bda0
      https://github.com/qemu/qemu/commit/3900d1d99267f16710762786c8e50ca83923bda0
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/ide/core.c

  Log Message:
  -----------
  ide: Fix error messages from static code analysis (no real error)

Report from smatch:
hw/ide/core.c:1472 ide_exec_cmd(423) error: buffer overflow 'smart_attributes' 8 &lt;= \
29 hw/ide/core.c:1474 ide_exec_cmd(425) error: buffer overflow 'smart_attributes' 8 \
&lt;= 29 hw/ide/core.c:1475 ide_exec_cmd(426) error: buffer overflow 'smart_attributes' \
                8 &lt;= 29
...

The upper limit of 30 was never reached because both for loops terminated
when 'smart_attributes' reached end of list, so there was no real buffer
overflow.

Nevertheless, changing the code not only fixes the error report, but also
reduces the size of smart_attributes and simplifies the for loops.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
(cherry picked from commit 1e53537fdaa4657d11f130a0f2673fcfb1956381)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 1e32a1651aeb071481b20f873f8d61a0692f7be5
      https://github.com/qemu/qemu/commit/1e32a1651aeb071481b20f873f8d61a0692f7be5
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M block/curl.c

  Log Message:
  -----------
  block/curl: Fix wrong free statement

Report from smatch:
block/curl.c:546 curl_close(21) info: redundant null check on s-&gt;url calling free()

The check was redundant, and free was also wrong because the memory
was allocated using g_strdup.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
(cherry picked from commit 45724d6d02383b0d7d4a90e05787fca7c55cb070)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 1c224f0ab3ee2807844527126546abece2bdfc4b
      https://github.com/qemu/qemu/commit/1c224f0ab3ee2807844527126546abece2bdfc4b
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M block/vdi.c

  Log Message:
  -----------
  vdi: Fix warning from clang

ccc-analyzer reports these warnings:

block/vdi.c:704:13: warning: Dereference of null pointer
      bmap[i] = VDI_UNALLOCATED;
      ^
block/vdi.c:702:13: warning: Dereference of null pointer
      bmap[i] = i;
      ^

Moving some code into the if block fixes this.
It also avoids calling function write with 0 bytes of data.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
(cherry picked from commit 514f21a5d4613e495adc2e2dd48f18091454efb8)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 84a2ca9f903dffa785b499979375aaadb58f1958
      https://github.com/qemu/qemu/commit/84a2ca9f903dffa785b499979375aaadb58f1958
  Author: Pavel Hrdina &lt;phrdina@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M block.c

  Log Message:
  -----------
  block: fix block tray status

The tray status should change also if you eject empty block device.

Signed-off-by: Pavel Hrdina &lt;phrdina@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
(cherry picked from commit 9ca111544c64b5abed2e79cf52e19a8f227b347b)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 7cf7e305cc93388063e92289622c72f3f5d4ab1d
      https://github.com/qemu/qemu/commit/7cf7e305cc93388063e92289622c72f3f5d4ab1d
  Author: Jason Baron &lt;jbaron@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/ide/ahci.c

  Log Message:
  -----------
  ahci: properly reset PxCMD on HBA reset

While testing q35, I found that windows 7 (specifically, windows 7 ultimate
with sp1 x64), wouldn't install because it can't find the cdrom or disk drive.
The failure message is: 'A required cd/dvd device driver is missing. If you
have a driver floppy disk, CD, DVD, or USB flash drive, please insert it now.'
This can also be reproduced on piix by adding an ahci controller, and
observing that windows 7 does not see any devices behind it.

The problem is that when windows issues a HBA reset, qemu does not reset the
individual ports' PxCMD register. Windows 7 then reads back the PxCMD register
and presumably assumes that the ahci controller has already been initialized.
Windows then never sets up the PxIE register to enable interrupts, and thus it
never gets irqs back when it sends ata device inquiry commands.

This change brings qemu into ahci 1.3 specification compliance.

Section 10.4.3 HBA Reset:

"
When GHC.HR is set to '1', GHC.AE, GHC.IE, the IS register, and all port
register fields (except PxFB/PxFBU/PxCLB/PxCLBU) that are not HwInit in the
HBA's register memory space are reset.
"

I've also re-tested Fedora 16 and 17 to verify that they continue to work with
this change.

Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Acked-by: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
(cherry picked from commit 2a4f4f34e6fe55f4c82507c3e7ec9b58c2e24ad4)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: f9f552e80b2f19997f1fda77cc2ce59848e86e91
      https://github.com/qemu/qemu/commit/f9f552e80b2f19997f1fda77cc2ce59848e86e91
  Author: Daniel P. Berrange &lt;berrange@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M qemu-img.c

  Log Message:
  -----------
  Don't require encryption password for 'qemu-img info' command

The encryption password is only required if I/O is going to be
performed on a disk image. The 'qemu-img info' command merely
reports metadata, so it should not ask for a decryption password

Signed-off-by: Daniel P. Berrange &lt;berrange@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
(cherry picked from commit f0536bb848ad6eb2709a7dc675f261bd160c751b)

Conflicts:

	qemu-img.c

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 9cf4af689b9c4d92857df11857912d5f9b865c9b
      https://github.com/qemu/qemu/commit/9cf4af689b9c4d92857df11857912d5f9b865c9b
  Author: Dunrong Huang &lt;riegamaths@gmail.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M block.c

  Log Message:
  -----------
  block: Don't forget to delete temporary file

The caller would not delete temporary file after failed get_tmp_filename().

Signed-off-by: Dunrong Huang &lt;riegamaths@gmail.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
(cherry picked from commit fe235a06e1e008dedd2ac3cc0a3a655169ce9b33)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: bffb221775792f89b4214aa8f7616bfbb760a668
      https://github.com/qemu/qemu/commit/bffb221775792f89b4214aa8f7616bfbb760a668
  Author: Alon Levy &lt;alevy@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/qxl.c
    M trace-events

  Log Message:
  -----------
  hw/qxl: tracing fixes

Add two new trace events:
qxl_send_events(int qid, uint32_t events) "%d %d"
qxl_set_guest_bug(int qid) "%d"

Change qxl_io_unexpected_vga_mode parameters to be equivalent to those
of qxl_io_write for easier grouping under a single systemtap probe.

Change d to qxl in one place.

Signed-off-by: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 917ae08ca1565aab2d10c8b6269cd905d6c5c05b)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: d28ed2ffbb695cc667ad32af164b23854e88e4a2
      https://github.com/qemu/qemu/commit/d28ed2ffbb695cc667ad32af164b23854e88e4a2
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: usbredir fixes

usbredir is only used by system emulation, so add the libraries to
libs_softmmu instead of LIBS.

Cc: Michael Tokarev &lt;mjt@tls.msk.ru&gt;
Cc: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 56ab2ad177dc43d474dc0a0bd84e81ef00f31e11)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ad2cea3878765c875da7a1f32b2c1dd68ad75a70
      https://github.com/qemu/qemu/commit/ad2cea3878765c875da7a1f32b2c1dd68ad75a70
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Don't set seen to 0 when removing unseen queue-heads

When removing unseen queue-heads from the async queue list, we should not
set the seen flag to 0, as this may cause them to be removed by
ehci_queues_rip_unused() during the next call to ehci_advance_async_state()
if the timer is late or running at a low frequency.

Note:
1) This *may* have caused the instant unlink / relinks described in commit
   9bc3a3a216e2689bfcdd36c3e079333bbdbf3ba0

2) Rather then putting more if-s inside ehci_queues_rip_unused, this patch
   instead introduces a new ehci_queues_rip_unseen function.

3) This patch also makes it save to call ehci_queues_rip_unseen() multiple
   times, which gets used in the folluw up patch titled:
   "ehci: Walk async schedule before and after migration"

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 8f5457eb04140714eaf57a99bc08dc661d83fa87)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: d56d7e6ef81e263cbab75742442aac48c0821016
      https://github.com/qemu/qemu/commit/d56d7e6ef81e263cbab75742442aac48c0821016
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Walk async schedule before and after migration

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit ceab6f96454fe6589d1b09ce64403c041d79f9d9)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 981e213cf7a6309f0fcfeadf4b784ce27b1d505d
      https://github.com/qemu/qemu/commit/981e213cf7a6309f0fcfeadf4b784ce27b1d505d
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Revert usb-redir part of commit 93bfef4c

Commit 93bfef4c6e4b23caea9d51e1099d06433d8835a4 makes qemu-devices
which report the qemu version string to the guest in some way use a
qemu_get_version function which reports a machine-specific version string.

However usb-redir does not expose the qemu version to the guest, only to
the usbredir-host as part of the initial handshake. This can then be logged
on the usbredir-host side for debugging purposes and is otherwise completely
unused! For debugging purposes it is important to have the real qemu version
in there, rather then the machine-specific version.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 35efba2cc6812dc980c336d7b9bf81dbfb5daf00)

Conflicts:

	hw/usb/redirect.c

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 2ee160f8e19dc6d1fd0860f37b8929f16f072eb2
      https://github.com/qemu/qemu/commit/2ee160f8e19dc6d1fd0860f37b8929f16f072eb2
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Don't queue up packets after one with the SPD flag set

Don't queue up packets after a packet with the SPD (short packet detect)
flag set. Since we won't know if the packet will actually be short until it
has completed, and if it is short we should stop the queue.

This fixes a miniature photoframe emulating a USB cdrom with the windows
software for it not working.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 72a04d0c178f01908d74539230d9de64ffc6da19)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 3ed791b42d75f20dc194f9355121c55ee3ac4444
      https://github.com/qemu/qemu/commit/3ed791b42d75f20dc194f9355121c55ee3ac4444
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M slirp/tcp_subr.c

  Log Message:
  -----------
  slirp: Remove wrong type casts ins debug statements

The type casts of pointers to long are not allowed
when sizeof(pointer) != sizeof(long).

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
(cherry picked from commit c4d12a743c73a5b88a8705ca68ff620ce0f8bba7)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 6116adbc0e22c92015220591594df14d776cf5f6
      https://github.com/qemu/qemu/commit/6116adbc0e22c92015220591594df14d776cf5f6
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M slirp/tcp_subr.c

  Log Message:
  -----------
  slirp: Fix error reported by static code analysis

Report from smatch:

slirp/tcp_subr.c:127 tcp_respond(17) error:
 we previously assumed 'tp' could be null (see line 124)

Return if 'tp' is NULL.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
(cherry picked from commit e56afbc54a2132c56931f44bae1992c28119944f)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 34f7e690c341ad526bd5012daf91f25b880fc709
      https://github.com/qemu/qemu/commit/34f7e690c341ad526bd5012daf91f25b880fc709
  Author: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M slirp/tftp.c
    M slirp/tftp.h

  Log Message:
  -----------
  slirp: improve TFTP performance

When transferring a file, keep it open during the whole transfer,
instead of opening/closing it for each block.

Signed-off-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Reviewed-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
(cherry picked from commit 78be056628c76ff73eedeade86fde44b97343c79)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: b83f395ba19c9fd9c2e3ad22b8b8d8f46ab9be12
      https://github.com/qemu/qemu/commit/b83f395ba19c9fd9c2e3ad22b8b8d8f46ab9be12
  Author: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M slirp/tftp.c
    M slirp/tftp.h

  Log Message:
  -----------
  slirp: Handle more than 65535 blocks in TFTP transfers

RFC 1350 does not mention block count roll-over. However, a lot of TFTP servers
implement it to be able to transmit big files, so do it also.

Current block size is 512 bytes, so TFTP files were limited to 32 MB.

Signed-off-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
(cherry picked from commit 4aa401f39e048e71020cceb59f126ab941095a42)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: c23314334d8d8fc13d6dd076fab7f0a8376ce1fb
      https://github.com/qemu/qemu/commit/c23314334d8d8fc13d6dd076fab7f0a8376ce1fb
  Author: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M slirp/tftp.c

  Log Message:
  -----------
  slirp: Implement TFTP Blocksize option

This option is described in RFC 1783. As this is only an optional field,
we may ignore it in some situations and handle it in some others.

However, MS Windows 2003 PXE boot client requests a block size of the MTU
(most of the times 1472 bytes), and doesn't work if the option is not
acknowledged (with whatever value).

According to the RFC 1783, we cannot acknowledge the option with a bigger
value than the requested one.

As current implementation is using 512 bytes by block, accept the option
with a value of 512 if the option was specified, and don't acknowledge it
if it is not present or less than 512 bytes.

Signed-off-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
(cherry picked from commit 95b1ad7ad86793c27ab8e9987be69571937900d1)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 34173da0214a10460ac0856b6ae4f1bd9ae84808
      https://github.com/qemu/qemu/commit/34173da0214a10460ac0856b6ae4f1bd9ae84808
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/srp.h

  Log Message:
  -----------
  srp: Don't use QEMU_PACKED for single elements of a structured type

QEMU_PACKED results in a MinGW compiler warning when it is
used for single structure elements:

warning: 'gcc_struct' attribute ignored

Using QEMU_PACKED for the whole structure avoids the compiler warning
without changing the memory layout.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
(cherry picked from commit 93d3ad2a8048469d2b2bb157697425b66b2a37aa)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: a0d718a39599d1967b4cd80027c25047565734a3
      https://github.com/qemu/qemu/commit/a0d718a39599d1967b4cd80027c25047565734a3
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M docs/specs/ppc-spapr-hcalls.txt
    M docs/usb2.txt
    M hw/xen_pt.h
    M hw/xen_pt_config_init.c
    M qemu-img.c
    M qemu-img.texi

  Log Message:
  -----------
  Spelling fixes in comments and documentation

These wrong spellings were detected by codespell:

* successully -&gt; successfully

* alot -&gt; a lot

* wanna -&gt; want to

* infomation -&gt; information

* occured -&gt; occurred

["also is" -&gt; "is also" and "ressources" -&gt; "resources" suggested by
Peter Maydell &lt;peter.maydell@linaro.org&gt;]

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
(cherry picked from commit 0546b8c2f089867cd7606ff47e026e8931157828)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: c6553fee8190eb3ea47bc07476c3f1ba0872cabc
      https://github.com/qemu/qemu/commit/c6553fee8190eb3ea47bc07476c3f1ba0872cabc
  Author: BALATON Zoltan &lt;balaton@eik.bme.hu&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M console.c

  Log Message:
  -----------
  console: Clean up bytes per pixel calculation

Division with round up is the correct way to compute this even if the
only case where division with round down gives incorrect result is
probably 15 bpp. This case was explicitely patched up in one of these
functions but was unhandled in the other. (I'm not sure about setting
16 bpp for the 15bpp case either but I left that there for now.)

Signed-off-by: BALATON Zoltan &lt;balaton@eik.bme.hu&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
(cherry picked from commit feadf1a4de0d7468ffb671a2b9f681925469fa58)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 59a01f73c31ceadba600e3cfb3305aa6995ae563
      https://github.com/qemu/qemu/commit/59a01f73c31ceadba600e3cfb3305aa6995ae563
  Author: Lei Li &lt;lilei@linux.vnet.ibm.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M qapi-schema-guest.json
    M qapi-schema.json

  Log Message:
  -----------
  qapi: Fix enumeration typo error

Signed-off-by: Lei Li &lt;lilei@linux.vnet.ibm.com&gt;
Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;
(cherry picked from commit 6932a69b20a88428c531805cdd20eec8acf05b27)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: a78cedc09ebde304f3dbff70a15f507b7f5099e2
      https://github.com/qemu/qemu/commit/a78cedc09ebde304f3dbff70a15f507b7f5099e2
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M kvm-all.c

  Log Message:
  -----------
  kvm: Fix warning from static code analysis

Report from smatch:

kvm-all.c:1373 kvm_init(135) warn:
 variable dereferenced before check 's' (see line 1360)

's' cannot by NULL (it was alloced using g_malloc0), so there is no need
to check it here.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;
(cherry picked from commit 6d1cc3210ccc4372ffa337c187da9db68314c0c4)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ca54dc1e752e1def95ce809b63a21932533d220c
      https://github.com/qemu/qemu/commit/ca54dc1e752e1def95ce809b63a21932533d220c
  Author: Igor Mitsyanko &lt;i.mitsyanko@samsung.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M arch_init.c

  Log Message:
  -----------
  arch_init.c: add missing '%' symbols before PRIu64 in debug printfs

'%' symbols were missing in front of PRIu64 macros in DPRINTF() messages in
arch_init.c, this caused compilation warnings when compiled with DEBUG_ARCH_INIT \
defined.

Signed-off-by: Igor Mitsyanko &lt;i.mitsyanko@samsung.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;
(cherry picked from commit ef37a699a06f96e098ee00683b7052b5fbb6ad7d)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 8e9fdc4a8818161f102457a4358fb5f617b61ac2
      https://github.com/qemu/qemu/commit/8e9fdc4a8818161f102457a4358fb5f617b61ac2
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/virtio-net.c
    M net.c
    M net/queue.c
    M net/queue.h

  Log Message:
  -----------
  net: notify iothread after flushing queue

virtio-net has code to flush the queue and notify the iothread
whenever new receive buffers are added by the guest.  That is
fine, and indeed we need to do the same in all other drivers.
However, notifying the iothread should be work for the network
subsystem.  And since we are at it we can add a little smartness:
if some of the queued packets already could not be delivered,
there is no need to notify the iothread.

Reported-by: Luigi Rizzo &lt;rizzo@iet.unipi.it&gt;
Cc: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Cc: Jan Kiszka &lt;jan.kiszka@siemens.de&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Amos Kong &lt;akong@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
(cherry picked from commit 987a9b4800003567b1a47a379255e886a77d57ea)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 7575a6d2f2747f5d6ef263ad002a731402853fa6
      https://github.com/qemu/qemu/commit/7575a6d2f2747f5d6ef263ad002a731402853fa6
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/e1000.c

  Log Message:
  -----------
  e1000: flush queue whenever can_receive can go from false to true

When the guests replenish the receive ring buffer, the network device
should flush its queue of pending packets.  This is done with
qemu_flush_queued_packets.

e1000's can_receive can go from false to true when RCTL or RDT are
modified.

Reported-by: Luigi Rizzo &lt;rizzo@iet.unipi.it&gt;
Cc: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Cc: Jan Kiszka &lt;jan.kiszka@siemens.de&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Amos Kong &lt;akong@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
(cherry picked from commit e8b4c680b41bd960ecccd9ff076b7b058e0afcd4)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 65a2f8e27c335c7edf4d6c8d1e1b7fb0090c72ff
      https://github.com/qemu/qemu/commit/65a2f8e27c335c7edf4d6c8d1e1b7fb0090c72ff
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/xen_nic.c

  Log Message:
  -----------
  xen: flush queue when getting an event

xen does not have a register that, when written, will cause can_receive
to go from false to true.  However, flushing the queue can be attempted
whenever the front-end raises its side of the Xen event channel.  There
is a single event channel for tx and rx.

Cc: Stefano Stabellini &lt;stefano.stabellini@eu.citrix.com&gt;
Cc: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Amos Kong &lt;akong@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
(cherry picked from commit a98b140223d3a627eab7ee3ddec645bab630d756)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: bfa23099aa1897f3a8dec7228e8ab23947d504ee
      https://github.com/qemu/qemu/commit/bfa23099aa1897f3a8dec7228e8ab23947d504ee
  Author: Bo Yang &lt;boyang@suse.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/eepro100.c

  Log Message:
  -----------
  eepro100: Fix network hang when rx buffers run out

This is reported by QA. When installing os with pxe, after the initial
kernel and initrd are loaded, the procedure tries to copy files from install
server to local harddisk, the network becomes stall because of running out of
receive descriptor.

[Whitespace fixes and removed qemu_notify_event() because Paolo's
earlier net patches have moved it into qemu_flush_queued_packets().

Additional info:

I can reproduce the network hang with a tap device doing a iPXE HTTP
boot as follows:

  $ qemu -enable-kvm -m 1024 \
    -netdev tap,id=netdev0,script=no,downscript=no \
    -device i82559er,netdev=netdev0,romfile=80861209.rom \
    -drive if=virtio,cache=none,file=test.img
  iPXE&gt; ifopen net0
  iPXE&gt; config # set static network configuration
  iPXE&gt; kernel http://mirror.bytemark.co.uk/fedora/linux/releases/17/Fedora/x86_64/os/images/pxeboot/vmlinuz


I needed a vanilla iPXE ROM to get to the iPXE prompt.  I think the boot
prompt has been disabled in the ROMs that ship with QEMU to reduce boot
time.

During the vmlinuz HTTP download there is a network hang.  hw/eepro100.c
has reached the end of the rx descriptor list.  When the iPXE driver
replenishes the rx descriptor list we don't kick the QEMU net subsystem
and event loop, thereby leaving the tap netdev without its file
descriptor in select(2).

Stefan Hajnoczi &lt;stefanha@gmail.com&gt;]

Signed-off-by: Bo Yang &lt;boyang@suse.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;
(cherry picked from commit 1069985fb132cd4324fc02d371f1e61492a1823f)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 0d91cd5aa7ddc678f80f47041aa2ed5277172d9c
      https://github.com/qemu/qemu/commit/0d91cd5aa7ddc678f80f47041aa2ed5277172d9c
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M net.c

  Log Message:
  -----------
  net: add receive_disabled logic to iov delivery path

This patch adds the missing NetClient-&gt;receive_disabled logic in the
sendv delivery code path.  It seems that commit
893379efd0e1b84ceb0c42a713293f3dbd27b1bd ("net: disable receiving if
client returns zero") only added the logic to qemu_deliver_packet() and
not qemu_deliver_packet_iov().

The receive_disabled flag should be automatically set when .receive(),
.receive_raw(), or .receive_iov() return 0.  No further packets will be
delivered to the NetClient until the receive_disabled flag is cleared
again by calling qemu_flush_queued_packets().

Typically the NetClient will wait until its file descriptor becomes
writable and then invoke qemu_flush_queued_packets() to resume
transmission.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
(cherry picked from commit c67f5dc10573687497f0f5c3aec19b15c35c63d7)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: a9d8f7b1c41a8a346f4cf5a0c6963a79fbd1249e
      https://github.com/qemu/qemu/commit/a9d8f7b1c41a8a346f4cf5a0c6963a79fbd1249e
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M net/queue.c

  Log Message:
  -----------
  net: do not report queued packets as sent

Net send functions have a return value where 0 means the packet has not
been sent and will be queued.  A non-zero value means the packet was
sent or an error caused the packet to be dropped.

This patch fixes two instances where packets are queued but we return
their size.  This causes callers to believe the packets were sent.  When
the caller uses the async send interface this creates a real problem
because the callback will be invoked for a packet that the caller
believed to be already sent.  This bug can cause double-frees in the
caller.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
(cherry picked from commit 06b5f36d052b540a59b52150582d65674199b2ce)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: aa69dd05ce1a0cece7a1462807b3c4841f1ba01e
      https://github.com/qemu/qemu/commit/aa69dd05ce1a0cece7a1462807b3c4841f1ba01e
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M qemu-options.hx

  Log Message:
  -----------
  net: add -netdev options to man page

Document the -netdev syntax which supercedes the older -net syntax.
This patch is a first step to making -netdev prominent in the QEMU
manual.

Reported-by: Anatoly Techtonik &lt;techtonik@gmail.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
(cherry picked from commit 08d12022c7f1aba6acccc75150659c6e4c9dff23)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 2747a3eee3d679bdffd35dc5bfa970fd80c4969e
      https://github.com/qemu/qemu/commit/2747a3eee3d679bdffd35dc5bfa970fd80c4969e
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/dev-network.c

  Log Message:
  -----------
  net: clean up usbnet_receive()

The USB network interface has two code paths depending on whether or not
RNDIS mode is enabled.  Refactor usbnet_receive() so that there is a
common path throughout the function instead of duplicating everything
across if (is_rndis(s)) ... else ... code paths.

Clean up coding style and 80 character line wrap along the way.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
(cherry picked from commit f237ddbb89142c6948a2257c459e49dee7500a7c)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: d8f481188025e56c229e3fd41afa1d17f9e0cff0
      https://github.com/qemu/qemu/commit/d8f481188025e56c229e3fd41afa1d17f9e0cff0
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/dev-network.c

  Log Message:
  -----------
  net: fix usbnet_receive() packet drops

The USB network interface has a single buffer which the guest reads
from.  This patch prevents multiple calls to usbnet_receive() from
clobbering the input buffer.  Instead we queue packets until buffer
space becomes available again.

This is inspired by virtio-net and e1000 rxbuf handling.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
(cherry picked from commit 190563f9a90c9df8ad32fc7f3e4b166deda949a6)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 5c8240c09ccb73e53984a2af80a6b90659e7b131
      https://github.com/qemu/qemu/commit/5c8240c09ccb73e53984a2af80a6b90659e7b131
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M net/hub.c

  Log Message:
  -----------
  net: broadcast hub packets if at least one port can receive

In commit 60c07d933c66c4b30a83b7ccbc8a0cb3df1b2d0e ("net: fix
qemu_can_send_packet logic") the "VLAN" broadcast behavior was changed
to queue packets if any net client cannot receive.  It turns out that
this was not actually the right fix and just hides the real bug that
hw/usb/dev-network.c:usbnet_receive() clobbers its receive buffer when
called multiple times in a row.  The commit also introduced a new bug
that "VLAN" packets would not be sent if one of multiple net clients was
down.

The hw/usb/dev-network.c bug has since been fixed, so this patch reverts
broadcast behavior to send packets as long as one net client can
receive.  Packets simply get queued for the net clients that are
temporarily unable to receive.

Reported-by: Roy.Li &lt;rongqing.li@windriver.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
(cherry picked from commit 61518a74ca98870e8ff132f91dd5dda252e31f58)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ab52df7712e0efe3bee32ccfed79729cb9dec9f8
      https://github.com/qemu/qemu/commit/ab52df7712e0efe3bee32ccfed79729cb9dec9f8
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M net/socket.c

  Log Message:
  -----------
  net: asynchronous send/receive infrastructure for net/socket.c

The net/socket.c net client is not truly asynchronous.  This patch
borrows the qemu_set_fd_handler2() code from net/tap.c as the basis for
proper asynchronous send/receive.

Only read packets from the socket when the peer is able to receive.
This avoids needless queuing.

Later patches implement asynchronous send.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
(cherry picked from commit 863f678fba4191f3b695620f41056cb7c124425d)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 9d72a090b2f68201701b10b765c8b3eac596b3bc
      https://github.com/qemu/qemu/commit/9d72a090b2f68201701b10b765c8b3eac596b3bc
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M net/socket.c

  Log Message:
  -----------
  net: EAGAIN handling for net/socket.c UDP

Implement asynchronous send for UDP (or other SOCK_DGRAM) sockets.  If
send fails with EAGAIN we wait for the socket to become writable again.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
(cherry picked from commit 213fd5087e2e4e2da10ad266df0ba950cf7618bf)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: a638498f513e68aacd6306b56afd504383713665
      https://github.com/qemu/qemu/commit/a638498f513e68aacd6306b56afd504383713665
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M net/socket.c

  Log Message:
  -----------
  net: EAGAIN handling for net/socket.c TCP

Replace spinning send_all() with a proper non-blocking send.  When the
socket write buffer limit is reached, we should stop trying to send and
wait for the socket to become writable again.

Non-blocking TCP sockets can return in two different ways when the write
buffer limit is reached:

1. ret = -1 and errno = EAGAIN/EWOULDBLOCK.  No data has been written.

2. ret &lt; total_size.  Short write, only part of the message was
   transmitted.

Handle both cases and keep track of how many bytes have been written in
s-&gt;send_index.  (This includes the 'length' header before the actual
payload buffer.)

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
(cherry picked from commit 45a7f54a8bb3928ffa58d522e0d61acaee8277bb)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: a63eb7a22731c4b0ec863582231f24c4b32b5969
      https://github.com/qemu/qemu/commit/a63eb7a22731c4b0ec863582231f24c4b32b5969
  Author: Yann E. MORIN &lt;yann.morin.1998@free.fr&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: fix seccomp check

Currently, if libseccomp is missing but the user explicitly requested
seccomp support using --enable-seccomp, configure silently ignores the
situation and disables seccomp support.

This is unlike all other tests that explicitly fail in such situation.

Fix that.

Signed-off-by: "Yann E. MORIN" &lt;yann.morin.1998@free.fr&gt;
Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;
(cherry picked from commit e84d5956cc6215d2f098e7b6090fc5ec4cba1be3)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 5d6ad6262b0c43400d60d7db37c0b9b524be3bd3
      https://github.com/qemu/qemu/commit/5d6ad6262b0c43400d60d7db37c0b9b524be3bd3
  Author: Natanael Copa &lt;natanael.copa@gmail.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: properly check if -lrt and -lm is needed

Fixes build against uClibc.

uClibc provides 2 versions of clock_gettime(), one with realtime
support and one without (this is so you can avoid linking in -lrt
unless actually needed). This means that the clock_gettime() don't
need -lrt. We still need it for timer_create() so we check for this
function in addition.

We also need check if -lm is needed for isnan().

Both -lm and -lrt are needed for libs_qga.

Signed-off-by: Natanael Copa &lt;ncopa@alpinelinux.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
(cherry picked from commit 8bacde8d86a09699207d85d4bab06162aed18dc4)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 57683d635420c8cd01e67db3b0129d9b143913b3
      https://github.com/qemu/qemu/commit/57683d635420c8cd01e67db3b0129d9b143913b3
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M qemu-char.c

  Log Message:
  -----------
  Revert 455aa1e08 and c3767ed0eb

    commit c3767ed0eb5d0bb25fe409ae5dec06e3411ff1b6
    qemu-char: (Re-)connect for tcp_chr_write() unconnected writing

Has no hope of working because tcp_chr_connect() does not actually connect.

455aa1e08 just fixes the SEGV with server() but the attempt to connect a client
socket is still completely broken.

This patch reverts both.

Reported-by: Richard W.M. Jones &lt;rjones@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 6db0fdce02d72546a4c47100a9b2cd0090cf464d)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 8484fead29c731a5902b1c183e64c179a13a15b8
      https://github.com/qemu/qemu/commit/8484fead29c731a5902b1c183e64c179a13a15b8
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M iohandler.c
    M qemu-char.c

  Log Message:
  -----------
  qemu-char: BUGFIX, don't call FD_ISSET with negative fd

tcp_chr_connect(), unlike for example udp_chr_update_read_handler() does
not check if the fd it is using is valid (&gt;= 0) before passing it to
qemu_set_fd_handler2().  If using e.g. a TCP serial port, which is not
initially connected, this can result in -1 being passed to FD_ISSET, which
has undefined behaviour.  On x86 it seems to harmlessly return 0, but on
PowerPC, it causes a fortify buffer overflow error to be thrown.

This patch fixes this by putting an extra test in tcp_chr_connect(), and
also adds an assert qemu_set_fd_handler2() to catch other such errors on
all platforms, rather than just some.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit bbdd2ad0814ea0911076419ea21b7957505cf1cc)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 668194d5a515247768d95f10fea933e27e3e3c95
      https://github.com/qemu/qemu/commit/668194d5a515247768d95f10fea933e27e3e3c95
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M exec.c

  Log Message:
  -----------
  cpu_physical_memory_write_rom() needs to do TB invalidates

cpu_physical_memory_write_rom(), despite the name, can also be used to
write images into RAM - and will often be used that way if the machine
uses load_image_targphys() into RAM addresses.

However, cpu_physical_memory_write_rom(), unlike cpu_physical_memory_rw()
doesn't invalidate any cached TBs which might be affected by the region
written.

This was breaking reset (under full emu) on the pseries machine - we loaded
our firmware image into RAM, and while executing it rewrite the code at
the entry point (correctly causing a TB invalidate/refresh).  When we
reset the firmware image was reloaded, but the TB from the rewrite was
still active and caused us to get an illegal instruction trap.

This patch fixes the bug by duplicating the tb invalidate code from
cpu_physical_memory_rw() in cpu_physical_memory_write_rom().

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 0b57e287138728f72d88b06e69b970c5d745c44a)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: b52c8f78f211d2b7f8fed92d02048095504df3a2
      https://github.com/qemu/qemu/commit/b52c8f78f211d2b7f8fed92d02048095504df3a2
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M arch_init.c

  Log Message:
  -----------
  arch_init.c: Improve '-soundhw help' for non-HAS_AUDIO_CHOICE archs

For architectures which don't set HAS_AUDIO_CHOICE, improve the
'-soundhw help' message so that it doesn't simply print an empty
list, implying no sound support at all.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;
(cherry picked from commit 55d4fd3c24bd253bd96270c7fdf1bb862f3a3400)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 34129550666731e3e163f136bee87a158dcdce26
      https://github.com/qemu/qemu/commit/34129550666731e3e163f136bee87a158dcdce26
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/xilinx.h
    M hw/xilinx_timer.c

  Log Message:
  -----------
  xilinx_timer: Removed comma in device name

Fixes an error in a61e4b07a30c062260d2d01771773f14820d1eb7

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
(cherry picked from commit c0a1dcb9f0baf9269f8baeb02cbcca8dad75454c)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 36d7fb299a7c914ec6cc7cc8a30099a5a5a7af58
      https://github.com/qemu/qemu/commit/36d7fb299a7c914ec6cc7cc8a30099a5a5a7af58
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/xilinx_timer.c

  Log Message:
  -----------
  xilinx_timer: Send dbg msgs to stderr not stdout

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
(cherry picked from commit e03377ae75808d33d0a7afc803b37bcda9f796b3)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 85368b79a01cc4f227673def44b1932f62c4bca5
      https://github.com/qemu/qemu/commit/85368b79a01cc4f227673def44b1932f62c4bca5
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/xilinx.h

  Log Message:
  -----------
  xilinx.h: Error check when setting links

Assert that the ethernet and dma controller are sucessfully linked to their
peers.

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
(cherry picked from commit 4b5e52101f9ad077d1c016f2b7130e2fdae6d2da)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 584717a39a2ad3ee94629599f7a181900945923e
      https://github.com/qemu/qemu/commit/584717a39a2ad3ee94629599f7a181900945923e
  Author: Chris Wulff &lt;crwulff@gmail.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/xilinx_timer.c

  Log Message:
  -----------
  xilinx_timer: Fix a compile error if debug enabled

There was a missing include of qemu-log and a variable name in a printf was out
of date.

Signed-off-by: Chris Wulff &lt;crwulff@gmail.com&gt;
Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
(cherry picked from commit 8354cd722e0afae63bee3e4cb21c8f0ddb6874c2)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 68958c31b5dcacc7c8529cd47be9979ed853a324
      https://github.com/qemu/qemu/commit/68958c31b5dcacc7c8529cd47be9979ed853a324
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/pflash_cfi01.c

  Log Message:
  -----------
  pflash_cfi01: fix vendor specific extended query

pflash_cfi01 announces a version number of 1.1, which implies
"Protection Register Information" and "Burst Read information"
sections, which are not provided.

Decrease the version number to 1.0 so that only the "Protection
Register Information" section is needed.

Set the number of protection fields (0x3f) to 0x01, as 0x00 means 256
protections field, which makes the CFI table bigger than the current
implementation, causing some kernels to fail to read it.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit 262e1eaafabf32d33a9fa0b03b3c8ea426c5ae1b)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: e8ca4a8ac7cdbb3c79d969815351107fae5ad867
      https://github.com/qemu/qemu/commit/e8ca4a8ac7cdbb3c79d969815351107fae5ad867
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M MAINTAINERS

  Log Message:
  -----------
  MAINTAINERS: Add entry for QOM CPU

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
(cherry picked from commit f2ca052414d7eddc10517e98a5a27ba8099b19b1)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ae06193d73534719cd3631ca06f1420d40e2d5fc
      https://github.com/qemu/qemu/commit/ae06193d73534719cd3631ca06f1420d40e2d5fc
  Author: Ronnie Sahlberg &lt;ronniesahlberg@gmail.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M block/iscsi.c

  Log Message:
  -----------
  iSCSI: We need to support SG_IO also from iscsi_ioctl()

We need to support SG_IO from the synchronous iscsi_ioctl() since
scsi-block uses this to do an INQ to the device to discover its properties
This patch makes scsi-block work with iscsi.

Signed-off-by: Ronnie Sahlberg &lt;ronniesahlberg@gmail.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
(cherry picked from commit f1a12821d7df2e4d21be4f2206f84b4640533e53)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 60088e5b8332fc523919a137231824e222730636
      https://github.com/qemu/qemu/commit/60088e5b8332fc523919a137231824e222730636
  Author: Ronnie Sahlberg &lt;ronniesahlberg@gmail.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M block/iscsi.c

  Log Message:
  -----------
  iSCSI: We dont need to explicitely call qemu_notify_event() any more

We no longer need to explicitely call qemu_notify_event() any more
since this is now done automatically any time the filehandles we listen
to change.

Signed-off-by: Ronnie Sahlberg &lt;ronniesahlberg@gmail.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
(cherry picked from commit 40a13ca8d28c21062e35b10d9b80e76b92405bdf)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 394a2f28cb186a4c421a358204387da58d1ee7a1
      https://github.com/qemu/qemu/commit/394a2f28cb186a4c421a358204387da58d1ee7a1
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/scsi-disk.c

  Log Message:
  -----------
  scsi-disk: introduce check_lba_range

Abstract the test for an out-of-range (starting block, block count)
pair.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
(cherry picked from commit 444bc908611ccaf4512dc37c33ac3b54d873a62b)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ff498e4a0dc188d2a441af6111065dd55feab57b
      https://github.com/qemu/qemu/commit/ff498e4a0dc188d2a441af6111065dd55feab57b
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/scsi-disk.c

  Log Message:
  -----------
  scsi-disk: fix check for out-of-range LBA

This fix is needed to correctly handle 0-block read and writes.
Without it, a 0-block access at LBA 0 would underflow.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
(cherry picked from commit 12ca76fc48081b3a0ad1a70546abfcf198aedfc4)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 75a44ae297b67aef5378f25fcf49b035e563b29b
      https://github.com/qemu/qemu/commit/75a44ae297b67aef5378f25fcf49b035e563b29b
  Author: Ronnie Sahlberg &lt;ronniesahlberg@gmail.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/scsi-disk.c

  Log Message:
  -----------
  SCSI: Standard INQUIRY data should report HiSup flag as set.

QEMU as far as I know only reports LUN numbers using the modes that
are described in SAM4.
As such, since all LUN numbers generated by the SCSI emulation in QEMU
follow SAM4, we should set the HiSup bit in the standard INQUIRY data
to indicate such.

&gt; From SAM4:
  4.6.3 LUNs overview
  All LUN formats described in this standard are hierarchical in
  structure even when only a single level in that hierarchy is used.
  The HISUP bit shall be set to one in the standard INQUIRY data
  (see SPC-4) when any LUN format described in this standard is used.
  Non-hierarchical formats are outside the scope of this standard.

Signed-off-by: Ronnie Sahlberg &lt;ronniesahlberg@gmail.com&gt;
(cherry picked from commit 1109c894052751df99962c009fd7dbae397721f5)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: b79ba45af114a5674a4790775502dbff26f6d3b7
      https://github.com/qemu/qemu/commit/b79ba45af114a5674a4790775502dbff26f6d3b7
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M audio/audio_template.h

  Log Message:
  -----------
  audio: Fix warning from static code analysis

smatch report:
audio/audio_template.h:416 AUD_open_out(18) warn:
 variable dereferenced before check 'as' (see line 414)

Moving the ldebug statement after the statement which checks 'as'
fixes that warning.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;
(cherry picked from commit 93b6599734f81328ee3d608f57667742cafeea72)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 907a34c9d7038abd68f9c06f026d7f049b5dbbe5
      https://github.com/qemu/qemu/commit/907a34c9d7038abd68f9c06f026d7f049b5dbbe5
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M qemu-ga.c

  Log Message:
  -----------
  qemu-ga: Remove unreachable code after g_error

Report from smatch:
qemu-ga.c:117 register_signal_handlers(11) info: ignoring unreachable code.
qemu-ga.c:122 register_signal_handlers(16) info: ignoring unreachable code.

g_error calls abort which terminates the program.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;
(cherry picked from commit b548828862d3bf7214b7ef9cb361356b153b89c9)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 3c980e22acc8fcb070688417eb0d6d35d80c2b6b
      https://github.com/qemu/qemu/commit/3c980e22acc8fcb070688417eb0d6d35d80c2b6b
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M qemu-sockets.c

  Log Message:
  -----------
  qemu-sockets: Fix potential memory leak

The old code leaks variable 'peer'.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;
(cherry picked from commit 39b384591fda27d6e1213cea0b11b1ebe0ed4b74)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 96d90d32ac4f3f2d39e0df881e0a9b12007a6d0d
      https://github.com/qemu/qemu/commit/96d90d32ac4f3f2d39e0df881e0a9b12007a6d0d
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/cadence_uart.c

  Log Message:
  -----------
  cadence_uart: Fix buffer overflow

Report from smatch:
hw/cadence_uart.c:413 uart_read(13) error: buffer overflow 's-&gt;r' 18 &lt;= 18

This fixes read access to s-&gt;r[R_MAX] which is behind the limits of s-&gt;r.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;
(cherry picked from commit 5d40097fc09fe5d34cf316a411dc27d455ac2cd0)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 2b9a5aca51fba0d02af3ed5768adb1f448327d2f
      https://github.com/qemu/qemu/commit/2b9a5aca51fba0d02af3ed5768adb1f448327d2f
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/lm4549.c

  Log Message:
  -----------
  lm4549: Fix buffer overflow

Report from smatch:
lm4549.c:234 lm4549_write_samples(14) error:
 buffer overflow 's-&gt;buffer' 1024 &lt;= 1024

There must be enough space to add two entries starting with index
s-&gt;buffer_level, therefore the old check was wrong.

[Peter Maydell &lt;peter.maydell@linaro.org&gt; clarifies the nature of the
analyser warning:

I don't object to making the change to placate the analyser,
but I don't think this is actually a buffer overrun. We always
add and remove samples from the buffer two at a time, so it's
not possible to get here with s-&gt;buffer_level == BUFFER_SIZE-1
(which is the only case where the old and new conditions
give different answers).]

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;
(cherry picked from commit 8139626643cbe8dc07bd9acc88057effeedf8064)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 4d0fcc1968afbcd69be08849016300d20a8d4023
      https://github.com/qemu/qemu/commit/4d0fcc1968afbcd69be08849016300d20a8d4023
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/ioh3420.c

  Log Message:
  -----------
  ioh3420: Remove unreachable code

Report from smatch:
hw/ioh3420.c:128 ioh3420_initfn(35) info: ignoring unreachable code.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Juan Quintela &lt;quintela@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;
(cherry picked from commit 997f15672a5ca7714cf310d92f475d2c5fe40970)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: f3e98930787bc1cf21d962dc121448dea713b891
      https://github.com/qemu/qemu/commit/f3e98930787bc1cf21d962dc121448dea713b891
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/pflash_cfi01.c

  Log Message:
  -----------
  pflash_cfi01: Fix warning caused by unreachable code

Report from smatch:
hw/pflash_cfi01.c:431 pflash_write(180) info: ignoring unreachable code.

Instead of removing the return statement after the switch statement,
the patch replaces the return statements in the switch statement by
break statements. Other switch statements in the same code do it also
like that.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;
(cherry picked from commit 12dabc79f976d66755025272f7e2e8e4da31715a)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 57304014425895659dbfd75fea06c6d4183fe03c
      https://github.com/qemu/qemu/commit/57304014425895659dbfd75fea06c6d4183fe03c
  Author: Hitoshi Mitake &lt;h.mitake@gmail.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M os-posix.c
    M qemu-os-posix.h
    M qemu-os-win32.h
    M vl.c

  Log Message:
  -----------
  curses: don't initialize curses when qemu is daemonized

Current qemu initializes curses even if -daemonize option is
passed. This cause problem because shell prompt appears without
calling endwin().

This patch adds new function, is_daemonized(), to OS dependent
code. With this function, curses_display_init() can check that qemu is
daemonized or not. If daemonized, curses_display_init() isn't called
and the problem is avoided.

Of course, -daemonize &amp;&amp; -curses doesn't make sense. Users shouldn't
pass the arguments at the same time. But the problem is very painful
because Ctrl-C cannot be delivered to the terminal.

Cc: Andrzej Zaborowski  &lt;balrog@zabor.org&gt;
Cc: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;
Cc: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Cc: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Signed-off-by: Hitoshi Mitake &lt;h.mitake@gmail.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;
(cherry picked from commit 995ee2bf469de6bbe5ce133ec853392b2a4ce34c)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: a2aad5fdc49b540d8b41c0a54c7078d034a3cf75
      https://github.com/qemu/qemu/commit/a2aad5fdc49b540d8b41c0a54c7078d034a3cf75
  Author: Laszlo Ersek &lt;lersek@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M console.c

  Log Message:
  -----------
  TextConsole: saturate escape parameter in TTY_STATE_CSI

Signed-off-by: Laszlo Ersek &lt;lersek@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;
(cherry picked from commit c10600af60865ba6c60987be313102ebb5fcee57)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 61dea8e914440d02720a929ad78178ed821f9946
      https://github.com/qemu/qemu/commit/61dea8e914440d02720a929ad78178ed821f9946
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M linux-user/syscall.c

  Log Message:
  -----------
  linux-user: Remove redundant null check and replace free by g_free

Report from smatch:

linux-user/syscall.c:3632 do_ioctl_dm(220) info:
 redundant null check on big_buf calling free()

'big_buf' was allocated by g_malloc0, therefore free was also
replaced by g_free.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;
(cherry picked from commit ad11ad77748bdd8016370db210751683dc038dd6)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: d4413913e1709bdbc892260124843e75e55d0eed
      https://github.com/qemu/qemu/commit/d4413913e1709bdbc892260124843e75e55d0eed
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M net/socket.c
    M qemu-common.h

  Log Message:
  -----------
  net/socket: Fix compiler warning (regression for MinGW)

Commit 213fd5087e2e4e2da10ad266df0ba950cf7618bf removed a type cast
which is needed for MinGW:

net/socket.c:136: warning:
 pointer targets in passing argument 2 of âsendto' differ in signedness
/usr/lib/gcc/amd64-mingw32msvc/4.4.4/../../../../amd64-mingw32msvc/include/winsock2.h:1313: \
note:  expected âconst char *' but argument is of type âconst uint8_t *'

Add a 'qemu_sendto' macro which provides that type cast where needed
and use the new macro instead of 'sendto'.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;
(cherry picked from commit 73062dfe6be0050dbd43ce3516e935ebb2545add)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 78fd27b3b6f0953a52b4a0f4d63265574d998582
      https://github.com/qemu/qemu/commit/78fd27b3b6f0953a52b4a0f4d63265574d998582
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M compiler.h

  Log Message:
  -----------
  w32: Always use standard instead of native format strings

GLib 2.0 include files use __printf__ for the format attribute
which resolves to native format strings on w32 hosts.

QEMU wants standard format strings instead of native format
strings, so we simply change any declaration with __printf__
to use __gnu_printf__.

This works because all basic printf functions support both
kinds of format strings.

This fixes a compiler warning:

qapi/string-output-visitor.c: In function âprint_type_int':
qapi/string-output-visitor.c:34:5: warning: unknown conversion type character âl' \
in format [-Wformat] qapi/string-output-visitor.c:34:5: warning: too many arguments \
for format [-Wformat-extra-args]

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;
(cherry picked from commit 95df51a4a02a853af8828c281bce2d4f2a41d6fd)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: eea54caab066abb4c82573d552a49747f896665d
      https://github.com/qemu/qemu/commit/eea54caab066abb4c82573d552a49747f896665d
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M oslib-win32.c
    M qemu-os-win32.h

  Log Message:
  -----------
  w32: Add implementation of gmtime_r, localtime_r

Those functions are missing in MinGW.

Some versions of MinGW-w64 include defines for gmtime_r and localtime_r.
Older versions of these macros are buggy (they return a pointer to a
static variable), therefore we don't want them. Newer versions are
similar to the code used here, but without the memset.

The implementation which is used here is not strictly reentrant,
but sufficiently good for QEMU on w32 or w64.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
[blauwirbel@gmail.com: added comment about locking]
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
(cherry picked from commit d3e8f95753114a827f9cd8e819b1d5cc8333f76b)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 513cdda198bac6c40e8847c8e8136ec974b67da7
      https://github.com/qemu/qemu/commit/513cdda198bac6c40e8847c8e8136ec974b67da7
  Author: Kevin Shanahan &lt;kmshanah@disenchant.net&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M blockdev.c

  Log Message:
  -----------
  blockdev: preserve readonly and snapshot states across media changes

If readonly=on is given at device creation time, the -&gt;readonly flag
needs to be set in the block driver state for this device so that
readonly-ness is preserved across media changes (qmp change command).
Similarly, to preserve the snapshot property requires -&gt;open_flags to
be correct.

Signed-off-by: Kevin Shanahan &lt;kmshanah@disenchant.net&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
(cherry picked from commit 80dd1aae3657a902d262f5d20a7a3c655b23705e)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: d80210efbc96cc92c843eca6ab875665c6063a39
      https://github.com/qemu/qemu/commit/d80210efbc96cc92c843eca6ab875665c6063a39
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M block.c
    M block.h

  Log Message:
  -----------
  block: correctly set the keep_read_only flag

I believe the bs-&gt;keep_read_only flag is supposed to reflect
the initial open state of the device. If the device is initially
opened R/O, then commit operations, or reopen operations changing
to R/W, are prohibited.

Currently, the keep_read_only flag is only accurate for the active
layer, and its backing file. Subsequent images end up always having
the keep_read_only flag set.

For instance, what happens now:

[  base  ]  kro = 1, ro = 1
    |
    v
[ snap-1 ]  kro = 1, ro = 1
    |
    v
[ snap-2 ]  kro = 0, ro = 1
    |
    v
[ active ]  kro = 0, ro = 0

What we want:

[  base  ]  kro = 0, ro = 1
    |
    v
[ snap-1 ]  kro = 0, ro = 1
    |
    v
[ snap-2 ]  kro = 0, ro = 1
    |
    v
[ active ]  kro = 0, ro = 0

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
(cherry picked from commit be028adcedd68ca4d78fdc43e7e2fa4f1cdbc653)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: b83465006d2a747c70c6ba4eb0fc8bf827852492
      https://github.com/qemu/qemu/commit/b83465006d2a747c70c6ba4eb0fc8bf827852492
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M Makefile
    M configure

  Log Message:
  -----------
  configure: Allow builds without any system or user emulation

The old code aborted configure when no emulation target was selected.
Even after removing the 'exit 1', it tried to read from STDIN
when QEMU was configured with

    configure' '--disable-user' '--disable-system'

This is fixed here.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 8bdd3d499fe0ddffa9901c56ab3bc8911d5b8be0)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 57f8a4c507be7b850756496e224e1dd3e9efc70e
      https://github.com/qemu/qemu/commit/57f8a4c507be7b850756496e224e1dd3e9efc70e
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M qemu-sockets.c

  Log Message:
  -----------
  Refactor inet_connect_opts function

refactor address resolution code to fix nonblocking connect
remove getnameinfo call

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Amos Kong &lt;akong@redhat.com&gt;
Signed-off-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 05bc1d8a4b2f77df8cc9880a552047e30c16f1f8)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ee0999b16af3cfd874a1bd9a0cfe3f60426878cf
      https://github.com/qemu/qemu/commit/ee0999b16af3cfd874a1bd9a0cfe3f60426878cf
  Author: Orit Wasserman &lt;owasserm@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M migration-tcp.c
    M nbd.c
    M qemu-char.c
    M qemu-sockets.c
    M qemu_socket.h
    M ui/vnc.c

  Log Message:
  -----------
  Separate inet_connect into inet_connect (blocking) and inet_nonblocking_connect

No need to add non blocking parameters to the blocking inet_connect
add block parameter for inet_connect_opts instead of using QemuOpt "block".

Signed-off-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 5db5f44cb4b7f24b9e0efdefc9015e36b7c34881)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 240f68ce5b9bdd13f859c80f286332036de33e6b
      https://github.com/qemu/qemu/commit/240f68ce5b9bdd13f859c80f286332036de33e6b
  Author: Orit Wasserman &lt;owasserm@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M migration-tcp.c
    M qemu-char.c
    M qemu-sockets.c
    M qemu_socket.h

  Log Message:
  -----------
  Fix address handling in inet_nonblocking_connect

getaddrinfo can give us a list of addresses, but we only try to
connect to the first one. If that fails we never proceed to
the next one.  This is common on desktop setups that often have ipv6
configured but not actually working.

To fix this make inet_connect_nonblocking retry connection with a different
address.
callers on inet_nonblocking_connect register a callback function that will
be called when connect opertion completes, in case of failure the fd will have
a negative value

Signed-off-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 233aa5c2d1cf4655ffe335025a68cf5454f87dad)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: d893e56f7249708080e2d363ce19d30a6de30733
      https://github.com/qemu/qemu/commit/d893e56f7249708080e2d363ce19d30a6de30733
  Author: Orit Wasserman &lt;owasserm@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M migration.c

  Log Message:
  -----------
  Clear handler only for valid fd

Signed-off-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 3202becaa2b805497ce9e6faa6edfb83665f91b1)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 806d996789a01b09953b051350321183e272c76d
      https://github.com/qemu/qemu/commit/806d996789a01b09953b051350321183e272c76d
  Author: Brendan Fennell &lt;bfennell@skynet.ie&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/pl190.c

  Log Message:
  -----------
  pl190: fix read of VECTADDR

Reading VECTADDR was causing us to set the current priority to
the wrong value, the most obvious effect of which was that we
would return the vector for the wrong interrupt as the result
of the read.

Signed-off-by: Brendan Fennell &lt;bfennell@skynet.ie&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
(cherry picked from commit 14c126baf1c38607c5bd988878de85a06cefd8cf)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 14bdf978efc5de2a6b6d1f17f8561a2ac6c58541
      https://github.com/qemu/qemu/commit/14bdf978efc5de2a6b6d1f17f8561a2ac6c58541
  Author: Meador Inge &lt;meadori@codesourcery.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/armv7m_nvic.c

  Log Message:
  -----------
  hw/armv7m_nvic: Correctly register GIC region when setting up NVIC

When setting up the NVIC memory regions the memory range
0x100..0xcff is aliased to an IO memory region that belongs
to the ARM GIC.  This aliased region should be added to the
NVIC memory container, but the actual GIC IO memory region
was being added instead.  This mixup was causing the wrong
IO memory access functions to be called when accessing parts
of the NVIC memory.

Signed-off-by: Meador Inge &lt;meadori@codesourcery.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
(cherry picked from commit 9892cae39562d2e6c00ccc5966302c00f23be6d4)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 3e1954cb4aff1cb4108903d7b43fb93c4482dff1
      https://github.com/qemu/qemu/commit/3e1954cb4aff1cb4108903d7b43fb93c4482dff1
  Author: Francesco Lavra &lt;francescolavra.fl@gmail.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/vexpress.c

  Log Message:
  -----------
  Versatile Express: Fix NOR flash 0 address and remove flash alias

In the A series memory map (implemented in the Cortex A15 CoreTile), the
first NOR flash bank (flash 0) is mapped to address 0x08000000, while
address 0x00000000 can be configured as alias to either the first or the
second flash bank. This patch fixes the definition of flash 0 address,
and for simplicity removes the alias definition.

Signed-off-by: Francesco Lavra &lt;francescolavra.fl@gmail.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
(cherry picked from commit 661bafb3e14bfffcb0a7c7910534c7944608ca45)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 68fc5d1d27af39f21c688e6f4b0ea22d66800736
      https://github.com/qemu/qemu/commit/68fc5d1d27af39f21c688e6f4b0ea22d66800736
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M target-i386/kvm.c

  Log Message:
  -----------
  i386: kvm: bit 10 of CPUID[8000_0001].EDX is reserved

Bit 10 of CPUID[8000_0001].EDX is not defined as an alias of
CPUID[1].EDX[10], so do not duplicate it on
kvm_arch_get_supported_cpuid().

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Reviewed-By: Igor Mammedov &lt;imammedo@redhat.com&gt;
Reviewed-by: Don Slutz &lt;Don@CloudSwitch.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
(cherry picked from commit b1f4679392a03f2b26a37bfa52e95d6cc4f73d82)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: a8f2299d1b170b6100b0e9ad00788a7a7e31719b
      https://github.com/qemu/qemu/commit/a8f2299d1b170b6100b0e9ad00788a7a7e31719b
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M fpu/softfloat.c

  Log Message:
  -----------
  fpu/softfloat.c: Return correctly signed values from uint64_to_float32

The uint64_to_float32() conversion function was incorrectly always
returning numbers with the sign bit set (ie negative numbers). Correct
this so we return positive numbers instead.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit e744c06fca438dc08271e626034e632a270c91c8)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 159fe82dea23fdaf2e747d09c4f71afee00f664c
      https://github.com/qemu/qemu/commit/159fe82dea23fdaf2e747d09c4f71afee00f664c
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/spapr.c
    M hw/spapr_hcall.c

  Log Message:
  -----------
  pseries: Don't test for MSR_PR for hypercalls under KVM

PAPR hypercalls should only be invoked from the guest kernel, not guest
user programs, that is, with MSR[PR]=0.  Currently we check this in
spapr_hypercall, returning H_PRIVILEGE if MSR[PR]=1.

However, under KVM the state of MSR[PR] is already checked by the host
kernel before passing the hypercall to qemu, making this check redundant.
Worse, however, we don't generally synchronize KVM and qemu state on the
hypercall path, meaning that qemu could incorrectly reject a hypercall
because it has a stale MSR value.

This patch fixes the problem by moving the privilege test exclusively to
the TCG hypercall path.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
CC: qemu-stable@nongnu.org
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
(cherry picked from commit efcb9383b974114e5f682e531346006f8f2466c0)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: f4c53d94d2538fcd335df25754c51444896e2c2c
      https://github.com/qemu/qemu/commit/f4c53d94d2538fcd335df25754c51444896e2c2c
  Author: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M VERSION

  Log Message:
  -----------
  update VERSION for v1.2.1

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/814395979efb^...f4c53d94d253

----==_mimepart_50aadd3edbfef_781e108aaec32445--


</body></email><email><emailId>20121121070016</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-21 07:00:16-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] ecf51c: tcg/ppc: Fix !softmmu case</subject><body>



----==_mimepart_50ac7c0024011_55451945aec1306a9
Date: Tue, 20 Nov 2012 23:00:16 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50ac7c0025205_55451945aec130758@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: ecf51c9abe63eae282e5f912d9367ce75f36636a
      https://github.com/qemu/qemu/commit/ecf51c9abe63eae282e5f912d9367ce75f36636a
  Author: malc &lt;av1474@comtv.ru&gt;
  Date:   2012-11-20 (Tue, 20 Nov 2012)

  Changed paths:
    M tcg/ppc/tcg-target.c

  Log Message:
  -----------
  tcg/ppc: Fix !softmmu case

Signed-off-by: malc &lt;av1474@comtv.ru&gt;




----==_mimepart_50ac7c0024011_55451945aec1306a9--


</body></email><email><emailId>20121121083014</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-21 08:30:14-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 1ccbc2: qemu-sockets: Fix parsing of the inet option 'to'.</subject><body>



----==_mimepart_50ac911641ec6_5da1cabaec1065c2
Date: Wed, 21 Nov 2012 00:30:14 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50ac911643372_5da1cabaec10666@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 1ccbc2851282564308f790753d7158487b6af8e2
      https://github.com/qemu/qemu/commit/1ccbc2851282564308f790753d7158487b6af8e2
  Author: Anthony PERARD &lt;anthony.perard@citrix.com&gt;
  Date:   2012-11-21 (Wed, 21 Nov 2012)

  Changed paths:
    M qemu-sockets.c

  Log Message:
  -----------
  qemu-sockets: Fix parsing of the inet option 'to'.

Having a qemu command line argument like "-vnc 127.0.0.1:0,to=99" is broken.
This have been break with commit 879e45c72da1569e07fbbc6a1aa2a708ea796044.

Signed-off-by: Anthony PERARD &lt;anthony.perard@citrix.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;




----==_mimepart_50ac911641ec6_5da1cabaec1065c2--


</body></email><email><emailId>20121124123010</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-24 12:30:10-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] d17bd1: tcg/arm: fix TLB access in qemu-ld/st ops</subject><body>



----==_mimepart_50b0bdd279d01_63b91b85af01024da
Date: Sat, 24 Nov 2012 04:30:10 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50b0bdd27bf0b_63b91b85af010258c@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: d17bd1d8cc27f8c1a24c65f555a77a661c332b7f
      https://github.com/qemu/qemu/commit/d17bd1d8cc27f8c1a24c65f555a77a661c332b7f
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-11-24 (Sat, 24 Nov 2012)

  Changed paths:
    M tcg/arm/tcg-target.c

  Log Message:
  -----------
  tcg/arm: fix TLB access in qemu-ld/st ops

The TCG arm backend considers likely that the offset to the TLB
entries does not exceed 12 bits for mem_index = 0. In practice this is
not true for at least the MIPS target.

The current patch fixes that by loading the bits 23-12 with a separate
instruction, and using loads with address writeback, independently of
the value of mem_idx. In total this allow a 24-bit offset, which is a
lot more than needed.

Cc: Andrzej Zaborowski &lt;balrogg@gmail.com&gt;
Cc: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Cc: qemu-stable@nongnu.org
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 7aab08aa786e3a8838beac758ee61c5000144937
      https://github.com/qemu/qemu/commit/7aab08aa786e3a8838beac758ee61c5000144937
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-11-24 (Sat, 24 Nov 2012)

  Changed paths:
    M tcg/arm/tcg-target.c

  Log Message:
  -----------
  tcg/arm: fix cross-endian qemu_st16

The bswap16 TCG opcode assumes that the high bytes of the temp equal
to 0 before calling it. The ARM backend implementation takes this
assumption to slightly optimize the generated code.

The same implementation is called for implementing the cross-endian
qemu_st16 opcode, where this assumption is not true anymore. One way to
fix that would be to zero the high bytes before calling it. Given the
store instruction just ignore them, it is possible to provide a slightly
more optimized version. With ARMv6+ the rev16 instruction does the work
correctly. For lower ARM versions the patch provides a version which
behaves correctly with non-zero high bytes, but fill them with junk.

Cc: Andrzej Zaborowski &lt;balrogg@gmail.com&gt;
Cc: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Cc: qemu-stable@nongnu.org
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 44e04d3b945ba6f5cc87e65192081da4783f73fa
      https://github.com/qemu/qemu/commit/44e04d3b945ba6f5cc87e65192081da4783f73fa
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-11-24 (Sat, 24 Nov 2012)

  Changed paths:
    M target-openrisc/cpu.h

  Log Message:
  -----------
  target-openrisc: remove conflicting definitions from cpu.h

On an ARM host, the registers definitions from cpu.h clash
with /usr/include/sys/ucontext.h. As there are unused, just remove
them.

Cc: Jia Liu &lt;proljc@gmail.com&gt;
Cc: qemu-stable@nongnu.org
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: d132c79f6b68622e8a115327d1f60176e1816c7c
      https://github.com/qemu/qemu/commit/d132c79f6b68622e8a115327d1f60176e1816c7c
  Author: é³éä»» (Wei-Ren Chen) &lt;chenwj@iis.sinica.edu.tw&gt;
  Date:   2012-11-24 (Sat, 24 Nov 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Add comments on POOL32Axf encoding

  Current QEMU MIPS POOL32AXF encoding comes from microMIPS32
and microMIPS32 DSP. Add comment here to help reading.

Signed-off-by: Chen Wei-Ren &lt;chenwj@iis.sinica.edu.tw&gt;
Reviewed-by: Eric Johnson &lt;ericj@mips.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 211da99290c8d570eee78f3f534f7e7d9d8f9da8
      https://github.com/qemu/qemu/commit/211da99290c8d570eee78f3f534f7e7d9d8f9da8
  Author: é³éä»» (Wei-Ren Chen) &lt;chenwj@iis.sinica.edu.tw&gt;
  Date:   2012-11-24 (Sat, 24 Nov 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Clean up microMIPS32 major opcode

  I check MIPS microMIPS manual [1], and found the major opcode might
be wrong. I add a comment to explicitly indicate what manual I am refering
to, and according that manual I remove microMIPS32 major opcodes 0x1f.
As for others, like 0x16, 0x17, 0x36 and 0x37, they are for higher-order
MIPS ISA level or new revision of this microMIPS architecture. Quote
from Johnson, they are belong MIPS64 [2].

[1] http://www.mips.com/products/architectures/micromips/#specifications

    MIPS Architecture for Programmers Volume II-B:
      The microMIPS32 Instruction Set (Revision 3.05)

    MD00582-2B-microMIPS-AFP-03.05.pdf

[2] http://www.mips.com/products/architectures/mips64/

    MIPS Architecture For Programmers
      Volume II-A: The MIPS64 Instruction Set

    MD00087-2B-MIPS64BIS-AFP-03.51.pdf

Signed-off-by: Chen Wei-Ren &lt;chenwj@iis.sinica.edu.tw&gt;
Reviewed-by: Eric Johnson &lt;ericj@mips.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: e5138db510efb61523be92c225d8c65eb985fff0
      https://github.com/qemu/qemu/commit/e5138db510efb61523be92c225d8c65eb985fff0
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-11-24 (Sat, 24 Nov 2012)

  Changed paths:
    M tcg/tcg.c

  Log Message:
  -----------
  tcg: mark local temps as MEM in dead_temp()

In dead_temp, local temps should always be marked as back to memory,
even if they have not been allocated (i.e. they are discared before
cross a basic block).

It fixes the following assertion in target-xtensa:

    qemu-system-xtensa: tcg/tcg.c:1665: temp_save: Assertion `s-&gt;temps[temp].val_type \
== 2 || s-&gt;temps[temp].fixed_reg' failed.  Aborted

Reported-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Tested-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


Compare: https://github.com/qemu/qemu/compare/1ccbc2851282...e5138db510ef

----==_mimepart_50b0bdd279d01_63b91b85af01024da--


</body></email><email><emailId>20121124130010</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-24 13:00:10-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 31abf9: target-mips: remove POOL48A from the microMIPS dec...</subject><body>



----==_mimepart_50b0c4daf01d2_171ff5baf478419
Date: Sat, 24 Nov 2012 05:00:10 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50b0c4daf169a_171ff5baf478543@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 31abf92447353ee09ecad0b3b18e458eef3a1215
      https://github.com/qemu/qemu/commit/31abf92447353ee09ecad0b3b18e458eef3a1215
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-11-24 (Sat, 24 Nov 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: remove POOL48A from the microMIPS decoding

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;




----==_mimepart_50b0c4daf01d2_171ff5baf478419--


</body></email><email><emailId>20121124210009</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-24 21:00:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] c6c506: tci: Fix type of tci_read_label</subject><body>



----==_mimepart_50b13559e3352_687ff03ae8459ab
Date: Sat, 24 Nov 2012 13:00:09 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50b13559e4fbe_687ff03ae84607@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: c6c5063c7a5bb1d3fe6b9931a1ec15294e39b8b1
      https://github.com/qemu/qemu/commit/c6c5063c7a5bb1d3fe6b9931a1ec15294e39b8b1
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-11-24 (Sat, 24 Nov 2012)

  Changed paths:
    M tci.c

  Log Message:
  -----------
  tci: Fix type of tci_read_label

Fixes the pointer truncation that was occurring for branches.

Cc: Stefan Weil &lt;sw@weilnetz.de&gt;
Cc: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Reviewed-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Tested-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 89c9bc3d147fdaa932db99b0463b4af1d3e7cda1
      https://github.com/qemu/qemu/commit/89c9bc3d147fdaa932db99b0463b4af1d3e7cda1
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-11-24 (Sat, 24 Nov 2012)

  Changed paths:
    M block.c

  Log Message:
  -----------
  block: Fix regression for MinGW (assertion caused by short string)

The local string tmp_filename is passed to function get_tmp_filename
which expects a string with minimum size MAX_PATH for w32 hosts.

MAX_PATH is 260 and PATH_MAX is 259, so tmp_filename was too short.

Commit eba25057b9a5e19d10ace2bc7716667a31297169 introduced this
regression.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: a85903ff80f9bfa6390069856a8ec706b0b5ad5a
      https://github.com/qemu/qemu/commit/a85903ff80f9bfa6390069856a8ec706b0b5ad5a
  Author: Wenchao Xia &lt;xiawenc@linux.vnet.ibm.com&gt;
  Date:   2012-11-24 (Sat, 24 Nov 2012)

  Changed paths:
    M Makefile

  Log Message:
  -----------
  Build system fix distclean error for pixman

  Currently Makefile test if pixman have configure log, but the script directly
return error if that file do not exist. This patch fix it.

Signed-off-by: Wenchao Xia &lt;xiawenc@linux.vnet.ibm.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 06dec08374a4a4bd882994a3dfd103e314584c4c
      https://github.com/qemu/qemu/commit/06dec08374a4a4bd882994a3dfd103e314584c4c
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-11-24 (Sat, 24 Nov 2012)

  Changed paths:
    M qemu-char.c

  Log Message:
  -----------
  chardev: Use real-time clock for open timer

The vm clock may be stopped, and then we won't get open events anymore.
Seen with QMP sessions.

Reported-by: Dietmar Maurer &lt;dietmar@proxmox.com&gt;
Tested-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/31abf9244735...06dec08374a4

----==_mimepart_50b13559e3352_687ff03ae8459ab--


</body></email><email><emailId>20121126160014</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-26 16:00:14-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 58ddcd: tap: reset vnet header size on open</subject><body>



----==_mimepart_50b3920df3990_1dd3158caf41222c1
Date: Mon, 26 Nov 2012 08:00:14 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50b3920e47f8_1dd3158caf4122361@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 58ddcd50f30cb5c020bd4f9f36b01ee160a27cac
      https://github.com/qemu/qemu/commit/58ddcd50f30cb5c020bd4f9f36b01ee160a27cac
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-11-20 (Tue, 20 Nov 2012)

  Changed paths:
    M net/tap.c

  Log Message:
  -----------
  tap: reset vnet header size on open

For tap, we currently assume the vnet header size is 10
(the default value) but that might not be the case
if tap is persistent and has been used by qemu previously.
To fix, set host header size in tap device on open.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Tested-by: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 1bc6b705eed02dab9feb0e663219b5623f3d684d
      https://github.com/qemu/qemu/commit/1bc6b705eed02dab9feb0e663219b5623f3d684d
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-11-21 (Wed, 21 Nov 2012)

  Changed paths:
    M block/raw-posix.c

  Log Message:
  -----------
  block: add bdrv_reopen() support for raw hdev, floppy, and cdrom

For hdev, floppy, and cdrom, the reopen() handlers are the same as
for the file reopen handler.  For floppy and cdrom types, however,
we keep O_NONBLOCK, as in the _open function.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 8ba2aae32c40f544def6be7ae82be9bcb781e01d
      https://github.com/qemu/qemu/commit/8ba2aae32c40f544def6be7ae82be9bcb781e01d
  Author: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
  Date:   2012-11-21 (Wed, 21 Nov 2012)

  Changed paths:
    M block/vdi.c

  Log Message:
  -----------
  vdi: don't override libuuid symbols

It's poor symbol hygiene to provide a global symbols that collide with a
common library like libuuid.  If QEMU links against a shared library
that depends on uuid_generate() it can end up calling our stub version
of the function.

This exact scenario happened with GlusterFS libgfapi.so, which depends
on libglusterfs.so's uuid_generate().

Scope the uuid stubs for vdi.c only and avoid affecting other shared
objects.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Reviewed-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 08448d5195aeff49bf25fb62b4a6218f079f5284
      https://github.com/qemu/qemu/commit/08448d5195aeff49bf25fb62b4a6218f079f5284
  Author: Stefan Priebe &lt;s.priebe@profihost.ag&gt;
  Date:   2012-11-21 (Wed, 21 Nov 2012)

  Changed paths:
    M block/rbd.c

  Log Message:
  -----------
  use int64_t for return values from rbd instead of int

rbd / rados tends to return pretty often length of writes
or discarded blocks. These values might be bigger than int.

The steps to reproduce are:

  mkfs.xfs -f a whole device bigger than int in bytes. mkfs.xfs sends
  a discard. Important is that you use scsi-hd and set
  discard_granularity=512. Otherwise rbd disabled discard support.

Signed-off-by: Stefan Priebe &lt;s.priebe@profihost.ag&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 038268e2e8087ee2fd8987a77ba580e15f14c147
      https://github.com/qemu/qemu/commit/038268e2e8087ee2fd8987a77ba580e15f14c147
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-11-21 (Wed, 21 Nov 2012)

  Changed paths:
    M hw/ide/core.c

  Log Message:
  -----------
  ide: Fix crash with too long PRD

Without this, s-&gt;nsector can become negative and badness happens (trying
to malloc huge amount of memory and glib calls abort())

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 72bcca73c7a67c8506fa737618861ad413dabf38
      https://github.com/qemu/qemu/commit/72bcca73c7a67c8506fa737618861ad413dabf38
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-11-21 (Wed, 21 Nov 2012)

  Changed paths:
    M hw/ide/core.c

  Log Message:
  -----------
  ide: Fix status register after short PRDs

When failing a request because the length of the regions described by
the PRDT was too short for the requested number of sectors, the IDE
emulation forgot to update the status register, so that the device would
keep the BSY flag set indefinitely.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 9995c0b706a2270a49c5bebbcda0b62263a31aa3
      https://github.com/qemu/qemu/commit/9995c0b706a2270a49c5bebbcda0b62263a31aa3
  Author: Lei Li &lt;lilei@linux.vnet.ibm.com&gt;
  Date:   2012-11-21 (Wed, 21 Nov 2012)

  Changed paths:
    M ui/spice-core.c

  Log Message:
  -----------
  Fix the inconsistency in x509-dh-key-file parameter

Commit c448e8552b0f6135dabddf944a7110f929c08320 (spice: tls
support) added options to the -spice command line. But there
is an inconsistency between the declaration of the option
'x509-dh-key-file' to -spice command line and its parameter
parsing 'x509-dh-file' in function qemu_spice_init.

https://bugs.launchpad.net/qemu/+bug/1035042

Reported-by: Alon Bar-Lev &lt;alon.barlev@gmail.com&gt;
Signed-off-by: Lei Li &lt;lilei@linux.vnet.ibm.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 21a50d0b1a0745e485eff3e5aa393cdc4a1980b6
      https://github.com/qemu/qemu/commit/21a50d0b1a0745e485eff3e5aa393cdc4a1980b6
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-21 (Wed, 21 Nov 2012)

  Changed paths:
    M ui/spice-display.c

  Log Message:
  -----------
  spice: add new spice-server callbacks to ui/spice-display.c

Otherwise qemu crashes with non-qxl graphics cards.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 887938160e5d631c56ee115b1817613a60184138
      https://github.com/qemu/qemu/commit/887938160e5d631c56ee115b1817613a60184138
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-21 (Wed, 21 Nov 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Add a completions_only flag for async completions

Add a completions_only flag, and set this when running process_frame for async
completion handling, this fixes 2 issues in a single patch:

1) It makes sure async completed packets get written to guest mem immediately,
even if all the bandwidth for the frame was consumed from the timer run
process_frame. This is necessary as delaying their writeback to the next frame
can cause the completion to get lost on migration.

2) The calling of process_frame from a bh on async completion causes iso
tds to get server more often they should, messing up usb sound class device
timing. By only processing completed packets, the iso tds get skipped fixing
this.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 1cbdde909f70fd15ff85f068a6318b73865c7fa3
      https://github.com/qemu/qemu/commit/1cbdde909f70fd15ff85f068a6318b73865c7fa3
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-21 (Wed, 21 Nov 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Don't allow the guest to set port-enabled when there is no dev connected

It is possible for device disconnect and the guest trying to reset the port
(because of USB xact errors prior to the disconnect getting signaled) to race,
when we hit this race, the guest will write the port-control register with its
pre-disconnect value + the reset bit set, after which we have a disconnected
device with its port-enabled bit set in its port-control register, which
is no good :)

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 71d2c9cf656cb8b55a71057c1943ade197c1bb5b
      https://github.com/qemu/qemu/commit/71d2c9cf656cb8b55a71057c1943ade197c1bb5b
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-21 (Wed, 21 Nov 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Fix double unlink

uhci_async_cancel() already does a uhci_async_unlink().

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 33c1a6856f06fccd7cbfe53e06f9ebbe95bd565f
      https://github.com/qemu/qemu/commit/33c1a6856f06fccd7cbfe53e06f9ebbe95bd565f
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-21 (Wed, 21 Nov 2012)

  Changed paths:
    M hw/usb/dev-bluetooth.c

  Log Message:
  -----------
  usb-bt: Return NAK instead of STALL when interrupt ep has no data

I noticed this while making all devices with interrupt endpoints properly
do wakeup. While at it also add wakeup support.

Note that I've not tested this, but returning STALL for an interrupt ep
which has no data is cleary the wrong thing to do.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: c4020746ff49b2156b4f98672c077d1a3b86fa8b
      https://github.com/qemu/qemu/commit/c4020746ff49b2156b4f98672c077d1a3b86fa8b
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-21 (Wed, 21 Nov 2012)

  Changed paths:
    M hw/usb/dev-smartcard-reader.c

  Log Message:
  -----------
  usb-smartcard-reader: Properly NAK interrupt eps when we've no events

When we've no data to return from the interrupt endpoint, return NAK rather
then a 0 length packet.

CC: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 234e810cce018daf2030e04e399a17b744fa3e0d
      https://github.com/qemu/qemu/commit/234e810cce018daf2030e04e399a17b744fa3e0d
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-21 (Wed, 21 Nov 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Split usb_handle_interrupt_data into separate in/out functions

No functional changes.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 723aedd53281cfa0997457cb156a59909a75f5a8
      https://github.com/qemu/qemu/commit/723aedd53281cfa0997457cb156a59909a75f5a8
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-11-21 (Wed, 21 Nov 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Don't handle interrupt output packets async

Instead report them as successfully completed directly on submission, this
has 2 advantages:

1) This matches the timing of interrupt output packets on real hardware,
with the previous async handling, if an ep has an interval of say 500 ms,
then there would be 500+ ms between the submission and the guest seeing the
completion, as we wont do the write back until the qh gets polled again. And
in the mean time the guest may very well have timed out, as the guest can
reasonable expect a much quicker completion.

2) This fixes interrupt output packets potentially getting send twice
surrounding a migration. As we delay the writeback to guest memory until
the qh gets polled again, there is a window between completion and writeback
where migration can happen, in this case the destination will not know
about the completion, and it will execute the packet *again*

But it does also come with a disadvantage:

1) If the actual interrupt out to the real usb device fails, there is no
way to report this back to the guest.

This patch assumes however that interrupt outs in practice never fail, as
they are only used by specialized drivers, which are unlikely to issue illegal
requests (unlike general class drivers which often issue requests which some
devices don't implement). And that thus the advantages outway the disadvantage.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: c6e88b3b27b411e3f1c924deb8b71b20f8a11107
      https://github.com/qemu/qemu/commit/c6e88b3b27b411e3f1c924deb8b71b20f8a11107
  Author: Bruce Rogers &lt;brogers@suse.com&gt;
  Date:   2012-11-23 (Fri, 23 Nov 2012)

  Changed paths:
    M qemu-options.hx

  Log Message:
  -----------
  Legacy qemu-kvm options have no argument

The options no-kvm, no-kvm-pit, no-kvm-pit-reinjection, and no-kvm-irqchip
should be marked as having no argument.

Signed-off-by: Bruce Rogers &lt;brogers@suse.com&gt;
Reviewed-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 7eff57421ff31657434545104b9f91a28e7869ff
      https://github.com/qemu/qemu/commit/7eff57421ff31657434545104b9f91a28e7869ff
  Author: Catalin Patulea &lt;catalinp@google.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M ui/vnc.c

  Log Message:
  -----------
  vnc: fix option misspelling ("non-adapative" -&gt; "non-adaptive")

Signed-off-by: Catalin Patulea &lt;catalinp@google.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: f8c4382e2cfe9b28b7d652b94712d258c751627b
      https://github.com/qemu/qemu/commit/f8c4382e2cfe9b28b7d652b94712d258c751627b
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M net/tap.c

  Log Message:
  -----------
  Merge remote-tracking branch 'stefanha/net' into staging

* stefanha/net:
  tap: reset vnet header size on open

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 0a87470116a169f0c764894e46014a77f5d32a9e
      https://github.com/qemu/qemu/commit/0a87470116a169f0c764894e46014a77f5d32a9e
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M block/raw-posix.c
    M block/rbd.c
    M block/vdi.c
    M hw/ide/core.c

  Log Message:
  -----------
  Merge remote-tracking branch 'stefanha/block' into staging

* stefanha/block:
  ide: Fix status register after short PRDs
  ide: Fix crash with too long PRD
  use int64_t for return values from rbd instead of int
  vdi: don't override libuuid symbols
  block: add bdrv_reopen() support for raw hdev, floppy, and cdrom

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: fb43a4807ec06307048018d93a7f9e0828308bb5
      https://github.com/qemu/qemu/commit/fb43a4807ec06307048018d93a7f9e0828308bb5
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M ui/spice-core.c
    M ui/spice-display.c

  Log Message:
  -----------
  Merge remote-tracking branch 'spice/spice.v64' into staging

* spice/spice.v64:
  spice: add new spice-server callbacks to ui/spice-display.c
  Fix the inconsistency in x509-dh-key-file parameter

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 95a6e48d776b208d085854358313346ebdb2924d
      https://github.com/qemu/qemu/commit/95a6e48d776b208d085854358313346ebdb2924d
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/usb/dev-bluetooth.c
    M hw/usb/dev-smartcard-reader.c
    M hw/usb/hcd-uhci.c
    M hw/usb/redirect.c

  Log Message:
  -----------
  Merge remote-tracking branch 'kraxel/usb.72' into staging

* kraxel/usb.72:
  usb-redir: Don't handle interrupt output packets async
  usb-redir: Split usb_handle_interrupt_data into separate in/out functions
  usb-smartcard-reader: Properly NAK interrupt eps when we've no events
  usb-bt: Return NAK instead of STALL when interrupt ep has no data
  uhci: Fix double unlink
  uhci: Don't allow the guest to set port-enabled when there is no dev connected
  uhci: Add a completions_only flag for async completions

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: cab1e8f3e37d8e883c270e3afd9c7c1c18332f0e
      https://github.com/qemu/qemu/commit/cab1e8f3e37d8e883c270e3afd9c7c1c18332f0e
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M qemu-options.hx

  Log Message:
  -----------
  Merge remote-tracking branch 'qemu-kvm/uq/master' into staging

* qemu-kvm/uq/master:
  Legacy qemu-kvm options have no argument

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/06dec08374a4...cab1e8f3e37d

----==_mimepart_50b3920df3990_1dd3158caf41222c1--


</body></email><email><emailId>20121126213014</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-26 21:30:14-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 9011a1: pc, pc_piix: split out pc nic initialization</subject><body>



----==_mimepart_50b3df662500e_21b6fd9ae4963e6
Date: Mon, 26 Nov 2012 13:30:14 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50b3df6628f90_21b6fd9ae49647@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 9011a1a7bbf00deeada3447143bbde7e0a685297
      https://github.com/qemu/qemu/commit/9011a1a7bbf00deeada3447143bbde7e0a685297
  Author: Isaku Yamahata &lt;yamahata@valinux.co.jp&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/pc.c
    M hw/pc.h
    M hw/pc_piix.c

  Log Message:
  -----------
  pc, pc_piix: split out pc nic initialization

Factor out pc nic initialization.
This simplifies the pc initialization and will reduce the code
duplication of q35 pc initialization.

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Isaku Yamahata &lt;yamahata@valinux.co.jp&gt;
Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: a39e356458335418973ca7d388c02712145cd177
      https://github.com/qemu/qemu/commit/a39e356458335418973ca7d388c02712145cd177
  Author: Jason Baron &lt;jbaron@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/pc.c
    M hw/pc.h
    M hw/pc_piix.c

  Log Message:
  -----------
  pc: Move ioapic_init() from pc_piix.c to pc.c

Move ioapic_init() from pc_piix.c to pc.c, to make it a common function.
Rename ioapic_init() -&gt; ioapic_init_gsi().
Move to pc.h so q35 can use them as well.

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: d8ee03843fcacfb70c0260af74f20ba9808d4f2e
      https://github.com/qemu/qemu/commit/d8ee03843fcacfb70c0260af74f20ba9808d4f2e
  Author: Jason Baron &lt;jbaron@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/kvm/ioapic.c
    M hw/pc_piix.c
    M kvm.h

  Log Message:
  -----------
  pc_piix: Move kvm irq routing functions out of pc_piix.c

Rename: kvm_piix3_gsi_handlei() -&gt; kvm_pc_gsi_handler()
  kvm_piix3_setup_irq_routing() -&gt; kvm_pc_setup_irq_routing()

This is in preparation for other users, namely q35 at this time.

Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 410edd922d2a90c79cd92b086c0e53650ea52c02
      https://github.com/qemu/qemu/commit/410edd922d2a90c79cd92b086c0e53650ea52c02
  Author: Isaku Yamahata &lt;yamahata@valinux.co.jp&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/Makefile.objs
    A hw/pam.c
    A hw/pam.h
    M hw/piix_pci.c

  Log Message:
  -----------
  pc/piix_pci: factor out smram/pam logic

Factor out smram/pam logic for use by other chipsets, namely q35
at this point.

Note: Should be factored out into a generic North Bridge Class.

[jbaron@redhat.com: changes for updated memory API]
Signed-off-by: Isaku Yamahata &lt;yamahata@valinux.co.jp&gt;
Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: e516572fdefdf1168e890d1fd79d56cd44aa2102
      https://github.com/qemu/qemu/commit/e516572fdefdf1168e890d1fd79d56cd44aa2102
  Author: Jason Baron &lt;jbaron@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/Makefile.objs
    A hw/acpi_ich9.c
    A hw/acpi_ich9.h
    A hw/ich9.h
    M hw/pci_ids.h

  Log Message:
  -----------
  ich9: Add acpi support and definitions

Lay the groundwork for subsequent ich9 support.

Signed-off-by: Isaku Yamahata &lt;yamahata@valinux.co.jp&gt;
Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 4d00636e97b7f55810ff7faccff594159175e24e
      https://github.com/qemu/qemu/commit/4d00636e97b7f55810ff7faccff594159175e24e
  Author: Jason Baron &lt;jbaron@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/i386/Makefile.objs
    A hw/lpc_ich9.c

  Log Message:
  -----------
  ich9: Add the lpc chip

Add support for the ICH9 LPC chip.

Signed-off-by: Isaku Yamahata &lt;yamahata@valinux.co.jp&gt;
Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 678e7b94b182f846de61e38e8a6499f9c55dbcf0
      https://github.com/qemu/qemu/commit/678e7b94b182f846de61e38e8a6499f9c55dbcf0
  Author: Jason Baron &lt;jbaron@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/Makefile.objs
    A hw/smbus_ich9.c

  Log Message:
  -----------
  ich9: Add smbus

Add support for the ich9 smbus chip.

Signed-off-by: Isaku Yamahata &lt;yamahata@valinux.co.jp&gt;
Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: df2d8b3ed4d2b6406335d274f9537d78ac4e3c0c
      https://github.com/qemu/qemu/commit/df2d8b3ed4d2b6406335d274f9537d78ac4e3c0c
  Author: Isaku Yamahata &lt;yamahata@valinux.co.jp&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/i386/Makefile.objs
    A hw/pc_q35.c
    M hw/pci_ids.h
    A hw/q35.c
    A hw/q35.h

  Log Message:
  -----------
  q35: Introduce q35 pc based chipset emulator

pc q35 based chipset emulator to support pci express natively. Based on
Anthony Liguori's suggestion, the machine name is 'q35-next', with an alias
of 'q35'. At this point, there are no compatibility guarantees. When the
chipset stabilizes more, we will begin to version the machine names.

Major features which still need to be added:

-Migration support (mostly around ahci)
-ACPI hotplug support (pcie hotplug support is working)
-Passthrough support

Signed-off-by: Isaku Yamahata &lt;yamahata@valinux.co.jp&gt;
Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: a1c9304683161a68c1fc1d9c3bc174ec8e26a61a
      https://github.com/qemu/qemu/commit/a1c9304683161a68c1fc1d9c3bc174ec8e26a61a
  Author: Jason Baron &lt;jbaron@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/Makefile.objs
    A hw/i82801b11.c

  Log Message:
  -----------
  ich9: Add i82801b11 dmi-to-pci bridge

Add the dmi-to-pci i82801b11 bridge chip. This is the pci bridge chip
that q35 uses on its host bus for PCI bus arbitration.

Signed-off-by: Isaku Yamahata &lt;yamahata@valinux.co.jp&gt;
Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 21bcfdd9a43041720f9370831c694bcb2e11eea4
      https://github.com/qemu/qemu/commit/21bcfdd9a43041720f9370831c694bcb2e11eea4
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/acpi_ich9.c

  Log Message:
  -----------
  q35: Suppress SMM BIOS initialization under KVM

Same as for i44fx: KVM does not support SMM yet. Signal it initialized
to Seabios to avoid failures.

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 243b95111c8b8d171e627247a7de16e94c7e9de0
      https://github.com/qemu/qemu/commit/243b95111c8b8d171e627247a7de16e94c7e9de0
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/lpc_ich9.c

  Log Message:
  -----------
  q35: Fix non-PCI IRQ processing in ich9_lpc_update_apic

Avoid passing a non-PCI IRQ to ich9_gsi_to_pirq. It's wrong and triggers
an assertion.

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 21022c92dc5095324ceb3effc068b5ff81642125
      https://github.com/qemu/qemu/commit/21022c92dc5095324ceb3effc068b5ff81642125
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/pc_q35.c

  Log Message:
  -----------
  q35: Add kvmclock support

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: b022b4a44abda9b6f89777b07e538be6f8f7aacb
      https://github.com/qemu/qemu/commit/b022b4a44abda9b6f89777b07e538be6f8f7aacb
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M aio-win32.c

  Log Message:
  -----------
  aio: avoid livelock behavior for Win32

The repeated calls to WaitForMultipleObjects may cause a livelock in aio_poll,
where no progress is made on bottom halves.  This patch matches the behavior
of the POSIX code.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: b2ea25d7aea3106f3cad597be20cf5ab4d87f7ab
      https://github.com/qemu/qemu/commit/b2ea25d7aea3106f3cad597be20cf5ab4d87f7ab
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M tests/Makefile
    A tests/test-aio.c

  Log Message:
  -----------
  tests: add AioContext unit tests

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 74c856e9228445bac1624f6aad83422bdbc59f98
      https://github.com/qemu/qemu/commit/74c856e9228445bac1624f6aad83422bdbc59f98
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M tests/Makefile
    A tests/test-thread-pool.c

  Log Message:
  -----------
  tests: add thread pool unit tests

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: b7f43fe46029d8fd0594cd599fa2599dcce0f553
      https://github.com/qemu/qemu/commit/b7f43fe46029d8fd0594cd599fa2599dcce0f553
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M qom/object.c

  Log Message:
  -----------
  qom: dynamic_cast of NULL is always NULL

Trying to cast a NULL value will cause a crash.  Returning
NULL is also sensible, and it is also what the type-unsafe
DO_UPCAST macro does.

Reported-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: b5007bcc9729acd995518c52eb1038c4d8416b5d
      https://github.com/qemu/qemu/commit/b5007bcc9729acd995518c52eb1038c4d8416b5d
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/pci-hotplug.c

  Log Message:
  -----------
  hmp: do not crash on invalid SCSI hotplug

Commit 0d93692 (qdev: Convert busses to QEMU Object Model, 2012-05-02)
removed a check on the type of the bus where a SCSI disk is hotplugged.
However, hot-plugging to the wrong kind of device now causes a crash
due to either a NULL pointer dereference (avoided by the previous patch)
or a failed QOM cast.

Instead, in this case we need to use object_dynamic_cast and check for
the result, similar to what was done before that commit.

Reported-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 764b63125a77dab54ed405d493452a4e05679c2e
      https://github.com/qemu/qemu/commit/764b63125a77dab54ed405d493452a4e05679c2e
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M qom/object.c

  Log Message:
  -----------
  qom: fix refcount of non-heap-allocated objects

The reference count for embedded objects is always one too low, because
object_initialize_with_type returns with zero references to the object.
This causes premature finalization of the object (or an assertion failure)
after calling object_ref to add an extra reference and object_unref to
remove it.

The fix is to move the initial object_ref call from object_new_with_type
to object_initialize_with_type.

Acked-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 667d22d1ae59da46b4c1fbd094ca61145f19b8c3
      https://github.com/qemu/qemu/commit/667d22d1ae59da46b4c1fbd094ca61145f19b8c3
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/qdev.c
    M include/qemu/object.h
    M qom/object.c

  Log Message:
  -----------
  qdev: move bus removal to object_unparent

Add an ObjectClass method that is done at object_unparent time.  It
should remove any backlinks to the object in the composition tree,
so that object_delete will be able to drop the last reference and
free the object.

Use it for qdev buses.

Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: fde9bf4470d4a3b6ee1da0dee2370ab028b6314a
      https://github.com/qemu/qemu/commit/fde9bf4470d4a3b6ee1da0dee2370ab028b6314a
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M include/qemu/object.h
    M qom/object.c

  Log Message:
  -----------
  qom: make object_delete usable for statically-allocated objects

Store in the object the freeing function that will be used at deletion
time.  This makes it possible to use object_delete on statically-allocated
(embedded) objects.  Dually, it makes it possible to use object_unparent
and object_unref without leaking memory, when the lifetime of object
might extend until after the call to object_delete.

Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 64b625f4b2fdb2c873e25c149648b2ce923faab7
      https://github.com/qemu/qemu/commit/64b625f4b2fdb2c873e25c149648b2ce923faab7
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/pci.c
    M hw/qdev-core.h
    M hw/qdev.c
    M hw/sysbus.c

  Log Message:
  -----------
  qdev: simplify (de)allocation of buses

All conditional deallocation can now be done with object_delete.
Remove the @qom_allocated and @glib_allocated fields; replace the latter
with a direct assignment of the @free function pointer.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 339c2708e7a0d91e926c473314d563354a949c7f
      https://github.com/qemu/qemu/commit/339c2708e7a0d91e926c473314d563354a949c7f
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M include/qemu/object.h
    M qom/object.c

  Log Message:
  -----------
  qom: make object_finalize static

It is not used anymore, and there is no need to make it public.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: fa5358c69d090d13f762f545d39c5e03124dfdd8
      https://github.com/qemu/qemu/commit/fa5358c69d090d13f762f545d39c5e03124dfdd8
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M vl.c

  Log Message:
  -----------
  vl.c: Fix broken -usb option

Commit 094b287f0b accidentally broke the "-usb" command line
option, so it would have no effect if the user had not specified
any machine options at that point. (the return value from
'qemu_opts_find(qemu_find_opts("machine"), 0);' is NULL if there
are no user specified options, so it is only to be used for
looking up an option, not when trying to set one.) Similarly,
would '-usbdevice' no longer cause USB to default to enabled.

Fix this regression by using the same style of code for forcing
the usb=on machine option that we use for other aliases such as
'-enable-kvm'.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: e1e54f3fbee6c0652e19182f4c747de172cbe8b1
      https://github.com/qemu/qemu/commit/e1e54f3fbee6c0652e19182f4c747de172cbe8b1
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: cpu: add missing flags to Haswell CPU model

When adding the Haswell CPU model, I intended to make it a superset of the
features present on the SandyBridge model, but I have removed the SEP and
RDTSCP features from the feature list by mistake. This patch adds the missing
SEP and RDTSCP features (that are present on SandyBridge) to Haswell.

Reported-by: Martin Kletzander &lt;mkletzan@redhat.com&gt;
Acked-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 0c26f2eca40d6c65ea9edc62a10e510dc7f65cc8
      https://github.com/qemu/qemu/commit/0c26f2eca40d6c65ea9edc62a10e510dc7f65cc8
  Author: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M qapi/qapi-dealloc-visitor.c

  Log Message:
  -----------
  qapi: handle visitor-&gt;type_size() in QapiDeallocVisitor

visit_type_size() requires either visitor-&gt;type_size() or
visitor_uint64() to be implemented, otherwise a NULL function pointer is
invoked.

It is possible to trigger this crash as follows:

  $ qemu-system-x86_64 -netdev tap,sndbuf=0,id=netdev0 \
                 -device virtio-blk-pci,netdev=netdev0

The 'sndbuf' option has type "size".

Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Reviewed-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 25d87288b150032fedcf7b5380fb54fdbdd6788d
      https://github.com/qemu/qemu/commit/25d87288b150032fedcf7b5380fb54fdbdd6788d
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/i8259_internal.h

  Log Message:
  -----------
  i8259: Fix PIC_COMMON() macro

It used a wrong struct type name since its introduction in
8f04ee0882aec9fe91fb70f767edf5dacff59835 (isa: pic: convert to QEMU
Object Model), apparently it is unused so far.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 14417039653d3293a795646730a7bf5055d78709
      https://github.com/qemu/qemu/commit/14417039653d3293a795646730a7bf5055d78709
  Author: Amit Shah &lt;amit.shah@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/virtio-rng.c

  Log Message:
  -----------
  virtio-rng: use virtqueue_get_avail_bytes, fix migration

Popping an elem from the vq just to find out its length causes problems
with save/load later on.  Use the new virtqueue_get_avail_bytes()
function instead, saves us the complexity in the migration code, as well
as makes the migration endian-safe.

Signed-off-by: Amit Shah &lt;amit.shah@redhat.com&gt;
Reviewed-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 4621c1768ef5d12171cca2aa1473595ecb9f1c9e
      https://github.com/qemu/qemu/commit/4621c1768ef5d12171cca2aa1473595ecb9f1c9e
  Author: Amit Shah &lt;amit.shah@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/virtio-rng.c

  Log Message:
  -----------
  virtio-rng: remove extra request for entropy

If we got fewer bytes from the backend than requested, don't poke the
backend for more bytes; the guest will ask for more (or if the guest has
already asked for more, the backend knows about it via handle_input()).

Signed-off-by: Amit Shah &lt;amit.shah@redhat.com&gt;
Reviewed-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 8cc677435498561d8fe213bb44a02cf4f75cc685
      https://github.com/qemu/qemu/commit/8cc677435498561d8fe213bb44a02cf4f75cc685
  Author: Amit Shah &lt;amit.shah@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/virtio-rng.c

  Log Message:
  -----------
  virtio-rng: disable timer on device removal

Disable the rate-limit timer on device remove (e.g. hot-unplug).

Signed-off-by: Amit Shah &lt;amit.shah@redhat.com&gt;
Reviewed-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 42015c9acb9fb418c97c42f6e0d44c84999c769d
      https://github.com/qemu/qemu/commit/42015c9acb9fb418c97c42f6e0d44c84999c769d
  Author: Amit Shah &lt;amit.shah@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/virtio-rng.c
    M include/qemu/rng.h

  Log Message:
  -----------
  virtio-rng: fix typos, comments

Fix typos, whitespace and update comments to match current
implementation.

Signed-off-by: Amit Shah &lt;amit.shah@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/cab1e8f3e37d...42015c9acb9f

----==_mimepart_50b3df662500e_21b6fd9ae4963e6--


</body></email><email><emailId>20121127003008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-27 00:30:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu]</subject><body>



----==_mimepart_50b40990c5669_cc31878aec40381
Date: Mon, 26 Nov 2012 16:30:08 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50b40990c68aa_cc31878aec40484@sh2.rs.github.com.mail&gt;

  Branch: refs/tags/v1.3.0-rc1
  Home:   https://github.com/qemu/qemu


----==_mimepart_50b40990c5669_cc31878aec40381--


</body></email><email><emailId>201211270030080</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-27 00:30:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 1e1d71: Update version for 1.3.0-rc1</subject><body>



----==_mimepart_50b409903281e_70a012a5ae8109393
Date: Mon, 26 Nov 2012 16:30:08 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50b4099033bb4_70a012a5ae81094be@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 1e1d71a582c60b7c435b05934423c87f83eab542
      https://github.com/qemu/qemu/commit/1e1d71a582c60b7c435b05934423c87f83eab542
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M VERSION

  Log Message:
  -----------
  Update version for 1.3.0-rc1

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;




----==_mimepart_50b409903281e_70a012a5ae8109393--


</body></email><email><emailId>20121127173011</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-27 17:30:11-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] d60478: tests: make threadpool cancellation test looser</subject><body>



----==_mimepart_50b4f8a34524b_18b51315af0345f4
Date: Tue, 27 Nov 2012 09:30:11 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50b4f8a346873_18b51315af034633@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: d60478c59a348886d82492861c5cd4fba572ebd5
      https://github.com/qemu/qemu/commit/d60478c59a348886d82492861c5cd4fba572ebd5
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-27 (Tue, 27 Nov 2012)

  Changed paths:
    M tests/test-thread-pool.c

  Log Message:
  -----------
  tests: make threadpool cancellation test looser

The cancellation test is failing on the buildbots.  While the failure
merits a little more investigation to understand what is going on,
the logs show that the failure is not impacting the coverage
provided by the test.  Hence, loosen a bit the assertions in a
way that should let the test proceed and hopefully pass.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 03a36f17d7788e4a1e07b3341b18028aa0206845
      https://github.com/qemu/qemu/commit/03a36f17d7788e4a1e07b3341b18028aa0206845
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-27 (Tue, 27 Nov 2012)

  Changed paths:
    M hw/virtio-rng.c

  Log Message:
  -----------
  virtio-rng: do not use g_assert_cmpint

g_assert_cmpint is not available on glib 2.12, which is the minimum
version required to build QEMU (we only require 2.16 to run tests,
since that is the first version including GTester).  Do not use it
in hardware models, use a normal assertion instead.

This fixes the buildbot failure for default_x86_64_rhel5.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/1e1d71a582c6...03a36f17d778

----==_mimepart_50b4f8a34524b_18b51315af0345f4--


</body></email><email><emailId>20121128220017</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-28 22:00:17-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 80ae41: target-i386/cpu: Add missing flags to Haswell CPU ...</subject><body>



----==_mimepart_50b68971498a4_7fcc16afae41244fa
Date: Wed, 28 Nov 2012 14:00:17 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50b689714adea_7fcc16afae4124540@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 80ae416058d8941824f450343781183618555415
      https://github.com/qemu/qemu/commit/80ae416058d8941824f450343781183618555415
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386/cpu: Add missing flags to Haswell CPU model

When adding the Haswell CPU model, I intended to make it a superset of the
features present on the SandyBridge model, but I have removed the SEP and
RDTSCP features from the feature list by mistake. This patch adds the
missing SEP and RDTSCP features (that are present on SandyBridge) to
Haswell.

Reported-by: Martin Kletzander &lt;mkletzan@redhat.com&gt;
Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: a0a7068104cc9908d0875404b0fa2ebf46e40f97
      https://github.com/qemu/qemu/commit/a0a7068104cc9908d0875404b0fa2ebf46e40f97
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: Enable SSSE3 TCG support

SSSE3 support has been added to TCG more than 4 years ago in commit
4242b1bd8acc19aaaacffdaad4ac23213d72a72b. It has been disabled by
mistake in commit 551a2dec8fa55006a68393b9d6fb63577d2b3f1c.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: d688e5239aad2a1f991147974832ce026f78c1a3
      https://github.com/qemu/qemu/commit/d688e5239aad2a1f991147974832ce026f78c1a3
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/ide/macio.c

  Log Message:
  -----------
  hw/ide/macio: Fix segfault caused by NULL DMAContext*

Pass qemu_sglist_init the global dma_context_memory rather than a NULL
pointer; this fixes a segfault in dma_memory_map() when the guest
starts using DMA.

Reported-by: Amadeusz SÅawiÅski &lt;amade@asmblr.net&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: f0cc4aa8450376ca2aee3ebb09db71f9f2ff333b
      https://github.com/qemu/qemu/commit/f0cc4aa8450376ca2aee3ebb09db71f9f2ff333b
  Author: Julio Guerra &lt;guerr@julio.in&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M target-ppc/translate.c

  Log Message:
  -----------
  PPC: Fix missing TRACE exception

This patch fixes bug 1031698 :
https://bugs.launchpad.net/qemu/+bug/1031698

If we look at the (truncated) translation of the conditional branch
instruction in the test submitted in the bug post, the call to the
exception helper is missing in the "bne-false" chunk of translated
code :

IN:
bne-    0x1800278

OUT:
0xb544236d:  jne    0xb5442396

0xb5442373:  mov    %ebp,(%esp)
0xb5442376:  mov    $0x44,%ebx
0xb544237b:  mov    %ebx,0x4(%esp)
0xb544237f:  mov    $0x1800278,%ebx
0xb5442384:  mov    %ebx,0x25c(%ebp)
0xb544238a:  call   0x827475a
               ^^^^^^^^^^^^^^^^^^

0xb5442396:  mov    %ebp,(%esp)
0xb5442399:  mov    $0x44,%ebx
0xb544239e:  mov    %ebx,0x4(%esp)
0xb54423a2:  mov    $0x1800270,%ebx
0xb54423a7:  mov    %ebx,0x25c(%ebp)

Indeed, gen_exception(ctx, excp) called by gen_goto_tb (called by
gen_bcond) changes ctx-&gt;exception's value to excp's :

gen_bcond()
{
  gen_goto_tb(ctx, 0, ctx-&gt;nip + li - 4);
  /* ctx-&gt;exception value is POWERPC_EXCP_BRANCH */

  gen_goto_tb(ctx, 1, ctx-&gt;nip);
  /* ctx-&gt;exception now value is POWERPC_EXCP_TRACE */
}

Making the following gen_goto_tb()'s test false during the second call :

if ((ctx-&gt;singlestep_enabled &amp;
    (CPU_BRANCH_STEP | CPU_SINGLE_STEP)) &amp;&amp;
    ctx-&gt;exception == POWERPC_EXCP_BRANCH /* false...*/) {
   target_ulong tmp = ctx-&gt;nip;
   ctx-&gt;nip = dest;
   /* ... and this is the missing call */
   gen_exception(ctx, POWERPC_EXCP_TRACE);
   ctx-&gt;nip = tmp;
}

So the patch simply adds the missing matching case, fixing our problem.

Signed-off-by: Julio Guerra &lt;guerr@julio.in&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 752ced0488806830f18f96b60ae6f3d1fadfd089
      https://github.com/qemu/qemu/commit/752ced0488806830f18f96b60ae6f3d1fadfd089
  Author: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M kvm-all.c

  Log Message:
  -----------
  kvm: fix incorrect length in a loop over kvm dirty pages map

QEMU allocates a map enough for 4k pages. However the system page size
can be 64K (for example on POWER) and the host kernel uses only a small
part of it as one big stores a dirty flag for 16 pages 4K each,
the hpratio variable stores this ratio and
the kvm_get_dirty_pages_log_range function handles it correctly.

However kvm_get_dirty_pages_log_range still goes beyond the data
provided by the host kernel which is not correct. It does not cause
errors at the moment as the whole bitmap is zeroed before doing KVM ioctl.

The patch reduces number of iterations over the map.

Signed-off-by: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 70c68cf638b4cf44a42a937622deac3ad3c7833c
      https://github.com/qemu/qemu/commit/70c68cf638b4cf44a42a937622deac3ad3c7833c
  Author: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/spapr_pci.c

  Log Message:
  -----------
  pseries: Fix bug in PCI MSI allocation

In one of the recent reworks to the XICS code, a bug was introduced where
we use the wrong sense and allocate level interrupts instead of message
interrupts for PCI MSIs.  This patch fixes it.

Signed-off-by: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: c4d88267ae76810420295a1682cf779c49f3ddec
      https://github.com/qemu/qemu/commit/c4d88267ae76810420295a1682cf779c49f3ddec
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M vl.c

  Log Message:
  -----------
  vl.c: Fix broken -usb option

Commit 094b287f0b accidentally broke the "-usb" command line
option, so it would have no effect if the user had not specified
any machine options at that point. (the return value from
'qemu_opts_find(qemu_find_opts("machine"), 0);' is NULL if there
are no user specified options, so it is only to be used for
looking up an option, not when trying to set one.) Similarly,
would '-usbdevice' no longer cause USB to default to enabled.

Fix this regression by using the same style of code for forcing
the usb=on machine option that we use for other aliases such as
'-enable-kvm'.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 6e72719e721a40fe1224701ca10edc1caf0cd708
      https://github.com/qemu/qemu/commit/6e72719e721a40fe1224701ca10edc1caf0cd708
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M qemu-pixman.c

  Log Message:
  -----------
  fbdev: fix pixman compile on old pixman

My QEMU compile failed with the following error:

qemu-pixman.c: In function âqemu_pixman_get_type':
qemu-pixman.c:24: error: âPIXMAN_TYPE_BGRA' undeclared (first use in this function)
qemu-pixman.c:24: error: (Each undeclared identifier is reported only once
qemu-pixman.c:24: error: for each function it appears in.)

Guard the PIXMAN_TYPE_BGRA branch like in the case right above the failing
case, so that compilation is fixed. Functionality on such old pixman is a
different question ;-).

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 8c7c3c58e3e33c80d1eef1514db3c705a4de692e
      https://github.com/qemu/qemu/commit/8c7c3c58e3e33c80d1eef1514db3c705a4de692e
  Author: Heinz Graalfs &lt;graalfs@linux.vnet.ibm.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/s390-virtio.c

  Log Message:
  -----------
  s390: Fix ram_size updating in machine init

The global variable 'ram_size' is hidden by the local variable
declaration in s390_init(). Since we want to update the global
ram size in certain cases we must not use a local ram_size
variable.
- This fixes booting with unusual ram sizes like -m 67001
- This changes behaviour back to the situation before commit
  5f072e1f3075bd869e0ace9f2545a85992ac0084
  (create struct for machine initialization arguments)

Signed-off-by: Heinz Graalfs &lt;graalfs@linux.vnet.ibm.com&gt;
Reviewed-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 773de5c786a6050bbf3b33c0e29d1bd519a40b4b
      https://github.com/qemu/qemu/commit/773de5c786a6050bbf3b33c0e29d1bd519a40b4b
  Author: Cornelia Huck &lt;cornelia.huck@de.ibm.com&gt;
  Date:   2012-11-26 (Mon, 26 Nov 2012)

  Changed paths:
    M hw/s390x/event-facility.c

  Log Message:
  -----------
  sclp: Fix uninitialized var in handle_write_event_buf().

Some gcc versions rightly complain about a possibly unitialized rc,
so let's move setting it before the QTAILQ_FOREACH().

Signed-off-by: Cornelia Huck &lt;cornelia.huck@de.ibm.com&gt;
Signed-off-by: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
Signed-off-by: Jens Freimann &lt;jfrei@linux.vnet.ibm.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 02c6ccc6dde90dcbf5975b1cfe2ab199e525ec11
      https://github.com/qemu/qemu/commit/02c6ccc6dde90dcbf5975b1cfe2ab199e525ec11
  Author: Alex Horn &lt;alex.horn@cs.ox.ac.uk&gt;
  Date:   2012-11-27 (Tue, 27 Nov 2012)

  Changed paths:
    M hw/mc146818rtc.c
    M tests/rtc-test.c

  Log Message:
  -----------
  rtc: Only call rtc_set_cmos when Register B SET flag is disabled.

This bug occurs when the SET flag of Register B is enabled. When an RTC
data register (i.e. any of the ten time/calender CMOS bytes) is set, the
data is (as expected) correctly stored in the cmos_data array. However,
since the SET flag is enabled, the function rtc_set_time is not invoked.
As a result, the field base_rtc in RTCState remains uninitialized. This
causes a problem on subsequent writes which can end up overwriting data.
To see this, consider writing data to Register A after having written
data to any of the RTC data registers; the following figure illustrates
the call stack for the Register A write operation:

 +- cmos_io_port_write
 +-- check_update_timer
 +---- get_next_alarm
 +------ rtc_update_time

In rtc_update_time, get_guest_rtc calculates the wrong time and
overwrites the previously written RTC data register values.

Signed-off-by: Alex Horn &lt;alex.horn@cs.ox.ac.uk&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 8ffaaba0e939f2a284bb23d1f6f7f9e2104a97e2
      https://github.com/qemu/qemu/commit/8ffaaba0e939f2a284bb23d1f6f7f9e2104a97e2
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-28 (Wed, 28 Nov 2012)

  Changed paths:
    M nbd.c

  Log Message:
  -----------
  nbd: fix use of two uninitialized bytes when connecting to a named export

Reported-by: Michal Privoznik &lt;mprivoznik@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: f3313d23a061648c99609a4c127ed13c820f831d
      https://github.com/qemu/qemu/commit/f3313d23a061648c99609a4c127ed13c820f831d
  Author: Michal Privoznik &lt;mprivozn@redhat.com&gt;
  Date:   2012-11-28 (Wed, 28 Nov 2012)

  Changed paths:
    M blockdev-nbd.c

  Log Message:
  -----------
  nbd-server-add: Fix the default for 'writable'

The documentation to this monitor command tells, that 'writable'
argument is optional and defaults to false. However, the code sets
true as the default. But since some applications may already been
using this, it's safer to fix the code and not documentation which
would break those applications.

Signed-off-by: Michal Privoznik &lt;mprivozn@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 8da1e18b0cf46b6c95c88bbad1cc50d6dd1bef4b
      https://github.com/qemu/qemu/commit/8da1e18b0cf46b6c95c88bbad1cc50d6dd1bef4b
  Author: Peter Lieven &lt;pl@dlhnet.de&gt;
  Date:   2012-11-28 (Wed, 28 Nov 2012)

  Changed paths:
    M block/iscsi.c

  Log Message:
  -----------
  iscsi: fix segfault in url parsing

If an invalid URL is specified iscsi_get_error(iscsi) is called
with iscsi == NULL.

Signed-off-by: Peter Lieven &lt;pl@kamp.de&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: e829b0bb054ed3389e5b22dad61875e51674e629
      https://github.com/qemu/qemu/commit/e829b0bb054ed3389e5b22dad61875e51674e629
  Author: Peter Lieven &lt;pl@dlhnet.de&gt;
  Date:   2012-11-28 (Wed, 28 Nov 2012)

  Changed paths:
    M block/iscsi.c

  Log Message:
  -----------
  iscsi: fix deadlock during login

If the connection is interrupted before the first login is successfully
completed qemu-kvm is waiting forever in qemu_aio_wait().

This is fixed by performing an sync login to the target. If the
connection breaks after the first successful login errors are
handled internally by libiscsi.

Signed-off-by: Peter Lieven &lt;pl@kamp.de&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: f807ecd5741325fe0d281199ff22cdda0acb6a7a
      https://github.com/qemu/qemu/commit/f807ecd5741325fe0d281199ff22cdda0acb6a7a
  Author: Peter Lieven &lt;pl@dlhnet.de&gt;
  Date:   2012-11-28 (Wed, 28 Nov 2012)

  Changed paths:
    M block/iscsi.c

  Log Message:
  -----------
  iscsi: do not assume device is zero initialized

Without any complex checks we can't assume that an
iscsi target is initialized to zero.

Signed-off-by: Peter Lieven &lt;pl@kamp.de&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 474ee55a18765e7de8f0b2cc00db5d26286bb24d
      https://github.com/qemu/qemu/commit/474ee55a18765e7de8f0b2cc00db5d26286bb24d
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-11-28 (Wed, 28 Nov 2012)

  Changed paths:
    M hw/virtio-scsi.c

  Log Message:
  -----------
  virtio-scsi: Fix some endian bugs with virtio-scsi

The virtio-scsi specification does not specify the correct endianness for
fields in the request structure.  It's therefore best to assume that it is
"guest native" endian since that's the (stupid and poorly defined) norm in
virtio.

However, the qemu device for virtio-scsi has no byteswaps at all, and so
will break if the guest has different endianness from the host.  This patch
fixes it by adding tswap() calls for the sense_len and resid fields in
the request structure.  In theory status_qualifier needs swaps as well,
but that field is never actually touched.  The tag field is a uint64_t, but
since its value is completely arbitrary, it might as well be uint8_t[8]
and so it does not need swapping.

Cc: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Cc: Paul 'Rusty' Russell &lt;rusty@rustcorp.com.au&gt;
Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 863d1050c96cff91dd478767c0da9cc288575919
      https://github.com/qemu/qemu/commit/863d1050c96cff91dd478767c0da9cc288575919
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-11-28 (Wed, 28 Nov 2012)

  Changed paths:
    M hw/virtio-scsi.c

  Log Message:
  -----------
  virtio-scsi: Fix subtle (guest) endian bug

The virtio-scsi config space is, by specification, in guest endian (which
is ill-defined, but there you go).  In virtio_scsi_get_config() we set up
all the fields in there, using stl_raw().  Which is a problem for the
max_channel and max_target fields, which are 16-bit, not 32-bit.  For
little-endian targets we get away with it by accident, since the first
two bytes will still be correct, and the extra two bytes written (with
zeroes) will be overwritten correctly by the next store.

But for big-endian guests, this means the max_target field ends up as zero,
which means the guest will only recognize a single disk on the virtio-scsi
bus.  This patch fixes the problem.

Cc: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Cc: Paul 'Rusty' Russell &lt;rusty@rustcorp.com.au&gt;
Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: cbdd1999daf2341b33d3ba8036fd84898e1e7c31
      https://github.com/qemu/qemu/commit/cbdd1999daf2341b33d3ba8036fd84898e1e7c31
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-28 (Wed, 28 Nov 2012)

  Changed paths:
    M Makefile.target
    M configure

  Log Message:
  -----------
  build: compile translate.o with -fno-gcse option on GCC 4.6.x and 4.7.[012]

These versions of GCC require insane (&gt;2GB) amounts of memory to compile
translate.o.  As a countermeasure, disable the culprit optimization pass.
This should fix the buildbot failure for default_x86_64_fedora16.  Anyway
this is a good thing to do because people will try to compile 1.3 with
less than 2GB of memory and complain.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: f3d44eb53c10b4dddfb3762c3e005be38adfc0ed
      https://github.com/qemu/qemu/commit/f3d44eb53c10b4dddfb3762c3e005be38adfc0ed
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-28 (Wed, 28 Nov 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  Merge remote-tracking branch 'afaerber/qom-cpu-1.3' into staging

* afaerber/qom-cpu-1.3:
  target-i386: Enable SSSE3 TCG support
  target-i386/cpu: Add missing flags to Haswell CPU model

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 7e68494b0be4310c48996e9334373ef5771e3d15
      https://github.com/qemu/qemu/commit/7e68494b0be4310c48996e9334373ef5771e3d15
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-28 (Wed, 28 Nov 2012)

  Changed paths:
    M hw/ide/macio.c
    M hw/spapr_pci.c
    M kvm-all.c
    M qemu-pixman.c
    M target-ppc/translate.c

  Log Message:
  -----------
  Merge remote-tracking branch 'agraf/ppc-for-upstream-1.3' into staging

* agraf/ppc-for-upstream-1.3:
  fbdev: fix pixman compile on old pixman
  vl.c: Fix broken -usb option
  pseries: Fix bug in PCI MSI allocation
  kvm: fix incorrect length in a loop over kvm dirty pages map
  PPC: Fix missing TRACE exception
  hw/ide/macio: Fix segfault caused by NULL DMAContext*

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 0a6b2ac0cf92a4411cce38a22703d7a34a5b3601
      https://github.com/qemu/qemu/commit/0a6b2ac0cf92a4411cce38a22703d7a34a5b3601
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-28 (Wed, 28 Nov 2012)

  Changed paths:
    M hw/s390-virtio.c
    M hw/s390x/event-facility.c

  Log Message:
  -----------
  Merge remote-tracking branch 'agraf/s390-for-upstream-1.3' into staging

* agraf/s390-for-upstream-1.3:
  sclp: Fix uninitialized var in handle_write_event_buf().
  s390: Fix ram_size updating in machine init

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: e6451fd372bbac8123414a88ed6d3296b66d4b5d
      https://github.com/qemu/qemu/commit/e6451fd372bbac8123414a88ed6d3296b66d4b5d
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-28 (Wed, 28 Nov 2012)

  Changed paths:
    M block/iscsi.c
    M hw/virtio-scsi.c

  Log Message:
  -----------
  Merge remote-tracking branch 'bonzini/scsi-next' into staging

* bonzini/scsi-next:
  virtio-scsi: Fix subtle (guest) endian bug
  virtio-scsi: Fix some endian bugs with virtio-scsi
  iscsi: do not assume device is zero initialized
  iscsi: fix deadlock during login
  iscsi: fix segfault in url parsing

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 264ac41ca171c53eead7e037bc78babb3f0f1bc3
      https://github.com/qemu/qemu/commit/264ac41ca171c53eead7e037bc78babb3f0f1bc3
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-28 (Wed, 28 Nov 2012)

  Changed paths:
    M blockdev-nbd.c
    M nbd.c

  Log Message:
  -----------
  Merge remote-tracking branch 'bonzini/nbd-next' into staging

* bonzini/nbd-next:
  nbd-server-add: Fix the default for 'writable'
  nbd: fix use of two uninitialized bytes when connecting to a named export

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: e9bff10f8db94912b1b0e6e2e3394cae02faf614
      https://github.com/qemu/qemu/commit/e9bff10f8db94912b1b0e6e2e3394cae02faf614
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-11-28 (Wed, 28 Nov 2012)

  Changed paths:
    M event_notifier-win32.c

  Log Message:
  -----------
  event notifier: Fix setup for win32

The event notifier state is only reset by test_and_clear. But we created
the windows event object with auto-reset, which subtly swallowed events.

Reviewed-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/03a36f17d778...e9bff10f8db9

----==_mimepart_50b68971498a4_7fcc16afae41244fa--


</body></email><email><emailId>20121130160042</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-30 16:00:42-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] e912c9: qdev: relax bus type check in qdev_device_add() (v...</subject><body>



----==_mimepart_50b8d82a6d95f_4e37ddbae41428c0
Date: Fri, 30 Nov 2012 08:00:42 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50b8d82a6ff14_4e37ddbae414292c@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: e912c96f7d2e5ccd8a6352ee74f5beee2a7d9976
      https://github.com/qemu/qemu/commit/e912c96f7d2e5ccd8a6352ee74f5beee2a7d9976
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-29 (Thu, 29 Nov 2012)

  Changed paths:
    M hw/qdev-monitor.c

  Log Message:
  -----------
  qdev: relax bus type check in qdev_device_add() (v2)

We are currently checking for an exact type match.  Use QOM dynamic_cast to
check for a compatible type instead.

Cc: Konrad Frederic &lt;fred.konrad@greensocs.com&gt;
Cc: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
---
v1 -&gt; v2:
 - also add cast to qbus_find_recursive (Peter)
 - simplify by doing object_dynamic_cast instead of messing with classes


  Commit: 044d003db9b6a588be2c9d0ec9de694ba3848551
      https://github.com/qemu/qemu/commit/044d003db9b6a588be2c9d0ec9de694ba3848551
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-11-29 (Thu, 29 Nov 2012)

  Changed paths:
    M qemu-tech.texi

  Log Message:
  -----------
  qemu-tech.texi: update implemented xtensa features list

Debug option is available since QEMU-1.2; FP coprocessor and
coprocessor context is available since QEMU-1.3.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: e1f7b4812eab992de46c98b3726745afb042a7f0
      https://github.com/qemu/qemu/commit/e1f7b4812eab992de46c98b3726745afb042a7f0
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-11-29 (Thu, 29 Nov 2012)

  Changed paths:
    M hw/virtio-rng.c
    M hw/virtio-serial-bus.c
    M hw/virtio.c
    M hw/virtio.h

  Log Message:
  -----------
  virtio: limit avail bytes lookahead

Commit 0d8d7690850eb0cf2b2b60933cf47669a6b6f18f introduced
a regression in virtio-net performance because it looks
into the ring aggressively while we really only care
about a single packet worth of buffers.
Reported as bugzilla 1066055 in launchpad.

To fix, add parameters limiting lookahead, and
use in virtqueue_avail_bytes.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Reported-by: Edivaldo de Araujo Pereira &lt;edivaldoapereira@yahoo.com.br&gt;
Tested-by: Edivaldo de Araujo Pereira &lt;edivaldoapereira@yahoo.com.br&gt;
Reviewed-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: fe512d65e0b752dfa7af6cfb374a0820d35040d0
      https://github.com/qemu/qemu/commit/fe512d65e0b752dfa7af6cfb374a0820d35040d0
  Author: Eduardo Otubo &lt;otubo@linux.vnet.ibm.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M qemu-seccomp.c

  Log Message:
  -----------
  seccomp: adding new syscalls (bugzilla 855162)

According to the bug 855162[0] - there's the need of adding new syscalls
to the whitelist when using Qemu with Libvirt.

[0] - https://bugzilla.redhat.com/show_bug.cgi?id=855162

Reported-by: Paul Moore &lt;pmoore@redhat.com&gt;
Tested-by: Paul Moore &lt;pmoore@redhat.com&gt;
Signed-off-by: Eduardo Otubo &lt;otubo@linux.vnet.ibm.com&gt;
Signed-off-by: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: c6e052f0809b56a657b2afcd728e07ffddb28f06
      https://github.com/qemu/qemu/commit/c6e052f0809b56a657b2afcd728e07ffddb28f06
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M pc-bios/multiboot.bin
    M pc-bios/optionrom/multiboot.S

  Log Message:
  -----------
  multiboot: fix e801 memory map

The e801 memory sizes in the multiboot structures hard-code the available
low memory to 640.  However, the value should not include the size of the
EBDA.  Fill the value in the option ROM, getting the size of low memory
from the BIOS.

Cc: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: d76aa45bf1f226d2c4e28f6dacbdbbefd51a37ca
      https://github.com/qemu/qemu/commit/d76aa45bf1f226d2c4e28f6dacbdbbefd51a37ca
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M audio/audio_pt_int.c

  Log Message:
  -----------
  Revert "audio/audio_pt_int: Clarify licensing"

This reverts commit 72bc6f1bf710e205f175af9b1fc8bbd83e8da71f.

This patch wasn't submitted to the list and did not get Acked by other
copyright holders in the file.

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 46ee77b357dde619db30d835f73a9001b9c75a03
      https://github.com/qemu/qemu/commit/46ee77b357dde619db30d835f73a9001b9c75a03
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M audio/wavcapture.c

  Log Message:
  -----------
  Revert "audio/wavcapture: Clarify licensing"

This reverts commit 456a84d156a7c42f18b1da176dd6219e2dffd043.

This patch wasn't submitted to the list and did not get Acked by other
copyright holders in the file.

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/e9bff10f8db9...46ee77b357dd

----==_mimepart_50b8d82a6d95f_4e37ddbae41428c0--


</body></email><email><emailId>20121130181619</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-30 18:16:19-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] fa98ef: qxl: reload memslots after migration, when qxl is ...</subject><body>



----==_mimepart_50b8f7f337a36_35c511faae41010cb
Date: Fri, 30 Nov 2012 10:16:19 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50b8f7f33c7be_35c511faae4101176@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: fa98efe932d93a15ffa867f3b05149c8d1fc7c28
      https://github.com/qemu/qemu/commit/fa98efe932d93a15ffa867f3b05149c8d1fc7c28
  Author: Yonit Halperin &lt;yhalperi@redhat.com&gt;
  Date:   2012-11-28 (Wed, 28 Nov 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  qxl: reload memslots after migration, when qxl is in UNDEFINED mode

The devram memslot stays active when qxl enters UNDEFINED mode (i.e, no
primary surface). If migration has occurred while the device is in
UNDEFINED stae, the memslots have to be reloaded at the destination.

Fixes rhbz#874574

Signed-off-by: Yonit Halperin &lt;yhalperi@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 6c2d1c32d084320081b0cd047f8cacd6e722d03a
      https://github.com/qemu/qemu/commit/6c2d1c32d084320081b0cd047f8cacd6e722d03a
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-28 (Wed, 28 Nov 2012)

  Changed paths:
    M hw/usb/hcd-ehci-pci.c
    M hw/usb/hcd-ohci.c
    M hw/usb/hcd-uhci.c
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  usb: tag usb host adapters as not hotpluggable.

Hotplugging them simply doesn't work, so tag them accordingly to
avoid users trying and then crashing qemu.

For xhci there is nothing fundamental which prevents hotplug from
working, we'll "only" need a exit() function which cleans up
everything properly.  That isn't for 1.3 though.

For ehci+uhci+ohci hotplug can't be supported until qemu gains the
capability to hotplug multifunction pci devices.

https://bugzilla.redhat.com/show_bug.cgi?id=879096

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: c128d6a6d785eb9235a4f6dbd52f405ab8c60bee
      https://github.com/qemu/qemu/commit/c128d6a6d785eb9235a4f6dbd52f405ab8c60bee
  Author: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
  Date:   2012-11-28 (Wed, 28 Nov 2012)

  Changed paths:
    M hw/usb/bus.c

  Log Message:
  -----------
  usb: fail usbdevice_create() when there is no USB bus

Report an error instead of segfaulting when attaching a USB device to a
machine with no USB busses:

  $ qemu-system-arm -machine vexpress-a9 \
      -sd Fedora-17-armhfp-vexpress-mmcblk0.img \
      -kernel vmlinuz-3.4.2-3.fc17.armv7hl \
      -initrd initramfs-3.4.2-3.fc17.armv7hl.img \
      -usbdevice disk:format=raw:test.img

Note that the vexpress-a9 machine does not have a USB host controller.

Reported-by: David Abdurachmanov &lt;David.Abdurachmanov@cern.ch&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 2b29f492c844ed03d6d16ebe6bb760d71b6557fe
      https://github.com/qemu/qemu/commit/2b29f492c844ed03d6d16ebe6bb760d71b6557fe
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-11-28 (Wed, 28 Nov 2012)

  Changed paths:
    M hw/usb/hcd-ehci-sysbus.c

  Log Message:
  -----------
  ehci-sysbus: Attach DMA context.

This was left as NULL on the initial merge due to debate on the mailing list on
how to handle DMA contexts for sysbus devices. Patch
9e11908f12f92e31ea94dc2a4c962c836cba9f2a was later merged to fix OHCI. This is the,
equivalent fix for sysbus EHCI.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 1d16252652688a775b244fffa1b9ac9b719ceffc
      https://github.com/qemu/qemu/commit/1d16252652688a775b244fffa1b9ac9b719ceffc
  Author: Bruce Rogers &lt;brogers@suse.com&gt;
  Date:   2012-11-29 (Thu, 29 Nov 2012)

  Changed paths:
    M qapi/qapi-dealloc-visitor.c

  Log Message:
  -----------
  qapi: fix qapi_dealloc_type_size parameter type

The second parameter to qapi_dealloc_type_size should be a uint64_t *,
not a size_t *. This was causing our 32 bit x86 build to fail, since
warnings are treated as errors.

Signed-off-by: Bruce Rogers &lt;brogers@suse.com&gt;
Reviewed-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Reviewed-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: a13e5e05570e6c0d0a6c8d9b5c516278770adae5
      https://github.com/qemu/qemu/commit/a13e5e05570e6c0d0a6c8d9b5c516278770adae5
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M qemu-options.hx

  Log Message:
  -----------
  Documentation: Update block cache mode information

Somehow we forgot to update this when cache=writeback became the
default. While changing the information on the default, also make the
description of all caches modes a bit more accurate.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Acked-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: d3067b020bdeb572f381c5be4420eedfd6af5884
      https://github.com/qemu/qemu/commit/d3067b020bdeb572f381c5be4420eedfd6af5884
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M qemu-doc.texi
    M qemu-img.texi

  Log Message:
  -----------
  Documentation: Update image format information

Document new and yet undocumented options and image formats. The
qemu-img man page contains information only for raw and qcow2 now and
references the HTML documentation for a more detailed description of
other formats.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Acked-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 0c6f08b0b0d0c758789cdb7257a48e873598bdbb
      https://github.com/qemu/qemu/commit/0c6f08b0b0d0c758789cdb7257a48e873598bdbb
  Author: Pavel Hrdina &lt;phrdina@redhat.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M hw/ide/atapi.c
    M hw/ide/core.c

  Log Message:
  -----------
  atapi: make change media detection for guests easier

If you have a guest with a media in the optical drive and you change
it, the windows guest cannot properly recognize this media change.

Windows needs to detect sense "NOT_READY with ASC_MEDIUM_NOT_PRESENT"
before we send sense "UNIT_ATTENTION with ASC_MEDIUM_MAY_HAVE_CHANGED".

Signed-off-by: Pavel Hrdina &lt;phrdina@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: e3980e28bb888bf643054770452998d1b4319609
      https://github.com/qemu/qemu/commit/e3980e28bb888bf643054770452998d1b4319609
  Author: Dietmar Maurer &lt;dietmar@proxmox.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M include/qemu/ratelimit.h

  Log Message:
  -----------
  stream: fix ratelimit_set_speed

The formula to compute slice_quota was wrong since commit 6ef228fc.

Signed-off-by: Dietmar Maurer &lt;dietmar@proxmox.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 2ad2210a7d2483c4c98423ebd59fad87c6124096
      https://github.com/qemu/qemu/commit/2ad2210a7d2483c4c98423ebd59fad87c6124096
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M coroutine-sigaltstack.c

  Log Message:
  -----------
  coroutine-sigaltstack.c: Use stack_t, not struct sigaltstack

Use the POSIX-specified stack_t type as the argument to sigaltstack()
rather than the legacy struct sigaltstack. This allows us to compile
on MacOSX with --with-coroutine=sigaltstack.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 1f32989d7349c31419d01a0b874f5eb3a238d913
      https://github.com/qemu/qemu/commit/1f32989d7349c31419d01a0b874f5eb3a238d913
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M roms/seabios

  Log Message:
  -----------
  seabios: update to b1c35f2b28cc0c94ebed8176ff61ac0e0b377798

This patch updates the seabios submodule to commit
b1c35f2b28cc0c94ebed8176ff61ac0e0b377798.

Most important change is that seabios sets the busmaster bit
in the pci config space for the lsi and esp scsi host adapters.
Since commit 1c380f9460522f32c8dd2577b2a53d518ec91c6d qemu
is strict here and disallows any dma access when the bit is
clear.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 7527bd85be991d91584329fcbb44af322758719e
      https://github.com/qemu/qemu/commit/7527bd85be991d91584329fcbb44af322758719e
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M roms/Makefile

  Log Message:
  -----------
  roms: also copy the dsdt when updating seabios.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: d7a51dbbaa70677846453f8c961590913052dd86
      https://github.com/qemu/qemu/commit/d7a51dbbaa70677846453f8c961590913052dd86
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    A pc-bios/acpi-dsdt.aml
    M pc-bios/bios.bin

  Log Message:
  -----------
  seabios: update binaries in pc-bios/

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 36520faa33abb91b3c8a80e935b82afec78f9bee
      https://github.com/qemu/qemu/commit/36520faa33abb91b3c8a80e935b82afec78f9bee
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M qapi/qapi-dealloc-visitor.c

  Log Message:
  -----------
  Merge remote-tracking branch 'qmp/queue/qmp' into staging

* qmp/queue/qmp:
  qapi: fix qapi_dealloc_type_size parameter type

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 923fd9897b0ffbcc5091181f8b0484aa2e36413b
      https://github.com/qemu/qemu/commit/923fd9897b0ffbcc5091181f8b0484aa2e36413b
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M hw/usb/bus.c
    M hw/usb/hcd-ehci-pci.c
    M hw/usb/hcd-ehci-sysbus.c
    M hw/usb/hcd-ohci.c
    M hw/usb/hcd-uhci.c
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  Merge remote-tracking branch 'kraxel/usb.73' into staging

* kraxel/usb.73:
  ehci-sysbus: Attach DMA context.
  usb: fail usbdevice_create() when there is no USB bus
  usb: tag usb host adapters as not hotpluggable.

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 3235f92784bcf679894b34081f4f4b04e4a358e3
      https://github.com/qemu/qemu/commit/3235f92784bcf679894b34081f4f4b04e4a358e3
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  Merge remote-tracking branch 'spice/spice.v65' into staging

* spice/spice.v65:
  qxl: reload memslots after migration, when qxl is in UNDEFINED mode

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 90e07938aa08fc179270d46c35fe9fd27c527f33
      https://github.com/qemu/qemu/commit/90e07938aa08fc179270d46c35fe9fd27c527f33
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M coroutine-sigaltstack.c
    M hw/ide/atapi.c
    M hw/ide/core.c
    M include/qemu/ratelimit.h
    M qemu-doc.texi
    M qemu-img.texi
    M qemu-options.hx

  Log Message:
  -----------
  Merge remote-tracking branch 'kwolf/for-anthony' into staging

* kwolf/for-anthony:
  coroutine-sigaltstack.c: Use stack_t, not struct sigaltstack
  stream: fix ratelimit_set_speed
  atapi: make change media detection for guests easier
  Documentation: Update image format information
  Documentation: Update block cache mode information

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: ee0caa8c8fe46b2b2c59604a3b2da0b2d3312d92
      https://github.com/qemu/qemu/commit/ee0caa8c8fe46b2b2c59604a3b2da0b2d3312d92
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    A pc-bios/acpi-dsdt.aml
    M pc-bios/bios.bin
    M roms/Makefile
    M roms/seabios

  Log Message:
  -----------
  Merge remote-tracking branch 'kraxel/seabios-b1c35f2' into staging

* kraxel/seabios-b1c35f2:
  seabios: update binaries in pc-bios/
  roms: also copy the dsdt when updating seabios.
  seabios: update to b1c35f2b28cc0c94ebed8176ff61ac0e0b377798

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/46ee77b357dd...ee0caa8c8fe4

----==_mimepart_50b8f7f337a36_35c511faae41010cb--


</body></email><email><emailId>20121130220033</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-30 22:00:33-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 01bbd8: Update version for 1.3.0-rc2</subject><body>



----==_mimepart_50b92c81b26e1_7f0d1337aec48454
Date: Fri, 30 Nov 2012 14:00:33 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50b92c81b3766_7f0d1337aec48576@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 01bbd8bf2caced5cb07939669f58d3a7bcc78092
      https://github.com/qemu/qemu/commit/01bbd8bf2caced5cb07939669f58d3a7bcc78092
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-11-30 (Fri, 30 Nov 2012)

  Changed paths:
    M VERSION

  Log Message:
  -----------
  Update version for 1.3.0-rc2

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;




----==_mimepart_50b92c81b26e1_7f0d1337aec48454--


</body></email><email><emailId>201211302200330</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-11-30 22:00:33-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu]</subject><body>



----==_mimepart_50b92c8139ab3_9341b3baf411438e
Date: Fri, 30 Nov 2012 14:00:33 -0800
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50b92c813ab20_9341b3baf4114496@sh3.rs.github.com.mail&gt;

  Branch: refs/tags/v1.3.0-rc2
  Home:   https://github.com/qemu/qemu


----==_mimepart_50b92c8139ab3_9341b3baf411438e--


</body></email><email><emailId>20121001203010</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-01 20:30:10-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 4be8ee: fpu/softfloat.c: Remove pointless shift of always-...</subject><body>



----==_mimepart_5069fd5228dcf_26ab1549aec884fc
Date: Mon, 01 Oct 2012 13:30:10 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5069fd522a774_26ab1549aec885eb@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 4be8eeacb9f2b01ad98747ad88e54a7feabc664c
      https://github.com/qemu/qemu/commit/4be8eeacb9f2b01ad98747ad88e54a7feabc664c
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-01 (Mon, 01 Oct 2012)

  Changed paths:
    M fpu/softfloat.c

  Log Message:
  -----------
  fpu/softfloat.c: Remove pointless shift of always-zero value

In float16_to_float32, when returning an infinity, just pass zero
as the mantissa argument to packFloat32(), rather than shifting
a value which we know must be zero.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: e744c06fca438dc08271e626034e632a270c91c8
      https://github.com/qemu/qemu/commit/e744c06fca438dc08271e626034e632a270c91c8
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-01 (Mon, 01 Oct 2012)

  Changed paths:
    M fpu/softfloat.c

  Log Message:
  -----------
  fpu/softfloat.c: Return correctly signed values from uint64_to_float32

The uint64_to_float32() conversion function was incorrectly always
returning numbers with the sign bit set (ie negative numbers). Correct
this so we return positive numbers instead.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


Compare: https://github.com/qemu/qemu/compare/0f41dc182c7e...e744c06fca43

----==_mimepart_5069fd5228dcf_26ab1549aec884fc--


</body></email><email><emailId>20121005023017</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-05 02:30:17-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 356d83: add pc-1.3 machine type</subject><body>



----==_mimepart_506e46399d0fb_187516efaf47314f
Date: Thu, 04 Oct 2012 19:30:17 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;506e4639ac391_187516efaf473237@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 356d83725675c0140db27b24afed3a2c0c7d9702
      https://github.com/qemu/qemu/commit/356d83725675c0140db27b24afed3a2c0c7d9702
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-26 (Wed, 26 Sep 2012)

  Changed paths:
    M hw/pc_piix.c

  Log Message:
  -----------
  add pc-1.3 machine type

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: a2879190ab08b2b75d65b576fad7ff95d7d7d641
      https://github.com/qemu/qemu/commit/a2879190ab08b2b75d65b576fad7ff95d7d7d641
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-26 (Wed, 26 Sep 2012)

  Changed paths:
    M hw/pc_piix.c

  Log Message:
  -----------
  compat: turn off msi/msix on xhci for old machine types

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: d95e74eaed8b74b0c75ab343e9cb826b1f5c9007
      https://github.com/qemu/qemu/commit/d95e74eaed8b74b0c75ab343e9cb826b1f5c9007
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-26 (Wed, 26 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: tweak limits

Set maxports to 15.  This is what the usb3 route string can handle.

Set maxslots to 64.  This is more than the number of root ports we
can have, but with additional hubs you can end up with more devices.

Set maxintrs (aka msi vectors) to 16.  Should be enougth, especially
considering that vectors are a limited ressource.  Linux guests use
only three at the moment.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: ccaf87a085c748910efddbcfb5077f6a67cc354a
      https://github.com/qemu/qemu/commit/ccaf87a085c748910efddbcfb5077f6a67cc354a
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-26 (Wed, 26 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: route string &amp; usb hub support

Parse route string in slot contexts and
support devices connected via hub.


  Commit: 1d8a4e69eeda7e474d1a6b50951b0b1680f8186e
      https://github.com/qemu/qemu/commit/1d8a4e69eeda7e474d1a6b50951b0b1680f8186e
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-26 (Wed, 26 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: create a memory region for each port

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: cae5d3f4b3fbe9b681c0c4046008af424bd1d6a5
      https://github.com/qemu/qemu/commit/cae5d3f4b3fbe9b681c0c4046008af424bd1d6a5
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-26 (Wed, 26 Sep 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Fix interrupt packet MULT handling

There are several issues with our handling of the MULT epcap field
of interrupt qhs, which this patch fixes.

1) When we don't execute a transaction because of the transaction counter
being 0, p-&gt;async stays EHCI_ASYNC_NONE, and the next time we process the
same qtd we hit an assert in ehci_state_fetchqtd because of this. Even though
I believe that this is caused by 3 below, this patch still removes the assert,
as that can still happen without 3, when multiple packets are queued for the
same interrupt ep.

2) We only *check* the transaction counter from ehci_state_execute, any
packets queued up by fill_queue bypass this check. This is fixed by not calling
fill_queue for interrupt packets.

3) Some versions of Windows set the MULT field of the qh to 0, which is a
clear violation of the EHCI spec, but still they do it. This means that we
will never execute a qtd for these, making interrupt ep-s on USB-2 devices
not work, and after recent changes, triggering 1).

So far we've stored the transaction counter in our copy of the mult field,
but with this beginnig at 0 already when dealing with these version of windows
this won't work. So this patch adds a transact_ctr field to our qh struct,
and sets this to the MULT field value on fetchqh. When the MULT field value
is 0, we set it to 4. Assuming that windows gets way with setting it to 0,
by the actual hardware going horizontal on a 1 -&gt; 0 transition, which will
give it 4 transactions (MULT goes from 0 - 3).

Note that we cannot stop on detecting the 1 -&gt; 0 transition, as our decrement
of the transaction counter, and checking for it are done in 2 different places.

Reported-by: Shawn Starr &lt;shawn.starr@rogers.com&gt;
Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 8b626aa7841ef79b70066c880b3b6c29496797af
      https://github.com/qemu/qemu/commit/8b626aa7841ef79b70066c880b3b6c29496797af
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-26 (Wed, 26 Sep 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  usb-redir: Adjust pkg-config check for usbredirparser .pc file rename (v2)

The usbredir 0.5 release introduced the new API for 64 bit packet ids, but
it kept the libusbredirparser.pc name as is, meaning that older versions of
qemu will still have their pkg-config check for usbredirparser fulfilled,
and build with the usb-redir device. Due to the API change there will be
some compiler warnings, but the build will succeed, however the usb-redir
device will be broken on 32 bit machines.

To solve this a new usbredir-0.5.2 release is coming, which renames the
libusbredirparser.pc file to libusbredirparser-0.5.pc, so that it will no
longer fulfill the pkg-config check of the qemu-1.2 and older releases,
stopping the (silent) breakage. This patch adjusts qemu master's configure
to properly detect the new usbredir release.

Changes in v2:
-Not only use the new .pc name in the check but also when getting cflags
 and libs!

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 39c138c8420f51a7da7b35233a8d7400a0b589ac
      https://github.com/qemu/qemu/commit/39c138c8420f51a7da7b35233a8d7400a0b589ac
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-09-26 (Wed, 26 Sep 2012)

  Changed paths:
    M hw/usb/libhw.c

  Log Message:
  -----------
  usb: Fix usb_packet_map() in the presence of IOMMUs

With the IOMMU infrastructure introduced before 1.2, we need to use
dma_memory_map() to obtain a qemu pointer to memory from an IO bus address.
However, dma_memory_map() alters the given length to reflect the length
over which the used DMA translation is valid - which could be either more
or less than the requested length.

usb_packet_map() does not correctly handle these cases, simply failing if
dma_memory_map() alters the requested length.  If dma_memory_map()
increased the length, we just need to use the requested length for the
qemu_iovec_add().  However, if it decreased the length, it means that a
single DMA translation is not valid for the whole sglist element, and so
we need to loop, splitting it up into multiple iovec entries for each
piece with a DMA translation (in practice &gt;2 pieces is unlikely).

This patch implements the correct behaviour

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: e9d17b6890ae772f3652c8cacf4e1f72f576f907
      https://github.com/qemu/qemu/commit/e9d17b6890ae772f3652c8cacf4e1f72f576f907
  Author: Ryota Ozaki &lt;ozaki.ryota@gmail.com&gt;
  Date:   2012-09-26 (Wed, 26 Sep 2012)

  Changed paths:
    M QMP/qmp.py

  Log Message:
  -----------
  Make negotiation optional in QEMUMonitorProtocol

This is a preparation for qemu-ga-client which uses
QEMUMonitorProtocol class. The class tries to
negotiate capabilities on connect, however, qemu-ga
doesn't suppose it and fails.

This change makes the negotiation optional, though
it's still performed by default for compatibility.

Signed-off-by: Ryota Ozaki &lt;ozaki.ryota@gmail.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: e37b350aa8766ae36ec9bf40fab665455d4a5530
      https://github.com/qemu/qemu/commit/e37b350aa8766ae36ec9bf40fab665455d4a5530
  Author: Ryota Ozaki &lt;ozaki.ryota@gmail.com&gt;
  Date:   2012-09-26 (Wed, 26 Sep 2012)

  Changed paths:
    M QMP/qmp.py

  Log Message:
  -----------
  Support settimeout in QEMUMonitorProtocol

This method is used in the following qemu-ga-client script
to implement non-blocking operations.

Signed-off-by: Ryota Ozaki &lt;ozaki.ryota@gmail.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: f513cbf7503d8db3778df436beaf25f3d8260317
      https://github.com/qemu/qemu/commit/f513cbf7503d8db3778df436beaf25f3d8260317
  Author: Ryota Ozaki &lt;ozaki.ryota@gmail.com&gt;
  Date:   2012-09-26 (Wed, 26 Sep 2012)

  Changed paths:
    A QMP/qemu-ga-client

  Log Message:
  -----------
  Add qemu-ga-client script

This is an easy-to-use QEMU guest agent client written in
Python. It simply provides commands to call guest agent
functions like ping, fsfreeze and shutdown. Additionally,
it provides extra useful commands, e.g, cat, ifconfig and
reboot, by using guet agent functions.

Examples:
  $ export QGA_CLIENT_ADDRESS=/tmp/qga.sock
  $ qemu-ga-client ping

  $ qemu-ga-client cat /etc/resolv.conf
  # Generated by NetworkManager
  nameserver 10.0.2.3

  $ qemu-ga-client fsfreeze status
  thawed
  $ qemu-ga-client fsfreeze freeze
  2 filesystems frozen

The script communicates with a guest agent by means of
qmp.QEMUMonitorProtocol. Every commands are called with
timeout (3 sec.) to avoid blocking. The script always
calls sync command prior to issuing an actual command
(except for ping which doesn't need sync).

Signed-off-by: Ryota Ozaki &lt;ozaki.ryota@gmail.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: eda50a656f52a5172fa8a95f7b217565b90d413e
      https://github.com/qemu/qemu/commit/eda50a656f52a5172fa8a95f7b217565b90d413e
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-26 (Wed, 26 Sep 2012)

  Changed paths:
    M scripts/qapi-types.py
    M scripts/qapi-visit.py
    M scripts/qapi.py

  Log Message:
  -----------
  qapi: do not protect enum values from namespace pollution

Enum values are always preceded by the uppercase name of the enum, so
they do not conflict with reserved words.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 1057725f6629fc2771a294a92ce8eedb92c86fe8
      https://github.com/qemu/qemu/commit/1057725f6629fc2771a294a92ce8eedb92c86fe8
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-26 (Wed, 26 Sep 2012)

  Changed paths:
    M scripts/qapi.py

  Log Message:
  -----------
  qapi: add "unix" to the set of reserved words

It is #defined to 1.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 9a3a88956c7f32130ad20011f7c3c161fa5876d8
      https://github.com/qemu/qemu/commit/9a3a88956c7f32130ad20011f7c3c161fa5876d8
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-26 (Wed, 26 Sep 2012)

  Changed paths:
    M hw/kvm/pci-assign.c

  Log Message:
  -----------
  pci-assign: use monitor_handle_fd_param

There is no need to open-code the choice between a file descriptor
number or a named one.  Just use monitor_handle_fd_param, which
also takes care of printing the error message.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: a9940fc4cba811adfb296fe07b247ee707265f90
      https://github.com/qemu/qemu/commit/a9940fc4cba811adfb296fe07b247ee707265f90
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-26 (Wed, 26 Sep 2012)

  Changed paths:
    M dump.c
    M migration-fd.c
    M monitor.c
    M monitor.h

  Log Message:
  -----------
  monitor: add Error * argument to monitor_get_fd

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: b224e5e2162a767dd56dbc366f796fbe45ca5baa
      https://github.com/qemu/qemu/commit/b224e5e2162a767dd56dbc366f796fbe45ca5baa
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-09-26 (Wed, 26 Sep 2012)

  Changed paths:
    M monitor.c
    M qapi-schema.json
    M qmp-commands.hx
    M qmp.c

  Log Message:
  -----------
  qapi: convert add_client

Also fixes a few issues while there:

 1. The fd returned by monitor_get_fd() leaks in most error conditions
 2. monitor_get_fd() return value is not checked. Best case we get
    an error that is not correctly reported, worse case one of the
    functions using the fd (with value of -1) will explode
 3. A few error conditions aren't reported
 4. We now "use up" @fdname always.  Before, it was left alone for
    invalid @protocol

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: d691180e41f58cc3c1f9fa848c2ab89193503160
      https://github.com/qemu/qemu/commit/d691180e41f58cc3c1f9fa848c2ab89193503160
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-09-27 (Thu, 27 Sep 2012)

  Changed paths:
    M qapi-schema.json

  Log Message:
  -----------
  qmp: dump-guest-memory: improve schema doc (again)

 o Add a note about memory allocation with paging=true
 o Fix indentation

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 2f61652d660ec1ffdadf926401a174c11f5c13a7
      https://github.com/qemu/qemu/commit/2f61652d660ec1ffdadf926401a174c11f5c13a7
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-09-27 (Thu, 27 Sep 2012)

  Changed paths:
    M dump.c

  Log Message:
  -----------
  qmp: dump-guest-memory: don't spin if non-blocking fd would block

fd_write_vmcore() will indefinitely spin for a non-blocking
file-descriptor that would block. However, if the fd is non-blocking,
how does it make sense to spin?

Change this behavior to return an error instead.

Note that this can only happen with an fd provided by a management
application. The fd opened internally by dump-guest-memory is blocking.

While there, also fix 'writen_size' variable name.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 753637695bcf6b80ea96614de5d31161603ad50f
      https://github.com/qemu/qemu/commit/753637695bcf6b80ea96614de5d31161603ad50f
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-09-27 (Thu, 27 Sep 2012)

  Changed paths:
    M hmp-commands.hx
    M hmp.c

  Log Message:
  -----------
  hmp: dump-guest-memory: hardcode protocol argument to "file:"

Today, it's necessary to specify the protocol you want to use
when dumping the guest memory, for example:

 (qemu) dump-guest-memory file:/tmp/guest-memory

This has a few issues:

 1. It's cumbersome to type
 2. We loose file path autocompletion
 3. Being able to specify fd:X in HMP makes little sense for humans

Because of these reasons, hardcode the 'protocol' argument to
'file:' in HMP.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 05a3543dbddd03d6be723be4074e2e661b00b851
      https://github.com/qemu/qemu/commit/05a3543dbddd03d6be723be4074e2e661b00b851
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-09-27 (Thu, 27 Sep 2012)

  Changed paths:
    M input.c

  Log Message:
  -----------
  input: qmp_send_key(): simplify

The current code duplicates the QKeyCodeList keys in order to store
the key values for release_keys() late run. This is a bit complicated
though, as we have to care about correct ordering and then release_keys()
will have to index key_defs[] over again.

Switch to an array of integers, which is dynamically allocated and stores
the already converted key value.

This simplifies the current code and the next commit.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 9f32897768064841fe9a99145c9d15ab6667ffed
      https://github.com/qemu/qemu/commit/9f32897768064841fe9a99145c9d15ab6667ffed
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-09-27 (Thu, 27 Sep 2012)

  Changed paths:
    M hmp.c
    M input.c
    M qapi-schema.json

  Log Message:
  -----------
  qmp: qmp_send_key(): accept key codes in hex

Before the qapi conversion, the sendkey command could be used to
send key codes in hex directly to the guest. In HMP, this would
be like:

 (qemu) sendkey 0xdc

However, the qapi conversion broke this, as it only supports sending
QKeyCode values to the guest. That's a regression.

This commit fixes the problem by adding hex value support down
the QMP interface, qmp_send_key().

In more detail, this commit:

 1. Adds the KeyValue union. This can represent an hex value or
    a QKeyCode value

 2. *Changes* the QMP send-key command to take an KeyValue argument
    instead of a QKeyCode one

 3. Adapt hmp_send_key() to the QMP interface changes

Item 2 is an incompatible change, but as we're in development phase
(and this command has been merged a few weeks ago) this shouldn't be
a problem.

Finally, it's not possible to split this commit without breaking the
build.

Reported-by: Avi Kivity &lt;avi@redhat.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 9d537c9019e6a05713b44900c78447a0cfb06567
      https://github.com/qemu/qemu/commit/9d537c9019e6a05713b44900c78447a0cfb06567
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-09-27 (Thu, 27 Sep 2012)

  Changed paths:
    M input.c

  Log Message:
  -----------
  input: index_from_key(): drop unused code

The hex key conversion is unused since last commit.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;


  Commit: 8bde9b6f8892c15e46e1f37a37ac038313be4d58
      https://github.com/qemu/qemu/commit/8bde9b6f8892c15e46e1f37a37ac038313be4d58
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-27 (Thu, 27 Sep 2012)

  Changed paths:
    M qapi-schema.json

  Log Message:
  -----------
  block: live snapshot documentation tweaks

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 0cea71a207508c2b8f563b2644ac46009832c8f4
      https://github.com/qemu/qemu/commit/0cea71a207508c2b8f563b2644ac46009832c8f4
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M hw/virtio.c

  Log Message:
  -----------
  virtio: don't mark unaccessed memory as dirty

offset of accessed buffer is calculated using iov_length, so it
can exceed accessed len. If that happens
math in len - offset wraps around, and size becomes wrong.
As real value is 0, so this is harmless but unnecessary.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 40bad8f3deba15e2074ff34cfe923c12916b1cc5
      https://github.com/qemu/qemu/commit/40bad8f3deba15e2074ff34cfe923c12916b1cc5
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M hw/virtio-net.c

  Log Message:
  -----------
  virtio-net: fix used len for tx

There is no out sg for TX, so used buf length for tx
should always be 0.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 844b5cea8ea6cbe964670a26d1b34037067569df
      https://github.com/qemu/qemu/commit/844b5cea8ea6cbe964670a26d1b34037067569df
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M iov.c
    M iov.h

  Log Message:
  -----------
  iov: add const annotation

iov_from_buf does not change iov, make it const.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 385ce95d9d060f20870402c8b2b503d0b6ab8af0
      https://github.com/qemu/qemu/commit/385ce95d9d060f20870402c8b2b503d0b6ab8af0
  Author: Amit Shah &lt;amit.shah@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M hw/virtio.c

  Log Message:
  -----------
  virtio: use unsigned int for counting bytes in vq

The virtqueue_avail_bytes() function counts bytes in an int.  Use an
unsigned int instead.

Signed-off-by: Amit Shah &lt;amit.shah@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 0d8d7690850eb0cf2b2b60933cf47669a6b6f18f
      https://github.com/qemu/qemu/commit/0d8d7690850eb0cf2b2b60933cf47669a6b6f18f
  Author: Amit Shah &lt;amit.shah@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M hw/virtio.c
    M hw/virtio.h

  Log Message:
  -----------
  virtio: Introduce virtqueue_get_avail_bytes()

The current virtqueue_avail_bytes() is oddly named, and checks if a
particular number of bytes are available in a vq.  A better API is to
fetch the number of bytes available in the vq, and let the caller do
what's interesting with the numbers.

Introduce virtqueue_get_avail_bytes(), which returns the number of bytes
for buffers marked for both, in as well as out.  virtqueue_avail_bytes()
is made a wrapper over this new function.

Signed-off-by: Amit Shah &lt;amit.shah@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: ad3005ad8c70a69705149d3ce6d1e51fb76edb15
      https://github.com/qemu/qemu/commit/ad3005ad8c70a69705149d3ce6d1e51fb76edb15
  Author: Amit Shah &lt;amit.shah@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M hw/virtio-serial-bus.c

  Log Message:
  -----------
  virtio-serial-bus: let chardev know the exact number of bytes requested

Using the virtqueue_avail_bytes() function had an unnecessarily
crippling effect on the number of bytes needed by the guest as reported
to the chardev layer in the can_read() callback.

Using the new virtqueue_get_avail_bytes() function will let us advertise
the exact number of bytes we can send to the guest.

Signed-off-by: Amit Shah &lt;amit.shah@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 946d58be1533bf843b499df12e1d9f97b28245c8
      https://github.com/qemu/qemu/commit/946d58be1533bf843b499df12e1d9f97b28245c8
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M block-migration.c

  Log Message:
  -----------
  block-migration: Flush requests in blk_mig_cleanup

When cancelling block migration, all in-flight requests of the block
migration must be completed before the data can be freed. This was
visible as failing assertions and segfaults.

Reported-by: Peter Lieven &lt;pl@dlhnet.de&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 870f5681c9dbafc738082b1fd48e0cc013bf43c7
      https://github.com/qemu/qemu/commit/870f5681c9dbafc738082b1fd48e0cc013bf43c7
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M blockdev.c

  Log Message:
  -----------
  block: after creating a live snapshot, make old image read-only

Currently, after a live snapshot of a drive, the image that has
been 'demoted' to be below the new active layer remains r/w.
This patch reopens it read-only.

Note that we do not check for error on the reopen(), because we
will not abort the snapshots if the reopen fails.

This patch depends on the bdrv_reopen() series.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 00f78533326c5ba2e62fafada16655aa558a5520
      https://github.com/qemu/qemu/commit/00f78533326c5ba2e62fafada16655aa558a5520
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M aio.c

  Log Message:
  -----------
  aio: Fix qemu_aio_wait() to maintain correct walking_handlers count

Fix qemu_aio_wait() to ensure that registered aio handlers don't get
deleted when they are still active. This is ensured by maintaning the
right count of walking_handlers.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Bharata B Rao &lt;bharata@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: ca0defb95c69f88a905d64adbe253e7bb8fde14a
      https://github.com/qemu/qemu/commit/ca0defb95c69f88a905d64adbe253e7bb8fde14a
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M Makefile.objs
    A uri.c
    A uri.h

  Log Message:
  -----------
  qemu: URI parsing library

Add a new URI parsing library to QEMU. The code has been borrowed from
libxml2 and libvirt.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Bharata B Rao &lt;bharata@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 2db2bfc0ccac5fd68dbf0ceb70fbc372c5d8a8c7
      https://github.com/qemu/qemu/commit/2db2bfc0ccac5fd68dbf0ceb70fbc372c5d8a8c7
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M aio.c

  Log Message:
  -----------
  aio: Another fix to the walking_handlers logic

The AIO dispatch loop will call QLIST_REMOVE and g_free even if there
are other pending calls to qemu_aio_wait outside the current one.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Bharata B Rao &lt;bharata@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: eb100396b9d2658e8bf9cdc14bfcb16a9152f464
      https://github.com/qemu/qemu/commit/eb100396b9d2658e8bf9cdc14bfcb16a9152f464
  Author: Bharata B Rao &lt;bharata@linux.vnet.ibm.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: Add a config option for GlusterFS as block backend

GlusterFS support in QEMU depends on libgfapi, libgfrpc and
libgfxdr provided by GlusterFS.

Signed-off-by: Bharata B Rao &lt;bharata@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 8d6d89cb63c57569864ecdeb84d3a1c2ebd031cc
      https://github.com/qemu/qemu/commit/8d6d89cb63c57569864ecdeb84d3a1c2ebd031cc
  Author: Bharata B Rao &lt;bharata@linux.vnet.ibm.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M block/Makefile.objs
    A block/gluster.c

  Log Message:
  -----------
  block: Support GlusterFS as a QEMU block backend.

This patch adds gluster as the new block backend in QEMU. This gives
QEMU the ability to boot VM images from gluster volumes. Its already
possible to boot from VM images on gluster volumes using FUSE mount, but
this patchset provides the ability to boot VM images from gluster volumes
by by-passing the FUSE layer in gluster. This is made possible by
using libgfapi routines to perform IO on gluster volumes directly.

VM Image on gluster volume is specified like this:

file=gluster[+transport]://[server[:port]]/volname/image[?socket=...]

'gluster' is the protocol.

'transport' specifies the transport type used to connect to gluster
management daemon (glusterd). Valid transport types are
tcp, unix and rdma. If a transport type isn't specified, then tcp
type is assumed.

'server' specifies the server where the volume file specification for
the given volume resides. This can be either hostname, ipv4 address
or ipv6 address. ipv6 address needs to be within square brackets [ ].
If transport type is 'unix', then 'server' field should not be specifed.
The 'socket' field needs to be populated with the path to unix domain
socket.

'port' is the port number on which glusterd is listening. This is optional
and if not specified, QEMU will send 0 which will make gluster to use the
default port. If the transport type is unix, then 'port' should not be
specified.

'volname' is the name of the gluster volume which contains the VM image.

'image' is the path to the actual VM image that resides on gluster volume.

Examples:

file=gluster://1.2.3.4/testvol/a.img
file=gluster+tcp://1.2.3.4/testvol/a.img
file=gluster+tcp://1.2.3.4:24007/testvol/dir/a.img
file=gluster+tcp://[1:2:3:4:5:6:7:8]/testvol/dir/a.img
file=gluster+tcp://[1:2:3:4:5:6:7:8]:24007/testvol/dir/a.img
file=gluster+tcp://server.domain.com:24007/testvol/dir/a.img
file=gluster+unix:///testvol/dir/a.img?socket=/tmp/glusterd.socket
file=gluster+rdma://1.2.3.4:24007/testvol/a.img

Signed-off-by: Bharata B Rao &lt;bharata@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 6ebdcee2d8e9e4b41ffe4e49039927550848b926
      https://github.com/qemu/qemu/commit/6ebdcee2d8e9e4b41ffe4e49039927550848b926
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M block.c
    M block.h

  Log Message:
  -----------
  block: add support functions for live commit, to find and delete images.

Add bdrv_find_overlay(), and bdrv_drop_intermediate().

bdrv_find_overlay():  given 'bs' and the active (topmost) BDS of an image chain,
              find the image that is the immediate top of 'bs'

bdrv_drop_intermediate():
              Given 3 BDS (active, top, base), drop images above
              base up to and including top, and set base to be the
              backing file of top's overlay node.
               E.g., this converts:
               bottom &lt;- base &lt;- intermediate &lt;- top &lt;- active
               to
               bottom &lt;- base &lt;- active

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 747ff602636fd83daae7ee4b1dd6e8d257a89fea
      https://github.com/qemu/qemu/commit/747ff602636fd83daae7ee4b1dd6e8d257a89fea
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M block/Makefile.objs
    A block/commit.c
    M block_int.h
    M trace-events

  Log Message:
  -----------
  block: add live block commit functionality

This adds the live commit coroutine.  This iteration focuses on the
commit only below the active layer, and not the active layer itself.

The behaviour is similar to block streaming; the sectors are walked
through, and anything that exists above 'base' is committed back down
into base.  At the end, intermediate images are deleted, and the
chain stitched together.  Images are restored to their original open
flags upon completion.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 9abf2dbaf6ae990c498ec0245986bddcd6b013ea
      https://github.com/qemu/qemu/commit/9abf2dbaf6ae990c498ec0245986bddcd6b013ea
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M blockdev.c
    M trace-events

  Log Message:
  -----------
  blockdev: rename block_stream_cb to a generic block_job_cb

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 79fac5680d3680c9fb43d14a8d4e39ced25530f8
      https://github.com/qemu/qemu/commit/79fac5680d3680c9fb43d14a8d4e39ced25530f8
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M block.c
    M block.h

  Log Message:
  -----------
  block: helper function, to find the base image of a chain

This is a simple helper function, that will return the base image
of a given image chain.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: ed61fc10e8c8d2d1287f7edae92e44f5c97c540d
      https://github.com/qemu/qemu/commit/ed61fc10e8c8d2d1287f7edae92e44f5c97c540d
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M QMP/qmp-events.txt
    M blockdev.c
    M qapi-schema.json
    M qmp-commands.hx

  Log Message:
  -----------
  QAPI: add command for live block commit, 'block-commit'

The command for live block commit is added, which has the following
arguments:

device: the block device to perform the commit on (mandatory)
base:   the base image to commit into; optional (if not specified,
  it is the underlying original image)
top:    the top image of the commit - all data from inside top down
  to base will be committed into base (mandatory for now; see
  note, below)

speed:  maximum speed, in bytes/sec

Note: Eventually this command will support merging down the active layer,
      but that code is not yet complete.  If the active layer is passed
      in as top, then an error will be returned.  Once merging down the
      active layer is supported, the 'top' argument may become optional,
      and default to the active layer.

The is done as a block job, so upon completion a BLOCK_JOB_COMPLETED will
be emitted.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 747051cd97c384e70eec0ceb905f08e630b6a1c4
      https://github.com/qemu/qemu/commit/747051cd97c384e70eec0ceb905f08e630b6a1c4
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    A tests/qemu-iotests/040
    A tests/qemu-iotests/040.out
    M tests/qemu-iotests/group

  Log Message:
  -----------
  qemu-iotests: add initial tests for live block commit

Derived from the streaming test cases (030), this adds the
following 9 tests:

1. For the following image chain, commit [mid] into [backing],
   and use qemu-io to verify [backing] has its original data, as
   well as the data from [mid]
      [backing] &lt;-- [mid] &lt;-- [test]

2. Verifies that 'block-commit' with the 'speed' parameter sets the
   speed parameter, as reported by 'query-block-jobs'

3. Verifies that a bogus 'device' parameter to 'block-commit'
   results in error

4-9: Appropriate error values returned for the following argument errors:
    * top == base
    * top is nonexistent
    * base is nonexistent
    * top == active layer (this is currently not supported)
    * top and base arguments are reversed
    * top argument is omitted

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 7ef1507045d35bd4d220cf3bfe0e80e7ac101d00
      https://github.com/qemu/qemu/commit/7ef1507045d35bd4d220cf3bfe0e80e7ac101d00
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M blockdev.c
    M qerror.h

  Log Message:
  -----------
  qerror/block: introduce QERR_BLOCK_JOB_NOT_ACTIVE

The DeviceNotActive text is not a particularly good match, add
a separate text while keeping the same class.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 7e03a9342fff50f2a6a4086906fa66e6c6d4351d
      https://github.com/qemu/qemu/commit/7e03a9342fff50f2a6a4086906fa66e6c6d4351d
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M block_int.h

  Log Message:
  -----------
  block: fix documentation of block_job_cancel_sync

Do this in a separate commit before we move the functions to
blockjob.h.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 2f0c9fe64c6a2887047b7eab05cd85b2643234c8
      https://github.com/qemu/qemu/commit/2f0c9fe64c6a2887047b7eab05cd85b2643234c8
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M Makefile.objs
    M block.c
    M block.h
    M block/Makefile.objs
    M block/commit.c
    M block/stream.c
    M block_int.h
    M blockdev.c
    A blockjob.c
    A blockjob.h

  Log Message:
  -----------
  block: move job APIs to separate files

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 30e628b709fcd30db298878e435e3bc93919c48c
      https://github.com/qemu/qemu/commit/30e628b709fcd30db298878e435e3bc93919c48c
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M blockdev.c
    M blockjob.c
    M blockjob.h

  Log Message:
  -----------
  block: add block_job_query

Extract it out of the implementation of info block-jobs.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 8d65883fff22e00d70f5880a26b7a1248c59a2d8
      https://github.com/qemu/qemu/commit/8d65883fff22e00d70f5880a26b7a1248c59a2d8
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M blockjob.c
    M qapi-schema.json

  Log Message:
  -----------
  qmp: add 'busy' member to BlockJobInfo

Because pausing a job is asynchronous, we need to know whether it has
completed.  This is described by the "busy" field of BlockJob; copy it
to BlockJobInfo.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 8acc72a4d20910d522516dab31272fe66da8da28
      https://github.com/qemu/qemu/commit/8acc72a4d20910d522516dab31272fe66da8da28
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M blockdev.c
    M blockjob.c
    M blockjob.h
    M qapi-schema.json
    M qerror.h

  Log Message:
  -----------
  block: add support for job pause/resume

Job pausing reuses the existing support for cancellable sleeps.  A pause
happens at the next sleeping point and lasts until the coroutine is
re-entered explicitly.  Cancellation was already doing a forced resume,
so implement it explicitly in terms of resume.

Paused jobs cannot be canceled without first resuming them.  This ensures
that I/O errors are never missed by management.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 6e37fb811ac86739e5ed30dba3a8e4848bd21b56
      https://github.com/qemu/qemu/commit/6e37fb811ac86739e5ed30dba3a8e4848bd21b56
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M blockdev.c
    M hmp-commands.hx
    M hmp.c
    M hmp.h
    M qapi-schema.json
    M qmp-commands.hx
    M trace-events

  Log Message:
  -----------
  qmp: add block-job-pause and block-job-resume

Add QMP commands matching the functionality.

Paused jobs cannot be canceled without first resuming them.  This
ensures that I/O errors are never missed by management.  However, an
optional force argument can be specified to allow that.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 0c81734765c9af1705f8e531b9431d63ee8ffd3d
      https://github.com/qemu/qemu/commit/0c81734765c9af1705f8e531b9431d63ee8ffd3d
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M tests/qemu-iotests/030
    M tests/qemu-iotests/030.out
    M tests/qemu-iotests/group

  Log Message:
  -----------
  qemu-iotests: add test for pausing a streaming operation

These check that a paused streaming job does not advance its offset.

Sometimes the new test fails; the map is different between the source
and the destination of the streaming because qemu-io does not always
pack adjacent clusters that have the same allocated/unallocated state.
However, this also happens with the existing test_stream testcase, and
is better fixed in qemu-io.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: ff06f5f351c3b19d5cdcb8bcb9f9cc9a01cac066
      https://github.com/qemu/qemu/commit/ff06f5f351c3b19d5cdcb8bcb9f9cc9a01cac066
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M block.c
    M block.h
    M block_int.h
    M hw/ide/core.c
    M hw/scsi-disk.c
    M hw/virtio-blk.c

  Log Message:
  -----------
  iostatus: rename BlockErrorAction, BlockQMPEventAction

We want to remove knowledge of BLOCK_ERR_STOP_ENOSPC from drivers;
drivers should only be told whether to stop/report/ignore the error.
On the other hand, we want to keep using the nicer BlockErrorAction
name in the drivers.  So rename the enums, while leaving aside the
names of the enum values for now.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 92aa5c6d77ac29574c1717bcf57827fa1e586f31
      https://github.com/qemu/qemu/commit/92aa5c6d77ac29574c1717bcf57827fa1e586f31
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M block.c
    M block.h
    M block/commit.c
    M block_int.h
    M blockdev.c
    M hw/fdc.c
    M hw/ide/core.c
    M hw/scsi-disk.c
    M hw/scsi-generic.c
    M hw/virtio-blk.c
    M qapi-schema.json

  Log Message:
  -----------
  iostatus: move BlockdevOnError declaration to QAPI

This will let block-stream reuse the enum.  Places that used the enums
are renamed accordingly.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 1ceee0d5cc841fc9ca8e72b81450b598ab307f14
      https://github.com/qemu/qemu/commit/1ceee0d5cc841fc9ca8e72b81450b598ab307f14
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M block.c
    M block.h
    M blockdev.c
    M hw/ide/core.c
    M hw/ide/pci.c
    M hw/scsi-disk.c
    M hw/virtio-blk.c

  Log Message:
  -----------
  iostatus: change is_read to a bool

Do this while we are touching this part of the code, before introducing
more uses of "int is_read".

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 3e1caa5f76a9104a0d574b0f28b3dafe986a8408
      https://github.com/qemu/qemu/commit/3e1caa5f76a9104a0d574b0f28b3dafe986a8408
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M block.c
    M block.h
    M hw/ide/core.c
    M hw/scsi-disk.c
    M hw/virtio-blk.c
    M qemu-tool.c

  Log Message:
  -----------
  iostatus: reorganize io error code

Move the common part of IDE/SCSI/virtio error handling to the block
layer.  The new function bdrv_error_action subsumes all three of
bdrv_emit_qmp_error_event, vm_stop, bdrv_iostatus_set_err.

The same scheme will be used for errors in block jobs.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 32c81a4a6ecc3f50efc9c270a269e4d3d8a9fbd5
      https://github.com/qemu/qemu/commit/32c81a4a6ecc3f50efc9c270a269e4d3d8a9fbd5
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M QMP/qmp-events.txt
    M block.c
    M block_int.h
    M blockjob.c
    M blockjob.h
    M monitor.c
    M monitor.h
    M qapi-schema.json

  Log Message:
  -----------
  block: introduce block job error

The following behaviors are possible:

'report': The behavior is the same as in 1.1.  An I/O error,
respectively during a read or a write, will complete the job immediately
with an error code.

'ignore': An I/O error, respectively during a read or a write, will be
ignored.  For streaming, the job will complete with an error and the
backing file will be left in place.  For mirroring, the sector will be
marked again as dirty and re-examined later.

'stop': The job will be paused and the job iostatus will be set to
failed or nospace, while the VM will keep running.  This can only be
specified if the block device has rerror=stop and werror=stop or enospc.

'enospc': Behaves as 'stop' for ENOSPC errors, 'report' for others.

In all cases, even for 'report', the I/O error is reported as a QMP
event BLOCK_JOB_ERROR, with the same arguments as BLOCK_IO_ERROR.

It is possible that while stopping the VM a BLOCK_IO_ERROR event will be
reported and will clobber the event from BLOCK_JOB_ERROR, or vice versa.
This is not really avoidable since stopping the VM completes all pending
I/O requests.  In fact, it is already possible now that a series of
BLOCK_IO_ERROR events are reported with rerror=stop, because vm_stop
calls bdrv_drain_all and this can generate further errors.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 1d809098aa9518cda41c2cf6e660d3d602614907
      https://github.com/qemu/qemu/commit/1d809098aa9518cda41c2cf6e660d3d602614907
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M block/stream.c
    M block_int.h
    M blockdev.c
    M hmp.c
    M qapi-schema.json
    M qmp-commands.hx

  Log Message:
  -----------
  stream: add on-error argument

This patch adds support for error management to streaming.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 8f96b5be92fbd74798b97b1dc1ff5fbbe249ed11
      https://github.com/qemu/qemu/commit/8f96b5be92fbd74798b97b1dc1ff5fbbe249ed11
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M block/blkdebug.c

  Log Message:
  -----------
  blkdebug: process all set_state rules in the old state

Currently it is impossible to write a blkdebug script that ping-pongs
between two states, because the second set-state rule will use the
state that is set in the first.  If you have

    [set-state]
    event = "..."
    state = "1"
    new_state = "2"

    [set-state]
    event = "..."
    state = "2"
    new_state = "1"

for example the state will remain locked at 1.  This can be fixed
by first processing all rules, and then setting the state.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 4f45056841abced5d57485edf0ff1d2ffc042cb1
      https://github.com/qemu/qemu/commit/4f45056841abced5d57485edf0ff1d2ffc042cb1
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M tests/qemu-iotests/iotests.py

  Log Message:
  -----------
  qemu-iotests: map underscore to dash in QMP argument names

iotests.py provides a convenience function that uses Python keyword
arguments to represent QMP command arguments.  However, almost all
QMP commands use dashes for argument names (the sole exception is
block_set_io_throttle), and dashes are not allowed in a keyword
argument name.  Hence provide automatic conversion of underscores
to dashes.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 90f0b71153c6a85d03967244b9889f892841d835
      https://github.com/qemu/qemu/commit/90f0b71153c6a85d03967244b9889f892841d835
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-28 (Fri, 28 Sep 2012)

  Changed paths:
    M tests/qemu-iotests/030
    M tests/qemu-iotests/030.out
    M tests/qemu-iotests/iotests.py

  Log Message:
  -----------
  qemu-iotests: add tests for streaming error handling

Add a test for each of report/ignore/stop.  The tests use blkdebug
to generate an error in the middle of a script.  The error is
recoverable (once = "on") so that we can test resuming a job after
stopping for an error.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: bd4982a6c6f1b133aff38873bc3b580af15cd334
      https://github.com/qemu/qemu/commit/bd4982a6c6f1b133aff38873bc3b580af15cd334
  Author: Anthony PERARD &lt;anthony.perard@citrix.com&gt;
  Date:   2012-10-03 (Wed, 03 Oct 2012)

  Changed paths:
    M hw/xen_platform.c

  Log Message:
  -----------
  xen: Fix, no unplug of pt device by platform device.

The Xen platform device will unplug any NICs if requested by the guest (PVonHVM)
including a NIC that would have been passthrough. This patch makes sure that a
passthrough device will not be unplug.

Reported-by: "Zhang, Yang Z" &lt;yang.z.zhang@intel.com&gt;
Signed-off-by: Anthony PERARD &lt;anthony.perard@citrix.com&gt;
Signed-off-by: Stefano Stabellini &lt;stefano.stabellini@eu.citrix.com&gt;


  Commit: aabc8530c7ba2be89e21463f051056ad7c255e6e
      https://github.com/qemu/qemu/commit/aabc8530c7ba2be89e21463f051056ad7c255e6e
  Author: Xudong Hao &lt;xudong.hao@intel.com&gt;
  Date:   2012-10-03 (Wed, 03 Oct 2012)

  Changed paths:
    M hw/xen_pt.c
    M hw/xen_pt_config_init.c

  Log Message:
  -----------
  qemu/xen: Add 64 bits big bar support on qemu

Currently it is assumed PCI device BAR access &lt; 4G memory. If there is such a
device whose BAR size is larger than 4G, it must access &gt; 4G memory address.
This patch enable the 64bits big BAR support on qemu.

Signed-off-by: Xudong Hao &lt;xudong.hao@intel.com&gt;
Signed-off-by: Xiantao Zhang &lt;xiantao.zhang@intel.com&gt;
Signed-off-by: Stefano Stabellini &lt;stefano.stabellini@eu.citrix.com&gt;


  Commit: 39f42439d0629d3921629dc4b38e68df8f2f7b83
      https://github.com/qemu/qemu/commit/39f42439d0629d3921629dc4b38e68df8f2f7b83
  Author: Anthony PERARD &lt;anthony.perard@citrix.com&gt;
  Date:   2012-10-03 (Wed, 03 Oct 2012)

  Changed paths:
    M qapi-schema.json
    M qmp-commands.hx
    M xen-all.c
    M xen-stub.c

  Log Message:
  -----------
  QMP, Introduce xen-set-global-dirty-log command.

This command is used during a migration of a guest under Xen. It calls
memory_global_dirty_log_start or memory_global_dirty_log_stop according to the
argument pass to the command.

Signed-off-by: Anthony PERARD &lt;anthony.perard@citrix.com&gt;
Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 910b38e4dc4c37683c8b821e75a7f4cf095e4b21
      https://github.com/qemu/qemu/commit/910b38e4dc4c37683c8b821e75a7f4cf095e4b21
  Author: Anthony PERARD &lt;anthony.perard@citrix.com&gt;
  Date:   2012-10-03 (Wed, 03 Oct 2012)

  Changed paths:
    M hw/xen.h
    M xen-all.c
    M xen-stub.c

  Log Message:
  -----------
  xen: Introduce xen_modified_memory.

This function is to be used during live migration. Every write access to the
guest memory should call this funcion so the Xen tools knows which pages are
dirty.

Signed-off-by: Anthony PERARD &lt;anthony.perard@citrix.com&gt;
Acked-by: Stefano Stabellini &lt;stefano.stabellini@eu.citrix.com&gt;


  Commit: 51d7a9eb2b64e787c90bea1027308087eac22065
      https://github.com/qemu/qemu/commit/51d7a9eb2b64e787c90bea1027308087eac22065
  Author: Anthony PERARD &lt;anthony.perard@citrix.com&gt;
  Date:   2012-10-03 (Wed, 03 Oct 2012)

  Changed paths:
    M exec.c

  Log Message:
  -----------
  exec: Introduce helper to set dirty flags.

This new helper/hook is used in the next patch to add an extra call in a single
place.

Signed-off-by: Anthony PERARD &lt;anthony.perard@citrix.com&gt;
Reviewed-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: e226939de5814527a21396903b08c3d0ed989558
      https://github.com/qemu/qemu/commit/e226939de5814527a21396903b08c3d0ed989558
  Author: Anthony PERARD &lt;anthony.perard@citrix.com&gt;
  Date:   2012-10-03 (Wed, 03 Oct 2012)

  Changed paths:
    M exec-obsolete.h
    M exec.c

  Log Message:
  -----------
  exec, memory: Call to xen_modified_memory.

This patch add some calls to xen_modified_memory to notify Xen about dirtybits
during migration.

Signed-off-by: Anthony PERARD &lt;anthony.perard@citrix.com&gt;
Reviewed-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 8aba7dc02d5660df7e7d8651304b3079908358be
      https://github.com/qemu/qemu/commit/8aba7dc02d5660df7e7d8651304b3079908358be
  Author: Anthony PERARD &lt;anthony.perard@citrix.com&gt;
  Date:   2012-10-03 (Wed, 03 Oct 2012)

  Changed paths:
    M xen-all.c

  Log Message:
  -----------
  xen: Set the vram dirty when an error occur.

If the call to xc_hvm_track_dirty_vram() fails, then we set dirtybit on all the
video ram. This case happens during migration.

Signed-off-by: Anthony PERARD &lt;anthony.perard@citrix.com&gt;
Acked-by: Stefano Stabellini &lt;stefano.stabellini@eu.citrix.com&gt;


  Commit: 4be403c8158e1b6be743f0fef004310cea4e3975
      https://github.com/qemu/qemu/commit/4be403c8158e1b6be743f0fef004310cea4e3975
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M .gitignore
    M Makefile
    M Makefile.hw
    M Makefile.target
    M configure
    M cpu-common.h
    M dma.h
    M hw/hw.h
    M hw/intel-hda.c
    M hw/rtl8139.c
    M monitor.c
    M target-ppc/mmu_helper.c
    M targphys.h

  Log Message:
  -----------
  Make target_phys_addr_t 64 bits unconditionally

The hassle and compile time overhead of maintaining both 32-bit and 64-bit
capable source isn't worth the tiny performance advantage which is seen on
a minority of configurations.  Switch to compiling libhw only once, with
target_phys_addr_t unconditionally typedefed to uint64_t.

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 938406dfb11d8a40d9228b3596d49a583d7218ff
      https://github.com/qemu/qemu/commit/938406dfb11d8a40d9228b3596d49a583d7218ff
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M configure
    M hw/usb/hcd-ehci.c
    M hw/usb/hcd-xhci.c
    M hw/usb/libhw.c

  Log Message:
  -----------
  Merge remote-tracking branch 'kraxel/usb.66' into staging

* kraxel/usb.66:
  usb: Fix usb_packet_map() in the presence of IOMMUs
  usb-redir: Adjust pkg-config check for usbredirparser .pc file rename (v2)
  ehci: Fix interrupt packet MULT handling
  xhci: create a memory region for each port
  xhci: route string &amp; usb hub support
  xhci: tweak limits
  compat: turn off msi/msix on xhci for old machine types
  add pc-1.3 machine type

Conflicts:
	hw/pc_piix.c

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 6929cf11bb8ec5ff9f9e76c870c513204854a1eb
      https://github.com/qemu/qemu/commit/6929cf11bb8ec5ff9f9e76c870c513204854a1eb
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M hw/virtio-net.c
    M hw/virtio-serial-bus.c
    M hw/virtio.c
    M hw/virtio.h
    M iov.c
    M iov.h

  Log Message:
  -----------
  Merge remote-tracking branch 'mst/tags/for_anthony' into staging

* mst/tags/for_anthony:
  virtio-serial-bus: let chardev know the exact number of bytes requested
  virtio: Introduce virtqueue_get_avail_bytes()
  virtio: use unsigned int for counting bytes in vq
  iov: add const annotation
  virtio-net: fix used len for tx
  virtio: don't mark unaccessed memory as dirty


  Commit: 97f3461555b1f5d8d4e6cfc839efe215098d786d
      https://github.com/qemu/qemu/commit/97f3461555b1f5d8d4e6cfc839efe215098d786d
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    A QMP/qemu-ga-client
    M QMP/qmp.py
    M dump.c
    M hmp-commands.hx
    M hmp.c
    M hw/kvm/pci-assign.c
    M input.c
    M migration-fd.c
    M monitor.c
    M monitor.h
    M qapi-schema.json
    M qmp-commands.hx
    M qmp.c
    M scripts/qapi-types.py
    M scripts/qapi-visit.py
    M scripts/qapi.py

  Log Message:
  -----------
  Merge remote-tracking branch 'qmp/queue/qmp' into staging

* qmp/queue/qmp:
  block: live snapshot documentation tweaks
  input: index_from_key(): drop unused code
  qmp: qmp_send_key(): accept key codes in hex
  input: qmp_send_key(): simplify
  hmp: dump-guest-memory: hardcode protocol argument to "file:"
  qmp: dump-guest-memory: don't spin if non-blocking fd would block
  qmp: dump-guest-memory: improve schema doc (again)
  qapi: convert add_client
  monitor: add Error * argument to monitor_get_fd
  pci-assign: use monitor_handle_fd_param
  qapi: add "unix" to the set of reserved words
  qapi: do not protect enum values from namespace pollution
  Add qemu-ga-client script
  Support settimeout in QEMUMonitorProtocol
  Make negotiation optional in QEMUMonitorProtocol


  Commit: 05d4f2f2ca6053bfea2e97cf324901ca18e49c76
      https://github.com/qemu/qemu/commit/05d4f2f2ca6053bfea2e97cf324901ca18e49c76
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M Makefile.objs
    M QMP/qmp-events.txt
    M aio.c
    M block-migration.c
    M block.c
    M block.h
    M block/Makefile.objs
    M block/blkdebug.c
    A block/commit.c
    A block/gluster.c
    M block/stream.c
    M block_int.h
    M blockdev.c
    A blockjob.c
    A blockjob.h
    M configure
    M hmp-commands.hx
    M hmp.c
    M hmp.h
    M hw/fdc.c
    M hw/ide/core.c
    M hw/ide/pci.c
    M hw/scsi-disk.c
    M hw/scsi-generic.c
    M hw/virtio-blk.c
    M monitor.c
    M monitor.h
    M qapi-schema.json
    M qemu-tool.c
    M qerror.h
    M qmp-commands.hx
    M tests/qemu-iotests/030
    M tests/qemu-iotests/030.out
    A tests/qemu-iotests/040
    A tests/qemu-iotests/040.out
    M tests/qemu-iotests/group
    M tests/qemu-iotests/iotests.py
    M trace-events
    A uri.c
    A uri.h

  Log Message:
  -----------
  Merge remote-tracking branch 'kwolf/for-anthony' into staging

* kwolf/for-anthony: (30 commits)
  qemu-iotests: add tests for streaming error handling
  qemu-iotests: map underscore to dash in QMP argument names
  blkdebug: process all set_state rules in the old state
  stream: add on-error argument
  block: introduce block job error
  iostatus: reorganize io error code
  iostatus: change is_read to a bool
  iostatus: move BlockdevOnError declaration to QAPI
  iostatus: rename BlockErrorAction, BlockQMPEventAction
  qemu-iotests: add test for pausing a streaming operation
  qmp: add block-job-pause and block-job-resume
  block: add support for job pause/resume
  qmp: add 'busy' member to BlockJobInfo
  block: add block_job_query
  block: move job APIs to separate files
  block: fix documentation of block_job_cancel_sync
  qerror/block: introduce QERR_BLOCK_JOB_NOT_ACTIVE
  qemu-iotests: add initial tests for live block commit
  QAPI: add command for live block commit, 'block-commit'
  block: helper function, to find the base image of a chain
  ...


  Commit: a14c74928ba1fdaada515717f4d3c3fa3275d6f7
      https://github.com/qemu/qemu/commit/a14c74928ba1fdaada515717f4d3c3fa3275d6f7
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M exec-obsolete.h
    M exec.c
    M hw/xen.h
    M hw/xen_platform.c
    M hw/xen_pt.c
    M hw/xen_pt_config_init.c
    M qapi-schema.json
    M qmp-commands.hx
    M xen-all.c
    M xen-stub.c

  Log Message:
  -----------
  Merge remote-tracking branch 'sstabellini/xen-2012-10-03' into staging

* sstabellini/xen-2012-10-03:
  xen: Set the vram dirty when an error occur.
  exec, memory: Call to xen_modified_memory.
  exec: Introduce helper to set dirty flags.
  xen: Introduce xen_modified_memory.
  QMP, Introduce xen-set-global-dirty-log command.
  qemu/xen: Add 64 bits big bar support on qemu
  xen: Fix, no unplug of pt device by platform device.


Compare: https://github.com/qemu/qemu/compare/e744c06fca43...a14c74928ba1

----==_mimepart_506e46399d0fb_187516efaf47314f--


</body></email><email><emailId>20121005213016</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-05 21:30:16-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] a5cf82: scsi, pci, qdev, isa-bus, sysbus: don't let *_get_...</subject><body>



----==_mimepart_506f51684ad1_423de58ae44295a
Date: Fri, 05 Oct 2012 14:30:16 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;506f5168a3a1_423de58ae4430d2@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: a5cf8262e4eb9c4646434e2c6211ef8608db3233
      https://github.com/qemu/qemu/commit/a5cf8262e4eb9c4646434e2c6211ef8608db3233
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M hw/ide/qdev.c
    M hw/isa-bus.c
    M hw/pci.c
    M hw/qdev.c
    M hw/scsi-bus.c
    M hw/sysbus.c

  Log Message:
  -----------
  scsi, pci, qdev, isa-bus, sysbus: don't let *_get_fw_dev_path return NULL

Use g_strdup rather than strdup, because the sole caller
(qdev_get_fw_dev_path_helper) assumes it gets non-NULL, and dereferences
it.  Besides, in that caller, the allocated buffer is already freed with
g_free, so it's better to allocate with a matching g_strdup.

In one case, (scsi-bus.c) it was trivial, so I replaced an snprintf+
g_strdup combination with an equivalent g_strdup_printf use.

Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: bfad67399bcca8c1afbbc93593d365044d92f7c6
      https://github.com/qemu/qemu/commit/bfad67399bcca8c1afbbc93593d365044d92f7c6
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M target-sparc/cpu.c

  Log Message:
  -----------
  sparc: use g_strdup in place of unchecked strdup

This avoids a NULL-deref upon strdup failure.
Also update matching free to g_free.

Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: c2cba3d9314f972dfaf724d0ec2d018eb54c95f1
      https://github.com/qemu/qemu/commit/c2cba3d9314f972dfaf724d0ec2d018eb54c95f1
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M block.c

  Log Message:
  -----------
  block: avoid buffer overrun by using pstrcpy, not strncpy

Also, use PATH_MAX, rather than the arbitrary 1024.
Using PATH_MAX is more consistent with other filename-related
variables in this file, like backing_filename and tmp_filename.

Acked-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 3178e2755ec5a7fb1afe583fb6ac2622c2c42184
      https://github.com/qemu/qemu/commit/3178e2755ec5a7fb1afe583fb6ac2622c2c42184
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M block/sheepdog.c

  Log Message:
  -----------
  sheepdog: avoid a few buffer overruns

* parse_vdiname: Use pstrcpy, not strncpy, when the destination
buffer must be NUL-terminated.
* sd_open: Likewise, avoid buffer overrun.
* do_sd_create: Likewise.  Leave the preceding memset, since
pstrcpy does not NUL-fill, and filename needs that.
* sd_snapshot_create: Add a comment/question.
* find_vdi_name: Remove a useless memset.
* sd_snapshot_goto: Remove a useless memset.
Use pstrcpy to NUL-terminate, because find_vdi_name requires
that its vdi arg (filename parameter) be NUL-terminated.
It seems ok not to NUL-fill the buffer.
Do the same for snapid: remove useless memset-0 (instead,
zero tag[0]).  Use pstrcpy, not strncpy.
* sd_snapshot_list: Use pstrcpy, not strncpy to write
into the -&gt;name member.  Each must be NUL-terminated.

Acked-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Acked-by: MORITA Kazutaka &lt;morita.kazutaka@lab.ntt.co.jp&gt;
Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: d66f8e7bd3de4a2ecf0680c635f870f2138425b8
      https://github.com/qemu/qemu/commit/d66f8e7bd3de4a2ecf0680c635f870f2138425b8
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M block/vmdk.c

  Log Message:
  -----------
  vmdk: relative_path: use pstrcpy in place of strncpy

Avoid strncpy+manual-NUL-terminate.  Use pstrcpy instead.

Acked-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: a79b5f8b80890b402fdb0733b0a073695a7875b5
      https://github.com/qemu/qemu/commit/a79b5f8b80890b402fdb0733b0a073695a7875b5
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M hw/9pfs/virtio-9p-synth.c

  Log Message:
  -----------
  hw/9pfs: avoid buffer overrun

v9fs_add_dir_node and qemu_v9fs_synth_add_file used strncpy
to form node-&gt;name, which requires NUL-termination, but
strncpy does not ensure NUL-termination.
Use pstrcpy, which does.

Acked-by: Aneesh Kumar K.V &lt;aneesh.kumar@linux.vnet.ibm.com&gt;
Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 1044dc1118d9a90e2aa324047bea9c91c889e28f
      https://github.com/qemu/qemu/commit/1044dc1118d9a90e2aa324047bea9c91c889e28f
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M hw/lm32_hwsetup.h

  Log Message:
  -----------
  lm32: avoid buffer overrun

Actually do what the comment says, using pstrcpy NUL-terminate:
strncpy does not always do that.

Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 3eadc68ebd174f5bad51fe6e0bbcf6d6651c784c
      https://github.com/qemu/qemu/commit/3eadc68ebd174f5bad51fe6e0bbcf6d6651c784c
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M os-posix.c

  Log Message:
  -----------
  os-posix: avoid buffer overrun

os_set_proc_name: Use pstrcpy, in place of strncpy and the
ineffectual preceding assignment: name[sizeof(name) - 1] = 0;

Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: ae2150680190e510dcbcdfdbfb3a54369c75367f
      https://github.com/qemu/qemu/commit/ae2150680190e510dcbcdfdbfb3a54369c75367f
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M target-ppc/kvm.c

  Log Message:
  -----------
  ppc: avoid buffer overrun: use pstrcpy, not strncpy

A terminal NUL is required by caller's use of strchr.
It's better not to use strncpy at all, since there is no need
to zero out hundreds of trailing bytes for each iteration.

Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 900cfbcac6fa689b5fc8d53b60c3ed39047b8a33
      https://github.com/qemu/qemu/commit/900cfbcac6fa689b5fc8d53b60c3ed39047b8a33
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M linux-user/elfload.c

  Log Message:
  -----------
  linux-user: remove two unchecked uses of strdup

Remove two uses of strdup (use g_path_get_basename instead),
and add a comment that this strncpy use is ok.

Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 5847d9e1399d3497be8eeca6f3a20a18a40b114b
      https://github.com/qemu/qemu/commit/5847d9e1399d3497be8eeca6f3a20a18a40b114b
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M ui/vnc-auth-sasl.c

  Log Message:
  -----------
  ui/vnc: simplify and avoid strncpy

Don't bother with strncpy.  There's no need for its zero-fill.
Use g_strndup in place of g_malloc+strncpy+NUL-terminate.

Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: e5fda03839e3c61b01d6c60de5625501d01c69d0
      https://github.com/qemu/qemu/commit/e5fda03839e3c61b01d6c60de5625501d01c69d0
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M hw/bt-hci.c

  Log Message:
  -----------
  bt: replace fragile snprintf use and unwarranted strncpy

In bt_hci_name_req a failed snprintf could return len larger than
sizeof(params.name), which means the following memset call would
have a "length" value of (size_t)-1, -2, etc...  Sounds scary.
But currently, one can deduce that there is no problem:
strlen(slave-&gt;lmp_name) is guaranteed to be smaller than
CHANGE_LOCAL_NAME_CP_SIZE, which is the same as sizeof(params.name),
so this cannot happen.  Regardless, there is no justification for
using snprintf+memset.  Use pstrcpy instead.

Also, in bt_hci_event_complete_read_local_name, use pstrcpy in place
of unwarranted strncpy.

Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 9238c2099d37748a4e2cbbe709ed1ebffa6f3c8b
      https://github.com/qemu/qemu/commit/9238c2099d37748a4e2cbbe709ed1ebffa6f3c8b
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M hw/9pfs/virtio-9p-posix-acl.c
    M hw/9pfs/virtio-9p-xattr-user.c
    M hw/9pfs/virtio-9p-xattr.c

  Log Message:
  -----------
  virtio-9p: avoid unwarranted uses of strncpy

In all of these cases, the uses of strncpy were unnecessary, since
at each point of use we know that the NUL-terminated source bytes
fit in the destination buffer.  Use memcpy in place of strncpy.

Acked-by: Aneesh Kumar K.V &lt;aneesh.kumar@linux.vnet.ibm.com&gt;
Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 9d055d8ac83cfd590263e8862ff683f705dfdf56
      https://github.com/qemu/qemu/commit/9d055d8ac83cfd590263e8862ff683f705dfdf56
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M hw/spapr_vscsi.c

  Log Message:
  -----------
  vscsi: avoid unwarranted strncpy

Don't use strncpy when the source string is known to fit
in the destination buffer.  Use equivalent memcpy.
We could even use strcpy, here, but some static analyzers
warn about that, so don't add new uses.

Acked-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 1ab516ed9b6ba00bafc5ca37604f8af4680323ca
      https://github.com/qemu/qemu/commit/1ab516ed9b6ba00bafc5ca37604f8af4680323ca
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M qga/commands-posix.c

  Log Message:
  -----------
  qemu-ga: prefer pstrcpy: consistently NUL-terminate ifreq.ifr_name

NUL-termination of the .ifr_name field is not required, but is fine
(and preferable to using strncpy and leaving the reader to wonder),
since the first thing the linux kernel does is to clear the last byte.
Besides, using pstrcpy here makes this setting of ifr_name consistent
with the other code (e.g., net/tap-linux.c) that does the same thing.

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 2e679780ae86c6ca8bc81efe0a376a0b99b09b8f
      https://github.com/qemu/qemu/commit/2e679780ae86c6ca8bc81efe0a376a0b99b09b8f
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M libcacard/Makefile
    M libcacard/vcard_emul_nss.c

  Log Message:
  -----------
  libcacard/vcard_emul_nss: use pstrcpy in place of strncpy

Replace strncpy+NUL-terminate use with use of pstrcpy.
This requires linking with cutils.o (or else vssclient doesn't link),
so add that in the Makefile.

Acked-by: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 3cda346269784c234c7a296ff6851f36a1a9189d
      https://github.com/qemu/qemu/commit/3cda346269784c234c7a296ff6851f36a1a9189d
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M hw/acpi.c

  Log Message:
  -----------
  acpi: remove strzcpy (strncpy-identical) function; just use strncpy

Adjust all uses s/strzcpy/strncpy/ and mark these uses
of strncpy as "ok".

Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 00ea188125f6ee33e6beaff5da878fa9478e6a0d
      https://github.com/qemu/qemu/commit/00ea188125f6ee33e6beaff5da878fa9478e6a0d
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M block/qcow2.c

  Log Message:
  -----------
  qcow2: mark this file's sole strncpy use as justified

Acked-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 9310b9be14f73d4c1e98bfa315fe84326ad9e8e7
      https://github.com/qemu/qemu/commit/9310b9be14f73d4c1e98bfa315fe84326ad9e8e7
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M hw/r2d.c

  Log Message:
  -----------
  hw/r2d: add comment: this strncpy use is ok

Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 9b9e3ec1b47f615f635055924e24705cc3f45b20
      https://github.com/qemu/qemu/commit/9b9e3ec1b47f615f635055924e24705cc3f45b20
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M HACKING

  Log Message:
  -----------
  doc: update HACKING wrt strncpy/pstrcpy

Reword the section on strncpy: its NUL-filling is important
in some cases.  Mention that pstrcpy's signature is different.

Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 610b823ef66b993660f1ab1447a769f190e4f3b3
      https://github.com/qemu/qemu/commit/610b823ef66b993660f1ab1447a769f190e4f3b3
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M qemu-barrier.h

  Log Message:
  -----------
  qemu-barrier: Fix compiler version check for future gcc versions

The current check will give a wrong result for gcc-5.x with x &lt; 4.
Using QEMU_GNUC_PREREQ is simpler and fixes that issue.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: e0fea6b1e4df2067a51e08e67a17cb98a547287c
      https://github.com/qemu/qemu/commit/e0fea6b1e4df2067a51e08e67a17cb98a547287c
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M tests/libqtest.c

  Log Message:
  -----------
  qtest: implement QTEST_STOP

It is quite difficult to debug qtest test cases without extra wrapper
scripts for QEMU or similar.  This patch adds a simple environment
variable-based trigger that sends a STOP signal to the QEMU instance
under test, before attempting to connect to its QMP session.

This will block execution of the testcase and give time to attach a
debugger to the stopped QEMU process.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: b6db4aca20e9af4f62c9c9e08b9b9672a6ed3390
      https://github.com/qemu/qemu/commit/b6db4aca20e9af4f62c9c9e08b9b9672a6ed3390
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M cutils.c
    M tests/rtc-test.c

  Log Message:
  -----------
  rtc: fix overflow in mktimegm

When setting a date in 1980, Linux is actually disregarding the century
byte and setting the year to 2080.  This causes a year-2038 overflow
in mktimegm.  Fix this by doing the days-to-seconds computation in
64-bit math.

Reported-by: Lucas Meneghel Rodrigues &lt;lookkas@gmail.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: e67edb943f0c812530aaae2491da56f9542f928b
      https://github.com/qemu/qemu/commit/e67edb943f0c812530aaae2491da56f9542f928b
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M hw/mc146818rtc.c
    M hw/mc146818rtc_regs.h

  Log Message:
  -----------
  rtc: map CMOS index 0x37 to 0x32 on read and writes

QEMU's attempt to implement the century byte cover two possible places
for the byte.  A common one on modern chipsets is 0x32, but QEMU also
stores the value in 0x37 (apparently for IBM PS/2 compatibility---it's
only been 25 years).  To simplify the implementation of the century
byte, store it only at 0x32 but remap transparently 0x37 to 0x32 when
reading and writing from CMOS.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: b8994faf2a8d6fc791669bb432bdb3a7a1711013
      https://github.com/qemu/qemu/commit/b8994faf2a8d6fc791669bb432bdb3a7a1711013
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M hw/mc146818rtc.c
    M tests/rtc-test.c

  Log Message:
  -----------
  rtc: implement century byte

Implement the century byte in the RTC emulation, and test that it works.
This leads to some annoying compatibility code because we need to treat
a value of 2000 for the base_year property as "use the century byte
properly" (which would be a value of 0).

The century byte will now be always-zero, rather than always-20,
for the MIPS Magnum machine whose base_year is 1980.  Commit 42fc73a
(Support epoch of 1980 in RTC emulation for MIPS Magnum, 2009-01-24)
correctly said:

    With an epoch of 1980 and a year of 2009, one could argue that [the
    century byte] should hold either 0, 1, 19 or 20.  NT 3.50 on MIPS
    does not read the century byte.

so I picked the simplest and most sensible implementation which is to
return 0 for 1980-2079, 1 for 2080-2179 and so on.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: c9159fe9aa9abe24115ea4d16127179e9cb07e22
      https://github.com/qemu/qemu/commit/c9159fe9aa9abe24115ea4d16127179e9cb07e22
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M .gitignore
    M Makefile
    R Makefile.hw
    M Makefile.objs
    M Makefile.target
    M configure
    M hw/9pfs/Makefile.objs
    M hw/Makefile.objs
    M hw/ide/Makefile.objs
    M hw/usb/Makefile.objs

  Log Message:
  -----------
  Remove libhw

The entries for libhw* are no longer needed in .gitignore.

There is also no longer a difference between common-obj-y and
hw-obj-y, so one of those two macros is sufficient.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/a14c74928ba1...c9159fe9aa9a

----==_mimepart_506f51684ad1_423de58ae44295a--


</body></email><email><emailId>20121006190016</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-06 19:00:16-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 8a269c: MAINTAINERS: Document sPAPR (pSeries) machine</subject><body>



----==_mimepart_50707fc09ca3e_1d6416aaae4820d
Date: Sat, 06 Oct 2012 12:00:16 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50707fc09dba5_1d6416aaae4821b9@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 8a269ca4167b43cbf1acaf51929f3f5919edcd1e
      https://github.com/qemu/qemu/commit/8a269ca4167b43cbf1acaf51929f3f5919edcd1e
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M MAINTAINERS

  Log Message:
  -----------
  MAINTAINERS: Document sPAPR (pSeries) machine

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Acked-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 98cded3a05de6a3295e89cc149ff267f1619bdc4
      https://github.com/qemu/qemu/commit/98cded3a05de6a3295e89cc149ff267f1619bdc4
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M MAINTAINERS

  Log Message:
  -----------
  MAINTAINERS: Document e500 machines and devices

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Cc: Alexander Graf &lt;agraf@suse.de&gt;
Cc: Scott Wood &lt;scottwood@freescale.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 9b9fe13540d2375a109c1d17b53d240a592e442d
      https://github.com/qemu/qemu/commit/9b9fe13540d2375a109c1d17b53d240a592e442d
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M MAINTAINERS

  Log Message:
  -----------
  MAINTAINERS: Downgrade ppc405 to Odd Fixes

As requested by Alex.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: aaade8d7d4d2a3d9b7fb99b198369b1b35a75450
      https://github.com/qemu/qemu/commit/aaade8d7d4d2a3d9b7fb99b198369b1b35a75450
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M MAINTAINERS

  Log Message:
  -----------
  MAINTAINERS: Document Bamboo machine and ppc4xx devices

Place it in alphabetical order and add new Devices section ppc4xx to
share file rules with 405 and virtex_ml507.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 794d00bfc7c38cfc559fbec137ecd0117b40e77b
      https://github.com/qemu/qemu/commit/794d00bfc7c38cfc559fbec137ecd0117b40e77b
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M MAINTAINERS

  Log Message:
  -----------
  MAINTAINERS: Document virtex_ml507 machine

Place it in alphabetical order, there is a separate section for sharing
ppc4xx devices now.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Acked-by: Edgar E. Iglesias &lt;edgar.iglesias@gmail.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: ef9bd1507b60edba0619e16f1179b158eac2c3ac
      https://github.com/qemu/qemu/commit/ef9bd1507b60edba0619e16f1179b158eac2c3ac
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M target-ppc/int_helper.c

  Log Message:
  -----------
  target-ppc: simplify NaN propagation for vector functions

Commit e024e881bb1a8b5085026589360d26ed97acdd64 provided a pickNaN()
function for PowerPC, implementing the correct NaN propagation rules.
Therefore there is no need to test the operands manually, we can rely
on the softfloat code to do that.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: db1babb8dbb6d18433a51f1b4c3d186ea7057a6f
      https://github.com/qemu/qemu/commit/db1babb8dbb6d18433a51f1b4c3d186ea7057a6f
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M target-ppc/int_helper.c

  Log Message:
  -----------
  target-ppc: use the softfloat min/max functions

Use the new softfloat float32_min() and float32_max() to implement the
vminfp and vmaxfp instructions. As a bonus we can get rid of the call to
the HANDLE_NAN2 macro, as the NaN handling is directly done at the
softfloat level.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 2f93c23fe71420e5095f2fae1877fe747ad9f876
      https://github.com/qemu/qemu/commit/2f93c23fe71420e5095f2fae1877fe747ad9f876
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M target-ppc/int_helper.c

  Log Message:
  -----------
  target-ppc: use the softfloat float32_muladd function

Use the new softfloat float32_muladd() function to implement the vmaddfp
and vnmsubfp instructions. As a bonus we can get rid of the call to the
HANDLE_NAN3 macro, as the NaN handling is directly done at the softfloat
level.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 89243b3b0183471a373d1457e7f93811773b64a7
      https://github.com/qemu/qemu/commit/89243b3b0183471a373d1457e7f93811773b64a7
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M target-ppc/int_helper.c

  Log Message:
  -----------
  target-ppc: get rid of the HANDLE_NAN{1, 2, 3} macros

We can finally get rid of the ugly HANDLE_NAN{1,2,3} macros.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: f1af19d767073a0926ce12c19b1f06c4933bca35
      https://github.com/qemu/qemu/commit/f1af19d767073a0926ce12c19b1f06c4933bca35
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M target-ppc/kvm.c

  Log Message:
  -----------
  ppc: Make kvm_arch_put_registers() put *all* the registers

At least when invoked with high enough 'level' arguments,
kvm_arch_put_registers() is supposed to copy essentially all the cpu state
as encoded in qemu's internal structures into the kvm state.  Currently
the ppc version does not do this - it never calls KVM_SET_SREGS, for
example, and therefore never sets the SDR1 and various other important
though rarely changed registers.

Instead, the code paths which need to set these registers need to
explicitly make (conditional) kvm calls which transfer the changes to kvm.
This breaks the usual model of handling state updates in qemu, where code
just changes the internal model and has it flushed out to kvm automatically
at some later point.

This patch fixes this for Book S ppc CPUs by adding a suitable call to
KVM_SET_SREGS and als to KVM_SET_ONE_REG to set the HIOR (the only register
that is set with that call so far).  This lets us remove the hacks to
explicitly set these registers from the kvmppc_set_papr() function.

The problem still exists for Book E CPUs (which use a different version of
the kvm_sregs structure).  But fixing that has some complications of its
own so can be left to another day.

Lkewise, there is still some ugly code for setting the PVR through special
calls to SET_SREGS which is left in for now.  The PVR needs to be set
especially early because it can affect what other features are available
on the CPU, so I need to do more thinking to see if it can be integrated
into the normal paths or not.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 048706d971c1830d7813052ca027ae00c519e894
      https://github.com/qemu/qemu/commit/048706d971c1830d7813052ca027ae00c519e894
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M hw/spapr.c
    M hw/spapr_rtas.c

  Log Message:
  -----------
  pseries: Fix and cleanup CPU initialization and reset

The current pseries machine init function iterates over the CPUs at several
points, doing various bits of initialization.  This is messy; these can
and should be merged into a single iteration doing all the necessary per
cpu initialization.  Worse, some of these initializations were setting up
state which should be set on every reset, not just at machine init time.
A few of the initializations simply weren't necessary at all.

This patch, therefore, moves those things that need to be to the
per-cpu reset handler, and combines the remainder into two loops over
the cpus (which also creates them).  The second loop is for setting up
hash table information, and will be removed in a subsequent patch also
making other fixes to the hash table setup.

This exposes a bug in our start-cpu RTAS routine (called by the guest to
start up CPUs other than CPU0) under kvm.  Previously, this function did
not make a call to ensure that it's changes to the new cpu's state were
pushed into KVM in-kernel state.  We sort-of got away with this because
some of the initializations had already placed the secondary CPUs into the
right starting state for the sorts of Linux guests we've been running.

Nonetheless the start-cpu RTAS call's behaviour was not correct and could
easily have been broken by guest changes.  This patch also fixes it.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: c8787ad477f3be5a971b877dcb1bae5752c5796a
      https://github.com/qemu/qemu/commit/c8787ad477f3be5a971b877dcb1bae5752c5796a
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M hw/spapr.c

  Log Message:
  -----------
  pseries: Use new method to correct reset sequence

A number of things need to occur during reset of the PAPR
paravirtualized platform in a specific order.  For example, the hash
table needs to be cleared before the CPUs are reset, so that they
initialize their register state correctly, and the CPUs need to have
their main reset called before we set up the entry point state on the
boot cpu.  We also need to have the main qdev reset happen before the
creation and installation of the device tree for the new boot, because
we need the state of the devices settled to correctly construct the
device tree.

We currently do the pseries once-per-reset initializations done from a
reset handler.  However we can't adequately control when this handler
is called during the reset - in particular we can't guarantee it
happens after all the qdev resets (since qdevs might be registered
after the machine init function has executed).

This patch uses the new QEMUMachine reset method to to fix this
problem, ensuring the various order dependent reset steps happen in
the correct order.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 7f763a5d994bbddb50705d2e50decdf52937521f
      https://github.com/qemu/qemu/commit/7f763a5d994bbddb50705d2e50decdf52937521f
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M hw/spapr.c
    M hw/spapr.h
    M target-ppc/kvm.c
    M target-ppc/kvm_ppc.h

  Log Message:
  -----------
  pseries: Add support for new KVM hash table control call

This adds support for then new "reset htab" ioctl which allows qemu
to properly cleanup the MMU hash table when the guest is reset. With
the corresponding kernel support, reset of a guest now works properly.

This also paves the way for indicating a different size hash table
to the kernel and for the kernel to be able to impose limits on
the requested size.

Signed-off-by: Benjamin Herrenschmidt &lt;benh@kernel.crashing.org&gt;
Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 4dd96f244f62d5e4b493c1f4071c0d4a4a57474d
      https://github.com/qemu/qemu/commit/4dd96f244f62d5e4b493c1f4071c0d4a4a57474d
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M hw/spapr_vio.c

  Log Message:
  -----------
  pseries: Clear TCE and signal state when resetting PAPR VIO devices

When we reset the system, the reset method for VIO bus devices resets
the state of their request queue (if present) as it should.  However
it was not resetting the state of their TCE table (DMA translation) if
present.  It was also not resetting the state of the per-device signal
mask set with H_VIO_SIGNAL.  This patch corrects both bugs, and also
removes some small code duplication in the reset paths.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: eddeed26ac83392053aef823a341f643ea8e3d2f
      https://github.com/qemu/qemu/commit/eddeed26ac83392053aef823a341f643ea8e3d2f
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M hw/spapr.h
    M hw/spapr_iommu.c
    M hw/spapr_pci.c

  Log Message:
  -----------
  pseries: Reset emulated PCI TCE tables on system reset

The emulated PCI host bridge on the pseries machine incorporates an IOMMU
(PAPR TCE table).  Currently the mappings in this IOMMU are not cleared
when we reset the system.  This patch fixes this bug.  To do this it adds
a new reset function to the IOMMU emulation code.  The VIO devices already
reset their TCE tables, but they do so by destroying and re-creating their
DMA context.  This doesn't work for the PCI host bridge, because the
infrastructure for PCI IOMMUs has already copied/cached the DMA pointer
context into the subordinate PCI device structures.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 256b408abea2cfe18d8c0278e5b46213509db271
      https://github.com/qemu/qemu/commit/256b408abea2cfe18d8c0278e5b46213509db271
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M hw/xics.c

  Log Message:
  -----------
  pseries: Fix XICS reset

The XICS interrupt controller used on the pseries machine currently has no
reset handler.  We can get away with this under some circumstances, but
it's not correct, and can cause failures if the XICS happens to be in the
wrong state at the time of reset.

This patch adds a hook to properly reset the XICS state.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 1dd088946cf464a994bc93945a360aef049493af
      https://github.com/qemu/qemu/commit/1dd088946cf464a994bc93945a360aef049493af
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M hw/spapr_hcall.c

  Log Message:
  -----------
  pseries: Small cleanup to H_CEDE implementation

The H_CEDE hypercall implementation for the pseries machine doesn't trigger
quite the right path in the main cpu exec loop.  We should set exit_request
to pop up one extra level and recheck state, and we should set the
exception_index to EXCP_HLT (H_CEDE is roughly equivalent to the hlt
instruction on x86).

In practice, this doesn't really matter except for KVM, and KVM implements
H_CEDE internally so we never hit this code path.  But we might as well
get it right, just in case it matters some day.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 98ca8c023825fc6dd99e6cea1956d84ed8cadb3a
      https://github.com/qemu/qemu/commit/98ca8c023825fc6dd99e6cea1956d84ed8cadb3a
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M hw/xics.c

  Log Message:
  -----------
  pseries: Remove C bitfields from xics code

The XICS interrupt controller emulation uses some C bitfield variables in
its internal state structure.  This makes like awkward for saving the state
because we don't have easy VMSTATE helpers for bitfields.

This patch removes the bitfields, instead using explicit bit masking in a
single status variable.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: ff9d2afa618acd81d926c9c213b4ff5f7163db1d
      https://github.com/qemu/qemu/commit/ff9d2afa618acd81d926c9c213b4ff5f7163db1d
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M hw/spapr.c
    M hw/spapr.h
    M hw/spapr_pci.c
    M hw/xics.c
    M hw/xics.h

  Log Message:
  -----------
  pseries: Remove XICS irq type enum type

Currently the XICS interrupt controller emulation uses a custom enum to
specify whether a given interrupt is level-sensitive or message-triggered.
This enum makes life awkward for saving the state, and isn't particularly
useful since there are only two possibilities.  This patch replaces the
enum with a simple bool.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 490d4a2b6edafb27cd688ded7fdb1290453d71b0
      https://github.com/qemu/qemu/commit/490d4a2b6edafb27cd688ded7fdb1290453d71b0
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M hw/spapr_vio.h

  Log Message:
  -----------
  pseries: Remove never used flags field from spapr vio devices

The general device state structure for PAPR VIO emulated devices includes a
'flags' field which was never used.  This patch removes it.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 53724ee565565f69560dbe17553bede8c0169379
      https://github.com/qemu/qemu/commit/53724ee565565f69560dbe17553bede8c0169379
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M hw/spapr.h
    M hw/spapr_iommu.c
    M hw/spapr_vio.c
    M hw/spapr_vio.h

  Log Message:
  -----------
  pseries: Rework implementation of TCE bypass

On the pseries machine the IOMMU (aka TCE tables) is always active for all
PCI and VIO devices.  Mostly to simplify the SLOF firmware, we implement an
extension which allows the IOMMU to be temporarily disabled for certain
devices.

Currently this is implemented by setting the device's DMAContext pointer to
NULL (thus reverting to qemu's default no-IOMMU DMA behaviour), then
replacing it when bypass mode is disabled.

This approach causes a bunch of complications though.  It complexifies the
management of the DMAContext lifetimes, it's problematic for savevm/loadvm,
and it means that while bypass is active we have nowhere to store the
device's LIOBN (Logical IO Bus Number, used to identify DMA address
spaces).  At present we regenerate the LIOBN from other address information
but this restricts how we can allocate LIOBNs.

This patch gives up on this approach, replacing it with the much simpler
one of having a 'bypass' boolean flag in the TCE state structure.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 3fe719f467530b7c8ac0797881ff4b66d1357c18
      https://github.com/qemu/qemu/commit/3fe719f467530b7c8ac0797881ff4b66d1357c18
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M hw/xics.c

  Log Message:
  -----------
  pseries: Fix semantics of RTAS int-on, int-off and set-xive functions

Currently the ibm,int-on and ibm,int-off RTAS functions are implemented as
no-ops.  This is because when implemented as specified in PAPR they caused
Linux (which calls both int-on/off and set-xive) to end up with interrupts
masked when they should not be.  Since Linux's set-xive calls make the
int-on/off calls redundant, making them nops worked around the problem.

In fact, the problem was caused because there was a subtle bug in set-xive,
PAPR specifies that as well as updating the current priority, it also needs
to update the saved priority used by int-on/off.  With this bug fixed the
problem goes away.  This patch implements this more correct fix.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: ace9a2cbac9b2949aadc176ffa83a1d2a0873e2c
      https://github.com/qemu/qemu/commit/ace9a2cbac9b2949aadc176ffa83a1d2a0873e2c
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M target-ppc/kvm.c

  Log Message:
  -----------
  target-ppc: KVM: Fix some kernel version edge cases for kvmppc_reset_htab()

The kvmppc_reset_htab() function invokes the KVM_PPC_ALLOCATE_HTAB vm ioctl
to request KVM to allocate and reset a hash page table for the guest - it
returns the size of hash table allocated, or 0 to indicate that qemu needs
to allocate the hash table itself.  In practice qemu needs to allocate the
htab for full emulation and with Book3sPR KVM, but the kernel has to
allocate it for Book3sHV KVM (the hash table needs to be physically
contiguous in that case).

Unfortunately, the logic in this function is incorrect for some existing
kernels.  Specifically:
  * at least some PR KVM versions advertise the relevant capability but
don't actually implement the ioctl(), returning ENOTTY.
  * For old kernels which don't have the capability, we currently return 0.
This is correct for PV KVM, where we need to allocate the htab, but not for
HV KVM - kernels of this era always allocate a 16MB hash table per guest.

This patch corrects both of these edge cases.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 5a1972c8472fafd519a68b689fdcaf33ec857945
      https://github.com/qemu/qemu/commit/5a1972c8472fafd519a68b689fdcaf33ec857945
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M hw/ppc405_uc.c

  Log Message:
  -----------
  ppc405_uc: Fix buffer overflow

Report from smatch:

ppc405_uc.c:209 dcr_read_pob(12) error: buffer overflow 'pob-&gt;besr' 2 &lt;= 2
ppc405_uc.c:232 dcr_write_pob(12) error: buffer overflow 'pob-&gt;besr' 2 &lt;= 2

The old code reads and writes besr[POB0_BESR1 - POB0_BESR0] or besr[2]
which is one too much.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 35f9304d925a5423c51bd2c83a81fa3cc2b6e680
      https://github.com/qemu/qemu/commit/35f9304d925a5423c51bd2c83a81fa3cc2b6e680
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M hw/spapr_hcall.c

  Log Message:
  -----------
  pseries: Remove unnecessary locking from PAPR hash table hcalls

In the paravirtualized environment provided by PAPR, there is a standard
locking scheme so that hypercalls updating the hash page table from
different guest threads don't corrupt the haah table state.  We implement
this HVLOCK bit in out page table hypercalls.  However, it is not necessary
in our case, since the hypercalls all run in the qemu environment under the
big qemu lock.

Therefore, this patch removes the locking code.  This has the additional
advantage of freeing up a hash PTE bit which will be useful for migration
support.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 382be75df77142cf6bdc7f5852738029eeb9e23a
      https://github.com/qemu/qemu/commit/382be75df77142cf6bdc7f5852738029eeb9e23a
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M hw/spapr.c

  Log Message:
  -----------
  pseries: Set hash table size based on RAM size

Currently the pseries machine code always attempts to set the size of the
guests's hash page table to 16MB.  However, because of the way the POWER
MMU works, a suitable hash page table size should really depend on memory
size.  16MB will be excessive for guests with &lt;1GB and RAM, and may not be
enough for guests with &gt;2GB of RAM (depending on guest page size and
other factors).

The usual given rule of thumb is that the hash table should be 1/64 of
the size of memory, but in fact the Linux guests we are aiming at don't
really need that much.  This patch, therefore, changes the hash table
allocation code to aim for 1/128 of the size of RAM (rounding up).  When
using KVM, this size may still be adjusted by the host kernel if it is
unable to allocate a suitable (contiguous) table.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 011aba24ed73000e126dd1bb90a6bea2afd91649
      https://github.com/qemu/qemu/commit/011aba24ed73000e126dd1bb90a6bea2afd91649
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M target-ppc/cpu.h
    M target-ppc/machine.c

  Log Message:
  -----------
  target-ppc: Remove unused power_mode field from cpu state

CPUPPCState includes a variable 'power_mode' which is used nowhere.  This
patch removes it.  This includes saving a dummy zero in its place during
vmsave, to avoid breaking the save format.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 711934334eb3895a89c555c1f57eb3d84ddb2906
      https://github.com/qemu/qemu/commit/711934334eb3895a89c555c1f57eb3d84ddb2906
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M device_tree.c
    M device_tree.h
    M hw/ppc/e500.c

  Log Message:
  -----------
  fdt: move dumpdtb interpretation code to device_tree.c

The dumpdtb code can be useful in more places than just for e500. Move it
to a generic place.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 6641b77254d3c191ecee5a87947425f623ac9ca0
      https://github.com/qemu/qemu/commit/6641b77254d3c191ecee5a87947425f623ac9ca0
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M device_tree.c

  Log Message:
  -----------
  device tree: simplify dumpdtb code

As per Peter's suggestion, we can use glib to write out a buffer in whole to
a file, simplifying the code dramatically.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 9dd5eba1bc69bccbd83885d157d84e2514799a22
      https://github.com/qemu/qemu/commit/9dd5eba1bc69bccbd83885d157d84e2514799a22
  Author: Scott Wood &lt;scottwood@freescale.com&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M hw/ppc/e500.c

  Log Message:
  -----------
  PPC: e500: increase DTC_LOAD_PAD

An allowance of 5 MiB for BSS is not enough for Linux kernels with certain
debug options enabled (not sure exactly which one caused it, but I'd guess
lockdep).  The kernel I ran into this with had a BSS of around 6.4 MB.

Unfortunately, uImage does not give us enough information to determine the
actual BSS size.  Increase the allowance to 18 MiB to give us plenty of
room.  Eventually this should be more intelligent, possibly packing
initrd+dtb at the end of guest RAM.

Signed-off-by: Scott Wood &lt;scottwood@freescale.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 7e7ec2d290ca5b1bdd555da9852dc5ee60232fe5
      https://github.com/qemu/qemu/commit/7e7ec2d290ca5b1bdd555da9852dc5ee60232fe5
  Author: Scott Wood &lt;scottwood@freescale.com&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M hw/ppc/e500.c

  Log Message:
  -----------
  PPC: e500: calculate initrd_base like dt_base

While investigating dtb pad issues, I noticed that initrd_base wasn't taking
loadaddr into account the way dt_base was.  This seems wrong.

Signed-off-by: Scott Wood &lt;scottwood@freescale.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: efcb9383b974114e5f682e531346006f8f2466c0
      https://github.com/qemu/qemu/commit/efcb9383b974114e5f682e531346006f8f2466c0
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M hw/spapr.c
    M hw/spapr_hcall.c

  Log Message:
  -----------
  pseries: Don't test for MSR_PR for hypercalls under KVM

PAPR hypercalls should only be invoked from the guest kernel, not guest
user programs, that is, with MSR[PR]=0.  Currently we check this in
spapr_hypercall, returning H_PRIVILEGE if MSR[PR]=1.

However, under KVM the state of MSR[PR] is already checked by the host
kernel before passing the hypercall to qemu, making this check redundant.
Worse, however, we don't generally synchronize KVM and qemu state on the
hypercall path, meaning that qemu could incorrectly reject a hypercall
because it has a stale MSR value.

This patch fixes the problem by moving the privilege test exclusively to
the TCG hypercall path.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
CC: qemu-stable@nongnu.org
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 2b15811c8cd4dbe8dcde32320936fe74e51e4279
      https://github.com/qemu/qemu/commit/2b15811c8cd4dbe8dcde32320936fe74e51e4279
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M target-ppc/translate_init.c

  Log Message:
  -----------
  ppc/pseries: Reset VPA registration on CPU reset

The ppc specific CPU state contains several variables which track the
VPA, SLB shadow and dispatch trace log.  These are structures shared
between OS and hypervisor that are used on the pseries machine to track
various per-CPU quantities.

The address of these structures needs to be registered by the guest on each
boot, however currently this registration is not cleared when we reset the
cpu.  This patch corrects this bug.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: fb37c3029c5a695e367baaacc6baf17640cc63cc
      https://github.com/qemu/qemu/commit/fb37c3029c5a695e367baaacc6baf17640cc63cc
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M hw/ppc/e500.c

  Log Message:
  -----------
  PPC: e500: Only expose even TLB sizes in initial TLB

When booting our e500 machine, we automatically generate a big TLB entry
in TLB1 that covers all of the code we need to run in there until the guest
can handle its TLB on its own.

However, e500v2 can only handle MAS1.0 sizes. However, we keep our TLB
information in MAS2.0 layout, which means we have twice as many TLB sizes
to choose from. That also means we can run into a situation where we try
to add a TLB size that could not fit into the MAS1.0 size bits.

Fix it by making sure we always have the lower bit set to 0. That way we
are always guaranteed to have MAS1.0 compatible TLB size information.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: ef8beb0e94c75984e016e855164361c36e15396c
      https://github.com/qemu/qemu/commit/ef8beb0e94c75984e016e855164361c36e15396c
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-04 (Thu, 04 Oct 2012)

  Changed paths:
    M target-ppc/kvm.c

  Log Message:
  -----------
  PPC: KVM: Fix BAT put

In the sregs API, upper and lower 32bit segments of the BAT registers
are swapped when doing a set. Since we need to support old kernels out
there, don't bother to fix it in the kernel, but instead work around
the problem in QEMU by swapping on put.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 7a608f562ebd91e811ed0b725e528c894e4f19c4
      https://github.com/qemu/qemu/commit/7a608f562ebd91e811ed0b725e528c894e4f19c4
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M hw/nand.c
    M hw/onenand.c
    M hw/sd.c

  Log Message:
  -----------
  hw: Fix return value check for bdrv_read, bdrv_write

Those functions return -errno in case of an error.
The old code would typically only detect EPERM (1) errors.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: afb63ebd0a9599312c27ecceb839a399740e00ef
      https://github.com/qemu/qemu/commit/afb63ebd0a9599312c27ecceb839a399740e00ef
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: Support empty target list (--target-list=)

Specifying an empty target list with --target-list= is shorter
than specifying --disable-user --disable-system.

Both variants should give the same result: no targets at all.

This modification implements that feature.

It uses a trick which works with POSIX compliant shells to test whether
target_list is undefined (=&gt; default targets) or empty (=&gt; no targets).

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: b2532d88c9eb4f4734f62d5075585ee8c1516605
      https://github.com/qemu/qemu/commit/b2532d88c9eb4f4734f62d5075585ee8c1516605
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M cpus.c

  Log Message:
  -----------
  cpu: Add missing 'static' attribute to qemu_global_mutex

Contrary to its name, 'qemu_global_mutex' is only used locally
in cpus.c.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: f97713ff191ab855ca5c03458f8dab0c9bf58443
      https://github.com/qemu/qemu/commit/f97713ff191ab855ca5c03458f8dab0c9bf58443
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M tcg/arm/tcg-target.c

  Log Message:
  -----------
  tcg/arm: Use tcg_out_mov_reg rather than inline equivalent code

Use the recently introduced tcg_out_mov_reg() function rather than
the equivalent inline code.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: 30daca5f77588a75bf9bcd604e21c5506402fabb
      https://github.com/qemu/qemu/commit/30daca5f77588a75bf9bcd604e21c5506402fabb
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M slirp/ip_icmp.h

  Log Message:
  -----------
  slirp: Fix spelling in comment (enought -&gt; enough, insure -&gt; ensure)

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: d69eba24269c0d3d376b7de4095dcca376a3beea
      https://github.com/qemu/qemu/commit/d69eba24269c0d3d376b7de4095dcca376a3beea
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M ui/vnc-tls.c

  Log Message:
  -----------
  vnc: Fix spelling (hellmen -&gt; hellman) in comment

The algorithm was named after Martin E. Hellman.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: 58455eb9f2865d54c8bf208805f7a4c217b5c00d
      https://github.com/qemu/qemu/commit/58455eb9f2865d54c8bf208805f7a4c217b5c00d
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M qemu-common.h
    M qemu-sockets.c

  Log Message:
  -----------
  qemu-sockets: Fix compiler warning (regression for MinGW)

setsockopt needs a type cast for MinGW. That type cast is missing in
a recent commit which results in a compiler warning.

Like for other socket related functions which have the same problem,
we add a 'qemu_setsockopt' macro which provides that type cast where
needed and use the new macro to avoid the warning.

A 'qemu_getsockopt' is also added and can be used for future
modifications.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: 4d5b97da35ecbfdad6fe1cbe7fdd7d71ef735602
      https://github.com/qemu/qemu/commit/4d5b97da35ecbfdad6fe1cbe7fdd7d71ef735602
  Author: Amos Kong &lt;akong@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M block/qed-table.c
    M blockdev.c
    M hw/9pfs/virtio-9p.c
    M hw/blizzard.c
    M hw/bt-hci.c
    M hw/device-hotplug.c
    M hw/exynos4210_combiner.c
    M hw/exynos4210_gic.c
    M hw/exynos4210_mct.c
    M hw/fdc.c
    M hw/framebuffer.c
    M hw/ide/macio.c
    M hw/ivshmem.c
    M hw/megasas.c
    M hw/msix.c
    M hw/pflash_cfi01.c
    M hw/pflash_cfi02.c
    M hw/pxa2xx_keypad.c
    M hw/sb16.c
    M hw/scsi-disk.c
    M hw/tcx.c
    M hw/usb/dev-uas.c
    M hw/usb/hcd-ohci.c
    M hw/usb/hcd-xhci.c
    M hw/xen_domainbuild.c
    M libcacard/vcard.c
    M libcacard/vcard_emul_nss.c
    M libcacard/vreader.c
    M linux-user/signal.c
    M os-posix.c
    M qemu-sockets.c
    M qga/commands-posix.c
    M qga/commands-win32.c
    M savevm.c
    M slirp/ip_input.c
    M slirp/tcp_input.c
    M slirp/udp.c
    M target-unicore32/translate.c
    M ui/vnc-auth-sasl.c
    M vl.c
    M xen-all.c

  Log Message:
  -----------
  cleanup useless return sentence

This patch cleans up return sentences in the end of void functions.

Reported-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Amos Kong &lt;akong@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: da665c99f1b5d3247f7f9f8a24f3eb1fda94e1e4
      https://github.com/qemu/qemu/commit/da665c99f1b5d3247f7f9f8a24f3eb1fda94e1e4
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M hw/leon3.c
    M hw/mips_fulong2e.c

  Log Message:
  -----------
  hw: Add missing 'static' attribute for QEMUMachine

It was missing for leon3 and mips_fulong2e.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: 8e7e2b14e7c86cdceb337cf7f5c4c351ab350775
      https://github.com/qemu/qemu/commit/8e7e2b14e7c86cdceb337cf7f5c4c351ab350775
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M qemu-barrier.h

  Log Message:
  -----------
  qemu-barrier: Fix compiler version check for future gcc versions

The current check will give a wrong result for gcc-5.x with x &lt; 4.
Using QEMU_GNUC_PREREQ is simpler and fixes that issue.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: c36b7de64dfb106ee0384d2634fd4037218ffbca
      https://github.com/qemu/qemu/commit/c36b7de64dfb106ee0384d2634fd4037218ffbca
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M hw/qdev.c

  Log Message:
  -----------
  qdev: kill bogus comment

When the DeviceInfo code was removed, the comment describing
qdev_subclass_init() was left in the code by mistake. Remove it.

Cc: qemu-trivial@nongnu.org
Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: 02cd521f6e207bd8843a7c1309f6d065cf01c6ee
      https://github.com/qemu/qemu/commit/02cd521f6e207bd8843a7c1309f6d065cf01c6ee
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M hw/versatilepb.c

  Log Message:
  -----------
  versatilepb: Use symbolic indices for ARM PIC

It is more readable, and all other code does it like that, too.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: 6fd2a026fbf46ed5927a57e3e043a2039a0651d0
      https://github.com/qemu/qemu/commit/6fd2a026fbf46ed5927a57e3e043a2039a0651d0
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M cpu-all.h
    M cpu-exec.c
    M cpus.c
    M exec.c
    M monitor.c
    M target-i386/cpu.c
    M target-i386/cpu.h
    M target-i386/helper.c
    M target-i386/seg_helper.c
    M target-i386/smm_helper.c

  Log Message:
  -----------
  cpu_dump_state: move DUMP_FPU and DUMP_CCOP flags from x86-only to generic

Move the DUMP_FPU and DUMP_CCOP flags for cpu_dump_state() from being
x86-specific flags to being generic ones. This allows us to drop some
TARGET_I386 ifdefs in various places, and means that we can (potentially)
be more consistent across architectures about which monitor commands or
debug abort printouts include FPU register contents and info about
QEMU's condition-code optimisations.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: f2617cfc237a7f7e72bd3791ed1f3d35f496bb22
      https://github.com/qemu/qemu/commit/f2617cfc237a7f7e72bd3791ed1f3d35f496bb22
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M target-arm/translate.c

  Log Message:
  -----------
  target-arm: Reinstate display of VFP registers in cpu_dump_state

Reinstate the display of VFP registers in cpu_dump_state(), if
the CPU has them (this code had been #if 0'd out a for a long time).
We drop the attempt ot display the values as floating point, since
this makes assumptions about the host 'float' and 'double' formats
and is not done by eg the i386 cpu_dump_state().
This display is gated on the CPU_DUMP_FPU flag, as for x86.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 66c374de8a949062bfb1792f7e685a168c61c416
      https://github.com/qemu/qemu/commit/66c374de8a949062bfb1792f7e685a168c61c416
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M target-arm/translate.c

  Log Message:
  -----------
  target-arm: use globals for CC flags

Use globals for CC flags instead of loading/storing them each they are
accessed. This allows some optimizations to be performed by the TCG
optimization passes.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 72485ec4f63d86c428f9223fc966bd7d2cc8100c
      https://github.com/qemu/qemu/commit/72485ec4f63d86c428f9223fc966bd7d2cc8100c
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M target-arm/helper.h
    M target-arm/op_helper.c
    M target-arm/translate.c

  Log Message:
  -----------
  target-arm: convert add_cc and sub_cc helpers to TCG

Now that the setcond TCG op is available, it's possible to replace
add_cc and sub_cc helpers by TCG code. The code generated by TCG is
actually very close to the one generated by GCC for the helper, and
this avoid all the consequences of using an helper: globals saved back
to memory, no possible optimization, call overhead, etc.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 365af80e47bf150506345cdfbcbf32120f18cdf6
      https://github.com/qemu/qemu/commit/365af80e47bf150506345cdfbcbf32120f18cdf6
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M target-arm/helper.h
    M target-arm/op_helper.c
    M target-arm/translate.c

  Log Message:
  -----------
  target-arm: convert sar, shl and shr helpers to TCG

Now that the movcond TCG op is available, it's possible to replace
shl and shr helpers by TCG code. The code generated by TCG is slightly
longer than the code generated by GCC for the helper but is still worth
it as this avoid all the consequences of using an helper: globals saved
back to memory, no possible optimization, call overhead, etc.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 00e3ab2db059d243e210052937fc4f4169aa839c
      https://github.com/qemu/qemu/commit/00e3ab2db059d243e210052937fc4f4169aa839c
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M target-arm/helper.h

  Log Message:
  -----------
  target-arm: mark a few integer helpers const and pure

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: d593c48ef91b6fee609d9c87958fe76dd2b36852
      https://github.com/qemu/qemu/commit/d593c48ef91b6fee609d9c87958fe76dd2b36852
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M target-arm/translate.c

  Log Message:
  -----------
  target-arm: use deposit instead of hardcoded version

Use the deposit op instead of and hardcoded bit field insertion. It
allows the host to emit the corresponding instruction if available.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 1273d9ca09e91bb290d10f704055f6abec363dd6
      https://github.com/qemu/qemu/commit/1273d9ca09e91bb290d10f704055f6abec363dd6
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-05 (Fri, 05 Oct 2012)

  Changed paths:
    M target-arm/cpu.h

  Log Message:
  -----------
  target-arm: Drop unused DECODE_CPREG_CRN macro

This macro snuck through code review despite being unused; drop it.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: f783cb22409c6537b3cab7e78e527f62b4237d1e
      https://github.com/qemu/qemu/commit/f783cb22409c6537b3cab7e78e527f62b4237d1e
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M target-xtensa/translate.c

  Log Message:
  -----------
  target-xtensa: de-optimize EXTUI

Now that "and" with 0xff, 0xffff and 0xffffffff and "shr" with 0 shift
are optimized in tcg/tcg-op.h there is no need to do it in
target-xtensa/translate.c.

Acked-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 626cd050e2c9094c1b005bc39cab637f8cbe3755
      https://github.com/qemu/qemu/commit/626cd050e2c9094c1b005bc39cab637f8cbe3755
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M tcg/README
    M tcg/arm/tcg-target.c
    M tcg/hppa/tcg-target.c
    M tcg/i386/tcg-target.c
    M tcg/ia64/tcg-target.c
    M tcg/mips/tcg-target.c
    M tcg/ppc/tcg-target.c
    M tcg/ppc64/tcg-target.c
    M tcg/s390/tcg-target.c
    M tcg/sparc/tcg-target.c
    M tcg/tcg-opc.h
    M tcg/tci/tcg-target.c
    M tci.c

  Log Message:
  -----------
  tcg: remove obsolete jmp op

The TCG jmp operation doesn't really make sense in the QEMU context, it
is unused, it is not implemented by some targets, and it is wrongly
implemented by some others.

This patch simply removes it.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Acked-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Acked-by: Stefan Weil&lt;sw@weilnetz.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: a1e472119aa2efa88a2a24b1aa50e45ea8cc8f31
      https://github.com/qemu/qemu/commit/a1e472119aa2efa88a2a24b1aa50e45ea8cc8f31
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M hw/alpha_pci.c
    M hw/mips_malta.c
    M hw/pc.c
    M hw/ppc_newworld.c
    M hw/ppc_oldworld.c
    M hw/ppc_prep.c
    M hw/spapr.c
    M hw/sun4u.c
    M hw/vga-pci.c
    M hw/vga-pci.h

  Log Message:
  -----------
  vga: rename pci_vga_init() into pci_std_vga_init()

This better explains what is this function about. Adjust all callers.

Cc: Alexander Graf &lt;agraf@suse.de&gt;
Cc: Andreas FÃ¤rber &lt;andreas.faerber@web.de&gt;
Cc: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Cc: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Acked-by: Richard Henderson &lt;rth@twiddle.net&gt;
Acked-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Acked-by: Andreas FÃ¤rber &lt;andreas.faerber@web.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 6405c86412719a0ccd1a09b81baf0b78e8a4ae6b
      https://github.com/qemu/qemu/commit/6405c86412719a0ccd1a09b81baf0b78e8a4ae6b
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M hw/mips_r4k.c
    M hw/pc.c
    M hw/pc.h

  Log Message:
  -----------
  vga: rename isa_vga_init() to isa_std_vga_init()

This better explains what is this function about. Adjust all callers.

Cc: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 36b7f27d2195a09dbfb7f08b2323d807c1ad90b0
      https://github.com/qemu/qemu/commit/36b7f27d2195a09dbfb7f08b2323d807c1ad90b0
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M hw/qdev.c
    M hw/qdev.h
    M vl.c

  Log Message:
  -----------
  vl.c: convert *vga_enabled functions to QOM

And get rid of qdev_exists().

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 879049a39724f91224f10c8d80b3cf70c9dc1c5e
      https://github.com/qemu/qemu/commit/879049a39724f91224f10c8d80b3cf70c9dc1c5e
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M vl.c

  Log Message:
  -----------
  vl.c: check for qxl availability

Check for qxl availability in vl.c. This will allow to remove #ifdef
CONFIG_SPICE .. #endif later in this series

Cc: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Cc: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 3605ded557eb2a6d06a942b952c8fac4c676b125
      https://github.com/qemu/qemu/commit/3605ded557eb2a6d06a942b952c8fac4c676b125
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M vl.c

  Log Message:
  -----------
  vl.c: default to std if cirrus is not available

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 129d42fb8496de5c1896160fddab949784d4dea4
      https://github.com/qemu/qemu/commit/129d42fb8496de5c1896160fddab949784d4dea4
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M hw/pci.c
    M hw/pci.h

  Log Message:
  -----------
  pci: add a pci_vga_init() function

This function create a PCI VGA device according to the value of
vga_interface_type. It returns a PCIDevice (and not a DeviceState).

Cc: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 14e7a6456e1dba2c6499b3b05637fee9f553e6ce
      https://github.com/qemu/qemu/commit/14e7a6456e1dba2c6499b3b05637fee9f553e6ce
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M hw/isa-bus.c
    M hw/isa.h

  Log Message:
  -----------
  isa: add a isa_vga_init() function

This function create a ISA VGA device according to the value of
vga_interface_type. It returns a ISADevice (and not a DeviceState).

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 9c59864d16d720184e723c0c29c505c34e94fed5
      https://github.com/qemu/qemu/commit/9c59864d16d720184e723c0c29c505c34e94fed5
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M hw/mips_malta.c

  Log Message:
  -----------
  mips/malta: use the new pci_vga_init() function

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 606f90cc22094bab743c84d40a11f6ded603ad34
      https://github.com/qemu/qemu/commit/606f90cc22094bab743c84d40a11f6ded603ad34
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M hw/alpha_dp264.c
    M hw/alpha_pci.c
    M hw/alpha_sys.h

  Log Message:
  -----------
  alpha: use the new pci_vga_init() function

This remove the fallback to std-vga in case, as availability of the
requested vga device is now tested in vl.c, and returns an error message
to the user.

Acked-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: e7a2e96df0692e19f253476027a565dc7c11da76
      https://github.com/qemu/qemu/commit/e7a2e96df0692e19f253476027a565dc7c11da76
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M hw/ppc_newworld.c

  Log Message:
  -----------
  ppc/newworld: use the new pci_vga_init() function

As a bonus it allows new vga card types (including none).

Cc: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 3e20ad3a9b674abc3464504d59bba46304316136
      https://github.com/qemu/qemu/commit/3e20ad3a9b674abc3464504d59bba46304316136
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M hw/ppc_oldworld.c

  Log Message:
  -----------
  ppc/oldworld: use the new pci_vga_init() function

As a bonus it allows new vga card types (including none).

Cc: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 95fa01fab0082483c1849f1439303db4183c8dd4
      https://github.com/qemu/qemu/commit/95fa01fab0082483c1849f1439303db4183c8dd4
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M hw/ppc_prep.c

  Log Message:
  -----------
  ppc/prep: use the new pci_vga_init() function

As a bonus it allows new vga card types (including none).

Acked-by: Andreas FÃ¤rber &lt;andreas.faerber@web.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 1ddcae82a2509668b94a13e84921bdcafddcdfff
      https://github.com/qemu/qemu/commit/1ddcae82a2509668b94a13e84921bdcafddcdfff
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M hw/spapr.c

  Log Message:
  -----------
  ppc/pSeries: use the new pci_vga_init() function

Keep the case to prevent some vga card to be selected.

Cc: Alexander Graf &lt;agraf@suse.de&gt;
Cc: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: f2898771435701df33145cacabeb42c6aa3a9a16
      https://github.com/qemu/qemu/commit/f2898771435701df33145cacabeb42c6aa3a9a16
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M hw/sun4u.c

  Log Message:
  -----------
  sun/sun4u: use the new pci_vga_init() function

As a bonus it allows new vga card types (including none).

Acked-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 16094b75b38dcb5582810bd4149fa8336a939dc8
      https://github.com/qemu/qemu/commit/16094b75b38dcb5582810bd4149fa8336a939dc8
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M hw/pc.c

  Log Message:
  -----------
  pc: use the new pci_vga_init() and isa_vga_init() functions

The CONFIG_SPICE is now tested in vl.c and thus not needed anymore.

Cc: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: f642dfce199eecda5a558ce94c17a34707d63ccd
      https://github.com/qemu/qemu/commit/f642dfce199eecda5a558ce94c17a34707d63ccd
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M hw/mips_r4k.c

  Log Message:
  -----------
  mips/r4k: use the new is_vga_init() function

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 457ebdcd91aa7f0df094e12a8c46235f0c7d4f9b
      https://github.com/qemu/qemu/commit/457ebdcd91aa7f0df094e12a8c46235f0c7d4f9b
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M hw/cirrus_vga.c
    M hw/pc.h
    M hw/vga-pci.c
    R hw/vga-pci.h
    M hw/vmware_vga.c
    R hw/vmware_vga.h
    M sysemu.h

  Log Message:
  -----------
  vga: cleanup after isa_vga_init() and pci_vga_init() conversion

Now that all machines call isa_vga_init() or pci_vga_init(), some unused
code can be removed.

Cc: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: bcc66562ad185e9c2a667b00426f625e2489bda9
      https://github.com/qemu/qemu/commit/bcc66562ad185e9c2a667b00426f625e2489bda9
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M tcg/s390/tcg-target.c
    M tcg/tcg.h

  Log Message:
  -----------
  tcg: Add is_unsigned_cond

Before we rearrange the TCG_COND enumeration, add a predicate for
the (single) use of comparisons vs TCGCond.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 0aed257f08444feb6269d0c302b35a8fb10fcb3f
      https://github.com/qemu/qemu/commit/0aed257f08444feb6269d0c302b35a8fb10fcb3f
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M tcg/arm/tcg-target.c
    M tcg/hppa/tcg-target.c
    M tcg/i386/tcg-target.c
    M tcg/optimize.c
    M tcg/ppc/tcg-target.c
    M tcg/ppc64/tcg-target.c
    M tcg/s390/tcg-target.c
    M tcg/sparc/tcg-target.c
    M tcg/tcg-op.h
    M tcg/tcg.c
    M tcg/tcg.h

  Log Message:
  -----------
  tcg: Add TCG_COND_NEVER, TCG_COND_ALWAYS

There are several cases that can be handled easier inside both
translators and code generators if we have out-of-band values
for conditions.  It's easy enough to handle ALWAYS and NEVER in
the natural way inside the tcg middle-end.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: d1e321b82a021c2e86d204af870356bc72b22546
      https://github.com/qemu/qemu/commit/d1e321b82a021c2e86d204af870356bc72b22546
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M tcg/hppa/tcg-target.c
    M tcg/tcg.h

  Log Message:
  -----------
  tcg: Add tcg_high_cond

The table that was recently added for hppa is generally usable.
And with the renumbering of the TCG_COND constants it's not too
difficult to compute rather than have a table.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 1d31fca470648ec66afd8743491bfb5846306341
      https://github.com/qemu/qemu/commit/1d31fca470648ec66afd8743491bfb5846306341
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M qemu-barrier.h

  Log Message:
  -----------
  qemu-barrier: Fix compilation on i386 hosts

Commit 610b823ef66b993660f1ab1447a769f190e4f3b3 uses QEMU_GNUC_PREREQ
on i386 hosts.

That macro is defined in qemu-common.h which is not always included
before qemu-barrier.h, so compilation on i386 hosts was broken.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 6b2f90fbbd31d594238098f46ef63ee307a12f55
      https://github.com/qemu/qemu/commit/6b2f90fbbd31d594238098f46ef63ee307a12f55
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M MAINTAINERS
    M device_tree.c
    M device_tree.h
    M hw/ppc/e500.c
    M hw/ppc405_uc.c
    M hw/spapr.c
    M hw/spapr.h
    M hw/spapr_hcall.c
    M hw/spapr_iommu.c
    M hw/spapr_pci.c
    M hw/spapr_rtas.c
    M hw/spapr_vio.c
    M hw/spapr_vio.h
    M hw/xics.c
    M hw/xics.h
    M target-ppc/cpu.h
    M target-ppc/int_helper.c
    M target-ppc/kvm.c
    M target-ppc/kvm_ppc.h
    M target-ppc/machine.c
    M target-ppc/translate_init.c

  Log Message:
  -----------
  Merge branch 'ppc-for-upstream' of git://repo.or.cz/qemu/agraf

* 'ppc-for-upstream' of git://repo.or.cz/qemu/agraf: (35 commits)
  PPC: KVM: Fix BAT put
  PPC: e500: Only expose even TLB sizes in initial TLB
  ppc/pseries: Reset VPA registration on CPU reset
  pseries: Don't test for MSR_PR for hypercalls under KVM
  PPC: e500: calculate initrd_base like dt_base
  PPC: e500: increase DTC_LOAD_PAD
  device tree: simplify dumpdtb code
  fdt: move dumpdtb interpretation code to device_tree.c
  target-ppc: Remove unused power_mode field from cpu state
  pseries: Set hash table size based on RAM size
  pseries: Remove unnecessary locking from PAPR hash table hcalls
  ppc405_uc: Fix buffer overflow
  target-ppc: KVM: Fix some kernel version edge cases for kvmppc_reset_htab()
  pseries: Fix semantics of RTAS int-on, int-off and set-xive functions
  pseries: Rework implementation of TCE bypass
  pseries: Remove never used flags field from spapr vio devices
  pseries: Remove XICS irq type enum type
  pseries: Remove C bitfields from xics code
  pseries: Small cleanup to H_CEDE implementation
  pseries: Fix XICS reset
  ...


  Commit: 048d3612a51b3da45081091b734f93428925ebf8
      https://github.com/qemu/qemu/commit/048d3612a51b3da45081091b734f93428925ebf8
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M block/qed-table.c
    M blockdev.c
    M configure
    M cpus.c
    M hw/9pfs/virtio-9p.c
    M hw/blizzard.c
    M hw/bt-hci.c
    M hw/device-hotplug.c
    M hw/exynos4210_combiner.c
    M hw/exynos4210_gic.c
    M hw/exynos4210_mct.c
    M hw/fdc.c
    M hw/framebuffer.c
    M hw/ide/macio.c
    M hw/ivshmem.c
    M hw/leon3.c
    M hw/megasas.c
    M hw/mips_fulong2e.c
    M hw/msix.c
    M hw/nand.c
    M hw/onenand.c
    M hw/pflash_cfi01.c
    M hw/pflash_cfi02.c
    M hw/pxa2xx_keypad.c
    M hw/qdev.c
    M hw/sb16.c
    M hw/scsi-disk.c
    M hw/sd.c
    M hw/tcx.c
    M hw/usb/dev-uas.c
    M hw/usb/hcd-ohci.c
    M hw/usb/hcd-xhci.c
    M hw/versatilepb.c
    M hw/xen_domainbuild.c
    M libcacard/vcard.c
    M libcacard/vcard_emul_nss.c
    M libcacard/vreader.c
    M linux-user/signal.c
    M os-posix.c
    M qemu-common.h
    M qemu-sockets.c
    M qga/commands-posix.c
    M qga/commands-win32.c
    M savevm.c
    M slirp/ip_icmp.h
    M slirp/ip_input.c
    M slirp/tcp_input.c
    M slirp/udp.c
    M target-unicore32/translate.c
    M tcg/arm/tcg-target.c
    M ui/vnc-auth-sasl.c
    M ui/vnc-tls.c
    M vl.c
    M xen-all.c

  Log Message:
  -----------
  Merge branch 'trivial-patches' of git://github.com/stefanha/qemu

* 'trivial-patches' of git://github.com/stefanha/qemu:
  versatilepb: Use symbolic indices for ARM PIC
  qdev: kill bogus comment
  qemu-barrier: Fix compiler version check for future gcc versions
  hw: Add missing 'static' attribute for QEMUMachine
  cleanup useless return sentence
  qemu-sockets: Fix compiler warning (regression for MinGW)
  vnc: Fix spelling (hellmen -&gt; hellman) in comment
  slirp: Fix spelling in comment (enought -&gt; enough, insure -&gt; ensure)
  tcg/arm: Use tcg_out_mov_reg rather than inline equivalent code
  cpu: Add missing 'static' attribute to qemu_global_mutex
  configure: Support empty target list (--target-list=)
  hw: Fix return value check for bdrv_read, bdrv_write


  Commit: 046dbab95f33e007428190610d638d2fcaf37fdf
      https://github.com/qemu/qemu/commit/046dbab95f33e007428190610d638d2fcaf37fdf
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-06 (Sat, 06 Oct 2012)

  Changed paths:
    M cpu-all.h
    M cpu-exec.c
    M cpus.c
    M exec.c
    M monitor.c
    M target-arm/cpu.h
    M target-arm/helper.h
    M target-arm/op_helper.c
    M target-arm/translate.c
    M target-i386/cpu.c
    M target-i386/cpu.h
    M target-i386/helper.c
    M target-i386/seg_helper.c
    M target-i386/smm_helper.c

  Log Message:
  -----------
  Merge branch 'target-arm.for-upstream' of git://git.linaro.org/people/pmaydell/qemu-arm

* 'target-arm.for-upstream' of git://git.linaro.org/people/pmaydell/qemu-arm:
  target-arm: Drop unused DECODE_CPREG_CRN macro
  target-arm: use deposit instead of hardcoded version
  target-arm: mark a few integer helpers const and pure
  target-arm: convert sar, shl and shr helpers to TCG
  target-arm: convert add_cc and sub_cc helpers to TCG
  target-arm: use globals for CC flags
  target-arm: Reinstate display of VFP registers in cpu_dump_state
  cpu_dump_state: move DUMP_FPU and DUMP_CCOP flags from x86-only to generic


Compare: https://github.com/qemu/qemu/compare/c9159fe9aa9a...046dbab95f33

----==_mimepart_50707fc09ca3e_1d6416aaae4820d--


</body></email><email><emailId>20121007183008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-07 18:30:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] f18297: qemu-barrier: Fix compilation on i386 hosts</subject><body>



----==_mimepart_5071ca303ad44_3b1a1153af0748e5
Date: Sun, 07 Oct 2012 11:30:08 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5071ca303bf92_3b1a1153af074958@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: f1829782d6cb931973d71649f8ad1dad66188c34
      https://github.com/qemu/qemu/commit/f1829782d6cb931973d71649f8ad1dad66188c34
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M qemu-barrier.h

  Log Message:
  -----------
  qemu-barrier: Fix compilation on i386 hosts

Commit 1d31fca470648ec66afd8743491bfb5846306341 tried to fix bug
introduced by 610b823ef66b993660f1ab1447a769f190e4f3b3 by including
qemu-common.h, which breaks the build further.

Include compiler.h instead, as suggested by Blue Swirl.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;




----==_mimepart_5071ca303ad44_3b1a1153af0748e5--


</body></email><email><emailId>20121007190013</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-07 19:00:13-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] d83820: tcg: Remove redundant pointer from TCGContext</subject><body>



----==_mimepart_5071d13d17e26_34bef6cae813469
Date: Sun, 07 Oct 2012 12:00:13 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5071d13d1c411_34bef6cae813591@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: d838201111894b17ca9123d5d2a74ab4cf6376d6
      https://github.com/qemu/qemu/commit/d838201111894b17ca9123d5d2a74ab4cf6376d6
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M tcg/tcg.c
    M tcg/tcg.h

  Log Message:
  -----------
  tcg: Remove redundant pointer from TCGContext

The pointer entry 'temps' always refers to the array entry 'static_temps'.
Removing the pointer and renaming 'static_temps' to 'temps' reduces the
size of TCGContext (4 or 8 byte) and allows better code generation.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 76a23ca099084ce72f5c30a3c5dc18e331384c59
      https://github.com/qemu/qemu/commit/76a23ca099084ce72f5c30a3c5dc18e331384c59
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/cpu.c

  Log Message:
  -----------
  target-sparc: Tidy cpu_dump_state

We don't really need to be told that %g are general register, etc.
Issue a trailing newline to separate blocks.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: b884fc5ecaacd241829f225282356d59eb186645
      https://github.com/qemu/qemu/commit/b884fc5ecaacd241829f225282356d59eb186645
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/int32_helper.c
    M target-sparc/int64_helper.c

  Log Message:
  -----------
  target-sparc: Make CPU_LOG_INT useful by default

No need for ifdefs when the log mask does just as well.
No need to print pc/npc when we're dumping the whole cpu state.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: d4a288ef9c2b432307961429bdcacb2416ad8a99
      https://github.com/qemu/qemu/commit/d4a288ef9c2b432307961429bdcacb2416ad8a99
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Tidy do_branch interfaces

We always pass cpu_cond to the r_cond parameter.  Use that global
register directly instead of passing it down.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: dee8913cbf82a03fed661ac6c461491045dac7f5
      https://github.com/qemu/qemu/commit/dee8913cbf82a03fed661ac6c461491045dac7f5
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Tidy flush_cond interface

We always pass cpu_cond to the cond parameter.  Use that global
register directly instead of passing it down.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 5b12f1e8a1aad8030c3ec5790cb5f8f370a1df1f
      https://github.com/qemu/qemu/commit/5b12f1e8a1aad8030c3ec5790cb5f8f370a1df1f
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Tidy gen_trap_ifnofpu interface

We always pass cpu_cond to the cond parameter.  Use that global
register directly instead of passing it down.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 66442b07ae37a23c727ecd8c30a25054a7f21886
      https://github.com/qemu/qemu/commit/66442b07ae37a23c727ecd8c30a25054a7f21886
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Tidy save_state interface

Use the cpu_cond global register directly instead of passing it down.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 13a6dd00433005831c2bc671b0e085cb5b04b424
      https://github.com/qemu/qemu/commit/13a6dd00433005831c2bc671b0e085cb5b04b424
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Tidy gen_mov_pc_npc interface

Use the cpu_cond global register directly instead of passing it down.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 934da7ee0840f582c7720d0ce4507456d9955feb
      https://github.com/qemu/qemu/commit/934da7ee0840f582c7720d0ce4507456d9955feb
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Tidy save_npc interface

Use the cpu_cond global register directly instead of passing it down.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 2e655fe768d9873d07be3be264c042c35720694b
      https://github.com/qemu/qemu/commit/2e655fe768d9873d07be3be264c042c35720694b
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Tidy gen_generic_branch interface

The arguments passed are always the same.
Pass down just DisasContext instead.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 416fcaea1ef7e9a71ccb0a968de594618ed7675e
      https://github.com/qemu/qemu/commit/416fcaea1ef7e9a71ccb0a968de594618ed7675e
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Introduce DisasCompare and functions to generate it

For the moment gen_cond et al retain their existing interface,
using setcond to turn a (potential) comparison back into a boolean.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 3a49e7598b78bca019e35c42590914faab2a817a
      https://github.com/qemu/qemu/commit/3a49e7598b78bca019e35c42590914faab2a817a
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Use DisasCompare in Tcc

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 7e480893cc3eb9f307199517f0e1d5c8e72a030f
      https://github.com/qemu/qemu/commit/7e480893cc3eb9f307199517f0e1d5c8e72a030f
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Use DisasCompare and movcond in FMOVR, FMOVCC

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: f52879b4410aa511e7c2baccc6a2fe37096b471e
      https://github.com/qemu/qemu/commit/f52879b4410aa511e7c2baccc6a2fe37096b471e
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Use DisasCompare and movcond in MOVCC

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: c33f80f52a4621e6ed2d021adb08c7de8bec09d8
      https://github.com/qemu/qemu/commit/c33f80f52a4621e6ed2d021adb08c7de8bec09d8
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Use DisasCompare and movcond in MOVR

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 61316742e2bc7b5b5257198f2248c42a9d238c84
      https://github.com/qemu/qemu/commit/61316742e2bc7b5b5257198f2248c42a9d238c84
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Use movcond in gen_generic_branch

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: c28ae41ecd3bec70f1db8545e0800b9023891057
      https://github.com/qemu/qemu/commit/c28ae41ecd3bec70f1db8545e0800b9023891057
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/cpu.h
    M target-sparc/helper.c
    M target-sparc/helper.h
    M target-sparc/ldst_helper.c
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Move sdivx and udivx out of line

The branches around the exception are maintaining an otherwise
unnecessary use of local temps for the cpu destination.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: bd49ed41ebe518c79bd52e46ce5b9cf278f8a2af
      https://github.com/qemu/qemu/commit/bd49ed41ebe518c79bd52e46ce5b9cf278f8a2af
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Tidy Tcc

Share more code between unconditional and conditional paths.

Move the computation of the trap number into the conditional BB;
avoid using temporaries that have gone out of scope (cpu_tmp32)
or rely on local temps (cpu_dst).

Fully fold the exception number when the trap number is %g0+imm.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: a2ea4aa9898086c1e45e1db9b5f94d16dbf0762e
      https://github.com/qemu/qemu/commit/a2ea4aa9898086c1e45e1db9b5f94d16dbf0762e
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/helper.c
    M target-sparc/helper.h
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Move taddcctv and tsubcctv out of line

The branches around the exception are maintaining an otherwise
unnecessary use of local temps for the cpu destination.

Note that gen_op_t{add,sub}_cc were identical to gen_op_{add,sub}_cc.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 6cb675b0f89131dcb7bc4f9e0801ac7620374185
      https://github.com/qemu/qemu/commit/6cb675b0f89131dcb7bc4f9e0801ac7620374185
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Use movcond in mulscc

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 690995a615ed584a4d494a7b61ede4f849d83e4a
      https://github.com/qemu/qemu/commit/690995a615ed584a4d494a7b61ede4f849d83e4a
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Use movcond for FMOV*R

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: b09b2fd30ce3079fbca1bbd7c1a87459378c5bd7
      https://github.com/qemu/qemu/commit/b09b2fd30ce3079fbca1bbd7c1a87459378c5bd7
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Cleanup "global" temporary allocation

There are 6 temporaries that disas_sparc_insn relies on having been
allocated.  Now that they are no longer referenced across branches,
they need not be allocated as local temps.

Move the allocation/free of these temporaries to make it clear that
they are local to the translation of a single insn.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: fe1755cbb21c34a40234e2c380d049b9b031c4e2
      https://github.com/qemu/qemu/commit/fe1755cbb21c34a40234e2c380d049b9b031c4e2
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Fall through from not-taken trap

Now that we've cleaned up global temporary allocation, we can
continue translating the fallthru path of a conditional trap.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 2a484ecf8283814c92b5743845e285f0efc23247
      https://github.com/qemu/qemu/commit/2a484ecf8283814c92b5743845e285f0efc23247
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Optimize conditionals using SUBCC

Aka "normal" comparisons.  We now have the infrastructure to
pass back non-boolean results from gen_compare.  This will
automatically get used by both branches and conditional moves.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 4bb26682f70a5f626cad3e0ac82bf4b6252ea7a4
      https://github.com/qemu/qemu/commit/4bb26682f70a5f626cad3e0ac82bf4b6252ea7a4
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M qemu-barrier.h

  Log Message:
  -----------
  Merge branch 'master' of git.qemu.org:/pub/git/qemu

* 'master' of git.qemu.org:/pub/git/qemu:
  qemu-barrier: Fix compilation on i386 hosts


Compare: https://github.com/qemu/qemu/compare/f1829782d6cb...4bb26682f70a

----==_mimepart_5071d13d17e26_34bef6cae813469--


</body></email><email><emailId>20121010020011</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-10 02:00:11-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] b4a76e: ssi: Support for multiple attached devices</subject><body>



----==_mimepart_5074d6aaf1589_3b4d12ceaec1763e
Date: Tue, 09 Oct 2012 19:00:11 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5074d6ab693_3b4d12ceaec177d9@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: b4a76e84f4997392c9d2eb6f4373dc376d2ffd82
      https://github.com/qemu/qemu/commit/b4a76e84f4997392c9d2eb6f4373dc376d2ffd82
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-10-09 (Tue, 09 Oct 2012)

  Changed paths:
    M hw/ssi.c

  Log Message:
  -----------
  ssi: Support for multiple attached devices

Removed assertion that only one device is attached to the SSI bus.

When multiple devices are attached, all slaves have their transfer function
called for transfers. Each device is responsible for knowing whether or not its
CS is active, and if not returning 0. The returned data is the logical or of
all responses from the (mulitple) devices.

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
Acked-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 66530953319427d7c67a723076acd68075dc7db2
      https://github.com/qemu/qemu/commit/66530953319427d7c67a723076acd68075dc7db2
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-10-09 (Tue, 09 Oct 2012)

  Changed paths:
    M hw/ads7846.c
    M hw/max111x.c
    M hw/spitz.c
    M hw/ssd0323.c
    M hw/ssi-sd.c
    M hw/ssi.c
    M hw/ssi.h
    M hw/stellaris.c
    M hw/z2.c

  Log Message:
  -----------
  ssi: Implemented CS behaviour

Added default CS behaviour for SSI slaves. SSI devices can set a property
to enable CS behaviour which will create a GPIO on the device which is the
CS. Tristating of the bus on SSI transfers is implemented.

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
Acked-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 74687e40b0406a0863234ca011c3cba7720864b0
      https://github.com/qemu/qemu/commit/74687e40b0406a0863234ca011c3cba7720864b0
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-10-09 (Tue, 09 Oct 2012)

  Changed paths:
    M hw/ssi.c
    M hw/ssi.h

  Log Message:
  -----------
  ssi: Added create_slave_no_init()

Slave creation function that can be used to create an SSI slave without
qdev_init() being called. This give machine models a chance to set properties.

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
Acked-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 1e5b31e6bd4fa8a9c679a18388d2219feece275a
      https://github.com/qemu/qemu/commit/1e5b31e6bd4fa8a9c679a18388d2219feece275a
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-10-09 (Tue, 09 Oct 2012)

  Changed paths:
    M hw/irq.c
    M hw/irq.h
    M hw/qdev.c

  Log Message:
  -----------
  qdev: allow multiple qdev_init_gpio_in() calls

Allow multiple qdev_init_gpio_in() calls for the one device. The first call will
define GPIOs 0-N-1, the next GPIOs N- ... . Allows different GPIOs to be handled
with different handlers. Needed when two levels of the QOM class heirachy both
define GPIO functionality, as a single GPIO handler with an index selecter is
not possible.

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 8120e7144b4007d26531835c7b6bc2b40a736cd2
      https://github.com/qemu/qemu/commit/8120e7144b4007d26531835c7b6bc2b40a736cd2
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-10-09 (Tue, 09 Oct 2012)

  Changed paths:
    M hw/ssd0323.c
    M hw/ssi-sd.c
    M hw/stellaris.c

  Log Message:
  -----------
  stellaris: Removed SSI mux

Removed the explicit SSI mux and wired the CS line directly up to the SSI
devices.

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;


  Commit: a3578d4a51250365fb7f048e8154942a2659cc4a
      https://github.com/qemu/qemu/commit/a3578d4a51250365fb7f048e8154942a2659cc4a
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-10-09 (Tue, 09 Oct 2012)

  Changed paths:
    M hw/Makefile.objs
    A hw/fifo.c
    A hw/fifo.h

  Log Message:
  -----------
  hw: Added generic FIFO API.

Added a FIFO API that can be used to create and operate byte FIFOs.

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;


  Commit: 82a2499011a73bcafab723e1bab4127e55a64844
      https://github.com/qemu/qemu/commit/82a2499011a73bcafab723e1bab4127e55a64844
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-10-09 (Tue, 09 Oct 2012)

  Changed paths:
    M default-configs/arm-softmmu.mak
    M default-configs/microblaze-softmmu.mak
    M default-configs/microblazeel-softmmu.mak
    M hw/Makefile.objs
    A hw/m25p80.c

  Log Message:
  -----------
  m25p80: Initial implementation of SPI flash device

Added device model for m25p80 style SPI flash family.

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;


  Commit: 929d1b52c43327b8a9e5a19f916ad6c9d1e6de5d
      https://github.com/qemu/qemu/commit/929d1b52c43327b8a9e5a19f916ad6c9d1e6de5d
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-10-09 (Tue, 09 Oct 2012)

  Changed paths:
    M hw/microblaze/Makefile.objs
    A hw/xilinx_spi.c

  Log Message:
  -----------
  xilinx_spi: Initial impl. of Xilinx SPI controller

Device model for xilinx XPS SPI controller (v2.0)

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;


  Commit: acd3b6be325a66f8f10f0eed19ed5261ced411cf
      https://github.com/qemu/qemu/commit/acd3b6be325a66f8f10f0eed19ed5261ced411cf
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-10-09 (Tue, 09 Oct 2012)

  Changed paths:
    M hw/petalogix_ml605_mmu.c

  Log Message:
  -----------
  petalogix-ml605: added SPI controller with n25q128

Added SPI controller to the reference design, with two n25q128 spi-flashes
connected.

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
Acked-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 94befa454d430655fc863a7a855302b80f7a4812
      https://github.com/qemu/qemu/commit/94befa454d430655fc863a7a855302b80f7a4812
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-10-09 (Tue, 09 Oct 2012)

  Changed paths:
    M hw/arm/Makefile.objs
    A hw/xilinx_spips.c

  Log Message:
  -----------
  xilinx_spips: Xilinx Zynq SPI cntrlr device model

Added device model for the Xilinx Zynq SPI controller (SPIPS).

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
Acked-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 559d489f137a696920d89ad2e3225b869c52b745
      https://github.com/qemu/qemu/commit/559d489f137a696920d89ad2e3225b869c52b745
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-10-09 (Tue, 09 Oct 2012)

  Changed paths:
    M hw/xilinx_zynq.c

  Log Message:
  -----------
  xilinx_zynq: Added SPI controllers + flashes

Added the two SPI controllers to the zynq machine model. Attached two SPI flash
devices to each controller.

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
Acked-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: fcb5629d3eb208d84c0fe9aa1ef64a6af7de0139
      https://github.com/qemu/qemu/commit/fcb5629d3eb208d84c0fe9aa1ef64a6af7de0139
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-10-09 (Tue, 09 Oct 2012)

  Changed paths:
    M MAINTAINERS

  Log Message:
  -----------
  MAINTAINERS: Added maintainerships for SSI

Added maintainership for SSI, M25P80 and the Xilinx SPI controllers.

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
Acked-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: b4ae3cfa57b8c1bdbbd7b7d420971e9171203ade
      https://github.com/qemu/qemu/commit/b4ae3cfa57b8c1bdbbd7b7d420971e9171203ade
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-10-09 (Tue, 09 Oct 2012)

  Changed paths:
    M hw/ssi.c
    M hw/ssi.h
    M hw/xilinx_spi.c
    M hw/xilinx_spips.c

  Log Message:
  -----------
  ssi: Add slave autoconnect helper

Added helper function to automatically connect SPI slaves based on the QOM child
nodes of a device. A SSI master device can call this routine to automatically
hook-up all child nodes to its SPI bus.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Acked-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


Compare: https://github.com/qemu/qemu/compare/4bb26682f70a...b4ae3cfa57b8

----==_mimepart_5074d6aaf1589_3b4d12ceaec1763e--


</body></email><email><emailId>20121012163047</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-12 16:30:47-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 0ec8df: qxl: always update displaysurface on resize</subject><body>



----==_mimepart_507845b72064d_1bef1284af04816b
Date: Fri, 12 Oct 2012 09:30:47 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;507845b727a92_1bef1284af04828d@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 0ec8df3974d2a4ff95b5fd4785b9bd3def7252f3
      https://github.com/qemu/qemu/commit/0ec8df3974d2a4ff95b5fd4785b9bd3def7252f3
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-07 (Sun, 07 Oct 2012)

  Changed paths:
    M hw/qxl-render.c

  Log Message:
  -----------
  qxl: always update displaysurface on resize

Don't try to be clever and skip displaysurface reinitialization in case
the size hasn't changed.  Other parameters might have changed
nevertheless, for example depth or stride, resulting in rendering being
broken then.

Trigger: boot linux guest with vesafb, start X11, make sure both vesafb
and X11 use the display same resolution.  Then watch X11 screen being
upside down.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 36a03e0ba5202cf49749b2128bb62d41983681d6
      https://github.com/qemu/qemu/commit/36a03e0ba5202cf49749b2128bb62d41983681d6
  Author: Michael Tokarev &lt;mjt@tls.msk.ru&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  qxl/update_area_io: cleanup invalid parameters handling

This cleans up two additions of almost the same code in commits
511b13e2c9 and ccc2960d654.  While at it, make error paths
consistent (always use 'break' instead of 'return').

Signed-off-by: Michael Tokarev &lt;mjt@tls.msk.ru&gt;
Cc: Dunrong Huang &lt;riegamaths@gmail.com&gt;
Cc: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: ffe01e599f106bedf13ba0e0f6956735b1942a0c
      https://github.com/qemu/qemu/commit/ffe01e599f106bedf13ba0e0f6956735b1942a0c
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  qxl: fix range check for rev3 io commands.

Enables QXL_IO_FLUSH_SURFACES_ASYNC and QXL_IO_FLUSH_RELEASE
which are part of the qxl rev3 feature set.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: e25a0651f4be22099122b5e14c77c354be0aa88b
      https://github.com/qemu/qemu/commit/e25a0651f4be22099122b5e14c77c354be0aa88b
  Author: Alon Levy &lt;alevy@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  hw/qxl: exit on failure to register qxl interface

This prevents a segfault later on when the device reset handler
tries to access a NULL ssd.worker since interface_attach_worker has
not been called.

Signed-off-by: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: d96aafca057845a4d58cd7b36771f2c97c78cd56
      https://github.com/qemu/qemu/commit/d96aafca057845a4d58cd7b36771f2c97c78cd56
  Author: Alon Levy &lt;alevy@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  hw/qxl: fix condition for exiting guest_bug

Reported and suggested by Paolo Bonzini, thanks.

Signed-off-by: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: c5825ac6c861bfe1a4adfa27517931b56079e298
      https://github.com/qemu/qemu/commit/c5825ac6c861bfe1a4adfa27517931b56079e298
  Author: Alon Levy &lt;alevy@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  hw/qxl: qxl_dirty_surfaces: use uintptr_t

As suggested by Paolo Bonzini, to avoid possible integer overflow issues.

Signed-off-by: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 67be6726b6459472103ee87ceaf2e8e97c154965
      https://github.com/qemu/qemu/commit/67be6726b6459472103ee87ceaf2e8e97c154965
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M configure
    M hw/qxl.c
    M ui/spice-core.c
    M ui/spice-display.c
    M ui/spice-display.h

  Log Message:
  -----------
  spice: raise requirement to 0.12

With the next qemu version (1.3) we are going to bump the qxl device
revision to 4.  The new features available require a recent spice-server
version, so raise up the bar.  Otherwise we would end up with different
qxl revisions depending on the spice-server version installed, which
would be a major PITA when it comes to compat properties.

Clear out a big bunch of #ifdefs which are not needed any more.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 591af14359f698d89cd334622237a20f19ae7060
      https://github.com/qemu/qemu/commit/591af14359f698d89cd334622237a20f19ae7060
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/pc_piix.c
    M hw/qxl.h

  Log Message:
  -----------
  qxl: set default revision to 4

Set qxl pci revision to 4 (for pc-1.3+) so guests know
spice-server 0.12 features are available.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 9e12c5aff2cfdd1574bf732c4bbf579d0c2e85c1
      https://github.com/qemu/qemu/commit/9e12c5aff2cfdd1574bf732c4bbf579d0c2e85c1
  Author: Jason Wang &lt;jasowang@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/rtl8139.c

  Log Message:
  -----------
  rtl8139: implement 8139cp link status

Add a link status chang callback and change the link status bit in BMSR
&amp; MSR accordingly. Tested in Linux/Windows guests.

The link status bit of MediaStatus is infered from BasicModeStatus,
they are inverse.

nc.link_down could not be migrated, this patch updates link_down in
rtl8139_post_load() to keep it coincident with real link status.

Signed-off-by: Jason Wang &lt;jasowang@redhat.com&gt;
Signed-off-by: Amos Kong &lt;akong@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: e4b823644044de1b8070fde82d0aad8053dc3333
      https://github.com/qemu/qemu/commit/e4b823644044de1b8070fde82d0aad8053dc3333
  Author: Amos Kong &lt;akong@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/e1000.c

  Log Message:
  -----------
  e1000: update nc.link_down in e1000_post_load()

This patch introduced e1000_post_load(), it will be called in the end of
migration. nc.link_down could not be migrated, this patch updates
link_down in e1000_post_load() to keep it coincident with real link
status.

Signed-off-by: Amos Kong &lt;akong@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: 9899148110627da388f82c02997bca6d678d1aa1
      https://github.com/qemu/qemu/commit/9899148110627da388f82c02997bca6d678d1aa1
  Author: Amos Kong &lt;akong@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/virtio-net.c

  Log Message:
  -----------
  virtio-net: update nc.link_down in virtio_net_load()

nc.link_down could not be migrated, this patch updates link_down in
virtio_post_load() to keep it coincident with real link status.

Signed-off-by: Amos Kong &lt;akong@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: a245fc18352fe286ba45ae0661a73b3841514889
      https://github.com/qemu/qemu/commit/a245fc18352fe286ba45ae0661a73b3841514889
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M net.c
    A net/clients.h
    M net/dump.c
    R net/dump.h
    M net/hub.c
    M net/hub.h
    M net/slirp.c
    M net/slirp.h
    M net/socket.c
    R net/socket.h
    M net/tap-win32.c
    M net/tap.c
    M net/tap.h
    M net/vde.c
    R net/vde.h

  Log Message:
  -----------
  net: consolidate NetClientState header files into one

This patch doesn't seem much useful alone, I must admit.  However,
it makes sense as part of the upcoming directory reorganization,
where I want to have include/net/tap.h as the net&lt;-&gt;hw interface
for tap.  Then having both net/tap.h and include/net/tap.h does
not work.  "Fixed" by moving all the init functions to a single
header file net/clients.h.

The patch also adopts a uniform style for including net/*.h files
from net/*.c, without the net/ path.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: ea486926b07d2ebd73ef67315ebb1eecf39faf5a
      https://github.com/qemu/qemu/commit/ea486926b07d2ebd73ef67315ebb1eecf39faf5a
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/vfio_pci.c
    M hw/vfio_pci_int.h

  Log Message:
  -----------
  vfio-pci: Update slow path INTx algorithm

We can't afford the overhead of switching out and back into mmap mode
around each interrupt, but we can do it lazily via a timer.  On INTx
interrupt, disable the mmap'd memory regions and set a timer.  On
every interrupt, push the timer out.  If the timer expires and the
interrupt is no longer pending, switch back to mmap mode.

This has the benefit that things like graphics cards, which rarely or
never, fire an interrupt don't need manual user intervention to add
the x-intx=off parameter.  They'll just remain in mmap mode until they
trigger an interrupt, and if they don't continue to regularly fire
interrupts, they'll switch back.

The default timeout is tuned for network cards so that a ping is just
enough to keep them in non-mmap mode, where they have much better
latency.  It is tunable with an experimental option,
x-intx-mmap-timeout-ms.  A value of 0 keeps the device in non-mmap
mode after the first interrupt.

It's possible we could look at the class code of devices and come up
with reasonable per-class defaults based on expected interrupt
frequency and latency.  None of this is used for MSI interrupts and
also won't be used if we can bypass through KVM.

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;


  Commit: af6bc27e39fafadbc03c8876ffa95851c5869683
      https://github.com/qemu/qemu/commit/af6bc27e39fafadbc03c8876ffa95851c5869683
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/vfio_pci.c

  Log Message:
  -----------
  vfio-pci: Re-order map/unmap

This cleans up the next patch that calls unmap from map.

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;


  Commit: 12af1344871aee4a8df011c3b0548f7c77332d54
      https://github.com/qemu/qemu/commit/12af1344871aee4a8df011c3b0548f7c77332d54
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/vfio_pci.c

  Log Message:
  -----------
  vfio-pci: Unmap and retry DMA mapping

Occasionally we get regions added that overlap with existing mappings.
These always seems to be in the VGA ROM range.  VFIO returns EBUSY
for these mapping attempts.  We can try a little harder and assume
that the latest mapping is correct by removing any overlapping ranges
and retrying the original request.

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;


  Commit: fd704adc479810477606c3418aeb64a590f51fe3
      https://github.com/qemu/qemu/commit/fd704adc479810477606c3418aeb64a590f51fe3
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/vfio_pci.c

  Log Message:
  -----------
  vfio-pci: Rework MSIX setup/teardown

We try to do lazy initialization of MSIX since we don't actually need
to setup anything until MSIX vectors start getting used.  This leads
to problems if MSIX is enabled, but never used (we can end up trying
to re-enable INTx while it's still enabled).  We also run into
problems trying to expand our reset function to tear down interrupts
as we can then get vector release notifications after we've released
data structures.  By making explicit initialization and teardown we
can avoid both of these problems and behave more similar to bare
metal.

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;


  Commit: 98cd5a5eaf4ad96d240e680eb1b26460dc278c33
      https://github.com/qemu/qemu/commit/98cd5a5eaf4ad96d240e680eb1b26460dc278c33
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/vfio_pci.c

  Log Message:
  -----------
  vfio-pci: No spurious MSIs

FreeBSD doesn't like these spurious MSIs, remove them as they're
mostly paranoia anyway.

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;


  Commit: 5c97e5eba665b66395eee87d88cf2f8301594145
      https://github.com/qemu/qemu/commit/5c97e5eba665b66395eee87d88cf2f8301594145
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/vfio_pci.c
    R hw/vfio_pci_int.h

  Log Message:
  -----------
  vfio-pci: Roll the header into the .c file

It's only ~100 lines and nobody else should be using this.
Suggested by Michael Tsirkin.

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;


  Commit: e43b9a5a4fb2b501fbbec411faff899b74a2d451
      https://github.com/qemu/qemu/commit/e43b9a5a4fb2b501fbbec411faff899b74a2d451
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/vfio_pci.c

  Log Message:
  -----------
  vfio-pci: Don't peak at msi_supported

Let the init function fail, just don't warn for -ENOTSUP.

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;


  Commit: 5976cdd58b657692e8c1af5310d55a60aecc9089
      https://github.com/qemu/qemu/commit/5976cdd58b657692e8c1af5310d55a60aecc9089
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/vfio_pci.c

  Log Message:
  -----------
  vfio-pci: Use uintptr_t for void* cast

We don't seem to run into any sign extension problems, but
unsigned looks more correct.

Signed-off-by: Alex williamson &lt;alex.williamson@redhat.com&gt;


  Commit: 9b1e45c8f1355592cb60c6aed9ac1f90b606a1a8
      https://github.com/qemu/qemu/commit/9b1e45c8f1355592cb60c6aed9ac1f90b606a1a8
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/vfio_pci.c

  Log Message:
  -----------
  vfio-pci: Remove setting of MSI qsize

This was a misinterpretation of the spec, hardware doesn't get to
specify how many were actually enabled through this field.

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;


  Commit: 5834a83f4803de88949162346e6dfa2060d3fca6
      https://github.com/qemu/qemu/commit/5834a83f4803de88949162346e6dfa2060d3fca6
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/vfio_pci.c

  Log Message:
  -----------
  vfio-pci: Extend reset

Take what we've learned from pci-assign and apply it to vfio-pci.
On reset, disable previous interrupt config, perform a device
reset if available, re-enable INTx, and disable memory regions on
the device to prevent continuing DMA.

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;


  Commit: ce59af2dba6fde2e3990b831f4c9a83641f5609e
      https://github.com/qemu/qemu/commit/ce59af2dba6fde2e3990b831f4c9a83641f5609e
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/vfio_pci.c

  Log Message:
  -----------
  vfio-pci: Cleanup on INTx setup failure

Missing some unwind code.

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;


  Commit: 1a40313381262ebb5f30fb95d5550b674280f396
      https://github.com/qemu/qemu/commit/1a40313381262ebb5f30fb95d5550b674280f396
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/vfio_pci.c

  Log Message:
  -----------
  vfio-pci: Clang cleanup

Blue Swirl reports that Clang doesn't like the structure we define to
avoid dynamic allocation for a number of calls to VFIO_DEVICE_SET_IRQS.
Adding an element after a variable sized type is a GNU extension.
Switch back to dynamic allocation, which really isn't a problem since
this is only done on interrupt setup changes.

Cc: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;


  Commit: 3a4f2816fac1b0f9cc197bb2208ddf03dc7bc592
      https://github.com/qemu/qemu/commit/3a4f2816fac1b0f9cc197bb2208ddf03dc7bc592
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-10-08 (Mon, 08 Oct 2012)

  Changed paths:
    M hw/vfio_pci.c

  Log Message:
  -----------
  vfio-pci: Fix BAR-&gt;VFIODevice translation in

DO_UPCAST is supposed to translate from the first member of a struct to
that struct, not from arbitrary ones. And it (usually) breaks the build
when neglecting this rule. Use container_of to fix the build breakage
and likely also the runtime behavior.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
aw: runtime behavior is actually the same, but clearly misuse of DO_UPCAST
Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;


  Commit: 785c23ae5cf1d697834a635daf45b0a6bd93c00f
      https://github.com/qemu/qemu/commit/785c23ae5cf1d697834a635daf45b0a6bd93c00f
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-10-09 (Tue, 09 Oct 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: add --localstatedir

Next commit wants to use it.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 6a3c8c14c8467c5db3539f1b6e43e03318e5e21b
      https://github.com/qemu/qemu/commit/6a3c8c14c8467c5db3539f1b6e43e03318e5e21b
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-10-09 (Tue, 09 Oct 2012)

  Changed paths:
    M qemu-ga.c

  Log Message:
  -----------
  qemu-ga: use state dir from CONFIG_QEMU_LOCALSTATEDIR

Has the side effect of changing the default directory used to
save the freeze status file from /tmp to ${prefix}/var/run.

This is a beneficial change for two reasons:

  1. FHS states that programs must not assume that files in /tmp will
     still exist between invocations of the program. This defeats
	 the purpose of the freeze status file

  2. FHS dictates that /var/run must be cleaned on boot, this
     ensures that a stale freeze status file will be removed on boot

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 9d6f1b73f83a02fb28438fa9a487f5c7d245e4af
      https://github.com/qemu/qemu/commit/9d6f1b73f83a02fb28438fa9a487f5c7d245e4af
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-10-09 (Tue, 09 Oct 2012)

  Changed paths:
    M qemu-ga.c

  Log Message:
  -----------
  qemu-ga: ga_open_pidfile(): add new line to pidfile

FHS requires that pid files should end with a new line. Also change to
snprintf() while there.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: dbbf01958e777b6f03fc4ab425879f84800b9cda
      https://github.com/qemu/qemu/commit/dbbf01958e777b6f03fc4ab425879f84800b9cda
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Change usbredir_open_chardev into usbredir_create_parser

As we need to create the parser at more places.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 5c16f767813602fbf57414e2a11057e252e0d422
      https://github.com/qemu/qemu/commit/5c16f767813602fbf57414e2a11057e252e0d422
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Don't make migration fail in none seamless case

Instead simple disconnect the device like host redirection does on
migration.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 883bca776daa43111e9c39008f0038f7c62ae723
      https://github.com/qemu/qemu/commit/883bca776daa43111e9c39008f0038f7c62ae723
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-11 (Thu, 11 Oct 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Raise interrupt when requested even for non active tds

According to the spec we must raise an interrupt when one is requested
even for non active tds.

Linux depends on this, for bulk transfers it runs an inactivity timer
to work around a bug in early uhci revisions, when we take longer then
200 ms to process a packet, this timer goes of, and as part of the
handling Linux then unlinks the qh, and relinks it after the frindex
has increased by atleast 1, the problem is Linux only checks for the
frindex increases on an interrupt, and we don't send that, causing
the qh to go inactive for more then 32 frames, at which point we
consider the packet cancelled.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 3f42ac89ba7197872c1bc6ddc850184fc83622a0
      https://github.com/qemu/qemu/commit/3f42ac89ba7197872c1bc6ddc850184fc83622a0
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M configure
    M hw/pc_piix.c
    M hw/qxl-render.c
    M hw/qxl.c
    M hw/qxl.h
    M ui/spice-core.c
    M ui/spice-display.c
    M ui/spice-display.h

  Log Message:
  -----------
  Merge remote-tracking branch 'spice/spice.v61' into staging

* spice/spice.v61:
  qxl: set default revision to 4
  spice: raise requirement to 0.12
  hw/qxl: qxl_dirty_surfaces: use uintptr_t
  hw/qxl: fix condition for exiting guest_bug
  hw/qxl: exit on failure to register qxl interface
  qxl: fix range check for rev3 io commands.
  qxl/update_area_io: cleanup invalid parameters handling
  qxl: always update displaysurface on resize


  Commit: 4336ef7a55751c867422c0df9f42877c5661c278
      https://github.com/qemu/qemu/commit/4336ef7a55751c867422c0df9f42877c5661c278
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M hw/e1000.c
    M hw/rtl8139.c
    M hw/virtio-net.c
    M net.c
    A net/clients.h
    M net/dump.c
    R net/dump.h
    M net/hub.c
    M net/hub.h
    M net/slirp.c
    M net/slirp.h
    M net/socket.c
    R net/socket.h
    M net/tap-win32.c
    M net/tap.c
    M net/tap.h
    M net/vde.c
    R net/vde.h

  Log Message:
  -----------
  Merge remote-tracking branch 'stefanha/net' into staging

* stefanha/net:
  net: consolidate NetClientState header files into one
  virtio-net: update nc.link_down in virtio_net_load()
  e1000: update nc.link_down in e1000_post_load()
  rtl8139: implement 8139cp link status


  Commit: 557e01a3f9956ba53f804a7394dc1ff2a9540109
      https://github.com/qemu/qemu/commit/557e01a3f9956ba53f804a7394dc1ff2a9540109
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M hw/vfio_pci.c
    R hw/vfio_pci_int.h

  Log Message:
  -----------
  Merge remote-tracking branch 'awilliam/tags/vfio-pci-for-qemu-20121008.0' into staging

* awilliam/tags/vfio-pci-for-qemu-20121008.0:
  vfio-pci: Fix BAR-&gt;VFIODevice translation in
  vfio-pci: Clang cleanup
  vfio-pci: Cleanup on INTx setup failure
  vfio-pci: Extend reset
  vfio-pci: Remove setting of MSI qsize
  vfio-pci: Use uintptr_t for void* cast
  vfio-pci: Don't peak at msi_supported
  vfio-pci: Roll the header into the .c file
  vfio-pci: No spurious MSIs
  vfio-pci: Rework MSIX setup/teardown
  vfio-pci: Unmap and retry DMA mapping
  vfio-pci: Re-order map/unmap
  vfio-pci: Update slow path INTx algorithm


  Commit: 453162e132023b319a23e6d7d25f51ba498105a7
      https://github.com/qemu/qemu/commit/453162e132023b319a23e6d7d25f51ba498105a7
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M configure
    M qemu-ga.c

  Log Message:
  -----------
  Merge remote-tracking branch 'mdroth/qga-pull-10-9-12' into staging

* mdroth/qga-pull-10-9-12:
  qemu-ga: ga_open_pidfile(): add new line to pidfile
  qemu-ga: use state dir from CONFIG_QEMU_LOCALSTATEDIR
  configure: add --localstatedir


  Commit: 628cc97df70476c9e1f30791dcfb70511bb1ebdd
      https://github.com/qemu/qemu/commit/628cc97df70476c9e1f30791dcfb70511bb1ebdd
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c
    M hw/usb/redirect.c

  Log Message:
  -----------
  Merge remote-tracking branch 'kraxel/usb.67' into staging

* kraxel/usb.67:
  uhci: Raise interrupt when requested even for non active tds
  usb-redir: Don't make migration fail in none seamless case
  usb-redir: Change usbredir_open_chardev into usbredir_create_parser


Compare: https://github.com/qemu/qemu/compare/b4ae3cfa57b8...628cc97df704

----==_mimepart_507845b72064d_1bef1284af04816b--


</body></email><email><emailId>20121012193010</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-12 19:30:10-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 1e14af: configure: Tidy up remnants of non-64-bit physaddr...</subject><body>



----==_mimepart_50786fc27d750_16eb1051ae4135427
Date: Fri, 12 Oct 2012 12:30:10 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50786fc280df8_16eb1051ae4135512@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 1e14afef00493bd375264dcea5fb8c7718b23355
      https://github.com/qemu/qemu/commit/1e14afef00493bd375264dcea5fb8c7718b23355
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: Tidy up remnants of non-64-bit physaddrs

Tidy up some remnants of code to support non-64-bit physaddrs
which were accidentally omitted from commit 4be403c8.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 2f5368017f8a0c00e982c3e315acb332a0907792
      https://github.com/qemu/qemu/commit/2f5368017f8a0c00e982c3e315acb332a0907792
  Author: MORITA Kazutaka &lt;morita.kazutaka@lab.ntt.co.jp&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M block/sheepdog.c

  Log Message:
  -----------
  sheepdog: use bool for boolean variables

This improves readability.

Signed-off-by: MORITA Kazutaka &lt;morita.kazutaka@lab.ntt.co.jp&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 417b0b88904fe1dd8c41bff8092dfbab0134d9cb
      https://github.com/qemu/qemu/commit/417b0b88904fe1dd8c41bff8092dfbab0134d9cb
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M ui/vnc.c

  Log Message:
  -----------
  vnc: fix "info vnc" with "-vnc ..., reverse=on"

When reverse connection is in use, there is no active VNC server
socket.  Because of this, getsockopt(-1, ...) is attempted and
the following error is emitted:

    $ socat TCP-LISTEN:5900,reuseaddr TCP-LISTEN:5901,reuseaddr &amp;
    $ x86_64-softmmu/qemu-system-x86_64 -vnc localhost:5900,reverse -monitor stdio
    QEMU 1.2.50 monitor - type 'help' for more information
    (qemu) info vnc
    An undefined error has occurred

Because however the host, family, service and auth fields are
optional, we can just exit if there is no active server socket.

    $ x86_64-softmmu/qemu-system-x86_64 -vnc localhost:5900,reverse -monitor stdio
    QEMU 1.2.50 monitor - type 'help' for more information
    (qemu) info vnc
    Server:
    Client:
   address: 127.0.0.1:5900
      x509_dname: none
  username: none

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 884285bf646d93e9dfa4a605bca9f8dc5280b23d
      https://github.com/qemu/qemu/commit/884285bf646d93e9dfa4a605bca9f8dc5280b23d
  Author: Soren Brinkmann &lt;soren.brinkmann@xilinx.com&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M hw/cadence_ttc.c

  Log Message:
  -----------
  cadence_ttc: Fix 'clear on read' behavior

A missing call to qemu_set_irq() when reading the IRQ register
required SW to write to the IRQ register to acknowledge an
interrupt. With this patch the behavior is fixed:
 - Reading the interrupt register clears it and updates the timers
   interrupt status
 - Writes to the interrupt register are ignored

Signed-off-by: Soren Brinkmann &lt;soren.brinkmann@xilinx.com&gt;
Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 9ab1b6053f03d58ba8e7accc8f19c882fbffb66f
      https://github.com/qemu/qemu/commit/9ab1b6053f03d58ba8e7accc8f19c882fbffb66f
  Author: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M hw/arm_gic.c

  Log Message:
  -----------
  hw/arm_gic.c: Fix improper DPRINTF output.

s-&gt;cpu_enabled is an array, so s-&gt;cpu_enabled ? "En" : "Dis" returns
"En" always. We should use s-&gt;cpu_enabled[cpu] here.

Signed-off-by: Evgeny Voevodin &lt;e.voevodin@samsung.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: ba4906a9b64e165a958e12f6208ca834dc7a36dc
      https://github.com/qemu/qemu/commit/ba4906a9b64e165a958e12f6208ca834dc7a36dc
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M hw/ds1338.c

  Log Message:
  -----------
  hw/ds1338: Fix mishandling of register pointer

Correct several deficiencies in the handling of the register pointer:
 * it should wrap around after 0x3f, not 0xff
 * guard against the caller handing us an out of range pointer
   (on h/w this can never happen, because only a 7 bit value is
   transferred over the I2C bus)
 * there was confusion over whether nvram[] holds only the 56 bytes
   of guest-accessible NVRAM, or also the secondary registers
   which hold the value of the clock captured at the start of a
   multibyte read. Correct to consistently be the latter, by fixing
   the array size and the offset used for NVRAM writes.
 * ds1338_send was attempting to use 'data' as both the data and
   the register offset simultaneously, which meant that writes to
   any register were broken; fix to use the register pointer.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 35b87a861394ed088c4db3b7ba9a67d8bb2b289e
      https://github.com/qemu/qemu/commit/35b87a861394ed088c4db3b7ba9a67d8bb2b289e
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M hw/ds1338.c

  Log Message:
  -----------
  hw/ds1338: Recapture current time when register pointer wraps around

The DS1338 datasheet documents that the current time is captured into
the secondary registers when the register pointer wraps round to zero
as well as at a START condition. Implement this.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 7f7fd0f2e4d6b4f2ec137cda67f6c9a140668ea3
      https://github.com/qemu/qemu/commit/7f7fd0f2e4d6b4f2ec137cda67f6c9a140668ea3
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M hw/ds1338.c

  Log Message:
  -----------
  hw/ds1338: Remove 'now' field from state struct

The 'struct tm now' field in the state structure is in fact only
ever used as a temporary (the actual RTC state is held in 'offset').
Remove it from the state structure in favour of using local variables
to avoid confusion about whether it needs to be saved on migration.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: f4741402ab8afe9014b6a54aed4cb0423041dbcb
      https://github.com/qemu/qemu/commit/f4741402ab8afe9014b6a54aed4cb0423041dbcb
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M hw/ds1338.c

  Log Message:
  -----------
  hw/ds1338: Implement state save/restore

Implement state save/restore for the DS1338. This requires
the usual minor adjustment of types in the state struct to
get fixed-width ones with vmstate macros.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 853e65e0b45403477c8a89afdb4c0abd4c3f97da
      https://github.com/qemu/qemu/commit/853e65e0b45403477c8a89afdb4c0abd4c3f97da
  Author: Jean-Christophe PLAGNIOL-VILLARD &lt;plagnioj@jcrosoft.com&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M hw/versatilepb.c

  Log Message:
  -----------
  versatilepb: add gpio pl061 support

Signed-off-by: Jean-Christophe PLAGNIOL-VILLARD &lt;plagnioj@jcrosoft.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: fa2ddcb4f5f33c07c68cec67615c88a98fab02de
      https://github.com/qemu/qemu/commit/fa2ddcb4f5f33c07c68cec67615c88a98fab02de
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M hw/zynq_slcr.c

  Log Message:
  -----------
  zynq_slcr: Fixed ResetValues enum

There is a gap in the reset region of the address space at offset 0x208. This
throws out all these enum values by one when translating them to address offsets.
Fixed by putting the corresponding gap in the enum as well.

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: fae15286751d8a8209724b14b62d065f1111e621
      https://github.com/qemu/qemu/commit/fae15286751d8a8209724b14b62d065f1111e621
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M hw/arm_gic.c
    M hw/arm_gic_common.c
    M hw/arm_gic_internal.h
    M hw/armv7m_nvic.c

  Log Message:
  -----------
  arm_gic: Rename gic_state to GICState

Rename the gic_state struct to match QEMU's coding style conventions
for structure names, since the impending KVM-for-ARM patches will
create another subclass of it. This patch was created using:
  sed -i 's/gic_state/GICState/g' hw/arm_gic.c hw/arm_gic_common.c \
    hw/arm_gic_internal.h hw/armv7m_nvic.c

Acked-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 5d9619aa1fc348fe8894553c15c1ec886fa33939
      https://github.com/qemu/qemu/commit/5d9619aa1fc348fe8894553c15c1ec886fa33939
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M block/sheepdog.c
    M configure
    M ui/vnc.c

  Log Message:
  -----------
  Merge remote-tracking branch 'stefanha/trivial-patches' into staging

* stefanha/trivial-patches:
  vnc: fix "info vnc" with "-vnc ..., reverse=on"
  sheepdog: use bool for boolean variables
  configure: Tidy up remnants of non-64-bit physaddrs


  Commit: ae72f3f5391cc761665824eeea542d3c5ad7ca67
      https://github.com/qemu/qemu/commit/ae72f3f5391cc761665824eeea542d3c5ad7ca67
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M hw/arm_gic.c
    M hw/arm_gic_common.c
    M hw/arm_gic_internal.h
    M hw/armv7m_nvic.c
    M hw/cadence_ttc.c
    M hw/ds1338.c
    M hw/versatilepb.c
    M hw/zynq_slcr.c

  Log Message:
  -----------
  Merge remote-tracking branch 'pmaydell/arm-devs.for-upstream' into staging

* pmaydell/arm-devs.for-upstream:
  arm_gic: Rename gic_state to GICState
  zynq_slcr: Fixed ResetValues enum
  versatilepb: add gpio pl061 support
  hw/ds1338: Implement state save/restore
  hw/ds1338: Remove 'now' field from state struct
  hw/ds1338: Recapture current time when register pointer wraps around
  hw/ds1338: Fix mishandling of register pointer
  hw/arm_gic.c: Fix improper DPRINTF output.
  cadence_ttc: Fix 'clear on read' behavior


Compare: https://github.com/qemu/qemu/compare/628cc97df704...ae72f3f5391c

----==_mimepart_50786fc27d750_16eb1051ae4135427--


</body></email><email><emailId>20121013143009</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-13 14:30:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 0fa2a0: target-sparc: Fix optimized %icc comparisons</subject><body>



----==_mimepart_50797af1dcd67_766616fbae81254b0
Date: Sat, 13 Oct 2012 07:30:09 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50797af1dfe63_766616fbae8125527@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 0fa2a0660c7516d13bc149ff9a3b417e9778137e
      https://github.com/qemu/qemu/commit/0fa2a0660c7516d13bc149ff9a3b417=
e9778137e
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-13 (Sat, 13 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Fix optimized %icc comparisons

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Tested-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 96b5a3d3cf49d27e6da7ceac683a1b38d122e6fa
      https://github.com/qemu/qemu/commit/96b5a3d3cf49d27e6da7ceac683a1b3=
8d122e6fa
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-13 (Sat, 13 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Optimize CC_OP_LOGIC conditions

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 6234ac09a947d1402f92b6d25ccea6faa4433b5b
      https://github.com/qemu/qemu/commit/6234ac09a947d1402f92b6d25ccea6f=
aa4433b5b
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-13 (Sat, 13 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Avoid unnecessary local temporaries

Now that save_state never ends a BB, we don't need to copy
values into local temps around it.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 20132b96055e1da1d114067c15bf53e78a25d1c4
      https://github.com/qemu/qemu/commit/20132b96055e1da1d114067c15bf53e=
78a25d1c4
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-13 (Sat, 13 Oct 2012)

  Changed paths:
    M linux-user/main.c
    M target-sparc/int32_helper.c
    M target-sparc/int64_helper.c
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Don't compute full flags value so often

Avoid speculatively computing flags before every potentially trapping
operation and instead do the flags computation when a trap actually
occurs.  This gives approximately 30% speedup in emulation.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 24c7f75459a042ac5467e0efdcb67e6c2127d5ea
      https://github.com/qemu/qemu/commit/24c7f75459a042ac5467e0efdcb67e6=
c2127d5ea
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-13 (Sat, 13 Oct 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Fix brcond2

Much the same problem as recently fixed for hppa.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: ded37f0d96f81b6294c728d4693d9880135e3cb9
      https://github.com/qemu/qemu/commit/ded37f0d96f81b6294c728d4693d988=
0135e3cb9
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-13 (Sat, 13 Oct 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c
    M tcg/sparc/tcg-target.h

  Log Message:
  -----------
  tcg-sparc: Implement movcond.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: dda73c782ffb1333eaf96444e27dcce5bc658454
      https://github.com/qemu/qemu/commit/dda73c782ffb1333eaf96444e27dcce=
5bc658454
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-13 (Sat, 13 Oct 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Fix setcond2

Like brcond2, use tcg_high_cond.  Use movcc instead of branches.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: a7a49843d70232e0f179e1da330355e5f03ab182
      https://github.com/qemu/qemu/commit/a7a49843d70232e0f179e1da330355e=
5f03ab182
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-13 (Sat, 13 Oct 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Fix qemu_st for 32-bit

The datalo variable is still live in the miss path.  Use another
when reconstructing the full data value.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 7d458a7567ffde5b16d7a4b5e9f585434b2afc35
      https://github.com/qemu/qemu/commit/7d458a7567ffde5b16d7a4b5e9f5854=
34b2afc35
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-13 (Sat, 13 Oct 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Fix setcond

The set of comparisons that can immediately use the carry are LTU/GEU,
not LTU/LEU.  Don't swap operands when we need a temp register; the
register may already be in use from setcond2.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 4ec28e255f532c245cb477d49d0793af657e4149
      https://github.com/qemu/qemu/commit/4ec28e255f532c245cb477d49d0793a=
f657e4149
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-13 (Sat, 13 Oct 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Fix add2/sub2

We must care not to clobber the high parts before we consume them.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 89269f6cea17d8381e0c366c44780f58ac3c67d8
      https://github.com/qemu/qemu/commit/89269f6cea17d8381e0c366c44780f5=
8ac3c67d8
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-13 (Sat, 13 Oct 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c
    M tcg/sparc/tcg-target.h

  Log Message:
  -----------
  tcg-sparc: Use Z constraint for %g0

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: fd84ea2391c044a7840c25dd35336bdaf2a302d0
      https://github.com/qemu/qemu/commit/fd84ea2391c044a7840c25dd35336bd=
af2a302d0
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-13 (Sat, 13 Oct 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Optimize setcond2 equality compare with 0.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: a115f3ea47cbd3ae64c754779321264857ab5bde
      https://github.com/qemu/qemu/commit/a115f3ea47cbd3ae64c754779321264=
857ab5bde
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-13 (Sat, 13 Oct 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Drop use of Bicc in favor of BPcc

Now that we're always sparcv9, we can not bother using Bicc for
32-bit branches and BPcc for 64-bit branches and instead always
use BPcc.

New interfaces allow less direct use of tcg_out32 and raw numbers
inside the qemu_ld/st routines.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 345ce423dd58b3ddc3cfbcbb1ca2eee25546e8be
      https://github.com/qemu/qemu/commit/345ce423dd58b3ddc3cfbcbb1ca2eee=
25546e8be
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-13 (Sat, 13 Oct 2012)

  Changed paths:
    M sparc-dis.c

  Log Message:
  -----------
  tcg-sparc: Dump illegal opode contents

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: ab1339b9b40752d076ae9784ed07f14194f130bd
      https://github.com/qemu/qemu/commit/ab1339b9b40752d076ae9784ed07f14=
194f130bd
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-13 (Sat, 13 Oct 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Emit BPr insns for brcond_i64

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 203342d8dc852bc09488e9dc5b853aa48aeed14c
      https://github.com/qemu/qemu/commit/203342d8dc852bc09488e9dc5b853aa=
48aeed14c
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-13 (Sat, 13 Oct 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Emit MOVR insns for setcond_i64 and movcond_64

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: e0bbf9b573e1a19a906abef861ee28293e44b3a2
      https://github.com/qemu/qemu/commit/e0bbf9b573e1a19a906abef861ee282=
93e44b3a2
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-13 (Sat, 13 Oct 2012)

  Changed paths:
    M hw/sun4m.c

  Log Message:
  -----------
  sun4m: Pass SPARCCPU to cpu_set_irq()

Needed for changing cpu_kick_irq() argument type to SPARCCPU.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 38c66cf2817366fd56af7cd2099a696d715365ce
      https://github.com/qemu/qemu/commit/38c66cf2817366fd56af7cd2099a696=
d715365ce
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-13 (Sat, 13 Oct 2012)

  Changed paths:
    M hw/sun4m.c

  Log Message:
  -----------
  sun4m: Pass SPARCCPU to cpu_kick_irq()

Needed for changing qemu_cpu_kick() argument type to CPUState.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 6b678e1f9b92e21ee2e2614440740ca76fc7d2d8
      https://github.com/qemu/qemu/commit/6b678e1f9b92e21ee2e2614440740ca=
76fc7d2d8
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-13 (Sat, 13 Oct 2012)

  Changed paths:
    M hw/sun4u.c

  Log Message:
  -----------
  sun4u: Pass SPARCCPU to {,s,hs}tick_irq() and cpu_timer_create()

Needed for changing cpu_kick_irq() argument type to SPARCCPU.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: ce18c558f08ea392b2ec79046eb40e791be5fc88
      https://github.com/qemu/qemu/commit/ce18c558f08ea392b2ec79046eb40e7=
91be5fc88
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-13 (Sat, 13 Oct 2012)

  Changed paths:
    M hw/sun4u.c

  Log Message:
  -----------
  sun4u: Pass SPARCCPU to cpu_kick_irq()

Needed for changing qemu_cpu_kick() argument type to CPUState.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: b64ba4b232e776d891a7a5137a6129221b6a9cd0
      https://github.com/qemu/qemu/commit/b64ba4b232e776d891a7a5137a61292=
21b6a9cd0
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-13 (Sat, 13 Oct 2012)

  Changed paths:
    M hw/sun4u.c

  Log Message:
  -----------
  sun4u: Pass SPARCCPU to cpu_set_ivec_irq()

Needed for moving halted field to CPUState.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/ae72f3f5391c...b64ba4b232e7=


----==_mimepart_50797af1dcd67_766616fbae81254b0--


</body></email><email><emailId>20121014110008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-14 11:00:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 8b4a3d: Fix popcnt in long mode</subject><body>



----==_mimepart_507a9b38520eb_1fa11c6faec50111
Date: Sun, 14 Oct 2012 04:00:08 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;507a9b38534f1_1fa11c6faec50231@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 8b4a3df8081f3e6f1061ed5cbb303ad623ade66b
      https://github.com/qemu/qemu/commit/8b4a3df8081f3e6f1061ed5cbb303ad623ade66b
  Author: malc &lt;av1474@comtv.ru&gt;
  Date:   2012-10-14 (Sun, 14 Oct 2012)

  Changed paths:
    M target-i386/translate.c

  Log Message:
  -----------
  Fix popcnt in long mode

Thanks to Andriy Gapon for initial problem report.

Signed-off-by: malc &lt;av1474@comtv.ru&gt;




----==_mimepart_507a9b38520eb_1fa11c6faec50111--


</body></email><email><emailId>20121016233008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-16 23:30:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 7fc645: tcg/arm: Factor out code to emit immediate or reg-...</subject><body>



----==_mimepart_507dee00db1c4_5b8b187bae41068cd
Date: Tue, 16 Oct 2012 16:30:08 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;507dee00dd23b_5b8b187bae4106921@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 7fc645bf7a313d75904f8901f4e231008e79999a
      https://github.com/qemu/qemu/commit/7fc645bf7a313d75904f8901f4e231008e79999a
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-16 (Tue, 16 Oct 2012)

  Changed paths:
    M tcg/arm/tcg-target.c

  Log Message:
  -----------
  tcg/arm: Factor out code to emit immediate or reg-reg op

The code to emit either an immediate cmp or a register cmp insn is
duplicated in several places; factor it out into its own function.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 4a1d241e3cc0a0cacb5de9084a4edb543d529d51
      https://github.com/qemu/qemu/commit/4a1d241e3cc0a0cacb5de9084a4edb543d529d51
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-16 (Tue, 16 Oct 2012)

  Changed paths:
    M tcg/arm/tcg-target.c
    M tcg/arm/tcg-target.h

  Log Message:
  -----------
  tcg/arm: Implement movcond_i32

Implement movcond_i32 for ARM, as the sequence
  mov dst, v2   (implicitly done by the tcg common code)
  cmp c1, c2
  movCC dst, v1

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: da897bf5ae2d0276dcabe941ba3a402aa718b740
      https://github.com/qemu/qemu/commit/da897bf5ae2d0276dcabe941ba3a402aa718b740
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-16 (Tue, 16 Oct 2012)

  Changed paths:
    M tcg/ia64/tcg-target.c

  Log Message:
  -----------
  tcg/ia64: use stack for TCG temps

Use stack instead of temp_buf array in CPUState for TCG temps.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: b90cf716928d7934f4c1392f9097247a84b295d2
      https://github.com/qemu/qemu/commit/b90cf716928d7934f4c1392f9097247a84b295d2
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-16 (Tue, 16 Oct 2012)

  Changed paths:
    M tcg/ia64/tcg-target.c
    M tcg/ia64/tcg-target.h

  Log Message:
  -----------
  tcg/ia64: implement movcond_i32/64

Implement movcond_i32/64 on ia64 hosts. It is not possible to have
immediate compare arguments without adding a new bundle, but it is
possible to have 22-bit immediate value arguments.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 2174d1e1ff3522f6f64260bad460185b7ca5bd26
      https://github.com/qemu/qemu/commit/2174d1e1ff3522f6f64260bad460185b7ca5bd26
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-16 (Tue, 16 Oct 2012)

  Changed paths:
    M tcg/ia64/tcg-target.c

  Log Message:
  -----------
  tcg/ia64: remove suboptimal register shifting in qemu_ld/st ops

Remove suboptimal register shifting in qemu_ld/st ops, introduced at the
CONFIG_TCG_PASS_AREG0 time.

As mem_idx is now loaded in register R58/R59 for the slow path, we have
to make sure to do it last, to not add additional register constraints.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 63975ea7dfb3ec258433c782c2455bf64fab5e49
      https://github.com/qemu/qemu/commit/63975ea7dfb3ec258433c782c2455bf64fab5e49
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-16 (Tue, 16 Oct 2012)

  Changed paths:
    M tcg/ia64/tcg-target.c

  Log Message:
  -----------
  tcg/ia64: slightly optimize TLB access code

It is possible to slightly optimize the TLB access code, by replacing
the movi + and instructions by a deposit instruction.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: c7d4475a701c61f964a593d6fe81a8ea7a33add7
      https://github.com/qemu/qemu/commit/c7d4475a701c61f964a593d6fe81a8ea7a33add7
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-16 (Tue, 16 Oct 2012)

  Changed paths:
    M tcg/ia64/tcg-target.c
    M tcg/ia64/tcg-target.h

  Log Message:
  -----------
  tcg-ia64: Implement deposit

Note that in the general reg=reg,reg case we're restricted
to 16-bit insertions.  This makes it easy to allow "any"
constant as input, as post-truncation it will fit into the
constant load insn for which we have room in the bundle.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


Compare: https://github.com/qemu/qemu/compare/8b4a3df8081f...c7d4475a701c

----==_mimepart_507dee00db1c4_5b8b187bae41068cd--


</body></email><email><emailId>20121017073008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-17 07:30:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 81bad5: target-mips: Clean up other_cpu in helper_{d, e}vpe...</subject><body>



----==_mimepart_507e5e802ee5_14921d39af46931d
Date: Wed, 17 Oct 2012 00:30:08 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;507e5e804083_14921d39af4694e1@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 81bad50ec40311797c38a7691844c7d2df9b3823
      https://github.com/qemu/qemu/commit/81bad50ec40311797c38a7691844c7d=
2df9b3823
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-16 (Tue, 16 Oct 2012)

  Changed paths:
    M target-mips/op_helper.c

  Log Message:
  -----------
  target-mips: Clean up other_cpu in helper_{d,e}vpe()

Free the variable name "other_cpu" for later use for MIPSCPU.

Fix off-by-one indentation while at it.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 135dd63a190a084fa5e9f1b4695397016bf0ce5a
      https://github.com/qemu/qemu/commit/135dd63a190a084fa5e9f1b46953970=
16bf0ce5a
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-16 (Tue, 16 Oct 2012)

  Changed paths:
    M target-mips/op_helper.c

  Log Message:
  -----------
  target-mips: Pass MIPSCPU to mips_tc_wake()

Needed for changing mips_vpe_is_wfi() argument type to MIPSCPU.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: b35d77d73c0fc0b60c9937471a17d41c6fb32947
      https://github.com/qemu/qemu/commit/b35d77d73c0fc0b60c9937471a17d41=
c6fb32947
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-16 (Tue, 16 Oct 2012)

  Changed paths:
    M target-mips/op_helper.c

  Log Message:
  -----------
  target-mips: Pass MIPSCPU to mips_vpe_is_wfi()

Needed for moving halted field to CPUState.
The variable name "c" is retained for MIPSCPU to leave "cpu" for CPUState=
.

Also change return type to bool while at it.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: c6679e9038027e28b0360039d2bb7d3aa55b934e
      https://github.com/qemu/qemu/commit/c6679e9038027e28b0360039d2bb7d3=
aa55b934e
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-16 (Tue, 16 Oct 2012)

  Changed paths:
    M target-mips/op_helper.c

  Log Message:
  -----------
  target-mips: Pass MIPSCPU to mips_tc_sleep()

Needed for changing mips_vpe_sleep() argument type to MIPSCPU.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 6f4d6b09088ee161ff4be0e4db4e4c0962c79070
      https://github.com/qemu/qemu/commit/6f4d6b09088ee161ff4be0e4db4e4c0=
962c79070
  Author: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
  Date:   2012-10-16 (Tue, 16 Oct 2012)

  Changed paths:
    M target-mips/op_helper.c

  Log Message:
  -----------
  target-mips: Pass MIPSCPU to mips_vpe_sleep()

Needed for moving halted field to CPUState.

Signed-off-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


Compare: https://github.com/qemu/qemu/compare/c7d4475a701c...6f4d6b09088e=


----==_mimepart_507e5e802ee5_14921d39af46931d--


</body></email><email><emailId>20121017170013</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-17 17:00:13-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 24c9ae: tcg: Split out swap_commutative as a subroutine</subject><body>



----==_mimepart_507ee41d1a158_7af11772ae4133cf
Date: Wed, 17 Oct 2012 10:00:13 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;507ee41d1d205_7af11772ae4134fd@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 24c9ae4eba5eec59256d0d0ace4d868a19f87528
      https://github.com/qemu/qemu/commit/24c9ae4eba5eec59256d0d0ace4d868a19f87528
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg: Split out swap_commutative as a subroutine

Reduces code duplication and prefers

  movcond d, c1, c2, const, s
to
  movcond d, c1, c2, s, const

It also prefers

  add r, r, c
over
  add r, c, r

when both inputs are known constants.  This doesn't matter for true add, as
we will fully constant fold that.  But it matters for a follow-on patch using
this routine for add2 which may not be fully foldable.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 1e484e61e2d9387c18a40e9e239b304003f5d183
      https://github.com/qemu/qemu/commit/1e484e61e2d9387c18a40e9e239b304003f5d183
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg: Canonicalize add2 operand ordering

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 0bfcb86538d0bcffa3ef5434810f91aa861431ce
      https://github.com/qemu/qemu/commit/0bfcb86538d0bcffa3ef5434810f91aa861431ce
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg: Swap commutative double-word comparisons

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 6e14e91b6681dac9614b7b09b561351813046193
      https://github.com/qemu/qemu/commit/6e14e91b6681dac9614b7b09b561351813046193
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg: Use common code when failing to optimize

This saves a whole lot of repetitive code sequences.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: bc1473eff4d9a3b62d669b7232383f85eb82b376
      https://github.com/qemu/qemu/commit/bc1473eff4d9a3b62d669b7232383f85eb82b376
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg: Optimize double-word comparisons against zero

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 9519da7e39516c5cb5bd7146a849a5d8c0958105
      https://github.com/qemu/qemu/commit/9519da7e39516c5cb5bd7146a849a5d8c0958105
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg: Split out subroutines from do_constant_folding_cond

We can re-use these for implementing double-word folding.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 6c4382f8f47d12eec24c7c5335141a9c78104016
      https://github.com/qemu/qemu/commit/6c4382f8f47d12eec24c7c5335141a9c78104016
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg: Do constant folding on double-word comparisons

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 212c328d615f6750659d39c6fd544d05be314fa1
      https://github.com/qemu/qemu/commit/212c328d615f6750659d39c6fd544d05be314fa1
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M tcg/optimize.c
    M tcg/tcg-op.h

  Log Message:
  -----------
  tcg: Constant fold add2 and sub2

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 1305c451e67e3def030720013415103f5e0f5e11
      https://github.com/qemu/qemu/commit/1305c451e67e3def030720013415103f5e0f5e11
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M tcg/tcg.c

  Log Message:
  -----------
  tcg: Optimize half-dead add2/sub2

When x86_64 guest is not in 64-bit mode, the high-part of the 64-bit
add is dead.  When the host is 32-bit, we can simplify to 32-bit
arithmetic.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 1414968a6aecd23cb037bc9e718d6f05ead2afaf
      https://github.com/qemu/qemu/commit/1414968a6aecd23cb037bc9e718d6f05ead2afaf
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M tcg/optimize.c
    M tcg/tcg-op.h
    M tcg/tcg.c

  Log Message:
  -----------
  tcg: Optimize mulu2

Like add2, do operand ordering, constant folding, and dead operand
elimination.  The latter happens about 15% of all mulu2 during an
x86_64 bios boot.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


Compare: https://github.com/qemu/qemu/compare/6f4d6b09088e...1414968a6aec

----==_mimepart_507ee41d1a158_7af11772ae4133cf--


</body></email><email><emailId>20121017183010</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-17 18:30:10-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] b6348f: target-arm/translate: Fix RRX operands</subject><body>



----==_mimepart_507ef93270da5_1f39d84af0737cf
Date: Wed, 17 Oct 2012 11:30:10 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;507ef93272a9c_1f39d84af073899@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: b6348f29d033d5a8a26f633d2ee94362595f32a4
      https://github.com/qemu/qemu/commit/b6348f29d033d5a8a26f633d2ee94362595f32a4
  Author: Peter Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M target-arm/translate.c

  Log Message:
  -----------
  target-arm/translate: Fix RRX operands

Instructions that both use the RRX second operand and update CS were
incorrect, as the Carry flag was updated too early. An example of such an
instruction would be:

ands r12,r13,RRX

Ands, because of the "s" flag will update the carry flag. But the RRX second
operand rotates through the C flag which should happen before the update.
Fixed the ordering of the two, the old carry is read by "r13,RRX" before being
updated.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
Reported-by: Vinesh Peringat &lt;vineshp@xilinx.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;




----==_mimepart_507ef93270da5_1f39d84af0737cf--


</body></email><email><emailId>20121019113008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-19 11:30:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] a5b3bd: microblaze: Support setting of TLS ptr</subject><body>



----==_mimepart_508139c08c670_3b73fdbaec474a0
Date: Fri, 19 Oct 2012 04:30:08 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;508139c08dc33_3b73fdbaec475ae@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: a5b3bdcba8a105439ad3a44121526306c449e100
      https://github.com/qemu/qemu/commit/a5b3bdcba8a105439ad3a44121526306c449e100
  Author: Edgar E. Iglesias &lt;edgar.iglesias@gmail.com&gt;
  Date:   2012-10-19 (Fri, 19 Oct 2012)

  Changed paths:
    M linux-user/syscall.c
    M target-microblaze/cpu.h

  Log Message:
  -----------
  microblaze: Support setting of TLS ptr

Signed-off-by: Edgar E. Iglesias &lt;edgar.iglesias@gmail.com&gt;


  Commit: d7dce494769e47c9a1eec6f55578d3acdfab888b
      https://github.com/qemu/qemu/commit/d7dce494769e47c9a1eec6f55578d3acdfab888b
  Author: Edgar E. Iglesias &lt;edgar.iglesias@gmail.com&gt;
  Date:   2012-10-19 (Fri, 19 Oct 2012)

  Changed paths:
    M linux-user/main.c

  Log Message:
  -----------
  microblaze: Update PC before simulating syscall

Fixes a clone() emulation bug were the new thread starts
at the point of the syscall and thus clones in a loop.

Signed-off-by: Edgar E. Iglesias &lt;edgar.iglesias@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/b6348f29d033...d7dce494769e

----==_mimepart_508139c08c670_3b73fdbaec474a0--


</body></email><email><emailId>20121019193013</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-19 19:30:13-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 229d33: linux-user: fix statfs</subject><body>



----==_mimepart_5081aa45604f2_2314153faec14046
Date: Fri, 19 Oct 2012 12:30:13 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;5081aa4563d69_2314153faec141a5@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 229d3376a38bf97aa09b6f73a957c5389badcd06
      https://github.com/qemu/qemu/commit/229d3376a38bf97aa09b6f73a957c5389badcd06
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M linux-user/syscall.c

  Log Message:
  -----------
  linux-user: fix statfs

The statfs syscall should always memset(0) its full struct extent before
writing to it. Newer versions of the syscall use one of the reserved fields
for flags, which would otherwise get stale values from uncleaned memory.

This fixes libarchive for me, which got confused about the return value of
pathconf("/", _PC_REC_XFER_ALIGN) otherwise, as it some times gave old pointers
as return value.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Riku Voipio &lt;riku.voipio@linaro.org&gt;


  Commit: 1bdd7c7ea8a711efcb5141663865cc1f7e4e824d
      https://github.com/qemu/qemu/commit/1bdd7c7ea8a711efcb5141663865cc1f7e4e824d
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M linux-user/syscall.c

  Log Message:
  -----------
  linux-user: fix multi-threaded /proc/self/maps

When reading our faked /proc/self/maps from a secondary thread,
we get an invalid stack entry. This is because ts-&gt;stack_base is not
initialized in non-primary threads.

However, ts-&gt;info is, and the stack layout information we're looking
for is there too. So let's use that one instead!

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Riku Voipio &lt;riku.voipio@linaro.org&gt;


  Commit: f287b2c2d4d20d35880ab6dca44bda0476e67dce
      https://github.com/qemu/qemu/commit/f287b2c2d4d20d35880ab6dca44bda0476e67dce
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M linux-user/syscall.c

  Log Message:
  -----------
  linux-user: Perform more checks on iovec lists

Validate count between 0 and IOV_MAX.  Limit total length of
operation in the same way the kernel does.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Riku Voipio &lt;riku.voipio@linaro.org&gt;


  Commit: 3d21d29c32380384e5ee5b804d0b0bf720469d97
      https://github.com/qemu/qemu/commit/3d21d29c32380384e5ee5b804d0b0bf720469d97
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M linux-user/syscall.c

  Log Message:
  -----------
  linux-user: Implement gethostname

Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Riku Voipio &lt;riku.voipio@linaro.org&gt;


  Commit: b7fb2310136090aab86004363f7c031b30845f2f
      https://github.com/qemu/qemu/commit/b7fb2310136090aab86004363f7c031b30845f2f
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M linux-user/alpha/target_signal.h

  Log Message:
  -----------
  alpha-linux-user: Fix sigaltstack structure definition

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Riku Voipio &lt;riku.voipio@linaro.org&gt;


  Commit: a05c64091509056b7e321537196db967f2545601
      https://github.com/qemu/qemu/commit/a05c64091509056b7e321537196db967f2545601
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M linux-user/qemu.h
    M linux-user/signal.c
    M linux-user/syscall.c

  Log Message:
  -----------
  linux-user: Fix siginfo handling

Compare signal numbers in the proper domain.
Convert all of the fields for SIGIO and SIGCHLD.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Riku Voipio &lt;riku.voipio@linaro.org&gt;


  Commit: 885c1d10b803fc37e6656e733ba916c702b6f515
      https://github.com/qemu/qemu/commit/885c1d10b803fc37e6656e733ba916c702b6f515
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M linux-user/linuxload.c
    M linux-user/main.c

  Log Message:
  -----------
  linux-user: If loading fails, print error as string, not number

If the attempt to load the guest executable fails, print the
error message as a string, not a number. This requires us to
fix a couple of places in loader_exec() where we were returning
-1 instead of a valid negative errno.

The change allows us to drop the "Unknown binary format" message
because the strerror-enhanced message is now a more self-explanatory
"Error while loading $guest-binary: Exec format error".

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Riku Voipio &lt;riku.voipio@linaro.org&gt;


  Commit: 30163d89953e2ec3e5fc53918682c8bc4b1b3b8d
      https://github.com/qemu/qemu/commit/30163d89953e2ec3e5fc53918682c8bc4b1b3b8d
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: Remove unnecessary host_guest_base code

All TCG hosts now support guest-base functionality, so we can
remove the setting of host_guest_base to 'yes' in every arm
of the case "$cpu" statement, and simply set guest_base to
default to 'yes'.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Riku Voipio &lt;riku.voipio@linaro.org&gt;


  Commit: 07e10e5de1470bdf1d1ed97c85cb7ed9e4826775
      https://github.com/qemu/qemu/commit/07e10e5de1470bdf1d1ed97c85cb7ed9e4826775
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M tcg/arm/tcg-target.h
    M tcg/hppa/tcg-target.h
    M tcg/i386/tcg-target.h
    M tcg/ia64/tcg-target.h
    M tcg/mips/tcg-target.h
    M tcg/ppc/tcg-target.h
    M tcg/ppc64/tcg-target.h
    M tcg/s390/tcg-target.h
    M tcg/sparc/tcg-target.h
    M tcg/tcg.c
    M tcg/tci/tcg-target.h

  Log Message:
  -----------
  tcg: Remove TCG_TARGET_HAS_GUEST_BASE define

GUEST_BASE support is now supported by all TCG backends, and is
now mandatory. Drop the now-pointless TCG_TARGET_HAS_GUEST_BASE
define (set by every backend) and the error if it is unset.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Riku Voipio &lt;riku.voipio@linaro.org&gt;


  Commit: 4a1def4e4ec2f0eb72b15596a04a030cdc889370
      https://github.com/qemu/qemu/commit/4a1def4e4ec2f0eb72b15596a04a030cdc889370
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M linux-user/syscall.c

  Log Message:
  -----------
  linux-user: ppc: mark as long long aligned

The SysV PPC32 ABI dictates that long long (64bit) parameters are pass in odd/even
register pairs. Because unlike ARM and MIPS we start at an odd register number,
we can reuse the same aligning code that ARM and MIPS use.

Clarified inline comment that it is SysV ABI that requires long long aligned
parameters - Riku

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Riku Voipio &lt;riku.voipio@linaro.org&gt;


  Commit: ae017a5b95962f68ece21065376cd3266998fd02
      https://github.com/qemu/qemu/commit/ae017a5b95962f68ece21065376cd3266998fd02
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-12 (Fri, 12 Oct 2012)

  Changed paths:
    M linux-user/syscall.c

  Log Message:
  -----------
  linux-user: register align p{read, write}64

pread64 and pwrite64 pass 64bit parameters which for some architectures need
to be aligned to special argument pairs, creating a gap argument.

Handle this special case the same way we handle it in other places of the code.

Reported-by: Alex Barcelo &lt;abarcelo@ac.upc.edu&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
Tested-by: Alex Barcelo &lt;abarcelo@ac.upc.edu&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Riku Voipio &lt;riku.voipio@linaro.org&gt;


  Commit: fe3e7f2dc05225cdd2ba40defcd4e2581bebc5e0
      https://github.com/qemu/qemu/commit/fe3e7f2dc05225cdd2ba40defcd4e2581bebc5e0
  Author: Joel Martin &lt;github@martintribe.org&gt;
  Date:   2012-10-19 (Fri, 19 Oct 2012)

  Changed paths:
    M ui/vnc.c

  Log Message:
  -----------
  ui/vnc: Only report/use TIGHT_PNG encoding if enabled.

If TIGHT_PNG is not enabled by the --enable-vnc-png configure flag
then do not report to the client that it is supported.

Also, since TIGHT_PNG is the same as the TIGHT encoding but with the
filter/copy replaced with PNG data, adding it to the supported
encodings list when it is disabled will cause the TIGHT encoding to be
used even though the client requested TIGHT_PNG.

Signed-off-by: Joel Martin &lt;github@martintribe.org&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 301592ea6f9c23d233fadc73124301d1305af13c
      https://github.com/qemu/qemu/commit/301592ea6f9c23d233fadc73124301d1305af13c
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-19 (Fri, 19 Oct 2012)

  Changed paths:
    M targphys.h

  Log Message:
  -----------
  targphys.h: Don't define target_phys_addr_t for user-mode emulators

Commit 4be403c accidentally defined the target_phys_addr_t type when
building user-mode emulators. Since the type doesn't really make
any sense except for system emulators, avoid defining it when building
in user mode.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Acked-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 02c7ac0c0f00ce7fb259a0d68c2590a09adb73f4
      https://github.com/qemu/qemu/commit/02c7ac0c0f00ce7fb259a0d68c2590a09adb73f4
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-19 (Fri, 19 Oct 2012)

  Changed paths:
    M target-arm/neon_helper.c

  Log Message:
  -----------
  target-arm/neon_helper: Remove obsolete FIXME comment

Commit 33ebc29 fixed the bugs in the implementation of VQRSHL,
but forgot to remove the FIXME comment...

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: abab1a0f32e44cb4e6c317e24d1705f182b88cd0
      https://github.com/qemu/qemu/commit/abab1a0f32e44cb4e6c317e24d1705f182b88cd0
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-19 (Fri, 19 Oct 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: Remove unused parameters from main function

This modification is required if compiler option -Wunused-parameter is activated.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 08778b398328c4978e6e6bed023e37a3141dba84
      https://github.com/qemu/qemu/commit/08778b398328c4978e6e6bed023e37a3141dba84
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-10-19 (Fri, 19 Oct 2012)

  Changed paths:
    M net/tap-win32.c

  Log Message:
  -----------
  net/tap-win32: Fix compiler warning caused by missing include statement

The include file for net_init_tap was missing:

net/tap-win32.c:703:
 warning: no previous prototype for ânet_init_tap'

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 11f66978618b542986172a62fcd6acfa36c0d178
      https://github.com/qemu/qemu/commit/11f66978618b542986172a62fcd6acfa36c0d178
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-19 (Fri, 19 Oct 2012)

  Changed paths:
    M ui/vnc-jobs.c

  Log Message:
  -----------
  ui/vnc-jobs.c: Fix minor typos in comments

Fix some minor typos/grammar errors in comments.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;


  Commit: 3e50da65255bf4026b15e71299f4a5a40382a057
      https://github.com/qemu/qemu/commit/3e50da65255bf4026b15e71299f4a5a40382a057
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-19 (Fri, 19 Oct 2012)

  Changed paths:
    M configure
    M net/tap-win32.c
    M target-arm/neon_helper.c
    M targphys.h
    M ui/vnc-jobs.c
    M ui/vnc.c

  Log Message:
  -----------
  Merge branch 'trivial-patches' of git://github.com/stefanha/qemu

* 'trivial-patches' of git://github.com/stefanha/qemu:
  ui/vnc-jobs.c: Fix minor typos in comments
  net/tap-win32: Fix compiler warning caused by missing include statement
  configure: Remove unused parameters from main function
  target-arm/neon_helper: Remove obsolete FIXME comment
  targphys.h: Don't define target_phys_addr_t for user-mode emulators
  ui/vnc: Only report/use TIGHT_PNG encoding if enabled.


  Commit: 41a05a457620539f84950c2f52293963388275b0
      https://github.com/qemu/qemu/commit/41a05a457620539f84950c2f52293963388275b0
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-19 (Fri, 19 Oct 2012)

  Changed paths:
    M configure
    M linux-user/alpha/target_signal.h
    M linux-user/linuxload.c
    M linux-user/main.c
    M linux-user/qemu.h
    M linux-user/signal.c
    M linux-user/syscall.c
    M tcg/arm/tcg-target.h
    M tcg/hppa/tcg-target.h
    M tcg/i386/tcg-target.h
    M tcg/ia64/tcg-target.h
    M tcg/mips/tcg-target.h
    M tcg/ppc/tcg-target.h
    M tcg/ppc64/tcg-target.h
    M tcg/s390/tcg-target.h
    M tcg/sparc/tcg-target.h
    M tcg/tcg.c
    M tcg/tci/tcg-target.h

  Log Message:
  -----------
  Merge branch 'linux-user-for-upstream' of \
git://git.linaro.org/people/rikuvoipio/qemu

* 'linux-user-for-upstream' of git://git.linaro.org/people/rikuvoipio/qemu:
  linux-user: register align p{read, write}64
  linux-user: ppc: mark as long long aligned
  tcg: Remove TCG_TARGET_HAS_GUEST_BASE define
  configure: Remove unnecessary host_guest_base code
  linux-user: If loading fails, print error as string, not number
  linux-user: Fix siginfo handling
  alpha-linux-user: Fix sigaltstack structure definition
  linux-user: Implement gethostname
  linux-user: Perform more checks on iovec lists
  linux-user: fix multi-threaded /proc/self/maps
  linux-user: fix statfs


  Commit: 585f60368f23e6603cf86cfdaeceb89d1169f4b8
      https://github.com/qemu/qemu/commit/585f60368f23e6603cf86cfdaeceb89d1169f4b8
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-19 (Fri, 19 Oct 2012)

  Changed paths:
    M qemu-options.hx

  Log Message:
  -----------
  qemu-options.hx: Change from recommending '?' to 'help'

Update the -help output and documentation so that it recommends
'help' rather than '?' for the various "list valid values for this
option" cases. '?' is deprecated (as it can fail confusingly if
not quoted), so it's better to steer users towards 'help'. ('?'
still works, for backwards compatibility.)

This is the -help option part of the change otherwise done in
commit c8057f9, since we are now past release 1.2 and free to
change our help text without worrying about breaking libvirt.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 38f419f35225decdbaea9fe1fd00218f8924ce84
      https://github.com/qemu/qemu/commit/38f419f35225decdbaea9fe1fd00218f8924ce84
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-10-19 (Fri, 19 Oct 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: Fix CONFIG_QEMU_HELPERDIR generation

We need to evaluate $libexecdir in configure, otherwise we literally end
up with "${prefix}/libexec" instead of the absolute path as
CONFIG_QEMU_HELPERDIR.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 1cd0f8ce731574afbf219b7ae2b938f305b77e86
      https://github.com/qemu/qemu/commit/1cd0f8ce731574afbf219b7ae2b938f305b77e86
  Author: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
  Date:   2012-10-19 (Fri, 19 Oct 2012)

  Changed paths:
    M MAINTAINERS

  Log Message:
  -----------
  MAINTAINERS: Update email address for Stefan Hajnoczi

Switch to my new work email address from which I am contributing.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 42a159284570b6fbb0b097e18c7590c094a5188c
      https://github.com/qemu/qemu/commit/42a159284570b6fbb0b097e18c7590c094a5188c
  Author: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
  Date:   2012-10-19 (Fri, 19 Oct 2012)

  Changed paths:
    M exec-all.h

  Log Message:
  -----------
  tci: fix build breakage for target-sparc

commit c28ae41 introduced GETPC() usage for sparc, which is currently
not defined when building with --enable-tcg-interpreter. Add sparc to
the list of targets we selectively define GETPC() for.

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Reviewed-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 7748b8cb1d100105753a80976d2d02ab107d8107
      https://github.com/qemu/qemu/commit/7748b8cb1d100105753a80976d2d02ab107d8107
  Author: Mike Frysinger &lt;vapier@gentoo.org&gt;
  Date:   2012-10-19 (Fri, 19 Oct 2012)

  Changed paths:
    M Makefile

  Log Message:
  -----------
  allow make {dist, }clean work w/out configure

There's no reason to require configure to run before running a clean
target, so check MAKECMDGOALS before.

Signed-off-by: Mike Frysinger &lt;vapier@gentoo.org&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: f62cb1b6ddc2c82694abac23ab5eeddd85800074
      https://github.com/qemu/qemu/commit/f62cb1b6ddc2c82694abac23ab5eeddd85800074
  Author: Catalin Patulea &lt;catalinp@google.com&gt;
  Date:   2012-10-19 (Fri, 19 Oct 2012)

  Changed paths:
    M tests/tcg/Makefile
    M tests/tcg/linux-test.c
    M tests/tcg/test-i386.c
    M tests/tcg/test_path.c

  Log Message:
  -----------
  tests/tcg: fix build

This broke when the tests were moved from tests/ to tests/tcg/.

On x86_64 host/i386-linux-user non-kvm guest, test-i386 and test-mmap are broken, but \
at least they build.

To build/run the tests:
$ cd $BUILD_PATH/tests/tcg
$ SRC_PATH=path/to/qemu make &lt;target&gt;

Signed-off-by: Catalin Patulea &lt;catalinp@google.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


Compare: https://github.com/qemu/qemu/compare/d7dce494769e...f62cb1b6ddc2

----==_mimepart_5081aa45604f2_2314153faec14046--


</body></email><email><emailId>20121020090012</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-20 09:00:12-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 0d0302: vga: fix indention</subject><body>



----==_mimepart_5082681cd8b7d_7a67e92af089265
Date: Sat, 20 Oct 2012 02:00:12 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5082681cdf337_7a67e92af0893a@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 0d0302e2033087ebcd0bcaa2ac1a79452f86d2a7
      https://github.com/qemu/qemu/commit/0d0302e2033087ebcd0bcaa2ac1a79452f86d2a7
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M hw/vga-pci.c

  Log Message:
  -----------
  vga: fix indention

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 803ff052b69c888df3d21e199626a5ef6e3ccf12
      https://github.com/qemu/qemu/commit/803ff052b69c888df3d21e199626a5ef6e3ccf12
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M hw/pc_piix.c
    M hw/vga-pci.c
    M hw/vga.c
    M hw/vga_int.h

  Log Message:
  -----------
  vga: add mmio bar to standard vga

This patch adds a mmio bar to the qemu standard vga which allows to
access the standard vga registers and bochs dispi interface registers
via mmio.

Cc: Benjamin Herrenschmidt &lt;benh@kernel.crashing.org&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: cc22824860a18e9e073496396b1cfc860d010a26
      https://github.com/qemu/qemu/commit/cc22824860a18e9e073496396b1cfc860d010a26
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    A docs/specs/standard-vga.txt
    M hw/vga-isa.c
    M hw/vga-pci.c

  Log Message:
  -----------
  vga: add specs for standard vga

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: a96d8bea8e23473bd5b4b4111ba9187fcb976865
      https://github.com/qemu/qemu/commit/a96d8bea8e23473bd5b4b4111ba9187fcb976865
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M hw/vga.c
    M hw/vga_int.h

  Log Message:
  -----------
  vga: remove CONFIG_BOCHS_VBE

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 5f072e1f3075bd869e0ace9f2545a85992ac0084
      https://github.com/qemu/qemu/commit/5f072e1f3075bd869e0ace9f2545a85992ac0084
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M hw/alpha_dp264.c
    M hw/an5206.c
    M hw/axis_dev88.c
    M hw/boards.h
    M hw/collie.c
    M hw/dummy_m68k.c
    M hw/exynos4_boards.c
    M hw/gumstix.c
    M hw/highbank.c
    M hw/integratorcp.c
    M hw/kzm.c
    M hw/leon3.c
    M hw/lm32_boards.c
    M hw/mainstone.c
    M hw/mcf5208.c
    M hw/milkymist.c
    M hw/mips_fulong2e.c
    M hw/mips_jazz.c
    M hw/mips_malta.c
    M hw/mips_mipssim.c
    M hw/mips_r4k.c
    M hw/musicpal.c
    M hw/nseries.c
    M hw/null-machine.c
    M hw/omap_sx1.c
    M hw/openrisc_sim.c
    M hw/palm.c
    M hw/pc_piix.c
    M hw/petalogix_ml605_mmu.c
    M hw/petalogix_s3adsp1800_mmu.c
    M hw/ppc/e500plat.c
    M hw/ppc/mpc8544ds.c
    M hw/ppc405_boards.c
    M hw/ppc440_bamboo.c
    M hw/ppc_newworld.c
    M hw/ppc_oldworld.c
    M hw/ppc_prep.c
    M hw/puv3.c
    M hw/r2d.c
    M hw/realview.c
    M hw/s390-virtio.c
    M hw/shix.c
    M hw/spapr.c
    M hw/spitz.c
    M hw/stellaris.c
    M hw/sun4m.c
    M hw/sun4u.c
    M hw/tosa.c
    M hw/versatilepb.c
    M hw/vexpress.c
    M hw/virtex_ml507.c
    M hw/xen_machine_pv.c
    M hw/xilinx_zynq.c
    M hw/xtensa_lx60.c
    M hw/xtensa_sim.c
    M hw/z2.c
    M vl.c

  Log Message:
  -----------
  create struct for machine initialization arguments

This should help us to:
- More easily add or remove machine initialization arguments without
  having to change every single machine init function;
- More easily make mechanical changes involving the machine init
  functions in the future;
- Let machine initialization forward the init arguments to other
  functions more easily.

This change was half-mechanical process: first the struct was added with
the local ram_size, boot_device, kernel_*, initrd_*, and cpu_model local
variable initialization to all functions. Then the compiler helped me
locate the local variables that are unused, so they could be removed.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: f1bc0bcc9dbbbf5674add3075b5efe0a93fe34f0
      https://github.com/qemu/qemu/commit/f1bc0bcc9dbbbf5674add3075b5efe0a93fe34f0
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M exec.c

  Log Message:
  -----------
  exec: Split up and tidy code_gen_buffer

It now consists of:

A macro definition of MAX_CODE_GEN_BUFFER_SIZE with host-specific values,

A function size_code_gen_buffer that applies most of the reasoning for
choosing a buffer size,

Three variations of a function alloc_code_gen_buffer that contain all
of the logic for allocating executable memory via a given allocation
mechanism.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 3d85a72fd8af6804f66a48d85187f448b14ddba3
      https://github.com/qemu/qemu/commit/3d85a72fd8af6804f66a48d85187f448b14ddba3
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M exec.c

  Log Message:
  -----------
  exec: Don't make DEFAULT_CODE_GEN_BUFFER_SIZE too large

For ARM we cap the buffer size to 16MB.  Do not allocate 32MB in that case.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 405def18466d0cbd84e6a0edb598466b0a5e15c3
      https://github.com/qemu/qemu/commit/405def18466d0cbd84e6a0edb598466b0a5e15c3
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M exec.c

  Log Message:
  -----------
  exec: Do not use absolute address hints for code_gen_buffer with -fpie

The hard-coded addresses inside alloc_code_gen_buffer only make sense
if we're building an executable that will actually run at the address
we've put into the linker scripts.

When we're building with -fpie, the executable will run at some
random location chosen by the kernel.  We get better placement for
the code_gen_buffer if we allow the kernel to place the memory,
as it will tend to to place it near the executable, based on the
PROT_EXEC bit.

Since code_gen_prologue is always inside the executable, this effect
is easily seen at the end of most TB, with the exit_tb opcode, and
with any calls to helper functions.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 4438c8a9469d79fa2c58189418befb506da54d97
      https://github.com/qemu/qemu/commit/4438c8a9469d79fa2c58189418befb506da54d97
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M exec.c
    M tcg/tcg.h

  Log Message:
  -----------
  exec: Allocate code_gen_prologue from code_gen_buffer

We had a hack for arm and sparc, allocating code_gen_prologue to a
special section.  Which, honestly does no good under certain cases.
We've already got limits on code_gen_buffer_size to ensure that all
TBs can use direct branches between themselves; reuse this limit to
ensure the prologue is also reachable.

As a bonus, we get to avoid marking a page of the main executable's
data segment as executable.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 74d590c8e930e42832711604ef0ffd7df6bd5873
      https://github.com/qemu/qemu/commit/74d590c8e930e42832711604ef0ffd7df6bd5873
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M exec-all.h
    M exec.c

  Log Message:
  -----------
  exec: Make MIN_CODE_GEN_BUFFER_SIZE private to exec.c

It is used nowhere else, and the corresponding MAX_CODE_GEN_BUFFER_SIZE
also lives there.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 8802361689c7aa9224aea39329af72fbc7b366ef
      https://github.com/qemu/qemu/commit/8802361689c7aa9224aea39329af72fbc7b366ef
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Add gen_load/store/dest_gpr

Infrastructure to be used to clean up handling of temporaries.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 97ea285917d473c8c8ecb627a637d76082cd6584
      https://github.com/qemu/qemu/commit/97ea285917d473c8c8ecb627a637d76082cd6584
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Conversion to gen_*_gpr, part 1

Only handle the easy cases directly within disas_sparc_insn.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 9d1d4e342cb154a0f801eabd9758e90599893073
      https://github.com/qemu/qemu/commit/9d1d4e342cb154a0f801eabd9758e90599893073
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Use gen_load_gpr in get_src[12]

This means we can avoid the incoming temporary, though the cleanup
of the existing temporaries is not performed in this patch.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: c7785e1682405d8ec7002918c76857aaebd812b2
      https://github.com/qemu/qemu/commit/c7785e1682405d8ec7002918c76857aaebd812b2
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Convert asi helpers to gen_*_gpr

Push the DisasContext down so that we can use gen_load/store_gpr
in sode gen_ldda_asi, gen_stda_ast, gen_cas_asi, gen_casx_asi.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 06828032e3f88710b3135ff55ecf1c0308027900
      https://github.com/qemu/qemu/commit/06828032e3f88710b3135ff55ecf1c0308027900
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Convert swap to gen_load/store_gpr

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 81634eea3d5dada203848f89ebd97d6a05aa4cce
      https://github.com/qemu/qemu/commit/81634eea3d5dada203848f89ebd97d6a05aa4cce
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Finish conversion to gen_load_gpr

All users of gen_movl_{reg_TN,TN_reg} are removed.  At the same time,
make cpu_val a local variable for load/store disassembly.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: a4273524875a960e8ef22ed676853e5988fefbea
      https://github.com/qemu/qemu/commit/a4273524875a960e8ef22ed676853e5988fefbea
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Cleanup cpu_src[12] allocation

Now that get_temp_tl is used for get_src[12], we don't need to
pre-allocate these temporaries.

Fallout from this is moving some assignments around cas/casx to
avoid uninitialized variable warnings.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 5e6ed43923830b09989a9a2fa2255dadadee67f2
      https://github.com/qemu/qemu/commit/5e6ed43923830b09989a9a2fa2255dadadee67f2
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Make the cpu_addr variable local to load/store handling

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 2ae23e178263ecb7faebd37d9706f36a5cba9791
      https://github.com/qemu/qemu/commit/2ae23e178263ecb7faebd37d9706f36a5cba9791
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Split out get_temp_i32

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: ba5f5179f2c27c7e9891e404f526d3463e3f4a15
      https://github.com/qemu/qemu/commit/ba5f5179f2c27c7e9891e404f526d3463e3f4a15
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Use get_temp_i32 in gen_dest_fpr_F

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 45778f99f0fb088af1f92d9a92759b760dceef2a
      https://github.com/qemu/qemu/commit/45778f99f0fb088af1f92d9a92759b760dceef2a
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Avoid cpu_tmp32 in Read Priv Register

We don't need another temporary here.  Load directly into the
register we want to set.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 7b9e066b67c1f8839a1ca63efebcbaf48cc60104
      https://github.com/qemu/qemu/commit/7b9e066b67c1f8839a1ca63efebcbaf48cc60104
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Avoid cpu_tmp32 in Write Priv Register

No need to copy to a temporary to store 32 bits.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: f8641947c2268eab6e73f16883c08ae14432280c
      https://github.com/qemu/qemu/commit/f8641947c2268eab6e73f16883c08ae14432280c
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Tidy ldfsr, stfsr

Remove the last uses of cpu_tmp32.  Unify the code between sparc64
and sparc32 by using the proper "tl" functions.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 1ec789ab68a9eabb5de8b1ba732d60a8fcb00446
      https://github.com/qemu/qemu/commit/1ec789ab68a9eabb5de8b1ba732d60a8fcb00446
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Remove usage of cpu_tmp64 from most helper functions

Use a locally allocated temporary instead.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 3886b8a32029a88111140dfe81f6ef02d6b85e23
      https://github.com/qemu/qemu/commit/3886b8a32029a88111140dfe81f6ef02d6b85e23
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Don't use a temporary for gen_dest_fpr_D

In all cases we don't have write-before-read problems.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: aeff993cc59ea043c8d33e3dc3584c61aa31f347
      https://github.com/qemu/qemu/commit/aeff993cc59ea043c8d33e3dc3584c61aa31f347
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Remove cpu_tmp64 use from softint insns

The use of "tl" functions and a tmp64 is logically incompatible.
Use cpu_tmp0 instead.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: abcc71919c65747af7615c8770754c0ea071a2d2
      https://github.com/qemu/qemu/commit/abcc71919c65747af7615c8770754c0ea071a2d2
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Remove last uses of cpu_tmp64

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 7b04bd5ccabf61d5ad8a616ecbe2282c4e2656c4
      https://github.com/qemu/qemu/commit/7b04bd5ccabf61d5ad8a616ecbe2282c4e2656c4
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Only use cpu_dst for eventual writes to a gpr

Use cpu_tmp0 for other stuff, like Write Priv Register.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 5793f2a47e201d251856c7956d6f7907ec0d9f1f
      https://github.com/qemu/qemu/commit/5793f2a47e201d251856c7956d6f7907ec0d9f1f
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Make cpu_dst local to OP=2 insns

And initialize it such that it (may) write directly to rd.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: de9e9d9f17a36ff76c1a02a5348835e5e0a081b0
      https://github.com/qemu/qemu/commit/de9e9d9f17a36ff76c1a02a5348835e5e0a081b0
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Remove cpu_tmp0 as a global

Subroutines do their own local temporary management.
Within disas_sparc_insn we limit the existance of the variable
to OP=2 insns, and delay initialization as late as is reasonable
for the specific XOP.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: e54eba1986f6c4bac2951e7f90a849cd842e25e4
      https://github.com/qemu/qemu/commit/e54eba1986f6c4bac2951e7f90a849cd842e25e4
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M qemu-log.c
    M qemu-log.h

  Log Message:
  -----------
  qemu-log: Add new log category for guest bugs

Add a new category for device models to log guest behaviour
which is likely to be a guest bug of some kind (accessing
nonexistent registers, reading 32 bit wide registers with
a byte access, etc). Making this its own log category allows
those who care (mostly guest OS authors) to see the complaints
without bothering most users.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 051c02b6c9c8ab5527f8775808625f9de8346006
      https://github.com/qemu/qemu/commit/051c02b6c9c8ab5527f8775808625f9de8346006
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M hw/hw.h

  Log Message:
  -----------
  hw/hw.h: Add include of qemu-log.h

Add an include of qemu-log.h to hw.h, so that device model
code has access to these logging functions without the need
to directly include qemu-log.h.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 9351d70829c6ef2b6e27b4ca89aaca2eab4780ed
      https://github.com/qemu/qemu/commit/9351d70829c6ef2b6e27b4ca89aaca2eab4780ed
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M hw/pl181.c

  Log Message:
  -----------
  hw/pl181: Use LOG_UNIMP and LOG_GUEST_ERROR

Rather than a mix of direct printing to stderr and aborting
via hw_error(), use LOG_UNIMP and LOG_GUEST_ERROR.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: b1d9df90212984f8e78abc75152527a00d899f89
      https://github.com/qemu/qemu/commit/b1d9df90212984f8e78abc75152527a00d899f89
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M hw/pl041.c

  Log Message:
  -----------
  hw/pl041: Use LOG_UNIMP

Use the new LOG_UNIMP tracing to report unimplemented
features.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: fd271e81aa7334b973285f5c94a4f8ab265df683
      https://github.com/qemu/qemu/commit/fd271e81aa7334b973285f5c94a4f8ab265df683
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M hw/pl190.c

  Log Message:
  -----------
  hw/pl190: Use LOG_GUEST_ERROR

If the guest attempts an offset to a nonexistent register, just
log this via LOG_GUEST_ERROR rather than killing QEMU with a hw_error.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 6d5433e00a73f96dd5cbf93874dd8122672144b6
      https://github.com/qemu/qemu/commit/6d5433e00a73f96dd5cbf93874dd8122672144b6
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M hw/pl011.c

  Log Message:
  -----------
  hw/pl011: Use LOG_UNIMP and LOG_GUEST_ERROR

Use the new LOG_UNIMP and LOG_GUEST_ERROR logging types rather
than hw_error().

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: af83c32bd44b6594db301b4ac8cb44e5eb85d4bf
      https://github.com/qemu/qemu/commit/af83c32bd44b6594db301b4ac8cb44e5eb85d4bf
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M hw/pl022.c

  Log Message:
  -----------
  hw/pl022: Use LOG_UNIMP and LOG_GUEST_ERROR

Use LOG_UNIMP and LOG_GUEST_ERROR where appropriate rather
than hw_error().

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: a5089c050138933631b8755a664cfd275763b223
      https://github.com/qemu/qemu/commit/a5089c050138933631b8755a664cfd275763b223
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M hw/pl031.c

  Log Message:
  -----------
  hw/pl031: Use LOG_GUEST_ERROR

Use LOG_GUEST_ERROR rather than hw_error or direct fprintf.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/f62cb1b6ddc2...a5089c050138

----==_mimepart_5082681cd8b7d_7a67e92af089265--


</body></email><email><emailId>20121020093007</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-20 09:30:07-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] e7c8af: target-sparc: fix FMOVr instruction</subject><body>



----==_mimepart_50826f1f28256_6d7a1d23aec5166a
Date: Sat, 20 Oct 2012 02:30:07 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50826f1f293a7_6d7a1d23aec517d9@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: e7c8afb9058f9d46a089a9fb75cccf996886249c
      https://github.com/qemu/qemu/commit/e7c8afb9058f9d46a089a9fb75cccf996886249c
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-20 (Sat, 20 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: fix FMOVr instruction

Like the MOVr instruction, the FMOVr instruction has the condition
encoded between bits 10 and 12.

Cc: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;




----==_mimepart_50826f1f28256_6d7a1d23aec5166a--


</body></email><email><emailId>20121022063009</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-22 06:30:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] f354b1: fix CONFIG_QEMU_HELPERDIR generation again</subject><body>



----==_mimepart_5084e7f0f249c_62e413abaf06417d
Date: Sun, 21 Oct 2012 23:30:09 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5084e7f0f3ccd_62e413abaf064254@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: f354b1a1ee7a1c72d51b42808724a2b10eec315f
      https://github.com/qemu/qemu/commit/f354b1a1ee7a1c72d51b42808724a2b10eec315f
  Author: Michael Tokarev &lt;mjt@tls.msk.ru&gt;
  Date:   2012-10-21 (Sun, 21 Oct 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  fix CONFIG_QEMU_HELPERDIR generation again

commit 38f419f35225 fixed a breakage with CONFIG_QEMU_HELPERDIR
which has been introduced by 8bf188aa18ef7a8.  But while techinically
that fix has been correct, all other similar variables are handled
differently.  Make it consistent, and let scripts/create_config
expand and capitalize the variable properly like for all other
qemu_*dir variables.

Signed-off-by: Michael Tokarev &lt;mjt@tls.msk.ru&gt;




----==_mimepart_5084e7f0f249c_62e413abaf06417d--


</body></email><email><emailId>20121022200020</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-22 20:00:20-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 7762c2: memory: rename 'exec-obsolete.h'</subject><body>



----==_mimepart_5085a5d4d5655_5cf91d25af4501a5
Date: Mon, 22 Oct 2012 13:00:20 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5085a5d4e1904_5cf91d25af4502b@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 7762c2c1e02e44fdc473cbe75105faba08b906cc
      https://github.com/qemu/qemu/commit/7762c2c1e02e44fdc473cbe75105faba08b906cc
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-15 (Mon, 15 Oct 2012)

  Changed paths:
    M cputlb.c
    R exec-obsolete.h
    M exec.c
    A memory-internal.h
    M memory.c

  Log Message:
  -----------
  memory: rename 'exec-obsolete.h'

exec-obsolete.h used to hold pre-memory-API functions that were used from
device code prior to the transition to the memory API.  Now that the
transition is complete, the name no longer describes the file.  The
functions still need to be merged better into the memory core, but there's
no danger of anyone using them.

Reviewed-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 0fada67420e29f389119ca6f44285203400e0730
      https://github.com/qemu/qemu/commit/0fada67420e29f389119ca6f44285203400e0730
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-15 (Mon, 15 Oct 2012)

  Changed paths:
    M hw/vhost.c

  Log Message:
  -----------
  vhost: use MemoryListener filtering to only monitor RAM address space

Instead of checking manually, let the listener filter for us.  This prepares
us for DMA address spaces.

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: d22b096ef6e0b20810193b68a1d472f3fb8a4f9e
      https://github.com/qemu/qemu/commit/d22b096ef6e0b20810193b68a1d472f3fb8a4f9e
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-15 (Mon, 15 Oct 2012)

  Changed paths:
    M kvm-all.c

  Log Message:
  -----------
  kvm: use separate MemoryListeners for memory and I/O

The construct

   if (address_space == get_system_memory()) {
       // memory thing
   } else {
       // io thing
   }

fails if we have more than two address spaces.  Use a separate listener
for memory and I/O, and utilize MemoryListener's address space filtering to
fix this.

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 12b40e471f33e552fa3d962887b416cf67831446
      https://github.com/qemu/qemu/commit/12b40e471f33e552fa3d962887b416cf67831446
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-15 (Mon, 15 Oct 2012)

  Changed paths:
    M hw/xen_pt.c
    M hw/xen_pt.h

  Log Message:
  -----------
  xen_pt: use separate MemoryListeners for memory and I/O

Using an unfiltered memory listener will cause regions to be reported
fails multiple times if we have more than two address spaces.  Use a separate
listener for memory and I/O, and utilize MemoryListener's address space
filtering to fix this.

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 8786db7cb96f8ce5c75c6e1e074319c9dca8d356
      https://github.com/qemu/qemu/commit/8786db7cb96f8ce5c75c6e1e074319c9dca8d356
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-15 (Mon, 15 Oct 2012)

  Changed paths:
    M memory.c

  Log Message:
  -----------
  memory: prepare AddressSpace for exporting

AddressSpace contains a member, current_map, of type FlatView.  Since we
want to limit the leakage of internal types to public headers, switch to
a pointer to a FlatView.  There is no performance impact as this isn't used
during lookups, only address space reconfigurations.

Reviewed-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 9ad2bbc16788d3048d514f3450d0975e59d46119
      https://github.com/qemu/qemu/commit/9ad2bbc16788d3048d514f3450d0975e59d46119
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-15 (Mon, 15 Oct 2012)

  Changed paths:
    M memory.c
    M memory.h

  Log Message:
  -----------
  memory: export AddressSpace

The DMA API will use an AddressSpace to differentiate among different
initiators.

Reviewed-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 0d673e36a74d366ce090ab096955317b581c0fb0
      https://github.com/qemu/qemu/commit/0d673e36a74d366ce090ab096955317b581c0fb0
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-15 (Mon, 15 Oct 2012)

  Changed paths:
    M memory.c
    M memory.h

  Log Message:
  -----------
  memory: maintain a list of address spaces

Instead of embedding knowledge of the memory and I/O address spaces in the
memory core, maintain a list of all address spaces.  This list will later
be extended dynamically for other bus masters.

Reviewed-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 975aefe011197453284a4ab777000183e6096d5b
      https://github.com/qemu/qemu/commit/975aefe011197453284a4ab777000183e6096d5b
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-15 (Mon, 15 Oct 2012)

  Changed paths:
    M memory.c

  Log Message:
  -----------
  memory: provide defaults for MemoryListener operations

Many listeners don't need to respond to all MemoryListener callbacks;
provide suitable no-op defaults instead.

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 9a2c913b77b54f650d60680d14b995bacbc63e50
      https://github.com/qemu/qemu/commit/9a2c913b77b54f650d60680d14b995bacbc63e50
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-15 (Mon, 15 Oct 2012)

  Changed paths:
    M exec.c

  Log Message:
  -----------
  memory: drop no-op MemoryListener callbacks

Removes quite a bit of useless code.

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: e71e602cb5ac194ea414816068f398080d913abb
      https://github.com/qemu/qemu/commit/e71e602cb5ac194ea414816068f398080d913abb
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-15 (Mon, 15 Oct 2012)

  Changed paths:
    M hw/vfio_pci.c

  Log Message:
  -----------
  vfio: drop no-op MemoryListener callbacks

Removes quite a bit of useless code.

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 6381fc188cd1c41c69ce947853dd1281d8f3c07e
      https://github.com/qemu/qemu/commit/6381fc188cd1c41c69ce947853dd1281d8f3c07e
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-15 (Mon, 15 Oct 2012)

  Changed paths:
    M hw/xen_pt.c

  Log Message:
  -----------
  xen_pt: drop no-op MemoryListener callbacks

Removes quite a bit of useless code.

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: ad1ff3d99a55f559e00a11de14d91ca33a139252
      https://github.com/qemu/qemu/commit/ad1ff3d99a55f559e00a11de14d91ca33a139252
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-15 (Mon, 15 Oct 2012)

  Changed paths:
    M kvm-all.c

  Log Message:
  -----------
  kvm: drop no-op MemoryListener callbacks

Removes quite a bit of useless code.

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: bf83601fddb976753b498a879cbdc8f107f59f53
      https://github.com/qemu/qemu/commit/bf83601fddb976753b498a879cbdc8f107f59f53
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-15 (Mon, 15 Oct 2012)

  Changed paths:
    M xen-all.c

  Log Message:
  -----------
  xen: drop no-op MemoryListener callbacks

Removes quite a bit of useless code.

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 05e72dc5812a9f461fc2c606dff2572909eafc39
      https://github.com/qemu/qemu/commit/05e72dc5812a9f461fc2c606dff2572909eafc39
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M buffered_file.c

  Log Message:
  -----------
  buffered_file: g_realloc() can't fail

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Orit Wasserman &lt;owasserm@redhat.com&gt;


  Commit: 79536f4f16934d6759a1d67f0342b4e7ceb66671
      https://github.com/qemu/qemu/commit/79536f4f16934d6759a1d67f0342b4e7ceb66671
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M arch_init.c

  Log Message:
  -----------
  fix migration sync

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 97d4d961d98c1ad54eee657d81e2e50911a92acf
      https://github.com/qemu/qemu/commit/97d4d961d98c1ad54eee657d81e2e50911a92acf
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M migration.c

  Log Message:
  -----------
  migration: store end_time in a local variable

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Orit Wasserman &lt;owasserm@redhat.com&gt;


  Commit: 9c5a9fcf5399450a873e7460b397a89447c7ef11
      https://github.com/qemu/qemu/commit/9c5a9fcf5399450a873e7460b397a89447c7ef11
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M hmp.c
    M migration.c
    M migration.h
    M qapi-schema.json
    M qmp-commands.hx

  Log Message:
  -----------
  migration: print total downtime for final phase of migration

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Orit Wasserman &lt;owasserm@redhat.com&gt;


  Commit: c00012f68b736c0ad9d0ff245373c7005ea0721a
      https://github.com/qemu/qemu/commit/c00012f68b736c0ad9d0ff245373c7005ea0721a
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M arch_init.c

  Log Message:
  -----------
  migration: rename expected_time to expected_downtime

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Orit Wasserman &lt;owasserm@redhat.com&gt;


  Commit: 859bc7569a2d244ee6183a99b71186462049ca86
      https://github.com/qemu/qemu/commit/859bc7569a2d244ee6183a99b71186462049ca86
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M migration.c
    M migration.h

  Log Message:
  -----------
  migration: export migrate_get_current()

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 2c52ddf1cb3057bc2c6ae256857077627f6da43a
      https://github.com/qemu/qemu/commit/2c52ddf1cb3057bc2c6ae256857077627f6da43a
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M arch_init.c
    M hmp.c
    M migration.c
    M migration.h
    M qapi-schema.json
    M qmp-commands.hx

  Log Message:
  -----------
  migration: print expected downtime in info migrate

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 5a17077529f7feec559e1881792e89554c2ae5b6
      https://github.com/qemu/qemu/commit/5a17077529f7feec559e1881792e89554c2ae5b6
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M arch_init.c

  Log Message:
  -----------
  savevm: Factorize ram globals reset in its own function

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Orit Wasserman &lt;owasserm@redhat.com&gt;


  Commit: e44d26c8f3894a220f29ff5b27abf87f570d2c07
      https://github.com/qemu/qemu/commit/e44d26c8f3894a220f29ff5b27abf87f570d2c07
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M arch_init.c

  Log Message:
  -----------
  ram: introduce migration_bitmap_set_dirty()

It just marks a region of memory as dirty.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Orit Wasserman &lt;owasserm@redhat.com&gt;


  Commit: 69268cde142d169e2e47836bcf0a26341e30218a
      https://github.com/qemu/qemu/commit/69268cde142d169e2e47836bcf0a26341e30218a
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M arch_init.c

  Log Message:
  -----------
  ram: Introduce migration_bitmap_test_and_reset_dirty()

It just test if the dirty bit is set, and clears it.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Orit Wasserman &lt;owasserm@redhat.com&gt;


  Commit: 652d7ec291d1726ad01587e13331d7277fa402ec
      https://github.com/qemu/qemu/commit/652d7ec291d1726ad01587e13331d7277fa402ec
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M cpu-all.h
    M exec.c

  Log Message:
  -----------
  ram: Export last_ram_offset()

Is the only way of knowing the RAM size.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: dd2df737ef3930f6d88116520d6ca7ff3cf0c41f
      https://github.com/qemu/qemu/commit/dd2df737ef3930f6d88116520d6ca7ff3cf0c41f
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M arch_init.c

  Log Message:
  -----------
  ram: introduce migration_bitmap_sync()

Helper that we use each time that we need to syncronize the migration
bitmap with the other dirty bitmaps.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 3c12193d998249bcbe5099edf85039bcd25c3a80
      https://github.com/qemu/qemu/commit/3c12193d998249bcbe5099edf85039bcd25c3a80
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M arch_init.c
    M trace-events

  Log Message:
  -----------
  ram: create trace event for migration sync bitmap

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: c6bf8e0e0cf04b40a8a22426e00ebbd727331d8b
      https://github.com/qemu/qemu/commit/c6bf8e0e0cf04b40a8a22426e00ebbd727331d8b
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M arch_init.c
    M cpu-all.h
    M exec-obsolete.h

  Log Message:
  -----------
  Separate migration bitmap

This patch creates a migration bitmap, which is periodically kept in
sync with the qemu bitmap. A separate copy of the dirty bitmap for the
migration limits the amount of concurrent access to the qemu bitmap
from iothread and migration thread (which requires taking the big
lock).

We use the qemu bitmap type.  We have to "undo" the dirty_pages
counting optimization on the general dirty bitmap and do the counting
optimization with the migration local bitmap.

Signed-off-by: Umesh Deshpande &lt;udeshpan@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 8d017193e2b66a65adf53e46a6372e55470fe7fd
      https://github.com/qemu/qemu/commit/8d017193e2b66a65adf53e46a6372e55470fe7fd
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M arch_init.c
    M hmp.c
    M migration.c
    M migration.h
    M qapi-schema.json

  Log Message:
  -----------
  migration: Add dirty_pages_rate to query migrate output

It indicates how many pages were dirtied during the last second.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 2dddf6f4133975af62e64cb6406ec1239491fa89
      https://github.com/qemu/qemu/commit/2dddf6f4133975af62e64cb6406ec1239491fa89
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M buffered_file.c

  Log Message:
  -----------
  BufferedFile: append, then flush

Simplify the logic for pushing data from the buffer to the output
pipe/socket.  This also matches more closely what will be the
operation of the migration thread.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Orit Wasserman &lt;owasserm@redhat.com&gt;


  Commit: 8e92c9e24f8c4edd7976aca82abf90e9a12667b4
      https://github.com/qemu/qemu/commit/8e92c9e24f8c4edd7976aca82abf90e9a12667b4
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M buffered_file.c

  Log Message:
  -----------
  buffered_file: rename opaque to migration_state

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: c7a8f0cdd25ed552e6dba124877bd3364054c55c
      https://github.com/qemu/qemu/commit/c7a8f0cdd25ed552e6dba124877bd3364054c55c
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M buffered_file.c
    M buffered_file.h

  Log Message:
  -----------
  buffered_file: opaque is MigrationState

It always have that type, just change it.
We will remove buffered file later on the migration thread series.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: c87b015bc71734db74f5bdffeda122a224c75bbb
      https://github.com/qemu/qemu/commit/c87b015bc71734db74f5bdffeda122a224c75bbb
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M buffered_file.c
    M buffered_file.h
    M migration.c
    M migration.h

  Log Message:
  -----------
  buffered_file: unfold migrate_fd_put_buffer

We only used it once, just remove the callback indirection

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 2c9adcb850bba7a24caec4d666dc01deca9f7649
      https://github.com/qemu/qemu/commit/2c9adcb850bba7a24caec4d666dc01deca9f7649
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M buffered_file.c
    M buffered_file.h
    M migration.c
    M migration.h

  Log Message:
  -----------
  buffered_file: unfold migrate_fd_put_ready

We only use it once, just remove the callback indirection.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 749f7909d942f5c7425d0895242ce720cd663e92
      https://github.com/qemu/qemu/commit/749f7909d942f5c7425d0895242ce720cd663e92
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M buffered_file.c
    M buffered_file.h
    M migration.c
    M migration.h

  Log Message:
  -----------
  buffered_file: unfold migrate_fd_wait_for_unfreeze

We only used it once, just remove the callback indirection.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 11c7674129a81b5b69e00ad252a63186e15bf6b6
      https://github.com/qemu/qemu/commit/11c7674129a81b5b69e00ad252a63186e15bf6b6
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M buffered_file.c
    M buffered_file.h
    M migration.c
    M migration.h

  Log Message:
  -----------
  buffered_file: unfold migrate_fd_close

We only used it once, just remove the callback indirection.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 796b4b0f5011e30cffbc57ed5a4ab93c6f5eaab7
      https://github.com/qemu/qemu/commit/796b4b0f5011e30cffbc57ed5a4ab93c6f5eaab7
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M buffered_file.c
    M buffered_file.h
    M migration.c

  Log Message:
  -----------
  buffered_file: We can access directly to bandwidth_limit

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 3d6dff316f20137a87e099c30136358df029c0f6
      https://github.com/qemu/qemu/commit/3d6dff316f20137a87e099c30136358df029c0f6
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M buffered_file.c

  Log Message:
  -----------
  buffered_file: callers of buffered_flush() already check for errors

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: d2dbc8e6a95a9f66f886c35db42786efc906c777
      https://github.com/qemu/qemu/commit/d2dbc8e6a95a9f66f886c35db42786efc906c777
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M buffered_file.c

  Log Message:
  -----------
  buffered_file: make buffered_flush return the error code

Or the amount of data written if there is no error.  Adjust all callers.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 9499743f36169cf7d974640f123bc29836f75a2d
      https://github.com/qemu/qemu/commit/9499743f36169cf7d974640f123bc29836f75a2d
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M buffered_file.c
    M migration.c
    M migration.h

  Log Message:
  -----------
  migration: make migrate_fd_wait_for_unfreeze() return errors

Adjust all callers

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: ffbfc74d1eb822ed086503a6c24413617c19d31a
      https://github.com/qemu/qemu/commit/ffbfc74d1eb822ed086503a6c24413617c19d31a
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M qemu-file.h
    M savevm.c

  Log Message:
  -----------
  savevm: unexport qemu_fflush

It is not used outside of savevm.c

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: e398d61b4777125f32a99fa49519c5edbb00809b
      https://github.com/qemu/qemu/commit/e398d61b4777125f32a99fa49519c5edbb00809b
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M hw/virtio-net.c

  Log Message:
  -----------
  virtio-net: use qemu_get_buffer() in a temp buffer

qemu_fseek() is known to be wrong.  Would be removed on the next
commit.  This code should never been used (value has been
MAC_TABLE_ENTRIES since 2009).

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: e5ae97cee4c0ecd252991aa868c6e233ef8c8f35
      https://github.com/qemu/qemu/commit/e5ae97cee4c0ecd252991aa868c6e233ef8c8f35
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M qemu-file.h
    M savevm.c

  Log Message:
  -----------
  savevm: Remove qemu_fseek()

It has no users, and is only half implemented.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 7311bea33fab3bed02e9fca8b36fd6234a3a7cb9
      https://github.com/qemu/qemu/commit/7311bea33fab3bed02e9fca8b36fd6234a3a7cb9
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M savevm.c

  Log Message:
  -----------
  savevm: make qemu_fflush() return an error code

Adjust all the callers.  We moved the set of last_error from inside
qemu_fflush() to all the callers.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 29eee86f312a7351b0e694e48b435084355630f7
      https://github.com/qemu/qemu/commit/29eee86f312a7351b0e694e48b435084355630f7
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M savevm.c

  Log Message:
  -----------
  savevm: unfold qemu_fclose_internal()

It was used only one, and was only one if.  It makes error handling
saner.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 3aee4be1de440de08ef68b936e51e028a9f6f6ab
      https://github.com/qemu/qemu/commit/3aee4be1de440de08ef68b936e51e028a9f6f6ab
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M qemu-file.h
    M savevm.c

  Log Message:
  -----------
  savevm: unexport qemu_ftell()

It was unused out of savevm.c.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 02c4a0511bc58b005511c94055a55b1e19c6be71
      https://github.com/qemu/qemu/commit/02c4a0511bc58b005511c94055a55b1e19c6be71
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M savevm.c

  Log Message:
  -----------
  savevm: make qemu_fill_buffer() be consistent

It was setting last_error directly once, and with the helper the other time.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: c10682cb031525a8bdf3999ef6a033777929d304
      https://github.com/qemu/qemu/commit/c10682cb031525a8bdf3999ef6a033777929d304
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M savevm.c

  Log Message:
  -----------
  savevm: Only qemu_fflush() can generate errors

Move the error check to the beggining of the callers.  Once this is fixed
qemu_file_set_if_error() is not used anymore, so remove it.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 81fdf640e4b479df75fcedf03fb300018f054bfa
      https://github.com/qemu/qemu/commit/81fdf640e4b479df75fcedf03fb300018f054bfa
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M buffered_file.c

  Log Message:
  -----------
  buffered_file: buffered_put_buffer() don't need to set last_error

Callers on savevm.c:qemu_fflush() will set it.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 59feec424723c0cacf503670a42d76e7c47167c1
      https://github.com/qemu/qemu/commit/59feec424723c0cacf503670a42d76e7c47167c1
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M block-migration.c

  Log Message:
  -----------
  block-migration: make flush_blks() return errors

This means we don't need to pass through qemu_file to get the errors.
Adjust all callers.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: ceb2bd09a13ea71d06353bf826524df3cf584735
      https://github.com/qemu/qemu/commit/ceb2bd09a13ea71d06353bf826524df3cf584735
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M block-migration.c

  Log Message:
  -----------
  block-migration:  Switch meaning of return value

Make consistent the result of blk_mig_save_dirty_block() and
mig_save_device_dirty()

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 43be3a25c931a7f61a76fbfc9d35584cbfc5fb58
      https://github.com/qemu/qemu/commit/43be3a25c931a7f61a76fbfc9d35584cbfc5fb58
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M block-migration.c

  Log Message:
  -----------
  block-migration: handle errors with the return codes correctly

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 6f121ff575e1601d652f3eecf4f9ab1205c12df1
      https://github.com/qemu/qemu/commit/6f121ff575e1601d652f3eecf4f9ab1205c12df1
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M qemu-file.h
    M savevm.c

  Log Message:
  -----------
  savevm: un-export qemu_file_set_error()

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: a2b413512443e67cd58285b8d98b84792a66c710
      https://github.com/qemu/qemu/commit/a2b413512443e67cd58285b8d98b84792a66c710
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M migration.c
    M qemu-file.h
    M savevm.c

  Log Message:
  -----------
  savevm: make qemu_file_put_notify() return errors

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: aa723c23147e93fef8475bd80fd29e633378c34d
      https://github.com/qemu/qemu/commit/aa723c23147e93fef8475bd80fd29e633378c34d
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M cpus.c

  Log Message:
  -----------
  cpus: create qemu_in_vcpu_thread()

Old code used !io_thread to know if a thread was an vcpu or not.  That
fails when we introduce the iothread.

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;


  Commit: 95d2994a2f756c9c8684709421d40c45e63e4e04
      https://github.com/qemu/qemu/commit/95d2994a2f756c9c8684709421d40c45e63e4e04
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    M exec.c
    M kvm-all.c
    M kvm-stub.c
    M kvm.h
    M memory.c
    M memory.h

  Log Message:
  -----------
  memory: manage coalesced mmio via a MemoryListener

Instead of calling a global function on coalesced mmio changes, which
routes the call to kvm if enabled, add coalesced mmio hooks to
MemoryListener and make kvm use that instead.

The motivation is support for multiple address spaces (which means we
we need to filter the call on the right address space) but the result
is cleaner as well.

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 2673a5da25ea9005e562c20a18cf469ed4f21060
      https://github.com/qemu/qemu/commit/2673a5da25ea9005e562c20a18cf469ed4f21060
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    M exec-memory.h
    M exec.c
    M memory.c

  Log Message:
  -----------
  memory: move address_space_memory and address_space_io out of memory core

With this change, memory.c no longer knows anything about special address
spaces, so it is prepared for AddressSpace based DMA.

Reviewed-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 1d71148eace669827ba15101819b54b20fcca616
      https://github.com/qemu/qemu/commit/1d71148eace669827ba15101819b54b20fcca616
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    M exec.c

  Log Message:
  -----------
  memory: move tcg flush into a tcg memory listener

We plan to make the core listener listen to all address spaces; this
will cause many more flushes than necessary.  Prepare for that by
moving the flush into a tcg-specific listener.

Later we can avoid registering the listener if tcg is disabled.

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: f6790af6bcfa35fa9ea3c565a0a2aed54337aef5
      https://github.com/qemu/qemu/commit/f6790af6bcfa35fa9ea3c565a0a2aed54337aef5
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    M exec-memory.h
    M exec.c
    M hw/vfio_pci.c
    M hw/vhost.c
    M hw/xen_pt.c
    M kvm-all.c
    M memory.c
    M memory.h
    M xen-all.c

  Log Message:
  -----------
  memory: use AddressSpace for MemoryListener filtering

Using the AddressSpace type reduces confusion, as you can't accidentally
supply the MemoryRegion you're interested in.

Reviewed-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 0e8a6d47afcc88564079387928f2da45736d36e8
      https://github.com/qemu/qemu/commit/0e8a6d47afcc88564079387928f2da45736d36e8
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    M target-s390x/misc_helper.c

  Log Message:
  -----------
  s390: avoid reaching into memory core internals

use cpu_physical_memory_is_io() instead.

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: ac1970fbe8ad5a70174f462109ac0f6c7bf1bc43
      https://github.com/qemu/qemu/commit/ac1970fbe8ad5a70174f462109ac0f6c7bf1bc43
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    M cputlb.c
    M cputlb.h
    M exec.c
    M memory-internal.h
    M memory.c
    M memory.h

  Log Message:
  -----------
  memory: per-AddressSpace dispatch

Currently we use a global radix tree to dispatch memory access.  This only
works with a single address space; to support multiple address spaces we
make the radix tree a member of AddressSpace (via an intermediate structure
AddressSpaceDispatch to avoid exposing too many internals).

A side effect is that address_space_io also gains a dispatch table.  When
we remove all the pre-memory-API I/O registrations, we can use that for
dispatching I/O and get rid of the original I/O dispatch.

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: b90600eed3c0efe5f3260853c873caf51c0677b1
      https://github.com/qemu/qemu/commit/b90600eed3c0efe5f3260853c873caf51c0677b1
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    M dma-helpers.c
    M dma.h
    M hw/spapr_iommu.c

  Log Message:
  -----------
  dma: make dma access its own address space

Instead of accessing the cpu address space, use an address space
configured by the caller.

Eventually all dma functionality will be folded into AddressSpace,
but we have to start from something.

Reviewed-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 83f3c251422b0724044f976a7ff26b2e8a47c374
      https://github.com/qemu/qemu/commit/83f3c251422b0724044f976a7ff26b2e8a47c374
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    M exec.c
    M memory-internal.h
    M memory.c
    M memory.h

  Log Message:
  -----------
  memory: add address_space_destroy()

Since address spaces can be created dynamically by device hotplug, they
can also be destroyed dynamically.

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 817dcc5368988b023c5e1d3f1444fd370c77c6a9
      https://github.com/qemu/qemu/commit/817dcc5368988b023c5e1d3f1444fd370c77c6a9
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    M hw/pci.c
    M hw/pci.h

  Log Message:
  -----------
  pci: give each device its own address space

Accesses from different devices can resolve differently
(depending on bridge settings, iommus, and PCI_COMMAND_MASTER), so
set up an address space for each device.

Currently iommus are expressed outside the memory API, so this doesn't
work if an iommu is present.

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 1c380f9460522f32c8dd2577b2a53d518ec91c6d
      https://github.com/qemu/qemu/commit/1c380f9460522f32c8dd2577b2a53d518ec91c6d
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    M hw/pci.c
    M hw/pci.h

  Log Message:
  -----------
  pci: honor PCI_COMMAND_MASTER

Currently we ignore PCI_COMMAND_MASTER completely: DMA succeeds even when
the bit is clear.

Honor PCI_COMMAND_MASTER by inserting a memory region into the device's
bus master address space, and tying its enable status to PCI_COMMAND_MASTER.

Tested using

  setpci -s 03 COMMAND=3

while a ping was running on a NIC in slot 3.  The kernel (Linux) detected
the stall and recovered after the command

  setpci -s 03 COMMAND=7

was issued.

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: d3e2efc5b540c4e99ed5bcc0db3b1158ef52af43
      https://github.com/qemu/qemu/commit/d3e2efc5b540c4e99ed5bcc0db3b1158ef52af43
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    M cputlb.c
    M cputlb.h
    M dma-helpers.c
    M dma.h
    M exec-memory.h
    R exec-obsolete.h
    M exec.c
    M hw/pci.c
    M hw/pci.h
    M hw/spapr_iommu.c
    M hw/vfio_pci.c
    M hw/vhost.c
    M hw/xen_pt.c
    M hw/xen_pt.h
    M kvm-all.c
    M kvm-stub.c
    M kvm.h
    A memory-internal.h
    M memory.c
    M memory.h
    M target-s390x/misc_helper.c
    M xen-all.c

  Log Message:
  -----------
  Merge remote-tracking branch 'qemu-kvm/memory/dma' into staging

* qemu-kvm/memory/dma: (23 commits)
  pci: honor PCI_COMMAND_MASTER
  pci: give each device its own address space
  memory: add address_space_destroy()
  dma: make dma access its own address space
  memory: per-AddressSpace dispatch
  s390: avoid reaching into memory core internals
  memory: use AddressSpace for MemoryListener filtering
  memory: move tcg flush into a tcg memory listener
  memory: move address_space_memory and address_space_io out of memory core
  memory: manage coalesced mmio via a MemoryListener
  xen: drop no-op MemoryListener callbacks
  kvm: drop no-op MemoryListener callbacks
  xen_pt: drop no-op MemoryListener callbacks
  vfio: drop no-op MemoryListener callbacks
  memory: drop no-op MemoryListener callbacks
  memory: provide defaults for MemoryListener operations
  memory: maintain a list of address spaces
  memory: export AddressSpace
  memory: prepare AddressSpace for exporting
  xen_pt: use separate MemoryListeners for memory and I/O
  ...


  Commit: f526f3c315d7c3ff7b7db39ae3a49f91d3a9986b
      https://github.com/qemu/qemu/commit/f526f3c315d7c3ff7b7db39ae3a49f91d3a9986b
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    M arch_init.c
    M block-migration.c
    M buffered_file.c
    M buffered_file.h
    M cpu-all.h
    M cpus.c
    M exec.c
    M hmp.c
    M hw/virtio-net.c
    M memory-internal.h
    M migration.c
    M migration.h
    M qapi-schema.json
    M qemu-file.h
    M qmp-commands.hx
    M savevm.c
    M trace-events

  Log Message:
  -----------
  Merge remote-tracking branch 'quintela/migration-next-20121017' into staging

* quintela/migration-next-20121017: (41 commits)
  cpus: create qemu_in_vcpu_thread()
  savevm: make qemu_file_put_notify() return errors
  savevm: un-export qemu_file_set_error()
  block-migration: handle errors with the return codes correctly
  block-migration:  Switch meaning of return value
  block-migration: make flush_blks() return errors
  buffered_file: buffered_put_buffer() don't need to set last_error
  savevm: Only qemu_fflush() can generate errors
  savevm: make qemu_fill_buffer() be consistent
  savevm: unexport qemu_ftell()
  savevm: unfold qemu_fclose_internal()
  savevm: make qemu_fflush() return an error code
  savevm: Remove qemu_fseek()
  virtio-net: use qemu_get_buffer() in a temp buffer
  savevm: unexport qemu_fflush
  migration: make migrate_fd_wait_for_unfreeze() return errors
  buffered_file: make buffered_flush return the error code
  buffered_file: callers of buffered_flush() already check for errors
  buffered_file: We can access directly to bandwidth_limit
  buffered_file: unfold migrate_fd_close
  ...


  Commit: ad0b5321f1f797274603ebbe20108b0750baee94
      https://github.com/qemu/qemu/commit/ad0b5321f1f797274603ebbe20108b0750baee94
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    M exec.c
    M osdep.h

  Log Message:
  -----------
  Call MADV_HUGEPAGE for guest RAM allocations

This makes it possible for QEMU to use transparent huge pages (THP)
when transparent_hugepage/enabled=madvise. Otherwise THP is only
used when it's enabled system wide.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 488cb996cd8d8eaa5ecfdc6ba5f6cbd23a13271b
      https://github.com/qemu/qemu/commit/488cb996cd8d8eaa5ecfdc6ba5f6cbd23a13271b
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    M hw/Makefile.objs
    M hw/alpha_dp264.c
    M hw/kzm.c
    M hw/mips_fulong2e.c
    M hw/mips_jazz.c
    M hw/mips_malta.c
    M hw/mips_mipssim.c
    M hw/mips_r4k.c
    M hw/musicpal.c
    M hw/omap_uart.c
    M hw/openrisc_sim.c
    M hw/pc.c
    M hw/pc.h
    M hw/petalogix_ml605_mmu.c
    M hw/ppc/e500.c
    M hw/ppc405_uc.c
    M hw/ppc440_bamboo.c
    M hw/ppc_prep.c
    M hw/pxa2xx.c
    A hw/serial-isa.c
    M hw/serial.c
    A hw/serial.h
    M hw/sm501.c
    M hw/sun4u.c
    M hw/virtex_ml507.c
    M hw/xtensa_lx60.c

  Log Message:
  -----------
  serial: split serial.c

Split serial.c into serial.c, serial.h and serial-isa.c.  While being at
creating a serial.h header file move the serial prototypes from pc.h to
the new serial.h.  The latter leads to s/pc.h/serial.h/ in tons of
boards which just want the serial bits from pc.h

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 419ad67208a37367932a5bf88d3860f85e06282c
      https://github.com/qemu/qemu/commit/419ad67208a37367932a5bf88d3860f85e06282c
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    M default-configs/pci.mak
    M hw/Makefile.objs
    M hw/pci_ids.h
    A hw/serial-pci.c
    M hw/serial.c
    M hw/serial.h

  Log Message:
  -----------
  serial: add pci variant

So we get a hot-pluggable 16550 uart.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: fe4f1793a6bd9fdd008a17aa695a2670ff438bb5
      https://github.com/qemu/qemu/commit/fe4f1793a6bd9fdd008a17aa695a2670ff438bb5
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    A docs/qemupciserial.inf

  Log Message:
  -----------
  serial: add windows inf file for the pci card to docs

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: d66bbea4e0d3faec69e8aa73789a2d1dc3b8312f
      https://github.com/qemu/qemu/commit/d66bbea4e0d3faec69e8aa73789a2d1dc3b8312f
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    M hw/serial-pci.c

  Log Message:
  -----------
  serial: add 2x + 4x pci variant

Add multiport serial card implementation, with two variants, one
featuring two and one featuring four ports.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 90734e02bd2fb137346d4184cec6c5d26e68f29b
      https://github.com/qemu/qemu/commit/90734e02bd2fb137346d4184cec6c5d26e68f29b
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    A docs/specs/pci-serial.txt
    M hw/serial-pci.c

  Log Message:
  -----------
  serial: add pci-serial documentation

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 70330fb3daa2ee295cc5c6f40133e8f8db47856d
      https://github.com/qemu/qemu/commit/70330fb3daa2ee295cc5c6f40133e8f8db47856d
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    M hw/usb/dev-serial.c

  Log Message:
  -----------
  usb-serial: don't magically zap chardev on umplug

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: da124e62de2109a312e21d85d6a3419774c58948
      https://github.com/qemu/qemu/commit/da124e62de2109a312e21d85d6a3419774c58948
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    M hw/usb/dev-serial.c

  Log Message:
  -----------
  usb-serial: only expose device in guest when the chardev is open

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/f354b1a1ee7a...da124e62de21

----==_mimepart_5085a5d4d5655_5cf91d25af4501a5--


</body></email><email><emailId>20121023183015</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-23 18:30:15-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 28f362: memory: Make eventfd adhere to device endianness</subject><body>



----==_mimepart_5086e23742eb0_673514fdae811353b
Date: Tue, 23 Oct 2012 11:30:15 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5086e2374701a_673514fdae811369e@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 28f362be6e7f45ea9b7a57a08555c4c784f36198
      https://github.com/qemu/qemu/commit/28f362be6e7f45ea9b7a57a08555c4c784f36198
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M memory.c

  Log Message:
  -----------
  memory: Make eventfd adhere to device endianness

Our memory API MMIO regions know the concept of device endianness. This
is used to automatically swap endianness between devices and host CPU,
depending on whether buses in between would swizzle the bits.

The ioeventfd value comparison does not adhere to that semantic though.
Probably because nobody has been running ioeventfd on a BE platform and
the only device implementing ioeventfd right now is LE (PCI) based.

So add swizzling to ioeventfd registration / deletion to make the rest
of the code as consistent as possible.

Thanks a lot to Michael Tsirkin to point me towards the right direction.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 2725aec70114cf1bee00443aeb47a305f9b0c665
      https://github.com/qemu/qemu/commit/2725aec70114cf1bee00443aeb47a305f9b0c665
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M hw/piix_pci.c

  Log Message:
  -----------
  i440fx: avoid destroying memory regions within a transaction

Calling memory_region_destroy() within a transaction is illegal, since
the memory API is allowed to continue to dispatch to a region until the
transaction commits.  440fx does that however when managing PAM registers.

This bug is benign, since the regions are all aliases (which the memory
core tends to throw anyway), and since we don't do concurrent dispatch yet,
but instead of relying on that, tighten ship ahead of the coming concurrency
storm.

Fix by having a predefined set of regions, of which one will be enabled at
any time.

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 2be0e25f4b6a4f91e39388cc365bbe53b56ab62a
      https://github.com/qemu/qemu/commit/2be0e25f4b6a4f91e39388cc365bbe53b56ab62a
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M memory.c

  Log Message:
  -----------
  memory: abort if a memory region is destroyed during a transaction

Destroying a memory region is illegal within a transaction, as until
the transaction is committed, the memory core may hold references to
the region.  Add an assert to check for violations of this rule.

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: a011b10e0c385c58469e654595801a592fb4137a
      https://github.com/qemu/qemu/commit/a011b10e0c385c58469e654595801a592fb4137a
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M hw/vfio_pci.c

  Log Message:
  -----------
  vfio-pci: Fix debug build

Stray variable from before MSI-X rework

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;


  Commit: d9f0e63898d639629bb7eb914786529185334635
      https://github.com/qemu/qemu/commit/d9f0e63898d639629bb7eb914786529185334635
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-17 (Wed, 17 Oct 2012)

  Changed paths:
    M hw/vfio_pci.c

  Log Message:
  -----------
  vfio-pci: Mark non-migratable

We haven't magically fixed this yet.  Toss in a description too.

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;


  Commit: 248bbe74930472e7653dd88716188ab0329f4604
      https://github.com/qemu/qemu/commit/248bbe74930472e7653dd88716188ab0329f4604
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    M hw/vfio_pci.c

  Log Message:
  -----------
  Merge remote-tracking branch 'awilliam/tags/vfio-pci-for-qemu-20121017.0' into staging

* awilliam/tags/vfio-pci-for-qemu-20121017.0:
  vfio-pci: Mark non-migratable
  vfio-pci: Fix debug build


  Commit: 50d2b4d93f45a425f15ac88bc4ec352f5c6e0bc2
      https://github.com/qemu/qemu/commit/50d2b4d93f45a425f15ac88bc4ec352f5c6e0bc2
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-22 (Mon, 22 Oct 2012)

  Changed paths:
    M hw/piix_pci.c
    M memory.c

  Log Message:
  -----------
  Merge remote-tracking branch 'qemu-kvm/memory/urgent' into staging

* qemu-kvm/memory/urgent:
  memory: abort if a memory region is destroyed during a transaction
  i440fx: avoid destroying memory regions within a transaction
  memory: Make eventfd adhere to device endianness


  Commit: a8170e5e97ad17ca169c64ba87ae2f53850dab4c
      https://github.com/qemu/qemu/commit/a8170e5e97ad17ca169c64ba87ae2f53850dab4c
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M HACKING
    M cpu-all.h
    M cpu-common.h
    M cpu-defs.h
    M cputlb.c
    M cputlb.h
    M disas.h
    M dma-helpers.c
    M dma.h
    M dump.c
    M exec-all.h
    M exec.c
    M hw/a9mpcore.c
    M hw/alpha_pci.c
    M hw/alpha_typhoon.c
    M hw/an5206.c
    M hw/apb_pci.c
    M hw/apb_pci.h
    M hw/apic.c
    M hw/apic_common.c
    M hw/apic_internal.h
    M hw/arm-misc.h
    M hw/arm11mpcore.c
    M hw/arm_boot.c
    M hw/arm_gic.c
    M hw/arm_l2x0.c
    M hw/arm_mptimer.c
    M hw/arm_sysctl.c
    M hw/arm_timer.c
    M hw/armv7m.c
    M hw/armv7m_nvic.c
    M hw/axis_dev88.c
    M hw/bonito.c
    M hw/cadence_gem.c
    M hw/cadence_ttc.c
    M hw/cadence_uart.c
    M hw/cirrus_vga.c
    M hw/cris-boot.h
    M hw/cs4231.c
    M hw/cs4231a.c
    M hw/cuda.c
    M hw/dma.c
    M hw/dp8393x.c
    M hw/ds1225y.c
    M hw/dummy_m68k.c
    M hw/e1000.c
    M hw/eccmemctl.c
    M hw/eepro100.c
    M hw/elf_ops.h
    M hw/empty_slot.c
    M hw/empty_slot.h
    M hw/escc.c
    M hw/escc.h
    M hw/esp-pci.c
    M hw/esp.c
    M hw/esp.h
    M hw/etraxfs.h
    M hw/etraxfs_dma.c
    M hw/etraxfs_dma.h
    M hw/etraxfs_eth.c
    M hw/etraxfs_pic.c
    M hw/etraxfs_ser.c
    M hw/etraxfs_timer.c
    M hw/exynos4210.h
    M hw/exynos4210_combiner.c
    M hw/exynos4210_fimd.c
    M hw/exynos4210_i2c.c
    M hw/exynos4210_mct.c
    M hw/exynos4210_pmu.c
    M hw/exynos4210_pwm.c
    M hw/exynos4210_rtc.c
    M hw/exynos4210_uart.c
    M hw/fdc.c
    M hw/fdc.h
    M hw/flash.h
    M hw/framebuffer.c
    M hw/framebuffer.h
    M hw/fw_cfg.c
    M hw/fw_cfg.h
    M hw/g364fb.c
    M hw/grlib.h
    M hw/grlib_apbuart.c
    M hw/grlib_gptimer.c
    M hw/grlib_irqmp.c
    M hw/gt64xxx.c
    M hw/heathrow_pic.c
    M hw/highbank.c
    M hw/hpet.c
    M hw/i82378.c
    M hw/i8259.c
    M hw/ide.h
    M hw/ide/ahci.c
    M hw/ide/cmd646.c
    M hw/ide/macio.c
    M hw/ide/mmio.c
    M hw/ide/pci.c
    M hw/ide/piix.c
    M hw/ide/via.c
    M hw/imx.h
    M hw/imx_avic.c
    M hw/imx_ccm.c
    M hw/imx_serial.c
    M hw/imx_timer.c
    M hw/integratorcp.c
    M hw/intel-hda.c
    M hw/ioapic.c
    M hw/isa-bus.c
    M hw/isa.h
    M hw/isa_mmio.c
    M hw/ivshmem.c
    M hw/jazz_led.c
    M hw/kvm/apic.c
    M hw/kvm/pci-assign.c
    M hw/kvmvapic.c
    M hw/lan9118.c
    M hw/lance.c
    M hw/lm32_boards.c
    M hw/lm32_hwsetup.h
    M hw/lm32_sys.c
    M hw/lm32_timer.c
    M hw/lm32_uart.c
    M hw/lm4549.c
    M hw/lm4549.h
    M hw/loader.c
    M hw/loader.h
    M hw/lsi53c895a.c
    M hw/m48t59.c
    M hw/mac_dbdma.c
    M hw/mac_dbdma.h
    M hw/mac_nvram.c
    M hw/mainstone.c
    M hw/marvell_88w8618_audio.c
    M hw/mcf.h
    M hw/mcf5206.c
    M hw/mcf5208.c
    M hw/mcf_fec.c
    M hw/mcf_intc.c
    M hw/mcf_uart.c
    M hw/megasas.c
    M hw/microblaze_boot.c
    M hw/microblaze_boot.h
    M hw/milkymist-ac97.c
    M hw/milkymist-hpdmc.c
    M hw/milkymist-hw.h
    M hw/milkymist-memcard.c
    M hw/milkymist-minimac2.c
    M hw/milkymist-pfpu.c
    M hw/milkymist-softusb.c
    M hw/milkymist-sysctl.c
    M hw/milkymist-tmu2.c
    M hw/milkymist-uart.c
    M hw/milkymist-vgafb.c
    M hw/milkymist.c
    M hw/mips.h
    M hw/mips_jazz.c
    M hw/mips_malta.c
    M hw/mips_r4k.c
    M hw/mipsnet.c
    M hw/mpc8544_guts.c
    M hw/msix.c
    M hw/mst_fpga.c
    M hw/multiboot.c
    M hw/musicpal.c
    M hw/ne2000.c
    M hw/nvram.h
    M hw/omap.h
    M hw/omap1.c
    M hw/omap2.c
    M hw/omap_dma.c
    M hw/omap_dss.c
    M hw/omap_gpio.c
    M hw/omap_gpmc.c
    M hw/omap_gptimer.c
    M hw/omap_i2c.c
    M hw/omap_intc.c
    M hw/omap_l4.c
    M hw/omap_lcdc.c
    M hw/omap_mmc.c
    M hw/omap_sdrc.c
    M hw/omap_spi.c
    M hw/omap_sx1.c
    M hw/omap_synctimer.c
    M hw/omap_tap.c
    M hw/omap_uart.c
    M hw/onenand.c
    M hw/opencores_eth.c
    M hw/openpic.c
    M hw/openpic.h
    M hw/openrisc_sim.c
    M hw/palm.c
    M hw/parallel.c
    M hw/pc.c
    M hw/pc.h
    M hw/pc_piix.c
    M hw/pc_sysfw.c
    M hw/pci.c
    M hw/pci_host.c
    M hw/pcie_host.c
    M hw/pcie_host.h
    M hw/pckbd.c
    M hw/pcnet-pci.c
    M hw/pcnet.c
    M hw/pcnet.h
    M hw/pcspk.c
    M hw/petalogix_ml605_mmu.c
    M hw/petalogix_s3adsp1800_mmu.c
    M hw/pflash_cfi01.c
    M hw/pflash_cfi02.c
    M hw/piix_pci.c
    M hw/pl011.c
    M hw/pl022.c
    M hw/pl031.c
    M hw/pl041.c
    M hw/pl050.c
    M hw/pl061.c
    M hw/pl080.c
    M hw/pl110.c
    M hw/pl181.c
    M hw/pl190.c
    M hw/ppc/e500.c
    M hw/ppc405.h
    M hw/ppc405_boards.c
    M hw/ppc405_uc.c
    M hw/ppc440_bamboo.c
    M hw/ppc4xx.h
    M hw/ppc4xx_devs.c
    M hw/ppc4xx_pci.c
    M hw/ppc_mac.h
    M hw/ppc_newworld.c
    M hw/ppc_oldworld.c
    M hw/ppc_prep.c
    M hw/ppce500_pci.c
    M hw/ppce500_spin.c
    M hw/prep_pci.c
    M hw/puv3_dma.c
    M hw/puv3_gpio.c
    M hw/puv3_intc.c
    M hw/puv3_ost.c
    M hw/puv3_pm.c
    M hw/pxa.h
    M hw/pxa2xx.c
    M hw/pxa2xx_dma.c
    M hw/pxa2xx_gpio.c
    M hw/pxa2xx_keypad.c
    M hw/pxa2xx_lcd.c
    M hw/pxa2xx_mmci.c
    M hw/pxa2xx_pcmcia.c
    M hw/pxa2xx_pic.c
    M hw/pxa2xx_timer.c
    M hw/qdev-addr.c
    M hw/qdev-addr.h
    M hw/qxl.c
    M hw/r2d.c
    M hw/rc4030.c
    M hw/realview.c
    M hw/rtl8139.c
    M hw/s390-virtio-bus.c
    M hw/s390-virtio.c
    M hw/sbi.c
    M hw/serial.c
    M hw/serial.h
    M hw/sh.h
    M hw/sh7750.c
    M hw/sh_intc.c
    M hw/sh_pci.c
    M hw/sh_serial.c
    M hw/sh_timer.c
    M hw/sharpsl.h
    M hw/shpc.c
    M hw/slavio_intctl.c
    M hw/slavio_misc.c
    M hw/slavio_timer.c
    M hw/sm501.c
    M hw/smc91c111.c
    M hw/soc_dma.c
    M hw/soc_dma.h
    M hw/spapr.c
    M hw/spapr.h
    M hw/spapr_iommu.c
    M hw/spapr_pci.c
    M hw/spapr_pci.h
    M hw/spapr_rtas.c
    M hw/sparc32_dma.c
    M hw/sparc32_dma.h
    M hw/spitz.c
    M hw/stellaris.c
    M hw/stellaris_enet.c
    M hw/strongarm.c
    M hw/sun4c_intctl.c
    M hw/sun4m.c
    M hw/sun4m.h
    M hw/sun4m_iommu.c
    M hw/sun4u.c
    M hw/sysbus.c
    M hw/sysbus.h
    M hw/tc6393xb.c
    M hw/tcx.c
    M hw/tusb6010.c
    M hw/unin_pci.c
    M hw/usb/hcd-ehci.c
    M hw/usb/hcd-musb.c
    M hw/usb/hcd-ohci.c
    M hw/usb/hcd-xhci.c
    M hw/versatile_i2c.c
    M hw/versatile_pci.c
    M hw/versatilepb.c
    M hw/vexpress.c
    M hw/vfio_pci.c
    M hw/vga-isa-mm.c
    M hw/vga-pci.c
    M hw/vga.c
    M hw/vga_int.h
    M hw/vhost.c
    M hw/virtex_ml507.c
    M hw/virtio-pci.c
    M hw/virtio-scsi.c
    M hw/virtio.c
    M hw/virtio.h
    M hw/vmware_vga.c
    M hw/wdt_i6300esb.c
    M hw/xen_apic.c
    M hw/xen_platform.c
    M hw/xen_pt.c
    M hw/xen_pt_msi.c
    M hw/xgmac.c
    M hw/xilinx.h
    M hw/xilinx_axidma.c
    M hw/xilinx_axienet.c
    M hw/xilinx_ethlite.c
    M hw/xilinx_intc.c
    M hw/xilinx_spi.c
    M hw/xilinx_spips.c
    M hw/xilinx_timer.c
    M hw/xilinx_uartlite.c
    M hw/xtensa_lx60.c
    M hw/zaurus.c
    M hw/zynq_slcr.c
    A hwaddr.h
    M kvm-all.c
    M kvm.h
    M memory-internal.h
    M memory.c
    M memory.h
    M memory_mapping.c
    M memory_mapping.h
    M monitor.c
    M softmmu_template.h
    M target-alpha/cpu.h
    M target-alpha/helper.c
    M target-alpha/mem_helper.c
    M target-arm/helper.c
    M target-cris/helper.c
    M target-i386/arch_memory_mapping.c
    M target-i386/helper.c
    M target-i386/kvm.c
    M target-i386/svm_helper.c
    M target-lm32/helper.c
    M target-m68k/helper.c
    M target-microblaze/cpu.h
    M target-microblaze/helper.c
    M target-microblaze/op_helper.c
    M target-mips/cpu.h
    M target-mips/helper.c
    M target-mips/op_helper.c
    M target-openrisc/cpu.h
    M target-openrisc/mmu.c
    M target-ppc/cpu.h
    M target-ppc/mmu_helper.c
    M target-s390x/cpu.h
    M target-s390x/helper.c
    M target-s390x/mem_helper.c
    M target-sh4/cpu.h
    M target-sh4/helper.c
    M target-sparc/cpu.h
    M target-sparc/ldst_helper.c
    M target-sparc/mmu_helper.c
    M target-unicore32/softmmu.c
    M target-xtensa/helper.c
    M target-xtensa/xtensa-semi.c
    R targphys.h
    M xen-all.c
    M xen-mapcache.c
    M xen-mapcache.h

  Log Message:
  -----------
  Rename target_phys_addr_t to hwaddr

target_phys_addr_t is unwieldly, violates the C standard (_t suffixes are
reserved) and its purpose doesn't match the name (most target_phys_addr_t
addresses are not target specific).  Replace it with a finger-friendly,
standards conformant hwaddr.

Outstanding patchsets can be fixed up with the command

  git rebase -i --exec 'find -name "*.[ch]"
                  | xargs s/target_phys_addr_t/hwaddr/g' origin

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/da124e62de21...a8170e5e97ad

----==_mimepart_5086e23742eb0_673514fdae811353b--


</body></email><email><emailId>20121026160012</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-26 16:00:12-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 680d16: error: add error_set_errno and error_setg_errno</subject><body>



----==_mimepart_508ab38cf714_674c15faaf4368ef
Date: Fri, 26 Oct 2012 09:00:12 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;508ab38c16340_674c15faaf4369ab@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 680d16dcb79f999fad3a652c5190d6a5c6ea10dd
      https://github.com/qemu/qemu/commit/680d16dcb79f999fad3a652c5190d6a5c6ea10dd
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M error.c
    M error.h

  Log Message:
  -----------
  error: add error_set_errno and error_setg_errno

These functions help maintaining homogeneous formatting of error
messages that include strerror values.

Acked-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 7fc4e63ec018a0ef6d420ddb7f6cbf68387d4995
      https://github.com/qemu/qemu/commit/7fc4e63ec018a0ef6d420ddb7f6cbf68387d4995
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M nbd.c
    M qemu-char.c
    M qemu-sockets.c
    M qemu_socket.h
    M qga/channel-posix.c
    M ui/vnc.c

  Log Message:
  -----------
  qemu-sockets: add Error ** to all functions

This lets me adjust the clients to do proper error propagation first,
thus avoiding temporary regressions in the quality of the error messages.

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 0c814709471ac8a9617406e1e2cbd7015e97bfe9
      https://github.com/qemu/qemu/commit/0c814709471ac8a9617406e1e2cbd7015e97bfe9
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M qemu-sockets.c

  Log Message:
  -----------
  qemu-sockets: unix_listen and unix_connect are portable

They are just wrappers and do not need a Win32-specific version.

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 1fc05adfa0f79a1268f7c2b7fb324f15eb63dceb
      https://github.com/qemu/qemu/commit/1fc05adfa0f79a1268f7c2b7fb324f15eb63dceb
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M qemu-char.c
    M qemu-sockets.c
    M qemu_socket.h

  Log Message:
  -----------
  qemu-sockets: add nonblocking connect for Unix sockets

This patch mostly mimics what was done to TCP sockets, but simpler
because there is only one address to try.  It also includes a free EINTR
bug fix.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: be7059cd7f8998d41f0b44ec13907359d04c63d2
      https://github.com/qemu/qemu/commit/be7059cd7f8998d41f0b44ec13907359d04c63d2
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M migration-tcp.c
    M migration.c

  Log Message:
  -----------
  migration: avoid using error_is_set and thus relying on errp != NULL

The migration code is using errp to detect "internal" errors, this means
that it relies on errp being non-NULL.

No impact so far because our only QMP clients (the QMP marshaller and HMP)
never pass a NULL Error **.  But if we had others, this patch would make
sure that migration can work with a NULL Error **.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 342ab8d1e4f8650a22a3a1c9fade31df3fd9c1c1
      https://github.com/qemu/qemu/commit/342ab8d1e4f8650a22a3a1c9fade31df3fd9c1c1
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M migration-tcp.c
    M migration-unix.c
    M migration.c

  Log Message:
  -----------
  migration: centralize call to migrate_fd_error()

The call to migrate_fd_error() was missing for non-socket backends, so
centralize it in qmp_migrate().

Before:

    (qemu) migrate fd:ffff
    migrate: An undefined error has occurred
    (qemu) info migrate
    (qemu)

After:

    (qemu) migrate fd:ffff
    migrate: An undefined error has occurred
    (qemu) info migrate
    capabilities: xbzrle: off
    Migration status: failed
    total time: 0 milliseconds

(The awful error message will be fixed later in the series).

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: e08c95ce8d66276198704f21ed9df6d99b3477e0
      https://github.com/qemu/qemu/commit/e08c95ce8d66276198704f21ed9df6d99b3477e0
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M migration-unix.c
    M migration.c
    M migration.h

  Log Message:
  -----------
  migration: use qemu-sockets to establish Unix sockets

This makes migration-unix.c again a cut-and-paste job from migration-tcp.c,
exactly as it was in the beginning. :)

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: f37afb5ab1921f42043b5527a517eef95c36acf8
      https://github.com/qemu/qemu/commit/f37afb5ab1921f42043b5527a517eef95c36acf8
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M migration-exec.c
    M migration-fd.c
    M migration-tcp.c
    M migration-unix.c
    M migration.c
    M migration.h

  Log Message:
  -----------
  migration (outgoing): add error propagation for all protocols

Error propagation is already there for socket backends.  Add it to other
protocols, simplifying code that tests for errors that will never happen.
With all protocols understanding Error, the code can be simplified
further by removing the return value.

Unfortunately, the quality of error messages varies depending
on where the error is detected, because no Error is passed to the
NonBlockingConnectHandler.  Thus, the exact error message still cannot
be sent to the user if the OS reports it asynchronously via SO_ERROR.
If NonBlockingConnectHandler received an Error**, we could for
example report the error class and/or message via a new field of the
query-migration command even if it is reported asynchronously.

Before:

    (qemu) migrate fd:ffff
    migrate: An undefined error has occurred
    (qemu) info migrate
    (qemu)

After:

    (qemu) migrate fd:ffff
    migrate: File descriptor named 'ffff' has not been found
    (qemu) info migrate
    capabilities: xbzrle: off
    Migration status: failed
    total time: 0 milliseconds

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 43eaae28e0394f8fb80848fb40aa5d28c6360321
      https://github.com/qemu/qemu/commit/43eaae28e0394f8fb80848fb40aa5d28c6360321
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M migration-exec.c
    M migration-fd.c
    M migration-tcp.c
    M migration-unix.c
    M migration.c
    M migration.h
    M vl.c

  Log Message:
  -----------
  migration (incoming): add error propagation to fd and exec protocols

And remove the superfluous integer return value.

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 87d5f24f3f5edc4b69d071d5966cea0aec7b571d
      https://github.com/qemu/qemu/commit/87d5f24f3f5edc4b69d071d5966cea0aec7b571d
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M qemu-char.c

  Log Message:
  -----------
  qemu-char: ask and print error information from qemu-sockets

Before:

    $ qemu-system-x86_64 -monitor tcp:localhost:6000
    (starts despite error)

    $ qemu-system-x86_64 -monitor tcp:foo.bar:12345
    getaddrinfo(foo.bar,12345): Name or service not known
    chardev: opening backend "socket" failed

    $ qemu-system-x86_64 -monitor tcp:localhost:443,server=on
    inet_listen_opts: bind(ipv4,127.0.0.1,443): Permission denied
    inet_listen_opts: FAILED
    chardev: opening backend "socket" failed

After:

    $ x86_64-softmmu/qemu-system-x86_64 -monitor tcp:localhost:6000
    x86_64-softmmu/qemu-system-x86_64: -monitor tcp:localhost:6000: Failed to connect \
to socket: Connection refused  chardev: opening backend "socket" failed

    $ x86_64-softmmu/qemu-system-x86_64 -monitor tcp:foo.bar:12345
    qemu-system-x86_64: -monitor tcp:foo.bar:12345: address resolution failed for \
foo.bar:12345: Name or service not known  chardev: opening backend "socket" failed

    $ x86_64-softmmu/qemu-system-x86_64 -monitor tcp:localhost:443,server=on
    qemu-system-x86_64: -monitor tcp:localhost:443,server=on: Failed to bind socket: \
Permission denied  chardev: opening backend "socket" failed

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: f8430e7621b3319f6b94c735c811b2a2448cd6ea
      https://github.com/qemu/qemu/commit/f8430e7621b3319f6b94c735c811b2a2448cd6ea
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M nbd.c

  Log Message:
  -----------
  nbd: ask and print error information from qemu-sockets

Before:

    $ qemu-system-x86_64 nbd:localhost:12345
    inet_connect_opts: connect(ipv4,yakj.usersys.redhat.com,127.0.0.1,12345): \
Connection refused  qemu-system-x86_64: could not open disk image \
nbd:localhost:12345: Connection refused

After:

    $ x86_64-softmmu/qemu-system-x86_64 nbd:localhost:12345
    qemu-system-x86_64: Failed to connect to socket: Connection refused
    qemu-system-x86_64: could not open disk image nbd:localhost:12345: Connection \
refused

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 90119816e36ba019650214e7efeccdac1d4a9e32
      https://github.com/qemu/qemu/commit/90119816e36ba019650214e7efeccdac1d4a9e32
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M qga/channel-posix.c

  Log Message:
  -----------
  qemu-ga: ask and print error information from qemu-sockets

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: c1c1619c8b100f675bc97198218f3fcb0a740921
      https://github.com/qemu/qemu/commit/c1c1619c8b100f675bc97198218f3fcb0a740921
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M ui/vnc.c

  Log Message:
  -----------
  vnc: avoid Yoda conditionals

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 1ce52c78ab90c4303bcb110f2c614410386d79a2
      https://github.com/qemu/qemu/commit/1ce52c78ab90c4303bcb110f2c614410386d79a2
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M ui/vnc.c

  Log Message:
  -----------
  vnc: introduce a single label for error returns

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 007fcd3ee9673b3d00baacf3765bd501296155cd
      https://github.com/qemu/qemu/commit/007fcd3ee9673b3d00baacf3765bd501296155cd
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M console.h
    M qmp.c
    M ui/vnc.c

  Log Message:
  -----------
  vnc: reorganize code for reverse mode

Avoid the dance between csock and vs-&gt;lsock.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 2d55f0e817b6fa260282f5b5c533bcd470c75a32
      https://github.com/qemu/qemu/commit/2d55f0e817b6fa260282f5b5c533bcd470c75a32
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M ui/vnc.c
    M vl.c

  Log Message:
  -----------
  vnc: add error propagation to vnc_display_open

Before:

    $ qemu-system-x86_64 -vnc foo.bar:12345
    getaddrinfo(foo.bar,18245): Name or service not known
    Failed to start VNC server on `foo.bar:12345'

    $ qemu-system-x86_64 -vnc localhost:12345,reverse=on
    inet_connect_opts: connect(ipv4,yakj.usersys.redhat.com,127.0.0.1,12345): \
Connection refused  Failed to start VNC server on `localhost:12345,reverse=on'

After:

    $ x86_64-softmmu/qemu-system-x86_64 -vnc foo.bar:12345
    Failed to start VNC server on `foo.bar:12345': address resolution failed for \
foo.bar:18245: Name or service not known

    $ x86_64-softmmu/qemu-system-x86_64 -vnc localhost:12345,reverse=on
    Failed to start VNC server on `localhost:12345,reverse=on': Failed to connect to \
socket: Connection refused

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: a12fb8ad5b444174ecf3c3270f93ec59ad177bf3
      https://github.com/qemu/qemu/commit/a12fb8ad5b444174ecf3c3270f93ec59ad177bf3
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M qemu-sockets.c

  Log Message:
  -----------
  qemu-sockets: include strerror or gai_strerror output in error messages

Among others, before:

    $ qemu-system-x86_64 -chardev socket,port=12345,id=char
    inet_connect: host and/or port not specified
    chardev: opening backend "socket" failed

After:

    $ x86_64-softmmu/qemu-system-x86_64 -chardev socket,port=12345,id=char
    qemu-system-x86_64: -chardev socket,port=12345,id=char: host and/or port not \
specified  chardev: opening backend "socket" failed

perror and fprintf can be removed because all clients can now
consume Errors properly.

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 11663b553b0815b266b6a9060ab9702cf7a5334c
      https://github.com/qemu/qemu/commit/11663b553b0815b266b6a9060ab9702cf7a5334c
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M qemu-sockets.c

  Log Message:
  -----------
  qemu-sockets: add error propagation to inet_connect_addr

perror and fprintf can be removed because all clients can now consume
Errors properly.  However, we'll need to change the non-blocking connect
handlers to take an Error, in order to improve error handling for
migration with the TCP protocol.

This is a minor degradation in error reporting for outgoing migration.
However, until 1.2 this case just failed without even attempting to
connect, so it is still an improvement as far as overall QoI is
concerned.

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 4f085c822947068c785be8c1f27d1ad4e3215149
      https://github.com/qemu/qemu/commit/4f085c822947068c785be8c1f27d1ad4e3215149
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M qemu-char.c
    M qemu-sockets.c

  Log Message:
  -----------
  qemu-sockets: add error propagation to inet_dgram_opts

Before:

    $ qemu-system-x86_64 -monitor udp:localhost:631@localhost:631
    inet_dgram_opts: bind(ipv4,127.0.0.1,631): OK
    inet_dgram_opts failed
    chardev: opening backend "udp" failed

After:

    $ x86_64-softmmu/qemu-system-x86_64 -monitor udp:localhost:631@localhost:631
    qemu-system-x86_64: -monitor udp:localhost:631@localhost:631: Failed to bind \
socket: Address already in use  chardev: opening backend "udp" failed

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 2f002c43ebded28604c26787c9215c4d3594f0ec
      https://github.com/qemu/qemu/commit/2f002c43ebded28604c26787c9215c4d3594f0ec
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M qemu-sockets.c

  Log Message:
  -----------
  qemu-sockets: add error propagation to inet_parse

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 58899664de29c250229f8d306fcf04f852cf5cc6
      https://github.com/qemu/qemu/commit/58899664de29c250229f8d306fcf04f852cf5cc6
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M qemu-sockets.c

  Log Message:
  -----------
  qemu-sockets: add error propagation to Unix socket functions

Before:

    $ qemu-system-x86_64 -monitor unix:/vvv,server=off
    connect(unix:/vvv): No such file or directory
    chardev: opening backend "socket" failed

After:

    $ x86_64-softmmu/qemu-system-x86_64 -monitor unix:/vvv,server=off
    qemu-system-x86_64: -monitor unix:/vvv,server=off: Failed to connect to socket: \
No such file or directory  chardev: opening backend "socket" failed

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 3f8b11bc7d86a1952311565f089063d544d5a2f7
      https://github.com/qemu/qemu/commit/3f8b11bc7d86a1952311565f089063d544d5a2f7
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M qerror.h
    M ui/vnc.c

  Log Message:
  -----------
  vnc: drop QERR_VNC_SERVER_FAILED

We now always return "nice" error messages in errp when we goto fail.
Drop the default error message.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 69758c22e0814f77c7a286ce65a68270ce71284e
      https://github.com/qemu/qemu/commit/69758c22e0814f77c7a286ce65a68270ce71284e
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M Makefile
    M Makefile.objs

  Log Message:
  -----------
  build: add QAPI files to the tools

We need them because qemu-sockets will soon be using SocketAddress.

Acked-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 5be8c759f008947514fbf7d8df9a30eebe496b6d
      https://github.com/qemu/qemu/commit/5be8c759f008947514fbf7d8df9a30eebe496b6d
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M qapi-schema.json

  Log Message:
  -----------
  qapi: add socket address types

Acked-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 879e45c72da1569e07fbbc6a1aa2a708ea796044
      https://github.com/qemu/qemu/commit/879e45c72da1569e07fbbc6a1aa2a708ea796044
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M qemu-sockets.c

  Log Message:
  -----------
  qemu-sockets: return InetSocketAddress from inet_parse

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 0ef3dd6c2de1fa4f80c5aa71fb5fdada0f35cc9a
      https://github.com/qemu/qemu/commit/0ef3dd6c2de1fa4f80c5aa71fb5fdada0f35cc9a
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M tests/Makefile

  Log Message:
  -----------
  tests: do not include tools-obj-y
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 101f9cbc2b73340197ec610c095fd69f0b1413ed
      https://github.com/qemu/qemu/commit/101f9cbc2b73340197ec610c095fd69f0b1413ed
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M Makefile
    M qemu-sockets.c
    M qemu-tool.c
    M qemu_socket.h

  Log Message:
  -----------
  qemu-sockets: add socket_listen, socket_connect, socket_parse

These are QAPI-friendly versions of the qemu-sockets functions.  They
support IP sockets, Unix sockets, and named file descriptors, using a
QAPI union to dispatch to the correct function.

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 3cbc002c34aa85ea952ee9b169a3ff97d350516a
      https://github.com/qemu/qemu/commit/3cbc002c34aa85ea952ee9b169a3ff97d350516a
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M block.c

  Log Message:
  -----------
  block: prepare code for adding block notifiers

There is no reason in principle to skip job cancellation and draining
of pending I/O when there is no medium in the disk.  Do these unconditionally,
which also prepares the code for the next patch.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: d7d512f60979681c27597f1b1277e03505c1de08
      https://github.com/qemu/qemu/commit/d7d512f60979681c27597f1b1277e03505c1de08
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M Makefile.objs
    M block.c
    M block.h
    M block_int.h

  Log Message:
  -----------
  block: add close notifiers

The first user of close notifiers will be the embedded NBD server.
It would be possible to use them to do some of the ad hoc processing
(e.g. for block jobs and I/O limits) that is currently done by
bdrv_close.

Acked-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 6dd844db4a49a367cc15cd0e8bfb72cfc6652766
      https://github.com/qemu/qemu/commit/6dd844db4a49a367cc15cd0e8bfb72cfc6652766
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-23 (Tue, 23 Oct 2012)

  Changed paths:
    M Makefile.objs
    A blockdev-nbd.c
    M qapi-schema.json
    M qmp-commands.hx

  Log Message:
  -----------
  qmp: add NBD server commands

Adding an NBD server inside QEMU is trivial, since all the logic is
in nbd.c and can be shared easily between qemu-nbd and QEMU itself.
The main difference is that qemu-nbd serves a single unnamed export,
while QEMU serves named exports.

Acked-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: c6b8141b84e1b80eff1f04e2a5feb38decae65d8
      https://github.com/qemu/qemu/commit/c6b8141b84e1b80eff1f04e2a5feb38decae65d8
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M Makefile
    M Makefile.objs
    M block.c
    M block.h
    M block_int.h
    A blockdev-nbd.c
    M console.h
    M error.c
    M error.h
    M migration-exec.c
    M migration-fd.c
    M migration-tcp.c
    M migration-unix.c
    M migration.c
    M migration.h
    M nbd.c
    M qapi-schema.json
    M qemu-char.c
    M qemu-sockets.c
    M qemu-tool.c
    M qemu_socket.h
    M qerror.h
    M qga/channel-posix.c
    M qmp-commands.hx
    M qmp.c
    M tests/Makefile
    M ui/vnc.c
    M vl.c

  Log Message:
  -----------
  Merge remote-tracking branch 'bonzini/nbd-next' into staging

* bonzini/nbd-next: (30 commits)
  qmp: add NBD server commands
  block: add close notifiers
  block: prepare code for adding block notifiers
  qemu-sockets: add socket_listen, socket_connect, socket_parse
  tests: do not include tools-obj-y Signed-off-by: Paolo Bonzini \
&lt;pbonzini@redhat.com&gt;  qemu-sockets: return InetSocketAddress from inet_parse
  qapi: add socket address types
  build: add QAPI files to the tools
  vnc: drop QERR_VNC_SERVER_FAILED
  qemu-sockets: add error propagation to Unix socket functions
  qemu-sockets: add error propagation to inet_parse
  qemu-sockets: add error propagation to inet_dgram_opts
  qemu-sockets: add error propagation to inet_connect_addr
  qemu-sockets: include strerror or gai_strerror output in error messages
  vnc: add error propagation to vnc_display_open
  vnc: reorganize code for reverse mode
  vnc: introduce a single label for error returns
  vnc: avoid Yoda conditionals
  qemu-ga: ask and print error information from qemu-sockets
  nbd: ask and print error information from qemu-sockets
  ...


  Commit: 8473f377393219390ea6f2d8d450a2b054bb823e
      https://github.com/qemu/qemu/commit/8473f377393219390ea6f2d8d450a2b054bb823e
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M osdep.h

  Log Message:
  -----------
  win32: fix broken build due to missing QEMU_MADV_HUGEPAGE

Commit ad0b5321f1f797274603ebbe20108b0750baee94 forgot to add
QEMU_MADV_HUGEPAGE macros for when CONFIG_MADVISE is not defined.
This broke the build for Windows. Fix it.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/a8170e5e97ad...8473f3773932

----==_mimepart_508ab38cf714_674c15faaf4368ef--


</body></email><email><emailId>20121027170009</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-27 17:00:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] f296c0: arm-semi.c: Handle get/put_user() failure accessin...</subject><body>



----==_mimepart_508c1319cb2e6_72bd13dcaec5943f
Date: Sat, 27 Oct 2012 10:00:09 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;508c1319ce300_72bd13dcaec595ce@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: f296c0d172735612cad8af5fafb8dedeaaa2a109
      https://github.com/qemu/qemu/commit/f296c0d172735612cad8af5fafb8dedeaaa2a109
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M target-arm/arm-semi.c

  Log Message:
  -----------
  arm-semi.c: Handle get/put_user() failure accessing arguments

Rework the handling of arguments to ARM semihosting calls so that we
handle a possible failure return from get_user_ual() or put_user_ual().
(This incidentally silences a lot of warnings from clang about
"expression result unused").

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: ee6fa5593ebfc437cbedaf28de8b66b2e7d44e70
      https://github.com/qemu/qemu/commit/ee6fa5593ebfc437cbedaf28de8b66b2e7d44e70
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M target-arm/helper.h
    M target-arm/neon_helper.c
    M target-arm/translate.c

  Log Message:
  -----------
  target-arm: Use TCG operation for Neon 64 bit negation

Use the TCG operation to do Neon 64 bit negations rather than calling
a helper routine for it.

Reviewed-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 36c91fd115a5920a35d4cb0e7a1903281469e0db
      https://github.com/qemu/qemu/commit/36c91fd115a5920a35d4cb0e7a1903281469e0db
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M target-arm/helper.c
    M target-arm/helper.h
    M target-arm/translate.c

  Log Message:
  -----------
  target-arm: Implement abs_i32 inline rather than as a helper

Implement abs_i32 inline (with movcond) rather than using a helper
function.

Reviewed-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 8b279a60dc3ca53923701dfec6e54bea9d13cfb7
      https://github.com/qemu/qemu/commit/8b279a60dc3ca53923701dfec6e54bea9d13cfb7
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M target-arm/op_helper.c

  Log Message:
  -----------
  target-arm: Remove out of date FIXME regarding saturating arithmetic

Remove an out of date FIXME regarding the saturating arithmetic helpers:
we now do pass a pointer to CPUARMState to these helpers, and since
the AREG0 changes went in there is no difference between helper.c
and op_helper.c and therefore no point in moving the functions.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: c1556a812a16023894e53c7b2215929741a5bf17
      https://github.com/qemu/qemu/commit/c1556a812a16023894e53c7b2215929741a5bf17
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-27 (Sat, 27 Oct 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: Disable (clang) initializer-overrides warnings

Disable clang's initializer-overrides warnings, as QEMU makes significant
use of the pattern of initializing an array with a range-based default
entry like
    [0 ... 0x1ff] = { GPIO_NONE, 0 }
followed by specific entries which override that default, and clang
would otherwise warn "initializer overrides prior initialization of
this subobject" when it encountered the specific entry.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 9bca81624ef9299b9a06013fd29cd6899079aab4
      https://github.com/qemu/qemu/commit/9bca81624ef9299b9a06013fd29cd6899079aab4
  Author: Bruce Rogers &lt;brogers@suse.com&gt;
  Date:   2012-10-27 (Sat, 27 Oct 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: avoid compiler warning in pipe2 detection

When building qemu-kvm for openSUSE:Factory, I am getting a
warning in the pipe2 detection performed by configure, which
prevents using --enable-werror.

Change detection code to use return value of pipe2.

Signed-off-by: Bruce Rogers &lt;brogers@suse.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 8a527317059bb6ece8a01a8d5be92b5452fa5ad0
      https://github.com/qemu/qemu/commit/8a527317059bb6ece8a01a8d5be92b5452fa5ad0
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-27 (Sat, 27 Oct 2012)

  Changed paths:
    M target-arm/arm-semi.c
    M target-arm/helper.c
    M target-arm/helper.h
    M target-arm/neon_helper.c
    M target-arm/op_helper.c
    M target-arm/translate.c

  Log Message:
  -----------
  Merge branch 'target-arm.for-upstream' of git://git.linaro.org/people/pmaydell/qemu-arm

* 'target-arm.for-upstream' of git://git.linaro.org/people/pmaydell/qemu-arm:
  target-arm: Remove out of date FIXME regarding saturating arithmetic
  target-arm: Implement abs_i32 inline rather than as a helper
  target-arm: Use TCG operation for Neon 64 bit negation
  arm-semi.c: Handle get/put_user() failure accessing arguments


  Commit: 0356404b0f1da939657cad1efeb556745cd430d5
      https://github.com/qemu/qemu/commit/0356404b0f1da939657cad1efeb556745cd430d5
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-27 (Sat, 27 Oct 2012)

  Changed paths:
    M default-configs/sparc64-softmmu.mak

  Log Message:
  -----------
  target-sparc64: disable VGA cirrus

OpenBIOS on sparc64 only support Standard VGA and not Cirrus VGA. Don't
build Cirrus VGA support so that it can't be selected.

This fixes the breakage introduced by commit f2898771.

Reported-by: Richard Henderson &lt;rth@twiddle.net&gt;
Cc: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Tested-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 49cdaea18b6a827fbe9555efef12821909e59229
      https://github.com/qemu/qemu/commit/49cdaea18b6a827fbe9555efef12821909e59229
  Author: Catalin Patulea &lt;catalinp@google.com&gt;
  Date:   2012-10-27 (Sat, 27 Oct 2012)

  Changed paths:
    M tests/tcg/hello-i386.c
    M tests/tcg/test-i386.c

  Log Message:
  -----------
  tests/tcg: fix a few warnings

Signed-off-by: Catalin Patulea &lt;catalinp@google.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: d1bd2423a90a144576cd140dc84b1fe8c7c8fda0
      https://github.com/qemu/qemu/commit/d1bd2423a90a144576cd140dc84b1fe8c7c8fda0
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-27 (Sat, 27 Oct 2012)

  Changed paths:
    M Makefile

  Log Message:
  -----------
  Makefile: Forbid out-of-tree build from a source tree that has been built in

If we try to do an out-of-tree build but the source tree we're building from
has been used in the past for an in-tree build then things will go
confusingly wrong. Specifically, some parts of the build process will pull
in generated files from the old in-tree build (because SRC_PATH is on
the vpath). Diagnose this situation so we can produce a useful error
message and tell the user how to fix it (run distclean in the source tree).

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: d64ed08eeca9587d28d573d81692721cea3273ca
      https://github.com/qemu/qemu/commit/d64ed08eeca9587d28d573d81692721cea3273ca
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-10-27 (Sat, 27 Oct 2012)

  Changed paths:
    M hw/xtensa_lx60.c

  Log Message:
  -----------
  hw/xtensa_lx60: don't prematurely explode QEMUMachineInitArgs

Don't explode QEMUMachineInitArgs before passing it to lx_init.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 50cd72148211c5e5f22ea2519d19ce024226e61f
      https://github.com/qemu/qemu/commit/50cd72148211c5e5f22ea2519d19ce024226e61f
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-10-27 (Sat, 27 Oct 2012)

  Changed paths:
    M hw/xtensa_sim.c

  Log Message:
  -----------
  hw/xtensa_sim: get rid of intermediate xtensa_sim_init

Remove xtensa_sim_init that only explodes machine init args, rename
sim_init to xtensa_sim_init.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/8473f3773932...50cd72148211

----==_mimepart_508c1319cb2e6_72bd13dcaec5943f--


</body></email><email><emailId>20121029150022</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-29 15:00:22-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 852bef: hmp: fix info cpus for sparc targets</subject><body>



----==_mimepart_508e9a064877a_22b01760aec341cc
Date: Mon, 29 Oct 2012 08:00:22 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;508e9a06504b0_22b01760aec3427c@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 852bef0e0c03e2de9d6441471219cd3bc1bf45b5
      https://github.com/qemu/qemu/commit/852bef0e0c03e2de9d6441471219cd3bc1bf45b5
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M hmp.c

  Log Message:
  -----------
  hmp: fix info cpus for sparc targets

On sparc targets, info cpus returns this kind of output:

| info cpus
| * CPU #0: pc=0x0000000000424d18pc=0x0000000000424d18npc=0x0000000000424d1c thread_id=19460

pc is printed twice, there is no space between pc, pc and npc.

With this patch, pc is not printed anymore when has_npc is set. In addition
the space is printed before pc/nip/npc/PC instead of after the colon so that
multiple prints are possible. This result on the following kind of input on
sparc targets:

| info cpus
| * CPU #0: pc=0x0000000000424d18 npc=0x0000000000424d1c thread_id=19460

Cc: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Cc: Markus Armbruster &lt;armbru@redhat.com&gt;
Cc: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 1e9981465f05a0f103d7e09afd975c9c0ff6d132
      https://github.com/qemu/qemu/commit/1e9981465f05a0f103d7e09afd975c9c0ff6d132
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M qapi-schema.json
    M qerror.h
    M qmp.c

  Log Message:
  -----------
  qmp: handle stop/cont in INMIGRATE state

Right now, stop followed by an incoming migration will let the
virtual machine start.  cont before an incoming migration instead
will fail.

This is bad because the actual behavior is not predictable; it is
racy with respect to the start of the incoming migration.  That's
because incoming migration is blocking, and thus will delay the
processing of stop/cont until the end of the migration.

In addition, there's nothing that really prevents the user from
typing the block device's passwords before incoming migration is
done, so returning the DeviceEncrypted error is also helpful in
the QMP case.

Both things can be fixed by just toggling the autostart variable when
stop/cont are called in INMIGRATE state.

Note that libvirt is currently working around the race by looping
if the MigrationExpected answer is returned.  After this patch, the
command will return right away without ever raising an error.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 29ed72f15a4c8fd3ac106d874f76cc27b654fd25
      https://github.com/qemu/qemu/commit/29ed72f15a4c8fd3ac106d874f76cc27b654fd25
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M migration.c
    M vl.c

  Log Message:
  -----------
  migration: go to paused state after finishing incoming migration with -S

At the end of migration the machine has started already, and cannot be
destroyed without losing the guest's data.  Hence, prelaunch is the
wrong state.  Go to the paused state instead.  QEMU would reach that
state anyway (after running the guest for the blink of an eye) if the
"stop" command had been received after the start of migration.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 166792f7bbe2cad120b75062ff6f8f1b67366f18
      https://github.com/qemu/qemu/commit/166792f7bbe2cad120b75062ff6f8f1b67366f18
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M tcg/i386/tcg-target.c

  Log Message:
  -----------
  tcg/i386: remove suboptimal register shifting

Now that CONFIG_TCG_PASS_AREG0 has been removed, it's easier to get
an optimal code for the load/store functions.

First swap the two registers used in tcg_out_tlb_load() so that the
address end-up in the second register instead of the first one. Adjust
tcg_out_qemu_ld() and tcg_out_qemu_st() to respectively call
tcg_out_qemu_ld_direct() and tcg_out_qemu_st_direct() with the correct
registers. Then replace the register shifting by direct load of the
arguments.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 17b914912d6175a5405d472832d6eba6187b6beb
      https://github.com/qemu/qemu/commit/17b914912d6175a5405d472832d6eba6187b6beb
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M tcg/i386/tcg-target.c

  Log Message:
  -----------
  tcg/i386: remove ld/st third argument register constraint

On x86_64, remove the constraint on the third argument register which
is not needed:
 - For loads the helper arguments are env, addr, mem_idx. The addr
   value should not be in the two first argument registers as they are
   used in tcg_out_tlb_load().
 - For stores the helper arguments are env, addr, data, mem_idx.
   The addr and data values should not be in the two first argument
   registers as they are used in tcg_out_tlb_load(). The data value
   should also not be in the two first argument registers, but could
   be in the third argument register in which case it would be already
   loaded at the right location.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 639368dd685f89b0567b56304c62937ad0ef8248
      https://github.com/qemu/qemu/commit/639368dd685f89b0567b56304c62937ad0ef8248
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M tcg/tcg.c

  Log Message:
  -----------
  tcg: add temp_dead()

A lot of code is duplicated to mark a temporary as dead. Replace it
by temp_dead(), which in addition marks the temp as saved in memory
for globals and local temps, instead of doing this a posteriori in
temp_save().

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 7f6ceedf9c5da96ee2b1fe42573b781243bc2828
      https://github.com/qemu/qemu/commit/7f6ceedf9c5da96ee2b1fe42573b781243bc2828
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M tcg/tcg.c

  Log Message:
  -----------
  tcg: add tcg_reg_sync()

Add a new function tcg_reg_sync() to synchronize the canonical location
of a temp with the value in the associated register, but without freeing
it. Rewrite tcg_reg_free() to first call tcg_reg_sync() and then to free
the register.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 1ad80729bea3d8ed1b67b457af44cbf9bbd8c3ec
      https://github.com/qemu/qemu/commit/1ad80729bea3d8ed1b67b457af44cbf9bbd8c3ec
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M tcg/tcg.c

  Log Message:
  -----------
  tcg: add temp_sync()

Add a new function temp_sync() to synchronize the canonical location
of a temp with the value in the corresponding register, but without
freeing the associated register. Rewrite temp_save() to call
temp_sync() followed by temp_dead().

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: ec7a869d31a1f82fe5b7750d8952c26753ea1df8
      https://github.com/qemu/qemu/commit/ec7a869d31a1f82fe5b7750d8952c26753ea1df8
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M tcg/tcg.c
    M tcg/tcg.h

  Log Message:
  -----------
  tcg: sync output arguments on liveness request

Synchronize an output argument when requested by the liveness analysis.
This is needed so that the temp can be declared dead later.

For that, add a new op_sync_args table in which each bit tells if the
corresponding output argument needs to be synchronized with the memory.
Pass it to the tcg_reg_alloc_* functions, and honor this bit. We need to
synchronize the argument before marking it as dead, and we have to make
sure all the infos about the temp are correctly filled.

At the same time change some types from unsigned int to uint16_t when
passing op_dead_args.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 9c43b68de628a1e2cba556adfb71c17028eb802e
      https://github.com/qemu/qemu/commit/9c43b68de628a1e2cba556adfb71c17028eb802e
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M tcg/tcg.c

  Log Message:
  -----------
  tcg: rework liveness analysis

Rework the liveness analysis by tracking temps that need to go back to
memory in addition to dead temps tracking. This allows to mark output
arguments as "need sync", and to synchronize them back to memory as soon
as they are not written anymore. This way even arguments mapping to
globals can be marked as "dead", avoiding moves to a new register when
input and outputs are aliased.

In addition it means that registers are freed as soon as temps are not
used anymore, instead of waiting for a basic block end or an op with side
effects. This reduces register spilling especially on CPUs with few
registers, and spread the mov over all the TB, increasing the
performances on in-order CPUs.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 4c4e1ab26bfc9b3f9b3097ecd0643bc20d0e2f0d
      https://github.com/qemu/qemu/commit/4c4e1ab26bfc9b3f9b3097ecd0643bc20d0e2f0d
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M tcg/tcg.c

  Log Message:
  -----------
  tcg: improve tcg_reg_alloc_movi()

Now that the liveness analysis might mark some output temps as dead, call
temp_dead() if needed.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: c29c1d7edfc57fc4ab15e30b3cea990a5685dd7a
      https://github.com/qemu/qemu/commit/c29c1d7edfc57fc4ab15e30b3cea990a5685dd7a
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M tcg/tcg.c

  Log Message:
  -----------
  tcg: rewrite tcg_reg_alloc_mov()

Now that the liveness analysis provides more information, rewrite
tcg_reg_alloc_mov(). This changes the behaviour about propagating
constants and memory accesses. We now take the assumption that once
a value is loaded into a register (from memory or from a constant),
it's better to keep it there than to reload it later. This assumption
is now always almost correct given that we are now sure the
corresponding temp is going to be used later (otherwise it would have
been synchronized and marked as dead already). The assumption is wrong
if one of the op after clobbers some registers including the one
of the holding the temp (this can be avoided by allocating clobbered
registers last, which is what most TCG target do), or in case of lack
of available register.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: a52ad07e7cde61c799ca3351ccd58c04d6f7474f
      https://github.com/qemu/qemu/commit/a52ad07e7cde61c799ca3351ccd58c04d6f7474f
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M tcg/tcg.c

  Log Message:
  -----------
  tcg: always mark dead input arguments as dead

Always mark dead input arguments as dead, even if the op is at the basic
block end. This will allow to check that all temps are correctly saved.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 7dfd8c6aa1d0691d03c5ccc9b0c5a93bcf00f768
      https://github.com/qemu/qemu/commit/7dfd8c6aa1d0691d03c5ccc9b0c5a93bcf00f768
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M tcg/tcg.c

  Log Message:
  -----------
  tcg: start with local temps in TEMP_VAL_MEM state

Start with local temps in TEMP_VAL_MEM state, to make possible a later
check that all the temps are correctly saved back to memory.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 2c0366f036cbb7b2565ba8185a9daee98d709edb
      https://github.com/qemu/qemu/commit/2c0366f036cbb7b2565ba8185a9daee98d709edb
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M tcg/tcg.c

  Log Message:
  -----------
  tcg: don't explicitly save globals and temps

The liveness analysis ensures that globals and temps are at the correct
state at a basic block end or with an op with side effects. Avoid
looping on all temps, this can be time consuming on targets with a lot
of globals. Keep an assert in debug mode.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 344028ba0f63b31c30723d2c1064d3539aa0f070
      https://github.com/qemu/qemu/commit/344028ba0f63b31c30723d2c1064d3539aa0f070
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M tcg/tcg-opc.h

  Log Message:
  -----------
  tcg: fix some op flags

Some branch related ops are marked with TCG_OPF_SIDE_EFFECTS, some other
not. In practice they don't need to, as they are all marked with
TCG_OPF_BB_END, which is handled specifically in all the code.

The call op is marked as TCG_OPF_SIDE_EFFECTS, which might be not true
as there is are specific flags (TCG_CALL_CONST and TCG_CALL_PURE) for
specifying that. On the other hand it always clobber arguments, so mark
it as such even if the call op is handled in a different code path.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: b202d41ee705a7a6152d03eb362e2e2147505022
      https://github.com/qemu/qemu/commit/b202d41ee705a7a6152d03eb362e2e2147505022
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M tcg/README
    M tcg/tcg-opc.h

  Log Message:
  -----------
  tcg: forbid ld/st function to modify globals

Mapping a memory address using a global and accessing it through
ld/st operations is currently broken. As it doesn't make any sense
to do that performance wise, let's forbid that.

Update the TCG documentation, and remove partial support for that.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 3d5c5f876d171983d614925eebe4f0edccbb75be
      https://github.com/qemu/qemu/commit/3d5c5f876d171983d614925eebe4f0edccbb75be
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M tcg/tcg.c
    M tcg/tcg.h

  Log Message:
  -----------
  tcg: synchronize globals for ops with side effects

Operations with side effects (in practice qemu_ld/st ops), only need to
synchronize globals to make sure the CPU state is consistent in case of
exception.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 78505279665e64d28e4a308818b69e6f77ecc5d2
      https://github.com/qemu/qemu/commit/78505279665e64d28e4a308818b69e6f77ecc5d2
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M tcg/README
    M tcg/optimize.c
    M tcg/tcg-op.h
    M tcg/tcg.c
    M tcg/tcg.h

  Log Message:
  -----------
  tcg: rework TCG helper flags

The current helper flags, TCG_CALL_CONST and TCG_CALL_PURE might be
confusing and doesn't provide enough granularity for some helpers (FP
helpers for example).

This patch changes them into the following helpers flags:
- TCG_CALL_NO_READ_GLOBALS means that the helper does not read globals,
  either directly or via an exception. They will not be saved to their
  canonical location before calling the helper.
- TCG_CALL_NO_WRITE_GLOBALS means that the helper does not modify any
  globals. They will only be saved to their canonical locations before
  calling helpers, but they won't be reloaded afterwise.
- TCG_CALL_NO_SIDE_EFFECTS means that the call to the function is
  removed if the return value is not used.

It provides convenience flags, to avoid helper definitions longer than
80 characters. It also provides compatibility flags, and updates the
documentation.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 0c0dcdfed0833539ed03560d251c31463c0eb9f9
      https://github.com/qemu/qemu/commit/0c0dcdfed0833539ed03560d251c31463c0eb9f9
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M target-alpha/helper.h

  Log Message:
  -----------
  target-alpha: rename helper flags

Rename helper flags to the new ones. This is purely a mechanical change,
it's possible to use better flags by looking at the helpers.

Acked-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 4b3d4829abfdeb5078195898997e73724898c41e
      https://github.com/qemu/qemu/commit/4b3d4829abfdeb5078195898997e73724898c41e
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M target-arm/helper.h

  Log Message:
  -----------
  target-arm: rename helper flags

Rename helper flags to the new ones. This is purely a mechanical change,
it's possible to use better flags by looking at the helpers.

Cc: Paul Brook &lt;paul@codesourcery.com&gt;
Cc: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 3e2bed86a24e13970bcc50527e21fe75f409f7ad
      https://github.com/qemu/qemu/commit/3e2bed86a24e13970bcc50527e21fe75f409f7ad
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M target-cris/helper.h

  Log Message:
  -----------
  target-cris: rename helper flags

Rename helper flags to the new ones. This is purely a mechanical change,
it's possible to use better flags by looking at the helpers.

Acked-by: Edgar E. Iglesias &lt;edgar.iglesias@gmail.com&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 95b638a29214173d4de04567b8d08f4064580abd
      https://github.com/qemu/qemu/commit/95b638a29214173d4de04567b8d08f4064580abd
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M target-i386/helper.h

  Log Message:
  -----------
  target-i386: rename helper flags

Rename helper flags to the new ones. This is purely a mechanical change,
it's possible to use better flags by looking at the helpers.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 2a997687b867d3fa005ae6abca01121e68e5c02e
      https://github.com/qemu/qemu/commit/2a997687b867d3fa005ae6abca01121e68e5c02e
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M target-microblaze/helper.h

  Log Message:
  -----------
  target-microblaze: rename helper flags

Rename helper flags to the new ones. This is purely a mechanical change,
it's possible to use better flags by looking at the helpers.

Acked-by: Edgar E. Iglesias &lt;edgar.iglesias@gmail.com&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 95bf787e40adead611f79cae6e8a57cc175df95e
      https://github.com/qemu/qemu/commit/95bf787e40adead611f79cae6e8a57cc175df95e
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M target-mips/helper.h

  Log Message:
  -----------
  target-mips: rename helper flags

Rename helper flags to the new ones. This is purely a mechanical change,
it's possible to use better flags by looking at the helpers.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 8f885ef88a3fa26c26e98150219884da607d46ed
      https://github.com/qemu/qemu/commit/8f885ef88a3fa26c26e98150219884da607d46ed
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M target-ppc/helper.h

  Log Message:
  -----------
  target-ppc: rename helper flags

Rename helper flags to the new ones. This is purely a mechanical change,
it's possible to use better flags by looking at the helpers.

Cc: Alexander Graf &lt;agraf@suse.de&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 9995567b3ecef5e0edd7d7301b722949320f89be
      https://github.com/qemu/qemu/commit/9995567b3ecef5e0edd7d7301b722949320f89be
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M target-s390x/helper.h

  Log Message:
  -----------
  target-s390x: rename helper flags

Rename helper flags to the new ones. This is purely a mechanical change,
it's possible to use better flags by looking at the helpers.

Cc: Alexander Graf &lt;agraf@suse.de&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 76ab687946b31c8ca5308bed1d85391f4f5c599c
      https://github.com/qemu/qemu/commit/76ab687946b31c8ca5308bed1d85391f4f5c599c
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M target-sh4/helper.h

  Log Message:
  -----------
  target-sh4: rename helper flags

Rename helper flags to the new ones. This is purely a mechanical change,
it's possible to use better flags by looking at the helpers.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: c33b235358a4c385abe36b3082ee9437bc86c2f5
      https://github.com/qemu/qemu/commit/c33b235358a4c385abe36b3082ee9437bc86c2f5
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M target-sparc/helper.h

  Log Message:
  -----------
  target-sparc: rename helper flags

Rename helper flags to the new ones. This is purely a mechanical change,
it's possible to use better flags by looking at the helpers.

Acked-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: f0de41325a195503d352d8e154c1015290f4c87c
      https://github.com/qemu/qemu/commit/f0de41325a195503d352d8e154c1015290f4c87c
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M target-xtensa/helper.h

  Log Message:
  -----------
  target-xtensa: rename helper flags

Rename helper flags to the new ones. This is purely a mechanical change,
it's possible to use better flags by looking at the helpers.

Cc: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: b393ab4228adc9338c17340d825f7a60e5f6820d
      https://github.com/qemu/qemu/commit/b393ab4228adc9338c17340d825f7a60e5f6820d
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M tcg/tcg.h

  Log Message:
  -----------
  tcg: remove compatiblity call flags

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: d73ee8a2b5267adae41ecb464cae06a185d2b0f9
      https://github.com/qemu/qemu/commit/d73ee8a2b5267adae41ecb464cae06a185d2b0f9
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Use TCG registers for the FPU.

With normal FP, this doesn't have much affect on the generated code,
because most of the FP operations are not CONST/PURE, and so we spill
registers in about the same frequency as the explicit load/stores.

But with Loongson multimedia instructions, which are all integral and
whose helpers are in fact CONST+PURE, this greatly improves the code.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 44b37ace0636cd229e956c5000a1bb6a49e274e7
      https://github.com/qemu/qemu/commit/44b37ace0636cd229e956c5000a1bb6a49e274e7
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M tcg/i386/tcg-target.c

  Log Message:
  -----------
  tcg-i386: Use %gs prefixes for x86_64 GUEST_BASE

When we allocate a reserved_va for the guest, the kernel will likely
choose an address well above 4G.  At which point we must use a pair
of movabsq+addq to form the host address.  If we have OS support,
set up a segment register to point to guest_base instead.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 1e9737da4aafb54681203931dfe8f8eea21fcef7
      https://github.com/qemu/qemu/commit/1e9737da4aafb54681203931dfe8f8eea21fcef7
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M configure
    M qemu-timer.c

  Log Message:
  -----------
  qemu-timer: Check for usable fields for SIGEV_THREAD_ID

Older glibc (RHEL 5.x, Debian 5.x) does not have the _sigev_un._tid
member in its structure definition, while the accompanying kernel
headers do define SIGEV_THREAD_ID.  We need configure to check for
both before using it.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 01f590d5a3385c3d79c6afda7acd66edf4bf48d3
      https://github.com/qemu/qemu/commit/01f590d5a3385c3d79c6afda7acd66edf4bf48d3
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: cpu: recover items 28-31 of ext2_feature_name

I removed a line by mistake on commit
3b671a40cab2404bc63e57db8cd3afa4ec70bfab, containing the flags lm/i64,
3dnow, and 3dnowext. This patch restores the removed line.

Reviewed-by: Don Slutz &lt;Don@cloudswitch.com&gt;
Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 21b2f13ae21974e0fd7f8da99d84628a8000d1d7
      https://github.com/qemu/qemu/commit/21b2f13ae21974e0fd7f8da99d84628a8000d1d7
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M target-ppc/mmu_helper.c

  Log Message:
  -----------
  Drop unnecessary check of TARGET_PHYS_ADDR_SPACE_BITS

For all our PPC targets the physical address space is at least
36 bits, so drop an unnecessary preprocessor conditional check
on TARGET_PHYS_ADDR_SPACE_BITS (erroneously introduced as part
of the change from target_phys_addr_t to hwaddr). This brings
this bit of code into line with the way we handle the other
cases which were originally checking TARGET_PHYS_ADDR_BITS in
order to avoid compiler complaints about overflowing a 32 bit type.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 5232fa59b17b45c04bd24e0d38224964816bf391
      https://github.com/qemu/qemu/commit/5232fa59b17b45c04bd24e0d38224964816bf391
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/ppc440_bamboo.c

  Log Message:
  -----------
  PPC: Bamboo: Fix memory size DT property

Device tree properties need to be specified in big endian. Fix the
bamboo memory size property accordingly.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
CC: qemu-stable@nongnu.org


  Commit: e598a9c56badd00eaa732c4e0e69def4e5e6614b
      https://github.com/qemu/qemu/commit/e598a9c56badd00eaa732c4e0e69def4e5e6614b
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M target-ppc/translate_init.c

  Log Message:
  -----------
  PPC: 440: Emulate DCBR0

The DCBR0 register on 440 is used to implement system reset. The same
register is used on 405 as well, so just reuse the code.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 59de4f98d14fb84f04181a6f816ef6dd8b82dd79
      https://github.com/qemu/qemu/commit/59de4f98d14fb84f04181a6f816ef6dd8b82dd79
  Author: Bharat Bhushan &lt;r65777@freescale.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/ppc/e500.c

  Log Message:
  -----------
  e500: Fix serial initialization

it was wrongly using serial_hds[0] instead of serial_hds[1]

Signed-off-by: Bharat Bhushan &lt;bharat.bhushan@freescale.com&gt;
Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 094b287f0b3b79d1e68df8f3a63cb144ec9cdfb6
      https://github.com/qemu/qemu/commit/094b287f0b3b79d1e68df8f3a63cb144ec9cdfb6
  Author: zhlcindy@gmail.com &lt;zhlcindy@gmail.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/nseries.c
    M hw/pc_piix.c
    M hw/ppc_newworld.c
    M hw/ppc_oldworld.c
    M hw/ppc_prep.c
    M hw/pxa2xx.c
    M hw/realview.c
    M hw/spapr.c
    M hw/versatilepb.c
    M qemu-config.c
    M sysemu.h
    M vl.c

  Log Message:
  -----------
  Add USB option in machine options

When -usb option is used, global varible usb_enabled is set.
And all the plaform will create one USB controller according
to this variable. In fact, global varibles make code hard
to read.

So this patch is to remove global variable usb_enabled and
add USB option in machine options. All the plaforms will get
USB option value from machine options.

USB option of machine options will be set either by:
  * -usb
  * -machine type=pseries,usb=on

Both these ways can work now. They both set USB option in
machine options. In the future, the first way will be removed.

Signed-off-by: Li Zhang &lt;zhlcindy@linux.vnet.ibm.com&gt;
Acked-by: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: c89d52997cf4849a9ee16b5d2cf462d0cd137634
      https://github.com/qemu/qemu/commit/c89d52997cf4849a9ee16b5d2cf462d0cd137634
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/spapr_hcall.c
    M hw/spapr_rtas.c

  Log Message:
  -----------
  pseries: Don't allow duplicate registration of hcalls or RTAS calls

Currently the pseries machine code allows a callback to be registered
for a hypercall number twice, as long as it's the same callback the second
time.  We don't test for duplicate registrations of RTAS callbacks at all
so it will effectively be last registratiojn wins.

This was originally done because it was awkward to ensure that the
registration happened exactly once, but the code has since been
restructured so that's no longer the case.

Duplicate registration of a hypercall or RTAS call could well suggest
a duplicate initialization which could cause other problems, so this patch
makes duplicate registrations a bug, to prevent the old behaviour from
hiding other bugs.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 1bfb37d1e077705de14f0f7fdc7b21749dbe4bc9
      https://github.com/qemu/qemu/commit/1bfb37d1e077705de14f0f7fdc7b21749dbe4bc9
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/spapr_hcall.c
    M target-ppc/cpu.h
    M target-ppc/translate_init.c

  Log Message:
  -----------
  target-ppc: Rework storage of VPA registration state

With PAPR guests, hypercalls allow registration of the Virtual Processor
Area (VPA), SLB shadow and dispatch trace log (DTL), each of which allow
for certain communication between the guest and hypervisor.  Currently, we
store the addresses of the three areas and the size of the dtl in
CPUPPCState.

The SLB shadow and DTL are variable sized, with the size being retrieved
from within the registered memory area at the hypercall time.  This size
can later be overwritten with other information, however, so we need to
save the size as of registration time.  We already do this for the DTL,
but not for the SLB shadow, so this patch fixes that.

In addition, we change the storage of the VPA information to use fixed
size integer types which will make life easier for syncing this data with
KVM, which we will need in future.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 74d042e5cec78090194669a8a4417c0a49d46a3d
      https://github.com/qemu/qemu/commit/74d042e5cec78090194669a8a4417c0a49d46a3d
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/ppc/Makefile.objs
    M hw/spapr.c
    M hw/spapr.h
    A hw/spapr_events.c

  Log Message:
  -----------
  pseries: Implement qemu initiated shutdowns using EPOW events

At present, using 'system_powerdown' from the monitor or otherwise
instructing qemu to (cleanly) shut down a pseries guest will not work,
because we did not have a method of signalling the shutdown request to the
guest.

PAPR does include a usable mechanism for this, though it is rather more
involved than the equivalent on x86.  This involves sending an EPOW
(Environmental and POwer Warning) event through the PAPR event and error
logging mechanism, which also has a number of other functions.

This patch implements just enough of the event/error logging functionality
to be able to send a shutdown event to the guest.  At least with modern
guest kernels and a userspace that is up and running, this means that
system_powerdown from the qemu monitor should now work correctly on pseries
guests.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: d6a6d362aa291686d3111aed59ab57badaaef463
      https://github.com/qemu/qemu/commit/d6a6d362aa291686d3111aed59ab57badaaef463
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/ac97.c

  Log Message:
  -----------
  ac97: convert PIO to new memory api read/write

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: df6db5b32ab776a1d23bd32ae75c0e5284a01234
      https://github.com/qemu/qemu/commit/df6db5b32ab776a1d23bd32ae75c0e5284a01234
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/virtio-pci.c

  Log Message:
  -----------
  virtio-pci: convert PIO to new memory api read/write

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: f3726fd78d79693b73c1ac41cc8ca0f1bb90082b
      https://github.com/qemu/qemu/commit/f3726fd78d79693b73c1ac41cc8ca0f1bb90082b
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/es1370.c

  Log Message:
  -----------
  es1370: convert PIO to new memory api read/write

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 0505bcdec8228d8de39ab1a02644e71999e7c052
      https://github.com/qemu/qemu/commit/0505bcdec8228d8de39ab1a02644e71999e7c052
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/i8254.c

  Log Message:
  -----------
  i8254: convert PIO to new memory api read/write

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 087bd055acf29e838908a9e6bfad73f12c49bc4c
      https://github.com/qemu/qemu/commit/087bd055acf29e838908a9e6bfad73f12c49bc4c
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/m48t59.c

  Log Message:
  -----------
  m48t59: convert PIO to new memory api read/write

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 0da8c842b73924fb54ed75fb8850be5f7e978df9
      https://github.com/qemu/qemu/commit/0da8c842b73924fb54ed75fb8850be5f7e978df9
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/mc146818rtc.c

  Log Message:
  -----------
  mc146818rtc: convert PIO to new memory api read/write

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 93ef41928299efbd7879bc63f329893e65e6e1de
      https://github.com/qemu/qemu/commit/93ef41928299efbd7879bc63f329893e65e6e1de
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/pc.c

  Log Message:
  -----------
  pc port92: convert PIO to new memory api read/write

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: d540bfe0e730ac0b18f58ed5a8355c8ee014f35d
      https://github.com/qemu/qemu/commit/d540bfe0e730ac0b18f58ed5a8355c8ee014f35d
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/pckbd.c

  Log Message:
  -----------
  pckbd: convert PIO to new memory api read/write

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 1bebb0ad17dc56f66ad09f35d0ab8a3a6357f548
      https://github.com/qemu/qemu/commit/1bebb0ad17dc56f66ad09f35d0ab8a3a6357f548
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/rtl8139.c

  Log Message:
  -----------
  rtl8139: convert PIO to new memory api read/write

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 5ec3a23e6c8303c51a244411c57f2456a24799c9
      https://github.com/qemu/qemu/commit/5ec3a23e6c8303c51a244411c57f2456a24799c9
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/serial.c

  Log Message:
  -----------
  serial: convert PIO to new memory api read/write

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 360d613e528df695fc0ac89f4069d8877d39ebea
      https://github.com/qemu/qemu/commit/360d613e528df695fc0ac89f4069d8877d39ebea
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/vmport.c

  Log Message:
  -----------
  vmport: convert PIO to new memory api read/write

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 626c7a171e644fbe1579516b8b794d611c295d2f
      https://github.com/qemu/qemu/commit/626c7a171e644fbe1579516b8b794d611c295d2f
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/xen_platform.c

  Log Message:
  -----------
  xen_platform: convert PIO to new memory api read/write

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: a1bc20dfbb012ea2a5fb1228cb77abd04490fd79
      https://github.com/qemu/qemu/commit/a1bc20dfbb012ea2a5fb1228cb77abd04490fd79
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/ppc/e500.c
    M hw/ppce500_pci.c

  Log Message:
  -----------
  PPC: e500: Map PIO space into core memory region

On PPC, we don't have PIO. So usually PIO space behind a PCI bridge is
accessible via MMIO. Do this mapping explicitly by mapping the PIO space
of our PCI bus into a memory region that lives in memory space.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: a178274efabcbbc5d44805b51def874e47051325
      https://github.com/qemu/qemu/commit/a178274efabcbbc5d44805b51def874e47051325
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/spapr_pci.c
    M hw/spapr_pci.h

  Log Message:
  -----------
  PPC: pseries: Remove hack for PIO window

Now that all users of old_portio are gone, we can remove the hack
that enabled us to support them.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 3f4331bfd112840e94935b0fd098ee88c07beabc
      https://github.com/qemu/qemu/commit/3f4331bfd112840e94935b0fd098ee88c07beabc
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hmp.c
    M migration.c
    M qapi-schema.json
    M qerror.h
    M qmp.c
    M vl.c

  Log Message:
  -----------
  Merge branch 'queue/qmp' of git://repo.or.cz/qemu/qmp-unstable

* 'queue/qmp' of git://repo.or.cz/qemu/qmp-unstable:
  migration: go to paused state after finishing incoming migration with -S
  qmp: handle stop/cont in INMIGRATE state
  hmp: fix info cpus for sparc targets


  Commit: d262cb02861dd33375c08fc798930653b14769e9
      https://github.com/qemu/qemu/commit/d262cb02861dd33375c08fc798930653b14769e9
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/ac97.c
    M hw/es1370.c
    M hw/i8254.c
    M hw/m48t59.c
    M hw/mc146818rtc.c
    M hw/nseries.c
    M hw/pc.c
    M hw/pc_piix.c
    M hw/pckbd.c
    M hw/ppc/Makefile.objs
    M hw/ppc/e500.c
    M hw/ppc440_bamboo.c
    M hw/ppc_newworld.c
    M hw/ppc_oldworld.c
    M hw/ppc_prep.c
    M hw/ppce500_pci.c
    M hw/pxa2xx.c
    M hw/realview.c
    M hw/rtl8139.c
    M hw/serial.c
    M hw/spapr.c
    M hw/spapr.h
    A hw/spapr_events.c
    M hw/spapr_hcall.c
    M hw/spapr_pci.c
    M hw/spapr_pci.h
    M hw/spapr_rtas.c
    M hw/versatilepb.c
    M hw/virtio-pci.c
    M hw/vmport.c
    M hw/xen_platform.c
    M qemu-config.c
    M sysemu.h
    M target-ppc/cpu.h
    M target-ppc/mmu_helper.c
    M target-ppc/translate_init.c
    M vl.c

  Log Message:
  -----------
  Merge branch 'ppc-for-upstream' of git://repo.or.cz/qemu/agraf

* 'ppc-for-upstream' of git://repo.or.cz/qemu/agraf: (22 commits)
  PPC: pseries: Remove hack for PIO window
  PPC: e500: Map PIO space into core memory region
  xen_platform: convert PIO to new memory api read/write
  vmport: convert PIO to new memory api read/write
  serial: convert PIO to new memory api read/write
  rtl8139: convert PIO to new memory api read/write
  pckbd: convert PIO to new memory api read/write
  pc port92: convert PIO to new memory api read/write
  mc146818rtc: convert PIO to new memory api read/write
  m48t59: convert PIO to new memory api read/write
  i8254: convert PIO to new memory api read/write
  es1370: convert PIO to new memory api read/write
  virtio-pci: convert PIO to new memory api read/write
  ac97: convert PIO to new memory api read/write
  pseries: Implement qemu initiated shutdowns using EPOW events
  target-ppc: Rework storage of VPA registration state
  pseries: Don't allow duplicate registration of hcalls or RTAS calls
  Add USB option in machine options
  e500: Fix serial initialization
  PPC: 440: Emulate DCBR0
  ...


Compare: https://github.com/qemu/qemu/compare/50cd72148211...d262cb02861d

----==_mimepart_508e9a064877a_22b01760aec341cc--


</body></email><email><emailId>20121029173020</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-29 17:30:20-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 1f7104: qemu-img: Fix division by zero for zero size image...</subject><body>



----==_mimepart_508ebd2c4985e_4a3f154aaf010869c
Date: Mon, 29 Oct 2012 10:30:20 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;508ebd2c5826f_4a3f154aaf0108773@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 1f71049523f4fc0738f96c74bfcce012521fa0f0
      https://github.com/qemu/qemu/commit/1f71049523f4fc0738f96c74bfcce012521fa0f0
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M qemu-img.c

  Log Message:
  -----------
  qemu-img: Fix division by zero for zero size images

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: ee17f9d5fd44fba950ab2290dd30f38d1cd2b625
      https://github.com/qemu/qemu/commit/ee17f9d5fd44fba950ab2290dd30f38d1cd2b625
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    A tests/qemu-iotests/042
    A tests/qemu-iotests/042.out
    M tests/qemu-iotests/group

  Log Message:
  -----------
  qemu-iotests: Test qemu-img operation on zero size image

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: b3d0380ec245d73e5233366f541497ef92b2e283
      https://github.com/qemu/qemu/commit/b3d0380ec245d73e5233366f541497ef92b2e283
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M QMP/qmp.py

  Log Message:
  -----------
  qmp: fix __accept() in qmp.py

In QEMUMonitorProtocol, commit e9d17b6 removed the __sockfile creation
from __negotiate_capabilities(), which breaks _accept().  This causes
failures in qemu-io python based tests (i.e. tests 030 and 040).

This patch creates the sockfile in __accept() as well.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Reviewed-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Acked-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: a616673dd1c2e00db5e3458d2ba4b6619b78876a
      https://github.com/qemu/qemu/commit/a616673dd1c2e00db5e3458d2ba4b6619b78876a
  Author: Alex Bligh &lt;alex@alex.org.uk&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M qemu-img.c
    M qemu-img.texi

  Log Message:
  -----------
  qemu-img rebase: use empty string to rebase without backing file

This patch allows an empty filename to be passed as the new base image name
for qemu-img rebase to mean base the image on no backing file (i.e.
independent of any backing file). According to Eric Blake, qemu-img rebase
already supports this when '-u' is used; this adds support when -u is not
used.

Signed-off-by: Alex Bligh &lt;alex@alex.org.uk&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: b1b1d783eabdb6ac4e4578b2c04b0c24483dce77
      https://github.com/qemu/qemu/commit/b1b1d783eabdb6ac4e4578b2c04b0c24483dce77
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M block.c

  Log Message:
  -----------
  block: make bdrv_find_backing_image compare canonical filenames

Currently, bdrv_find_backing_image compares bs-&gt;backing_file with
what is passed in as a backing_file name.  Mismatches may occur,
however, when bs-&gt;backing_file and backing_file are not both
absolute or relative.

Use path_combine() to make sure any relative backing filenames are
relative to the current image filename being searched, and then use
realpath() to make all comparisons based on absolute filenames.

If either backing_file or bs-&gt;backing_file is determine to be a
protocol, then no filename normalization is performed.

This also changes bdrv_find_backing_image to no longer be recursive,
but iterative.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: d5208c45be38ab858db6ec5a5097aa1c1a8ebbc9
      https://github.com/qemu/qemu/commit/d5208c45be38ab858db6ec5a5097aa1c1a8ebbc9
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M block/commit.c
    M blockdev.c
    M tests/qemu-iotests/040

  Log Message:
  -----------
  block: in commit, determine base image from the top image

This simplifies some code and error checking, and also fixes a bug.

bdrv_find_backing_image() should only be passed absolute filenames,
or filenames relative to the chain.  In the QMP message handler for
block commit, when looking up the base do so from the determined top
image, so we know it is reachable from top.

Some of the error messages put out by block-commit have changed
slightly, which causes 2 tests cases for block-commit to fail.
This patch updates the test cases to look for the correct error
output.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 6bf0d1f478a5a425c0c024994375592805d591c0
      https://github.com/qemu/qemu/commit/6bf0d1f478a5a425c0c024994375592805d591c0
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M tests/qemu-iotests/040
    M tests/qemu-iotests/040.out

  Log Message:
  -----------
  qemu-iotests: add relative backing file tests for block-commit (040)

The previous block commit used absolute filenames for all block-commit
images and commands; this adds relative filenames for the same tests.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 9699bf0d06eb42625779216586a28d19d8fc005d
      https://github.com/qemu/qemu/commit/9699bf0d06eb42625779216586a28d19d8fc005d
  Author: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M qemu-img.c

  Log Message:
  -----------
  qemu-img: Add --backing-chain option to info command

The qemu-img info --backing-chain option enumerates the backing file
chain.  For example, for base.qcow2 &lt;- snap1.qcow2 &lt;- snap2.qcow2 the
output becomes:

  $ qemu-img info --backing-chain snap2.qcow2
  image: snap2.qcow2
  file format: qcow2
  virtual size: 100M (104857600 bytes)
  disk size: 196K
  cluster_size: 65536
  backing file: snap1.qcow2
  backing file format: qcow2

  image: snap1.qcow2
  file format: qcow2
  virtual size: 100M (104857600 bytes)
  disk size: 196K
  cluster_size: 65536
  backing file: base.qcow2
  backing file format: qcow2

  image: base.qcow2
  file format: qcow2
  virtual size: 100M (104857600 bytes)
  disk size: 136K
  cluster_size: 65536

Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 514d9da5a9a820b43a2cb90b439dd570a7835114
      https://github.com/qemu/qemu/commit/514d9da5a9a820b43a2cb90b439dd570a7835114
  Author: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    A tests/qemu-iotests/043
    A tests/qemu-iotests/043.out
    M tests/qemu-iotests/common.rc
    M tests/qemu-iotests/group

  Log Message:
  -----------
  qemu-iotests: Add 043 backing file chain infinite loop test

This new test verifies that qemu-img info --backing-chain safely aborts
when an image file has a backing file infinite loop.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: e53575606aa5567bde3246cdc3af1fdc757f77c8
      https://github.com/qemu/qemu/commit/e53575606aa5567bde3246cdc3af1fdc757f77c8
  Author: Kashyap Chamarthy &lt;kashyap.cv@gmail.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M qemu-img-cmds.hx
    M qemu-img.texi

  Log Message:
  -----------
  qemu-img: document 'info --backing-chain'

Signed-off-by: Kashyap Chamarthy &lt;kashyap.cv@gmail.com&gt;
Reviewed-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 80168bff43760bde98388480dc7c93f94693421c
      https://github.com/qemu/qemu/commit/80168bff43760bde98388480dc7c93f94693421c
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M block.c

  Log Message:
  -----------
  block: bdrv_create(): don't leak cco.filename on error

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Stefan Hajnoczi &lt;stefanha@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 9ac54af0c35d3f931653efae5698ef0f465eac7c
      https://github.com/qemu/qemu/commit/9ac54af0c35d3f931653efae5698ef0f465eac7c
  Author: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M monitor.c
    M qapi-schema.json

  Log Message:
  -----------
  monitor: Allow add-fd to any specified fd set

The first call to add an fd to an fd set was previously not
allowed to choose the fd set ID.  The ID was generated as
the first available and ensuing calls could add more fds by
specifying the fd set ID.  This change allows users to
choose the fd set ID on the first call.

Signed-off-by: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: e446f70d54b4920e8ca5af509271b69eab86e37b
      https://github.com/qemu/qemu/commit/e446f70d54b4920e8ca5af509271b69eab86e37b
  Author: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M monitor.c
    M monitor.h

  Log Message:
  -----------
  monitor: Enable adding an inherited fd to an fd set

qmp_add_fd() gets an fd that was received over a socket with
SCM_RIGHTS and adds it to an fd set.  This patch adds support
that will enable adding an fd that was inherited on the
command line to an fd set.

Note: All of the code added to monitor_fdset_add_fd(), with the
exception of the error path for non-valid fdset-id, is code motion
from qmp_add_fd().

Signed-off-by: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: ebe52b592dd5867fce7238f49b8c0416c3eedb6c
      https://github.com/qemu/qemu/commit/ebe52b592dd5867fce7238f49b8c0416c3eedb6c
  Author: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M monitor.c

  Log Message:
  -----------
  monitor: Prevent removing fd from set during init

If an fd is added to an fd set via the command line, and it is not
referenced by another command line option (ie. -drive), then clean
it up after QEMU initialization is complete.

Signed-off-by: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 587ed6be0b6331b11169da8846b8442840d5428c
      https://github.com/qemu/qemu/commit/587ed6be0b6331b11169da8846b8442840d5428c
  Author: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M qemu-config.c
    M qemu-options.hx
    M vl.c

  Log Message:
  -----------
  qemu-config: Add new -add-fd command line option

This option can be used for passing file descriptors on the
command line.  It mirrors the existing add-fd QMP command which
allows an fd to be passed to QEMU via SCM_RIGHTS and added to an
fd set.

This can be combined with commands such as -drive to link file
descriptors in an fd set to a drive:

    qemu-kvm -add-fd fd=3,set=2,opaque="rdwr:/path/to/file"
       -add-fd fd=4,set=2,opaque="rdonly:/path/to/file"
       -drive file=/dev/fdset/2,index=0,media=disk

This example adds dups of fds 3 and 4, and the accompanying opaque
strings to the fd set with ID=2.  qemu_open() already knows how
to handle a filename of this format.  qemu_open() searches the
corresponding fd set for an fd and when it finds a match, QEMU
goes on to use a dup of that fd just like it would have used an
fd that it opened itself.

Signed-off-by: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: ac84adac48963653638a1c95dd7c6ab8b4d5a4f3
      https://github.com/qemu/qemu/commit/ac84adac48963653638a1c95dd7c6ab8b4d5a4f3
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M block.c
    M block.h

  Log Message:
  -----------
  block: add bdrv_query_info

Extract it out of the implementation of "info block".

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 9887b616619f62977682e76927a9b5a6134cc8bf
      https://github.com/qemu/qemu/commit/9887b616619f62977682e76927a9b5a6134cc8bf
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M block.c
    M block.h

  Log Message:
  -----------
  block: add bdrv_query_stats

qmp_query_blockstat cannot have errors, remove the Error argument and
create a new public function bdrv_query_stats out of it.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 9156df12a4f3b3db63d1b292d081d814f02e311a
      https://github.com/qemu/qemu/commit/9156df12a4f3b3db63d1b292d081d814f02e311a
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M block.c
    M block.h

  Log Message:
  -----------
  block: add bdrv_open_backing_file

Mirroring runs without the backing file so that it can be copied outside
QEMU.  However, we need to add it at the time the job is completed and
QEMU switches to the target.  Factor out the common bits of opening an
image and completing a mirroring operation.

The new function does not assume that the file is closed immediately after
it returns failure, so it keeps the BDRV_O_NO_BACKING flag up-to-date.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 1755da16e32c15b22a521e8a38539e4b5cf367f3
      https://github.com/qemu/qemu/commit/1755da16e32c15b22a521e8a38539e4b5cf367f3
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M block.c
    M block.h

  Log Message:
  -----------
  block: introduce new dirty bitmap functionality

Assert that write_compressed is never used with the dirty bitmap.
Setting the bits early is wrong, because a coroutine might concurrently
examine them and copy incomplete data from the source.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: b9a9b3a4626aa099f829e2a6036bfaa0c8e47700
      https://github.com/qemu/qemu/commit/b9a9b3a4626aa099f829e2a6036bfaa0c8e47700
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M block.c
    M qapi-schema.json

  Log Message:
  -----------
  block: export dirty bitmap information in query-block

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 65f4632243f526958aa1f6b3911add98329c3796
      https://github.com/qemu/qemu/commit/65f4632243f526958aa1f6b3911add98329c3796
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M block/commit.c
    M block/stream.c
    M blockjob.c
    M blockjob.h

  Log Message:
  -----------
  block: rename block_job_complete to block_job_completed

The imperative will be used for the QMP command.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: aeae883baf2377b714a41529f94905046fa058f3
      https://github.com/qemu/qemu/commit/aeae883baf2377b714a41529f94905046fa058f3
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M blockdev.c
    M blockjob.c
    M blockjob.h
    M hmp-commands.hx
    M hmp.c
    M hmp.h
    M qapi-schema.json
    M qerror.h
    M qmp-commands.hx
    M trace-events

  Log Message:
  -----------
  block: add block-job-complete

While streaming can be dropped as soon as it progressed through the whole
image, mirroring needs to be completed manually for two reasons: 1) so that
management knows exactly when the VM switches to the target; 2) because
for other use cases such as replication, we may leave the operation running
for the whole life of the virtual machine.

Add a new block job command that manually completes background operations.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: a66a2a368383e627b929bf42d1b972822491404b
      https://github.com/qemu/qemu/commit/a66a2a368383e627b929bf42d1b972822491404b
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M QMP/qmp-events.txt
    M blockdev.c
    M blockjob.c
    M blockjob.h
    M monitor.c
    M monitor.h
    M qapi-schema.json

  Log Message:
  -----------
  block: introduce BLOCK_JOB_READY event

Even for jobs that need to be manually completed, management may want
to take care itself of the completion, not requiring the user to issue
a command to terminate the job.  In this case we want to avoid that
they poll us continuously, waiting for completion to become available.
Thus, add a new event that signals the phase switch and the availability
of the block-job-complete command.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 893f7ebafe4e8afc0ce4dbd9e64b3752f3036bbb
      https://github.com/qemu/qemu/commit/893f7ebafe4e8afc0ce4dbd9e64b3752f3036bbb
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M block/Makefile.objs
    A block/mirror.c
    M block_int.h
    M qapi-schema.json
    M trace-events

  Log Message:
  -----------
  mirror: introduce mirror job

This patch adds the implementation of a new job that mirrors a disk to
a new image while letting the guest continue using the old image.
The target is treated as a "black box" and data is copied from the
source to the target in the background.  This can be used for several
purposes, including storage migration, continuous replication, and
observation of the guest I/O in an external program.  It is also a
first step in replacing the inefficient block migration code that is
part of QEMU.

The job is possibly never-ending, but it is logically structured into
two phases: 1) copy all data as fast as possible until the target
first gets in sync with the source; 2) keep target in sync and
ensure that reopening to the target gets a correct (full) copy
of the source data.

The second phase is indicated by the progress in "info block-jobs"
reporting the current offset to be equal to the length of the file.
When the job is cancelled in the second phase, QEMU will run the
job until the source is clean and quiescent, then it will report
successful completion of the job.

In other words, the BLOCK_JOB_CANCELLED event means that the target
may _not_ be consistent with a past state of the source; the
BLOCK_JOB_COMPLETED event means that the target is consistent with
a past state of the source.  (Note that it could already happen
that management lost the race against QEMU and got a completion
event instead of cancellation).

It is not yet possible to complete the job and switch over to the target
disk.  The next patches will fix this and add many refinements to the
basic idea introduced here.  These include improved error management,
some tunable knobs and performance optimizations.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: d9b902db3fb71fdcdfbb2aa9cc94a410dee864e5
      https://github.com/qemu/qemu/commit/d9b902db3fb71fdcdfbb2aa9cc94a410dee864e5
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M blockdev.c
    M hmp-commands.hx
    M hmp.c
    M hmp.h
    M qapi-schema.json
    M qmp-commands.hx

  Log Message:
  -----------
  qmp: add drive-mirror command

This adds the monitor commands that start the mirroring job.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: d63ffd87acad618a4a64b8812b64ad88577ae9b1
      https://github.com/qemu/qemu/commit/d63ffd87acad618a4a64b8812b64ad88577ae9b1
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M block/mirror.c

  Log Message:
  -----------
  mirror: implement completion

Switching to the target of the migration is done mostly asynchronously,
and reported to management via the BLOCK_JOB_COMPLETED event; the only
synchronous phase is opening the backing files.  bdrv_open_backing_file
can always be done, even for migration of the full image (aka sync:
'full').  In this case, qmp_drive_mirror will create the target disk
with no backing file at all, and bdrv_open_backing_file will be a no-op.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 44c7ca5ebfb20c8086ac78f72a1bc6566828f956
      https://github.com/qemu/qemu/commit/44c7ca5ebfb20c8086ac78f72a1bc6566828f956
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    A tests/qemu-iotests/041
    A tests/qemu-iotests/041.out
    M tests/qemu-iotests/group

  Log Message:
  -----------
  qemu-iotests: add mirroring test case

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 3bd293c3fdc8b4052b9fc357e0b28cba20e73099
      https://github.com/qemu/qemu/commit/3bd293c3fdc8b4052b9fc357e0b28cba20e73099
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M block.c
    M blockjob.c
    M blockjob.h

  Log Message:
  -----------
  iostatus: forward block_job_iostatus_reset to block job

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: b952b5589a36114e06201c0d2e82c293dbad2b1f
      https://github.com/qemu/qemu/commit/b952b5589a36114e06201c0d2e82c293dbad2b1f
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M block/mirror.c
    M block_int.h
    M blockdev.c
    M hmp.c
    M qapi-schema.json
    M qmp-commands.hx

  Log Message:
  -----------
  mirror: add support for on-source-error/on-target-error

Error management is important for mirroring; otherwise, an error on the
target (even something as "innocent" as ENOSPC) requires to start again
with a full copy.  Similar to on_read_error/on_write_error, two separate
knobs are provided for on_source_error (reads) and on_target_error (writes).
The default is 'report' for both.

The 'ignore' policy will leave the sector dirty, so that it will be
retried later.  Thus, it will not cause corruption.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 9eb80eadd498fae2ad9eecbb89646b0cc4929cac
      https://github.com/qemu/qemu/commit/9eb80eadd498fae2ad9eecbb89646b0cc4929cac
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M QMP/qmp.py

  Log Message:
  -----------
  qmp: add pull_event function

This function is unlike get_events in that it makes it easy to process
one event at a time.  This is useful in the mirroring test cases, where
we want to process just one event (BLOCK_JOB_ERROR) and leave the others
to a helper function.

Acked-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 9dfa9f593045d70572ebfd94f59cd33ec99e847c
      https://github.com/qemu/qemu/commit/9dfa9f593045d70572ebfd94f59cd33ec99e847c
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M tests/qemu-iotests/041
    M tests/qemu-iotests/041.out
    M tests/qemu-iotests/iotests.py

  Log Message:
  -----------
  qemu-iotests: add testcases for mirroring on-source-error/on-target-error

The new options are tested with blkdebug on both the source and the
target.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 3b6eda2f57a5b7ed047077b6272c2b5a9e3531ca
      https://github.com/qemu/qemu/commit/3b6eda2f57a5b7ed047077b6272c2b5a9e3531ca
  Author: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
  Date:   2012-10-24 (Wed, 24 Oct 2012)

  Changed paths:
    M osdep.c

  Log Message:
  -----------
  osdep: Less restrictive F_SEFL in qemu_dup_flags()

qemu_dup_flags() currently limits the flags that can be set on the
fcntl() F_SETFL call to those that we currently know can be set with
fcntl() F_SETFL.  The problem with this is that it will prevent use
of new flags in the future without a code update.

This patch relaxes the checking and lets fcntl() determine the flags
it can set.

Signed-off-by: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 00a0770de3ddb803a0f81f6aea40b0f945154a68
      https://github.com/qemu/qemu/commit/00a0770de3ddb803a0f81f6aea40b0f945154a68
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Properly unmap packets on cancel / invalid pid

Packets with an invalid pid, or which were cancelled have
usb_packet_map() called on them on init, but not usb_packet_unmap()
before being freed.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 7c2eaca4efa46e02caaec4ca7ddf05a6e461da94
      https://github.com/qemu/qemu/commit/7c2eaca4efa46e02caaec4ca7ddf05a6e461da94
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Move checks to continue queuing to uhci_fill_queue()

Rather then having a special check to start queuing after the first packet,
and then another check for the other packets in uhci_fill_queue(), simply
check the previous packet beforehand in uhci_fill_queue()

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 549a3c3d9665bdc0246fb6594b6e36ce3afadd21
      https://github.com/qemu/qemu/commit/549a3c3d9665bdc0246fb6594b6e36ce3afadd21
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Get rid of packet tbytes field

This field is used in some places to track the tbytes field of the token, but
in other places the field is used directly, use it directly everywhere for
consistency.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: cf08a8a1f600b2ac25f72cf5736247f3e95cc43d
      https://github.com/qemu/qemu/commit/cf08a8a1f600b2ac25f72cf5736247f3e95cc43d
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Set int flag on a short input packet

According to 4.15.1.2 an interrupt must be raised when a short packet
is received. If we don't do this it may take a significant time for
the guest to notice a short trasnfer has completed, since only the last td
will have its IOC flag set, and a short transfer may complete in an earlier
packet.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 0262f65aaae49d582e7d4e4b1b5c8cfe4cd19d6d
      https://github.com/qemu/qemu/commit/0262f65aaae49d582e7d4e4b1b5c8cfe4cd19d6d
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Improve latency of interrupt delivery and async schedule scanning

While doing various performance tests of reading from USB mass storage devices
I noticed the following::
1) When an async handled packet completes, we don't immediately report an
   interrupt to the guest, instead we wait for the frame-timer to run and
   report it from there
2) If 1) has been fixed and an async handled packet takes a while to complete,
   then async_stepdown will become a high value, which means that there
   will be a large latency before any new packets queued by the guest in
   response to the interrupt get seen

1) was done deliberately as part of commit f0ad01f92:
http://www.kraxel.org/cgit/qemu/commit/?h=usb.57&amp;id=f0ad01f92ca02eee7cadbfd225c5de753ebd5fce
 Since setting the interrupt immediately on async packet completion was causing
issues with Linux guests, I believe this recently fixed Linux bug explains
why this is happening:
http://git.kernel.org/?p=linux/kernel/git/torvalds/linux.git;a=commitdiff;h=361aabf395e4a23cf554cf4ec0c0c6963b8beb01


Note that we can *not* count on this fix being present in all Linux guests!

I was hoping that the recently added support for Interrupt Threshold Control
would fix the issues with Linux guests, but adding a simple ehci_commit_irq()
call to ehci_async_bh() still caused problems with Linux guests.

The problem is, that when doing ehci_commit_irq() from ehci_async_bh(),
the "old" frindex value is used to calculate usbsts_frindex, and when
the frame-timer then runs possibly very shortly after ehci_async_bh(),
it increases the frame-timer, and thus any interrupts raised from that
frame-timer run, will also get reported to the guest immediately, rather
then being delayed to the next frame-timer run.

Luckily the solution for this is simple, this means that we need to
increase frindex before calling ehci_commit_irq() from ehci_async_bh(),
which in the end boils down to simple calling ehci_frame_timer() instead
of ehci_async_bh() from the bh.

This may seem like it causes a lot of extra work to be done, but this
is not true. Any work done from the frame-timer processing the periodic
schedule is work which then does not need to be done the next time the
frame timer runs, also the frame-timer will re-arm itself at (possibly)
a later time then it was armed for saving a vmexit at that time.

As an additional advantage moving to simply calling the frame-timer also
fixes 2) as the packet completion will set async_stepdown to 0, and the
re-arming of the timer with an async_stepdown of 0 ensures that any
newly queued up packets get seen in a reasonable amount of time.

This improves the speed (MB/s) of a Linux guest reading from a USB mass
storage device by a factor of 1.5 - 1.7 with input pipelining disabled,
and by a factor of 1.8 with input pipelining enabled.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 44272b0f88247e2d2960c0ef19b546c206a10080
      https://github.com/qemu/qemu/commit/44272b0f88247e2d2960c0ef19b546c206a10080
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Speed up the timer of raising int from the async schedule

Often the guest will queue up new packets in response to a packet, in the
async schedule with its IOC flag set, completing. By speeding up the
frame-timer, we notice these new packets earlier. This increases the
speed (MB/s) of a Linux guest reading from a USB mass storage device by a
factor of 1.15 on top of the "Improve latency of interrupt delivery"
speed-ups, both with and without input pipelining enabled.

I've not tested the speed-up of this patch without the
"Improve latency of interrupt delivery" patch.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: e3a36bce1d0123d003855f7731494e6d6f550fcc
      https://github.com/qemu/qemu/commit/e3a36bce1d0123d003855f7731494e6d6f550fcc
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Detect going in circles when filling the queue

For ctrl endpoints Windows (atleast Win7) creates circular td lists, so far
these were not a problem because we would stop filling the queue if altnext
was set. Since further patches in this patchset remove the altnext check this
does become a problem and we need detection for going in circles.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: b4ea86649915eca5551a5166f76e7a9d9032de50
      https://github.com/qemu/qemu/commit/b4ea86649915eca5551a5166f76e7a9d9032de50
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Retry to fill the queue while waiting for td completion

If the guest is using multiple transfers to try and keep the usb bus busy /
used at maximum efficiency, currently we would see / do the following:

1) submit transfer 1 to the device
2) submit transfer 2 to the device
3) report transfer 1 completion to guest
4) report transfer 2 completion to guest
5) submit transfer 1 to the device
6) report transfer 1 completion to guest
7) submit transfer 2 to the device
8) report transfer 2 completion to guest
etc.

So after the initial submission we would effectively only have 1 transfer
in flight, rather then 2. This is caused by us not checking the queue for
addition of new transfers by the guest (ie the resubmission of a recently
finished transfer), while waiting for a pending transfer to complete.
This patch does add a check for this, changing the sequence to:

1) submit transfer 1 to the device
2) submit transfer 2 to the device
3) report transfer 1 completion to guest
4) submit transfer 1 to the device
5) report transfer 2 completion to guest
6) submit transfer 2 to the device
etc.

Thus keeping 2 transfers in flight (most of the time, and always 1),
as intended by the guest.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 3151f2096dd676dc42e81ef0d55ae80780fd8769
      https://github.com/qemu/qemu/commit/3151f2096dd676dc42e81ef0d55ae80780fd8769
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: Add a xhci_ep_nuke_one_xfer helper function

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: d0ff81b871af3c6cf31c807dfdd480b9d1032780
      https://github.com/qemu/qemu/commit/d0ff81b871af3c6cf31c807dfdd480b9d1032780
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb.h
    M hw/usb/core.c

  Log Message:
  -----------
  usb: Rename __usb_packet_complete to usb_packet_complete_one

And make it available for use outside of core.c

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 36dfe324fd4b5efd9ef1a5b4c352bbb158952e24
      https://github.com/qemu/qemu/commit/36dfe324fd4b5efd9ef1a5b4c352bbb158952e24
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb.h
    M hw/usb/bus.c
    M hw/usb/core.c
    M hw/usb/hcd-ehci.c
    M hw/usb/hcd-musb.c
    M hw/usb/hcd-ohci.c
    M hw/usb/hcd-uhci.c
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  usb: Add USB_RET_ADD_TO_QUEUE packet result code

This can be used by usb-device code which wishes to process an entire endpoint
queue at once, to do this the usb-device code returns USB_RET_ADD_TO_QUEUE
from its handle_data class method and defines a flush_ep_queue class method
to call when the hcd is done queuing up packets.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 0cae7b1a004d6857e3bde3d511d7efa39d3cb48a
      https://github.com/qemu/qemu/commit/0cae7b1a004d6857e3bde3d511d7efa39d3cb48a
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb.h
    M hw/usb/core.c
    M hw/usb/hcd-ehci.c
    M hw/usb/hcd-uhci.c
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  usb: Move clearing of queue on halt to the core

hcds which queue up more then one packet at once (uhci, ehci and xhci),
must clear the queue after an error which has caused the queue to halt.

Currently this is handled as a special case inside the hcd code, this
patch instead adds an USB_RET_REMOVE_FROM_QUEUE packet result code, teaches
the 3 hcds about this and moves the clearing of the queue on a halt into
the USB core.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 6ba43f1f6b60159e731b1f37ffb53ab9ab59efa9
      https://github.com/qemu/qemu/commit/6ba43f1f6b60159e731b1f37ffb53ab9ab59efa9
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb.h
    M hw/usb/core.c
    M hw/usb/hcd-ehci.c
    M hw/usb/hcd-musb.c
    M hw/usb/hcd-ohci.c
    M hw/usb/hcd-uhci.c
    M hw/usb/hcd-xhci.c
    M hw/usb/host-linux.c
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb: Move short-not-ok handling to the core

After a short-not-ok packet ending short, we should not advance the queue.
Move enforcing this to the core, rather then handling it in the hcd code.

This may result in the queue now actually containing multiple input packets
(which would not happen before), and this requires special handling in
combination with pipelining, so disable pipleining for input endpoints
(for now).

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: a6fb2ddb1417fcc2d24f3231c84035fcbd90123a
      https://github.com/qemu/qemu/commit/a6fb2ddb1417fcc2d24f3231c84035fcbd90123a
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb.h
    M hw/usb/core.c
    M hw/usb/hcd-ehci.c
    M hw/usb/hcd-musb.c
    M hw/usb/hcd-ohci.c
    M hw/usb/hcd-uhci.c
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  usb: Add an int_req flag to USBPacket

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: aaac74343d761947e57a1b0cbaa7f2dd0c6a40ca
      https://github.com/qemu/qemu/commit/aaac74343d761947e57a1b0cbaa7f2dd0c6a40ca
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/core.c
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  usb: Enforce iso endpoints never returing USB_RET_ASYNC

ehci was already testing for this, and we depend in various places
on no devices doing this, so lets move the check for this to the
usb core.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 5b352ed537e31a6b5f9e33e26429ba8b909af234
      https://github.com/qemu/qemu/commit/5b352ed537e31a6b5f9e33e26429ba8b909af234
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: No need to handle async completion of isoc packets

No devices ever return async for isoc endpoints and the core
already enforces this.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 2f2ee2689ffe8a784a86bf10fb946772748632c7
      https://github.com/qemu/qemu/commit/2f2ee2689ffe8a784a86bf10fb946772748632c7
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: cleanup: Add an unlink call to uhci_async_cancel()

All callers of uhci_async_cancel() call uhci_async_unlink() first, so
lets move the unlink call to uhci_async_cancel()

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: a89e255b0cbe7c5b56348201e1c0f6d427c98fc8
      https://github.com/qemu/qemu/commit/a89e255b0cbe7c5b56348201e1c0f6d427c98fc8
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Don't retry on error

Since we are either dealing with emulated devices, where retrying is
not going to help, or with redirected devices where the host OS will
have already retried, don't bother retrying on failed transfers.

Also move some common/indentical code out of all the error cases
into the generic error path.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 3c87c76d1a0e9ce1dde6f919e3b1b9bcabb69985
      https://github.com/qemu/qemu/commit/3c87c76d1a0e9ce1dde6f919e3b1b9bcabb69985
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Drop unnecessary forward declaration of some static functions

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 40507377261250fe19e441300788c77b748688cb
      https://github.com/qemu/qemu/commit/40507377261250fe19e441300788c77b748688cb
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Move emptying of the queue's asyncs' queue to uhci_queue_free

Cleanup: all callers of uhci_queue_free first unconditionally cancel
all remaining asyncs in the queue, so lets move this to uhci_queue_free().

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 1f250cc77224f9b950c867e47d9f47e4cd46d7d4
      https://github.com/qemu/qemu/commit/1f250cc77224f9b950c867e47d9f47e4cd46d7d4
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Rename UHCIAsync-&gt;td to UHCIAsync-&gt;td_addr

We use the name td both to refer to a UHCI_TD read from guest memory as
well as to refer to the guest address where a td is stored, switch over
to always use td_addr in the second case for consistency.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 963a68b54f8f4e5dcc7cc2c6ec8d047557ac5feb
      https://github.com/qemu/qemu/commit/963a68b54f8f4e5dcc7cc2c6ec8d047557ac5feb
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Add uhci_read_td() helper function

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: a4f30cd766888e69e1d75cd87d251c04e829688e
      https://github.com/qemu/qemu/commit/a4f30cd766888e69e1d75cd87d251c04e829688e
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Make uhci_fill_queue() actually operate on an UHCIQueue

And move its calling point to handle_td, this removes the ep_ret ugliness,
and prepates the way for further cleanups in the follow-up patches in this
patch-set.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 11d15e402beec122fb11104e36c35d1a46f650ff
      https://github.com/qemu/qemu/commit/11d15e402beec122fb11104e36c35d1a46f650ff
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Store ep in UHCIQueue

This avoids the need to repeatedly lookup the device, and ep.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 5ad23e873c858292dc58b9296261365312b8f683
      https://github.com/qemu/qemu/commit/5ad23e873c858292dc58b9296261365312b8f683
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Immediately free queues on device disconnect

There is no need to just cancel any in-flight packets, and then wait
for validate-end to clean things up, we can simply clean things up
immediately on device removal.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 66a08cbe6ad1aebec8eecf58b3ba042e19dd1649
      https://github.com/qemu/qemu/commit/66a08cbe6ad1aebec8eecf58b3ba042e19dd1649
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c
    M trace-events

  Log Message:
  -----------
  uhci: Verify queue has not been changed by guest

According to the spec a guest can unlink a qh, and then as soon as frindex
has changed by 1 since the unlink, assume it is idle and re-use it. However
for various reasons, we cannot simply consider a qh as unlinked if we've not
seen it for 1 frame. This means that it is possible for a guest to re-use /
restart the queue while we still see its old state. This patch adds a safety
check for this, and "early" retires queues when they were changed by the guest.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 8c75a899f85dda9f8305d25f0cc453a79115fd90
      https://github.com/qemu/qemu/commit/8c75a899f85dda9f8305d25f0cc453a79115fd90
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Detect guest td re-use

A td can be reused by the guest in a different queue, before we notice
the original queue has been unlinked. So search for tds by addr only, detect
guest td reuse, and cancel the original queue, this is necessary to keep our
packet ids unique.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 420ca987d5d14fabacdec86c568832d6b0056ca3
      https://github.com/qemu/qemu/commit/420ca987d5d14fabacdec86c568832d6b0056ca3
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: When the guest marks a pending td non-active, cancel the queue

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 3905097ea8ea0e1b3dd1556f3ef74a123fe8622a
      https://github.com/qemu/qemu/commit/3905097ea8ea0e1b3dd1556f3ef74a123fe8622a
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Always mark a queue valid when we encounter it

Before this patch we would not mark a queue valid when its head was a
non-active td. This causes us to misbehave in the following scenario:

1) queue with multiple input transfers queued
2) We hit some latency issue, causing qemu to get behind processing frames
3) When qemu gets to run again, it notices the first transfer ends short,
   marking the head td non-active
4) It now processes 32+ frames in a row without giving the guest a chance
   to run since it is behind
5) valid is decreased to 0, causing the queue to get cancelled also cancelling
   already queued up further input transfers
6) guest gets to run, notices the inactive td, cleanups up further tds
   from the short transfer, and lets the queue continue at the first td of
   the next input transfer
7) we re-start the queue, issuing the second input transfer for the *second*
   time, and any data read by the first time we issued it has been lost

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 8928c9c43df1a0eeda1ae2e9582beb34dce49330
      https://github.com/qemu/qemu/commit/8928c9c43df1a0eeda1ae2e9582beb34dce49330
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Retry to fill the queue while waiting for td completion

If the guest is using multiple transfers to try and keep the usb bus busy /
used at maximum efficiency, currently we would see / do the following:

1) submit transfer 1 to the device
2) submit transfer 2 to the device
3) report transfer 1 completion to guest
4) report transfer 2 completion to guest
5) submit transfer 1 to the device
6) report transfer 1 completion to guest
7) submit transfer 2 to the device
8) report transfer 2 completion to guest
etc.

So after the initial submission we would effectively only have 1 transfer
in flight, rather then 2. This is caused by us not checking the queue for
addition of new transfers by the guest (ie the resubmission of a recently
finished transfer), while waiting for a pending transfer to complete.
This patch does add a check for this, changing the sequence to:

1) submit transfer 1 to the device
2) submit transfer 2 to the device
3) report transfer 1 completion to guest
4) submit transfer 1 to the device
5) report transfer 2 completion to guest
6) submit transfer 2 to the device
etc.

Thus keeping 2 transfers in flight (most of the time, and always 1),
as intended by the guest.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 6fe30910abd7e0f4af69f8e522ccfe6b5125abbb
      https://github.com/qemu/qemu/commit/6fe30910abd7e0f4af69f8e522ccfe6b5125abbb
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Use only one queue for ctrl endpoints

ctrl endpoints use different pids for different phases of a control
transfer, this patch makes us use only one queue for a ctrl ep, rather
then 3.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 79a8af3509151dd1b650c996defdda13e02a7e38
      https://github.com/qemu/qemu/commit/79a8af3509151dd1b650c996defdda13e02a7e38
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: fix function name in error message

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 3f973ee84ef51e448566c08ec5cfe746c9640269
      https://github.com/qemu/qemu/commit/3f973ee84ef51e448566c08ec5cfe746c9640269
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: flush endpoint context unconditinally

Not updating the endpoint context in case the state didn't change is
wrong.  Other context fields might have changed, for example the
dequeue pointer in response to a CR_SET_TR_DEQUEUE command.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: e099ad4b7e9ca7debdd624a0d465a33198a6844f
      https://github.com/qemu/qemu/commit/e099ad4b7e9ca7debdd624a0d465a33198a6844f
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: allow disabling interrupters

For secondary interrupters this is explicitly allowed in the specs.
For the primary interrupter behavior is undefined, lets be friendly
and allow disabling too.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 91062ae00fd4a88a40c28288e8ac7fe50ee83adf
      https://github.com/qemu/qemu/commit/91062ae00fd4a88a40c28288e8ac7fe50ee83adf
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: make number of interrupters and slots configurable

Add properties to tweak the numbers of available interrupters and slots.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 0ebfb144e8ad3f2da436d630fdcc5aa9ab646341
      https://github.com/qemu/qemu/commit/0ebfb144e8ad3f2da436d630fdcc5aa9ab646341
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-10-25 (Thu, 25 Oct 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: fix usb name in caps

Used to be "UTB" not "USB".

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 90c45b30319dee7d4137f18817395454728ea2f9
      https://github.com/qemu/qemu/commit/90c45b30319dee7d4137f18817395454728ea2f9
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M QMP/qmp-events.txt
    M QMP/qmp.py
    M block.c
    M block.h
    M block/Makefile.objs
    M block/commit.c
    A block/mirror.c
    M block/stream.c
    M block_int.h
    M blockdev.c
    M blockjob.c
    M blockjob.h
    M hmp-commands.hx
    M hmp.c
    M hmp.h
    M monitor.c
    M monitor.h
    M osdep.c
    M qapi-schema.json
    M qemu-config.c
    M qemu-img-cmds.hx
    M qemu-img.c
    M qemu-img.texi
    M qemu-options.hx
    M qerror.h
    M qmp-commands.hx
    M tests/qemu-iotests/040
    M tests/qemu-iotests/040.out
    A tests/qemu-iotests/041
    A tests/qemu-iotests/041.out
    A tests/qemu-iotests/042
    A tests/qemu-iotests/042.out
    A tests/qemu-iotests/043
    A tests/qemu-iotests/043.out
    M tests/qemu-iotests/common.rc
    M tests/qemu-iotests/group
    M tests/qemu-iotests/iotests.py
    M trace-events
    M vl.c

  Log Message:
  -----------
  Merge remote-tracking branch 'kwolf/for-anthony' into staging

* kwolf/for-anthony: (32 commits)
  osdep: Less restrictive F_SEFL in qemu_dup_flags()
  qemu-iotests: add testcases for mirroring on-source-error/on-target-error
  qmp: add pull_event function
  mirror: add support for on-source-error/on-target-error
  iostatus: forward block_job_iostatus_reset to block job
  qemu-iotests: add mirroring test case
  mirror: implement completion
  qmp: add drive-mirror command
  mirror: introduce mirror job
  block: introduce BLOCK_JOB_READY event
  block: add block-job-complete
  block: rename block_job_complete to block_job_completed
  block: export dirty bitmap information in query-block
  block: introduce new dirty bitmap functionality
  block: add bdrv_open_backing_file
  block: add bdrv_query_stats
  block: add bdrv_query_info
  qemu-config: Add new -add-fd command line option
  monitor: Prevent removing fd from set during init
  monitor: Enable adding an inherited fd to an fd set
  ...

Conflicts:
	vl.c

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 6b0e6468e33883c1739a7474fe6baca170eec9aa
      https://github.com/qemu/qemu/commit/6b0e6468e33883c1739a7474fe6baca170eec9aa
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/usb.h
    M hw/usb/bus.c
    M hw/usb/core.c
    M hw/usb/hcd-ehci.c
    M hw/usb/hcd-musb.c
    M hw/usb/hcd-ohci.c
    M hw/usb/hcd-uhci.c
    M hw/usb/hcd-xhci.c
    M hw/usb/host-linux.c
    M hw/usb/redirect.c
    M trace-events

  Log Message:
  -----------
  Merge remote-tracking branch 'kraxel/usb.68' into staging

* kraxel/usb.68: (36 commits)
  xhci: fix usb name in caps
  xhci: make number of interrupters and slots configurable
  xhci: allow disabling interrupters
  xhci: flush endpoint context unconditinally
  xhci: fix function name in error message
  uhci: Use only one queue for ctrl endpoints
  uhci: Retry to fill the queue while waiting for td completion
  uhci: Always mark a queue valid when we encounter it
  uhci: When the guest marks a pending td non-active, cancel the queue
  uhci: Detect guest td re-use
  uhci: Verify queue has not been changed by guest
  uhci: Immediately free queues on device disconnect
  uhci: Store ep in UHCIQueue
  uhci: Make uhci_fill_queue() actually operate on an UHCIQueue
  uhci: Add uhci_read_td() helper function
  uhci: Rename UHCIAsync-&gt;td to UHCIAsync-&gt;td_addr
  uhci: Move emptying of the queue's asyncs' queue to uhci_queue_free
  uhci: Drop unnecessary forward declaration of some static functions
  uhci: Don't retry on error
  uhci: cleanup: Add an unlink call to uhci_async_cancel()
  ...

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: b308c82cbda44e138ef990af64d44a5613c16092
      https://github.com/qemu/qemu/commit/b308c82cbda44e138ef990af64d44a5613c16092
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/pci_bridge.c
    M hw/pci_internals.h

  Log Message:
  -----------
  pci: avoid destroying bridge address space windows in a transaction

Calling memory_region_destroy() in a transaction is illegal (and aborts),
as until the transaction is committed, the region remains live.

Fix by moving destruction until after the transaction commits.  This requires
having an extra set of regions, so the new and old regions can coexist.

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/d262cb02861d...b308c82cbda4

----==_mimepart_508ebd2c4985e_4a3f154aaf010869c--


</body></email><email><emailId>20121029210018</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-29 21:00:18-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] d6e65d: pci: Helper function for testing if an INTx route ...</subject><body>



----==_mimepart_508eee6232e39_acc15efaf035820
Date: Mon, 29 Oct 2012 14:00:18 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;508eee6235ed6_acc15efaf03598f@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: d6e65d54f0fa980f891aa3166d85b6ffd7d541eb
      https://github.com/qemu/qemu/commit/d6e65d54f0fa980f891aa3166d85b6ffd7d541eb
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/pci.c
    M hw/pci.h

  Log Message:
  -----------
  pci: Helper function for testing if an INTx route changed

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 4774d7b258e0c4a6595a7b0bc6960c1751365bbf
      https://github.com/qemu/qemu/commit/4774d7b258e0c4a6595a7b0bc6960c1751365bbf
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/kvm/pci-assign.c

  Log Message:
  -----------
  pci-assign: Use pci_intx_route_changed()

Replace open coded version

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 39b9bc626a436837f0068cb600aaf91c0e8aa937
      https://github.com/qemu/qemu/commit/39b9bc626a436837f0068cb600aaf91c0e8aa937
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/msi.c
    M hw/msi.h

  Log Message:
  -----------
  msi: Add msi_get_message()

vfio-pci and pci-assign both do this on their own for setting up
direct MSI injection through KVM.  Provide a helper function for
this in MSI code.

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 2b199f9318ec698dfced65f5d4ad9729f166e37c
      https://github.com/qemu/qemu/commit/2b199f9318ec698dfced65f5d4ad9729f166e37c
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/kvm/pci-assign.c

  Log Message:
  -----------
  pci-assign: Use msi_get_message()

pci-assign only uses a subset of the flexibility msi_get_message()
provides, but it's still worthwhile to use it.

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 05c0621e64b425d9f89bef542f0b85e61dc57ff8
      https://github.com/qemu/qemu/commit/05c0621e64b425d9f89bef542f0b85e61dc57ff8
  Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/pci.c

  Log Message:
  -----------
  pci: Return PCI_INTX_DISABLED when no bus INTx routing support

Rather than assert, simply return PCI_INTX_DISABLED when we don't
have a pci_route_irq_fn.  PIIX already returns DISABLED for an
invalid pin, so users already deal with this state.  Users of this
interface should only be acting on an ENABLED or INVERTED return
value (though we really have no support for INVERTED).  Also
complain loudly when we hit this so we don't forget it's missing.

Signed-off-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Acked-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;


  Commit: dc59944bc9a5ad784572eea57610de60e4a2f4e5
      https://github.com/qemu/qemu/commit/dc59944bc9a5ad784572eea57610de60e4a2f4e5
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/pc_piix.c
    M target-i386/cpu.c
    M target-i386/cpu.h

  Log Message:
  -----------
  qemu: enable PV EOI for qemu 1.3

Enable KVM PV EOI by default. You can still disable it with
-kvm_pv_eoi cpu flag. To avoid breaking cross-version migration,
enable only for qemu 1.3 (or in the future, newer) machine type.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: e26631b74663f59b5873a84ed5b92ee4ddf48255
      https://github.com/qemu/qemu/commit/e26631b74663f59b5873a84ed5b92ee4ddf48255
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/pci.c

  Log Message:
  -----------
  pci: make each capability DWORD aligned

PCI spec (see e.g. 6.7 Capabilities List in spec rev 3.0)
requires that each capability is DWORD aligned.
Ensure this when allocating space by rounding size up to 4.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: b56d701f1d1f1828c9fabea535b3460857546dd0
      https://github.com/qemu/qemu/commit/b56d701f1d1f1828c9fabea535b3460857546dd0
  Author: Isaku Yamahata &lt;yamahata@valinux.co.jp&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/pci.c

  Log Message:
  -----------
  pci: pci capability must be in PCI space

pci capability must be in PCI space.
It can't lay in PCIe extended config space.

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Isaku Yamahata &lt;yamahata@valinux.co.jp&gt;
Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 9e38f56183c52e06fc29c64691f59a46d246eec5
      https://github.com/qemu/qemu/commit/9e38f56183c52e06fc29c64691f59a46d246eec5
  Author: Isaku Yamahata &lt;yamahata@valinux.co.jp&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/pci_ids.h

  Log Message:
  -----------
  pci_ids: add intel 82801BA pci-to-pci bridge id

Adds pci id constants which will be used by q35.

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Isaku Yamahata &lt;yamahata@valinux.co.jp&gt;
Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 91e5615984c1fd5674caad343e750bb5ecd17995
      https://github.com/qemu/qemu/commit/91e5615984c1fd5674caad343e750bb5ecd17995
  Author: Isaku Yamahata &lt;yamahata@valinux.co.jp&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/pci.c
    M hw/pci.h

  Log Message:
  -----------
  pci: introduce pci_swizzle_map_irq_fn() for standardized interrupt pin swizzle

Introduce pci_swizzle_map_irq_fn() for interrupt pin swizzle which is
standardized. PCI bridge swizzle is common logic, by introducing
this function duplicated swizzle logic will be avoided later.

[jbaron@redhat.com: drop opaque argument]
Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Isaku Yamahata &lt;yamahata@valinux.co.jp&gt;
Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: f7748569902f4854ac1223c143edbde4f588040f
      https://github.com/qemu/qemu/commit/f7748569902f4854ac1223c143edbde4f588040f
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/pci.c
    M hw/pci_ids.h

  Log Message:
  -----------
  pci: Add class 0xc05 as 'SMBus'

[jbaron@redhat.com: add PCI_CLASS_SERIAL_SMBUS definition]
Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: c702ddb8daece08b16fce9d6654b38304d385f93
      https://github.com/qemu/qemu/commit/c702ddb8daece08b16fce9d6654b38304d385f93
  Author: Jason Baron &lt;jbaron@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/pcie_host.c
    M hw/pcie_host.h

  Log Message:
  -----------
  pcie: pass pcie window size to pcie_host_mmcfg_update()

This allows q35 to pass/set the size of the pcie window in its update routine.

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: bc927e488c040c8ef2faed323e8a1a3d0ebbfb62
      https://github.com/qemu/qemu/commit/bc927e488c040c8ef2faed323e8a1a3d0ebbfb62
  Author: Jason Baron &lt;jbaron@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/pcie_host.c
    M hw/pcie_host.h

  Log Message:
  -----------
  pcie: Convert PCIExpressHost to use the QOM.

Let's use PCIExpressHost with QOM.

Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Acked-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: e35e23f655fb120a2b4d0695bdee86fafd9caabf
      https://github.com/qemu/qemu/commit/e35e23f655fb120a2b4d0695bdee86fafd9caabf
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/virtio-net.c

  Log Message:
  -----------
  virtio-net: track host/guest header length

Tracking these in device state instead of
re-calculating on each packet. No functional
changes.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: d336336c8164859e4527cbb9f3df189f8bb406de
      https://github.com/qemu/qemu/commit/d336336c8164859e4527cbb9f3df189f8bb406de
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M iov.c
    M iov.h

  Log Message:
  -----------
  iov: add iov_cpy

Add API to copy part of iovec safely.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 22cc84db6e42bef8646b8cd671f4c999e9c0a38f
      https://github.com/qemu/qemu/commit/22cc84db6e42bef8646b8cd671f4c999e9c0a38f
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/virtio-net.c

  Log Message:
  -----------
  virtio-net: avoid sg copy

Avoid tweaking iovec during receive. This removes
the need to copy the vector.
Note: we currently have an evil cast in work_around_broken_dhclient
and unfortunately this patch does not fix it - just
pushes the evil cast to another place.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 63c5872873de8d7d994a589eed7bfe6a70cc8e06
      https://github.com/qemu/qemu/commit/63c5872873de8d7d994a589eed7bfe6a70cc8e06
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/virtio-net.c

  Log Message:
  -----------
  virtio-net: use safe iov operations for rx

Avoid magling iov manually: use safe iov operations
for processing packets incoming to guest.
This also removes the requirement for virtio header to
fit the first s/g entry exactly.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 280598b7a5fdf96fb79d87a2129750bad5dbf24b
      https://github.com/qemu/qemu/commit/280598b7a5fdf96fb79d87a2129750bad5dbf24b
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/virtio-net.c

  Log Message:
  -----------
  virtio-net: refactor receive_hdr

Now that we know host hdr length, we don't need to
duplicate the logic in receive_hdr: caller can
figure out the offset itself.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: c8d28e7e336869524d166d88f08ad476eadedccb
      https://github.com/qemu/qemu/commit/c8d28e7e336869524d166d88f08ad476eadedccb
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/virtio-net.c

  Log Message:
  -----------
  virtio-net: first s/g is always at start of buf

We know offset is 0, assert that.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 14761f9cf7fbc6d058c1e51c313a139066eab256
      https://github.com/qemu/qemu/commit/14761f9cf7fbc6d058c1e51c313a139066eab256
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/virtio-net.c

  Log Message:
  -----------
  virtio-net: switch tx to safe iov functions

Avoid mangling iovec manually: use safe iov_*
functions.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 7b80d08efc36fd6c7881e98302f00148b5fd908a
      https://github.com/qemu/qemu/commit/7b80d08efc36fd6c7881e98302f00148b5fd908a
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/virtio-net.c

  Log Message:
  -----------
  virtio-net: simplify rx code

Remove code duplication using guest header length that we track.
Drop specific layout requirement for rx buffers: things work
using generic iovec functions in any case.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: e043ebc6f9a093c1fd1b677191ad9fbeefe22d1e
      https://github.com/qemu/qemu/commit/e043ebc6f9a093c1fd1b677191ad9fbeefe22d1e
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/virtio-net.c

  Log Message:
  -----------
  virtio-net: minor code simplification

During packet filtering, we can now use host hdr len
to offset incoming buffer unconditionally.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 6e371ab867d48c16e6a9ee32cefcea48692a4deb
      https://github.com/qemu/qemu/commit/6e371ab867d48c16e6a9ee32cefcea48692a4deb
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/virtio-net.c

  Log Message:
  -----------
  virtio-net: test peer header support at init time

There's no reason to query header support at random
times: at load or feature query.
Driver also might not query functions.
Cleaner to do it at device init.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: ff3a8066e651230d255e6eea340e2d48e7da4aeb
      https://github.com/qemu/qemu/commit/ff3a8066e651230d255e6eea340e2d48e7da4aeb
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/vhost_net.c
    M hw/virtio-net.c

  Log Message:
  -----------
  virtio-net: enable mrg buf header in tap on linux

Modern linux supports arbitrary header size,
which makes it possible to pass mrg buf header
to tap directly without iovec mangling.
Use this capability when it is there.

This removes the need to deal with it in
vhost-net as we do now.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 523a59f596a3e62f5a28eb171adba35e71310040
      https://github.com/qemu/qemu/commit/523a59f596a3e62f5a28eb171adba35e71310040
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/pci_bridge.c
    M hw/pci_internals.h

  Log Message:
  -----------
  pci: avoid destroying bridge address space windows in a transaction

Calling memory_region_destroy() in a transaction is illegal (and aborts),
as until the transaction is committed, the region remains live.

Fix by moving destruction until after the transaction commits.  This requires
having an extra set of regions, so the new and old regions can coexist.

Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 233926fafa6c4a0fb666e1469524d66dd3b47ddd
      https://github.com/qemu/qemu/commit/233926fafa6c4a0fb666e1469524d66dd3b47ddd
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/kvm/pci-assign.c
    M hw/msi.c
    M hw/msi.h
    M hw/pc_piix.c
    M hw/pci.c
    M hw/pci.h
    M hw/pci_ids.h
    M hw/pcie_host.c
    M hw/pcie_host.h
    M hw/vhost_net.c
    M hw/virtio-net.c
    M iov.c
    M iov.h
    M target-i386/cpu.c
    M target-i386/cpu.h

  Log Message:
  -----------
  Merge remote-tracking branch 'mst/tags/for_anthony' into staging

virtio,pci infrastructure

This includes infrastructure patches that don't do much by themselves
but should help vfio and q35 make progress.
Also included is rework of virtio-net to use iovec APIs
for vector access - helpful to make it more secure
and in preparation for a new feature that will allow
arbitrary s/g layout for guests.
Also included is a pci bridge bugfix by Avi.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;

* mst/tags/for_anthony: (25 commits)
  pci: avoid destroying bridge address space windows in a transaction
  virtio-net: enable mrg buf header in tap on linux
  virtio-net: test peer header support at init time
  virtio-net: minor code simplification
  virtio-net: simplify rx code
  virtio-net: switch tx to safe iov functions
  virtio-net: first s/g is always at start of buf
  virtio-net: refactor receive_hdr
  virtio-net: use safe iov operations for rx
  virtio-net: avoid sg copy
  iov: add iov_cpy
  virtio-net: track host/guest header length
  pcie: Convert PCIExpressHost to use the QOM.
  pcie: pass pcie window size to pcie_host_mmcfg_update()
  pci: Add class 0xc05 as 'SMBus'
  pci: introduce pci_swizzle_map_irq_fn() for standardized interrupt pin swizzle
  pci_ids: add intel 82801BA pci-to-pci bridge id
  pci: pci capability must be in PCI space
  pci: make each capability DWORD aligned
  qemu: enable PV EOI for qemu 1.3
  ...

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: d26a8caea3f160782841efb87b5e8bea606b512b
      https://github.com/qemu/qemu/commit/d26a8caea3f160782841efb87b5e8bea606b512b
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M memory.c

  Log Message:
  -----------
  memory: fix rendering of a region obscured by another

The memory core drops regions that are hidden by another region (for example,
during BAR sizing), but it doesn't do so correctly if the lower address of the
existing range is below the lower address of the new range.

Example (qemu-system-mips -M malta -kernel vmlinux-2.6.32-5-4kc-malta
   -append "console=ttyS0"  -nographic -vga cirrus):

Existing range: 10000000-107fffff
New range:      100a0000-100bffff

Correct behaviour: drop new range
Incorrect behaviour: add new range

Fix by taking this case into account (previously we only considered
equal lower boundaries).

Tested-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/b308c82cbda4...d26a8caea3f1

----==_mimepart_508eee6232e39_acc15efaf035820--


</body></email><email><emailId>20121030003010</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-30 00:30:10-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 235a3f: s390x: fix -initrd in virtio machine</subject><body>



----==_mimepart_508f1f92b7a92_a79174daf0110847
Date: Mon, 29 Oct 2012 17:30:10 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;508f1f92bae2c_a79174daf0110998@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 235a3f0bed3584fe65079ffa07c7a842971f261e
      https://github.com/qemu/qemu/commit/235a3f0bed3584fe65079ffa07c7a842971f261e
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/s390-virtio.c

  Log Message:
  -----------
  s390x: fix -initrd in virtio machine

When using -initrd in the virtio machine, we need to indicate the initrd
start and size inside the kernel image. These parameters need to be stored
in native endianness.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
Acked-by: Richard Henderson &lt;rth@twiddle.net&gt;
Acked-by: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;


  Commit: 1b3e6f88dc151578acb6158e22570cf3ee7cbb69
      https://github.com/qemu/qemu/commit/1b3e6f88dc151578acb6158e22570cf3ee7cbb69
  Author: Heinz Graalfs &lt;graalfs@linux.vnet.ibm.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M scripts/kvm/kvm_stat

  Log Message:
  -----------
  s390/kvm_stat: correct sys_perf_event_open syscall number

Correct sys_perf_event_open syscall number for s390 architecture
   - the hardcoded syscall number 298 is for x86 but should
     be different for other architectures.
     In case we figure out via /proc/cpuinfo that we are running
     on s390 the appropriate syscall number is used from map
     syscall_numbers; other architectures can extend this.

Signed-off-by: Heinz Graalfs &lt;graalfs@linux.vnet.ibm.com&gt;
Signed-off-by: Jens Freimann &lt;jfrei@linux.vnet.ibm.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 5b08b344bf581a266071389ceeb445e943e01ba1
      https://github.com/qemu/qemu/commit/5b08b344bf581a266071389ceeb445e943e01ba1
  Author: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M target-s390x/kvm.c

  Log Message:
  -----------
  s390: use sync regs for register transfer

Newer kernels provide the guest registers in kvm_run. Lets use
those if available (i.e. the capability is set). This avoids
ioctls on cpu_synchronize_state making intercepts faster.

In addition, we have now the prefix register, the access registers
the control registers up to date. This helps in certain cases,
e.g. for resolving kernel module addresses with gdb on a guest.

On return, we update the registers according to the level statement,
i.e. we put all registers for KVM_PUT_FULL_STATE and _RESET_STATE.

Signed-off-by: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
Signed-off-by: Jens Freimann &lt;jfrei@linux.vnet.ibm.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: f6c98f9286c69cafe108b7e9fb22c2ff5da7d6a9
      https://github.com/qemu/qemu/commit/f6c98f9286c69cafe108b7e9fb22c2ff5da7d6a9
  Author: Heinz Graalfs &lt;graalfs@linux.vnet.ibm.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/s390x/Makefile.objs
    A hw/s390x/sclp.c
    A hw/s390x/sclp.h
    M target-s390x/cpu.h
    M target-s390x/kvm.c
    M target-s390x/misc_helper.c

  Log Message:
  -----------
  s390: sclp base support

This adds a more generic infrastructure for handling Service-Call
requests on s390. Currently we only support a small subset of Read
SCP Info directly in target-s390x. This patch provides the base
infrastructure for supporting more commands and moves Read SCP
Info.
In the future we could add additional commands for hotplug, call
home and event handling.

Signed-off-by: Heinz Graalfs &lt;graalfs@linux.vnet.ibm.com&gt;
Signed-off-by: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
Signed-off-by: Jens Freimann &lt;jfrei@linux.vnet.ibm.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 559a17a1439e34a95dcab47ef99022bcd0e8f8e7
      https://github.com/qemu/qemu/commit/559a17a1439e34a95dcab47ef99022bcd0e8f8e7
  Author: Heinz Graalfs &lt;graalfs@linux.vnet.ibm.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/s390-virtio.c
    M hw/s390x/Makefile.objs
    A hw/s390x/event-facility.c
    A hw/s390x/event-facility.h
    M hw/s390x/sclp.c
    M hw/s390x/sclp.h

  Log Message:
  -----------
  s390: sclp event support

Several SCLP features are considered to be events. Those events don't
provide SCLP commands on their own, instead they are all based on
Read Event Data, Write Event Data, Write Event Mask and the service
interrupt. Follow-on patches will provide SCLP's Signal Quiesce (via
system_powerdown) and the ASCII console.
Further down the road the sclp line mode console and configuration
change events (e.g. cpu hotplug) can be implemented.

Signed-off-by: Heinz Graalfs &lt;graalfs@linux.vnet.ibm.com&gt;
Signed-off-by: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
Signed-off-by: Jens Freimann &lt;jfrei@linux.vnet.ibm.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: ab9074b559823a22822db9e299198c53169c34ea
      https://github.com/qemu/qemu/commit/ab9074b559823a22822db9e299198c53169c34ea
  Author: Heinz Graalfs &lt;graalfs@linux.vnet.ibm.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/s390x/Makefile.objs
    M hw/s390x/event-facility.c
    A hw/s390x/sclpquiesce.c

  Log Message:
  -----------
  s390: sclp signal quiesce support

This implements the sclp signal quiesce event via the SCLP Event
Facility.
This allows to gracefully shutdown a guest by using system_powerdown
notifiers. It creates a service interrupt that will trigger a
Read Event Data command from the guest. This code will then add an
event that is interpreted by linux guests as ctrl-alt-del.

Signed-off-by: Heinz Graalfs &lt;graalfs@linux.vnet.ibm.com&gt;
Signed-off-by: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
Signed-off-by: Jens Freimann &lt;jfrei@linux.vnet.ibm.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 130c57c036fdc2eba8936da1b1dad39e78d5ea32
      https://github.com/qemu/qemu/commit/130c57c036fdc2eba8936da1b1dad39e78d5ea32
  Author: Heinz Graalfs &lt;graalfs@linux.vnet.ibm.com&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/s390x/Makefile.objs
    A hw/s390x/sclpconsole.c

  Log Message:
  -----------
  s390: sclp ascii console support

This code adds console support  by implementing SCLP's ASCII Console
Data event. This is the same console as LPARs ASCII console or z/VMs
sysascii.

The console can be specified manually with something like
-chardev stdio,id=charconsole0 -device sclpconsole,chardev=charconsole0,id=console0

Newer kernels will autodetect that console and prefer that over virtio
console.

When data is received from the character layer it creates a service
interrupt to trigger a Read Event Data command from the guest that will
pick up the received character byte-stream.
When characters are echo'ed by the linux guest a Write Event Data occurs
which is forwarded by the Event Facility to the console that supports
a corresponding mask value.
Console resizing is not supported.
The character layer byte-stream is buffered using a fixed size iov
buffer.

Signed-off-by: Heinz Graalfs &lt;graalfs@linux.vnet.ibm.com&gt;
Signed-off-by: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
Signed-off-by: Jens Freimann &lt;jfrei@linux.vnet.ibm.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 3585317f6fdff0e3ae082f88afb2784d815a07e2
      https://github.com/qemu/qemu/commit/3585317f6fdff0e3ae082f88afb2784d815a07e2
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M tcg/mips/tcg-target.c

  Log Message:
  -----------
  tcg/mips: use MUL instead of MULT on MIPS32 and above

MIPS32 and later instruction sets have a multiplication instruction
directly operating on GPRs. It only produces a 32-bit result but
it is exactly what is needed by QEMU.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 38c4718392fda2bda1e084366b9aa41b49b9d8cf
      https://github.com/qemu/qemu/commit/38c4718392fda2bda1e084366b9aa41b49b9d8cf
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-29 (Mon, 29 Oct 2012)

  Changed paths:
    M hw/s390-virtio.c
    M hw/s390x/Makefile.objs
    A hw/s390x/event-facility.c
    A hw/s390x/event-facility.h
    A hw/s390x/sclp.c
    A hw/s390x/sclp.h
    A hw/s390x/sclpconsole.c
    A hw/s390x/sclpquiesce.c
    M scripts/kvm/kvm_stat
    M target-s390x/cpu.h
    M target-s390x/kvm.c
    M target-s390x/misc_helper.c

  Log Message:
  -----------
  Merge branch 's390-for-upstream' of git://repo.or.cz/qemu/agraf

* 's390-for-upstream' of git://repo.or.cz/qemu/agraf:
  s390: sclp ascii console support
  s390: sclp signal quiesce support
  s390: sclp event support
  s390: sclp base support
  s390: use sync regs for register transfer
  s390/kvm_stat: correct sys_perf_event_open syscall number
  s390x: fix -initrd in virtio machine


Compare: https://github.com/qemu/qemu/compare/d26a8caea3f1...38c4718392fd

----==_mimepart_508f1f92b7a92_a79174daf0110847--


</body></email><email><emailId>20121030213010</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-30 21:30:10-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 419336: m25p80: Support for Quad SPI</subject><body>



----==_mimepart_509046e23f756_f9be18ae830985
Date: Tue, 30 Oct 2012 14:30:10 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;509046e24201b_f9be18ae8310a4@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 419336a9f934d6a6c7098648bc833137a5db2015
      https://github.com/qemu/qemu/commit/419336a9f934d6a6c7098648bc833137a5db2015
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M hw/m25p80.c

  Log Message:
  -----------
  m25p80: Support for Quad SPI

Added the Quad mode read and write commands. Data remains serialized on a
single wire, i.e. the quad mode instructions just behave the same as single
mode, with the expection of modelling the varying number of dummy/mode bytes
between the address bytes and the first data word.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;


  Commit: f12411440b5d9e96af0720dd47b484c1440f4d62
      https://github.com/qemu/qemu/commit/f12411440b5d9e96af0720dd47b484c1440f4d62
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M hw/xilinx_spips.c

  Log Message:
  -----------
  xilinx_spips: Generalised to model QSPI

Extended the xilinx spips controller to model QSPI as well. Paremeterised the
operational difference with the normal spi controller (num_ss_bits, width of the
tx/rx fifo heads etc.). Multiple bus functionality is modelled (needed for QSPI
dual parallel mode. LQSPI is modelled.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;


  Commit: 7b482bcfa9ca1a65d8a5c154f385399e58fc5498
      https://github.com/qemu/qemu/commit/7b482bcfa9ca1a65d8a5c154f385399e58fc5498
  Author: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;
  Date:   2012-10-28 (Sun, 28 Oct 2012)

  Changed paths:
    M hw/xilinx_zynq.c

  Log Message:
  -----------
  xilinx_zynq: added QSPI controller

Added the QSPI controller to the Zynq. 4 SPI devices are attached to allow
modelling of the different geometries. E.G. Dual parallel and dual stacked
mode can both be tested with this one arrangement.

Signed-off-by: Peter Crosthwaite &lt;peter.crosthwaite@xilinx.com&gt;


  Commit: 742a40229d991d5a1a67baba59f6b1ee85dd41f0
      https://github.com/qemu/qemu/commit/742a40229d991d5a1a67baba59f6b1ee85dd41f0
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M hw/m25p80.c
    M hw/xilinx_spips.c
    M hw/xilinx_zynq.c

  Log Message:
  -----------
  Merge branch 'qspi.2' of git://developer.petalogix.com/public/qemu

* 'qspi.2' of git://developer.petalogix.com/public/qemu:
  xilinx_zynq: added QSPI controller
  xilinx_spips: Generalised to model QSPI
  m25p80: Support for Quad SPI


  Commit: e7d51b3450893dfcef4af4238c48baf2d4b0ed31
      https://github.com/qemu/qemu/commit/e7d51b3450893dfcef4af4238c48baf2d4b0ed31
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M target-sparc/translate.c

  Log Message:
  -----------
  target-sparc: Revert setting cpu_dst to gen_dest_gpr

There is some read-after-write error within the OP=2 insns which
prevents setting cpu_dst to the real output register.  Until this
is found and fixed, always write to a temporary first.

Cc: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Cc: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Tested-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: a1d29d6c1d4002a5c7b19eda61d794f4c22538dd
      https://github.com/qemu/qemu/commit/a1d29d6c1d4002a5c7b19eda61d794f4c22538dd
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: use -Wwombat to test whether gcc recognizes -Wno-wombat

gcc will silently accept unrecognized -Wno-wombat warning suppression
options (it only mentions them if it has to print a compiler warning
for some other reason). Since we already run a check for whether gcc
recognizes the warning options we use, we can easily make this use
the positive sense of the option when checking for support for the
suppression option. This doesn't have any effect except that it avoids
gcc emitting extra messages about unrecognized command line options
when it is printing other warning messages.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Igor Mitsyanko &lt;i.mitsyanko@samsung.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: f71d61216ea8eb914ee79459a58dc5343d95ddec
      https://github.com/qemu/qemu/commit/f71d61216ea8eb914ee79459a58dc5343d95ddec
  Author: Catalin Patulea &lt;catalinp@google.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M tests/tcg/test-mmap.c
    M tests/tcg/testthread.c

  Log Message:
  -----------
  tests/tcg: fix unused result warnings

With i386-linux-user target on x86_64 host, this does not introduce any new test
failures.

Signed-off-by: Catalin Patulea &lt;catalinp@google.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: aee0bf7d8d7564f8f2c40e4501695c492b7dd8d1
      https://github.com/qemu/qemu/commit/aee0bf7d8d7564f8f2c40e4501695c492b7dd8d1
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-10-30 (Tue, 30 Oct 2012)

  Changed paths:
    M net/tap-win32.c

  Log Message:
  -----------
  tap-win32: stubs to fix win32 build

Add missing stubs to win32 to fix link failure.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Reported-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/38c4718392fd...aee0bf7d8d75

----==_mimepart_509046e23f756_f9be18ae830985--


</body></email><email><emailId>20121031220017</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-10-31 22:00:17-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 235eb0: target-mips: Add ASE DSP internal functions</subject><body>



----==_mimepart_50919f717e625_16ebd8daec556f1
Date: Wed, 31 Oct 2012 15:00:17 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50919f7189782_16ebd8daec557c4@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 235eb0158cfb31bb8a7cad7296e2327d7f7349fc
      https://github.com/qemu/qemu/commit/235eb0158cfb31bb8a7cad7296e2327=
d7f7349fc
  Author: Jia Liu &lt;proljc@gmail.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/Makefile.objs
    A target-mips/dsp_helper.c

  Log Message:
  -----------
  target-mips: Add ASE DSP internal functions

Add internal functions using by MIPS ASE DSP instructions.

Signed-off-by: Jia Liu &lt;proljc@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 853c3240c0753735b82fe80a86123e09234f5448
      https://github.com/qemu/qemu/commit/853c3240c0753735b82fe80a86123e0=
9234f5448
  Author: Jia Liu &lt;proljc@gmail.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M linux-user/main.c
    M target-mips/cpu.h
    M target-mips/helper.c
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Add ASE DSP resources access check

Add MIPS ASE DSP resources access check.

Signed-off-by: Jia Liu &lt;proljc@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 4133498f8e532f9a32dae2153ef5e14433626e9f
      https://github.com/qemu/qemu/commit/4133498f8e532f9a32dae2153ef5e14=
433626e9f
  Author: Jia Liu &lt;proljc@gmail.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  Use correct acc value to index cpu_HI/cpu_LO rather than using a fix nu=
mber

Signed-off-by: Jia Liu &lt;proljc@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: e45a93e2590051e77a3d944a0feb3360a1ff1841
      https://github.com/qemu/qemu/commit/e45a93e2590051e77a3d944a0feb336=
0a1ff1841
  Author: Jia Liu &lt;proljc@gmail.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Add ASE DSP branch instructions

Add MIPS ASE DSP Branch instructions.

Signed-off-by: Jia Liu &lt;proljc@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 9b1a1d68d0411cf67502b2adb3daae2eb157b704
      https://github.com/qemu/qemu/commit/9b1a1d68d0411cf67502b2adb3daae2=
eb157b704
  Author: Jia Liu &lt;proljc@gmail.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Add ASE DSP load instructions

Add MIPS ASE DSP Load instructions.

Signed-off-by: Jia Liu &lt;proljc@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 461c08df75d8564a3ef8582bfcda398e9b09c0ff
      https://github.com/qemu/qemu/commit/461c08df75d8564a3ef8582bfcda398=
e9b09c0ff
  Author: Jia Liu &lt;proljc@gmail.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/dsp_helper.c
    M target-mips/helper.h
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Add ASE DSP arithmetic instructions

Add MIPS ASE DSP Arithmetic instructions.

Signed-off-by: Jia Liu &lt;proljc@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 77c5fa8b55adbd277dfa272752b4e99836ee4702
      https://github.com/qemu/qemu/commit/77c5fa8b55adbd277dfa272752b4e99=
836ee4702
  Author: Jia Liu &lt;proljc@gmail.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/dsp_helper.c
    M target-mips/helper.h
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Add ASE DSP GPR-based shift instructions

Add MIPS ASE DSP GPR-Based Shift instructions.

Signed-off-by: Jia Liu &lt;proljc@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: a22260ae380fa6abb546479cfc2962ba4c40382d
      https://github.com/qemu/qemu/commit/a22260ae380fa6abb546479cfc2962b=
a4c40382d
  Author: Jia Liu &lt;proljc@gmail.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/dsp_helper.c
    M target-mips/helper.h
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Add ASE DSP multiply instructions

Add MIPS ASE DSP Multiply instructions.

Signed-off-by: Jia Liu &lt;proljc@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 1cb6686cf926e0efc2056405a0a76dd41eb65d89
      https://github.com/qemu/qemu/commit/1cb6686cf926e0efc2056405a0a76dd=
41eb65d89
  Author: Jia Liu &lt;proljc@gmail.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/dsp_helper.c
    M target-mips/helper.h
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Add ASE DSP bit/manipulation instructions

Add MIPS ASE DSP Bit/Manipulation instructions.

Signed-off-by: Jia Liu &lt;proljc@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 266905602401e4aa849372bc50a71b2987157727
      https://github.com/qemu/qemu/commit/266905602401e4aa849372bc50a71b2=
987157727
  Author: Jia Liu &lt;proljc@gmail.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/dsp_helper.c
    M target-mips/helper.h
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Add ASE DSP compare-pick instructions

Add MIPS ASE DSP Compare-Pick instructions.

Signed-off-by: Jia Liu &lt;proljc@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: b53371ed5d4b6a678bf524d381f80746739b7fc0
      https://github.com/qemu/qemu/commit/b53371ed5d4b6a678bf524d381f8074=
6739b7fc0
  Author: Jia Liu &lt;proljc@gmail.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/dsp_helper.c
    M target-mips/helper.h
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Add ASE DSP accumulator instructions

Add MIPS ASE DSP Accumulator and DSPControl Access instructions.

Signed-off-by: Jia Liu &lt;proljc@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: af13ae03f8dbc02974d53b11b80b3ae4dd9f30b4
      https://github.com/qemu/qemu/commit/af13ae03f8dbc02974d53b11b80b3ae=
4dd9f30b4
  Author: Jia Liu &lt;proljc@gmail.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/translate_init.c

  Log Message:
  -----------
  target-mips: Add ASE DSP processors

Add 74kf and mips64dspr2-generic-cpu model for test.

Signed-off-by: Jia Liu &lt;proljc@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: d70080c4e37fc533fa10904b286f29449decc6f8
      https://github.com/qemu/qemu/commit/d70080c4e37fc533fa10904b286f294=
49decc6f8
  Author: Jia Liu &lt;proljc@gmail.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    A tests/tcg/mips/mips32-dsp/Makefile
    A tests/tcg/mips/mips32-dsp/absq_s_ph.c
    A tests/tcg/mips/mips32-dsp/absq_s_w.c
    A tests/tcg/mips/mips32-dsp/addq_ph.c
    A tests/tcg/mips/mips32-dsp/addq_s_ph.c
    A tests/tcg/mips/mips32-dsp/addq_s_w.c
    A tests/tcg/mips/mips32-dsp/addsc.c
    A tests/tcg/mips/mips32-dsp/addu_qb.c
    A tests/tcg/mips/mips32-dsp/addu_s_qb.c
    A tests/tcg/mips/mips32-dsp/addwc.c
    A tests/tcg/mips/mips32-dsp/bitrev.c
    A tests/tcg/mips/mips32-dsp/bposge32.c
    A tests/tcg/mips/mips32-dsp/cmp_eq_ph.c
    A tests/tcg/mips/mips32-dsp/cmp_le_ph.c
    A tests/tcg/mips/mips32-dsp/cmp_lt_ph.c
    A tests/tcg/mips/mips32-dsp/cmpgu_eq_qb.c
    A tests/tcg/mips/mips32-dsp/cmpgu_le_qb.c
    A tests/tcg/mips/mips32-dsp/cmpgu_lt_qb.c
    A tests/tcg/mips/mips32-dsp/cmpu_eq_qb.c
    A tests/tcg/mips/mips32-dsp/cmpu_le_qb.c
    A tests/tcg/mips/mips32-dsp/cmpu_lt_qb.c
    A tests/tcg/mips/mips32-dsp/dpaq_s_w_ph.c
    A tests/tcg/mips/mips32-dsp/dpaq_sa_l_w.c
    A tests/tcg/mips/mips32-dsp/dpau_h_qbl.c
    A tests/tcg/mips/mips32-dsp/dpau_h_qbr.c
    A tests/tcg/mips/mips32-dsp/dpsq_s_w_ph.c
    A tests/tcg/mips/mips32-dsp/dpsq_sa_l_w.c
    A tests/tcg/mips/mips32-dsp/dpsu_h_qbl.c
    A tests/tcg/mips/mips32-dsp/dpsu_h_qbr.c
    A tests/tcg/mips/mips32-dsp/extp.c
    A tests/tcg/mips/mips32-dsp/extpdp.c
    A tests/tcg/mips/mips32-dsp/extpdpv.c
    A tests/tcg/mips/mips32-dsp/extpv.c
    A tests/tcg/mips/mips32-dsp/extr_r_w.c
    A tests/tcg/mips/mips32-dsp/extr_rs_w.c
    A tests/tcg/mips/mips32-dsp/extr_s_h.c
    A tests/tcg/mips/mips32-dsp/extr_w.c
    A tests/tcg/mips/mips32-dsp/extrv_r_w.c
    A tests/tcg/mips/mips32-dsp/extrv_rs_w.c
    A tests/tcg/mips/mips32-dsp/extrv_s_h.c
    A tests/tcg/mips/mips32-dsp/extrv_w.c
    A tests/tcg/mips/mips32-dsp/insv.c
    A tests/tcg/mips/mips32-dsp/lbux.c
    A tests/tcg/mips/mips32-dsp/lhx.c
    A tests/tcg/mips/mips32-dsp/lwx.c
    A tests/tcg/mips/mips32-dsp/madd.c
    A tests/tcg/mips/mips32-dsp/maddu.c
    A tests/tcg/mips/mips32-dsp/main.c
    A tests/tcg/mips/mips32-dsp/maq_s_w_phl.c
    A tests/tcg/mips/mips32-dsp/maq_s_w_phr.c
    A tests/tcg/mips/mips32-dsp/maq_sa_w_phl.c
    A tests/tcg/mips/mips32-dsp/maq_sa_w_phr.c
    A tests/tcg/mips/mips32-dsp/mfhi.c
    A tests/tcg/mips/mips32-dsp/mflo.c
    A tests/tcg/mips/mips32-dsp/modsub.c
    A tests/tcg/mips/mips32-dsp/msub.c
    A tests/tcg/mips/mips32-dsp/msubu.c
    A tests/tcg/mips/mips32-dsp/mthi.c
    A tests/tcg/mips/mips32-dsp/mthlip.c
    A tests/tcg/mips/mips32-dsp/mtlo.c
    A tests/tcg/mips/mips32-dsp/muleq_s_w_phl.c
    A tests/tcg/mips/mips32-dsp/muleq_s_w_phr.c
    A tests/tcg/mips/mips32-dsp/muleu_s_ph_qbl.c
    A tests/tcg/mips/mips32-dsp/muleu_s_ph_qbr.c
    A tests/tcg/mips/mips32-dsp/mulq_rs_ph.c
    A tests/tcg/mips/mips32-dsp/mult.c
    A tests/tcg/mips/mips32-dsp/multu.c
    A tests/tcg/mips/mips32-dsp/packrl_ph.c
    A tests/tcg/mips/mips32-dsp/pick_ph.c
    A tests/tcg/mips/mips32-dsp/pick_qb.c
    A tests/tcg/mips/mips32-dsp/preceq_w_phl.c
    A tests/tcg/mips/mips32-dsp/preceq_w_phr.c
    A tests/tcg/mips/mips32-dsp/precequ_ph_qbl.c
    A tests/tcg/mips/mips32-dsp/precequ_ph_qbla.c
    A tests/tcg/mips/mips32-dsp/precequ_ph_qbr.c
    A tests/tcg/mips/mips32-dsp/precequ_ph_qbra.c
    A tests/tcg/mips/mips32-dsp/preceu_ph_qbl.c
    A tests/tcg/mips/mips32-dsp/preceu_ph_qbla.c
    A tests/tcg/mips/mips32-dsp/preceu_ph_qbr.c
    A tests/tcg/mips/mips32-dsp/preceu_ph_qbra.c
    A tests/tcg/mips/mips32-dsp/precrq_ph_w.c
    A tests/tcg/mips/mips32-dsp/precrq_qb_ph.c
    A tests/tcg/mips/mips32-dsp/precrq_rs_ph_w.c
    A tests/tcg/mips/mips32-dsp/precrqu_s_qb_ph.c
    A tests/tcg/mips/mips32-dsp/raddu_w_qb.c
    A tests/tcg/mips/mips32-dsp/rddsp.c
    A tests/tcg/mips/mips32-dsp/repl_ph.c
    A tests/tcg/mips/mips32-dsp/repl_qb.c
    A tests/tcg/mips/mips32-dsp/replv_ph.c
    A tests/tcg/mips/mips32-dsp/replv_qb.c
    A tests/tcg/mips/mips32-dsp/shilo.c
    A tests/tcg/mips/mips32-dsp/shilov.c
    A tests/tcg/mips/mips32-dsp/shll_ph.c
    A tests/tcg/mips/mips32-dsp/shll_qb.c
    A tests/tcg/mips/mips32-dsp/shll_s_ph.c
    A tests/tcg/mips/mips32-dsp/shll_s_w.c
    A tests/tcg/mips/mips32-dsp/shllv_ph.c
    A tests/tcg/mips/mips32-dsp/shllv_qb.c
    A tests/tcg/mips/mips32-dsp/shllv_s_ph.c
    A tests/tcg/mips/mips32-dsp/shllv_s_w.c
    A tests/tcg/mips/mips32-dsp/shra_ph.c
    A tests/tcg/mips/mips32-dsp/shra_r_ph.c
    A tests/tcg/mips/mips32-dsp/shra_r_w.c
    A tests/tcg/mips/mips32-dsp/shrav_ph.c
    A tests/tcg/mips/mips32-dsp/shrav_r_ph.c
    A tests/tcg/mips/mips32-dsp/shrav_r_w.c
    A tests/tcg/mips/mips32-dsp/shrl_qb.c
    A tests/tcg/mips/mips32-dsp/shrlv_qb.c
    A tests/tcg/mips/mips32-dsp/subq_ph.c
    A tests/tcg/mips/mips32-dsp/subq_s_ph.c
    A tests/tcg/mips/mips32-dsp/subq_s_w.c
    A tests/tcg/mips/mips32-dsp/subu_qb.c
    A tests/tcg/mips/mips32-dsp/subu_s_qb.c
    A tests/tcg/mips/mips32-dsp/wrdsp.c
    A tests/tcg/mips/mips32-dspr2/Makefile
    A tests/tcg/mips/mips32-dspr2/absq_s_qb.c
    A tests/tcg/mips/mips32-dspr2/addqh_ph.c
    A tests/tcg/mips/mips32-dspr2/addqh_r_ph.c
    A tests/tcg/mips/mips32-dspr2/addqh_r_w.c
    A tests/tcg/mips/mips32-dspr2/addqh_w.c
    A tests/tcg/mips/mips32-dspr2/addu_ph.c
    A tests/tcg/mips/mips32-dspr2/addu_s_ph.c
    A tests/tcg/mips/mips32-dspr2/adduh_qb.c
    A tests/tcg/mips/mips32-dspr2/adduh_r_qb.c
    A tests/tcg/mips/mips32-dspr2/append.c
    A tests/tcg/mips/mips32-dspr2/balign.c
    A tests/tcg/mips/mips32-dspr2/cmpgdu_eq_qb.c
    A tests/tcg/mips/mips32-dspr2/cmpgdu_le_qb.c
    A tests/tcg/mips/mips32-dspr2/cmpgdu_lt_qb.c
    A tests/tcg/mips/mips32-dspr2/dpa_w_ph.c
    A tests/tcg/mips/mips32-dspr2/dpaqx_s_w_ph.c
    A tests/tcg/mips/mips32-dspr2/dpaqx_sa_w_ph.c
    A tests/tcg/mips/mips32-dspr2/dpax_w_ph.c
    A tests/tcg/mips/mips32-dspr2/dps_w_ph.c
    A tests/tcg/mips/mips32-dspr2/dpsqx_s_w_ph.c
    A tests/tcg/mips/mips32-dspr2/dpsqx_sa_w_ph.c
    A tests/tcg/mips/mips32-dspr2/dpsx_w_ph.c
    A tests/tcg/mips/mips32-dspr2/mul_ph.c
    A tests/tcg/mips/mips32-dspr2/mul_s_ph.c
    A tests/tcg/mips/mips32-dspr2/mulq_rs_w.c
    A tests/tcg/mips/mips32-dspr2/mulq_s_ph.c
    A tests/tcg/mips/mips32-dspr2/mulq_s_w.c
    A tests/tcg/mips/mips32-dspr2/mulsa_w_ph.c
    A tests/tcg/mips/mips32-dspr2/mulsaq_s_w_ph.c
    A tests/tcg/mips/mips32-dspr2/precr_qb_ph.c
    A tests/tcg/mips/mips32-dspr2/precr_sra_ph_w.c
    A tests/tcg/mips/mips32-dspr2/precr_sra_r_ph_w.c
    A tests/tcg/mips/mips32-dspr2/prepend.c
    A tests/tcg/mips/mips32-dspr2/shra_qb.c
    A tests/tcg/mips/mips32-dspr2/shra_r_qb.c
    A tests/tcg/mips/mips32-dspr2/shrav_qb.c
    A tests/tcg/mips/mips32-dspr2/shrav_r_qb.c
    A tests/tcg/mips/mips32-dspr2/shrl_ph.c
    A tests/tcg/mips/mips32-dspr2/shrlv_ph.c
    A tests/tcg/mips/mips32-dspr2/subqh_ph.c
    A tests/tcg/mips/mips32-dspr2/subqh_r_ph.c
    A tests/tcg/mips/mips32-dspr2/subqh_r_w.c
    A tests/tcg/mips/mips32-dspr2/subqh_w.c
    A tests/tcg/mips/mips32-dspr2/subu_ph.c
    A tests/tcg/mips/mips32-dspr2/subu_s_ph.c
    A tests/tcg/mips/mips32-dspr2/subuh_qb.c
    A tests/tcg/mips/mips32-dspr2/subuh_r_qb.c
    A tests/tcg/mips/mips64-dsp/Makefile
    A tests/tcg/mips/mips64-dsp/absq_s_ob.c
    A tests/tcg/mips/mips64-dsp/absq_s_ph.c
    A tests/tcg/mips/mips64-dsp/absq_s_pw.c
    A tests/tcg/mips/mips64-dsp/absq_s_qh.c
    A tests/tcg/mips/mips64-dsp/absq_s_w.c
    A tests/tcg/mips/mips64-dsp/addq_ph.c
    A tests/tcg/mips/mips64-dsp/addq_pw.c
    A tests/tcg/mips/mips64-dsp/addq_qh.c
    A tests/tcg/mips/mips64-dsp/addq_s_ph.c
    A tests/tcg/mips/mips64-dsp/addq_s_pw.c
    A tests/tcg/mips/mips64-dsp/addq_s_qh.c
    A tests/tcg/mips/mips64-dsp/addq_s_w.c
    A tests/tcg/mips/mips64-dsp/addsc.c
    A tests/tcg/mips/mips64-dsp/addu_ob.c
    A tests/tcg/mips/mips64-dsp/addu_qb.c
    A tests/tcg/mips/mips64-dsp/addu_s_ob.c
    A tests/tcg/mips/mips64-dsp/addu_s_qb.c
    A tests/tcg/mips/mips64-dsp/addwc.c
    A tests/tcg/mips/mips64-dsp/bitrev.c
    A tests/tcg/mips/mips64-dsp/bposge32.c
    A tests/tcg/mips/mips64-dsp/bposge64.c
    A tests/tcg/mips/mips64-dsp/cmp_eq_ph.c
    A tests/tcg/mips/mips64-dsp/cmp_eq_pw.c
    A tests/tcg/mips/mips64-dsp/cmp_eq_qh.c
    A tests/tcg/mips/mips64-dsp/cmp_le_ph.c
    A tests/tcg/mips/mips64-dsp/cmp_le_pw.c
    A tests/tcg/mips/mips64-dsp/cmp_le_qh.c
    A tests/tcg/mips/mips64-dsp/cmp_lt_ph.c
    A tests/tcg/mips/mips64-dsp/cmp_lt_pw.c
    A tests/tcg/mips/mips64-dsp/cmp_lt_qh.c
    A tests/tcg/mips/mips64-dsp/cmpgu_eq_ob.c
    A tests/tcg/mips/mips64-dsp/cmpgu_eq_qb.c
    A tests/tcg/mips/mips64-dsp/cmpgu_le_ob.c
    A tests/tcg/mips/mips64-dsp/cmpgu_le_qb.c
    A tests/tcg/mips/mips64-dsp/cmpgu_lt_ob.c
    A tests/tcg/mips/mips64-dsp/cmpgu_lt_qb.c
    A tests/tcg/mips/mips64-dsp/cmpu_eq_ob.c
    A tests/tcg/mips/mips64-dsp/cmpu_eq_qb.c
    A tests/tcg/mips/mips64-dsp/cmpu_le_ob.c
    A tests/tcg/mips/mips64-dsp/cmpu_le_qb.c
    A tests/tcg/mips/mips64-dsp/cmpu_lt_ob.c
    A tests/tcg/mips/mips64-dsp/cmpu_lt_qb.c
    A tests/tcg/mips/mips64-dsp/dappend.c
    A tests/tcg/mips/mips64-dsp/dextp.c
    A tests/tcg/mips/mips64-dsp/dextpdp.c
    A tests/tcg/mips/mips64-dsp/dextpdpv.c
    A tests/tcg/mips/mips64-dsp/dextpv.c
    A tests/tcg/mips/mips64-dsp/dextr_l.c
    A tests/tcg/mips/mips64-dsp/dextr_r_l.c
    A tests/tcg/mips/mips64-dsp/dextr_r_w.c
    A tests/tcg/mips/mips64-dsp/dextr_rs_l.c
    A tests/tcg/mips/mips64-dsp/dextr_rs_w.c
    A tests/tcg/mips/mips64-dsp/dextr_s_h.c
    A tests/tcg/mips/mips64-dsp/dextr_w.c
    A tests/tcg/mips/mips64-dsp/dextrv_l.c
    A tests/tcg/mips/mips64-dsp/dextrv_r_l.c
    A tests/tcg/mips/mips64-dsp/dextrv_r_w.c
    A tests/tcg/mips/mips64-dsp/dextrv_rs_l.c
    A tests/tcg/mips/mips64-dsp/dextrv_rs_w.c
    A tests/tcg/mips/mips64-dsp/dextrv_s_h.c
    A tests/tcg/mips/mips64-dsp/dextrv_w.c
    A tests/tcg/mips/mips64-dsp/dinsv.c
    A tests/tcg/mips/mips64-dsp/dmadd.c
    A tests/tcg/mips/mips64-dsp/dmaddu.c
    A tests/tcg/mips/mips64-dsp/dmsub.c
    A tests/tcg/mips/mips64-dsp/dmsubu.c
    A tests/tcg/mips/mips64-dsp/dmthlip.c
    A tests/tcg/mips/mips64-dsp/dpaq_s_w_ph.c
    A tests/tcg/mips/mips64-dsp/dpaq_s_w_qh.c
    A tests/tcg/mips/mips64-dsp/dpaq_sa_l_pw.c
    A tests/tcg/mips/mips64-dsp/dpaq_sa_l_w.c
    A tests/tcg/mips/mips64-dsp/dpau_h_obl.c
    A tests/tcg/mips/mips64-dsp/dpau_h_obr.c
    A tests/tcg/mips/mips64-dsp/dpau_h_qbl.c
    A tests/tcg/mips/mips64-dsp/dpau_h_qbr.c
    A tests/tcg/mips/mips64-dsp/dpsq_s_w_ph.c
    A tests/tcg/mips/mips64-dsp/dpsq_s_w_qh.c
    A tests/tcg/mips/mips64-dsp/dpsq_sa_l_pw.c
    A tests/tcg/mips/mips64-dsp/dpsq_sa_l_w.c
    A tests/tcg/mips/mips64-dsp/dpsu_h_obl.c
    A tests/tcg/mips/mips64-dsp/dpsu_h_obr.c
    A tests/tcg/mips/mips64-dsp/dpsu_h_qbl.c
    A tests/tcg/mips/mips64-dsp/dpsu_h_qbr.c
    A tests/tcg/mips/mips64-dsp/dshilo.c
    A tests/tcg/mips/mips64-dsp/dshilov.c
    A tests/tcg/mips/mips64-dsp/extp.c
    A tests/tcg/mips/mips64-dsp/extpdp.c
    A tests/tcg/mips/mips64-dsp/extpdpv.c
    A tests/tcg/mips/mips64-dsp/extpv.c
    A tests/tcg/mips/mips64-dsp/extr_r_w.c
    A tests/tcg/mips/mips64-dsp/extr_rs_w.c
    A tests/tcg/mips/mips64-dsp/extr_s_h.c
    A tests/tcg/mips/mips64-dsp/extr_w.c
    A tests/tcg/mips/mips64-dsp/extrv_r_w.c
    A tests/tcg/mips/mips64-dsp/extrv_rs_w.c
    A tests/tcg/mips/mips64-dsp/extrv_s_h.c
    A tests/tcg/mips/mips64-dsp/extrv_w.c
    A tests/tcg/mips/mips64-dsp/head.S
    A tests/tcg/mips/mips64-dsp/insv.c
    A tests/tcg/mips/mips64-dsp/io.h
    A tests/tcg/mips/mips64-dsp/lbux.c
    A tests/tcg/mips/mips64-dsp/ldx.c
    A tests/tcg/mips/mips64-dsp/lhx.c
    A tests/tcg/mips/mips64-dsp/lwx.c
    A tests/tcg/mips/mips64-dsp/madd.c
    A tests/tcg/mips/mips64-dsp/maddu.c
    A tests/tcg/mips/mips64-dsp/maq_s_l_pwl.c
    A tests/tcg/mips/mips64-dsp/maq_s_l_pwr.c
    A tests/tcg/mips/mips64-dsp/maq_s_w_phl.c
    A tests/tcg/mips/mips64-dsp/maq_s_w_phr.c
    A tests/tcg/mips/mips64-dsp/maq_s_w_qhll.c
    A tests/tcg/mips/mips64-dsp/maq_s_w_qhlr.c
    A tests/tcg/mips/mips64-dsp/maq_s_w_qhrl.c
    A tests/tcg/mips/mips64-dsp/maq_s_w_qhrr.c
    A tests/tcg/mips/mips64-dsp/maq_sa_w_phl.c
    A tests/tcg/mips/mips64-dsp/maq_sa_w_phr.c
    A tests/tcg/mips/mips64-dsp/maq_sa_w_qhll.c
    A tests/tcg/mips/mips64-dsp/maq_sa_w_qhlr.c
    A tests/tcg/mips/mips64-dsp/maq_sa_w_qhrl.c
    A tests/tcg/mips/mips64-dsp/maq_sa_w_qhrr.c
    A tests/tcg/mips/mips64-dsp/mfhi.c
    A tests/tcg/mips/mips64-dsp/mflo.c
    A tests/tcg/mips/mips64-dsp/mips_boot.lds
    A tests/tcg/mips/mips64-dsp/modsub.c
    A tests/tcg/mips/mips64-dsp/msub.c
    A tests/tcg/mips/mips64-dsp/msubu.c
    A tests/tcg/mips/mips64-dsp/mthi.c
    A tests/tcg/mips/mips64-dsp/mthlip.c
    A tests/tcg/mips/mips64-dsp/mtlo.c
    A tests/tcg/mips/mips64-dsp/muleq_s_pw_qhl.c
    A tests/tcg/mips/mips64-dsp/muleq_s_pw_qhr.c
    A tests/tcg/mips/mips64-dsp/muleq_s_w_phl.c
    A tests/tcg/mips/mips64-dsp/muleq_s_w_phr.c
    A tests/tcg/mips/mips64-dsp/muleu_s_ph_qbl.c
    A tests/tcg/mips/mips64-dsp/muleu_s_ph_qbr.c
    A tests/tcg/mips/mips64-dsp/muleu_s_qh_obl.c
    A tests/tcg/mips/mips64-dsp/muleu_s_qh_obr.c
    A tests/tcg/mips/mips64-dsp/mulq_rs_ph.c
    A tests/tcg/mips/mips64-dsp/mulq_rs_qh.c
    A tests/tcg/mips/mips64-dsp/mulsaq_s_l_pw.c
    A tests/tcg/mips/mips64-dsp/mulsaq_s_w_qh.c
    A tests/tcg/mips/mips64-dsp/mult.c
    A tests/tcg/mips/mips64-dsp/multu.c
    A tests/tcg/mips/mips64-dsp/packrl_ph.c
    A tests/tcg/mips/mips64-dsp/packrl_pw.c
    A tests/tcg/mips/mips64-dsp/pick_ob.c
    A tests/tcg/mips/mips64-dsp/pick_ph.c
    A tests/tcg/mips/mips64-dsp/pick_pw.c
    A tests/tcg/mips/mips64-dsp/pick_qb.c
    A tests/tcg/mips/mips64-dsp/pick_qh.c
    A tests/tcg/mips/mips64-dsp/preceq_l_pwl.c
    A tests/tcg/mips/mips64-dsp/preceq_l_pwr.c
    A tests/tcg/mips/mips64-dsp/preceq_pw_qhl.c
    A tests/tcg/mips/mips64-dsp/preceq_pw_qhla.c
    A tests/tcg/mips/mips64-dsp/preceq_pw_qhr.c
    A tests/tcg/mips/mips64-dsp/preceq_pw_qhra.c
    A tests/tcg/mips/mips64-dsp/preceq_w_phl.c
    A tests/tcg/mips/mips64-dsp/preceq_w_phr.c
    A tests/tcg/mips/mips64-dsp/precequ_ph_qbl.c
    A tests/tcg/mips/mips64-dsp/precequ_ph_qbla.c
    A tests/tcg/mips/mips64-dsp/precequ_ph_qbr.c
    A tests/tcg/mips/mips64-dsp/precequ_ph_qbra.c
    A tests/tcg/mips/mips64-dsp/precequ_qh_obl.c
    A tests/tcg/mips/mips64-dsp/precequ_qh_obla.c
    A tests/tcg/mips/mips64-dsp/precequ_qh_obr.c
    A tests/tcg/mips/mips64-dsp/precequ_qh_obra.c
    A tests/tcg/mips/mips64-dsp/preceu_ph_qbl.c
    A tests/tcg/mips/mips64-dsp/preceu_ph_qbla.c
    A tests/tcg/mips/mips64-dsp/preceu_ph_qbr.c
    A tests/tcg/mips/mips64-dsp/preceu_ph_qbra.c
    A tests/tcg/mips/mips64-dsp/preceu_qh_obl.c
    A tests/tcg/mips/mips64-dsp/preceu_qh_obla.c
    A tests/tcg/mips/mips64-dsp/preceu_qh_obr.c
    A tests/tcg/mips/mips64-dsp/preceu_qh_obra.c
    A tests/tcg/mips/mips64-dsp/precr_ob_qh.c
    A tests/tcg/mips/mips64-dsp/precr_sra_qh_pw.c
    A tests/tcg/mips/mips64-dsp/precr_sra_r_qh_pw.c
    A tests/tcg/mips/mips64-dsp/precrq_ob_qh.c
    A tests/tcg/mips/mips64-dsp/precrq_ph_w.c
    A tests/tcg/mips/mips64-dsp/precrq_pw_l.c
    A tests/tcg/mips/mips64-dsp/precrq_qb_ph.c
    A tests/tcg/mips/mips64-dsp/precrq_qh_pw.c
    A tests/tcg/mips/mips64-dsp/precrq_rs_ph_w.c
    A tests/tcg/mips/mips64-dsp/precrq_rs_qh_pw.c
    A tests/tcg/mips/mips64-dsp/precrqu_s_ob_qh.c
    A tests/tcg/mips/mips64-dsp/precrqu_s_qb_ph.c
    A tests/tcg/mips/mips64-dsp/prependd.c
    A tests/tcg/mips/mips64-dsp/prependw.c
    A tests/tcg/mips/mips64-dsp/printf.c
    A tests/tcg/mips/mips64-dsp/raddu_l_ob.c
    A tests/tcg/mips/mips64-dsp/raddu_w_qb.c
    A tests/tcg/mips/mips64-dsp/rddsp.c
    A tests/tcg/mips/mips64-dsp/repl_ob.c
    A tests/tcg/mips/mips64-dsp/repl_ph.c
    A tests/tcg/mips/mips64-dsp/repl_pw.c
    A tests/tcg/mips/mips64-dsp/repl_qb.c
    A tests/tcg/mips/mips64-dsp/repl_qh.c
    A tests/tcg/mips/mips64-dsp/replv_ob.c
    A tests/tcg/mips/mips64-dsp/replv_ph.c
    A tests/tcg/mips/mips64-dsp/replv_pw.c
    A tests/tcg/mips/mips64-dsp/replv_qb.c
    A tests/tcg/mips/mips64-dsp/shilo.c
    A tests/tcg/mips/mips64-dsp/shilov.c
    A tests/tcg/mips/mips64-dsp/shll_ob.c
    A tests/tcg/mips/mips64-dsp/shll_ph.c
    A tests/tcg/mips/mips64-dsp/shll_pw.c
    A tests/tcg/mips/mips64-dsp/shll_qb.c
    A tests/tcg/mips/mips64-dsp/shll_qh.c
    A tests/tcg/mips/mips64-dsp/shll_s_ph.c
    A tests/tcg/mips/mips64-dsp/shll_s_pw.c
    A tests/tcg/mips/mips64-dsp/shll_s_qh.c
    A tests/tcg/mips/mips64-dsp/shll_s_w.c
    A tests/tcg/mips/mips64-dsp/shllv_ob.c
    A tests/tcg/mips/mips64-dsp/shllv_ph.c
    A tests/tcg/mips/mips64-dsp/shllv_pw.c
    A tests/tcg/mips/mips64-dsp/shllv_qb.c
    A tests/tcg/mips/mips64-dsp/shllv_qh.c
    A tests/tcg/mips/mips64-dsp/shllv_s_ph.c
    A tests/tcg/mips/mips64-dsp/shllv_s_pw.c
    A tests/tcg/mips/mips64-dsp/shllv_s_qh.c
    A tests/tcg/mips/mips64-dsp/shllv_s_w.c
    A tests/tcg/mips/mips64-dsp/shra_ob.c
    A tests/tcg/mips/mips64-dsp/shra_ph.c
    A tests/tcg/mips/mips64-dsp/shra_pw.c
    A tests/tcg/mips/mips64-dsp/shra_qh.c
    A tests/tcg/mips/mips64-dsp/shra_r_ob.c
    A tests/tcg/mips/mips64-dsp/shra_r_ph.c
    A tests/tcg/mips/mips64-dsp/shra_r_pw.c
    A tests/tcg/mips/mips64-dsp/shra_r_qh.c
    A tests/tcg/mips/mips64-dsp/shra_r_w.c
    A tests/tcg/mips/mips64-dsp/shrav_ph.c
    A tests/tcg/mips/mips64-dsp/shrav_pw.c
    A tests/tcg/mips/mips64-dsp/shrav_qh.c
    A tests/tcg/mips/mips64-dsp/shrav_r_ph.c
    A tests/tcg/mips/mips64-dsp/shrav_r_pw.c
    A tests/tcg/mips/mips64-dsp/shrav_r_qh.c
    A tests/tcg/mips/mips64-dsp/shrav_r_w.c
    A tests/tcg/mips/mips64-dsp/shrl_ob.c
    A tests/tcg/mips/mips64-dsp/shrl_qb.c
    A tests/tcg/mips/mips64-dsp/shrl_qh.c
    A tests/tcg/mips/mips64-dsp/shrlv_ob.c
    A tests/tcg/mips/mips64-dsp/shrlv_qb.c
    A tests/tcg/mips/mips64-dsp/shrlv_qh.c
    A tests/tcg/mips/mips64-dsp/subq_ph.c
    A tests/tcg/mips/mips64-dsp/subq_pw.c
    A tests/tcg/mips/mips64-dsp/subq_qh.c
    A tests/tcg/mips/mips64-dsp/subq_s_ph.c
    A tests/tcg/mips/mips64-dsp/subq_s_pw.c
    A tests/tcg/mips/mips64-dsp/subq_s_qh.c
    A tests/tcg/mips/mips64-dsp/subq_s_w.c
    A tests/tcg/mips/mips64-dsp/subu_ob.c
    A tests/tcg/mips/mips64-dsp/subu_qb.c
    A tests/tcg/mips/mips64-dsp/subu_s_ob.c
    A tests/tcg/mips/mips64-dsp/subu_s_qb.c
    A tests/tcg/mips/mips64-dsp/wrdsp.c
    A tests/tcg/mips/mips64-dspr2/.directory
    A tests/tcg/mips/mips64-dspr2/Makefile
    A tests/tcg/mips/mips64-dspr2/absq_s_qb.c
    A tests/tcg/mips/mips64-dspr2/addqh_ph.c
    A tests/tcg/mips/mips64-dspr2/addqh_r_ph.c
    A tests/tcg/mips/mips64-dspr2/addqh_r_w.c
    A tests/tcg/mips/mips64-dspr2/addqh_w.c
    A tests/tcg/mips/mips64-dspr2/addu_ph.c
    A tests/tcg/mips/mips64-dspr2/addu_qh.c
    A tests/tcg/mips/mips64-dspr2/addu_s_ph.c
    A tests/tcg/mips/mips64-dspr2/addu_s_qh.c
    A tests/tcg/mips/mips64-dspr2/adduh_ob.c
    A tests/tcg/mips/mips64-dspr2/adduh_qb.c
    A tests/tcg/mips/mips64-dspr2/adduh_r_ob.c
    A tests/tcg/mips/mips64-dspr2/adduh_r_qb.c
    A tests/tcg/mips/mips64-dspr2/append.c
    A tests/tcg/mips/mips64-dspr2/balign.c
    A tests/tcg/mips/mips64-dspr2/cmpgdu_eq_ob.c
    A tests/tcg/mips/mips64-dspr2/cmpgdu_eq_qb.c
    A tests/tcg/mips/mips64-dspr2/cmpgdu_le_ob.c
    A tests/tcg/mips/mips64-dspr2/cmpgdu_le_qb.c
    A tests/tcg/mips/mips64-dspr2/cmpgdu_lt_ob.c
    A tests/tcg/mips/mips64-dspr2/cmpgdu_lt_qb.c
    A tests/tcg/mips/mips64-dspr2/dbalign.c
    A tests/tcg/mips/mips64-dspr2/dpa_w_ph.c
    A tests/tcg/mips/mips64-dspr2/dpa_w_qh.c
    A tests/tcg/mips/mips64-dspr2/dpaqx_s_w_ph.c
    A tests/tcg/mips/mips64-dspr2/dpaqx_sa_w_ph.c
    A tests/tcg/mips/mips64-dspr2/dpax_w_ph.c
    A tests/tcg/mips/mips64-dspr2/dps_w_ph.c
    A tests/tcg/mips/mips64-dspr2/dps_w_qh.c
    A tests/tcg/mips/mips64-dspr2/dpsqx_s_w_ph.c
    A tests/tcg/mips/mips64-dspr2/dpsqx_sa_w_ph.c
    A tests/tcg/mips/mips64-dspr2/dpsx_w_ph.c
    A tests/tcg/mips/mips64-dspr2/head.S
    A tests/tcg/mips/mips64-dspr2/io.h
    A tests/tcg/mips/mips64-dspr2/mips_boot.lds
    A tests/tcg/mips/mips64-dspr2/mul_ph.c
    A tests/tcg/mips/mips64-dspr2/mul_s_ph.c
    A tests/tcg/mips/mips64-dspr2/mulq_rs_w.c
    A tests/tcg/mips/mips64-dspr2/mulq_s_ph.c
    A tests/tcg/mips/mips64-dspr2/mulq_s_w.c
    A tests/tcg/mips/mips64-dspr2/mulsa_w_ph.c
    A tests/tcg/mips/mips64-dspr2/mulsaq_s_w_ph.c
    A tests/tcg/mips/mips64-dspr2/precr_qb_ph.c
    A tests/tcg/mips/mips64-dspr2/precr_sra_ph_w.c
    A tests/tcg/mips/mips64-dspr2/precr_sra_r_ph_w.c
    A tests/tcg/mips/mips64-dspr2/prepend.c
    A tests/tcg/mips/mips64-dspr2/printf.c
    A tests/tcg/mips/mips64-dspr2/shra_qb.c
    A tests/tcg/mips/mips64-dspr2/shra_r_qb.c
    A tests/tcg/mips/mips64-dspr2/shrav_ob.c
    A tests/tcg/mips/mips64-dspr2/shrav_qb.c
    A tests/tcg/mips/mips64-dspr2/shrav_r_ob.c
    A tests/tcg/mips/mips64-dspr2/shrav_r_qb.c
    A tests/tcg/mips/mips64-dspr2/shrl_ph.c
    A tests/tcg/mips/mips64-dspr2/shrlv_ph.c
    A tests/tcg/mips/mips64-dspr2/subqh_ph.c
    A tests/tcg/mips/mips64-dspr2/subqh_r_ph.c
    A tests/tcg/mips/mips64-dspr2/subqh_r_w.c
    A tests/tcg/mips/mips64-dspr2/subqh_w.c
    A tests/tcg/mips/mips64-dspr2/subu_ph.c
    A tests/tcg/mips/mips64-dspr2/subu_qh.c
    A tests/tcg/mips/mips64-dspr2/subu_s_ph.c
    A tests/tcg/mips/mips64-dspr2/subu_s_qh.c
    A tests/tcg/mips/mips64-dspr2/subuh_ob.c
    A tests/tcg/mips/mips64-dspr2/subuh_qb.c
    A tests/tcg/mips/mips64-dspr2/subuh_r_ob.c
    A tests/tcg/mips/mips64-dspr2/subuh_r_qb.c

  Log Message:
  -----------
  target-mips: Add ASE DSP testcases

Add MIPS ASE DSP testcases.

Signed-off-by: Jia Liu &lt;proljc@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: b30706dda79894c01768df23cde526061d609258
      https://github.com/qemu/qemu/commit/b30706dda79894c01768df23cde5260=
61d609258
  Author: Jia Liu &lt;proljc@gmail.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/TODO

  Log Message:
  -----------
  target-mips: Change TODO file

Change DSP r1 &amp; DSP r2 into microMIPS DSP encodings in TODO file.

Signed-off-by: Jia Liu &lt;proljc@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 40e3acc18f1c663ee8f0c981525316f864f7b8ea
      https://github.com/qemu/qemu/commit/40e3acc18f1c663ee8f0c981525316f=
864f7b8ea
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: remove #if defined(TARGET_MIPS64) in opcode enums

All switch() decoding instruction have a default entry, so it is possible=

to have unused enum entries. Remove conditional definitions of MIPS64
opcode enums, as it only makes the code less readable.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: ac4119c023c72b15f54238af43e4a178fcf41494
      https://github.com/qemu/qemu/commit/ac4119c023c72b15f54238af43e4a17=
8fcf41494
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M qemu-char.c
    M qemu-char.h
    M vl.c

  Log Message:
  -----------
  chardev: Use timer instead of bottom-half to postpone open event

As the block layer may decide to flush bottom-halfs while the machine is
still initializing (e.g. to read geometry data from the disk), our
postponed open event may be processed before the last frontend
registered with a muxed chardev.

Until the semantics of BHs have been clarified, use an expired timer to
achieve the same effect (suggested by Paolo Bonzini). This requires to
perform the alarm timer initialization earlier as otherwise timer
subsystem can be used before being ready.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;


  Commit: e1e1b25c97632cf68d6a11e20f8068282e3d7915
      https://github.com/qemu/qemu/commit/e1e1b25c97632cf68d6a11e20f80682=
82e3d7915
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-alpha/helper.h

  Log Message:
  -----------
  target-alpha: Use TCG_CALL_NO_WG

Mark helper functions that raise exceptions, but otherwise do not
change TCG register state, with TCG_CALL_NO_WG.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;


  Commit: b3a1be87bac3a6aaa59bb88c1410f170dc9b22d5
      https://github.com/qemu/qemu/commit/b3a1be87bac3a6aaa59bb88c1410f17=
0dc9b22d5
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M tcg/tcg.c

  Log Message:
  -----------
  tcg: don't remove op if output needs to be synced to memory

Commit 9c43b68de628a1e2cba556adfb71c17028eb802e do not correctly check
for dead outputs when they need to be synced to memory in case of
half-dead operations.

Fix that by applying the same pattern than for the default case.

Tested-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 4636401d99c113c67229ceabe93666767a619a25
      https://github.com/qemu/qemu/commit/4636401d99c113c67229ceabe936667=
67a619a25
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: correctly restore btarget upon exception

When the CPU state is restored through retranslation after an exception,
btarget should also be restored.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 1e0e239a89b5a5ffe475a8efce5e59383a88af44
      https://github.com/qemu/qemu/commit/1e0e239a89b5a5ffe475a8efce5e593=
83a88af44
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: do not save CPU state when using retranslation

When the CPU state after a possible retranslation is going to be handled
through code retranslation, we don't need to save the CPU state before.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: bbc1dedef6530917e34a94a2641932e636f9b02d
      https://github.com/qemu/qemu/commit/bbc1dedef6530917e34a94a2641932e=
636f9b02d
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M fpu/softfloat-specialize.h

  Log Message:
  -----------
  softfloat: implement fused multiply-add NaN propagation for MIPS

Add a pickNaNMulAdd function for MIPS, implementing NaN propagation
rules for MIPS fused multiply-add instructions.

Cc: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: b3d6cd447d594217cbfd09a3ffdf7b7893a1aa92
      https://github.com/qemu/qemu/commit/b3d6cd447d594217cbfd09a3ffdf7b7=
893a1aa92
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/helper.h
    M target-mips/op_helper.c
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: use the softfloat floatXX_muladd functions

Use the new softfloat floatXX_muladd() functions to implement the madd,
msub, nmadd and nmsub instructions. At the same time replace the name of
the helpers by the name of the instruction, as the only reason for the
previous names was to keep the macros simple.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 4a587b2ccb336e36817712ab21c513e35baa0eca
      https://github.com/qemu/qemu/commit/4a587b2ccb336e36817712ab21c513e=
35baa0eca
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/op_helper.c

  Log Message:
  -----------
  target-mips: keep softfloat exception set to 0 between instructions

Instead of clearing the softfloat exception flags before each floating
point instruction, reset them to 0 in update_fcr31() when an exception
is detected.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 5dbe90bba778c6ffcd0c7991ec67c4e7469e1c09
      https://github.com/qemu/qemu/commit/5dbe90bba778c6ffcd0c7991ec67c4e=
7469e1c09
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/op_helper.c

  Log Message:
  -----------
  target-mips: fix FPU exceptions

For each FPU instruction that can trigger an FPU exception, to call
call update_fcr31() after.

Remove the manual NaN assignment in case of float to float operation, as
softfloat is already taking care of that. However for float to int
operation, the value has to be changed to the MIPS one. In the cvtpw_ps
case, the two registers have to be handled separately to guarantee
a correct final value in both registers.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 4cc2e5f989728424e913777c494d68dbf0d2ec09
      https://github.com/qemu/qemu/commit/4cc2e5f989728424e913777c494d68d=
bf0d2ec09
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/op_helper.c

  Log Message:
  -----------
  target-mips: cleanup float to int conversion helpers

Instead of accessing the flags from the floating point control
register after updating it, read the softfloat flags.

This is just code cleanup and should not change the behaviour.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 05993cd05fcdebc75f8432cf6ad558726dc8ec15
      https://github.com/qemu/qemu/commit/05993cd05fcdebc75f8432cf6ad5587=
26dc8ec15
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/op_helper.c

  Log Message:
  -----------
  target-mips: use softfloat constants when possible

softfloat already has a few constants defined, use them instead of
redefining them in target-mips.

Rename FLOAT_SNAN32 and FLOAT_SNAN64 to FP_TO_INT32_OVERFLOW and
FP_TO_INT64_OVERFLOW as even if they have the same value, they are
technically different (and defined differently in the MIPS ISA).

Remove the unused constants.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 5f7319cd84ecb82f65c67dd1033ec27647fcb7db
      https://github.com/qemu/qemu/commit/5f7319cd84ecb82f65c67dd1033ec27=
647fcb7db
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/op_helper.c

  Log Message:
  -----------
  target-mips: restore CPU state after an FPU exception

Rework *raise_exception*() functions so that they can be called from
other helpers, passing the return address as an argument.

Use do_raise_exception() function in update_fcr31() to correctly restore
the CPU state after an FPU exception.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 2910c6cbaacf7b9d54be3ce8ca03d68db45767bb
      https://github.com/qemu/qemu/commit/2910c6cbaacf7b9d54be3ce8ca03d68=
db45767bb
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: cleanup load/store operations

Load/store operations use macros for historical reasons. Now that there
is no point in keeping them, replace them by direct calls to qemu_ld/st.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 3cee3050ce2d79837fa286a730a54e2a8b9dc5dc
      https://github.com/qemu/qemu/commit/3cee3050ce2d79837fa286a730a54e2=
a8b9dc5dc
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: optimize load operations

Only allocate t1 when needed.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 18bba4dc781a273c2c1ff5baec2909c214e2e0fa
      https://github.com/qemu/qemu/commit/18bba4dc781a273c2c1ff5baec2909c=
214e2e0fa
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/op_helper.c

  Log Message:
  -----------
  target-mips: simplify load/store microMIPS helpers

load/store microMIPS helpers are reinventing the wheel. Call do_lw,
do_ll, do_sw and do_sl instead of using a macro calling the cpu_*
load/store functions.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: fc40787abcf8452b8f50d92b7a13243a12972c7a
      https://github.com/qemu/qemu/commit/fc40787abcf8452b8f50d92b7a13243=
a12972c7a
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/helper.h
    M target-mips/op_helper.c
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: implement unaligned loads using TCG

Load/store from helpers should be avoided as they are quite
inefficient. Rewrite unaligned loads instructions using TCG and
aligned loads. The number of actual loads operations to implement
an unaligned load instruction is reduced from up to 8 to 1.

Note: As we can't rely on shift by 32 or 64 undefined behaviour,
the code loads already shift by one constants.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 2d2826b99ee810057c76b48377d286beb9ee943b
      https://github.com/qemu/qemu/commit/2d2826b99ee810057c76b48377d286b=
eb9ee943b
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: don't use local temps for store conditional

Store conditional operations only need local temps in user mode. Fix
the code to use temp local only in user mode, this spares two memory
stores in system mode.

At the same time remove a wrong a wrong copied &amp; pasted comment,
store operations don't have a register destination.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: acf124655873cf7256877a35efd8dacca1b199d8
      https://github.com/qemu/qemu/commit/acf124655873cf7256877a35efd8dac=
ca1b199d8
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: implement movn/movz using movcond

Avoid the branches in movn/movz implementation and replace them with
movcond. Also update a wrong command.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 51127181cfac0315720e6ca502eb133a353f6b11
      https://github.com/qemu/qemu/commit/51127181cfac0315720e6ca502eb133=
a353f6b11
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: optimize ddiv/ddivu/div/divu with movcond

The result of a division by 0, or a division of INT_MIN by -1 in the
signed case, is unpredictable. Just replace 0 by 1 in that case so that
it doesn't trigger a floating point exception on the host.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: e0d002f17d1db1ade2b8d24b4a7c7ab361256726
      https://github.com/qemu/qemu/commit/e0d002f17d1db1ade2b8d24b4a7c7ab=
361256726
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: use deposit instead of hardcoded version

Use the deposit op instead of and hardcoded bit field insertion. It
allows the host to emit the corresponding instruction if available.

At the same time remove the (lsb &gt; msb) test. The MIPS64R2 instruction
set manual says "Because of the instruction format, lsb can never be
greater than msb, so there is no UNPREDICATABLE case for this
instruction."

(Bug reported as LP:1071149.)
Cc: =D0=9D=D0=B8=D0=BA=D0=B8=D1=82=D0=B0 =D0=9A=D0=B0=D0=BD=D1=83=D0=BD=D0=
=BD=D0=B8=D0=BA=D0=BE=D0=B2 &lt;n.kanunnikov@sbtcom.ru&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: bc3e45e13a93b883f0369acb2e19c0cec8705a7a
      https://github.com/qemu/qemu/commit/bc3e45e13a93b883f0369acb2e19c0c=
ec8705a7a
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/op_helper.c

  Log Message:
  -----------
  target-mips: fix TLBR wrt SEGMask

Like r4k_map_address(), r4k_helper_tlbp() should use SEGMask to mask the
address.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 286d52ebfc0d0d53c2a878e454292fea14bad41b
      https://github.com/qemu/qemu/commit/286d52ebfc0d0d53c2a878e454292fe=
a14bad41b
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-10-31 (Wed, 31 Oct 2012)

  Changed paths:
    M target-mips/op_helper.c

  Log Message:
  -----------
  target-mips: don't flush extra TLB on permissions upgrade

If the guest uses a TLBWI instruction for upgrading permissions, we
don't need to flush the extra TLBs. This improve boot time performance
by about 10%.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


Compare: https://github.com/qemu/qemu/compare/aee0bf7d8d75...286d52ebfc0d=


----==_mimepart_50919f717e625_16ebd8daec556f1--


</body></email><email><emailId>20120907160010</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-07 16:00:10-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 449bc9: lan9118: fix multicast filtering</subject><body>



----==_mimepart_504a1a0aa7945_6f081a16ae848421
Date: Fri, 07 Sep 2012 09:00:10 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;504a1a0aa8f61_6f081a16ae84854a@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 449bc90e1f2e2fbafb64eb0c76d16c9352b0d2df
      https://github.com/qemu/qemu/commit/449bc90e1f2e2fbafb64eb0c76d16c9352b0d2df
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-07 (Fri, 07 Sep 2012)

  Changed paths:
    M hw/lan9118.c

  Log Message:
  -----------
  lan9118: fix multicast filtering

The lan9118 emulation tries to compute the multicast index by calling
directly the crc32() function from zlib, but fails to get the correct
result.

Use the common compute_mcast_idx() function instead, which gives the
correct result. This fixes IPv6 support.

Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;




----==_mimepart_504a1a0aa7945_6f081a16ae848421--


</body></email><email><emailId>20120908000018</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-08 00:00:18-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 03e6e5: MIPS/user: Fix reset CPU state initialization</subject><body>



----==_mimepart_504a8a92cca08_5a71d0faec2167c
Date: Fri, 07 Sep 2012 17:00:18 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;504a8a92cdff9_5a71d0faec2176a@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 03e6e5017757645f00b2f3b4f3a257973985e455
      https://github.com/qemu/qemu/commit/03e6e5017757645f00b2f3b4f3a257973985e455
  Author: Maciej W. Rozycki &lt;macro@codesourcery.com&gt;
  Date:   2012-09-07 (Fri, 07 Sep 2012)

  Changed paths:
    M target-mips/cpu.h
    M target-mips/op_helper.c
    M target-mips/translate.c

  Log Message:
  -----------
  MIPS/user: Fix reset CPU state initialization

 This change updates the CPU reset sequence to use a common piece of code
that figures out CPU state flags, fixing the problem with MIPS_HFLAG_COP1X
not being set where applicable that causes floating-point MADD family
instructions (and other instructions from the MIPS IV FP subset) to trap.

 As compute_hflags is now shared between op_helper.c and translate.c, the
function is now moved to a common header.  There are no changes to this
function.

 The problem was seen with the 24Kf MIPS32r2 processor in user emulation.
The new approach prevents system and user emulation from diverging -- all
the hflags state is initialized in one place now.

Signed-off-by: Maciej W. Rozycki &lt;macro@codesourcery.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;




----==_mimepart_504a8a92cca08_5a71d0faec2167c--


</body></email><email><emailId>201209080000180</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-08 00:00:18-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] f408f4: qtest: fix infinite loop when QEMU aborts abruptly</subject><body>



----==_mimepart_504a8a92c6ceb_58c1637ae4264f
Date: Fri, 07 Sep 2012 17:00:18 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;504a8a92d8369_58c1637ae42651e@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/stable-1.1
  Home:   https://github.com/qemu/qemu
  Commit: f408f49165111b95a7186e2b1e01ee577c643855
      https://github.com/qemu/qemu/commit/f408f49165111b95a7186e2b1e01ee577c643855
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M tests/libqtest.c

  Log Message:
  -----------
  qtest: fix infinite loop when QEMU aborts abruptly

&gt; From Markus:

Makes "make check" hang:

    QTEST_QEMU_BINARY=x86_64-softmmu/qemu-system-x86_64 gtester -k --verbose -m=quick \
tests/crash-test tests/rtc-test  TEST: tests/crash-test... (pid=972)
    qemu-system-x86_64: Device needs media, but drive is empty
[Nothing happens, wait a while, then hit ^C]
    make: *** [check-qtest-x86_64] Interrupt

This was due to the fact that we weren't checked for errors when
reading from the QMP socket.  This patch adds appropriate error
checking.

Reported-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 039380a8e18f618cdacf72486449c04dc1b70eef)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 7940c766d470ddb184f6d678d080006d2b668172
      https://github.com/qemu/qemu/commit/7940c766d470ddb184f6d678d080006d2b668172
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: Don't override user's --cpu on MacOS and Solaris

Both MacOS and Solaris have special case handling for the CPU
type, because the check_define probes will return i386 even if
the hardware is 64 bit and x86_64 would be preferable. Move
these checks earlier in the configure probing so that we can
do them only if the user didn't specify a CPU with --cpu. This
fixes a bug where the user's command line argument was being
ignored.

Reviewed-by: Andreas F=E4rber &lt;afaerber@suse.de&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit bbea4050802a2e7e0296a21823c0925782c02b93)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 08e642c00e979b10e3fb293272dc3057ab9f220b
      https://github.com/qemu/qemu/commit/08e642c00e979b10e3fb293272dc3057ab9f220b
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M target-ppc/kvm.c

  Log Message:
  -----------
  ppc: Fix bug in handling of PAPR hypercall exits

Currently for powerpc, kvm_arch_handle_exit() always returns 1, meaning
that its caller - kvm_cpu_exec() - will always exit immediately afterwards
to the loop in qemu_kvm_cpu_thread_fn().

There's no need to do this.  Once we've handled the hypercall there's no
reason we can't go straight around and KVM_RUN again, which is what ret = 0
will signal.  The only exception might be for hypercalls which affect the
state of cpu_can_run(), however the only one that might do this is H_CEDE
and for kvm that is always handled in the kernel, not qemu.

Furtherm setting ret = 0 means that when exit_requested is set from a
hypercall, we will enter KVM_RUN once more with a signal which lets the
the kernel do its internal logic to complete the hypercall with out
actually executing any more guest code.  This is important if our hypercall
also triggered a reset, which previously would re-initialize everything
without completing the hypercall.  This caused the kernel to get confused
because it thought the guest was still in the middle of a hypercall when
it has actually been reset.

This patch therefore changes to ret = 0, which is both a bugfix and a small
optimization.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
(cherry picked from commit 78e8fde26c032931ca2ae13bfc7c59e38afd17ee)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 97ac3b1af57a4cdbf04ad55c308dff72bc9f1a61
      https://github.com/qemu/qemu/commit/97ac3b1af57a4cdbf04ad55c308dff72bc9f1a61
  Author: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M target-s390x/kvm.c
    M target-s390x/op_helper.c

  Log Message:
  -----------
  s390: Fix error handling and condition code of service call

Invalid sccb addresses will cause specification or addressing exception.
Lets add those checks. Furthermore, the good case (cc=0) was incorrect
for KVM, we did not set the CC at all. We now use return codes &lt; 0
as program checks and return codes &gt; 0 as condition code values.

Signed-off-by: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
(cherry picked from commit 9abf567d95a4e840df868ca993219175fbef8c22)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 5a1800cf1cc7869d29e6bd299dddbab7a3acbb2b
      https://github.com/qemu/qemu/commit/5a1800cf1cc7869d29e6bd299dddbab7a3acbb2b
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M hw/apic_common.c

  Log Message:
  -----------
  kvmvapic: Disable if there is insufficient memory

We need at least 1M of RAM to map the option ROM. Otherwise, we will
corrupt host memory or even crash:

    $ qemu-system-x86_64 -nodefaults --enable-kvm -vnc :0 -m 640k
    Segmentation fault (core dumped)

Reported-and-tested-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;
(cherry picked from commit a9605e0317c7a6d5e68f3a3b6708c8ef1096f4bc)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 36ed337845a00240c370bbea782f953a8110d0c0
      https://github.com/qemu/qemu/commit/36ed337845a00240c370bbea782f953a8110d0c0
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M hw/qdev.c

  Log Message:
  -----------
  qdev: fix use-after-free in the error path of qdev_init_nofail

&gt; From Markus:

Before:

    $ qemu-system-x86_64 -display none -drive if=ide
    qemu-system-x86_64: Device needs media, but drive is empty
    qemu-system-x86_64: Initialization of device ide-hd failed
    [Exit 1 ]

After:

    $ qemu-system-x86_64 -display none -drive if=ide
    qemu-system-x86_64: Device needs media, but drive is empty
    Segmentation fault (core dumped)
    [Exit 139 (SIGSEGV)]

This error always existed as qdev_init() frees the object.  But QOM
goes a bit further and purposefully sets the class pointer to NULL to
help find use-after-free.  It worked :-)

Cc: Andreas Faerber &lt;afaerber@suse.de&gt;
Reported-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 7de3abe505e34398cef5bddf6c4d0bd9ee47007f)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 3b38972743856fbfcee88fc15eb0753977103313
      https://github.com/qemu/qemu/commit/3b38972743856fbfcee88fc15eb0753977103313
  Author: Avi Kivity &lt;avi@redhat.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M hw/virtio-blk.c

  Log Message:
  -----------
  virtio-blk: fix use-after-free while handling scsi commands

The scsi passthrough handler falls through after completing a
request into the failure path, resulting in a use after free.

Reproducible by running a guest with aio=native on a block device.

Reported-by: Stefan Priebe &lt;s.priebe@profihost.ag&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
(cherry picked from commit 730a9c53b4e52681fcfe31cf38854cbf91e132c7)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 34b41ed15dd050097def7aebde9b39a12bd4cc43
      https://github.com/qemu/qemu/commit/34b41ed15dd050097def7aebde9b39a12bd4cc43
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: fix reset

Check for the reset bit first when processing USBCMD register writes.
Also break out of the switch, there is no need to check the other bits.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 7046530c36fa3a3f87692bdb54556f5d891a9c03)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: b10daa61f9a600997b59b36b34c6e2341a6e7616
      https://github.com/qemu/qemu/commit/b10daa61f9a600997b59b36b34c6e2341a6e7616
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: don't flush cache on doorbell rings.

Commit 4be23939ab0d7019c7e59a37485b416fbbf0f073 makes ehci instantly
zap any unlinked queue heads when the guest rings the doorbell.

While hacking up uas support this turned out to be a problem.  The linux
kernel can unlink and instantly relink the very same queue head, thereby
killing any async packets in flight.  That alone isn't an issue yet, the
packet will canceled and resubmitted and everything is fine.  We'll run
into trouble though in case the async packet is completed already, so we
can't cancel it any more.  The transaction is simply lost then.

usb_ehci_qh_ptrs q (nil) - QH @ 39c4f000: next 39c4f122 qtds \
00000000,00000001,39c50000 usb_ehci_qh_fields QH @ 39c4f000 - rl 0, mplen 0, eps 0, \
ep 0, dev 0 usb_ehci_qh_ptrs q 0x7f95feba90a0 - QH @ 39c4f000: next 39c4f122 qtds \
00000000,00000001,39c50000 usb_ehci_qh_fields QH @ 39c4f000 - rl 0, mplen 0, eps 0, \
ep 0, dev 0 usb_ehci_qh_ptrs q 0x7f95fe515210 - QH @ 39c4f120: next 39c4f0c2 qtds \
29dbce40,29dbc4e0,00000009 usb_ehci_qh_fields QH @ 39c4f120 - rl 4, mplen 512, eps 2, \
ep 1, dev 2 usb_ehci_packet_action q 0x7f95fe515210 p 0x7f95fdec32a0: alloc
usb_packet_state_change bus 0, port 2, ep 1, packet 0x7f95fdec32e0, state undef -&gt; \
setup usb_ehci_packet_action q 0x7f95fe515210 p 0x7f95fdec32a0: process
usb_uas_command dev 2, tag 0x2, lun 0, lun64 00000000-00000000
scsi_req_parsed target 0 lun 0 tag 2 command 42 dir 2 length 16384
scsi_req_parsed_lba target 0 lun 0 tag 2 command 42 lba 5933312
scsi_req_alloc target 0 lun 0 tag 2
scsi_req_continue target 0 lun 0 tag 2
scsi_req_data target 0 lun 0 tag 2 len 16384
usb_uas_scsi_data dev 2, tag 0x2, bytes 16384
usb_uas_write_ready dev 2, tag 0x2
usb_packet_state_change bus 0, port 2, ep 1, packet 0x7f95fdec32e0, state setup -&gt; \
complete usb_ehci_packet_action q 0x7f95fe515210 p 0x7f95fdec32a0: free
usb_ehci_qh_ptrs q 0x7f95fdec3210 - QH @ 39c4f0c0: next 39c4f002 qtds \
29dbce40,00000001,00000009 usb_ehci_qh_fields QH @ 39c4f0c0 - rl 4, mplen 512, eps 2, \
ep 2, dev 2 usb_ehci_queue_action q 0x7f95fe5152a0: free
usb_packet_state_change bus 0, port 2, ep 2, packet 0x7f95feba9170, state async -&gt; \
complete ^^^ async packets completes.
usb_ehci_packet_action q 0x7f95fdec3210 p 0x7f95feba9130: wakeup

usb_ehci_qh_ptrs q (nil) - QH @ 39c4f000: next 39c4f122 qtds \
00000000,00000001,39c50000 usb_ehci_qh_fields QH @ 39c4f000 - rl 0, mplen 0, eps 0, \
ep 0, dev 0 usb_ehci_qh_ptrs q 0x7f95feba90a0 - QH @ 39c4f000: next 39c4f122 qtds \
00000000,00000001,39c50000 usb_ehci_qh_fields QH @ 39c4f000 - rl 0, mplen 0, eps 0, \
ep 0, dev 0 usb_ehci_qh_ptrs q 0x7f95fe515210 - QH @ 39c4f120: next 39c4f002 qtds \
29dbc4e0,29dbc8a0,00000009 usb_ehci_qh_fields QH @ 39c4f120 - rl 4, mplen 512, eps 2, \
ep 1, dev 2 usb_ehci_queue_action q 0x7f95fdec3210: free
usb_ehci_packet_action q 0x7f95fdec3210 p 0x7f95feba9130: free
^^^ endpoint #2 queue head removed from schedule, doorbell makes ehci zap the queue,
    the (completed) usb packet is freed too and gets lost.

usb_ehci_qh_ptrs q (nil) - QH @ 39c4f000: next 39c4f0c2 qtds \
00000000,00000001,39c50000 usb_ehci_qh_fields QH @ 39c4f000 - rl 0, mplen 0, eps 0, \
ep 0, dev 0 usb_ehci_qh_ptrs q 0x7f95feba90a0 - QH @ 39c4f000: next 39c4f0c2 qtds \
00000000,00000001,39c50000 usb_ehci_qh_fields QH @ 39c4f000 - rl 0, mplen 0, eps 0, \
ep 0, dev 0 usb_ehci_queue_action q 0x7f9600dff570: alloc
usb_ehci_qh_ptrs q 0x7f9600dff570 - QH @ 39c4f0c0: next 39c4f122 qtds \
29dbce40,00000001,00000009 usb_ehci_qh_fields QH @ 39c4f0c0 - rl 4, mplen 512, eps 2, \
ep 2, dev 2 usb_ehci_packet_action q 0x7f9600dff570 p 0x7f95feba9130: alloc
usb_packet_state_change bus 0, port 2, ep 2, packet 0x7f95feba9170, state undef -&gt; \
setup usb_ehci_packet_action q 0x7f9600dff570 p 0x7f95feba9130: process
usb_packet_state_change bus 0, port 2, ep 2, packet 0x7f95feba9170, state setup -&gt; \
async usb_ehci_packet_action q 0x7f9600dff570 p 0x7f95feba9130: async
^^^ linux kernel relinked the queue head, ehci creates a new usb packet,
    but we should have delivered the completed one instead.
usb_ehci_qh_ptrs q 0x7f95fe515210 - QH @ 39c4f120: next 39c4f002 qtds \
29dbc4e0,29dbc8a0,00000009 usb_ehci_qh_fields QH @ 39c4f120 - rl 4, mplen 512, eps 2, \
ep 1, dev 2

So instead of instantly zapping the queue we'll set a flag that the
queue needs revalidation in case we'll see it again in the schedule.
ehci then checks that the queue head fields addressing / describing the
endpoint and the qtd pointer match the cached content before reusing it.

Cc: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 9bc3a3a216e2689bfcdd36c3e079333bbdbf3ba0)

Conflicts:

	hw/usb/hcd-ehci.c

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: f49853a4bd5113cdb847579b8fb171a06d68af10
      https://github.com/qemu/qemu/commit/f49853a4bd5113cdb847579b8fb171a06d68af10
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: fix uhci_async_cancel_all

We update the QTAILQ in the loop, thus we must use the SAFE version
to make sure we don't touch the queue struct after freeing it.

https://bugzilla.novell.com/show_bug.cgi?id=766310

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 77fa9aee38758a078870e25f0dcf642066b4d5cc)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: a1a17b1d5a7fe618e42a94fc171712aeb31561ec
      https://github.com/qemu/qemu/commit/a1a17b1d5a7fe618e42a94fc171712aeb31561ec
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M hw/usb/bus.c

  Log Message:
  -----------
  usb: restore USBDevice-&gt;attached on vmload

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 495d544798151206bafca65ec588c0388637eb40)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: b00201d402e9927427a4494510c9d0a4b2f620c7
      https://github.com/qemu/qemu/commit/b00201d402e9927427a4494510c9d0a4b2f620c7
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Correctly handle the usb_redir_babble usbredir status

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit adae502c0ae4572ef08f71cb5b5ed5a8e90299fe)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: dbeb6c22d7a6d17f14fec38725bca63218ab7f22
      https://github.com/qemu/qemu/commit/dbeb6c22d7a6d17f14fec38725bca63218ab7f22
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  usb-ehci: Fix an assert whenever isoc transfers are used

hcd-ehci.c is missing an usb_packet_init() call for the ipacket UsbPacket
it uses for isoc transfers, triggering an assert (taking the entire vm down)
in usb_packet_setup as soon as any isoc transfers are done by a high speed
USB device.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
(cherry picked from commit 7341ea075c09258b98a1d0efc60efd402cbfc9b4)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 8a869baa08b3b3fd7a122957983f3d7754728112
      https://github.com/qemu/qemu/commit/8a869baa08b3b3fd7a122957983f3d7754728112
  Author: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M qlist.c
    M qlist.h

  Log Message:
  -----------
  qlist: add qlist_size()

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit a86a4c2f7b7f0b72816ea1c219d8140699b6665b)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 9c7e3b98aac6c43c3cf4d261696f58b13f84afe7
      https://github.com/qemu/qemu/commit/9c7e3b98aac6c43c3cf4d261696f58b13f84afe7
  Author: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M json-parser.c

  Log Message:
  -----------
  json-parser: don't replicate tokens at each level of recursion

Currently, when parsing a stream of tokens we make a copy of the token
list at the beginning of each level of recursion so that we do not
modify the original list in cases where we need to fall back to an
earlier state.

In the worst case, we will only read 1 or 2 tokens off the list before
recursing again, which means an upper bound of roughly N^2 token allocations.

For a "reasonably" sized QMP request (in this a QMP representation of
cirrus_vga's device state, generated via QIDL, being passed in via
qom-set), this caused my 16GB's of memory to be exhausted before any
noticeable progress was made by the parser.

This patch works around the issue by using single copy of the token list
in the form of an indexable array so that we can save/restore state by
manipulating indices.

A subsequent commit adds a "large_dict" test case which exhibits the
same behavior as above. With this patch applied the test case successfully
completes in under a second.

Tested with valgrind, make check, and QMP.

Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 65c0f1e9558c7c762cdb333406243fff1d687117)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: b83883e2dbbbeb4b4f5c2fc83c5eec8e2d5a6c5d
      https://github.com/qemu/qemu/commit/b83883e2dbbbeb4b4f5c2fc83c5eec8e2d5a6c5d
  Author: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M tests/check-qjson.c

  Log Message:
  -----------
  check-qjson: add test for large JSON objects

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 7109edfeb69c1d3c2164175837784dfcd210fed0)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 55e64b6dddfd71953f4eb7ad6d0bcfc8d92500e5
      https://github.com/qemu/qemu/commit/55e64b6dddfd71953f4eb7ad6d0bcfc8d92500e5
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M net/slirp.c

  Log Message:
  -----------
  slirp: Enforce host-side user of smb share

Windows 7 (and possibly other versions) cannot connect to the samba
share if the exported host directory is not world-readable. This can be
resolved by forcing the username used for access checks to the one
under which QEMU and smbd are running.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
(cherry picked from commit 1cb1c5d10bb9e180bd3f7be2c10b212ed86a97b4)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 1a933e48016db893c799775a897b2af88a879683
      https://github.com/qemu/qemu/commit/1a933e48016db893c799775a897b2af88a879683
  Author: Dunrong Huang &lt;riegamaths@gmail.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M net/slirp.c

  Log Message:
  -----------
  slirp: Ensure smbd and shared directory exist when enable smb

Users may pass the following parameters to qemu:
    $ qemu-kvm -net nic -net user,smb= ...
    $ qemu-kvm -net nic -net user,smb ...
    $ qemu-kvm -net nic -net user,smb=bad_directory ...

In these cases, qemu started successfully while samba server
failed to start. Users will confuse since samba server
failed silently without any indication of what it did wrong.

To avoid it, we check whether the shared directory exist and
if users have permission to access this directory when QEMU's
"built-in" SMB server is enabled.

Signed-off-by: Dunrong Huang &lt;riegamaths@gmail.com&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
(cherry picked from commit 927d811b282ffdf5386bd63f435c1507634ba49a)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 44a42fd2b69b1bc9cdb54d0cbfcdfd6b3bbf0c31
      https://github.com/qemu/qemu/commit/44a42fd2b69b1bc9cdb54d0cbfcdfd6b3bbf0c31
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M net/slirp.c

  Log Message:
  -----------
  slirp: Improve error reporting of inaccessible smb directories

Instead of guessing, print the error code returned by access.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
(cherry picked from commit 22a61f365df83d5d7884cceb1c462295977cb2db)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: c337db8cc9f4725c0654134de42b97f7847186a4
      https://github.com/qemu/qemu/commit/c337db8cc9f4725c0654134de42b97f7847186a4
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M hw/apic.c

  Log Message:
  -----------
  apic: Resolve potential endless loop around apic_update_irq

Commit d96e173769 refactored the reinjection of pending PIC interrupts.
However, it missed the potential loop of apic_update_irq -&gt;
apic_deliver_pic_intr -&gt; apic_local_deliver -&gt; apic_set_irq -&gt;
apic_update_irq that /could/ occur if LINT0 is injected as APIC_DM_FIXED
and that vector is currently blocked via TPR.

Resolve this by reinjecting only where it matters: inside
apic_get_interrupt. This function may clear a vector while a
PIC-originated reason still exists.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;
(cherry picked from commit 3db3659bf60094657e1465cc809acb09551816ee)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 2a93a8940093560686fdcda24776ff265d6bcba7
      https://github.com/qemu/qemu/commit/2a93a8940093560686fdcda24776ff265d6bcba7
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M hw/apic.c

  Log Message:
  -----------
  apic: Reevaluate pending interrupts on LVT_LINT0 changes

When the guest modifies the LVT_LINT0 register, we need to check if some
pending PIC interrupt can now be delivered.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;
(cherry picked from commit a94820ddc36f8c452b37f9dcb323f55ffdbc75f9)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: a47343957489b9fafdb438351e8fa9d58d7fd30b
      https://github.com/qemu/qemu/commit/a47343957489b9fafdb438351e8fa9d58d7fd30b
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M cpu-exec.c
    M hw/apic.c
    M hw/apic.h
    M hw/apic_internal.h
    M target-i386/cpu.h
    M target-i386/kvm.c

  Log Message:
  -----------
  apic: Defer interrupt updates to VCPU thread

KVM performs TPR raising asynchronously to QEMU, specifically outside
QEMU's global lock. When an interrupt is injected into the APIC and TPR
is checked to decide if this can be delivered, a stale TPR value may be
used, causing spurious interrupts in the end.

Fix this by deferring apic_update_irq to the context of the target VCPU.
We introduce a new interrupt flag for this, CPU_INTERRUPT_POLL. When it
is set, the VCPU calls apic_poll_irq before checking for further pending
interrupts. To avoid special-casing KVM, we also implement this logic
for TCG mode.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;
(cherry picked from commit 5d62c43a17edaa7f6a88821c9086e6c8e0e5327d)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: c094d3d8181f3193e402b49361327040c5725d79
      https://github.com/qemu/qemu/commit/c094d3d8181f3193e402b49361327040c5725d79
  Author: Jason Baron &lt;jbaron@redhat.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M dma-helpers.c
    M hw/ide/ahci.c

  Log Message:
  -----------
  ahci: Fix sglist memleak in ahci_dma_rw_buf()

I noticed that in hw/ide/ahci:ahci_dma_rw_buf() we do not free the sglist. Thus,
I've added a call to qemu_sglist_destroy() to fix this memory leak.

In addition, I've adeed a call in qemu_sglist_destroy() to 0 all of the sglist
fields, in case there is some other codepath that tries to free the sglist.

Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
(cherry picked from commit ea8d82a1ed72634f089ed1bccccd9c84cc1ab855)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 5ae1c7ca0a8e648219f7cea1f58bf57cf8d2cea2
      https://github.com/qemu/qemu/commit/5ae1c7ca0a8e648219f7cea1f58bf57cf8d2cea2
  Author: Jason Baron &lt;jbaron@redhat.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M hw/ide/ahci.c
    M hw/ide/internal.h

  Log Message:
  -----------
  ahci: Fix ahci cdrom read corruptions for reads &gt; 128k

While testing q35, which has its cdrom attached to the ahci controller, I found
that the Fedora 17 install would panic on boot. The panic occurs while
squashfs is trying to read from the cdrom. The errors are:

[    8.622711] SQUASHFS error: xz_dec_run error, data probably corrupt
[    8.625180] SQUASHFS error: squashfs_read_data failed to read block
0x20be48a

I was also able to produce corrupt data reads using an installed piix based
qemu machine, using 'dd'. I found that the corruptions were only occuring when
then read size was greater than 128k. For example, the following command
results in corrupted reads:

dd if=/dev/sr0 of=/tmp/blah bs=256k iflag=direct

The &gt; 128k size reads exercise a different code path than 128k and below. In
ide_atapi_cmd_read_dma_cb() s-&gt;io_buffer_size is capped at 128k. Thus,
ide_atapi_cmd_read_dma_cb() is called a second time when the read is &gt; 128k.
However, ahci_dma_rw_buf() restart the read from offset 0, instead of at 128k.
Thus, resulting in a corrupted read.

To fix this, I've introduced 'io_buffer_offset' field in IDEState to keep
track of the offset. I've also modified ahci_populate_sglist() to take a new
3rd offset argument, so that the sglist is property initialized.

I've tested this patch using 'dd' testing, and Fedora 17 now correctly boots
and installs on q35 with the cdrom ahci controller.

Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Tested-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
(cherry picked from commit 61f52e06f0a21bab782f98ef3ea789aa6d0aa046)

Conflicts:

	hw/ide/ahci.c

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 393d4c921464c2a791b6662b8b664feba9104cce
      https://github.com/qemu/qemu/commit/393d4c921464c2a791b6662b8b664feba9104cce
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M hw/kvm/i8254.c

  Log Message:
  -----------
  kvm: i8254: Cache kernel clock offset in KVMPITState

To prepare the final fix for clock calibration issues with the in-kernel
PIT, we want to cache the offset between vmclock and the clock used by
the in-kernel PIT. So far, we only need to update it when the VM state
changes between running and stopped because we only read the in-kernel
PIT state while the VM is running.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;
(cherry picked from commit 205df4d1a87cbb14a50655fb2c0a987467fb29d6)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ffc7565c81b010683c3cab8efe9accd0eb90aa0d
      https://github.com/qemu/qemu/commit/ffc7565c81b010683c3cab8efe9accd0eb90aa0d
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M hw/kvm/i8254.c

  Log Message:
  -----------
  kvm: i8254: Finish time conversion fix

0cdd3d1444 fixed reading back the counter load time from the kernel
while assuming the kernel would always update its load time on writing
the state. That is only true for channel 1, and so pit_get_channel_info
returned wrong output pin states for high counter values.

Fix this by applying the offset also on kvm_pit_put. Now we also need to
update the offset when we write the state while the VM is stopped as it
keeps on changing in that state.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;
(cherry picked from commit 050a46065de8e3d4ee5a04f5598d666f63d34800)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: cfeb9958c8f4f99f08222a47fe42ea73acb41ecc
      https://github.com/qemu/qemu/commit/cfeb9958c8f4f99f08222a47fe42ea73acb41ecc
  Author: Markus Armbruster &lt;armbru@redhat.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M hw/pc.c

  Log Message:
  -----------
  pc: Fix RTC CMOS info on RAM for ram_size &lt; 1MiB

pc_cmos_init() always claims 640KiB base memory, and ram_size - 1MiB
extended memory.  The latter can underflow to "lots of extended
memory".  Fix both, and clean up some.

Note: SeaBIOS currently requires 1MiB of RAM, and doesn't check
whether it got enough.

Signed-off-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
(cherry picked from commit e89001f72edde37fb36fa7c964daa1bbeb2eca26)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: fd21cc14f57247339be0ebf3e0845e431aa5aedc
      https://github.com/qemu/qemu/commit/fd21cc14f57247339be0ebf3e0845e431aa5aedc
  Author: Markus Armbruster &lt;armbru@redhat.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M vl.c

  Log Message:
  -----------
  vl: Round argument of -m up to multiple of 8KiB

Partial pages make little sense and don't work.  Ensure the RAM size
is a multiple of any possible target's page size.

Fixes

    $ qemu-system-x86_64 -nodefaults -S -vnc :0 -m 0.8
    qemu-system-x86_64: /work/armbru/qemu/exec.c:2255: register_subpage: Assertion \
`existing-&gt;mr-&gt;subpage || existing-&gt;mr == &amp;io_mem_unassigned' failed.

Signed-off-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
(cherry picked from commit ff961015529437f4b83fca0a92069aebcf533c9c)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 07ab4fc1ef2e628209ecab97475ea45071b19ec8
      https://github.com/qemu/qemu/commit/07ab4fc1ef2e628209ecab97475ea45071b19ec8
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M block/vmdk.c

  Log Message:
  -----------
  vmdk: Fix header structure

Commit bb45ded9 swapped gd_offset and rgd_offset. This is wrong.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
(cherry picked from commit 7a736bfa4e0a58087054cad68a1d4b3804bbb708)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: d438650fa512f944ca4af1a08ab132712c50b684
      https://github.com/qemu/qemu/commit/d438650fa512f944ca4af1a08ab132712c50b684
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M block/vmdk.c

  Log Message:
  -----------
  vmdk: Read footer for streamOptimized images

The footer takes precedence over the header when it exists. It contains
the real grain directory offset that is missing in the header. Without
this patch, streamOptimized images with a footer cannot be read.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Reviewed-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Reviewed-by: Jeff Cody &lt;jcody@redhat.com&gt;
(cherry picked from commit 65bd155c7356d448ffee7f89149c4d473076b0ba)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: f946f010f5f7d6b13bf6acabffebe093b1c9949c
      https://github.com/qemu/qemu/commit/f946f010f5f7d6b13bf6acabffebe093b1c9949c
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M qemu-img.texi

  Log Message:
  -----------
  Documentation: Warn against qemu-img on active image

People have repeatedly expected that you can do things like snapshotting
an image with qemu-img while a qemu instance is running. Maybe we need
to consider locking the files while they are in use, but having a
warning in the qemu-img manpage is doable for 1.2 and can't hurt anyway.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
(cherry picked from commit 48467328c6dccc9c7be6628ed0ef0810f83be2a9)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: a410be59b5f2727f254152020e0f59cf2c1c5b15
      https://github.com/qemu/qemu/commit/a410be59b5f2727f254152020e0f59cf2c1c5b15
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M block/iscsi.c

  Log Message:
  -----------
  iscsi: move iscsi_schedule_bh and iscsi_readv_writev_bh_cb

Put these functions at the beginning, to avoid forward references
in the next patches.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
(cherry picked from commit 27cbd828c617944c0f9603763fdf4fa87e7ad923)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: b90d717b6469ac15fa1837a884097bbc5499124c
      https://github.com/qemu/qemu/commit/b90d717b6469ac15fa1837a884097bbc5499124c
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M block/iscsi.c

  Log Message:
  -----------
  iscsi: simplify iscsi_schedule_bh

It is always used with the same callback, remove the argument.  And
its return value is never used, assume allocation succeeds.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
(cherry picked from commit cfb3f5064af2d2e29c976e292c9472dfe9d61e31)

Conflicts:

	block/iscsi.c

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 799c27e1243769a52fb3edc7e5b42f9f50c9fba6
      https://github.com/qemu/qemu/commit/799c27e1243769a52fb3edc7e5b42f9f50c9fba6
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M block/iscsi.c

  Log Message:
  -----------
  iscsi: fix races between task completion and abort

This patch fixes two main issues with block/iscsi.c:

1) iscsi_task_mgmt_abort_task_async calls iscsi_scsi_task_cancel which
was also directly called in iscsi_aio_cancel

2) a race between task completion and task abortion could happen cause
the scsi_free_scsi_task were done before iscsi_schedule_bh has finished.
To fix this, all the freeing of IscsiTasks and releasing of the AIOCBs
is centralized in iscsi_bh_cb, independent of whether the SCSI command
has completed or was cancelled.

3) iscsi_aio_cancel was not synchronously waiting for the end of the
command.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
(cherry picked from commit 1bd075f29ea6d11853475c7c42734595720c3ac6)

Conflicts:

	block/iscsi.c

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: b598cb2214cbc197a7d8a677644a7ef3ea17c2c1
      https://github.com/qemu/qemu/commit/b598cb2214cbc197a7d8a677644a7ef3ea17c2c1
  Author: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M iohandler.c

  Log Message:
  -----------
  eventfd: making it thread safe

QEMU uses IO handlers to run select() in the main loop.
The handlers list is managed by qemu_set_fd_handler() helper
which works fine when called from the main thread as it is
called when select() is not waiting.

However IO handlers list can be changed in the thread other than
the main one doing os_host_main_loop_wait(), for example, as a result
of a hypercall which changes PCI config space (VFIO on POWER is the case)
and enables/disabled MSI/MSIX which closes/creates eventfd handles.
As the main loop should be waiting on the newly created eventfds,
it has to be restarted.

The patch adds the qemu_notify_event() call to interrupt select()
to make main_loop() restart select() with the updated IO handlers
list.

Signed-off-by: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 55ce75faf253d4369670f60409c608e665e8dde9)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 886c62a3ff5aefca7b595a830ef2def5fedb636d
      https://github.com/qemu/qemu/commit/886c62a3ff5aefca7b595a830ef2def5fedb636d
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M hw/i82378.c

  Log Message:
  -----------
  i82378: Remove bogus MMIO coalescing

This MMIO area is an entry gate to legacy PC ISA devices, addressed via
PIO over there. Quite a few of the PIO ports have side effects on access
like starting/stopping timers that must be executed properly ordered
/wrt the CPU. So we have to remove the coalescing mark.

Acked-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Acked-by: Andreas FÃ¤rber &lt;andreas.faerber@web.de&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 0ec64507a5e6366e6d8070a82c866b935f687ed9)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: c7e6d6b1158910460b395232faeb053593da2a96
      https://github.com/qemu/qemu/commit/c7e6d6b1158910460b395232faeb053593da2a96
  Author: Frediano Ziglio &lt;frediano.ziglio@citrix.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M xen-mapcache.c

  Log Message:
  -----------
  Fix invalidate if memory requested was not bucket aligned

When memory is mapped in qemu_map_cache with lock != 0 a reverse mapping
is created pointing to the virtual address of location requested.
The cached mapped entry is saved in last_address_vaddr with the memory
location of the base virtual address (without bucket offset).
However when this entry is invalidated the virtual address saved in the
reverse mapping is used. This cause that the mapping is freed but the
last_address_vaddr is not reset.

Signed-off-by: Frediano Ziglio &lt;frediano.ziglio@citrix.com&gt;
Signed-off-by: Stefano Stabellini &lt;stefano.stabellini@eu.citrix.com&gt;
(cherry picked from commit 27b7652ef515bb4c694f79d657d2052c72b19536)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 07548727b3ef25c63ed5a3f068f46059963490c6
      https://github.com/qemu/qemu/commit/07548727b3ef25c63ed5a3f068f46059963490c6
  Author: Dongxiao Xu &lt;dongxiao.xu@intel.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M xen-all.c

  Log Message:
  -----------
  xen-all.c: fix multiply issue for int and uint types

If the two multiply operands are int and uint types separately,
the int type will be transformed to uint firstly, which is not the
intent in our code piece. The fix is to add (int64_t) transform
for the uint type before the multiply.

Signed-off-by: Dongxiao Xu &lt;dongxiao.xu@intel.com&gt;
Signed-off-by: Stefano Stabellini &lt;stefano.stabellini@eu.citrix.com&gt;
(cherry picked from commit 14d40183725361e6350166099556c7661063921b)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 1bc633246105b629b72728b007fd9d414c6038e8
      https://github.com/qemu/qemu/commit/1bc633246105b629b72728b007fd9d414c6038e8
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M qemu-ga.c

  Log Message:
  -----------
  qemu-ga: don't leak a file descriptor upon failed lockf

Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 4144f122b477164cf466ca69be24cf4ef5c218d3)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: df60f451b3eb94305e63f0bb12c9c361a721bc81
      https://github.com/qemu/qemu/commit/df60f451b3eb94305e63f0bb12c9c361a721bc81
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M linux-user/syscall.c

  Log Message:
  -----------
  linux-user: do_msgrcv: don't leak host_mb upon TARGET_EFAULT failure

Also, use g_malloc to avoid NULL-deref upon OOM.

Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 0d07fe47d4986271a21ed4ff5237275ff55dd93f)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: b68e45c68667dce43341c94c69126852496ddbaf
      https://github.com/qemu/qemu/commit/b68e45c68667dce43341c94c69126852496ddbaf
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M block/sheepdog.c

  Log Message:
  -----------
  sheepdog: don't leak socket file descriptor upon connection failure

Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit a7e47d4bfcbf256fae06891a8599950ff8e1b61b)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: cc5caf7df4ed5833183121e08c6b6131722137d5
      https://github.com/qemu/qemu/commit/cc5caf7df4ed5833183121e08c6b6131722137d5
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M arm-semi.c

  Log Message:
  -----------
  arm-semi: don't leak 1KB user string lock buffer upon TARGET_SYS_OPEN

Always call unlock_user before returning.

Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 396bef4b3846bf4e80a2bee38e9a2d8554d0f251)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: c068d37020f8c0d10beaf4671c41b05b923d7896
      https://github.com/qemu/qemu/commit/c068d37020f8c0d10beaf4671c41b05b923d7896
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M softmmu-semi.h

  Log Message:
  -----------
  softmmu-semi: fix lock_user* functions not to deref NULL upon OOM

Return NULL upon malloc failure.

Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 15d9e3bc6af8a56af8c61911aab8453a54795db1)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 50d0184cb7be68a521a19073c92c5ffc6adb728f
      https://github.com/qemu/qemu/commit/50d0184cb7be68a521a19073c92c5ffc6adb728f
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M monitor.c

  Log Message:
  -----------
  monitor: move json init from OPEN event to init

At some point in the past, the OPEN event was changed to be issued from a
bottom half.  This creates a small window whereas a data callback registered in
init may be invoked before the OPEN event has been issued.

This is reproducible with:

 echo "{'execute': 'qmp_capabilities'}" | qemu-system-x86_64 -M none -qmp stdio

We can fix this for the monitor by moving the parser initialization to init.

The remaining state that is set in OPEN appears harmless.

Reported-by: Daniel Berrange &lt;berrange@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 58617a795c8067b2f9800cffce60f38707d3aa31)

Conflicts:

	monitor.c

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 5ea33884f642ab74a321527d7a91001d1562d671
      https://github.com/qemu/qemu/commit/5ea33884f642ab74a321527d7a91001d1562d671
  Author: Meador Inge &lt;meadori@codesourcery.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Enable access to required RDHWR hardware registers

While running in the usermode emulator all of the required*
MIPS32r2 RDHWR hardware registers should be accessible (the
Linux kernel enables access to these same registers).  Note
that these registers are still enabled when the MIPS ISA is
not release 2.  This is OK since the Linux kernel emulates
access to them when they are not available in hardware.

* There is also the ULR register which is only recommended
  for full release 2 compliance.  Incidentally, accessing
  this register in the current implementation works fine
  without flipping its access bit.

Signed-off-by: Meador Inge &lt;meadori@codesourcery.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit 94159135cb59684853dcd45ff70d6dbc54a29209)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: cdcf2aa41c816482b53e2d3909557c7c3f909845
      https://github.com/qemu/qemu/commit/cdcf2aa41c816482b53e2d3909557c7c3f909845
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M target-mips/op_helper.c

  Log Message:
  -----------
  target-mips: Fix some helper functions (VR54xx multiplication)

Commits b5dc7732e1cc2fb549e48b7b5d664f2c79628e2e and
be24bb4f3007c3e07cbf1934f7e781493d876ab7 optimized the code
and removed the correct setting of t0. Fix this.

gcc-4.7 detected this bug because parameter arg1 was unused
but set in set_HIT0_LO and set_HI_LOT0.

Cc: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit 6fc97fafce05eee76479ca6d289241772d21b370)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 5330a894ed44e18ba8eb038fbc1060eac34ad8bc
      https://github.com/qemu/qemu/commit/5330a894ed44e18ba8eb038fbc1060eac34ad8bc
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M monitor.c

  Log Message:
  -----------
  monitor: don't try to initialize json parser when monitor is HMP

Reported-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 26efaca377e004b79ff50a6e936d029a0c095b8b)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 1d34dff02fad135a64266e670f01ac3c6a408fa1
      https://github.com/qemu/qemu/commit/1d34dff02fad135a64266e670f01ac3c6a408fa1
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M hw/acpi_piix4.c
    M hw/qdev.c
    M hw/xen_platform.c
    M qom/object.c

  Log Message:
  -----------
  qom: object_delete should unparent the object first

object_deinit is only called when the reference count goes to zero,
and yet tries to do an object_unparent.  Now, object_unparent
either does nothing or it will decrease the reference count.
Because we know the reference count is zero, the object_unparent
call in object_deinit is useless.

Instead, we need to disconnect the object from its parent just
before we remove the last reference apart from the parent's.  This
happens in object_delete.  Once we do this, all calls to
object_unparent peppered through QEMU can go away.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit da5a44e8b0b727681fc33e8d94832d1cae48a788)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 63f7166a80a204e8d6d1732315b5c924d46f31d3
      https://github.com/qemu/qemu/commit/63f7166a80a204e8d6d1732315b5c924d46f31d3
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M hw/ivshmem.c

  Log Message:
  -----------
  ivshmem: fix memory_region_del_eventfd assertion failure

We do not register ioeventfds unless the IVSHMEM_IOEVENTFD feature
is set.  The same feature must be checked before releasing the eventfds.
Regression introduced by commit 563027c (ivshmem: use EventNotifier and
memory API, 2012-07-05).

Reported-by: Cam Macdonnell &lt;cam@cs.ualberta.ca&gt;
Tested-by: Cam Macdonnell &lt;cam@cs.ualberta.ca&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 98609cd8fcf755c0ba7049d751353b8b2e243b65)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 0214b6b4deb87d70bfc5fb00ba62f85fcf06f8ab
      https://github.com/qemu/qemu/commit/0214b6b4deb87d70bfc5fb00ba62f85fcf06f8ab
  Author: Matthew Ogilvie &lt;mmogilvi_qemu@miniinfo.net&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M target-i386/translate.c

  Log Message:
  -----------
  target-i386/translate.c: mov to/from crN/drN: ignore mod bits

&gt; This instruction is always treated as a register-to-register (MOD = 11)
&gt; instruction, regardless of the encoding of the MOD field in the MODR/M
&gt; byte.

Also, Microport UNIX System V/386 v 2.1 (ca 1987) runs fine on
real Intel 386 and 486 CPU's (at least), but does not run in qemu without
this patch.

Signed-off-by: Matthew Ogilvie &lt;mmogilvi_qemu@miniinfo.net&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;
(cherry picked from commit 5c73b757e3aa80dc84352b2ede0d8bdea5419f6d)

Conflicts:

	target-i386/translate.c

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 0ba3d50242573c3c821f275e6061655b7e6d4ae1
      https://github.com/qemu/qemu/commit/0ba3d50242573c3c821f275e6061655b7e6d4ae1
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M tcg/arm/tcg-target.c

  Log Message:
  -----------
  tcg/arm: Fix broken CONFIG_TCG_PASS_AREG0 code

The CONFIG_TCG_PASS_AREG0 code for calling ld/st helpers was
broken in that it did not respect the ABI requirement that 64
bit values were passed in even-odd register pairs. The simplest
way to fix this is to implement some new utility functions
for marshalling function arguments into the correct registers
and stack, so that the code which sets up the address and
data arguments does not need to care whether there has been
a preceding env argument.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
(cherry picked from commit 9716ef3b1b48ebbb4b6515fb4685a5db96ce41d9)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ec16f35e4e448a11741263c08bf4e76533c435c8
      https://github.com/qemu/qemu/commit/ec16f35e4e448a11741263c08bf4e76533c435c8
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M tcg/ia64/tcg-target.c

  Log Message:
  -----------
  tcg/ia64: fix prologue/epilogue

Prologue and epilogue code has been broken in cea5f9a28.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit 18d445b443a5fa06a7c2819a170623b970afb3fb)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 50462f2ca8098aff7d947772446b6060e2f59f79
      https://github.com/qemu/qemu/commit/50462f2ca8098aff7d947772446b6060e2f59f79
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M tcg/ia64/tcg-target.c

  Log Message:
  -----------
  tcg/ia64: fix and optimize ld/st slow path

Store slow path has been broken in e141ab52d:
- the arguments are shifted before the last one (mem_index) is written.
- the shift is done for both slow and fast paths.

Fix that. Also optimize a bit by bundling the move together. This still
can be optimized, but it's better to wait for a decision to be taken on
the arguments order.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit d03c98d80ffb7c561d9e6874580f52fe7ecc8c6c)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 9a32fb28244272f4e57145646a5f4b67edb6e111
      https://github.com/qemu/qemu/commit/9a32fb28244272f4e57145646a5f4b67edb6e111
  Author: Richard Sandiford &lt;rdsandiford@googlemail.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  Fix operands of RECIP2.S and RECIP2.PS

Read the second input operand of RECIP2.S and RECIP2.PS from FT rather
than FD.  RECIP2.D is already correct.

Signed-off-by: Richard Sandiford &lt;rdsandiford@googlemail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit d22d7289877ecd3ef86570f6f6d0574da40711dc)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: bc4321e754e8fadac0d8173c73719700a8c98d4a
      https://github.com/qemu/qemu/commit/bc4321e754e8fadac0d8173c73719700a8c98d4a
  Author: Richard Sandiford &lt;rdsandiford@googlemail.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  Fix order of CVT.PS.S operands

The FS input to CVT.PS.S is the high half and FT is the low half.
tcg_gen_concat_i32_i64 takes the low half first, so the operands
were in the wrong order.

Signed-off-by: Richard Sandiford &lt;rdsandiford@googlemail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit 13d24f49720a3e7b35a21222ef182c8513f139db)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 2f0f684cce95a9e0ef709cc2614fd1512cf0bb85
      https://github.com/qemu/qemu/commit/2f0f684cce95a9e0ef709cc2614fd1512cf0bb85
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Streamline indexed cp1 memory addressing.

We've already eliminated both base and index being zero.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit 05168674505153a641c7bfddb691d2eda11d13d1)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 8d45ae83523ae29fc05c6a3f7af3d863e3af18e7
      https://github.com/qemu/qemu/commit/8d45ae83523ae29fc05c6a3f7af3d863e3af18e7
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  mips-linux-user: Always support rdhwr.

The kernel will emulate this instruction if it's not supported
natively.  This insn is used for TLS, among other things, and
so is required by modern glibc.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Cc: Riku Voipio &lt;riku.voipio@iki.fi&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit b3167288367f79754b74ad933146e37938ebff13)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 57708c532fb37163c445e7e4827e182cce2bbf60
      https://github.com/qemu/qemu/commit/57708c532fb37163c445e7e4827e182cce2bbf60
  Author: Eric Johnson &lt;ericj@mips.com&gt;
  Date:   2012-08-28 (Tue, 28 Aug 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: add privilege level check to several Cop0 instructions

The MIPS Architecture Verification Programs (AVPs) check privileged
instructions for the required privilege level.  These changes are needed
to pass the AVP suite.

Signed-off-by: Eric Johnson &lt;ericj@mips.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit 2e15497c5b8d0d172dece0cf56e2d2e977a6b679)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 849c8651553ecbbb29993880b8709b0ab8e27ab1
      https://github.com/qemu/qemu/commit/849c8651553ecbbb29993880b8709b0ab8e27ab1
  Author: Eric Johnson &lt;ericj@mips.com&gt;
  Date:   2012-08-28 (Tue, 28 Aug 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: allow microMIPS SWP and SDP to have RD equal to BASE

The microMIPS SWP and SDP instructions do not modify GPRs.  So their
behavior is well defined when RD equals BASE.  The MIPS Architecture
Verification Programs (AVPs) check that they work as expected.  This
is required for AVPs to pass.

Signed-off-by: Eric Johnson &lt;ericj@mips.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit 36c6711bbe79642b0102416a9dd4243505e874a6)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 256c89943262c4a10f4a1604d73918d37adad24e
      https://github.com/qemu/qemu/commit/256c89943262c4a10f4a1604d73918d37adad24e
  Author: munkyu.im &lt;munkyu.im@samsung.com&gt;
  Date:   2012-08-28 (Tue, 28 Aug 2012)

  Changed paths:
    M audio/winwaveaudio.c

  Log Message:
  -----------
  audio/winwave: previous audio buffer should be flushed

Winwave audio backend has problem with pausing and restart audio out.
Unlike other backends, Winwave pausing API does not flush audio buffer.
As a result, the previous audio data are played in front of
user expected sound when user restart audio.
So changes it to waveOutReset()

Signed-off-by: Munkyu Im &lt;munkyu.im@samsung.com&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;
(cherry picked from commit 13ef70f64e9e4d7583fbd9918d8ea76194023d37)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 69c67eca97298c37b084ddd6c961625079682579
      https://github.com/qemu/qemu/commit/69c67eca97298c37b084ddd6c961625079682579
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-08-28 (Tue, 28 Aug 2012)

  Changed paths:
    M tcg/mips/tcg-target.c

  Log Message:
  -----------
  tcg/mips: fix broken CONFIG_TCG_PASS_AREG0 code

The CONFIG_TCG_PASS_AREG0 code for calling ld/st helpers was
broken in that it did not respect the ABI requirement that 64
bit values were passed in even-odd register pairs. The simplest
way to fix this is to implement some new utility functions
for marshalling function arguments into the correct registers
and stack, so that the code which sets up the address and
data arguments does not need to care whether there has been
a preceding env argument.

Based on commit 9716ef3b for ARM by Peter Maydell.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
(cherry picked from commit 18fec301cd2a38f72a5eeba2656a0c5b4fa69fb7)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 450ead742ae119b9862c3385b9a27060c4364483
      https://github.com/qemu/qemu/commit/450ead742ae119b9862c3385b9a27060c4364483
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-30 (Thu, 30 Aug 2012)

  Changed paths:
    M hw/arm_gic.c

  Log Message:
  -----------
  hw/arm_gic.c: Define .class_size in arm_gic_info TypeInfo

Add the missing .class_size definition to the arm_gic_info TypeInfo.
This fixes the memory corruption and possible segfault that otherwise
results when the class struct is allocated at too small a size and
the class init function writes off the end of it.

Reported-by: Adam Lackorzynski &lt;adam@os.inf.tu-dresden.de&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 998a74bcda7f3297813732ddc2f28ffe5a12e37a)

 - ARMGICClass isn't in 1.1, set class size to SysBusDeviceClass instead

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 57fa9fb4efa5aa3382045db2a1970279d49e63f5
      https://github.com/qemu/qemu/commit/57fa9fb4efa5aa3382045db2a1970279d49e63f5
  Author: Cam Macdonell &lt;cam@cs.ualberta.ca&gt;
  Date:   2012-08-30 (Thu, 30 Aug 2012)

  Changed paths:
    M hw/ivshmem.c

  Log Message:
  -----------
  ivshmem: remove redundant ioeventfd configuration

setup_ioeventfds() is unnecessary and actually causes a segfault when used
ioeventfd=on is used on the command-line.  Since ioeventfds are handled within
the memory API, it can be removed.

Signed-off-by: Cam Macdonell &lt;cam@cs.ualberta.ca&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 7e7de876ae9bdb1b994dee148c6dc009ce94c48e)

Conflicts:

	hw/ivshmem.c

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 25c0807e3ca1026b245243e156e764cf989be6bf
      https://github.com/qemu/qemu/commit/25c0807e3ca1026b245243e156e764cf989be6bf
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-08-30 (Thu, 30 Aug 2012)

  Changed paths:
    M memory.c

  Log Message:
  -----------
  memory: Fix copy&amp;paste mistake in memory_region_iorange_write

The last argument of find_portio is "write", so this must be true here.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 7e2a62d82a3f1397acd67685c3008046eba8344b)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: cccb5446a6d1083b51d851ef5a4f1acff9173127
      https://github.com/qemu/qemu/commit/cccb5446a6d1083b51d851ef5a4f1acff9173127
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-08-30 (Thu, 30 Aug 2012)

  Changed paths:
    M qemu-ga.c

  Log Message:
  -----------
  qemu-ga: Fix null pointer passed to unlink in failure branch

Clang reports this warning:

Null pointer passed as an argument to a 'nonnull' parameter

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 4bdb1a3059d7d3a931de0748a2eec39a0ab41b4e)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 28846ad3b556458674f03323cac3144dcc3cd5e2
      https://github.com/qemu/qemu/commit/28846ad3b556458674f03323cac3144dcc3cd5e2
  Author: Stefano Stabellini &lt;stefano.stabellini@eu.citrix.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M qemu-timer.c

  Log Message:
  -----------
  qemu_rearm_alarm_timer: do not call rearm if the next deadline is INT64_MAX

qemu_rearm_alarm_timer partially duplicates the code in
qemu_next_alarm_deadline to figure out if it needs to rearm the timer.
If it calls qemu_next_alarm_deadline, it always rearms the timer even if
the next deadline is INT64_MAX.

This patch simplifies the behavior of qemu_rearm_alarm_timer and removes
the duplicated code, always calling qemu_next_alarm_deadline and only
rearming the timer if the deadline is less than INT64_MAX.

Signed-off-by: Stefano Stabellini &lt;stefano.stabellini@eu.citrix.com&gt;
Reviewed-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Tested-by: Andreas FÃ¤rber &lt;andreas.faerber@web.de&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
(cherry picked from commit 8227421e0476d9caf2a9a089465bb40c23834e33)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 219a7482ab5866c64fc5a815381737ef8cf77f63
      https://github.com/qemu/qemu/commit/219a7482ab5866c64fc5a815381737ef8cf77f63
  Author: Gleb Natapov &lt;gleb@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M hw/acpi_piix4.c

  Log Message:
  -----------
  reset PMBA and PMREGMISC PIIX4 registers.

The bug causes Windows + OVMF hang after reboot since OVMF
checks PMREGMISC to see if IO space is enabled and skip
configuration if it is.

Reviewed-by: Laszlo Ersek &lt;lersek@redhat.com&gt;
Signed-off-by: Gleb Natapov &lt;gleb@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 4d09d37c6aa9a02b44b1fdb6268820fab92499bd)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: ce4fc986e576536b0998a7f8e963c0932adda6d0
      https://github.com/qemu/qemu/commit/ce4fc986e576536b0998a7f8e963c0932adda6d0
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M hw/msix.c
    M hw/virtio-pci.c

  Log Message:
  -----------
  msix: make [un]use vectors on reset/load optional

The facility to use/unuse vectors dynamically is helpful
for virtio but little else: everyone just seems to use
vectors in their init function.

Avoid clearing msix vector use info on reset and load.
For virtio, clear it explicitly.
This should fix regressions reported with ivshmem - though
I didn't test this, I verified that virtio keeps
working like it did.

Tested-by: Cam Macdonell &lt;cam@cs.ualberta.ca&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
(cherry picked from commit 3cac001e5ae3c0ceb33e0a1978a48cb5e2482ab2)

Conflicts:

	hw/msix.c
	hw/virtio-pci.c

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: a8cd6f7ddfb9a8514170d79665669be8538d2f96
      https://github.com/qemu/qemu/commit/a8cd6f7ddfb9a8514170d79665669be8538d2f96
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Fix NULL ptr deref when unplugging an USB dev with an iso stream active

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
(cherry picked from commit 7ce86aa1aafaa65e7d3e572873bdf37bdb896f49)

Conflicts:

	hw/usb/hcd-ehci.c

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: c7580c103434c8b96c5a2cd54aaa9a092bb638a7
      https://github.com/qemu/qemu/commit/c7580c103434c8b96c5a2cd54aaa9a092bb638a7
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M target-xtensa/translate.c

  Log Message:
  -----------
  target-xtensa: fix big-endian BBS/BBC implementation

Quote from ISA, 2.1:

For most Xtensa instructions, bit numbering is irrelevant; only the BBC
and BBS instructions assign bit numbers to values on which the processor
operates. The BBC/BBS instructions use big-endian bit ordering (0 is the
most-significant bit) on a big-endian processor configuration.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
(cherry picked from commit 7ff7563fc1c3c57914aafec1753219604346fe18)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 5a16dd9bc80bc1c519c500392122c179a2942b37
      https://github.com/qemu/qemu/commit/5a16dd9bc80bc1c519c500392122c179a2942b37
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M xtensa-semi.c

  Log Message:
  -----------
  target-xtensa: return ENOSYS for unimplemented simcalls

This prevents guest from proceeding with uninitialised garbage returned
from unimplemented simcalls.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
(cherry picked from commit e7eee62a90c671d22d50964b7de05e3f4fd96f5f)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: f965d237b567389661bccb1701a6c94e964d7818
      https://github.com/qemu/qemu/commit/f965d237b567389661bccb1701a6c94e964d7818
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M qemu-timer.c

  Log Message:
  -----------
  qemu-timer: properly arm alarm timer for timers set by device initialization

QEMU will hang when fed the following command-line

  qemu-system-mips -kernel vmlinux-2.6.32-5-4kc-malta -append "console=ttyS0" \
-nographic -net none

The -net none is important otherwise it seems some events are generated
causing the things to work. When it doesn't work, the guest hangs when
measuring the CPU frequency, after the following line:

  [    0.000000] NR_IRQS:256

Pressing a key on the serial port unblocks it, hinting that the problem
is due to the recent elimination of the 1 second timeout in the main
loop.

The problem is that because init_timer_alarm sets the timer's pending
flag to true, the alarm timer is never armed until after the first time
through the main loop.  Thus the bug started when QEMU started testing
the pending flag in qemu_mod_timer (commit 1828be3, more alarm timer
cleanup, 2010-03-10).

But actually, it isn't true at all that a timer is pending when the
alarm timer is created, and the real bug has been latent forever: the
fix is to remove the bogus setting of pending flag.

Reported-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Tested-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Tested-by: Michael Tokarev &lt;mjt@tls.msk.ru&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
(cherry picked from commit de188751da8db3c77a681bf903035a0e5218c463)

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


  Commit: 113f4cd9e96f55df159573282110848b898e6b50
      https://github.com/qemu/qemu/commit/113f4cd9e96f55df159573282110848b898e6b50
  Author: Ian Campbell &lt;ian.campbell@citrix.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M console.c

  Log Message:
  -----------
  console: bounds check whenever changing the cursor due to an escape code

This is XSA-17 / CVE-2012-3515

Signed-off-by: Ian Campbell &lt;ian.campbell@citrix.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 4ce5bc2dd1914a706725186c6563e8f92eedfc84
      https://github.com/qemu/qemu/commit/4ce5bc2dd1914a706725186c6563e8f92eedfc84
  Author: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M VERSION

  Log Message:
  -----------
  update VERSION for 1.1.2

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/785adb09b9fd...4ce5bc2dd191

----==_mimepart_504a8a92c6ceb_58c1637ae4264f--


</body></email><email><emailId>20120908050008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-08 05:00:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] c001ed: target-cris: Fix buffer overflow</subject><body>



----==_mimepart_504ad0d8aa0b9_7cf519cbae81921a
Date: Fri, 07 Sep 2012 22:00:08 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;504ad0d8ab30a_7cf519cbae819379@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: c001ed15f7bfeaa3cabde5c9cc79c4dfdb674769
      https://github.com/qemu/qemu/commit/c001ed15f7bfeaa3cabde5c9cc79c4dfdb674769
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-07 (Fri, 07 Sep 2012)

  Changed paths:
    M target-cris/translate.c

  Log Message:
  -----------
  target-cris: Fix buffer overflow

Report from smatch:

target-cris/translate.c:3464 cpu_dump_state(32) error:
 buffer overflow 'env-&gt;sregs' 4 &lt;= 255

sregs is declared 'uint32_t sregs[4][16]', so the first index must be
less than 4 or ARRAY_SIZE(env-&gt;sregs).

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;




----==_mimepart_504ad0d8aa0b9_7cf519cbae81921a--


</body></email><email><emailId>20120908093009</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-08 09:30:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] c29b1b: target-xtensa: fix missing errno codes for mingw32</subject><body>



----==_mimepart_504b102177783_7cf519cbae83213f
Date: Sat, 08 Sep 2012 02:30:09 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;504b102179490_7cf519cbae832281@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: c29b1bee4b025f51f02cc9f521ca19cb5f3eb432
      https://github.com/qemu/qemu/commit/c29b1bee4b025f51f02cc9f521ca19cb5f3eb432
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-09-08 (Sat, 08 Sep 2012)

  Changed paths:
    M target-xtensa/xtensa-semi.c

  Log Message:
  -----------
  target-xtensa: fix missing errno codes for mingw32

Put the following errno value mappings under #ifdef:

xtensa-semi.c: In function 'errno_h2g':
xtensa-semi.c:113: error: 'ENOTBLK' undeclared (first use in this function)
xtensa-semi.c:113: error: (Each undeclared identifier is reported only once
xtensa-semi.c:113: error: for each function it appears in.)
xtensa-semi.c:113: error: array index in initializer not of integer type
xtensa-semi.c:113: error: (near initialization for 'guest_errno')
xtensa-semi.c:124: error: 'ETXTBSY' undeclared (first use in this function)
xtensa-semi.c:124: error: array index in initializer not of integer type
xtensa-semi.c:124: error: (near initialization for 'guest_errno')
xtensa-semi.c:134: error: 'ELOOP' undeclared (first use in this function)
xtensa-semi.c:134: error: array index in initializer not of integer type
xtensa-semi.c:134: error: (near initialization for 'guest_errno')

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 5acfc8320fdd455c3ee5c21fe7d3403dbc755372
      https://github.com/qemu/qemu/commit/5acfc8320fdd455c3ee5c21fe7d3403dbc755372
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-08 (Sat, 08 Sep 2012)

  Changed paths:
    M target-sparc/fop_helper.c

  Log Message:
  -----------
  target-sparc: fix fcmp{s,d,q} instructions wrt exception

fcmp{s,d,q} instructions are supposed to ignore quiet NaN (contrary to
the fcmpe{s,d,q} instructions), but the current code is wrongly setting
the NV exception in that case. Moreover the current code is duplicated:
first the arguments are checked for NaN to generate an exception, and
later in case the comparison is unordered (which can only happens if one
of the argument is a NaN), the same check is done to generate an
exception.

Fix that by calling clear_float_exceptions() followed by
check_ieee_exceptions() as for the other floating point instructions.
Use the _compare_quiet functions for fcmp{s,d,q} and the _compare ones
for fcmpe{s,d,q}. Simplify the flag setting by not clearing a flag that
is set the line just below.

This fix allows the math glibc testsuite to pass.

Cc: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: ce6c760c37b9a88db87c5b9b9bf39ca866e570f6
      https://github.com/qemu/qemu/commit/ce6c760c37b9a88db87c5b9b9bf39ca866e570f6
  Author: Fabien Chouteau &lt;chouteau@adacore.com&gt;
  Date:   2012-09-08 (Sat, 08 Sep 2012)

  Changed paths:
    M MAINTAINERS

  Log Message:
  -----------
  Add MAINTAINERS entry for leon3

Signed-off-by: Fabien Chouteau &lt;chouteau@adacore.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/c001ed15f7bf...ce6c760c37b9

----==_mimepart_504b102177783_7cf519cbae83213f--


</body></email><email><emailId>20120908103007</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-08 10:30:07-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 0c2672: musicpal: Fix flash mapping</subject><body>



----==_mimepart_504b1e2f4e107_7cf519cbae8354a7
Date: Sat, 08 Sep 2012 03:30:07 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;504b1e2f4f4ed_7cf519cbae8355c0@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 0c267217ca9985e6d118ec8368bebd382db7a099
      https://github.com/qemu/qemu/commit/0c267217ca9985e6d118ec8368bebd382db7a099
  Author: Jan Kiszka &lt;jan.kiszka@web.de&gt;
  Date:   2012-09-08 (Sat, 08 Sep 2012)

  Changed paths:
    M hw/musicpal.c

  Log Message:
  -----------
  musicpal: Fix flash mapping

The old arithmetic assumed 32 physical address bits which is no longer
true for ARM since 3cc0cd61f4.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@web.de&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;




----==_mimepart_504b1e2f4e107_7cf519cbae8354a7--


</body></email><email><emailId>20120910133014</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-10 13:30:14-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] fa779b: Add support for pretty-printing response in qmp-sh...</subject><body>



----==_mimepart_504deb6631be4_43361157aec154194
Date: Mon, 10 Sep 2012 06:30:14 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;504deb6638a88_43361157aec1542c9@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: fa779b65fa77d5632df1f8b2df33e9023dbc4cc8
      https://github.com/qemu/qemu/commit/fa779b65fa77d5632df1f8b2df33e9023dbc4cc8
  Author: Daniel P. Berrange &lt;berrange@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M QMP/qmp-shell

  Log Message:
  -----------
  Add support for pretty-printing response in qmp-shell

Add a '-p' arg to the QMP/qmp-shell test program, which uses
the python pprint module to pretty-print the dictionary
returned from a command

  $ qmp-shell -p /tmp/qemu
  Welcome to the QMP low-level shell!
  Connected to QEMU 1.1.50

  (QEMU) query-cpus
  {   u'return': [   {   u'CPU': 0,
                   u'current': True,
                   u'halted': True,
                   u'pc': 1048556,
                   u'thread_id': 7108}]}

Signed-off-by: Daniel P. Berrange &lt;berrange@redhat.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 886cc706ce5d4d3d1c296f028ddc2991cfbe3bbe
      https://github.com/qemu/qemu/commit/886cc706ce5d4d3d1c296f028ddc2991cfbe3bbe
  Author: Amos Kong &lt;akong@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M hmp-commands.hx

  Log Message:
  -----------
  fix doc of using raw values with sendkey

(qemu) sendkey a
(qemu) sendkey 0x1e
(qemu) sendkey #0x1e
 unknown key: '#0x1e'

The last command doesn't work, '#' is not requested before
raw values, and the raw value in decimal format is not supported.

Signed-off-by: Amos Kong &lt;akong@redhat.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: cd383492bfb5ea805d518e129d7a5402c7b99ef2
      https://github.com/qemu/qemu/commit/cd383492bfb5ea805d518e129d7a5402c7b99ef2
  Author: Amos Kong &lt;akong@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M monitor.c

  Log Message:
  -----------
  monitor: rename keyname '&lt;' to 'less'

There are many maps of keycode 0x56 in pc-bios/keymaps/*
  pc-bios/keymaps/common:less 0x56
  pc-bios/keymaps/common:greater 0x56 shift
  pc-bios/keymaps/common:bar 0x56 altgr
  pc-bios/keymaps/common:brokenbar 0x56 shift altgr

This patch just renamed '&lt;' to 'less', QAPI might add new
variable by adding a prefix to keyname, '$PREFIX_&lt;' is not
available, '$PREFIX_less' is ok.

For compatibility, convert user inputted '&lt;' to 'less'.

Signed-off-by: Amos Kong &lt;akong@redhat.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 2ef20c15b4736c9b0afc7ef2b14239182fbcd3e1
      https://github.com/qemu/qemu/commit/2ef20c15b4736c9b0afc7ef2b14239182fbcd3e1
  Author: Amos Kong &lt;akong@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M hmp-commands.hx
    M monitor.c

  Log Message:
  -----------
  hmp: rename arguments

Rename 'string' to 'keys', rename 'hold_time' to 'hold-time'.

Signed-off-by: Amos Kong &lt;akong@redhat.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: b9c4b48d50057b6aee7c70879b240ff76f39c85b
      https://github.com/qemu/qemu/commit/b9c4b48d50057b6aee7c70879b240ff76f39c85b
  Author: Amos Kong &lt;akong@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M scripts/qapi-types.py
    M scripts/qapi-visit.py

  Log Message:
  -----------
  qapi: generate list struct and visit_list for enum

Currently, if we define an 'enum' and use it in one command's
data, list struct for enum could not be generated, but it's
used in qmp function.

For example: KeyCodesList could not be generated.
&gt;&gt;&gt; qapi-schema.json:
{ 'enum': 'KeyCodes',
  'data': [ 'shift', 'alt' ... ] }
{ 'command': 'sendkey',
  'data': { 'keys': ['KeyCodes'], '*hold-time': 'int' } }

&gt;&gt;&gt; qmp-command.h:
void qmp_sendkey(KeyCodesList * keys, bool has_hold_time, int64_t
hold_time, Error **errp);

This patch lets qapi generate list struct and visit_list for enum.

Signed-off-by: Amos Kong &lt;akong@redhat.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 411656f48d71131d6d1cb5b6db792fc7b451e72e
      https://github.com/qemu/qemu/commit/411656f48d71131d6d1cb5b6db792fc7b451e72e
  Author: Amos Kong &lt;akong@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M qapi-schema.json

  Log Message:
  -----------
  qapi: add the QKeyCode enum

key_defs[] in monitor.c is a mapping table of keys and keycodes,
this patch added a QKeyCode enum. Key's index in the enmu is same
as keycode's index in key_defs[].

Signed-off-by: Amos Kong &lt;akong@redhat.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 1048c88f03545fa42bdebb077871a743a614d2ab
      https://github.com/qemu/qemu/commit/1048c88f03545fa42bdebb077871a743a614d2ab
  Author: Amos Kong &lt;akong@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M console.h
    M input.c
    M monitor.c

  Log Message:
  -----------
  monitor: move key_defs[] table and introduce two help functions

This patch added two help functions to convert key/code to index of
mapping table, those functions will return Q_KEY_CODE_MAX if the
code/key is invalid.

Patch also moved key_defs[] to input.c, and removed useless KeyDef struct.
Key's index in QKeyCode enmu is same as keycode's index in new key_defs[].
Monitor functions were changed to access key_defs[] directly.

key_defs[] is used in do_send_key(), so export key_defs[]. It will be
changed to static in next patch.

Signed-off-by: Amos Kong &lt;akong@redhat.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: e4c8f004c55d9da3eae3e14df740238bf805b5d6
      https://github.com/qemu/qemu/commit/e4c8f004c55d9da3eae3e14df740238bf805b5d6
  Author: Amos Kong &lt;akong@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M console.h
    M hmp-commands.hx
    M hmp.c
    M hmp.h
    M input.c
    M monitor.c
    M qapi-schema.json
    M qmp-commands.hx

  Log Message:
  -----------
  qapi: convert sendkey

Convert 'sendkey' to use QAPI.

QAPI passes key's index of mapping table to qmp_send_key(),
not keycode. So we use help functions to convert key/code to
index of key_defs, and 'index' will be converted to 'keycode'
inside qmp_send_key().

For qmp, QAPI would check invalid key and raise error.
For hmp, invalid key is checked in hmp_send_key().

'send-key' of QMP doesn't support key in hexadecimal format.

Signed-off-by: Amos Kong &lt;akong@redhat.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 227ccf6bff234c29974c2c18ecd3a29e6b965e3d
      https://github.com/qemu/qemu/commit/227ccf6bff234c29974c2c18ecd3a29e6b965e3d
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M scripts/qapi-visit.py

  Log Message:
  -----------
  qapi: Fix potential NULL pointer segfault

Report from smatch:

qapi-visit.c:1640 visit_type_BlockdevAction(8) error:
 we previously assumed 'obj' could be null (see line 1639)
qapi-visit.c:2432 visit_type_NetClientOptions(8) error:
 we previously assumed 'obj' could be null (see line 2431)

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 149474c93490e1c66f838391bd491db83136d91d
      https://github.com/qemu/qemu/commit/149474c93490e1c66f838391bd491db83136d91d
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M qobject.h

  Log Message:
  -----------
  json-parser: Fix potential NULL pointer segfault

Report from smatch:
json-parser.c:474 parse_object(62) error: potential null derefence 'dict'.
json-parser.c:553 parse_array(75) error: potential null derefence 'list'.

Label 'out' in json-parser.c can be called with list == NULL
which is passed to QDECREF.

Modify QDECREF to handle a NULL argument (inline function qobject_decref
already handles them, too).

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 75d789f8d38be693bbee3e77b558e59012e33997
      https://github.com/qemu/qemu/commit/75d789f8d38be693bbee3e77b558e59012e33997
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M error.h

  Log Message:
  -----------
  error: add error_setg()

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: d7098135d4baac8141b2e76f2daa8a7f61599c72
      https://github.com/qemu/qemu/commit/d7098135d4baac8141b2e76f2daa8a7f61599c72
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M console.c
    M console.h
    M hw/blizzard.c
    M hw/g364fb.c
    M hw/omap_lcdc.c
    M hw/qxl.c
    M hw/tcx.c
    M hw/vga.c
    M hw/vmware_vga.c

  Log Message:
  -----------
  console: vga_hw_screen_dump_ptr: take Error argument

All devices that register a screen dump callback via
graphic_console_init() are updated.

The new argument is not used in this commit. Error handling will
be added to each device individually later.

This change is a preparation to convert the screendump command
to the QAPI.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: ad39cf6d150e951e4c67c8120d495ae7e78054a6
      https://github.com/qemu/qemu/commit/ad39cf6d150e951e4c67c8120d495ae7e78054a6
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M console.c
    M console.h
    M hmp-commands.hx
    M hmp.c
    M hmp.h
    M monitor.c
    M qapi-schema.json
    M qmp-commands.hx

  Log Message:
  -----------
  qapi: convert screendump

Next commits will update devices to propagate errors.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: d663174dcd9623c44f3af2a46de2a55d16f15c19
      https://github.com/qemu/qemu/commit/d663174dcd9623c44f3af2a46de2a55d16f15c19
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M hw/blizzard.c
    M hw/qxl.c
    M hw/vga.c
    M hw/vga_int.h
    M hw/vmware_vga.c

  Log Message:
  -----------
  vga: ppm_save(): add error handling

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 8dc4cc7bb57d3f0d6a1d8ba372d9eda1494bcc64
      https://github.com/qemu/qemu/commit/8dc4cc7bb57d3f0d6a1d8ba372d9eda1494bcc64
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M hw/omap_lcdc.c

  Log Message:
  -----------
  omap_lcdc: rename ppm_save() to omap_ppm_save()

Avoids confusion with the global ppm_save() defined in hw/vga.c.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: d9c7ebb10042a7d29d50b47c110e5cb754293d89
      https://github.com/qemu/qemu/commit/d9c7ebb10042a7d29d50b47c110e5cb754293d89
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M hw/omap_lcdc.c

  Log Message:
  -----------
  omap_lcdc: omap_ppm_save(): add error handling

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 61a3f955c1caca775729fc59e97fb9c97808ffca
      https://github.com/qemu/qemu/commit/61a3f955c1caca775729fc59e97fb9c97808ffca
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M hw/g364fb.c

  Log Message:
  -----------
  g364fb: g364fb_screen_dump(): add error handling

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 537f2d2b0d4c27e21b3e610e57d6511e315d76cc
      https://github.com/qemu/qemu/commit/537f2d2b0d4c27e21b3e610e57d6511e315d76cc
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M hw/tcx.c

  Log Message:
  -----------
  tcx: tcx24_screen_dump(): add error handling

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 0ab6b63655ba59d7c05089017acb721a44979526
      https://github.com/qemu/qemu/commit/0ab6b63655ba59d7c05089017acb721a44979526
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M hw/tcx.c

  Log Message:
  -----------
  tcx: tcx_screen_dump(): add error handling

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 71e470886fb6092504503a5fe41092ace71c096c
      https://github.com/qemu/qemu/commit/71e470886fb6092504503a5fe41092ace71c096c
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M target-s390x/helper.c
    M target-s390x/op_helper.c

  Log Message:
  -----------
  target-s390x: fix style

Before splitting op_helper.c and helper.c in the next patches,
fix style issues. No functional changes.

Replace also GCC specific __FUNCTION__ with
standard __func__.

Don't init static variable (cpu_s390x_init:inited) with 0.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: e72ca652aa08e3d07c59349f239ba596f27c97af
      https://github.com/qemu/qemu/commit/e72ca652aa08e3d07c59349f239ba596f27c97af
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M target-s390x/Makefile.objs
    M target-s390x/cpu.h
    A target-s390x/fpu_helper.c
    M target-s390x/op_helper.c
    M target-s390x/translate.c

  Log Message:
  -----------
  target-s390x: split FPU ops

Move floating point instructions to fpu_helper.c.

While exporting some condition code helpers,
avoid duplicate identifier conflict with translate.c.

Remove unused set_cc_nz_f64() in translate.c.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: a78b0504e8d5487fca77b6b0cd8d3c98b9bace8c
      https://github.com/qemu/qemu/commit/a78b0504e8d5487fca77b6b0cd8d3c98b9bace8c
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M target-s390x/Makefile.objs
    A target-s390x/cc_helper.c
    M target-s390x/cpu.h
    M target-s390x/op_helper.c

  Log Message:
  -----------
  target-s390x: split condition code helpers

Move condition code helpers to cc_helper.c.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: fc8d72c2d34afd6789e8c4374d275a5f69c603f1
      https://github.com/qemu/qemu/commit/fc8d72c2d34afd6789e8c4374d275a5f69c603f1
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M target-s390x/Makefile.objs
    A target-s390x/int_helper.c
    M target-s390x/op_helper.c

  Log Message:
  -----------
  target-s390x: split integer helpers

Move integer helpers to int_helper.c.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 8ef7f78e190b3a34e167a31c9a8e43c813c7ff78
      https://github.com/qemu/qemu/commit/8ef7f78e190b3a34e167a31c9a8e43c813c7ff78
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M target-s390x/Makefile.objs
    A target-s390x/mem_helper.c
    M target-s390x/op_helper.c

  Log Message:
  -----------
  target-s390x: split memory access helpers

Move memory access helpers to mem_helper.c.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
[agraf: fold softmmu include ifdefs together]
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: aea1e885b2b59cf93d0db9356fd5bb6cb1780f01
      https://github.com/qemu/qemu/commit/aea1e885b2b59cf93d0db9356fd5bb6cb1780f01
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M target-s390x/Makefile.objs
    M target-s390x/cpu.h
    A target-s390x/misc_helper.c
    R target-s390x/op_helper.c

  Log Message:
  -----------
  target-s390x: rename op_helper.c to misc_helper.c

Now op_helper.c contains miscellaneous helpers, rename
it to misc_helper.c.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
[agraf: fix conflict]
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 449c0d70b6d5692bafd8b028e2a8a4e0ed7076fe
      https://github.com/qemu/qemu/commit/449c0d70b6d5692bafd8b028e2a8a4e0ed7076fe
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M target-s390x/Makefile.objs
    M target-s390x/cc_helper.c
    M target-s390x/cpu.h
    M target-s390x/fpu_helper.c
    M target-s390x/helper.h
    M target-s390x/mem_helper.c
    M target-s390x/translate.c

  Log Message:
  -----------
  target-s390x: avoid AREG0 for FPU helpers

Make FPU helpers take a parameter for CPUState instead
of relying on global env.

Introduce temporary wrappers for FPU load and store ops.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 4fda26a7b0d6ffbb4055ab8b756cd94647f5fd22
      https://github.com/qemu/qemu/commit/4fda26a7b0d6ffbb4055ab8b756cd94647f5fd22
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M target-s390x/Makefile.objs
    M target-s390x/helper.h
    M target-s390x/int_helper.c
    M target-s390x/translate.c

  Log Message:
  -----------
  target-s390x: avoid AREG0 for integer helpers

Make integer helpers take a parameter for CPUState instead
of relying on global env.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 932385a367b2c67f1ea7148dcafb013db188cd23
      https://github.com/qemu/qemu/commit/932385a367b2c67f1ea7148dcafb013db188cd23
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M target-s390x/Makefile.objs
    M target-s390x/cc_helper.c
    M target-s390x/helper.h
    M target-s390x/translate.c

  Log Message:
  -----------
  target-s390x: avoid AREG0 for condition code helpers

Make condition code helpers take a parameter for CPUState instead
of relying on global env.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 089f5c06926105a35df461003ae32b7387ed4236
      https://github.com/qemu/qemu/commit/089f5c06926105a35df461003ae32b7387ed4236
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M target-s390x/Makefile.objs
    M target-s390x/helper.h
    M target-s390x/mem_helper.c
    M target-s390x/misc_helper.c
    M target-s390x/translate.c

  Log Message:
  -----------
  target-s390x: avoid AREG0 for misc helpers

Make misc helpers take a parameter for CPUState instead
of relying on global env.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
[agraf: fix conflict]
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 19b0516fb4fd22b08c6ee42ea4162aaf3b9c8ee1
      https://github.com/qemu/qemu/commit/19b0516fb4fd22b08c6ee42ea4162aaf3b9c8ee1
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M configure
    M target-s390x/Makefile.objs
    M target-s390x/cpu.h
    M target-s390x/fpu_helper.c
    M target-s390x/helper.c
    M target-s390x/helper.h
    M target-s390x/mem_helper.c
    M target-s390x/misc_helper.c
    M target-s390x/translate.c

  Log Message:
  -----------
  target-s390x: switch to AREG0 free mode

Add an explicit CPUState parameter instead of relying on AREG0.

Remove temporary wrappers and switch to AREG0 free mode.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
[agraf: fix conflicts]
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 6845df48cec9cc6833429942b3ceed333a791119
      https://github.com/qemu/qemu/commit/6845df48cec9cc6833429942b3ceed333a791119
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M tcg/s390/tcg-target.c

  Log Message:
  -----------
  tcg/s390: fix ld/st with CONFIG_TCG_PASS_AREG0

The load/store slow path has been broken in e141ab52d:
- We need to move 4 registers for store functions and 3 registers for
  load functions and not the reverse.
- According to the s390x calling convention the arguments of a function
  should be zero extended. This means that the register shift should be
  done with TCG_TYPE_I64 to ensure the higher word is correctly zero
  extended when needed.

I am aware that CONFIG_TCG_PASS_AREG0 is being removed and thus that
this patch can be improved, but doing so means it can also be applied to
the 1.1 and 1.2 stable branches.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 149eeb5fe57b853081e8059575d91b8a58a4f96c
      https://github.com/qemu/qemu/commit/149eeb5fe57b853081e8059575d91b8a58a4f96c
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/wm8750.c

  Log Message:
  -----------
  hw/wm8750: Fix potential buffer overflow

Report from smatch:

hw/wm8750.c:369 wm8750_tx(12) error: buffer overflow 's-&gt;i2c_data' 2 &lt;= 2

It looks like the preprocessor statements were simply misplaced.

Replace also __FUNCTION__ by __func__ to please checkpatch.pl.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt; 
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 599d64f6dc10f267a45e7abebfcafd8e7626585b
      https://github.com/qemu/qemu/commit/599d64f6dc10f267a45e7abebfcafd8e7626585b
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M target-arm/helper.c

  Log Message:
  -----------
  target-arm: Fix potential buffer overflow

Report from smatch:

target-arm/helper.c:651 arm946_prbs_read(6) error:
 buffer overflow 'env-&gt;cp15.c6_region' 8 &lt;= 8
target-arm/helper.c:661 arm946_prbs_write(6) error:
 buffer overflow 'env-&gt;cp15.c6_region' 8 &lt;= 8

c7_region is an array with 8 elements, so the index must be less than 8.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: a32354e206895400d17c3de9a8df1de96d3df289
      https://github.com/qemu/qemu/commit/a32354e206895400d17c3de9a8df1de96d3df289
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/mcf5206.c

  Log Message:
  -----------
  hw/mcf5206: Fix buffer overflow for MBAR read / write

Report from smatch:

mcf5206.c:384 m5206_mbar_readb(7) error: buffer overflow 'm5206_mbar_width' 128 &lt;= 128
mcf5206.c:403 m5206_mbar_readw(8) error: buffer overflow 'm5206_mbar_width' 128 &lt;= 128
mcf5206.c:427 m5206_mbar_readl(8) error: buffer overflow 'm5206_mbar_width' 128 &lt;= 128
mcf5206.c:451 m5206_mbar_writeb(9) error: buffer overflow 'm5206_mbar_width' 128 &lt;= 128
mcf5206.c:475 m5206_mbar_writew(9) error: buffer overflow 'm5206_mbar_width' 128 &lt;= 128
mcf5206.c:503 m5206_mbar_writel(9) error: buffer overflow 'm5206_mbar_width' 128 &lt;= 128

m5206_mbar_width has 0x80 elements and supports 0 &lt;= offset &lt; 0x200.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: e22b1e9907833d72f4a959b34c5eefc3533c7711
      https://github.com/qemu/qemu/commit/e22b1e9907833d72f4a959b34c5eefc3533c7711
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M QMP/qmp-shell
    M console.c
    M console.h
    M error.h
    M hmp-commands.hx
    M hmp.c
    M hmp.h
    M hw/blizzard.c
    M hw/g364fb.c
    M hw/omap_lcdc.c
    M hw/qxl.c
    M hw/tcx.c
    M hw/vga.c
    M hw/vga_int.h
    M hw/vmware_vga.c
    M input.c
    M monitor.c
    M qapi-schema.json
    M qmp-commands.hx
    M qobject.h
    M scripts/qapi-types.py
    M scripts/qapi-visit.py

  Log Message:
  -----------
  Merge branch 'queue/qmp' of git://repo.or.cz/qemu/qmp-unstable

* 'queue/qmp' of git://repo.or.cz/qemu/qmp-unstable:
  tcx: tcx_screen_dump(): add error handling
  tcx: tcx24_screen_dump(): add error handling
  g364fb: g364fb_screen_dump(): add error handling
  omap_lcdc: omap_ppm_save(): add error handling
  omap_lcdc: rename ppm_save() to omap_ppm_save()
  vga: ppm_save(): add error handling
  qapi: convert screendump
  console: vga_hw_screen_dump_ptr: take Error argument
  error: add error_setg()
  json-parser: Fix potential NULL pointer segfault
  qapi: Fix potential NULL pointer segfault
  qapi: convert sendkey
  monitor: move key_defs[] table and introduce two help functions
  qapi: add the QKeyCode enum
  qapi: generate list struct and visit_list for enum
  hmp: rename arguments
  monitor: rename keyname '&lt;' to 'less'
  fix doc of using raw values with sendkey
  Add support for pretty-printing response in qmp-shell


Compare: https://github.com/qemu/qemu/compare/0c267217ca99...e22b1e990783

----==_mimepart_504deb6631be4_43361157aec154194--


</body></email><email><emailId>20120910140013</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-10 14:00:13-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 835cab: spice: abort on invalid streaming cmdline params</subject><body>



----==_mimepart_504df26d99266_159d1a4aaf0195639
Date: Mon, 10 Sep 2012 07:00:13 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;504df26d9cb16_159d1a4aaf019572a@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 835cab85ad83ed8dfe1c13243aeda5959b153e3e
      https://github.com/qemu/qemu/commit/835cab85ad83ed8dfe1c13243aeda5959b153e3e
  Author: Christophe Fergeau &lt;cfergeau@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M ui/spice-core.c

  Log Message:
  -----------
  spice: abort on invalid streaming cmdline params

When parsing its command line parameters, spice aborts when it
finds unexpected values, except for the 'streaming-video' option.
This happens because the parsing of the parameters for this option
is done using the 'name2enum' helper, which does not error out
on unknown values. Using the 'parse_name' helper makes sure we
error out in this case. Looking at git history, the use of
'name2enum' instead of 'parse_name' seems to have been an oversight,
so let's change to that now.

Fixes rhbz#831708

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: f5bb039c6d97ef3e664094eab3c9a4dc1824ed73
      https://github.com/qemu/qemu/commit/f5bb039c6d97ef3e664094eab3c9a4dc1824ed73
  Author: Yonit Halperin &lt;yhalperi@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M ui/spice-core.c

  Log Message:
  -----------
  spice: notify spice server on vm start/stop

Spice server needs to know about the vm state in order to prevent
attempts to write to devices when they are stopped, mainly during
the non-live stage of migration.
Instead, spice will take care of restoring this writes, on the migration
target side, after migration completes.

Signed-off-by: Yonit Halperin &lt;yhalperi@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 71d388d420e68ac77cd42f15f7e68cf5a6fb01b2
      https://github.com/qemu/qemu/commit/71d388d420e68ac77cd42f15f7e68cf5a6fb01b2
  Author: Yonit Halperin &lt;yhalperi@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M hw/qxl.c
    M ui/spice-core.c
    M ui/spice-display.c
    M ui/spice-display.h

  Log Message:
  -----------
  spice: notify on vm state change only via spice_server_vm_start/stop

QXLWorker-&gt;start/stop are deprecated since spice-server 0.11.2

Signed-off-by: Yonit Halperin &lt;yhalperi@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 2fdd16e239c2a2763aa3266e637718123328688c
      https://github.com/qemu/qemu/commit/2fdd16e239c2a2763aa3266e637718123328688c
  Author: Yonit Halperin &lt;yhalperi@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M monitor.c
    M monitor.h
    M ui/spice-core.c

  Log Message:
  -----------
  spice migration: add QEVENT_SPICE_MIGRATE_COMPLETED

When migrating, libvirt queries the migration status, and upon migration
completions, it closes the migration src. On the other hand, when
migration is completed, spice transfers data from the src to destination
via the client. This data is required for keeping the spice session
after migration, without suffering from data loss and inconsistencies.
In order to allow this data transfer, we add QEVENT for signaling
libvirt that spice migration has completed, and libvirt needs to wait
for this event before quitting the src process.

Signed-off-by: Yonit Halperin &lt;yhalperi@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 61c4efe2cb85b0a9c6bc68f6a2dd107c8d7ec080
      https://github.com/qemu/qemu/commit/61c4efe2cb85b0a9c6bc68f6a2dd107c8d7ec080
  Author: Yonit Halperin &lt;yhalperi@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M hmp.c
    M qapi-schema.json
    M ui/spice-core.c

  Log Message:
  -----------
  spice: add 'migrated' flag to spice info

The flag is 'true' when spice migration has completed on the src side.
It is needed for a case where libvirt dies before migration completes
and it misses the event QEVENT_SPICE_MIGRATE_COMPLETED.
When libvirt is restored and queries the migration status, it also needs
to query spice and check if its migration has completed.

Signed-off-by: Yonit Halperin &lt;yhalperi@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 8c9570530c819821b9b5cc3113d2b2966afe7621
      https://github.com/qemu/qemu/commit/8c9570530c819821b9b5cc3113d2b2966afe7621
  Author: Yonit Halperin &lt;yhalperi@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M qemu-config.c
    M qemu-options.hx
    M ui/spice-core.c

  Log Message:
  -----------
  spice: adding seamless-migration option to the command line

The seamless-migration flag is required in order to identify
whether libvirt supports the new QEVENT_SPICE_MIGRATE_COMPLETED or not
(by default the flag is off).
New libvirt versions that wait for QEVENT_SPICE_MIGRATE_COMPLETED should turn on this flag.
When this flag is off, spice fallbacks to its old migration method, which
can result in data loss.

Signed-off-by: Yonit Halperin &lt;yhalperi@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 27af778828db9aa893fa1de928744141e5de20e5
      https://github.com/qemu/qemu/commit/27af778828db9aa893fa1de928744141e5de20e5
  Author: Yonit Halperin &lt;yhalperi@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M qemu-options.hx

  Log Message:
  -----------
  spice: increase the verbosity of spice section in "qemu --help"

Added all spice options to the help string. This can be used by libvirt
to determine which spice related features are supported by qemu.

Signed-off-by: Yonit Halperin &lt;yhalperi@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 511b13e2c9b426b3c56060909693de5097f0b496
      https://github.com/qemu/qemu/commit/511b13e2c9b426b3c56060909693de5097f0b496
  Author: Alon Levy &lt;alevy@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  qxl/update_area_io: guest_bug on invalid parameters

Signed-off-by: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 36839d355e4ffc77d8f937caa6bb4c5530b9237e
      https://github.com/qemu/qemu/commit/36839d355e4ffc77d8f937caa6bb4c5530b9237e
  Author: Alon Levy &lt;alevy@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  qxl: disallow unknown revisions

Signed-off-by: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 020af1c45fec664d5d4cf3b8e5117f8bc1d691f2
      https://github.com/qemu/qemu/commit/020af1c45fec664d5d4cf3b8e5117f8bc1d691f2
  Author: Alon Levy &lt;alevy@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M configure
    M hw/qxl.c
    M hw/qxl.h
    M trace-events
    M ui/spice-display.h

  Log Message:
  -----------
  qxl: add QXL_IO_MONITORS_CONFIG_ASYNC

Revision bumped to 4 for new IO support, enabled for spice-server &gt;=
0.11.1. New io enabled if revision is 4. Revision can be set to 4.

[ kraxel: 3 continues to be the default revision.  Once we have a new
    stable spice-server release and the qemu patches to enable
    the new bits merged we'll go flip the switch and make rev4
    the default ]

This io calls the corresponding new spice api
spice_qxl_monitors_config_async to let spice-server read a new guest set
monitors config and notify the client.

On migration reissue spice_qxl_monitors_config_async.

RHBZ: 770842

Signed-off-by: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;

fixup

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 2e0e3c399aa8067148055b9ea0edb822c5b584d2
      https://github.com/qemu/qemu/commit/2e0e3c399aa8067148055b9ea0edb822c5b584d2
  Author: Alon Levy &lt;alevy@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: print spice-protocol and spice-server versions

Signed-off-by: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: ddd8fdc78ee30fc445e3d1f5bd2056acfcdefe47
      https://github.com/qemu/qemu/commit/ddd8fdc78ee30fc445e3d1f5bd2056acfcdefe47
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M hw/qxl.c
    M hw/qxl.h
    M ui/spice-display.c
    M ui/spice-display.h

  Log Message:
  -----------
  spice: make number of surfaces runtime-configurable.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: c10018d6c77c94a8c703b9e4f026da74cad73d9e
      https://github.com/qemu/qemu/commit/c10018d6c77c94a8c703b9e4f026da74cad73d9e
  Author: SÃ¸ren Sandmann Pedersen &lt;ssp@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  qxl: Add set_client_capabilities() interface to QXLInterface

This new interface lets spice server inform the guest whether

(a) a client is connected
(b) what capabilities the client has

There is a fixed number (464) of bits reserved for capabilities, and
when the capabilities bits change, the QXL_INTERRUPT_CLIENT interrupt
is generated.

Signed-off-by: Soren Sandmann &lt;ssp@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 265db734901df7d8f24796ad7c43923249651289
      https://github.com/qemu/qemu/commit/265db734901df7d8f24796ad7c43923249651289
  Author: SÃ¸ren Sandmann Pedersen &lt;ssp@redhat.com&gt;
  Date:   2012-09-05 (Wed, 05 Sep 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  Remove #ifdef QXL_COMMAND_FLAG_COMPAT_16BPP

We require spice &gt;= 0.8 now, so this flag is always present.

Signed-off-by: Soren Sandmann &lt;ssp@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 69fc255350af9e8e39e29b4d6a84d44f0a55ebf2
      https://github.com/qemu/qemu/commit/69fc255350af9e8e39e29b4d6a84d44f0a55ebf2
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M configure
    M hmp.c
    M hw/qxl.c
    M hw/qxl.h
    M monitor.c
    M monitor.h
    M qapi-schema.json
    M qemu-config.c
    M qemu-options.hx
    M trace-events
    M ui/spice-core.c
    M ui/spice-display.c
    M ui/spice-display.h

  Log Message:
  -----------
  Merge branch 'spice.v59' of git://anongit.freedesktop.org/spice/qemu

* 'spice.v59' of git://anongit.freedesktop.org/spice/qemu:
  Remove #ifdef QXL_COMMAND_FLAG_COMPAT_16BPP
  qxl: Add set_client_capabilities() interface to QXLInterface
  spice: make number of surfaces runtime-configurable.
  configure: print spice-protocol and spice-server versions
  qxl: add QXL_IO_MONITORS_CONFIG_ASYNC
  qxl: disallow unknown revisions
  qxl/update_area_io: guest_bug on invalid parameters
  spice: increase the verbosity of spice section in "qemu --help"
  spice: adding seamless-migration option to the command line
  spice: add 'migrated' flag to spice info
  spice migration: add QEVENT_SPICE_MIGRATE_COMPLETED
  spice: notify on vm state change only via spice_server_vm_start/stop
  spice: notify spice server on vm start/stop
  spice: abort on invalid streaming cmdline params


Compare: https://github.com/qemu/qemu/compare/e22b1e990783...69fc255350af

----==_mimepart_504df26d99266_159d1a4aaf0195639--


</body></email><email><emailId>20120910230010</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-10 23:00:10-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 692e58: qemu: add .exrc</subject><body>



----==_mimepart_504e70fa4fdfe_6d0f190aaf055617
Date: Mon, 10 Sep 2012 16:00:10 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;504e70fa54785_6d0f190aaf055774@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 692e587fc61fd32d755234d187b4f082e28c3993
      https://github.com/qemu/qemu/commit/692e587fc61fd32d755234d187b4f082e28c3993
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-09-06 (Thu, 06 Sep 2012)

  Changed paths:
    A .exrc

  Log Message:
  -----------
  qemu: add .exrc

I've been using this to get correct indenting with vim
in qemu for a while, but it's a bit easier if we
put the settings in the central place.
Note that
1. you still need to enable 'exrc' and 'secure'
   options in your vimrc for these settings to take effect.
2. you can create a .vimrc file if 'exrc' is on but there's
   need to bypass this configuration.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 1de53459272d89c52bb21b45d5d970de40fbb642
      https://github.com/qemu/qemu/commit/1de53459272d89c52bb21b45d5d970de40fbb642
  Author: Jason Baron &lt;jbaron@redhat.com&gt;
  Date:   2012-09-06 (Thu, 06 Sep 2012)

  Changed paths:
    M hw/pci.c
    M hw/pcie.h

  Log Message:
  -----------
  pcie: drop version_id field for live migration

While testing q35 live migration, I found that the migration would abort with
the following error: "Unknown savevm section type 76".

The error is due to this check failing in 'vmstate_load_state()':

    while(field-&gt;name) {
  if ((field-&gt;field_exists &amp;&amp;
       field-&gt;field_exists(opaque, version_id)) ||
      (!field-&gt;field_exists &amp;&amp;
       field-&gt;version_id &lt;= version_id)) {

The VMSTATE_PCIE_DEVICE() currently has a 'version_id' set to 2. However,
'version_id' in the above check is 1. And thus we fail to load the pcie device
field. Further the code returns to 'qemu_loadvm_state()' which produces the
error that I saw.

I'm proposing to fix this by simply dropping the 'version_id' field from
VMSTATE_PCIE_DEVICE(). VMSTATE_PCI_DEVICE() defines no such field and further
the vmstate_pcie_device that VMSTATE_PCI_DEVICE() refers to is already
versioned. Thus, any versioning issues could be detected at the vmsd level.

Taking a step back, I think that the 'field-&gt;version_id' should be compared
against a saved version number for the field not the 'version_id'. Futhermore,
once vmstate_load_state() is called recursively on another vmsd, the check of:

    if (version_id &gt; vmsd-&gt;version_id) {
  return -EINVAL;
    }

Will never fail since version_id is always equal to vmsd-&gt;version_id. So I'm
wondering why we aren't storing the vmsd version id of the source in the
migration stream?

This patch also renames the 'name' field of vmstate_pcie_device from:
PCIDevice -&gt; PCIEDevice to differentiate it from vmstate_pci_device.

Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 0e180d9c8a7429c55d23d2e7855f1e490a063aaa
      https://github.com/qemu/qemu/commit/0e180d9c8a7429c55d23d2e7855f1e490a063aaa
  Author: Jason Baron &lt;jbaron@redhat.com&gt;
  Date:   2012-09-06 (Thu, 06 Sep 2012)

  Changed paths:
    M hw/pcie_aer.c

  Log Message:
  -----------
  pcie_aer: clear cmask for Advanced Error Interrupt Message Number

The Advanced Error Interrupt Message Number (bits 31:27 of the Root
Error Status Register) is updated when the number of msi messages assigned to a
device changes. Migration of windows 7 on q35 chipset failed because the check
in get_pci_config_device() fails due to cmask being set on these bits. Its valid
to update these bits and we must restore this state across migration.

Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: a96ed02fc73e23748c8b3e38880eeac91f83ab9f
      https://github.com/qemu/qemu/commit/a96ed02fc73e23748c8b3e38880eeac91f83ab9f
  Author: Nicholas Bellinger &lt;nab@linux-iscsi.org&gt;
  Date:   2012-09-06 (Thu, 06 Sep 2012)

  Changed paths:
    M monitor.c
    M monitor.h
    M net.c
    M net.h
    M net/socket.c
    M net/tap.c

  Log Message:
  -----------
  monitor: Rename+move net_handle_fd_param -&gt; monitor_handle_fd_param

This patch renames+moves the net_handle_fd_param() caller used to
obtain a file descriptor from either qemu_parse_fd() (the normal case)
or from monitor_get_fd() (migration case) into a generically prefixed
monitor_handle_fd_param() to be used by vhost-scsi code.

Also update net/[socket,tap].c consumers to use the new prefix.

Reported-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Cc: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Cc: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Cc: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Cc: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Nicholas Bellinger &lt;nab@linux-iscsi.org&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 1241ed94c331ddd8fc8297b02b4508ead59467de
      https://github.com/qemu/qemu/commit/1241ed94c331ddd8fc8297b02b4508ead59467de
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-09-06 (Thu, 06 Sep 2012)

  Changed paths:
    M hw/vhost.c
    M hw/vhost.h
    M hw/vhost_net.c

  Log Message:
  -----------
  vhost: Pass device path to vhost_dev_init()

The path to /dev/vhost-net is currently hardcoded in vhost_dev_init().
This needs to be changed so that /dev/vhost-scsi can be used.  Pass in
the device path instead of hardcoding it.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Cc: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Cc: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Nicholas Bellinger &lt;nab@linux-iscsi.org&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;


  Commit: 62fe83318d2fc5b31f473d66326910d94c1c4907
      https://github.com/qemu/qemu/commit/62fe83318d2fc5b31f473d66326910d94c1c4907
  Author: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
  Date:   2012-09-09 (Sun, 09 Sep 2012)

  Changed paths:
    M configure
    M kvm-all.c

  Log Message:
  -----------
  qemu: Use valgrind annotations to mark kvm guest memory as defined

valgrind with kvm produces a big amount of false positives regarding
"Conditional jump or move depends on uninitialised value(s)". This
happens because the guest memory is allocated with qemu_vmalloc which
boils down posix_memalign etc. This function is (correctly) considered
by valgrind as returning undefined memory.

Since valgrind is based on jitting code, it will not be able to see
changes made by the guest to guest memory if this is done by KVM_RUN,
thus keeping most of the guest memory undefined.

Now lots of places in qemu will then use guest memory to change behaviour.
To avoid the flood of these messages, lets declare the whole guest
memory as defined. This will reduce the noise and allows us to see real
problems.

In the future we might want to make this conditional, since there
is actually something that we can use those false positives for:
These messages will point to code that depends on guest memory, so
we can use these backtraces to actually make an audit that is focussed
only at those code places. For normal development we dont want to
see those messages, though.

Signed-off-by: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: b131c74a0e485b084ddaffc8214c8a19af492be7
      https://github.com/qemu/qemu/commit/b131c74a0e485b084ddaffc8214c8a19af492be7
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-09-09 (Sun, 09 Sep 2012)

  Changed paths:
    M hw/virtio-pci.c
    M kvm-all.c
    M kvm-stub.c
    M kvm.h

  Log Message:
  -----------
  kvm: Clean up irqfd API

No need to expose the fd-based interface, everyone will already be fine
with the more handy EventNotifier variant. Rename the latter to clarify
that we are still talking about irqfds here.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Acked-by: Alex Williamson &lt;alex.williamson@redhat.com&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: cc57407e966e8467f9742e7a4ad47567b5951122
      https://github.com/qemu/qemu/commit/cc57407e966e8467f9742e7a4ad47567b5951122
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M kvm-all.c
    M kvm.h

  Log Message:
  -----------
  kvm: Introduce kvm_irqchip_update_msi_route

This service allows to update an MSI route without releasing/reacquiring
the associated VIRQ. Will be used by PCI device assignment, later on
likely also by virtio/vhost and VFIO.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Acked-by: Acked-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 3ab73842446a9f2d9d78b23daa43ff382679eece
      https://github.com/qemu/qemu/commit/3ab73842446a9f2d9d78b23daa43ff382679eece
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M kvm-all.c
    M kvm.h

  Log Message:
  -----------
  kvm: Introduce kvm_has_intx_set_mask

Will be used by PCI device assignment code.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Acked-by: Acked-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: b139bd300f4f579c526d153efa4960c380e2b6e3
      https://github.com/qemu/qemu/commit/b139bd300f4f579c526d153efa4960c380e2b6e3
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M target-i386/kvm.c
    M target-i386/kvm_i386.h

  Log Message:
  -----------
  kvm: i386: Add services required for PCI device assignment

These helpers abstract the interaction of upcoming pci-assign with the
KVM kernel services. Put them under i386 only as other archs will
implement device pass-through via VFIO and not this classic interface.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Acked-by: Acked-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: c3ebd3ba786e1be5449527e47001eded6b59322b
      https://github.com/qemu/qemu/commit/c3ebd3ba786e1be5449527e47001eded6b59322b
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/kvm/Makefile.objs
    A hw/kvm/pci-assign.c
    M hw/qdev-monitor.c

  Log Message:
  -----------
  kvm: i386: Add classic PCI device assignment

This adds PCI device assignment for i386 targets using the classic KVM
interfaces. This version is 100% identical to what is being maintained
in qemu-kvm for several years and is supported by libvirt as well. It is
expected to remain relevant for another couple of years until kernels
without full-features and performance-wise equivalent VFIO support are
obsolete.

A refactoring to-do that should be done in-tree is to model MSI and
MSI-X support via the generic PCI layer, similar to what VFIO is already
doing for MSI-X. This should improve the correctness and clean up the
code from duplicate logic.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Acked-by: Acked-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Avi Kivity &lt;avi@redhat.com&gt;


  Commit: 8bf188aa18ef7a8355d9edbd43871d590468c4ed
      https://github.com/qemu/qemu/commit/8bf188aa18ef7a8355d9edbd43871d590468c4ed
  Author: Michael Tokarev &lt;mjt@tls.msk.ru&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  use --libexecdir instead of ignoring it first and reinventing it later

Commit 7b93fadf3a38d1ed65ea5536a52efc2772c6e3b8 "Add basic version
of bridge helper" put the bridge helper executable into a fixed
${prefix}/libexec/ location, instead of using ${libexecdir} for
this.  At the same time, --libexecdir is being happily ignored
by ./configure.  Even more, the same patch sets unused $libexecdir
variable in the generated config-host.mak, and uses fixed string
(\${prefix}/libexecdir) for the bridge helper binary.

Fix this braindamage by introducing $libexecdir variable, using
it for the bridge helper binary, and recognizing --libexecdir.

This patch is applicable to stable-1.1.

Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Reviewed-by: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
Signed-off-by: Michael Tokarev &lt;mjt@tls.msk.ru&gt;
Cc: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
Cc: Richa Marwaha &lt;rmarwah@linux.vnet.ibm.com&gt;
Cc: qemu-stable@nongnu.org
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 455aa1e0818653c41fd794435b982426ce21ba2f
      https://github.com/qemu/qemu/commit/455aa1e0818653c41fd794435b982426ce21ba2f
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M qemu-char.c

  Log Message:
  -----------
  socket: don't attempt to reconnect a TCP socket in server mode

Commit c3767ed0eb5d0bb25fe409ae5dec06e3411ff1b6 introduced a possible SEGV when
using a socket chardev with server=on because it assumes that all TCP sockets
are in client mode.

This patch adds a check to only reconnect when in client mode.

Cc: Lei Li &lt;lilei@linux.vnet.ibm.com&gt;
Reported-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 14df77a609e39403c3ec814bae63bec0fb4d24d2
      https://github.com/qemu/qemu/commit/14df77a609e39403c3ec814bae63bec0fb4d24d2
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    A .exrc
    M hw/pci.c
    M hw/pcie.h
    M hw/pcie_aer.c
    M hw/vhost.c
    M hw/vhost.h
    M hw/vhost_net.c
    M monitor.c
    M monitor.h
    M net.c
    M net.h
    M net/socket.c
    M net/tap.c

  Log Message:
  -----------
  Merge remote-tracking branch 'mst/tags/for_anthony' into staging

* mst/tags/for_anthony:
  vhost: Pass device path to vhost_dev_init()
  monitor: Rename+move net_handle_fd_param -&gt; monitor_handle_fd_param
  pcie_aer: clear cmask for Advanced Error Interrupt Message Number
  pcie: drop version_id field for live migration
  qemu: add .exrc


  Commit: 6a38e0dc369e6bdc3b3ac4a965a34990c4980b66
      https://github.com/qemu/qemu/commit/6a38e0dc369e6bdc3b3ac4a965a34990c4980b66
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M configure
    M hw/kvm/Makefile.objs
    A hw/kvm/pci-assign.c
    M hw/qdev-monitor.c
    M hw/virtio-pci.c
    M kvm-all.c
    M kvm-stub.c
    M kvm.h
    M target-i386/kvm.c
    M target-i386/kvm_i386.h

  Log Message:
  -----------
  Merge remote-tracking branch 'qemu-kvm/uq/master' into staging

* qemu-kvm/uq/master:
  kvm: i386: Add classic PCI device assignment
  kvm: i386: Add services required for PCI device assignment
  kvm: Introduce kvm_has_intx_set_mask
  kvm: Introduce kvm_irqchip_update_msi_route
  kvm: Clean up irqfd API
  qemu: Use valgrind annotations to mark kvm guest memory as defined


  Commit: bedc572eae6e250070495116f0db72607826aee5
      https://github.com/qemu/qemu/commit/bedc572eae6e250070495116f0db72607826aee5
  Author: Yang Zhang &lt;yang.z.zhang@intel.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/mc146818rtc.c

  Log Message:
  -----------
  RTC: Remove the logic to update time format when DM bit changed

Changing the DM (binary/BCD) and 24/12 control bit doesn't affect the internal
registers. It only indicates what format is used for those registers.

Signed-off-by: Yang Zhang &lt;yang.z.zhang@intel.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: c4c18e246f968f18dc656afa3e8de7cf6b9752e8
      https://github.com/qemu/qemu/commit/c4c18e246f968f18dc656afa3e8de7cf6b9752e8
  Author: Yang Zhang &lt;yang.z.zhang@intel.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/mc146818rtc.c

  Log Message:
  -----------
  RTC: Rename rtc_timer_update

Signed-off-by: Yang Zhang &lt;yang.z.zhang@intel.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: e46deabaa58b78397aeef2b04147aeecf5933794
      https://github.com/qemu/qemu/commit/e46deabaa58b78397aeef2b04147aeecf5933794
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/mc146818rtc.c

  Log Message:
  -----------
  RTC: introduce RTC_CLOCK_RATE

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 9324cc50c6b5df0998d46e8fca76e35f00ced6c3
      https://github.com/qemu/qemu/commit/9324cc50c6b5df0998d46e8fca76e35f00ced6c3
  Author: Yang Zhang &lt;yang.z.zhang@intel.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/mc146818rtc.c
    M hw/mc146818rtc_regs.h

  Log Message:
  -----------
  RTC: Update interrupt state when interrupts are masked/unmasked

If an interrupt flag is already set when the interrupt becomes enabled,
raise an interrupt immediately, and vice versa if interrupts become
disabled.

Signed-off-by: Yang Zhang &lt;yang.z.zhang@intel.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 0281518a1c7dd3577dea9ccc78869ecff954589c
      https://github.com/qemu/qemu/commit/0281518a1c7dd3577dea9ccc78869ecff954589c
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M vmstate.h

  Log Message:
  -----------
  vmstate: add VMSTATE_TIMER_V

Also, for consistency with other occurrences, implement VMSTATE_TIMER
as a special case of VMSTATE_TIMER_V rather than VMSTATE_TIMER_TEST.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 56038ef6234e5fb3d01bad1f6df37c2ccab82af9
      https://github.com/qemu/qemu/commit/56038ef6234e5fb3d01bad1f6df37c2ccab82af9
  Author: Yang Zhang &lt;yang.z.zhang@intel.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/mc146818rtc.c

  Log Message:
  -----------
  RTC: Update the RTC clock only when reading it

Calculate guest RTC based on the time of the last update, instead of
using timers.  The formula is

    (base_rtc + guest_time_now - guest_time_last_update + offset)

Base_rtc is the RTC value when the RTC was last updated.
Guest_time_now is the guest time when the access happens.
Guest_time_last_update was the guest time when the RTC was last updated.
Offset is used when divider reset happens or the set bit is toggled.

The timer is kept in order to signal interrupts, but it only needs to
run when either UF or AF is cleared.  When the bits are both set, the
timer does not run.

UIP is now synthesized when reading register A.  If the timer is not set,
or if there is more than one second before it (as is the case at the
end of this series), the leading edge of UIP is computed and the rising
edge occurs 220us later.  If the update timer occurs within one second,
however, the rising edge of the AF and UF bits should coincide withe
the falling edge of UIP.  We do not know exactly when this will happen
because there could be delays in the servicing of the timer.  Hence, in
this case reading register A only computes for the rising edge of UIP,
and latches the bit until the timer is fired and clears it.

Signed-off-by: Yang Zhang &lt;yang.z.zhang@intel.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 41a9b8b24d59acec462b0d8e0d2a7ffce6031d55
      https://github.com/qemu/qemu/commit/41a9b8b24d59acec462b0d8e0d2a7ffce6031d55
  Author: Yang Zhang &lt;yang.z.zhang@intel.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/mc146818rtc.c

  Log Message:
  -----------
  RTC: Add divider reset support

The first update cycle begins one-half seconds after divider
reset is removed.  This feature is useful for testing.

Signed-off-by: Yang Zhang &lt;yang.z.zhang@intel.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 00cf57747db98c6a9e4219cea39ac3113dde6993
      https://github.com/qemu/qemu/commit/00cf57747db98c6a9e4219cea39ac3113dde6993
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/mc146818rtc.c

  Log Message:
  -----------
  RTC: Do not fire timer periodically to catch next alarm

This patch limits further the usage of a periodic timer.  It computes the
time of the next alarm, and uses it to skip all intermediate occurrences
of the timer.

Cc: Yang Zhang &lt;yang.z.zhang@intel.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: e2826cf4a8c89d64cdf8304f861910293f046aa8
      https://github.com/qemu/qemu/commit/e2826cf4a8c89d64cdf8304f861910293f046aa8
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/mc146818rtc.c

  Log Message:
  -----------
  RTC: Get and set time without going through s-&gt;current_tm

This patch makes rtc_set_time and rtc_set_cmos work without reading
s-&gt;current_tm.  In the case of rtc_set_time I introduce a new
function that retrieves the time and stores into a given struct tm
(not hard-coded to s-&gt;current_tm).  In the case of rtc_set_cmos, the
current time is similarly taken from a struct tm rather than
s-&gt;current_tm.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 89166459065353c6a49456794f840ffe57016020
      https://github.com/qemu/qemu/commit/89166459065353c6a49456794f840ffe57016020
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/mc146818rtc.c

  Log Message:
  -----------
  RTC: Remove the current_tm field

This is not used anymore and only written to.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 66d5499b3754b83c09487259c08fe2ce73188a59
      https://github.com/qemu/qemu/commit/66d5499b3754b83c09487259c08fe2ce73188a59
  Author: Daniel P. Berrange &lt;berrange@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  Add ability to disable build of all targets

Allow passing of '--target-list=' to configure to request that
all targets are to be disabled. This allows for doing a very
fast tools-only build of things like qemu-img, qemu-io, qemu-nbd.

Signed-off-by: Daniel P. Berrange &lt;berrange@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 4b1c11fd20e8901f04a2d9c225cd10fc05a762ff
      https://github.com/qemu/qemu/commit/4b1c11fd20e8901f04a2d9c225cd10fc05a762ff
  Author: Daniel P. Berrange &lt;berrange@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  Add ability to force enable/disable of tools build

The qemu-img, qemu-nbd and qemu-io tools are built conditionally
based on whether any softmmu target is enabled. These are useful
self-contained tools which can be used in many other scenarios.
Add new --enable-tools/--disable-tools args to configure to allow
the user to explicitly turn on / off their build. The default
behaviour is now to build these tools are all times, regardless
of whether any softmmu target is enabled

Signed-off-by: Daniel P. Berrange &lt;berrange@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/69fc255350af...4b1c11fd20e8

----==_mimepart_504e70fa4fdfe_6d0f190aaf055617--


</body></email><email><emailId>20120911173016</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-11 17:30:16-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 45b339: usb: controllers do not need to check for babble t...</subject><body>



----==_mimepart_504f7528c5a23_2e2e1804ae896915
Date: Tue, 11 Sep 2012 10:30:16 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;504f7528cf540_2e2e1804ae897043@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 45b339b18c660eb85af2ba25bfcaed5469660d77
      https://github.com/qemu/qemu/commit/45b339b18c660eb85af2ba25bfcaed5469660d77
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  usb: controllers do not need to check for babble themselves

If an (emulated) usb-device tries to write more data to a packet then
its iov len, this will trigger an assert in usb_packet_copy(), and if
a driver somehow circumvents that check and writes more data to the
iov then there is space, we have a much bigger problem then not correctly
reporting babble to the guest.

In practice babble will only happen with (real) redirected devices, and there
both the usb-host os and the qemu usb-device code already check for it.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: cc40997489260f405aecccd30d4626ceee862502
      https://github.com/qemu/qemu/commit/cc40997489260f405aecccd30d4626ceee862502
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/core.c

  Log Message:
  -----------
  usb-core: Don't set packet state to complete on a nak

This way the hcd can re-use the same packet to retry without needing
to re-init it.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: c13a9e61366cc3e28299d8faeb65e65c6e5964cf
      https://github.com/qemu/qemu/commit/c13a9e61366cc3e28299d8faeb65e65c6e5964cf
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb.h
    M hw/usb/core.c

  Log Message:
  -----------
  usb-core: Add a usb_ep_find_packet_by_id() helper function

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 9c1f67654ab611553bbfca54a1e0922728c25760
      https://github.com/qemu/qemu/commit/9c1f67654ab611553bbfca54a1e0922728c25760
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/core.c

  Log Message:
  -----------
  usb-core: Allow the first packet of a pipelined ep to complete immediately

This can happen with usb-redir live-migration when the packet gets re-queued
after the migration and the original queuing from the migration source side
has already finished.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 66f092d25697e11847b61d761c38ddebedaed8d1
      https://github.com/qemu/qemu/commit/66f092d25697e11847b61d761c38ddebedaed8d1
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  Revert "ehci: don't flush cache on doorbell rings."

This reverts commit 9bc3a3a216e2689bfcdd36c3e079333bbdbf3ba0, which got
added to fix an issue where the real, underlying cause was not stopping
the ep queue on an error.

Now that the underlying cause is fixed by the "usb: Halt ep queue and
cancel pending packets on a packet error" patch, the "don't flush" fix
is no longer needed.

Not only is it not needed, it causes us to see cancellations (unlinks)
done by the Linux EHCI driver too late, which in combination with the new
usb-core packet-id generation where qtd addresses are used as ids, causes
duplicate ids for in flight packets.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;


  Commit: dafe31fc2a8653b535d58f8c7b250c0827b14420
      https://github.com/qemu/qemu/commit/dafe31fc2a8653b535d58f8c7b250c0827b14420
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Validate qh is not changed unexpectedly by the guest

-combine the qh check with the check for devaddr changes
-also ensure that p gets set to NULL when the queue gets cancelled on
 devaddr change, which was not done properly before this patch

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;


  Commit: 522079dd4461c38b9a88bf31a65ea038c5b2be45
      https://github.com/qemu/qemu/commit/522079dd4461c38b9a88bf31a65ea038c5b2be45
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Update copyright headers to reflect recent work

Update copyright headers to reflect all the work Gerd and I have been doing
on the EHCI emulation.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;


  Commit: 0e7953525f52aa6c098dc0c1ce0b4a80ce82da45
      https://github.com/qemu/qemu/commit/0e7953525f52aa6c098dc0c1ce0b4a80ce82da45
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Properly cleanup packets on cancel

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;


  Commit: 4b63a0df3bda8a2c278e45d9d94d9ba6d5791d8d
      https://github.com/qemu/qemu/commit/4b63a0df3bda8a2c278e45d9d94d9ba6d5791d8d
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Properly report completed but not yet processed packets to the guest

Reported packets which have completed before being cancelled as such to the
host. Note that the new code path this patch adds is untested since it I've
been unable to actually trigger the race which needs this code path.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;


  Commit: 616789cde2a83fad5e634880fd20214f0c984fd5
      https://github.com/qemu/qemu/commit/616789cde2a83fad5e634880fd20214f0c984fd5
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: check for EHCI_ASYNC_FINISHED first in ehci_free_packet

Otherwise we'll see the packet free twice in the trace log even though
it actually happens only once.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 5c514681abbb3ae2f61f517c1aa3197f2f3ca93c
      https://github.com/qemu/qemu/commit/5c514681abbb3ae2f61f517c1aa3197f2f3ca93c
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c
    M trace-events

  Log Message:
  -----------
  ehci: trace guest bugs

make qemu_queue_{cancel,reset} return the number of packets released,
so the caller can figure whenever there have been active packets even
though there shouldn't have been any.  Add tracepoint to log this.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 1defcbd1e81d67476b6e4e486bcd4d869162900d
      https://github.com/qemu/qemu/commit/1defcbd1e81d67476b6e4e486bcd4d869162900d
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c
    M trace-events

  Log Message:
  -----------
  ehci: add doorbell trace events

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 3a8ca08e01ea4baafff2a513655008cdd00feebf
      https://github.com/qemu/qemu/commit/3a8ca08e01ea4baafff2a513655008cdd00feebf
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Add some additional ehci_trace_guest_bug() calls

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: ef5b234477df80700b128f561f5877a0688a70c8
      https://github.com/qemu/qemu/commit/ef5b234477df80700b128f561f5877a0688a70c8
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Fix memory leak in handling of NAK-ed packets

Currently each time we try to execute a NAK-ed packet we redo
ehci_init_transfer, and usb_packet_map, re-allocing (without freeing) the
sg list every time.

This patch fixes this, it does this by introducing another async state, so
that we also properly cleanup a NAK-ed packet on cancel.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: eff6dce79bd7ad3c16d75c5e55b5a2a137ba6a60
      https://github.com/qemu/qemu/commit/eff6dce79bd7ad3c16d75c5e55b5a2a137ba6a60
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Handle USB_RET_PROCERR in ehci_fill_queue

USB_RET_PROCERR can be triggered by the guest (by for example requesting more
then BUFFSIZE bytes), so don't assert on it.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: cf1f81691d1998fa8fe5bfcb8b498fb3723cf3c3
      https://github.com/qemu/qemu/commit/cf1f81691d1998fa8fe5bfcb8b498fb3723cf3c3
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Correct a comment in fetchqtd packet processing

Since my previous comment said "Should never happen", I tried changing the
next line to an assert(0), which did not go well, which as the new comments
explains is logical if you think about it for a moment.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 181133404f520fab40a3ad40d935d91cf3cf546c
      https://github.com/qemu/qemu/commit/181133404f520fab40a3ad40d935d91cf3cf546c
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Never return USB_RET_NAK for async handled packets

USB_RET_NAK is not a valid response for async handled packets (and will
trigger an assert as such).

Also drop the warning when receiving a status of cancelled for packets not
cancelled by qemu itself, this can happen when a device gets unredirected
by the usbredir-host while transfers are pending.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: ed9873bfbf145c084d039baab08c63b9d67e7bd3
      https://github.com/qemu/qemu/commit/ed9873bfbf145c084d039baab08c63b9d67e7bd3
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Don't delay handling of open events to a bottom half

There is no need for this, and doing so means that a backend trying to
write immediately after an open event will see qemu_chr_be_can_write
returning 0, which not all backends handle well as there is no wakeup
mechanism to detect when the frontend does become writable.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: cb897117cdedd488f19985c8ec5ea05971103a27
      https://github.com/qemu/qemu/commit/cb897117cdedd488f19985c8ec5ea05971103a27
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Get rid of async-struct get member

This is a preparation patch for completely getting rid of the async-packet
struct in usb-redir, instead relying on the (new) per ep queues in the
qemu usb core.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 104981d52b63dc3d68f39d4442881c667f44bbb9
      https://github.com/qemu/qemu/commit/104981d52b63dc3d68f39d4442881c667f44bbb9
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Get rid of local shadow copy of packet headers

The shadow copy only serves as an extra check (besides the packet-id) to
ensure the packet we get back is a reply to the packet we think it is.

This check has never triggered in all the time usb-redir is in use now,
and since the verified data in the returned packet-header is not used
otherwise, removing the check does not open any possibilities for the
usbredirhost to confuse us.

This is a preparation patch for completely getting rid of the async-packet
struct in usb-redir, instead relying on the (new) per ep queues in the
qemu usb core.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 206e7f20fe7b920b362bcc02608680c5d5527f2a
      https://github.com/qemu/qemu/commit/206e7f20fe7b920b362bcc02608680c5d5527f2a
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Get rid of unused async-struct dev member

This is a preparation patch for completely getting rid of the async-packet
struct in usb-redir, instead relying on the (new) per ep queues in the
qemu usb core.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: de550a6afb468ed3b8171019e19b63ae8254886d
      https://github.com/qemu/qemu/commit/de550a6afb468ed3b8171019e19b63ae8254886d
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Move to core packet id and queue handling

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 2979a36183a3902cd75665e7c6bbc8668668fd17
      https://github.com/qemu/qemu/commit/2979a36183a3902cd75665e7c6bbc8668668fd17
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Return babble when getting more bulk data then requested

Babble is the appropriate error in this case (rather then signalling a stall).

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: be4a892846651e06dbbd9a48aa877f4e0397d01e
      https://github.com/qemu/qemu/commit/be4a892846651e06dbbd9a48aa877f4e0397d01e
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M configure
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Convert to new libusbredirparser 0.5 API

This gives us support for 64 bit ids which is needed for using XHCI with
the new hcd generated ids.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 0fde3b7a826aa654612126cdea9832319a34172c
      https://github.com/qemu/qemu/commit/0fde3b7a826aa654612126cdea9832319a34172c
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Set ep max_packet_size if available

This is needed for usb-redir to work properly with the xhci emulation.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 910c1e6b14e4abb188ff7ef584a629187479f82d
      https://github.com/qemu/qemu/commit/910c1e6b14e4abb188ff7ef584a629187479f82d
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Add a usbredir_reject_device helper function

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: a508cc42e22a2ac3878b964290780f1d81ec65c1
      https://github.com/qemu/qemu/commit/a508cc42e22a2ac3878b964290780f1d81ec65c1
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Ensure our peer has the necessary caps when redirecting to XHCI

In order for redirection to work properly when redirecting to an emulated
XHCI controller, the usb-redir-host must support both
usb_redir_cap_ep_info_max_packet_size and usb_redir_cap_64bits_ids,
reject any devices redirected to an XHCI controller when these are not
supported.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 6c67446a427b50a706e628f810116353f5d128cf
      https://github.com/qemu/qemu/commit/6c67446a427b50a706e628f810116353f5d128cf
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Enable pipelining for bulk endpoints

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 2964cd9bfa5100e433471d3e3fedcc9d62891894
      https://github.com/qemu/qemu/commit/2964cd9bfa5100e433471d3e3fedcc9d62891894
  Author: Samuel Thibault &lt;samuel.thibault@ens-lyon.org&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/dev-serial.c

  Log Message:
  -----------
  Better name usb braille device

Windows users need to know that they have to use the Baum driver to make
the qemu braille device work.

Signed-off-by: Samuel Thibault &lt;samuel.thibault@ens-lyon.org&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 2bbd086c41a00dc4384727ec895a94890c688eb5
      https://github.com/qemu/qemu/commit/2bbd086c41a00dc4384727ec895a94890c688eb5
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/dev-audio.c

  Log Message:
  -----------
  usb-audio: fix usb version

usb-audio is a full speed (1.1) device,
but bcdUSB claims it is usb 2.0.  Fix it.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 331e9406f152b6bae6859a153d36e5076c58901d
      https://github.com/qemu/qemu/commit/331e9406f152b6bae6859a153d36e5076c58901d
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: rip out background transfer code

original xhci code (the one which used libusb directly) used to use
'background transfers' for iso streams.  In upstream qemu the iso
stream buffering is handled by usb-host &amp; usb-redir, so we will
never ever need this.  It has been left in as reference, but is dead
code anyway.  Rip it out.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: d5a15814b413869667b2a3215772986885be574a
      https://github.com/qemu/qemu/commit/d5a15814b413869667b2a3215772986885be574a
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c
    M trace-events

  Log Message:
  -----------
  xhci: drop buffering

This patch splits the xhci_xfer_data function into three.
The xhci_xfer_data function used to do does two things:

  (1) copy transfer data between guest memory and a temporary buffer.
  (2) report transfer results to the guest using events.

Now we three functions to handle this:

  (1) xhci_xfer_map creates a scatter list for the transfer and
      uses that (instead of the temporary buffer) to build a
      USBPacket.
  (2) xhci_xfer_unmap undoes the mapping.
  (3) xhci_xfer_report sends out events.

The patch also fixes reporting of transaction errors which must be
reported unconditinally, not only in case the guest asks for it
using the ISP flag.

[ v2: fix warning ]

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 5c08106ff65c904c297dab17cd0b0a3a28b63527
      https://github.com/qemu/qemu/commit/5c08106ff65c904c297dab17cd0b0a3a28b63527
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: move device lookup into xhci_setup_packet

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 01546fa6624ad0d1068423c58fa31bdfc44da2bf
      https://github.com/qemu/qemu/commit/01546fa6624ad0d1068423c58fa31bdfc44da2bf
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: implement mfindex

Implement mfindex register and mfindex wrap event.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 3d1396842dc8acd691d3e5d1d3c59ade39776e5a
      https://github.com/qemu/qemu/commit/3d1396842dc8acd691d3e5d1d3c59ade39776e5a
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: iso xfer support

Add support for iso transfers.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 873123fe094546ba99ff96d089e8eb02f307043d
      https://github.com/qemu/qemu/commit/873123fe094546ba99ff96d089e8eb02f307043d
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c
    M trace-events

  Log Message:
  -----------
  xhci: trace cc codes in cleartext

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: d829fde97d25bfa5ec62d21d28ed32991e56ffc7
      https://github.com/qemu/qemu/commit/d829fde97d25bfa5ec62d21d28ed32991e56ffc7
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c
    M trace-events

  Log Message:
  -----------
  xhci: add trace_usb_xhci_ep_set_dequeue

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 8e9f18b6db1cd67f0a7efd7d0285bee489445197
      https://github.com/qemu/qemu/commit/8e9f18b6db1cd67f0a7efd7d0285bee489445197
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: fix runtime write tracepoint

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 106b214c4fbba80699b32b63020432cbd1cf95db
      https://github.com/qemu/qemu/commit/106b214c4fbba80699b32b63020432cbd1cf95db
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: update register layout

Change the register layout to be a bit more sparse and also not depend
on the number of ports.  Useful when for making the number of ports
runtime-configurable.


  Commit: 0846e6359c407e372f446723b8b7b09ac20d0f03
      https://github.com/qemu/qemu/commit/0846e6359c407e372f446723b8b7b09ac20d0f03
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: update port handling

This patch changes the way xhci ports are linked to USBPorts.  The fixed
1:1 relationship between xhci ports and USBPorts is gone.  Now each
USBPort represents a physical plug which has usually two xhci ports
assigned: one usb2 and ond usb3 port.  usb devices show up at one or the
other, depending on whenever they support superspeed or not.

This patch also makes the number of usb2 and usb3 ports runtime
configurable by adding 'p2' and 'p3' properties.  It is allowed to
have different numbers of usb2 and usb3 ports.  Specifying p2=4,p3=2
will give you an xhci adapter which supports all speeds on physical
ports 1+2 and usb2 only on ports 3+4.


  Commit: 6d51b2bb07030c38e5f2d9048c6c474ca486fe9b
      https://github.com/qemu/qemu/commit/6d51b2bb07030c38e5f2d9048c6c474ca486fe9b
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/desc.c
    M hw/usb/desc.h

  Log Message:
  -----------
  usb3: superspeed descriptors

Add superspeed descriptor entry to USBDesc,
advertise superspeed support when present.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: b43a28517620c4eba8ab8b96b08e5ec85aedeeaf
      https://github.com/qemu/qemu/commit/b43a28517620c4eba8ab8b96b08e5ec85aedeeaf
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb.h
    M hw/usb/desc.c
    M hw/usb/desc.h

  Log Message:
  -----------
  usb3: superspeed endpoint companion

Add support for building superspeed endpoint companion descriptors,
create them for superspeed usb devices.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 2077469b58066da3cdac9e5b81d3c60178e6d300
      https://github.com/qemu/qemu/commit/2077469b58066da3cdac9e5b81d3c60178e6d300
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb.h
    M hw/usb/desc.c
    M hw/usb/desc.h
    M trace-events

  Log Message:
  -----------
  usb3: bos decriptor

Add support for creating BOS descriptor and
device cappability descriptors.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 79b40459ba361ac0946bb54fee4a2389d1307c68
      https://github.com/qemu/qemu/commit/79b40459ba361ac0946bb54fee4a2389d1307c68
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/dev-storage.c

  Log Message:
  -----------
  usb-storage: usb3 support

Add usb3 descriptors to usb-storage, so it shows up as superspeed
device when connected to xhci.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: c5e9b02dee4a19f7b047fb75399012e1db759190
      https://github.com/qemu/qemu/commit/c5e9b02dee4a19f7b047fb75399012e1db759190
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: fix &amp; cleanup msi.

Drop custom write_config function which isn't needed any more.
Make the msi property a bit property so it accepts 'on' &amp; 'off'.
Enable MSI by default.

TODO: add compat property to disable on old machine types.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 4c4abe7cc903e057d343cd445eca2e5227783579
      https://github.com/qemu/qemu/commit/4c4abe7cc903e057d343cd445eca2e5227783579
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: rework interrupt handling

Split xhci_irq_update into a function which handles intx updates
(including lowering the irq line once the guests acks the interrupt)
and one which is used for raising an irq only.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 4c47f800631a14c8cb7970ba3a47d4a4ab0ee088
      https://github.com/qemu/qemu/commit/4c47f800631a14c8cb7970ba3a47d4a4ab0ee088
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c
    M trace-events

  Log Message:
  -----------
  xhci: add msix support

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 2cae41195b5b95129d92a189a0bfce3e5d0d8707
      https://github.com/qemu/qemu/commit/2cae41195b5b95129d92a189a0bfce3e5d0d8707
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: move register update into xhci_intr_raise

Now that we have a separate function to raise an IRQ we can move
some comon code into the function.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 962d11e17264af0239f259aad1386fcc7ff471aa
      https://github.com/qemu/qemu/commit/962d11e17264af0239f259aad1386fcc7ff471aa
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c
    M trace-events

  Log Message:
  -----------
  xhci: add XHCIInterrupter

Move all state belonging to the (single) interrupter into a separate
struct.  First step in adding support for multiple interrupters.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 43d9d6047e0f12b96bfc680982a630f0af78611a
      https://github.com/qemu/qemu/commit/43d9d6047e0f12b96bfc680982a630f0af78611a
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: prepare xhci_runtime_{read,write} for multiple interrupters

Prepare xhci runtime register access function for multiple interrupters.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 2d1de8508fed1bddb1946d7d57256c96e02c1dd4
      https://github.com/qemu/qemu/commit/2d1de8508fed1bddb1946d7d57256c96e02c1dd4
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: pick target interrupter

Pick the correct interrupter when queuing an event.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: fa8ee89e8b0a075e82ca54faa6135137abccfa48
      https://github.com/qemu/qemu/commit/fa8ee89e8b0a075e82ca54faa6135137abccfa48
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: support multiple interrupters

Everything is in place, flip the big switch now
and enable support for multiple interrupters.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 1b067564ce5db9a144eb15239abbd36c31dd65c8
      https://github.com/qemu/qemu/commit/1b067564ce5db9a144eb15239abbd36c31dd65c8
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: kill xhci_mem_{read,write} dispatcher functions

... and register subregions instead, so we offload the dispatching
to the the memory subsystem which is designed to handle it.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 6ee021d41078844df60a3a466e3829a3e82776f3
      https://github.com/qemu/qemu/commit/6ee021d41078844df60a3a466e3829a3e82776f3
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-10 (Mon, 10 Sep 2012)

  Changed paths:
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  xhci: allow bytewise capability register reads

Some guests need this according to
Alejandro Martinez Ruiz &lt;alex@securiforest.com&gt;

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: c5cc28ff8feac21b502d64453c9491ff38f5d62d
      https://github.com/qemu/qemu/commit/c5cc28ff8feac21b502d64453c9491ff38f5d62d
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M tcg/tcg.c
    M tcg/tcg.h

  Log Message:
  -----------
  tcg: improve profiler

Now that there are two passes of optimization (optimize.c, liveness)
there is no point of outputing the statistics of the liveness part
only. Update the code to take into account both optimizations.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 56e4943825e70a45d1fbba4fffa431000c6e1c7a
      https://github.com/qemu/qemu/commit/56e4943825e70a45d1fbba4fffa431000c6e1c7a
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: split expression simplification

Split expression simplification in multiple parts so that a given op
can appear multiple times. This patch should not change anything.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 38ee188b1b63606191c013046add021bdc6f1bfd
      https://github.com/qemu/qemu/commit/38ee188b1b63606191c013046add021bdc6f1bfd
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: simplify or/xor r, a, 0 cases

or/xor r, a, 0 is equivalent to a mov r, a.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 61251c0c790d0a63468c8e3eb2767c1f4bf3654a
      https://github.com/qemu/qemu/commit/61251c0c790d0a63468c8e3eb2767c1f4bf3654a
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: simplify and r, a, 0 cases

and r, a, 0 is equivalent to a movi r, 0.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 01ee5282ea955dee4e189b34ef888be6f36d9861
      https://github.com/qemu/qemu/commit/01ee5282ea955dee4e189b34ef888be6f36d9861
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: simplify shift/rot r, 0, a =&gt; movi r, 0 cases

shift/rot r, 0, a is equivalent to movi r, 0.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 65a7cce17ddf6fa1a30d4315da1631d9b6c8fd31
      https://github.com/qemu/qemu/commit/65a7cce17ddf6fa1a30d4315da1631d9b6c8fd31
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: swap brcond/setcond arguments when possible

brcond and setcond ops are not commutative, but it's easy to compute the
new condition after swapping the arguments. Try to always put the constant
argument in second position like for commutative ops, to help backends to
generate better code.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: f8dd19e5c7a5ff8cb5587c9aaea96ef754429713
      https://github.com/qemu/qemu/commit/f8dd19e5c7a5ff8cb5587c9aaea96ef754429713
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: add constant folding for setcond

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: fbeaa26c4cf45a83afaab7aac286d5d96199e740
      https://github.com/qemu/qemu/commit/fbeaa26c4cf45a83afaab7aac286d5d96199e740
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: add constant folding for brcond

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: fedc0da2510b61742dcc4755938093bef4c6078d
      https://github.com/qemu/qemu/commit/fedc0da2510b61742dcc4755938093bef4c6078d
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: fix if/else/break coding style

optimizer.c contains some cases were the break is appearing in both the
if and the else parts. Fix that by moving it to the outer part. Also
move some common code there.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: e0a1e32dbc41e6b2aabb436a9417dfd32177a3dc
      https://github.com/qemu/qemu/commit/e0a1e32dbc41e6b2aabb436a9417dfd32177a3dc
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M configure
    M hw/usb.h
    M hw/usb/core.c
    M hw/usb/desc.c
    M hw/usb/desc.h
    M hw/usb/dev-audio.c
    M hw/usb/dev-serial.c
    M hw/usb/dev-storage.c
    M hw/usb/hcd-ehci.c
    M hw/usb/hcd-uhci.c
    M hw/usb/hcd-xhci.c
    M hw/usb/redirect.c
    M trace-events

  Log Message:
  -----------
  Merge branch 'usb.64' of git://git.kraxel.org/qemu

* 'usb.64' of git://git.kraxel.org/qemu: (54 commits)
  xhci: allow bytewise capability register reads
  xhci: kill xhci_mem_{read,write} dispatcher functions
  xhci: support multiple interrupters
  xhci: pick target interrupter
  xhci: prepare xhci_runtime_{read,write} for multiple interrupters
  xhci: add XHCIInterrupter
  xhci: move register update into xhci_intr_raise
  xhci: add msix support
  xhci: rework interrupt handling
  xhci: fix &amp; cleanup msi.
  usb-storage: usb3 support
  usb3: bos decriptor
  usb3: superspeed endpoint companion
  usb3: superspeed descriptors
  xhci: update port handling
  xhci: update register layout
  xhci: fix runtime write tracepoint
  xhci: add trace_usb_xhci_ep_set_dequeue
  xhci: trace cc codes in cleartext
  xhci: iso xfer support
  ...


Compare: https://github.com/qemu/qemu/compare/4b1c11fd20e8...e0a1e32dbc41

----==_mimepart_504f7528c5a23_2e2e1804ae896915--


</body></email><email><emailId>20120915173008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-15 17:30:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 3cebc3: tcg: Fix MAX_OPC_PARAM_IARGS</subject><body>



----==_mimepart_5054bb2062c0c_6fb6d7baf44454c
Date: Sat, 15 Sep 2012 10:30:08 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5054bb2064294_6fb6d7baf444647@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 3cebc3f11d8d74eb87dc02e712629c45e689960b
      https://github.com/qemu/qemu/commit/3cebc3f11d8d74eb87dc02e712629c45e689960b
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-15 (Sat, 15 Sep 2012)

  Changed paths:
    M def-helper.h
    M exec-all.h

  Log Message:
  -----------
  tcg: Fix MAX_OPC_PARAM_IARGS

DEF_HELPER_FLAGS_5 was added some time ago without adjusting
MAX_OPC_PARAM_IARGS.

Fixing the definition becomes more important as QEMU is using
an increasing number of helper functions called with 5 arguments.

Add also a comment to avoid future problems when DEF_HELPER_FLAGS_6
will be added.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 8bacde8d86a09699207d85d4bab06162aed18dc4
      https://github.com/qemu/qemu/commit/8bacde8d86a09699207d85d4bab06162aed18dc4
  Author: Natanael Copa &lt;natanael.copa@gmail.com&gt;
  Date:   2012-09-15 (Sat, 15 Sep 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: properly check if -lrt and -lm is needed

Fixes build against uClibc.

uClibc provides 2 versions of clock_gettime(), one with realtime
support and one without (this is so you can avoid linking in -lrt
unless actually needed). This means that the clock_gettime() don't
need -lrt. We still need it for timer_create() so we check for this
function in addition.

We also need check if -lm is needed for isnan().

Both -lm and -lrt are needed for libs_qga.

Signed-off-by: Natanael Copa &lt;ncopa@alpinelinux.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/e0a1e32dbc41...8bacde8d86a0

----==_mimepart_5054bb2062c0c_6fb6d7baf44454c--


</body></email><email><emailId>20120916073009</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-16 07:30:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 46ee3d: target-s390x: avoid cpu_single_env</subject><body>



----==_mimepart_5055800137339_49efe37aec168792
Date: Sun, 16 Sep 2012 00:30:09 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;505580013af01_49efe37aec168847@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 46ee3d8455d4d67a1a9438a4b1f1e4ebf977d97b
      https://github.com/qemu/qemu/commit/46ee3d8455d4d67a1a9438a4b1f1e4ebf977d97b
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-15 (Sat, 15 Sep 2012)

  Changed paths:
    M target-s390x/translate.c

  Log Message:
  -----------
  target-s390x: avoid cpu_single_env

Pass around CPUState instead of using global cpu_single_env.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 32ac0ca2ecc0ea0eb6b868abcbe0a7d094870cfd
      https://github.com/qemu/qemu/commit/32ac0ca2ecc0ea0eb6b868abcbe0a7d094870cfd
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-15 (Sat, 15 Sep 2012)

  Changed paths:
    M configure
    M target-lm32/Makefile.objs
    M target-lm32/helper.h
    M target-lm32/op_helper.c
    M target-lm32/translate.c

  Log Message:
  -----------
  target-lm32: switch to AREG0 free mode

Add an explicit CPUState parameter instead of relying on AREG0
and switch to AREG0 free mode.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 31871141521225d089b7705a5d73bf03c605c964
      https://github.com/qemu/qemu/commit/31871141521225d089b7705a5d73bf03c605c964
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-15 (Sat, 15 Sep 2012)

  Changed paths:
    M configure
    M target-m68k/Makefile.objs
    M target-m68k/helpers.h
    M target-m68k/op_helper.c
    M target-m68k/translate.c

  Log Message:
  -----------
  target-m68k: switch to AREG0 free mode

Add an explicit CPUState parameter instead of relying on AREG0
and switch to AREG0 free mode.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: d4d79bb144f0958f7ee2c6c9ef820dc06c1ff476
      https://github.com/qemu/qemu/commit/d4d79bb144f0958f7ee2c6c9ef820dc06c1ff476
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-15 (Sat, 15 Sep 2012)

  Changed paths:
    M target-m68k/translate.c

  Log Message:
  -----------
  target-m68k: avoid using cpu_single_env

Pass around CPUState instead of using global cpu_single_env.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 04a130eaa10f3d2af6ac9fb68a8daffd40a2f9aa
      https://github.com/qemu/qemu/commit/04a130eaa10f3d2af6ac9fb68a8daffd40a2f9aa
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-15 (Sat, 15 Sep 2012)

  Changed paths:
    M configure
    M target-unicore32/Makefile.objs
    M target-unicore32/helper.h
    M target-unicore32/op_helper.c
    M target-unicore32/translate.c

  Log Message:
  -----------
  target-unicore32: switch to AREG0 free mode

Add an explicit CPUState parameter instead of relying on AREG0
and switch to AREG0 free mode.

Tested-by: Guan Xuetao &lt;gxt@mprc.pku.edu.cn&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 1ce94f81eca411b64c71a05b11e4c51dea86639f
      https://github.com/qemu/qemu/commit/1ce94f81eca411b64c71a05b11e4c51dea86639f
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-15 (Sat, 15 Sep 2012)

  Changed paths:
    M target-arm/helper.h
    M target-arm/op_helper.c
    M target-arm/translate.c

  Log Message:
  -----------
  target-arm: convert void helpers

Add an explicit CPUState parameter instead of relying on AREG0.

For easier review, convert only op helpers which don't return any value.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 9ef392772597693b07959460f6c27b9b5a8287a1
      https://github.com/qemu/qemu/commit/9ef392772597693b07959460f6c27b9b5a8287a1
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-15 (Sat, 15 Sep 2012)

  Changed paths:
    M target-arm/helper.h
    M target-arm/op_helper.c
    M target-arm/translate.c

  Log Message:
  -----------
  target-arm: convert remaining helpers

Convert remaining helpers to AREG0 free mode: add an explicit
CPUState parameter instead of relying on AREG0.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: d31dd73e48561de5f9d718febfb44224f7aab818
      https://github.com/qemu/qemu/commit/d31dd73e48561de5f9d718febfb44224f7aab818
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-15 (Sat, 15 Sep 2012)

  Changed paths:
    M configure
    M target-arm/Makefile.objs
    M target-arm/cpu.h
    M target-arm/helper.c
    M target-arm/op_helper.c
    M target-arm/translate.c

  Log Message:
  -----------
  target-arm: final conversion to AREG0 free mode

Convert code load functions and switch to AREG0 free mode.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 64254eba53198fd14b52128b3f0026000d2dc4ab
      https://github.com/qemu/qemu/commit/64254eba53198fd14b52128b3f0026000d2dc4ab
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-15 (Sat, 15 Sep 2012)

  Changed paths:
    M configure
    M target-microblaze/Makefile.objs
    M target-microblaze/helper.h
    M target-microblaze/op_helper.c
    M target-microblaze/translate.c

  Log Message:
  -----------
  target-microblaze: switch to AREG0 free mode

Add an explicit CPUState parameter instead of relying on AREG0
and switch to AREG0 free mode.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: febc9920c66dd51245c2ca2ee88ada2aa5d0a63e
      https://github.com/qemu/qemu/commit/febc9920c66dd51245c2ca2ee88ada2aa5d0a63e
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-15 (Sat, 15 Sep 2012)

  Changed paths:
    M target-cris/helper.h
    M target-cris/op_helper.c
    M target-cris/translate.c
    M target-cris/translate_v10.c

  Log Message:
  -----------
  target-cris: Avoid AREG0 for helpers

Add an explicit CPUCRISState parameter instead of relying on AREG0.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: cf7e0c80aa21620ca36161faff7e0ce4f7b866ac
      https://github.com/qemu/qemu/commit/cf7e0c80aa21620ca36161faff7e0ce4f7b866ac
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-15 (Sat, 15 Sep 2012)

  Changed paths:
    M configure
    M target-cris/Makefile.objs
    M target-cris/helper.c
    M target-cris/op_helper.c
    M target-cris/translate.c
    M target-cris/translate_v10.c

  Log Message:
  -----------
  target-cris: Switch to AREG0 free mode

Add an explicit CPUCRISState parameter instead of relying on AREG0, and
use cpu_ld* in translation and interrupt handling. Remove AREG0 swapping
in tlb_fill(). Switch to AREG0 free mode

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 485d003539b96c33b9f9f7c627d1071524ecc6a7
      https://github.com/qemu/qemu/commit/485d003539b96c33b9f9f7c627d1071524ecc6a7
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-15 (Sat, 15 Sep 2012)

  Changed paths:
    M configure
    M target-sh4/Makefile.objs
    M target-sh4/helper.h
    M target-sh4/op_helper.c
    M target-sh4/translate.c

  Log Message:
  -----------
  target-sh4: switch to AREG0 free mode

Add an explicit CPUState parameter instead of relying on AREG0
and switch to AREG0 free mode.

Acked-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 895c2d0435924532c92252fbbf5c4caec8540d34
      https://github.com/qemu/qemu/commit/895c2d0435924532c92252fbbf5c4caec8540d34
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-15 (Sat, 15 Sep 2012)

  Changed paths:
    M configure
    M target-mips/Makefile.objs
    M target-mips/cpu.h
    M target-mips/helper.h
    M target-mips/op_helper.c
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: switch to AREG0 free mode

Add an explicit CPUState parameter instead of relying on AREG0
and switch to AREG0 free mode.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Acked-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 89c33337fd21930de671a6e34793e8b1ee257e2e
      https://github.com/qemu/qemu/commit/89c33337fd21930de671a6e34793e8b1ee257e2e
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-15 (Sat, 15 Sep 2012)

  Changed paths:
    M Makefile.target
    M configure
    M cpu-all.h
    M cputlb.c
    R dyngen-exec.h
    M exec-all.h
    M hw/spapr_hcall.c
    M softmmu_defs.h
    M softmmu_header.h
    M softmmu_template.h
    M target-m68k/op_helper.c
    M target-sparc/Makefile.objs
    M tcg/arm/tcg-target.c
    M tcg/arm/tcg-target.h
    M tcg/hppa/tcg-target.c
    M tcg/hppa/tcg-target.h
    M tcg/i386/tcg-target.c
    M tcg/i386/tcg-target.h
    M tcg/ia64/tcg-target.c
    M tcg/ia64/tcg-target.h
    M tcg/mips/tcg-target.c
    M tcg/mips/tcg-target.h
    M tcg/ppc/tcg-target.c
    M tcg/ppc64/tcg-target.c
    M tcg/s390/tcg-target.c
    M tcg/s390/tcg-target.h
    M tcg/sparc/tcg-target.c
    M tcg/sparc/tcg-target.h
    M tcg/tci/tcg-target.c
    M tci.c
    M user-exec.c

  Log Message:
  -----------
  Remove unused CONFIG_TCG_PASS_AREG0 and dead code

Now that CONFIG_TCG_PASS_AREG0 is enabled for all targets,
remove dead code and support for !CONFIG_TCG_PASS_AREG0 case.

Remove dyngen-exec.h and all references to it. Although included by
hw/spapr_hcall.c, it does not seem to use it.

Remove unused HELPER_CFLAGS.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;


Compare: https://github.com/qemu/qemu/compare/8bacde8d86a0...89c33337fd21

----==_mimepart_5055800137339_49efe37aec168792--


</body></email><email><emailId>20120917183021</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-17 18:30:21-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 287963: update-linux-headers.sh: Don't hard code list of a...</subject><body>



----==_mimepart_50576c3d15f12_278d1320af44803
Date: Mon, 17 Sep 2012 11:30:21 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50576c3d1b262_278d1320af448147@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 2879636d55312b5391ec46c7dee5d3a07714c222
      https://github.com/qemu/qemu/commit/2879636d55312b5391ec46c7dee5d3a07714c222
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M scripts/update-linux-headers.sh

  Log Message:
  -----------
  update-linux-headers.sh: Don't hard code list of architectures

Rather than hardcoding the list of architectures in the kernel
header update script, just import headers for every architecture
which supports KVM (with a blacklist exception for ia64 which
has KVM headers but is dead). This reduces the number of QEMU
files which need to be updated to add support for a new KVM
architecture.

Acked-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 8732fbd2afce18afc429da2ad76df7c48b4bac4b
      https://github.com/qemu/qemu/commit/8732fbd2afce18afc429da2ad76df7c48b4bac4b
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M kvm-all.c

  Log Message:
  -----------
  kvm-all.c: Move init of irqchip_inject_ioctl out of kvm_irqchip_create()

Move the init of the irqchip_inject_ioctl field of KVMState out of
kvm_irqchip_create() and into kvm_init(), so that kvm_set_irq()
can be used even when no irqchip is created (for architectures
that support async interrupt notification even without an in
kernel irqchip).

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: d410515e035ccb7433c6a3a8157742f6f679f57f
      https://github.com/qemu/qemu/commit/d410515e035ccb7433c6a3a8157742f6f679f57f
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M memory.c
    M memory.h

  Log Message:
  -----------
  memory: Flush coalesced MMIO on selected region access

Instead of flushing pending coalesced MMIO requests on every vmexit,
this provides a mechanism to selectively flush when memory regions
related to the coalesced one are accessed. This first of all includes
the coalesced region itself but can also applied to other regions, e.g.
of the same device, by calling memory_region_set_flush_coalesced.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 59023ef41179f61bfc1e2500c406ad28d046b09d
      https://github.com/qemu/qemu/commit/59023ef41179f61bfc1e2500c406ad28d046b09d
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M memory.c

  Log Message:
  -----------
  memory: Use transaction_begin/commit also for single-step operations

Wrap also simple operations consisting only of a single step with
memory_region_transaction_begin/commit. This allows to perform
additional steps like coalesced MMIO flushing from a single place.

This requires dropping some micro-optimizations: The skipping of
topology updates after updating disabled or unregistered regions.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 02e2b95fb4bcf8b0a512c5eb449cfb9a1ea3d3b7
      https://github.com/qemu/qemu/commit/02e2b95fb4bcf8b0a512c5eb449cfb9a1ea3d3b7
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M memory.c

  Log Message:
  -----------
  memory: Fold memory_region_update_topology into memory_region_transaction_commit

Simplify the code as we are using now only a subset of the original
features of memory_region_update_topology.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: bb880ded7a6a77b2a7818e6302ac55fbd9ba5e86
      https://github.com/qemu/qemu/commit/bb880ded7a6a77b2a7818e6302ac55fbd9ba5e86
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M memory.c

  Log Message:
  -----------
  memory: Flush coalesced MMIO on mapping and state changes

Flush pending coalesced MMIO before performing mapping or state changes
that could affect the event orderings or route the buffered requests to
a wrong region.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: bd8f2f5d7034172a53c5a5b229613761f3297493
      https://github.com/qemu/qemu/commit/bd8f2f5d7034172a53c5a5b229613761f3297493
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M hw/cirrus_vga.c
    M hw/qxl.c
    M hw/vga-isa-mm.c
    M hw/vga.c
    M hw/vmware_vga.c

  Log Message:
  -----------
  VGA: Flush coalesced MMIO on related MMIO/PIO accesses

In preparation of stopping to flush coalesced MMIO unconditionally on
vmexits, mark VGA MMIO and PIO regions as synchronous /wrt coalesced
MMIO and flush the buffer explicitly on PIO accesses that do not use
generic memory regions yet.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 683d4b5d9f46f7453271577ad0212b67bdd9cb1b
      https://github.com/qemu/qemu/commit/683d4b5d9f46f7453271577ad0212b67bdd9cb1b
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M kvm-all.c

  Log Message:
  -----------
  kvm: Stop flushing coalesced MMIO on vmexit

The memory subsystem will now take care of flushing whenever affected
regions are accessed or the memory mapping changes.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: e333cd694920f056573083c6d38fbdf0238c390d
      https://github.com/qemu/qemu/commit/e333cd694920f056573083c6d38fbdf0238c390d
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M kvm-all.c

  Log Message:
  -----------
  kvm: Rename irqchip_inject_ioctl to irq_set_ioctl

This variable is no longer bound to irqchip, and the IOCTL sets the IRQ
level, does not directly inject it. No functional changes.

Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: b1af98ba3e4c4fd44f233fc7240df2612baeb1c2
      https://github.com/qemu/qemu/commit/b1af98ba3e4c4fd44f233fc7240df2612baeb1c2
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M hw/qxl.c
    M ui/spice-display.c
    M ui/spice-display.h

  Log Message:
  -----------
  spice: switch to queue for vga mode updates

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: c60319a3aa136769e38ea8b24e91fb4867c4587d
      https://github.com/qemu/qemu/commit/c60319a3aa136769e38ea8b24e91fb4867c4587d
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M ui/spice-display.c

  Log Message:
  -----------
  spice: split qemu_spice_create_update

Creating one function which creates a single update for a given
rectangle.  And one (for now) pretty simple wrapper around it to
queue up screen updates for the dirty region.

[ v2: also update bounding box ]

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: a7310dd34df4d35a1c3e7ea3f4a94c60f6d5064b
      https://github.com/qemu/qemu/commit/a7310dd34df4d35a1c3e7ea3f4a94c60f6d5064b
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M ui/spice-display.c
    M ui/spice-display.h

  Log Message:
  -----------
  spice: add screen mirror

Create a screen mirror, keep there a copy of the most recent update
passed on to spice-server.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: b021bd29835b0367d499e042f76afbbf4b6ee026
      https://github.com/qemu/qemu/commit/b021bd29835b0367d499e042f76afbbf4b6ee026
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M ui/spice-display.c

  Log Message:
  -----------
  spice: send updates only for changed screen content

when creating screen updates go compare the current guest screen
against the mirror (which holds the most recent update sent), then
only create updates for the screen areas which did actually change.

[ v2: drop redundant qemu_spice_create_one_update call ]

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: ccc2960d654a233a6ed415b37d8ff41728d817c5
      https://github.com/qemu/qemu/commit/ccc2960d654a233a6ed415b37d8ff41728d817c5
  Author: Dunrong Huang &lt;riegamaths@gmail.com&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  qxl: dont update invalid area

This patch fixes the following error:

$ ~/usr/bin/qemu-system-x86_64 -enable-kvm -m 1024 -spice port=5900,disable-ticketing \
-vga qxl -cdrom ~/Images/linuxmint-13-mate-dvd-32bit.iso \
(/home/mathslinux/usr/bin/qemu-system-x86_64:10068): SpiceWorker-CRITICAL **: \
red_worker.c:4599:red_update_area: condition `area-&gt;left &gt;= 0 &amp;&amp; area-&gt;top &gt;= 0 &amp;&amp; \
area-&gt;left &lt; area-&gt;right &amp;&amp; area-&gt;top &lt; area-&gt;bottom' failed Aborted

spice server terminates QEMU process if we pass invalid area to it,
so dont update those invalid areas.

Signed-off-by: Dunrong Huang &lt;riegamaths@gmail.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: ab902981cf4d46834d82eb095f2b9ab159e017bf
      https://github.com/qemu/qemu/commit/ab902981cf4d46834d82eb095f2b9ab159e017bf
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  qxl: Ignore set_client_capabilities pre/post migrate

The recent introduction of set_client_capabilities has broken
(seamless) migration by trying to call qxl_send_events pre (seamless
incoming) and post (*) migration, triggering the following assert:
qxl_send_events: Assertion `qemu_spice_display_is_running(&amp;d-&gt;ssd)' failed.

The solution is easy, pre migration the guest will have already received
the client caps on the migration source side, and post migration there no
longer is a guest, so we can simply ignore the set_client_capabilities call
in both those scenarios.

*) Post migration, so not fatal for to the migration itself, but still a crash

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 753b8b0d77ba1b343a35f9679cc777ea10a62bba
      https://github.com/qemu/qemu/commit/753b8b0d77ba1b343a35f9679cc777ea10a62bba
  Author: Uri Lublin &lt;uril@redhat.com&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M hw/qxl.c

  Log Message:
  -----------
  qxl: better cleanup for surface destroy

Add back a call to qxl_spice_destroy_surface_wait_complete() in \
qxl_spice_destroy_surface_wait(), that was removed by commit \
c480bb7da465186b84d8427e068ef7502e47ffbf

It is needed to complete surface-removal cleanup, for non async.
For async, qxl_spice_destroy_surface_wait_complete is called upon operation \
completion.

Signed-off-by: Uri Lublin &lt;uril@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 1f7a48de4467f31afc51169122453318efdb0f33
      https://github.com/qemu/qemu/commit/1f7a48de4467f31afc51169122453318efdb0f33
  Author: MORITA Kazutaka &lt;morita.kazutaka@lab.ntt.co.jp&gt;
  Date:   2012-09-12 (Wed, 12 Sep 2012)

  Changed paths:
    M block/sheepdog.c

  Log Message:
  -----------
  sheepdog: fix savevm and loadvm

This patch sets data to be sent to Sheepdog correctly and fixes savevm
and loadvm operations on a Sheepdog image.

Signed-off-by: MORITA Kazutaka &lt;morita.kazutaka@lab.ntt.co.jp&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: ce560dcf20c14194db5ef3b9fc1ea592d4e68109
      https://github.com/qemu/qemu/commit/ce560dcf20c14194db5ef3b9fc1ea592d4e68109
  Author: Ronnie Sahlberg &lt;ronniesahlberg@gmail.com&gt;
  Date:   2012-09-12 (Wed, 12 Sep 2012)

  Changed paths:
    M hw/ide/atapi.c

  Log Message:
  -----------
  ATAPI: STARTSTOPUNIT only eject/load media if powercondition is 0

The START STOP UNIT command will only eject/load media if
power condition is zero.

If power condition is !0 then LOEJ and START will be ignored.

&gt; From MMC (sbc contains similar wordings too)
  The Power Conditions field requests the block device to be placed
  in the power condition defined in
  Table 558. If this field has a value other than 0h then the Start
  and LoEj bits shall be ignored.

Signed-off-by: Ronnie Sahlberg &lt;ronniesahlberg@gmail.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 1e53537fdaa4657d11f130a0f2673fcfb1956381
      https://github.com/qemu/qemu/commit/1e53537fdaa4657d11f130a0f2673fcfb1956381
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-12 (Wed, 12 Sep 2012)

  Changed paths:
    M hw/ide/core.c

  Log Message:
  -----------
  ide: Fix error messages from static code analysis (no real error)

Report from smatch:
hw/ide/core.c:1472 ide_exec_cmd(423) error: buffer overflow 'smart_attributes' 8 &lt;= \
29 hw/ide/core.c:1474 ide_exec_cmd(425) error: buffer overflow 'smart_attributes' 8 \
&lt;= 29 hw/ide/core.c:1475 ide_exec_cmd(426) error: buffer overflow 'smart_attributes' \
                8 &lt;= 29
...

The upper limit of 30 was never reached because both for loops terminated
when 'smart_attributes' reached end of list, so there was no real buffer
overflow.

Nevertheless, changing the code not only fixes the error report, but also
reduces the size of smart_attributes and simplifies the for loops.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 45724d6d02383b0d7d4a90e05787fca7c55cb070
      https://github.com/qemu/qemu/commit/45724d6d02383b0d7d4a90e05787fca7c55cb070
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-12 (Wed, 12 Sep 2012)

  Changed paths:
    M block/curl.c

  Log Message:
  -----------
  block/curl: Fix wrong free statement

Report from smatch:
block/curl.c:546 curl_close(21) info: redundant null check on s-&gt;url calling free()

The check was redundant, and free was also wrong because the memory
was allocated using g_strdup.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 514f21a5d4613e495adc2e2dd48f18091454efb8
      https://github.com/qemu/qemu/commit/514f21a5d4613e495adc2e2dd48f18091454efb8
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-12 (Wed, 12 Sep 2012)

  Changed paths:
    M block/vdi.c

  Log Message:
  -----------
  vdi: Fix warning from clang

ccc-analyzer reports these warnings:

block/vdi.c:704:13: warning: Dereference of null pointer
      bmap[i] = VDI_UNALLOCATED;
      ^
block/vdi.c:702:13: warning: Dereference of null pointer
      bmap[i] = i;
      ^

Moving some code into the if block fixes this.
It also avoids calling function write with 0 bytes of data.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 9ca111544c64b5abed2e79cf52e19a8f227b347b
      https://github.com/qemu/qemu/commit/9ca111544c64b5abed2e79cf52e19a8f227b347b
  Author: Pavel Hrdina &lt;phrdina@redhat.com&gt;
  Date:   2012-09-12 (Wed, 12 Sep 2012)

  Changed paths:
    M block.c

  Log Message:
  -----------
  block: fix block tray status

The tray status should change also if you eject empty block device.

Signed-off-by: Pavel Hrdina &lt;phrdina@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 2a4f4f34e6fe55f4c82507c3e7ec9b58c2e24ad4
      https://github.com/qemu/qemu/commit/2a4f4f34e6fe55f4c82507c3e7ec9b58c2e24ad4
  Author: Jason Baron &lt;jbaron@redhat.com&gt;
  Date:   2012-09-12 (Wed, 12 Sep 2012)

  Changed paths:
    M hw/ide/ahci.c

  Log Message:
  -----------
  ahci: properly reset PxCMD on HBA reset

While testing q35, I found that windows 7 (specifically, windows 7 ultimate
with sp1 x64), wouldn't install because it can't find the cdrom or disk drive.
The failure message is: 'A required cd/dvd device driver is missing. If you
have a driver floppy disk, CD, DVD, or USB flash drive, please insert it now.'
This can also be reproduced on piix by adding an ahci controller, and
observing that windows 7 does not see any devices behind it.

The problem is that when windows issues a HBA reset, qemu does not reset the
individual ports' PxCMD register. Windows 7 then reads back the PxCMD register
and presumably assumes that the ahci controller has already been initialized.
Windows then never sets up the PxIE register to enable interrupts, and thus it
never gets irqs back when it sends ata device inquiry commands.

This change brings qemu into ahci 1.3 specification compliance.

Section 10.4.3 HBA Reset:

"
When GHC.HR is set to '1', GHC.AE, GHC.IE, the IS register, and all port
register fields (except PxFB/PxFBU/PxCLB/PxCLBU) that are not HwInit in the
HBA's register memory space are reset.
"

I've also re-tested Fedora 16 and 17 to verify that they continue to work with
this change.

Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Acked-by: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: c249ee682542ff3b8c310c78be67e3e713fd61d7
      https://github.com/qemu/qemu/commit/c249ee682542ff3b8c310c78be67e3e713fd61d7
  Author: BenoÃ®t Canet &lt;benoit@irqsave.net&gt;
  Date:   2012-09-12 (Wed, 12 Sep 2012)

  Changed paths:
    M qapi-schema.json

  Log Message:
  -----------
  qapi: Add SnapshotInfo and ImageInfo.

Signed-off-by: Benoit Canet &lt;benoit@irqsave.net&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: c054b3fd78f28b12f4d066583fc0ade017752479
      https://github.com/qemu/qemu/commit/c054b3fd78f28b12f4d066583fc0ade017752479
  Author: BenoÃ®t Canet &lt;benoit@irqsave.net&gt;
  Date:   2012-09-12 (Wed, 12 Sep 2012)

  Changed paths:
    M Makefile
    M qemu-img-cmds.hx
    M qemu-img.c
    M qemu-img.texi

  Log Message:
  -----------
  qemu-img: Add json output option to the info command.

This option --output=[human|json] make qemu-img info output on
human or JSON representation at the choice of the user.

example:
{
    "snapshots": [
  {
      "vm-clock-nsec": 637102488,
      "name": "vm-20120821145509",
      "date-sec": 1345553709,
      "date-nsec": 220289000,
      "vm-clock-sec": 20,
      "id": "1",
      "vm-state-size": 96522745
  },
  {
      "vm-clock-nsec": 28210866,
      "name": "vm-20120821154059",
      "date-sec": 1345556459,
      "date-nsec": 171392000,
      "vm-clock-sec": 46,
      "id": "2",
      "vm-state-size": 101208714
  }
    ],
    "virtual-size": 1073741824,
    "filename": "snap.qcow2",
    "cluster-size": 65536,
    "format": "qcow2",
    "actual-size": 985587712,
    "dirty-flag": false
}

Signed-off-by: Benoit Canet &lt;benoit@irqsave.net&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: f0536bb848ad6eb2709a7dc675f261bd160c751b
      https://github.com/qemu/qemu/commit/f0536bb848ad6eb2709a7dc675f261bd160c751b
  Author: Daniel P. Berrange &lt;berrange@redhat.com&gt;
  Date:   2012-09-12 (Wed, 12 Sep 2012)

  Changed paths:
    M qemu-img.c

  Log Message:
  -----------
  Don't require encryption password for 'qemu-img info' command

The encryption password is only required if I/O is going to be
performed on a disk image. The 'qemu-img info' command merely
reports metadata, so it should not ask for a decryption password

Signed-off-by: Daniel P. Berrange &lt;berrange@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: fe235a06e1e008dedd2ac3cc0a3a655169ce9b33
      https://github.com/qemu/qemu/commit/fe235a06e1e008dedd2ac3cc0a3a655169ce9b33
  Author: Dunrong Huang &lt;riegamaths@gmail.com&gt;
  Date:   2012-09-12 (Wed, 12 Sep 2012)

  Changed paths:
    M block.c

  Log Message:
  -----------
  block: Don't forget to delete temporary file

The caller would not delete temporary file after failed get_tmp_filename().

Signed-off-by: Dunrong Huang &lt;riegamaths@gmail.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 917ae08ca1565aab2d10c8b6269cd905d6c5c05b
      https://github.com/qemu/qemu/commit/917ae08ca1565aab2d10c8b6269cd905d6c5c05b
  Author: Alon Levy &lt;alevy@redhat.com&gt;
  Date:   2012-09-12 (Wed, 12 Sep 2012)

  Changed paths:
    M hw/qxl.c
    M trace-events

  Log Message:
  -----------
  hw/qxl: tracing fixes

Add two new trace events:
qxl_send_events(int qid, uint32_t events) "%d %d"
qxl_set_guest_bug(int qid) "%d"

Change qxl_io_unexpected_vga_mode parameters to be equivalent to those
of qxl_io_write for easier grouping under a single systemtap probe.

Change d to qxl in one place.

Signed-off-by: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 1a1bc08568b3fc3d893cab774806cdcedfe1b60b
      https://github.com/qemu/qemu/commit/1a1bc08568b3fc3d893cab774806cdcedfe1b60b
  Author: Alon Levy &lt;alevy@redhat.com&gt;
  Date:   2012-09-12 (Wed, 12 Sep 2012)

  Changed paths:
    M hw/qxl.c
    M trace-events

  Log Message:
  -----------
  qxl: add trace-event for QXL_IO_LOG

Signed-off-by: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: a639ab0482952c13c896f3e555d717caf98f138b
      https://github.com/qemu/qemu/commit/a639ab0482952c13c896f3e555d717caf98f138b
  Author: Alon Levy &lt;alevy@redhat.com&gt;
  Date:   2012-09-12 (Wed, 12 Sep 2012)

  Changed paths:
    M configure
    M hw/qxl.c
    M trace-events

  Log Message:
  -----------
  hw/qxl: support client monitor configuration via device

Until now we used only the agent to change the monitor count and each
monitor resolution. This patch introduces the qemu part of using the
device as the mediator instead of the agent via virtio-serial.

Spice (&gt;=0.11.5) calls the new QXLInterface::client_monitors_config,
which returns wether the interrupt is enabled, and if so and given a non
NULL monitors config will
generate an interrupt QXL_INTERRUPT_CLIENT_MONITORS_CONFIG with crc
checksum for the guest to verify a second call hasn't interfered.

The maximal number of monitors is limited on the QXLRom to 64.

Signed-off-by: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: c4d12a743c73a5b88a8705ca68ff620ce0f8bba7
      https://github.com/qemu/qemu/commit/c4d12a743c73a5b88a8705ca68ff620ce0f8bba7
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-13 (Thu, 13 Sep 2012)

  Changed paths:
    M slirp/tcp_subr.c

  Log Message:
  -----------
  slirp: Remove wrong type casts ins debug statements

The type casts of pointers to long are not allowed
when sizeof(pointer) != sizeof(long).

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;


  Commit: e56afbc54a2132c56931f44bae1992c28119944f
      https://github.com/qemu/qemu/commit/e56afbc54a2132c56931f44bae1992c28119944f
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-13 (Thu, 13 Sep 2012)

  Changed paths:
    M slirp/tcp_subr.c

  Log Message:
  -----------
  slirp: Fix error reported by static code analysis

Report from smatch:

slirp/tcp_subr.c:127 tcp_respond(17) error:
 we previously assumed 'tp' could be null (see line 124)

Return if 'tp' is NULL.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;


  Commit: 78be056628c76ff73eedeade86fde44b97343c79
      https://github.com/qemu/qemu/commit/78be056628c76ff73eedeade86fde44b97343c79
  Author: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
  Date:   2012-09-13 (Thu, 13 Sep 2012)

  Changed paths:
    M slirp/tftp.c
    M slirp/tftp.h

  Log Message:
  -----------
  slirp: improve TFTP performance

When transferring a file, keep it open during the whole transfer,
instead of opening/closing it for each block.

Signed-off-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Reviewed-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;


  Commit: 4aa401f39e048e71020cceb59f126ab941095a42
      https://github.com/qemu/qemu/commit/4aa401f39e048e71020cceb59f126ab941095a42
  Author: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
  Date:   2012-09-13 (Thu, 13 Sep 2012)

  Changed paths:
    M slirp/tftp.c
    M slirp/tftp.h

  Log Message:
  -----------
  slirp: Handle more than 65535 blocks in TFTP transfers

RFC 1350 does not mention block count roll-over. However, a lot of TFTP servers
implement it to be able to transmit big files, so do it also.

Current block size is 512 bytes, so TFTP files were limited to 32 MB.

Signed-off-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;


  Commit: eb7faf0e3a45b0a0089035f972080ca4bd2e15ce
      https://github.com/qemu/qemu/commit/eb7faf0e3a45b0a0089035f972080ca4bd2e15ce
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-09-13 (Thu, 13 Sep 2012)

  Changed paths:
    M slirp/tftp.c

  Log Message:
  -----------
  slirp: Remove unused return value of tftp_send_next_block

No caller actually makes use of this value, so let's simplify the code.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;


  Commit: 95b1ad7ad86793c27ab8e9987be69571937900d1
      https://github.com/qemu/qemu/commit/95b1ad7ad86793c27ab8e9987be69571937900d1
  Author: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
  Date:   2012-09-13 (Thu, 13 Sep 2012)

  Changed paths:
    M slirp/tftp.c

  Log Message:
  -----------
  slirp: Implement TFTP Blocksize option

This option is described in RFC 1783. As this is only an optional field,
we may ignore it in some situations and handle it in some others.

However, MS Windows 2003 PXE boot client requests a block size of the MTU
(most of the times 1472 bytes), and doesn't work if the option is not
acknowledged (with whatever value).

According to the RFC 1783, we cannot acknowledge the option with a bigger
value than the requested one.

As current implementation is using 512 bytes by block, accept the option
with a value of 512 if the option was specified, and don't acknowledge it
if it is not present or less than 512 bytes.

Signed-off-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;


  Commit: 93d3ad2a8048469d2b2bb157697425b66b2a37aa
      https://github.com/qemu/qemu/commit/93d3ad2a8048469d2b2bb157697425b66b2a37aa
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M hw/srp.h

  Log Message:
  -----------
  srp: Don't use QEMU_PACKED for single elements of a structured type

QEMU_PACKED results in a MinGW compiler warning when it is
used for single structure elements:

warning: 'gcc_struct' attribute ignored

Using QEMU_PACKED for the whole structure avoids the compiler warning
without changing the memory layout.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 0546b8c2f089867cd7606ff47e026e8931157828
      https://github.com/qemu/qemu/commit/0546b8c2f089867cd7606ff47e026e8931157828
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M docs/specs/ppc-spapr-hcalls.txt
    M docs/usb2.txt
    M hw/xen_pt.h
    M hw/xen_pt_config_init.c
    M qemu-img.c
    M qemu-img.texi

  Log Message:
  -----------
  Spelling fixes in comments and documentation

These wrong spellings were detected by codespell:

* successully -&gt; successfully

* alot -&gt; a lot

* wanna -&gt; want to

* infomation -&gt; information

* occured -&gt; occurred

["also is" -&gt; "is also" and "ressources" -&gt; "resources" suggested by
Peter Maydell &lt;peter.maydell@linaro.org&gt;]

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: aade7b91d5afce84b1328f0dbbc77452bde00d1f
      https://github.com/qemu/qemu/commit/aade7b91d5afce84b1328f0dbbc77452bde00d1f
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M hw/imx_avic.c
    M hw/imx_timer.c
    M hw/kzm.c

  Log Message:
  -----------
  Fix spelling (licenced -&gt; licensed) in GPL

The patch also fixes the case of "written".

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 52a8e968a325f5dbbdceba06aaad2ac94f30da37
      https://github.com/qemu/qemu/commit/52a8e968a325f5dbbdceba06aaad2ac94f30da37
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M hw/xen-host-pci-device.c

  Log Message:
  -----------
  Spelling fixes in comments and macro names (ressource -&gt; resource)

Macro XEN_HOST_PCI_RESOURCE_BUFFER_SIZE is only used locally,
so the change should be safe.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 4580c490107ec846fb1ec63be823cf65dbb19f73
      https://github.com/qemu/qemu/commit/4580c490107ec846fb1ec63be823cf65dbb19f73
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M ui/spice-display.c

  Log Message:
  -----------
  ui: Fix spelling in comment (ressource -&gt; resource)

The function is called interface_release_resource.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 7b1532eccf63eae318f9116adfd4cc2ba51e31fd
      https://github.com/qemu/qemu/commit/7b1532eccf63eae318f9116adfd4cc2ba51e31fd
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M linux-user/main.c

  Log Message:
  -----------
  linux-user: Remove #if 0'd cpu_get_real_ticks() definition

Remove the cpu_get_real_ticks() definition from linux-user/main.c.
This has been disabled via #if 0 and unused since commit 1dce7c3c22
in 2006; the definitions we actually use are in qemu-timer.h.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 1a7e8cae4bfd99beca9103de188440afda6c002a
      https://github.com/qemu/qemu/commit/1a7e8cae4bfd99beca9103de188440afda6c002a
  Author: BALATON Zoltan &lt;balaton@eik.bme.hu&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M memory.h

  Log Message:
  -----------
  Fix copy&amp;paste typos in documentation comments

Signed-off-by: BALATON Zoltan &lt;balaton@eik.bme.hu&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: feadf1a4de0d7468ffb671a2b9f681925469fa58
      https://github.com/qemu/qemu/commit/feadf1a4de0d7468ffb671a2b9f681925469fa58
  Author: BALATON Zoltan &lt;balaton@eik.bme.hu&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M console.c

  Log Message:
  -----------
  console: Clean up bytes per pixel calculation

Division with round up is the correct way to compute this even if the
only case where division with round down gives incorrect result is
probably 15 bpp. This case was explicitely patched up in one of these
functions but was unhandled in the other. (I'm not sure about setting
16 bpp for the 15bpp case either but I left that there for now.)

Signed-off-by: BALATON Zoltan &lt;balaton@eik.bme.hu&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 6932a69b20a88428c531805cdd20eec8acf05b27
      https://github.com/qemu/qemu/commit/6932a69b20a88428c531805cdd20eec8acf05b27
  Author: Lei Li &lt;lilei@linux.vnet.ibm.com&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M qapi-schema-guest.json
    M qapi-schema.json

  Log Message:
  -----------
  qapi: Fix enumeration typo error

Signed-off-by: Lei Li &lt;lilei@linux.vnet.ibm.com&gt;
Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: 6d1cc3210ccc4372ffa337c187da9db68314c0c4
      https://github.com/qemu/qemu/commit/6d1cc3210ccc4372ffa337c187da9db68314c0c4
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M kvm-all.c

  Log Message:
  -----------
  kvm: Fix warning from static code analysis

Report from smatch:

kvm-all.c:1373 kvm_init(135) warn:
 variable dereferenced before check 's' (see line 1360)

's' cannot by NULL (it was alloced using g_malloc0), so there is no need
to check it here.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: ef37a699a06f96e098ee00683b7052b5fbb6ad7d
      https://github.com/qemu/qemu/commit/ef37a699a06f96e098ee00683b7052b5fbb6ad7d
  Author: Igor Mitsyanko &lt;i.mitsyanko@samsung.com&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M arch_init.c

  Log Message:
  -----------
  arch_init.c: add missing '%' symbols before PRIu64 in debug printfs

'%' symbols were missing in front of PRIu64 macros in DPRINTF() messages in
arch_init.c, this caused compilation warnings when compiled with DEBUG_ARCH_INIT \
defined.

Signed-off-by: Igor Mitsyanko &lt;i.mitsyanko@samsung.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: 987a9b4800003567b1a47a379255e886a77d57ea
      https://github.com/qemu/qemu/commit/987a9b4800003567b1a47a379255e886a77d57ea
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M hw/virtio-net.c
    M net.c
    M net/queue.c
    M net/queue.h

  Log Message:
  -----------
  net: notify iothread after flushing queue

virtio-net has code to flush the queue and notify the iothread
whenever new receive buffers are added by the guest.  That is
fine, and indeed we need to do the same in all other drivers.
However, notifying the iothread should be work for the network
subsystem.  And since we are at it we can add a little smartness:
if some of the queued packets already could not be delivered,
there is no need to notify the iothread.

Reported-by: Luigi Rizzo &lt;rizzo@iet.unipi.it&gt;
Cc: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Cc: Jan Kiszka &lt;jan.kiszka@siemens.de&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Amos Kong &lt;akong@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: e8b4c680b41bd960ecccd9ff076b7b058e0afcd4
      https://github.com/qemu/qemu/commit/e8b4c680b41bd960ecccd9ff076b7b058e0afcd4
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M hw/e1000.c

  Log Message:
  -----------
  e1000: flush queue whenever can_receive can go from false to true

When the guests replenish the receive ring buffer, the network device
should flush its queue of pending packets.  This is done with
qemu_flush_queued_packets.

e1000's can_receive can go from false to true when RCTL or RDT are
modified.

Reported-by: Luigi Rizzo &lt;rizzo@iet.unipi.it&gt;
Cc: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Cc: Jan Kiszka &lt;jan.kiszka@siemens.de&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Amos Kong &lt;akong@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: a98b140223d3a627eab7ee3ddec645bab630d756
      https://github.com/qemu/qemu/commit/a98b140223d3a627eab7ee3ddec645bab630d756
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M hw/xen_nic.c

  Log Message:
  -----------
  xen: flush queue when getting an event

xen does not have a register that, when written, will cause can_receive
to go from false to true.  However, flushing the queue can be attempted
whenever the front-end raises its side of the Xen event channel.  There
is a single event channel for tx and rx.

Cc: Stefano Stabellini &lt;stefano.stabellini@eu.citrix.com&gt;
Cc: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Reviewed-by: Amos Kong &lt;akong@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 1069985fb132cd4324fc02d371f1e61492a1823f
      https://github.com/qemu/qemu/commit/1069985fb132cd4324fc02d371f1e61492a1823f
  Author: Bo Yang &lt;boyang@suse.com&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M hw/eepro100.c

  Log Message:
  -----------
  eepro100: Fix network hang when rx buffers run out

This is reported by QA. When installing os with pxe, after the initial
kernel and initrd are loaded, the procedure tries to copy files from install
server to local harddisk, the network becomes stall because of running out of
receive descriptor.

[Whitespace fixes and removed qemu_notify_event() because Paolo's
earlier net patches have moved it into qemu_flush_queued_packets().

Additional info:

I can reproduce the network hang with a tap device doing a iPXE HTTP
boot as follows:

  $ qemu -enable-kvm -m 1024 \
    -netdev tap,id=netdev0,script=no,downscript=no \
    -device i82559er,netdev=netdev0,romfile=80861209.rom \
    -drive if=virtio,cache=none,file=test.img
  iPXE&gt; ifopen net0
  iPXE&gt; config # set static network configuration
  iPXE&gt; kernel http://mirror.bytemark.co.uk/fedora/linux/releases/17/Fedora/x86_64/os/images/pxeboot/vmlinuz


I needed a vanilla iPXE ROM to get to the iPXE prompt.  I think the boot
prompt has been disabled in the ROMs that ship with QEMU to reduce boot
time.

During the vmlinuz HTTP download there is a network hang.  hw/eepro100.c
has reached the end of the rx descriptor list.  When the iPXE driver
replenishes the rx descriptor list we don't kick the QEMU net subsystem
and event loop, thereby leaving the tap netdev without its file
descriptor in select(2).

Stefan Hajnoczi &lt;stefanha@gmail.com&gt;]

Signed-off-by: Bo Yang &lt;boyang@suse.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: c67f5dc10573687497f0f5c3aec19b15c35c63d7
      https://github.com/qemu/qemu/commit/c67f5dc10573687497f0f5c3aec19b15c35c63d7
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M net.c

  Log Message:
  -----------
  net: add receive_disabled logic to iov delivery path

This patch adds the missing NetClient-&gt;receive_disabled logic in the
sendv delivery code path.  It seems that commit
893379efd0e1b84ceb0c42a713293f3dbd27b1bd ("net: disable receiving if
client returns zero") only added the logic to qemu_deliver_packet() and
not qemu_deliver_packet_iov().

The receive_disabled flag should be automatically set when .receive(),
.receive_raw(), or .receive_iov() return 0.  No further packets will be
delivered to the NetClient until the receive_disabled flag is cleared
again by calling qemu_flush_queued_packets().

Typically the NetClient will wait until its file descriptor becomes
writable and then invoke qemu_flush_queued_packets() to resume
transmission.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 06b5f36d052b540a59b52150582d65674199b2ce
      https://github.com/qemu/qemu/commit/06b5f36d052b540a59b52150582d65674199b2ce
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M net/queue.c

  Log Message:
  -----------
  net: do not report queued packets as sent

Net send functions have a return value where 0 means the packet has not
been sent and will be queued.  A non-zero value means the packet was
sent or an error caused the packet to be dropped.

This patch fixes two instances where packets are queued but we return
their size.  This causes callers to believe the packets were sent.  When
the caller uses the async send interface this creates a real problem
because the callback will be invoked for a packet that the caller
believed to be already sent.  This bug can cause double-frees in the
caller.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 08d12022c7f1aba6acccc75150659c6e4c9dff23
      https://github.com/qemu/qemu/commit/08d12022c7f1aba6acccc75150659c6e4c9dff23
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M qemu-options.hx

  Log Message:
  -----------
  net: add -netdev options to man page

Document the -netdev syntax which supercedes the older -net syntax.
This patch is a first step to making -netdev prominent in the QEMU
manual.

Reported-by: Anatoly Techtonik &lt;techtonik@gmail.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: f237ddbb89142c6948a2257c459e49dee7500a7c
      https://github.com/qemu/qemu/commit/f237ddbb89142c6948a2257c459e49dee7500a7c
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M hw/usb/dev-network.c

  Log Message:
  -----------
  net: clean up usbnet_receive()

The USB network interface has two code paths depending on whether or not
RNDIS mode is enabled.  Refactor usbnet_receive() so that there is a
common path throughout the function instead of duplicating everything
across if (is_rndis(s)) ... else ... code paths.

Clean up coding style and 80 character line wrap along the way.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 190563f9a90c9df8ad32fc7f3e4b166deda949a6
      https://github.com/qemu/qemu/commit/190563f9a90c9df8ad32fc7f3e4b166deda949a6
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M hw/usb/dev-network.c

  Log Message:
  -----------
  net: fix usbnet_receive() packet drops

The USB network interface has a single buffer which the guest reads
from.  This patch prevents multiple calls to usbnet_receive() from
clobbering the input buffer.  Instead we queue packets until buffer
space becomes available again.

This is inspired by virtio-net and e1000 rxbuf handling.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 61518a74ca98870e8ff132f91dd5dda252e31f58
      https://github.com/qemu/qemu/commit/61518a74ca98870e8ff132f91dd5dda252e31f58
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M net/hub.c

  Log Message:
  -----------
  net: broadcast hub packets if at least one port can receive

In commit 60c07d933c66c4b30a83b7ccbc8a0cb3df1b2d0e ("net: fix
qemu_can_send_packet logic") the "VLAN" broadcast behavior was changed
to queue packets if any net client cannot receive.  It turns out that
this was not actually the right fix and just hides the real bug that
hw/usb/dev-network.c:usbnet_receive() clobbers its receive buffer when
called multiple times in a row.  The commit also introduced a new bug
that "VLAN" packets would not be sent if one of multiple net clients was
down.

The hw/usb/dev-network.c bug has since been fixed, so this patch reverts
broadcast behavior to send packets as long as one net client can
receive.  Packets simply get queued for the net clients that are
temporarily unable to receive.

Reported-by: Roy.Li &lt;rongqing.li@windriver.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 863f678fba4191f3b695620f41056cb7c124425d
      https://github.com/qemu/qemu/commit/863f678fba4191f3b695620f41056cb7c124425d
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M net/socket.c

  Log Message:
  -----------
  net: asynchronous send/receive infrastructure for net/socket.c

The net/socket.c net client is not truly asynchronous.  This patch
borrows the qemu_set_fd_handler2() code from net/tap.c as the basis for
proper asynchronous send/receive.

Only read packets from the socket when the peer is able to receive.
This avoids needless queuing.

Later patches implement asynchronous send.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 213fd5087e2e4e2da10ad266df0ba950cf7618bf
      https://github.com/qemu/qemu/commit/213fd5087e2e4e2da10ad266df0ba950cf7618bf
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M net/socket.c

  Log Message:
  -----------
  net: EAGAIN handling for net/socket.c UDP

Implement asynchronous send for UDP (or other SOCK_DGRAM) sockets.  If
send fails with EAGAIN we wait for the socket to become writable again.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 45a7f54a8bb3928ffa58d522e0d61acaee8277bb
      https://github.com/qemu/qemu/commit/45a7f54a8bb3928ffa58d522e0d61acaee8277bb
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M net/socket.c

  Log Message:
  -----------
  net: EAGAIN handling for net/socket.c TCP

Replace spinning send_all() with a proper non-blocking send.  When the
socket write buffer limit is reached, we should stop trying to send and
wait for the socket to become writable again.

Non-blocking TCP sockets can return in two different ways when the write
buffer limit is reached:

1. ret = -1 and errno = EAGAIN/EWOULDBLOCK.  No data has been written.

2. ret &lt; total_size.  Short write, only part of the message was
   transmitted.

Handle both cases and keep track of how many bytes have been written in
s-&gt;send_index.  (This includes the 'length' header before the actual
payload buffer.)

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: e84d5956cc6215d2f098e7b6090fc5ec4cba1be3
      https://github.com/qemu/qemu/commit/e84d5956cc6215d2f098e7b6090fc5ec4cba1be3
  Author: Yann E. MORIN &lt;yann.morin.1998@free.fr&gt;
  Date:   2012-09-14 (Fri, 14 Sep 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: fix seccomp check

Currently, if libseccomp is missing but the user explicitly requested
seccomp support using --enable-seccomp, configure silently ignores the
situation and disables seccomp support.

This is unlike all other tests that explicitly fail in such situation.

Fix that.

Signed-off-by: "Yann E. MORIN" &lt;yann.morin.1998@free.fr&gt;
Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: 8490fc78e708eaaaa20f06b5efe190bfeabe0064
      https://github.com/qemu/qemu/commit/8490fc78e708eaaaa20f06b5efe190bfeabe0064
  Author: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
  Date:   2012-09-17 (Mon, 17 Sep 2012)

  Changed paths:
    M exec.c
    M qemu-config.c
    M qemu-options.hx

  Log Message:
  -----------
  add -machine mem-merge=on|off option

It allows to disable memory merge support (KSM on Linux), which is
enabled by default otherwise.

Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: ed0ec1aa858ac1fcfe3664e4159e695c2c063df8
      https://github.com/qemu/qemu/commit/ed0ec1aa858ac1fcfe3664e4159e695c2c063df8
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-09-17 (Mon, 17 Sep 2012)

  Changed paths:
    M hw/pc.c

  Log Message:
  -----------
  pc: Drop practically unused BOCHS BIOS debug ports

We have debugcon these days to listen on those ports that receive debug
messages. Also drop the others that have no effect anymore.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 6db0fdce02d72546a4c47100a9b2cd0090cf464d
      https://github.com/qemu/qemu/commit/6db0fdce02d72546a4c47100a9b2cd0090cf464d
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-09-17 (Mon, 17 Sep 2012)

  Changed paths:
    M qemu-char.c

  Log Message:
  -----------
  Revert 455aa1e08 and c3767ed0eb

    commit c3767ed0eb5d0bb25fe409ae5dec06e3411ff1b6
    qemu-char: (Re-)connect for tcp_chr_write() unconnected writing

Has no hope of working because tcp_chr_connect() does not actually connect.

455aa1e08 just fixes the SEGV with server() but the attempt to connect a client
socket is still completely broken.

This patch reverts both.

Reported-by: Richard W.M. Jones &lt;rjones@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: bbdd2ad0814ea0911076419ea21b7957505cf1cc
      https://github.com/qemu/qemu/commit/bbdd2ad0814ea0911076419ea21b7957505cf1cc
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-09-17 (Mon, 17 Sep 2012)

  Changed paths:
    M iohandler.c
    M qemu-char.c

  Log Message:
  -----------
  qemu-char: BUGFIX, don't call FD_ISSET with negative fd

tcp_chr_connect(), unlike for example udp_chr_update_read_handler() does
not check if the fd it is using is valid (&gt;= 0) before passing it to
qemu_set_fd_handler2().  If using e.g. a TCP serial port, which is not
initially connected, this can result in -1 being passed to FD_ISSET, which
has undefined behaviour.  On x86 it seems to harmlessly return 0, but on
PowerPC, it causes a fortify buffer overflow error to be thrown.

This patch fixes this by putting an extra test in tcp_chr_connect(), and
also adds an assert qemu_set_fd_handler2() to catch other such errors on
all platforms, rather than just some.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 0b57e287138728f72d88b06e69b970c5d745c44a
      https://github.com/qemu/qemu/commit/0b57e287138728f72d88b06e69b970c5d745c44a
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-09-17 (Mon, 17 Sep 2012)

  Changed paths:
    M exec.c

  Log Message:
  -----------
  cpu_physical_memory_write_rom() needs to do TB invalidates

cpu_physical_memory_write_rom(), despite the name, can also be used to
write images into RAM - and will often be used that way if the machine
uses load_image_targphys() into RAM addresses.

However, cpu_physical_memory_write_rom(), unlike cpu_physical_memory_rw()
doesn't invalidate any cached TBs which might be affected by the region
written.

This was breaking reset (under full emu) on the pseries machine - we loaded
our firmware image into RAM, and while executing it rewrite the code at
the entry point (correctly causing a TB invalidate/refresh).  When we
reset the firmware image was reloaded, but the TB from the rewrite was
still active and caused us to get an illegal instruction trap.

This patch fixes the bug by duplicating the tb invalidate code from
cpu_physical_memory_rw() in cpu_physical_memory_write_rom().

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 121afa9e0c02617c2a774996512e4f85f3e93da8
      https://github.com/qemu/qemu/commit/121afa9e0c02617c2a774996512e4f85f3e93da8
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-09-17 (Mon, 17 Sep 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  Revert "Add ability to disable build of all targets"

This reverts commit 66d5499b3754b83c09487259c08fe2ce73188a59.

This commit broke --target-list="x86_64-softmmu" and the fix isn't immediatley
obvious.

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 31e165f1770cd10ee4fabf7ef4c1a48566be3336
      https://github.com/qemu/qemu/commit/31e165f1770cd10ee4fabf7ef4c1a48566be3336
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-09-17 (Mon, 17 Sep 2012)

  Changed paths:
    M hw/cirrus_vga.c
    M hw/qxl.c
    M hw/vga-isa-mm.c
    M hw/vga.c
    M hw/vmware_vga.c
    M kvm-all.c
    M memory.c
    M memory.h
    M scripts/update-linux-headers.sh

  Log Message:
  -----------
  Merge remote-tracking branch 'qemu-kvm/uq/master' into staging

* qemu-kvm/uq/master:
  kvm: Rename irqchip_inject_ioctl to irq_set_ioctl
  kvm: Stop flushing coalesced MMIO on vmexit
  VGA: Flush coalesced MMIO on related MMIO/PIO accesses
  memory: Flush coalesced MMIO on mapping and state changes
  memory: Fold memory_region_update_topology into memory_region_transaction_commit
  memory: Use transaction_begin/commit also for single-step operations
  memory: Flush coalesced MMIO on selected region access
  kvm-all.c: Move init of irqchip_inject_ioctl out of kvm_irqchip_create()
  update-linux-headers.sh: Don't hard code list of architectures


  Commit: de71bd6f77739cc5addb6d70bf29be59aed41722
      https://github.com/qemu/qemu/commit/de71bd6f77739cc5addb6d70bf29be59aed41722
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-09-17 (Mon, 17 Sep 2012)

  Changed paths:
    M hw/e1000.c
    M hw/eepro100.c
    M hw/usb/dev-network.c
    M hw/virtio-net.c
    M hw/xen_nic.c
    M net.c
    M net/hub.c
    M net/queue.c
    M net/queue.h
    M net/socket.c
    M qemu-options.hx

  Log Message:
  -----------
  Merge remote-tracking branch 'stefanha/net' into staging

* stefanha/net:
  net: EAGAIN handling for net/socket.c TCP
  net: EAGAIN handling for net/socket.c UDP
  net: asynchronous send/receive infrastructure for net/socket.c
  net: broadcast hub packets if at least one port can receive
  net: fix usbnet_receive() packet drops
  net: clean up usbnet_receive()
  net: add -netdev options to man page
  net: do not report queued packets as sent
  net: add receive_disabled logic to iov delivery path
  eepro100: Fix network hang when rx buffers run out
  xen: flush queue when getting an event
  e1000: flush queue whenever can_receive can go from false to true
  net: notify iothread after flushing queue


  Commit: cd6dcc710541dd39504f47a5c258f14a762bb767
      https://github.com/qemu/qemu/commit/cd6dcc710541dd39504f47a5c258f14a762bb767
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-09-17 (Mon, 17 Sep 2012)

  Changed paths:
    M configure
    M hw/qxl.c
    M trace-events
    M ui/spice-display.c
    M ui/spice-display.h

  Log Message:
  -----------
  Merge remote-tracking branch 'spice/spice.v60' into staging

* spice/spice.v60:
  hw/qxl: support client monitor configuration via device
  qxl: add trace-event for QXL_IO_LOG
  hw/qxl: tracing fixes
  qxl: better cleanup for surface destroy
  qxl: Ignore set_client_capabilities pre/post migrate
  qxl: dont update invalid area
  spice: send updates only for changed screen content
  spice: add screen mirror
  spice: split qemu_spice_create_update
  spice: switch to queue for vga mode updates


  Commit: 509e9c462d03c4b7edc4a0d277311a7f45c9c046
      https://github.com/qemu/qemu/commit/509e9c462d03c4b7edc4a0d277311a7f45c9c046
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-09-17 (Mon, 17 Sep 2012)

  Changed paths:
    M arch_init.c
    M configure
    M console.c
    M docs/specs/ppc-spapr-hcalls.txt
    M docs/usb2.txt
    M hw/imx_avic.c
    M hw/imx_timer.c
    M hw/kzm.c
    M hw/srp.h
    M hw/xen-host-pci-device.c
    M hw/xen_pt.h
    M hw/xen_pt_config_init.c
    M kvm-all.c
    M linux-user/main.c
    M memory.h
    M qapi-schema-guest.json
    M qapi-schema.json
    M qemu-img.c
    M qemu-img.texi
    M ui/spice-display.c

  Log Message:
  -----------
  Merge remote-tracking branch 'stefanha/trivial-patches' into staging

* stefanha/trivial-patches:
  configure: fix seccomp check
  arch_init.c: add missing '%' symbols before PRIu64 in debug printfs
  kvm: Fix warning from static code analysis
  qapi: Fix enumeration typo error
  console: Clean up bytes per pixel calculation
  Fix copy&amp;paste typos in documentation comments
  linux-user: Remove #if 0'd cpu_get_real_ticks() definition
  ui: Fix spelling in comment (ressource -&gt; resource)
  Spelling fixes in comments and macro names (ressource -&gt; resource)
  Fix spelling (licenced -&gt; licensed) in GPL
  Spelling fixes in comments and documentation
  srp: Don't use QEMU_PACKED for single elements of a structured type


  Commit: 109820df4a3b8b58f234319d015a854df9db8981
      https://github.com/qemu/qemu/commit/109820df4a3b8b58f234319d015a854df9db8981
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-09-17 (Mon, 17 Sep 2012)

  Changed paths:
    M Makefile
    M block.c
    M block/curl.c
    M block/sheepdog.c
    M block/vdi.c
    M hw/ide/ahci.c
    M hw/ide/atapi.c
    M hw/ide/core.c
    M qapi-schema.json
    M qemu-img-cmds.hx
    M qemu-img.c
    M qemu-img.texi

  Log Message:
  -----------
  Merge remote-tracking branch 'kwolf/for-anthony' into staging

* kwolf/for-anthony:
  block: Don't forget to delete temporary file
  Don't require encryption password for 'qemu-img info' command
  qemu-img: Add json output option to the info command.
  qapi: Add SnapshotInfo and ImageInfo.
  ahci: properly reset PxCMD on HBA reset
  block: fix block tray status
  vdi: Fix warning from clang
  block/curl: Fix wrong free statement
  ide: Fix error messages from static code analysis (no real error)
  ATAPI: STARTSTOPUNIT only eject/load media if powercondition is 0
  sheepdog: fix savevm and loadvm


  Commit: 6b80f7db8a7f84d21e46d01e30c8497733bb23a0
      https://github.com/qemu/qemu/commit/6b80f7db8a7f84d21e46d01e30c8497733bb23a0
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-09-17 (Mon, 17 Sep 2012)

  Changed paths:
    M slirp/tcp_subr.c
    M slirp/tftp.c
    M slirp/tftp.h

  Log Message:
  -----------
  Merge remote-tracking branch 'kiszka/queues/slirp' into staging

* kiszka/queues/slirp:
  slirp: Implement TFTP Blocksize option
  slirp: Remove unused return value of tftp_send_next_block
  slirp: Handle more than 65535 blocks in TFTP transfers
  slirp: improve TFTP performance
  slirp: Fix error reported by static code analysis
  slirp: Remove wrong type casts ins debug statements


Compare: https://github.com/qemu/qemu/compare/89c33337fd21...6b80f7db8a7f

----==_mimepart_50576c3d15f12_278d1320af44803--


</body></email><email><emailId>20120919143819</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-19 14:38:19-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 55d4fd: arch_init.c: Improve '-soundhw help' for non-HAS_A...</subject><body>



----==_mimepart_5059d8daf351d_2caf1636af454186
Date: Wed, 19 Sep 2012 07:38:19 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5059d8dbad3_2caf1636af4542dc@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 55d4fd3c24bd253bd96270c7fdf1bb862f3a3400
      https://github.com/qemu/qemu/commit/55d4fd3c24bd253bd96270c7fdf1bb862f3a3400
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M arch_init.c

  Log Message:
  -----------
  arch_init.c: Improve '-soundhw help' for non-HAS_AUDIO_CHOICE archs

For architectures which don't set HAS_AUDIO_CHOICE, improve the
'-soundhw help' message so that it doesn't simply print an empty
list, implying no sound support at all.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;




----==_mimepart_5059d8daf351d_2caf1636af454186--


</body></email><email><emailId>20120919180008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-19 18:00:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] c0a1dc: xilinx_timer: Removed comma in device name</subject><body>



----==_mimepart_505a0828bbb7b_2c90152caf0497f9
Date: Wed, 19 Sep 2012 11:00:08 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;505a0828bd928_2c90152caf0498f@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: c0a1dcb9f0baf9269f8baeb02cbcca8dad75454c
      https://github.com/qemu/qemu/commit/c0a1dcb9f0baf9269f8baeb02cbcca8dad75454c
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M hw/xilinx.h
    M hw/xilinx_timer.c

  Log Message:
  -----------
  xilinx_timer: Removed comma in device name

Fixes an error in a61e4b07a30c062260d2d01771773f14820d1eb7

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;


  Commit: e03377ae75808d33d0a7afc803b37bcda9f796b3
      https://github.com/qemu/qemu/commit/e03377ae75808d33d0a7afc803b37bcda9f796b3
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M hw/xilinx_timer.c

  Log Message:
  -----------
  xilinx_timer: Send dbg msgs to stderr not stdout

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;


  Commit: 919f89f44c7e3a8dee6a0f0eebd0cc81766da612
      https://github.com/qemu/qemu/commit/919f89f44c7e3a8dee6a0f0eebd0cc81766da612
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M hw/xilinx.h
    M hw/xilinx_timer.c

  Log Message:
  -----------
  xilinx_timer: Fixed "frequency" prop name

The "frequency" qdev prop matches the "clock-frequency" property in Xilinx EDK.
Renamed "frequency" -&gt; "clock-frequency" accordingly.

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;


  Commit: 4b5e52101f9ad077d1c016f2b7130e2fdae6d2da
      https://github.com/qemu/qemu/commit/4b5e52101f9ad077d1c016f2b7130e2fdae6d2da
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M hw/xilinx.h

  Log Message:
  -----------
  xilinx.h: Error check when setting links

Assert that the ethernet and dma controller are sucessfully linked to their
peers.

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;


  Commit: c9b6e1f6bbc93cd1a43dbde625077dde5806c7d7
      https://github.com/qemu/qemu/commit/c9b6e1f6bbc93cd1a43dbde625077dde5806c7d7
  Author: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M hw/xilinx.h

  Log Message:
  -----------
  xilinx: fix names of ethernet and dma links.

These names were incorrect. Fixed to match to actual link names

Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;


  Commit: 8354cd722e0afae63bee3e4cb21c8f0ddb6874c2
      https://github.com/qemu/qemu/commit/8354cd722e0afae63bee3e4cb21c8f0ddb6874c2
  Author: Chris Wulff &lt;crwulff@gmail.com&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M hw/xilinx_timer.c

  Log Message:
  -----------
  xilinx_timer: Fix a compile error if debug enabled

There was a missing include of qemu-log and a variable name in a printf was out
of date.

Signed-off-by: Chris Wulff &lt;crwulff@gmail.com&gt;
Signed-off-by: Peter A. G. Crosthwaite &lt;peter.crosthwaite@petalogix.com&gt;


Compare: https://github.com/qemu/qemu/compare/55d4fd3c24bd...8354cd722e0a

----==_mimepart_505a0828bbb7b_2c90152caf0497f9--


</body></email><email><emailId>20120919200013</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-19 20:00:13-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 5c2d2a: tcg/i386: allow constants in load/store ops</subject><body>



----==_mimepart_505a244d646a4_82814a1af4262c0
Date: Wed, 19 Sep 2012 13:00:13 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;505a244d671dd_82814a1af4263ca@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 5c2d2a9ee5f1978ae980598fba80151c761105a0
      https://github.com/qemu/qemu/commit/5c2d2a9ee5f1978ae980598fba80151c761105a0
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M tcg/i386/tcg-target.c

  Log Message:
  -----------
  tcg/i386: allow constants in load/store ops

On x86, it is possible to move a constant value to memory. Add code to
handle a constant argument to load/store ops.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 332864bd95257111bf457e3f0501114028c107d6
      https://github.com/qemu/qemu/commit/332864bd95257111bf457e3f0501114028c107d6
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M tcg/tcg-opc.h
    M tcg/tcg.c

  Log Message:
  -----------
  tcg: mark set_label with TCG_OPF_BB_END flag

set_label is effectively the end of a basic block, as no optimization
can be made accross it. It was treated as such in the liveness analysis
code, but as a special case.

Mark it with TCG_OPF_BB_END flag so that this information can be used
by other parts of the TCG code, and remove the special case in the liveness
analysis code.

Cc: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: d104bebd073cc05a1a572529a060857a377be6aa
      https://github.com/qemu/qemu/commit/d104bebd073cc05a1a572529a060857a377be6aa
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M tcg/optimize.c
    M tcg/tcg.h

  Log Message:
  -----------
  revert "TCG: fix copy propagation"

Given the copy propagation breakage on 32-bit hosts has been fixed
commit e31b0a7c050711884ad570fe73df806520953618 can be reverted.

Cc: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 262e1eaafabf32d33a9fa0b03b3c8ea426c5ae1b
      https://github.com/qemu/qemu/commit/262e1eaafabf32d33a9fa0b03b3c8ea426c5ae1b
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M hw/pflash_cfi01.c

  Log Message:
  -----------
  pflash_cfi01: fix vendor specific extended query

pflash_cfi01 announces a version number of 1.1, which implies
"Protection Register Information" and "Burst Read information"
sections, which are not provided.

Decrease the version number to 1.0 so that only the "Protection
Register Information" section is needed.

Set the number of protection fields (0x3f) to 0x01, as 0x00 means 256
protections field, which makes the CFI table bigger than the current
implementation, causing some kernels to fail to read it.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: eb99c9a993cc45f431a0b755595c8536aa947ace
      https://github.com/qemu/qemu/commit/eb99c9a993cc45f431a0b755595c8536aa947ace
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M hw/pflash_cfi01.c
    M hw/pflash_cfi02.c

  Log Message:
  -----------
  hw/pflash_cfi0[12]: Use host-utils.h ctz32()

Drop the private reimplementation of ctz32() from pflash_cfi0[12]
in favour of using the standard version from host-utils.h.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: e1050a7637d24d9f49e739cbe6d6d657359603db
      https://github.com/qemu/qemu/commit/e1050a7637d24d9f49e739cbe6d6d657359603db
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Set opn in gen_ldst_multiple.

Used by MIPS_DEBUG, when enabled.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Acked-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 9fa7748873c99cbf8b281650bdc18fd442be4743
      https://github.com/qemu/qemu/commit/9fa7748873c99cbf8b281650bdc18fd442be4743
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Fix MIPS_DEBUG.

The macro uses the DisasContext.  Pass it around as needed.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Acked-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: fb7729e2d03e1ffb4306f2411c18aa20f737dba8
      https://github.com/qemu/qemu/commit/fb7729e2d03e1ffb4306f2411c18aa20f737dba8
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Always evaluate debugging macro arguments

this will prevent some of the compilation errors with debugging
enabled from creeping back in.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: bd277fa1966bc400f1b411f868f39125cda0c403
      https://github.com/qemu/qemu/commit/bd277fa1966bc400f1b411f868f39125cda0c403
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M target-mips/Makefile.objs
    M target-mips/helper.h
    A target-mips/lmi_helper.c
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Implement Loongson Multimedia Instructions

Implements all of the COP2 instructions except for the S&lt;cond&gt;
family of comparisons.  The documentation is unclear for those.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: a25506603914d706f4ac4c63d3b93b4f1227b9b4
      https://github.com/qemu/qemu/commit/a25506603914d706f4ac4c63d3b93b4f1227b9b4
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: fix end of basic block detection

Commit e31b0a7c050711884ad570fe73df806520953618 fixed copy propagation on
32-bit host by restricting the copy between different types. This was the
wrong fix.

The real problem is that the all temps states should be reset at the end
of a basic block. This was done by adding such operations in the switch,
but brcond2 was forgotten (that's why the crash was only observed on 32-bit
hosts).

Fix that by looking at the TCG_OPF_BB_END instead. We need to keep the case
for op_set_label as temps might be modified through another path.

Cc: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


Compare: https://github.com/qemu/qemu/compare/8354cd722e0a...a25506603914

----==_mimepart_505a244d646a4_82814a1af4262c0--


</body></email><email><emailId>20120920233008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-20 23:30:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] f9cb50: target-xtensa: fix extui shift amount</subject><body>



----==_mimepart_505ba700930da_c8d1735af42598e
Date: Thu, 20 Sep 2012 16:30:08 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;505ba70094476_c8d1735af4260f2@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: f9cb5045d1eb6d187b0849d0f36735d3aac1a37f
      https://github.com/qemu/qemu/commit/f9cb5045d1eb6d187b0849d0f36735d3aac1a37f
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-09-20 (Thu, 20 Sep 2012)

  Changed paths:
    M target-xtensa/translate.c

  Log Message:
  -----------
  target-xtensa: fix extui shift amount

extui opcode only uses lowermost op1 bit for sa4.

Reported-by: malc &lt;av1474@comtv.ru&gt;
Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Cc: qemu-stable &lt;qemu-stable@nongnu.org&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;


  Commit: c26032b2c91721245bfec542d94f37a0238e986e
      https://github.com/qemu/qemu/commit/c26032b2c91721245bfec542d94f37a0238e986e
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-09-20 (Thu, 20 Sep 2012)

  Changed paths:
    M target-xtensa/translate.c

  Log Message:
  -----------
  target-xtensa: don't emit extra tcg_gen_goto_tb

Unconditional gen_check_loop_end at the end of disas_xtensa_insn
can emit tcg_gen_goto_tb with slot id already used in the TB (e.g. when
TB ends at LEND with a branch).

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Cc: qemu-stable &lt;qemu-stable@nongnu.org&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;


Compare: https://github.com/qemu/qemu/compare/a25506603914...c26032b2c917

----==_mimepart_505ba700930da_c8d1735af42598e--


</body></email><email><emailId>20120921183013</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-21 18:30:13-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 63587e: usb-host: allow emulated (non-async) control reque...</subject><body>



----==_mimepart_505cb235b83ac_5eab127faf0487e1
Date: Fri, 21 Sep 2012 11:30:13 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;505cb235be21d_5eab127faf0488c7@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 63587e31353b6652cadfcfb869f5692a2b69daeb
      https://github.com/qemu/qemu/commit/63587e31353b6652cadfcfb869f5692=
a2b69daeb
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M hw/usb/host-linux.c

  Log Message:
  -----------
  usb-host: allow emulated (non-async) control requests without USBPacket=


xhci needs this for USB_REQ_SET_ADDRESS due to the way
usb addressing is handled by the xhci hardware.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 3e4f910c8d490a1490409a7e381dbbb229f9d272
      https://github.com/qemu/qemu/commit/3e4f910c8d490a1490409a7e381dbbb=
229f9d272
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c
    M trace-events

  Log Message:
  -----------
  ehci: switch to new-style memory ops

Also register different memory regions for capabilities,
operational registers and port status registers.  Create
separate tracepoints for operational regs and port status
regs.  Ditch a bunch of sanity checks because the memory
core will do this for us now.

Offloading the byte, word and dword access handling to the
memory core also has the side effect of fixing ehci register
access on bigendian hosts.

Cc: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: ffa1f2e088eb7e3d57f2fc35f21e7bdb23e592c5
      https://github.com/qemu/qemu/commit/ffa1f2e088eb7e3d57f2fc35f21e7bd=
b23e592c5
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Fix interrupts stopping when Interrupt Threshold Control is 8

If Interrupt Threshold Control is 8 or a multiple of 8, then
s-&gt;usbsts_frindex can become exactly 0x4000, at which point
(s-&gt;usbsts_frindex &gt; s-&gt;frindex) will never become true, as
s-&gt;usbsts_frindex will not be lowered / reset in this case.

This patch fixes this.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 8f74ed1e43263293301031a10e440549bab19a6e
      https://github.com/qemu/qemu/commit/8f74ed1e43263293301031a10e44054=
9bab19a6e
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-11 (Tue, 11 Sep 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Don't process too much frames in 1 timer tick (v2)

The Linux ehci isoc scheduling code fills the entire schedule ahead of
time minus 80 frames. If we make a large jump in where we are in the
schedule, ie 40 frames, then the scheduler all of a sudden will only have=

40 frames left to work in, causing it to fail packet submissions
with error -27 (-EFBIG).

Changes in v2:
-Don't hardcode a maximum number of frames to process in one tick, instea=
d:
 -Process a minimum number of frames to ensure we do eventually catch up
 -Stop (after the minimum number) when the guest has requested an irq

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 56ab2ad177dc43d474dc0a0bd84e81ef00f31e11
      https://github.com/qemu/qemu/commit/56ab2ad177dc43d474dc0a0bd84e81e=
f00f31e11
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-13 (Thu, 13 Sep 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: usbredir fixes

usbredir is only used by system emulation, so add the libraries to
libs_softmmu instead of LIBS.

Cc: Michael Tokarev &lt;mjt@tls.msk.ru&gt;
Cc: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 8f5457eb04140714eaf57a99bc08dc661d83fa87
      https://github.com/qemu/qemu/commit/8f5457eb04140714eaf57a99bc08dc6=
61d83fa87
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-13 (Thu, 13 Sep 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Don't set seen to 0 when removing unseen queue-heads

When removing unseen queue-heads from the async queue list, we should not=

set the seen flag to 0, as this may cause them to be removed by
ehci_queues_rip_unused() during the next call to ehci_advance_async_state=
()
if the timer is late or running at a low frequency.

Note:
1) This *may* have caused the instant unlink / relinks described in commi=
t
   9bc3a3a216e2689bfcdd36c3e079333bbdbf3ba0

2) Rather then putting more if-s inside ehci_queues_rip_unused, this patc=
h
   instead introduces a new ehci_queues_rip_unseen function.

3) This patch also makes it save to call ehci_queues_rip_unseen() multipl=
e
   times, which gets used in the folluw up patch titled:
   "ehci: Walk async schedule before and after migration"

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: ceab6f96454fe6589d1b09ce64403c041d79f9d9
      https://github.com/qemu/qemu/commit/ceab6f96454fe6589d1b09ce64403c0=
41d79f9d9
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-13 (Thu, 13 Sep 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Walk async schedule before and after migration

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 8e60452a954978f2f52026aa5f5cfd948e4e2be0
      https://github.com/qemu/qemu/commit/8e60452a954978f2f52026aa5f5cfd9=
48e4e2be0
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-13 (Thu, 13 Sep 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Change cancelled packet code into a generic packet-id queue

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 9a8d4067a63702dfb62d0ae3399600a853ad5daa
      https://github.com/qemu/qemu/commit/9a8d4067a63702dfb62d0ae3399600a=
853ad5daa
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-13 (Thu, 13 Sep 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Add an already_in_flight packet-id queue

After a live migration, the usb-hcd will re-queue all packets by
walking over the schedule in the guest memory again, but requests which
were encountered on the migration source before will already be in flight=
,
so these should *not* be re-send to the usbredir-host.

This patch adds an already in flight packet ud queue, which will be fille=
d by
the source before migration and then moved over to the migration dest, an=
y
async handled packets are then checked against this queue to avoid sendin=
g
the same packet to the usbredir-host twice.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat,com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 3f4be32824ccc5f6a5566b93c900df989a96d048
      https://github.com/qemu/qemu/commit/3f4be32824ccc5f6a5566b93c900df9=
89a96d048
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-13 (Thu, 13 Sep 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Store max_packet_size in endp_data

So that we've a place to migrate it to / from to allow restoring it after=

migration.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: fc3f6e1b106abcf6b8cf487ac8f8e5fc2fd86776
      https://github.com/qemu/qemu/commit/fc3f6e1b106abcf6b8cf487ac8f8e5f=
c2fd86776
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-13 (Thu, 13 Sep 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Add support for migration

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 09054d19e72f6991cd359d41c479badd92f62a06
      https://github.com/qemu/qemu/commit/09054d19e72f6991cd359d41c479bad=
d92f62a06
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-13 (Thu, 13 Sep 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Add chardev open / close debug logging

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 35efba2cc6812dc980c336d7b9bf81dbfb5daf00
      https://github.com/qemu/qemu/commit/35efba2cc6812dc980c336d7b9bf81d=
bfb5daf00
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-13 (Thu, 13 Sep 2012)

  Changed paths:
    M hw/usb/redirect.c

  Log Message:
  -----------
  usb-redir: Revert usb-redir part of commit 93bfef4c

Commit 93bfef4c6e4b23caea9d51e1099d06433d8835a4 makes qemu-devices
which report the qemu version string to the guest in some way use a
qemu_get_version function which reports a machine-specific version string=
.

However usb-redir does not expose the qemu version to the guest, only to
the usbredir-host as part of the initial handshake. This can then be logg=
ed
on the usbredir-host side for debugging purposes and is otherwise complet=
ely
unused! For debugging purposes it is important to have the real qemu vers=
ion
in there, rather then the machine-specific version.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 72a04d0c178f01908d74539230d9de64ffc6da19
      https://github.com/qemu/qemu/commit/72a04d0c178f01908d74539230d9de6=
4ffc6da19
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-09-13 (Thu, 13 Sep 2012)

  Changed paths:
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  uhci: Don't queue up packets after one with the SPD flag set

Don't queue up packets after a packet with the SPD (short packet detect)
flag set. Since we won't know if the packet will actually be short until =
it
has completed, and if it is short we should stop the queue.

This fixes a miniature photoframe emulating a USB cdrom with the windows
software for it not working.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: f8e7343956c91ba6cf26bf41b5a9a94e97ad4261
      https://github.com/qemu/qemu/commit/f8e7343956c91ba6cf26bf41b5a9a94=
e97ad4261
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M target-sh4/helper.h

  Log Message:
  -----------
  target-sh4: mark a few helpers const and pure

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: ff2086fed268d2b2fedb273f6794949ed2ef9e10
      https://github.com/qemu/qemu/commit/ff2086fed268d2b2fedb273f6794949=
ed2ef9e10
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M target-sh4/op_helper.c

  Log Message:
  -----------
  target-sh4: use float32_muladd() to implement fmac

There is no need to add a SH4 specific pickNaNMulAdd() to softfloat as
SH4 is always returning a default NaN.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 22b88fd77e2fbb8aefb6e50a6a24d670b0ecb022
      https://github.com/qemu/qemu/commit/22b88fd77e2fbb8aefb6e50a6a24d67=
0b0ecb022
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M target-sh4/helper.h
    M target-sh4/op_helper.c
    M target-sh4/translate.c

  Log Message:
  -----------
  target-sh4: implement addc and subc using TCG

Now that setcond is available, the addc and subc can easily be
implemented using TCG.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: ad8d25a11f13cb8acc69558d03cd69202f5a3cc2
      https://github.com/qemu/qemu/commit/ad8d25a11f13cb8acc69558d03cd692=
02f5a3cc2
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M target-sh4/helper.h
    M target-sh4/op_helper.c
    M target-sh4/translate.c

  Log Message:
  -----------
  target-sh4: implement addv and subv using TCG

addv and subv helpers implementation is directly copied from the SH4
manual and looks quite complex. It is however possible to explain it
without branches, and is therefore possible to implement it with TCG.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: f16640f47bb0b8f907fff08a2e8d1c891ce82480
      https://github.com/qemu/qemu/commit/f16640f47bb0b8f907fff08a2e8d1c8=
91ce82480
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M target-sh4/translate.c

  Log Message:
  -----------
  target-sh4: optimize xtrct

The register being 32 bit long, after a shift to the right by 16 bits,
the upper 16 bit are already cleared. There is no need to call ext16u
to clear them.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: c53b36d210a55c67eca3ae89ebfdf665c0f2c3e2
      https://github.com/qemu/qemu/commit/c53b36d210a55c67eca3ae89ebfdf66=
5c0f2c3e2
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M target-sh4/translate.c

  Log Message:
  -----------
  target-sh4: optimize swap.w

It's possible swap the two 16-bit words of a 32-bit register using a
rotation. If the TCG target doesn't implement rotation, the replacement
code is similar to the previously implemented code.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: ed22e6f30e7f8c723f9b1be30869b9c0368e3e4e
      https://github.com/qemu/qemu/commit/ed22e6f30e7f8c723f9b1be30869b9c=
0368e3e4e
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M target-sh4/translate.c

  Log Message:
  -----------
  target-sh4: remove gen_clr_t() and gen_set_t()

gen_clr_t() and gen_set_t() have very few callers and can be remplaced
by a single line. Remove them.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 1012740098d0307ce5d957ebbe9a7f020da7f574
      https://github.com/qemu/qemu/commit/1012740098d0307ce5d957ebbe9a7f0=
20da7f574
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M target-sh4/helper.h
    M target-sh4/op_helper.c
    M target-sh4/translate.c

  Log Message:
  -----------
  target-sh4: rework exceptions handling

Since commit fd4bab102 PC is restored in case of exception through code
retranslation. While it is clearly the thing to do in case it is not
not known if an helper is going to trigger an exception or not
(e.g. for load/store, FPU, etc.), it just make things slower when the
exception is already known at translation time.

Partially revert this commit and save PC in the TCG code. Set bstate to
BS_BRANCH to not generate TCG exit code. Micro-optimize the sleep
helper. Make all the exception helpers to call raise_exception and mark
it as noreturn.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 7a64244fda7b9b6257de30cfe93498ccd6017630
      https://github.com/qemu/qemu/commit/7a64244fda7b9b6257de30cfe93498c=
cd6017630
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M target-sh4/translate.c

  Log Message:
  -----------
  target-sh4: cleanup DisasContext

We should avoid accessing env at translation stage, except of course for
static values like the supported features.

Remove variables copied from env in DisasContext and use the TB flags
instead.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 080df491db6400fade2bdf1bdeee3a459529398b
      https://github.com/qemu/qemu/commit/080df491db6400fade2bdf1bdeee3a4=
59529398b
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M target-sh4/translate.c

  Log Message:
  -----------
  target-sh4: remove useless code

Almost dead code.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: ffc5ea09afb8f9487ed9d660f54a492889a067c7
      https://github.com/qemu/qemu/commit/ffc5ea09afb8f9487ed9d660f54a492=
889a067c7
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M tcg/README
    M tcg/arm/tcg-target.h
    M tcg/hppa/tcg-target.h
    M tcg/i386/tcg-target.h
    M tcg/ia64/tcg-target.h
    M tcg/mips/tcg-target.h
    M tcg/ppc/tcg-target.h
    M tcg/ppc64/tcg-target.h
    M tcg/s390/tcg-target.h
    M tcg/sparc/tcg-target.h
    M tcg/tcg-op.h
    M tcg/tcg-opc.h
    M tcg/tcg.c
    M tcg/tcg.h
    M tcg/tci/tcg-target.h

  Log Message:
  -----------
  tcg: Introduce movcond

Implemented with setcond if the target does not provide
the optional opcode.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 57e289de7330a97ff4c9919a1dad54ca0650cfa7
      https://github.com/qemu/qemu/commit/57e289de7330a97ff4c9919a1dad54c=
a0650cfa7
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M target-alpha/translate.c

  Log Message:
  -----------
  target-alpha: Use movcond

For proper cmov insns, as well as the non-goto-tb case
of conditional branch.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: d0a16297c97ecf6be259a9a98af7a2dac9230939
      https://github.com/qemu/qemu/commit/d0a16297c97ecf6be259a9a98af7a2d=
ac9230939
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M tcg/i386/tcg-target.c
    M tcg/i386/tcg-target.h

  Log Message:
  -----------
  tcg-i386: Implement movcond

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Reviewed-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: fa01a2084e5643504b28ebba2d9dbdb73d2f74a4
      https://github.com/qemu/qemu/commit/fa01a2084e5643504b28ebba2d9dbdb=
73d2f74a4
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg: Optimize movcond for constant comparisons

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 5d8f53630011f93dc774f1b2dc9557c7eac3ad89
      https://github.com/qemu/qemu/commit/5d8f53630011f93dc774f1b2dc9557c=
7eac3ad89
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg: Optimize two-address commutative operations

While swapping constants to the second operand, swap
sources matching destinations to the first operand.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: eca5c303339016c8640567f2e5a31ef1d6487df9
      https://github.com/qemu/qemu/commit/eca5c303339016c8640567f2e5a31ef=
1d6487df9
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M gdbstub.c

  Log Message:
  -----------
  gdbstub/sh4: fix build with USE_SOFTFLOAT_STRUCT_TYPES

We have to use different type to access float values when
USE_SOFTFLOAT_STRUCT_TYPES is defined.

Rework SH4 version of cpu_gdb_{read,write}_register() using
a single case, and fixing the coding style. Use ldll_p() and
stfl_p() to access float values.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: fe7e1d3ec4410d91a1a687ff4a9288870aefac40
      https://github.com/qemu/qemu/commit/fe7e1d3ec4410d91a1a687ff4a92888=
70aefac40
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M tcg/tcg.h

  Log Message:
  -----------
  tcg: Fix !USE_DIRECT_JUMP

Commit 6375e09e changed the type of TranslationBlock.tb_next,
but failed to change the type of TCGContext.tb_next.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Reviewed-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: c08d9ee38d240ef45496620cbfe8e1b5ed81accb
      https://github.com/qemu/qemu/commit/c08d9ee38d240ef45496620cbfe8e1b=
5ed81accb
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M tcg/hppa/tcg-target.c

  Log Message:
  -----------
  tcg-hppa: Fix brcond2 and setcond2

Neither of these functions were performing double-word
compares properly.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: e55f523d7977480462151d8abb0ebb4b1747eabf
      https://github.com/qemu/qemu/commit/e55f523d7977480462151d8abb0ebb4=
b1747eabf
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M tcg/hppa/tcg-target.c

  Log Message:
  -----------
  tcg-hppa: Fix broken load/store helpers

The CONFIG_TCG_PASS_AREG0 code for calling ld/st helpers
was not respecting the ABI requirement for 64-bit values
being aligned in registers.

Mirror the ARM port in use of helper functions to marshal
arguments into the correct registers.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: cfb75cb9807463ebe18b127096b48b5d0db1ce03
      https://github.com/qemu/qemu/commit/cfb75cb9807463ebe18b127096b48b5=
d0db1ce03
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M configure
    M hw/usb/hcd-ehci.c
    M hw/usb/hcd-uhci.c
    M hw/usb/host-linux.c
    M hw/usb/redirect.c
    M trace-events

  Log Message:
  -----------
  Merge branch 'usb.65' of git://git.kraxel.org/qemu

* 'usb.65' of git://git.kraxel.org/qemu:
  uhci: Don't queue up packets after one with the SPD flag set
  usb-redir: Revert usb-redir part of commit 93bfef4c
  usb-redir: Add chardev open / close debug logging
  usb-redir: Add support for migration
  usb-redir: Store max_packet_size in endp_data
  usb-redir: Add an already_in_flight packet-id queue
  usb-redir: Change cancelled packet code into a generic packet-id queue
  ehci: Walk async schedule before and after migration
  ehci: Don't set seen to 0 when removing unseen queue-heads
  configure: usbredir fixes
  ehci: Don't process too much frames in 1 timer tick (v2)
  ehci: Fix interrupts stopping when Interrupt Threshold Control is 8
  ehci: switch to new-style memory ops
  usb-host: allow emulated (non-async) control requests without USBPacket=



Compare: https://github.com/qemu/qemu/compare/c26032b2c917...cfb75cb98074=


----==_mimepart_505cb235b83ac_5eab127faf0487e1--


</body></email><email><emailId>20120922150012</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-22 15:00:12-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 2ceb3a: tcg-mips: fix wrong usage of 'Z' constraint</subject><body>



----==_mimepart_505dd27ce7a32_3bbe1321ae4397b5
Date: Sat, 22 Sep 2012 08:00:12 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;505dd27cecfab_3bbe1321ae4398c7@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 2ceb3a9e0f2110c7d96134f2db7593609ed50bc2
      https://github.com/qemu/qemu/commit/2ceb3a9e0f2110c7d96134f2db7593609ed50bc2
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/mips/tcg-target.c

  Log Message:
  -----------
  tcg-mips: fix wrong usage of 'Z' constraint

The 'Z' constraint has been introduced to map the zero register. However
when the op also accept a constant, there is no point to accept the zero
register in addition.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 0834c9eac31d6a6780594be17c7b3a3d6403ac16
      https://github.com/qemu/qemu/commit/0834c9eac31d6a6780594be17c7b3a3d6403ac16
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/mips/tcg-target.c

  Log Message:
  -----------
  tcg/mips: kill warnings in user mode

Recent versions of GCC emit warnings when compiling user mode targets.
Kill them by reordering a bit the #ifdef.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 5a0eed379ddff07f1c136c7acedd380b60eecd28
      https://github.com/qemu/qemu/commit/5a0eed379ddff07f1c136c7acedd380b60eecd28
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/mips/tcg-target.c

  Log Message:
  -----------
  tcg/mips: use TCGArg or TCGReg instead of int

Instead of int, use the correct TCGArg and TCGReg type: TCGReg when
representing a TCG target register, TCGArg when representing the latter
or a constant.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 3314e0089f1bae4b0430f9bf3299c3b16d6ea32b
      https://github.com/qemu/qemu/commit/3314e0089f1bae4b0430f9bf3299c3b16d6ea32b
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/mips/tcg-target.c

  Log Message:
  -----------
  tcg/mips: don't use global pointer

Don't use the global pointer in TCG, in case helpers try access global
variables.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 0d0b53a6708d0ae3ea37828ec6a967d55827ed6d
      https://github.com/qemu/qemu/commit/0d0b53a6708d0ae3ea37828ec6a967d55827ed6d
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/mips/tcg-target.c

  Log Message:
  -----------
  tcg/mips: use stack for TCG temps

Use stack instead of temp_buf array in CPUState for TCG
temps.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 0f46c064eebc9c93b8f925416e0812cc7b4bb503
      https://github.com/qemu/qemu/commit/0f46c064eebc9c93b8f925416e0812cc7b4bb503
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/mips/tcg-target.c

  Log Message:
  -----------
  tcg/mips: optimize brcond arg, 0

MIPS has some conditional branch instructions when comparing with zero.
Use them.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: c1cf85c9acb847c4871c0b241ced8fabf410d502
      https://github.com/qemu/qemu/commit/c1cf85c9acb847c4871c0b241ced8fabf410d502
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/mips/tcg-target.c
    M tcg/mips/tcg-target.h

  Log Message:
  -----------
  tcg/mips: optimize bswap{16,16s,32} on MIPS32R2

bswap operations can be optimized on MIPS32 Release 2 using the ROTR,
WSBH and SEH instructions. We can't use the non-R2 code to implement the
ops due to registers constraints, so don't define the corresponding
TCG_TARGET_HAS_bswap* values.

Also bswap16* operations are supposed to be called with the 16 high bits
zeroed. This is the case everywhere (including for TCG by definition)
except when called from the store helper. Remove the AND instructions from
bswap16* and move it there.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 9a152519a9f767297c92b5840c91a22235295c8d
      https://github.com/qemu/qemu/commit/9a152519a9f767297c92b5840c91a22235295c8d
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/mips/tcg-target.c
    M tcg/mips/tcg-target.h

  Log Message:
  -----------
  tcg/mips: implement rotl/rotr ops on MIPS32R2

rotr operations can be optimized on MIPS32 Release 2 using the ROTR and
ROTRV instructions. Also implemented rotl operations by subtracting the
shift from 32.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 04f71aa3fd002d8c3aeb6db72a9219e1a8b3fef4
      https://github.com/qemu/qemu/commit/04f71aa3fd002d8c3aeb6db72a9219e1a8b3fef4
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/mips/tcg-target.c
    M tcg/mips/tcg-target.h

  Log Message:
  -----------
  tcg/mips: implement deposit op on MIPS32R2

deposit operations can be optimized on MIPS32 Release 2 using the INS
instruction.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 7d7c4930ab83349ee31945d93a1747331c37c0eb
      https://github.com/qemu/qemu/commit/7d7c4930ab83349ee31945d93a1747331c37c0eb
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/mips/tcg-target.c
    M tcg/mips/tcg-target.h

  Log Message:
  -----------
  tcg/mips: implement movcond op on MIPS32R2

movcond operation can be implemented on MIPS32 Release 2 using the MOVN,
MOVZ, SLT and SLTU instructions.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 48b56ce1683dec02a29448f31861fca4dd0a0b33
      https://github.com/qemu/qemu/commit/48b56ce1683dec02a29448f31861fca4dd0a0b33
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: remove TCG_TEMP_ANY

TCG_TEMP_ANY has no different meaning than TCG_TEMP_UNDEF, so use
the later instead.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: b80bb016d8c8e9d74345a90ab6dac1cb547904e0
      https://github.com/qemu/qemu/commit/b80bb016d8c8e9d74345a90ab6dac1cb547904e0
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: check types in copy propagation

The copy propagation doesn't check the types of the temps during copy
propagation. However TCG is using the mov_i32 for the i64 to i32
conversion and thus the two are not equivalent.

With this patch tcg_opt_gen_mov() doesn't consider two temps of
different type as copies anymore.

So far it seems the optimization was not aggressive enough to trigger
this bug, but it will be triggered later in this series once the copy
propagation is improved.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: e590d4e6b3c73b38a9d9ed10c898f73ed8a29f1d
      https://github.com/qemu/qemu/commit/e590d4e6b3c73b38a9d9ed10c898f73ed8a29f1d
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: rework copy progagation

The copy propagation pass tries to keep track what is a copy of what
and what has copy of what, and in addition it keep a circular list of
of all the copies. Unfortunately this doesn't fully work: a mov from
a temp which has a state "COPY" changed it into a state "HAS_COPY".
Later when this temp is used again, it is considered has not having
copy and thus no propagation is done.

This patch fixes that by removing the hiearchy between copies, and thus
only keeping a "COPY" state both meaning "is a copy" and "has a copy".
The decision of which copy to use is deferred to the actual temp
replacement. At this stage there is not one best choice to do, but only
better choices than others. For doing the best choice the operation
would have to be parsed in reversed to know if a temp is going to be
used later or not. That what is done by the liveness analysis. At this
stage it is known that globals will be always live, that local temps
will be dead at the end of the translation block, and that the temps
will be dead at the end of the basic block. This means that this stage
should try to replace temps by local temps or globals and local temps
by globals.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 1ff8c5418a680d6766493908eaa07cc11dce7f13
      https://github.com/qemu/qemu/commit/1ff8c5418a680d6766493908eaa07cc11dce7f13
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: do copy propagation for all operations

It is possible to due copy propagation for all operations, even the one
that have side effects or clobber arguments (it only concerns input
arguments). That said, the call operation should be handled differently
due to the variable number of arguments.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 0aba1c7376ad325202f328211ab6dfcae94c7f2a
      https://github.com/qemu/qemu/commit/0aba1c7376ad325202f328211ab6dfcae94c7f2a
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: optimize "op r, a, a =&gt; mov r, a"

Now that we can easily detect all copies, we can optimize the
"op r, a, a =&gt; mov r, a" case a bit more.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 3c94193e0bbdd855bcbedabd27e3cbe1e6bc6242
      https://github.com/qemu/qemu/commit/3c94193e0bbdd855bcbedabd27e3cbe1e6bc6242
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: optimize "op r, a, a =&gt; movi r, 0"

Now that it's possible to detect copies, we can optimize the case
the "op r, a, a =&gt; movi r, 0". This helps in the computation of
overflow flags when one of the two args is 0.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: b336ceb6918b8f9eb54dcbb1043521482c7be83b
      https://github.com/qemu/qemu/commit/b336ceb6918b8f9eb54dcbb1043521482c7be83b
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: further optimize brcond/movcond/setcond

When both argument of brcond/movcond/setcond are the same or when one
of the two values is a constant equal to zero, it's possible to do
further optimizations.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: c2b0e2fea2ef7a183233d3b86c37c5d4bcb89544
      https://github.com/qemu/qemu/commit/c2b0e2fea2ef7a183233d3b86c37c5d4bcb89544
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: prefer the "op a, a, b" form for commutative ops

The "op a, a, b" form is better handled on non-RISC host than the "op
a, b, a" form, so swap the arguments to this form when possible, and
when b is not a constant.

This reduces the number of generated instructions by a tiny bit.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: fba3161fd289f1282f5afce5f91c32e2575e5e8e
      https://github.com/qemu/qemu/commit/fba3161fd289f1282f5afce5f91c32e2575e5e8e
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/tcg.c

  Log Message:
  -----------
  tcg: remove #ifdef #endif around TCGOpcode tests

Commit 25c4d9cc changed all TCGOpcode enums to be available, so we don't
need to #ifdef #endif the one that are available only on some targets.
This makes the code easier to read.

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 7ef55fc91926f518f905692db19ed0b4a8018989
      https://github.com/qemu/qemu/commit/7ef55fc91926f518f905692db19ed0b4a8018989
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/optimize.c

  Log Message:
  -----------
  tcg/optimize: add constant folding for deposit

Reviewed-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: f0da375754666511acefa89b57487a22a2b9f945
      https://github.com/qemu/qemu/commit/f0da375754666511acefa89b57487a22a2b9f945
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/hppa/tcg-target.c
    M tcg/hppa/tcg-target.h

  Log Message:
  -----------
  tcg-hppa: Implement movcond

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 9bacf4143190ca57771c8db5981d040f9c625ae5
      https://github.com/qemu/qemu/commit/9bacf4143190ca57771c8db5981d040f9c625ae5
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/README

  Log Message:
  -----------
  tcg/README: document tcg_gen_goto_tb restrictions

See
http://lists.nongnu.org/archive/html/qemu-devel/2012-09/msg03196.html
for the whole story.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 1b7621ad99d352629c096cba40eadc6fb2b0c294
      https://github.com/qemu/qemu/commit/1b7621ad99d352629c096cba40eadc6fb2b0c294
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/i386/tcg-target.c
    M tcg/i386/tcg-target.h

  Log Message:
  -----------
  w64: Fix TCG helper functions with 5 arguments

TCG uses 6 registers for function arguments on 64 bit Linux hosts,
but only 4 registers on W64 hosts.

Commit 2999a0b20074a7e4a58f56572bb1436749368f59 increased the number
of arguments for some important helper functions from 4 to 5
which triggered a bug for W64 hosts: QEMU aborts when executing
helper_lcall_real in the guest's BIOS because function
tcg_target_get_call_iarg_regs_count always returned 6.

As W64 has only 4 registers for arguments, the 5th argument must be
passed on the stack using a correct stack offset.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: b18212c66870f119111e0777fcc19462ae07eb70
      https://github.com/qemu/qemu/commit/b18212c66870f119111e0777fcc19462ae07eb70
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/i386/tcg-target.c

  Log Message:
  -----------
  tcg/i386: Add shortcuts for registers used in L constraint

While 64 bit hosts use the first three registers which are also used
as function input parameters, 32 bit hosts use TCG_REG_EAX and
TCG_REG_EDX which are not used in parameter passing.

After defining new register macros for the registers used in L
constraint, the patch replaces most occurrences of
tcg_target_call_iarg_regs[0], tcg_target_call_iarg_regs[1] and
tcg_target_call_iarg_regs[2] by those new macros.

tcg_target_call_iarg_regs remains unchanged when it is used for input
arguments (only with 64 bit hosts) before tcg_out_calli.

A comment related to those registers was fixed, too.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
[aurel32: build fix on i386, small optimization for i386 in the prologue]
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: d73685e3c3936fd7851a32eff5443405cb5368be
      https://github.com/qemu/qemu/commit/d73685e3c3936fd7851a32eff5443405cb5368be
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/i386/tcg-target.c

  Log Message:
  -----------
  tcg/i386: Remove unused registers from tcg_target_call_iarg_regs

32 bit x86 hosts don't need registers for helper function arguments
because they use the default stack based calling convention.

Removing the registers allows simpler code for function
tcg_target_get_call_iarg_regs_count.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 6e17d0c5cdf7b3d0086708ba1d2df931e18cb5b5
      https://github.com/qemu/qemu/commit/6e17d0c5cdf7b3d0086708ba1d2df931e18cb5b5
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/arm/tcg-target.c
    M tcg/hppa/tcg-target.c
    M tcg/i386/tcg-target.c
    M tcg/ia64/tcg-target.c
    M tcg/mips/tcg-target.c
    M tcg/ppc/tcg-target.c
    M tcg/ppc64/tcg-target.c
    M tcg/s390/tcg-target.c
    M tcg/sparc/tcg-target.c
    M tcg/tcg.c
    M tcg/tci/tcg-target.c

  Log Message:
  -----------
  tcg: Remove tcg_target_get_call_iarg_regs_count

The TCG targets no longer need individual implementations.

Since commit 6a18ae2d2947532d5c26439548afa0481c4529f9,
'flags' is no longer used in tcg_target_get_call_iarg_regs_count.

The remaining tcg_target_get_call_iarg_regs_count is trivial and only
called once. Therefore the patch eliminates it completely.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


Compare: https://github.com/qemu/qemu/compare/cfb75cb98074...6e17d0c5cdf7

----==_mimepart_505dd27ce7a32_3bbe1321ae4397b5--


</body></email><email><emailId>20120922153007</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-22 15:30:07-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] ad49d1: tcg/mips</subject><body>



----==_mimepart_505dd97f79ad1_7eb31775af062314
Date: Sat, 22 Sep 2012 08:30:07 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;505dd97f7ad54_7eb31775af062453@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: ad49d1f75115663731bfe06dec61eed6775526ad
      https://github.com/qemu/qemu/commit/ad49d1f75115663731bfe06dec61eed6775526ad
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/mips/tcg-target.c

  Log Message:
  -----------
  tcg/mips


  Commit: 23f3ff2604679a0ba7a23be7576529169e5e7921
      https://github.com/qemu/qemu/commit/23f3ff2604679a0ba7a23be7576529169e5e7921
  Author: malc &lt;av1474@comtv.ru&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/ppc/tcg-target.c
    M tcg/ppc/tcg-target.h

  Log Message:
  -----------
  tcg/ppc32: Implement movcond32

Thanks to Richard Henderson

Signed-off-by: malc &lt;av1474@comtv.ru&gt;


Compare: https://github.com/qemu/qemu/compare/6e17d0c5cdf7...23f3ff260467

----==_mimepart_505dd97f79ad1_7eb31775af062314--


</body></email><email><emailId>20120922173007</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-22 17:30:07-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] e809c0: Revert "tcg/mips"</subject><body>



----==_mimepart_505df59f84283_2b701191ae470532
Date: Sat, 22 Sep 2012 10:30:07 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;505df59f85754_2b701191ae470612@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: e809c0dc70522cba07dc2f16f677d1adf01523fc
      https://github.com/qemu/qemu/commit/e809c0dc70522cba07dc2f16f677d1adf01523fc
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M tcg/mips/tcg-target.c

  Log Message:
  -----------
  Revert "tcg/mips"

This reverts commit ad49d1f75115663731bfe06dec61eed6775526ad.

This commit was not supposed to be pushed.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;




----==_mimepart_505df59f84283_2b701191ae470532--


</body></email><email><emailId>20120922180013</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-22 18:00:13-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 62724c: linux-user: Use memcpy in get_user/put_user.</subject><body>



----==_mimepart_505dfcad9bb7d_1dd718b6af4869e2
Date: Sat, 22 Sep 2012 11:00:13 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;505dfcada03d7_1dd718b6af48707e@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 62724cc5ebd7fb9113f156cbc0d2bb5e3cb0a9ae
      https://github.com/qemu/qemu/commit/62724cc5ebd7fb9113f156cbc0d2bb5e3cb0a9ae
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M linux-user/qemu.h

  Log Message:
  -----------
  linux-user: Use memcpy in get_user/put_user.

When host and target have differing alignment rules, using a cast
and direct memory operation can result in SIGBUS.  Use memcpy instead,
which the compiler will happily optimize when alignment is satisfied.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 3ee60ad44a3a8673ad38e3da5af05455fed377b8
      https://github.com/qemu/qemu/commit/3ee60ad44a3a8673ad38e3da5af05455fed377b8
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Hack in qemu_ld/st64 for 32-bit.

Not actually implemented, but at least we avoid the tcg assert at startup.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;


  Commit: a221ae3fcc55fcc3911587bc572af88eed3342dd
      https://github.com/qemu/qemu/commit/a221ae3fcc55fcc3911587bc572af88eed3342dd
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Fix ADDX opcode.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;


  Commit: d5dd696fe3049657c08eb14f40cb74b6e94e79cc
      https://github.com/qemu/qemu/commit/d5dd696fe3049657c08eb14f40cb74b6e94e79cc
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M exec.c

  Log Message:
  -----------
  tcg-sparc: Don't MAP_FIXED on top of the program

The address we pick in sparc64.ld is also 0x60000000, so doing a fixed map
on top of that is guaranteed to blow up.  Choosing 0x40000000 is exactly
right for the max of code_gen_buffer_size set below.

No need to ever use MAP_FIXED.  While getting our desired address helps
optimize the generated code, we won't fail if we don't get it.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;


  Commit: 9b9c37c36439ee0452632253dac7a31897f27f70
      https://github.com/qemu/qemu/commit/9b9c37c36439ee0452632253dac7a31897f27f70
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M configure
    M disas.c
    M exec.c
    M qemu-timer.h
    M tcg/sparc/tcg-target.c
    M tcg/sparc/tcg-target.h
    M tcg/tcg.c

  Log Message:
  -----------
  tcg-sparc: Assume v9 cpu always, i.e. force v8plus in 32-bit mode.

Current code doesn't actually work in 32-bit mode at all.  Since
no one really noticed, drop the complication of v7 and v8 cpus.
Eliminate the --sparc_cpu configure option and standardize macro
testing on TCG_TARGET_REG_BITS / HOST_LONG_BITS

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;


  Commit: a0ce341aac61ca3d56bcb56dcfb6ac11272fd567
      https://github.com/qemu/qemu/commit/a0ce341aac61ca3d56bcb56dcfb6ac11272fd567
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Fix qemu_ld/st to handle 32-bit host.

At the same time, split out the tlb load logic to a new function.
Fixes the cases of two data registers and two address registers.
Fixes the signature of, and adds missing, qemu_ld/st opcodes.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;


  Commit: c6f7e4fb9a0f82bb826f4bd7dff6f2c90d6a83be
      https://github.com/qemu/qemu/commit/c6f7e4fb9a0f82bb826f4bd7dff6f2c90d6a83be
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M configure
    M tcg/sparc/tcg-target.c
    M tcg/sparc/tcg-target.h

  Log Message:
  -----------
  tcg-sparc: Support GUEST_BASE.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;


  Commit: 0c554161b6fadf75e42d4228e952ff100176ff8a
      https://github.com/qemu/qemu/commit/0c554161b6fadf75e42d4228e952ff100176ff8a
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c
    M tcg/sparc/tcg-target.h

  Log Message:
  -----------
  tcg-sparc: Change AREG0 in generated code to %i0.

We can now move the TCG variable from %g[56] to a call-preserved
windowed register.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;


  Commit: 4c3204cb12a966d0d1255eeeaabf30ee4bd34629
      https://github.com/qemu/qemu/commit/4c3204cb12a966d0d1255eeeaabf30ee4bd34629
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M configure
    M tcg/sparc/tcg-target.c
    M tcg/sparc/tcg-target.h

  Log Message:
  -----------
  tcg-sparc: Clean up cruft stemming from attempts to use global registers.

Don't use -ffixed-gN.  Don't link statically.  Don't save/restore
AREG0 around calls.  Don't allocate space on the stack for AREG0 save.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;


  Commit: 1fd959466574c3d46f4898f2e27cd3b1060338e4
      https://github.com/qemu/qemu/commit/1fd959466574c3d46f4898f2e27cd3b1060338e4
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Mask shift immediates to avoid illegal insns.

The xtensa-test image generates a sra_i32 with count 0x40.
Whether this is accident of tcg constant propagation or
originating directly from the instruction stream is immaterial.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;


  Commit: 375816f84b820e087fab8ff584bd5b8f27811cdb
      https://github.com/qemu/qemu/commit/375816f84b820e087fab8ff584bd5b8f27811cdb
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Use defines for temporaries.

And change from %i4/%i5 to %g1/%o7 to remove a v8plus fixme.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;


  Commit: 26adfb759c4c6ad42958c365812945316f3468ae
      https://github.com/qemu/qemu/commit/26adfb759c4c6ad42958c365812945316f3468ae
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Add %g/%o registers to alloc_order

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;


  Commit: 5bbd2cae8e087b4329e17c3f44439096e4c3ec6a
      https://github.com/qemu/qemu/commit/5bbd2cae8e087b4329e17c3f44439096e4c3ec6a
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M exec-all.h
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Fix and enable direct TB chaining.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;


  Commit: f4bf0b912e780978a37979f7a9fad40f99aa2241
      https://github.com/qemu/qemu/commit/f4bf0b912e780978a37979f7a9fad40f99aa2241
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M tcg/sparc/tcg-target.c

  Log Message:
  -----------
  tcg-sparc: Preserve branch destinations during retranslation

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;


  Commit: 66176802960ad1f7c3d061d17b784088c2e28d59
      https://github.com/qemu/qemu/commit/66176802960ad1f7c3d061d17b784088c2e28d59
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M fpu/softfloat.h

  Log Message:
  -----------
  softfloat: make float_muladd_negate_* flags independent

Flags passed into float{32,64}_muladd are treated as bits; assign
independent bits to float_muladd_negate_* to allow precise control over
what gets negated in float{32,64}_muladd.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Reviewed-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 213ff4e6df0f74e93995a5d3d7429acb4ad3ee86
      https://github.com/qemu/qemu/commit/213ff4e6df0f74e93995a5d3d7429acb4ad3ee86
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M fpu/softfloat-specialize.h
    M fpu/softfloat.h

  Log Message:
  -----------
  softfloat: add NO_SIGNALING_NANS

Architectures that don't have signaling NaNs can define
NO_SIGNALING_NANS, it will make float*_is_quiet_nan return 1 for any NaN
and float*_is_signaling_nan always return 0.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 10f6ca034089e201aaff1da5ed99b127811081d5
      https://github.com/qemu/qemu/commit/10f6ca034089e201aaff1da5ed99b127811081d5
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M target-xtensa/overlay_tool.h

  Log Message:
  -----------
  target-xtensa: handle boolean option in overlays

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: b81fe822dad134871cd336e26ed55d165e597f4e
      https://github.com/qemu/qemu/commit/b81fe822dad134871cd336e26ed55d165e597f4e
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M fpu/softfloat-specialize.h

  Log Message:
  -----------
  target-xtensa: specialize softfloat NaN rules

NaN propagation rule: leftmost NaN in the expression gets propagated to
the result.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: dd519cbec63434f2b883f0b4a20f827bbd59793e
      https://github.com/qemu/qemu/commit/dd519cbec63434f2b883f0b4a20f827bbd59793e
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M gdbstub.c
    M target-xtensa/cpu.h
    M target-xtensa/helper.h
    M target-xtensa/op_helper.c
    M target-xtensa/translate.c

  Log Message:
  -----------
  target-xtensa: add FP registers

There are 16 32-bit FP registers (f0 - f15), control and status user
registers (fcr, fsr).

See ISA, 4.3.10 for more details.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 9ed7ae12afacdd234a749aa5af27dd93ea1594ec
      https://github.com/qemu/qemu/commit/9ed7ae12afacdd234a749aa5af27dd93ea1594ec
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M target-xtensa/translate.c

  Log Message:
  -----------
  target-xtensa: implement LSCX and LSCI groups

These are load/store instructions for FP registers with immediate or
register index and optional base post-update.
See ISA, 4.3.10 for more details.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 0b6df8385d24a4eed0ff546493c59e047b16537b
      https://github.com/qemu/qemu/commit/0b6df8385d24a4eed0ff546493c59e047b16537b
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M target-xtensa/helper.h
    M target-xtensa/op_helper.c
    M target-xtensa/translate.c

  Log Message:
  -----------
  target-xtensa: implement FP0 arithmetic

These are FP arithmetic opcodes.
See ISA, 4.3.10 for more details.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: b7ee8c6a32987e5039f0a2c2976fad556965727d
      https://github.com/qemu/qemu/commit/b7ee8c6a32987e5039f0a2c2976fad556965727d
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M target-xtensa/helper.h
    M target-xtensa/op_helper.c
    M target-xtensa/translate.c

  Log Message:
  -----------
  target-xtensa: implement FP0 conversions

These are FP to integer and integer to FP conversion opcodes.
See ISA, 4.3.10 for more details.

Note that ISA description for utrunc.s is currently incorrect and will
be fixed in future revisions.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 4e273869671d78660cd709183d3c5dec3a17de79
      https://github.com/qemu/qemu/commit/4e273869671d78660cd709183d3c5dec3a17de79
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M target-xtensa/helper.h
    M target-xtensa/op_helper.c
    M target-xtensa/translate.c

  Log Message:
  -----------
  target-xtensa: implement FP1 group

These are comparison and conditional move opcodes.
See ISA, 4.3.10 for more details.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: ef04a8467eae31bc93b9458ad3d30a6ad1303327
      https://github.com/qemu/qemu/commit/ef04a8467eae31bc93b9458ad3d30a6ad1303327
  Author: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M target-xtensa/cpu.h
    M target-xtensa/translate.c

  Log Message:
  -----------
  target-xtensa: implement coprocessor context option

In case Coprocessor Context option is enabled CPENABLE SR bits control
whether access to coprocessors is allowed or would rise one of
CoprocessorXDisabled exceptions.

See ISA, 4.4.5 for more details.

FP is coprocessor 0.

Signed-off-by: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 04cbbdeefdda2615b11f7890f1e61b750e83129f
      https://github.com/qemu/qemu/commit/04cbbdeefdda2615b11f7890f1e61b750e83129f
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M configure
    M disas.c
    M exec-all.h
    M exec.c
    M linux-user/qemu.h
    M qemu-timer.h
    M tcg/sparc/tcg-target.c
    M tcg/sparc/tcg-target.h
    M tcg/tcg.c

  Log Message:
  -----------
  Merge branch 'tcg-sparc' of git://repo.or.cz/qemu/rth

* 'tcg-sparc' of git://repo.or.cz/qemu/rth:
  tcg-sparc: Preserve branch destinations during retranslation
  tcg-sparc: Fix and enable direct TB chaining.
  tcg-sparc: Add %g/%o registers to alloc_order
  tcg-sparc: Use defines for temporaries.
  tcg-sparc: Mask shift immediates to avoid illegal insns.
  tcg-sparc: Clean up cruft stemming from attempts to use global registers.
  tcg-sparc: Change AREG0 in generated code to %i0.
  tcg-sparc: Support GUEST_BASE.
  tcg-sparc: Fix qemu_ld/st to handle 32-bit host.
  tcg-sparc: Assume v9 cpu always, i.e. force v8plus in 32-bit mode.
  tcg-sparc: Don't MAP_FIXED on top of the program
  tcg-sparc: Fix ADDX opcode.
  tcg-sparc: Hack in qemu_ld/st64 for 32-bit.
  linux-user: Use memcpy in get_user/put_user.


Compare: https://github.com/qemu/qemu/compare/e809c0dc7052...04cbbdeefdda

----==_mimepart_505dfcad9bb7d_1dd718b6af4869e2--


</body></email><email><emailId>20120922220007</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-22 22:00:07-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 93b659: audio: Fix warning from static code analysis</subject><body>



----==_mimepart_505e34e7ca30e_4815ef8ae4447b2
Date: Sat, 22 Sep 2012 15:00:07 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;505e34e7cb8bd_4815ef8ae44484d@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 93b6599734f81328ee3d608f57667742cafeea72
      https://github.com/qemu/qemu/commit/93b6599734f81328ee3d608f57667742cafeea72
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M audio/audio_template.h

  Log Message:
  -----------
  audio: Fix warning from static code analysis

smatch report:
audio/audio_template.h:416 AUD_open_out(18) warn:
 variable dereferenced before check 'as' (see line 414)

Moving the ldebug statement after the statement which checks 'as'
fixes that warning.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;




----==_mimepart_505e34e7ca30e_4815ef8ae4447b2--


</body></email><email><emailId>20120923173008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-23 17:30:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] d3e8f9: w32: Add implementation of gmtime_r, localtime_r</subject><body>



----==_mimepart_505f47204c97f_38c1643aec1087d0
Date: Sun, 23 Sep 2012 10:30:08 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;505f47204de92_38c1643aec10889d@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: d3e8f95753114a827f9cd8e819b1d5cc8333f76b
      https://github.com/qemu/qemu/commit/d3e8f95753114a827f9cd8e819b1d5cc8333f76b
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-23 (Sun, 23 Sep 2012)

  Changed paths:
    M oslib-win32.c
    M qemu-os-win32.h

  Log Message:
  -----------
  w32: Add implementation of gmtime_r, localtime_r

Those functions are missing in MinGW.

Some versions of MinGW-w64 include defines for gmtime_r and localtime_r.
Older versions of these macros are buggy (they return a pointer to a
static variable), therefore we don't want them. Newer versions are
similar to the code used here, but without the memset.

The implementation which is used here is not strictly reentrant,
but sufficiently good for QEMU on w32 or w64.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
[blauwirbel@gmail.com: added comment about locking]
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;




----==_mimepart_505f47204c97f_38c1643aec1087d0--


</body></email><email><emailId>20120925230012</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-25 23:00:12-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 8f06bf: tcg/mips: fix MIPS32(R2) detection</subject><body>



----==_mimepart_5062377ccee4_1c0b100eaf091789
Date: Tue, 25 Sep 2012 16:00:12 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5062377cfbbe_1c0b100eaf09185c@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 8f06bf693dec29642255adcc2828bc6b7daa83d9
      https://github.com/qemu/qemu/commit/8f06bf693dec29642255adcc2828bc6b7daa83d9
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M tcg/mips/tcg-target.c
    M tcg/mips/tcg-target.h

  Log Message:
  -----------
  tcg/mips: fix MIPS32(R2) detection

Fix the MIPS32(R2) cpu detection so that it also works with
-march=octeon. Thanks to Andrew Pinski for the hint.

Cc: Andrew Pinski &lt;apinski@cavium.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 5a696f6ac0641f200cdd2dfe7a6fd397d48ea7bd
      https://github.com/qemu/qemu/commit/5a696f6ac0641f200cdd2dfe7a6fd397d48ea7bd
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M tcg/README

  Log Message:
  -----------
  tcg: Adjust descriptions of *cond opcodes

The README file documented the operand ordering of the tcg_gen_*
functions.  Since we're documenting opcodes here, use the true
operand ordering.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Cc: malc &lt;av1474@comtv.ru&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 42ce3e2015b26df591e1d4c5aa1814fb8c45c36c
      https://github.com/qemu/qemu/commit/42ce3e2015b26df591e1d4c5aa1814fb8c45c36c
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M tcg/tcg-op.h

  Log Message:
  -----------
  tcg: Emit ANDI as EXTU for appropriate constants

Note that andi_i64 failed to perform even the minimal
optimizations promised by the README.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: d81ada7fa43e588a24856da4bfcdcac020d8e25b
      https://github.com/qemu/qemu/commit/d81ada7fa43e588a24856da4bfcdcac020d8e25b
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M tcg/tcg-op.h

  Log Message:
  -----------
  tcg: Optimize initial inputs for ori_i64

Copy the same optimizations from ori_i32.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 6f3bb33eaa79570b7009f3704ca55c4f8296219f
      https://github.com/qemu/qemu/commit/6f3bb33eaa79570b7009f3704ca55c4f8296219f
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M tcg/tcg-op.h

  Log Message:
  -----------
  tcg: Emit XORI as NOT for appropriate constants

Note that xori_i64 failed to perform even the minimal
optimizations promised by the README.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 77276f6581b660a14bec069ec8d20f1280bddeb6
      https://github.com/qemu/qemu/commit/77276f6581b660a14bec069ec8d20f1280bddeb6
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M tcg/tcg-op.h

  Log Message:
  -----------
  tcg: Implement concat*_i64 with deposit_i64

For tcg_gen_concat_i32_i64 we only use deposit if the host supports it.
For tcg_gen_concat32_i64 even if the host does not, as we get identical
code before and after.

Note that this relies on the ANDI -&gt; EXTU patch for the identity claim.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: c552d6c038f7cf4058d1fd5987118ffd41e0e050
      https://github.com/qemu/qemu/commit/c552d6c038f7cf4058d1fd5987118ffd41e0e050
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M tcg/tcg.h

  Log Message:
  -----------
  tcg: Add tcg_debug_assert

Like the C assert macro, except only enabled for CONFIG_DEBUG_TCG,
and without having to set _NDEBUG and disable all other asserts at
the same time.

The use of __builtin_unreachable (when available) gives the compiler
the same information, which may (or may not) help it optimize better.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 717e70368bdc339d241f84aba00ed72d051e0236
      https://github.com/qemu/qemu/commit/717e70368bdc339d241f84aba00ed72d051e0236
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M tcg/tcg-op.h

  Log Message:
  -----------
  tcg: Sanity check deposit inputs

Given these are constants, checking once here means everything
after can assume they're correct.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 0a209d4bb119b92eb14b9afab55cef5bc0555554
      https://github.com/qemu/qemu/commit/0a209d4bb119b92eb14b9afab55cef5bc0555554
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M tcg/tcg-op.h
    M tcg/tcg.c
    M tcg/tcg.h

  Log Message:
  -----------
  tcg: Sanity check goto_tb input

Checking that we don't try for idx != [01] is trivial.  Checking
that we don't issue more than one of any index requires a tad
more data and some ifdefs protecting that new variable.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Cc: Max Filippov &lt;jcmvbkbc@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: a463133ee26b9172728476962eb9d411985b480f
      https://github.com/qemu/qemu/commit/a463133ee26b9172728476962eb9d411985b480f
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M tcg/tcg-op.h

  Log Message:
  -----------
  tcg: Streamline movcond_i64 using 32-bit arithmetic

Avoiding 64-bit arithmetic (outside of the compare) reduces the
generated op count from 15 to 12, and the generated code size on
i686 from 105 to 88 bytes.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: a80a6b63e362cc8eda7aae5b4c3f9e4e49013d62
      https://github.com/qemu/qemu/commit/a80a6b63e362cc8eda7aae5b4c3f9e4e49013d62
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M tcg/tcg-op.h

  Log Message:
  -----------
  tcg: Streamline movcond_i64 using movcond_i32

When movcond_i32 is available we can further reduce the generated
op count from 12 to 6, and the generated code size on i686 from
88 to 74 bytes.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: f813cb838f19ee8637d3c365659e6a6bb0c9c974
      https://github.com/qemu/qemu/commit/f813cb838f19ee8637d3c365659e6a6bb0c9c974
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M tcg/i386/tcg-target.c

  Log Message:
  -----------
  tcg/i386: fix build with -march &lt; i686

The movcond_i32 op has to be protected with TCG_TARGET_HAS_movcond_i32
to fix the build with -march &lt; i686.

Thanks to Richard Henderson for the hint.

Reported-by: Alex Barcelo &lt;abarcelo@ac.upc.edu&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


Compare: https://github.com/qemu/qemu/compare/d3e8f9575311...f813cb838f19

----==_mimepart_5062377ccee4_1c0b100eaf091789--


</body></email><email><emailId>20120925233021</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-25 23:30:21-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] fa26c2: nbd: add more constants</subject><body>



----==_mimepart_50623e8cf1c81_256e1506ae478651
Date: Tue, 25 Sep 2012 16:30:21 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50623e8d772_256e1506ae478778@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: fa26c26b078b298a18686adb06a38bea3cdee990
      https://github.com/qemu/qemu/commit/fa26c26b078b298a18686adb06a38bea3cdee990
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-18 (Tue, 18 Sep 2012)

  Changed paths:
    M nbd.c

  Log Message:
  -----------
  nbd: add more constants

Avoid magic numbers and magic size computations; hide them behind
constants.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 9a304d29a79a3daeeaf15c68d7439713037405b1
      https://github.com/qemu/qemu/commit/9a304d29a79a3daeeaf15c68d7439713037405b1
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M nbd.c

  Log Message:
  -----------
  nbd: pass NBDClient to nbd_send_negotiate

We will need the NBDClient in nbd_send_negotiate to store the
export requested by the client.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: a4aab7b4cb2d994e17c987d7d3fb2b6645ea92a2
      https://github.com/qemu/qemu/commit/a4aab7b4cb2d994e17c987d7d3fb2b6645ea92a2
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M nbd.c
    M qemu-nbd.c

  Log Message:
  -----------
  nbd: do not close BlockDriverState in nbd_export_close

This is not desirable when embedding the NBD server inside QEMU.
Move the bdrv_close to qemu-nbd.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: ce33967af74523685c7f911f6576c689728fcc81
      https://github.com/qemu/qemu/commit/ce33967af74523685c7f911f6576c689728fcc81
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M nbd.c
    M nbd.h

  Log Message:
  -----------
  nbd: make refcount interface public

After the next patch, the close callback will have to release its
reference.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: ff2b68aa70d10b7eae813b04e9a23723dbd89ebd
      https://github.com/qemu/qemu/commit/ff2b68aa70d10b7eae813b04e9a23723dbd89ebd
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M nbd.c
    M nbd.h

  Log Message:
  -----------
  nbd: do not leak nbd_trip coroutines when a connection is torn down

Because nbd_client_close removes the I/O handlers for the client
socket, there is no way that any suspended coroutines are restarted.
This will be a problem with the QEMU embedded NBD server, because
we will have a QMP command to forcibly close all connections with
the clients.

Instead, we can exploit the reference counting of NBDClients; shutdown the
client socket, which will make it readable and writeable.  Also call the
close callback, which will release the user's reference.  The coroutines
then will fail and exit cleanly, and release all remaining references,
until the last refcount finally triggers the closure of the client.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 2c8d9f065538a5a0ef2421e90b6076d05148accf
      https://github.com/qemu/qemu/commit/2c8d9f065538a5a0ef2421e90b6076d05148accf
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M nbd.c
    M nbd.h
    M qemu-nbd.c

  Log Message:
  -----------
  nbd: add reference counting to NBDExport

We will use a similar two-phase destruction for NBDExport, so we need
each NBDClient to add a reference to NBDExport.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 4b9441f6b3565ba6affa95141590cd2be4ae0cd9
      https://github.com/qemu/qemu/commit/4b9441f6b3565ba6affa95141590cd2be4ae0cd9
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M nbd.c

  Log Message:
  -----------
  nbd: track clients into NBDExport

Track the NBDClients of each NBDExport, and use it to implement
nbd_export_close.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 0ddf08db22a9ef6b122d8c4cfe5b25d2c2c51962
      https://github.com/qemu/qemu/commit/0ddf08db22a9ef6b122d8c4cfe5b25d2c2c51962
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M nbd.c
    M nbd.h
    M qemu-nbd.c

  Log Message:
  -----------
  nbd: add notification for closing an NBDExport

In order to exit cleanly from qemu-nbd, add a callback that triggers
when an NBDExport is closed.  In the case of qemu-nbd it will exit the
main loop.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 7860a380ac2a9fd09a6e8f31fd9db5318fc91285
      https://github.com/qemu/qemu/commit/7860a380ac2a9fd09a6e8f31fd9db5318fc91285
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M qemu-nbd.c

  Log Message:
  -----------
  qemu-nbd: rewrite termination conditions to use a state machine

Use a simple state machine with the following states:

- RUNNING     =&gt; accepting connections
- TERMINATE   =&gt; main loop must call nbd_export_close/put, and not accept
  connections anymore
- TERMINATING =&gt; waiting for pending requests to finish
- TERMINATED  =&gt; the NBDExport has been closed

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: ee0a19ec2a98989ff634857fb203bc2879d96bff
      https://github.com/qemu/qemu/commit/ee0a19ec2a98989ff634857fb203bc2879d96bff
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M nbd.c
    M nbd.h

  Log Message:
  -----------
  nbd: register named exports

Add an API to register and find named exports.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 6b8c01e781524ab713faa31a4fb5b20a745f638a
      https://github.com/qemu/qemu/commit/6b8c01e781524ab713faa31a4fb5b20a745f638a
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M nbd.c

  Log Message:
  -----------
  nbd: negotiate with named exports

Allow negotiation to receive the name of the requested export from
the client.  Passing a NULL export to nbd_client_new will cause
the server to send the extended negotiation header.  The exp field
is then filled during negotiation.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 125afda8cbd228583c1e7c32c0f86eeb8de39c73
      https://github.com/qemu/qemu/commit/125afda8cbd228583c1e7c32c0f86eeb8de39c73
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-19 (Wed, 19 Sep 2012)

  Changed paths:
    M nbd.c
    M nbd.h

  Log Message:
  -----------
  nbd: add nbd_export_get_blockdev

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: f2ca052414d7eddc10517e98a5a27ba8099b19b1
      https://github.com/qemu/qemu/commit/f2ca052414d7eddc10517e98a5a27ba8099b19b1
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M MAINTAINERS

  Log Message:
  -----------
  MAINTAINERS: Add entry for QOM CPU

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 6cdf8854203e51a222c9ce94a8c8c568da834cf6
      https://github.com/qemu/qemu/commit/6cdf8854203e51a222c9ce94a8c8c568da834cf6
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: Fold -cpu ?cpuid, ?model output into -cpu help, drop ?dump

Commit c8057f95 (accidentally) disabled the ability to pass
option strings starting with '?' to the target-specific
cpu_list function, so the target-i386 specific "-cpu ?dump",
"-cpu ?cpuid" and "-cpu ?model" stopped working.

Since these options are undocumented and not used by libvirt,
simply drop them completely rather than reinstating them
with new style syntax. Instead, we fold the ?model and ?cpuid
output into the output of the plain "-cpu help" output. The
detailed output produced by ?dump is dropped.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Reviewed-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Reviewed-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: e916cbf80328d46b288f6c82a12cb3b8fc4fbd4a
      https://github.com/qemu/qemu/commit/e916cbf80328d46b288f6c82a12cb3b8fc4fbd4a
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M cpus.c
    M linux-user/main.c
    M target-i386/cpu.c
    M target-i386/cpu.h

  Log Message:
  -----------
  Drop cpu_list_id macro

Since the only user of the extended cpu_list_id() format
was the x86 ?model/?dump/?cpuid output, we can drop it
completely.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Reviewed-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: a75b081846176b020e5f39b37a0ae197172b7838
      https://github.com/qemu/qemu/commit/a75b081846176b020e5f39b37a0ae197172b7838
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M target-i386/cpu.h

  Log Message:
  -----------
  target-i386: Add missing CPUID_* constants

Those constants will be used by new CPU model definitions.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Reviewed-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 3eca46420c9f727ea5c50086d50a610f939affe5
      https://github.com/qemu/qemu/commit/3eca46420c9f727ea5c50086d50a610f939affe5
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M sysconfigs/target/cpus-x86_64.conf
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: Move CPU models from cpus-x86_64.conf to C

Those models are maintained by QEMU and may require compatibility code
to be added when making some changes. Keeping the data in the C source
code should make it simpler to handle those details.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Reviewed-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Reviewed-by: Don Slutz &lt;Don@CloudSwitch.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: ba6212d8a809b89151a9d76b452b814836474029
      https://github.com/qemu/qemu/commit/ba6212d8a809b89151a9d76b452b814836474029
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M Makefile
    M arch_init.c
    R sysconfigs/target/cpus-x86_64.conf

  Log Message:
  -----------
  Eliminate cpus-x86_64.conf file

This file is not needed anymore, as QEMU won't ship any config-based
cpudefs out of the box, relying only on the builtin CPU models.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Reviewed-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: bc3e1291ddcbc0f6548886a321c98227fa710173
      https://github.com/qemu/qemu/commit/bc3e1291ddcbc0f6548886a321c98227fa710173
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: x86_cpudef_setup() coding style change

Make source code lines shorter.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Reviewed-by: Don Slutz &lt;Don@CloudSwitch.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: c04321b3685a0b06d737d04146a0f1f2c5950b39
      https://github.com/qemu/qemu/commit/c04321b3685a0b06d737d04146a0f1f2c5950b39
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: Kill cpudef config section support

It's nice to have a flexible system to maintain CPU models as data, but
this is holding us from making improvements in the CPU code because it's
not using the common infra-structure, and because the machine-type data
is still inside C code.

Users who want to configure CPU features directly may simply use the
"-cpu" command-line option (and maybe an equivalent -device option in
the future) to set CPU features.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 473955e5c3bce09c007ba3b64937cfca6f18f525
      https://github.com/qemu/qemu/commit/473955e5c3bce09c007ba3b64937cfca6f18f525
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: Drop unused setscalar() macro

It was only used by now removed setfeatures() function.

Suggested-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: 2b85cf0efd81a6190320e7b488a0a4bad9743cc3
      https://github.com/qemu/qemu/commit/2b85cf0efd81a6190320e7b488a0a4bad9743cc3
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M target-alpha/translate.c

  Log Message:
  -----------
  target-alpha: Initialize env-&gt;cpu_model_str

Save the cpu_model_str so that we have a non-null value when
creating a new cpu during clone.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;


  Commit: f1a12821d7df2e4d21be4f2206f84b4640533e53
      https://github.com/qemu/qemu/commit/f1a12821d7df2e4d21be4f2206f84b4640533e53
  Author: Ronnie Sahlberg &lt;ronniesahlberg@gmail.com&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M block/iscsi.c

  Log Message:
  -----------
  iSCSI: We need to support SG_IO also from iscsi_ioctl()

We need to support SG_IO from the synchronous iscsi_ioctl() since
scsi-block uses this to do an INQ to the device to discover its properties
This patch makes scsi-block work with iscsi.

Signed-off-by: Ronnie Sahlberg &lt;ronniesahlberg@gmail.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 40a13ca8d28c21062e35b10d9b80e76b92405bdf
      https://github.com/qemu/qemu/commit/40a13ca8d28c21062e35b10d9b80e76b92405bdf
  Author: Ronnie Sahlberg &lt;ronniesahlberg@gmail.com&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M block/iscsi.c

  Log Message:
  -----------
  iSCSI: We dont need to explicitely call qemu_notify_event() any more

We no longer need to explicitely call qemu_notify_event() any more
since this is now done automatically any time the filehandles we listen
to change.

Signed-off-by: Ronnie Sahlberg &lt;ronniesahlberg@gmail.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 444bc908611ccaf4512dc37c33ac3b54d873a62b
      https://github.com/qemu/qemu/commit/444bc908611ccaf4512dc37c33ac3b54d873a62b
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M hw/scsi-disk.c

  Log Message:
  -----------
  scsi-disk: introduce check_lba_range

Abstract the test for an out-of-range (starting block, block count)
pair.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 12ca76fc48081b3a0ad1a70546abfcf198aedfc4
      https://github.com/qemu/qemu/commit/12ca76fc48081b3a0ad1a70546abfcf198aedfc4
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M hw/scsi-disk.c

  Log Message:
  -----------
  scsi-disk: fix check for out-of-range LBA

This fix is needed to correctly handle 0-block read and writes.
Without it, a 0-block access at LBA 0 would underflow.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: bb729f758195a36db1dd0d5c01ec983e466729eb
      https://github.com/qemu/qemu/commit/bb729f758195a36db1dd0d5c01ec983e466729eb
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M hw/scsi-bus.c
    M hw/scsi.h

  Log Message:
  -----------
  scsi: introduce scsi_cdb_length and scsi_data_cdb_length

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: e93176d55f1eb4be1a366b51afeaf4f4c8c31d75
      https://github.com/qemu/qemu/commit/e93176d55f1eb4be1a366b51afeaf4f4c8c31d75
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M hw/scsi-disk.c

  Log Message:
  -----------
  scsi-disk: use scsi_data_cdb_length

This simplifies and unifies the parsing of READ, WRITE and WRITE SAME
commands.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 1109c894052751df99962c009fd7dbae397721f5
      https://github.com/qemu/qemu/commit/1109c894052751df99962c009fd7dbae397721f5
  Author: Ronnie Sahlberg &lt;ronniesahlberg@gmail.com&gt;
  Date:   2012-09-21 (Fri, 21 Sep 2012)

  Changed paths:
    M hw/scsi-disk.c

  Log Message:
  -----------
  SCSI: Standard INQUIRY data should report HiSup flag as set.

QEMU as far as I know only reports LUN numbers using the modes that
are described in SAM4.
As such, since all LUN numbers generated by the SCSI emulation in QEMU
follow SAM4, we should set the HiSup bit in the standard INQUIRY data
to indicate such.

&gt;From SAM4:
  4.6.3 LUNs overview
  All LUN formats described in this standard are hierarchical in
  structure even when only a single level in that hierarchy is used.
  The HISUP bit shall be set to one in the standard INQUIRY data
  (see SPC-4) when any LUN format described in this standard is used.
  Non-hierarchical formats are outside the scope of this standard.

Signed-off-by: Ronnie Sahlberg &lt;ronniesahlberg@gmail.com&gt;


  Commit: 2e84849aa2cc7f220d3b3668f5f7e3c57bb1b590
      https://github.com/qemu/qemu/commit/2e84849aa2cc7f220d3b3668f5f7e3c57bb1b590
  Author: Don Slutz &lt;Don@CloudSwitch.com&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: Allow tsc-frequency to be larger then 2.147G

The check using INT_MAX (2147483647) is wrong in this case.

Signed-off-by: Fred Oliveira &lt;foliveira@cloudswitch.com&gt;
Signed-off-by: Don Slutz &lt;Don@CloudSwitch.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: b548828862d3bf7214b7ef9cb361356b153b89c9
      https://github.com/qemu/qemu/commit/b548828862d3bf7214b7ef9cb361356b153b89c9
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M qemu-ga.c

  Log Message:
  -----------
  qemu-ga: Remove unreachable code after g_error

Report from smatch:
qemu-ga.c:117 register_signal_handlers(11) info: ignoring unreachable code.
qemu-ga.c:122 register_signal_handlers(16) info: ignoring unreachable code.

g_error calls abort which terminates the program.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: 39b384591fda27d6e1213cea0b11b1ebe0ed4b74
      https://github.com/qemu/qemu/commit/39b384591fda27d6e1213cea0b11b1ebe0ed4b74
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M qemu-sockets.c

  Log Message:
  -----------
  qemu-sockets: Fix potential memory leak

The old code leaks variable 'peer'.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: 5d40097fc09fe5d34cf316a411dc27d455ac2cd0
      https://github.com/qemu/qemu/commit/5d40097fc09fe5d34cf316a411dc27d455ac2cd0
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M hw/cadence_uart.c

  Log Message:
  -----------
  cadence_uart: Fix buffer overflow

Report from smatch:
hw/cadence_uart.c:413 uart_read(13) error: buffer overflow 's-&gt;r' 18 &lt;= 18

This fixes read access to s-&gt;r[R_MAX] which is behind the limits of s-&gt;r.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: 8139626643cbe8dc07bd9acc88057effeedf8064
      https://github.com/qemu/qemu/commit/8139626643cbe8dc07bd9acc88057effeedf8064
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M hw/lm4549.c

  Log Message:
  -----------
  lm4549: Fix buffer overflow

Report from smatch:
lm4549.c:234 lm4549_write_samples(14) error:
 buffer overflow 's-&gt;buffer' 1024 &lt;= 1024

There must be enough space to add two entries starting with index
s-&gt;buffer_level, therefore the old check was wrong.

[Peter Maydell &lt;peter.maydell@linaro.org&gt; clarifies the nature of the
analyser warning:

I don't object to making the change to placate the analyser,
but I don't think this is actually a buffer overrun. We always
add and remove samples from the buffer two at a time, so it's
not possible to get here with s-&gt;buffer_level == BUFFER_SIZE-1
(which is the only case where the old and new conditions
give different answers).]

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: 997f15672a5ca7714cf310d92f475d2c5fe40970
      https://github.com/qemu/qemu/commit/997f15672a5ca7714cf310d92f475d2c5fe40970
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M hw/ioh3420.c

  Log Message:
  -----------
  ioh3420: Remove unreachable code

Report from smatch:
hw/ioh3420.c:128 ioh3420_initfn(35) info: ignoring unreachable code.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Juan Quintela &lt;quintela@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: 12dabc79f976d66755025272f7e2e8e4da31715a
      https://github.com/qemu/qemu/commit/12dabc79f976d66755025272f7e2e8e4da31715a
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M hw/pflash_cfi01.c

  Log Message:
  -----------
  pflash_cfi01: Fix warning caused by unreachable code

Report from smatch:
hw/pflash_cfi01.c:431 pflash_write(180) info: ignoring unreachable code.

Instead of removing the return statement after the switch statement,
the patch replaces the return statements in the switch statement by
break statements. Other switch statements in the same code do it also
like that.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: d8f8a860f2403533fc73f541122c65a34b21e42f
      https://github.com/qemu/qemu/commit/d8f8a860f2403533fc73f541122c65a34b21e42f
  Author: Alon Levy &lt;alevy@redhat.com&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M scripts/tracetool/backend/dtrace.py

  Log Message:
  -----------
  dtrace backend: add function to reserved words

Signed-off-by: Alon Levy &lt;alevy@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: 995ee2bf469de6bbe5ce133ec853392b2a4ce34c
      https://github.com/qemu/qemu/commit/995ee2bf469de6bbe5ce133ec853392b2a4ce34c
  Author: Hitoshi Mitake &lt;h.mitake@gmail.com&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M os-posix.c
    M qemu-os-posix.h
    M qemu-os-win32.h
    M vl.c

  Log Message:
  -----------
  curses: don't initialize curses when qemu is daemonized

Current qemu initializes curses even if -daemonize option is
passed. This cause problem because shell prompt appears without
calling endwin().

This patch adds new function, is_daemonized(), to OS dependent
code. With this function, curses_display_init() can check that qemu is
daemonized or not. If daemonized, curses_display_init() isn't called
and the problem is avoided.

Of course, -daemonize &amp;&amp; -curses doesn't make sense. Users shouldn't
pass the arguments at the same time. But the problem is very painful
because Ctrl-C cannot be delivered to the terminal.

Cc: Andrzej Zaborowski  &lt;balrog@zabor.org&gt;
Cc: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;
Cc: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Cc: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Signed-off-by: Hitoshi Mitake &lt;h.mitake@gmail.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: c10600af60865ba6c60987be313102ebb5fcee57
      https://github.com/qemu/qemu/commit/c10600af60865ba6c60987be313102ebb5fcee57
  Author: Laszlo Ersek &lt;lersek@redhat.com&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M console.c

  Log Message:
  -----------
  TextConsole: saturate escape parameter in TTY_STATE_CSI

Signed-off-by: Laszlo Ersek &lt;lersek@redhat.com&gt;
Reviewed-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: 144b97c26cdef7fecd62dae2db6ce312cd493751
      https://github.com/qemu/qemu/commit/144b97c26cdef7fecd62dae2db6ce312cd493751
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M qemu-timer.c

  Log Message:
  -----------
  qemu-timer: simplify qemu_run_timers

ptimer_head is an invariant pointer to clock-&gt;active_timers.
Remove it, and just reference clock-&gt;active_timers directly.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: ad11ad77748bdd8016370db210751683dc038dd6
      https://github.com/qemu/qemu/commit/ad11ad77748bdd8016370db210751683dc038dd6
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M linux-user/syscall.c

  Log Message:
  -----------
  linux-user: Remove redundant null check and replace free by g_free

Report from smatch:

linux-user/syscall.c:3632 do_ioctl_dm(220) info:
 redundant null check on big_buf calling free()

'big_buf' was allocated by g_malloc0, therefore free was also
replaced by g_free.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: 73062dfe6be0050dbd43ce3516e935ebb2545add
      https://github.com/qemu/qemu/commit/73062dfe6be0050dbd43ce3516e935ebb2545add
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M net/socket.c
    M qemu-common.h

  Log Message:
  -----------
  net/socket: Fix compiler warning (regression for MinGW)

Commit 213fd5087e2e4e2da10ad266df0ba950cf7618bf removed a type cast
which is needed for MinGW:

net/socket.c:136: warning:
 pointer targets in passing argument 2 of âsendto' differ in signedness
/usr/lib/gcc/amd64-mingw32msvc/4.4.4/../../../../amd64-mingw32msvc/include/winsock2.h:1313: note:
 expected âconst char *' but argument is of type âconst uint8_t *'

Add a 'qemu_sendto' macro which provides that type cast where needed
and use the new macro instead of 'sendto'.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: 95df51a4a02a853af8828c281bce2d4f2a41d6fd
      https://github.com/qemu/qemu/commit/95df51a4a02a853af8828c281bce2d4f2a41d6fd
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-22 (Sat, 22 Sep 2012)

  Changed paths:
    M compiler.h

  Log Message:
  -----------
  w32: Always use standard instead of native format strings

GLib 2.0 include files use __printf__ for the format attribute
which resolves to native format strings on w32 hosts.

QEMU wants standard format strings instead of native format
strings, so we simply change any declaration with __printf__
to use __gnu_printf__.

This works because all basic printf functions support both
kinds of format strings.

This fixes a compiler warning:

qapi/string-output-visitor.c: In function âprint_type_int':
qapi/string-output-visitor.c:34:5: warning: unknown conversion type character âl' in format [-Wformat]
qapi/string-output-visitor.c:34:5: warning: too many arguments for format [-Wformat-extra-args]

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@gmail.com&gt;


  Commit: 80dd1aae3657a902d262f5d20a7a3c655b23705e
      https://github.com/qemu/qemu/commit/80dd1aae3657a902d262f5d20a7a3c655b23705e
  Author: Kevin Shanahan &lt;kmshanah@disenchant.net&gt;
  Date:   2012-09-24 (Mon, 24 Sep 2012)

  Changed paths:
    M blockdev.c

  Log Message:
  -----------
  blockdev: preserve readonly and snapshot states across media changes

If readonly=on is given at device creation time, the -&gt;readonly flag
needs to be set in the block driver state for this device so that
readonly-ness is preserved across media changes (qmp change command).
Similarly, to preserve the snapshot property requires -&gt;open_flags to
be correct.

Signed-off-by: Kevin Shanahan &lt;kmshanah@disenchant.net&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: be028adcedd68ca4d78fdc43e7e2fa4f1cdbc653
      https://github.com/qemu/qemu/commit/be028adcedd68ca4d78fdc43e7e2fa4f1cdbc653
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-24 (Mon, 24 Sep 2012)

  Changed paths:
    M block.c
    M block.h

  Log Message:
  -----------
  block: correctly set the keep_read_only flag

I believe the bs-&gt;keep_read_only flag is supposed to reflect
the initial open state of the device. If the device is initially
opened R/O, then commit operations, or reopen operations changing
to R/W, are prohibited.

Currently, the keep_read_only flag is only accurate for the active
layer, and its backing file. Subsequent images end up always having
the keep_read_only flag set.

For instance, what happens now:

[  base  ]  kro = 1, ro = 1
    |
    v
[ snap-1 ]  kro = 1, ro = 1
    |
    v
[ snap-2 ]  kro = 0, ro = 1
    |
    v
[ active ]  kro = 0, ro = 0

What we want:

[  base  ]  kro = 0, ro = 1
    |
    v
[ snap-1 ]  kro = 0, ro = 1
    |
    v
[ snap-2 ]  kro = 0, ro = 1
    |
    v
[ active ]  kro = 0, ro = 0

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 55b110f24ec765a09cfb7f4c013fcd90dd807628
      https://github.com/qemu/qemu/commit/55b110f24ec765a09cfb7f4c013fcd90dd807628
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-24 (Mon, 24 Sep 2012)

  Changed paths:
    M block.c

  Log Message:
  -----------
  block: make bdrv_set_enable_write_cache() modify open_flags

bdrv_set_enable_write_cache() sets the bs-&gt;enable_write_cache flag,
but without the flag recorded in bs-&gt;open_flags, then next time
a reopen() is performed the enable_write_cache setting may be
inadvertently lost.

This will set the flag in open_flags, so it is preserved across
reopens.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: e971aa12739f269d6fbfaeabdd4acaeb0f15960b
      https://github.com/qemu/qemu/commit/e971aa12739f269d6fbfaeabdd4acaeb0f15960b
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-24 (Mon, 24 Sep 2012)

  Changed paths:
    M block.c
    M block.h
    M block_int.h

  Log Message:
  -----------
  block: Framework for reopening files safely

This is based on Supriya Kannery's bdrv_reopen() patch series.

This provides a transactional method to reopen multiple
images files safely.

Image files are queue for reopen via bdrv_reopen_queue(), and the
reopen occurs when bdrv_reopen_multiple() is called.  Changes are
staged in bdrv_reopen_prepare() and in the equivalent driver level
functions.  If any of the staged images fails a prepare, then all
of the images left untouched, and the staged changes for each image
abandoned.

Block drivers are passed a reopen state structure, that contains:
    * BDS to reopen
    * flags for the reopen
    * opaque pointer for any driver-specific data that needs to be
      persistent from _prepare to _commit/_abort
    * reopen queue pointer, if the driver needs to queue additional
      BDS for a reopen

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: fc32a72dc19a79f7e16156784b1e76a128d41841
      https://github.com/qemu/qemu/commit/fc32a72dc19a79f7e16156784b1e76a128d41841
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-24 (Mon, 24 Sep 2012)

  Changed paths:
    M block/raw-posix.c

  Log Message:
  -----------
  block: move aio initialization into a helper function

Move AIO initialization for raw-posix block driver into a helper function.

In addition to just code motion, the aio_ctx pointer is checked for NULL,
prior to calling laio_init(), to make sure laio_init() is only run once.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 6a8dc0422e508fc85390e55cbca1b93cb242d22d
      https://github.com/qemu/qemu/commit/6a8dc0422e508fc85390e55cbca1b93cb242d22d
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-24 (Mon, 24 Sep 2012)

  Changed paths:
    M block/raw-posix.c
    M block/raw-win32.c

  Log Message:
  -----------
  block: move open flag parsing in raw block drivers to helper functions

Code motion, to move parsing of open flags into a helper function.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 39c9fb9565613a5ca0ae6e83ea115585f91527bb
      https://github.com/qemu/qemu/commit/39c9fb9565613a5ca0ae6e83ea115585f91527bb
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-24 (Mon, 24 Sep 2012)

  Changed paths:
    M block/iscsi.c
    M block/raw-posix.c
    M block/raw-win32.c
    M block/rbd.c
    M block/sheepdog.c

  Log Message:
  -----------
  block: do not parse BDRV_O_CACHE_WB in block drivers

Block drivers should ignore BDRV_O_CACHE_WB in .bdrv_open flags,
and in the bs-&gt;open_flags.

This patch removes the code, leaving the behaviour behind as if
BDRV_O_CACHE_WB was set.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 9acc5a06d41416400dda0ae9495707236911e234
      https://github.com/qemu/qemu/commit/9acc5a06d41416400dda0ae9495707236911e234
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-24 (Mon, 24 Sep 2012)

  Changed paths:
    M block/raw-posix.c

  Log Message:
  -----------
  block: use BDRV_O_NOCACHE instead of s-&gt;aligned_buf in raw-posix.c

Rather than check for a non-NULL aligned_buf to determine if
raw_aio_submit needs to check for alignment, check for the presence
of BDRV_O_NOCACHE in the bs-&gt;open_flags.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 3d1807ac6707773526b193f296e72c6c86969bf7
      https://github.com/qemu/qemu/commit/3d1807ac6707773526b193f296e72c6c86969bf7
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-24 (Mon, 24 Sep 2012)

  Changed paths:
    M block/raw-posix.c

  Log Message:
  -----------
  block: purge s-&gt;aligned_buf and s-&gt;aligned_buf_size from raw-posix.c

The aligned_buf pointer and aligned_buf size are no longer used in
raw_posix.c, so remove all references to them.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: eeb6b45d48800e96f67ef2a5c80332557fd45ddb
      https://github.com/qemu/qemu/commit/eeb6b45d48800e96f67ef2a5c80332557fd45ddb
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-24 (Mon, 24 Sep 2012)

  Changed paths:
    M block/raw-posix.c

  Log Message:
  -----------
  block: raw-posix image file reopen

This is derived from the Supriya Kannery's reopen patches.

This contains the raw-posix driver changes for the bdrv_reopen_*
functions.  All changes are staged into a temporary scratch buffer
during the prepare() stage, and copied over to the live structure
during commit().  Upon abort(), all changes are abandoned, and the
live structures are unmodified.

The _prepare() will create an extra fd - either by means of a dup,
if possible, or opening a new fd if not (for instance, access
control changes).  Upon _commit(), the original fd is closed and
the new fd is used.  Upon _abort(), the duplicate/new fd is closed.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 01bdddb5aaf4f660355cf764874f19271978f74f
      https://github.com/qemu/qemu/commit/01bdddb5aaf4f660355cf764874f19271978f74f
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-24 (Mon, 24 Sep 2012)

  Changed paths:
    M block/raw.c

  Log Message:
  -----------
  block: raw image file reopen

These are the stubs for the file reopen drivers for the raw format.

There is currently nothing that needs to be done by the raw driver
in reopen.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: f9cb20f167ff205e37a895ee6a03d5a183ef8acf
      https://github.com/qemu/qemu/commit/f9cb20f167ff205e37a895ee6a03d5a183ef8acf
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-24 (Mon, 24 Sep 2012)

  Changed paths:
    M block/qed.c

  Log Message:
  -----------
  block: qed image file reopen

These are the stubs for the file reopen drivers for the qed format.

There is currently nothing that needs to be done by the qed driver
in reopen.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 21d82ac95f67947ebc32ada96184f00831a9b911
      https://github.com/qemu/qemu/commit/21d82ac95f67947ebc32ada96184f00831a9b911
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-24 (Mon, 24 Sep 2012)

  Changed paths:
    M block/qcow2.c

  Log Message:
  -----------
  block: qcow2 image file reopen

These are the stubs for the file reopen drivers for the qcow2 format.

There is currently nothing that needs to be done by the qcow2 driver
in reopen.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: d177692ede3129dcb18a6b0f5472577bed2e2688
      https://github.com/qemu/qemu/commit/d177692ede3129dcb18a6b0f5472577bed2e2688
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-24 (Mon, 24 Sep 2012)

  Changed paths:
    M block/qcow.c

  Log Message:
  -----------
  block: qcow image file reopen

These are the stubs for the file reopen drivers for the qcow format.

There is currently nothing that needs to be done by the qcow driver
in reopen.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 3897575f1cd96370a604be8cb5cf1e3fae2be0c1
      https://github.com/qemu/qemu/commit/3897575f1cd96370a604be8cb5cf1e3fae2be0c1
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-24 (Mon, 24 Sep 2012)

  Changed paths:
    M block/vmdk.c

  Log Message:
  -----------
  block: vmdk image file reopen

This patch supports reopen for VMDK image files.  VMDK extents are added
to the existing reopen queue, so that the transactional model of reopen
is maintained with multiple image files.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: ecfe2bbabbc25e08b21ae57d66e484ef64c4aefa
      https://github.com/qemu/qemu/commit/ecfe2bbabbc25e08b21ae57d66e484ef64c4aefa
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-24 (Mon, 24 Sep 2012)

  Changed paths:
    M block/vdi.c

  Log Message:
  -----------
  block: vdi image file reopen

There is currently nothing that needs to be done for VDI reopen.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 3fe4b70008f3a0323e1d685becc6a9cff2b71de7
      https://github.com/qemu/qemu/commit/3fe4b70008f3a0323e1d685becc6a9cff2b71de7
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-24 (Mon, 24 Sep 2012)

  Changed paths:
    M block/vpc.c

  Log Message:
  -----------
  block: vpc image file reopen

There is currently nothing that needs to be done for VPC image
file reopen.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 0bce597d6ec34b2af802799eb53ebc863c704d05
      https://github.com/qemu/qemu/commit/0bce597d6ec34b2af802799eb53ebc863c704d05
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-24 (Mon, 24 Sep 2012)

  Changed paths:
    M block.c

  Log Message:
  -----------
  block: convert bdrv_commit() to use bdrv_reopen()

Currently, bdrv_commit() reopens images r/w itself, via risky
_delete() and _open() calls. Use the new safe method for drive reopen.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: dc1c13d96912731d4c7c7e13d31c93b8735f1203
      https://github.com/qemu/qemu/commit/dc1c13d96912731d4c7c7e13d31c93b8735f1203
  Author: Jeff Cody &lt;jcody@redhat.com&gt;
  Date:   2012-09-24 (Mon, 24 Sep 2012)

  Changed paths:
    M block.c
    M block_int.h

  Log Message:
  -----------
  block: remove keep_read_only flag from BlockDriverState struct

The keep_read_only flag is no longer used, in favor of the bdrv
flag BDRV_O_ALLOW_RDWR.

Signed-off-by: Jeff Cody &lt;jcody@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 09d0726c0351cbf71b96b41b9f39cc7857b45ccc
      https://github.com/qemu/qemu/commit/09d0726c0351cbf71b96b41b9f39cc7857b45ccc
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M nbd.c
    M nbd.h
    M qemu-nbd.c

  Log Message:
  -----------
  Merge remote-tracking branch 'bonzini/nbd-next' into staging

* bonzini/nbd-next:
  nbd: add nbd_export_get_blockdev
  nbd: negotiate with named exports
  nbd: register named exports
  qemu-nbd: rewrite termination conditions to use a state machine
  nbd: add notification for closing an NBDExport
  nbd: track clients into NBDExport
  nbd: add reference counting to NBDExport
  nbd: do not leak nbd_trip coroutines when a connection is torn down
  nbd: make refcount interface public
  nbd: do not close BlockDriverState in nbd_export_close
  nbd: pass NBDClient to nbd_send_negotiate
  nbd: add more constants


  Commit: d352210aede32743c6e7a8987c99196d84ab5471
      https://github.com/qemu/qemu/commit/d352210aede32743c6e7a8987c99196d84ab5471
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M block/iscsi.c
    M hw/scsi-bus.c
    M hw/scsi-disk.c
    M hw/scsi.h

  Log Message:
  -----------
  Merge remote-tracking branch 'bonzini/scsi-next' into staging

* bonzini/scsi-next:
  SCSI: Standard INQUIRY data should report HiSup flag as set.
  scsi-disk: use scsi_data_cdb_length
  scsi: introduce scsi_cdb_length and scsi_data_cdb_length
  scsi-disk: fix check for out-of-range LBA
  scsi-disk: introduce check_lba_range
  iSCSI: We dont need to explicitely call qemu_notify_event() any more
  iSCSI: We need to support SG_IO also from iscsi_ioctl()


  Commit: 97fe81d3e8613be13754ff096c16b73010fd60ad
      https://github.com/qemu/qemu/commit/97fe81d3e8613be13754ff096c16b73010fd60ad
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M MAINTAINERS
    M Makefile
    M arch_init.c
    M cpus.c
    M linux-user/main.c
    R sysconfigs/target/cpus-x86_64.conf
    M target-alpha/translate.c
    M target-i386/cpu.c
    M target-i386/cpu.h

  Log Message:
  -----------
  Merge remote-tracking branch 'afaerber/qom-cpu' into staging

* afaerber/qom-cpu:
  target-alpha: Initialize env-&gt;cpu_model_str
  target-i386: Drop unused setscalar() macro
  target-i386: Kill cpudef config section support
  target-i386: x86_cpudef_setup() coding style change
  Eliminate cpus-x86_64.conf file
  target-i386: Move CPU models from cpus-x86_64.conf to C
  target-i386: Add missing CPUID_* constants
  Drop cpu_list_id macro
  target-i386: Fold -cpu ?cpuid, ?model output into -cpu help, drop ?dump
  MAINTAINERS: Add entry for QOM CPU


  Commit: 3988475b9b7fa251b00a29b076761d8c1c7e64dc
      https://github.com/qemu/qemu/commit/3988475b9b7fa251b00a29b076761d8c1c7e64dc
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M compiler.h
    M console.c
    M hw/cadence_uart.c
    M hw/ioh3420.c
    M hw/lm4549.c
    M hw/pflash_cfi01.c
    M linux-user/syscall.c
    M net/socket.c
    M os-posix.c
    M qemu-common.h
    M qemu-ga.c
    M qemu-os-posix.h
    M qemu-os-win32.h
    M qemu-sockets.c
    M qemu-timer.c
    M scripts/tracetool/backend/dtrace.py
    M target-i386/cpu.c
    M vl.c

  Log Message:
  -----------
  Merge remote-tracking branch 'stefanha/trivial-patches' into staging

* stefanha/trivial-patches:
  w32: Always use standard instead of native format strings
  net/socket: Fix compiler warning (regression for MinGW)
  linux-user: Remove redundant null check and replace free by g_free
  qemu-timer: simplify qemu_run_timers
  TextConsole: saturate escape parameter in TTY_STATE_CSI
  curses: don't initialize curses when qemu is daemonized
  dtrace backend: add function to reserved words
  pflash_cfi01: Fix warning caused by unreachable code
  ioh3420: Remove unreachable code
  lm4549: Fix buffer overflow
  cadence_uart: Fix buffer overflow
  qemu-sockets: Fix potential memory leak
  qemu-ga: Remove unreachable code after g_error
  target-i386: Allow tsc-frequency to be larger then 2.147G


  Commit: 444dbc381b94f5b54da521df61e751f28b00ce88
      https://github.com/qemu/qemu/commit/444dbc381b94f5b54da521df61e751f28b00ce88
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M block.c
    M block.h
    M block/iscsi.c
    M block/qcow.c
    M block/qcow2.c
    M block/qed.c
    M block/raw-posix.c
    M block/raw-win32.c
    M block/raw.c
    M block/rbd.c
    M block/sheepdog.c
    M block/vdi.c
    M block/vmdk.c
    M block/vpc.c
    M block_int.h
    M blockdev.c

  Log Message:
  -----------
  Merge remote-tracking branch 'kwolf/for-anthony' into staging

* kwolf/for-anthony:
  block: remove keep_read_only flag from BlockDriverState struct
  block: convert bdrv_commit() to use bdrv_reopen()
  block: vpc image file reopen
  block: vdi image file reopen
  block: vmdk image file reopen
  block: qcow image file reopen
  block: qcow2 image file reopen
  block: qed image file reopen
  block: raw image file reopen
  block: raw-posix image file reopen
  block: purge s-&gt;aligned_buf and s-&gt;aligned_buf_size from raw-posix.c
  block: use BDRV_O_NOCACHE instead of s-&gt;aligned_buf in raw-posix.c
  block: do not parse BDRV_O_CACHE_WB in block drivers
  block: move open flag parsing in raw block drivers to helper functions
  block: move aio initialization into a helper function
  block: Framework for reopening files safely
  block: make bdrv_set_enable_write_cache() modify open_flags
  block: correctly set the keep_read_only flag
  blockdev: preserve readonly and snapshot states across media changes


  Commit: d9b41bcda91ea7285d934a9c2333c49cd32d1ad3
      https://github.com/qemu/qemu/commit/d9b41bcda91ea7285d934a9c2333c49cd32d1ad3
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M tcg/README
    M tcg/i386/tcg-target.c
    M tcg/mips/tcg-target.c
    M tcg/mips/tcg-target.h
    M tcg/tcg-op.h
    M tcg/tcg.c
    M tcg/tcg.h

  Log Message:
  -----------
  Merge remote-tracking branch 'origin/master' into staging

* origin/master:
  tcg/i386: fix build with -march &lt; i686
  tcg: Streamline movcond_i64 using movcond_i32
  tcg: Streamline movcond_i64 using 32-bit arithmetic
  tcg: Sanity check goto_tb input
  tcg: Sanity check deposit inputs
  tcg: Add tcg_debug_assert
  tcg: Implement concat*_i64 with deposit_i64
  tcg: Emit XORI as NOT for appropriate constants
  tcg: Optimize initial inputs for ori_i64
  tcg: Emit ANDI as EXTU for appropriate constants
  tcg: Adjust descriptions of *cond opcodes
  tcg/mips: fix MIPS32(R2) detection


Compare: https://github.com/qemu/qemu/compare/f813cb838f19...d9b41bcda91e

----==_mimepart_50623e8cf1c81_256e1506ae478651--


</body></email><email><emailId>20120926130010</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-26 13:00:10-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] a9552c: Introduce powerdown_notifiers</subject><body>



----==_mimepart_5062fc5abe401_2a181649af0210362
Date: Wed, 26 Sep 2012 06:00:10 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5062fc5ac1a5d_2a181649af02104df@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: a9552c8edbd31bf75d42b561f0a592c00aff1038
      https://github.com/qemu/qemu/commit/a9552c8edbd31bf75d42b561f0a592c00aff1038
  Author: Igor Mammedov &lt;imammedo@redhat.com&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M sysemu.h
    M vl.c

  Log Message:
  -----------
  Introduce powerdown_notifiers

Notifier will be used for signaling powerdown request to guest in
a more general way and intended to replace very specific
qemu_irq_rise(qemu_system_powerdown) and will allow to remove global
variable qemu_system_powerdown.

Signed-off-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: d010f91c3ab97862c1d0a6a6b6832ed388fb6cd7
      https://github.com/qemu/qemu/commit/d010f91c3ab97862c1d0a6a6b6832ed388fb6cd7
  Author: Igor Mammedov &lt;imammedo@redhat.com&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M hw/acpi_piix4.c

  Log Message:
  -----------
  acpi: use notifier for signaling guest system_powerdown command

In addition, there is no need to allocate an extra irq just for
rising SCI in irq handler. Just rise SCI right from notifier
handler instead.

Signed-off-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: c72ddb1e4734ce021c3101b6b4f8ed02439c9e21
      https://github.com/qemu/qemu/commit/c72ddb1e4734ce021c3101b6b4f8ed02439c9e21
  Author: Igor Mammedov &lt;imammedo@redhat.com&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M hw/nseries.c

  Log Message:
  -----------
  target-arm: use notifier for signaling guest system_powerdown command

Acked-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: bea42280dad1e016225654a062b98bafe99e51fe
      https://github.com/qemu/qemu/commit/bea42280dad1e016225654a062b98bafe99e51fe
  Author: Igor Mammedov &lt;imammedo@redhat.com&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M hw/sun4m.c

  Log Message:
  -----------
  target-sparc: use notifier for signaling guest system_powerdown command

Signed-off-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 013c2f150f617d0e19ab487539df2234b2d4209b
      https://github.com/qemu/qemu/commit/013c2f150f617d0e19ab487539df2234b2d4209b
  Author: Igor Mammedov &lt;imammedo@redhat.com&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M sysemu.h
    M vl.c

  Log Message:
  -----------
  Cleanup unused global var qemu_system_powerdown

All deps that used global qemu_system_powerdown var are now converted
to notifiers, so remove it.

Signed-off-by: Igor Mammedov &lt;imammedo@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: f430694188293f99a316bfa375b7cc17d23a06ed
      https://github.com/qemu/qemu/commit/f430694188293f99a316bfa375b7cc17d23a06ed
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M hw/pc_piix.c

  Log Message:
  -----------
  add pc-1.3 machine type

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 183c5eaa41f7814ed4e83c16812c67a857eac6aa
      https://github.com/qemu/qemu/commit/183c5eaa41f7814ed4e83c16812c67a857eac6aa
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M hw/pc_piix.c

  Log Message:
  -----------
  compat: turn off msi/msix on xhci for old machine types

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: c08ba66f13d3977402e0c9cd6ef35323ea11c0d6
      https://github.com/qemu/qemu/commit/c08ba66f13d3977402e0c9cd6ef35323ea11c0d6
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M hw/ivshmem.c
    M hw/pc_piix.c

  Log Message:
  -----------
  ivshmem: add 64bit option

This patch adds a "use64" property which will make the ivshmem driver
register a 64bit memory bar when set, so you have something to play with
when testing 64bit pci bits.  It also allows to have quite big shared
memory regions, like this:

[root@fedora ~]# lspci -vs1:1
01:01.0 RAM memory: Red Hat, Inc Device 1110
  Subsystem: Red Hat, Inc Device 1100
  Physical Slot: 1-1
  Flags: fast devsel
  Memory at fd400000 (32-bit, non-prefetchable) [disabled] [size=256]
  Memory at 8040000000 (64-bit, prefetchable) [size=1G]

[ v5: rebase, update compat property for post-1.2 merge ]
[ v4: rebase &amp; adapt to latest master again ]
[ v3: rebase &amp; adapt to latest master ]
[ v2: default to on as suggested by avi,
      turn off for pc-$old using compat property ]

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Tested-by: Cam Macdonell &lt;cam@cs.ualberta.ca&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 8bdd3d499fe0ddffa9901c56ab3bc8911d5b8be0
      https://github.com/qemu/qemu/commit/8bdd3d499fe0ddffa9901c56ab3bc8911d5b8be0
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M Makefile
    M configure

  Log Message:
  -----------
  configure: Allow builds without any system or user emulation

The old code aborted configure when no emulation target was selected.
Even after removing the 'exit 1', it tried to read from STDIN
when QEMU was configured with

    configure' '--disable-user' '--disable-system'

This is fixed here.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 05bc1d8a4b2f77df8cc9880a552047e30c16f1f8
      https://github.com/qemu/qemu/commit/05bc1d8a4b2f77df8cc9880a552047e30c16f1f8
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M qemu-sockets.c

  Log Message:
  -----------
  Refactor inet_connect_opts function

refactor address resolution code to fix nonblocking connect
remove getnameinfo call

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Amos Kong &lt;akong@redhat.com&gt;
Signed-off-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 5db5f44cb4b7f24b9e0efdefc9015e36b7c34881
      https://github.com/qemu/qemu/commit/5db5f44cb4b7f24b9e0efdefc9015e36b7c34881
  Author: Orit Wasserman &lt;owasserm@redhat.com&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M migration-tcp.c
    M nbd.c
    M qemu-char.c
    M qemu-sockets.c
    M qemu_socket.h
    M ui/vnc.c

  Log Message:
  -----------
  Separate inet_connect into inet_connect (blocking) and inet_nonblocking_connect

No need to add non blocking parameters to the blocking inet_connect
add block parameter for inet_connect_opts instead of using QemuOpt "block".

Signed-off-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 233aa5c2d1cf4655ffe335025a68cf5454f87dad
      https://github.com/qemu/qemu/commit/233aa5c2d1cf4655ffe335025a68cf5454f87dad
  Author: Orit Wasserman &lt;owasserm@redhat.com&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M migration-tcp.c
    M qemu-char.c
    M qemu-sockets.c
    M qemu_socket.h

  Log Message:
  -----------
  Fix address handling in inet_nonblocking_connect

getaddrinfo can give us a list of addresses, but we only try to
connect to the first one. If that fails we never proceed to
the next one.  This is common on desktop setups that often have ipv6
configured but not actually working.

To fix this make inet_connect_nonblocking retry connection with a different
address.
callers on inet_nonblocking_connect register a callback function that will
be called when connect opertion completes, in case of failure the fd will have
a negative value

Signed-off-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 3202becaa2b805497ce9e6faa6edfb83665f91b1
      https://github.com/qemu/qemu/commit/3202becaa2b805497ce9e6faa6edfb83665f91b1
  Author: Orit Wasserman &lt;owasserm@redhat.com&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M migration.c

  Log Message:
  -----------
  Clear handler only for valid fd

Signed-off-by: Orit Wasserman &lt;owasserm@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: ac05f3492421caeb05809ffa02c6198ede179e43
      https://github.com/qemu/qemu/commit/ac05f3492421caeb05809ffa02c6198ede179e43
  Author: Amos Kong &lt;akong@redhat.com&gt;
  Date:   2012-09-25 (Tue, 25 Sep 2012)

  Changed paths:
    M hw/fw_cfg.c
    M qemu-config.c
    M qemu-options.hx
    M vl.c

  Log Message:
  -----------
  add a boot parameter to set reboot timeout

Added an option to let qemu transfer a configuration file to bios,
"etc/boot-fail-wait", which could be specified by command
    -boot reboot-timeout=T
T have a max value of 0xffff, unit is ms.

With this option, guest will wait for a given time if not find
bootabled device, then reboot. If reboot-timeout is '-1', guest
will not reboot, qemu passes '-1' to bios by default.

This feature need the new seabios's support.

Seabios pulls the value from the fwcfg "file" interface, this
interface is used because SeaBIOS needs a reliable way of
obtaining a name, value size, and value. It in no way requires
that there be a real file on the user's host machine.

Signed-off-by: Amos Kong &lt;akong@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/d9b41bcda91e...ac05f3492421

----==_mimepart_5062fc5abe401_2a181649af0210362--


</body></email><email><emailId>20120927193009</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-27 19:30:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 6673f4: tci: Fix for AREG0 free mode</subject><body>



----==_mimepart_5064a941ac7ac_543dde1ae8558b9
Date: Thu, 27 Sep 2012 12:30:09 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5064a941ae009_543dde1ae855992@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 6673f47da21718d07346b0f3725f0dbf0d6d8e45
      https://github.com/qemu/qemu/commit/6673f47da21718d07346b0f3725f0dbf0d6d8e45
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-09-27 (Thu, 27 Sep 2012)

  Changed paths:
    M tcg/tci/tcg-target.c
    M tci.c

  Log Message:
  -----------
  tci: Fix for AREG0 free mode

Support for helper functions with 5 arguments was missing
in the code generator and in the interpreter.

There is no need to pass the constant TCG_AREG0 from the
code generator to the interpreter. Remove that code for
the INDEX_op_qemu_st* opcodes.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;




----==_mimepart_5064a941ac7ac_543dde1ae8558b9--


</body></email><email><emailId>20120927200013</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-27 20:00:13-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 14c126: pl190: fix read of VECTADDR</subject><body>



----==_mimepart_5064b04d7264c_42131b70aec102617
Date: Thu, 27 Sep 2012 13:00:13 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5064b04d75ae8_42131b70aec10278f@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 14c126baf1c38607c5bd988878de85a06cefd8cf
      https://github.com/qemu/qemu/commit/14c126baf1c38607c5bd988878de85a06cefd8cf
  Author: Brendan Fennell &lt;bfennell@skynet.ie&gt;
  Date:   2012-09-26 (Wed, 26 Sep 2012)

  Changed paths:
    M hw/pl190.c

  Log Message:
  -----------
  pl190: fix read of VECTADDR

Reading VECTADDR was causing us to set the current priority to
the wrong value, the most obvious effect of which was that we
would return the vector for the wrong interrupt as the result
of the read.

Signed-off-by: Brendan Fennell &lt;bfennell@skynet.ie&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 9892cae39562d2e6c00ccc5966302c00f23be6d4
      https://github.com/qemu/qemu/commit/9892cae39562d2e6c00ccc5966302c00f23be6d4
  Author: Meador Inge &lt;meadori@codesourcery.com&gt;
  Date:   2012-09-26 (Wed, 26 Sep 2012)

  Changed paths:
    M hw/armv7m_nvic.c

  Log Message:
  -----------
  hw/armv7m_nvic: Correctly register GIC region when setting up NVIC

When setting up the NVIC memory regions the memory range
0x100..0xcff is aliased to an IO memory region that belongs
to the ARM GIC.  This aliased region should be added to the
NVIC memory container, but the actual GIC IO memory region
was being added instead.  This mixup was causing the wrong
IO memory access functions to be called when accessing parts
of the NVIC memory.

Signed-off-by: Meador Inge &lt;meadori@codesourcery.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 661bafb3e14bfffcb0a7c7910534c7944608ca45
      https://github.com/qemu/qemu/commit/661bafb3e14bfffcb0a7c7910534c7944608ca45
  Author: Francesco Lavra &lt;francescolavra.fl@gmail.com&gt;
  Date:   2012-09-26 (Wed, 26 Sep 2012)

  Changed paths:
    M hw/vexpress.c

  Log Message:
  -----------
  Versatile Express: Fix NOR flash 0 address and remove flash alias

In the A series memory map (implemented in the Cortex A15 CoreTile), the
first NOR flash bank (flash 0) is mapped to address 0x08000000, while
address 0x00000000 can be configured as alias to either the first or the
second flash bank. This patch fixes the definition of flash 0 address,
and for simplicity removes the alias definition.

Signed-off-by: Francesco Lavra &lt;francescolavra.fl@gmail.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 3dc3e7dd936f2e7f3e6dd4056f81c8961dc8201b
      https://github.com/qemu/qemu/commit/3dc3e7dd936f2e7f3e6dd4056f81c8961dc8201b
  Author: Francesco Lavra &lt;francescolavra.fl@gmail.com&gt;
  Date:   2012-09-26 (Wed, 26 Sep 2012)

  Changed paths:
    M hw/vexpress.c

  Log Message:
  -----------
  Versatile Express: Add modelling of NOR flash

This patch adds modelling of the two NOR flash banks found on the
Versatile Express motherboard. Tested with U-Boot running on an emulated
Versatile Express, with either A9 or A15 CoreTile.

Signed-off-by: Francesco Lavra &lt;francescolavra.fl@gmail.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: fdefe51c288866b98e62663fa18c8af1d66bf5f6
      https://github.com/qemu/qemu/commit/fdefe51c288866b98e62663fa18c8af1d66bf5f6
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-27 (Thu, 27 Sep 2012)

  Changed paths:
    M target-alpha/translate.c
    M target-arm/translate.c
    M target-cris/translate.c
    M target-i386/translate.c
    M target-lm32/translate.c
    M target-microblaze/translate.c
    M target-mips/translate.c
    M target-openrisc/translate.c
    M target-ppc/translate.c
    M target-sh4/translate.c
    M target-sparc/translate.c
    M target-xtensa/translate.c

  Log Message:
  -----------
  Emit debug_insn for CPU_LOG_TB_OP_OPT as well.

For all targets that currently call tcg_gen_debug_insn_start,
add CPU_LOG_TB_OP_OPT to the condition that gates it.

This is useful for comparing optimization dumps, when the
pre-optimization dump is merely noise.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: fa547e617c2f499903dccb8f1b9031bfe724e11e
      https://github.com/qemu/qemu/commit/fa547e617c2f499903dccb8f1b9031bfe724e11e
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-27 (Thu, 27 Sep 2012)

  Changed paths:
    M target-m68k/translate.c

  Log Message:
  -----------
  target-m68k: Call tcg_gen_debug_insn_start

Cc: Paul Brook &lt;paul@codesourcery.com&gt;
Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 7193b5f6f52d633531406771b9370d7b591cef88
      https://github.com/qemu/qemu/commit/7193b5f6f52d633531406771b9370d7b591cef88
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-27 (Thu, 27 Sep 2012)

  Changed paths:
    M target-s390x/translate.c

  Log Message:
  -----------
  target-s390x: Call tcg_gen_debug_insn_start

Cc: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: daa47c34a893917d712923b107d33f7b89a3a53b
      https://github.com/qemu/qemu/commit/daa47c34a893917d712923b107d33f7b89a3a53b
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-27 (Thu, 27 Sep 2012)

  Changed paths:
    M target-unicore32/translate.c

  Log Message:
  -----------
  target-unicore32: Call tcg_gen_debug_insn_start

Acked-by: Guan Xuetao &lt;gxt@mprc.pku.edu.cn&gt;
Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 0d404541b24b332f6a822139c6bd889b7e319762
      https://github.com/qemu/qemu/commit/0d404541b24b332f6a822139c6bd889b7e319762
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-27 (Thu, 27 Sep 2012)

  Changed paths:
    M target-s390x/helper.c
    M target-s390x/misc_helper.c

  Log Message:
  -----------
  target-s390x: Use CPU_LOG_INT

Three places in the interrupt code did we not honor the mask.

Reviewed-by: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 87a5395bdd75c22e8c9b92c5655810762a7fd5bf
      https://github.com/qemu/qemu/commit/87a5395bdd75c22e8c9b92c5655810762a7fd5bf
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-27 (Thu, 27 Sep 2012)

  Changed paths:
    M target-s390x/translate.c

  Log Message:
  -----------
  target-s390x: Avoid double CPU_LOG_TB_CPU

This is already handled generically in cpu_exec.

Reviewed-by: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: d885bdd481fc1c11d3158cc1c4c68bffdb2c26fe
      https://github.com/qemu/qemu/commit/d885bdd481fc1c11d3158cc1c4c68bffdb2c26fe
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-09-27 (Thu, 27 Sep 2012)

  Changed paths:
    M target-s390x/translate.c

  Log Message:
  -----------
  target-s390x: Tidy cpu_dump_state

The blank lines inside the single dump make it difficult for the
eye to pick out the block.  Worse, with interior newlines, but
no blank line following, the PSW line appears to belong to the
next dump block.

Reviewed-by: Alexander Graf &lt;agraf@suse.de&gt;
Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 6f8fd2530e9a530f237240daf1c981fa5df7f978
      https://github.com/qemu/qemu/commit/6f8fd2530e9a530f237240daf1c981fa5df7f978
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-09-27 (Thu, 27 Sep 2012)

  Changed paths:
    M hw/armv7m_nvic.c
    M hw/pl190.c
    M hw/vexpress.c

  Log Message:
  -----------
  Merge branch 'arm-devs.for-upstream' of git://git.linaro.org/people/pmaydell/qemu-arm

* 'arm-devs.for-upstream' of git://git.linaro.org/people/pmaydell/qemu-arm:
  Versatile Express: Add modelling of NOR flash
  Versatile Express: Fix NOR flash 0 address and remove flash alias
  hw/armv7m_nvic: Correctly register GIC region when setting up NVIC
  pl190: fix read of VECTADDR


Compare: https://github.com/qemu/qemu/compare/6673f47da217...6f8fd2530e9a

----==_mimepart_5064b04d7264c_42131b70aec102617--


</body></email><email><emailId>20120930123007</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-09-30 12:30:07-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] b1f467: i386: kvm: bit 10 of CPUID[8000_0001].EDX is reser...</subject><body>



----==_mimepart_50683b4fa3643_e6c1c49af46968e
Date: Sun, 30 Sep 2012 05:30:07 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50683b4fa55f4_e6c1c49af469763@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: b1f4679392a03f2b26a37bfa52e95d6cc4f73d82
      https://github.com/qemu/qemu/commit/b1f4679392a03f2b26a37bfa52e95d6cc4f73d82
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-09-30 (Sun, 30 Sep 2012)

  Changed paths:
    M target-i386/kvm.c

  Log Message:
  -----------
  i386: kvm: bit 10 of CPUID[8000_0001].EDX is reserved

Bit 10 of CPUID[8000_0001].EDX is not defined as an alias of
CPUID[1].EDX[10], so do not duplicate it on
kvm_arch_get_supported_cpuid().

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Reviewed-By: Igor Mammedov &lt;imammedo@redhat.com&gt;
Reviewed-by: Don Slutz &lt;Don@CloudSwitch.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 8fad4b44a0f71cd404f95f109657c0ccbf11f8f9
      https://github.com/qemu/qemu/commit/8fad4b44a0f71cd404f95f109657c0ccbf11f8f9
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-09-30 (Sun, 30 Sep 2012)

  Changed paths:
    M target-i386/cpu.h
    M target-i386/kvm.c

  Log Message:
  -----------
  i386: kvm: use a #define for the set of alias feature bits

Instea of using a hardcoded hex constant, define CPUID_EXT2_AMD_ALIASES
as the set of CPUID[8000_0001].EDX bits that on AMD are the same as the
bits of CPUID[1].EDX.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Reviewed-By: Igor Mammedov &lt;imammedo@redhat.com&gt;
Reviewed-by: Don Slutz &lt;Don@CloudSwitch.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 60032ac04c675cf8950497f9d06e681b2dc7085c
      https://github.com/qemu/qemu/commit/60032ac04c675cf8950497f9d06e681b2dc7085c
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-09-30 (Sun, 30 Sep 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  i386: cpu: replace EXT2_FEATURE_MASK with CPUID_EXT2_AMD_ALIASES

Both constants have the same value, but CPUID_EXT2_AMD_ALIASES is
defined without using magic numbers.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Reviewed-by: Don Slutz &lt;Don@CloudSwitch.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 3b671a40cab2404bc63e57db8cd3afa4ec70bfab
      https://github.com/qemu/qemu/commit/3b671a40cab2404bc63e57db8cd3afa4ec70bfab
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-09-30 (Sun, 30 Sep 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  i386: cpu: eliminate duplicate feature names

Instead of having duplicate feature names on the ext2_feature array for
the AMD feature bit aliases, we keep the feature names only on the
feature_name[] array, and copy the corresponding bits to
cpuid_ext2_features in case the CPU vendor is AMD.

This will:

- Make sure we don't set the feature bit aliases on Intel CPUs;
- Make it easier to convert feature bits to CPU properties, as now we
  have a single bit on the x86_def_t struct for each CPU feature.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Reviewed-by: Don Slutz &lt;Don@CloudSwitch.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 4a19e505df659dd25a77fb790399744f3e1f971c
      https://github.com/qemu/qemu/commit/4a19e505df659dd25a77fb790399744f3e1f971c
  Author: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
  Date:   2012-09-30 (Sun, 30 Sep 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  i386: -cpu help: remove reference to specific CPUID leaves/registers

The -cpu configuration interface is based on a list of feature names or
properties, on a single namespace, so there's no need to mention on
which CPUID leaf/register each flag is located.

Signed-off-by: Eduardo Habkost &lt;ehabkost@redhat.com&gt;
Reviewed-by: Don Slutz &lt;Don@CloudSwitch.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/6f8fd2530e9a...4a19e505df65

----==_mimepart_50683b4fa3643_e6c1c49af46968e--


</body></email><email><emailId>20120814193012</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-14 19:30:12-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] d3eb5e: x86: avoid AREG0 for FPU helpers</subject><body>



----==_mimepart_502aa7445fdef_5ed41708af423815
Date: Tue, 14 Aug 2012 12:30:12 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;502aa7446227c_5ed41708af423959@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: d3eb5eaeb56e48891bb98ab5f092f43e142e3f28
      https://github.com/qemu/qemu/commit/d3eb5eaeb56e48891bb98ab5f092f43e142e3f28
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M target-i386/Makefile.objs
    M target-i386/cpu.h
    M target-i386/fpu_helper.c
    M target-i386/helper.h
    M target-i386/mem_helper.c
    M target-i386/ops_sse.h
    M target-i386/ops_sse_header.h
    M target-i386/translate.c

  Log Message:
  -----------
  x86: avoid AREG0 for FPU helpers

Make FPU helpers take a parameter for CPUState instead
of relying on global env.

Introduce temporary wrappers for FPU load and store ops. Remove
wrappers for non-AREG0 code. Don't call unconverted helpers
directly.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: f0967a1add1e01df75607b9de5ef6cf83bfa0f82
      https://github.com/qemu/qemu/commit/f0967a1add1e01df75607b9de5ef6cf83bfa0f82
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M target-i386/Makefile.objs
    M target-i386/cc_helper.c
    M target-i386/cc_helper_template.h
    M target-i386/helper.h
    M target-i386/int_helper.c
    M target-i386/mem_helper.c
    M target-i386/misc_helper.c
    M target-i386/seg_helper.c
    M target-i386/shift_helper_template.h
    M target-i386/translate.c

  Log Message:
  -----------
  x86: avoid AREG0 for condition code helpers

Add an explicit CPUX86State parameter instead of relying on AREG0.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 7923057bae23e44f75a52ce3735c3bd5d55872c1
      https://github.com/qemu/qemu/commit/7923057bae23e44f75a52ce3735c3bd5d55872c1
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M target-i386/Makefile.objs
    M target-i386/helper.h
    M target-i386/int_helper.c
    M target-i386/shift_helper_template.h
    M target-i386/translate.c

  Log Message:
  -----------
  x86: avoid AREG0 for integer helpers

Add an explicit CPUX86State parameter instead of relying on AREG0.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 052e80d5e026a5414a02d5d979c37521eb33e07d
      https://github.com/qemu/qemu/commit/052e80d5e026a5414a02d5d979c37521eb33e07d
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M target-i386/Makefile.objs
    M target-i386/helper.h
    M target-i386/svm_helper.c
    M target-i386/translate.c

  Log Message:
  -----------
  x86: avoid AREG0 for SVM helpers

Add an explicit CPUX86State parameter instead of relying on AREG0.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 608badfc660b1c4d20e67a64b639c7bcd2d5ba16
      https://github.com/qemu/qemu/commit/608badfc660b1c4d20e67a64b639c7bcd2d5ba16
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M target-i386/Makefile.objs
    M target-i386/helper.h
    M target-i386/smm_helper.c
    M target-i386/translate.c

  Log Message:
  -----------
  x86: avoid AREG0 for SMM helpers

Add an explicit CPUX86State parameter instead of relying on AREG0.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 329e607d8efc77553b1bbf5059045301e50c32c8
      https://github.com/qemu/qemu/commit/329e607d8efc77553b1bbf5059045301e50c32c8
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M target-i386/cpu.h
    M target-i386/mem_helper.c
    M target-i386/seg_helper.c

  Log Message:
  -----------
  x86: use wrappers for memory access helpers

Switch to wrapped versions of memory access functions.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 4a7443be520f5737009ea47f93e4aa0328eecbca
      https://github.com/qemu/qemu/commit/4a7443be520f5737009ea47f93e4aa0328eecbca
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M target-i386/Makefile.objs
    M target-i386/helper.h
    M target-i386/misc_helper.c
    M target-i386/translate.c

  Log Message:
  -----------
  x86: avoid AREG0 for misc helpers

Add an explicit CPUX86State parameter instead of relying on AREG0.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 2999a0b20074a7e4a58f56572bb1436749368f59
      https://github.com/qemu/qemu/commit/2999a0b20074a7e4a58f56572bb1436749368f59
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M target-i386/Makefile.objs
    M target-i386/helper.h
    M target-i386/seg_helper.c
    M target-i386/translate.c

  Log Message:
  -----------
  x86: avoid AREG0 in segmentation helpers

Add an explicit CPUX86State parameter instead of relying on AREG0.

Rename remains of op_helper.c to seg_helper.c.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: 92fc4b586f8856ee9f2bad31fb6e9acd80fa8319
      https://github.com/qemu/qemu/commit/92fc4b586f8856ee9f2bad31fb6e9acd80fa8319
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M configure
    M cpu-all.h
    M target-i386/Makefile.objs
    M target-i386/cpu.h
    M target-i386/fpu_helper.c
    M target-i386/helper.h
    M target-i386/mem_helper.c
    M target-i386/misc_helper.c
    M target-i386/seg_helper.c
    M target-i386/svm_helper.c
    M target-i386/translate.c

  Log Message:
  -----------
  x86: switch to AREG0 free mode

Add an explicit CPUX86State parameter instead of relying on AREG0.

Remove temporary wrappers and switch to AREG0 free mode.

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/633decd71119...92fc4b586f88

----==_mimepart_502aa7445fdef_5ed41708af423815--


</body></email><email><emailId>20120814200011</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-14 20:00:11-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] c8b0bf: linux-user: Fix incorrect TARGET_BLKBSZGET, TARGET...</subject><body>



----==_mimepart_502aae4b7bc50_5eea1835ae42946f
Date: Tue, 14 Aug 2012 13:00:11 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;502aae4b7ea2e_5eea1835ae429578@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: c8b0bf545631b55f9e8288252a7b026a97872dd3
      https://github.com/qemu/qemu/commit/c8b0bf545631b55f9e8288252a7b026a97872dd3
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M linux-user/syscall_defs.h

  Log Message:
  -----------
  linux-user: Fix incorrect TARGET_BLKBSZGET, TARGET_BLKBSZSET

The definitions for the ioctl numbers TARGET_BLKBSZGET and
TARGET_BLKBSZSET had the wrong size parameters (they are defined
with size_t, not int, even though the ioctl implementations themselves
read and write integers). Since commit 354a0008 we now have an
ioctl wrapper definition for BLKBSZGET and so on an x86-64-to-x86-64
linux-user binary we were triggering the mismatch warning in
syscall_init().

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 5f72307d90a00caabdf786d940418f810bd7c095
      https://github.com/qemu/qemu/commit/5f72307d90a00caabdf786d940418f810bd7c095
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M linux-user/ioctls.h
    M linux-user/syscall_defs.h
    M linux-user/syscall_types.h

  Log Message:
  -----------
  linux-user: Fix SNDCTL_DSP_MAP{IN, OUT}BUF ioctl definitions

Fix the SNDCTL_DSP_MAP{IN,OUT}BUF ioctl definitions so that they
refer to a suitably defined target struct layout rather than hardcoding
the ioctl number. This fixes complaints from the syscall_init()
consistency check when running an x86_64-to-x86_64 linux-user qemu.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: dd6e957a142d9582df766b5c6de2fbb6773241f2
      https://github.com/qemu/qemu/commit/dd6e957a142d9582df766b5c6de2fbb6773241f2
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-13 (Mon, 13 Aug 2012)

  Changed paths:
    M linux-user/syscall.c

  Log Message:
  -----------
  linux-user: Move target_to_host_errno_table[] setup out of ioctl loop

The code to initialise the target_to_host_errno_table[] array was
accidentally inside the loop through checking and initialising all
the supported ioctls. This was harmless but meant that we reinitialised the
array several hundred times on startup.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: ca6190673c90e283897740b243f6508055c9de5a
      https://github.com/qemu/qemu/commit/ca6190673c90e283897740b243f6508055c9de5a
  Author: Jing Huang &lt;jing.huang.pku@gmail.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M linux-user/syscall.c

  Log Message:
  -----------
  linux-user: pass sockaddr from host to target

Signed-off-by: Jing Huang &lt;jing.huang.pku@gmail.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 920394db819e30fbbfa527f25e45360061d1a220
      https://github.com/qemu/qemu/commit/920394db819e30fbbfa527f25e45360061d1a220
  Author: Jing Huang &lt;jing.huang.pku@gmail.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M linux-user/syscall.c

  Log Message:
  -----------
  linux-user: make do_setsockopt support SOL_RAW ICMP_FILTER socket option

Signed-off-by: Jing Huang &lt;jing.huang.pku@gmail.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: aebf5bc727fa1837b3c5296c5325b560f19ed9ee
      https://github.com/qemu/qemu/commit/aebf5bc727fa1837b3c5296c5325b560f19ed9ee
  Author: Jing Huang &lt;jing.huang.pku@gmail.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M linux-user/syscall.c

  Log Message:
  -----------
  linux-user: make host_to_target_cmsg support SO_TIMESTAMP cmsg_type

Signed-off-by: Jing Huang &lt;jing.huang.pku@gmail.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: cd8e407d24657569e0d6e323b2e8c274fafab590
      https://github.com/qemu/qemu/commit/cd8e407d24657569e0d6e323b2e8c274fafab590
  Author: Mike Frysinger &lt;vapier@gentoo.org&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M linux-user/flatload.c

  Log Message:
  -----------
  flatload: fix bss clearing

The current bss clear logic assumes the target mmap address and host
address are the same.  Use g2h to translate from the target address
space to the host so we can call memset on it.

Signed-off-by: Mike Frysinger &lt;vapier@gentoo.org&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: dce104013d1b393d39a89c4417d7771d928c08f3
      https://github.com/qemu/qemu/commit/dce104013d1b393d39a89c4417d7771d928c08f3
  Author: Meador Inge &lt;meadori@codesourcery.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M linux-user/elfload.c
    M linux-user/qemu.h

  Log Message:
  -----------
  linux-user: Factor out guest space probing into a function

Signed-off-by: Meador Inge &lt;meadori@codesourcery.com&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 806d102141b99d4f1e55a97d68b7ea8c8ba3129f
      https://github.com/qemu/qemu/commit/806d102141b99d4f1e55a97d68b7ea8c8ba3129f
  Author: Meador Inge &lt;meadori@codesourcery.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M linux-user/elfload.c
    M linux-user/main.c
    M linux-user/qemu.h

  Log Message:
  -----------
  linux-user: Use init_guest_space when -R and -B are specified

Roll the code used to initialize the guest memory space when -R
or -B is used into 'init_guest_space' and then call 'init_guest_space'
from the driver.  This way the reserved guest memory space can
be probed for.  Calling 'mmap' just once as is currently done is not
guaranteed to succeed since the host address space validation might fail.

Signed-off-by: Meador Inge &lt;meadori@codesourcery.com&gt;
[PMM: Fixed minor whitespace errors.]
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 3a1363acf9648bc26989b01b87c7c3c494df2138
      https://github.com/qemu/qemu/commit/3a1363acf9648bc26989b01b87c7c3c494df2138
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M linux-user/main.c

  Log Message:
  -----------
  linux-user: ARM: Ignore immediate value for svc in thumb mode

When running in thumb mode, Linux doesn't evaluate the immediate value
of the svc instruction, but instead just always assumes the syscall number
to be in r7.

This fixes executing go_bootstrap while building go for me.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


  Commit: 873359d411eeb380906761e46839a2b705dbcf75
      https://github.com/qemu/qemu/commit/873359d411eeb380906761e46839a2b705dbcf75
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M linux-user/elfload.c
    M linux-user/flatload.c
    M linux-user/ioctls.h
    M linux-user/main.c
    M linux-user/qemu.h
    M linux-user/syscall.c
    M linux-user/syscall_defs.h
    M linux-user/syscall_types.h

  Log Message:
  -----------
  Merge branch 'linux-user.next' of git://git.linaro.org/people/pmaydell/qemu-arm

* 'linux-user.next' of git://git.linaro.org/people/pmaydell/qemu-arm:
  linux-user: ARM: Ignore immediate value for svc in thumb mode
  linux-user: Use init_guest_space when -R and -B are specified
  linux-user: Factor out guest space probing into a function
  flatload: fix bss clearing
  linux-user: make host_to_target_cmsg support SO_TIMESTAMP cmsg_type
  linux-user: make do_setsockopt support SOL_RAW ICMP_FILTER socket option
  linux-user: pass sockaddr from host to target
  linux-user: Move target_to_host_errno_table[] setup out of ioctl loop
  linux-user: Fix SNDCTL_DSP_MAP{IN, OUT}BUF ioctl definitions
  linux-user: Fix incorrect TARGET_BLKBSZGET, TARGET_BLKBSZSET


Compare: https://github.com/qemu/qemu/compare/92fc4b586f88...873359d411ee

----==_mimepart_502aae4b7bc50_5eea1835ae42946f--


</body></email><email><emailId>20120814230010</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-14 23:00:10-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 01afda: update seabios to latest master</subject><body>



----==_mimepart_502ad87a5473_4d8b1127af489587
Date: Tue, 14 Aug 2012 16:00:10 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;502ad87a7212_4d8b1127af48966e@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 01afdadc92e71e29700e64f3a5f42c1c543e3cf9
      https://github.com/qemu/qemu/commit/01afdadc92e71e29700e64f3a5f42c1c543e3cf9
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-08-07 (Tue, 07 Aug 2012)

  Changed paths:
    M pc-bios/bios.bin
    M roms/seabios

  Log Message:
  -----------
  update seabios to latest master

Upstream seabios commit 5a023065388287e261ae9212452ff541f9fa9cd3

Major changes since 1.7.0:
 - Usual share of bugfixes and cleanups ;)
 - Support for 64bit PCI bars and mapping those above 4G.
 - Stack switching for real mode irq handlers to reduce
   seabios stack footprint.
 - Support for booting from lsi scsi hba.
 - Support for booting from usb attached scsi.
 - Support for non-linear apic ids.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 2f00463fa67d42864a747fc5b85f1db8bf5556ce
      https://github.com/qemu/qemu/commit/2f00463fa67d42864a747fc5b85f1db8bf5556ce
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M MAINTAINERS

  Log Message:
  -----------
  MAINTAINERS: Update email address for Stefan Hajnoczi

Switch to my personal email address.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 28a9a00e95f935542512e3e682c073617c741bef
      https://github.com/qemu/qemu/commit/28a9a00e95f935542512e3e682c073617c741bef
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M pc-bios/bios.bin
    M roms/seabios

  Log Message:
  -----------
  Merge remote-tracking branch 'kraxel/seabios-5a02306' into staging

* kraxel/seabios-5a02306:
  update seabios to latest master


  Commit: 03834e22abafbc8dc4052d46a5ccd6dd135a54a3
      https://github.com/qemu/qemu/commit/03834e22abafbc8dc4052d46a5ccd6dd135a54a3
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M configure
    M cpu-all.h
    M linux-user/elfload.c
    M linux-user/flatload.c
    M linux-user/ioctls.h
    M linux-user/main.c
    M linux-user/qemu.h
    M linux-user/syscall.c
    M linux-user/syscall_defs.h
    M linux-user/syscall_types.h
    M target-i386/Makefile.objs
    M target-i386/cc_helper.c
    M target-i386/cc_helper_template.h
    M target-i386/fpu_helper.c
    M target-i386/helper.h
    M target-i386/int_helper.c
    M target-i386/mem_helper.c
    M target-i386/misc_helper.c
    M target-i386/ops_sse.h
    M target-i386/ops_sse_header.h
    M target-i386/seg_helper.c
    M target-i386/shift_helper_template.h
    M target-i386/smm_helper.c
    M target-i386/svm_helper.c
    M target-i386/translate.c

  Log Message:
  -----------
  Merge remote-tracking branch 'origin/master' into staging

* origin/master:
  linux-user: ARM: Ignore immediate value for svc in thumb mode
  linux-user: Use init_guest_space when -R and -B are specified
  linux-user: Factor out guest space probing into a function
  flatload: fix bss clearing
  linux-user: make host_to_target_cmsg support SO_TIMESTAMP cmsg_type
  linux-user: make do_setsockopt support SOL_RAW ICMP_FILTER socket option
  linux-user: pass sockaddr from host to target
  x86: switch to AREG0 free mode
  x86: avoid AREG0 in segmentation helpers
  x86: avoid AREG0 for misc helpers
  x86: use wrappers for memory access helpers
  x86: avoid AREG0 for SMM helpers
  x86: avoid AREG0 for SVM helpers
  x86: avoid AREG0 for integer helpers
  x86: avoid AREG0 for condition code helpers
  x86: avoid AREG0 for FPU helpers
  linux-user: Move target_to_host_errno_table[] setup out of ioctl loop
  linux-user: Fix SNDCTL_DSP_MAP{IN, OUT}BUF ioctl definitions
  linux-user: Fix incorrect TARGET_BLKBSZGET, TARGET_BLKBSZSET


Compare: https://github.com/qemu/qemu/compare/873359d411ee...03834e22abaf

----==_mimepart_502ad87a5473_4d8b1127af489587--


</body></email><email><emailId>20120815200014</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-15 20:00:14-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 8ae601: trace: rename TraceRecordHeader to TraceLogHeader</subject><body>



----==_mimepart_502bffce5a3a6_71d312eeaf479268
Date: Wed, 15 Aug 2012 13:00:14 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;502bffce5ec82_71d312eeaf4793af@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 8ae601e8fedbbc9b1a1514796bb608e942660bd9
      https://github.com/qemu/qemu/commit/8ae601e8fedbbc9b1a1514796bb608e942660bd9
  Author: Harsh Prateek Bora &lt;harsh@linux.vnet.ibm.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M trace/simple.c

  Log Message:
  -----------
  trace: rename TraceRecordHeader to TraceLogHeader

The TraceRecordHeader is really the header for the entire trace log
file.  It's not per-record header so make this obvious by renaming it.

Signed-off-by: Harsh Prateek Bora &lt;harsh@linux.vnet.ibm.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 83d35d3e9909614e952021a92dbb39421977affc
      https://github.com/qemu/qemu/commit/83d35d3e9909614e952021a92dbb39421977affc
  Author: Harsh Prateek Bora &lt;harsh@linux.vnet.ibm.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M trace/simple.c

  Log Message:
  -----------
  trace: remove unnecessary write_to_buffer() typecasting

The buffer argument is void* so it is not necessary to cast.

Signed-off-by: Harsh Prateek Bora &lt;harsh@linux.vnet.ibm.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: fd82f015a1cc2df5972f06b75b350f65da68f9cf
      https://github.com/qemu/qemu/commit/fd82f015a1cc2df5972f06b75b350f65da68f9cf
  Author: Harsh Prateek Bora &lt;harsh@linux.vnet.ibm.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M trace/simple.c
    M trace/simple.h

  Log Message:
  -----------
  trace: drop unused TraceBufferRecord-&gt;next_tbuf_idx field

Signed-off-by: Harsh Prateek Bora &lt;harsh@linux.vnet.ibm.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: db8894f2090629a2e12b1e7324c4c5c53367e048
      https://github.com/qemu/qemu/commit/db8894f2090629a2e12b1e7324c4c5c53367e048
  Author: Harsh Prateek Bora &lt;harsh@linux.vnet.ibm.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M trace/simple.c

  Log Message:
  -----------
  trace: avoid pointer aliasing in trace_record_finish()

Declaring a TraceRecord on the stack works fine.  No need for a
uint8_t array and pointer aliasing.

Signed-off-by: Harsh Prateek Bora &lt;harsh@linux.vnet.ibm.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 964d0a7b2bab935d48d3b2c4d6ab9b0efc74ce8b
      https://github.com/qemu/qemu/commit/964d0a7b2bab935d48d3b2c4d6ab9b0efc74ce8b
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M scripts/tracetool/backend/simple.py

  Log Message:
  -----------
  trace/simple: Fix compiler warning for 32 bit hosts

gcc complains when a 32 bit pointer is casted to a 64 bit integer.

Cc: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 4552e41025af4694c55854448c3ae4d95e72c7f6
      https://github.com/qemu/qemu/commit/4552e41025af4694c55854448c3ae4d95e72c7f6
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M trace/simple.c

  Log Message:
  -----------
  trace/simple: Replace asprintf by g_strdup_printf

asprintf is not available for all hosts. g_strdup_printf is
more portable and simplifies the code because if does not
need error handling.

The static variable does not need an explicit assignment to be NULL.

Cc: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 205df4d1a87cbb14a50655fb2c0a987467fb29d6
      https://github.com/qemu/qemu/commit/205df4d1a87cbb14a50655fb2c0a987467fb29d6
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M hw/kvm/i8254.c

  Log Message:
  -----------
  kvm: i8254: Cache kernel clock offset in KVMPITState

To prepare the final fix for clock calibration issues with the in-kernel
PIT, we want to cache the offset between vmclock and the clock used by
the in-kernel PIT. So far, we only need to update it when the VM state
changes between running and stopped because we only read the in-kernel
PIT state while the VM is running.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 050a46065de8e3d4ee5a04f5598d666f63d34800
      https://github.com/qemu/qemu/commit/050a46065de8e3d4ee5a04f5598d666f63d34800
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M hw/kvm/i8254.c

  Log Message:
  -----------
  kvm: i8254: Finish time conversion fix

0cdd3d1444 fixed reading back the counter load time from the kernel
while assuming the kernel would always update its load time on writing
the state. That is only true for channel 1, and so pit_get_channel_info
returned wrong output pin states for high counter values.

Fix this by applying the offset also on kvm_pit_put. Now we also need to
update the offset when we write the state while the VM is stopped as it
keeps on changing in that state.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: a9605e0317c7a6d5e68f3a3b6708c8ef1096f4bc
      https://github.com/qemu/qemu/commit/a9605e0317c7a6d5e68f3a3b6708c8ef1096f4bc
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M hw/apic_common.c

  Log Message:
  -----------
  kvmvapic: Disable if there is insufficient memory

We need at least 1M of RAM to map the option ROM. Otherwise, we will
corrupt host memory or even crash:

    $ qemu-system-x86_64 -nodefaults --enable-kvm -vnc :0 -m 640k
    Segmentation fault (core dumped)

Reported-and-tested-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 256d046ca70788e4cb3aad56cda64ad81f19b7cd
      https://github.com/qemu/qemu/commit/256d046ca70788e4cb3aad56cda64ad81f19b7cd
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-14 (Tue, 14 Aug 2012)

  Changed paths:
    M scripts/update-linux-headers.sh

  Log Message:
  -----------
  update-linux-headers.sh: Pull in asm-generic/kvm_para.h

Add asm-generic/kvm_para.h to the set of non-architecture specific
KVM kernel headers we copy into QEMU. This header may be included
by an architecture's kvm_para.h header.

Reviewed-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Marcelo Tosatti &lt;mtosatti@redhat.com&gt;


  Commit: 06138651f3347a4ad7527d48b1ccbeae89f9e7f6
      https://github.com/qemu/qemu/commit/06138651f3347a4ad7527d48b1ccbeae89f9e7f6
  Author: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M qemu-char.c

  Log Message:
  -----------
  qemu-char: Add MSG_CMSG_CLOEXEC flag to recvmsg

Set the close-on-exec flag for the file descriptor received
via SCM_RIGHTS.

Signed-off-by: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: ba1c048a8f9c4a62812a8735ebd4fde0cfd086e8
      https://github.com/qemu/qemu/commit/ba1c048a8f9c4a62812a8735ebd4fde0cfd086e8
  Author: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M monitor.c
    M qapi-schema.json
    M qmp-commands.hx

  Log Message:
  -----------
  qapi: Introduce add-fd, remove-fd, query-fdsets

This patch adds support that enables passing of file descriptors
to the QEMU monitor where they will be stored in specified file
descriptor sets.

A file descriptor set can be used by a client like libvirt to
store file descriptors for the same file.  This allows the
client to open a file with different access modes (O_RDWR,
O_WRONLY, O_RDONLY) and add/remove the passed fds to/from an fd
set as needed.  This will allow QEMU to (in a later patch in this
series) "open" and "reopen" the same file by dup()ing the fd in
the fd set that corresponds to the file, where the fd has the
matching access mode flag that QEMU requests.

The new QMP commands are:
  add-fd: Add a file descriptor to an fd set
  remove-fd: Remove a file descriptor from an fd set
  query-fdsets: Return information describing all fd sets

Note: These commands are not compatible with the existing getfd
and closefd QMP commands.

Signed-off-by: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: e17408283562be359f16a7e12ddfee7509d6fe11
      https://github.com/qemu/qemu/commit/e17408283562be359f16a7e12ddfee7509d6fe11
  Author: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M block/raw-posix.c

  Log Message:
  -----------
  block: Prevent detection of /dev/fdset/ as floppy

Signed-off-by: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 6165f4d85d92e15b6aebdeeb2559dc687b0353c7
      https://github.com/qemu/qemu/commit/6165f4d85d92e15b6aebdeeb2559dc687b0353c7
  Author: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M block/raw-posix.c
    M block/raw-win32.c
    M block/vdi.c
    M block/vmdk.c
    M block/vpc.c
    M block/vvfat.c

  Log Message:
  -----------
  block: Convert open calls to qemu_open

This patch converts all block layer open calls to qemu_open.

Note that this adds the O_CLOEXEC flag to the changed open paths
when the O_CLOEXEC macro is defined.

Signed-off-by: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 2e1e79dae7a7e0a3d698fbd359d75e3a0239bdaa
      https://github.com/qemu/qemu/commit/2e1e79dae7a7e0a3d698fbd359d75e3a0239bdaa
  Author: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M block/raw-posix.c
    M block/raw-win32.c
    M block/vmdk.c
    M block/vpc.c
    M block/vvfat.c
    M osdep.c
    M qemu-common.h
    M savevm.c

  Log Message:
  -----------
  block: Convert close calls to qemu_close

This patch converts all block layer close calls, that correspond
to qemu_open calls, to qemu_close.

Signed-off-by: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: adb696f3d8535119fe0f5363de79a29e6bda83ed
      https://github.com/qemu/qemu/commit/adb696f3d8535119fe0f5363de79a29e6bda83ed
  Author: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M Makefile
    M cutils.c
    M monitor.c
    M monitor.h
    M osdep.c
    M qemu-common.h
    M qemu-tool.c
    M qemu-user.c
    M tests/Makefile

  Log Message:
  -----------
  block: Enable qemu_open/close to work with fd sets

When qemu_open is passed a filename of the "/dev/fdset/nnn"
format (where nnn is the fdset ID), an fd with matching access
mode flags will be searched for within the specified monitor
fd set.  If the fd is found, a dup of the fd will be returned
from qemu_open.

Signed-off-by: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: efb87c169740e618ec548c45c819a43e0ade2bab
      https://github.com/qemu/qemu/commit/efb87c169740e618ec548c45c819a43e0ade2bab
  Author: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M monitor.c

  Log Message:
  -----------
  monitor: Clean up fd sets on monitor disconnect

Fd sets are shared by all monitor connections.  Fd sets are considered
to be in use while at least one monitor is connected.  When the last
monitor disconnects, all fds that are members of an fd set with no
outstanding dup references are closed.  This prevents any fd leakage
associated with a client disconnect prior to using a passed fd.

Signed-off-by: Corey Bryant &lt;coreyb@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 64e69e80920d82df3fa679bc41b13770d2f99360
      https://github.com/qemu/qemu/commit/64e69e80920d82df3fa679bc41b13770d2f99360
  Author: Stefan Priebe &lt;s.priebe@profihost.ag&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M block/iscsi.c

  Log Message:
  -----------
  iscsi: Fix NULL dereferences / races between task completion and abort

Signed-off-by: Stefan Priebe &lt;s.priebe@profihost.ag&gt;
Acked-by: Ronnie Sahlberg &lt;ronniesahlberg@gmail.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: d4c823292336598e2a0c79eb38a640d95748e2a2
      https://github.com/qemu/qemu/commit/d4c823292336598e2a0c79eb38a640d95748e2a2
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M block.c

  Log Message:
  -----------
  block: Flush parent to OS with cache=unsafe

Commit 29cdb251 already added a comment that no unnecessary flushes to
disk will occur, this patch makes the code even get to the point of the
comment. This is mostly theoretical because in practice we only stack
one format on top of one protocol, the former implementing flush_to_os
and the latter only flush_to_disk. It starts to matter when drivers that
are not on top implement flush_to_os.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Reviewed-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 58c8cce21c13bddd332590fb1fd9a5c369975d3f
      https://github.com/qemu/qemu/commit/58c8cce21c13bddd332590fb1fd9a5c369975d3f
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M tests/qemu-iotests/030

  Log Message:
  -----------
  qemu-iotests: Fix 030 after switch to GenericError

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Reviewed-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: e743ccecb1148485f0440db28f20f064bb89446e
      https://github.com/qemu/qemu/commit/e743ccecb1148485f0440db28f20f064bb89446e
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M Makefile

  Log Message:
  -----------
  Makefile: Avoid explicit list of directories in clean target

Avoid having an explicit list of directories in the 'clean'
target by using 'find' to remove all .o and .d files instead.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: df6839c7f7f0afb208414234903a8f8202fc6770
      https://github.com/qemu/qemu/commit/df6839c7f7f0afb208414234903a8f8202fc6770
  Author: Alejandro Martinez Ruiz &lt;alex@securiforest.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: fix assertion typo

Signed-off-by: Alejandro Martinez Ruiz &lt;alex@securiforest.com&gt;
Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 116aae36ae446cd97dd0010ae813194042732ccc
      https://github.com/qemu/qemu/commit/116aae36ae446cd97dd0010ae813194042732ccc
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M cputlb.c

  Log Message:
  -----------
  cputlb.c: Fix out of date comment

The comment about the return address from get_page_addr_code() was
well out of date as phys_ram_base has not existed for some time.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: eda5edd12db3c172671f12f79d0676eeb78dae73
      https://github.com/qemu/qemu/commit/eda5edd12db3c172671f12f79d0676eeb78dae73
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M scripts/simpletrace.py

  Log Message:
  -----------
  trace: Fix "Qemu" -&gt; "QEMU"

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 280a66a6ab896252829d049c0a0331716497db7e
      https://github.com/qemu/qemu/commit/280a66a6ab896252829d049c0a0331716497db7e
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M docs/bootindex.txt

  Log Message:
  -----------
  docs: Fix spelling (propery -&gt; property)

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 370de0234cb2bff701248a07e8cf37fafc7e1043
      https://github.com/qemu/qemu/commit/370de0234cb2bff701248a07e8cf37fafc7e1043
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/versatilepb.c

  Log Message:
  -----------
  Spelling fix in comment (peripherans -&gt; peripherals)

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 9c6bb55b864d34d78aa617440fc055e1c61cd2a6
      https://github.com/qemu/qemu/commit/9c6bb55b864d34d78aa617440fc055e1c61cd2a6
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/framebuffer.c

  Log Message:
  -----------
  framebuffer: Fix spelling in comment (leight -&gt; height)

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: bb9558679ffaae062ea26ef97d2273b148e9c515
      https://github.com/qemu/qemu/commit/bb9558679ffaae062ea26ef97d2273b148e9c515
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M iov.c

  Log Message:
  -----------
  iov_send_recv(): Handle zero bytes case even if OS does not

POSIX allows sendmsg() and recvmsg() to fail EMSGSIZE if passed a zero
msg.msg_iovlen (in particular the MacOS X implementation will do this).
Handle the case where iov_send_recv() is passed a zero byte count
explicitly, to avoid accidentally depending on the OS to treat zero
msg_iovlen as a no-op.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Acked-by: Michael Tokarev &lt;mjt@tls.msk.ru&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: c3594ed73e0a7e7feae309be79f0eb6bafcc02ab
      https://github.com/qemu/qemu/commit/c3594ed73e0a7e7feae309be79f0eb6bafcc02ab
  Author: Alberto Garcia &lt;agarcia@igalia.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/ivshmem.c
    M hw/qdev-monitor.c

  Log Message:
  -----------
  ivshmem, qdev-monitor: fix order of qerror parameters

Now that the QERR_ macros no longer contain a json dictionary,
the order of some parameters needs to be fixed for them to appear
correctly.

Signed-off-by: Alberto Garcia &lt;agarcia@igalia.com&gt;
Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;


  Commit: 8fa27d21a993e261137d15def5475ba2c4d8985b
      https://github.com/qemu/qemu/commit/8fa27d21a993e261137d15def5475ba2c4d8985b
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M scripts/tracetool/backend/simple.py
    M trace/simple.c
    M trace/simple.h

  Log Message:
  -----------
  Merge remote-tracking branch 'stefanha/tracing' into staging

* stefanha/tracing:
  trace/simple: Replace asprintf by g_strdup_printf
  trace/simple: Fix compiler warning for 32 bit hosts
  trace: avoid pointer aliasing in trace_record_finish()
  trace: drop unused TraceBufferRecord-&gt;next_tbuf_idx field
  trace: remove unnecessary write_to_buffer() typecasting
  trace: rename TraceRecordHeader to TraceLogHeader


  Commit: cc92186773df8c9aae8f812fff85e7325e1d7583
      https://github.com/qemu/qemu/commit/cc92186773df8c9aae8f812fff85e7325e1d7583
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/apic_common.c
    M hw/kvm/i8254.c
    M scripts/update-linux-headers.sh

  Log Message:
  -----------
  Merge remote-tracking branch 'qemu-kvm/uq/master' into staging

* qemu-kvm/uq/master:
  update-linux-headers.sh: Pull in asm-generic/kvm_para.h
  kvmvapic: Disable if there is insufficient memory
  kvm: i8254: Finish time conversion fix
  kvm: i8254: Cache kernel clock offset in KVMPITState


  Commit: fdef621b5810cf8d6715e04d883a0f3523873014
      https://github.com/qemu/qemu/commit/fdef621b5810cf8d6715e04d883a0f3523873014
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M Makefile
    M block.c
    M block/iscsi.c
    M block/raw-posix.c
    M block/raw-win32.c
    M block/vdi.c
    M block/vmdk.c
    M block/vpc.c
    M block/vvfat.c
    M cutils.c
    M monitor.c
    M monitor.h
    M osdep.c
    M qapi-schema.json
    M qemu-char.c
    M qemu-common.h
    M qemu-tool.c
    M qemu-user.c
    M qmp-commands.hx
    M savevm.c
    M tests/Makefile
    M tests/qemu-iotests/030

  Log Message:
  -----------
  Merge remote-tracking branch 'kwolf/for-anthony' into staging

* kwolf/for-anthony:
  qemu-iotests: Fix 030 after switch to GenericError
  block: Flush parent to OS with cache=unsafe
  iscsi: Fix NULL dereferences / races between task completion and abort
  monitor: Clean up fd sets on monitor disconnect
  block: Enable qemu_open/close to work with fd sets
  block: Convert close calls to qemu_close
  block: Convert open calls to qemu_open
  block: Prevent detection of /dev/fdset/ as floppy
  qapi: Introduce add-fd, remove-fd, query-fdsets
  qemu-char: Add MSG_CMSG_CLOEXEC flag to recvmsg


  Commit: d1186a33efa74c91b01e1b5d9918c61d109f1b54
      https://github.com/qemu/qemu/commit/d1186a33efa74c91b01e1b5d9918c61d109f1b54
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M Makefile
    M cputlb.c
    M docs/bootindex.txt
    M hw/framebuffer.c
    M hw/ivshmem.c
    M hw/qdev-monitor.c
    M hw/usb/hcd-ehci.c
    M hw/versatilepb.c
    M iov.c
    M scripts/simpletrace.py

  Log Message:
  -----------
  Merge remote-tracking branch 'stefanha/trivial-patches' into staging

* stefanha/trivial-patches:
  ivshmem, qdev-monitor: fix order of qerror parameters
  iov_send_recv(): Handle zero bytes case even if OS does not
  framebuffer: Fix spelling in comment (leight -&gt; height)
  Spelling fix in comment (peripherans -&gt; peripherals)
  docs: Fix spelling (propery -&gt; property)
  trace: Fix "Qemu" -&gt; "QEMU"
  cputlb.c: Fix out of date comment
  ehci: fix assertion typo
  Makefile: Avoid explicit list of directories in clean target


  Commit: 76b64a7aa84965ee9c7594058a43b00c2a14c72e
      https://github.com/qemu/qemu/commit/76b64a7aa84965ee9c7594058a43b00c2a14c72e
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M arch_init.h
    M compiler.h
    M qmp.c
    M target-i386/cpu.c
    M target-ppc/translate_init.c

  Log Message:
  -----------
  win32: provide separate macros for weak decls and definitions

mingw32 seems to want the declaration to also carry the weak attribute.
Strangely, gcc on Linux absolutely does not want the declaration to be marked
as weak.  This may not be the right fix, but it seems to do the trick.

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/03834e22abaf...76b64a7aa849

----==_mimepart_502bffce5a3a6_71d312eeaf479268--


</body></email><email><emailId>20120815214057</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-15 21:40:57-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 9abf56: s390: Fix error handling and condition code of ser...</subject><body>



----==_mimepart_502c1769ed9cd_71d312eeaf411319d
Date: Wed, 15 Aug 2012 14:40:57 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;502c1769ef91a_71d312eeaf411329d@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 9abf567d95a4e840df868ca993219175fbef8c22
      https://github.com/qemu/qemu/commit/9abf567d95a4e840df868ca993219175fbef8c22
  Author: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M target-s390x/kvm.c
    M target-s390x/op_helper.c

  Log Message:
  -----------
  s390: Fix error handling and condition code of service call

Invalid sccb addresses will cause specification or addressing exception.
Lets add those checks. Furthermore, the good case (cc=0) was incorrect
for KVM, we did not set the CC at all. We now use return codes &lt; 0
as program checks and return codes &gt; 0 as condition code values.

Signed-off-by: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 000a1a3800b532f97b939ebb777d5a14418f44a6
      https://github.com/qemu/qemu/commit/000a1a3800b532f97b939ebb777d5a14418f44a6
  Author: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M target-s390x/Makefile.objs
    M target-s390x/cpu.h
    A target-s390x/interrupt.c
    M target-s390x/op_helper.c

  Log Message:
  -----------
  s390: provide interface for service interrupt/introduce interrupt.c

This patch creates interrupt.c. The first user is a callback for hw/*
code to trigger an service interrupt for a given sccb value. Several
interrupt types for s390 are floating (can be delivered to all CPUs).
so this code does not belong to a specific CPU.
Other interrupts (like the virtio one) are also floating and can be
moved here later on.

Signed-off-by: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 231903bf27c18ba6d4d905601eab368f324159eb
      https://github.com/qemu/qemu/commit/231903bf27c18ba6d4d905601eab368f324159eb
  Author: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/spapr_pci.c
    M hw/spapr_pci.h

  Log Message:
  -----------
  pseries pci: removed redundant busdev

The PCIHostState struct already contains SysBusDevice so
the one in sPAPRPHBState has to go.

Signed-off-by: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: e0fdbd7c1b45c1af034d4070a65067f6635f77b0
      https://github.com/qemu/qemu/commit/e0fdbd7c1b45c1af034d4070a65067f6635f77b0
  Author: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/spapr.c
    M hw/spapr_pci.c
    M hw/spapr_pci.h

  Log Message:
  -----------
  pseries pci: spapr_populate_pci_devices renamed to spapr_populate_pci_dt

spapr_populate_pci_devices() populates the device tree only with bus
properties and has nothing to do with the devices on it as PCI BAR
allocation is done by the system firmware (SLOF).

New name - spapr_populate_pci_dt() - describes the functionality better.

Signed-off-by: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 4a18e7c92a3c23ee742eda1e4442299b56198517
      https://github.com/qemu/qemu/commit/4a18e7c92a3c23ee742eda1e4442299b56198517
  Author: Scott Wood &lt;scottwood@freescale.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/ppc/Makefile.objs
    A hw/ppc/e500.c
    R hw/ppce500_mpc8544ds.c

  Log Message:
  -----------
  PPC: e500: rename mpc8544ds into generic file

Rename the file (with no changes other than fixing up the header paths)
in preparation for refactoring into a generic e500 platform.  Also move
it into the newly created ppc/ directory.

Signed-off-by: Scott Wood &lt;scottwood@freescale.com&gt;
Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
[agraf: conditionalize on CONFIG_FDT]
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: b330598137cad915f65562a524b30e32498e44be
      https://github.com/qemu/qemu/commit/b330598137cad915f65562a524b30e32498e44be
  Author: Scott Wood &lt;scottwood@freescale.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/ppc/e500.c

  Log Message:
  -----------
  PPC: e500: change internal references away from mpc8544ds

No functional changes -- machine is still outwardly mpc8544ds.

The references that are not changed contain mpc8544 hardware details that
need to be parameterized if/when a different e500 platform wants to
change them.

Signed-off-by: Scott Wood &lt;scottwood@freescale.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: e6eaabeb8dfb026da51d178974bddf56f1f06ffe
      https://github.com/qemu/qemu/commit/e6eaabeb8dfb026da51d178974bddf56f1f06ffe
  Author: Scott Wood &lt;scottwood@freescale.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/ppc/Makefile.objs
    M hw/ppc/e500.c
    A hw/ppc/e500.h
    A hw/ppc/mpc8544ds.c

  Log Message:
  -----------
  PPC: e500: split mpc8544ds machine from generic e500 code

Currently the only mpc8544ds-ism that is factored out is
toplevel compatible and model.  In the future the generic e500
code is expected to become more generic.

Signed-off-by: Scott Wood &lt;scottwood@freescale.com&gt;
[agraf: conditionalize on CONFIG_FDT]
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 4d5c29ca455ed6adb1fb9f8394e4d7badfd0c532
      https://github.com/qemu/qemu/commit/4d5c29ca455ed6adb1fb9f8394e4d7badfd0c532
  Author: Scott Wood &lt;scottwood@freescale.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/ppc/Makefile.objs
    A hw/ppc/e500plat.c

  Log Message:
  -----------
  PPC: e500: add generic e500 platform

This gives the kernel a paravirtualized machine to target, without
requiring both sides to pretend to be targeting a specific board
that likely has little to do with the host in KVM scenarios.  This
avoids the need to add new boards to QEMU, just to be able to
run KVM on new CPUs.

Signed-off-by: Scott Wood &lt;scottwood@freescale.com&gt;
[agraf: conditionalize on CONFIG_FDT]
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 78e8fde26c032931ca2ae13bfc7c59e38afd17ee
      https://github.com/qemu/qemu/commit/78e8fde26c032931ca2ae13bfc7c59e38afd17ee
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M target-ppc/kvm.c

  Log Message:
  -----------
  ppc: Fix bug in handling of PAPR hypercall exits

Currently for powerpc, kvm_arch_handle_exit() always returns 1, meaning
that its caller - kvm_cpu_exec() - will always exit immediately afterwards
to the loop in qemu_kvm_cpu_thread_fn().

There's no need to do this.  Once we've handled the hypercall there's no
reason we can't go straight around and KVM_RUN again, which is what ret = 0
will signal.  The only exception might be for hypercalls which affect the
state of cpu_can_run(), however the only one that might do this is H_CEDE
and for kvm that is always handled in the kernel, not qemu.

Furtherm setting ret = 0 means that when exit_requested is set from a
hypercall, we will enter KVM_RUN once more with a signal which lets the
the kernel do its internal logic to complete the hypercall with out
actually executing any more guest code.  This is important if our hypercall
also triggered a reset, which previously would re-initialize everything
without completing the hypercall.  This caused the kernel to get confused
because it thought the guest was still in the middle of a hypercall when
it has actually been reset.

This patch therefore changes to ret = 0, which is both a bugfix and a small
optimization.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 7e99826c350f21cb7d162e802efaa5d1b8689ad0
      https://github.com/qemu/qemu/commit/7e99826c350f21cb7d162e802efaa5d1b8689ad0
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/ppc/e500.c

  Log Message:
  -----------
  Revert "PPC: e500: Use new MPIC dt format"

This reverts commit 518c7fb44f2182cde943dc64f88cb2fd4e4ff6b5. It breaks
new Linux guests with SMP, because IPIs get mapped to large vectors which
our MPIC emulation does not implement.

Conflicts:

	hw/ppc/e500.c


  Commit: c1195d1677a41f42be712620674d42b39d83bdfe
      https://github.com/qemu/qemu/commit/c1195d1677a41f42be712620674d42b39d83bdfe
  Author: zhlcindy@gmail.com &lt;zhlcindy@gmail.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/alpha_pci.c
    M hw/cirrus_vga.c
    M hw/mips_malta.c
    M hw/pc.c
    M hw/pc.h
    M hw/ppc_newworld.c
    M hw/ppc_oldworld.c
    M hw/ppc_prep.c
    M hw/sun4u.c
    M hw/vga-pci.c
    A hw/vga-pci.h

  Log Message:
  -----------
  Add one new file vga-pci.h and cleanup on all platforms

Functions pci_vga_init() and pci_cirrus_vga_init() are declared
in pc.h. That prevents other platforms (e.g. sPAPR) to use them.

This patch is to create one new file vga-pci.h and move the
declarations to vga-pci.h, so that they can be shared by
all platforms. This patch also cleans up on all platforms.

Signed-off-by: Li Zhang &lt;zhlcindy@linux.vnet.ibm.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: f28359d8e8fc64192450a72164b89d06cc3f781d
      https://github.com/qemu/qemu/commit/f28359d8e8fc64192450a72164b89d06cc3f781d
  Author: zhlcindy@gmail.com &lt;zhlcindy@gmail.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/spapr.c

  Log Message:
  -----------
  spapr: Add support for -vga option

Also instanciate the USB keyboard and mouse when that option is used
(you can still use -device to create individual devices without all
the defaults)

Signed-off-by: Benjamin Herrenschmidt &lt;benh@kernel.crashing.org&gt;
Signed-off-by: Li Zhang &lt;zhlcindy@linux.vnet.ibm.com&gt;
[agraf: remove USB bits]
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: a5b71725c7067f6805eb30ff8e03dce3b6bf7a53
      https://github.com/qemu/qemu/commit/a5b71725c7067f6805eb30ff8e03dce3b6bf7a53
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M savevm.c

  Log Message:
  -----------
  xbzrle: fix compilation on ppc32

When compiling the xbzrle code on my ppc32 user space, I hit the following
gcc compiler warning (treated as an error):

  cc1: warnings being treated as errors
  savevm.c: In function âxbzrle_encode_buffer':
  savevm.c:2476: error: overflow in implicit constant conversion

Fix this by making the cast explicit, rather than implicit.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 8c57b867b5d18b0d916797dfbac465b8aaa5bf5a
      https://github.com/qemu/qemu/commit/8c57b867b5d18b0d916797dfbac465b8aaa5bf5a
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/spapr.c

  Log Message:
  -----------
  PPC: spapr: Rework VGA select logic

When selecting our VGA adapter, we want to:

  * fail completely when we can't satisfy the user's request
  * support -nographic where no VGA adapter should be spawned

This patch reworks the logic so we fulfill the two conditions above.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 3fc5acdeedfcea7c7d86040fa427ae785920b399
      https://github.com/qemu/qemu/commit/3fc5acdeedfcea7c7d86040fa427ae785920b399
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/spapr.c
    M hw/spapr.h

  Log Message:
  -----------
  PPC: spapr: Remove global variable

Global variables are bad. Let's move spapr_has_graphics into the
machine state struct.

Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 03332579b81ef7f2b0fcb41e45f7764a5bfc1ea4
      https://github.com/qemu/qemu/commit/03332579b81ef7f2b0fcb41e45f7764a5bfc1ea4
  Author: Benjamin Herrenschmidt &lt;benh@kernel.crashing.org&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M pc-bios/README
    M pc-bios/slof.bin
    M roms/SLOF

  Log Message:
  -----------
  pseries: Update SLOF

This patch updates the SLOF version, introducing a number of fixes:
 * add proper graphics support
 * fix bugs with graphical terminal under grub2
 * fix bugs in handling of 64-bit unit addresses
 * fix VSCSI representation to be closer to PowerVM
 * fix bugs which caused grub2 to crash

Signed-off-by: Benjamin Herrenschmidt &lt;benh@kernel.crashing.org&gt;
Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: c9f709d2e7d9dcc6e6ecbee8d499b4b14b11320b
      https://github.com/qemu/qemu/commit/c9f709d2e7d9dcc6e6ecbee8d499b4b14b11320b
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/spapr.c

  Log Message:
  -----------
  pseries: Remove extraneous prints

The pseries machine prints several messages to stderr whenever it starts up
and another whenever the vm is reset.  It's not normal for qemu machines to
do this though, so this patch removes them.  We can put them back
conditional on a DEBUG symbol if we really need them in future.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: a307d59434ba78b97544b42b8cfd24a1b62e39a6
      https://github.com/qemu/qemu/commit/a307d59434ba78b97544b42b8cfd24a1b62e39a6
  Author: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/spapr.c
    M hw/spapr.h
    M hw/spapr_llan.c
    M hw/spapr_pci.c
    M hw/spapr_pci.h
    M hw/spapr_vio.c
    M hw/spapr_vio.h
    M hw/spapr_vty.c
    M hw/xics.c
    M hw/xics.h

  Log Message:
  -----------
  pseries: Rework irq assignment to avoid carrying qemu_irqs around

Currently, the interfaces in the pseries machine code for assignment
and setup of interrupts pass around qemu_irq objects.  That was done
in an attempt not to be too closely linked to the specific XICS
interrupt controller.  However interactions with the device tree setup
made that attempt rather futile, and XICS is part of the PAPR spec
anyway, so this really just meant we had to carry both the qemu_irq
pointers and the XICS irq numbers around.

This mess will just get worse when we add upcoming PCI MSI support,
since that will require tracking a bunch more interrupt.  Therefore,
this patch reworks the spapr code to just use XICS irq numbers
(roughly equivalent to GSIs on x86) and only retrieve the qemu_irq
pointers from the XICS code when we need them (a trivial lookup).

This is a reworked and generalized version of an earlier spapr_pci
specific patch from Alexey Kardashevskiy.

Signed-off-by: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
[agraf: fix checkpath warning]
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: fa28f71b4a88cdb796f1e0a308205c6be604d3f3
      https://github.com/qemu/qemu/commit/fa28f71b4a88cdb796f1e0a308205c6be604d3f3
  Author: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/spapr.c
    M hw/spapr_pci.c
    M hw/spapr_pci.h

  Log Message:
  -----------
  pseries: Separate PCI RTAS setup from common from emulation specific PCI setup

Currently the RTAS functions for handling PCI are registered from the
class init code for the PCI host bridge.  That sort of makes sense
now, but will break in the future when vfio gives us multiple types of
host bridge for pseries (emulated and pass-through, at least).  The
RTAS functions will be common across all host bridge types (and will
call out to different places internally depending on the type).

So, this patch moves the RTAS registration into its own function
called direct from the machine setup code.

Signed-off-by: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: f4b9523ba6388f6f951933de3f9a76e2e9ea2ede
      https://github.com/qemu/qemu/commit/f4b9523ba6388f6f951933de3f9a76e2e9ea2ede
  Author: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/spapr.c
    M hw/spapr.h

  Log Message:
  -----------
  pseries: added allocator for a block of IRQs

The patch adds a simple helper which allocates a consecutive sequence
of IRQs calling spapr_allocate_irq for each and checks that allocated
IRQs go consequently.

The patch is required for upcoming support of MSI/MSIX on POWER.

Signed-off-by: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 9894c5d4b467d24e281c22f2f5e24822c9b55fb3
      https://github.com/qemu/qemu/commit/9894c5d4b467d24e281c22f2f5e24822c9b55fb3
  Author: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/spapr_pci.c

  Log Message:
  -----------
  pseries: Export find_phb() utility function for PCI code

The pseries PCI code makes use of an internal find_dev() function which
locates a PCIDevice * given a (platform specific) bus ID and device
address.  Internally this needs to first locate the host bridge on which
the device resides based on the bus ID.  This patch exposes that host
bridge lookup as a separate function, which we will need later in the MSI
and VFIO code.

Signed-off-by: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
[agraf: drop trace.h inclusion]
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: a2950fb6e795e3e10fed35d347a7aa28a44be2ff
      https://github.com/qemu/qemu/commit/a2950fb6e795e3e10fed35d347a7aa28a44be2ff
  Author: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/spapr_pci.c
    M trace-events

  Log Message:
  -----------
  pseries: Add trace event for PCI irqs

This adds a trace event in the pseries PCI specific set_irq() function to
assist in debugging.

Signed-off-by: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
[agraf: add trace.h include]
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 0ee2c058a3fe485b8901186179102e251a33d082
      https://github.com/qemu/qemu/commit/0ee2c058a3fe485b8901186179102e251a33d082
  Author: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/spapr.c
    M hw/spapr_pci.c
    M hw/spapr_pci.h
    M trace-events

  Log Message:
  -----------
  pseries: Add PCI MSI/MSI-X support

This patch implements MSI and MSI-X support for the pseries PCI host
bridge.  To do this it adds:

 * A "config_space_address to msi_table" map, since the MSI RTAS calls
take a PCI config space address as an identifier.

 * A MSIX memory region to catch msi_notify()/msix_notiry() from
virtio-pci and pass them to the guest via qemu_irq_pulse().

 * RTAS call "ibm,change-msi" which sets up MSI vectors for a
device. Note that this call may configure and return lesser number of
vectors than requested.

 * RTAS call "ibm,query-interrupt-source-number" which translates MSI
vector to interrupt controller (XICS) IRQ number.

Signed-off-by: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
[agraf: fix error case ndev &lt; 0]
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 5c4cbcf26ca9465a36fc0661b4103d55897e1a19
      https://github.com/qemu/qemu/commit/5c4cbcf26ca9465a36fc0661b4103d55897e1a19
  Author: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/spapr.h
    M hw/spapr_iommu.c
    M hw/spapr_pci.c
    M hw/spapr_pci.h
    M hw/spapr_vio.c

  Log Message:
  -----------
  pseries dma: DMA window params added to PHB and DT population changed

Previously the only PCI bus supported was the emulated PCI bus with
fixed DMA window with start at 0 and size 1GB. As we are going to support
PCI pass through which DMA window properties are set by the host
kernel, we have to support DMA windows with parameters other than default.

This patch adds:

1. DMA window properties to sPAPRPHBState: LIOBN (bus id), start,
size of the window.

2. An additional function spapr_dma_dt() to populate DMA window
properties in the device tree which simply accepts all the parameters
and does not try to guess what kind of IOMMU is given to it.
The original spapr_dma_dt() is renamed to spapr_tcet_dma_dt().

Signed-off-by: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 4504068723bcf9a3b37f6683d87711b6c5e4c0c3
      https://github.com/qemu/qemu/commit/4504068723bcf9a3b37f6683d87711b6c5e4c0c3
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M pc-bios/README
    M pc-bios/slof.bin
    M roms/SLOF

  Log Message:
  -----------
  pseries: Update SLOF firmware image

This updates SLOF to handle the necessary device tree properties for MSI
and MSI-X.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 3e77223293bcb9277f7b760b88f694f097f29c33
      https://github.com/qemu/qemu/commit/3e77223293bcb9277f7b760b88f694f097f29c33
  Author: Bharat Bhushan &lt;r65777@freescale.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/openpic.c

  Log Message:
  -----------
  openpic: Added BRR1 register

Linux mpic driver uses (changes may be in pipeline to get upstreamed soon)
BRR1. This patch adds the support to emulate readonly FSL BRR1 register.

Currently QEMU does not fully emulate any version on MPIC, so the MPIC
Major number and Minor number are set to 0.

Signed-off-by: Bharat Bhushan &lt;bharat.bhushan@freescale.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: 0d16fdd732d1b211842fa96b7c90ddf9e6bde0e4
      https://github.com/qemu/qemu/commit/0d16fdd732d1b211842fa96b7c90ddf9e6bde0e4
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/alpha_pci.c
    M hw/cirrus_vga.c
    M hw/mips_malta.c
    M hw/openpic.c
    M hw/pc.c
    M hw/pc.h
    M hw/ppc/Makefile.objs
    A hw/ppc/e500.c
    A hw/ppc/e500.h
    A hw/ppc/e500plat.c
    A hw/ppc/mpc8544ds.c
    M hw/ppc_newworld.c
    M hw/ppc_oldworld.c
    M hw/ppc_prep.c
    R hw/ppce500_mpc8544ds.c
    M hw/spapr.c
    M hw/spapr.h
    M hw/spapr_iommu.c
    M hw/spapr_llan.c
    M hw/spapr_pci.c
    M hw/spapr_pci.h
    M hw/spapr_vio.c
    M hw/spapr_vio.h
    M hw/spapr_vty.c
    M hw/sun4u.c
    M hw/vga-pci.c
    A hw/vga-pci.h
    M hw/xics.c
    M hw/xics.h
    M pc-bios/README
    M pc-bios/slof.bin
    M roms/SLOF
    M savevm.c
    M target-ppc/kvm.c
    M trace-events

  Log Message:
  -----------
  Merge remote-tracking branch 'agraf/ppc-for-upstream' into staging

* agraf/ppc-for-upstream: (24 commits)
  openpic: Added BRR1 register
  pseries: Update SLOF firmware image
  pseries dma: DMA window params added to PHB and DT population changed
  pseries: Add PCI MSI/MSI-X support
  pseries: Add trace event for PCI irqs
  pseries: Export find_phb() utility function for PCI code
  pseries: added allocator for a block of IRQs
  pseries: Separate PCI RTAS setup from common from emulation specific PCI setup
  pseries: Rework irq assignment to avoid carrying qemu_irqs around
  pseries: Remove extraneous prints
  pseries: Update SLOF
  PPC: spapr: Remove global variable
  PPC: spapr: Rework VGA select logic
  xbzrle: fix compilation on ppc32
  spapr: Add support for -vga option
  Add one new file vga-pci.h and cleanup on all platforms
  Revert "PPC: e500: Use new MPIC dt format"
  ppc: Fix bug in handling of PAPR hypercall exits
  PPC: e500: add generic e500 platform
  PPC: e500: split mpc8544ds machine from generic e500 code
  ...


  Commit: 2b97f88c927be3ff3722497980048bc1cb7cc571
      https://github.com/qemu/qemu/commit/2b97f88c927be3ff3722497980048bc1cb7cc571
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M target-s390x/Makefile.objs
    M target-s390x/cpu.h
    A target-s390x/interrupt.c
    M target-s390x/kvm.c
    M target-s390x/op_helper.c

  Log Message:
  -----------
  Merge remote-tracking branch 'agraf/s390-for-upstream' into staging

* agraf/s390-for-upstream:
  s390: provide interface for service interrupt/introduce interrupt.c
  s390: Fix error handling and condition code of service call


Compare: https://github.com/qemu/qemu/compare/76b64a7aa849...2b97f88c927b

----==_mimepart_502c1769ed9cd_71d312eeaf411319d--


</body></email><email><emailId>20120816150015</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-16 15:00:15-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 5a4d70: audio: Make pcspk card selectable again</subject><body>



----==_mimepart_502d0aff51c5d_70b21473af03007f
Date: Thu, 16 Aug 2012 08:00:15 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;502d0aff5300d_70b21473af03015c@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 5a4d701acde890a5ca134236424ece45545f70c7
      https://github.com/qemu/qemu/commit/5a4d701acde890a5ca134236424ece45545f70c7
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-08-16 (Thu, 16 Aug 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  audio: Make pcspk card selectable again

    [ The following text is in the "ISO-8859-1" character set. ]
    [ Your display is set for the "KOI8-R" character set.  ]
    [ Some special characters may be displayed incorrectly. ]

Since we moved pcspk into hwlib, CONFIG_PCSPK is no longer defined per
target. Therefore, statically built soundhw array in arch_init.c stopped
including this card.

Work around this by re-adding this define to config-target.mak.
Long-term, a dynamic creation of this soundhw list will be necessary.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;




----==_mimepart_502d0aff51c5d_70b21473af03007f--


</body></email><email><emailId>20120816190011</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-16 19:00:11-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu]</subject><body>



----==_mimepart_502d433b22d3b_2188e34af42706b7
Date: Thu, 16 Aug 2012 12:00:11 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;502d433b23e86_2188e34af4270724@sh2.rs.github.com.mail&gt;

  Branch: refs/tags/v1.2.0-rc0
  Home:   https://github.com/qemu/qemu


----==_mimepart_502d433b22d3b_2188e34af42706b7--


</body></email><email><emailId>20120816190012</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-16 19:00:12-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] a86a4c: qlist: add qlist_size()</subject><body>



----==_mimepart_502d433c85e41_338410c1aec83395
Date: Thu, 16 Aug 2012 12:00:12 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;502d433c8873a_338410c1aec8344a@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: a86a4c2f7b7f0b72816ea1c219d8140699b6665b
      https://github.com/qemu/qemu/commit/a86a4c2f7b7f0b72816ea1c219d8140699b6665b
  Author: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
  Date:   2012-08-16 (Thu, 16 Aug 2012)

  Changed paths:
    M qlist.c
    M qlist.h

  Log Message:
  -----------
  qlist: add qlist_size()

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 65c0f1e9558c7c762cdb333406243fff1d687117
      https://github.com/qemu/qemu/commit/65c0f1e9558c7c762cdb333406243fff1d687117
  Author: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
  Date:   2012-08-16 (Thu, 16 Aug 2012)

  Changed paths:
    M json-parser.c

  Log Message:
  -----------
  json-parser: don't replicate tokens at each level of recursion

Currently, when parsing a stream of tokens we make a copy of the token
list at the beginning of each level of recursion so that we do not
modify the original list in cases where we need to fall back to an
earlier state.

In the worst case, we will only read 1 or 2 tokens off the list before
recursing again, which means an upper bound of roughly N^2 token allocations.

For a "reasonably" sized QMP request (in this a QMP representation of
cirrus_vga's device state, generated via QIDL, being passed in via
qom-set), this caused my 16GB's of memory to be exhausted before any
noticeable progress was made by the parser.

This patch works around the issue by using single copy of the token list
in the form of an indexable array so that we can save/restore state by
manipulating indices.

A subsequent commit adds a "large_dict" test case which exhibits the
same behavior as above. With this patch applied the test case successfully
completes in under a second.

Tested with valgrind, make check, and QMP.

Reviewed-by: Eric Blake &lt;eblake@redhat.com&gt;
Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 7109edfeb69c1d3c2164175837784dfcd210fed0
      https://github.com/qemu/qemu/commit/7109edfeb69c1d3c2164175837784dfcd210fed0
  Author: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
  Date:   2012-08-16 (Thu, 16 Aug 2012)

  Changed paths:
    M tests/check-qjson.c

  Log Message:
  -----------
  check-qjson: add test for large JSON objects

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: bbea4050802a2e7e0296a21823c0925782c02b93
      https://github.com/qemu/qemu/commit/bbea4050802a2e7e0296a21823c0925782c02b93
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-16 (Thu, 16 Aug 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: Don't override user's --cpu on MacOS and Solaris

Both MacOS and Solaris have special case handling for the CPU
type, because the check_define probes will return i386 even if
the hardware is 64 bit and x86_64 would be preferable. Move
these checks earlier in the configure probing so that we can
do them only if the user didn't specify a CPU with --cpu. This
fixes a bug where the user's command line argument was being
ignored.

Reviewed-by: Andreas F=E4rber &lt;afaerber@suse.de&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: a0b7cf6b6ecc91e730de5ac6a6f7f927d16f89ca
      https://github.com/qemu/qemu/commit/a0b7cf6b6ecc91e730de5ac6a6f7f927d16f89ca
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-16 (Thu, 16 Aug 2012)

  Changed paths:
    M configure

  Log Message:
  -----------
  configure: Define OS_OBJECT_USE_OBJC=0 for MacOSX builds

MacOSX 10.8 ("Mountain Lion") defaults to trying to use automated
reference counting on certain objects.  This means that the system
header files will use some Objective C syntax constructs even when
compiling pure C, which confuses mainline gcc. Suppress this by
setting OS_OBJECT_USE_OBJC=0. This avoids a compile error like this:

In file included from
/System/Library/Frameworks/Foundation.framework/Headers/NSObject.h:5:0,
           from /usr/include/os/object.h:74,
           from /usr/include/dispatch/dispatch.h:48,
           from /System/Library/Frameworks/IOKit.framework/Headers/IOKitLib.h:56,
           from block/raw-posix.c:35:
/System/Library/Frameworks/Foundation.framework/Headers/NSObjCRuntime.h:409:1: error: \
stray â@' in program [with a large number of further run-on errors]

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 3c4a4d0dcbf4269e125f92df06816db1c1e86d20
      https://github.com/qemu/qemu/commit/3c4a4d0dcbf4269e125f92df06816db1c1e86d20
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-16 (Thu, 16 Aug 2012)

  Changed paths:
    M configure
    M rules.mak

  Log Message:
  -----------
  Support using a different compiler for Objective-C files

MacOSX 10.8 ("Mountain Lion") requires us to compile our one
Objective-C source file with clang even if the rest of QEMU
requires a real gcc, because the system headers we use make
use of Apple's "Blocks" extension to C/ObjC, and mainline
gcc doesn't support that. Since we only need to use a true
gcc for the parts of QEMU that use the fixed-register
env variable, we can simply use clang to build the ObjC
file: it will link to the gcc-built objects with no problems.

Add the necessary support for an OBJCC variable in the
makefile and configure machinery; we default to clang
if we have it, otherwise whatever CC is (since gcc
might be the Apple gcc which does support Blocks).

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: ddb97f1debbb6be8d871f3b565f7b8befebf0f4f
      https://github.com/qemu/qemu/commit/ddb97f1debbb6be8d871f3b565f7b8befebf0f4f
  Author: Jason Baron &lt;jbaron@redhat.com&gt;
  Date:   2012-08-16 (Thu, 16 Aug 2012)

  Changed paths:
    M exec.c
    M osdep.h
    M qemu-config.c
    M qemu-options.hx

  Log Message:
  -----------
  memory: add -machine dump-guest-core=on|off

Add a new '[,dump-guest-core=on|off]' option to the '-machine' option. When
'dump-guest-core=off' is specified, guest memory is omitted from the core dump.
The default behavior continues to be to include guest memory when a core dump is
triggered. In my testing, this brought the core dump size down from 384MB to 6MB
on a 2GB guest.

Is anything additional required to preserve this setting for migration or
savevm? I don't believe so.

Changelog:
v3:
    Eliminate globals as per Anthony's suggestion
    set no dump from qemu_ram_remap() as well
v2:
    move the option from -m to -machine, rename option dump -&gt; dump-guest-core

Signed-off-by: Jason Baron &lt;jbaron@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: bc9b78debf63c9be051abe51403736d386092d09
      https://github.com/qemu/qemu/commit/bc9b78debf63c9be051abe51403736d386092d09
  Author: Benjamin Herrenschmidt &lt;benh@kernel.crashing.org&gt;
  Date:   2012-08-16 (Thu, 16 Aug 2012)

  Changed paths:
    M dma-helpers.c

  Log Message:
  -----------
  dma: Fix stupid typo/thinko

Hi hard a brain fart when coding that function, it will
fail to "set" the memory beyond the first 512 bytes. This
is in turn causing guest crashes in ibmveth (spapr_llan.c
on the qemu side) due to the receive queue not being
properly initialized.

Signed-off-by: Benjamin Herrenschmidt &lt;benh@kernel.crashing.org&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: f794573eab564548fa7aa463b5908b0042c0e6a4
      https://github.com/qemu/qemu/commit/f794573eab564548fa7aa463b5908b0042c0e6a4
  Author: Eduardo Otubo &lt;otubo@linux.vnet.ibm.com&gt;
  Date:   2012-08-16 (Thu, 16 Aug 2012)

  Changed paths:
    M Makefile.objs
    M configure

  Log Message:
  -----------
  Adding support for libseccomp in configure and Makefile (v8)

Adding basic options to the configure script to use libseccomp or not.
The default is set to 'no'. If the flag --enable-libseccomp is used, the
script will check for its existence using pkg-config.

Signed-off-by: Eduardo Otubo &lt;otubo@linux.vnet.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
---
v1 -&gt; v2:
 - As I removed all the code related to seccomp from vl.c, I created
   qemu-seccomp.[ch].
 - Also making the configure script to add the specific line to
   Makefile.obj in order to compile with appropriate support to seccomp.

v2 -&gt; v3:
 - Removing the line from Makefile.obj and adding it to Makefile.objs.
 - Marking libseccomp default option to 'yes' in the configure script.

v3 -&gt; v8:
 - fix configure probe if libseccomp isn't available (aliguori)


  Commit: 2f668be77501c0232a84aafb6a066c9915987f0e
      https://github.com/qemu/qemu/commit/2f668be77501c0232a84aafb6a066c9915987f0e
  Author: Eduardo Otubo &lt;otubo@linux.vnet.ibm.com&gt;
  Date:   2012-08-16 (Thu, 16 Aug 2012)

  Changed paths:
    A qemu-seccomp.c
    A qemu-seccomp.h

  Log Message:
  -----------
  Adding qemu-seccomp.[ch] (v8)

Signed-off-by: Eduardo Otubo &lt;otubo@linux.vnet.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
---
v1:
 - I added a syscall struct using priority levels as described in the
   libseccomp man page. The priority numbers are based to the frequency
   they appear in a sample strace from a regular qemu guest run under
   libvirt.

   Libseccomp generates linear BPF code to filter system calls, those rules
   are read one after another. The priority system places the most common
   rules first in order to reduce the overhead when processing them.

v1 -&gt; v2:
 - Fixed some style issues
 - Removed code from vl.c and created qemu-seccomp.[ch]
 - Now using ARRAY_SIZE macro
 - Added more syscalls without priority/frequency set yet

v2 -&gt; v3:
 - Adding copyright and license information
 - Replacing seccomp_whitelist_count just by ARRAY_SIZE
 - Adding header protection to qemu-seccomp.h
 - Moving QemuSeccompSyscall definition to qemu-seccomp.c
 - Negative return from seccomp_start is fatal now.
 - Adding open() and execve() to the whitelis

v3 -&gt; v4:
 - Tests revealed a bigger set of syscalls.
 - seccomp_start() now has an argument to set the mode according to the
   configure option trap or kill.

v4 -&gt; v5:
 - Tests on x86_64 required a new specific set of system calls.
 - libseccomp release 1.0.0: part of the API have changed in this last
   release, had to adapt to the new function signatures.


  Commit: 452dfbef600837c0e430564ea9e35138ef48f24c
      https://github.com/qemu/qemu/commit/452dfbef600837c0e430564ea9e35138ef48f24c
  Author: Eduardo Otubo &lt;otubo@linux.vnet.ibm.com&gt;
  Date:   2012-08-16 (Thu, 16 Aug 2012)

  Changed paths:
    M vl.c

  Log Message:
  -----------
  Adding seccomp calls to vl.c (v8)

Signed-off-by: Eduardo Otubo &lt;otubo@linux.vnet.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
---
v1:
 - Full seccomp calls and data included in vl.c

v1 -&gt; v2:
 - Full seccomp calls and data removed from vl.c and put into separate
   qemu-seccomp.[ch] file.


  Commit: 7d76ad4fa4405bb20c35fd24c3c848d2bc48f694
      https://github.com/qemu/qemu/commit/7d76ad4fa4405bb20c35fd24c3c848d2bc48f694
  Author: Eduardo Otubo &lt;otubo@linux.vnet.ibm.com&gt;
  Date:   2012-08-16 (Thu, 16 Aug 2012)

  Changed paths:
    M qemu-config.c
    M qemu-config.h
    M qemu-options.hx
    M vl.c

  Log Message:
  -----------
  Command line support for seccomp with -sandbox (v8)

Signed-off-by: Eduardo Otubo &lt;otubo@linux.vnet.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
---
v7 -&gt; v8
 - Parse options correctly (aliguori)


  Commit: d973ba18ced6e9440131c55b0f07e97bdbbc6703
      https://github.com/qemu/qemu/commit/d973ba18ced6e9440131c55b0f07e97bdbbc6703
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-16 (Thu, 16 Aug 2012)

  Changed paths:
    M osdep.c

  Log Message:
  -----------
  osdep: Fix compilation failure on BSD systems

Fix compilation failure on BSD systems (which don't have
O_DIRECT or O_NOATIME:
osdep.c:116: error: âO_DIRECT' undeclared (first use in this function)
osdep.c:116: error: (Each undeclared identifier is reported only once
osdep.c:116: error: for each function it appears in.)
osdep.c:116: error: âO_NOATIME' undeclared (first use in this function)

Reviewed-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 35139a590c4e2f3086d069028bda77f1de1d46b0
      https://github.com/qemu/qemu/commit/35139a590c4e2f3086d069028bda77f1de1d46b0
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-08-16 (Thu, 16 Aug 2012)

  Changed paths:
    M hw/spapr.c

  Log Message:
  -----------
  pseries: Instantiate USB interface when required

The pseries machine already supports the -vga std option, creating a
graphics adapter.  However, this is not very useful without being able to
add a keyboard and mouse as well.  This patch addresses this by adding
a USB interface when requested, and automatically adding a USB keyboard
and mouse when VGA is enabled.

This is a stop gap measure to get usable graphics mode on pseries while
waiting for Li Zhang's rework of USB options to go in after 1.2.

Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: be52202902d166e914d426c8e3d8976b25121b4d
      https://github.com/qemu/qemu/commit/be52202902d166e914d426c8e3d8976b25121b4d
  Author: David Gibson &lt;david@gibson.dropbear.id.au&gt;
  Date:   2012-08-16 (Thu, 16 Aug 2012)

  Changed paths:
    M hw/boards.h
    M sysemu.h
    M vl.c

  Log Message:
  -----------
  Allow QEMUMachine to override reset sequencing

qemu_system_reset() function always performs the same basic actions on
all machines.  This includes running all the reset handler hooks,
however the order in which these will run is not always easily predictable.

This patch splits the core of qemu_system_reset() - the invocation of
the reset handlers - out into a new qemu_devices_reset() function.
qemu_system_reset() will usually call qemu_devices_reset(), but that
can be now overriden by a new reset method in the QEMUMachine
structure.

Individual machines can use this reset method, if necessary, to
perform any extra, machine specific initializations which have to
occur before or after the bulk of the reset handlers.  It's expected
that the method will call qemu_devices_reset() at some point, but if
the machine has really strange ordering requirements between devices
resets it could even override that with it's own reset sequence (with
great care, obviously).

For a specific example of when this might be needed: a number of
machines (but not PC) load images specified with -kernel or -initrd
directly into the machine RAM before booting the guest.  This mostly
works at the moment, but to make this actually safe requires that this
load occurs after peripheral devices are reset - otherwise they could
have active DMAs in progress which would clobber the in memory images.
Some machines (notably pseries) also have other entry conditions which
need to be set up as the last thing before executing in guest space -
some of this could be considered "emulated firmware" in the sense that
the actions of the firmware are emulated directly by qemu rather than
by executing a firmware image within the guest.  When the platform's
firmware to OS interface is sufficiently well specified, this saves
time both in implementing the "firmware" and executing it.

aliguori: don't unconditionally dereference current_machine

Reviewed-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: David Gibson &lt;david@gibson.dropbear.id.au&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: c3767ed0eb5d0bb25fe409ae5dec06e3411ff1b6
      https://github.com/qemu/qemu/commit/c3767ed0eb5d0bb25fe409ae5dec06e3411ff1b6
  Author: Lei Li &lt;lilei@linux.vnet.ibm.com&gt;
  Date:   2012-08-16 (Thu, 16 Aug 2012)

  Changed paths:
    M qemu-char.c

  Log Message:
  -----------
  qemu-char: (Re-)connect for tcp_chr_write() unconnected writing

tcp_chr_write() did not deal with writing to an unconnected
connection and return the original length of the data, it's
not right and would cause false writing. So (re-)connect it
and return 0 for this situation.

Reviewed-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Lei Li &lt;lilei@linux.vnet.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 731dc9ecd4f2c3041538f7eb2d10eee0cb82da1b
      https://github.com/qemu/qemu/commit/731dc9ecd4f2c3041538f7eb2d10eee0cb82da1b
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-16 (Thu, 16 Aug 2012)

  Changed paths:
    M VERSION

  Log Message:
  -----------
  Update version to 1.2.0-rc0

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/5a4d701acde8...731dc9ecd4f2

----==_mimepart_502d433c85e41_338410c1aec83395--


</body></email><email><emailId>20120818203007</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-18 20:30:07-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 5f893b: Avoid asprintf() which is not available on mingw</subject><body>



----==_mimepart_502ffb4fbf80d_13d81789af01527b2
Date: Sat, 18 Aug 2012 13:30:07 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;502ffb4fc0a79_13d81789af015282@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 5f893b4e9c207c5a38cf7b141d2c54fa30046afd
      https://github.com/qemu/qemu/commit/5f893b4e9c207c5a38cf7b141d2c54fa30046afd
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-08-18 (Sat, 18 Aug 2012)

  Changed paths:
    M hw/msix.c

  Log Message:
  -----------
  Avoid asprintf() which is not available on mingw

Use g_strdup_printf() instead.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Reviewed-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: d83c951cce14dd3c7600c386d3791c4993744622
      https://github.com/qemu/qemu/commit/d83c951cce14dd3c7600c386d3791c4993744622
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-08-18 (Sat, 18 Aug 2012)

  Changed paths:
    M hw/scsi-bus.c

  Log Message:
  -----------
  scsi: fix warning

hw/scsi-bus.c:758: warning: âxfer' may be used uninitialized in this
function

Isn't true, but older gcc versions (for example 4.1 as shipped in rhel5)
are not clever enougth to figure, so sprinkle in a default: line to make
them happy.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: ff961015529437f4b83fca0a92069aebcf533c9c
      https://github.com/qemu/qemu/commit/ff961015529437f4b83fca0a92069aebcf533c9c
  Author: Markus Armbruster &lt;armbru@redhat.com&gt;
  Date:   2012-08-18 (Sat, 18 Aug 2012)

  Changed paths:
    M vl.c

  Log Message:
  -----------
  vl: Round argument of -m up to multiple of 8KiB

Partial pages make little sense and don't work.  Ensure the RAM size
is a multiple of any possible target's page size.

Fixes

    $ qemu-system-x86_64 -nodefaults -S -vnc :0 -m 0.8
    qemu-system-x86_64: /work/armbru/qemu/exec.c:2255: register_subpage: Assertion \
`existing-&gt;mr-&gt;subpage || existing-&gt;mr == &amp;io_mem_unassigned' failed.

Signed-off-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


  Commit: e89001f72edde37fb36fa7c964daa1bbeb2eca26
      https://github.com/qemu/qemu/commit/e89001f72edde37fb36fa7c964daa1bbeb2eca26
  Author: Markus Armbruster &lt;armbru@redhat.com&gt;
  Date:   2012-08-18 (Sat, 18 Aug 2012)

  Changed paths:
    M hw/pc.c

  Log Message:
  -----------
  pc: Fix RTC CMOS info on RAM for ram_size &lt; 1MiB

pc_cmos_init() always claims 640KiB base memory, and ram_size - 1MiB
extended memory.  The latter can underflow to "lots of extended
memory".  Fix both, and clean up some.

Note: SeaBIOS currently requires 1MiB of RAM, and doesn't check
whether it got enough.

Signed-off-by: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;


Compare: https://github.com/qemu/qemu/compare/731dc9ecd4f2...e89001f72edd

----==_mimepart_502ffb4fbf80d_13d81789af01527b2--


</body></email><email><emailId>20120819140005</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-19 14:00:05-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 682527: Update OpenBIOS images</subject><body>



----==_mimepart_5030f165dc53b_1a7f1252af071233
Date: Sun, 19 Aug 2012 07:00:05 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5030f165dd7a6_1a7f1252af07134d@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 682527c00409d676c0d3b9fac99ca3b2fdfd6d2c
      https://github.com/qemu/qemu/commit/682527c00409d676c0d3b9fac99ca3b2fdfd6d2c
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-08-19 (Sun, 19 Aug 2012)

  Changed paths:
    M pc-bios/README
    M pc-bios/openbios-ppc
    M pc-bios/openbios-sparc32
    M pc-bios/openbios-sparc64

  Log Message:
  -----------
  Update OpenBIOS images

Update OpenBIOS images to SVN r1062. Build with GCC 4.6.0
in order to avoid boot problems introduced by GCC 4.7.[01].

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;




----==_mimepart_5030f165dc53b_1a7f1252af071233--


</body></email><email><emailId>20120822180012</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-22 18:00:12-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 55ce75: eventfd: making it thread safe</subject><body>



----==_mimepart_50351e2c6e6cf_786114b6ae4140376
Date: Wed, 22 Aug 2012 11:00:12 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;50351e2c7022d_786114b6ae4140455@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 55ce75faf253d4369670f60409c608e665e8dde9
      https://github.com/qemu/qemu/commit/55ce75faf253d4369670f60409c608e665e8dde9
  Author: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M iohandler.c

  Log Message:
  -----------
  eventfd: making it thread safe

QEMU uses IO handlers to run select() in the main loop.
The handlers list is managed by qemu_set_fd_handler() helper
which works fine when called from the main thread as it is
called when select() is not waiting.

However IO handlers list can be changed in the thread other than
the main one doing os_host_main_loop_wait(), for example, as a result
of a hypercall which changes PCI config space (VFIO on POWER is the case)
and enables/disabled MSI/MSIX which closes/creates eventfd handles.
As the main loop should be waiting on the newly created eventfds,
it has to be restarted.

The patch adds the qemu_notify_event() call to interrupt select()
to make main_loop() restart select() with the updated IO handlers
list.

Signed-off-by: Alexey Kardashevskiy &lt;aik@ozlabs.ru&gt;
Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 0ec64507a5e6366e6d8070a82c866b935f687ed9
      https://github.com/qemu/qemu/commit/0ec64507a5e6366e6d8070a82c866b935f687ed9
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M hw/i82378.c

  Log Message:
  -----------
  i82378: Remove bogus MMIO coalescing

This MMIO area is an entry gate to legacy PC ISA devices, addressed via
PIO over there. Quite a few of the PIO ports have side effects on access
like starting/stopping timers that must be executed properly ordered
/wrt the CPU. So we have to remove the coalescing mark.

Acked-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Acked-by: Andreas FÃ¤rber &lt;andreas.faerber@web.de&gt;
Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 4144f122b477164cf466ca69be24cf4ef5c218d3
      https://github.com/qemu/qemu/commit/4144f122b477164cf466ca69be24cf4ef5c218d3
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M qemu-ga.c

  Log Message:
  -----------
  qemu-ga: don't leak a file descriptor upon failed lockf

Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 0d07fe47d4986271a21ed4ff5237275ff55dd93f
      https://github.com/qemu/qemu/commit/0d07fe47d4986271a21ed4ff5237275ff55dd93f
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M linux-user/syscall.c

  Log Message:
  -----------
  linux-user: do_msgrcv: don't leak host_mb upon TARGET_EFAULT failure

Also, use g_malloc to avoid NULL-deref upon OOM.

Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: a7e47d4bfcbf256fae06891a8599950ff8e1b61b
      https://github.com/qemu/qemu/commit/a7e47d4bfcbf256fae06891a8599950ff8e1b61b
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M block/sheepdog.c

  Log Message:
  -----------
  sheepdog: don't leak socket file descriptor upon connection failure

Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 396bef4b3846bf4e80a2bee38e9a2d8554d0f251
      https://github.com/qemu/qemu/commit/396bef4b3846bf4e80a2bee38e9a2d8554d0f251
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M target-arm/arm-semi.c

  Log Message:
  -----------
  arm-semi: don't leak 1KB user string lock buffer upon TARGET_SYS_OPEN

Always call unlock_user before returning.

Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 15d9e3bc6af8a56af8c61911aab8453a54795db1
      https://github.com/qemu/qemu/commit/15d9e3bc6af8a56af8c61911aab8453a54795db1
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M softmmu-semi.h

  Log Message:
  -----------
  softmmu-semi: fix lock_user* functions not to deref NULL upon OOM

Return NULL upon malloc failure.

Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: ea776abca628d855e03c4929da3864985afd8aae
      https://github.com/qemu/qemu/commit/ea776abca628d855e03c4929da3864985afd8aae
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M hw/pc_piix.c
    M hw/virtio-blk.c
    M hw/virtio-blk.h

  Log Message:
  -----------
  virtio-blk: hide VIRTIO_BLK_F_CONFIG_WCE from old machine types

QEMU has a policy of keeping a stable guest device ABI.  When new guest device
features are introduced they must not change hardware info seen by existing
guests.  This is important because operating systems or applications may
"fingerprint" the hardware and refuse to run when the hardware changes.  To
always get the latest guest device ABI, run with x86 machine type "pc".

This patch hides the new VIRTIO_BLK_F_CONFIG_WCE virtio feature bit from
existing machine types.  Only pc-1.2 and later will expose this feature
by default.

For more info on the VIRTIO_BLK_F_CONFIG_WCE feature bit, see:

  commit 13e3dce068773c971ff2f19d986378c55897c4a3
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   Thu Aug 9 16:07:19 2012 +0200

      virtio-blk: support VIRTIO_BLK_F_CONFIG_WCE

      Also rename VIRTIO_BLK_F_WCACHE to VIRTIO_BLK_F_WCE for consistency with
      the spec.

      Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
      Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;

Anthony Liguori &lt;aliguori@us.ibm.com&gt; reported:

  This broke qemu-test because it changed the pc-1.0 machine type:

  Setting guest RANDOM seed to 47167
  *** Running tests ***
  Running test /tests/finger-print.sh...		OK
  --- fingerprints/pc-1.0.x86_64	2011-12-18 13:08:40.000000000 -0600
  +++ fingerprint.txt	2012-08-12 13:30:48.000000000 -0500
  @@ -55,7 +55,7 @@
   /sys/bus/pci/devices/0000:00:06.0/subsystem_device=0x0002
   /sys/bus/pci/devices/0000:00:06.0/class=0x010000
   /sys/bus/pci/devices/0000:00:06.0/revision=0x00
  -/sys/bus/pci/devices/0000:00:06.0/virtio/host-features=0x710006d4
  +/sys/bus/pci/devices/0000:00:06.0/virtio/host-features=0x71000ed4
   /sys/class/dmi/id/bios_vendor=Bochs
   /sys/class/dmi/id/bios_date=01/01/2007
   /sys/class/dmi/id/bios_version=Bochs
  Guest fingerprint changed for pc-1.0!

Reported-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 4240abff5a6fb5d88867b51f46c0235518dac564
      https://github.com/qemu/qemu/commit/4240abff5a6fb5d88867b51f46c0235518dac564
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M hw/alpha_typhoon.c
    M hw/bonito.c
    M hw/dec_pci.c
    M hw/grackle_pci.c
    M hw/gt64xxx.c
    M hw/piix_pci.c
    M hw/ppc4xx_pci.c
    M hw/ppce500_pci.c
    M hw/prep_pci.c
    M hw/spapr_pci.c
    M hw/unin_pci.c

  Log Message:
  -----------
  pci: Make host bridge TypeInfos const

During the QOM migration they were amended with further info but this is
no longer the case. All static TypeInfos can be const these days.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Acked-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 94dd91d651fe821971411280f8c64a6b72e8ca64
      https://github.com/qemu/qemu/commit/94dd91d651fe821971411280f8c64a6b72e8ca64
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M hw/alpha_typhoon.c

  Log Message:
  -----------
  alpha_typhoon: QOM'ify Typhoon PCI host bridge

Introduce type constant and cast macro. Don't access DeviceState
or PCIHostState indirectly through parent fields.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Acked-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: c5589ee9745319944886231935680fb8d110e6cb
      https://github.com/qemu/qemu/commit/c5589ee9745319944886231935680fb8d110e6cb
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M hw/bonito.c

  Log Message:
  -----------
  bonito: QOM'ify Bonito PCI host bridge

Introduce type constant. Avoid accessing DeviceState or SysBusDevice
indirectly through PCIHostState field.

Drop global state by passing BonitoState as opaque and adding the IRQs
and a pointer to PCIBonitoState to its state.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Acked-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: ab6153673727cc1b88258675fa02113cf3271aa8
      https://github.com/qemu/qemu/commit/ab6153673727cc1b88258675fa02113cf3271aa8
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M hw/dec_pci.c
    M hw/dec_pci.h

  Log Message:
  -----------
  dec_pci: QOM'ify DEC 21154 PCI-PCI bridge

Introduce type constant. Introduce cast macro and drop dummy busdev
field used with FROM_SYSBUS() that would've broken SYS_BUS_DEVICE().
Avoid accessing parent fields directly.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Acked-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 0e655047c5b394b54ffec6dddf37641b2aa5df55
      https://github.com/qemu/qemu/commit/0e655047c5b394b54ffec6dddf37641b2aa5df55
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M hw/grackle_pci.c
    M hw/ppc_mac.h

  Log Message:
  -----------
  grackle_pci: QOM'ify Grackle PCI host bridge

Introduce type constant. Introduce cast macro to drop dummy busdev field
used with FROM_SYSBUS() that would've broken SYS_BUS_DEVICE().
Avoid accessing parent fields directly.

Drop no-op reset function.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Acked-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 8d43d7e591c2078cc64534b867365d46ad394d04
      https://github.com/qemu/qemu/commit/8d43d7e591c2078cc64534b867365d46ad394d04
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M hw/gt64xxx.c

  Log Message:
  -----------
  gt64xxx: QOM'ify GT64120 PCI host bridge

Introduce type constant. Introduce cast macro to drop dummy busdev field
used with FROM_SYSBUS() macro that would've broken SYS_BUS_DEVICE().
Avoid accessing DeviceState indirectly through PCIHostState.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Acked-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 42c281a2832a67ee1d0cc08744c5b9ebb4f6b802
      https://github.com/qemu/qemu/commit/42c281a2832a67ee1d0cc08744c5b9ebb4f6b802
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M hw/ppc440_bamboo.c
    M hw/ppc4xx.h
    M hw/ppc4xx_pci.c

  Log Message:
  -----------
  ppc4xx_pci: QOM'ify ppc4xx PCI host bridge

Introduce type constant and cast macro. Avoid accessing its parent field
directly.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Acked-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 9c1a61f0e583a0ae3f601465ffa22da5954c9bfc
      https://github.com/qemu/qemu/commit/9c1a61f0e583a0ae3f601465ffa22da5954c9bfc
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M hw/ppce500_pci.c

  Log Message:
  -----------
  ppce500_pci: QOM'ify e500 PCI host bridge

Introduce type constant and cast macro. Avoid accessing parent fields
directly.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Acked-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 03a6b667702b0af0e7b36754489aed6aa82d30a1
      https://github.com/qemu/qemu/commit/03a6b667702b0af0e7b36754489aed6aa82d30a1
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M hw/prep_pci.c

  Log Message:
  -----------
  prep_pci: QOM'ify Raven PCI host bridge

Introduce type constant and cast macro. Avoid accessing parent fields
directly.

Also add missing space and braces.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Acked-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 8c9f64df3dd76c253e4961c5d2f075bffcc29e1d
      https://github.com/qemu/qemu/commit/8c9f64df3dd76c253e4961c5d2f075bffcc29e1d
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M hw/spapr.c
    M hw/spapr_pci.c
    M hw/spapr_pci.h

  Log Message:
  -----------
  spapr_pci: QOM'ify sPAPR PCI host bridge

Introduce type constant. Introduce cast macro to drop bogus busdev field
that would've broken SYS_BUS_DEVICE(). Avoid accessing parent fields
directly.

Free the identifier phb as acronym for PCI_HOST_BRIDGE.

Updated against conflicting merge from branch 'agraf/ppc-for-upstream'
(0d16fdd732d1b211842fa96b7c90ddf9e6bde0e4), which removed busdev field
differently, moved some code around and added new occurrences of 'phb'.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 57fd7b7fce9098cdac58a8442033cb91412400b9
      https://github.com/qemu/qemu/commit/57fd7b7fce9098cdac58a8442033cb91412400b9
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M hw/unin_pci.c

  Log Message:
  -----------
  unin_pci: QOM'ify UniNorth PCI host bridges

Introduce type constants and cast macros.
Avoid accessing parent fields directly.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Acked-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: b44ff9d430c5f2b51872f542d9562a15f0061a82
      https://github.com/qemu/qemu/commit/b44ff9d430c5f2b51872f542d9562a15f0061a82
  Author: Andreas FÃ¤rber &lt;andreas.faerber@web.de&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M hw/pci_host.c
    M hw/pci_host.h

  Log Message:
  -----------
  pci_host: Turn into SysBus-derived QOM type

The preceding commits fixed misuses of FROM_SYSBUS() that led people to
add a bogus busdev field. For qdev the field order was less relevant but
for QOM the PCIHostState field (including the SysBusDevice actually
initialized with a value) must be placed first within the state struct.

To facilitate accessing the PCIHostState fields, derive all PCI host
bridges from TYPE_PCI_HOST_BRIDGE rather than TYPE_SYS_BUS_DEVICE.

We can now access PCIHostState QOM-style, with PCI_HOST_BRIDGE() macro.

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Wanpeng Li &lt;liwanp@linux.vnet.ibm.com&gt;
Signed-off-by: Andreas FÃ¤rber &lt;andreas.faerber@web.de&gt;
Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Acked-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 8558d942b665a9ff0847851615e107308f6386a5
      https://github.com/qemu/qemu/commit/8558d942b665a9ff0847851615e107308f6386a5
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M hw/alpha_typhoon.c
    M hw/bonito.c
    M hw/dec_pci.c
    M hw/grackle_pci.c
    M hw/gt64xxx.c
    M hw/piix_pci.c
    M hw/ppc4xx_pci.c
    M hw/ppc_prep.c
    M hw/ppce500_pci.c
    M hw/prep_pci.c
    M hw/spapr.c
    M hw/spapr_pci.c
    M hw/unin_pci.c

  Log Message:
  -----------
  pci: Derive PCI host bridges from TYPE_PCI_HOST_BRIDGE

Use PCIHostState and PCI_HOST_BRIDGE() where appropriate.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 67c332fd12326a6ef572f07b9d71370ada6a287f
      https://github.com/qemu/qemu/commit/67c332fd12326a6ef572f07b9d71370ada6a287f
  Author: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M hw/alpha_typhoon.c
    M hw/dec_pci.c
    M hw/grackle_pci.c
    M hw/gt64xxx.c
    M hw/piix_pci.c
    M hw/ppc4xx_pci.c
    M hw/ppce500_pci.c
    M hw/prep_pci.c
    M hw/spapr_pci.h
    M hw/unin_pci.c

  Log Message:
  -----------
  pci: Tidy up PCI host bridges

Adopt the QOM parent field name and enforce QOM-style access via casts.
Don't just typedef PCIHostState, either use it directly or embed it.

Signed-off-by: Andreas FÃ¤rber &lt;afaerber@suse.de&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 99afc91d6ccdbe45258cff66fd0ce0142820c366
      https://github.com/qemu/qemu/commit/99afc91d6ccdbe45258cff66fd0ce0142820c366
  Author: Daniel P. Berrange &lt;berrange@redhat.com&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M arch_init.c
    M configure
    M qapi-schema.json
    M qmp-commands.hx

  Log Message:
  -----------
  qapi: add 'query-target' command to return target arch

Add a 'query-target' QAPI command to allow management applications
to determine what target architecture a QEMU binary is emulating
without having to parse the binary name or -help output

  $ qmp-shell -p /tmp/qemu
  (QEMU) query-target
  {   u'return': {   u'arch': u'x86_64' }}

Signed-off-by: Daniel P. Berrange &lt;berrange@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/682527c00409...99afc91d6ccd

----==_mimepart_50351e2c6e6cf_786114b6ae4140376--


</body></email><email><emailId>20120822200014</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-22 20:00:14-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] c19537: usb: async control xfer fixup</subject><body>



----==_mimepart_50353a4ed7fe2_68691277ae4669ef
Date: Wed, 22 Aug 2012 13:00:14 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50353a4ede390_68691277ae46709b@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: c19537a1143d493897850576394f082914f39ef1
      https://github.com/qemu/qemu/commit/c19537a1143d493897850576394f082914f39ef1
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/usb/core.c
    M hw/usb/host-linux.c

  Log Message:
  -----------
  usb: async control xfer fixup

Need to clear p-&gt;result after copying setup data using usb_packet_copy()
because we'll reuse the USBPacket for the data transfer.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 0daf53047da0b817e40c4931580e59e73b420f41
      https://github.com/qemu/qemu/commit/0daf53047da0b817e40c4931580e59e73b420f41
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/usb/dev-uas.c

  Log Message:
  -----------
  usb: update uas product id

Pick other product id to fix clash with audio.

Current usage list (after applying this patch):

46f4:0001 -- usb-storage
46f4:0002 -- usb-audio
46f4:0003 -- usb-uas

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 6d3b6d3d2deaf682def95e3e512ad0e17f02274f
      https://github.com/qemu/qemu/commit/6d3b6d3d2deaf682def95e3e512ad0e17f02274f
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-08-15 (Wed, 15 Aug 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: fix Interrupt Threshold Control implementation

First, not all interrupts are subject to Interrupt Threshold Control,
some of them must be delivered without delay.

Second, Interrupt Threshold Control state must be part of vmstate,
otherwise we might loose IRQs on migration.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 47d073cc3b8ad4a3ef1dba7055b35a87fa4091ff
      https://github.com/qemu/qemu/commit/47d073cc3b8ad4a3ef1dba7055b35a87fa4091ff
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-08-16 (Thu, 16 Aug 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Fix setting of halt bit from usbcmd register updates

This fixes linux guests started without any USB devices not seeing newly
plugged devices until "lsusb" is done inside the guest.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 7a736bfa4e0a58087054cad68a1d4b3804bbb708
      https://github.com/qemu/qemu/commit/7a736bfa4e0a58087054cad68a1d4b3804bbb708
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-08-17 (Fri, 17 Aug 2012)

  Changed paths:
    M block/vmdk.c

  Log Message:
  -----------
  vmdk: Fix header structure

Commit bb45ded9 swapped gd_offset and rgd_offset. This is wrong.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 65bd155c7356d448ffee7f89149c4d473076b0ba
      https://github.com/qemu/qemu/commit/65bd155c7356d448ffee7f89149c4d473076b0ba
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-08-17 (Fri, 17 Aug 2012)

  Changed paths:
    M block/vmdk.c

  Log Message:
  -----------
  vmdk: Read footer for streamOptimized images

The footer takes precedence over the header when it exists. It contains
the real grain directory offset that is missing in the header. Without
this patch, streamOptimized images with a footer cannot be read.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;
Reviewed-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Reviewed-by: Jeff Cody &lt;jcody@redhat.com&gt;


  Commit: 48467328c6dccc9c7be6628ed0ef0810f83be2a9
      https://github.com/qemu/qemu/commit/48467328c6dccc9c7be6628ed0ef0810f83be2a9
  Author: Kevin Wolf &lt;kwolf@redhat.com&gt;
  Date:   2012-08-17 (Fri, 17 Aug 2012)

  Changed paths:
    M qemu-img.texi

  Log Message:
  -----------
  Documentation: Warn against qemu-img on active image

People have repeatedly expected that you can do things like snapshotting
an image with qemu-img while a qemu instance is running. Maybe we need
to consider locking the files while they are in use, but having a
warning in the qemu-img manpage is doable for 1.2 and can't hurt anyway.

Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: eec7f96c2cac88f59fd8c79b78a6e027df4abfb2
      https://github.com/qemu/qemu/commit/eec7f96c2cac88f59fd8c79b78a6e027df4abfb2
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-08-17 (Fri, 17 Aug 2012)

  Changed paths:
    M hw/pc_piix.c
    M hw/virtio-blk.c
    M hw/virtio-blk.h
    M hw/virtio-pci.c

  Log Message:
  -----------
  virtio-blk: hide VIRTIO_BLK_F_CONFIG_WCE from old machine types

QEMU has a policy of keeping a stable guest device ABI.  When new guest device
features are introduced they must not change hardware info seen by existing
guests.  This is important because operating systems or applications may
"fingerprint" the hardware and refuse to run when the hardware changes.  To
always get the latest guest device ABI, run with x86 machine type "pc".

This patch hides the new VIRTIO_BLK_F_CONFIG_WCE virtio feature bit from
existing machine types.  Only pc-1.2 and later will expose this feature
by default.

For more info on the VIRTIO_BLK_F_CONFIG_WCE feature bit, see:

  commit 13e3dce068773c971ff2f19d986378c55897c4a3
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   Thu Aug 9 16:07:19 2012 +0200

      virtio-blk: support VIRTIO_BLK_F_CONFIG_WCE

      Also rename VIRTIO_BLK_F_WCACHE to VIRTIO_BLK_F_WCE for consistency with
      the spec.

      Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
      Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;

Anthony Liguori &lt;aliguori@us.ibm.com&gt; reported:

  This broke qemu-test because it changed the pc-1.0 machine type:

  Setting guest RANDOM seed to 47167
  *** Running tests ***
  Running test /tests/finger-print.sh...		OK
  --- fingerprints/pc-1.0.x86_64	2011-12-18 13:08:40.000000000 -0600
  +++ fingerprint.txt	2012-08-12 13:30:48.000000000 -0500
  @@ -55,7 +55,7 @@
   /sys/bus/pci/devices/0000:00:06.0/subsystem_device=0x0002
   /sys/bus/pci/devices/0000:00:06.0/class=0x010000
   /sys/bus/pci/devices/0000:00:06.0/revision=0x00
  -/sys/bus/pci/devices/0000:00:06.0/virtio/host-features=0x710006d4
  +/sys/bus/pci/devices/0000:00:06.0/virtio/host-features=0x71000ed4
   /sys/class/dmi/id/bios_vendor=Bochs
   /sys/class/dmi/id/bios_date=01/01/2007
   /sys/class/dmi/id/bios_version=Bochs
  Guest fingerprint changed for pc-1.0!

Reported-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: b20909195745c34a819aed14ae996b60ab0f591f
      https://github.com/qemu/qemu/commit/b20909195745c34a819aed14ae996b60ab0f591f
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-08-20 (Mon, 20 Aug 2012)

  Changed paths:
    M block/iscsi.c

  Log Message:
  -----------
  Revert "iscsi: Fix NULL dereferences / races between task completion and abort"

This reverts commit 64e69e80920d82df3fa679bc41b13770d2f99360.  The commit
returned immediately from iscsi_aio_cancel, risking corruption in case the
following happens:

    guest                  qemu                 target
  =========================================================================
    send write 1 --------&gt;
                     send write 1 --------&gt;
    cancel write 1 ------&gt;
                     cancel write 1 ------&gt;
       &lt;------------------ cancellation processed
    send write 2 --------&gt;
                     send write 2 --------&gt;
                         &lt;---------------- completed write 2
       &lt;------------------ completed write 2
                         &lt;---------------- completed write 1
                         &lt;---------------- cancellation not done

Here, the guest would see write 2 superseding write 1, when in fact the
outcome could have been the opposite.  The right behavior is to return
only after the target says whether the cancellation was done or not, and
it will be implemented by the next three patches.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 27cbd828c617944c0f9603763fdf4fa87e7ad923
      https://github.com/qemu/qemu/commit/27cbd828c617944c0f9603763fdf4fa87e7ad923
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-08-20 (Mon, 20 Aug 2012)

  Changed paths:
    M block/iscsi.c

  Log Message:
  -----------
  iscsi: move iscsi_schedule_bh and iscsi_readv_writev_bh_cb

Put these functions at the beginning, to avoid forward references
in the next patches.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: cfb3f5064af2d2e29c976e292c9472dfe9d61e31
      https://github.com/qemu/qemu/commit/cfb3f5064af2d2e29c976e292c9472dfe9d61e31
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-08-20 (Mon, 20 Aug 2012)

  Changed paths:
    M block/iscsi.c

  Log Message:
  -----------
  iscsi: simplify iscsi_schedule_bh

It is always used with the same callback, remove the argument.  And
its return value is never used, assume allocation succeeds.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 1bd075f29ea6d11853475c7c42734595720c3ac6
      https://github.com/qemu/qemu/commit/1bd075f29ea6d11853475c7c42734595720c3ac6
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-08-20 (Mon, 20 Aug 2012)

  Changed paths:
    M block/iscsi.c

  Log Message:
  -----------
  iscsi: fix races between task completion and abort

This patch fixes two main issues with block/iscsi.c:

1) iscsi_task_mgmt_abort_task_async calls iscsi_scsi_task_cancel which
was also directly called in iscsi_aio_cancel

2) a race between task completion and task abortion could happen cause
the scsi_free_scsi_task were done before iscsi_schedule_bh has finished.
To fix this, all the freeing of IscsiTasks and releasing of the AIOCBs
is centralized in iscsi_bh_cb, independent of whether the SCSI command
has completed or was cancelled.

3) iscsi_aio_cancel was not synchronously waiting for the end of the
command.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 07a5298c3067ed63f7d82d8c1a6f479146447289
      https://github.com/qemu/qemu/commit/07a5298c3067ed63f7d82d8c1a6f479146447289
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-08-20 (Mon, 20 Aug 2012)

  Changed paths:
    M hw/pc_piix.c
    M hw/virtio-scsi.c
    M hw/virtio-scsi.h

  Log Message:
  -----------
  virtio-scsi: add backwards-compatibility properties for 1.1 and earlier machines

Hotplug and parameter change are new in 1.2, disable them via compat
properties for pc-1.1 and earlier.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: e36c87667aa2204a3f19efe7bbcb6eb41f098e40
      https://github.com/qemu/qemu/commit/e36c87667aa2204a3f19efe7bbcb6eb41f098e40
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-08-20 (Mon, 20 Aug 2012)

  Changed paths:
    M qapi/opts-visitor.c

  Log Message:
  -----------
  qapi: Fix memory leak

valgrind report:

==24534== 232 bytes in 2 blocks are definitely lost in loss record 1,245 of 1,601
==24534==    at 0x4824F20: malloc (vg_replace_malloc.c:236)
==24534==    by 0x293C88: malloc_and_trace (vl.c:2281)
==24534==    by 0x489AD99: ??? (in /lib/libglib-2.0.so.0.2400.1)
==24534==    by 0x489B23B: g_malloc0 (in /lib/libglib-2.0.so.0.2400.1)
==24534==    by 0x2B4EFC: opts_visitor_new (opts-visitor.c:376)
==24534==    by 0x29DEA5: net_client_init (net.c:708)
==24534==    by 0x29E6C7: net_init_client (net.c:966)
==24534==    by 0x2C2179: qemu_opts_foreach (qemu-option.c:1114)
==24534==    by 0x29E85B: net_init_clients (net.c:1008)
==24534==    by 0x296F40: main (vl.c:3463)

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Reviewed-by: Laszlo Ersek &lt;lersek@redhat.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: b2dc64c391843f6499069f0ba77ad0a8c9560c86
      https://github.com/qemu/qemu/commit/b2dc64c391843f6499069f0ba77ad0a8c9560c86
  Author: Blue Swirl &lt;blauwirbel@gmail.com&gt;
  Date:   2012-08-20 (Mon, 20 Aug 2012)

  Changed paths:
    M monitor.c

  Log Message:
  -----------
  monitor: avoid declaring unused variables

Some variables are only used on !win32, declare
them only when used.

This avoids a warning in mingw32 build:
  CC    i386-softmmu/monitor.o
/src/qemu/monitor.c: In function 'monitor_fdset_get_fd':
/src/qemu/monitor.c:2575: warning: unused variable 'mon_fd_flags'
/src/qemu/monitor.c:2574: warning: unused variable 'mon_fdset_fd'
/src/qemu/monitor.c:2573: warning: unused variable 'mon_fdset'

Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Reviewed-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 7aa939af39e20eeca98fced59708a87c64267f54
      https://github.com/qemu/qemu/commit/7aa939af39e20eeca98fced59708a87c64267f54
  Author: Juan Quintela &lt;quintela@redhat.com&gt;
  Date:   2012-08-21 (Tue, 21 Aug 2012)

  Changed paths:
    M hmp.c
    M migration.c
    M qapi-schema.json
    M qmp-commands.hx

  Log Message:
  -----------
  migration: move total_time from ram stats to migration info

Signed-off-by: Juan Quintela &lt;quintela@redhat.com&gt;
Signed-off-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;


  Commit: 27b7652ef515bb4c694f79d657d2052c72b19536
      https://github.com/qemu/qemu/commit/27b7652ef515bb4c694f79d657d2052c72b19536
  Author: Frediano Ziglio &lt;frediano.ziglio@citrix.com&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M xen-mapcache.c

  Log Message:
  -----------
  Fix invalidate if memory requested was not bucket aligned

When memory is mapped in qemu_map_cache with lock != 0 a reverse mapping
is created pointing to the virtual address of location requested.
The cached mapped entry is saved in last_address_vaddr with the memory
location of the base virtual address (without bucket offset).
However when this entry is invalidated the virtual address saved in the
reverse mapping is used. This cause that the mapping is freed but the
last_address_vaddr is not reset.

Signed-off-by: Frediano Ziglio &lt;frediano.ziglio@citrix.com&gt;
Signed-off-by: Stefano Stabellini &lt;stefano.stabellini@eu.citrix.com&gt;


  Commit: 14d40183725361e6350166099556c7661063921b
      https://github.com/qemu/qemu/commit/14d40183725361e6350166099556c7661063921b
  Author: Dongxiao Xu &lt;dongxiao.xu@intel.com&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M xen-all.c

  Log Message:
  -----------
  xen-all.c: fix multiply issue for int and uint types

If the two multiply operands are int and uint types separately,
the int type will be transformed to uint firstly, which is not the
intent in our code piece. The fix is to add (int64_t) transform
for the uint type before the multiply.

Signed-off-by: Dongxiao Xu &lt;dongxiao.xu@intel.com&gt;
Signed-off-by: Stefano Stabellini &lt;stefano.stabellini@eu.citrix.com&gt;


  Commit: b6825cd79cdf3e2006c22bb8cfe47a0d7c5209fa
      https://github.com/qemu/qemu/commit/b6825cd79cdf3e2006c22bb8cfe47a0d7c5209fa
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M hw/usb/core.c
    M hw/usb/dev-uas.c
    M hw/usb/hcd-ehci.c
    M hw/usb/host-linux.c

  Log Message:
  -----------
  Merge remote-tracking branch 'kraxel/usb.59' into staging

* kraxel/usb.59:
  ehci: Fix setting of halt bit from usbcmd register updates
  ehci: fix Interrupt Threshold Control implementation
  usb: update uas product id
  usb: async control xfer fixup


  Commit: 7b2f89c435f895431d55b675dc412275c2069314
      https://github.com/qemu/qemu/commit/7b2f89c435f895431d55b675dc412275c2069314
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M block/vmdk.c
    M hw/virtio-blk.h
    M hw/virtio-pci.c
    M qemu-img.texi

  Log Message:
  -----------
  Merge remote-tracking branch 'kwolf/for-anthony' into staging

* kwolf/for-anthony:
  virtio-blk: hide VIRTIO_BLK_F_CONFIG_WCE from old machine types
  Documentation: Warn against qemu-img on active image
  vmdk: Read footer for streamOptimized images
  vmdk: Fix header structure

Conflicts:
	hw/virtio-blk.c


  Commit: a9b670b139ed381bd07df08bdfdcb515dff3ca8c
      https://github.com/qemu/qemu/commit/a9b670b139ed381bd07df08bdfdcb515dff3ca8c
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M block/iscsi.c
    M hw/pc_piix.c
    M hw/virtio-scsi.c
    M hw/virtio-scsi.h

  Log Message:
  -----------
  Merge remote-tracking branch 'bonzini/scsi-next' into staging

* bonzini/scsi-next:
  virtio-scsi: add backwards-compatibility properties for 1.1 and earlier machines
  iscsi: fix races between task completion and abort
  iscsi: simplify iscsi_schedule_bh
  iscsi: move iscsi_schedule_bh and iscsi_readv_writev_bh_cb
  Revert "iscsi: Fix NULL dereferences / races between task completion and abort"


  Commit: b100fcfe4966aa41d4d6908d0c4c510bcf8f82dd
      https://github.com/qemu/qemu/commit/b100fcfe4966aa41d4d6908d0c4c510bcf8f82dd
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M xen-all.c
    M xen-mapcache.c

  Log Message:
  -----------
  Merge remote-tracking branch 'sstabellini/xen-fixes-20120822' into staging

* sstabellini/xen-fixes-20120822:
  xen-all.c: fix multiply issue for int and uint types
  Fix invalidate if memory requested was not bucket aligned


  Commit: 86759aa89d1307d0dda2435cc25943bcd7026686
      https://github.com/qemu/qemu/commit/86759aa89d1307d0dda2435cc25943bcd7026686
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M hmp.c
    M migration.c
    M monitor.c
    M qapi-schema.json
    M qapi/opts-visitor.c
    M qmp-commands.hx

  Log Message:
  -----------
  Merge remote-tracking branch 'qmp/queue/qmp' into staging

* qmp/queue/qmp:
  migration: move total_time from ram stats to migration info
  monitor: avoid declaring unused variables
  qapi: Fix memory leak


Compare: https://github.com/qemu/qemu/compare/99afc91d6ccd...86759aa89d13

----==_mimepart_50353a4ed7fe2_68691277ae4669ef--


</body></email><email><emailId>20120823153009</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-23 15:30:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] af506c: Update version for 1.2.0-rc1 release</subject><body>



----==_mimepart_50364c8125324_586415d2af4929e4
Date: Thu, 23 Aug 2012 08:30:09 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50364c8127173_586415d2af493091@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: af506c7036003a4a860e23e694034b9a914d1d2f
      https://github.com/qemu/qemu/commit/af506c7036003a4a860e23e694034b9a914d1d2f
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M VERSION

  Log Message:
  -----------
  Update version for 1.2.0-rc1 release

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: b4a738bf93c3137b92d532e59d60edccc4e1ea96
      https://github.com/qemu/qemu/commit/b4a738bf93c3137b92d532e59d60edccc4e1ea96
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-22 (Wed, 22 Aug 2012)

  Changed paths:
    M hw/Makefile.objs
    A hw/null-machine.c

  Log Message:
  -----------
  boards: add a 'none' machine type to all platforms

This allows any QEMU binary to be executed with:

  $QEMU_BINARY -M none -qmp stdio

Without errors from missing options that are required by various boards.  This
also provides a mode that we can use in the future to construct machines
entirely through QMP commands.

Cc: Daniel Berrange &lt;berrange@redhat.com&gt;
Cc: Markus Armbruster &lt;armbru@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 58617a795c8067b2f9800cffce60f38707d3aa31
      https://github.com/qemu/qemu/commit/58617a795c8067b2f9800cffce60f38707d3aa31
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-23 (Thu, 23 Aug 2012)

  Changed paths:
    M monitor.c

  Log Message:
  -----------
  monitor: move json init from OPEN event to init

At some point in the past, the OPEN event was changed to be issued from a
bottom half.  This creates a small window whereas a data callback registered in
init may be invoked before the OPEN event has been issued.

This is reproducible with:

 echo "{'execute': 'qmp_capabilities'}" | qemu-system-x86_64 -M none -qmp stdio

We can fix this for the monitor by moving the parser initialization to init.

The remaining state that is set in OPEN appears harmless.

Reported-by: Daniel Berrange &lt;berrange@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 94159135cb59684853dcd45ff70d6dbc54a29209
      https://github.com/qemu/qemu/commit/94159135cb59684853dcd45ff70d6dbc54a29209
  Author: Meador Inge &lt;meadori@codesourcery.com&gt;
  Date:   2012-08-23 (Thu, 23 Aug 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Enable access to required RDHWR hardware registers

While running in the usermode emulator all of the required*
MIPS32r2 RDHWR hardware registers should be accessible (the
Linux kernel enables access to these same registers).  Note
that these registers are still enabled when the MIPS ISA is
not release 2.  This is OK since the Linux kernel emulates
access to them when they are not available in hardware.

* There is also the ULR register which is only recommended
  for full release 2 compliance.  Incidentally, accessing
  this register in the current implementation works fine
  without flipping its access bit.

Signed-off-by: Meador Inge &lt;meadori@codesourcery.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


Compare: https://github.com/qemu/qemu/compare/86759aa89d13...94159135cb59

----==_mimepart_50364c8125324_586415d2af4929e4--


</body></email><email><emailId>201208231530090</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-23 15:30:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 4082e8: s390x: fix s390 virtio aliases</subject><body>



----==_mimepart_50364c8174dda_44ca1521aec399b2
Date: Thu, 23 Aug 2012 08:30:09 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50364c8176795_44ca1521aec400e3@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/stable-1.1
  Home:   https://github.com/qemu/qemu
  Commit: 4082e889ee8aa43b303105180399bab14312231e
      https://github.com/qemu/qemu/commit/4082e889ee8aa43b303105180399bab14312231e
  Author: Alexander Graf &lt;agraf@suse.de&gt;
  Date:   2012-07-10 (Tue, 10 Jul 2012)

  Changed paths:
    M hw/qdev-monitor.c

  Log Message:
  -----------
  s390x: fix s390 virtio aliases

Some of the virtio devices have the same frontend name, but actually
implement different devices behind the scenes through aliases.

The indicator which device type to use is the architecture. On s390, we
want s390 virtio devices. On everything else, we want PCI devices.

Reflect this in the alias selection code. This way we fix commands like
-device virtio-blk on s390x which with this patch applied select the
correct virtio-blk-s390 device rather than virtio-blk-pci.

Reported-by: Christian Borntraeger &lt;borntraeger@de.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
Signed-off-by: Alexander Graf &lt;agraf@suse.de&gt;


  Commit: f52d0d639e96f30b226b853d931881d034c57308
      https://github.com/qemu/qemu/commit/f52d0d639e96f30b226b853d931881d034c57308
  Author: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
  Date:   2012-07-10 (Tue, 10 Jul 2012)

  Changed paths:
    M hw/qdev-monitor.c

  Log Message:
  -----------
  Merge remote-tracking branch 'agraf/s390-for-upstream-1.1' into HEAD


  Commit: 785adb09b9fd0d4df6707f00247ec519c42fcfc6
      https://github.com/qemu/qemu/commit/785adb09b9fd0d4df6707f00247ec519c42fcfc6
  Author: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
  Date:   2012-07-12 (Thu, 12 Jul 2012)

  Changed paths:
    M VERSION

  Log Message:
  -----------
  update VERSION for v1.1.1

Signed-off-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/b7093f294c33...785adb09b9fd

----==_mimepart_50364c8174dda_44ca1521aec399b2--


</body></email><email><emailId>20120823153015</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-23 15:30:15-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu]</subject><body>



----==_mimepart_50364c873f9af_6b09fb1ae4311b
Date: Thu, 23 Aug 2012 08:30:15 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;50364c8740e16_6b09fb1ae431210@sh2.rs.github.com.mail&gt;

  Branch: refs/tags/v1.2.0-rc1
  Home:   https://github.com/qemu/qemu


----==_mimepart_50364c873f9af_6b09fb1ae4311b--


</body></email><email><emailId>20120823233008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-23 23:30:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 6fc97f: target-mips: Fix some helper functions (VR54xx mul...</subject><body>



----==_mimepart_5036bd0080cd7_52111747aec264ef
Date: Thu, 23 Aug 2012 16:30:08 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5036bd0081fb7_52111747aec2654e@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 6fc97fafce05eee76479ca6d289241772d21b370
      https://github.com/qemu/qemu/commit/6fc97fafce05eee76479ca6d289241772d21b370
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-08-23 (Thu, 23 Aug 2012)

  Changed paths:
    M target-mips/op_helper.c

  Log Message:
  -----------
  target-mips: Fix some helper functions (VR54xx multiplication)

Commits b5dc7732e1cc2fb549e48b7b5d664f2c79628e2e and
be24bb4f3007c3e07cbf1934f7e781493d876ab7 optimized the code
and removed the correct setting of t0. Fix this.

gcc-4.7 detected this bug because parameter arg1 was unused
but set in set_HIT0_LO and set_HI_LOT0.

Cc: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;




----==_mimepart_5036bd0080cd7_52111747aec264ef--


</body></email><email><emailId>20120824013007</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-24 01:30:07-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 26efac: monitor: don't try to initialize json parser when ...</subject><body>



----==_mimepart_5036d91f359ab_79291746ae81506a5
Date: Thu, 23 Aug 2012 18:30:07 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5036d91f377de_79291746ae815077@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 26efaca377e004b79ff50a6e936d029a0c095b8b
      https://github.com/qemu/qemu/commit/26efaca377e004b79ff50a6e936d029a0c095b8b
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-23 (Thu, 23 Aug 2012)

  Changed paths:
    M monitor.c

  Log Message:
  -----------
  monitor: don't try to initialize json parser when monitor is HMP

Reported-by: Michael Roth &lt;mdroth@linux.vnet.ibm.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: da5a44e8b0b727681fc33e8d94832d1cae48a788
      https://github.com/qemu/qemu/commit/da5a44e8b0b727681fc33e8d94832d1cae48a788
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-08-23 (Thu, 23 Aug 2012)

  Changed paths:
    M hw/acpi_piix4.c
    M hw/qdev.c
    M hw/shpc.c
    M hw/xen_platform.c
    M qom/object.c

  Log Message:
  -----------
  qom: object_delete should unparent the object first

object_deinit is only called when the reference count goes to zero,
and yet tries to do an object_unparent.  Now, object_unparent
either does nothing or it will decrease the reference count.
Because we know the reference count is zero, the object_unparent
call in object_deinit is useless.

Instead, we need to disconnect the object from its parent just
before we remove the last reference apart from the parent's.  This
happens in object_delete.  Once we do this, all calls to
object_unparent peppered through QEMU can go away.

Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 98609cd8fcf755c0ba7049d751353b8b2e243b65
      https://github.com/qemu/qemu/commit/98609cd8fcf755c0ba7049d751353b8b2e243b65
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-08-23 (Thu, 23 Aug 2012)

  Changed paths:
    M hw/ivshmem.c

  Log Message:
  -----------
  ivshmem: fix memory_region_del_eventfd assertion failure

We do not register ioeventfds unless the IVSHMEM_IOEVENTFD feature
is set.  The same feature must be checked before releasing the eventfds.
Regression introduced by commit 563027c (ivshmem: use EventNotifier and
memory API, 2012-07-05).

Reported-by: Cam Macdonnell &lt;cam@cs.ualberta.ca&gt;
Tested-by: Cam Macdonnell &lt;cam@cs.ualberta.ca&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/6fc97fafce05...98609cd8fcf7

----==_mimepart_5036d91f359ab_79291746ae81506a5--


</body></email><email><emailId>20120824040007</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-24 04:00:07-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 145c7c: fix some debug printf format strings</subject><body>



----==_mimepart_5036fc477b9cd_11bf130aaec105338
Date: Thu, 23 Aug 2012 21:00:07 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5036fc477e066_11bf130aaec1054a8@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 145c7c880ff520a9348cc2401ba291330b9606fe
      https://github.com/qemu/qemu/commit/145c7c880ff520a9348cc2401ba291330b9606fe
  Author: Matthew Ogilvie &lt;mmogilvi_qemu@miniinfo.net&gt;
  Date:   2012-08-23 (Thu, 23 Aug 2012)

  Changed paths:
    M hw/cirrus_vga.c
    M hw/i8259.c
    M hw/ide/cmd646.c
    M hw/ide/via.c

  Log Message:
  -----------
  fix some debug printf format strings

These are normally ifdefed out and don't matter.  But if you enable
them, they ought to be correct.

Signed-off-by: Matthew Ogilvie &lt;mmogilvi_qemu@miniinfo.net&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;


  Commit: 5c73b757e3aa80dc84352b2ede0d8bdea5419f6d
      https://github.com/qemu/qemu/commit/5c73b757e3aa80dc84352b2ede0d8bdea5419f6d
  Author: Matthew Ogilvie &lt;mmogilvi_qemu@miniinfo.net&gt;
  Date:   2012-08-23 (Thu, 23 Aug 2012)

  Changed paths:
    M target-i386/translate.c

  Log Message:
  -----------
  target-i386/translate.c: mov to/from crN/drN: ignore mod bits

&gt; This instruction is always treated as a register-to-register (MOD = 11)
&gt; instruction, regardless of the encoding of the MOD field in the MODR/M
&gt; byte.

Also, Microport UNIX System V/386 v 2.1 (ca 1987) runs fine on
real Intel 386 and 486 CPU's (at least), but does not run in qemu without
this patch.

Signed-off-by: Matthew Ogilvie &lt;mmogilvi_qemu@miniinfo.net&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;


  Commit: 7764ae9671f1cd74227cf4404431dd5213799ef0
      https://github.com/qemu/qemu/commit/7764ae9671f1cd74227cf4404431dd5213799ef0
  Author: Matthew Ogilvie &lt;mmogilvi_qemu@miniinfo.net&gt;
  Date:   2012-08-23 (Thu, 23 Aug 2012)

  Changed paths:
    M vl.c

  Log Message:
  -----------
  vl: fix -hdachs/-hda argument order parsing issues

Without this patch, the -hdachs argument had to occur either
BEFORE the corresponding "-hda" option, or AFTER the plain
disk image name (if neither -hda nor -drive is used).  Otherwise
it would effectively be ignored.

Option -hdachs still has no effect on -drive, but that seems best.

Signed-off-by: Matthew Ogilvie &lt;mmogilvi_qemu@miniinfo.net&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;


  Commit: 39dda260628e5f2a3fd2ce2ec8a71f3d5ca309a9
      https://github.com/qemu/qemu/commit/39dda260628e5f2a3fd2ce2ec8a71f3d5ca309a9
  Author: Matthew Ogilvie &lt;mmogilvi_qemu@miniinfo.net&gt;
  Date:   2012-08-23 (Thu, 23 Aug 2012)

  Changed paths:
    M qemu-options.hx

  Log Message:
  -----------
  qemu-options.hx: mention retrace= VGA option

The feature was added in commit cb5a7aa8c32141bb Sep 2008.
My description is based on "Better VGA retrace emulation (needed
for some DOS games/demos)" from
http://www.boblycat.org/~malc/code/patches/qemu/index.html

Signed-off-by: Matthew Ogilvie &lt;mmogilvi_qemu@miniinfo.net&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;


  Commit: 482f7bf86b43af9f6903c52726fedf82b28bf953
      https://github.com/qemu/qemu/commit/482f7bf86b43af9f6903c52726fedf82b28bf953
  Author: Matthew Ogilvie &lt;mmogilvi_qemu@miniinfo.net&gt;
  Date:   2012-08-23 (Thu, 23 Aug 2012)

  Changed paths:
    M hw/pc.h
    M hw/vga.c
    M qemu-options.hx
    M vl.c

  Log Message:
  -----------
  vga: add some optional CGA compatibility hacks

This patch adds some optional compatibility hacks (default
disabled) to allow Microport UNIX to function under qemu.

I've tried to structure it to be easy to add more hacks for other
old CGA programs, if anyone ever needs them.

Microport UNIX System V/386 v 2.1 (ca 1987) tries to program
the CGA registers directly with neither the assistance of BIOS, nor
with proper handling of EGA/VGA-only registers.  Note that it didn't
work on real VGA hardware, either (although in that case, the most
obvious problems seemed to be out-of-range hsync and/or vsync
signalling, rather than the issues in this patch).

Eventually real MDA and/or CGA support might provide an alternative to
this patch, although a hybrid approach like this patch might still
be useful in marginal cases.

Signed-off-by: Matthew Ogilvie &lt;mmogilvi_qemu@miniinfo.net&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;


  Commit: f278d4947fff814dcde2ef2acad36d172ff8be35
      https://github.com/qemu/qemu/commit/f278d4947fff814dcde2ef2acad36d172ff8be35
  Author: Matthew Ogilvie &lt;mmogilvi_qemu@miniinfo.net&gt;
  Date:   2012-08-23 (Thu, 23 Aug 2012)

  Changed paths:
    M cpu-exec.c
    M hw/i8259.c
    M qemu-options.hx
    M sysemu.h
    M vl.c

  Log Message:
  -----------
  i8259: add -no-spurious-interrupt-hack option

This patch provides a way to optionally suppress spurious interrupts,
as a workaround for systems described below:

Some old operating systems do not handle spurious interrupts well,
and qemu tends to generate them significantly more often than
real hardware.

Examples:
  - Microport UNIX System V/386 v 2.1 (ca 1987)
    (The main problem I'm fixing: Without this patch, it panics
    sporadically when accessing the hard disk.)
  - AT&amp;T UNIX System V/386 Release 4.0 Version 2.1a (ca 1991)
    See screenshot in "QEMU Official OS Support List":
    http://www.claunia.com/qemu/objectManager.php?sClass=application&amp;iId=9
    (I don't have this system to test.)
  - A report about OS/2 boot lockup from 2004 by Hampa Hug:
    http://lists.nongnu.org/archive/html/qemu-devel/2004-09/msg00367.html
    (My patch was partially inspired by his.)
    Also: http://lists.nongnu.org/archive/html/qemu-devel/2005-06/msg00243.html
    (I don't have this system to test.)

Signed-off-by: Matthew Ogilvie &lt;mmogilvi_qemu@miniinfo.net&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;


Compare: https://github.com/qemu/qemu/compare/98609cd8fcf7...f278d4947fff

----==_mimepart_5036fc477b9cd_11bf130aaec105338--


</body></email><email><emailId>20120826183007</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-26 18:30:07-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 9716ef: tcg/arm: Fix broken CONFIG_TCG_PASS_AREG0 code</subject><body>



----==_mimepart_503a6b2f35dd_df81475ae477175
Date: Sun, 26 Aug 2012 11:30:07 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;503a6b2f4a45_df81475ae477265@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 9716ef3b1b48ebbb4b6515fb4685a5db96ce41d9
      https://github.com/qemu/qemu/commit/9716ef3b1b48ebbb4b6515fb4685a5db96ce41d9
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-26 (Sun, 26 Aug 2012)

  Changed paths:
    M tcg/arm/tcg-target.c

  Log Message:
  -----------
  tcg/arm: Fix broken CONFIG_TCG_PASS_AREG0 code

The CONFIG_TCG_PASS_AREG0 code for calling ld/st helpers was
broken in that it did not respect the ABI requirement that 64
bit values were passed in even-odd register pairs. The simplest
way to fix this is to implement some new utility functions
for marshalling function arguments into the correct registers
and stack, so that the code which sets up the address and
data arguments does not need to care whether there has been
a preceding env argument.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;




----==_mimepart_503a6b2f35dd_df81475ae477175--


</body></email><email><emailId>20120826193007</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-26 19:30:07-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 18d445: tcg/ia64: fix prologue/epilogue</subject><body>



----==_mimepart_503a793f41a80_4dbb1257af01067d5
Date: Sun, 26 Aug 2012 12:30:07 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;503a793f43017_4dbb1257af010687c@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 18d445b443a5fa06a7c2819a170623b970afb3fb
      https://github.com/qemu/qemu/commit/18d445b443a5fa06a7c2819a170623b970afb3fb
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-08-26 (Sun, 26 Aug 2012)

  Changed paths:
    M tcg/ia64/tcg-target.c

  Log Message:
  -----------
  tcg/ia64: fix prologue/epilogue

Prologue and epilogue code has been broken in cea5f9a28.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: d03c98d80ffb7c561d9e6874580f52fe7ecc8c6c
      https://github.com/qemu/qemu/commit/d03c98d80ffb7c561d9e6874580f52fe7ecc8c6c
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-08-26 (Sun, 26 Aug 2012)

  Changed paths:
    M tcg/ia64/tcg-target.c

  Log Message:
  -----------
  tcg/ia64: fix and optimize ld/st slow path

Store slow path has been broken in e141ab52d:
- the arguments are shifted before the last one (mem_index) is written.
- the shift is done for both slow and fast paths.

Fix that. Also optimize a bit by bundling the move together. This still
can be optimized, but it's better to wait for a decision to be taken on
the arguments order.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


Compare: https://github.com/qemu/qemu/compare/9716ef3b1b48...d03c98d80ffb

----==_mimepart_503a793f41a80_4dbb1257af01067d5--


</body></email><email><emailId>20120827103007</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-27 10:30:07-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] d22d72: Fix operands of RECIP2.S and RECIP2.PS</subject><body>



----==_mimepart_503b4c2f2dd95_f371cdfaf414560
Date: Mon, 27 Aug 2012 03:30:07 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;503b4c2f2f57e_f371cdfaf41464@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: d22d7289877ecd3ef86570f6f6d0574da40711dc
      https://github.com/qemu/qemu/commit/d22d7289877ecd3ef86570f6f6d0574da40711dc
  Author: Richard Sandiford &lt;rdsandiford@googlemail.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  Fix operands of RECIP2.S and RECIP2.PS

Read the second input operand of RECIP2.S and RECIP2.PS from FT rather
than FD.  RECIP2.D is already correct.

Signed-off-by: Richard Sandiford &lt;rdsandiford@googlemail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 13d24f49720a3e7b35a21222ef182c8513f139db
      https://github.com/qemu/qemu/commit/13d24f49720a3e7b35a21222ef182c8513f139db
  Author: Richard Sandiford &lt;rdsandiford@googlemail.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  Fix order of CVT.PS.S operands

The FS input to CVT.PS.S is the high half and FT is the low half.
tcg_gen_concat_i32_i64 takes the low half first, so the operands
were in the wrong order.

Signed-off-by: Richard Sandiford &lt;rdsandiford@googlemail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 05168674505153a641c7bfddb691d2eda11d13d1
      https://github.com/qemu/qemu/commit/05168674505153a641c7bfddb691d2eda11d13d1
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: Streamline indexed cp1 memory addressing.

We've already eliminated both base and index being zero.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: b3167288367f79754b74ad933146e37938ebff13
      https://github.com/qemu/qemu/commit/b3167288367f79754b74ad933146e37938ebff13
  Author: Richard Henderson &lt;rth@twiddle.net&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  mips-linux-user: Always support rdhwr.

The kernel will emulate this instruction if it's not supported
natively.  This insn is used for TLS, among other things, and
so is required by modern glibc.

Signed-off-by: Richard Henderson &lt;rth@twiddle.net&gt;
Cc: Riku Voipio &lt;riku.voipio@iki.fi&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


Compare: https://github.com/qemu/qemu/compare/d03c98d80ffb...b3167288367f

----==_mimepart_503b4c2f2dd95_f371cdfaf414560--


</body></email><email><emailId>20120827150012</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-27 15:00:12-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 4f2138: Revert "i8259: add -no-spurious-interrupt-hack opt...</subject><body>



----==_mimepart_503b8b7c178c7_37b31aabae410629b
Date: Mon, 27 Aug 2012 08:00:12 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;503b8b7c19231_37b31aabae41063c5@sh3.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 4f213879f3cc695644cfd8bf603495e7316c78f6
      https://github.com/qemu/qemu/commit/4f213879f3cc695644cfd8bf603495e7316c78f6
  Author: malc &lt;av1474@comtv.ru&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M cpu-exec.c
    M hw/i8259.c
    M qemu-options.hx
    M sysemu.h
    M vl.c

  Log Message:
  -----------
  Revert "i8259: add -no-spurious-interrupt-hack option"

This reverts commit f278d4947fff814dcde2ef2acad36d172ff8be35.

Signed-off-by: malc &lt;av1474@comtv.ru&gt;


  Commit: df8002103c3e262dc40d7b5e0eb2171ba28b1d63
      https://github.com/qemu/qemu/commit/df8002103c3e262dc40d7b5e0eb2171ba28b1d63
  Author: malc &lt;av1474@comtv.ru&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M hw/pc.h
    M hw/vga.c
    M qemu-options.hx
    M vl.c

  Log Message:
  -----------
  Revert "vga: add some optional CGA compatibility hacks"

This reverts commit 482f7bf86b43af9f6903c52726fedf82b28bf953.

Signed-off-by: malc &lt;av1474@comtv.ru&gt;


  Commit: e4558dcae8b9fcb2bcc312f1d04071b34adf0781
      https://github.com/qemu/qemu/commit/e4558dcae8b9fcb2bcc312f1d04071b34adf0781
  Author: malc &lt;av1474@comtv.ru&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M qemu-options.hx

  Log Message:
  -----------
  Revert "qemu-options.hx: mention retrace= VGA option"

This reverts commit 39dda260628e5f2a3fd2ce2ec8a71f3d5ca309a9.

Signed-off-by: malc &lt;av1474@comtv.ru&gt;


  Commit: 9f227bc3583ea082be7a79c14a5ffdade5844753
      https://github.com/qemu/qemu/commit/9f227bc3583ea082be7a79c14a5ffdade5844753
  Author: malc &lt;av1474@comtv.ru&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M vl.c

  Log Message:
  -----------
  Revert "vl: fix -hdachs/-hda argument order parsing issues"

This reverts commit 7764ae9671f1cd74227cf4404431dd5213799ef0.

Signed-off-by: malc &lt;av1474@comtv.ru&gt;


  Commit: 08406b035edc35fff4e3e14af3ec6f8f3a17a587
      https://github.com/qemu/qemu/commit/08406b035edc35fff4e3e14af3ec6f8f3a17a587
  Author: malc &lt;av1474@comtv.ru&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M hw/cirrus_vga.c
    M hw/i8259.c
    M hw/ide/cmd646.c
    M hw/ide/via.c

  Log Message:
  -----------
  Revert "fix some debug printf format strings"

This reverts commit 145c7c880ff520a9348cc2401ba291330b9606fe.

Signed-off-by: malc &lt;av1474@comtv.ru&gt;


Compare: https://github.com/qemu/qemu/compare/b3167288367f...08406b035edc

----==_mimepart_503b8b7c178c7_37b31aabae410629b--


</body></email><email><emailId>20120827213010</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-27 21:30:10-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 2e1549: target-mips: add privilege level check to several ...</subject><body>



----==_mimepart_503be6e239b5f_22e8194baf02182c
Date: Mon, 27 Aug 2012 14:30:10 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;503be6e23b294_22e8194baf02194c@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 2e15497c5b8d0d172dece0cf56e2d2e977a6b679
      https://github.com/qemu/qemu/commit/2e15497c5b8d0d172dece0cf56e2d2e977a6b679
  Author: Eric Johnson &lt;ericj@mips.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: add privilege level check to several Cop0 instructions

The MIPS Architecture Verification Programs (AVPs) check privileged
instructions for the required privilege level.  These changes are needed
to pass the AVP suite.

Signed-off-by: Eric Johnson &lt;ericj@mips.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 36c6711bbe79642b0102416a9dd4243505e874a6
      https://github.com/qemu/qemu/commit/36c6711bbe79642b0102416a9dd4243505e874a6
  Author: Eric Johnson &lt;ericj@mips.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M target-mips/translate.c

  Log Message:
  -----------
  target-mips: allow microMIPS SWP and SDP to have RD equal to BASE

The microMIPS SWP and SDP instructions do not modify GPRs.  So their
behavior is well defined when RD equals BASE.  The MIPS Architecture
Verification Programs (AVPs) check that they work as expected.  This
is required for AVPs to pass.

Signed-off-by: Eric Johnson &lt;ericj@mips.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


Compare: https://github.com/qemu/qemu/compare/08406b035edc...36c6711bbe79

----==_mimepart_503be6e239b5f_22e8194baf02182c--


</body></email><email><emailId>20120828153010</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-28 15:30:10-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 13ef70: audio/winwave: previous audio buffer should be flu...</subject><body>



----==_mimepart_503ce402a4b2f_63db167caf41545ae
Date: Tue, 28 Aug 2012 08:30:10 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;503ce402a64e1_63db167caf4154632@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 13ef70f64e9e4d7583fbd9918d8ea76194023d37
      https://github.com/qemu/qemu/commit/13ef70f64e9e4d7583fbd9918d8ea76194023d37
  Author: munkyu.im &lt;munkyu.im@samsung.com&gt;
  Date:   2012-08-28 (Tue, 28 Aug 2012)

  Changed paths:
    M audio/winwaveaudio.c

  Log Message:
  -----------
  audio/winwave: previous audio buffer should be flushed

Winwave audio backend has problem with pausing and restart audio out.
Unlike other backends, Winwave pausing API does not flush audio buffer.
As a result, the previous audio data are played in front of
user expected sound when user restart audio.
So changes it to waveOutReset()

Signed-off-by: Munkyu Im &lt;munkyu.im@samsung.com&gt;
Signed-off-by: malc &lt;av1474@comtv.ru&gt;




----==_mimepart_503ce402a4b2f_63db167caf41545ae--


</body></email><email><emailId>20120828190011</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-28 19:00:11-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 54cddd: target-ppc: fix altivec instructions</subject><body>



----==_mimepart_503d153b767b4_9d0139daf43065c
Date: Tue, 28 Aug 2012 12:00:11 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;503d153b77b47_9d0139daf43075@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 54cddd21b04013d5741a92d6828dea3bdb821482
      https://github.com/qemu/qemu/commit/54cddd21b04013d5741a92d6828dea3=
bdb821482
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-08-28 (Tue, 28 Aug 2012)

  Changed paths:
    M target-ppc/translate.c

  Log Message:
  -----------
  target-ppc: fix altivec instructions

Altivec instructions are not working anymore in PowerPC emulation,
following commit d15f74fb, which inverted two registers in the call
to helper. Fix that.

Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Reviewed-by: Andreas F=C3=A4rber &lt;afaerber@suse.de&gt;
Acked-by: Blue Swirl &lt;blauwirbel@gmail.com&gt;
Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: ce6760404851f410d63519084329d54dc216ff93
      https://github.com/qemu/qemu/commit/ce6760404851f410d63519084329d54=
dc216ff93
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-08-28 (Tue, 28 Aug 2012)

  Changed paths:
    M pc-bios/README
    M pc-bios/openbios-ppc
    M roms/openbios

  Log Message:
  -----------
  Update OpenBIOS PPC image

Update OpenBIOS PPC image to SVN r1063 to fix issues introduced by
commit 9e56edcf. The code change in this revision only affects PPC,
so OpenBIOS SPARC images are not updated.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;


  Commit: 18fec301cd2a38f72a5eeba2656a0c5b4fa69fb7
      https://github.com/qemu/qemu/commit/18fec301cd2a38f72a5eeba2656a0c5=
b4fa69fb7
  Author: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
  Date:   2012-08-28 (Tue, 28 Aug 2012)

  Changed paths:
    M tcg/mips/tcg-target.c

  Log Message:
  -----------
  tcg/mips: fix broken CONFIG_TCG_PASS_AREG0 code

The CONFIG_TCG_PASS_AREG0 code for calling ld/st helpers was
broken in that it did not respect the ABI requirement that 64
bit values were passed in even-odd register pairs. The simplest
way to fix this is to implement some new utility functions
for marshalling function arguments into the correct registers
and stack, so that the code which sets up the address and
data arguments does not need to care whether there has been
a preceding env argument.

Based on commit 9716ef3b for ARM by Peter Maydell.

Signed-off-by: Aurelien Jarno &lt;aurelien@aurel32.net&gt;
Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;


Compare: https://github.com/qemu/qemu/compare/13ef70f64e9e...18fec301cd2a=


----==_mimepart_503d153b767b4_9d0139daf43065c--


</body></email><email><emailId>20120830130011</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-30 13:00:11-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] 42644c: linux-user: arg_table need not have global scope</subject><body>



----==_mimepart_503f63db8ea90_346617c5af0161547
Date: Thu, 30 Aug 2012 06:00:11 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-ID: &lt;503f63db90918_346617c5af0161687@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: 42644cee08f85202f5d3e8babf6503487849353a
      https://github.com/qemu/qemu/commit/42644cee08f85202f5d3e8babf6503487849353a
  Author: Jim Meyering &lt;meyering@redhat.com&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M linux-user/main.c

  Log Message:
  -----------
  linux-user: arg_table need not have global scope

Declare arg_table to be "static const", and adjust the two users
to also be const.

Signed-off-by: Jim Meyering &lt;meyering@redhat.com&gt;
Signed-off-by: Riku Voipio &lt;riku.voipio@linaro.org&gt;


  Commit: 333858b77c2b4f7636257808a77822c58bdd80fe
      https://github.com/qemu/qemu/commit/333858b77c2b4f7636257808a77822c58bdd80fe
  Author: Dmitry V. Levin &lt;ldv@altlinux.org&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M linux-user/syscall.c
    M linux-user/syscall_defs.h

  Log Message:
  -----------
  linux-user: fix emulation of getdents

In case when TARGET_ABI_BITS == 32 &amp;&amp; HOST_LONG_BITS == 64, the last
byte of the target dirent structure (aka d_type byte) was never copied
from the host dirent structure, thus breaking everything that relies
on valid d_type value, e.g. glob(3).

Reviewed-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Dmitry V. Levin &lt;ldv@altlinux.org&gt;
Signed-off-by: Riku Voipio &lt;riku.voipio@linaro.org&gt;


  Commit: 097b8cb840a31ec526cc58778bd8cbab0d2beaaa
      https://github.com/qemu/qemu/commit/097b8cb840a31ec526cc58778bd8cbab0d2beaaa
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-27 (Mon, 27 Aug 2012)

  Changed paths:
    M linux-user/main.c

  Log Message:
  -----------
  linux-user: Clarify "Unable to reserve guest address space" error

Now that we default to reserving nearly 4GB of RAM for the guest
address space when running a 32 bit linux-user guest on 64 bit
hosts, users are much more likely to run into it. Reword the
message to be more informative about what failed and provide
suggestions for how to fix things.

Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Riku Voipio &lt;riku.voipio@linaro.org&gt;


  Commit: fb6541571e0dc74655f0bfb0534c95d759a7bdb4
      https://github.com/qemu/qemu/commit/fb6541571e0dc74655f0bfb0534c95d759a7bdb4
  Author: Hannes Reinecke &lt;hare@suse.de&gt;
  Date:   2012-08-28 (Tue, 28 Aug 2012)

  Changed paths:
    M hw/megasas.c

  Log Message:
  -----------
  megasas: Add 'hba_serial' property

Add a 'hba_serial' property to the megasas driver. Originally
it would be using a pointer value which would break migration.

Reported-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Cc: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Hannes Reinecke &lt;hare@suse.de&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 9ea73f8b10531de4b1173835c819b7c35b7160c6
      https://github.com/qemu/qemu/commit/9ea73f8b10531de4b1173835c819b7c35b7160c6
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-08-28 (Tue, 28 Aug 2012)

  Changed paths:
    M hw/esp.c

  Log Message:
  -----------
  esp: support 24-bit DMA

SeaBIOS will issue requests for more than 64k when loading a CD-ROM
image into memory.  Support the TCHI register from the AMD PCscsi
spec.

Acked-by: HervÃ© Poussineau &lt;hpoussin@reactos.org&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 0f1da449ec65403bc5c028eb9618d0ee598a3615
      https://github.com/qemu/qemu/commit/0f1da449ec65403bc5c028eb9618d0ee598a3615
  Author: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
  Date:   2012-08-28 (Tue, 28 Aug 2012)

  Changed paths:
    M hw/scsi-disk.c
    M hw/scsi-generic.c

  Log Message:
  -----------
  scsi: more fixes to properties for passthrough devices

Commit 0384783 (scsi-block: remove properties that are not relevant for
passthrough, 2012-07-09) removed one property that should have been
left there, "bootindex".

It also did not touch scsi-generic, while it should have.

Fix both problems.

Reported-by: Alexandre DERUMIER &lt;aderumier@odiso.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;


  Commit: 135b9088780d7d8e5eae027b4fba6b33562f7006
      https://github.com/qemu/qemu/commit/135b9088780d7d8e5eae027b4fba6b33562f7006
  Author: Ronnie Sahlberg &lt;ronniesahlberg@gmail.com&gt;
  Date:   2012-08-28 (Tue, 28 Aug 2012)

  Changed paths:
    M block/iscsi.c

  Log Message:
  -----------
  iscsi: Set number of blocks to 0 for blank CDROM devices

The number of blocks of the device is used to compute the device size
in bdrv_getlength()/iscsi_getlength().
For MMC devices, the ReturnedLogicalBlockAddress in the READCAPACITY10
has a special meaning when it is 0.
In this case it does not mean that LBA 0 is the last accessible LBA,
and thus the device has 1 readable block, but instead it means that the
disc is blank and there are no readable blocks.

This change ensures that when the iSCSI LUN is loaded with a blank
DVD-R disk or similar that bdrv_getlength() will return the correct
size of the device as 0 bytes.

Signed-off-by: Ronnie Sahlberg &lt;ronniesahlberg@gmail.com&gt;


  Commit: 7dd6f4b250772e4859997d2624ac0bbc8d02482b
      https://github.com/qemu/qemu/commit/7dd6f4b250772e4859997d2624ac0bbc8d02482b
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-29 (Wed, 29 Aug 2012)

  Changed paths:
    M linux-user/main.c
    M linux-user/syscall.c
    M linux-user/syscall_defs.h

  Log Message:
  -----------
  Merge remote-tracking branch 'riku/linux-user-for-upstream' into staging

* riku/linux-user-for-upstream:
  linux-user: Clarify "Unable to reserve guest address space" error
  linux-user: fix emulation of getdents
  linux-user: arg_table need not have global scope


  Commit: 1e2778d59d110404428627690950405577be5090
      https://github.com/qemu/qemu/commit/1e2778d59d110404428627690950405577be5090
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-29 (Wed, 29 Aug 2012)

  Changed paths:
    M block/iscsi.c
    M hw/esp.c
    M hw/megasas.c
    M hw/scsi-disk.c
    M hw/scsi-generic.c

  Log Message:
  -----------
  Merge remote-tracking branch 'bonzini/scsi-next' into staging

* bonzini/scsi-next:
  iscsi: Set number of blocks to 0 for blank CDROM devices
  scsi: more fixes to properties for passthrough devices
  esp: support 24-bit DMA
  megasas: Add 'hba_serial' property


  Commit: 998a74bcda7f3297813732ddc2f28ffe5a12e37a
      https://github.com/qemu/qemu/commit/998a74bcda7f3297813732ddc2f28ffe5a12e37a
  Author: Peter Maydell &lt;peter.maydell@linaro.org&gt;
  Date:   2012-08-29 (Wed, 29 Aug 2012)

  Changed paths:
    M hw/arm_gic.c

  Log Message:
  -----------
  hw/arm_gic.c: Define .class_size in arm_gic_info TypeInfo

Add the missing .class_size definition to the arm_gic_info TypeInfo.
This fixes the memory corruption and possible segfault that otherwise
results when the class struct is allocated at too small a size and
the class init function writes off the end of it.

Reported-by: Adam Lackorzynski &lt;adam@os.inf.tu-dresden.de&gt;
Signed-off-by: Peter Maydell &lt;peter.maydell@linaro.org&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 7e7de876ae9bdb1b994dee148c6dc009ce94c48e
      https://github.com/qemu/qemu/commit/7e7de876ae9bdb1b994dee148c6dc009ce94c48e
  Author: Cam Macdonell &lt;cam@cs.ualberta.ca&gt;
  Date:   2012-08-29 (Wed, 29 Aug 2012)

  Changed paths:
    M hw/ivshmem.c

  Log Message:
  -----------
  ivshmem: remove redundant ioeventfd configuration

setup_ioeventfds() is unnecessary and actually causes a segfault when used
ioeventfd=on is used on the command-line.  Since ioeventfds are handled within
the memory API, it can be removed.

Signed-off-by: Cam Macdonell &lt;cam@cs.ualberta.ca&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 7e2a62d82a3f1397acd67685c3008046eba8344b
      https://github.com/qemu/qemu/commit/7e2a62d82a3f1397acd67685c3008046eba8344b
  Author: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
  Date:   2012-08-29 (Wed, 29 Aug 2012)

  Changed paths:
    M memory.c

  Log Message:
  -----------
  memory: Fix copy&amp;paste mistake in memory_region_iorange_write

The last argument of find_portio is "write", so this must be true here.

Signed-off-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 4bdb1a3059d7d3a931de0748a2eec39a0ab41b4e
      https://github.com/qemu/qemu/commit/4bdb1a3059d7d3a931de0748a2eec39a0ab41b4e
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-08-29 (Wed, 29 Aug 2012)

  Changed paths:
    M qemu-ga.c

  Log Message:
  -----------
  qemu-ga: Fix null pointer passed to unlink in failure branch

Clang reports this warning:

Null pointer passed as an argument to a 'nonnull' parameter

Reviewed-by: Luiz Capitulino &lt;lcapitulino@redhat.com&gt;
Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 4d09d37c6aa9a02b44b1fdb6268820fab92499bd
      https://github.com/qemu/qemu/commit/4d09d37c6aa9a02b44b1fdb6268820fab92499bd
  Author: Gleb Natapov &lt;gleb@redhat.com&gt;
  Date:   2012-08-29 (Wed, 29 Aug 2012)

  Changed paths:
    M hw/acpi_piix4.c

  Log Message:
  -----------
  reset PMBA and PMREGMISC PIIX4 registers.

The bug causes Windows + OVMF hang after reboot since OVMF
checks PMREGMISC to see if IO space is enabled and skip
configuration if it is.

Reviewed-by: Laszlo Ersek &lt;lersek@redhat.com&gt;
Signed-off-by: Gleb Natapov &lt;gleb@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: ef8621b1a3b199c348606c0a11a77d8e8bf135f1
      https://github.com/qemu/qemu/commit/ef8621b1a3b199c348606c0a11a77d8e8bf135f1
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-29 (Wed, 29 Aug 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  target-i386: disable pv eoi to fix migration across QEMU versions

We have a problem with how we handle migration with KVM paravirt features.
We unconditionally enable paravirt features regardless of whether we know how
to migrate them.

We also don't tie paravirt features to specific machine types so an old QEMU on
a new kernel would expose features that never existed.

The 1.2 cycle is over and as things stand, migration is broken.  Michael has
another series that adds support for migrating PV EOI and attempts to make it
work correctly for different machine types.

After speaking with Michael on IRC, we agreed to take this patch plus 1 &amp; 4
from his series.  This makes sure QEMU can migrate PV EOI if it's enabled, but
does not enable it by default.

This also means that we won't unconditionally enable new features for guests
future proofing us from this happening again in the future.

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 651682dcf54c4f2e07904bd822a97895900f6d8a
      https://github.com/qemu/qemu/commit/651682dcf54c4f2e07904bd822a97895900f6d8a
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-08-29 (Wed, 29 Aug 2012)

  Changed paths:
    M linux-headers/asm-s390/kvm.h
    M linux-headers/asm-s390/kvm_para.h
    M linux-headers/asm-x86/kvm.h
    M linux-headers/asm-x86/kvm_para.h
    M linux-headers/linux/kvm.h

  Log Message:
  -----------
  linux-headers: update to 3.6-rc3

Update linux-headers to version present in Linux 3.6-rc3.
Header asm-x96_64/kvm_para.h update is needed for the new PV EOI
feature.

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: bc9a839d569d4d8532c5c097bf1f4583226e3aa0
      https://github.com/qemu/qemu/commit/bc9a839d569d4d8532c5c097bf1f4583226e3aa0
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-08-29 (Wed, 29 Aug 2012)

  Changed paths:
    M target-i386/cpu.h
    M target-i386/kvm.c
    M target-i386/machine.c

  Log Message:
  -----------
  kvm: get/set PV EOI MSR

Support get/set of new PV EOI MSR, for migration.
Add an optional section for MSR value - send it
out in case MSR was changed from the default value (0).

Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 3cac001e5ae3c0ceb33e0a1978a48cb5e2482ab2
      https://github.com/qemu/qemu/commit/3cac001e5ae3c0ceb33e0a1978a48cb5e2482ab2
  Author: Michael S. Tsirkin &lt;mst@redhat.com&gt;
  Date:   2012-08-29 (Wed, 29 Aug 2012)

  Changed paths:
    M hw/msix.c
    M hw/virtio-pci.c

  Log Message:
  -----------
  msix: make [un]use vectors on reset/load optional

The facility to use/unuse vectors dynamically is helpful
for virtio but little else: everyone just seems to use
vectors in their init function.

Avoid clearing msix vector use info on reset and load.
For virtio, clear it explicitly.
This should fix regressions reported with ivshmem - though
I didn't test this, I verified that virtio keeps
working like it did.

Tested-by: Cam Macdonell &lt;cam@cs.ualberta.ca&gt;
Signed-off-by: Michael S. Tsirkin &lt;mst@redhat.com&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 5bb0b62e750c24886e90d1399eb9f03c68404001
      https://github.com/qemu/qemu/commit/5bb0b62e750c24886e90d1399eb9f03c68404001
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-08-29 (Wed, 29 Aug 2012)

  Changed paths:
    M hw/scsi-disk.c

  Log Message:
  -----------
  scsi-disk: Fix typo (uint32 -&gt; uint32_t)

Cc: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: c9a238e7005bc6c94c7367b2976402ee5adec0de
      https://github.com/qemu/qemu/commit/c9a238e7005bc6c94c7367b2976402ee5adec0de
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-30 (Thu, 30 Aug 2012)

  Changed paths:
    M VERSION

  Log Message:
  -----------
  Update version for 1.2.0-rc2

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/18fec301cd2a...c9a238e7005b

----==_mimepart_503f63db8ea90_346617c5af0161547--


</body></email><email><emailId>20120830193006</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-30 19:30:06-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu]</subject><body>



----==_mimepart_503fbf3e59744_600f1c65aec4288
Date: Thu, 30 Aug 2012 12:30:06 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;503fbf3e5a77e_600f1c65aec4315@sh2.rs.github.com.mail&gt;

  Branch: refs/tags/v1.2.0-rc2
  Home:   https://github.com/qemu/qemu


----==_mimepart_503fbf3e59744_600f1c65aec4288--


</body></email><email><emailId>20120830220006</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-30 22:00:06-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] b834b5: w32: Fix broken build</subject><body>



----==_mimepart_503fe26649f21_7c91e22ae81058ba
Date: Thu, 30 Aug 2012 15:00:06 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;503fe2664b032_7c91e22ae81059d2@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: b834b5081d6266cc0789454905f3b7d622d4d096
      https://github.com/qemu/qemu/commit/b834b5081d6266cc0789454905f3b7d622d4d096
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-08-30 (Thu, 30 Aug 2012)

  Changed paths:
    M target-i386/cpu.c

  Log Message:
  -----------
  w32: Fix broken build

Commit ef8621b1a3b199c348606c0a11a77d8e8bf135f1 added an include
file which is not available for MinGW compilations.

Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;




----==_mimepart_503fe26649f21_7c91e22ae81058ba--


</body></email><email><emailId>20120831160008</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-31 16:00:08-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu]</subject><body>



----==_mimepart_5040df881a31_540e1632ae449128
Date: Fri, 31 Aug 2012 09:00:08 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5040df882e80_540e1632ae449266@sh2.rs.github.com.mail&gt;

  Branch: refs/tags/v1.2.0-rc3
  Home:   https://github.com/qemu/qemu


----==_mimepart_5040df881a31_540e1632ae449128--


</body></email><email><emailId>20120831160009</emailId><senderName>GitHub</senderName><senderEmail>noreply@github.com</senderEmail><timestampReceived>2012-08-31 16:00:09-0400</timestampReceived><subject>[Qemu-commits] [qemu/qemu] ef72f7: qed: refuse unaligned zero writes with a backing f...</subject><body>



----==_mimepart_5040df8993229_6e2519acae419227
Date: Fri, 31 Aug 2012 09:00:09 -0700
Mime-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-ID: &lt;5040df8997d7d_6e2519acae419384@sh2.rs.github.com.mail&gt;

  Branch: refs/heads/master
  Home:   https://github.com/qemu/qemu
  Commit: ef72f76e58107bd4096018c3db2912d28249308e
      https://github.com/qemu/qemu/commit/ef72f76e58107bd4096018c3db2912d28249308e
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-08-29 (Wed, 29 Aug 2012)

  Changed paths:
    M block/qed.c

  Log Message:
  -----------
  qed: refuse unaligned zero writes with a backing file

Zero writes have cluster granularity in QED.  Therefore they can only be
used to zero entire clusters.

If the zero write request leaves sectors untouched, zeroing the entire
cluster would obscure the backing file.  Instead return -ENOTSUP, which
is handled by block.c:bdrv_co_do_write_zeroes() and falls back to a
regular write.

The qemu-iotests 034 test cases covers this scenario.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 571cd9dcc7f2fee59e47913365ced7781f33c2d3
      https://github.com/qemu/qemu/commit/571cd9dcc7f2fee59e47913365ced7781f33c2d3
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-08-29 (Wed, 29 Aug 2012)

  Changed paths:
    M block/stream.c

  Log Message:
  -----------
  stream: complete early if end of backing file is reached

It is possible to create an image that is larger than its backing file.
Reading beyond the end of the backing file produces zeroes if no writes
have been made to those sectors in the image file.

This patch finishes streaming early when the end of the backing file is
reached.  Without this patch the block job hangs and continually tries
to stream the first sectors beyond the end of the backing file.

To reproduce the hung block job bug:

  $ qemu-img create -f qcow2 backing.qcow2 128M
  $ qemu-img create -f qcow2 -o backing_file=backing.qcow2 image.qcow2 6G
  $ qemu -drive if=virtio,cache=none,file=image.qcow2
  (qemu) block_stream virtio0
  (qemu) info block-jobs

The qemu-iotests 030 streaming test still passes.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: 774a8850d708aeb6dd6de493c28b374098c1a4c3
      https://github.com/qemu/qemu/commit/774a8850d708aeb6dd6de493c28b374098c1a4c3
  Author: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
  Date:   2012-08-29 (Wed, 29 Aug 2012)

  Changed paths:
    M tests/qemu-iotests/030
    M tests/qemu-iotests/030.out

  Log Message:
  -----------
  qemu-iotests: add backing file smaller than image test case

This new test case checks that streaming completes successfully when the
backing file is smaller than the image file.

Signed-off-by: Stefan Hajnoczi &lt;stefanha@linux.vnet.ibm.com&gt;
Reviewed-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Kevin Wolf &lt;kwolf@redhat.com&gt;


  Commit: da9fbe76a0639c529f9678aabcc052dfe4cd9cc4
      https://github.com/qemu/qemu/commit/da9fbe76a0639c529f9678aabcc052dfe4cd9cc4
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-08-31 (Fri, 31 Aug 2012)

  Changed paths:
    M hw/qdev-monitor.c

  Log Message:
  -----------
  fix info qtree indention

Without the patch bus properties are are not in line with the other
properties:

[ ... ]
  dev: fw_cfg, id ""
    ctl_iobase = 0x510
    data_iobase = 0x511
      irq 0
      mmio ffffffffffffffff/0000000000000002
      mmio ffffffffffffffff/0000000000000001
[ ... ]

With the patch applied everything is lined up properly:

[ ... ]
  dev: fw_cfg, id ""
    ctl_iobase = 0x510
    data_iobase = 0x511
    irq 0
    mmio ffffffffffffffff/0000000000000002
    mmio ffffffffffffffff/0000000000000001
[ ... ]

Needed to make the autotest qtree parser happy.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 0132b4b6595423c92f54d7e0b172b5d73aaa8375
      https://github.com/qemu/qemu/commit/0132b4b6595423c92f54d7e0b172b5d73aaa8375
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-08-31 (Fri, 31 Aug 2012)

  Changed paths:
    M hw/usb.h
    M hw/usb/core.c
    M hw/usb/hcd-ehci.c
    M hw/usb/hcd-uhci.c

  Log Message:
  -----------
  usb: Halt ep queue en cancel pending packets on a packet error

For controllers which queue up more then 1 packet at a time, we must halt the
ep queue, and inside the controller code cancel all pending packets on an
error.

There are multiple reasons for this:
1) Guests expect the controllers to halt ep queues on error, so that they
get the opportunity to cancel transfers which the scheduled after the failing
one, before processing continues

2) Not cancelling queued up packets after a failed transfer also messes up
the controller state machine, in the case of EHCI causing the following
assert to trigger: "assert(p-&gt;qtdaddr == q-&gt;qtdaddr)" at hcd-ehci.c:2075

3) For bulk endpoints with pipelining enabled (redirection to a real USB
device), we must cancel all the transfers after this a failed one so that:
a) If they've completed already, they are not processed further causing more
   stalls to be reported, originating from the same failed transfer
b) If still in flight, they are cancelled before the guest does
   a clear stall, otherwise the guest and device can loose sync!

Note this patch only touches the ehci and uhci controller changes, since AFAIK
no other controllers actually queue up multiple transfer. If I'm wrong on this
other controllers need to be updated too!

Also note that this patch was heavily tested with the ehci code, where I had
a reproducer for a device causing a transfer to fail. The uhci code is not
tested with actually failing transfers and could do with a thorough review!

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: e983395d30d1d5bfa0ed3ae9c028c130f7c498cc
      https://github.com/qemu/qemu/commit/e983395d30d1d5bfa0ed3ae9c028c130f7c498cc
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-08-31 (Fri, 31 Aug 2012)

  Changed paths:
    M hw/usb.h
    M hw/usb/core.c
    M hw/usb/hcd-ehci.c
    M hw/usb/hcd-musb.c
    M hw/usb/hcd-ohci.c
    M hw/usb/hcd-uhci.c
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  usb: unique packet ids

This patch adds IDs to usb packets.  Those IDs are (a) supposed to be
unique for the lifecycle of a packet (from packet setup until the packet
is either completed or canceled) and (b) stable across migration.

uhci, ohci, ehci and xhci use the guest physical address of the transfer
descriptor for this.

musb needs a different approach because there is no transfer descriptor.
But musb also doesn't support pipelining, so we have never more than one
packet per endpoint in flight.  So we go create an ID based on endpoint
and device address.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 7ce86aa1aafaa65e7d3e572873bdf37bdb896f49
      https://github.com/qemu/qemu/commit/7ce86aa1aafaa65e7d3e572873bdf37bdb896f49
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-08-31 (Fri, 31 Aug 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Fix NULL ptr deref when unplugging an USB dev with an iso stream active

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;


  Commit: a1c3e4b839f8e7ec7f1792b8a11c63ca845aa021
      https://github.com/qemu/qemu/commit/a1c3e4b839f8e7ec7f1792b8a11c63ca845aa021
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-08-31 (Fri, 31 Aug 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Schedule async-bh when IAAD bit gets set

After the "ehci: Print a warning when a queue unexpectedly contains packets
on cancel" commit. Under certain reproducable conditions I was getting the
following message: "EHCI: Warning queue not empty on queue reset".

After aprox. 8 hours of debugging I've finally found the cause. The Linux EHCI
driver has an IAAD watchdog, to work around certain EHCI hardware sometimes
not acknowledging the doorbell at all. This watchdog has a timeout of 10 ms,
which is less then the time between 2 runs through the async schedule when
async_stepdown is at its highest value.

Thus the watchdog can trigger, after which Linux clears the IAAD bit and
re-uses the QH. IOW we were not properly detecting the unlink of the qh, due
to us missing (ignoring for more then 10 ms) the IAAD command, which triggered
the warning.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;


  Commit: 53dd6f7032ec4898ca8f95356df795a92cd27e09
      https://github.com/qemu/qemu/commit/53dd6f7032ec4898ca8f95356df795a92cd27e09
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-08-31 (Fri, 31 Aug 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Remove unnecessary ehci_flush_qh call

ehci_qh_do_overlay() already calls ehci_flush_qh() before it returns, calling
it twice is useless.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 574ef17191f5ec5a3cc4782c1f59dc5eb8279654
      https://github.com/qemu/qemu/commit/574ef17191f5ec5a3cc4782c1f59dc5eb8279654
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-08-31 (Fri, 31 Aug 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: simplify ehci_state_executing

ehci_state_executing does not need to check for p-&gt;usb_status == USB_RET_ASYNC
or USB_RET_PROCERR, since ehci_execute_complete already does a similar check
and will trigger an assert if either value is encountered.

USB_RET_ASYNC should never be the packet status when execute_complete runs
for obvious reasons, and USB_RET_PROCERR is only used by ehci_state_execute /
ehci_execute not by ehci_state_executing / ehci_execute_complete.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;
Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: c7cdca3b853eed0dd521c43098b6d07bcce24fd1
      https://github.com/qemu/qemu/commit/c7cdca3b853eed0dd521c43098b6d07bcce24fd1
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-08-31 (Fri, 31 Aug 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: add ehci_cancel_queue()

Factor out function to cancel all packets of a queue.
No behavior change.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: 287fd3f1dd0b2abbd69e58b402e5364b334e95bd
      https://github.com/qemu/qemu/commit/287fd3f1dd0b2abbd69e58b402e5364b334e95bd
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-08-31 (Fri, 31 Aug 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: handle TD deactivation of inflight packets

Check the TDs of inflight packets, cancel
packets in case the guest clears the active bit.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: adf478342b11cf9f540baf1f387b669210d3bea1
      https://github.com/qemu/qemu/commit/adf478342b11cf9f540baf1f387b669210d3bea1
  Author: Hans de Goede &lt;hdegoede@redhat.com&gt;
  Date:   2012-08-31 (Fri, 31 Aug 2012)

  Changed paths:
    M hw/usb/hcd-ehci.c

  Log Message:
  -----------
  ehci: Fix interrupt endpoints no longer working

One of the recent changes (likely the addition of queuing support) has broken
interrupt endpoints, this patch fixes this.

Signed-off-by: Hans de Goede &lt;hdegoede@redhat.com&gt;


  Commit: 347e40ffe61b7cc8d4565be476c20acd00611669
      https://github.com/qemu/qemu/commit/347e40ffe61b7cc8d4565be476c20acd00611669
  Author: Gerd Hoffmann &lt;kraxel@redhat.com&gt;
  Date:   2012-08-31 (Fri, 31 Aug 2012)

  Changed paths:
    M hw/usb/dev-uas.c

  Log Message:
  -----------
  uas: move transfer kickoff

Kick next scsi transfer from request release callback instead of command
completion callback, otherwise we might get stuck in case scsi_req_unref()
doesn't release the request instantly due to someone else holding a
reference too.

Signed-off-by: Gerd Hoffmann &lt;kraxel@redhat.com&gt;


  Commit: cdedd9d867f2e955e022f07808b10a4a5d383841
      https://github.com/qemu/qemu/commit/cdedd9d867f2e955e022f07808b10a4a5d383841
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-31 (Fri, 31 Aug 2012)

  Changed paths:
    M block/qed.c
    M block/stream.c
    M tests/qemu-iotests/030
    M tests/qemu-iotests/030.out

  Log Message:
  -----------
  Merge remote-tracking branch 'kwolf/for-anthony' into staging

* kwolf/for-anthony:
  qemu-iotests: add backing file smaller than image test case
  stream: complete early if end of backing file is reached
  qed: refuse unaligned zero writes with a backing file


  Commit: 23aec6005af30e29180496b434edcc51660ce94e
      https://github.com/qemu/qemu/commit/23aec6005af30e29180496b434edcc51660ce94e
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-31 (Fri, 31 Aug 2012)

  Changed paths:
    M hw/qdev-monitor.c
    M hw/usb.h
    M hw/usb/core.c
    M hw/usb/dev-uas.c
    M hw/usb/hcd-ehci.c
    M hw/usb/hcd-musb.c
    M hw/usb/hcd-ohci.c
    M hw/usb/hcd-uhci.c
    M hw/usb/hcd-xhci.c

  Log Message:
  -----------
  Merge remote-tracking branch 'kraxel/usb.61' into staging

* kraxel/usb.61:
  uas: move transfer kickoff
  ehci: Fix interrupt endpoints no longer working
  ehci: handle TD deactivation of inflight packets
  ehci: add ehci_cancel_queue()
  ehci: simplify ehci_state_executing
  ehci: Remove unnecessary ehci_flush_qh call
  ehci: Schedule async-bh when IAAD bit gets set
  ehci: Fix NULL ptr deref when unplugging an USB dev with an iso stream active
  usb: unique packet ids
  usb: Halt ep queue en cancel pending packets on a packet error
  fix info qtree indention


  Commit: 8bd6b06d7b718b3e595aab279699ef3651ce2e48
      https://github.com/qemu/qemu/commit/8bd6b06d7b718b3e595aab279699ef3651ce2e48
  Author: Stefan Weil &lt;sw@weilnetz.de&gt;
  Date:   2012-08-31 (Fri, 31 Aug 2012)

  Changed paths:
    M console.c

  Log Message:
  -----------
  console: Fix warning from clang (and potential crash)

ccc-analyzer reports this warning:

console.c:1090:29: warning: Dereference of null pointer
  if (active_console-&gt;cursor_timer) {
                      ^

Function console_select allows active_console to be NULL,
but would crash when accessing cursor_timer. Fix this.

Reviewed-by: Jan Kiszka &lt;jan.kiszka@siemens.com&gt;
Signed-off-by: Stefan Weil &lt;sw@weilnetz.de&gt;
Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


  Commit: 0232cd355d37e1ef938c3636a0e934da87f3bcc8
      https://github.com/qemu/qemu/commit/0232cd355d37e1ef938c3636a0e934da87f3bcc8
  Author: Anthony Liguori &lt;aliguori@us.ibm.com&gt;
  Date:   2012-08-31 (Fri, 31 Aug 2012)

  Changed paths:
    M VERSION

  Log Message:
  -----------
  Update version to 1.2.0-rc3

Signed-off-by: Anthony Liguori &lt;aliguori@us.ibm.com&gt;


Compare: https://github.com/qemu/qemu/compare/b834b5081d62...0232cd355d37

----==_mimepart_5040df8993229_6e2519acae419227--


</body></email></emails>