<?xml version="1.0" encoding="utf-8"?>
<emails><email><emailId>20170403080746</emailId><senderName>Michael Hierweck</senderName><senderEmail>michael@hierweck.de</senderEmail><timestampReceived>2017-04-03 08:07:46-0400</timestampReceived><subject>[libvirt-users] (Live) Migration safe vs. unsafe</subject><body>

Hi all,

virsh checks whether a (live) migration is safe or unsafe. When a
migration is considered to be unsafe it is rejected unless the --unsafe
option is prodivided.

As a part of those checks virsh considers the cache settings for the
underlying storage resources. In this context only cache="none" is
considered to be safe.

I wonder why cache="directsync" might be harmfull as it bypasses the
host page cache completely.

Regards,

Michael

</body></email><email><emailId>20170427120243</emailId><senderName>Stefano Ricci</senderName><senderEmail>sfn.rcc@gmail.com</senderEmail><timestampReceived>2017-04-27 12:02:43-0400</timestampReceived><subject>[libvirt-users] Libvirtd freezes</subject><body>

Hello everyone
I come back to ask for a hand to solve a problem that has affected me
since October 2016 and I have not yet solved using libvirt.
I thought I would solve it by going to a 4.9.x kernel with qemu
2.8.1.1 and with libvirt 3.2.0.
Compile it all in a stable LFS environment version 7.9 and that all
checks pass without errors.
The strange thing is that the libvirtd process starts without errors
but has arrived at the qemu process launch to understand the system's
capabilities freezes until the following process is killed
/usr/bin/qemu-system-x86_64 -S -none-user-config -nodefaults
-nographic -machine none, accel = kvm: tcg -qmp unix:
/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait-pidfile/var/lib/libvirt/qemu/capabilities.Pidfile
                
-daemonize, since that time libvirtd resumes running and can be used
with virsh.
Performing qemu independently of libvirt works regularly, creates and
runs virtual machines smoothly.

Thanks in advance
Stefano Ricci


</body></email><email><emailId>20170604094335</emailId><senderName>Hui Jing</senderName><senderEmail>h.jingict@gmail.com</senderEmail><timestampReceived>2017-06-04 09:43:35-0400</timestampReceived><subject>[libvirt-users] vm live migration memory copy</subject><body>

Hi All,

I am wondering when we do live migration, how much memory is transferred? I
guess it must be one of the three below, but not sure which one:
1. The amount of memory allocated to VM
2. The memory currently used by VM (actual Mem usage in guest)
3. The memory used by the qemu process (RSS).

Best Regards,
Hui

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi All,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I am wondering when we do live migration, \
how much memory is transferred? I guess it must be one of the three below, but not \
sure which one:&lt;/div&gt;&lt;div&gt;1. The amount of memory allocated to VM&lt;/div&gt;&lt;div&gt;2. The \
memory currently used by VM (actual Mem usage in guest)  &lt;/div&gt;&lt;div&gt;3. The memory \
used by the qemu process (RSS).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Best \
Regards,&lt;/div&gt;&lt;div&gt;Hui&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170802093017</emailId><senderName>Aditya Bhardwaj</senderName><senderEmail>adityaform@gmail.com</senderEmail><timestampReceived>2017-08-02 09:30:17-0400</timestampReceived><subject>[libvirt-users] Regarding KVM-Qemu Migration code</subject><body>

Respected Sir,
I need to modify kvm-qemu migration code. Please tell me where i can
find the code.

-- 




*Thank youWith Regards:Aditya Bhardwaj*
*Dept. of CSE *
*NITTTR (Ministry of MHRD, Govt. of India)*
*Sector-26, **Chandigarh - 160019  INDIA*
https://scholar.google.co.in/citations?user=rEHhEnEAAAAJ&amp;hl=en

</body></email><email><emailId>20170907152546</emailId><senderName>Silvia Fichera</senderName><senderEmail>fichera.sil@gmail.com</senderEmail><timestampReceived>2017-09-07 15:25:46-0400</timestampReceived><subject>[libvirt-users] Failed building wheel for libvirt-python</subject><body>

Hi all,
I'm installing Openstack using devstack netwon branch in my PC with Ubuntu
16.04 and I have this error.
Could someone of you help me please?
Thanks

Collecting libvirt-python===2.1.0 (from -c
/opt/stack/requirements/upper-constraints.txt (line 169))
  Using cached libvirt-python-2.1.0.tar.gz
Building wheels for collected packages: libvirt-python
  Running setup.py bdist_wheel for libvirt-python ... error
  Complete output from command /usr/bin/python -u -c "import setuptools,
tokenize;__file__='/tmp/pip-build-g9ai0P/libvirt-python/setup.py';f=getattr(tokenize,
'open', open)(__file__);code=f.read().replace('\r\n',
'\n');f.close();exec(compile(code, __file__, 'exec'))" bdist_wheel -d
/tmp/tmpsHlvcmpip-wheel- --python-tag cp27:
  running bdist_wheel
  running build
  /usr/bin/pkg-config --print-errors --atleast-version=0.9.11 libvirt
  /usr/bin/python generator.py libvirt
/usr/share/libvirt/api/libvirt-api.xml
  Found 415 functions in /usr/share/libvirt/api/libvirt-api.xml
  Found 0 functions in libvirt-override-api.xml
  Generated 344 wrapper functions
  Missing type converters:
  virConnectNodeDeviceEventGenericCallback:1
  ERROR: failed virConnectNodeDeviceEventRegisterAny
  error: command '/usr/bin/python' failed with exit status 1

  ----------------------------------------
  Failed building wheel for libvirt-python
  Running setup.py clean for libvirt-python
Failed to build libvirt-python
Installing collected packages: libvirt-python
  Running setup.py install for libvirt-python ... error
    Complete output from command /usr/bin/python -u -c "import setuptools,
tokenize;__file__='/tmp/pip-build-g9ai0P/libvirt-python/setup.py';f=getattr(tokenize,
'open', open)(__file__);code=f.read().replace('\r\n',
'\n');f.close();exec(compile(code, __file__, 'exec'))" install --record
/tmp/pip-0i4vHi-record/install-record.txt
--single-version-externally-managed --compile:
    running install
    running build
    /usr/bin/pkg-config --print-errors --atleast-version=0.9.11 libvirt
    /usr/bin/python generator.py libvirt
/usr/share/libvirt/api/libvirt-api.xml
    Found 415 functions in /usr/share/libvirt/api/libvirt-api.xml
    Found 0 functions in libvirt-override-api.xml
    Generated 344 wrapper functions
    Missing type converters:
    virConnectNodeDeviceEventGenericCallback:1
    ERROR: failed virConnectNodeDeviceEventRegisterAny
    error: command '/usr/bin/python' failed with exit status 1

    ----------------------------------------
Command "/usr/bin/python -u -c "import setuptools,
tokenize;__file__='/tmp/pip-build-g9ai0P/libvirt-python/setup.py';f=getattr(tokenize,
'open', open)(__file__);code=f.read().replace('\r\n',
'\n');f.close();exec(compile(code, __file__, 'exec'))" install --record
/tmp/pip-0i4vHi-record/install-record.txt
--single-version-externally-managed --compile" failed with error code 1 in
/tmp/pip-build-g9ai0P/libvirt-python/
+inc/python:pip_install:1                  exit_trap
+./stack.sh:exit_trap:494                  local r=1
++./stack.sh:exit_trap:495                  jobs -p
+./stack.sh:exit_trap:495                  jobs=
+./stack.sh:exit_trap:498                  [[ -n '' ]]
+./stack.sh:exit_trap:504                  kill_spinner
+./stack.sh:kill_spinner:390               '[' '!' -z '' ']'
+./stack.sh:exit_trap:506                  [[ 1 -ne 0 ]]
+./stack.sh:exit_trap:507                  echo 'Error on exit'
Error on exit
+./stack.sh:exit_trap:508                  generate-subunit 1504797369 129
fail
+./stack.sh:exit_trap:509                  [[ -z /opt/stack/logs ]]
+./stack.sh:exit_trap:512
/home/onossona/devstack/tools/worlddump.py -d /opt/stack/logs
World dumping... see /opt/stack/logs/worlddump-2017-09-07-151818.txt for
details
+./stack.sh:exit_trap:518                  exit 1


-- 
Silvia Fichera

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hi all,&lt;br&gt;&lt;/div&gt;I'm installing Openstack using \
devstack netwon branch in my PC with Ubuntu 16.04 and I have this \
error.&lt;br&gt;&lt;/div&gt;Could someone of you help me \
please?&lt;br&gt;&lt;/div&gt;Thanks&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;Collecting libvirt-python===2.1.0 \
(from -c /opt/stack/requirements/upper-constraints.txt (line 169))&lt;br&gt;   Using cached \
libvirt-python-2.1.0.tar.gz&lt;br&gt;Building wheels for collected packages: \
libvirt-python&lt;br&gt;   Running setup.py bdist_wheel for libvirt-python ... error&lt;br&gt;   \
Complete output from command /usr/bin/python -u -c "import setuptools, \
tokenize;__file__='/tmp/pip-build-g9ai0P/libvirt-python/setup.py';f=getattr(tokenize, \
'open', open)(__file__);code=f.read().replace('\r\n', \
'\n');f.close();exec(compile(code, __file__, 'exec'))" \
bdist_wheel -d /tmp/tmpsHlvcmpip-wheel- --python-tag cp27:&lt;br&gt;   running \
bdist_wheel&lt;br&gt;   running build&lt;br&gt;   /usr/bin/pkg-config --print-errors \
--atleast-version=0.9.11 libvirt&lt;br&gt;   /usr/bin/python generator.py libvirt \
/usr/share/libvirt/api/libvirt-api.xml&lt;br&gt;   Found 415 functions in \
/usr/share/libvirt/api/libvirt-api.xml&lt;br&gt;   Found 0 functions in \
libvirt-override-api.xml&lt;br&gt;   Generated 344 wrapper functions&lt;br&gt;   Missing type \
converters:&lt;br&gt;   virConnectNodeDeviceEventGenericCallback:1&lt;br&gt;   ERROR: failed \
virConnectNodeDeviceEventRegisterAny&lt;br&gt;   error: command '/usr/bin/python' \
failed with exit status 1&lt;br&gt;   &lt;br&gt;   ----------------------------------------&lt;br&gt;   \
Failed building wheel for libvirt-python&lt;br&gt;   Running setup.py clean for \
libvirt-python&lt;br&gt;Failed to build libvirt-python&lt;br&gt;Installing collected packages: \
libvirt-python&lt;br&gt;   Running setup.py install for libvirt-python ... error&lt;br&gt;       \
Complete output from command /usr/bin/python -u -c "import setuptools, \
tokenize;__file__='/tmp/pip-build-g9ai0P/libvirt-python/setup.py';f=getattr(tokenize, \
'open', open)(__file__);code=f.read().replace('\r\n', \
'\n');f.close();exec(compile(code, __file__, 'exec'))" install \
--record /tmp/pip-0i4vHi-record/install-record.txt \
--single-version-externally-managed --compile:&lt;br&gt;       running install&lt;br&gt;       \
running build&lt;br&gt;       /usr/bin/pkg-config --print-errors --atleast-version=0.9.11 \
libvirt&lt;br&gt;       /usr/bin/python generator.py libvirt \
/usr/share/libvirt/api/libvirt-api.xml&lt;br&gt;       Found 415 functions in \
/usr/share/libvirt/api/libvirt-api.xml&lt;br&gt;       Found 0 functions in \
libvirt-override-api.xml&lt;br&gt;       Generated 344 wrapper functions&lt;br&gt;       Missing \
type converters:&lt;br&gt;       virConnectNodeDeviceEventGenericCallback:1&lt;br&gt;       \
ERROR: failed virConnectNodeDeviceEventRegisterAny&lt;br&gt;       error: command \
'/usr/bin/python' failed with exit status 1&lt;br&gt;       &lt;br&gt;       \
----------------------------------------&lt;br&gt;Command "/usr/bin/python -u -c \
"import setuptools, \
tokenize;__file__='/tmp/pip-build-g9ai0P/libvirt-python/setup.py';f=getattr(tokenize, \
'open', open)(__file__);code=f.read().replace('\r\n', \
'\n');f.close();exec(compile(code, __file__, 'exec'))" install \
--record /tmp/pip-0i4vHi-record/install-record.txt \
--single-version-externally-managed --compile" failed with error code 1 in \
/tmp/pip-build-g9ai0P/libvirt-python/&lt;br&gt;+inc/python:pip_install:1                    \
exit_trap&lt;br&gt;+./stack.sh:exit_trap:494                                   local \
r=1&lt;br&gt;++./stack.sh:exit_trap:495                                   jobs \
-p&lt;br&gt;+./stack.sh:exit_trap:495                                   \
jobs=&lt;br&gt;+./stack.sh:exit_trap:498                                   [[ -n '' \
]]&lt;br&gt;+./stack.sh:exit_trap:504                                   \
kill_spinner&lt;br&gt;+./stack.sh:kill_spinner:390                             '[' \
'!' -z '' ']'&lt;br&gt;+./stack.sh:exit_trap:506                    \
[[ 1 -ne 0 ]]&lt;br&gt;+./stack.sh:exit_trap:507                                   echo \
'Error on exit'&lt;br&gt;Error on exit&lt;br&gt;+./stack.sh:exit_trap:508                 \
generate-subunit 1504797369 129 fail&lt;br&gt;+./stack.sh:exit_trap:509                     \
[[ -z /opt/stack/logs ]]&lt;br&gt;+./stack.sh:exit_trap:512                                 \
/home/onossona/devstack/tools/worlddump.py -d /opt/stack/logs&lt;br&gt;World dumping... see \
/opt/stack/logs/worlddump-2017-09-07-151818.txt for \
details&lt;br&gt;+./stack.sh:exit_trap:518                                   exit 1&lt;br&gt;&lt;br \
clear="all"&gt;&lt;br&gt;-- &lt;br&gt;&lt;div class="gmail_signature"&gt;Silvia Fichera&lt;/div&gt; \
&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20171002214209</emailId><senderName>Nick Gilmour</senderName><senderEmail>nickeforos@gmail.com</senderEmail><timestampReceived>2017-10-02 21:42:09-0400</timestampReceived><subject>[libvirt-users] error: internal error: missing backend for pool type 11 (zfs)</subject><body>

Hi all,

I'm trying to setup virt-manager with ZFS als storage on my Arch box. I
have created a pool named virt-pool and tried to use it as storage. First
with virt-manager and then in the terminal with virsh but I'm always
getting the following errors:



*virsh # pool-define-as --name zfsvirtpool --source-name virt-pool --type
zfserror: Failed to define pool zfsvirtpoolerror: internal error: missing
backend for pool type 11 (zfs)*

But ZFS seems to be working fine:

# zpool status
 pool: virt-pool
state: ONLINE
 scan: none requested
config:

       NAME                      STATE     READ WRITE CKSUM
       virt-pool                 ONLINE       0     0     0
         x                       ONLINE       0     0     0

errors: No known data errors

libvirt and VMM also. These are the installed versions:
Virtual Machine Manager v.1.4.3
virsh v.3.7.0
libvirtd (libvirt) 3.7.0

I have found that there was a bug last year which is supposed to be fixed:


*https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=827245
&lt;https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=827245&gt;*

So why I'm getting this error. Is something wrong with my setup?

Regards,
Nick

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi all,&lt;br&gt;&lt;br&gt;I'm trying to setup virt-manager with ZFS als \
storage on my Arch box. I have created a pool named virt-pool and tried to use it as \
storage. First with virt-manager and then in the terminal with virsh but I'm \
always getting the following errors:&lt;br&gt;&lt;br&gt;&lt;b&gt;virsh # pool-define-as --name \
zfsvirtpool --source-name virt-pool --type zfs&lt;br&gt;error: Failed to define pool \
zfsvirtpool&lt;br&gt;error: internal error: missing backend for pool type 11 \
(zfs)&lt;/b&gt;&lt;div&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;But ZFS seems to be working \
fine:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-family:monospace"&gt;&lt;span \
style="color:rgb(0,0,0)"&gt;# zpool status &lt;/span&gt;&lt;br&gt;   pool: virt-pool
&lt;br&gt; state: ONLINE
&lt;br&gt;   scan: none requested
&lt;br&gt;config:
&lt;br&gt;
&lt;br&gt;               NAME                                           STATE         READ \
WRITE CKSUM &lt;br&gt;               virt-pool                                 ONLINE       \
0         0         0 &lt;br&gt;                   x                                  \
ONLINE             0         0         0 &lt;br&gt;
&lt;br&gt;errors: No known data errors&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-family:monospace"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;libvirt and VMM also. These are \
the installed versions:&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-family:monospace"&gt;Virtual \
Machine Manager v.1.4.3&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-family:monospace;color:rgb(0,0,0)"&gt;virsh v.&lt;/span&gt;&lt;span \
style="font-family:monospace"&gt;3.7.0  &lt;/span&gt;&lt;br style="font-family:monospace"&gt;&lt;span \
style="font-family:monospace"&gt;libvirtd (libvirt) \
3.7.0&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I have found that there was a bug last year \
which is supposed to be fixed:&lt;br&gt;&lt;div&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;a \
href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=827245"&gt;https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=827245&lt;/a&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So \
why I'm getting this error. Is something wrong with my \
setup?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regards,&lt;/div&gt;&lt;div&gt;Nick&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20171102130356</emailId><senderName>"Volo M."</senderName><senderEmail>vm@vovs.net</senderEmail><timestampReceived>2017-11-02 13:03:56-0400</timestampReceived><subject>[libvirt-users] What global_quota option mean? What's its logic?</subject><body>

Hi techs,

Could you please explain or refer me to documentation where I could find a
description of global_quota schedinfo option. Someone told me that it could
mean a cpu limitation in percents like:
global_quota   : 25000 (does it mean cpu limit % set to 25  ?)

Is it true?
What other parameters mean in below output?
I didn't find any related documentation at libvirt.org.
Could you help me to describe me or refer to some description what below
schedinfo options mean? Thanks.

[root@cpkvm ~]# virsh list

 Id    Name                           State

----------------------------------------------------

 3     kvmtestvm                running

[root@cpkvm ~]# virsh schedinfo 3

Scheduler      : posix

cpu_shares     : 154

vcpu_period    : 100000

vcpu_quota     : -1

emulator_period: 100000

emulator_quota : -1

global_period  : 100000

global_quota   : -1

iothread_period: 100000

iothread_quota : -1

[root@cpkvm ~]# virsh schedinfo 3 --set global_quota=25

Scheduler      : posix

error: invalid argument: value of 'global_quota' is out of range [1000,
18446744073709551]

[1000, 18446744073709551]  - what this range mean?

[root@cpkvm ~]#

[root@cpkvm ~]# virsh schedinfo 3 --set global_quota=25000

Scheduler      : posix

cpu_shares     : 154

vcpu_period    : 100000

vcpu_quota     : 12500

emulator_period: 100000

emulator_quota : -1

global_period  : 100000

global_quota   : 25000

iothread_period: 100000

iothread_quota : 25000

[root@cpkvm ~]#

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;font size="4"&gt;Hi techs,&lt;/font&gt;&lt;div&gt;&lt;font \
size="4"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font size="4"&gt;Could you please explain or refer me to \
documentation where I could find a description of global_quota schedinfo option. \
Someone told me that it could mean a cpu limitation in percents \
like:&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font size="4"&gt;global_quota     : 25000 (does it mean cpu \
limit % set to 25   ?)&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font size="4"&gt;Is it true? \
&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font size="4"&gt;What other parameters mean in below \
output?&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font size="4"&gt;I didn't find any related documentation \
at &lt;a href="http://libvirt.org"&gt;libvirt.org&lt;/a&gt;.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
size="4"&gt;Could you help me to describe me or refer to some description what below \
schedinfo options mean? Thanks.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;







&lt;p class="gmail-p1"&gt;[root@cpkvm ~]# virsh list&lt;/p&gt;&lt;p class="gmail-p1"&gt;  Id      Name  \
State&lt;/p&gt;&lt;p class="gmail-p1"&gt;----------------------------------------------------&lt;/p&gt;&lt;p \
class="gmail-p1"&gt;  3        kvmtestvm                        running&lt;/p&gt;&lt;p \
class="gmail-p1"&gt;[root@cpkvm ~]# virsh schedinfo 3&lt;/p&gt;&lt;p class="gmail-p1"&gt;Scheduler   \
: posix&lt;/p&gt;&lt;p class="gmail-p1"&gt;cpu_shares        : 154&lt;/p&gt;&lt;p \
class="gmail-p1"&gt;vcpu_period      : 100000&lt;/p&gt;&lt;p class="gmail-p1"&gt;vcpu_quota        : \
-1&lt;/p&gt;&lt;p class="gmail-p1"&gt;emulator_period: 100000&lt;/p&gt;&lt;p \
class="gmail-p1"&gt;emulator_quota : -1&lt;/p&gt;&lt;p class="gmail-p1"&gt;global_period   : \
100000&lt;/p&gt;&lt;p class="gmail-p1"&gt;global_quota     : -1&lt;/p&gt;&lt;p \
class="gmail-p1"&gt;iothread_period: 100000&lt;/p&gt;&lt;p class="gmail-p1"&gt;iothread_quota : \
-1&lt;/p&gt;&lt;p class="gmail-p1"&gt;[root@cpkvm ~]# virsh schedinfo 3 --set \
global_quota=25&lt;/p&gt;&lt;p class="gmail-p1"&gt;Scheduler         : posix&lt;/p&gt;&lt;p \
class="gmail-p1"&gt;error: invalid argument: value of 'global_quota' is out of \
range [1000, 18446744073709551]&lt;/p&gt;&lt;p class="gmail-p1"&gt;&lt;font size="4"&gt;[1000, \
18446744073709551]   - what this range mean?&lt;/font&gt;&lt;br&gt;&lt;/p&gt;&lt;p \
class="gmail-p1"&gt;[root@cpkvm ~]#  &lt;/p&gt;&lt;p class="gmail-p1"&gt;[root@cpkvm ~]# virsh \
schedinfo 3 --set global_quota=25000&lt;/p&gt;&lt;p class="gmail-p1"&gt;Scheduler         : \
posix&lt;/p&gt;&lt;p class="gmail-p1"&gt;cpu_shares        : 154&lt;/p&gt;&lt;p \
class="gmail-p1"&gt;vcpu_period      : 100000&lt;/p&gt;&lt;p class="gmail-p1"&gt;vcpu_quota        : \
12500&lt;/p&gt;&lt;p class="gmail-p1"&gt;emulator_period: 100000&lt;/p&gt;&lt;p \
class="gmail-p1"&gt;emulator_quota : -1&lt;/p&gt;&lt;p class="gmail-p1"&gt;global_period   : \
100000&lt;/p&gt;&lt;p class="gmail-p1"&gt;global_quota     : 25000&lt;/p&gt;&lt;p \
class="gmail-p1"&gt;iothread_period: 100000&lt;/p&gt;&lt;p class="gmail-p1"&gt;iothread_quota : \
25000&lt;/p&gt;&lt;p class="gmail-p1"&gt;[root@cpkvm ~]#&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20171204080233</emailId><senderName>Lying</senderName><senderEmail>15700157322@163.com</senderEmail><timestampReceived>2017-12-04 08:02:33-0400</timestampReceived><subject>[libvirt-users] Guest Reboot After Plug HDMI</subject><body>

[Attachment #2 (text/plain)]

Hello, Everybody. I encounter a problem when i using my guest.

I booting my guest without HDMI primarily, Then i add it, but my guest is be \
rebooted.


To know what cause it, i do it again, especially i check my guest is running normal \
or not with "ping" before plugging, that's well.


What i was suffer? can you help me solve it?


Following message is detailed!!!


Guest: window 7 profession


Linux: Ubuntu 1604


Qemu:1 v2.11.0-rc0 


Libvirt: 3.9


method of  booting: virsh start myGuest1


method of plug HDMI: virsh qemu-monitor-command myGuest1 --hmp 'device_add \
driver=vfio-pci,host=01:00.0,xvga=on,multifunction=yes' 


phenomenon: after plugging, my Guest is failed to check with "ping", for a while, my \
display is light and load windows.


expect: my guest is running when i plug HDMI, it  seem that hot add a device. 





 


[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div \
style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div \
style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;pre&gt;&lt;div \
style="font-family: Arial; white-space: normal;"&gt;Hello, Everybody. I encounter a \
problem when i using my guest.&lt;/div&gt;&lt;div style="font-family: Arial; white-space: \
normal;"&gt;&lt;br&gt;&lt;/div&gt;&lt;div style="font-family: Arial; white-space: normal;"&gt;I booting my \
guest without HDMI primarily, Then i add it, but my guest is be rebooted.&lt;/div&gt;&lt;div \
style="font-family: Arial; white-space: normal;"&gt;&lt;br&gt;&lt;/div&gt;&lt;div style="font-family: \
Arial; white-space: normal;"&gt;To know what cause it, i do it again, especially i check \
my guest is running normal or not with "ping" before plugging, that's well.&lt;/div&gt;&lt;div \
style="font-family: Arial; white-space: normal;"&gt;&lt;br&gt;&lt;/div&gt;&lt;div style="font-family: \
Arial; white-space: normal;"&gt;What i was suffer? can you help me solve it?&lt;/div&gt;&lt;div \
style="font-family: Arial; white-space: normal;"&gt;&lt;br&gt;&lt;/div&gt;&lt;div style="font-family: \
Arial; white-space: normal;"&gt;Following message is detailed!!!&lt;/div&gt;&lt;div \
style="font-family: Arial; white-space: normal;"&gt;&lt;br&gt;&lt;/div&gt;&lt;div style="font-family: \
Arial; white-space: normal;"&gt;Guest: window 7 profession&lt;/div&gt;&lt;div style="font-family: \
Arial; white-space: normal;"&gt;&lt;br&gt;&lt;/div&gt;&lt;div style="font-family: Arial; white-space: \
normal;"&gt;Linux: Ubuntu 1604&lt;/div&gt;&lt;div style="font-family: Arial; white-space: \
normal;"&gt;&lt;br&gt;&lt;/div&gt;&lt;div style="font-family: Arial; white-space: normal;"&gt;Qemu:1 \
v2.11.0-rc0 &lt;/div&gt;&lt;div style="font-family: Arial; white-space: \
normal;"&gt;&lt;br&gt;&lt;/div&gt;&lt;div style="font-family: Arial; white-space: normal;"&gt;Libvirt: \
3.9&lt;/div&gt;&lt;div style="font-family: Arial; white-space: normal;"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family: Arial; white-space: normal;"&gt;method of  booting: virsh start \
myGuest1&lt;/div&gt;&lt;div style="font-family: Arial; white-space: normal;"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family: Arial; white-space: normal;"&gt;method of plug HDMI: virsh \
qemu-monitor-command myGuest1 --hmp 'device_add \
driver=vfio-pci,host=01:00.0,xvga=on,multifunction=yes' &lt;/div&gt;&lt;div \
style="font-family: Arial; white-space: normal;"&gt;&lt;br&gt;&lt;/div&gt;&lt;div style="font-family: \
Arial; white-space: normal;"&gt;phenomenon: after plugging, my Guest is failed to check \
with "ping", for a while, my display is light and load windows.&lt;/div&gt;&lt;div \
style="font-family: Arial; white-space: normal;"&gt;&lt;br&gt;&lt;/div&gt;&lt;div style="font-family: \
Arial; white-space: normal;"&gt;expect: my guest is running when i plug HDMI, it  \
seem that hot add a device. &lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;span \
title="neteasefooter"&gt;&lt;p&gt;&lt;br&gt; &lt;/p&gt;&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;span \
title="neteasefooter"&gt;&lt;p&gt;&lt;br/&gt; &lt;/p&gt;&lt;/span&gt;



</body></email><email><emailId>20170614082609</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-06-14 08:26:09-0400</timestampReceived><subject>[libvirt-users] virtual drive performance</subject><body>

Hi,

I'm investigating a performance issue on a virtualized windows server 
host that is run on a ubuntu machine via libvirt/qemu. While the host 
can easily read/write on the raid drive with 100Mmb/s as observable with 
dd, the virtualized windows server running on that host is barely able 
to read/write with at most 8Mb/s and averages around 1.4Mb/s. This has 
grown to the extent that the virtualized host is often unresponsive and 
even unable to start up its services with system default timeouts. Any 
help to improve the situation is greatly appreciated.

This is the configuration of the virtualized host:

~$ virsh dumpxml windows-server-2016-x64
&lt;domain type='kvm' id='1'&gt;
   &lt;name&gt;windows-server-2016-x64&lt;/name&gt;
   &lt;uuid&gt;XXX&lt;/uuid&gt;
   &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;
   &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMemory&gt;
   &lt;vcpu placement='static'&gt;2&lt;/vcpu&gt;
   &lt;resource&gt;
     &lt;partition&gt;/machine&lt;/partition&gt;
   &lt;/resource&gt;
   &lt;os&gt;
     &lt;type arch='x86_64' machine='pc-i440fx-xenial'&gt;hvm&lt;/type&gt;
     &lt;boot dev='hd'/&gt;
   &lt;/os&gt;
   &lt;features&gt;
     &lt;acpi/&gt;
     &lt;apic/&gt;
     &lt;hyperv&gt;
       &lt;relaxed state='on'/&gt;
       &lt;vapic state='on'/&gt;
       &lt;spinlocks state='on' retries='8191'/&gt;
     &lt;/hyperv&gt;
   &lt;/features&gt;
   &lt;cpu mode='custom' match='exact'&gt;
     &lt;model fallback='allow'&gt;IvyBridge&lt;/model&gt;
     &lt;topology sockets='1' cores='2' threads='1'/&gt;
   &lt;/cpu&gt;
   &lt;clock offset='localtime'&gt;
     &lt;timer name='rtc' tickpolicy='catchup'/&gt;
     &lt;timer name='pit' tickpolicy='delay'/&gt;
     &lt;timer name='hpet' present='no'/&gt;
     &lt;timer name='hypervclock' present='yes'/&gt;
   &lt;/clock&gt;
   &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
   &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
   &lt;on_crash&gt;restart&lt;/on_crash&gt;
   &lt;pm&gt;
     &lt;suspend-to-mem enabled='no'/&gt;
     &lt;suspend-to-disk enabled='no'/&gt;
   &lt;/pm&gt;
   &lt;devices&gt;
     &lt;emulator&gt;/usr/bin/kvm-spice&lt;/emulator&gt;
     &lt;disk type='file' device='disk'&gt;
       &lt;driver name='qemu' type='qcow2' cache='none'/&gt;
       &lt;source 
file='/var/data/virtuals/machines/windows-server-2016-x64/image.qcow2'/&gt;
       &lt;backingStore/&gt;
       &lt;target dev='hda' bus='ide'/&gt;
       &lt;alias name='ide0-0-0'/&gt;
       &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
     &lt;/disk&gt;
     &lt;disk type='file' device='cdrom'&gt;
       &lt;driver name='qemu' type='raw'/&gt;
       &lt;source 
file='/var/data/virtuals/machines/windows-server-2016-x64/dvd.iso'/&gt;
       &lt;backingStore/&gt;
       &lt;target dev='hdb' bus='ide'/&gt;
       &lt;readonly/&gt;
       &lt;alias name='ide0-0-1'/&gt;
       &lt;address type='drive' controller='0' bus='0' target='0' unit='1'/&gt;
     &lt;/disk&gt;
     &lt;controller type='usb' index='0' model='ich9-ehci1'&gt;
       &lt;alias name='usb'/&gt;
       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05' 
function='0x7'/&gt;
     &lt;/controller&gt;
     &lt;controller type='usb' index='0' model='ich9-uhci1'&gt;
       &lt;alias name='usb'/&gt;
       &lt;master startport='0'/&gt;
       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05' 
function='0x0' multifunction='on'/&gt;
     &lt;/controller&gt;
     &lt;controller type='usb' index='0' model='ich9-uhci2'&gt;
       &lt;alias name='usb'/&gt;
       &lt;master startport='2'/&gt;
       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05' 
function='0x1'/&gt;
     &lt;/controller&gt;
     &lt;controller type='usb' index='0' model='ich9-uhci3'&gt;
       &lt;alias name='usb'/&gt;
       &lt;master startport='4'/&gt;
       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05' 
function='0x2'/&gt;
     &lt;/controller&gt;
     &lt;controller type='pci' index='0' model='pci-root'&gt;
       &lt;alias name='pci.0'/&gt;
     &lt;/controller&gt;
     &lt;controller type='ide' index='0'&gt;
       &lt;alias name='ide'/&gt;
       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x01' 
function='0x1'/&gt;
     &lt;/controller&gt;
     &lt;interface type='bridge'&gt;
       &lt;mac address='52:54:00:0e:f2:23'/&gt;
       &lt;source bridge='br0'/&gt;
       &lt;target dev='vnet0'/&gt;
       &lt;model type='rtl8139'/&gt;
       &lt;alias name='net0'/&gt;
       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03' 
function='0x0'/&gt;
     &lt;/interface&gt;
     &lt;serial type='pty'&gt;
       &lt;source path='/dev/pts/1'/&gt;
       &lt;target port='0'/&gt;
       &lt;alias name='serial0'/&gt;
     &lt;/serial&gt;
     &lt;console type='pty' tty='/dev/pts/1'&gt;
       &lt;source path='/dev/pts/1'/&gt;
       &lt;target type='serial' port='0'/&gt;
       &lt;alias name='serial0'/&gt;
     &lt;/console&gt;
     &lt;input type='tablet' bus='usb'&gt;
       &lt;alias name='input0'/&gt;
     &lt;/input&gt;
     &lt;input type='mouse' bus='ps2'/&gt;
     &lt;input type='keyboard' bus='ps2'/&gt;
     &lt;graphics type='vnc' port='5900' autoport='yes' listen='127.0.0.1'&gt;
       &lt;listen type='address' address='127.0.0.1'/&gt;
     &lt;/graphics&gt;
     &lt;video&gt;
       &lt;model type='vga' vram='16384' heads='1'/&gt;
       &lt;alias name='video0'/&gt;
       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02' 
function='0x0'/&gt;
     &lt;/video&gt;
     &lt;memballoon model='virtio'&gt;
       &lt;alias name='balloon0'/&gt;
       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x04' 
function='0x0'/&gt;
     &lt;/memballoon&gt;
   &lt;/devices&gt;
   &lt;seclabel type='dynamic' model='apparmor' relabel='yes'&gt;
     &lt;label&gt;libvirt-XXX&lt;/label&gt;
     &lt;imagelabel&gt;libvirt-XXX&lt;/imagelabel&gt;
   &lt;/seclabel&gt;
&lt;/domain&gt;

Cheers,
Dominik

</body></email><email><emailId>20170614183239</emailId><senderName>Thiago Oliveira</senderName><senderEmail>cpv.thiago@gmail.com</senderEmail><timestampReceived>2017-06-14 18:32:39-0400</timestampReceived><subject>Re: [libvirt-users] virtual drive performance</subject><body>

Hi Dominik,

Sure, I beleive you can improve using:

&lt;cpu mode='host-passthrough'&gt;
&lt;/cpu&gt;

add io='native'

 &lt;driver name='qemu' type='qcow2' cache='none' io='native'/&gt;

After that, please try again, but I can see other thing, for example,
change the hda=IDE to virtio.

Cheers!

Thiago



2017-06-14 5:26 GMT-03:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:

&gt; Hi,
&gt;
&gt; I'm investigating a performance issue on a virtualized windows server host
&gt; that is run on a ubuntu machine via libvirt/qemu. While the host can easily
&gt; read/write on the raid drive with 100Mmb/s as observable with dd, the
&gt; virtualized windows server running on that host is barely able to
&gt; read/write with at most 8Mb/s and averages around 1.4Mb/s. This has grown
&gt; to the extent that the virtualized host is often unresponsive and even
&gt; unable to start up its services with system default timeouts. Any help to
&gt; improve the situation is greatly appreciated.
&gt;
&gt; This is the configuration of the virtualized host:
&gt;
&gt; ~$ virsh dumpxml windows-server-2016-x64
&gt; &lt;domain type='kvm' id='1'&gt;
&gt;   &lt;name&gt;windows-server-2016-x64&lt;/name&gt;
&gt;   &lt;uuid&gt;XXX&lt;/uuid&gt;
&gt;   &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;
&gt;   &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMemory&gt;
&gt;   &lt;vcpu placement='static'&gt;2&lt;/vcpu&gt;
&gt;   &lt;resource&gt;
&gt;     &lt;partition&gt;/machine&lt;/partition&gt;
&gt;   &lt;/resource&gt;
&gt;   &lt;os&gt;
&gt;     &lt;type arch='x86_64' machine='pc-i440fx-xenial'&gt;hvm&lt;/type&gt;
&gt;     &lt;boot dev='hd'/&gt;
&gt;   &lt;/os&gt;
&gt;   &lt;features&gt;
&gt;     &lt;acpi/&gt;
&gt;     &lt;apic/&gt;
&gt;     &lt;hyperv&gt;
&gt;       &lt;relaxed state='on'/&gt;
&gt;       &lt;vapic state='on'/&gt;
&gt;       &lt;spinlocks state='on' retries='8191'/&gt;
&gt;     &lt;/hyperv&gt;
&gt;   &lt;/features&gt;
&gt;   &lt;cpu mode='custom' match='exact'&gt;
&gt;     &lt;model fallback='allow'&gt;IvyBridge&lt;/model&gt;
&gt;     &lt;topology sockets='1' cores='2' threads='1'/&gt;
&gt;   &lt;/cpu&gt;
&gt;   &lt;clock offset='localtime'&gt;
&gt;     &lt;timer name='rtc' tickpolicy='catchup'/&gt;
&gt;     &lt;timer name='pit' tickpolicy='delay'/&gt;
&gt;     &lt;timer name='hpet' present='no'/&gt;
&gt;     &lt;timer name='hypervclock' present='yes'/&gt;
&gt;   &lt;/clock&gt;
&gt;   &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
&gt;   &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
&gt;   &lt;on_crash&gt;restart&lt;/on_crash&gt;
&gt;   &lt;pm&gt;
&gt;     &lt;suspend-to-mem enabled='no'/&gt;
&gt;     &lt;suspend-to-disk enabled='no'/&gt;
&gt;   &lt;/pm&gt;
&gt;   &lt;devices&gt;
&gt;     &lt;emulator&gt;/usr/bin/kvm-spice&lt;/emulator&gt;
&gt;     &lt;disk type='file' device='disk'&gt;
&gt;       &lt;driver name='qemu' type='qcow2' cache='none'/&gt;
&gt;       &lt;source file='/var/data/virtuals/machines/windows-server-2016-x64/
&gt; image.qcow2'/&gt;
&gt;       &lt;backingStore/&gt;
&gt;       &lt;target dev='hda' bus='ide'/&gt;
&gt;       &lt;alias name='ide0-0-0'/&gt;
&gt;       &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt;     &lt;/disk&gt;
&gt;     &lt;disk type='file' device='cdrom'&gt;
&gt;       &lt;driver name='qemu' type='raw'/&gt;
&gt;       &lt;source file='/var/data/virtuals/machines/windows-server-2016-x64/
&gt; dvd.iso'/&gt;
&gt;       &lt;backingStore/&gt;
&gt;       &lt;target dev='hdb' bus='ide'/&gt;
&gt;       &lt;readonly/&gt;
&gt;       &lt;alias name='ide0-0-1'/&gt;
&gt;       &lt;address type='drive' controller='0' bus='0' target='0' unit='1'/&gt;
&gt;     &lt;/disk&gt;
&gt;     &lt;controller type='usb' index='0' model='ich9-ehci1'&gt;
&gt;       &lt;alias name='usb'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05'
&gt; function='0x7'/&gt;
&gt;     &lt;/controller&gt;
&gt;     &lt;controller type='usb' index='0' model='ich9-uhci1'&gt;
&gt;       &lt;alias name='usb'/&gt;
&gt;       &lt;master startport='0'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05'
&gt; function='0x0' multifunction='on'/&gt;
&gt;     &lt;/controller&gt;
&gt;     &lt;controller type='usb' index='0' model='ich9-uhci2'&gt;
&gt;       &lt;alias name='usb'/&gt;
&gt;       &lt;master startport='2'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05'
&gt; function='0x1'/&gt;
&gt;     &lt;/controller&gt;
&gt;     &lt;controller type='usb' index='0' model='ich9-uhci3'&gt;
&gt;       &lt;alias name='usb'/&gt;
&gt;       &lt;master startport='4'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05'
&gt; function='0x2'/&gt;
&gt;     &lt;/controller&gt;
&gt;     &lt;controller type='pci' index='0' model='pci-root'&gt;
&gt;       &lt;alias name='pci.0'/&gt;
&gt;     &lt;/controller&gt;
&gt;     &lt;controller type='ide' index='0'&gt;
&gt;       &lt;alias name='ide'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x01'
&gt; function='0x1'/&gt;
&gt;     &lt;/controller&gt;
&gt;     &lt;interface type='bridge'&gt;
&gt;       &lt;mac address='52:54:00:0e:f2:23'/&gt;
&gt;       &lt;source bridge='br0'/&gt;
&gt;       &lt;target dev='vnet0'/&gt;
&gt;       &lt;model type='rtl8139'/&gt;
&gt;       &lt;alias name='net0'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
&gt; function='0x0'/&gt;
&gt;     &lt;/interface&gt;
&gt;     &lt;serial type='pty'&gt;
&gt;       &lt;source path='/dev/pts/1'/&gt;
&gt;       &lt;target port='0'/&gt;
&gt;       &lt;alias name='serial0'/&gt;
&gt;     &lt;/serial&gt;
&gt;     &lt;console type='pty' tty='/dev/pts/1'&gt;
&gt;       &lt;source path='/dev/pts/1'/&gt;
&gt;       &lt;target type='serial' port='0'/&gt;
&gt;       &lt;alias name='serial0'/&gt;
&gt;     &lt;/console&gt;
&gt;     &lt;input type='tablet' bus='usb'&gt;
&gt;       &lt;alias name='input0'/&gt;
&gt;     &lt;/input&gt;
&gt;     &lt;input type='mouse' bus='ps2'/&gt;
&gt;     &lt;input type='keyboard' bus='ps2'/&gt;
&gt;     &lt;graphics type='vnc' port='5900' autoport='yes' listen='127.0.0.1'&gt;
&gt;       &lt;listen type='address' address='127.0.0.1'/&gt;
&gt;     &lt;/graphics&gt;
&gt;     &lt;video&gt;
&gt;       &lt;model type='vga' vram='16384' heads='1'/&gt;
&gt;       &lt;alias name='video0'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02'
&gt; function='0x0'/&gt;
&gt;     &lt;/video&gt;
&gt;     &lt;memballoon model='virtio'&gt;
&gt;       &lt;alias name='balloon0'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x04'
&gt; function='0x0'/&gt;
&gt;     &lt;/memballoon&gt;
&gt;   &lt;/devices&gt;
&gt;   &lt;seclabel type='dynamic' model='apparmor' relabel='yes'&gt;
&gt;     &lt;label&gt;libvirt-XXX&lt;/label&gt;
&gt;     &lt;imagelabel&gt;libvirt-XXX&lt;/imagelabel&gt;
&gt;   &lt;/seclabel&gt;
&gt; &lt;/domain&gt;
&gt;
&gt; Cheers,
&gt; Dominik
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi Dominik,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Sure, I beleive you can improve \
using:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;&lt;cpu \
mode='&lt;/span&gt;host-passthrough&lt;span \
style="font-size:12.8px"&gt;'&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;/cpu&gt;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;add \
io='native'&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;  \
&lt;driver name='qemu' type='qcow2' cache='none'  \
&lt;/span&gt;io='native'&lt;span \
style="font-size:12.8px"&gt;/&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;After that, please try \
again, but I can see other thing, for example, change the hda=IDE to \
virtio.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thiago&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-06-14 5:26 GMT-03:00 Dominik \
Psenner &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;Hi,&lt;br&gt; &lt;br&gt;
I'm investigating a performance issue on a virtualized windows server host that \
is run on a ubuntu machine via libvirt/qemu. While the host can easily read/write on \
the raid drive with 100Mmb/s as observable with dd, the virtualized windows server \
running on that host is barely able to read/write with at most 8Mb/s and averages \
around 1.4Mb/s. This has grown to the extent that the virtualized host is often \
unresponsive and even unable to start up its services with system default timeouts. \
Any help to improve the situation is greatly appreciated.&lt;br&gt; &lt;br&gt;
This is the configuration of the virtualized host:&lt;br&gt;
&lt;br&gt;
~$ virsh dumpxml windows-server-2016-x64&lt;br&gt;
&lt;domain type='kvm' id='1'&gt;&lt;br&gt;
   &lt;name&gt;windows-server-2016-x64&lt;&lt;wbr&gt;/name&gt;&lt;br&gt;
   &lt;uuid&gt;XXX&lt;/uuid&gt;&lt;br&gt;
   &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;&lt;br&gt;
   &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMem&lt;wbr&gt;ory&gt;&lt;br&gt;
   &lt;vcpu placement='static'&gt;2&lt;/vcpu&gt;&lt;br&gt;
   &lt;resource&gt;&lt;br&gt;
      &lt;partition&gt;/machine&lt;/partition&lt;wbr&gt;&gt;&lt;br&gt;
   &lt;/resource&gt;&lt;br&gt;
   &lt;os&gt;&lt;br&gt;
      &lt;type arch='x86_64' \
machine='pc-i440fx-xenial'&gt;hvm&lt;wbr&gt;&lt;/type&gt;&lt;br&gt;  &lt;boot \
dev='hd'/&gt;&lt;br&gt;  &lt;/os&gt;&lt;br&gt;
   &lt;features&gt;&lt;br&gt;
      &lt;acpi/&gt;&lt;br&gt;
      &lt;apic/&gt;&lt;br&gt;
      &lt;hyperv&gt;&lt;br&gt;
         &lt;relaxed state='on'/&gt;&lt;br&gt;
         &lt;vapic state='on'/&gt;&lt;br&gt;
         &lt;spinlocks state='on' retries='8191'/&gt;&lt;br&gt;
      &lt;/hyperv&gt;&lt;br&gt;
   &lt;/features&gt;&lt;br&gt;
   &lt;cpu mode='custom' match='exact'&gt;&lt;br&gt;
      &lt;model fallback='allow'&gt;IvyBridge&lt;/mo&lt;wbr&gt;del&gt;&lt;br&gt;
      &lt;topology sockets='1' cores='2' threads='1'/&gt;&lt;br&gt;
   &lt;/cpu&gt;&lt;br&gt;
   &lt;clock offset='localtime'&gt;&lt;br&gt;
      &lt;timer name='rtc' tickpolicy='catchup'/&gt;&lt;br&gt;
      &lt;timer name='pit' tickpolicy='delay'/&gt;&lt;br&gt;
      &lt;timer name='hpet' present='no'/&gt;&lt;br&gt;
      &lt;timer name='hypervclock' present='yes'/&gt;&lt;br&gt;
   &lt;/clock&gt;&lt;br&gt;
   &lt;on_poweroff&gt;destroy&lt;/on_power&lt;wbr&gt;off&gt;&lt;br&gt;
   &lt;on_reboot&gt;restart&lt;/on_reboot&gt;&lt;br&gt;
   &lt;on_crash&gt;restart&lt;/on_crash&gt;&lt;br&gt;
   &lt;pm&gt;&lt;br&gt;
      &lt;suspend-to-mem enabled='no'/&gt;&lt;br&gt;
      &lt;suspend-to-disk enabled='no'/&gt;&lt;br&gt;
   &lt;/pm&gt;&lt;br&gt;
   &lt;devices&gt;&lt;br&gt;
      &lt;emulator&gt;/usr/bin/kvm-spice&lt;/&lt;wbr&gt;emulator&gt;&lt;br&gt;
      &lt;disk type='file' device='disk'&gt;&lt;br&gt;
         &lt;driver name='qemu' type='qcow2' \
                cache='none'/&gt;&lt;br&gt;
         &lt;source file='/var/data/virtuals/machi&lt;wbr&gt;nes/windows-server-2016-x64/&lt;wbr&gt;image.qcow2'/&gt;&lt;br&gt;
  &lt;backingStore/&gt;&lt;br&gt;
         &lt;target dev='hda' bus='ide'/&gt;&lt;br&gt;
         &lt;alias name='ide0-0-0'/&gt;&lt;br&gt;
         &lt;address type='drive' controller='0' bus='0' \
target='0' unit='0'/&gt;&lt;br&gt;  &lt;/disk&gt;&lt;br&gt;
      &lt;disk type='file' device='cdrom'&gt;&lt;br&gt;
         &lt;driver name='qemu' type='raw'/&gt;&lt;br&gt;
         &lt;source file='/var/data/virtuals/machi&lt;wbr&gt;nes/windows-server-2016-x64/&lt;wbr&gt;dvd.iso'/&gt;&lt;br&gt;
  &lt;backingStore/&gt;&lt;br&gt;
         &lt;target dev='hdb' bus='ide'/&gt;&lt;br&gt;
         &lt;readonly/&gt;&lt;br&gt;
         &lt;alias name='ide0-0-1'/&gt;&lt;br&gt;
         &lt;address type='drive' controller='0' bus='0' \
target='0' unit='1'/&gt;&lt;br&gt;  &lt;/disk&gt;&lt;br&gt;
      &lt;controller type='usb' index='0' \
model='ich9-ehci1'&gt;&lt;br&gt;  &lt;alias name='usb'/&gt;&lt;br&gt;
         &lt;address type='pci' domain='0x0000' bus='0x00' \
slot='0x05' function='0x7'/&gt;&lt;br&gt;  &lt;/controller&gt;&lt;br&gt;
      &lt;controller type='usb' index='0' \
model='ich9-uhci1'&gt;&lt;br&gt;  &lt;alias name='usb'/&gt;&lt;br&gt;
         &lt;master startport='0'/&gt;&lt;br&gt;
         &lt;address type='pci' domain='0x0000' bus='0x00' \
slot='0x05' function='0x0' multifunction='on'/&gt;&lt;br&gt;  \
                &lt;/controller&gt;&lt;br&gt;
      &lt;controller type='usb' index='0' \
model='ich9-uhci2'&gt;&lt;br&gt;  &lt;alias name='usb'/&gt;&lt;br&gt;
         &lt;master startport='2'/&gt;&lt;br&gt;
         &lt;address type='pci' domain='0x0000' bus='0x00' \
slot='0x05' function='0x1'/&gt;&lt;br&gt;  &lt;/controller&gt;&lt;br&gt;
      &lt;controller type='usb' index='0' \
model='ich9-uhci3'&gt;&lt;br&gt;  &lt;alias name='usb'/&gt;&lt;br&gt;
         &lt;master startport='4'/&gt;&lt;br&gt;
         &lt;address type='pci' domain='0x0000' bus='0x00' \
slot='0x05' function='0x2'/&gt;&lt;br&gt;  &lt;/controller&gt;&lt;br&gt;
      &lt;controller type='pci' index='0' \
model='pci-root'&gt;&lt;br&gt;  &lt;alias name='pci.0'/&gt;&lt;br&gt;
      &lt;/controller&gt;&lt;br&gt;
      &lt;controller type='ide' index='0'&gt;&lt;br&gt;
         &lt;alias name='ide'/&gt;&lt;br&gt;
         &lt;address type='pci' domain='0x0000' bus='0x00' \
slot='0x01' function='0x1'/&gt;&lt;br&gt;  &lt;/controller&gt;&lt;br&gt;
      &lt;interface type='bridge'&gt;&lt;br&gt;
         &lt;mac address='52:54:00:0e:f2:23'/&gt;&lt;br&gt;
         &lt;source bridge='br0'/&gt;&lt;br&gt;
         &lt;target dev='vnet0'/&gt;&lt;br&gt;
         &lt;model type='rtl8139'/&gt;&lt;br&gt;
         &lt;alias name='net0'/&gt;&lt;br&gt;
         &lt;address type='pci' domain='0x0000' bus='0x00' \
slot='0x03' function='0x0'/&gt;&lt;br&gt;  &lt;/interface&gt;&lt;br&gt;
      &lt;serial type='pty'&gt;&lt;br&gt;
         &lt;source path='/dev/pts/1'/&gt;&lt;br&gt;
         &lt;target port='0'/&gt;&lt;br&gt;
         &lt;alias name='serial0'/&gt;&lt;br&gt;
      &lt;/serial&gt;&lt;br&gt;
      &lt;console type='pty' tty='/dev/pts/1'&gt;&lt;br&gt;
         &lt;source path='/dev/pts/1'/&gt;&lt;br&gt;
         &lt;target type='serial' port='0'/&gt;&lt;br&gt;
         &lt;alias name='serial0'/&gt;&lt;br&gt;
      &lt;/console&gt;&lt;br&gt;
      &lt;input type='tablet' bus='usb'&gt;&lt;br&gt;
         &lt;alias name='input0'/&gt;&lt;br&gt;
      &lt;/input&gt;&lt;br&gt;
      &lt;input type='mouse' bus='ps2'/&gt;&lt;br&gt;
      &lt;input type='keyboard' bus='ps2'/&gt;&lt;br&gt;
      &lt;graphics type='vnc' port='5900' autoport='yes' \
                listen='127.0.0.1'&gt;&lt;br&gt;
         &lt;listen type='address' address='127.0.0.1'/&gt;&lt;br&gt;
      &lt;/graphics&gt;&lt;br&gt;
      &lt;video&gt;&lt;br&gt;
         &lt;model type='vga' vram='16384' heads='1'/&gt;&lt;br&gt;
         &lt;alias name='video0'/&gt;&lt;br&gt;
         &lt;address type='pci' domain='0x0000' bus='0x00' \
slot='0x02' function='0x0'/&gt;&lt;br&gt;  &lt;/video&gt;&lt;br&gt;
      &lt;memballoon model='virtio'&gt;&lt;br&gt;
         &lt;alias name='balloon0'/&gt;&lt;br&gt;
         &lt;address type='pci' domain='0x0000' bus='0x00' \
slot='0x04' function='0x0'/&gt;&lt;br&gt;  &lt;/memballoon&gt;&lt;br&gt;
   &lt;/devices&gt;&lt;br&gt;
   &lt;seclabel type='dynamic' model='apparmor' \
relabel='yes'&gt;&lt;br&gt;  &lt;label&gt;libvirt-XXX&lt;/label&gt;&lt;br&gt;
      &lt;imagelabel&gt;libvirt-XXX&lt;/image&lt;wbr&gt;label&gt;&lt;br&gt;
   &lt;/seclabel&gt;&lt;br&gt;
&lt;/domain&gt;&lt;br&gt;
&lt;br&gt;
Cheers,&lt;br&gt;
Dominik&lt;br&gt;
&lt;br&gt;
______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt; \
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170615020847</emailId><senderName>Andrea Bolognani</senderName><senderEmail>abologna@redhat.com</senderEmail><timestampReceived>2017-06-15 02:08:47-0400</timestampReceived><subject>Re: [libvirt-users] virtual drive performance</subject><body>

On Wed, 2017-06-14 at 15:32 -0300, Thiago Oliveira wrote:
[...]
&gt; I can see other thing, for example, change the hda=IDE to virtio.

I'd say switching the disk from IDE to virtio should be the
very first step - and while you're at it, you might as well
use virtio for the network interface too.

--  
Andrea Bolognani / Red Hat / Virtualization

</body></email><email><emailId>20170619103818</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-06-19 10:38:18-0400</timestampReceived><subject>Re: [libvirt-users] virtual drive performance</subject><body>

Hi,

Thank you for your input.

We already tried several tweaks but without luck. For example adding 
io='native' did not help improve the performance. It behaved exactly the 
same way before and after. I've read somewhere that cache='writethrough' 
could also help improving the performance, but we cannot do that because 
we take live snapshots to backup the machine while it runs. When cache 
is enabled, we observed that sometimes an external live snapshot cannot 
be merged with blockcommit without the host being shut down.

Would you please explain what &lt;cpu mode='host-passthrough' /&gt; should do 
to improve the performance?

Switching from IDE to virtio basically means that the host then knows 
that it runs on virtualized hardware and can do things differently? But 
it also requires to modify the host with specialized drivers that even 
influence the boot process. That feels more like a hack than a solution.

We're astonished why the virtualized IO is so much slower. I could 
understand a performance penalty of 10% or even 20%, but a drop from 
120Mb/s IO read to 1.4Mb/s IO read is suspicious to everyone of us. We'd 
have expected at least a throughput of 50Mb/s while reading from disk 
which is more than half the IO that the hardware can do. Please note 
that we do not observe the hosting machine to peak 100% with CPU or IO 
(using top and iotop) when the virtualized host does some io. Is there a 
lock contention or something else going on? When running a virtualized 
host for example with virtual box we don't see such an impact. What does 
virtual box do differently to improve virtualized IO and could that help 
libvirt/qemu/kvm?


On 2017-06-15 04:08, Andrea Bolognani wrote:
&gt; On Wed, 2017-06-14 at 15:32 -0300, Thiago Oliveira wrote:
&gt; [...]
&gt;&gt; I can see other thing, for example, change the hda=IDE to virtio.
&gt; I'd say switching the disk from IDE to virtio should be the
&gt; very first step - and while you're at it, you might as well
&gt; use virtio for the network interface too.
&gt;
&gt; -- 
&gt; Andrea Bolognani / Red Hat / Virtualization

</body></email><email><emailId>20170620071950</emailId><senderName>Andrea Bolognani</senderName><senderEmail>abologna@redhat.com</senderEmail><timestampReceived>2017-06-20 07:19:50-0400</timestampReceived><subject>Re: [libvirt-users] virtual drive performance</subject><body>

I'm in no way a performance expert, so I can't comment on
most of the points you raise; hopefully someone with more
experience in the area will be able to help you.

That said...

On Mon, 2017-06-19 at 12:38 +0200, Dominik Psenner wrote:
&gt; Switching from IDE to virtio basically means that the host then knows
&gt; that it runs on virtualized hardware and can do things differently? But
&gt; it also requires to modify the host with specialized drivers that even
&gt; influence the boot process. That feels more like a hack than a solution.

... I don't see why this would be a problem: installing
VirtIO drivers in a guest is not unlike installing drivers
that are tailored to the specific GPU in your laptop rather
than relying on the generic VGA drivers shipped with the OS.
Different hardware, different drivers.

Moreover, recent Windows versions ship Enlightened I/O
drivers which AFAIK do for guests running on Hyper-V pretty
much what VirtIO drivers do for those running on QEMU/KVM.

--  
Andrea Bolognani / Red Hat / Virtualization

</body></email><email><emailId>20170620082907</emailId><senderName>Gianluca Cecchi</senderName><senderEmail>gianluca.cecchi@gmail.com</senderEmail><timestampReceived>2017-06-20 08:29:07-0400</timestampReceived><subject>Re: [libvirt-users] virtual drive performance</subject><body>

On Mon, Jun 19, 2017 at 12:38 PM, Dominik Psenner &lt;dpsenner@gmail.com&gt;
wrote:

&gt; When running a virtualized host for example with virtual box we don't see
&gt; such an impact. What does virtual box do differently to improve virtualized
&gt; IO and could that help libvirt/qemu/kvm?
&gt;
&gt;
Hello,
I would jump here to try to put some information
Even in virtualbox, at virtual storage chapter
https://www.virtualbox.org/manual/ch05.html

you get:
"
In general, you should avoid IDE unless it is the only controller supported
by your guest. Whether you use SATA, SCSI or SAS does not make any real
difference. The variety of controllers is only supplied for VirtualBox for
compatibility with existing hardware and other hypervisors.
"

In fact, just tried with a not so new version of virtualbox (4.3.6 I don't
use it very often), if I create a VM with Windows 2012 as OS, by default it
sets the os disk on top of a virtualized sata controller, that should be
more efficient.
Or are you saying that you explicitly configured Virtualbox and selected
IDE as controller type for the guest?

Indeed I verified that in new version of virt-manager, when you configure a
windows 2012 R2 qemu/kvm VM instead, it does set IDE as the controller and
so the performance problems you see. Probably you choose the default
proposed?
In the past I also tried IDE on vSphere and it had the same performance
problems, because it is fully virtualized and unoptimized

You should set SCSI as controller type in my opinion if you have a recent
version of libvirt/qemu/kvm

That said, I don't know what is the level of support for W2016 at time with
virtio and virtio-scsi drivers.
You can download iso and virtual floppy images here:
https://fedoraproject.org/wiki/Windows_Virtio_Drivers

The method could be to add a new disk with the desired controller to the
guest: virtio or virtio-scsi
Then configure it using iso or vfd images
Then shutdown the guest and set also the boot disk with the same virtio or
virtio-scsi controller and try to boot again.
Having installed the drivers it should auto reconfigure (not tried with
w2012 and w2016)
If all goes well shutdown guest again and remove the second disk

Also, you can try to install a new guest and change the controller and
provide the installation process the vfs image file.
Try it on a test system to see if it works and if it gives you the desired
performance.
HIH a little,
Gianluca

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div class="gmail_extra"&gt;&lt;div class="gmail_quote"&gt;On Mon, Jun 19, 2017 \
at 12:38 PM, Dominik Psenner &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt;When running a virtualized host for example with \
virtual box we don't see such an impact. What does virtual box do differently to \
improve virtualized IO and could that help libvirt/qemu/kvm?&lt;div \
class="gmail-HOEnZb"&gt;&lt;div \
class="gmail-h5"&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Hello,&lt;/div&gt;&lt;div&gt;I \
would jump here to try to put some information&lt;/div&gt;&lt;div&gt;Even in virtualbox, at \
virtual storage chapter&lt;/div&gt;&lt;div&gt;&lt;a \
href="https://www.virtualbox.org/manual/ch05.html"&gt;https://www.virtualbox.org/manual/ch05.html&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;you \
get:&lt;/div&gt;&lt;div&gt;"&lt;/div&gt;&lt;div&gt;In general, you should avoid IDE unless it is the \
only controller supported by your guest. Whether you use SATA, SCSI or SAS does not \
make any real difference. The variety of controllers is only supplied for VirtualBox \
for compatibility with existing hardware and other \
hypervisors.&lt;br&gt;&lt;/div&gt;&lt;div&gt;"&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In fact, just tried with a \
not so new version of virtualbox (4.3.6 I don't use it very often), if I create a \
VM with Windows 2012 as OS, by default it sets the os disk on top of a virtualized \
sata controller, that should be more efficient.&lt;/div&gt;&lt;div&gt;Or are you saying that you \
explicitly configured Virtualbox and selected IDE as controller type for the \
guest?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Indeed I verified that in new version of \
virt-manager, when you configure a windows 2012 R2 qemu/kvm VM instead, it does set \
IDE as the controller and so the performance problems you see. Probably you choose \
the default proposed?&lt;/div&gt;&lt;div&gt;In the past I also tried IDE on vSphere and it had \
the same performance problems, because it is fully virtualized and unoptimized  \
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;You should set SCSI as controller type in my opinion if you \
have a recent version of libvirt/qemu/kvm&lt;/div&gt;&lt;div&gt;  &lt;/div&gt;&lt;div&gt;That said, I \
don't know what is the level of support for W2016 at time with virtio and \
virtio-scsi drivers.&lt;/div&gt;&lt;div&gt;You can download iso and virtual floppy images \
here:&lt;/div&gt;&lt;div&gt;&lt;a href="https://fedoraproject.org/wiki/Windows_Virtio_Drivers"&gt;https: \
//fedoraproject.org/wiki/Windows_Virtio_Drivers&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The \
method could be to add a new disk with the desired controller to the guest: virtio or \
virtio-scsi&lt;/div&gt;&lt;div&gt;Then configure it using iso or vfd images&lt;/div&gt;&lt;div&gt;Then \
shutdown the guest and set also the boot disk with the same virtio or virtio-scsi \
controller and try to boot again.&lt;/div&gt;&lt;div&gt;Having installed the drivers it should \
auto reconfigure (not tried with w2012 and w2016)&lt;/div&gt;&lt;div&gt;If all goes well shutdown \
guest again and remove the second disk&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also, you can try to \
install a new guest and change the controller and provide the installation process \
the vfs image file.&lt;/div&gt;&lt;div&gt;Try it on a test system to see if it works and if it \
gives you the desired performance.&lt;/div&gt;&lt;div&gt;HIH a \
little,&lt;/div&gt;&lt;div&gt;Gianluca&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170620131201</emailId><senderName>Gianluca Cecchi</senderName><senderEmail>gianluca.cecchi@gmail.com</senderEmail><timestampReceived>2017-06-20 13:12:01-0400</timestampReceived><subject>Re: [libvirt-users] virtual drive performance</subject><body>

On Tue, Jun 20, 2017 at 10:29 AM, Gianluca Cecchi &lt;gianluca.cecchi@gmail.com
&gt; wrote:

&gt;
&gt;
&gt; That said, I don't know what is the level of support for W2016 at time
&gt; with virtio and virtio-scsi drivers.
&gt; You can download iso and virtual floppy images here:
&gt; https://fedoraproject.org/wiki/Windows_Virtio_Drivers
&gt;

This message below just posted at ovirt-users mailing list so that for
drivers you can use this iso, that seems supporting W2016 (not tested
myslef yet):
http://lists.ovirt.org/pipermail/users/2017-June/082717.html

Gianluca

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div class="gmail_extra"&gt;&lt;div class="gmail_quote"&gt;On Tue, Jun 20, 2017 \
at 10:29 AM, Gianluca Cecchi &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:gianluca.cecchi@gmail.com" \
target="_blank"&gt;gianluca.cecchi@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_extra"&gt;&lt;div \
class="gmail_quote"&gt;&lt;br&gt;&lt;div&gt;  &lt;/div&gt;&lt;div&gt;That said, I don't know what is the \
level of support for W2016 at time with virtio and virtio-scsi drivers.&lt;/div&gt;&lt;div&gt;You \
can download iso and virtual floppy images here:&lt;/div&gt;&lt;div&gt;&lt;a \
href="https://fedoraproject.org/wiki/Windows_Virtio_Drivers" \
target="_blank"&gt;https://fedoraproject.org/&lt;wbr&gt;wiki/Windows_Virtio_Drivers&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This \
message below just posted at ovirt-users mailing list so that for drivers  you can \
use this iso, that seems supporting W2016 (not tested myslef yet):&lt;/div&gt;&lt;div&gt;&lt;a \
href="http://lists.ovirt.org/pipermail/users/2017-June/082717.html"&gt;http://lists.ovirt.org/pipermail/users/2017-June/082717.html&lt;/a&gt;&lt;/div&gt;&lt;div&gt; \
&lt;/div&gt;&lt;div&gt;Gianluca&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170620133840</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-06-20 13:38:40-0400</timestampReceived><subject>Re: [libvirt-users] virtual drive performance</subject><body>

Installing the virtio drivers is probably the best option, but is going 
to remain our last resort because it has further implications like a 
larger maintenance window. Thanks for pointing us towards the W2016 
virtio drivers.

Your last email was a little unclear to me. Would you expect a 
performance boost by changing bus='ide' to bus='scsi'? For instance 
changing this:

&lt;disk type='file' device='disk'&gt;
   &lt;driver name='qemu' type='qcow2' cache='none'/&gt;
   &lt;source 
file='/var/data/virtuals/machines/windows-server-2016-x64/image.qcow2'/&gt;
   &lt;backingStore/&gt;
   &lt;target dev='hda' bus='ide'/&gt;
   &lt;alias name='ide0-0-0'/&gt;
   &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&lt;/disk&gt;

to the following:

&lt;disk type='file' device='disk'&gt;
   &lt;driver name='qemu' type='qcow2' cache='none'/&gt;
   &lt;source 
file='/var/data/virtuals/machines/windows-server-2016-x64/image.qcow2'/&gt;
   &lt;backingStore/&gt;
   &lt;target dev='hda' bus='scsi'/&gt;
   &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&lt;/disk&gt;

Do you see any gotchas in this configuration that could prevent the 
virtualized guest to power on and boot up?


On 2017-06-20 15:12, Gianluca Cecchi wrote:
&gt; On Tue, Jun 20, 2017 at 10:29 AM, Gianluca Cecchi 
&gt; &lt;gianluca.cecchi@gmail.com &lt;mailto:gianluca.cecchi@gmail.com&gt;&gt; wrote:
&gt;
&gt;
&gt;     That said, I don't know what is the level of support for W2016 at
&gt;     time with virtio and virtio-scsi drivers.
&gt;     You can download iso and virtual floppy images here:
&gt;     https://fedoraproject.org/wiki/Windows_Virtio_Drivers
&gt;     &lt;https://fedoraproject.org/wiki/Windows_Virtio_Drivers&gt;
&gt;
&gt;
&gt; This message below just posted at ovirt-users mailing list so that for 
&gt; drivers you can use this iso, that seems supporting W2016 (not tested 
&gt; myslef yet):
&gt; http://lists.ovirt.org/pipermail/users/2017-June/082717.html
&gt; Gianluca


[Attachment #3 (text/html)]

&lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
  &lt;/head&gt;
  &lt;body text="#000000" bgcolor="#FFFFFF"&gt;
    &lt;p&gt;Installing the virtio drivers is probably the best option, but is
      going to remain our last resort because it has further
      implications like a larger maintenance window. Thanks for pointing
      us towards the W2016 virtio drivers.&lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;Your last email was a little unclear to me. Would you expect a
      performance boost by changing bus='ide' to bus='scsi'? For
      instance changing this:&lt;/p&gt;
    &lt;p&gt;&lt;disk type='file' device='disk'&gt;&lt;br&gt;
        &lt;driver name='qemu' type='qcow2' cache='none'/&gt;&lt;br&gt;
        &lt;source
file='/var/data/virtuals/machines/windows-server-2016-x64/image.qcow2'/&gt;&lt;br&gt;
        &lt;backingStore/&gt;&lt;br&gt;
        &lt;target dev='hda' bus='ide'/&gt;&lt;br&gt;
        &lt;alias name='ide0-0-0'/&gt;&lt;br&gt;
        &lt;address type='drive' controller='0' bus='0' target='0'
      unit='0'/&gt;&lt;br&gt;
      &lt;/disk&gt;&lt;/p&gt;
    &lt;p&gt;to the following:&lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;&lt;disk type='file' device='disk'&gt;&lt;br&gt;
        &lt;driver name='qemu' type='qcow2' cache='none'/&gt;&lt;br&gt;
        &lt;source
file='/var/data/virtuals/machines/windows-server-2016-x64/image.qcow2'/&gt;&lt;br&gt;
        &lt;backingStore/&gt;&lt;br&gt;
        &lt;target dev='hda' bus='scsi'/&gt;&lt;br&gt;
        &lt;address type='drive' controller='0' bus='0' target='0'
      unit='0'/&gt;&lt;br&gt;
      &lt;/disk&gt;&lt;/p&gt;
    &lt;p&gt;Do you see any gotchas in this configuration that could prevent
      the virtualized guest to power on and boot up?&lt;br&gt;
    &lt;/p&gt;
    &lt;br&gt;
    &lt;div class="moz-cite-prefix"&gt;On 2017-06-20 15:12, Gianluca Cecchi
      wrote:&lt;br&gt;
    &lt;/div&gt;
    &lt;blockquote type="cite"
cite="mid:CAG2kNCyTCh2cg-UT7sHXxgMRSAibGxWtqt_O-DzEGyXC7GkLFw@mail.gmail.com"&gt;
      &lt;div dir="ltr"&gt;
        &lt;div class="gmail_extra"&gt;
          &lt;div class="gmail_quote"&gt;On Tue, Jun 20, 2017 at 10:29 AM,
            Gianluca Cecchi &lt;span dir="ltr"&gt;&lt;&lt;a
                href="mailto:gianluca.cecchi@gmail.com" target="_blank"
                moz-do-not-send="true"&gt;gianluca.cecchi@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;
            wrote:&lt;br&gt;
            &lt;blockquote class="gmail_quote" style="margin:0px 0px 0px
              0.8ex;border-left:1px solid
              rgb(204,204,204);padding-left:1ex"&gt;
              &lt;div dir="ltr"&gt;
                &lt;div class="gmail_extra"&gt;
                  &lt;div class="gmail_quote"&gt;&lt;br&gt;
                    &lt;div&gt; &lt;/div&gt;
                    &lt;div&gt;That said, I don't know what is the level of
                      support for W2016 at time with virtio and
                      virtio-scsi drivers.&lt;/div&gt;
                    &lt;div&gt;You can download iso and virtual floppy images
                      here:&lt;/div&gt;
                    &lt;div&gt;&lt;a
                        href="https://fedoraproject.org/wiki/Windows_Virtio_Drivers"
                        target="_blank" \
moz-do-not-send="true"&gt;https://fedoraproject.org/&lt;wbr&gt;wiki/Windows_Virtio_Drivers&lt;/a&gt;&lt;/div&gt;
  &lt;/div&gt;
                &lt;/div&gt;
              &lt;/div&gt;
            &lt;/blockquote&gt;
            &lt;div&gt;&lt;br&gt;
            &lt;/div&gt;
            &lt;div&gt;This message below just posted at ovirt-users mailing
              list so that for drivers you can use this iso, that seems
              supporting W2016 (not tested myslef yet):&lt;/div&gt;
            &lt;div&gt;&lt;a
                href="http://lists.ovirt.org/pipermail/users/2017-June/082717.html"
                moz-do-not-send="true"&gt;http://lists.ovirt.org/pipermail/users/2017-June/082717.html&lt;/a&gt;&lt;/div&gt;
  &lt;div&gt; &lt;/div&gt;
            &lt;div&gt;Gianluca&lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
  &lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170620142432</emailId><senderName>Gianluca Cecchi</senderName><senderEmail>gianluca.cecchi@gmail.com</senderEmail><timestampReceived>2017-06-20 14:24:32-0400</timestampReceived><subject>Re: [libvirt-users] virtual drive performance</subject><body>

On Tue, Jun 20, 2017 at 3:38 PM, Dominik Psenner &lt;dpsenner@gmail.com&gt; wrote:

&gt;
&gt; to the following:
&gt;
&gt; &lt;disk type='file' device='disk'&gt;
&gt;   &lt;driver name='qemu' type='qcow2' cache='none'/&gt;
&gt;   &lt;source file='/var/data/virtuals/machines/windows-server-2016-
&gt; x64/image.qcow2'/&gt;
&gt;   &lt;backingStore/&gt;
&gt;   &lt;target dev='hda' bus='scsi'/&gt;
&gt;   &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt; &lt;/disk&gt;
&gt;
&gt; Do you see any gotchas in this configuration that could prevent the
&gt; virtualized guest to power on and boot up?
&gt;
&gt;
When I configure like this, from a linux guest point of view I get this
Symbios Logic SCSI Controller:
00:08.0 SCSI storage controller: LSI Logic / Symbios Logic 53c895a

But htis is true only if you add the SCSI controller too, not only the disk
definition.
In my case

    &lt;controller type='scsi' index='0'&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08'
function='0x0'/&gt;
    &lt;/controller&gt;

Note the slot='0x08' that is reflected into the first field of lspci inside
my linux guest.
So between your controllers you have to add the SCSI one

In my case (Fedora 25 with virt-manager-1.4.1-2.fc25.noarch,
qemu-kvm-2.7.1-6.fc25.x86_64, libvirt-2.2.1-2.fc25.x86_64) with "Disk bus"
set as SCSI in virt-manager, the xml defintiion for the guest is
automatically updated with the controller if not existent yet.
And the disk definition sections is like this:

    &lt;disk type='file' device='disk'&gt;
      &lt;driver name='qemu' type='qcow2'/&gt;
      &lt;source file='/var/lib/libvirt/images/slaxsmall.qcow2'/&gt;
      &lt;target dev='sda' bus='scsi'/&gt;
      &lt;boot order='1'/&gt;
      &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
    &lt;/disk&gt;

So I think you should set dev='sda' and not 'hda' in your xml for it

I don't kknow if w2016 contains the symbios logic drivers already
installed, so that a "simple" reboot could imply an automatic
reconfiguration of the guest....
Note also that in Windows when the hw configuration is considered heavily
changed, you could be asked to register again (I don't think that the IDE
--&gt; SCSI should imply it...)

Gianluca

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div class="gmail_extra"&gt;&lt;div class="gmail_quote"&gt;On Tue, Jun 20, 2017 \
at 3:38 PM, Dominik Psenner &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt;  
    
  
  &lt;div bgcolor="#FFFFFF"&gt;
    &lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;span class="gmail-"&gt;
    &lt;/span&gt;&lt;p&gt;to the following:&lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;&lt;span class="gmail-"&gt;&lt;disk type='file' \
                device='disk'&gt;&lt;br&gt;
         &lt;driver name='qemu' type='qcow2' \
cache='none'/&gt;&lt;br&gt;  &lt;source
file='/var/data/virtuals/&lt;wbr&gt;machines/windows-server-2016-&lt;wbr&gt;x64/image.qcow2'/&gt;&lt;br&gt;
  &lt;backingStore/&gt;&lt;br&gt;&lt;/span&gt;
         &lt;target dev='hda' bus='scsi'/&gt;&lt;span \
                class="gmail-"&gt;&lt;br&gt;
         &lt;address type='drive' controller='0' bus='0' \
target='0'  unit='0'/&gt;&lt;br&gt;
      &lt;/disk&gt;&lt;/span&gt;&lt;/p&gt;
    &lt;p&gt;Do you see any gotchas in this configuration that could prevent
      the virtualized guest to power on and boot up?&lt;br&gt;
    &lt;/p&gt;&lt;div&gt;&lt;div class="gmail-h5"&gt;&lt;br&gt;
  &lt;/div&gt;&lt;/div&gt;&lt;/div&gt;

&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;When I configure like this, \
from a linux guest point of view I get this Symbios Logic SCSI Controller:&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;00:08.0 SCSI storage controller: LSI Logic / Symbios Logic \
53c895a&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;But htis \
is true only if you add the SCSI controller too, not only the disk \
definition.&lt;/div&gt;&lt;div class="gmail_extra"&gt;In my case&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;div&gt;&lt;div&gt;      &lt;controller \
type='scsi' index='0'&gt;&lt;/div&gt;&lt;div&gt;         &lt;address \
type='pci' domain='0x0000' bus='0x00' slot='0x08' \
function='0x0'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/controller&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Note the slot='0x08' that \
is reflected into the first field of lspci inside my linux guest.&lt;/div&gt;&lt;div&gt;So \
between your controllers you have to add the SCSI one&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;In my case (Fedora 25 with \
virt-manager-1.4.1-2.fc25.noarch, qemu-kvm-2.7.1-6.fc25.x86_64, \
libvirt-2.2.1-2.fc25.x86_64) with "Disk bus" set as SCSI in virt-manager, \
the xml defintiion for the guest is automatically updated with the controller if not \
existent yet.&lt;/div&gt;&lt;div class="gmail_extra"&gt;And the disk definition sections is like \
this:&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;div \
class="gmail_extra"&gt;      &lt;disk type='file' \
device='disk'&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;         &lt;driver \
name='qemu' type='qcow2'/&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;         \
&lt;source file='/var/lib/libvirt/images/slaxsmall.qcow2'/&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;         &lt;target dev='sda' \
bus='scsi'/&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;         &lt;boot \
order='1'/&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;         &lt;address \
type='drive' controller='0' bus='0' target='0' \
unit='0'/&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;      \
&lt;/disk&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So I think you should set dev='sda' \
and not 'hda' in your xml for it&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I don't kknow \
if w2016 contains the symbios logic drivers already installed, so that a \
"simple" reboot could imply an automatic reconfiguration of the \
guest....&lt;/div&gt;&lt;div&gt;Note also that in Windows when the hw configuration is considered \
heavily changed, you could be asked to register again (I don't think that the IDE \
--&gt; SCSI should imply \
it...)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Gianluca&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;




</body></email><email><emailId>20170621183255</emailId><senderName>Dan</senderName><senderEmail>srwx4096@gmail.com</senderEmail><timestampReceived>2017-06-21 18:32:55-0400</timestampReceived><subject>Re: [libvirt-users] virtual drive performance</subject><body>

On Wed, Jun 14, 2017 at 10:26:09AM +0200, Dominik Psenner wrote:
&gt; Hi,
&gt; 
&gt; I'm investigating a performance issue on a virtualized windows server host
&gt; that is run on a ubuntu machine via libvirt/qemu. While the host can easily
&gt; read/write on the raid drive with 100Mmb/s as observable with dd, the
&gt; virtualized windows server running on that host is barely able to read/write
&gt; with at most 8Mb/s and averages around 1.4Mb/s. This has grown to the extent
&gt; that the virtualized host is often unresponsive and even unable to start up
&gt; its services with system default timeouts. Any help to improve the situation
&gt; is greatly appreciated.
&gt; 
Just to provide some even weirder numbers.

With Debian on bare metal hosting Debian VM by qemu, kvm, for the
I/O model comparison, I found there were about
40% performance drop (read), 26K(transaction/s) to 15 K (transaction/s)
in pbench switching from IDE to virtio; while 18 K for bare metal.

There would be 0 % to 70 % improvement in apache bench (request/s) depending
on concurrency level, switching from IDE-e1000 to virtio-virtio.

Very likely something was seriously wrong, as I expected when I/O bound,
virtio would have been the winner.

Dan
&gt; This is the configuration of the virtualized host:
&gt; 
&gt; ~$ virsh dumpxml windows-server-2016-x64
&gt; &lt;domain type='kvm' id='1'&gt;
&gt;   &lt;name&gt;windows-server-2016-x64&lt;/name&gt;
&gt;   &lt;uuid&gt;XXX&lt;/uuid&gt;
&gt;   &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;
&gt;   &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMemory&gt;
&gt;   &lt;vcpu placement='static'&gt;2&lt;/vcpu&gt;
&gt;   &lt;resource&gt;
&gt;     &lt;partition&gt;/machine&lt;/partition&gt;
&gt;   &lt;/resource&gt;
&gt;   &lt;os&gt;
&gt;     &lt;type arch='x86_64' machine='pc-i440fx-xenial'&gt;hvm&lt;/type&gt;
&gt;     &lt;boot dev='hd'/&gt;
&gt;   &lt;/os&gt;
&gt;   &lt;features&gt;
&gt;     &lt;acpi/&gt;
&gt;     &lt;apic/&gt;
&gt;     &lt;hyperv&gt;
&gt;       &lt;relaxed state='on'/&gt;
&gt;       &lt;vapic state='on'/&gt;
&gt;       &lt;spinlocks state='on' retries='8191'/&gt;
&gt;     &lt;/hyperv&gt;
&gt;   &lt;/features&gt;
&gt;   &lt;cpu mode='custom' match='exact'&gt;
&gt;     &lt;model fallback='allow'&gt;IvyBridge&lt;/model&gt;
&gt;     &lt;topology sockets='1' cores='2' threads='1'/&gt;
&gt;   &lt;/cpu&gt;
&gt;   &lt;clock offset='localtime'&gt;
&gt;     &lt;timer name='rtc' tickpolicy='catchup'/&gt;
&gt;     &lt;timer name='pit' tickpolicy='delay'/&gt;
&gt;     &lt;timer name='hpet' present='no'/&gt;
&gt;     &lt;timer name='hypervclock' present='yes'/&gt;
&gt;   &lt;/clock&gt;
&gt;   &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
&gt;   &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
&gt;   &lt;on_crash&gt;restart&lt;/on_crash&gt;
&gt;   &lt;pm&gt;
&gt;     &lt;suspend-to-mem enabled='no'/&gt;
&gt;     &lt;suspend-to-disk enabled='no'/&gt;
&gt;   &lt;/pm&gt;
&gt;   &lt;devices&gt;
&gt;     &lt;emulator&gt;/usr/bin/kvm-spice&lt;/emulator&gt;
&gt;     &lt;disk type='file' device='disk'&gt;
&gt;       &lt;driver name='qemu' type='qcow2' cache='none'/&gt;
&gt;       &lt;source
&gt; file='/var/data/virtuals/machines/windows-server-2016-x64/image.qcow2'/&gt;
&gt;       &lt;backingStore/&gt;
&gt;       &lt;target dev='hda' bus='ide'/&gt;
&gt;       &lt;alias name='ide0-0-0'/&gt;
&gt;       &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt;     &lt;/disk&gt;
&gt;     &lt;disk type='file' device='cdrom'&gt;
&gt;       &lt;driver name='qemu' type='raw'/&gt;
&gt;       &lt;source
&gt; file='/var/data/virtuals/machines/windows-server-2016-x64/dvd.iso'/&gt;
&gt;       &lt;backingStore/&gt;
&gt;       &lt;target dev='hdb' bus='ide'/&gt;
&gt;       &lt;readonly/&gt;
&gt;       &lt;alias name='ide0-0-1'/&gt;
&gt;       &lt;address type='drive' controller='0' bus='0' target='0' unit='1'/&gt;
&gt;     &lt;/disk&gt;
&gt;     &lt;controller type='usb' index='0' model='ich9-ehci1'&gt;
&gt;       &lt;alias name='usb'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05'
&gt; function='0x7'/&gt;
&gt;     &lt;/controller&gt;
&gt;     &lt;controller type='usb' index='0' model='ich9-uhci1'&gt;
&gt;       &lt;alias name='usb'/&gt;
&gt;       &lt;master startport='0'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05'
&gt; function='0x0' multifunction='on'/&gt;
&gt;     &lt;/controller&gt;
&gt;     &lt;controller type='usb' index='0' model='ich9-uhci2'&gt;
&gt;       &lt;alias name='usb'/&gt;
&gt;       &lt;master startport='2'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05'
&gt; function='0x1'/&gt;
&gt;     &lt;/controller&gt;
&gt;     &lt;controller type='usb' index='0' model='ich9-uhci3'&gt;
&gt;       &lt;alias name='usb'/&gt;
&gt;       &lt;master startport='4'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05'
&gt; function='0x2'/&gt;
&gt;     &lt;/controller&gt;
&gt;     &lt;controller type='pci' index='0' model='pci-root'&gt;
&gt;       &lt;alias name='pci.0'/&gt;
&gt;     &lt;/controller&gt;
&gt;     &lt;controller type='ide' index='0'&gt;
&gt;       &lt;alias name='ide'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x01'
&gt; function='0x1'/&gt;
&gt;     &lt;/controller&gt;
&gt;     &lt;interface type='bridge'&gt;
&gt;       &lt;mac address='52:54:00:0e:f2:23'/&gt;
&gt;       &lt;source bridge='br0'/&gt;
&gt;       &lt;target dev='vnet0'/&gt;
&gt;       &lt;model type='rtl8139'/&gt;
&gt;       &lt;alias name='net0'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
&gt; function='0x0'/&gt;
&gt;     &lt;/interface&gt;
&gt;     &lt;serial type='pty'&gt;
&gt;       &lt;source path='/dev/pts/1'/&gt;
&gt;       &lt;target port='0'/&gt;
&gt;       &lt;alias name='serial0'/&gt;
&gt;     &lt;/serial&gt;
&gt;     &lt;console type='pty' tty='/dev/pts/1'&gt;
&gt;       &lt;source path='/dev/pts/1'/&gt;
&gt;       &lt;target type='serial' port='0'/&gt;
&gt;       &lt;alias name='serial0'/&gt;
&gt;     &lt;/console&gt;
&gt;     &lt;input type='tablet' bus='usb'&gt;
&gt;       &lt;alias name='input0'/&gt;
&gt;     &lt;/input&gt;
&gt;     &lt;input type='mouse' bus='ps2'/&gt;
&gt;     &lt;input type='keyboard' bus='ps2'/&gt;
&gt;     &lt;graphics type='vnc' port='5900' autoport='yes' listen='127.0.0.1'&gt;
&gt;       &lt;listen type='address' address='127.0.0.1'/&gt;
&gt;     &lt;/graphics&gt;
&gt;     &lt;video&gt;
&gt;       &lt;model type='vga' vram='16384' heads='1'/&gt;
&gt;       &lt;alias name='video0'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02'
&gt; function='0x0'/&gt;
&gt;     &lt;/video&gt;
&gt;     &lt;memballoon model='virtio'&gt;
&gt;       &lt;alias name='balloon0'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x04'
&gt; function='0x0'/&gt;
&gt;     &lt;/memballoon&gt;
&gt;   &lt;/devices&gt;
&gt;   &lt;seclabel type='dynamic' model='apparmor' relabel='yes'&gt;
&gt;     &lt;label&gt;libvirt-XXX&lt;/label&gt;
&gt;     &lt;imagelabel&gt;libvirt-XXX&lt;/imagelabel&gt;
&gt;   &lt;/seclabel&gt;
&gt; &lt;/domain&gt;
&gt; 
&gt; Cheers,
&gt; Dominik
&gt; 
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users

</body></email><email><emailId>20170702081040</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-07-02 08:10:40-0400</timestampReceived><subject>Re: [libvirt-users] virtual drive performance</subject><body>

Hi

a small update on this. I just migrated the vm from the site to my laptop
and fired it up. The exact same xml configuration (except file paths and
such) starts up and bursts with 50Mb/s to 115Mb/s in the guest. This allows
only one reasonable answer: the cpu on my laptop is somehow better suited
to emulate IO than the CPU built into the host on site. The host there is a
HP proliant microserver gen8 with xeon processor. But the processor there
is also never capped at 100% when the guest copies files.

I just ran another test by copying a 3Gb large file on the guest. What I
can observe on my computer is that the copy process is not at a constant
rate but rather starts with 90Mb/s, then drops down to 30Mb/s, goes up to
70Mb/s, drops down to 1Mb/s, goes up to 75Mb/s, drops to 1Mb/s, goes up to
55Mb/s and the pattern continues. Please note that the drive is still
configured as:

&lt;driver name='qemu' type='qcow2' cache='none' io='threads'/&gt;

and I would expect a constant rate that is either high or low since there
is no caching involved and the underlying hard drive is a samsung ssd evo
850. To have an idea how fast that drive is on my laptop:

$ dd if=/dev/zero of=testfile bs=1M count=1000 oflag=direct
1000+0 records in
1000+0 records out
1048576000 bytes (1.0 GB, 1000 MiB) copied, 2.47301 s, 424 MB/s

I can further observe that the smaller the saved chunks are the slower the
overall performance is:

dd if=/dev/zero of=testfile bs=512K count=1000 oflag=direct
1000+0 records in
1000+0 records out
524288000 bytes (524 MB, 500 MiB) copied, 1.34874 s, 389 MB/s

$ dd if=/dev/zero of=testfile bs=5K count=1000 oflag=direct
1000+0 records in
1000+0 records out
5120000 bytes (5.1 MB, 4.9 MiB) copied, 0.105109 s, 48.7 MB/s

$ dd if=/dev/zero of=testfile bs=1K count=10000 oflag=direct
10000+0 records in
10000+0 records out
10240000 bytes (10 MB, 9.8 MiB) copied, 0.668438 s, 15.3 MB/s

$ dd if=/dev/zero of=testfile bs=512 count=20000 oflag=direct
20000+0 records in
20000+0 records out
10240000 bytes (10 MB, 9.8 MiB) copied, 1.10964 s, 9.2 MB/s

Could this be a limiting factor? Does qemu/kvm do many many writes of just
a few bytes?

Ideas, anyone?

Cheers

2017-06-21 20:46 GMT+02:00 Dan &lt;srwx4096@gmail.com&gt;:

&gt; On Tue, Jun 20, 2017 at 04:24:32PM +0200, Gianluca Cecchi wrote:
&gt; &gt; On Tue, Jun 20, 2017 at 3:38 PM, Dominik Psenner &lt;dpsenner@gmail.com&gt;
&gt; wrote:
&gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; to the following:
&gt; &gt; &gt;
&gt; &gt; &gt; &lt;disk type='file' device='disk'&gt;
&gt; &gt; &gt;   &lt;driver name='qemu' type='qcow2' cache='none'/&gt;
&gt; &gt; &gt;   &lt;source file='/var/data/virtuals/machines/windows-server-2016-
&gt; &gt; &gt; x64/image.qcow2'/&gt;
&gt; &gt; &gt;   &lt;backingStore/&gt;
&gt; &gt; &gt;   &lt;target dev='hda' bus='scsi'/&gt;
&gt; &gt; &gt;   &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt; &gt; &gt; &lt;/disk&gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Do you see any gotchas in this configuration that could prevent the
&gt; &gt; &gt; virtualized guest to power on and boot up?
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; When I configure like this, from a linux guest point of view I get this
&gt; &gt; Symbios Logic SCSI Controller:
&gt; &gt; 00:08.0 SCSI storage controller: LSI Logic / Symbios Logic 53c895a
&gt; &gt;
&gt; &gt; But htis is true only if you add the SCSI controller too, not only the
&gt; disk
&gt; &gt; definition.
&gt; &gt; In my case
&gt; &gt;
&gt; &gt;     &lt;controller type='scsi' index='0'&gt;
&gt; &gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08'
&gt; &gt; function='0x0'/&gt;
&gt; &gt;     &lt;/controller&gt;
&gt; &gt;
&gt; &gt; Note the slot='0x08' that is reflected into the first field of lspci
&gt; inside
&gt; &gt; my linux guest.
&gt; &gt; So between your controllers you have to add the SCSI one
&gt; &gt;
&gt; &gt; In my case (Fedora 25 with virt-manager-1.4.1-2.fc25.noarch,
&gt; &gt; qemu-kvm-2.7.1-6.fc25.x86_64, libvirt-2.2.1-2.fc25.x86_64) with "Disk
&gt; bus"
&gt; &gt; set as SCSI in virt-manager, the xml defintiion for the guest is
&gt; &gt; automatically updated with the controller if not existent yet.
&gt; &gt; And the disk definition sections is like this:
&gt; &gt;
&gt; &gt;     &lt;disk type='file' device='disk'&gt;
&gt; &gt;       &lt;driver name='qemu' type='qcow2'/&gt;
&gt; &gt;       &lt;source file='/var/lib/libvirt/images/slaxsmall.qcow2'/&gt;
&gt; &gt;       &lt;target dev='sda' bus='scsi'/&gt;
&gt; &gt;       &lt;boot order='1'/&gt;
&gt; &gt;       &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt; &gt;     &lt;/disk&gt;
&gt; &gt;
&gt; &gt; So I think you should set dev='sda' and not 'hda' in your xml for it
&gt; &gt;
&gt; I am actually very curious to know if that would make a difference. I
&gt; don't have a such windows vm images ready to test at present.
&gt;
&gt; Dan
&gt; &gt; I don't kknow if w2016 contains the symbios logic drivers already
&gt; &gt; installed, so that a "simple" reboot could imply an automatic
&gt; &gt; reconfiguration of the guest....
&gt; &gt; Note also that in Windows when the hw configuration is considered heavily
&gt; &gt; changed, you could be asked to register again (I don't think that the IDE
&gt; &gt; --&gt; SCSI should imply it...)
&gt; &gt;
&gt; &gt; Gianluca
&gt;
&gt; &gt; _______________________________________________
&gt; &gt; libvirt-users mailing list
&gt; &gt; libvirt-users@redhat.com
&gt; &gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;
&gt;


-- 
Dominik Psenner

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;Hi&lt;br&gt;&lt;br&gt;&lt;/div&gt;a small update on this. I just migrated the \
vm  from the site to my laptop and fired it up. The exact same xml 
configuration (except file paths and such) starts up and bursts with 
50Mb/s to 115Mb/s in the guest. This allows only one reasonable answer: 
the cpu on my laptop is somehow better suited to emulate IO than the CPU
 built into the host on site. The host there is a HP proliant 
microserver gen8 with xeon processor. But the processor there is also 
never capped at 100% when the guest copies files.&lt;br&gt;&lt;br&gt;I just ran 
another test by copying a 3Gb large file on the guest. What I can 
observe on my computer is that the copy process is not at a constant 
rate but rather starts with 90Mb/s, then drops down to 30Mb/s, goes up 
to 70Mb/s, drops down to 1Mb/s, goes up to 75Mb/s, drops to 1Mb/s, goes 
up to 55Mb/s and the pattern continues. Please note that the drive is 
still configured as:&lt;br&gt;&lt;br&gt;&lt;driver name='qemu' type='qcow2' \
cache='none' io='threads'/&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;and  I would expect a \
constant rate that is either high or low since there  is no caching involved and the \
underlying hard drive is a samsung ssd  evo 850. To have an idea how fast that drive \
is on my laptop:&lt;br&gt;&lt;br&gt;$ dd if=/dev/zero of=testfile bs=1M count=1000 \
oflag=direct&lt;br&gt;1000+0 records in&lt;br&gt;1000+0 records out&lt;br&gt;1048576000 bytes (1.0 GB, \
1000 MiB) copied, 2.47301 s, 424 MB/s&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I can further observe \
that the smaller the saved chunks are the slower the overall performance \
is:&lt;br&gt;&lt;br&gt;dd if=/dev/zero of=testfile bs=512K count=1000 oflag=direct&lt;br&gt;1000+0 \
records in&lt;br&gt;1000+0 records out&lt;br&gt;524288000 bytes (524 MB, 500 MiB) copied, 1.34874 \
s, 389 MB/s&lt;br&gt;&lt;br&gt;$ dd if=/dev/zero of=testfile bs=5K count=1000 \
oflag=direct&lt;br&gt;1000+0 records in&lt;br&gt;1000+0 records out&lt;br&gt;5120000 bytes (5.1 MB, 4.9 \
MiB) copied, 0.105109 s, 48.7 MB/s&lt;br&gt;&lt;br&gt;$ dd if=/dev/zero of=testfile bs=1K \
count=10000 oflag=direct&lt;br&gt;10000+0 records in&lt;br&gt;10000+0 records out&lt;br&gt;10240000 \
bytes (10 MB, 9.8 MiB) copied, 0.668438 s, 15.3 MB/s&lt;br&gt;&lt;br&gt;$ dd if=/dev/zero \
of=testfile bs=512 count=20000 oflag=direct&lt;br&gt;20000+0 records in&lt;br&gt;20000+0 records \
out&lt;br&gt;10240000 bytes (10 MB, 9.8 MiB) copied, 1.10964 s, 9.2 \
MB/s&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Could this be a limiting factor? Does qemu/kvm do many many \
writes of just a few bytes?&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;Ideas, \
anyone?&lt;br&gt;&lt;br&gt;&lt;/div&gt;Cheers&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-06-21 20:46 GMT+02:00 Dan &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:srwx4096@gmail.com" \
target="_blank"&gt;srwx4096@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
class="HOEnZb"&gt;&lt;div class="h5"&gt;On Tue, Jun 20, 2017 at 04:24:32PM +0200, Gianluca \
Cecchi wrote:&lt;br&gt; &gt; On Tue, Jun 20, 2017 at 3:38 PM, Dominik Psenner &lt;&lt;a \
href="mailto:dpsenner@gmail.com"&gt;dpsenner@gmail.com&lt;/a&gt;&gt; wrote:&lt;br&gt; &gt;&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; to the following:&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; &lt;disk type='file' device='disk'&gt;&lt;br&gt;
&gt; &gt;     &lt;driver name='qemu' type='qcow2' \
cache='none'/&gt;&lt;br&gt; &gt; &gt;     &lt;source \
file='/var/data/virtuals/&lt;wbr&gt;machines/windows-server-2016-&lt;br&gt; &gt; &gt; \
x64/image.qcow2'/&gt;&lt;br&gt; &gt; &gt;     &lt;backingStore/&gt;&lt;br&gt;
&gt; &gt;     &lt;target dev='hda' bus='scsi'/&gt;&lt;br&gt;
&gt; &gt;     &lt;address type='drive' controller='0' bus='0' \
target='0' unit='0'/&gt;&lt;br&gt; &gt; &gt; &lt;/disk&gt;&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; Do you see any gotchas in this configuration that could prevent the&lt;br&gt;
&gt; &gt; virtualized guest to power on and boot up?&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; When I configure like this, from a linux guest point of view I get this&lt;br&gt;
&gt; Symbios Logic SCSI Controller:&lt;br&gt;
&gt; 00:08.0 SCSI storage controller: LSI Logic / Symbios Logic 53c895a&lt;br&gt;
&gt;&lt;br&gt;
&gt; But htis is true only if you add the SCSI controller too, not only the disk&lt;br&gt;
&gt; definition.&lt;br&gt;
&gt; In my case&lt;br&gt;
&gt;&lt;br&gt;
&gt;        &lt;controller type='scsi' index='0'&gt;&lt;br&gt;
&gt;           &lt;address type='pci' domain='0x0000' \
bus='0x00' slot='0x08'&lt;br&gt; &gt; function='0x0'/&gt;&lt;br&gt;
&gt;        &lt;/controller&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; Note the slot='0x08' that is reflected into the first field of lspci \
inside&lt;br&gt; &gt; my linux guest.&lt;br&gt;
&gt; So between your controllers you have to add the SCSI one&lt;br&gt;
&gt;&lt;br&gt;
&gt; In my case (Fedora 25 with virt-manager-1.4.1-2.fc25.&lt;wbr&gt;noarch,&lt;br&gt;
&gt; qemu-kvm-2.7.1-6.fc25.x86_64, libvirt-2.2.1-2.fc25.x86_64) with "Disk \
bus"&lt;br&gt; &gt; set as SCSI in virt-manager, the xml defintiion for the guest \
is&lt;br&gt; &gt; automatically updated with the controller if not existent yet.&lt;br&gt;
&gt; And the disk definition sections is like this:&lt;br&gt;
&gt;&lt;br&gt;
&gt;        &lt;disk type='file' device='disk'&gt;&lt;br&gt;
&gt;           &lt;driver name='qemu' type='qcow2'/&gt;&lt;br&gt;
&gt;           &lt;source \
file='/var/lib/libvirt/images/&lt;wbr&gt;slaxsmall.qcow2'/&gt;&lt;br&gt; &gt;           \
&lt;target dev='sda' bus='scsi'/&gt;&lt;br&gt; &gt;           &lt;boot \
order='1'/&gt;&lt;br&gt; &gt;           &lt;address type='drive' \
controller='0' bus='0' target='0' unit='0'/&gt;&lt;br&gt; \
&gt;        &lt;/disk&gt;&lt;br&gt; &gt;&lt;br&gt;
&gt; So I think you should set dev='sda' and not 'hda' in your xml \
for it&lt;br&gt; &gt;&lt;br&gt;
&lt;/div&gt;&lt;/div&gt;I am actually very curious to know if that would make a difference. I&lt;br&gt;
don't have a such windows vm images ready to test at present.&lt;br&gt;
&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;br&gt;
Dan&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;span class="im HOEnZb"&gt;&gt; I don't kknow if w2016 contains the \
symbios logic drivers already&lt;br&gt; &gt; installed, so that a "simple" reboot \
could imply an automatic&lt;br&gt; &gt; reconfiguration of the guest....&lt;br&gt;
&gt; Note also that in Windows when the hw configuration is considered heavily&lt;br&gt;
&gt; changed, you could be asked to register again (I don't think that the \
IDE&lt;br&gt; &gt; --&gt; SCSI should imply it...)&lt;br&gt;
&gt;&lt;br&gt;
&gt; Gianluca&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;&lt;div class="HOEnZb"&gt;&lt;div class="h5"&gt;&gt; \
______________________________&lt;wbr&gt;_________________&lt;br&gt; &gt; libvirt-users mailing \
list&lt;br&gt; &gt; &lt;a href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;
 &gt; &lt;a href="https://www.redhat.com/mailman/listinfo/libvirt-users" \
rel="noreferrer" target="_blank"&gt;https://www.redhat.com/&lt;wbr&gt;mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;
 &lt;br&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;br&gt;-- &lt;br&gt;&lt;div \
class="gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik \
Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;



</body></email><email><emailId>20171204133245</emailId><senderName>Pavel Hrdina</senderName><senderEmail>phrdina@redhat.com</senderEmail><timestampReceived>2017-12-04 13:32:45-0400</timestampReceived><subject>Re: [libvirt-users] Guest Reboot After Plug HDMI</subject><body>


On Mon, Dec 04, 2017 at 04:02:33PM +0800, Lying wrote:
&gt; Hello, Everybody. I encounter a problem when i using my guest.
&gt; 
&gt; I booting my guest without HDMI primarily, Then i add it, but my guest is be \
&gt; rebooted. 
&gt; 
&gt; To know what cause it, i do it again, especially i check my guest is running normal \
&gt; or not with "ping" before plugging, that's well. 
&gt; 
&gt; What i was suffer? can you help me solve it?
&gt; 
&gt; 
&gt; Following message is detailed!!!
&gt; 
&gt; 
&gt; Guest: window 7 profession
&gt; 
&gt; 
&gt; Linux: Ubuntu 1604
&gt; 
&gt; 
&gt; Qemu:1 v2.11.0-rc0 
&gt; 
&gt; 
&gt; Libvirt: 3.9
&gt; 
&gt; 
&gt; method of  booting: virsh start myGuest1
&gt; 
&gt; 
&gt; method of plug HDMI: virsh qemu-monitor-command myGuest1 --hmp 'device_add \
&gt; driver=vfio-pci,host=01:00.0,xvga=on,multifunction=yes' 

Hi, this command hot-plugs the whole GPU card, and I'm not surprised
that it doesn't work.  Passing the whole GPU to guest is a little bit
tricky and requires several steps.  Main reason why it's not automated
yet is that each HW combination is specific and requires different
tuning.

I would recommend you to read this wiki page [1].

[1] &lt;https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF&gt;

I was able to configure it on my computer, basically you need to make
sure that you have IOMMU available and enabled, that your GPU card is
in it's own isolated IOMMU group, configure kernel to assign vfio-pci
driver while booting and properly configure guest XML in libvirt.

Everything is described and explained on that wiki page.

Pavel


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20171102155831</emailId><senderName>Ján Tomko</senderName><senderEmail>jtomko@redhat.com</senderEmail><timestampReceived>2017-11-02 15:58:31-0400</timestampReceived><subject>Re: [libvirt-users] What global_quota option mean? What's its logic?</subject><body>


On Thu, Nov 02, 2017 at 03:03:56PM +0200, Volo M. wrote:
&gt; Hi techs,
&gt; 
&gt; Could you please explain or refer me to documentation where I could find a
&gt; description of global_quota schedinfo option. Someone told me that it could
&gt; mean a cpu limitation in percents like:
&gt; global_quota   : 25000 (does it mean cpu limit % set to 25  ?)
&gt; 

The _quota values are relative to the _period, both in milliseconds and refer
to the cumulative CPU time available to all the processes/threads in a group.

See the documentation in the kernel:
https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/Documentation/scheduler/sched-bwc.txt


So with global_period being set to 100000, a value of 25000 would mean
that all the threads of the virtual machine would be limited to use at
most 25 % of 1 CPU.

&gt; Is it true?
&gt; What other parameters mean in below output?
&gt; I didn't find any related documentation at libvirt.org.
&gt; Could you help me to describe me or refer to some description what below
&gt; schedinfo options mean? Thanks.
&gt; 

[...]

&gt; 
&gt; [root@cpkvm ~]# virsh schedinfo 3 --set global_quota=25
&gt; 
&gt; Scheduler      : posix
&gt; 
&gt; error: invalid argument: value of 'global_quota' is out of range [1000,
&gt; 18446744073709551]
&gt; 
&gt; [1000, 18446744073709551]  - what this range mean?
&gt; 

These are the minimum and maximum values that were accepted by the
kernel at the time when this error message was implemented in libvirt.

Jan


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20171003064410</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-10-03 06:44:10-0400</timestampReceived><subject>Re: [libvirt-users] error: internal error: missing backend for pool type 11 (zfs)</subject><body>

On 10/02/2017 11:42 PM, Nick Gilmour wrote:
&gt; Hi all,
&gt; 
&gt; I'm trying to setup virt-manager with ZFS als storage on my Arch box. I
&gt; have created a pool named virt-pool and tried to use it as storage. First
&gt; with virt-manager and then in the terminal with virsh but I'm always
&gt; getting the following errors:
&gt; 
&gt; 
&gt; 
&gt; *virsh # pool-define-as --name zfsvirtpool --source-name virt-pool --type
&gt; zfserror: Failed to define pool zfsvirtpoolerror: internal error: missing
&gt; backend for pool type 11 (zfs)*

Your libvirt was built without support for ZFS. You need to contact your
distribution manufacturer and ask them to enable it. Or build libvirt on
your own.

However, as I am writing these lines I realized two things:

1) there's no API to query loaded drivers/storage backends.

2) storage backends are static. While we have libvirt drivers in
separate modules (.so files) and load them at start up, it's not the
same story with storage driver backends. These are hardcoded into the
storage driver. Might be worth it to have them dynamically loadable too.

Michal

</body></email><email><emailId>20171003134817</emailId><senderName>Nick Gilmour</senderName><senderEmail>nickeforos@gmail.com</senderEmail><timestampReceived>2017-10-03 13:48:17-0400</timestampReceived><subject>Re: [libvirt-users] error: internal error: missing backend for pool type 11 (zfs)</subject><body>

@Michal: Thanks for your reply!

Indeed I have found a package in the AUR (libvirt-zfs) and only had to
change to the current version and add zfs-utils as dependency in the
PKGBUILD. Now I don't get the previous error anymore but I still cannot
setup a VM because I constantly get errors due to wrong permissions.

I have tried to change the permissions in:

   - /etc/libvirt/qemu.conf
   - /virt-pool/vmm
   - /dev/zvol/virt-pool


also:

# zfs allow &lt;user&gt; create,destroy,mount virt-pool/vmm

didn't help.

What are the correct permissions? Which user and group?

Nick


On Tue, Oct 3, 2017 at 8:44 AM, Michal Privoznik &lt;mprivozn@redhat.com&gt;
wrote:

&gt; On 10/02/2017 11:42 PM, Nick Gilmour wrote:
&gt; &gt; Hi all,
&gt; &gt;
&gt; &gt; I'm trying to setup virt-manager with ZFS als storage on my Arch box. I
&gt; &gt; have created a pool named virt-pool and tried to use it as storage. First
&gt; &gt; with virt-manager and then in the terminal with virsh but I'm always
&gt; &gt; getting the following errors:
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; *virsh # pool-define-as --name zfsvirtpool --source-name virt-pool --type
&gt; &gt; zfserror: Failed to define pool zfsvirtpoolerror: internal error: missing
&gt; &gt; backend for pool type 11 (zfs)*
&gt;
&gt; Your libvirt was built without support for ZFS. You need to contact your
&gt; distribution manufacturer and ask them to enable it. Or build libvirt on
&gt; your own.
&gt;
&gt; However, as I am writing these lines I realized two things:
&gt;
&gt; 1) there's no API to query loaded drivers/storage backends.
&gt;
&gt; 2) storage backends are static. While we have libvirt drivers in
&gt; separate modules (.so files) and load them at start up, it's not the
&gt; same story with storage driver backends. These are hardcoded into the
&gt; storage driver. Might be worth it to have them dynamically loadable too.
&gt;
&gt; Michal
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;@Michal: Thanks for your reply!&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Indeed I have found \
a package in the AUR (libvirt-zfs) and only had to change to the current version and \
add zfs-utils as dependency in the PKGBUILD. Now I don't get the previous error \
anymore but I still cannot setup a VM because I constantly get errors due to wrong \
permissions.  &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I have tried to change the permissions \
in:&lt;/div&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;/etc/libvirt/qemu.conf&lt;br&gt;&lt;/li&gt;&lt;li&gt;/virt-pool/vmm&lt;br&gt;&lt;/li&gt;&lt;li&gt;/dev/zvol/virt-pool&lt;br&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-family:monospace"&gt;&lt;span \
style="color:rgb(0,0,0)"&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-family:monospace"&gt;&lt;span \
style="color:rgb(0,0,0)"&gt;also:&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;# zfs allow \
&lt;user&gt; create,destroy,mount virt-pool/vmm&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;didn't \
help.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What are the correct permissions? Which user and \
group?  &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Nick&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;On Tue, Oct 3, 2017 at 8:44 AM, \
Michal Privoznik &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:mprivozn@redhat.com" \
target="_blank"&gt;mprivozn@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span class=""&gt;On 10/02/2017 11:42 PM, Nick Gilmour \
wrote:&lt;br&gt; &gt; Hi all,&lt;br&gt;
&gt;&lt;br&gt;
&gt; I'm trying to setup virt-manager with ZFS als storage on my Arch box. I&lt;br&gt;
&gt; have created a pool named virt-pool and tried to use it as storage. First&lt;br&gt;
&gt; with virt-manager and then in the terminal with virsh but I'm always&lt;br&gt;
&gt; getting the following errors:&lt;br&gt;
&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt;&lt;br&gt;
&lt;/span&gt;&gt; *virsh # pool-define-as --name zfsvirtpool --source-name virt-pool \
--type&lt;br&gt; &gt; zfserror: Failed to define pool zfsvirtpoolerror: internal error: \
missing&lt;br&gt; &gt; backend for pool type 11 (zfs)*&lt;br&gt;
&lt;br&gt;
Your libvirt was built without support for ZFS. You need to contact your&lt;br&gt;
distribution manufacturer and ask them to enable it. Or build libvirt on&lt;br&gt;
your own.&lt;br&gt;
&lt;br&gt;
However, as I am writing these lines I realized two things:&lt;br&gt;
&lt;br&gt;
1) there's no API to query loaded drivers/storage backends.&lt;br&gt;
&lt;br&gt;
2) storage backends are static. While we have libvirt drivers in&lt;br&gt;
separate modules (.so files) and load them at start up, it's not the&lt;br&gt;
same story with storage driver backends. These are hardcoded into the&lt;br&gt;
storage driver. Might be worth it to have them dynamically loadable too.&lt;br&gt;
&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;br&gt;
Michal&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20171003141535</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-10-03 14:15:35-0400</timestampReceived><subject>Re: [libvirt-users] error: internal error: missing backend for pool type 11 (zfs)</subject><body>

On 10/03/2017 03:48 PM, Nick Gilmour wrote:
&gt; @Michal: Thanks for your reply!
&gt; 
&gt; Indeed I have found a package in the AUR (libvirt-zfs) and only had to
&gt; change to the current version and add zfs-utils as dependency in the
&gt; PKGBUILD. Now I don't get the previous error anymore but I still cannot
&gt; setup a VM because I constantly get errors due to wrong permissions.
&gt; 
&gt; I have tried to change the permissions in:
&gt; 
&gt;    - /etc/libvirt/qemu.conf
&gt;    - /virt-pool/vmm
&gt;    - /dev/zvol/virt-pool
&gt; 
&gt; 
&gt; also:
&gt; 
&gt; # zfs allow &lt;user&gt; create,destroy,mount virt-pool/vmm
&gt; 
&gt; didn't help.
&gt; 
&gt; What are the correct permissions? Which user and group?

Interesting. Libvirtd is/should be running as root, therefore it
shouldn't have to get EPERM. What's the actual error message you're seeing?

Michal

</body></email><email><emailId>20171003144020</emailId><senderName>Nick Gilmour</senderName><senderEmail>nickeforos@gmail.com</senderEmail><timestampReceived>2017-10-03 14:40:20-0400</timestampReceived><subject>Re: [libvirt-users] error: internal error: missing backend for pool type 11 (zfs)</subject><body>

I have set root in both for user and group in the qemu.conf and changed the
file permissions to root like it was before. Now I'm getting this error:

*# Error 1#*
*Unable to complete install: 'internal error: process exited while
connecting to monitor: us=pci.0,addr=0x5.0x7 -device
ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x5
-device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x5.0x1
-device ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x5.0x2
-device virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x6 -drive
file=/dev/zvol/virt-pool/vmm/fedora,format=raw,if=none,id=drive-ide0-0-0,cache=none,aio=native
                
-device
ide-hd,bus=ide.0,unit=0,drive=drive-ide0-0-0,id=ide0-0-0,bootindex=2 -drive
'file=/home/nick/Downloads/#IMAGES#/Fedora-Workstation-Live-x86_64-26-1.5.iso,format=raw,if=none,id=drive-ide0-0-1,readonly=on'
                
-device
ide-cd,bus=ide.0,unit=1,drive=drive-ide0-0-1,id=ide0-0-1,bootindex=1
-netdev user,id=hostnet0 -device
rtl8139,netdev=hostnet0,id=net0,mac=52:54:00:ad:21:19,bus=pci.0,addr=0x3
-chardev pty,id=charserial0 -device
isa-serial,chardev=charserial0,id=serial0 -chardev
spicevmc,id=charchannel0,name=vdagent -device virtserialport,bus=virtio-se'*

*Traceback (most recent call last):*
*  File "/usr/share/virt-manager/virtManager/asyncjob.py", line 89, in
cb_wrapper*
*    callback(asyncjob, *args, **kwargs)*
*  File "/usr/share/virt-manager/virtManager/create.py", line 2545, in
_do_async_install*
*    guest.start_install(meter=meter)*
*  File "/usr/share/virt-manager/virtinst/guest.py", line 498, in
start_install*
*    doboot, transient)*
*  File "/usr/share/virt-manager/virtinst/guest.py", line 434, in
_create_guest*
*    domain = self.conn.createXML(install_xml or final_xml, 0)*
*  File "/usr/lib/python2.7/site-packages/libvirt.py", line 3640, in
createXML*
*    if ret is None:raise libvirtError('virDomainCreateXML() failed',
conn=self)*
*libvirtError: internal error: process exited while connecting to monitor:
us=pci.0,addr=0x5.0x7 -device
ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x5
-device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x5.0x1
-device ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x5.0x2
-device virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x6 -drive
file=/dev/zvol/virt-pool/vmm/fedora,format=raw,if=none,id=drive-ide0-0-0,cache=none,aio=native
                
-device
ide-hd,bus=ide.0,unit=0,drive=drive-ide0-0-0,id=ide0-0-0,bootindex=2 -drive
'file=/home/nick/Downloads/#IMAGES#/Fedora-Workstation-Live-x86_64-26-1.5.iso,format=raw,if=none,id=drive-ide0-0-1,readonly=on'
                
-device
ide-cd,bus=ide.0,unit=1,drive=drive-ide0-0-1,id=ide0-0-1,bootindex=1
-netdev user,id=hostnet0 -device
rtl8139,netdev=hostnet0,id=net0,mac=52:54:00:ad:21:19,bus=pci.0,addr=0x3
-chardev pty,id=charserial0 -device
isa-serial,chardev=charserial0,id=serial0 -chardev
spicevmc,id=charchannel0,name=vdagent -device virtserialport,bus=virtio-se*


Before that I was getting these errors:

*# Error 2#*
*Unable to complete install: 'internal error: process exited while
connecting to monitor: rdev spicevmc,id=charchannel0,name=vdagent -device
virtserialport,bus=virtio-serial0.0,nr=1,chardev=charchannel0,id=channel0,name=com.redhat.spice.0
                
-spice
port=5901,addr=127.0.0.1,disable-ticketing,image-compression=off,seamless-migration=on
                
-device
qxl-vga,id=video0,ram_size=67108864,vram_size=67108864,vram64_size_mb=0,vgamem_mb=16,max_outputs=1,bus=pci.0,addr=0x2
                
-device intel-hda,id=sound0,bus=pci.0,addr=0x4 -device
hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -chardev
spicevmc,id=charredir0,name=usbredir -device
usb-redir,chardev=charredir0,id=redir0,bus=usb.0,port=1 -chardev
spicevmc,id=charredir1,name=usbredir -device
usb-redir,chardev=charredir1,id=redir1,bus=usb.0,port=2 -device
virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x7 -msg timestamp=on*
*2017-10-03T13:13:12.185700Z qemu-system-x86_64: -chardev
pty,id=charserial0: char device redirected to /dev/pts/11 (label
charserial0)*
*2017-10-03T13:13:12.187799Z qemu-system-x86_64: -drive
file=/dev/zvol/virt-p'*

*Traceback (most recent call last):*
*  File "/usr/share/virt-manager/virtManager/asyncjob.py", line 89, in
cb_wrapper*
*    callback(asyncjob, *args, **kwargs)*
*  File "/usr/share/virt-manager/virtManager/create.py", line 2545, in
_do_async_install*
*    guest.start_install(meter=meter)*
*  File "/usr/share/virt-manager/virtinst/guest.py", line 498, in
start_install*
*    doboot, transient)*
*  File "/usr/share/virt-manager/virtinst/guest.py", line 434, in
_create_guest*
*    domain = self.conn.createXML(install_xml or final_xml, 0)*
*  File "/usr/lib/python2.7/site-packages/libvirt.py", line 3640, in
createXML*
*    if ret is None:raise libvirtError('virDomainCreateXML() failed',
conn=self)*
*libvirtError: internal error: process exited while connecting to monitor:
rdev spicevmc,id=charchannel0,name=vdagent -device
virtserialport,bus=virtio-serial0.0,nr=1,chardev=charchannel0,id=channel0,name=com.redhat.spice.0
                
-spice
port=5901,addr=127.0.0.1,disable-ticketing,image-compression=off,seamless-migration=on
                
-device
qxl-vga,id=video0,ram_size=67108864,vram_size=67108864,vram64_size_mb=0,vgamem_mb=16,max_outputs=1,bus=pci.0,addr=0x2
                
-device intel-hda,id=sound0,bus=pci.0,addr=0x4 -device
hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -chardev
spicevmc,id=charredir0,name=usbredir -device
usb-redir,chardev=charredir0,id=redir0,bus=usb.0,port=1 -chardev
spicevmc,id=charredir1,name=usbredir -device
usb-redir,chardev=charredir1,id=redir1,bus=usb.0,port=2 -device
virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x7 -msg timestamp=on*
*2017-10-03T13:13:12.185700Z qemu-system-x86_64: -chardev
pty,id=charserial0: char device redirected to /dev/pts/11 (label
charserial0)*
*2017-10-03T13:13:12.187799Z qemu-system-x86_64: -drive
file=/dev/zvol/virt-p*


*# Error 3#*
*Unable to complete install: 'internal error: process exited while
connecting to monitor: hannel0,id=channel0,name=com.redhat.spice.0 -spice
port=5901,addr=127.0.0.1,disable-ticketing,image-compression=off,seamless-migration=on
                
-device
qxl-vga,id=video0,ram_size=67108864,vram_size=67108864,vram64_size_mb=0,vgamem_mb=16,max_outputs=1,bus=pci.0,addr=0x2
                
-device intel-hda,id=sound0,bus=pci.0,addr=0x4 -device
hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -chardev
spicevmc,id=charredir0,name=usbredir -device
usb-redir,chardev=charredir0,id=redir0,bus=usb.0,port=1 -chardev
spicevmc,id=charredir1,name=usbredir -device
usb-redir,chardev=charredir1,id=redir1,bus=usb.0,port=2 -device
virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x7 -msg timestamp=on*
*2017-10-03T13:07:06.405747Z qemu-system-x86_64: -chardev
pty,id=charserial0: char device redirected to /dev/pts/11 (label
charserial0)*
*2017-10-03T13:07:06.407941Z qemu-system-x86_64: -drive
file=/dev/zvol/virt-pool/vmm/fedora,format=raw,if=none,id=drive-ide0-0-0,cache=none,aio=native:
 Could not open '/dev/zvol/virt'*

*Traceback (most recent call last):*
*  File "/usr/share/virt-manager/virtManager/asyncjob.py", line 89, in
cb_wrapper*
*    callback(asyncjob, *args, **kwargs)*
*  File "/usr/share/virt-manager/virtManager/create.py", line 2545, in
_do_async_install*
*    guest.start_install(meter=meter)*
*  File "/usr/share/virt-manager/virtinst/guest.py", line 498, in
start_install*
*    doboot, transient)*
*  File "/usr/share/virt-manager/virtinst/guest.py", line 434, in
_create_guest*
*    domain = self.conn.createXML(install_xml or final_xml, 0)*
*  File "/usr/lib/python2.7/site-packages/libvirt.py", line 3640, in
createXML*
*    if ret is None:raise libvirtError('virDomainCreateXML() failed',
conn=self)*
*libvirtError: internal error: process exited while connecting to monitor:
hannel0,id=channel0,name=com.redhat.spice.0 -spice
port=5901,addr=127.0.0.1,disable-ticketing,image-compression=off,seamless-migration=on
                
-device
qxl-vga,id=video0,ram_size=67108864,vram_size=67108864,vram64_size_mb=0,vgamem_mb=16,max_outputs=1,bus=pci.0,addr=0x2
                
-device intel-hda,id=sound0,bus=pci.0,addr=0x4 -device
hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -chardev
spicevmc,id=charredir0,name=usbredir -device
usb-redir,chardev=charredir0,id=redir0,bus=usb.0,port=1 -chardev
spicevmc,id=charredir1,name=usbredir -device
usb-redir,chardev=charredir1,id=redir1,bus=usb.0,port=2 -device
virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x7 -msg timestamp=on*
*2017-10-03T13:07:06.405747Z qemu-system-x86_64: -chardev
pty,id=charserial0: char device redirected to /dev/pts/11 (label
charserial0)*
*2017-10-03T13:07:06.407941Z qemu-system-x86_64: -drive
file=/dev/zvol/virt-pool/vmm/fedora,format=raw,if=none,id=drive-ide0-0-0,cache=none,aio=native:
 Could not open '/dev/zvol/virt*


*# Error 4#*

*Unable to complete install: 'internal error: process exited while
connecting to monitor: 2017-10-03T13:01:11.590603Z qemu-system-x86_64:
-chardev pty,id=charserial0: char device redirected to /dev/pts/11 (label
charserial0)*
*2017-10-03T13:01:11.592767Z qemu-system-x86_64: -drive
file=/dev/zvol/virt-pool/vmm/fedora,format=raw,if=none,id=drive-ide0-0-0,cache=none,aio=native:
 Could not open '/dev/zvol/virt-pool/vmm/fedora': Permission denied'*

*Traceback (most recent call last):*
*  File "/usr/share/virt-manager/virtManager/asyncjob.py", line 89, in
cb_wrapper*
*    callback(asyncjob, *args, **kwargs)*
*  File "/usr/share/virt-manager/virtManager/create.py", line 2545, in
_do_async_install*
*    guest.start_install(meter=meter)*
*  File "/usr/share/virt-manager/virtinst/guest.py", line 498, in
start_install*
*    doboot, transient)*
*  File "/usr/share/virt-manager/virtinst/guest.py", line 434, in
_create_guest*
*    domain = self.conn.createXML(install_xml or final_xml, 0)*
*  File "/usr/lib/python2.7/site-packages/libvirt.py", line 3640, in
createXML*
*    if ret is None:raise libvirtError('virDomainCreateXML() failed',
conn=self)*
*libvirtError: internal error: process exited while connecting to monitor:
2017-10-03T13:01:11.590603Z qemu-system-x86_64: -chardev
pty,id=charserial0: char device redirected to /dev/pts/11 (label
charserial0)*
*2017-10-03T13:01:11.592767Z qemu-system-x86_64: -drive
file=/dev/zvol/virt-pool/vmm/fedora,format=raw,if=none,id=drive-ide0-0-0,cache=none,aio=native:
 Could not open '/dev/zvol/virt-pool/vmm/fedora': Permission denied*


*# Error 5#*

*Error starting domain: internal error: process exited while connecting to
monitor: LC_ALL=C
PATH=/usr/sbin:/sbin:/bin:/usr/games:/usr/local/sbin:/usr/local/bin:/usr/bin:/opt/andr \
oid-sdk/platform-tools:/usr/lib/jvm/default/bin:/usr/bin/site_perl:/usr/bin/vendor_perl:/usr/bin/core_perl
 HOME=/home/nick USER=nick LOGNAME=nick QEMU_AUDIO_DRV=spice
/usr/sbin/qemu-system-x86_64 -name guest=Fedora-Test1,debug-threads=on -S
-object
secret,id=masterKey0,format=raw,file=/home/nick/.config/libvirt/qemu/lib/domain-1-Fedora-Test1/master-key.aes
                
-machine pc-i440fx-2.10,accel=kvm,usb=off,vmport=off,dump-guest-core=off
-cpu kvm64 -m 4096 -realtime mlock=off -smp 2,sockets=2,cores=1,threads=1
-uuid 352c2983-fb53-4eb2-9def-1804e0abec5b -no-user-config -nodefaults
-chardev
socket,id=charmonitor,path=/home/nick/.config/libvirt/qemu/lib/domain-1-Fedora-Test1/monitor.sock,server,nowait
                
-mon chardev=charmonitor,id=monitor,mode=control -rtc
base=utc,driftfix=slew -global kvm-pit.lost_tick_policy=delay -no-hpet
-no-shutdown -global PIIX4_PM.disable_s3=1 -global PIIX4_PM.*

*Traceback (most recent call last):*
*  File "/usr/share/virt-manager/virtManager/asyncjob.py", line 89, in
cb_wrapper*
*    callback(asyncjob, *args, **kwargs)*
*  File "/usr/share/virt-manager/virtManager/asyncjob.py", line 125, in
tmpcb*
*    callback(*args, **kwargs)*
*  File "/usr/share/virt-manager/virtManager/libvirtobject.py", line 82, in
newfn*
*    ret = fn(self, *args, **kwargs)*
*  File "/usr/share/virt-manager/virtManager/domain.py", line 1505, in
startup*
*    self._backend.create()*
*  File "/usr/lib/python2.7/site-packages/libvirt.py", line 1062, in create*
*    if ret == -1: raise libvirtError ('virDomainCreate() failed',
dom=self)*
*libvirtError: internal error: process exited while connecting to monitor:
LC_ALL=C
PATH=/usr/sbin:/sbin:/bin:/usr/games:/usr/local/sbin:/usr/local/bin:/usr/bin:/opt/andr \
oid-sdk/platform-tools:/usr/lib/jvm/default/bin:/usr/bin/site_perl:/usr/bin/vendor_perl:/usr/bin/core_perl
 HOME=/home/nick USER=nick LOGNAME=nick QEMU_AUDIO_DRV=spice
/usr/sbin/qemu-system-x86_64 -name guest=Fedora-Test1,debug-threads=on -S
-object
secret,id=masterKey0,format=raw,file=/home/nick/.config/libvirt/qemu/lib/domain-1-Fedora-Test1/master-key.aes
                
-machine pc-i440fx-2.10,accel=kvm,usb=off,vmport=off,dump-guest-core=off
-cpu kvm64 -m 4096 -realtime mlock=off -smp 2,sockets=2,cores=1,threads=1
-uuid 352c2983-fb53-4eb2-9def-1804e0abec5b -no-user-config -nodefaults
-chardev
socket,id=charmonitor,path=/home/nick/.config/libvirt/qemu/lib/domain-1-Fedora-Test1/monitor.sock,server,nowait
                
-mon chardev=charmonitor,id=monitor,mode=control -rtc
base=utc,driftfix=slew -global kvm-pit.lost_tick_policy=delay -no-hpet
-no-shutdown -global PIIX4_PM.disable_s3=1 -global PIIX4_PM.*

*Error starting domain: Cannot access storage file
'/dev/zvol/virt-pool/test-vol' (as uid:4294967295, gid:4294967295): No such
file or directory*

On Tue, Oct 3, 2017 at 4:15 PM, Michal Privoznik &lt;mprivozn@redhat.com&gt;
wrote:

&gt; On 10/03/2017 03:48 PM, Nick Gilmour wrote:
&gt; &gt; @Michal: Thanks for your reply!
&gt; &gt; 
&gt; &gt; Indeed I have found a package in the AUR (libvirt-zfs) and only had to
&gt; &gt; change to the current version and add zfs-utils as dependency in the
&gt; &gt; PKGBUILD. Now I don't get the previous error anymore but I still cannot
&gt; &gt; setup a VM because I constantly get errors due to wrong permissions.
&gt; &gt; 
&gt; &gt; I have tried to change the permissions in:
&gt; &gt; 
&gt; &gt; - /etc/libvirt/qemu.conf
&gt; &gt; - /virt-pool/vmm
&gt; &gt; - /dev/zvol/virt-pool
&gt; &gt; 
&gt; &gt; 
&gt; &gt; also:
&gt; &gt; 
&gt; &gt; # zfs allow &lt;user&gt; create,destroy,mount virt-pool/vmm
&gt; &gt; 
&gt; &gt; didn't help.
&gt; &gt; 
&gt; &gt; What are the correct permissions? Which user and group?
&gt; 
&gt; Interesting. Libvirtd is/should be running as root, therefore it
&gt; shouldn't have to get EPERM. What's the actual error message you're seeing?
&gt; 
&gt; Michal
&gt; 


[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;I have set root in both for user and group in the qemu.conf and \
changed the file permissions to root like it was before. Now I'm getting this \
error:&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;b&gt;# Error \
1#&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;i&gt;Unable to complete install: 'internal \
error: process exited while connecting to monitor: us=pci.0,addr=0x5.0x7 -device \
ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x5 \
-device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x5.0x1 -device \
ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x5.0x2 -device \
virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x6 -drive \
file=/dev/zvol/virt-pool/vmm/fedora,format=raw,if=none,id=drive-ide0-0-0,cache=none,aio=native \
-device ide-hd,bus=ide.0,unit=0,drive=drive-ide0-0-0,id=ide0-0-0,bootindex=2 -drive \
'file=/home/nick/Downloads/#IMAGES#/Fedora-Workstation-Live-x86_64-26-1.5.iso,format=raw,if=none,id=drive-ide0-0-1,readonly=on' \
-device ide-cd,bus=ide.0,unit=1,drive=drive-ide0-0-1,id=ide0-0-1,bootindex=1 -netdev \
user,id=hostnet0 -device \
rtl8139,netdev=hostnet0,id=net0,mac=52:54:00:ad:21:19,bus=pci.0,addr=0x3 -chardev \
pty,id=charserial0 -device isa-serial,chardev=charserial0,id=serial0 -chardev \
spicevmc,id=charchannel0,name=vdagent -device \
virtserialport,bus=virtio-se'&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;Traceback \
(most recent call last):&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/share/virt-manager/virtManager/asyncjob.py", line 89, in \
cb_wrapper&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      callback(asyncjob, *args, \
**kwargs)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/share/virt-manager/virtManager/create.py", line 2545, in \
_do_async_install&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      \
guest.start_install(meter=meter)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/share/virt-manager/virtinst/guest.py", line 498, in \
start_install&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      doboot, transient)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/share/virt-manager/virtinst/guest.py", line 434, in \
_create_guest&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      domain = self.conn.createXML(install_xml or \
final_xml, 0)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/lib/python2.7/site-packages/libvirt.py", line 3640, in \
createXML&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      if ret is None:raise \
libvirtError('virDomainCreateXML() failed', \
conn=self)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;libvirtError: internal error: process exited while \
connecting to monitor: us=pci.0,addr=0x5.0x7 -device \
ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x5 \
-device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x5.0x1 -device \
ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x5.0x2 -device \
virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x6 -drive \
file=/dev/zvol/virt-pool/vmm/fedora,format=raw,if=none,id=drive-ide0-0-0,cache=none,aio=native \
-device ide-hd,bus=ide.0,unit=0,drive=drive-ide0-0-0,id=ide0-0-0,bootindex=2 -drive \
'file=/home/nick/Downloads/#IMAGES#/Fedora-Workstation-Live-x86_64-26-1.5.iso,format=raw,if=none,id=drive-ide0-0-1,readonly=on' \
-device ide-cd,bus=ide.0,unit=1,drive=drive-ide0-0-1,id=ide0-0-1,bootindex=1 -netdev \
user,id=hostnet0 -device \
rtl8139,netdev=hostnet0,id=net0,mac=52:54:00:ad:21:19,bus=pci.0,addr=0x3 -chardev \
pty,id=charserial0 -device isa-serial,chardev=charserial0,id=serial0 -chardev \
spicevmc,id=charchannel0,name=vdagent -device \
virtserialport,bus=virtio-se&lt;/i&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Before \
that I was getting these errors:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;# Error \
2#&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;i&gt;Unable to complete install: 'internal error: process \
exited while connecting to monitor: rdev spicevmc,id=charchannel0,name=vdagent \
-device virtserialport,bus=virtio-serial0.0,nr=1,chardev=charchannel0,id=channel0,name=com.redhat.spice.0 \
-spice port=5901,addr=127.0.0.1,disable-ticketing,image-compression=off,seamless-migration=on \
-device qxl-vga,id=video0,ram_size=67108864,vram_size=67108864,vram64_size_mb=0,vgamem_mb=16,max_outputs=1,bus=pci.0,addr=0x2 \
-device intel-hda,id=sound0,bus=pci.0,addr=0x4 -device \
hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -chardev \
spicevmc,id=charredir0,name=usbredir -device \
usb-redir,chardev=charredir0,id=redir0,bus=usb.0,port=1 -chardev \
spicevmc,id=charredir1,name=usbredir -device \
usb-redir,chardev=charredir1,id=redir1,bus=usb.0,port=2 -device \
virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x7 -msg \
timestamp=on&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;2017-10-03T13:13:12.185700Z qemu-system-x86_64: \
-chardev pty,id=charserial0: char device redirected to /dev/pts/11 (label \
charserial0)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;2017-10-03T13:13:12.187799Z qemu-system-x86_64: -drive \
file=/dev/zvol/virt-p'&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;Traceback (most \
recent call last):&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/share/virt-manager/virtManager/asyncjob.py", line 89, in \
cb_wrapper&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      callback(asyncjob, *args, \
**kwargs)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/share/virt-manager/virtManager/create.py", line 2545, in \
_do_async_install&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      \
guest.start_install(meter=meter)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/share/virt-manager/virtinst/guest.py", line 498, in \
start_install&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      doboot, transient)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/share/virt-manager/virtinst/guest.py", line 434, in \
_create_guest&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      domain = self.conn.createXML(install_xml or \
final_xml, 0)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/lib/python2.7/site-packages/libvirt.py", line 3640, in \
createXML&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      if ret is None:raise \
libvirtError('virDomainCreateXML() failed', \
conn=self)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;libvirtError: internal error: process exited while \
connecting to monitor: rdev spicevmc,id=charchannel0,name=vdagent -device \
virtserialport,bus=virtio-serial0.0,nr=1,chardev=charchannel0,id=channel0,name=com.redhat.spice.0 \
-spice port=5901,addr=127.0.0.1,disable-ticketing,image-compression=off,seamless-migration=on \
-device qxl-vga,id=video0,ram_size=67108864,vram_size=67108864,vram64_size_mb=0,vgamem_mb=16,max_outputs=1,bus=pci.0,addr=0x2 \
-device intel-hda,id=sound0,bus=pci.0,addr=0x4 -device \
hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -chardev \
spicevmc,id=charredir0,name=usbredir -device \
usb-redir,chardev=charredir0,id=redir0,bus=usb.0,port=1 -chardev \
spicevmc,id=charredir1,name=usbredir -device \
usb-redir,chardev=charredir1,id=redir1,bus=usb.0,port=2 -device \
virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x7 -msg \
timestamp=on&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;2017-10-03T13:13:12.185700Z qemu-system-x86_64: \
-chardev pty,id=charserial0: char device redirected to /dev/pts/11 (label \
charserial0)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;2017-10-03T13:13:12.187799Z qemu-system-x86_64: -drive \
file=/dev/zvol/virt-p&lt;/i&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;b&gt;# \
Error 3#&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;i&gt;Unable to complete install: \
'internal error: process exited while connecting to monitor: \
hannel0,id=channel0,name=com.redhat.spice.0 -spice \
port=5901,addr=127.0.0.1,disable-ticketing,image-compression=off,seamless-migration=on \
-device qxl-vga,id=video0,ram_size=67108864,vram_size=67108864,vram64_size_mb=0,vgamem_mb=16,max_outputs=1,bus=pci.0,addr=0x2 \
-device intel-hda,id=sound0,bus=pci.0,addr=0x4 -device \
hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -chardev \
spicevmc,id=charredir0,name=usbredir -device \
usb-redir,chardev=charredir0,id=redir0,bus=usb.0,port=1 -chardev \
spicevmc,id=charredir1,name=usbredir -device \
usb-redir,chardev=charredir1,id=redir1,bus=usb.0,port=2 -device \
virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x7 -msg \
timestamp=on&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;2017-10-03T13:07:06.405747Z qemu-system-x86_64: \
-chardev pty,id=charserial0: char device redirected to /dev/pts/11 (label \
charserial0)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;2017-10-03T13:07:06.407941Z qemu-system-x86_64: -drive \
file=/dev/zvol/virt-pool/vmm/fedora,format=raw,if=none,id=drive-ide0-0-0,cache=none,aio=native: \
Could not open '/dev/zvol/virt'&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;Traceback \
(most recent call last):&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/share/virt-manager/virtManager/asyncjob.py", line 89, in \
cb_wrapper&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      callback(asyncjob, *args, \
**kwargs)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/share/virt-manager/virtManager/create.py", line 2545, in \
_do_async_install&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      \
guest.start_install(meter=meter)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/share/virt-manager/virtinst/guest.py", line 498, in \
start_install&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      doboot, transient)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/share/virt-manager/virtinst/guest.py", line 434, in \
_create_guest&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      domain = self.conn.createXML(install_xml or \
final_xml, 0)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/lib/python2.7/site-packages/libvirt.py", line 3640, in \
createXML&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      if ret is None:raise \
libvirtError('virDomainCreateXML() failed', \
conn=self)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;libvirtError: internal error: process exited while \
connecting to monitor: hannel0,id=channel0,name=com.redhat.spice.0 -spice \
port=5901,addr=127.0.0.1,disable-ticketing,image-compression=off,seamless-migration=on \
-device qxl-vga,id=video0,ram_size=67108864,vram_size=67108864,vram64_size_mb=0,vgamem_mb=16,max_outputs=1,bus=pci.0,addr=0x2 \
-device intel-hda,id=sound0,bus=pci.0,addr=0x4 -device \
hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -chardev \
spicevmc,id=charredir0,name=usbredir -device \
usb-redir,chardev=charredir0,id=redir0,bus=usb.0,port=1 -chardev \
spicevmc,id=charredir1,name=usbredir -device \
usb-redir,chardev=charredir1,id=redir1,bus=usb.0,port=2 -device \
virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x7 -msg \
timestamp=on&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;2017-10-03T13:07:06.405747Z qemu-system-x86_64: \
-chardev pty,id=charserial0: char device redirected to /dev/pts/11 (label \
charserial0)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;2017-10-03T13:07:06.407941Z qemu-system-x86_64: -drive \
file=/dev/zvol/virt-pool/vmm/fedora,format=raw,if=none,id=drive-ide0-0-0,cache=none,aio=native: \
Could not open '/dev/zvol/virt&lt;/i&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;b&gt;# \
Error 4#&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;Unable to complete install: \
'internal error: process exited while connecting to monitor: \
2017-10-03T13:01:11.590603Z qemu-system-x86_64: -chardev pty,id=charserial0: char \
device redirected to /dev/pts/11 (label \
charserial0)&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;i&gt;2017-10-03T13:01:11.592767Z \
qemu-system-x86_64: -drive \
file=/dev/zvol/virt-pool/vmm/fedora,format=raw,if=none,id=drive-ide0-0-0,cache=none,aio=native: \
Could not open '/dev/zvol/virt-pool/vmm/fedora': Permission \
denied'&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;Traceback (most recent call \
last):&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/share/virt-manager/virtManager/asyncjob.py", line 89, in \
cb_wrapper&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      callback(asyncjob, *args, \
**kwargs)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/share/virt-manager/virtManager/create.py", line 2545, in \
_do_async_install&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      \
guest.start_install(meter=meter)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/share/virt-manager/virtinst/guest.py", line 498, in \
start_install&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      doboot, transient)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/share/virt-manager/virtinst/guest.py", line 434, in \
_create_guest&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      domain = self.conn.createXML(install_xml or \
final_xml, 0)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/lib/python2.7/site-packages/libvirt.py", line 3640, in \
createXML&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      if ret is None:raise \
libvirtError('virDomainCreateXML() failed', \
conn=self)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;libvirtError: internal error: process exited while \
connecting to monitor: 2017-10-03T13:01:11.590603Z qemu-system-x86_64: -chardev \
pty,id=charserial0: char device redirected to /dev/pts/11 (label \
charserial0)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;2017-10-03T13:01:11.592767Z qemu-system-x86_64: -drive \
file=/dev/zvol/virt-pool/vmm/fedora,format=raw,if=none,id=drive-ide0-0-0,cache=none,aio=native: \
Could not open '/dev/zvol/virt-pool/vmm/fedora': Permission \
denied&lt;/i&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;b&gt;# \
Error 5#&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;Error starting domain: internal \
error: process exited while connecting to monitor: LC_ALL=C \
PATH=/usr/sbin:/sbin:/bin:/usr/games:/usr/local/sbin:/usr/local/bin:/usr/bin:/opt/andr \
oid-sdk/platform-tools:/usr/lib/jvm/default/bin:/usr/bin/site_perl:/usr/bin/vendor_perl:/usr/bin/core_perl \
HOME=/home/nick USER=nick LOGNAME=nick QEMU_AUDIO_DRV=spice \
/usr/sbin/qemu-system-x86_64 -name guest=Fedora-Test1,debug-threads=on -S -object \
secret,id=masterKey0,format=raw,file=/home/nick/.config/libvirt/qemu/lib/domain-1-Fedora-Test1/master-key.aes \
-machine pc-i440fx-2.10,accel=kvm,usb=off,vmport=off,dump-guest-core=off -cpu kvm64 \
-m 4096 -realtime mlock=off -smp 2,sockets=2,cores=1,threads=1 -uuid \
352c2983-fb53-4eb2-9def-1804e0abec5b -no-user-config -nodefaults -chardev \
socket,id=charmonitor,path=/home/nick/.config/libvirt/qemu/lib/domain-1-Fedora-Test1/monitor.sock,server,nowait \
-mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc,driftfix=slew -global \
kvm-pit.lost_tick_policy=delay -no-hpet -no-shutdown -global PIIX4_PM.disable_s3=1 \
-global PIIX4_PM.&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;Traceback \
(most recent call last):&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/share/virt-manager/virtManager/asyncjob.py", line 89, in \
cb_wrapper&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      callback(asyncjob, *args, \
**kwargs)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/share/virt-manager/virtManager/asyncjob.py", line 125, in \
tmpcb&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      callback(*args, **kwargs)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/share/virt-manager/virtManager/libvirtobject.py", line 82, in \
newfn&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      ret = fn(self, *args, **kwargs)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/share/virt-manager/virtManager/domain.py", line 1505, in \
startup&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      self._backend.create()&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;   File \
"/usr/lib/python2.7/site-packages/libvirt.py", line 1062, in \
create&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;      if ret == -1: raise libvirtError \
('virDomainCreate() failed', dom=self)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;libvirtError: \
&gt; @Michal: Thanks for your reply!&lt;br&gt;
&gt;&lt;br&gt;
&gt; Indeed I have found a package in the AUR (libvirt-zfs) and only had to&lt;br&gt;
&gt; change to the current version and add zfs-utils as dependency in the&lt;br&gt;
&gt; PKGBUILD. Now I don't get the previous error anymore but I still cannot&lt;br&gt;
&gt; setup a VM because I constantly get errors due to wrong permissions.&lt;br&gt;
&gt;&lt;br&gt;
&gt; I have tried to change the permissions in:&lt;br&gt;
&gt;&lt;br&gt;
&lt;/span&gt;&gt;      - /etc/libvirt/qemu.conf&lt;br&gt;
&gt;      - /virt-pool/vmm&lt;br&gt;
&gt;      - /dev/zvol/virt-pool&lt;br&gt;
&lt;span class=""&gt;&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; also:&lt;br&gt;
&gt;&lt;br&gt;
&gt; # zfs allow &lt;user&gt; create,destroy,mount virt-pool/vmm&lt;br&gt;
&gt;&lt;br&gt;
&gt; didn't help.&lt;br&gt;
&gt;&lt;br&gt;
&gt; What are the correct permissions? Which user and group?&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;Interesting. Libvirtd is/should be running as root, therefore it&lt;br&gt;
shouldn't have to get EPERM. What's the actual error message you're \
seeing?&lt;br&gt; &lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;br&gt;
Michal&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20171003151618</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-10-03 15:16:18-0400</timestampReceived><subject>Re: [libvirt-users] error: internal error: missing backend for pool type 11 (zfs)</subject><body>

On 10/03/2017 04:40 PM, Nick Gilmour wrote:
&gt; I have set root in both for user and group in the qemu.conf and changed the
&gt; file permissions to root like it was before. Now I'm getting this error:
&gt; 
&gt; *# Error 1#*
&gt; *Unable to complete install: 'internal error: process exited while
&gt; connecting to monitor: us=pci.0,addr=0x5.0x7 -device
&gt; ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x5
&gt; -device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x5.0x1
&gt; -device ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x5.0x2
&gt; -device virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x6 -drive
&gt; file=/dev/zvol/virt-pool/vmm/fedora,format=raw,if=none,id=drive-ide0-0-0,cache=none,aio=native
&gt;                 
&gt; -device
&gt; ide-hd,bus=ide.0,unit=0,drive=drive-ide0-0-0,id=ide0-0-0,bootindex=2 -drive
&gt; 'file=/home/nick/Downloads/#IMAGES#/Fedora-Workstation-Live-x86_64-26-1.5.iso,format=raw,if=none,id=drive-ide0-0-1,readonly=on'
&gt;                 
&gt; -device
&gt; ide-cd,bus=ide.0,unit=1,drive=drive-ide0-0-1,id=ide0-0-1,bootindex=1
&gt; -netdev user,id=hostnet0 -device
&gt; rtl8139,netdev=hostnet0,id=net0,mac=52:54:00:ad:21:19,bus=pci.0,addr=0x3
&gt; -chardev pty,id=charserial0 -device
&gt; isa-serial,chardev=charserial0,id=serial0 -chardev
&gt; spicevmc,id=charchannel0,name=vdagent -device virtserialport,bus=virtio-se'*

This looks like the error message was cut off. Isn't there a full error
message somewhere in the logs, e.g. journalctl?

Anyway, qemu is dying because .. and this is where the message would
help. To help us identify the reason. Maybe
/dev/zvol/virt-pool/vmm/fedora doesn't exist (just a rough guess)?


&gt; &lt;snip/&gt;
&gt; 
&gt; *Error starting domain: Cannot access storage file
&gt; '/dev/zvol/virt-pool/test-vol' (as uid:4294967295, gid:4294967295): No such
&gt; file or directory*

Have you built the storage pool or just defined it?

Michal


</body></email><email><emailId>20171003155158</emailId><senderName>Nick Gilmour</senderName><senderEmail>nickeforos@gmail.com</senderEmail><timestampReceived>2017-10-03 15:51:58-0400</timestampReceived><subject>Re: [libvirt-users] error: internal error: missing backend for pool type 11 (zfs)</subject><body>

*Errors with journalctl:*

Oct 03 16:27:21 host libvirtd[18183]: 2017-10-03 14:27:21.021+0000: 18201:
error : virNetworkObjAssignDefLocked:594 : opera
tion failed: network 'default' already exists with uuid
a780228d-cf2a-4475-ad03-6f8b72b48dd8


*Multiple XCB errors like this (I don't know if they are related...):*

Oct 03 16:20:39 host plasmashell[1389]: QXcbConnection: XCB error: 2
(BadValue), sequence: 47851, resource id: 100663303, m
ajor code: 142 (Unknown), minor code: 3


*And some others:*
Oct 03 09:25:25 host libvirtd[955]: 2017-10-03 07:25:25.457+0000: 1025:
error : storageDriverAutostart:227 : internal error
: Failed to autostart storage pool 'test-vol': cannot open directory
'/dev/zvol/virt-pool': No such file or directory

Oct 03 01:07:18 host libvirtd[24462]: 2017-10-02 23:07:18.579+0000: 24466:
error : qemuProcessUpdateGuestCPU:5159 : unsuppo
rted configuration: CPU mode 'custom' for x86_64 kvm domain on x86_64 host
is not supported by hypervisor

Oct 03 01:05:37 host libvirtd[24462]: 2017-10-02 23:05:37.152+0000: 24467:
error : virStoragePoolObjSourceFindDuplicate:105
4 : operation failed: Storage source conflict with pool: 'images'
Oct 03 01:06:04 kronos libvirtd[24462]: 2017-10-02 23:06:04.857+0000:
24465: error : qemuProcessUpdateGuestCPU:5159 : unsuppo
rted configuration: CPU mode 'custom' for x86_64 kvm domain on x86_64 host
is not supported by hypervisor

Oct 03 01:06:19 host libvirtd[24462]: 2017-10-02 23:06:19.214+0000: 24464:
error : qemuConnectGetDomainCapabilities:19173 :
invalid argument: KVM is not supported by '/usr/sbin/qemu-system-x86_64' on
this host

Oct 03 01:06:33 host libvirtd[24462]: 2017-10-02 23:06:33.144+0000: 24462:
error : qemuMonitorIORead:595 : Unable to read f
rom monitor: Connection reset by peer

Oct 03 01:06:33 host libvirtd[24462]: 2017-10-02 23:06:33.144+0000: 24462:
error : qemuProcessReportLogError:1880 : interna
l error: qemu unexpectedly closed the monitor:
chardev=charchannel0,id=channel0,name=com.redhat.spice.0 -spice
port=5900,addr
=127.0.0.1,disable-ticketing,image-compression=off,seamless-migration=on
-device qxl-vga,id=video0,ram_size=67108864,vram_siz
e=67108864,vram64_size_mb=0,vgamem_mb=16,max_outputs=1,bus=pci.0,addr=0x2
-device intel-hda,id=sound0,bus=pci.0,addr=0x4 -dev
ice hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -chardev
spicevmc,id=charredir0,name=usbredir -device usb-redir,chardev=ch
arredir0,id=redir0,bus=usb.0,port=1 -chardev
spicevmc,id=charredir1,name=usbredir -device
usb-redir,chardev=charredir1,id=red
ir1,bus=usb.0,port=2 -device
virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x7 -msg timestamp=on

Oct 03 01:06:33 host libvirtd[24462]: 2017-10-02T23:06:33.089796Z
qemu-system-x86_64: -chardev pty,id=charserial0: char dev
ice redirected to /dev/pts/5 (label charserial0)

Oct 03 01:06:33 host libvirtd[24462]: Could not access KVM kernel module:
Permission denied

Oct 03 01:06:33 host libvirtd[24462]: 2017-10-02T23:06:33.089878Z
qemu-system-x86_64: failed to initialize KVM: Permission
denied

Oct 03 01:06:33 host libvirtd[24462]: 2017-10-02 23:06:33.145+0000: 24467:
error : qemuProcessReportLogError:1880 : interna
l error: process exited while connecting to monitor:
chardev=charchannel0,id=channel0,name=com.redhat.spice.0 -spice port=590
0,addr=127.0.0.1,disable-ticketing,image-compression=off,seamless-migration=on
-device qxl-vga,id=video0,ram_size=67108864,vr
am_size=67108864,vram64_size_mb=0,vgamem_mb=16,max_outputs=1,bus=pci.0,addr=0x2
-device intel-hda,id=sound0,bus=pci.0,addr=0x
4 -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -chardev
spicevmc,id=charredir0,name=usbredir -device usb-redir,char
dev=charredir0,id=redir0,bus=usb.0,port=1 -chardev
spicevmc,id=charredir1,name=usbredir -device usb-redir,chardev=charredir1,
id=redir1,bus=usb.0,port=2 -device
virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x7 -msg timestamp=on

Oct 03 01:06:33 host libvirtd[24462]: 2017-10-02T23:06:33.089796Z
qemu-system-x86_64: -chardev pty,id=charserial0: char dev
ice redirected to /dev/pts/5 (label charserial0)

Oct 03 01:06:33 host libvirtd[24462]: Could not access KVM kernel module:
Permission denied

Oct 03 01:06:33 host libvirtd[24462]: 2017-10-02T23:06:33.089878Z
qemu-system-x86_64: failed to initialize KVM: Permission
denied


*I have manually built the zfs pool and the zvol and then tried to define
it in VMM.*



On Tue, Oct 3, 2017 at 5:16 PM, Michal Privoznik &lt;mprivozn@redhat.com&gt;
wrote:

&gt; On 10/03/2017 04:40 PM, Nick Gilmour wrote:
&gt; &gt; I have set root in both for user and group in the qemu.conf and changed
&gt; the
&gt; &gt; file permissions to root like it was before. Now I'm getting this error:
&gt; &gt;
&gt; &gt; *# Error 1#*
&gt; &gt; *Unable to complete install: 'internal error: process exited while
&gt; &gt; connecting to monitor: us=pci.0,addr=0x5.0x7 -device
&gt; &gt; ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,
&gt; multifunction=on,addr=0x5
&gt; &gt; -device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=
&gt; 0x5.0x1
&gt; &gt; -device ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=
&gt; 0x5.0x2
&gt; &gt; -device virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x6 -drive
&gt; &gt; file=/dev/zvol/virt-pool/vmm/fedora,format=raw,if=none,id=
&gt; drive-ide0-0-0,cache=none,aio=native
&gt; &gt; -device
&gt; &gt; ide-hd,bus=ide.0,unit=0,drive=drive-ide0-0-0,id=ide0-0-0,bootindex=2
&gt; -drive
&gt; &gt; 'file=/home/nick/Downloads/#IMAGES#/Fedora-Workstation-
&gt; Live-x86_64-26-1.5.iso,format=raw,if=none,id=drive-ide0-0-1,readonly=on'
&gt; &gt; -device
&gt; &gt; ide-cd,bus=ide.0,unit=1,drive=drive-ide0-0-1,id=ide0-0-1,bootindex=1
&gt; &gt; -netdev user,id=hostnet0 -device
&gt; &gt; rtl8139,netdev=hostnet0,id=net0,mac=52:54:00:ad:21:19,bus=pci.0,addr=0x3
&gt; &gt; -chardev pty,id=charserial0 -device
&gt; &gt; isa-serial,chardev=charserial0,id=serial0 -chardev
&gt; &gt; spicevmc,id=charchannel0,name=vdagent -device
&gt; virtserialport,bus=virtio-se'*
&gt;
&gt; This looks like the error message was cut off. Isn't there a full error
&gt; message somewhere in the logs, e.g. journalctl?
&gt;
&gt; Anyway, qemu is dying because .. and this is where the message would
&gt; help. To help us identify the reason. Maybe
&gt; /dev/zvol/virt-pool/vmm/fedora doesn't exist (just a rough guess)?
&gt;
&gt;
&gt; &gt; &lt;snip/&gt;
&gt; &gt;
&gt; &gt; *Error starting domain: Cannot access storage file
&gt; &gt; '/dev/zvol/virt-pool/test-vol' (as uid:4294967295, gid:4294967295): No
&gt; such
&gt; &gt; file or directory*
&gt;
&gt; Have you built the storage pool or just defined it?
&gt;
&gt; Michal
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;span style="font-family:monospace"&gt;&lt;b&gt;&lt;span \
style="color:rgb(0,0,0)"&gt;Errors with journalctl:&lt;/span&gt;&lt;br&gt;&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;span \
style="font-family:monospace"&gt;&lt;span style="color:rgb(0,0,0)"&gt;&lt;div&gt;&lt;span \
style="font-family:monospace"&gt;&lt;span \
style="color:rgb(0,0,0)"&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;Oct 03 16:27:21 host \
libvirtd[18183]: 2017-10-03 14:27:21.021+0000: 18201: error : \
virNetworkObjAssignDefLocked:594 : opera&lt;/span&gt;&lt;br&gt;tion failed: network \
'default' already exists with uuid \
a780228d-cf2a-4475-ad03-6f8b72b48dd8&lt;/span&gt;&lt;div&gt;&lt;span \
style="font-family:monospace"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-family:monospace"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;span \
style="font-family:monospace"&gt;Multiple  &lt;/span&gt;&lt;span \
style="color:rgb(0,0,0);font-family:monospace"&gt;XCB errors like this (I don't know \
if they are related...):&lt;/span&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-family:monospace"&gt;&lt;font color="#000000"&gt;&lt;br&gt;&lt;/font&gt; &lt;/span&gt;&lt;span \
style="font-family:monospace"&gt;&lt;span style="color:rgb(0,0,0)"&gt;Oct 03 16:20:39 host \
plasmashell[1389]: QXcbConnection: XCB error: 2 (BadValue), sequence: 47851, resource \
id: 100663303, m&lt;/span&gt;&lt;br&gt;ajor code: 142 (Unknown), minor code: 3&lt;br&gt; &lt;br&gt;&lt;b&gt;And \
some others:&lt;br&gt;&lt;/b&gt;&lt;br&gt;&lt;/span&gt;&lt;div&gt;&lt;span style="font-family:monospace"&gt;&lt;span \
style="color:rgb(0,0,0)"&gt;Oct 03 09:25:25  &lt;/span&gt;&lt;/span&gt;&lt;span \
style="color:rgb(0,0,0);font-family:monospace"&gt;host&lt;/span&gt;&lt;span \
style="font-family:monospace"&gt;&lt;span style="color:rgb(0,0,0)"&gt;  libvirtd[955]: \
2017-10-03 07:25:25.457+0000: 1025: error : storageDriverAutostart:227 : internal \
error&lt;/span&gt;&lt;br&gt;: Failed to autostart storage pool 'test-vol': cannot open \
directory '/dev/zvol/virt-pool': No such file or directory&lt;br&gt; \
&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-family:monospace"&gt;&lt;span \
style="color:rgb(0,0,0)"&gt;Oct 03 01:07:18  &lt;/span&gt;&lt;/span&gt;&lt;span \
style="color:rgb(0,0,0);font-family:monospace"&gt;host&lt;/span&gt;&lt;span \
style="font-family:monospace"&gt;&lt;span style="color:rgb(0,0,0)"&gt;  libvirtd[24462]: \
2017-10-02 23:07:18.579+0000: 24466: error : qemuProcessUpdateGuestCPU:5159 : \
unsuppo&lt;/span&gt;&lt;br&gt;rted configuration: CPU mode 'custom' for x86_64 kvm domain \
on x86_64 host is not supported by hypervisor&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-family:monospace"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-family:monospace"&gt;&lt;span style="color:rgb(0,0,0)"&gt;Oct 03 01:05:37  \
&lt;/span&gt;&lt;/span&gt;&lt;span style="color:rgb(0,0,0);font-family:monospace"&gt;host&lt;/span&gt;&lt;span \
style="font-family:monospace"&gt;&lt;span style="color:rgb(0,0,0)"&gt;  libvirtd[24462]: \
2017-10-02 23:05:37.152+0000: 24467: error : \
virStoragePoolObjSourceFindDuplicate:105&lt;/span&gt;&lt;br&gt;4 : operation failed: Storage \
source conflict with pool: 'images' &lt;br&gt;Oct 03 01:06:04 kronos \
libvirtd[24462]: 2017-10-02 23:06:04.857+0000: 24465: error : \
qemuProcessUpdateGuestCPU:5159 : unsuppo&lt;br&gt;rted configuration: CPU mode \
'custom' for x86_64 kvm domain on x86_64 host is not supported by hypervisor  \
&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-family:monospace"&gt;&lt;br&gt;Oct 03 01:06:19  \
&lt;/span&gt;&lt;span style="color:rgb(0,0,0);font-family:monospace"&gt;host&lt;/span&gt;&lt;span \
style="font-family:monospace"&gt;  libvirtd[24462]: 2017-10-02 23:06:19.214+0000: 24464: \
error : qemuConnectGetDomainCapabilities:19173 :&lt;br&gt; invalid argument: KVM is not \
supported by '/usr/sbin/qemu-system-x86_64' on this host \
&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-family:monospace"&gt;Oct 03 01:06:33  \
&lt;/span&gt;&lt;span style="color:rgb(0,0,0);font-family:monospace"&gt;host&lt;/span&gt;&lt;span \
style="font-family:monospace"&gt;  libvirtd[24462]: 2017-10-02 23:06:33.144+0000: 24462: \
error : qemuMonitorIORead:595 : Unable to read f&lt;br&gt;rom monitor: Connection reset by \
peer &lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-family:monospace"&gt;Oct 03 01:06:33  \
&lt;/span&gt;&lt;span style="color:rgb(0,0,0);font-family:monospace"&gt;host&lt;/span&gt;&lt;span \
style="font-family:monospace"&gt;  libvirtd[24462]: 2017-10-02 23:06:33.144+0000: 24462: \
error : qemuProcessReportLogError:1880 : interna&lt;br&gt;l error: qemu unexpectedly closed \
the monitor: chardev=charchannel0,id=channel0,name=com.redhat.spice.0 -spice \
port=5900,addr&lt;br&gt;=127.0.0.1,disable-ticketing,image-compression=off,seamless-migration=on \
-device qxl-vga,id=video0,ram_size=67108864,vram_siz&lt;br&gt;e=67108864,vram64_size_mb=0,vgamem_mb=16,max_outputs=1,bus=pci.0,addr=0x2 \
-device intel-hda,id=sound0,bus=pci.0,addr=0x4 -dev&lt;br&gt;ice \
hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -chardev \
spicevmc,id=charredir0,name=usbredir -device \
usb-redir,chardev=ch&lt;br&gt;arredir0,id=redir0,bus=usb.0,port=1 -chardev \
spicevmc,id=charredir1,name=usbredir -device \
usb-redir,chardev=charredir1,id=red&lt;br&gt;ir1,bus=usb.0,port=2 -device \
virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x7 -msg timestamp=on \
&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-family:monospace"&gt;Oct 03 01:06:33  \
&lt;/span&gt;&lt;span style="color:rgb(0,0,0);font-family:monospace"&gt;host&lt;/span&gt;&lt;span \
style="font-family:monospace"&gt;  libvirtd[24462]: 2017-10-02T23:06:33.089796Z \
qemu-system-x86_64: -chardev pty,id=charserial0: char dev&lt;br&gt;ice redirected to \
/dev/pts/5 (label charserial0) &lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-family:monospace"&gt;Oct 03 01:06:33  &lt;/span&gt;&lt;span \
style="color:rgb(0,0,0);font-family:monospace"&gt;host&lt;/span&gt;&lt;span \
style="font-family:monospace"&gt;  libvirtd[24462]: Could not access KVM kernel module: \
Permission denied &lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-family:monospace"&gt;Oct \
03 01:06:33  &lt;/span&gt;&lt;span \
style="color:rgb(0,0,0);font-family:monospace"&gt;host&lt;/span&gt;&lt;span \
style="font-family:monospace"&gt;  libvirtd[24462]: 2017-10-02T23:06:33.089878Z \
qemu-system-x86_64: failed to initialize KVM: Permission &lt;br&gt;denied \
&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-family:monospace"&gt;Oct 03 01:06:33  \
&lt;/span&gt;&lt;span style="color:rgb(0,0,0);font-family:monospace"&gt;host&lt;/span&gt;&lt;span \
style="font-family:monospace"&gt;  libvirtd[24462]: 2017-10-02 23:06:33.145+0000: 24467: \
error : qemuProcessReportLogError:1880 : interna&lt;br&gt;l error: process exited while \
connecting to monitor: chardev=charchannel0,id=channel0,name=com.redhat.spice.0 \
-spice port=590&lt;br&gt;0,addr=127.0.0.1,disable-ticketing,image-compression=off,seamless-migration=on \
-device qxl-vga,id=video0,ram_size=67108864,vr&lt;br&gt;am_size=67108864,vram64_size_mb=0,vgamem_mb=16,max_outputs=1,bus=pci.0,addr=0x2 \
-device intel-hda,id=sound0,bus=pci.0,addr=0x&lt;br&gt;4 -device \
hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -chardev \
spicevmc,id=charredir0,name=usbredir -device \
usb-redir,char&lt;br&gt;dev=charredir0,id=redir0,bus=usb.0,port=1 -chardev \
spicevmc,id=charredir1,name=usbredir -device \
usb-redir,chardev=charredir1,&lt;br&gt;id=redir1,bus=usb.0,port=2 -device \
virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x7 -msg timestamp=on \
&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-family:monospace"&gt;Oct 03 01:06:33  \
&lt;/span&gt;&lt;span style="color:rgb(0,0,0);font-family:monospace"&gt;host&lt;/span&gt;&lt;span \
style="font-family:monospace"&gt;  libvirtd[24462]: 2017-10-02T23:06:33.089796Z \
qemu-system-x86_64: -chardev pty,id=charserial0: char dev&lt;br&gt;ice redirected to \
/dev/pts/5 (label charserial0) &lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-family:monospace"&gt;Oct 03 01:06:33  &lt;/span&gt;&lt;span \
style="color:rgb(0,0,0);font-family:monospace"&gt;host&lt;/span&gt;&lt;span \
style="font-family:monospace"&gt;  libvirtd[24462]: Could not access KVM kernel module: \
Permission denied &lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-family:monospace"&gt;Oct \
03 01:06:33  &lt;/span&gt;&lt;span \
style="color:rgb(0,0,0);font-family:monospace"&gt;host&lt;/span&gt;&lt;span \
style="font-family:monospace"&gt;  libvirtd[24462]: 2017-10-02T23:06:33.089878Z \
qemu-system-x86_64: failed to initialize KVM: Permission &lt;br&gt;denied&lt;br&gt; \
&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-family:monospace"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-family:monospace"&gt;&lt;b&gt;I have manually built the zfs pool and the zvol and \
then tried to define it in VMM.&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Tue, Oct 3, 2017 at 5:16 PM, Michal Privoznik &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:mprivozn@redhat.com" \
target="_blank"&gt;mprivozn@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span class=""&gt;On 10/03/2017 04:40 PM, Nick Gilmour \
wrote:&lt;br&gt; &gt; I have set root in both for user and group in the qemu.conf and \
changed the&lt;br&gt; &gt; file permissions to root like it was before. Now I'm getting \
this error:&lt;br&gt; &gt;&lt;br&gt;
&lt;/span&gt;&gt; *# Error 1#*&lt;br&gt;
&gt; *Unable to complete install: 'internal error: process exited while&lt;br&gt;
&lt;span class=""&gt;&gt; connecting to monitor: us=pci.0,addr=0x5.0x7 -device&lt;br&gt;
&gt; ich9-usb-uhci1,masterbus=usb.&lt;wbr&gt;0,firstport=0,bus=pci.0,&lt;wbr&gt;multifunction=on,addr=0x5&lt;br&gt;
 &gt; -device ich9-usb-uhci2,masterbus=usb.&lt;wbr&gt;0,firstport=2,bus=pci.0,addr=&lt;wbr&gt;0x5.0x1&lt;br&gt;
 &gt; -device ich9-usb-uhci3,masterbus=usb.&lt;wbr&gt;0,firstport=4,bus=pci.0,addr=&lt;wbr&gt;0x5.0x2&lt;br&gt;
 &gt; -device virtio-serial-pci,id=virtio-&lt;wbr&gt;serial0,bus=pci.0,addr=0x6 -drive&lt;br&gt;
&gt; file=/dev/zvol/virt-pool/vmm/&lt;wbr&gt;fedora,format=raw,if=none,id=&lt;wbr&gt;drive-ide0-0-0,cache=none,aio=&lt;wbr&gt;native&lt;br&gt;
 &gt; -device&lt;br&gt;
&gt; ide-hd,bus=ide.0,unit=0,drive=&lt;wbr&gt;drive-ide0-0-0,id=ide0-0-0,&lt;wbr&gt;bootindex=2 \
-drive&lt;br&gt; &gt; 'file=/home/nick/Downloads/#&lt;wbr&gt;IMAGES#/Fedora-Workstation-&lt;wbr&gt;L \
ive-x86_64-26-1.5.iso,format=&lt;wbr&gt;raw,if=none,id=drive-ide0-0-1,&lt;wbr&gt;readonly=on'&lt;br&gt;
 &gt; -device&lt;br&gt;
&gt; ide-cd,bus=ide.0,unit=1,drive=&lt;wbr&gt;drive-ide0-0-1,id=ide0-0-1,&lt;wbr&gt;bootindex=1&lt;br&gt;
 &gt; -netdev user,id=hostnet0 -device&lt;br&gt;
&gt; rtl8139,netdev=hostnet0,id=&lt;wbr&gt;net0,mac=52:54:00:ad:21:19,&lt;wbr&gt;bus=pci.0,addr=0x3&lt;br&gt;
 &gt; -chardev pty,id=charserial0 -device&lt;br&gt;
&gt; isa-serial,chardev=&lt;wbr&gt;charserial0,id=serial0 -chardev&lt;br&gt;
&lt;/span&gt;&gt; spicevmc,id=charchannel0,name=&lt;wbr&gt;vdagent -device \
virtserialport,bus=virtio-se'*&lt;br&gt; &lt;br&gt;
This looks like the error message was cut off. Isn't there a full error&lt;br&gt;
message somewhere in the logs, e.g. journalctl?&lt;br&gt;
&lt;br&gt;
Anyway, qemu is dying because .. and this is where the message would&lt;br&gt;
help. To help us identify the reason. Maybe&lt;br&gt;
/dev/zvol/virt-pool/vmm/fedora doesn't exist (just a rough guess)?&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&gt; &lt;snip/&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; *Error starting domain: Cannot access storage file&lt;br&gt;
&lt;span class=""&gt;&gt; '/dev/zvol/virt-pool/test-vol' (as uid:4294967295, \
gid:4294967295): No such&lt;br&gt; &lt;/span&gt;&gt; file or directory*&lt;br&gt;
&lt;br&gt;
Have you built the storage pool or just defined it?&lt;br&gt;
&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;br&gt;
Michal&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20171004145804</emailId><senderName>Peter Krempa</senderName><senderEmail>pkrempa@redhat.com</senderEmail><timestampReceived>2017-10-04 14:58:04-0400</timestampReceived><subject>Re: [libvirt-users] error: internal error: missing backend for pool type 11 (zfs)</subject><body>


On Tue, Oct 03, 2017 at 08:44:10 +0200, Michal Privoznik wrote:
&gt; On 10/02/2017 11:42 PM, Nick Gilmour wrote:

[...]

&gt;=20
&gt; 2) storage backends are static. While we have libvirt drivers in
&gt; separate modules (.so files) and load them at start up, it's not the
&gt; same story with storage driver backends. These are hardcoded into the
&gt; storage driver. Might be worth it to have them dynamically loadable too.

This was changed some time ago. Backends are loadable now:

src/.libs/libvirt_storage_backend_disk.so
src/.libs/libvirt_storage_backend_fs.so
src/.libs/libvirt_storage_backend_gluster.so
src/.libs/libvirt_storage_backend_iscsi.so
src/.libs/libvirt_storage_backend_logical.so
src/.libs/libvirt_storage_backend_mpath.so
src/.libs/libvirt_storage_backend_rbd.so
src/.libs/libvirt_storage_backend_scsi.so
src/.libs/libvirt_storage_backend_sheepdog.so
src/.libs/libvirt_storage_backend_vstorage.so
src/.libs/libvirt_storage_backend_zfs.so

Similarly to driver backends they are loaded at start of libvirtd.

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20171004160408</emailId><senderName>Nick Gilmour</senderName><senderEmail>nickeforos@gmail.com</senderEmail><timestampReceived>2017-10-04 16:04:08-0400</timestampReceived><subject>Re: [libvirt-users] error: internal error: missing backend for pool type 11 (zfs)</subject><body>

I have finally found the solution here:

https://www.mail-archive.com/search?l=ubuntu-bugs@lists.ubuntu.com&amp;q=subject:%22%5C%5B \
Bug+405388%5C%5D+Re%5C%3A+virt%5C-manager+cannot+create+image+file%22&amp;o=newest&amp;f=1

By default is qemu:///system activated but I had to change to
qemu:///session because I was getting errors. I created a VM with
qemu:///session and it was running without any issues. But it didn't work
for ZFS Volums. I suppose the other change that it was necessary is set the
user to root in the /etc/libvirt/qemu.conf. I have created a new volume in
VMM and installed Fedora. Everything seems to be working fine inclusive ZFS
snapshots.

Regards,
Nick



On Wed, Oct 4, 2017 at 4:58 PM, Peter Krempa &lt;pkrempa@redhat.com&gt; wrote:

&gt; On Tue, Oct 03, 2017 at 08:44:10 +0200, Michal Privoznik wrote:
&gt; &gt; On 10/02/2017 11:42 PM, Nick Gilmour wrote:
&gt; 
&gt; [...]
&gt; 
&gt; &gt; 
&gt; &gt; 2) storage backends are static. While we have libvirt drivers in
&gt; &gt; separate modules (.so files) and load them at start up, it's not the
&gt; &gt; same story with storage driver backends. These are hardcoded into the
&gt; &gt; storage driver. Might be worth it to have them dynamically loadable too.
&gt; 
&gt; This was changed some time ago. Backends are loadable now:
&gt; 
&gt; src/.libs/libvirt_storage_backend_disk.so
&gt; src/.libs/libvirt_storage_backend_fs.so
&gt; src/.libs/libvirt_storage_backend_gluster.so
&gt; src/.libs/libvirt_storage_backend_iscsi.so
&gt; src/.libs/libvirt_storage_backend_logical.so
&gt; src/.libs/libvirt_storage_backend_mpath.so
&gt; src/.libs/libvirt_storage_backend_rbd.so
&gt; src/.libs/libvirt_storage_backend_scsi.so
&gt; src/.libs/libvirt_storage_backend_sheepdog.so
&gt; src/.libs/libvirt_storage_backend_vstorage.so
&gt; src/.libs/libvirt_storage_backend_zfs.so
&gt; 
&gt; Similarly to driver backends they are loaded at start of libvirtd.
&gt; 


[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;I have finally found the solution here:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;a \
href="https://www.mail-archive.com/search?l=ubuntu-bugs@lists.ubuntu.com&amp;q=subject \
:%22%5C%5BBug+405388%5C%5D+Re%5C%3A+virt%5C-manager+cannot+create+image+file%22&amp;o= \
newest&amp;f=1"&gt;https://www.mail-archive.com/search?l=ubuntu-bugs@lists.ubuntu.com&amp; \
;q=subject:%22%5C%5BBug+405388%5C%5D+Re%5C%3A+virt%5C-manager+cannot+create+image+file%22&amp;o=newest&amp;f=1&lt;/a&gt;&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;By \
default is qemu:///system activated but I had to change to qemu:///session because I \
was getting errors. I created a VM with qemu:///session  and it was running without \
any issues. But it didn't work for ZFS Volums. I suppose the other change that it \
was necessary is set the user to root in the  &lt;span \
style="font-size:12.8px"&gt;/etc/libvirt/qemu.conf. I have created a new volume in VMM \
and installed Fedora. Everything seems to be working fine inclusive ZFS \
snapshots.&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;Regards,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;Nick&lt;br&gt;&lt;/span&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;On Wed, Oct 4, 2017 at 4:58 PM, \
Peter Krempa &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:pkrempa@redhat.com" \
target="_blank"&gt;pkrempa@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span class=""&gt;On Tue, Oct 03, 2017 at 08:44:10 +0200, Michal \
Privoznik wrote:&lt;br&gt; &gt; On 10/02/2017 11:42 PM, Nick Gilmour wrote:&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;[...]&lt;br&gt;
&lt;span class=""&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; 2) storage backends are static. While we have libvirt drivers in&lt;br&gt;
&gt; separate modules (.so files) and load them at start up, it's not the&lt;br&gt;
&gt; same story with storage driver backends. These are hardcoded into the&lt;br&gt;
&gt; storage driver. Might be worth it to have them dynamically loadable too.&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;This was changed some time ago. Backends are loadable now:&lt;br&gt;
&lt;br&gt;
src/.libs/libvirt_storage_&lt;wbr&gt;backend_disk.so&lt;br&gt;
src/.libs/libvirt_storage_&lt;wbr&gt;backend_fs.so&lt;br&gt;
src/.libs/libvirt_storage_&lt;wbr&gt;backend_gluster.so&lt;br&gt;
src/.libs/libvirt_storage_&lt;wbr&gt;backend_iscsi.so&lt;br&gt;
src/.libs/libvirt_storage_&lt;wbr&gt;backend_logical.so&lt;br&gt;
src/.libs/libvirt_storage_&lt;wbr&gt;backend_mpath.so&lt;br&gt;
src/.libs/libvirt_storage_&lt;wbr&gt;backend_rbd.so&lt;br&gt;
src/.libs/libvirt_storage_&lt;wbr&gt;backend_scsi.so&lt;br&gt;
src/.libs/libvirt_storage_&lt;wbr&gt;backend_sheepdog.so&lt;br&gt;
src/.libs/libvirt_storage_&lt;wbr&gt;backend_vstorage.so&lt;br&gt;
src/.libs/libvirt_storage_&lt;wbr&gt;backend_zfs.so&lt;br&gt;
&lt;br&gt;
Similarly to driver backends they are loaded at start of libvirtd.&lt;br&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170427131123</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-04-27 13:11:23-0400</timestampReceived><subject>Re: [libvirt-users] Libvirtd freezes</subject><body>

On 04/27/2017 02:02 PM, Stefano Ricci wrote:
&gt; Hello everyone
&gt; I come back to ask for a hand to solve a problem that has affected me
&gt; since October 2016 and I have not yet solved using libvirt.
&gt; I thought I would solve it by going to a 4.9.x kernel with qemu
&gt; 2.8.1.1 and with libvirt 3.2.0.
&gt; Compile it all in a stable LFS environment version 7.9 and that all
&gt; checks pass without errors.
&gt; The strange thing is that the libvirtd process starts without errors
&gt; but has arrived at the qemu process launch to understand the system's
&gt; capabilities freezes until the following process is killed
&gt; /usr/bin/qemu-system-x86_64 -S -none-user-config -nodefaults
&gt; -nographic -machine none, accel = kvm: tcg -qmp unix:
&gt; /var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait-pidfile/var/lib/libvirt/qemu/capabilities.Pidfile
&gt;                 
&gt; -daemonize, since that time libvirtd resumes running and can be used
&gt; with virsh.
&gt; Performing qemu independently of libvirt works regularly, creates and
&gt; runs virtual machines smoothly.
&gt; 
&gt; Thanks in advance
&gt; Stefano Ricci
&gt; 


I think I've read this somewhere else, but I don't remember where.
Anyway, my rough guess is that libvirtd is stuck on refreshing the qemu
capabilities. This is done on the daemon startup and until it finishes,
no API can be practically executed. Well, for the driver in question (in
this case qemu). Other driver should work just fine.

Can you please attach debugger and get the backtrace for us?

gdb -p $(pgrep libvirtd)

...
...
(gdb) bt


Michal


</body></email><email><emailId>20170427131250</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-04-27 13:12:50-0400</timestampReceived><subject>Re: [libvirt-users] Libvirtd freezes</subject><body>

On 04/27/2017 03:11 PM, Michal Privoznik wrote:
&gt; On 04/27/2017 02:02 PM, Stefano Ricci wrote:
&gt; &gt; Hello everyone
&gt; &gt; I come back to ask for a hand to solve a problem that has affected me
&gt; &gt; since October 2016 and I have not yet solved using libvirt.
&gt; &gt; I thought I would solve it by going to a 4.9.x kernel with qemu
&gt; &gt; 2.8.1.1 and with libvirt 3.2.0.
&gt; &gt; Compile it all in a stable LFS environment version 7.9 and that all
&gt; &gt; checks pass without errors.
&gt; &gt; The strange thing is that the libvirtd process starts without errors
&gt; &gt; but has arrived at the qemu process launch to understand the system's
&gt; &gt; capabilities freezes until the following process is killed
&gt; &gt; /usr/bin/qemu-system-x86_64 -S -none-user-config -nodefaults
&gt; &gt; -nographic -machine none, accel = kvm: tcg -qmp unix:
&gt; &gt; /var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait-pidfile/var/lib/libvirt/qemu/capabilities.Pidfile
&gt; &gt;                 
&gt; &gt; -daemonize, since that time libvirtd resumes running and can be used
&gt; &gt; with virsh.
&gt; &gt; Performing qemu independently of libvirt works regularly, creates and
&gt; &gt; runs virtual machines smoothly.
&gt; &gt; 
&gt; &gt; Thanks in advance
&gt; &gt; Stefano Ricci
&gt; &gt; 
&gt; 
&gt; 
&gt; I think I've read this somewhere else, but I don't remember where.
&gt; Anyway, my rough guess is that libvirtd is stuck on refreshing the qemu
&gt; capabilities. This is done on the daemon startup and until it finishes,
&gt; no API can be practically executed. Well, for the driver in question (in
&gt; this case qemu). Other driver should work just fine.
&gt; 
&gt; Can you please attach debugger and get the backtrace for us?
&gt; 
&gt; gdb -p $(pgrep libvirtd)
&gt; 
&gt; ...
&gt; ...
&gt; (gdb) bt

I mean more 't a a bt' which stands for 'thread apply all backtrace' =&gt;
get backtrace for all the threads. Thanks.

Michal


</body></email><email><emailId>20170427143112</emailId><senderName>Stefano Ricci</senderName><senderEmail>sfn.rcc@gmail.com</senderEmail><timestampReceived>2017-04-27 14:31:12-0400</timestampReceived><subject>Re: [libvirt-users] Libvirtd freezes</subject><body>

Here is the backtrace of the libvirt process just started

https://pastebin.com/R66myzFp


Stefano

2017-04-27 15:12 GMT+02:00 Michal Privoznik &lt;mprivozn@redhat.com&gt;:
&gt; On 04/27/2017 03:11 PM, Michal Privoznik wrote:
&gt; &gt; On 04/27/2017 02:02 PM, Stefano Ricci wrote:
&gt; &gt; &gt; Hello everyone
&gt; &gt; &gt; I come back to ask for a hand to solve a problem that has affected me
&gt; &gt; &gt; since October 2016 and I have not yet solved using libvirt.
&gt; &gt; &gt; I thought I would solve it by going to a 4.9.x kernel with qemu
&gt; &gt; &gt; 2.8.1.1 and with libvirt 3.2.0.
&gt; &gt; &gt; Compile it all in a stable LFS environment version 7.9 and that all
&gt; &gt; &gt; checks pass without errors.
&gt; &gt; &gt; The strange thing is that the libvirtd process starts without errors
&gt; &gt; &gt; but has arrived at the qemu process launch to understand the system's
&gt; &gt; &gt; capabilities freezes until the following process is killed
&gt; &gt; &gt; /usr/bin/qemu-system-x86_64 -S -none-user-config -nodefaults
&gt; &gt; &gt; -nographic -machine none, accel = kvm: tcg -qmp unix:
&gt; &gt; &gt; /var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait-pidfile/var/lib/libvirt/qemu/capabilities.Pidfile
&gt; &gt; &gt;                 
&gt; &gt; &gt; -daemonize, since that time libvirtd resumes running and can be used
&gt; &gt; &gt; with virsh.
&gt; &gt; &gt; Performing qemu independently of libvirt works regularly, creates and
&gt; &gt; &gt; runs virtual machines smoothly.
&gt; &gt; &gt; 
&gt; &gt; &gt; Thanks in advance
&gt; &gt; &gt; Stefano Ricci
&gt; &gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; I think I've read this somewhere else, but I don't remember where.
&gt; &gt; Anyway, my rough guess is that libvirtd is stuck on refreshing the qemu
&gt; &gt; capabilities. This is done on the daemon startup and until it finishes,
&gt; &gt; no API can be practically executed. Well, for the driver in question (in
&gt; &gt; this case qemu). Other driver should work just fine.
&gt; &gt; 
&gt; &gt; Can you please attach debugger and get the backtrace for us?
&gt; &gt; 
&gt; &gt; gdb -p $(pgrep libvirtd)
&gt; &gt; 
&gt; &gt; ...
&gt; &gt; ...
&gt; &gt; (gdb) bt
&gt; 
&gt; I mean more 't a a bt' which stands for 'thread apply all backtrace' =&gt;
&gt; get backtrace for all the threads. Thanks.
&gt; 
&gt; Michal


</body></email><email><emailId>20170428123310</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-04-28 12:33:10-0400</timestampReceived><subject>Re: [libvirt-users] Libvirtd freezes</subject><body>

On 04/27/2017 04:31 PM, Stefano Ricci wrote:
&gt; Here is the backtrace of the libvirt process just started

[Just a side note, you shouldn't top post on technical lists. Gmail
sucks at this.]

&gt; 
&gt; https://pastebin.com/R66myzFp

Looks like libvirtd is trying to spawn /usr/bin/qemu-system-x86_64 but
it takes ages to init. In the debug logs you might see the actual
command line that libvirt tries to execute. You can try running it by
hand and see if it takes about the same time. If so, then it's a qemu bug.

http://wiki.libvirt.org/page/DebugLogs

Michal

</body></email><email><emailId>20170429023833</emailId><senderName>Stefano Ricci</senderName><senderEmail>sfn.rcc@gmail.com</senderEmail><timestampReceived>2017-04-29 02:38:33-0400</timestampReceived><subject>Re: [libvirt-users] Libvirtd freezes</subject><body>

2017-04-28 14:33 GMT+02:00 Michal Privoznik &lt;mprivozn@redhat.com&gt;:
&gt; On 04/27/2017 04:31 PM, Stefano Ricci wrote:
&gt;&gt; Here is the backtrace of the libvirt process just started
&gt;
&gt; [Just a side note, you shouldn't top post on technical lists. Gmail
&gt; sucks at this.]
&gt;
&gt;&gt;
&gt;&gt; https://pastebin.com/R66myzFp
&gt;
&gt; Looks like libvirtd is trying to spawn /usr/bin/qemu-system-x86_64 but
&gt; it takes ages to init. In the debug logs you might see the actual
&gt; command line that libvirt tries to execute. You can try running it by
&gt; hand and see if it takes about the same time. If so, then it's a qemu bug.
&gt;
&gt; http://wiki.libvirt.org/page/DebugLogs
&gt;
&gt; Michal

The line that comes from the libvirt log is as follows:
LC_ALL=C PATH=/bin:/usr/bin:/sbin:/usr/sbin HOME=/ USER=root
/usr/bin/qemu-system-x86_64 -S -no-user-config -nodefaults -nographic
-M none -qmp unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait
-pidfile /var/lib/libvirt/qemu/capabilities.pidfile -daemonize
Before I run the command manually I added the -D parameter to write
the qemu process stderr in a log file.
Once the command is executed, the log file is blank then error-free
and the process seems to respond correctly.
I have connected with the following command: nc -U
/var/lib/libvirt/qemu/capabilities.monitor.sock
and this is an extract of qemu output to my requests:
{"QMP": {"version": {"qemu": {"micro": 1, "minor": 8, "major": 2},
"package": ""}, "capabilities": []}}
{ "execute": "qmp_capabilities" }
{"return": {}}
{ "execute": "query-commands" }
{"return": [{"name": "xen-set-global-dirty-log"}, {"name":
"xen-save-devices-state"}, {"name": "xen-load-devices-state"},
{"name": "x-colo-lost-heartbeat"}, {"name":
"x-blockdev-remove-medium"}, {"name": "x-blockdev-insert-medium"},
{"name": "x-blockdev-del"}, {"name": "x-blockdev-change"}, {"name":
"transaction"}, {"name": "trace-event-set-state"}, {"name":
"trace-event-get-state"}, {"name": "system_wakeup"}, {"name":
"system_reset"}, {"name": "system_powerdown"}, {"name": "stop"},
{"name": "set_password"}, {"name": "set_link"}, {"name": "send-key"},
{"name": "screendump"}, {"name": "rtc-reset-reinjection"}, {"name":
"ringbuf-write"}, {"name": "ringbuf-read"}, {"name": "remove-fd"},
{"name": "quit"}, {"name": "query-vnc-servers"}, {"name":
"query-vnc"}, {"name": "query-version"}, {"name": "query-uuid"},
{"name": "query-tpm-types"}, {"name": "query-tpm-models"}, {"name":
"query-tpm"}, {"name": "query-target"}, {"name": "query-status"},
{"name": "query-spice"}, {"name": "query-rx-filter"}, {"name":
"query-rocker-ports"}, {"name": "query-rocker-of-dpa-groups"},
{"name": "query-rocker-of-dpa-flows"}, {"name": "query-rocker"},
{"name": "query-pci"}, {"name": "query-named-block-nodes"}, {"name":
"query-name"}, {"name": "query-migrate-parameters"}, {"name":
"query-migrate-capabilities"}, {"name": "query-migrate-cache-size"},
{"name": "query-migrate"}, {"name": "query-mice"}, {"name":
"query-memory-devices"}, {"name": "query-memdev"}, {"name":
"query-machines"}, {"name": "query-kvm"}, {"name": "query-iothreads"},
{"name": "query-hotpluggable-cpus"}, {"name": "query-fdsets"},
{"name": "query-events"}, {"name":
"query-dump-guest-memory-capability"}, {"name": "query-dump"},
{"name": "query-cpus"}, {"name": "query-cpu-definitions"}, {"name":
"query-commands"}, {"name": "query-command-line-options"}, {"name":
"query-chardev-backends"}, {"name": "query-chardev"}, {"name":
"query-blockstats"}, {"name": "query-block-jobs"}, {"name":
"query-block"}, {"name": "query-balloon"}, {"name":
"query-acpi-ospm-status"}, {"name": "qom-set"}, {"name":
"qom-list-types"}, {"name": "qom-list"}, {"name": "qom-get"}, {"name":
"qmp_capabilities"}, {"name": "pmemsave"}, {"name": "object-del"},
{"name": "object-add"}, {"name": "netdev_del"} .......
So it would not look like a qemu bug.

Stefano

</body></email><email><emailId>20170429052458</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-04-29 05:24:58-0400</timestampReceived><subject>Re: [libvirt-users] Libvirtd freezes</subject><body>

On 04/29/2017 04:38 AM, Stefano Ricci wrote:
&gt; 2017-04-28 14:33 GMT+02:00 Michal Privoznik &lt;mprivozn@redhat.com&gt;:
&gt;&gt; On 04/27/2017 04:31 PM, Stefano Ricci wrote:
&gt;&gt;&gt; Here is the backtrace of the libvirt process just started
&gt;&gt;
&gt;&gt; [Just a side note, you shouldn't top post on technical lists. Gmail
&gt;&gt; sucks at this.]
&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; https://pastebin.com/R66myzFp
&gt;&gt;
&gt;&gt; Looks like libvirtd is trying to spawn /usr/bin/qemu-system-x86_64 but
&gt;&gt; it takes ages to init. In the debug logs you might see the actual
&gt;&gt; command line that libvirt tries to execute. You can try running it by
&gt;&gt; hand and see if it takes about the same time. If so, then it's a qemu bug.
&gt;&gt;
&gt;&gt; http://wiki.libvirt.org/page/DebugLogs
&gt;&gt;
&gt;&gt; Michal
&gt; 
&gt; The line that comes from the libvirt log is as follows:
&gt; LC_ALL=C PATH=/bin:/usr/bin:/sbin:/usr/sbin HOME=/ USER=root
&gt; /usr/bin/qemu-system-x86_64 -S -no-user-config -nodefaults -nographic
&gt; -M none -qmp unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait
&gt; -pidfile /var/lib/libvirt/qemu/capabilities.pidfile -daemonize
&gt; Before I run the command manually I added the -D parameter to write
&gt; the qemu process stderr in a log file.
&gt; Once the command is executed, the log file is blank then error-free
&gt; and the process seems to respond correctly.
&gt; I have connected with the following command: nc -U
&gt; /var/lib/libvirt/qemu/capabilities.monitor.sock
&gt; and this is an extract of qemu output to my requests:
&gt; {"QMP": {"version": {"qemu": {"micro": 1, "minor": 8, "major": 2},
&gt; "package": ""}, "capabilities": []}}
&gt; { "execute": "qmp_capabilities" }
&gt; {"return": {}}
&gt; { "execute": "query-commands" }
&gt; {"return": [{"name": "xen-set-global-dirty-log"}, {"name":
&gt; "xen-save-devices-state"}, {"name": "xen-load-devices-state"},
&gt; {"name": "x-colo-lost-heartbeat"}, {"name":
&gt; "x-blockdev-remove-medium"}, {"name": "x-blockdev-insert-medium"},
&gt; {"name": "x-blockdev-del"}, {"name": "x-blockdev-change"}, {"name":
&gt; "transaction"}, {"name": "trace-event-set-state"}, {"name":
&gt; "trace-event-get-state"}, {"name": "system_wakeup"}, {"name":
&gt; "system_reset"}, {"name": "system_powerdown"}, {"name": "stop"},
&gt; {"name": "set_password"}, {"name": "set_link"}, {"name": "send-key"},
&gt; {"name": "screendump"}, {"name": "rtc-reset-reinjection"}, {"name":
&gt; "ringbuf-write"}, {"name": "ringbuf-read"}, {"name": "remove-fd"},
&gt; {"name": "quit"}, {"name": "query-vnc-servers"}, {"name":
&gt; "query-vnc"}, {"name": "query-version"}, {"name": "query-uuid"},
&gt; {"name": "query-tpm-types"}, {"name": "query-tpm-models"}, {"name":
&gt; "query-tpm"}, {"name": "query-target"}, {"name": "query-status"},
&gt; {"name": "query-spice"}, {"name": "query-rx-filter"}, {"name":
&gt; "query-rocker-ports"}, {"name": "query-rocker-of-dpa-groups"},
&gt; {"name": "query-rocker-of-dpa-flows"}, {"name": "query-rocker"},
&gt; {"name": "query-pci"}, {"name": "query-named-block-nodes"}, {"name":
&gt; "query-name"}, {"name": "query-migrate-parameters"}, {"name":
&gt; "query-migrate-capabilities"}, {"name": "query-migrate-cache-size"},
&gt; {"name": "query-migrate"}, {"name": "query-mice"}, {"name":
&gt; "query-memory-devices"}, {"name": "query-memdev"}, {"name":
&gt; "query-machines"}, {"name": "query-kvm"}, {"name": "query-iothreads"},
&gt; {"name": "query-hotpluggable-cpus"}, {"name": "query-fdsets"},
&gt; {"name": "query-events"}, {"name":
&gt; "query-dump-guest-memory-capability"}, {"name": "query-dump"},
&gt; {"name": "query-cpus"}, {"name": "query-cpu-definitions"}, {"name":
&gt; "query-commands"}, {"name": "query-command-line-options"}, {"name":
&gt; "query-chardev-backends"}, {"name": "query-chardev"}, {"name":
&gt; "query-blockstats"}, {"name": "query-block-jobs"}, {"name":
&gt; "query-block"}, {"name": "query-balloon"}, {"name":
&gt; "query-acpi-ospm-status"}, {"name": "qom-set"}, {"name":
&gt; "qom-list-types"}, {"name": "qom-list"}, {"name": "qom-get"}, {"name":
&gt; "qmp_capabilities"}, {"name": "pmemsave"}, {"name": "object-del"},
&gt; {"name": "object-add"}, {"name": "netdev_del"} .......
&gt; So it would not look like a qemu bug.

Well, this does not prove that qemu replies to all commands issued by
libvirt. For that we would need debug logs as referred to above.

BTW: The stack trace looks a bit old (the line number do not match with
the current git HEAD) - what's the release you're running and does the
problem occur with the current git HEAD too?

Michal

</body></email><email><emailId>20170501053219</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-05-01 05:32:19-0400</timestampReceived><subject>Re: [libvirt-users] Libvirtd freezes</subject><body>

On 04/30/2017 07:12 PM, Stefano Ricci wrote:

&gt; 
&gt; The version used for backtrace is 3.2.0, now I have also tried the
&gt; current downloaded with git but the problem is always present.
&gt; This is the current version log file, set as shown on the DebugLogs page:
&gt; 
&gt; https://drive.google.com/open?id=0By9lwQyveHENdEt4aEtZcUV3ZEU

Couple of my findings:

2017-04-30 16:19:34.894+0000: 870: debug : virDriverLoadModuleFile:49 : Load module \
file '/usr/lib/libvirt/storage-backend/libvirt_storage_backend_rbd.so' 2017-04-30 \
16:19:35.324+0000: 870: debug : virDriverLoadModuleFunc:71 : Lookup function \
'virStorageBackendRBDRegister'

it takes nearly .5s to load libvirt_storage_backend_rbd.so

But apart from that there is nothing unusual in the logs. So how do you observe the \
hang? How long it is anyway - assuming it goes away after some time. Or does it hang \
indefinitely?

BTW: is this all the debug messages you have? Because in there, the last line is how \
libvirtd starts qemu-system-x86_64 in order to fetch its capabilities. I'd expect \
libvirt setting qmp_capabilities on the monitor at least.

Michal


</body></email><email><emailId>20170501075706</emailId><senderName>Stefano Ricci</senderName><senderEmail>sfn.rcc@gmail.com</senderEmail><timestampReceived>2017-05-01 07:57:06-0400</timestampReceived><subject>Re: [libvirt-users] Libvirtd freezes</subject><body>

2017-05-01 7:32 GMT+02:00 Michal Privoznik &lt;mprivozn@redhat.com&gt;:
&gt; On 04/30/2017 07:12 PM, Stefano Ricci wrote:
&gt; 
&gt; &gt; 
&gt; &gt; The version used for backtrace is 3.2.0, now I have also tried the
&gt; &gt; current downloaded with git but the problem is always present.
&gt; &gt; This is the current version log file, set as shown on the DebugLogs page:
&gt; &gt; 
&gt; &gt; https://drive.google.com/open?id=0By9lwQyveHENdEt4aEtZcUV3ZEU
&gt; 
&gt; Couple of my findings:
&gt; 
&gt; 2017-04-30 16:19:34.894+0000: 870: debug : virDriverLoadModuleFile:49 : Load module \
&gt; file '/usr/lib/libvirt/storage-backend/libvirt_storage_backend_rbd.so' 2017-04-30 \
&gt; 16:19:35.324+0000: 870: debug : virDriverLoadModuleFunc:71 : Lookup function \
&gt; 'virStorageBackendRBDRegister' 
&gt; it takes nearly .5s to load libvirt_storage_backend_rbd.so
&gt; 
&gt; But apart from that there is nothing unusual in the logs. So how do you observe the \
&gt; hang? How long it is anyway - assuming it goes away after some time. Or does it \
&gt; hang indefinitely? 
&gt; BTW: is this all the debug messages you have? Because in there, the last line is \
&gt; how libvirtd starts qemu-system-x86_64 in order to fetch its capabilities. I'd \
&gt; expect libvirt setting qmp_capabilities on the monitor at least. 
&gt; Michal

Virtlib logs end in the way you see, only when i kill the qemu process
then it starts logging and it is possible to connect remotely with
virsh.
Until the qemu process is active you can not use libvirt.
In the following libvirt log file find all that happens when killing
the qemu process, after the line
2017-05-01 07:40:47.772+0000: 892: debug : virCommandRunAsync:2451 :
Command result 0, with PID 970

https://drive.google.com/open?id=0By9lwQyveHENNVBaczFxNHBCYU0

Stefano


</body></email><email><emailId>20170503065657</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-05-03 06:56:57-0400</timestampReceived><subject>Re: [libvirt-users] Libvirtd freezes</subject><body>

On 05/01/2017 09:57 AM, Stefano Ricci wrote:
&gt; 2017-05-01 7:32 GMT+02:00 Michal Privoznik &lt;mprivozn@redhat.com&gt;:
&gt; &gt; On 04/30/2017 07:12 PM, Stefano Ricci wrote:
&gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; The version used for backtrace is 3.2.0, now I have also tried the
&gt; &gt; &gt; current downloaded with git but the problem is always present.
&gt; &gt; &gt; This is the current version log file, set as shown on the DebugLogs page:
&gt; &gt; &gt; 
&gt; &gt; &gt; https://drive.google.com/open?id=0By9lwQyveHENdEt4aEtZcUV3ZEU
&gt; &gt; 
&gt; &gt; Couple of my findings:
&gt; &gt; 
&gt; &gt; 2017-04-30 16:19:34.894+0000: 870: debug : virDriverLoadModuleFile:49 : Load \
&gt; &gt; module file '/usr/lib/libvirt/storage-backend/libvirt_storage_backend_rbd.so' \
&gt; &gt; 2017-04-30 16:19:35.324+0000: 870: debug : virDriverLoadModuleFunc:71 : Lookup \
&gt; &gt; function 'virStorageBackendRBDRegister' 
&gt; &gt; it takes nearly .5s to load libvirt_storage_backend_rbd.so
&gt; &gt; 
&gt; &gt; But apart from that there is nothing unusual in the logs. So how do you observe \
&gt; &gt; the hang? How long it is anyway - assuming it goes away after some time. Or does \
&gt; &gt; it hang indefinitely? 
&gt; &gt; BTW: is this all the debug messages you have? Because in there, the last line is \
&gt; &gt; how libvirtd starts qemu-system-x86_64 in order to fetch its capabilities. I'd \
&gt; &gt; expect libvirt setting qmp_capabilities on the monitor at least. 
&gt; &gt; Michal
&gt; 
&gt; Virtlib logs end in the way you see, only when i kill the qemu process
&gt; then it starts logging and it is possible to connect remotely with
&gt; virsh.

I see. There's nothing suspicious in the logs. The fact that libvirt
waits for qemu suggests that qemu did not go daemon. I mean, we pass
-daemonize to qemu, but that doesn't work. I wonder if we cannot do what
we are doing usually when spawning qemu processes: fork() + exec()
instead of relying on -daemonize which is broken.

BTW: you can verify that qemu did not deamonize itself by consulting the
libvirtd log:

2017-04-30 16:19:36.633+0000: 886: debug : virCommandRunAsync:2451 :
Command result 0, with PID 962

This means, that PID 962 is qemu. However, when going daemon double fork
is needed, therefore 'pgrep qemu' should print different number than
962. But I guess it doesn't, does it?

Michal


</body></email><email><emailId>20170504092048</emailId><senderName>Stefano Ricci</senderName><senderEmail>sfn.rcc@gmail.com</senderEmail><timestampReceived>2017-05-04 09:20:48-0400</timestampReceived><subject>Re: [libvirt-users] Libvirtd freezes</subject><body>

2017-05-03 8:56 GMT+02:00 Michal Privoznik &lt;mprivozn@redhat.com&gt;:
&gt; On 05/01/2017 09:57 AM, Stefano Ricci wrote:
&gt; &gt; 2017-05-01 7:32 GMT+02:00 Michal Privoznik &lt;mprivozn@redhat.com&gt;:
&gt; &gt; &gt; On 04/30/2017 07:12 PM, Stefano Ricci wrote:
&gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; The version used for backtrace is 3.2.0, now I have also tried the
&gt; &gt; &gt; &gt; current downloaded with git but the problem is always present.
&gt; &gt; &gt; &gt; This is the current version log file, set as shown on the DebugLogs page:
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; https://drive.google.com/open?id=0By9lwQyveHENdEt4aEtZcUV3ZEU
&gt; &gt; &gt; 
&gt; &gt; &gt; Couple of my findings:
&gt; &gt; &gt; 
&gt; &gt; &gt; 2017-04-30 16:19:34.894+0000: 870: debug : virDriverLoadModuleFile:49 : Load \
&gt; &gt; &gt; module file '/usr/lib/libvirt/storage-backend/libvirt_storage_backend_rbd.so' \
&gt; &gt; &gt; 2017-04-30 16:19:35.324+0000: 870: debug : virDriverLoadModuleFunc:71 : Lookup \
&gt; &gt; &gt; function 'virStorageBackendRBDRegister' 
&gt; &gt; &gt; it takes nearly .5s to load libvirt_storage_backend_rbd.so
&gt; &gt; &gt; 
&gt; &gt; &gt; But apart from that there is nothing unusual in the logs. So how do you observe \
&gt; &gt; &gt; the hang? How long it is anyway - assuming it goes away after some time. Or \
&gt; &gt; &gt; does it hang indefinitely? 
&gt; &gt; &gt; BTW: is this all the debug messages you have? Because in there, the last line \
&gt; &gt; &gt; is how libvirtd starts qemu-system-x86_64 in order to fetch its capabilities. \
&gt; &gt; &gt; I'd expect libvirt setting qmp_capabilities on the monitor at least. 
&gt; &gt; &gt; Michal
&gt; &gt; 
&gt; &gt; Virtlib logs end in the way you see, only when i kill the qemu process
&gt; &gt; then it starts logging and it is possible to connect remotely with
&gt; &gt; virsh.
&gt; 
&gt; I see. There's nothing suspicious in the logs. The fact that libvirt
&gt; waits for qemu suggests that qemu did not go daemon. I mean, we pass
&gt; -daemonize to qemu, but that doesn't work. I wonder if we cannot do what
&gt; we are doing usually when spawning qemu processes: fork() + exec()
&gt; instead of relying on -daemonize which is broken.
&gt; 
&gt; BTW: you can verify that qemu did not deamonize itself by consulting the
&gt; libvirtd log:
&gt; 
&gt; 2017-04-30 16:19:36.633+0000: 886: debug : virCommandRunAsync:2451 :
&gt; Command result 0, with PID 962
&gt; 
&gt; This means, that PID 962 is qemu. However, when going daemon double fork
&gt; is needed, therefore 'pgrep qemu' should print different number than
&gt; 962. But I guess it doesn't, does it?
&gt; 
&gt; Michal

Fixed, the problem was qemu with the device (I saw that in certain
conditions there was segmentation fault)), I recompiled with the
correct configuration and now everything works, thanks for the
availability, patience shown.
Thanks again.

Stefano


</body></email><email><emailId>20170702082137</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-07-02 08:21:37-0400</timestampReceived><subject>Re: [libvirt-users] virtual drive performance</subject><body>

Hi again,

just today an issue I've thought to be resolved popped up again. We backup
the machine by doing:

virsh snapshot-create-as --domain domain --name backup --no-metadata
--atomic --disk-only --diskspec hda,snapshot=external
# backup hda.qcow2
virsh blockcommit domain hda --active --pivot

Every now and then this process fails with the following error message:

error: failed to pivot job for disk hda
error: block copy still active: disk 'hda' not ready for pivot yet
Could not merge changes for disk hda of domain. VM may be in invalid state.

I expect live backups are a great asset and should work. Is this a bug that
may relates also to the virtual drive performance issues we observe?

Cheers

2017-07-02 10:10 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:

&gt; Hi
&gt;
&gt; a small update on this. I just migrated the vm from the site to my laptop
&gt; and fired it up. The exact same xml configuration (except file paths and
&gt; such) starts up and bursts with 50Mb/s to 115Mb/s in the guest. This allows
&gt; only one reasonable answer: the cpu on my laptop is somehow better suited
&gt; to emulate IO than the CPU built into the host on site. The host there is a
&gt; HP proliant microserver gen8 with xeon processor. But the processor there
&gt; is also never capped at 100% when the guest copies files.
&gt;
&gt; I just ran another test by copying a 3Gb large file on the guest. What I
&gt; can observe on my computer is that the copy process is not at a constant
&gt; rate but rather starts with 90Mb/s, then drops down to 30Mb/s, goes up to
&gt; 70Mb/s, drops down to 1Mb/s, goes up to 75Mb/s, drops to 1Mb/s, goes up to
&gt; 55Mb/s and the pattern continues. Please note that the drive is still
&gt; configured as:
&gt;
&gt; &lt;driver name='qemu' type='qcow2' cache='none' io='threads'/&gt;
&gt;
&gt; and I would expect a constant rate that is either high or low since there
&gt; is no caching involved and the underlying hard drive is a samsung ssd evo
&gt; 850. To have an idea how fast that drive is on my laptop:
&gt;
&gt; $ dd if=/dev/zero of=testfile bs=1M count=1000 oflag=direct
&gt; 1000+0 records in
&gt; 1000+0 records out
&gt; 1048576000 bytes (1.0 GB, 1000 MiB) copied, 2.47301 s, 424 MB/s
&gt;
&gt; I can further observe that the smaller the saved chunks are the slower the
&gt; overall performance is:
&gt;
&gt; dd if=/dev/zero of=testfile bs=512K count=1000 oflag=direct
&gt; 1000+0 records in
&gt; 1000+0 records out
&gt; 524288000 bytes (524 MB, 500 MiB) copied, 1.34874 s, 389 MB/s
&gt;
&gt; $ dd if=/dev/zero of=testfile bs=5K count=1000 oflag=direct
&gt; 1000+0 records in
&gt; 1000+0 records out
&gt; 5120000 bytes (5.1 MB, 4.9 MiB) copied, 0.105109 s, 48.7 MB/s
&gt;
&gt; $ dd if=/dev/zero of=testfile bs=1K count=10000 oflag=direct
&gt; 10000+0 records in
&gt; 10000+0 records out
&gt; 10240000 bytes (10 MB, 9.8 MiB) copied, 0.668438 s, 15.3 MB/s
&gt;
&gt; $ dd if=/dev/zero of=testfile bs=512 count=20000 oflag=direct
&gt; 20000+0 records in
&gt; 20000+0 records out
&gt; 10240000 bytes (10 MB, 9.8 MiB) copied, 1.10964 s, 9.2 MB/s
&gt;
&gt; Could this be a limiting factor? Does qemu/kvm do many many writes of just
&gt; a few bytes?
&gt;
&gt; Ideas, anyone?
&gt;
&gt; Cheers
&gt;
&gt; 2017-06-21 20:46 GMT+02:00 Dan &lt;srwx4096@gmail.com&gt;:
&gt;
&gt;&gt; On Tue, Jun 20, 2017 at 04:24:32PM +0200, Gianluca Cecchi wrote:
&gt;&gt; &gt; On Tue, Jun 20, 2017 at 3:38 PM, Dominik Psenner &lt;dpsenner@gmail.com&gt;
&gt;&gt; wrote:
&gt;&gt; &gt;
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; to the following:
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; &lt;disk type='file' device='disk'&gt;
&gt;&gt; &gt; &gt;   &lt;driver name='qemu' type='qcow2' cache='none'/&gt;
&gt;&gt; &gt; &gt;   &lt;source file='/var/data/virtuals/machines/windows-server-2016-
&gt;&gt; &gt; &gt; x64/image.qcow2'/&gt;
&gt;&gt; &gt; &gt;   &lt;backingStore/&gt;
&gt;&gt; &gt; &gt;   &lt;target dev='hda' bus='scsi'/&gt;
&gt;&gt; &gt; &gt;   &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt;&gt; &gt; &gt; &lt;/disk&gt;
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; Do you see any gotchas in this configuration that could prevent the
&gt;&gt; &gt; &gt; virtualized guest to power on and boot up?
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; When I configure like this, from a linux guest point of view I get this
&gt;&gt; &gt; Symbios Logic SCSI Controller:
&gt;&gt; &gt; 00:08.0 SCSI storage controller: LSI Logic / Symbios Logic 53c895a
&gt;&gt; &gt;
&gt;&gt; &gt; But htis is true only if you add the SCSI controller too, not only the
&gt;&gt; disk
&gt;&gt; &gt; definition.
&gt;&gt; &gt; In my case
&gt;&gt; &gt;
&gt;&gt; &gt;     &lt;controller type='scsi' index='0'&gt;
&gt;&gt; &gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08'
&gt;&gt; &gt; function='0x0'/&gt;
&gt;&gt; &gt;     &lt;/controller&gt;
&gt;&gt; &gt;
&gt;&gt; &gt; Note the slot='0x08' that is reflected into the first field of lspci
&gt;&gt; inside
&gt;&gt; &gt; my linux guest.
&gt;&gt; &gt; So between your controllers you have to add the SCSI one
&gt;&gt; &gt;
&gt;&gt; &gt; In my case (Fedora 25 with virt-manager-1.4.1-2.fc25.noarch,
&gt;&gt; &gt; qemu-kvm-2.7.1-6.fc25.x86_64, libvirt-2.2.1-2.fc25.x86_64) with "Disk
&gt;&gt; bus"
&gt;&gt; &gt; set as SCSI in virt-manager, the xml defintiion for the guest is
&gt;&gt; &gt; automatically updated with the controller if not existent yet.
&gt;&gt; &gt; And the disk definition sections is like this:
&gt;&gt; &gt;
&gt;&gt; &gt;     &lt;disk type='file' device='disk'&gt;
&gt;&gt; &gt;       &lt;driver name='qemu' type='qcow2'/&gt;
&gt;&gt; &gt;       &lt;source file='/var/lib/libvirt/images/slaxsmall.qcow2'/&gt;
&gt;&gt; &gt;       &lt;target dev='sda' bus='scsi'/&gt;
&gt;&gt; &gt;       &lt;boot order='1'/&gt;
&gt;&gt; &gt;       &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt;&gt; &gt;     &lt;/disk&gt;
&gt;&gt; &gt;
&gt;&gt; &gt; So I think you should set dev='sda' and not 'hda' in your xml for it
&gt;&gt; &gt;
&gt;&gt; I am actually very curious to know if that would make a difference. I
&gt;&gt; don't have a such windows vm images ready to test at present.
&gt;&gt;
&gt;&gt; Dan
&gt;&gt; &gt; I don't kknow if w2016 contains the symbios logic drivers already
&gt;&gt; &gt; installed, so that a "simple" reboot could imply an automatic
&gt;&gt; &gt; reconfiguration of the guest....
&gt;&gt; &gt; Note also that in Windows when the hw configuration is considered
&gt;&gt; heavily
&gt;&gt; &gt; changed, you could be asked to register again (I don't think that the
&gt;&gt; IDE
&gt;&gt; &gt; --&gt; SCSI should imply it...)
&gt;&gt; &gt;
&gt;&gt; &gt; Gianluca
&gt;&gt;
&gt;&gt; &gt; _______________________________________________
&gt;&gt; &gt; libvirt-users mailing list
&gt;&gt; &gt; libvirt-users@redhat.com
&gt;&gt; &gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Dominik Psenner
&gt;



-- 
Dominik Psenner

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hi again,&lt;br&gt;&lt;br&gt;&lt;/div&gt;just today \
an issue I've thought to be resolved popped up again. We backup the machine by \
doing:&lt;br&gt;&lt;br&gt;&lt;/div&gt;virsh snapshot-create-as --domain domain --name backup \
--no-metadata --atomic --disk-only --diskspec hda,snapshot=external&lt;br&gt;&lt;/div&gt;# backup \
hda.qcow2&lt;br&gt;&lt;/div&gt;virsh blockcommit domain hda --active --pivot&lt;br&gt;&lt;br&gt;&lt;/div&gt;Every \
now and then this process fails with the following error message:&lt;br&gt;&lt;br&gt;error: \
                failed to pivot job for disk hda&lt;br&gt;
error: block copy still active: disk 'hda' not ready for pivot yet&lt;br&gt;
Could not merge changes for disk hda of domain. VM may be in invalid \
state.&lt;br&gt;&lt;br&gt;&lt;/div&gt;I expect live backups are a great asset and should work. Is this \
a bug that may relates also to the virtual drive performance issues we \
observe?&lt;br&gt;&lt;br&gt;&lt;/div&gt;Cheers&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-02 10:10 GMT+02:00 Dominik Psenner &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
class="HOEnZb"&gt;&lt;div class="h5"&gt;&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;Hi&lt;br&gt;&lt;br&gt;&lt;/div&gt;a small \
update on this. I just migrated the vm  from the site to my laptop and fired it up. \
The exact same xml  configuration (except file paths and such) starts up and bursts \
with  50Mb/s to 115Mb/s in the guest. This allows only one reasonable answer: 
the cpu on my laptop is somehow better suited to emulate IO than the CPU
 built into the host on site. The host there is a HP proliant 
microserver gen8 with xeon processor. But the processor there is also 
never capped at 100% when the guest copies files.&lt;br&gt;&lt;br&gt;I just ran 
another test by copying a 3Gb large file on the guest. What I can 
observe on my computer is that the copy process is not at a constant 
rate but rather starts with 90Mb/s, then drops down to 30Mb/s, goes up 
to 70Mb/s, drops down to 1Mb/s, goes up to 75Mb/s, drops to 1Mb/s, goes 
up to 55Mb/s and the pattern continues. Please note that the drive is 
still configured as:&lt;br&gt;&lt;br&gt;&lt;driver name='qemu' type='qcow2' \
cache='none' io='threads'/&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;and  I would expect a \
constant rate that is either high or low since there  is no caching involved and the \
underlying hard drive is a samsung ssd  evo 850. To have an idea how fast that drive \
is on my laptop:&lt;br&gt;&lt;br&gt;$ dd if=/dev/zero of=testfile bs=1M count=1000 \
oflag=direct&lt;br&gt;1000+0 records in&lt;br&gt;1000+0 records out&lt;br&gt;1048576000 bytes (1.0 GB, \
1000 MiB) copied, 2.47301 s, 424 MB/s&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I can further observe \
that the smaller the saved chunks are the slower the overall performance \
is:&lt;br&gt;&lt;br&gt;dd if=/dev/zero of=testfile bs=512K count=1000 oflag=direct&lt;br&gt;1000+0 \
records in&lt;br&gt;1000+0 records out&lt;br&gt;524288000 bytes (524 MB, 500 MiB) copied, 1.34874 \
s, 389 MB/s&lt;br&gt;&lt;br&gt;$ dd if=/dev/zero of=testfile bs=5K count=1000 \
oflag=direct&lt;br&gt;1000+0 records in&lt;br&gt;1000+0 records out&lt;br&gt;5120000 bytes (5.1 MB, 4.9 \
MiB) copied, 0.105109 s, 48.7 MB/s&lt;br&gt;&lt;br&gt;$ dd if=/dev/zero of=testfile bs=1K \
count=10000 oflag=direct&lt;br&gt;10000+0 records in&lt;br&gt;10000+0 records out&lt;br&gt;10240000 \
bytes (10 MB, 9.8 MiB) copied, 0.668438 s, 15.3 MB/s&lt;br&gt;&lt;br&gt;$ dd if=/dev/zero \
of=testfile bs=512 count=20000 oflag=direct&lt;br&gt;20000+0 records in&lt;br&gt;20000+0 records \
out&lt;br&gt;10240000 bytes (10 MB, 9.8 MiB) copied, 1.10964 s, 9.2 \
MB/s&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Could this be a limiting factor? Does qemu/kvm do many many \
writes of just a few bytes?&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;Ideas, \
anyone?&lt;br&gt;&lt;br&gt;&lt;/div&gt;Cheers&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;&lt;div&gt;&lt;div class="h5"&gt;2017-06-21 20:46 GMT+02:00 Dan &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:srwx4096@gmail.com" \
target="_blank"&gt;srwx4096@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div \
class="h5"&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px \
#ccc solid;padding-left:1ex"&gt;&lt;div class="m_-9222668100434188158HOEnZb"&gt;&lt;div \
class="m_-9222668100434188158h5"&gt;On Tue, Jun 20, 2017 at 04:24:32PM +0200, Gianluca \
Cecchi wrote:&lt;br&gt; &gt; On Tue, Jun 20, 2017 at 3:38 PM, Dominik Psenner &lt;&lt;a \
href="mailto:dpsenner@gmail.com" target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt; \
wrote:&lt;br&gt; &gt;&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; to the following:&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; &lt;disk type='file' device='disk'&gt;&lt;br&gt;
&gt; &gt;     &lt;driver name='qemu' type='qcow2' \
cache='none'/&gt;&lt;br&gt; &gt; &gt;     &lt;source \
file='/var/data/virtuals/machi&lt;wbr&gt;nes/windows-server-2016-&lt;br&gt; &gt; &gt; \
x64/image.qcow2'/&gt;&lt;br&gt; &gt; &gt;     &lt;backingStore/&gt;&lt;br&gt;
&gt; &gt;     &lt;target dev='hda' bus='scsi'/&gt;&lt;br&gt;
&gt; &gt;     &lt;address type='drive' controller='0' bus='0' \
target='0' unit='0'/&gt;&lt;br&gt; &gt; &gt; &lt;/disk&gt;&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; Do you see any gotchas in this configuration that could prevent the&lt;br&gt;
&gt; &gt; virtualized guest to power on and boot up?&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; When I configure like this, from a linux guest point of view I get this&lt;br&gt;
&gt; Symbios Logic SCSI Controller:&lt;br&gt;
&gt; 00:08.0 SCSI storage controller: LSI Logic / Symbios Logic 53c895a&lt;br&gt;
&gt;&lt;br&gt;
&gt; But htis is true only if you add the SCSI controller too, not only the disk&lt;br&gt;
&gt; definition.&lt;br&gt;
&gt; In my case&lt;br&gt;
&gt;&lt;br&gt;
&gt;        &lt;controller type='scsi' index='0'&gt;&lt;br&gt;
&gt;           &lt;address type='pci' domain='0x0000' \
bus='0x00' slot='0x08'&lt;br&gt; &gt; function='0x0'/&gt;&lt;br&gt;
&gt;        &lt;/controller&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; Note the slot='0x08' that is reflected into the first field of lspci \
inside&lt;br&gt; &gt; my linux guest.&lt;br&gt;
&gt; So between your controllers you have to add the SCSI one&lt;br&gt;
&gt;&lt;br&gt;
&gt; In my case (Fedora 25 with virt-manager-1.4.1-2.fc25.noar&lt;wbr&gt;ch,&lt;br&gt;
&gt; qemu-kvm-2.7.1-6.fc25.x86_64, libvirt-2.2.1-2.fc25.x86_64) with "Disk \
bus"&lt;br&gt; &gt; set as SCSI in virt-manager, the xml defintiion for the guest \
is&lt;br&gt; &gt; automatically updated with the controller if not existent yet.&lt;br&gt;
&gt; And the disk definition sections is like this:&lt;br&gt;
&gt;&lt;br&gt;
&gt;        &lt;disk type='file' device='disk'&gt;&lt;br&gt;
&gt;           &lt;driver name='qemu' type='qcow2'/&gt;&lt;br&gt;
&gt;           &lt;source \
file='/var/lib/libvirt/images/&lt;wbr&gt;slaxsmall.qcow2'/&gt;&lt;br&gt; &gt;           \
&lt;target dev='sda' bus='scsi'/&gt;&lt;br&gt; &gt;           &lt;boot \
order='1'/&gt;&lt;br&gt; &gt;           &lt;address type='drive' \
controller='0' bus='0' target='0' unit='0'/&gt;&lt;br&gt; \
&gt;        &lt;/disk&gt;&lt;br&gt; &gt;&lt;br&gt;
&gt; So I think you should set dev='sda' and not 'hda' in your xml \
for it&lt;br&gt; &gt;&lt;br&gt;
&lt;/div&gt;&lt;/div&gt;I am actually very curious to know if that would make a difference. I&lt;br&gt;
don't have a such windows vm images ready to test at present.&lt;br&gt;
&lt;span class="m_-9222668100434188158HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;br&gt;
Dan&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;span class="m_-9222668100434188158im \
m_-9222668100434188158HOEnZb"&gt;&gt; I don't kknow if w2016 contains the symbios \
logic drivers already&lt;br&gt; &gt; installed, so that a "simple" reboot could \
imply an automatic&lt;br&gt; &gt; reconfiguration of the guest....&lt;br&gt;
&gt; Note also that in Windows when the hw configuration is considered heavily&lt;br&gt;
&gt; changed, you could be asked to register again (I don't think that the \
IDE&lt;br&gt; &gt; --&gt; SCSI should imply it...)&lt;br&gt;
&gt;&lt;br&gt;
&gt; Gianluca&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;&lt;div class="m_-9222668100434188158HOEnZb"&gt;&lt;div \
class="m_-9222668100434188158h5"&gt;&gt; \
______________________________&lt;wbr&gt;_________________&lt;br&gt; &gt; libvirt-users mailing \
list&lt;br&gt; &gt; &lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt; \
&lt;br&gt; &lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span class="HOEnZb"&gt;&lt;font \
color="#888888"&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;br&gt;-- &lt;br&gt;&lt;div \
class="m_-9222668100434188158gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div \
dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;/font&gt;&lt;/span&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;br&gt;-- &lt;br&gt;&lt;div class="gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/div&gt;



</body></email><email><emailId>20170704025216</emailId><senderName>netsurfed</senderName><senderEmail>zhuohaofan@126.com</senderEmail><timestampReceived>2017-07-04 02:52:16-0400</timestampReceived><subject>[libvirt-users] node device lifecycle callback can't resive event</subject><body>

[Attachment #2 (text/plain)]

Hi all, 
I registe node device lifecycle event callback function after connect qemu. In the \
callback function, I printf the event and detail. When I plug a USB into host, and \
then pull out, but there is nothing happen. The callback was not called. Could you \
tell me Why? And what dose node device mean?

I want to auto-hotplug usb devices by using libvirt.


Bellow the call of libvirt:
 // node device lifecycle callback function
void nodeDeviceEventLifecycleCallback(virConnectPtr conn, virNodeDevicePtr dev, int \
event,  int detail, void * opaque)
{
    printf("event = %d, detail= %d\n", event, detail);
}


// registe node device lifecycle event
int registeNodeDevEvent()
{
    int ret = virEventRegisterDefaultImpl();
    if (ret) { return -1;}


    ret = virConnectNodeDeviceEventRegisterAny(vmh_conn, NULL, \
                VIR_NODE_DEVICE_EVENT_ID_LIFECYCLE,
            VIR_NODE_DEVICE_EVENT_CALLBACK(nodeDeviceEventLifecycleCallback), NULL, \
NULL);  if (-1 == ret) { return ret;}
}


Below some information about my hypervisor:
root@ubuntu-05:/datapool/zhuohf# virsh -v
3.4.0
root@ubuntu-05:/datapool/zhuohf# qemu-x86_64 -version
qemu-x86_64 version 2.9.0
Copyright (c) 2003-2017 Fabrice Bellard and the QEMU Project developers


[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div&gt;Hi \
all, &lt;/div&gt;&lt;div&gt;I registe node device lifecycle event callback function after \
connect qemu. In the callback function, I printf the event \
and detail.&lt;/div&gt;&lt;div&gt;When I plug a USB into host, and then pull out, but \
there is nothing happen. The callback was not called.&lt;/div&gt;&lt;div&gt;Could you tell me \
Why? And what dose node device mean?&lt;br&gt;&lt;/div&gt;&lt;div&gt;I want to auto-hotplug usb devices \
by using libvirt.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Bellow the call of \
libvirt:&lt;/div&gt;&lt;div&gt; // node device lifecycle callback function&lt;/div&gt;&lt;div&gt;void \
nodeDeviceEventLifecycleCallback(virConnectPtr conn, virNodeDevicePtr dev, int \
event,&lt;/div&gt;&lt;div&gt;                int detail, \
void * opaque)&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;    printf("event = %d, detail= %d\n", \
event, detail);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;// registe node device lifecycle \
event&lt;/div&gt;&lt;div&gt;int registeNodeDevEvent()&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;  \
  int ret = virEventRegisterDefaultImpl();&lt;/div&gt;&lt;div&gt;    if (ret) \
{ return -1;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;    ret = \
virConnectNodeDeviceEventRegisterAny(vmh_conn, NULL, \
VIR_NODE_DEVICE_EVENT_ID_LIFECYCLE,&lt;/div&gt;&lt;div&gt;          \
  VIR_NODE_DEVICE_EVENT_CALLBACK(nodeDeviceEventLifecycleCallback), NULL, \
NULL);&lt;/div&gt;&lt;div&gt;    if (-1 == ret) { return \
ret;}&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;pre style="width: 1076.34px;"&gt;Below some \
information about my hypervisor:&lt;/pre&gt;&lt;pre style="width: \
1076.34px;"&gt;root@ubuntu-05:/datapool/zhuohf# virsh -v 3.4.0&lt;/pre&gt;&lt;pre style="width: \
1076.34px;"&gt;root@ubuntu-05:/datapool/zhuohf# qemu-x86_64 -version qemu-x86_64 version \
2.9.0 Copyright (c) 2003-2017 Fabrice Bellard and the QEMU Project \
developers&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170704084519</emailId><senderName>王李明</senderName><senderEmail>wanglm@certusnet.com.cn</senderEmail><timestampReceived>2017-07-04 08:45:19-0400</timestampReceived><subject>[libvirt-users] The emergence of virtual machines, probabilistic copy large file rate is very low</subject><body>

UbJGR;7b MIME 8qJ=5D6`2?7VSJ&lt;~!#


hi all:

       I used openstack+ceph to create a virtual machine for the window 2008 \
Enterprise Edition sp2. Now I find that almost every day I copy a large 60G file for \
the first time under two different folders on the same disk. Replication rate occurs \
only 2MB/s. But after this copy is finished, it is normal to copy again, and it can \
reach 70MB/s. But the first time the second day of the same operation, it will appear \
again. Not necessarily every day, of course

 

any help will be appricate

 

Wang Liming


[Attachment #3 (text/html)]

&lt;html xmlns:v="urn:schemas-microsoft-com:vml" \
xmlns:o="urn:schemas-microsoft-com:office:office" \
xmlns:w="urn:schemas-microsoft-com:office:word" \
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" \
xmlns="http://www.w3.org/TR/REC-html40"&gt;

&lt;head&gt;
&lt;meta http-equiv=Content-Type content="text/html; charset=utf-8"&gt;
&lt;meta name=Generator content="Microsoft Word 12 (filtered medium)"&gt;
&lt;style&gt;
&lt;!--
 /* Font Definitions */
 @font-face
	{font-family:宋体;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:"\@宋体";
	panose-1:2 1 6 0 3 1 1 1 1 1;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:宋体;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:purple;
	text-decoration:underline;}
span.m-9222668100434188158hoenzb
	{mso-style-name:m_-9222668100434188158hoenzb;}
span.m-9222668100434188158im
	{mso-style-name:m_-9222668100434188158im;}
span.hoenzb
	{mso-style-name:hoenzb;}
span.EmailStyle20
	{mso-style-type:personal;
	font-family:"Calibri","sans-serif";
	color:black;}
span.EmailStyle21
	{mso-style-type:personal-reply;
	font-family:"Calibri","sans-serif";
	color:black;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-size:10.0pt;}
@page Section1
	{size:612.0pt 792.0pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;}
div.Section1
	{page:Section1;}
--&gt;
&lt;/style&gt;
&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
 &lt;o:shapedefaults v:ext="edit" spidmax="1026" /&gt;
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
 &lt;o:shapelayout v:ext="edit"&gt;
  &lt;o:idmap v:ext="edit" data="1" /&gt;
 &lt;/o:shapelayout&gt;&lt;/xml&gt;&lt;![endif]--&gt;
&lt;/head&gt;

&lt;body lang=ZH-CN link=blue vlink=purple&gt;

&lt;div class=Section1&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='font-family:"Calibri","sans-serif";
color:black'&gt;hi all:&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='font-family:"Calibri","sans-serif";
color:black'&gt;             I used openstack+ceph to create a virtual machine for the
window 2008 Enterprise Edition sp2. Now I find that almost every day I copy a
large 60G file for the first time under two different folders on the same disk.
Replication rate occurs only 2MB/s. But after this copy is finished, it is
normal to copy again, and it can reach 70MB/s. But the first time the second
day of the same operation, it will appear again. Not necessarily every day, of
course&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='font-family:"Calibri","sans-serif";
color:black'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='font-family:"Calibri","sans-serif";
color:black'&gt;any help will be appricate&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='font-family:"Calibri","sans-serif";
color:black'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='font-family:"Calibri","sans-serif";
color:black'&gt;Wang Liming&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/body&gt;

&lt;/html&gt;



</body></email><email><emailId>20171125044621</emailId><senderName>Benjammin2068</senderName><senderEmail>benjammin2068@gmail.com</senderEmail><timestampReceived>2017-11-25 04:46:21-0400</timestampReceived><subject>[libvirt-users] kvm/libvirt on CentOS7 w/Windows 10 Pro guest</subject><body>

Hey all,

New to list, so I apologize if this has been asked a bunch already...

 Is there something I'm missing with Windows 10 as a guest that keeps Windows Updates \
from nuking the boot process?

I just did an orderly shutdown and windows updated itself &lt;I forgot to disable in \
time&gt; only to reboot to the diagnostics screen which couldn't repair.

going to command prompt and doing the usual "bootrec /fixmbr, /fixboot and \
/RebuildBcd" didn't help.

This has happened a few times. I can't believe how fragile Win10pro is while running \
in a VM.

(and it's happened on a couple machines I've been experimenting with -- both running \
same OS, but different hardware.)

I just saw the FAQ about the libvirt repo for the virtio drivers for windows.... I \
need to go read more on it...

but in the meantime, is there any other smoking gun I'm not aware of? (after lots of \
google searching)


Thanks,


 -Ben


</body></email><email><emailId>20171125132557</emailId><senderName>Sam Varshavchik</senderName><senderEmail>mrsam@courier-mta.com</senderEmail><timestampReceived>2017-11-25 13:25:57-0400</timestampReceived><subject>Re: [libvirt-users] kvm/libvirt on CentOS7 w/Windows 10 Pro guest</subject><body>


Benjammin2068 writes:

&gt; Hey all,
&gt;
&gt; New to list, so I apologize if this has been asked a bunch already...
&gt;
&gt;   Is there something I'm missing with Windows 10 as a guest that keeps  
&gt; Windows Updates from nuking the boot process?
&gt;
&gt; I just did an orderly shutdown and windows updated itself &lt;I forgot to  
&gt; disable in time&gt; only to reboot to the diagnostics screen which couldn't  
&gt; repair.
&gt;
&gt; going to command prompt and doing the usual "bootrec /fixmbr, /fixboot and  
&gt; /RebuildBcd" didn't help.
&gt;
&gt; This has happened a few times. I can't believe how fragile Win10pro is while  
&gt; running in a VM.
&gt;
&gt; (and it's happened on a couple machines I've been experimenting with -- both  
&gt; running same OS, but different hardware.)
&gt;
&gt; I just saw the FAQ about the libvirt repo for the virtio drivers for  
&gt; windows.... I need to go read more on it...
&gt;
&gt; but in the meantime, is there any other smoking gun I'm not aware of? (after  
&gt; lots of google searching)

I don't use virtio drivers. My Windows 10 guest setup is as plain as it can  
be.

Starting with qemu 2.9, there is some kind of a problem that prevents  
Windows 10 from rebooting itself properly. I've also read about others  
reporting this issue as well. It's possible that the problem started before  
2.9. Fedora 25, with qemu 2.4, was ok. Fedora 26, with qemu 2.9, was broken.

About 90% of the reboots end up in rescue mode, with Windows 10's rescue  
tool claiming, no what you do, that the system is not recoverable. Without  
really explaining why. Obviously, since it booted into rescue mode, the  
virtual disk is working, but the rescue tool does not see it. Note, that I  
do not use virtio, so this is not a factor.

However if you force off the VM, and do a fresh boot, nothing's wrong. It'll  
boot up like nothing happened. Your updates do not really mess up the boot  
process. It just looks this way.

Use "virsh edit" to edit your domain XML file in /etc/libvirt/qemu. Replace  
the existing &lt;on_reboot&gt; setting in there with:

&lt;on_reboot&gt;destroy&lt;/on_reboot&gt;

Now, when Windows 10 updates reboot now, the virtual machine will turn off  
instead. After manually starting it again, it should boot fine.

If you're using virt-manager, it goes a bit wonky, when the VM shuts down  
with this setting in place, and virt-manager will get very confused. You'll  
just need to close and restart virt-manager, to turn on the VM again.


[Attachment #3 (application/pgp-signature)]

</body></email><email><emailId>20171127162827</emailId><senderName>Benjammin2068</senderName><senderEmail>benjammin2068@gmail.com</senderEmail><timestampReceived>2017-11-27 16:28:27-0400</timestampReceived><subject>Re: [libvirt-users] kvm/libvirt on CentOS7 w/Windows 10 Pro guest</subject><body>

On 11/25/2017 07:25 AM, Sam Varshavchik wrote:
&gt; 
&gt; I don't use virtio drivers. My Windows 10 guest setup is as plain as it can be.
&gt; 
&gt; Starting with qemu 2.9, there is some kind of a problem that prevents Windows 10 \
&gt; from rebooting itself properly. I've also read about others reporting this issue as \
&gt; well. It's possible that the problem started before 2.9. Fedora 25, with qemu 2.4, \
&gt; was ok. Fedora 26, with qemu 2.9, was broken. 
&gt; About 90% of the reboots end up in rescue mode, with Windows 10's rescue tool \
&gt; claiming, no what you do, that the system is not recoverable. Without really \
&gt; explaining why. Obviously, since it booted into rescue mode, the virtual disk is \
&gt; working, but the rescue tool does not see it. Note, that I do not use virtio, so \
&gt; this is not a factor. 
&gt; However if you force off the VM, and do a fresh boot, nothing's wrong. It'll boot \
&gt; up like nothing happened. Your updates do not really mess up the boot process. It \
&gt; just looks this way. 
&gt; Use "virsh edit" to edit your domain XML file in /etc/libvirt/qemu. Replace the \
&gt; existing &lt;on_reboot&gt; setting in there with: 
&gt; &lt;on_reboot&gt;destroy&lt;/on_reboot&gt;
&gt; 
&gt; Now, when Windows 10 updates reboot now, the virtual machine will turn off instead. \
&gt; After manually starting it again, it should boot fine. 
&gt; If you're using virt-manager, it goes a bit wonky, when the VM shuts down with this \
&gt; setting in place, and virt-manager will get very confused. You'll just need to \
&gt; close and restart virt-manager, to turn on the VM again. 

Thanks for the reply.

IIRC, I've even rebooted the system (host as well) with no success... but maybe not. \
I'll try your suggestions again if I have an issue.

I really thought it was updates. I also don't use any VirtIO stuff either. As plain \
and stock a setup as I can get.

Hopefully this glitch gets fixed soon. What a way to freak admins out. :P

Thanks,

 -Ben


</body></email><email><emailId>20171128063747</emailId><senderName>Tony Brian Albers</senderName><senderEmail>tba@kb.dk</senderEmail><timestampReceived>2017-11-28 06:37:47-0400</timestampReceived><subject>Re: [libvirt-users] kvm/libvirt on CentOS7 w/Windows 10 Pro guest</subject><body>

On 11/27/2017 05:28 PM, Benjammin2068 wrote:
&gt; On 11/25/2017 07:25 AM, Sam Varshavchik wrote:
&gt; &gt; 
&gt; &gt; I don't use virtio drivers. My Windows 10 guest setup is as plain as it can be.
&gt; &gt; 
&gt; &gt; Starting with qemu 2.9, there is some kind of a problem that prevents Windows 10 \
&gt; &gt; from rebooting itself properly. I've also read about others reporting this issue \
&gt; &gt; as well. It's possible that the problem started before 2.9. Fedora 25, with qemu \
&gt; &gt; 2.4, was ok. Fedora 26, with qemu 2.9, was broken. 
&gt; &gt; About 90% of the reboots end up in rescue mode, with Windows 10's rescue tool \
&gt; &gt; claiming, no what you do, that the system is not recoverable. Without really \
&gt; &gt; explaining why. Obviously, since it booted into rescue mode, the virtual disk is \
&gt; &gt; working, but the rescue tool does not see it. Note, that I do not use virtio, so \
&gt; &gt; this is not a factor. 
&gt; &gt; However if you force off the VM, and do a fresh boot, nothing's wrong. It'll boot \
&gt; &gt; up like nothing happened. Your updates do not really mess up the boot process. It \
&gt; &gt; just looks this way. 
&gt; &gt; Use "virsh edit" to edit your domain XML file in /etc/libvirt/qemu. Replace the \
&gt; &gt; existing &lt;on_reboot&gt; setting in there with: 
&gt; &gt; &lt;on_reboot&gt;destroy&lt;/on_reboot&gt;
&gt; &gt; 
&gt; &gt; Now, when Windows 10 updates reboot now, the virtual machine will turn off \
&gt; &gt; instead. After manually starting it again, it should boot fine. 
&gt; &gt; If you're using virt-manager, it goes a bit wonky, when the VM shuts down with \
&gt; &gt; this setting in place, and virt-manager will get very confused. You'll just need \
&gt; &gt; to close and restart virt-manager, to turn on the VM again. 
&gt; 
&gt; Thanks for the reply.
&gt; 
&gt; IIRC, I've even rebooted the system (host as well) with no success... but maybe \
&gt; not. I'll try your suggestions again if I have an issue. 
&gt; I really thought it was updates. I also don't use any VirtIO stuff either. As plain \
&gt; and stock a setup as I can get. 
&gt; Hopefully this glitch gets fixed soon. What a way to freak admins out. :P
&gt; 
&gt; Thanks,
&gt; 
&gt; -Ben
&gt; 
&gt; 
Hmm.. could this somehow be related to the fast startup thing in win10? 
I mean, if fast startup is disabled, will that help?

Just a thought.

/tony


Tony Albers
Systems administrator, IT-development
Royal Danish Library, Victor Albecks Vej 1, 8000 Aarhus C, Denmark.
Tel: +45 2566 2383 / +45 8946 2316


</body></email><email><emailId>20171128115305</emailId><senderName>Sam Varshavchik</senderName><senderEmail>mrsam@courier-mta.com</senderEmail><timestampReceived>2017-11-28 11:53:05-0400</timestampReceived><subject>Re: [libvirt-users] kvm/libvirt on CentOS7 w/Windows 10 Pro guest</subject><body>


Tony Brian Albers writes:

&gt; On 11/27/2017 05:28 PM, Benjammin2068 wrote:

&gt; &gt; Thanks for the reply.
&gt; &gt;
&gt; &gt; IIRC, I've even rebooted the system (host as well) with no success... but  
&gt; maybe not. I'll try your suggestions again if I have an issue.
&gt; &gt;
&gt; &gt; I really thought it was updates. I also don't use any VirtIO stuff either.  
&gt; As plain and stock a setup as I can get.
&gt; &gt;
&gt; &gt; Hopefully this glitch gets fixed soon. What a way to freak admins out. :P
&gt; &gt;
&gt; &gt; Thanks,
&gt; &gt;
&gt; &gt;    -Ben
&gt; &gt;
&gt; &gt;
&gt; Hmm.. could this somehow be related to the fast startup thing in win10?
&gt; I mean, if fast startup is disabled, will that help?
&gt;
&gt; Just a thought.

Fast startup does not get utilized for reboots, only for regular shutdowns.  
The actual option in Windows settings reads:

"This helps starts your PC faster after shutdown. Restart isn't affected."


[Attachment #3 (application/pgp-signature)]

</body></email><email><emailId>20171128122325</emailId><senderName>Tony Brian Albers</senderName><senderEmail>tba@kb.dk</senderEmail><timestampReceived>2017-11-28 12:23:25-0400</timestampReceived><subject>Re: [libvirt-users] kvm/libvirt on CentOS7 w/Windows 10 Pro guest</subject><body>

On 11/28/2017 12:53 PM, Sam Varshavchik wrote:
&gt; Tony Brian Albers writes:
&gt; 
&gt;&gt; On 11/27/2017 05:28 PM, Benjammin2068 wrote:
&gt; 
&gt;&gt; &gt; Thanks for the reply.
&gt;&gt; &gt;
&gt;&gt; &gt; IIRC, I've even rebooted the system (host as well) with no 
&gt;&gt; success... but maybe not. I'll try your suggestions again if I have an 
&gt;&gt; issue.
&gt;&gt; &gt;
&gt;&gt; &gt; I really thought it was updates. I also don't use any VirtIO stuff 
&gt;&gt; either. As plain and stock a setup as I can get.
&gt;&gt; &gt;
&gt;&gt; &gt; Hopefully this glitch gets fixed soon. What a way to freak admins 
&gt;&gt; out. :P
&gt;&gt; &gt;
&gt;&gt; &gt; Thanks,
&gt;&gt; &gt;
&gt;&gt; &gt;   -Ben
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; Hmm.. could this somehow be related to the fast startup thing in win10?
&gt;&gt; I mean, if fast startup is disabled, will that help?
&gt;&gt;
&gt;&gt; Just a thought.
&gt; 
&gt; Fast startup does not get utilized for reboots, only for regular 
&gt; shutdowns. The actual option in Windows settings reads:
&gt; 
&gt; "This helps starts your PC faster after shutdown. Restart isn't affected."
&gt; 

Thanks, I wasn't sure about that.
So a restart/reboot is closer to a cold-start than a shutdown and 
power-up is. Makes sense....

Yeah, I know there's a way to disable fast-start end also to avoid it 
when shutting down.

So restart avoids the hibernation-thing that fast start uses, but does 
it do so to full extent? If it saves just the least bit of info, that 
could be the reason for the boot issue. Just me thinking.. I haven't 
really used windows for the last 17 yrs.

/tony

-- 
Tony Albers
Systems administrator, IT-development
Royal Danish Library, Victor Albecks Vej 1, 8000 Aarhus C, Denmark.
Tel: +45 2566 2383 / +45 8946 2316

</body></email><email><emailId>20171129002807</emailId><senderName>Sam Varshavchik</senderName><senderEmail>mrsam@courier-mta.com</senderEmail><timestampReceived>2017-11-29 00:28:07-0400</timestampReceived><subject>Re: [libvirt-users] kvm/libvirt on CentOS7 w/Windows 10 Pro guest</subject><body>


Tony Brian Albers writes:

&gt; &gt;&gt; Hmm.. could this somehow be related to the fast startup thing in win10?
&gt; &gt;&gt; I mean, if fast startup is disabled, will that help?
&gt; &gt;&gt;
&gt; &gt;&gt; Just a thought.
&gt; &gt;
&gt; &gt; Fast startup does not get utilized for reboots, only for regular
&gt; &gt; shutdowns. The actual option in Windows settings reads:
&gt; &gt;
&gt; &gt; "This helps starts your PC faster after shutdown. Restart isn't affected."
&gt; &gt;
&gt;
&gt; Thanks, I wasn't sure about that.
&gt; So a restart/reboot is closer to a cold-start than a shutdown and
&gt; power-up is. Makes sense....
&gt;
&gt; Yeah, I know there's a way to disable fast-start end also to avoid it
&gt; when shutting down.
&gt;
&gt; So restart avoids the hibernation-thing that fast start uses, but does
&gt; it do so to full extent? If it saves just the least bit of info, that
&gt; could be the reason for the boot issue.

It's also entirely possible that "Restart isn't affected" part refers only  
to restarts that get initiated after applying system updates, so a manually- 
initiated restart still hibernates, despite this claim otherwise.

&gt;  Just me thinking.. I haven't
&gt; really used windows for the last 17 yrs.

Well, some Googling around found the instructions for disabling fast start  
up in Windows 10.

Then, I took a Windows 10 guest that I successfully nursed through the fall  
creator's update by manually starting it for every reboot. The host was also  
updated to Fedora 27 and qemu 2.10 during the same timeframe.

I reenabled the reboots in domain XML file, and disabled fast startup in  
Windows 10. So far, I've succesfully rebooted that VM twice without any  
issues. I'll probably need to reboot it 3-4 times more, before cautiously  
marking this as a solved issue; but not quite sure whether the deciding  
factor is the fall creator's update, qemu 2.10, or disabling fast startup.

I have not noticed any marked difference in the actual startup speed. If  
anything, Windows seems to boot a bit faster, and the CPU utilization seems  
to settle down pretty quickly, after a reboot. Which kind of makes sense,  
actually, now that I'm aware of the fast startup "feature", and I find it  
absolutely hillarious.

See: if Windows was really hibernating, then after it boots up the dumb  
thing obviously wants to immediately kick off every frigging last scheduled  
task it has, since it probably came due during the time the whole bloody  
thing was off. I always had a laugh looking at virt-manager showing the  
guest pegging the CPU at 100% for 10-30 minutes after I start up the VM.  
That's Windows for you. Well, now, with the fast startup disabled, the  
virtual CPU settles down pretty quickly.

Also the system startup audio chime reliably plays every time now, too. I  
guess waking up from hibernation doesn't merit the audio chime.



[Attachment #3 (application/pgp-signature)]

</body></email><email><emailId>20171204150356</emailId><senderName>"Patrick O'Callaghan"</senderName><senderEmail>poc@usb.ve</senderEmail><timestampReceived>2017-12-04 15:03:56-0400</timestampReceived><subject>Re: [libvirt-users] Guest Reboot After Plug HDMI</subject><body>

On Mon, 2017-12-04 at 14:32 +0100, Pavel Hrdina wrote:
&gt; I would recommend you to read this wiki page [1].
&gt; 
&gt; [1] &lt;https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF&gt;
&gt; 
&gt; I was able to configure it on my computer, basically you need to make
&gt; sure that you have IOMMU available and enabled, that your GPU card is
&gt; in it's own isolated IOMMU group, configure kernel to assign vfio-pci
&gt; driver while booting and properly configure guest XML in libvirt.
&gt; 
&gt; Everything is described and explained on that wiki page.

See also the VFIO mailing list at:

https://www.redhat.com/mailman/listinfo/vfio-users

poc

</body></email><email><emailId>20171205100458</emailId><senderName>"Rogue S.T"</senderName><senderEmail>15700157322@163.com</senderEmail><timestampReceived>2017-12-05 10:04:58-0400</timestampReceived><subject>[libvirt-users] Libvirt checkout graphics card</subject><body>

[Attachment #2 (text/plain)]

Hello, everybody!My guest has two graphics card when it is running, one is GTX960, \
and other is video card that is created by qemu.But my guest use video card default, \
and my screen is not light. I try checkout graphics card with vnc or spice, But it is \
suspend.Could you help me? And may i checkout card in my host system with command? \
Because my connection with vnc or spice is not stable.This is my vga card message:

    Bus  0, device   7, function 0:
    VGA controller: PCI device 1234:1111
      BAR0: 32 bit prefetchable memory at 0xf2000000 [0xf2ffffff].
      BAR2: 32 bit memory at 0xfe09e000 [0xfe09efff].
      BAR6: 32 bit memory at 0xffffffffffffffff [0x0000fffe].
      id "video0"
  Bus  0, device   8, function 0:
    VGA controller: PCI device 10de:1401
      IRQ 11.
      BAR0: 32 bit memory at 0xfd000000 [0xfdffffff].
      BAR1: 64 bit prefetchable memory at 0xe0000000 [0xefffffff].
      BAR3: 64 bit prefetchable memory at 0xf0000000 [0xf1ffffff].
      BAR5: I/O at 0xc000 [0xc07f].
      BAR6: 32 bit memory at 0xffffffffffffffff [0x0003fffe].
      id ""
And following message is my envireoment:


  host: ubuntu 1604
  guest: window 7 professor
  qemu: 2.11.0-rc0
  seabiois: 2.10.7 (qemu set)
  libvirt: 3.9


[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div \
style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div \
style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div \
style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;pre&gt;&lt;div \
style="font-family: Arial; white-space: normal;"&gt;Hello, everybody!&lt;/div&gt;&lt;div \
style="font-family: Arial; white-space: normal;"&gt;My guest has two graphics card when \
it is running, one is GTX960, and other is video card that is created by \
qemu.&lt;/div&gt;&lt;div style="font-family: Arial; white-space: normal;"&gt;But my guest use \
video card default, and my screen is not light. I try checkout graphics card with vnc \
or spice, But it is suspend.&lt;/div&gt;&lt;div style="font-family: Arial; white-space: \
normal;"&gt;Could you help me? And may i checkout card in my host system with command? \
Because my connection with vnc or spice is not stable.&lt;/div&gt;&lt;div style="font-family: \
Arial; white-space: normal;"&gt;This is my vga card message:&lt;/div&gt;&lt;div \
style="font-family: Arial; white-space: normal;"&gt;&lt;br&gt;&lt;/div&gt;&lt;div style="font-family: \
Arial; white-space: normal;"&gt;    Bus  0, device   7, \
function 0:&lt;/div&gt;&lt;div style="font-family: Arial; white-space: normal;"&gt;    \
VGA controller: PCI device 1234:1111&lt;/div&gt;&lt;div style="font-family: Arial; \
white-space: normal;"&gt;      BAR0: 32 bit prefetchable memory at \
0xf2000000 [0xf2ffffff].&lt;/div&gt;&lt;div style="font-family: Arial; white-space: \
normal;"&gt;      BAR2: 32 bit memory at 0xfe09e000 \
[0xfe09efff].&lt;/div&gt;&lt;div style="font-family: Arial; white-space: normal;"&gt;  \
    BAR6: 32 bit memory at 0xffffffffffffffff [0x0000fffe].&lt;/div&gt;&lt;div \
style="font-family: Arial; white-space: normal;"&gt;      id \
"video0"&lt;/div&gt;&lt;div style="font-family: Arial; white-space: normal;"&gt;  Bus  \
0, device   8, function 0:&lt;/div&gt;&lt;div style="font-family: Arial; \
white-space: normal;"&gt;    VGA controller: PCI device 10de:1401&lt;/div&gt;&lt;div \
style="font-family: Arial; white-space: normal;"&gt;      IRQ \
11.&lt;/div&gt;&lt;div style="font-family: Arial; white-space: normal;"&gt;      \
BAR0: 32 bit memory at 0xfd000000 [0xfdffffff].&lt;/div&gt;&lt;div style="font-family: Arial; \
white-space: normal;"&gt;      BAR1: 64 bit prefetchable memory at \
0xe0000000 [0xefffffff].&lt;/div&gt;&lt;div style="font-family: Arial; white-space: \
normal;"&gt;      BAR3: 64 bit prefetchable memory at 0xf0000000 \
[0xf1ffffff].&lt;/div&gt;&lt;div style="font-family: Arial; white-space: normal;"&gt;  \
    BAR5: I/O at 0xc000 [0xc07f].&lt;/div&gt;&lt;div style="font-family: Arial; \
white-space: normal;"&gt;      BAR6: 32 bit memory at 0xffffffffffffffff \
[0x0003fffe].&lt;/div&gt;&lt;div style="font-family: Arial; white-space: normal;"&gt;  \
    id ""&lt;/div&gt;&lt;div&gt;And following message is my \
envireoment:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;  host: ubuntu 1604&lt;/div&gt;&lt;div&gt;  guest: window 7 \
professor&lt;/div&gt;&lt;div&gt;  qemu: 2.11.0-rc0&lt;/div&gt;&lt;div&gt;  seabiois: 2.10.7 (qemu \
set)&lt;/div&gt;&lt;div&gt;  libvirt: \
3.9&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;span \
title="neteasefooter"&gt;&lt;p&gt;&lt;br/&gt; &lt;/p&gt;&lt;/span&gt;



</body></email><email><emailId>20171206032741</emailId><senderName>"Rogue S.T"</senderName><senderEmail>15700157322@163.com</senderEmail><timestampReceived>2017-12-06 03:27:41-0400</timestampReceived><subject>[libvirt-users] How to use virtio-gpu to output</subject><body>

[Attachment #2 (text/plain)]

Hello, lads, owing to i study video card on my guest recently.
So i have a notion that whether we can get video with virtio-vga or not.
It's seem that we are using a graphics card truth.
Maybe we can finish? 
And if this is not likelihood? Tell me why please.
Thanks
following is my host system environment:
host: ubuntu 1604
qemu: 2.11
libvirt: 3.9
kernel: 4.14
guest: window 7 professor


[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div&gt;Hello, \
lads, owing to i study video card on my guest recently.&lt;/div&gt;&lt;div&gt;So i have a notion \
that whether we can get video with virtio-vga or not.&lt;/div&gt;&lt;div&gt;It's seem that we are \
using a graphics card truth.&lt;/div&gt;&lt;div&gt;Maybe we can finish? &lt;/div&gt;&lt;div&gt;And if \
this is not likelihood? Tell me why please.&lt;/div&gt;&lt;div&gt;Thanks&lt;/div&gt;&lt;div&gt;following is \
my host system environment:&lt;/div&gt;&lt;div&gt;host: ubuntu 1604&lt;/div&gt;&lt;div&gt;qemu: \
2.11&lt;/div&gt;&lt;div&gt;libvirt: 3.9&lt;/div&gt;&lt;div&gt;kernel: 4.14&lt;/div&gt;&lt;div&gt;guest: window 7 \
professor&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;span \
title="neteasefooter"&gt;&lt;p&gt;&lt;br/&gt; &lt;/p&gt;&lt;/span&gt;



</body></email><email><emailId>20171206140545</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-12-06 14:05:45-0400</timestampReceived><subject>Re: [libvirt-users] problem when use tls to connect libvirt</subject><body>

On Wed, Dec 06, 2017 at 09:44:47PM +0800, Yalan Zhang wrote:
&gt; Hi guys,
&gt; 
&gt; I met a problem when I use tls to connect libvirt.
&gt; When I set the CN in client.info, server.info as hostname(FDQN), the tls
&gt; check will fail with ip; and vice versa, when set CN as ip address, the tls
&gt; check will fail with hostname. Only use what we set in can succeed. If this
&gt; is expected? or I there was some issue in my env. or setup steps?
&gt; 
&gt; 
&gt; 1. set tls env with hostname, then it will fail to check with ip
&gt; 
&gt; # virsh -c qemu+tls://192.168.122.4/system
&gt; 2017-12-06 13:24:52.346+0000: 3954: info : libvirt version: x.x.x, package:
&gt; 4.el7 (Red Hat, Inc. &lt;http://bugzilla.redhat.com/bugzilla&gt;,
&gt; 2017-11-30-07:57:27, x.x.x.redhat.com)
&gt; 2017-12-06 13:24:52.346+0000: 3954: info : hostname: work.englab.cn
&gt; 2017-12-06 13:24:52.346+0000: 3954: warning :
&gt; virNetTLSContextCheckCertificate:1125 : Certificate check failed
&gt; Certificate [session] owner does not match the hostname 192.168.122.4
&gt; error: failed to connect to the hypervisor
&gt; error: authentication failed: Failed to verify peer's certificate
&gt; 
&gt; 2. use the hostname as what we set can succeed.
&gt; 
&gt; # virsh -c qemu+tls://test.englab.cn/system
&gt; Welcome to virsh, the virtualization interactive terminal.
&gt; 
&gt; Type:  'help' for help with commands
&gt;        'quit' to quit
&gt; 
&gt; virsh #

X509 certificates contain one or more hostnames + IP addresses that are
associated with the server that owns them.  The error message you see
shows that the certificate you have created only contains the hostname
"test.englab.cn", and does *not* contain the IP address "192.168.122.4".

If you want to be able to connect to libvirt using and IP address then
you need to make sure the certificate contains the IP address too.

If you're following the libvirt guide at

  https://libvirt.org/remote.html#Remote_TLS_server_certificates

Then, instead of creating server.info containing:

  organization = Name of your organization
  cn = test.englab.cn
  tls_www_server
  encryption_key
  signing_key

use this:

  organization = Name of your organization
  cn = test.englab.cn
  dns_name = test.englab.cn
  dns_name = test
  ip_address = 192.168.122.4
  tls_www_server
  encryption_key
  signing_key


notice you can list multiple dns_name entries and multiple ip_address
entries if needed - I show using the short + fully qualified hostname
here. Adjust as desired.


Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20171207172148</emailId><senderName>Andrea Bolognani</senderName><senderEmail>abologna@redhat.com</senderEmail><timestampReceived>2017-12-07 17:21:48-0400</timestampReceived><subject>Re: [libvirt-users] public IP for VM</subject><body>

On Thu, 2017-12-07 at 11:55 -0500, Doug Hughes wrote:
[...]
&gt; from the guest perspective, here's an example from the .xml
&gt;    &lt;interface type='network'&gt;
&gt;       &lt;mac address='52:54:00:b0:98:0b'/&gt;
&gt;       &lt;source network='default'/&gt;
&gt;       &lt;model type='rtl8139'/&gt;

As a side note, you should only use rtl8139 if your guest OS
literally can't be convinced to work with anything else.

-- 
Andrea Bolognani / Red Hat / Virtualization

</body></email><email><emailId>20171210172514</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-12-10 17:25:14-0400</timestampReceived><subject>Re: [libvirt-users] libvirt error messages</subject><body>

On 12/10/2017 05:03 PM, Anastasiya Ruzhanskaya wrote:
&gt; Hello,
&gt; I am experimenting with libvirt for my diploma. I set up an environment,
&gt; where I can stop, resend, generate messages for libvirt.
&gt; I am capable also standing between client and server and analyze the number
&gt; of current procedure and decide what to do next ( I mean rpc procedure).
&gt; 
&gt; So, for example I want to always drop creating snapshots and send an error
&gt; to client with my custom message (NOT custom error type, but exactly custom
&gt; message, I don't want to modify any libvirt code on client and adding my
&gt; errors). I am operating with bare tcp traffic, so I can easily read
&gt; everything in the middle.
&gt; 
&gt; So,  I noticed one error for libvirt snapshots:
&gt; 'internal error: unexpected domain snapshot snapshot1 already exists'
&gt; and started sending it every time I see procedure :
&gt; REMOTE_PROC_DOMAIN_SNAPSHOT_CREATE_XML
&gt; 
&gt; I thought, that this is possible to insert custom message here, but this is
&gt; not true. When I change the length of the message on one symbol - it is
&gt; still correct, on two -also , on three symbols - I get an error that the
&gt; size of the payload is incorrect. Some other errors when I insert a message
&gt; of random length.
&gt; 
&gt; What is strange, that if I insert 'xxxxxxxxxxxxx...' message , which has
&gt; the same length as 'internal error: unexpected domain snapshot snapshot1
&gt; already exists' - everything is parsed fine.

I guess when changing the error message you're not re-calculating RPC
'lengths'. For instance, at RPC level strings are encoded as follows:

| len | string .... [padding] |

Where len specifies string length, string is then whatever string
server/client is sending. At the end is optional padding so that the
whole field is aligned to multiple of 4 bytes.

Then, there's the header which contains the full length of the RPC
packet. In the code, this is calculated as the last thing, after all
other fields were placed into the packet. IOW, if you change length of a
string (or any other field) you have to recalculate the new packet
length. There's a page which describes how our RPC works:

  https://libvirt.org/internals/rpc.html

BTW: A reply to call is identified by matching header fields, meaning:
program, version, procedure and serial numbers must match for client to
correctly identify reply to a call.

Michal

</body></email><email><emailId>20171211062516</emailId><senderName>Anastasiya Ruzhanskaya</senderName><senderEmail>anastasiya.ruzhanskaya@frtk.ru</senderEmail><timestampReceived>2017-12-11 06:25:16-0400</timestampReceived><subject>Re: [libvirt-users] libvirt authentication</subject><body>

I also wanted to know,
where the information about current session is sent?
In which structures ( I actually didn't find this in code)?
Is it appended to every sent procedure or not? Or maybe libvirt checks in
some other way ?

Thank you.

2017-12-10 20:57 GMT+01:00 Anastasiya Ruzhanskaya &lt;
anastasiya.ruzhanskaya@frtk.ru&gt;:

&gt; Hello,
&gt; I am currently trying to install certificates for tls. By this time I have
&gt; got some questions:
&gt; 1) Is documentation in the web docs up-to-date regarding tls server,
&gt; client, ca certificates? (actually I have some problems, but maybe this is
&gt; due to smth has changed in certtools and was not updated in docs, perhaps
&gt; some more fields are needed now).
&gt; 2) there is a error in virt-pki-validate :
&gt; when determining whether host name matches CN name you assume, that CN is
&gt; standing in the end. So I get an error:
&gt;
&gt; The server certificate does not seem to match the host name
&gt; hostname: "barni"
&gt; Server certificate CN: "barni,O=libvirt.org"
&gt;
&gt; CN field is standing at the beginning of line.
&gt;
&gt; Seems that these are the appropriate lines in code:
&gt;
&gt; 258  S_HOST=`"$CERTOOL" -i --infile "$LIBVIRT/servercert.pem" | grep
&gt; Subject: | sed 's+.*CN=\([a-zA-Z\. _-]*\)+\1+'`
&gt; 259  if test "$S_HOST" != "`hostname -s`" &amp;&amp; test "$S_HOST" != "`hostname`"
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;I also wanted to know, &lt;br&gt;where the information about current \
session is sent? &lt;br&gt;In which structures ( I actually didn't find this in code)? \
&lt;br&gt;Is it appended to every sent procedure or not? Or maybe libvirt checks in some \
other way ?&lt;br&gt;&lt;br&gt;&lt;/div&gt;Thank you.&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-12-10 20:57 GMT+01:00 Anastasiya Ruzhanskaya &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:anastasiya.ruzhanskaya@frtk.ru" \
target="_blank"&gt;anastasiya.ruzhanskaya@frtk.ru&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hello,&lt;br&gt;&lt;/div&gt;I am currently trying to \
install certificates for tls. By this time I have got some questions:&lt;br&gt;&lt;/div&gt;1) Is \
documentation in the web docs up-to-date regarding tls server, client, ca \
certificates? (actually I have some problems, but maybe this is due to smth has \
changed in certtools and was not updated in docs, perhaps some more fields are needed \
now). &lt;br&gt;&lt;/div&gt;2) there is a error in virt-pki-validate :&lt;br&gt;&lt;/div&gt;when determining \
whether host name matches CN name you assume, that CN is standing in the end. So I \
get an error:&lt;br&gt;&lt;br&gt;The server certificate does not seem to match the host \
name&lt;br&gt;hostname: "barni"&lt;br&gt;Server certificate CN: "barni,O=&lt;a \
href="http://libvirt.org" \
target="_blank"&gt;libvirt.org&lt;/a&gt;"&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;CN field is standing at the \
beginning of line.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Seems that these are the appropriate lines in \
code:&lt;br&gt;&lt;br&gt;258   S_HOST=`"$CERTOOL" -i --infile \
"$LIBVIRT/servercert.pem" | grep Subject: | sed 's+.*CN=\([a-zA-Z\. \
_-]*\)+\1+'`&lt;br&gt;259   if test "$S_HOST" != "`hostname -s`" \
&amp;&amp; test "$S_HOST" != "`hostname`"&lt;br&gt;&lt;/div&gt; \
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20171212153417</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-12-12 15:34:17-0400</timestampReceived><subject>Re: [libvirt-users] Inter Shared Memory ( Ivshmem ) : Cannot Bind</subject><body>

On Mon, Dec 11, 2017 at 03:03:34PM +0800, Rogue S.T wrote:
&gt; Hello, friends.
&gt; I encounter a problem when i use ivshmem with my guest, my ivshmem server is not \
&gt; start, and output a error : Example code, do not use in production ,cannot bind. 
&gt; 
&gt; Detail distribution:
&gt; Today, I know ivshmem from a topic "QEMU version 2.10.93 User Documentation",
&gt; Ivshmem: it can create a shared memory that guest device use, so we can use this \
&gt; memory to do something ourselves. First, I create host memory backend:
&gt; -object memory-backend-file,size=1M,share,mem-path=/dev/shm/ivshmem,id=hostmem
&gt; Twice, Bind a shared memory device to my guest:
&gt; -device ivshmem-plain,memdev=hostmem

You are using plain, but

&gt; Then I boot ivshmem servi
&gt; ivshmem-server -p /var/run/ivshmem-server.pid  -S /tmp/ivshmem_socket  -M ivshmem \
&gt; -m /dev/shm -l 1M -n 2

You are running a server.  This is not how it works.

Looks like you are playing with something that you don't really need, otherwise
you would do things differetly.  It you are just trying it out, that's fine.
Otherwise make sure it's what you need.  More information on how this hot mess
works is here:

https://git.qemu.org/?p=qemu.git;a=blob;f=docs/specs/ivshmem-spec.txt

&gt; Next time i get this error:
&gt; *** Example code, do not use in production ***
&gt; cannot bind
&gt; And i search the problem on google, but nothing to get, hope you can help me solve \
&gt; it. following message is my host environment:
&gt; host:  ubuntu 1604
&gt; qemu:  version 2.10.90 (v2.11.0-rc0-dirty)
&gt; libvirt:  libvirtd (libvirt) 3.9.0
&gt; guest:    window 7 professor
&gt; 
&gt; 
&gt; Refer:
&gt; https://qemu.weilnetz.de/doc/qemu-doc.html#Inter_002dVM-Shared-Memory-device (topic \
&gt; qemu documention) https://helpmanual.io/help/ivshmem-server/  ( how to use \
&gt; ivshmem-server )

&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users


</body></email><email><emailId>20171213220316</emailId><senderName>ooth suresh</senderName><senderEmail>ooth.suresh@gmail.com</senderEmail><timestampReceived>2017-12-13 22:03:16-0400</timestampReceived><subject>[libvirt-users] libvirt-lxc nested containers</subject><body>

Hi,

I am using libvirt to launch lxc containers. I would like to know if I can
spawn nested container using libvirt-lxc.

Is it supported ? Can some please shed some light on this ? Any pointers
will be very helpful.

Thanks
Suresh S



‌

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;img width="0" height="0" class="mailtrack-img" alt="" \
style="display:flex" \
src="https://mailtrack.io/trace/mail/dc77c5128f20b64a8af4b8c0f6c7ed5c71834cfe.png?u=79716"&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I \
am using libvirt to launch lxc containers. I would like to know if I can spawn nested \
container using libvirt-lxc.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Is it supported ? Can some \
please shed some light on this ? Any pointers will be very \
helpful.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&lt;/div&gt;&lt;div&gt;Suresh \
S&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;‌&lt;/div&gt;



</body></email><email><emailId>20171221024057</emailId><senderName>"Rogue S.T"</senderName><senderEmail>15700157322@163.com</senderEmail><timestampReceived>2017-12-21 02:40:57-0400</timestampReceived><subject>[libvirt-users] Cannot Write xvga=yes in xml file</subject><body>

[Attachment #2 (text/plain)]

Hello,my system info:
    virsh verison
    Compiled against library: libvirt 3.9.0
    Using library: libvirt 3.9.0 
    Using API: QEMU 3.9.0
    Running hypervisor: QEMU 2.10.90
And i want to pass through my gpu to my window 7 guest with &lt;hostdev&gt;, next line is \
comand i use:  &lt;hostdev mode='subsystem' type='pci' managed='yes' xvga='yes'&gt;
      &lt;source&gt;
        &lt;address domain='0x0000' bus='0x01' slot='0x00' function='0x0'/&gt;
      &lt;/source&gt;
      &lt;rom bar='on' file='/root/gpu.dump'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x07' function='0x0'/&gt;
    &lt;/hostdev&gt;
But i get this error: 
        XML document failed to validate against schema: Unable to validate doc \
against /ocl/share/libvirt/schemas/domain.rng  Extra element devices in interleave
        Element domain failed to validate content
If i delete xvga='yes',it's ok, but i get a other question, my display is not light.
        


[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div&gt;Hello,my \
system info:&lt;/div&gt;&lt;div&gt;    virsh verison&lt;/div&gt;&lt;div&gt;&lt;div&gt;    \
Compiled against library: libvirt 3.9.0&lt;/div&gt;&lt;div&gt;    Using library: \
libvirt 3.9.0 &lt;/div&gt;&lt;div&gt;    Using API: QEMU 3.9.0&lt;/div&gt;&lt;div&gt;  \
  Running hypervisor: QEMU 2.10.90&lt;/div&gt;&lt;/div&gt;&lt;div&gt;And i want to pass through my \
gpu to my window 7 guest with &lt;hostdev&gt;, next line is comand i \
use:&lt;/div&gt;&lt;div&gt;     &lt;hostdev mode='subsystem' type='pci' \
managed='yes' xvga='yes'&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;source&gt;&lt;/div&gt;&lt;div&gt;        &lt;address domain='0x0000' \
bus='0x01' slot='0x00' function='0x0'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/source&gt;&lt;/div&gt;&lt;div&gt;      &lt;rom bar='on' \
file='/root/gpu.dump'/&gt;&lt;/div&gt;&lt;div&gt;      &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x07' function='0x0'/&gt;&lt;/div&gt;&lt;div&gt;    \
&lt;/hostdev&gt;&lt;/div&gt;&lt;div&gt;But i get this error: &lt;/div&gt;&lt;div&gt;      \
  XML document failed to validate against schema: Unable to validate doc against \
/ocl/share/libvirt/schemas/domain.rng&lt;/div&gt;&lt;div&gt;        Extra \
element devices in interleave&lt;/div&gt;&lt;div&gt;        Element domain \
failed to validate content&lt;/div&gt;&lt;div&gt;If i delete xvga='yes',it's ok, but i get a \
other question, my display is not light.&lt;/div&gt;&lt;div&gt;      \
  &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;span \
title="neteasefooter"&gt;&lt;p&gt;&lt;br/&gt; &lt;/p&gt;&lt;/span&gt;



</body></email><email><emailId>20171223070852</emailId><senderName>Bao Nguyen</senderName><senderEmail>baondt@gmail.com</senderEmail><timestampReceived>2017-12-23 07:08:52-0400</timestampReceived><subject>[libvirt-users] Question about disabling UFO on guest</subject><body>

Hello everyone,

I would like to ask a question regarding to disable UFO of virtio vNIC in
my guest. I have read the document at https://libvirt.org/formatdomain.html


*host*

The csum, gso, tso4, tso6, ecn and ufo attributes with possible
values on and off can be used to turn off host offloading options. By
default, the supported offloads are enabled by QEMU. *Since 1.2.9 (QEMU
only)* The mrg_rxbuf attribute can be used to control mergeable rx buffers
on the host side. Possible values are on (default) and off. *Since 1.2.13
(QEMU only)*

*guest*

The csum, tso4, tso6, ecn and ufo attributes with possible
values on and off can be used to turn off guest offloading options. By
default, the supported offloads are enabl

ed by QEMU.
*Since 1.2.9 (QEMU only)*


Then I disabled UFO on my vNIC on guest as the following configuration

&lt;devices&gt;

  &lt;interface type='network'&gt;

    &lt;source network='default'/&gt;

    &lt;target dev='vnet1'/&gt;

    &lt;model type='virtio'/&gt;

    &lt;driver name='vhost' txmode='iothread' ioeventfd='on' event_idx='off'
queues='5' rx_queue_size='256' tx_queue_size='256'&gt;

      *&lt;host gso='off' ufo='off' /&gt;*

      *&lt;guest ufo='off'/&gt;*

    &lt;/driver&gt;



  &lt;/interface&gt;

&lt;/devices&gt;


Then I reboot my node to get the change effect and it works. However, can I
disable the UFO without touching the host OS? or it always has to disable
on both host and guest like that?


Thanks,

Brs,

Natsu

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;Hello everyone,&lt;br&gt;&lt;br&gt;&lt;/div&gt;I would like to ask a question \
regarding to disable UFO of virtio vNIC in my guest. I have read the document at  &lt;a \
href="https://libvirt.org/formatdomain.html" class="external-link" rel="nofollow" \
style="color:rgb(59,115,175);text-decoration:none"&gt;https://libvirt.org/formatdomain.html&lt;/a&gt; \
&lt;p style="margin:10px 0px 0px"&gt;&lt;br&gt;&lt;/p&gt; &lt;p style="margin:10px 0px \
0px"&gt;&lt;b&gt;host&lt;/b&gt;&lt;/p&gt; &lt;p style="margin:10px 0px 0px"&gt;The  csum,  gso,  tso4,  tso6,  \
ecn  and  ufo  attributes  with possible values  on  and  off  can be used to turn \
off host offloading  options. By default, the supported offloads are enabled by QEMU. \
&lt;b&gt;&lt;em&gt;Since 1.2.9 (QEMU only)&lt;/em&gt;&lt;/b&gt;  The  mrg_rxbuf  attribute  can be used to \
control mergeable rx buffers on the host side. Possible  values are  on  (default) \
and  off.  &lt;b&gt;&lt;em&gt;Since 1.2.13 (QEMU only)&lt;/em&gt;&lt;/b&gt;&lt;/p&gt; &lt;p style="margin:10px 0px \
0px"&gt;&lt;b&gt;guest&lt;/b&gt;&lt;/p&gt; &lt;p style="margin:10px 0px 0px"&gt;The  csum,  tso4,  tso6,  ecn  \
and  ufo  attributes  with possible values  on  and  off  can be used to turn off \
guest  offloading options. By default, the supported offloads are enabl&lt;/p&gt;&lt;p \
style="margin:10px 0px 0px"&gt;ed by  QEMU.  &lt;b&gt;&lt;em&gt;Since 1.2.9 (QEMU \
only)&lt;br&gt;&lt;/em&gt;&lt;/b&gt;&lt;/p&gt;&lt;p style="margin:10px 0px 0px"&gt;&lt;em&gt;&lt;/em&gt;&lt;br&gt;&lt;/p&gt;&lt;p \
style="margin:10px 0px 0px"&gt;Then I disabled UFO on my vNIC on guest as the following \
configuration&lt;br&gt;&lt;/p&gt;&lt;p style="margin:10px 0px 0px"&gt;&lt;devices&gt;&lt;/p&gt; &lt;p \
style="margin:10px 0px 0px"&gt;   &lt;interface type='network'&gt;&lt;/p&gt; &lt;p \
style="margin:10px 0px 0px"&gt;       &lt;source network='default'/&gt;&lt;/p&gt; &lt;p \
style="margin:10px 0px 0px"&gt;       &lt;target dev='vnet1'/&gt;&lt;/p&gt; &lt;p \
style="margin:10px 0px 0px"&gt;       &lt;model type='virtio'/&gt;&lt;/p&gt; &lt;p \
style="margin:10px 0px 0px"&gt;        &lt;driver name='vhost' \
txmode='iothread' ioeventfd='on'  event_idx='off' \
queues='5' rx_queue_size='256' tx_queue_size='256'&gt;&lt;/p&gt; &lt;p \
style="margin:10px 0px 0px"&gt;           &lt;b&gt;&lt;host gso='off' \
ufo='off' /&gt;&lt;/b&gt;&lt;/p&gt; &lt;p style="margin:10px 0px 0px"&gt;           \
&lt;b&gt;&lt;guest ufo='off'/&gt;&lt;/b&gt;&lt;/p&gt; &lt;p style="margin:10px 0px 0px"&gt;       \
&lt;/driver&gt;&lt;/p&gt; &lt;p style="margin:10px 0px 0px"&gt;      &lt;/p&gt; &lt;p style="margin:10px \
0px 0px"&gt;    &lt;/interface&gt;&lt;/p&gt; &lt;p style="margin:10px 0px \
0px"&gt;&lt;/devices&gt;&lt;/p&gt;&lt;p style="margin:10px 0px 0px"&gt;&lt;br&gt;&lt;/p&gt;&lt;p style="margin:10px \
0px 0px"&gt;Then I reboot my node to get the change effect and it works. However, can I \
disable the UFO without touching the host OS? or it always has to disable on both \
host and guest like that?&lt;/p&gt;&lt;p style="margin:10px 0px 0px"&gt;&lt;br&gt;&lt;/p&gt;&lt;p \
style="margin:10px 0px 0px"&gt;Thanks,&lt;/p&gt;&lt;p style="margin:10px 0px 0px"&gt;Brs,&lt;/p&gt;&lt;p \
style="margin:10px 0px 0px"&gt;Natsu&lt;br&gt;&lt;/p&gt;&lt;p style="margin:10px 0px 0px"&gt;&lt;br&gt;&lt;/p&gt;&lt;p \
style="margin:10px 0px 0px"&gt; &lt;/p&gt;&lt;/div&gt;



</body></email><email><emailId>20171224091327</emailId><senderName>Priyanka Gupta</senderName><senderEmail>priyanka.gupta1687@gmail.com</senderEmail><timestampReceived>2017-12-24 09:13:27-0400</timestampReceived><subject>[libvirt-users] Libvirt not terminating SSH processes</subject><body>

Hi LibVirt team,

I am facing an issue with libvert. I am closing a "qemu+ssh" connection but
the initiated ssh process are going into sleep mode and not getting killed
upon closing the connection. Can you please help me figure out the issue ?

-- 
With Kind Regards
Priyanka Gupta

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;span style="color:rgb(0,0,0);font-family:Arial,Lato,"Titillium \
Web",sans-serif;font-size:13.5px"&gt;Hi LibVirt team,  &lt;/span&gt;&lt;div&gt;&lt;span \
style="color:rgb(0,0,0);font-family:Arial,Lato,"Titillium \
Web",sans-serif;font-size:13.5px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="color:rgb(0,0,0);font-family:Arial,Lato,"Titillium \
Web",sans-serif;font-size:13.5px"&gt;I am facing an issue with libvert. I am \
closing a "qemu+ssh" connection but the initiated ssh process are going \
into sleep mode and not getting killed upon closing the connection. Can you please \
help me figure out the issue ?&lt;/span&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- &lt;br&gt;&lt;div \
class="gmail_signature"&gt;With Kind Regards&lt;br&gt;Priyanka Gupta&lt;br&gt;&lt;br&gt;&lt;/div&gt; \
&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20171206134447</emailId><senderName>Yalan Zhang</senderName><senderEmail>yalzhang@redhat.com</senderEmail><timestampReceived>2017-12-06 13:44:47-0400</timestampReceived><subject>[libvirt-users]  problem when use tls to connect libvirt</subject><body>

Hi guys,

I met a problem when I use tls to connect libvirt.
When I set the CN in client.info, server.info as hostname(FDQN), the tls
check will fail with ip; and vice versa, when set CN as ip address, the tls
check will fail with hostname. Only use what we set in can succeed. If this
is expected? or I there was some issue in my env. or setup steps?


1. set tls env with hostname, then it will fail to check with ip

# virsh -c qemu+tls://192.168.122.4/system
2017-12-06 13:24:52.346+0000: 3954: info : libvirt version: x.x.x, package:
4.el7 (Red Hat, Inc. &lt;http://bugzilla.redhat.com/bugzilla&gt;,
2017-11-30-07:57:27, x.x.x.redhat.com)
2017-12-06 13:24:52.346+0000: 3954: info : hostname: work.englab.cn
2017-12-06 13:24:52.346+0000: 3954: warning :
virNetTLSContextCheckCertificate:1125 : Certificate check failed
Certificate [session] owner does not match the hostname 192.168.122.4
error: failed to connect to the hypervisor
error: authentication failed: Failed to verify peer's certificate

2. use the hostname as what we set can succeed.

# virsh -c qemu+tls://test.englab.cn/system
Welcome to virsh, the virtualization interactive terminal.

Type:  'help' for help with commands
       'quit' to quit

virsh #


# ping test.englab.cn
PING test.englab.cn (192.168.122.4) 56(84) bytes of data.
64 bytes from test.englab.cn (192.168.122.4): icmp_seq=1 ttl=64 time=0.235
ms
64 bytes from test.englab.cn (192.168.122.4): icmp_seq=2 ttl=64 time=0.204
ms
...



-------
Best Regards,
Yalan Zhang

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi guys,&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="gmail_signature"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_signature"&gt;I met a problem when I \
use tls to connect libvirt.  &lt;/div&gt;&lt;div class="gmail_signature"&gt;When I set the CN in \
&lt;a href="http://client.info"&gt;client.info&lt;/a&gt;, &lt;a \
href="http://server.info"&gt;server.info&lt;/a&gt; as hostname(FDQN), the tls check will fail \
with ip; and  vice versa, when set CN as ip address, the tls check will fail with \
hostname. Only use what we set in can succeed. If this is expected? or I there was \
some issue in my env. or setup steps?&lt;/div&gt;&lt;div \
class="gmail_signature"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_signature"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_signature"&gt;1. set tls env with hostname, then it will fail to check with \
ip&lt;/div&gt;&lt;div class="gmail_signature"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_signature"&gt;&lt;div \
class="gmail_signature"&gt;# virsh -c qemu+tls://&lt;a \
href="http://192.168.122.4/system"&gt;192.168.122.4/system&lt;/a&gt;&lt;/div&gt;&lt;div \
class="gmail_signature"&gt;2017-12-06 13:24:52.346+0000: 3954: info : libvirt version: \
x.x.x, package: 4.el7 (Red Hat, Inc. &lt;&lt;a \
href="http://bugzilla.redhat.com/bugzilla"&gt;http://bugzilla.redhat.com/bugzilla&lt;/a&gt;&gt;, \
2017-11-30-07:57:27, &lt;a \
href="http://x.x.x.redhat.com"&gt;x.x.x.redhat.com&lt;/a&gt;)&lt;/div&gt;&lt;div \
class="gmail_signature"&gt;2017-12-06 13:24:52.346+0000: 3954: info : hostname: &lt;a \
href="http://work.englab.cn"&gt;work.englab.cn&lt;/a&gt;&lt;/div&gt;&lt;div \
class="gmail_signature"&gt;2017-12-06 13:24:52.346+0000: 3954: warning : \
virNetTLSContextCheckCertificate:1125 : Certificate check failed Certificate \
[session] owner does not match the hostname 192.168.122.4&lt;/div&gt;&lt;div \
class="gmail_signature"&gt;error: failed to connect to the hypervisor&lt;/div&gt;&lt;div \
class="gmail_signature"&gt;error: authentication failed: Failed to verify peer's \
certificate&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2. use the hostname as what we set can \
succeed.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# virsh -c qemu+tls://&lt;a \
href="http://test.englab.cn/system"&gt;test.englab.cn/system&lt;/a&gt;&lt;/div&gt;&lt;div&gt;Welcome to \
virsh, the virtualization interactive terminal.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Type:   \
'help' for help with commands&lt;/div&gt;&lt;div&gt;           'quit' to \
quit&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;virsh #  \
&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# ping &lt;a \
href="http://test.englab.cn"&gt;test.englab.cn&lt;/a&gt;&lt;/div&gt;&lt;div&gt;PING &lt;a \
href="http://test.englab.cn"&gt;test.englab.cn&lt;/a&gt; (192.168.122.4) 56(84) bytes of \
data.&lt;/div&gt;&lt;div&gt;64 bytes from &lt;a href="http://test.englab.cn"&gt;test.englab.cn&lt;/a&gt; \
(192.168.122.4): icmp_seq=1 ttl=64 time=0.235 ms&lt;/div&gt;&lt;div&gt;64 bytes from &lt;a \
href="http://test.englab.cn"&gt;test.englab.cn&lt;/a&gt; (192.168.122.4): icmp_seq=2 ttl=64 \
time=0.204 ms&lt;/div&gt;&lt;/div&gt;&lt;div&gt;...&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_signature"&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;-------&lt;br&gt;Best Regards,&lt;br&gt;Yalan \
Zhang&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;



</body></email><email><emailId>20171227191544</emailId><senderName>Radostin Stoyanov</senderName><senderEmail>rstoyanov1@gmail.com</senderEmail><timestampReceived>2017-12-27 19:15:44-0400</timestampReceived><subject>Re: [libvirt-users] libvirt net xml format</subject><body>

Hi

I know that this is not you question but is it possible to set
"no-hosts" in /etc/dnsmasq.conf ?

On 27/12/17 16:24, Bhasker C V wrote:
&gt; Hi all,
&gt;  I went through the docs but could not find a way to pass the
&gt; -h OR --no-hosts
&gt; option to dnsmasq via libvirt xml
&gt;
&gt; Is there a way to do this via xml ? please can someone help.
&gt;
&gt; Thanks
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users


[Attachment #3 (text/html)]

&lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
  &lt;/head&gt;
  &lt;body text="#000000" bgcolor="#FFFFFF"&gt;
    &lt;font face="Helvetica, Arial, sans-serif"&gt;Hi&lt;br&gt;
      &lt;br&gt;
      I know that this is not you question but is it possible to set
      "no-hosts" in /etc/dnsmasq.conf ?&lt;br&gt;
    &lt;/font&gt;&lt;br&gt;
    &lt;div class="moz-cite-prefix"&gt;On 27/12/17 16:24, Bhasker C V wrote:&lt;br&gt;
    &lt;/div&gt;
    &lt;blockquote type="cite"
cite="mid:CAPLCSGAxz3+ejHYVKyCjUTSkYtEBW2TXz5t3Pn=Q0UR+YEXW1w@mail.gmail.com"&gt;
      &lt;pre wrap=""&gt;Hi all,
 I went through the docs but could not find a way to pass the
-h OR --no-hosts
option to dnsmasq via libvirt xml

Is there a way to do this via xml ? please can someone help.

Thanks

_______________________________________________
libvirt-users mailing list
&lt;a class="moz-txt-link-abbreviated" \
href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt; &lt;a \
class="moz-txt-link-freetext" \
href="https://www.redhat.com/mailman/listinfo/libvirt-users"&gt;https://www.redhat.com/mailman/listinfo/libvirt-users&lt;/a&gt;
 &lt;/pre&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
  &lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20171207045749</emailId><senderName>scar</senderName><senderEmail>scar@drigon.com</senderEmail><timestampReceived>2017-12-07 04:57:49-0400</timestampReceived><subject>[libvirt-users] public IP for VM</subject><body>

I can't seem to figure out how to setup a public IP for the VM so we 
could use it as a second public webserver.  The host machine runs our 
primary webserver with CentOS 6.9 and one public ipv4 address configured 
on physical interface eth0.  Now i have configured a new bridge 
interface br0:
DEVICE=br0
TYPE=Bridge
BOOTPROTO=static

The IP settings are for a second public ipv4 address in the same 
network.  Now i setup the VM to use br0 for the NIC and set the same IP 
settings inside the VM... but it doesn't work.  The VM can't resolve any 
hosts, and if i try to ssh to the second public IP, it just sends me to 
the host machine instead of the VM.

</body></email><email><emailId>20171210160331</emailId><senderName>Anastasiya Ruzhanskaya</senderName><senderEmail>anastasiya.ruzhanskaya@frtk.ru</senderEmail><timestampReceived>2017-12-10 16:03:31-0400</timestampReceived><subject>[libvirt-users] libvirt error messages</subject><body>

Hello,
I am experimenting with libvirt for my diploma. I set up an environment,
where I can stop, resend, generate messages for libvirt.
I am capable also standing between client and server and analyze the number
of current procedure and decide what to do next ( I mean rpc procedure).

So, for example I want to always drop creating snapshots and send an error
to client with my custom message (NOT custom error type, but exactly custom
message, I don't want to modify any libvirt code on client and adding my
errors). I am operating with bare tcp traffic, so I can easily read
everything in the middle.

So,  I noticed one error for libvirt snapshots:
'internal error: unexpected domain snapshot snapshot1 already exists'
and started sending it every time I see procedure :
REMOTE_PROC_DOMAIN_SNAPSHOT_CREATE_XML

I thought, that this is possible to insert custom message here, but this is
not true. When I change the length of the message on one symbol - it is
still correct, on two -also , on three symbols - I get an error that the
size of the payload is incorrect. Some other errors when I insert a message
of random length.

What is strange, that if I insert 'xxxxxxxxxxxxx...' message , which has
the same length as 'internal error: unexpected domain snapshot snapshot1
already exists' - everything is parsed fine.


So, how does this stuff work? Are there anywhere predefined lengths for
error messages and checks against them, or are there checks against exact
error strings? How all this stuff is regulated? I know now, that I can pad
my message with ...say, space symbols and it will be ok, but I want to know
how error parsing works in all cases.


I have looked through files, where an overall structure and logic of errors
is described but didn't find any helpful information. And I don't a good
way to debug libvirt to see, where this happens.

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hello,&lt;br&gt;&lt;/div&gt;I am experimenting with libvirt \
for my diploma. I set up an environment, where I can stop, resend, generate messages \
for libvirt. &lt;br&gt;&lt;/div&gt;I am capable also standing between client and server and \
analyze the number of current procedure and decide what to do next ( I mean rpc \
procedure).&lt;br&gt;&lt;br&gt;&lt;/div&gt;So, for example I want to always drop creating snapshots and \
send an error to client with my custom message (NOT custom error type, but exactly \
custom message, I don't want to modify any libvirt code on client and adding my \
errors). I am operating with bare tcp traffic, so I can easily read everything in the \
middle. &lt;br&gt;&lt;br&gt;&lt;/div&gt;So,   I noticed one error for libvirt \
snapshots:&lt;br&gt;&lt;div&gt;'internal error: unexpected domain snapshot snapshot1 already \
exists'&lt;/div&gt;&lt;div&gt;and started sending it every time I see procedure : \
REMOTE_PROC_DOMAIN_SNAPSHOT_CREATE_XML&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I thought, that this \
is possible to insert custom message here, but this is not true. When I change the \
length of the message on one symbol - it is still correct, on two -also , on three \
symbols - I get an error that the size of the payload is incorrect. Some other errors \
when I insert a message of random length. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What is \
strange, that if I insert 'xxxxxxxxxxxxx...' message , which has the same \
length as 'internal error: unexpected domain snapshot snapshot1 already \
exists' - everything is parsed fine.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So, \
how does this stuff work? Are there anywhere predefined lengths for error messages \
and checks against them, or are there checks against exact error strings? How all \
this stuff is regulated? I know now, that I can pad my message with ...say, space \
symbols and it will be ok, but I want to know how error parsing works in all cases. \
&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I have looked through files, where an \
overall structure and logic of errors is described but didn't find any helpful \
information. And I don't a good way to debug libvirt to see, where this \
happens.&lt;br&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20171210195732</emailId><senderName>Anastasiya Ruzhanskaya</senderName><senderEmail>anastasiya.ruzhanskaya@frtk.ru</senderEmail><timestampReceived>2017-12-10 19:57:32-0400</timestampReceived><subject>[libvirt-users] libvirt authentication</subject><body>

Hello,
I am currently trying to install certificates for tls. By this time I have
got some questions:
1) Is documentation in the web docs up-to-date regarding tls server,
client, ca certificates? (actually I have some problems, but maybe this is
due to smth has changed in certtools and was not updated in docs, perhaps
some more fields are needed now).
2) there is a error in virt-pki-validate :
when determining whether host name matches CN name you assume, that CN is
standing in the end. So I get an error:

The server certificate does not seem to match the host name
hostname: "barni"
Server certificate CN: "barni,O=libvirt.org"

CN field is standing at the beginning of line.

Seems that these are the appropriate lines in code:

258  S_HOST=`"$CERTOOL" -i --infile "$LIBVIRT/servercert.pem" | grep
Subject: | sed 's+.*CN=\([a-zA-Z\. _-]*\)+\1+'`
259  if test "$S_HOST" != "`hostname -s`" &amp;&amp; test "$S_HOST" != "`hostname`"

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hello,&lt;br&gt;&lt;/div&gt;I am currently trying to \
install certificates for tls. By this time I have got some questions:&lt;br&gt;&lt;/div&gt;1) Is \
documentation in the web docs up-to-date regarding tls server, client, ca \
certificates? (actually I have some problems, but maybe this is due to smth has \
changed in certtools and was not updated in docs, perhaps some more fields are needed \
now). &lt;br&gt;&lt;/div&gt;2) there is a error in virt-pki-validate :&lt;br&gt;&lt;/div&gt;when determining \
whether host name matches CN name you assume, that CN is standing in the end. So I \
get an error:&lt;br&gt;&lt;br&gt;The server certificate does not seem to match the host \
name&lt;br&gt;hostname: "barni"&lt;br&gt;Server certificate CN: "barni,O=&lt;a \
href="http://libvirt.org"&gt;libvirt.org&lt;/a&gt;"&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;CN field is \
standing at the beginning of line.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Seems that these are the appropriate \
lines in code:&lt;br&gt;&lt;br&gt;258   S_HOST=`"$CERTOOL" -i --infile \
"$LIBVIRT/servercert.pem" | grep Subject: | sed 's+.*CN=\([a-zA-Z\. \
_-]*\)+\1+'`&lt;br&gt;259   if test "$S_HOST" != "`hostname -s`" \
&amp;&amp; test "$S_HOST" != "`hostname`"&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20171211070334</emailId><senderName>"Rogue S.T"</senderName><senderEmail>15700157322@163.com</senderEmail><timestampReceived>2017-12-11 07:03:34-0400</timestampReceived><subject>[libvirt-users] Inter Shared Memory ( Ivshmem ) : Cannot Bind</subject><body>

[Attachment #2 (text/plain)]

Hello, friends.
I encounter a problem when i use ivshmem with my guest, my ivshmem server is not \
start, and output a error : Example code, do not use in production ,cannot bind.


Detail distribution: 
Today, I know ivshmem from a topic "QEMU version 2.10.93 User Documentation", 
Ivshmem: it can create a shared memory that guest device use, so we can use this \
memory to do something ourselves. First, I create host memory backend:
     -object memory-backend-file,size=1M,share,mem-path=/dev/shm/ivshmem,id=hostmem
Twice, Bind a shared memory device to my guest:
    -device ivshmem-plain,memdev=hostmem
Then I boot ivshmem servi
    ivshmem-server -p /var/run/ivshmem-server.pid  -S /tmp/ivshmem_socket  -M ivshmem \
-m /dev/shm -l 1M -n 2 Next time i get this error:
    *** Example code, do not use in production ***
    cannot bind
And i search the problem on google, but nothing to get, hope you can help me solve \
it. following message is my host environment:
    host:  ubuntu 1604
    qemu:  version 2.10.90 (v2.11.0-rc0-dirty)
    libvirt:  libvirtd (libvirt) 3.9.0
    guest:    window 7 professor


Refer:
    https://qemu.weilnetz.de/doc/qemu-doc.html#Inter_002dVM-Shared-Memory-device \
(topic qemu documention)  https://helpmanual.io/help/ivshmem-server/  ( how to use \
ivshmem-server )


[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div&gt;Hello, \
friends.&lt;/div&gt;&lt;div&gt;I encounter a problem when i use ivshmem with my guest, my ivshmem \
server is not start, and output a error : Example code, do not use in production \
,cannot bind.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Detail distribution: &lt;/div&gt;&lt;div&gt;Today, I \
know ivshmem from a topic "QEMU version 2.10.93 User \
Documentation", &lt;/div&gt;&lt;div&gt;Ivshmem: it can create a shared memory that guest \
device use, so we can use this memory to do something ourselves.&lt;/div&gt;&lt;div&gt;First, I \
create host memory backend:&lt;/div&gt;&lt;div&gt;     -object \
memory-backend-file,size=1M,share,mem-path=/dev/shm/ivshmem,id=hostmem&lt;/div&gt;&lt;div&gt;Twice, \
Bind a shared memory device to my guest:&lt;/div&gt;&lt;div&gt;    \
-device ivshmem-plain,memdev=hostmem&lt;/div&gt;&lt;div&gt;Then I boot ivshmem \
servi&lt;/div&gt;&lt;div&gt;    ivshmem-server -p \
/var/run/ivshmem-server.pid  -S /tmp/ivshmem_socket  -M ivshmem -m /dev/shm \
-l 1M -n 2&lt;/div&gt;&lt;div&gt;Next time i get this error:&lt;/div&gt;&lt;div&gt;  &lt;span style="color: \
rgb(255, 0, 0);"&gt;  *** Example code, do not use in production \
***&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="color: rgb(255, 0, 0);"&gt;    cannot \
bind&lt;/span&gt;&lt;/div&gt;&lt;div&gt;And i search the problem on google, but nothing to get, hope \
you can help me solve it.&lt;/div&gt;&lt;div&gt;following message is my host \
environment:&lt;/div&gt;&lt;div&gt;    host:  ubuntu 1604&lt;/div&gt;&lt;div&gt;    \
qemu:  version 2.10.90 (v2.11.0-rc0-dirty)&lt;/div&gt;&lt;div&gt;    \
libvirt:  libvirtd (libvirt) 3.9.0&lt;/div&gt;&lt;div&gt;    guest:  \
  window 7 professor&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Refer:&lt;/div&gt;&lt;div&gt;  \
  &lt;a href="https://qemu.weilnetz.de/doc/qemu-doc.html#Inter_002dVM-Shared-Memory-device" \
_src="https://qemu.weilnetz.de/doc/qemu-doc.html#Inter_002dVM-Shared-Memory-device"&gt;ht \
tps://qemu.weilnetz.de/doc/qemu-doc.html#Inter_002dVM-Shared-Memory-device&lt;/a&gt; (topic \
qemu documention)&lt;/div&gt;&lt;div&gt;    &lt;a \
href="https://helpmanual.io/help/ivshmem-server/" \
_src="https://helpmanual.io/help/ivshmem-server/"&gt;https://helpmanual.io/help/ivshmem-server/&lt;/a&gt;  \
( how to use ivshmem-server )&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;span \
title="neteasefooter"&gt;&lt;p&gt;&lt;br/&gt; &lt;/p&gt;&lt;/span&gt;



</body></email><email><emailId>20171207053608</emailId><senderName>Chandler</senderName><senderEmail>admin@genome.arizona.edu</senderEmail><timestampReceived>2017-12-07 05:36:08-0400</timestampReceived><subject>[libvirt-users] public IP for VM</subject><body>

I can't seem to figure out how to setup a public IP for the VM so we 
could use it as a second public webserver.  The host machine runs our 
primary webserver with CentOS 6.9 and one public ipv4 address configured 
on physical interface eth0.  Now i have configured a new bridge 
interface br0:
DEVICE=br0
TYPE=Bridge
BOOTPROTO=static

The IP settings are for a second public ipv4 address in the same 
network.  Now i setup the VM to use br0 for the NIC and set the same IP 
settings inside the VM... but it doesn't work.  The VM can't resolve any 
hosts, and if i try to ssh to the second public IP, it just sends me to 
the host machine instead of the VM.  I read the Bridged Networking 
section but it seems to want to set br0 to the public IP and not use 
eth0.  I want to use two public IP's over the same shared phys 
interface, eth0 with our first IP and br0 with the second IP for the 
VM... or another similar configuration that will have the same effect.
Thanks

</body></email><email><emailId>20171207075231</emailId><senderName>Tony Brian Albers</senderName><senderEmail>tba@kb.dk</senderEmail><timestampReceived>2017-12-07 07:52:31-0400</timestampReceived><subject>Re: [libvirt-users] public IP for VM</subject><body>

On 12/07/2017 05:57 AM, scar wrote:
&gt; I can't seem to figure out how to setup a public IP for the VM so we 
&gt; could use it as a second public webserver.  The host machine runs our 
&gt; primary webserver with CentOS 6.9 and one public ipv4 address configured 
&gt; on physical interface eth0.  Now i have configured a new bridge 
&gt; interface br0:
&gt; DEVICE=br0
&gt; TYPE=Bridge
&gt; BOOTPROTO=static
&gt; 
&gt; The IP settings are for a second public ipv4 address in the same 
&gt; network.  Now i setup the VM to use br0 for the NIC and set the same IP 
&gt; settings inside the VM... but it doesn't work.  The VM can't resolve any 
&gt; hosts, and if i try to ssh to the second public IP, it just sends me to 
&gt; the host machine instead of the VM.
&gt; 


Try using macvtap instead. A bridge is more like an internal 
software-based switch, it's not really a NIC.

/tony


-- 
Tony Albers
Systems administrator, IT-development
Royal Danish Library, Victor Albecks Vej 1, 8000 Aarhus C, Denmark.
Tel: +45 2566 2383 / +45 8946 2316

</body></email><email><emailId>20171207120210</emailId><senderName>Sam Varshavchik</senderName><senderEmail>mrsam@courier-mta.com</senderEmail><timestampReceived>2017-12-07 12:02:10-0400</timestampReceived><subject>Re: [libvirt-users] public IP for VM</subject><body>


scar writes:

&gt; I can't seem to figure out how to setup a public IP for the VM so we could  
&gt; use it as a second public webserver.  The host machine runs our primary  
&gt; webserver with CentOS 6.9 and one public ipv4 address configured on physical  
&gt; interface eth0.  Now i have configured a new bridge interface br0:
&gt; DEVICE=br0
&gt; TYPE=Bridge
&gt; BOOTPROTO=static
&gt;
&gt; The IP settings are for a second public ipv4 address in the same network.   
&gt; Now i setup the VM to use br0 for the NIC and set the same IP settings  
&gt; inside the VM... but it doesn't work.  The VM can't resolve any hosts, and  
&gt; if i try to ssh to the second public IP, it just sends me to the host  
&gt; machine instead of the VM.

Do you have

BRIDGE=br0

In the ifcfg file for your host's network interface, with only its first,  
primary, IP address? Also my bridge configuration has ONBOOT=yes




[Attachment #3 (application/pgp-signature)]

</body></email><email><emailId>20171227162430</emailId><senderName>Bhasker C V</senderName><senderEmail>bhasker@unixindia.com</senderEmail><timestampReceived>2017-12-27 16:24:30-0400</timestampReceived><subject>[libvirt-users] libvirt net xml format</subject><body>

Hi all,
 I went through the docs but could not find a way to pass the
-h OR --no-hosts
option to dnsmasq via libvirt xml

Is there a way to do this via xml ? please can someone help.

Thanks

</body></email><email><emailId>20171222085233</emailId><senderName>Holger Schranz</senderName><senderEmail>holger@fam-schranz.de</senderEmail><timestampReceived>2017-12-22 08:52:33-0400</timestampReceived><subject>[libvirt-users] [BUG] Not exiting media forced a promptly close of libvirt 3.10</subject><body>

Hello,

In the .xml file I use a media which is no longer available.
In the past, I got the information media not available and the
creation of the VM was stopped - O.k. behavior.
Since 3.10 the libvirtd stopped promptly and all open
consoles windows and the virt-manager closed promptly.

For diagnose:
etcsvms1:/kvm/CS8200/M5 # coredumpctl
TIME                            PID   UID   GID SIG PRESENT EXE
Fri 2017-12-22 08:16:35 CET    7056     0     0  11 * 
/usr/local/sbin/libvirtd
Fri 2017-12-22 08:19:46 CET   10611     0     0  11 * 
/usr/local/sbin/libvirtd
Fri 2017-12-22 09:28:48 CET   10728     0     0  11 * 
/usr/local/sbin/libvirtd

etcsvms1:/kvm/CS8200/M5 # coredumpctl info libvirtd
.
.
.
            PID: 10728 (libvirtd)
            UID: 0 (root)
            GID: 0 (root)
         Signal: 11 (SEGV)
      Timestamp: Fri 2017-12-22 09:28:39 CET (15min ago)
   Command Line: /usr/local/sbin/libvirtd -d
     Executable: /usr/local/sbin/libvirtd
  Control Group: /
          Slice: -.slice
        Boot ID: 01603763bc784c7380e310d5eea124d6
     Machine ID: 89c660865c00403a9bacef32b6828556
       Hostname: etcsvms1
       Coredump: 
/var/lib/systemd/coredump/core.libvirtd.0.01603763bc784c7380e310
        Message: Process 10728 (libvirtd) of user 0 dumped core.

etcsvms1:/kvm/CS8200/M5 # coredumpctl dump libvirtd
            PID: 10728 (libvirtd)
            UID: 0 (root)
            GID: 0 (root)
         Signal: 11 (SEGV)
      Timestamp: Fri 2017-12-22 09:28:39 CET (16min ago)
   Command Line: /usr/local/sbin/libvirtd -d
     Executable: /usr/local/sbin/libvirtd
  Control Group: /
          Slice: -.slice
        Boot ID: 01603763bc784c7380e310d5eea124d6
     Machine ID: 89c660865c00403a9bacef32b6828556
       Hostname: etcsvms1
       Coredump: 
/var/lib/systemd/coredump/core.libvirtd.0.01603763bc784c7380e310d5eea124d6.10728.1513931319000000.xz
        Message: Process 10728 (libvirtd) of user 0 dumped core.
Refusing to dump core to tty.

etcsvms1:/kvm/CS8200/M5 # coredumpctl gdb libvirtd
            PID: 10728 (libvirtd)
            UID: 0 (root)
            GID: 0 (root)
         Signal: 11 (SEGV)
      Timestamp: Fri 2017-12-22 09:28:39 CET (18min ago)
   Command Line: /usr/local/sbin/libvirtd -d
     Executable: /usr/local/sbin/libvirtd
  Control Group: /
          Slice: -.slice
        Boot ID: 01603763bc784c7380e310d5eea124d6
     Machine ID: 89c660865c00403a9bacef32b6828556
       Hostname: etcsvms1
       Coredump: 
/var/lib/systemd/coredump/core.libvirtd.0.01603763bc784c7380e310d5eea124d6.10728.1513931319000000.xz
        Message: Process 10728 (libvirtd) of user 0 dumped core.

GNU gdb (GDB; openSUSE Leap 42.3) 8.0.1
Copyright (C) 2017 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later 
&lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-suse-linux".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
&lt;http://bugs.opensuse.org/&gt;.
Find the GDB manual and other documentation resources online at:
&lt;http://www.gnu.org/software/gdb/documentation/&gt;.
For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from /usr/local/sbin/libvirtd...done.
[New LWP 10729]
[New LWP 10731]
[New LWP 10733]
[New LWP 10735]
[New LWP 10732]
[New LWP 10739]
[New LWP 10730]
[New LWP 10741]
[New LWP 10743]
[New LWP 10734]
[New LWP 10736]
[New LWP 11276]
[New LWP 10737]
[New LWP 10738]
[New LWP 10728]
[New LWP 10740]
[New LWP 10751]
[New LWP 10742]
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib64/libthread_db.so.1".
Core was generated by `/usr/local/sbin/libvirtd -d'.
Program terminated with signal SIGSEGV, Segmentation fault.
#0  virStorageFileReportBrokenChain (errcode=2, 
src=src@entry=0x7f0d4004ac40, parent=0x7f0d4004ac40)
     at storage/storage_source.c:422
422         unsigned int access_user = src-&gt;drv-&gt;uid;
[Current thread is 1 (Thread 0x7f0d525ab700 (LWP 10729))]
Missing separate debuginfos, use: zypper install 
device-mapper-debuginfo-1.02.97-77.1.x86_64 
glibc-debuginfo-2.22-8.4.x86_64 krb5-debuginfo-1.12.5-12.1.x86_64 
libapparmor1-debuginfo-2.10.3-16.1.x86_64 
libavahi-client3-debuginfo-0.6.32-3.5.x86_64 
libavahi-common3-debuginfo-0.6.32-3.5.x86_64 
libblkid1-debuginfo-2.29.2-5.1.x86_64 
libcap2-debuginfo-2.22-18.16.x86_64 
libcom_err2-debuginfo-1.42.11-15.1.x86_64 
libcurl4-debuginfo-7.37.0-23.1.x86_64 
libdbus-1-3-debuginfo-1.8.22-5.1.x86_64 
libffi4-debuginfo-5.3.1+r233831-10.1.x86_64 
libgmp10-debuginfo-5.1.3-7.15.x86_64 
libgnutls28-debuginfo-3.3.27-1.5.x86_64 
libhogweed2-debuginfo-2.7.1-12.1.x86_64 
libidn11-debuginfo-1.28-8.3.x86_64 
libkeyutils1-debuginfo-1.5.9-7.13.x86_64 
libldap-2_4-2-debuginfo-2.4.44-18.1.x86_64 
liblzma5-debuginfo-5.2.2-3.15.x86_64 
libnettle4-debuginfo-2.7.1-12.1.x86_64 
libnl1-debuginfo-1.1.4-6.13.x86_64 
libopenssl1_0_0-debuginfo-1.0.2j-16.1.x86_64 
libp11-kit0-debuginfo-0.20.7-1.2.x86_64 
libpciaccess0-debuginfo-0.13.4-4.3.x86_64 
libpcre1-debuginfo-8.39-11.1.x86_64 
libsasl2-3-debuginfo-2.1.26-14.1.x86_64 
libselinux1-debuginfo-2.5-4.17.x86_64 
libssh2-1-debuginfo-1.4.3-18.3.x86_64 
libtasn1-6-debuginfo-4.9-1.2.x86_64 libudev1-debuginfo-228-38.1.x86_64 
libuuid1-debuginfo-2.29.2-5.1.x86_64 
libxml2-2-debuginfo-2.9.4-12.1.x86_64 
libyajl2-debuginfo-2.0.1-21.3.x86_64 libz1-debuginfo-1.2.8-13.15.x86_64
(gdb)

Best regards

Holger

---
Diese E-Mail wurde von Avast Antivirus-Software auf Viren geprüft.
https://www.avast.com/antivirus

</body></email><email><emailId>20171222090101</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-12-22 09:01:01-0400</timestampReceived><subject>Re: [libvirt-users] [BUG] Not exiting media forced a promptly close of libvirt 3.10</subject><body>

On Fri, Dec 22, 2017 at 09:52:33AM +0100, Holger Schranz wrote:
&gt; etcsvms1:/kvm/CS8200/M5 # coredumpctl gdb libvirtd
&gt; PID: 10728 (libvirtd)
&gt; UID: 0 (root)
&gt; GID: 0 (root)
&gt; Signal: 11 (SEGV)
&gt; Timestamp: Fri 2017-12-22 09:28:39 CET (18min ago)
&gt; Command Line: /usr/local/sbin/libvirtd -d
&gt; Executable: /usr/local/sbin/libvirtd
&gt; Control Group: /
&gt; Slice: -.slice
&gt; Boot ID: 01603763bc784c7380e310d5eea124d6
&gt; Machine ID: 89c660865c00403a9bacef32b6828556
&gt; Hostname: etcsvms1
&gt; Coredump: /var/lib/systemd/coredump/core.libvirtd.0.01603763bc784c7380e310d5eea124d6.10728.1513931319000000.xz
&gt;                 
&gt; Message: Process 10728 (libvirtd) of user 0 dumped core.


&gt; Core was generated by `/usr/local/sbin/libvirtd -d'.
&gt; Program terminated with signal SIGSEGV, Segmentation fault.
&gt; #0  virStorageFileReportBrokenChain (errcode=2,
&gt; src=src@entry=0x7f0d4004ac40, parent=0x7f0d4004ac40)
&gt; at storage/storage_source.c:422
&gt; 422         unsigned int access_user = src-&gt;drv-&gt;uid;
&gt; [Current thread is 1 (Thread 0x7f0d525ab700 (LWP 10729))]
&gt; Missing separate debuginfos, use: zypper install

&gt; (gdb)

You've not given a full stack trace here - just the top most frame.
Can you do it again and run

  (gdb) thread apply all backtrace full

Regards,
Daniel
-- 
&gt; &gt; https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
&gt; &gt; https://libvirt.org         -o-            https://fstop138.berrange.com :|
&gt; &gt; https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|


</body></email><email><emailId>20171222092120</emailId><senderName>Holger Schranz</senderName><senderEmail>holger@fam-schranz.de</senderEmail><timestampReceived>2017-12-22 09:21:20-0400</timestampReceived><subject>Re: [libvirt-users] [BUG] Not exiting media forced a promptly close of libvirt 3.10</subject><body>

Hi Daniel,

sorry. Here the requested stack trace.

Best regards

Holger

=====================================================================================

Thread 18 (Thread 0x7f0d495e0700 (LWP 10742)):
#0  0x00007f0d55e690bf in pthread_cond_wait@@GLIBC_2.3.2 () from 
/lib64/libpthread.so.0
No symbol table info available.
#1  0x00007f0d5892176a in virCondWait (c=c@entry=0x5557f238db28, 
m=m@entry=0x5557f238db00) at util/virthread.c:154
         ret = &lt;optimized out&gt;
#2  0x00007f0d58922543 in virThreadPoolWorker 
(opaque=opaque@entry=0x5557f23848f0) at util/virthreadpool.c:124
         data = 0x0
         pool = 0x5557f238dac0
         cond = 0x5557f238db28
         priority = false
         curWorkers = 0x5557f238dba0
         maxLimit = 0x5557f238db88
         job = 0x0
#3  0x00007f0d58921288 in virThreadHelper (data=&lt;optimized out&gt;) at 
util/virthread.c:206
         args = 0x0
         local = {func = 0x7f0d589223b0 &lt;virThreadPoolWorker&gt;, funcName 
= 0x5557f0d8879d "virNetServerHandleJob", worker = true,
           opaque = 0x5557f23848f0}
#4  0x00007f0d55e64744 in start_thread () from /lib64/libpthread.so.0
No symbol table info available.
#5  0x00007f0d55ba2aad in clone () from /lib64/libc.so.6
No symbol table info available.

Thread 17 (Thread 0x7f0d47d73700 (LWP 10751)):
#0  0x00007f0d55e690bf in pthread_cond_wait@@GLIBC_2.3.2 () from 
/lib64/libpthread.so.0
No symbol table info available.
#1  0x00007f0d5892176a in virCondWait (c=c@entry=0x7f0d40017a20, 
m=m@entry=0x7f0d400179e0) at util/virthread.c:154
         ret = &lt;optimized out&gt;
#2  0x00007f0d4bebb5e8 in udevEventHandleThread (opaque=&lt;optimized out&gt;) 
at node_device/node_device_udev.c:1729
         priv = 0x7f0d400179d0
         device = &lt;optimized out&gt;
         __FUNCTION__ = "udevEventHandleThread"
#3  0x00007f0d589212b2 in virThreadHelper (data=&lt;optimized out&gt;) at 
util/virthread.c:206
         args = 0x0
         local = {func = 0x7f0d4bebb590 &lt;udevEventHandleThread&gt;, 
funcName = 0x7f0d4bec6f4e "udevEventHandleThread", worker = false,
           opaque = 0x0}
#4  0x00007f0d55e64744 in start_thread () from /lib64/libpthread.so.0
No symbol table info available.
#5  0x00007f0d55ba2aad in clone () from /lib64/libc.so.6
No symbol table info available.

Thread 16 (Thread 0x7f0d4a5e2700 (LWP 10740)):
#0  0x00007f0d55e690bf in pthread_cond_wait@@GLIBC_2.3.2 () from 
/lib64/libpthread.so.0
No symbol table info available.
#1  0x00007f0d5892176a in virCondWait (c=c@entry=0x5557f238db28, 
m=m@entry=0x5557f238db00) at util/virthread.c:154
         ret = &lt;optimized out&gt;
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
#2  0x00007f0d58922543 in virThreadPoolWorker 
(opaque=opaque@entry=0x5557f238dde0) at util/virthreadpool.c:124
         data = 0x0
         pool = 0x5557f238dac0
         cond = 0x5557f238db28
         priority = false
         curWorkers = 0x5557f238dba0
         maxLimit = 0x5557f238db88
         job = 0x0
#3  0x00007f0d58921288 in virThreadHelper (data=&lt;optimized out&gt;) at 
util/virthread.c:206
         args = 0x0
         local = {func = 0x7f0d589223b0 &lt;virThreadPoolWorker&gt;, funcName 
= 0x5557f0d8879d "virNetServerHandleJob", worker = true,
           opaque = 0x5557f238dde0}
#4  0x00007f0d55e64744 in start_thread () from /lib64/libpthread.so.0
No symbol table info available.
#5  0x00007f0d55ba2aad in clone () from /lib64/libc.so.6
No symbol table info available.

Thread 15 (Thread 0x7f0d595fb840 (LWP 10728)):
#0  0x00007f0d55b9a20d in poll () from /lib64/libc.so.6
No symbol table info available.
#1  0x00007f0d588c177a in poll (__timeout=5000, __nfds=30, 
__fds=&lt;optimized out&gt;) at /usr/include/bits/poll2.h:46
No locals.
#2  virEventPollRunOnce () at util/vireventpoll.c:641
         fds = 0x5557f238fe40
         ret = &lt;optimized out&gt;
         timeout = 5000
         nfds = 30
         __func__ = "virEventPollRunOnce"
         __FUNCTION__ = "virEventPollRunOnce"
#3  0x00007f0d588c01a2 in virEventRunDefaultImpl () at util/virevent.c:327
         __func__ = "virEventRunDefaultImpl"
#4  0x00007f0d58a5a00d in virNetDaemonRun (dmn=0x5557f2385150) at 
rpc/virnetdaemon.c:838
         timerid = -1
         timerActive = false
         __FUNCTION__ = "virNetDaemonRun"
         __func__ = "virNetDaemonRun"
#5  0x00005557f0d26645 in main (argc=&lt;optimized out&gt;, argv=&lt;optimized 
out&gt;) at libvirtd.c:1498
         dmn = 0x5557f2385150
         srv = 0x5557f23853d0
         srvAdm = 0x5557f238d9d0
         remote_config_file = 0x5557f2384fd0 
"/usr/local/etc/libvirt/libvirtd.conf"
         statuswrite = -1
         ret = 1
         pid_file_fd = 5
         pid_file = 0x5557f2392e30 "/usr/local/var/run/libvirtd.pid"
         sock_file = 0x5557f2392db0 
"/usr/local/var/run/libvirt/libvirt-sock"
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
         sock_file_ro = 0x5557f2392ae0 
"/usr/local/var/run/libvirt/libvirt-sock-ro"
         sock_file_adm = 0x5557f2391ec0 
"/usr/local/var/run/libvirt/libvirt-admin-sock"
         timeout = -1
         verbose = 0
         godaemon = 1
         ipsock = 0
         config = 0x5557f23845a0
         privileged = &lt;optimized out&gt;
         implicit_conf = &lt;optimized out&gt;
         run_dir = 0x5557f2392d30 "/usr/local/var/run/libvirt"
         old_umask = &lt;optimized out&gt;
         opts = {{name = 0x5557f0d76acc "verbose", has_arg = 0, flag = 
0x7ffdf2c76860, val = 118}, {name = 0x5557f0d76ad4 "daemon",
             has_arg = 0, flag = 0x7ffdf2c76864, val = 100}, {name = 
0x5557f0d76adb "listen", has_arg = 0, flag = 0x7ffdf2c76868,
             val = 108}, {name = 0x5557f0d76bb6 "config", has_arg = 1, 
flag = 0x0, val = 102}, {name = 0x5557f0d76b31 "timeout",
             has_arg = 1, flag = 0x0, val = 116}, {name = 0x5557f0d76ae2 
"pid-file", has_arg = 1, flag = 0x0, val = 112}, {
             name = 0x5557f0d76aeb "version", has_arg = 0, flag = 0x0, 
val = 86}, {name = 0x5557f0d76af3 "help", has_arg = 0, flag = 0x0,
             val = 104}, {name = 0x0, has_arg = 0, flag = 0x0, val = 0}}
         __func__ = "main"

Thread 14 (Thread 0x7f0d4dda2700 (LWP 10738)):
#0  0x00007f0d55e690bf in pthread_cond_wait@@GLIBC_2.3.2 () from 
/lib64/libpthread.so.0
No symbol table info available.
#1  0x00007f0d5892176a in virCondWait (c=c@entry=0x5557f23855c8, 
m=m@entry=0x5557f2385500) at util/virthread.c:154
         ret = &lt;optimized out&gt;
#2  0x00007f0d589224db in virThreadPoolWorker 
(opaque=opaque@entry=0x5557f2391d40) at util/virthreadpool.c:124
         data = 0x0
         pool = 0x5557f23854c0
         cond = 0x5557f23855c8
         priority = true
         curWorkers = 0x5557f23855b8
         maxLimit = 0x5557f23855b0
         job = 0x0
#3  0x00007f0d58921288 in virThreadHelper (data=&lt;optimized out&gt;) at 
util/virthread.c:206
         args = 0x0
         local = {func = 0x7f0d589223b0 &lt;virThreadPoolWorker&gt;, funcName 
= 0x5557f0d8879d "virNetServerHandleJob", worker = true,
           opaque = 0x5557f2391d40}
#4  0x00007f0d55e64744 in start_thread () from /lib64/libpthread.so.0
No symbol table info available.
#5  0x00007f0d55ba2aad in clone () from /lib64/libc.so.6
No symbol table info available.

Thread 13 (Thread 0x7f0d4e5a3700 (LWP 10737)):
#0  0x00007f0d55e690bf in pthread_cond_wait@@GLIBC_2.3.2 () from 
/lib64/libpthread.so.0
No symbol table info available.
#1  0x00007f0d5892176a in virCondWait (c=c@entry=0x5557f23855c8, 
m=m@entry=0x5557f2385500) at util/virthread.c:154
         ret = &lt;optimized out&gt;
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
#2  0x00007f0d589224db in virThreadPoolWorker 
(opaque=opaque@entry=0x5557f2391c60) at util/virthreadpool.c:124
         data = 0x0
         pool = 0x5557f23854c0
         cond = 0x5557f23855c8
         priority = true
         curWorkers = 0x5557f23855b8
         maxLimit = 0x5557f23855b0
         job = 0x0
#3  0x00007f0d58921288 in virThreadHelper (data=&lt;optimized out&gt;) at 
util/virthread.c:206
         args = 0x0
         local = {func = 0x7f0d589223b0 &lt;virThreadPoolWorker&gt;, funcName 
= 0x5557f0d8879d "virNetServerHandleJob", worker = true,
           opaque = 0x5557f2391c60}
#4  0x00007f0d55e64744 in start_thread () from /lib64/libpthread.so.0
No symbol table info available.
#5  0x00007f0d55ba2aad in clone () from /lib64/libc.so.6
No symbol table info available.

Thread 12 (Thread 0x7f0d485de700 (LWP 11276)):
#0  0x00007f0d55e690bf in pthread_cond_wait@@GLIBC_2.3.2 () from 
/lib64/libpthread.so.0
No symbol table info available.
#1  0x00007f0d5892176a in virCondWait (c=c@entry=0x7f0d400ddc68, 
m=m@entry=0x7f0d400ddc40) at util/virthread.c:154
         ret = &lt;optimized out&gt;
#2  0x00007f0d58922543 in virThreadPoolWorker 
(opaque=opaque@entry=0x5557f2393440) at util/virthreadpool.c:124
         data = 0x0
         pool = 0x7f0d400ddc00
         cond = 0x7f0d400ddc68
         priority = false
         curWorkers = 0x7f0d400ddce0
         maxLimit = 0x7f0d400ddcc8
         job = 0x0
#3  0x00007f0d58921288 in virThreadHelper (data=&lt;optimized out&gt;) at 
util/virthread.c:206
         args = 0x0
         local = {func = 0x7f0d589223b0 &lt;virThreadPoolWorker&gt;, funcName 
= 0x7f0d4b63dc60 "qemuProcessEventHandler", worker = true,
           opaque = 0x5557f2393440}
#4  0x00007f0d55e64744 in start_thread () from /lib64/libpthread.so.0
No symbol table info available.
#5  0x00007f0d55ba2aad in clone () from /lib64/libc.so.6
No symbol table info available.

Thread 11 (Thread 0x7f0d4eda4700 (LWP 10736)):
#0  0x00007f0d55e690bf in pthread_cond_wait@@GLIBC_2.3.2 () from 
/lib64/libpthread.so.0
No symbol table info available.
#1  0x00007f0d5892176a in virCondWait (c=c@entry=0x5557f23855c8, 
m=m@entry=0x5557f2385500) at util/virthread.c:154
         ret = &lt;optimized out&gt;
#2  0x00007f0d589224db in virThreadPoolWorker 
(opaque=opaque@entry=0x5557f2391d40) at util/virthreadpool.c:124
         data = 0x0
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
         pool = 0x5557f23854c0
         cond = 0x5557f23855c8
         priority = true
         curWorkers = 0x5557f23855b8
         maxLimit = 0x5557f23855b0
         job = 0x0
#3  0x00007f0d58921288 in virThreadHelper (data=&lt;optimized out&gt;) at 
util/virthread.c:206
         args = 0x0
         local = {func = 0x7f0d589223b0 &lt;virThreadPoolWorker&gt;, funcName 
= 0x5557f0d8879d "virNetServerHandleJob", worker = true,
           opaque = 0x5557f2391d40}
#4  0x00007f0d55e64744 in start_thread () from /lib64/libpthread.so.0
No symbol table info available.
#5  0x00007f0d55ba2aad in clone () from /lib64/libc.so.6
No symbol table info available.

Thread 10 (Thread 0x7f0d4fda6700 (LWP 10734)):
#0  0x00007f0d55e690bf in pthread_cond_wait@@GLIBC_2.3.2 () from 
/lib64/libpthread.so.0
No symbol table info available.
#1  0x00007f0d5892176a in virCondWait (c=c@entry=0x5557f23855c8, 
m=m@entry=0x5557f2385500) at util/virthread.c:154
         ret = &lt;optimized out&gt;
#2  0x00007f0d589224db in virThreadPoolWorker 
(opaque=opaque@entry=0x5557f2391c60) at util/virthreadpool.c:124
         data = 0x0
         pool = 0x5557f23854c0
         cond = 0x5557f23855c8
         priority = true
         curWorkers = 0x5557f23855b8
         maxLimit = 0x5557f23855b0
         job = 0x0
#3  0x00007f0d58921288 in virThreadHelper (data=&lt;optimized out&gt;) at 
util/virthread.c:206
         args = 0x0
         local = {func = 0x7f0d589223b0 &lt;virThreadPoolWorker&gt;, funcName 
= 0x5557f0d8879d "virNetServerHandleJob", worker = true,
           opaque = 0x5557f2391c60}
#4  0x00007f0d55e64744 in start_thread () from /lib64/libpthread.so.0
No symbol table info available.
#5  0x00007f0d55ba2aad in clone () from /lib64/libc.so.6
No symbol table info available.

Thread 9 (Thread 0x7f0d48ddf700 (LWP 10743)):
#0  0x00007f0d55e690bf in pthread_cond_wait@@GLIBC_2.3.2 () from 
/lib64/libpthread.so.0
No symbol table info available.
#1  0x00007f0d5892176a in virCondWait (c=c@entry=0x5557f238db28, 
m=m@entry=0x5557f238db00) at util/virthread.c:154
         ret = &lt;optimized out&gt;
#2  0x00007f0d58922543 in virThreadPoolWorker 
(opaque=opaque@entry=0x5557f238dde0) at util/virthreadpool.c:124
         data = 0x0
         pool = 0x5557f238dac0
         cond = 0x5557f238db28
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
         priority = false
         curWorkers = 0x5557f238dba0
         maxLimit = 0x5557f238db88
         job = 0x0
#3  0x00007f0d58921288 in virThreadHelper (data=&lt;optimized out&gt;) at 
util/virthread.c:206
         args = 0x0
         local = {func = 0x7f0d589223b0 &lt;virThreadPoolWorker&gt;, funcName 
= 0x5557f0d8879d "virNetServerHandleJob", worker = true,
           opaque = 0x5557f238dde0}
#4  0x00007f0d55e64744 in start_thread () from /lib64/libpthread.so.0
No symbol table info available.
#5  0x00007f0d55ba2aad in clone () from /lib64/libc.so.6
No symbol table info available.

Thread 8 (Thread 0x7f0d49de1700 (LWP 10741)):
#0  0x00007f0d55e690bf in pthread_cond_wait@@GLIBC_2.3.2 () from 
/lib64/libpthread.so.0
No symbol table info available.
#1  0x00007f0d5892176a in virCondWait (c=c@entry=0x5557f238db28, 
m=m@entry=0x5557f238db00) at util/virthread.c:154
         ret = &lt;optimized out&gt;
#2  0x00007f0d58922543 in virThreadPoolWorker 
(opaque=opaque@entry=0x5557f238dfb0) at util/virthreadpool.c:124
         data = 0x0
         pool = 0x5557f238dac0
         cond = 0x5557f238db28
         priority = false
         curWorkers = 0x5557f238dba0
         maxLimit = 0x5557f238db88
         job = 0x0
#3  0x00007f0d58921288 in virThreadHelper (data=&lt;optimized out&gt;) at 
util/virthread.c:206
         args = 0x0
         local = {func = 0x7f0d589223b0 &lt;virThreadPoolWorker&gt;, funcName 
= 0x5557f0d8879d "virNetServerHandleJob", worker = true,
           opaque = 0x5557f238dfb0}
#4  0x00007f0d55e64744 in start_thread () from /lib64/libpthread.so.0
No symbol table info available.
#5  0x00007f0d55ba2aad in clone () from /lib64/libc.so.6
No symbol table info available.

Thread 7 (Thread 0x7f0d51daa700 (LWP 10730)):
#0  0x00007f0d55e690bf in pthread_cond_wait@@GLIBC_2.3.2 () from 
/lib64/libpthread.so.0
No symbol table info available.
#1  0x00007f0d5892176a in virCondWait (c=c@entry=0x5557f2385528, 
m=m@entry=0x5557f2385500) at util/virthread.c:154
         ret = &lt;optimized out&gt;
#2  0x00007f0d58922543 in virThreadPoolWorker 
(opaque=opaque@entry=0x5557f2391d40) at util/virthreadpool.c:124
         data = 0x0
         pool = 0x5557f23854c0
         cond = 0x5557f2385528
         priority = false
         curWorkers = 0x5557f23855a0
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
         maxLimit = 0x5557f2385588
         job = 0x0
#3  0x00007f0d58921288 in virThreadHelper (data=&lt;optimized out&gt;) at 
util/virthread.c:206
         args = 0x0
         local = {func = 0x7f0d589223b0 &lt;virThreadPoolWorker&gt;, funcName 
= 0x5557f0d8879d "virNetServerHandleJob", worker = true,
           opaque = 0x5557f2391d40}
#4  0x00007f0d55e64744 in start_thread () from /lib64/libpthread.so.0
No symbol table info available.
#5  0x00007f0d55ba2aad in clone () from /lib64/libc.so.6
No symbol table info available.

Thread 6 (Thread 0x7f0d4ade3700 (LWP 10739)):
#0  0x00007f0d55e690bf in pthread_cond_wait@@GLIBC_2.3.2 () from 
/lib64/libpthread.so.0
No symbol table info available.
#1  0x00007f0d5892176a in virCondWait (c=c@entry=0x5557f238db28, 
m=m@entry=0x5557f238db00) at util/virthread.c:154
         ret = &lt;optimized out&gt;
#2  0x00007f0d58922543 in virThreadPoolWorker 
(opaque=opaque@entry=0x5557f23848f0) at util/virthreadpool.c:124
         data = 0x0
         pool = 0x5557f238dac0
         cond = 0x5557f238db28
         priority = false
         curWorkers = 0x5557f238dba0
         maxLimit = 0x5557f238db88
         job = 0x0
#3  0x00007f0d58921288 in virThreadHelper (data=&lt;optimized out&gt;) at 
util/virthread.c:206
         args = 0x0
         local = {func = 0x7f0d589223b0 &lt;virThreadPoolWorker&gt;, funcName 
= 0x5557f0d8879d "virNetServerHandleJob", worker = true,
           opaque = 0x5557f23848f0}
#4  0x00007f0d55e64744 in start_thread () from /lib64/libpthread.so.0
No symbol table info available.
#5  0x00007f0d55ba2aad in clone () from /lib64/libc.so.6
No symbol table info available.

Thread 5 (Thread 0x7f0d50da8700 (LWP 10732)):
#0  0x00007f0d55e690bf in pthread_cond_wait@@GLIBC_2.3.2 () from 
/lib64/libpthread.so.0
No symbol table info available.
#1  0x00007f0d5892176a in virCondWait (c=c@entry=0x5557f2385528, 
m=m@entry=0x5557f2385500) at util/virthread.c:154
         ret = &lt;optimized out&gt;
#2  0x00007f0d58922543 in virThreadPoolWorker 
(opaque=opaque@entry=0x5557f2391e70) at util/virthreadpool.c:124
         data = 0x0
         pool = 0x5557f23854c0
         cond = 0x5557f2385528
         priority = false
         curWorkers = 0x5557f23855a0
         maxLimit = 0x5557f2385588
         job = 0x0
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
#3  0x00007f0d58921288 in virThreadHelper (data=&lt;optimized out&gt;) at 
util/virthread.c:206
         args = 0x0
         local = {func = 0x7f0d589223b0 &lt;virThreadPoolWorker&gt;, funcName 
= 0x5557f0d8879d "virNetServerHandleJob", worker = true,
           opaque = 0x5557f2391e70}
#4  0x00007f0d55e64744 in start_thread () from /lib64/libpthread.so.0
No symbol table info available.
#5  0x00007f0d55ba2aad in clone () from /lib64/libc.so.6
No symbol table info available.

Thread 4 (Thread 0x7f0d4f5a5700 (LWP 10735)):
#0  0x00007f0d55e690bf in pthread_cond_wait@@GLIBC_2.3.2 () from 
/lib64/libpthread.so.0
No symbol table info available.
#1  0x00007f0d5892176a in virCondWait (c=c@entry=0x5557f23855c8, 
m=m@entry=0x5557f2385500) at util/virthread.c:154
         ret = &lt;optimized out&gt;
#2  0x00007f0d589224db in virThreadPoolWorker 
(opaque=opaque@entry=0x5557f2391e70) at util/virthreadpool.c:124
         data = 0x0
         pool = 0x5557f23854c0
         cond = 0x5557f23855c8
         priority = true
         curWorkers = 0x5557f23855b8
         maxLimit = 0x5557f23855b0
         job = 0x0
#3  0x00007f0d58921288 in virThreadHelper (data=&lt;optimized out&gt;) at 
util/virthread.c:206
         args = 0x0
         local = {func = 0x7f0d589223b0 &lt;virThreadPoolWorker&gt;, funcName 
= 0x5557f0d8879d "virNetServerHandleJob", worker = true,
           opaque = 0x5557f2391e70}
#4  0x00007f0d55e64744 in start_thread () from /lib64/libpthread.so.0
No symbol table info available.
#5  0x00007f0d55ba2aad in clone () from /lib64/libc.so.6
No symbol table info available.

Thread 3 (Thread 0x7f0d505a7700 (LWP 10733)):
#0  0x00007f0d55e690bf in pthread_cond_wait@@GLIBC_2.3.2 () from 
/lib64/libpthread.so.0
No symbol table info available.
#1  0x00007f0d5892176a in virCondWait (c=c@entry=0x5557f2385528, 
m=m@entry=0x5557f2385500) at util/virthread.c:154
         ret = &lt;optimized out&gt;
#2  0x00007f0d58922543 in virThreadPoolWorker 
(opaque=opaque@entry=0x5557f2391d40) at util/virthreadpool.c:124
         data = 0x0
         pool = 0x5557f23854c0
         cond = 0x5557f2385528
         priority = false
         curWorkers = 0x5557f23855a0
         maxLimit = 0x5557f2385588
         job = 0x0
#3  0x00007f0d58921288 in virThreadHelper (data=&lt;optimized out&gt;) at 
util/virthread.c:206
         args = 0x0
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
         local = {func = 0x7f0d589223b0 &lt;virThreadPoolWorker&gt;, funcName 
= 0x5557f0d8879d "virNetServerHandleJob", worker = true,
           opaque = 0x5557f2391d40}
#4  0x00007f0d55e64744 in start_thread () from /lib64/libpthread.so.0
No symbol table info available.
#5  0x00007f0d55ba2aad in clone () from /lib64/libc.so.6
No symbol table info available.

Thread 2 (Thread 0x7f0d515a9700 (LWP 10731)):
#0  0x00007f0d55e690bf in pthread_cond_wait@@GLIBC_2.3.2 () from 
/lib64/libpthread.so.0
No symbol table info available.
#1  0x00007f0d5892176a in virCondWait (c=c@entry=0x5557f2385528, 
m=m@entry=0x5557f2385500) at util/virthread.c:154
         ret = &lt;optimized out&gt;
#2  0x00007f0d58922543 in virThreadPoolWorker 
(opaque=opaque@entry=0x5557f2391c60) at util/virthreadpool.c:124
         data = 0x0
         pool = 0x5557f23854c0
         cond = 0x5557f2385528
         priority = false
         curWorkers = 0x5557f23855a0
         maxLimit = 0x5557f2385588
         job = 0x0
#3  0x00007f0d58921288 in virThreadHelper (data=&lt;optimized out&gt;) at 
util/virthread.c:206
         args = 0x0
         local = {func = 0x7f0d589223b0 &lt;virThreadPoolWorker&gt;, funcName 
= 0x5557f0d8879d "virNetServerHandleJob", worker = true,
           opaque = 0x5557f2391c60}
#4  0x00007f0d55e64744 in start_thread () from /lib64/libpthread.so.0
No symbol table info available.
#5  0x00007f0d55ba2aad in clone () from /lib64/libc.so.6
No symbol table info available.

Thread 1 (Thread 0x7f0d525ab700 (LWP 10729)):
#0  virStorageFileReportBrokenChain (errcode=2, 
src=src@entry=0x7f0d4004ac40, parent=0x7f0d4004ac40) at 
storage/storage_source.c:422
         access_user = &lt;optimized out&gt;
         access_group = &lt;optimized out&gt;
         __FUNCTION__ = "virStorageFileReportBrokenChain"
#1  0x00007f0d4b56a262 in qemuDomainDetermineDiskChain 
(driver=driver@entry=0x7f0d40240bf0, vm=vm@entry=0x7f0d400e66d0,
     disk=disk@entry=0x7f0d4037fa80, force_probe=force_probe@entry=true, 
report_broken=report_broken@entry=true)
     at qemu/qemu_domain.c:6383
         cfg = 0x7f0d400be000
         src = 0x7f0d4004ac40
         ret = -1
         uid = 1074685768
         gid = 32525
         __FUNCTION__ = "qemuDomainDetermineDiskChain"
#2  0x00007f0d4b594c92 in qemuProcessPrepareHostStorage (flags=17, 
vm=0x7f0d400e66d0, driver=0x7f0d40240bf0) at qemu/qemu_process.c:5562
         idx = 0
         disk = 0x7f0d4037fa80
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
         i = 1
         cold_boot = true
#3  qemuProcessPrepareHost (driver=driver@entry=0x7f0d40240bf0, 
vm=vm@entry=0x7f0d400e66d0, flags=flags@entry=17)
     at qemu/qemu_process.c:5668
         ret = -1
         hostdev_flags = &lt;optimized out&gt;
         priv = &lt;optimized out&gt;
         cfg = 0x7f0d400be000
         __func__ = "qemuProcessPrepareHost"
         __FUNCTION__ = "qemuProcessPrepareHost"
#4  0x00007f0d4b59ac3b in qemuProcessStart 
(conn=conn@entry=0x7f0d24002340, driver=driver@entry=0x7f0d40240bf0,
     vm=vm@entry=0x7f0d400e66d0, updatedCPU=updatedCPU@entry=0x0, 
asyncJob=asyncJob@entry=QEMU_ASYNC_JOB_START,
     migrateFrom=migrateFrom@entry=0x0, migrateFd=migrateFd@entry=-1, 
migratePath=migratePath@entry=0x0, snapshot=snapshot@entry=0x0,
     vmop=vmop@entry=VIR_NETDEV_VPORT_PROFILE_OP_CREATE, flags=17, 
flags@entry=1) at qemu/qemu_process.c:6128
         priv = 0x7f0d402924a0
         incoming = 0x0
         stopFlags = &lt;optimized out&gt;
         relabel = false
         ret = -1
         rv = &lt;optimized out&gt;
         __func__ = "qemuProcessStart"
         __FUNCTION__ = "qemuProcessStart"
#5  0x00007f0d4b603036 in qemuDomainObjStart (conn=0x7f0d24002340, 
driver=driver@entry=0x7f0d40240bf0, vm=0x7f0d400e66d0,
     flags=flags@entry=0, asyncJob=QEMU_ASYNC_JOB_START) at 
qemu/qemu_driver.c:7283
         ret = &lt;optimized out&gt;
         managed_save = 0x7f0d40397a80 
"/usr/local/var/lib/libvirt/qemu/save/S1VCS82M5-IUP0.save"
         start_paused = false
         autodestroy = false
         bypass_cache = false
         force_boot = false
         start_flags = 1
         priv = 0x7f0d402924a0
#6  0x00007f0d4b603776 in qemuDomainCreateWithFlags (dom=0x7f0d4009b1c0, 
flags=0) at qemu/qemu_driver.c:7337
         driver = 0x7f0d40240bf0
         vm = 0x7f0d400e66d0
         ret = -1
         __FUNCTION__ = "qemuDomainCreateWithFlags"
#7  0x00007f0d589e573c in virDomainCreate 
(domain=domain@entry=0x7f0d4009b1c0) at libvirt-domain.c:6531
         ret = &lt;optimized out&gt;
         conn = &lt;optimized out&gt;
         __func__ = "virDomainCreate"
         __FUNCTION__ = "virDomainCreate"
#8  0x00005557f0d53ea3 in remoteDispatchDomainCreate 
(server=0x5557f23853d0, msg=0x5557f23936a0, args=&lt;optimized out&gt;,
     rerr=0x7f0d525aac90, client=0x5557f238fac0) at remote_dispatch.h:4222
         dom = 0x7f0d4009b1c0
         priv = &lt;optimized out&gt;
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
#9  remoteDispatchDomainCreateHelper (server=0x5557f23853d0, 
client=0x5557f238fac0, msg=0x5557f23936a0, rerr=0x7f0d525aac90,
     args=&lt;optimized out&gt;, ret=0x7f0d403683c0) at remote_dispatch.h:4198
         rv = -231146816
         __func__ = "remoteDispatchDomainCreateHelper"
#10 0x00007f0d58a60ed2 in virNetServerProgramDispatchCall 
(msg=0x5557f23936a0, client=0x5557f238fac0, server=0x5557f23853d0,
     prog=0x5557f2391a70) at rpc/virnetserverprogram.c:437
         ret = 0x7f0d403683c0 ""
         rv = -1
         i = &lt;optimized out&gt;
         identity = 0x7f0d400166e0
         arg = 0x7f0d4033eaa0 "\340:\t@\r\177"
         dispatcher = 0x5557f0fa03b0 &lt;remoteProcs+432&gt;
         rerr = {code = 0, domain = 0, message = 0x0, level = 0, dom = 
0x0, str1 = 0x0, str2 = 0x0, str3 = 0x0, int1 = 0, int2 = 0,
           net = 0x0}
#11 virNetServerProgramDispatch (prog=0x5557f2391a70, 
server=server@entry=0x5557f23853d0, client=0x5557f238fac0, 
msg=0x5557f23936a0)
     at rpc/virnetserverprogram.c:307
         rerr = {code = 0, domain = 0, message = 0x0, level = 0, dom = 
0x0, str1 = 0x0, str2 = 0x0, str3 = 0x0, int1 = 0, int2 = 0,
           net = 0x0}
         __func__ = "virNetServerProgramDispatch"
         __FUNCTION__ = "virNetServerProgramDispatch"
#12 0x00005557f0d6a19d in virNetServerProcessMsg (msg=&lt;optimized out&gt;, 
prog=&lt;optimized out&gt;, client=&lt;optimized out&gt;, srv=0x5557f23853d0)
     at rpc/virnetserver.c:148
         ret = -1
#13 virNetServerHandleJob (jobOpaque=&lt;optimized out&gt;, 
opaque=0x5557f23853d0) at rpc/virnetserver.c:169
         srv = 0x5557f23853d0
         job = 0x5557f2393820
         __func__ = "virNetServerHandleJob"
#14 0x00007f0d58922491 in virThreadPoolWorker 
(opaque=opaque@entry=0x5557f2391e70) at util/virthreadpool.c:167
         data = 0x0
         pool = 0x5557f23854c0
         cond = 0x5557f2385528
         priority = false
         curWorkers = 0x5557f23855a0
         maxLimit = 0x5557f2385588
         job = 0x5557f238ef70
#15 0x00007f0d58921288 in virThreadHelper (data=&lt;optimized out&gt;) at 
util/virthread.c:206
         args = 0x0
         local = {func = 0x7f0d589223b0 &lt;virThreadPoolWorker&gt;, funcName 
= 0x5557f0d8879d "virNetServerHandleJob", worker = true,
           opaque = 0x5557f2391e70}
#16 0x00007f0d55e64744 in start_thread () from /lib64/libpthread.so.0
No symbol table info available.
#17 0x00007f0d55ba2aad in clone () from /lib64/libc.so.6
No symbol table info available.
(gdb)



Am 22.12.2017 um 10:01 schrieb Daniel P. Berrange:
&gt; On Fri, Dec 22, 2017 at 09:52:33AM +0100, Holger Schranz wrote:
&gt; &gt; etcsvms1:/kvm/CS8200/M5 # coredumpctl gdb libvirtd
&gt; &gt; PID: 10728 (libvirtd)
&gt; &gt; UID: 0 (root)
&gt; &gt; GID: 0 (root)
&gt; &gt; Signal: 11 (SEGV)
&gt; &gt; Timestamp: Fri 2017-12-22 09:28:39 CET (18min ago)
&gt; &gt; Command Line: /usr/local/sbin/libvirtd -d
&gt; &gt; Executable: /usr/local/sbin/libvirtd
&gt; &gt; Control Group: /
&gt; &gt; Slice: -.slice
&gt; &gt; Boot ID: 01603763bc784c7380e310d5eea124d6
&gt; &gt; Machine ID: 89c660865c00403a9bacef32b6828556
&gt; &gt; Hostname: etcsvms1
&gt; &gt; Coredump: /var/lib/systemd/coredump/core.libvirtd.0.01603763bc784c7380e310d5eea124d6.10728.1513931319000000.xz
&gt; &gt;                 
&gt; &gt; Message: Process 10728 (libvirtd) of user 0 dumped core.
&gt; 
&gt; &gt; Core was generated by `/usr/local/sbin/libvirtd -d'.
&gt; &gt; Program terminated with signal SIGSEGV, Segmentation fault.
&gt; &gt; #0  virStorageFileReportBrokenChain (errcode=2,
&gt; &gt; src=src@entry=0x7f0d4004ac40, parent=0x7f0d4004ac40)
&gt; &gt; at storage/storage_source.c:422
&gt; &gt; 422         unsigned int access_user = src-&gt;drv-&gt;uid;
&gt; &gt; [Current thread is 1 (Thread 0x7f0d525ab700 (LWP 10729))]
&gt; &gt; Missing separate debuginfos, use: zypper install
&gt; &gt; (gdb)
&gt; You've not given a full stack trace here - just the top most frame.
&gt; Can you do it again and run
&gt; 
&gt; (gdb) thread apply all backtrace full
&gt; 
&gt; Regards,
&gt; Daniel


---
Diese E-Mail wurde von Avast Antivirus-Software auf Viren geprüft.
https://www.avast.com/antivirus


</body></email><email><emailId>20171222212721</emailId><senderName>Jim Fehlig</senderName><senderEmail>jfehlig@suse.com</senderEmail><timestampReceived>2017-12-22 21:27:21-0400</timestampReceived><subject>Re: [libvirt-users] [BUG] Not exiting media forced a promptly close of libvirt 3.10</subject><body>

On 12/22/2017 02:21 AM, Holger Schranz wrote:
&gt; Thread 1 (Thread 0x7f0d525ab700 (LWP 10729)):
&gt; #0  virStorageFileReportBrokenChain (errcode=2, src=src@entry=0x7f0d4004ac40, 
&gt; parent=0x7f0d4004ac40) at storage/storage_source.c:422
&gt;          access_user = &lt;optimized out&gt;
&gt;          access_group = &lt;optimized out&gt;
&gt;          __FUNCTION__ = "virStorageFileReportBrokenChain"
&gt; #1  0x00007f0d4b56a262 in qemuDomainDetermineDiskChain 
&gt; (driver=driver@entry=0x7f0d40240bf0, vm=vm@entry=0x7f0d400e66d0,
&gt;      disk=disk@entry=0x7f0d4037fa80, force_probe=force_probe@entry=true, 
&gt; report_broken=report_broken@entry=true)

This bug has already been fixed

https://libvirt.org/git/?p=libvirt.git;a=commit;h=2d07f1f0ebd44b0348daa61afa0de34f3f838c22

Regards,
Jim

</body></email><email><emailId>20171223085636</emailId><senderName>Holger Schranz</senderName><senderEmail>holger@fam-schranz.de</senderEmail><timestampReceived>2017-12-23 08:56:36-0400</timestampReceived><subject>Re: [libvirt-users] [BUG] Not exiting media forced a promptly close of libvirt 3.10</subject><body>

Hello,

thanks for the information.

Please let me ask: If understand correctly this issue occoured and reported
in 3.9? And the fix is for 3.11 or 4.0?

Best regards

Holger

Am 22.12.2017 um 22:27 schrieb Jim Fehlig:
&gt; On 12/22/2017 02:21 AM, Holger Schranz wrote:
&gt;&gt; Thread 1 (Thread 0x7f0d525ab700 (LWP 10729)):
&gt;&gt; #0  virStorageFileReportBrokenChain (errcode=2, 
&gt;&gt; src=src@entry=0x7f0d4004ac40, parent=0x7f0d4004ac40) at 
&gt;&gt; storage/storage_source.c:422
&gt;&gt;          access_user = &lt;optimized out&gt;
&gt;&gt;          access_group = &lt;optimized out&gt;
&gt;&gt;          __FUNCTION__ = "virStorageFileReportBrokenChain"
&gt;&gt; #1  0x00007f0d4b56a262 in qemuDomainDetermineDiskChain 
&gt;&gt; (driver=driver@entry=0x7f0d40240bf0, vm=vm@entry=0x7f0d400e66d0,
&gt;&gt;      disk=disk@entry=0x7f0d4037fa80, 
&gt;&gt; force_probe=force_probe@entry=true, 
&gt;&gt; report_broken=report_broken@entry=true)
&gt;
&gt; This bug has already been fixed
&gt;
&gt; https://libvirt.org/git/?p=libvirt.git;a=commit;h=2d07f1f0ebd44b0348daa61afa0de34f3f838c22 
&gt;
&gt;
&gt; Regards,
&gt; Jim


---
Diese E-Mail wurde von Avast Antivirus-Software auf Viren geprüft.
https://www.avast.com/antivirus

</body></email><email><emailId>20171223092037</emailId><senderName>Holger Schranz</senderName><senderEmail>holger@fam-schranz.de</senderEmail><timestampReceived>2017-12-23 09:20:37-0400</timestampReceived><subject>Re: [libvirt-users] [BUG] Not exiting media forced a promptly close of libvirt 3.10</subject><body>

Sorry for an additional question:

In the bug report where Jim was wrote in his answer:
https://libvirt.org/git/?p=libvirt.git;a=commit;h=2d07f1f0ebd44b0348daa61afa0de34f3f838c22 

is a pointer to the report:
https://bugzilla.redhat.com/show_bug.cgi?id=1522682

In this report the fixed version is: libvirt-3.9.0-6.el7

How can I check/find whether this fix is include in the 3.10 which
I used?

Best regards

Holger

Am 23.12.2017 um 09:56 schrieb Holger Schranz:
&gt; Hello,
&gt;
&gt; thanks for the information.
&gt;
&gt; Please let me ask: If understand correctly this issue occoured and 
&gt; reported
&gt; in 3.9? And the fix is for 3.11 or 4.0?
&gt;
&gt; Best regards
&gt;
&gt; Holger
&gt;
&gt; Am 22.12.2017 um 22:27 schrieb Jim Fehlig:
&gt;&gt; On 12/22/2017 02:21 AM, Holger Schranz wrote:
&gt;&gt;&gt; Thread 1 (Thread 0x7f0d525ab700 (LWP 10729)):
&gt;&gt;&gt; #0  virStorageFileReportBrokenChain (errcode=2, 
&gt;&gt;&gt; src=src@entry=0x7f0d4004ac40, parent=0x7f0d4004ac40) at 
&gt;&gt;&gt; storage/storage_source.c:422
&gt;&gt;&gt;          access_user = &lt;optimized out&gt;
&gt;&gt;&gt;          access_group = &lt;optimized out&gt;
&gt;&gt;&gt;          __FUNCTION__ = "virStorageFileReportBrokenChain"
&gt;&gt;&gt; #1  0x00007f0d4b56a262 in qemuDomainDetermineDiskChain 
&gt;&gt;&gt; (driver=driver@entry=0x7f0d40240bf0, vm=vm@entry=0x7f0d400e66d0,
&gt;&gt;&gt;      disk=disk@entry=0x7f0d4037fa80, 
&gt;&gt;&gt; force_probe=force_probe@entry=true, 
&gt;&gt;&gt; report_broken=report_broken@entry=true)
&gt;&gt;
&gt;&gt; This bug has already been fixed
&gt;&gt;
&gt;&gt; https://libvirt.org/git/?p=libvirt.git;a=commit;h=2d07f1f0ebd44b0348daa61afa0de34f3f838c22 
&gt;&gt;
&gt;&gt;
&gt;&gt; Regards,
&gt;&gt; Jim
&gt;
&gt;
&gt; ---
&gt; Diese E-Mail wurde von Avast Antivirus-Software auf Viren geprüft.
&gt; https://www.avast.com/antivirus
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users

</body></email><email><emailId>20171223214702</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-12-23 21:47:02-0400</timestampReceived><subject>Re: [libvirt-users] [BUG] Not exiting media forced a promptly close of libvirt 3.10</subject><body>

On 12/23/2017 10:20 AM, Holger Schranz wrote:
&gt; Sorry for an additional question:
&gt; 
&gt; In the bug report where Jim was wrote in his answer:
&gt; https://libvirt.org/git/?p=libvirt.git;a=commit;h=2d07f1f0ebd44b0348daa61afa0de34f3f838c22
&gt; 
&gt; is a pointer to the report:
&gt; https://bugzilla.redhat.com/show_bug.cgi?id=1522682
&gt; 
&gt; In this report the fixed version is: libvirt-3.9.0-6.el7
&gt; 
&gt; How can I check/find whether this fix is include in the 3.10 which
&gt; I used?

It's not fixed there:

$ git describe  2d07f1f0ebd44b0348daa61afa0de34f3f838c22
v3.10.0-32-g2d07f1f0e

Which means, that the commit is 32'nd after 3.10.0 release. You'll have
to wait for:

a) new release,
b) your distro to pick up the commit and backport it.

Michal

</body></email><email><emailId>20171207163021</emailId><senderName>Daniel Romero</senderName><senderEmail>romero.cl@gmail.com</senderEmail><timestampReceived>2017-12-07 16:30:21-0400</timestampReceived><subject>Re: [libvirt-users] public IP for VM</subject><body>

Hi Chandler,

since host and guest are in the same network they can't have the same IP.

On the host, try to create a virtual network (using virsh or config files)
attached to the bridge, then set up eth0 with the primary IP and add it to
the bridge. After that set up the guest VM with an interface attached to
the virtual network using the secondary IP. At this moment you should have
access to both machines using their own IP.

If you want to use multiple IPs on the same NIC, you have to use aliases to
setup eth0 without IP, and eth0:0 and eth0:1 with the primary and secondary
IPs, but I don't see where this can help to your use case.

Supposing you want to have two web servers (I don't understand what you
want to achieve exactly), for load balancing or failover, you should set up
a different environment like:

- 1 main server in charge of virtualization (host), connected to the public
network (lets use eth0 for that), but not necesarily with a public IP, with
a virtual network connected to the public network (virtual network attached
to a bridge that contains eth0), and a private virtual network.
- 1 VM for the primary web server connected to the private virtual network
- 1 VM for the secondary web server connected to the private virtual network
- 1 VM running a load balancer connected to the private and public virtual
networks. This VM accept requests on the public interface and then forward
it to primary or secondary server following your rules. (this role could
also be played by primary web server, but I like to keep it apart)

this way you can have a single web server (for users it will look like
this) with a single IP that forward requests to one or multiple webservers
that are only visible in the private network, so also is a little more
secure.

hope it helps.

Atte.
Daniel Romero P.


On Thu, Dec 7, 2017 at 2:36 AM, Chandler &lt;admin@genome.arizona.edu&gt; wrote:

&gt; I can't seem to figure out how to setup a public IP for the VM so we could
&gt; use it as a second public webserver.  The host machine runs our primary
&gt; webserver with CentOS 6.9 and one public ipv4 address configured on
&gt; physical interface eth0.  Now i have configured a new bridge interface br0:
&gt; DEVICE=br0
&gt; TYPE=Bridge
&gt; BOOTPROTO=static
&gt;
&gt; The IP settings are for a second public ipv4 address in the same network.
&gt; Now i setup the VM to use br0 for the NIC and set the same IP settings
&gt; inside the VM... but it doesn't work.  The VM can't resolve any hosts, and
&gt; if i try to ssh to the second public IP, it just sends me to the host
&gt; machine instead of the VM.  I read the Bridged Networking section but it
&gt; seems to want to set br0 to the public IP and not use eth0.  I want to use
&gt; two public IP's over the same shared phys interface, eth0 with our first IP
&gt; and br0 with the second IP for the VM... or another similar configuration
&gt; that will have the same effect.
&gt; Thanks
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi Chandler,&lt;br&gt;&lt;br&gt;since host and guest are in the same network they \
can't have the same IP.&lt;br&gt;&lt;br&gt;On the host, try to create a virtual network \
(using virsh or config files) attached to the bridge, then set up eth0 with the \
primary IP and add it to the bridge. After that set up the guest VM with an interface \
attached to the virtual network using the secondary IP. At this moment you should \
have access to both machines using their own IP.&lt;br&gt;&lt;br&gt;If you want to use multiple \
IPs on the same NIC, you have to use aliases to setup eth0 without IP, and eth0:0 and \
eth0:1 with the primary and secondary IPs, but I don't see where this can help to \
your use case.&lt;br&gt;&lt;br&gt;Supposing you want to have two web servers (I don't \
understand what you want to achieve exactly), for load balancing or failover, you \
should set up a different environment like:&lt;br&gt;&lt;br&gt;- 1 main server in charge of \
virtualization (host), connected to the public network (lets use eth0 for that), but \
not necesarily with a public IP, with a virtual network connected to the public \
network (virtual network attached to a bridge that contains eth0), and a private \
virtual network.&lt;br&gt;- 1 VM for the primary web server connected to the private \
virtual network&lt;br&gt;- 1 VM for the secondary web server connected to the private \
virtual network&lt;br&gt;- 1 VM running a load balancer connected to the private and public \
virtual networks. This VM accept requests on the public interface and then forward it \
to primary or secondary server following your rules. (this role could also be played \
by primary web server, but I like to keep it apart)&lt;br&gt;&lt;br&gt;this way you can have a \
single web server (for users it will look like this) with a single IP that forward \
requests to one or multiple webservers that are only visible in the private network, \
so also is a little more secure.&lt;br&gt;&lt;br&gt;hope it helps.&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div class="gmail_signature" \
data-smartmail="gmail_signature"&gt;Atte.&lt;br&gt;Daniel Romero P.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;br&gt;&lt;div class="gmail_quote"&gt;On Thu, Dec 7, 2017 at 2:36 AM, Chandler &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:admin@genome.arizona.edu" \
target="_blank"&gt;admin@genome.arizona.edu&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;I can't seem to figure out how to setup a public IP for \
the VM so we could use it as a second public webserver.   The host machine runs our \
primary webserver with CentOS 6.9 and one public ipv4 address configured on physical \
interface eth0.   Now i have configured a new bridge interface br0:&lt;br&gt; \
DEVICE=br0&lt;br&gt; TYPE=Bridge&lt;br&gt;
BOOTPROTO=static&lt;br&gt;
&lt;br&gt;
The IP settings are for a second public ipv4 address in the same network.   Now i \
setup the VM to use br0 for the NIC and set the same IP settings inside the VM... but \
it doesn't work.   The VM can't resolve any hosts, and if i try to ssh to the \
second public IP, it just sends me to the host machine instead of the VM.   I read \
the Bridged Networking section but it seems to want to set br0 to the public IP and \
not use eth0.   I want to use two public IP's over the same shared phys \
interface, eth0 with our first IP and br0 with the second IP for the VM... or another \
similar configuration that will have the same effect.&lt;br&gt; Thanks&lt;br&gt;
&lt;br&gt;
______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt; \
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20171207165526</emailId><senderName>Doug Hughes</senderName><senderEmail>doug.hughes@keystonenap.com</senderEmail><timestampReceived>2017-12-07 16:55:26-0400</timestampReceived><subject>Re: [libvirt-users] public IP for VM</subject><body>

Here's how I do it..

I have a VM host and a bunch of VM guests on it. Most of those guest VMS
are in the same vlan as the host, which works fine with bridge. Some are
in tagged vlans, but you didn't ask about that.

from the guest perspective, here's an example from the .xml

     &lt;interface type='network'&gt;
           &lt;mac address='52:54:00:b0:98:0b'/&gt;
           &lt;source network='default'/&gt;
           &lt;model type='rtl8139'/&gt;
           &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
function='0x0'/&gt;
       &lt;/interface&gt;

host:

[root@vm2 qemu]# cat networks/default.xml
&lt;!--
WARNING: THIS IS AN AUTO-GENERATED FILE. CHANGES TO IT ARE LIKELY TO BE
OVERWRITTEN AND LOST. Changes to this xml configuration should be made
using:
   virsh net-edit default
or other application using the libvirt API.
--&gt;

/etc/libvirt/qemu/networks/default.xml:
&lt;network&gt;
   &lt;name&gt;default&lt;/name&gt;
   &lt;uuid&gt;57f11311-c17e-4550-8450-bea1c69d36cc&lt;/uuid&gt;
   &lt;forward mode='bridge'/&gt;
   &lt;bridge name='br0'/&gt;
&lt;/network&gt;

host (centos) /etc/sysconfig/network-scripts/ifcfg-br0: (note br0 uses
em0 on the hardware exclusively)
DEVICE="br0"
NAME="br0"
ONBOOT="yes"
BOOTPROTO="none"
HWADDR=c8:1f:66:e3:de:58
IPADDR=10.0.2.36
NETMASK=255.255.255.0
DEFROUTE="yes"
GATEWAY=10.0.2.1
TYPE="bridge"

# virsh
virsh # net-list
  Name                                 State           Autostart         Persistent
----------------------------------------------------------
  default                           active         yes                     yes

virsh # net-info default
Name:                     default
UUID:                     57f11311-c17e-4550-8450-bea1c69d36cc
Active:                 yes
Persistent:         yes
Autostart:           yes
Bridge:                 br0


a guest (centos) /etc/sysconfig/network-scripts/ifcfg-eth0:

TYPE=Ethernet
BOOTPROTO=static
HWADDR=52:54:00:6f:f7:85
USERCTL=no
IPADDR=10.0.2.27
NETMASK=255.255.255.0
GATEWAY=10.0.2.1
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=no
NAME=eth0
DEVICE=eth0
ONBOOT=yes
DNS1=8.8.8.8
DNS2=8.8.4.4
DOMAIN=foo.bar
UUID=8c4d5363-3bea-409f-8965-f2db432a6853



On 12/6/2017 11:57 PM, scar wrote:
&gt; I can't seem to figure out how to setup a public IP for the VM so we
&gt; could use it as a second public webserver.   The host machine runs our
&gt; primary webserver with CentOS 6.9 and one public ipv4 address
&gt; configured on physical interface eth0.   Now i have configured a new
&gt; bridge interface br0:
&gt; DEVICE=br0
&gt; TYPE=Bridge
&gt; BOOTPROTO=static
&gt;
&gt; The IP settings are for a second public ipv4 address in the same
&gt; network.   Now i setup the VM to use br0 for the NIC and set the same
&gt; IP settings inside the VM... but it doesn't work.   The VM can't
&gt; resolve any hosts, and if i try to ssh to the second public IP, it
&gt; just sends me to the host machine instead of the VM.
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users

-- 
Doug Hughes
Keystone NAP
Fairless Hills, PA
1.844.KEYBLOCK (539.2562) 	


[Attachment #3 (multipart/related)]

[Attachment #5 (text/html)]

&lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
  &lt;/head&gt;
  &lt;body text="#000000" bgcolor="#FFFFFF"&gt;
    &lt;p&gt;Here's how I do it..&lt;/p&gt;
    &lt;p&gt;I have a VM host and a bunch of VM guests on it. Most of those
      guest VMS are in the same vlan as the host, which works fine with
      bridge. Some are in tagged vlans, but you didn't ask about that.&lt;/p&gt;
    &lt;p&gt;from the guest perspective, here's an example from the .xml&lt;/p&gt;
    &lt;p&gt;   &lt;interface type='network'&gt;&lt;br&gt;
            &lt;mac address='52:54:00:b0:98:0b'/&gt;&lt;br&gt;
            &lt;source network='&lt;font color="#ff0000"&gt;default&lt;/font&gt;'/&gt;&lt;br&gt;
            &lt;model type='rtl8139'/&gt;&lt;br&gt;
            &lt;address type='pci' domain='0x0000' bus='0x00'
      slot='0x03' function='0x0'/&gt;&lt;br&gt;
          &lt;/interface&gt;&lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;host: &lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;[root@vm2 qemu]# cat networks/&lt;font color="#ff0000"&gt;default&lt;/font&gt;.xml
      &lt;br&gt;
      &lt;!--&lt;br&gt;
      WARNING: THIS IS AN AUTO-GENERATED FILE. CHANGES TO IT ARE LIKELY
      TO BE&lt;br&gt;
      OVERWRITTEN AND LOST. Changes to this xml configuration should be
      made using:&lt;br&gt;
        virsh net-edit default&lt;br&gt;
      or other application using the libvirt API.&lt;br&gt;
      --&gt;&lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;/etc/libvirt/qemu/networks/default.xml:&lt;br&gt;
      &lt;network&gt;&lt;br&gt;
        &lt;name&gt;default&lt;/name&gt;&lt;br&gt;
        &lt;uuid&gt;57f11311-c17e-4550-8450-bea1c69d36cc&lt;/uuid&gt;&lt;br&gt;
        &lt;forward mode='bridge'/&gt;&lt;br&gt;
        &lt;bridge name='br0'/&gt;&lt;br&gt;
      &lt;/network&gt;&lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;host (centos) /etc/sysconfig/network-scripts/ifcfg-br0: (note br0
      uses em0 on the hardware exclusively)&lt;br&gt;
      DEVICE="br0"&lt;br&gt;
      NAME="br0"&lt;br&gt;
      ONBOOT="yes"&lt;br&gt;
      BOOTPROTO="none"&lt;br&gt;
      HWADDR=c8:1f:66:e3:de:58&lt;br&gt;
      IPADDR=10.0.2.36&lt;br&gt;
      NETMASK=255.255.255.0&lt;br&gt;
      DEFROUTE="yes"&lt;br&gt;
      GATEWAY=10.0.2.1&lt;br&gt;
      TYPE="bridge"&lt;/p&gt;
    &lt;p&gt;# virsh&lt;br&gt;
      virsh # net-list&lt;br&gt;
       Name                 State      Autostart     Persistent&lt;br&gt;
      ----------------------------------------------------------&lt;br&gt;
       default              active     yes           yes&lt;br&gt;
      &lt;br&gt;
      virsh # net-info default&lt;br&gt;
      Name:           default&lt;br&gt;
      UUID:           57f11311-c17e-4550-8450-bea1c69d36cc&lt;br&gt;
      Active:         yes&lt;br&gt;
      Persistent:     yes&lt;br&gt;
      Autostart:      yes&lt;br&gt;
      Bridge:         br0&lt;br&gt;
      &lt;br&gt;
      &lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;a guest (centos) /etc/sysconfig/network-scripts/ifcfg-eth0:&lt;/p&gt;
    &lt;p&gt;TYPE=Ethernet&lt;br&gt;
      BOOTPROTO=static&lt;br&gt;
      HWADDR=52:54:00:6f:&lt;a class="moz-txt-link-freetext" href="f7:85"&gt;f7:85&lt;/a&gt;&lt;br&gt;
      USERCTL=no&lt;br&gt;
      IPADDR=10.0.2.27&lt;br&gt;
      NETMASK=255.255.255.0&lt;br&gt;
      GATEWAY=10.0.2.1&lt;br&gt;
      DEFROUTE=yes&lt;br&gt;
      IPV4_FAILURE_FATAL=no&lt;br&gt;
      IPV6INIT=no&lt;br&gt;
      NAME=eth0&lt;br&gt;
      DEVICE=eth0&lt;br&gt;
      ONBOOT=yes&lt;br&gt;
      DNS1=8.8.8.8&lt;br&gt;
      DNS2=8.8.4.4&lt;br&gt;
      DOMAIN=foo.bar&lt;br&gt;
      UUID=8c4d5363-3bea-409f-8965-f2db432a6853&lt;br&gt;
      &lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;&lt;br&gt;
    &lt;/p&gt;
    &lt;br&gt;
    &lt;div class="moz-cite-prefix"&gt;On 12/6/2017 11:57 PM, scar wrote:&lt;br&gt;
    &lt;/div&gt;
    &lt;blockquote type="cite" cite="mid:p0aho7$8ia$1@blaine.gmane.org"&gt;I
      can't seem to figure out how to setup a public IP for the VM so we
      could use it as a second public webserver.  The host machine runs
      our primary webserver with CentOS 6.9 and one public ipv4 address
      configured on physical interface eth0.  Now i have configured a
      new bridge interface br0:
      &lt;br&gt;
      DEVICE=br0
      &lt;br&gt;
      TYPE=Bridge
      &lt;br&gt;
      BOOTPROTO=static
      &lt;br&gt;
      &lt;br&gt;
      The IP settings are for a second public ipv4 address in the same
      network.  Now i setup the VM to use br0 for the NIC and set the
      same IP settings inside the VM... but it doesn't work.  The VM
      can't resolve any hosts, and if i try to ssh to the second public
      IP, it just sends me to the host machine instead of the VM.
      &lt;br&gt;
      &lt;br&gt;
      _______________________________________________
      &lt;br&gt;
      libvirt-users mailing list
      &lt;br&gt;
      &lt;a class="moz-txt-link-abbreviated" \
href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt;  &lt;br&gt;
      &lt;a class="moz-txt-link-freetext" \
href="https://www.redhat.com/mailman/listinfo/libvirt-users"&gt;https://www.redhat.com/mailman/listinfo/libvirt-users&lt;/a&gt;
  &lt;br&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
    &lt;div class="moz-signature"&gt;-- &lt;br&gt;
      &lt;table&gt;
        &lt;tbody&gt;
          &lt;tr&gt;
            &lt;td style="padding-left: 20px" width="90%"&gt;Doug Hughes&lt;br&gt;
              Keystone NAP&lt;br&gt;
              Fairless Hills, PA&lt;br&gt;
              1.844.KEYBLOCK (539.2562)&lt;/td&gt;
            &lt;td style="align: right;padding-right: 20px"&gt;&lt;img
                src="cid:part1.349BBE03.7001F613@keystonenap.com"&gt;
            &lt;/td&gt;
          &lt;/tr&gt;
        &lt;/tbody&gt;
      &lt;/table&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;


["keystone-nap.png" (image/png)]

</body></email><email><emailId>20171228173650</emailId><senderName>Jim Fehlig</senderName><senderEmail>jfehlig@suse.com</senderEmail><timestampReceived>2017-12-28 17:36:50-0400</timestampReceived><subject>Re: [libvirt-users] [BUG] Not exiting media forced a promptly close of libvirt 3.10</subject><body>

On 12/23/2017 02:47 PM, Michal Privoznik wrote:
&gt; On 12/23/2017 10:20 AM, Holger Schranz wrote:
&gt;&gt; Sorry for an additional question:
&gt;&gt;
&gt;&gt; In the bug report where Jim was wrote in his answer:
&gt;&gt; https://libvirt.org/git/?p=libvirt.git;a=commit;h=2d07f1f0ebd44b0348daa61afa0de34f3f838c22
&gt;&gt;
&gt;&gt; is a pointer to the report:
&gt;&gt; https://bugzilla.redhat.com/show_bug.cgi?id=1522682
&gt;&gt;
&gt;&gt; In this report the fixed version is: libvirt-3.9.0-6.el7
&gt;&gt;
&gt;&gt; How can I check/find whether this fix is include in the 3.10 which
&gt;&gt; I used?
&gt; 
&gt; It's not fixed there:
&gt; 
&gt; $ git describe  2d07f1f0ebd44b0348daa61afa0de34f3f838c22
&gt; v3.10.0-32-g2d07f1f0e
&gt; 
&gt; Which means, that the commit is 32'nd after 3.10.0 release. You'll have
&gt; to wait for:
&gt; 
&gt; a) new release,
&gt; b) your distro to pick up the commit and backport it.

b was done on 14 Dec.

Holger, the fix is available in the 3.10.0 libvirt package in the OBS 
Virtualization project

https://build.opensuse.org/package/show/Virtualization/libvirt

Regards,
Jim

</body></email><email><emailId>20171229161907</emailId><senderName>Benjammin2068</senderName><senderEmail>benjammin2068@gmail.com</senderEmail><timestampReceived>2017-12-29 16:19:07-0400</timestampReceived><subject>[libvirt-users] Using Intel Quick-Sync with GPU capable Intel CPUs</subject><body>

Rogue S.T asked about checking out graphics cards which brought the question to me...


Is it possible to make Intel on-CPU GPU resources to Windows 10?


(the box I'm working with has Xeon E5-2640v4 CPUs which should be QuickSync capable)

What else do I have to do to take advantage of this?

Just load the drivers?

Thanks,


  -Ben

</body></email><email><emailId>20171101102352</emailId><senderName>lejeczek</senderName><senderEmail>peljasz@yahoo.co.uk</senderEmail><timestampReceived>2017-11-01 10:23:52-0400</timestampReceived><subject>Re: [libvirt-users] net interface direct - no IP communication between guest &amp; host</subject><body>



On 25/10/17 08:05, Daniel P. Berrange wrote:
&gt; On Tue, Oct 24, 2017 at 03:52:52PM +0100, lejeczek wrote:
&gt;&gt; hi everyone
&gt;&gt;
&gt;&gt; I wonder why, when I attach an interface like this:
&gt;&gt;
&gt;&gt; virsh # attach-interface --domain win10Ent --type direct --source nm-team
&gt;&gt; --config --persistent --model virtio
&gt;&gt;
&gt;&gt; host cannot ip ping the guest and vice versa, yet guest can ping other
&gt;&gt; nodes(outside of its host, connected via phys net via a switch)
&gt;&gt;
&gt;&gt; Would you know?
&gt;&gt;
&gt;&gt; I thought maybe routing on the host, so I did:
&gt;&gt; $ route add -host 192.168.2.222 dev nm-team
&gt;&gt;
&gt;&gt; but to no avail.
&gt;&gt;
&gt;&gt; I wonder if it's lower layer, arp kernel bits?
&gt; I expect you'll be hitting this unfortunate gotcha:
&gt;
&gt; https://wiki.libvirt.org/page/TroubleshootMacvtapHostFail

really nice pointer, thanks.
So I changed some bits, NIC for quest now is:

vnet2      bridge     192-168-2-0 virtio

and network is:

&lt;network&gt;
   &lt;name&gt;192-168-2-0&lt;/name&gt;
   &lt;uuid&gt;4e03af62&lt;/uuid&gt;
   &lt;forward mode='bridge'/&gt;
   &lt;bridge name='nm-bridge1'/&gt;
&lt;/network&gt;

and the host's bridge(nm-bridge1) comprise of one net-team 
device which builds on two phys NICs.
And... the problem remains the same - other hosts/node(via a 
switch to which nm-team is connected) can get to the quest 
but the host itself cannot(and vice versa)
So no "macvtap" but still does not work.


&gt;
&gt; Regards,
&gt; Daniel

</body></email><email><emailId>20171103233554</emailId><senderName>Thiago Oliveira</senderName><senderEmail>cpv.thiago@gmail.com</senderEmail><timestampReceived>2017-11-03 23:35:54-0400</timestampReceived><subject>Re: [libvirt-users] What global_quota option mean? What's its logic?</subject><body>

Very interesting!
I did this configuration and I can see my core working just in 25%.
I would like to try the same with memory.....I am looking for that.

Thanks.

2017-11-02 13:58 GMT-02:00 Ján Tomko &lt;jtomko@redhat.com&gt;:

&gt; On Thu, Nov 02, 2017 at 03:03:56PM +0200, Volo M. wrote:
&gt;
&gt;&gt; Hi techs,
&gt;&gt;
&gt;&gt; Could you please explain or refer me to documentation where I could find a
&gt;&gt; description of global_quota schedinfo option. Someone told me that it
&gt;&gt; could
&gt;&gt; mean a cpu limitation in percents like:
&gt;&gt; global_quota   : 25000 (does it mean cpu limit % set to 25  ?)
&gt;&gt;
&gt;&gt;
&gt; The _quota values are relative to the _period, both in milliseconds and
&gt; refer
&gt; to the cumulative CPU time available to all the processes/threads in a
&gt; group.
&gt;
&gt; See the documentation in the kernel:
&gt; https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/lin
&gt; ux.git/tree/Documentation/scheduler/sched-bwc.txt
&gt;
&gt; So with global_period being set to 100000, a value of 25000 would mean
&gt; that all the threads of the virtual machine would be limited to use at
&gt; most 25 % of 1 CPU.
&gt;
&gt; Is it true?
&gt;&gt; What other parameters mean in below output?
&gt;&gt; I didn't find any related documentation at libvirt.org.
&gt;&gt; Could you help me to describe me or refer to some description what below
&gt;&gt; schedinfo options mean? Thanks.
&gt;&gt;
&gt;&gt;
&gt; [...]
&gt;
&gt;
&gt;&gt; [root@cpkvm ~]# virsh schedinfo 3 --set global_quota=25
&gt;&gt;
&gt;&gt; Scheduler      : posix
&gt;&gt;
&gt;&gt; error: invalid argument: value of 'global_quota' is out of range [1000,
&gt;&gt; 18446744073709551]
&gt;&gt;
&gt;&gt; [1000, 18446744073709551]  - what this range mean?
&gt;&gt;
&gt;&gt;
&gt; These are the minimum and maximum values that were accepted by the
&gt; kernel at the time when this error message was implemented in libvirt.
&gt;
&gt; Jan
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Very  interesting!&lt;div&gt;I did this configuration and I can see my core \
working just in 25%.&lt;/div&gt;&lt;div&gt;I would like to try the same with memory.....I am \
looking for that.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks.&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-11-02 13:58 GMT-02:00 Ján \
Tomko &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:jtomko@redhat.com" \
target="_blank"&gt;jtomko@redhat.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;On Thu, Nov 02, \
2017 at 03:03:56PM +0200, Volo M. wrote:&lt;br&gt; &lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt; Hi techs,&lt;br&gt;
&lt;br&gt;
Could you please explain or refer me to documentation where I could find a&lt;br&gt;
description of global_quota schedinfo option. Someone told me that it could&lt;br&gt;
mean a cpu limitation in percents like:&lt;br&gt;
global_quota     : 25000 (does it mean cpu limit % set to 25   ?)&lt;br&gt;
&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;
The _quota values are relative to the _period, both in milliseconds and refer&lt;br&gt;
to the cumulative CPU time available to all the processes/threads in a group.&lt;br&gt;
&lt;br&gt;
See the documentation in the kernel:&lt;br&gt;
&lt;a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/Documentation/scheduler/sched-bwc.txt" \
rel="noreferrer" target="_blank"&gt;https://git.kernel.org/pub/scm&lt;wbr&gt;/linux/kernel/git/torvalds/lin&lt;wbr&gt;ux.git/tree/Documentation/sche&lt;wbr&gt;duler/sched-bwc.txt&lt;/a&gt;&lt;br&gt;
 &lt;br&gt;
So with global_period being set to 100000, a value of 25000 would mean&lt;br&gt;
that all the threads of the virtual machine would be limited to use at&lt;br&gt;
most 25 % of 1 CPU.&lt;br&gt;
&lt;br&gt;
&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt; Is it true?&lt;br&gt;
What other parameters mean in below output?&lt;br&gt;
I didn't find any related documentation at &lt;a href="http://libvirt.org" \
rel="noreferrer" target="_blank"&gt;libvirt.org&lt;/a&gt;.&lt;br&gt; Could you help me to describe \
me or refer to some description what below&lt;br&gt; schedinfo options mean? Thanks.&lt;br&gt;
&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;
[...]&lt;br&gt;
&lt;br&gt;
&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt; &lt;br&gt;
[root@cpkvm ~]# virsh schedinfo 3 --set global_quota=25&lt;br&gt;
&lt;br&gt;
Scheduler         : posix&lt;br&gt;
&lt;br&gt;
error: invalid argument: value of 'global_quota' is out of range [1000,&lt;br&gt;
18446744073709551]&lt;br&gt;
&lt;br&gt;
[1000, 18446744073709551]   - what this range mean?&lt;br&gt;
&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;
These are the minimum and maximum values that were accepted by the&lt;br&gt;
kernel at the time when this error message was implemented in libvirt.&lt;br&gt;
&lt;br&gt;
Jan&lt;br&gt;
&lt;br&gt;______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;
&lt;a href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/&lt;wbr&gt;mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;




</body></email><email><emailId>20171106202910</emailId><senderName>mxs kolo</senderName><senderEmail>kolomaxes@gmail.com</senderEmail><timestampReceived>2017-11-06 20:29:10-0400</timestampReceived><subject>[libvirt-users] Has libvirt guest pagecache level ?</subject><body>

 Greetings

Has libvirt dedicated page cache area for guest ?
If not - what is the difference between
cache='none' and cache='directsync' ?
&gt; The optional cache attribute controls the cache mechanism, possible &gt;values are \
&gt; "default", "none", "writethrough", "writeback", "directsync" &gt;(like "writethrough", \
&gt; but it bypasses the host page cache) and &gt;"unsafe" (host may cache all disk io, and \
&gt; sync requests from guest &gt;are ignored).
 As I understand  'unsafe' - always remove flags O_SYNC|O_DIRECT fron
guest level.
 What about other cache options - how it work ?
 Would be glad see any schema or description, if You have.

b.r.
 Maxim Kozin


</body></email><email><emailId>20171107080806</emailId><senderName>Marc-Aurèle Brothier - Exoscale</senderName><senderEmail>marco@exoscale.ch</senderEmail><timestampReceived>2017-11-07 08:08:06-0400</timestampReceived><subject>Re: [libvirt-users] Live Migration Issue</subject><body>

Hi,

I would suspect that you don't run the same version on the hosts and
you hit an incompatibilty issue.

Another question: does the SSH login works without passphrase?

Marc-AurÃ¨le

On Mon, 2017-11-06 at 08:43 -0500, Hans Knecht wrote:
&gt; Sorry, ctrl entered.
&gt;  
&gt; I'm hoping someone here can help me figure out what's going on here.
&gt;  
&gt; I've got two CentOS 7 hosts with shared storage that I'm trying to do
&gt; live migrations between and I'm running into an error with VMs that
&gt; were originally created on a CentOS 6 host and then moved the CentOS
&gt; 7 hosts. The CentOS 6 VM runs fine on the host, and can do non-live
&gt; migrations without any issues, however when attempting to live
&gt; migrate the VM it fails. The VM itself is CentOS 7. Live migration
&gt; does work when using VMs created using CentOS 7.
&gt;  
&gt; Error message:
&gt; "libvirtd virKeepAliveTimerInternal connection closed due to keep
&gt; alive timeout.
&gt; Cannot acquire state change lock (held by
&gt; remoteDispatchDomainMigratePrepare3params)"
&gt;  
&gt; Surrounding error messages here:
&gt; Origin Host: https://pastebin.com/fLN6DRiq
&gt; Recipient Host: https://pastebin.com/xR6mnaW2
&gt;  
&gt; The command being run is:
&gt; Virsh --connect qemu:///system migrate --live vmname
&gt; qemu+SSH://host2/system
&gt;  
&gt; Firewall is turned off, SELinux is turned off, CentOS 7 CPUs are
&gt; identical, both hosts fully updated.
&gt;  
&gt; I've tried:
&gt;  
&gt; Converting the VM from QCOW2 to Raw
&gt; Converting the VM from QCOW2 to QCOW2 to try to get it to regenerate
&gt; the XML/inject CentOS 7 Drivers
&gt; Installed new drivers
&gt; Updated all the packages in the VM.
&gt; Removed all the Devices from the VM, except the HDDs.
&gt;  
&gt;  
&gt; Hans Knecht â€“ DevOps Network Administrator
&gt; Kinsale Insurance Company  I  2221 Edward Holland Drive I  Suite 600 
&gt; I  Richmond, VA 23230
&gt; (804) 289-1300 x5102 office  I (804) 673-5697 fax I hans.knecht@kinsa
&gt; leins.com I www.kinsaleins.com
&gt;  
&gt; From: Hans Knecht [mailto:hans.knecht@kinsaleins.com] 
&gt; Sent: Monday, November 06, 2017 8:38 AM
&gt; To: 'libvirt-users@redhat.com' &lt;libvirt-users@redhat.com&gt;
&gt; Subject: Live Migration Issue
&gt;  
&gt; I'm hoping someone here can help me figure out what's going on here.
&gt;  
&gt; I've got two CentOS 7 hosts with shared storage that I'm trying to do
&gt; live migrations between and I'm running into an error with VMs that
&gt; were originally created on a CentOS 6 host and then moved the CentOS
&gt; 7 hosts. The CentOS 6 VM runs fine on the host, and can do non-live
&gt; migrations without any issues, however when attempting to live
&gt; migrate the VM it fails with the following error message:
&gt;  
&gt; Hans Knecht â€“ DevOps Network Administrator
&gt; Kinsale Insurance Company  I  2221 Edward Holland Drive I  Suite 600 
&gt; I  Richmond, VA 23230
&gt; (804) 289-1300 x5102 office  I (804) 673-5697 fax I hans.knecht@kinsa
&gt; leins.com I www.kinsaleins.com
&gt;  
&gt; This communication constitutes an electronic communication within the
&gt; meaning of the Electronic Communications Privacy Act, 19 USC 2510,
&gt; and its disclosure is strictly limited to the recipient intended by
&gt; the sender of this message. This communication may contain
&gt; confidential and privileged material for the sole use of the intended
&gt; recipient and the disclosure to anyone other than the intended
&gt; recipient does not constitute a loss of the confidential or
&gt; privileged nature of the communication. If you are not the intended
&gt; recipient, please contact the sender by return electronic mail and
&gt; delete all copies of this communication. Please check for any defects
&gt; or viruses before opening or using any attachments. There is no
&gt; warranty that this e-mail is virus free or without error.  No Kinsale
&gt; Company is liable if an attachment is altered without its written
&gt; consent. Thank you. 
&gt;  
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users

</body></email><email><emailId>20171107160228</emailId><senderName>John Ferlan</senderName><senderEmail>jferlan@redhat.com</senderEmail><timestampReceived>2017-11-07 16:02:28-0400</timestampReceived><subject>Re: [libvirt-users] this function is not supported by the connection driver: virInterfaceDefineXML</subject><body>



On 11/06/2017 09:13 PM, netsurfed wrote:
&gt; Hi all:
&gt; 
&gt; I'm facing problems trying to define a bridge on Ubuntu 16.04, using libvirt 3.4.0.
&gt; 
&gt; When I try to do:
&gt; root@ubuntu-180:/tmp# virsh iface-define iface-testbr1.xml
&gt; 
&gt; I get the following error:
&gt; error: Failed to define interface from iface-testbr1.xml
&gt; error: this function is not supported by the connection driver: \
&gt; virInterfaceDefineXML 

It's supported by the netcf interface backend.

What does "virsh -V" tell you?

In the "Networking:" line you'd see 'Interface netcf' - I have to assume
you have 'udev' instead.

&gt; What can i do to make this function works normally? THX.

If netcf isn't supported on Ubuntu, then that's a packaging thing.

John

&gt; 
&gt; The xml file as:
&gt; 
&gt; &lt;interface type='bridge' name='testbr1'&gt;
&gt; 
&gt; &lt;mtu size='1500'/&gt;
&gt; &lt;bridge stp='on' delay='1500'&gt;
&gt; &lt;interface type='ethernet' name='enp9s0'&gt;
&gt; &lt;link speed='1000' state='up'/&gt;
&gt; &lt;mac address='0c:c4:7a:c1:63:17'/&gt;
&gt; &lt;/interface&gt;
&gt; &lt;/bridge&gt;
&gt; &lt;/interface&gt;
&gt; 
&gt; root@ubuntu-180:/tmp# uname -a
&gt; Linux ubuntu-180 4.4.0-62-generic #83-Ubuntu SMP Wed Jan 18 14:10:15 UTC 2017 \
&gt; x86_64 x86_64 x86_64 GNU/Linux 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt; 


</body></email><email><emailId>20171107181428</emailId><senderName>Doug Hughes</senderName><senderEmail>doug.hughes@keystonenap.com</senderEmail><timestampReceived>2017-11-07 18:14:28-0400</timestampReceived><subject>Re: [libvirt-users] using LVM thin pool LVs as a storage for libvirt guest</subject><body>

Ditto for Qcow2. We use it on ZFS.

I do a snapshot-create-as to get the QCOW2 consistent image, then zfs
snapshot, then replicate to another host for backups. All the VMS have
consistent backups in this way.



On 11/7/2017 5:16 AM, Vasiliy Tolstov wrote:
&gt; Please don't use lvm thin for vm. In our hosting in Russia we have
&gt; 100-150 vps on each node with lvm thin pool on ssd and have locks,
&gt; slowdowns and other bad things because of COW. After we switching to
&gt; qcow2 files on plain ssd ext4 fs and happy =).
&gt;
&gt;
&gt; 2017-11-04 23:21 GMT+03:00 Jan Hutař &lt;jhutar@redhat.com&gt;:
&gt;&gt; Hello,
&gt;&gt; as usual, I'm few years behind trends so I have learned about LVM thin
&gt;&gt; volumes recently and I especially like that your volumes can be "sparse"
&gt;&gt; - that you can have 1TB thin volume on 250GB VG/thin pool.
&gt;&gt;
&gt;&gt; Is it somehow possible to use that with libvirt?
&gt;&gt;
&gt;&gt; I have found this post from 2014:
&gt;&gt;
&gt;&gt;    https://www.redhat.com/archives/libvirt-users/2014-August/msg00010.html
&gt;&gt;
&gt;&gt; which says you should be able to create "sparse" volume with `virsh
&gt;&gt; vol-create ...` or that libvirt should be able to see thin volumes you
&gt;&gt; create yourself, but neither of that works for me
&gt;&gt; (libvirt-3.2.1-6.fc26.x86_64).
&gt;&gt;
&gt;&gt; This way I try to create new:
&gt;&gt;
&gt;&gt;    # vgs storage
&gt;&gt;      VG      #PV #LV #SN Attr   VSize   VFree
&gt;&gt;      storage   1   1   0 wz--n- 267.93g    0    # lvs storage -a
&gt;&gt;      LV              VG      Attr       LSize   Pool Origin Data%  Meta%
&gt;&gt; Move Log Cpy%Sync Convert
&gt;&gt;      [lvol0_pmspare] storage ewi-------  68.00m
&gt;&gt; lvol1           storage twi-aotz-- 267.80g             0.00   0.44
&gt;&gt; [lvol1_tdata]   storage Twi-ao---- 267.80g
&gt;&gt; [lvol1_tmeta]   storage ewi-ao----  68.00m
&gt;&gt;    # virsh pool-dumpxml storage
&gt;&gt;    &lt;pool type='logical'&gt;
&gt;&gt;      &lt;name&gt;storage&lt;/name&gt;
&gt;&gt;      &lt;uuid&gt;f523aed2-a7e4-4dc2-88db-0193a7337704&lt;/uuid&gt;
&gt;&gt;      &lt;capacity unit='bytes'&gt;287687311360&lt;/capacity&gt;
&gt;&gt;      &lt;allocation unit='bytes'&gt;287687311360&lt;/allocation&gt;
&gt;&gt;      &lt;available unit='bytes'&gt;0&lt;/available&gt;
&gt;&gt;      &lt;source&gt;
&gt;&gt;        &lt;device path='/dev/nvme0n1p3'/&gt;
&gt;&gt;        &lt;name&gt;storage&lt;/name&gt;
&gt;&gt;        &lt;format type='lvm2'/&gt;
&gt;&gt;      &lt;/source&gt;
&gt;&gt;      &lt;target&gt;
&gt;&gt;        &lt;path&gt;/dev/storage&lt;/path&gt;
&gt;&gt;      &lt;/target&gt;
&gt;&gt;    &lt;/pool&gt;
&gt;&gt;    # cat /tmp/big.xml
&gt;&gt;    &lt;volume&gt;
&gt;&gt;      &lt;name&gt;big&lt;/name&gt;
&gt;&gt;      &lt;capacity&gt;1073741824&lt;/capacity&gt;
&gt;&gt;      &lt;allocation&gt;1048576&lt;/allocation&gt;
&gt;&gt;      &lt;target&gt;
&gt;&gt;        &lt;path&gt;/dev/storage/big&lt;/path&gt;
&gt;&gt;      &lt;/target&gt;
&gt;&gt;    &lt;/volume&gt;
&gt;&gt;    # virsh vol-create storage /tmp/big.xml    error: Failed to create vol
&gt;&gt; from /tmp/big.xml
&gt;&gt;    error: internal error: Child process (/usr/sbin/lvcreate --name big -L
&gt;&gt; 1024K --type snapshot --virtualsize 1048576K storage) unexpected exit status
&gt;&gt; 5:   Volume group "storage" has insufficient free space (0 extents): 1
&gt;&gt; required.
&gt;&gt;
&gt;&gt; When I create thin volume manually, I do not see it:
&gt;&gt;
&gt;&gt;    # lvcreate -n big -V 500G --thinpool storage/lvol1
&gt;&gt;      Using default stripesize 64.00 KiB.
&gt;&gt;      WARNING: Sum of all thin volume sizes (500.00 GiB) exceeds the size of
&gt;&gt; thin pool storage/lvol1 and the size of whole volume group (267.93 GiB)!
&gt;&gt;      For thin pool auto extension activation/thin_pool_autoextend_threshold
&gt;&gt; should be below 100.
&gt;&gt;      Logical volume "big" created.
&gt;&gt;    # lvs storage -a
&gt;&gt;      LV              VG      Attr       LSize   Pool  Origin Data%  Meta%
&gt;&gt; Move Log Cpy%Sync Convert
&gt;&gt;      big             storage Vwi-a-tz-- 500.00g lvol1        0.00
&gt;&gt; [lvol0_pmspare] storage ewi-------  68.00m
&gt;&gt; lvol1           storage twi-aotz-- 267.80g              0.00   0.45
&gt;&gt; [lvol1_tdata]   storage Twi-ao---- 267.80g
&gt;&gt; [lvol1_tmeta]   storage ewi-ao----  68.00m
&gt;&gt; # virsh vol-list storage
&gt;&gt;     Name                 Path
&gt;&gt; ------------------------------------------------------------------------------
&gt;&gt;
&gt;&gt;
&gt;&gt; Do I understand the concept incorrectly, or is there something else to
&gt;&gt; configure?
&gt;&gt;
&gt;&gt; At the end I want to get max IO performance with possibility to
&gt;&gt; "overcommit disk space". I know I can use storage "dir", but thought
&gt;&gt; there might be something faster?
&gt;&gt;
&gt;&gt; Thank you very much for a response,
&gt;&gt; Jan
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Jan Hutar     Systems Management QA
&gt;&gt; jhutar@redhat.com     Red Hat, Inc.
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; libvirt-users mailing list
&gt;&gt; libvirt-users@redhat.com
&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;
&gt;

-- 
Doug Hughes
Keystone NAP
Fairless Hills, PA
1.844.KEYBLOCK (539.2562) 	


[Attachment #3 (multipart/related)]

[Attachment #5 (text/html)]

&lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
  &lt;/head&gt;
  &lt;body text="#000000" bgcolor="#FFFFFF"&gt;
    &lt;p&gt;Ditto for Qcow2. We use it on ZFS.&lt;/p&gt;
    &lt;p&gt;I do a snapshot-create-as to get the QCOW2 consistent image, then
      zfs snapshot, then replicate to another host for backups. All the
      VMS have consistent backups in this way.&lt;/p&gt;
    &lt;p&gt;&lt;br&gt;
    &lt;/p&gt;
    &lt;br&gt;
    &lt;div class="moz-cite-prefix"&gt;On 11/7/2017 5:16 AM, Vasiliy Tolstov
      wrote:&lt;br&gt;
    &lt;/div&gt;
    &lt;blockquote type="cite"
cite="mid:CACaajQukaMFjwNaLZGKd51QdPjPL=st6qNckB9DHLTWq29XTXA@mail.gmail.com"&gt;
      &lt;pre wrap=""&gt;Please don't use lvm thin for vm. In our hosting in Russia we have
100-150 vps on each node with lvm thin pool on ssd and have locks,
slowdowns and other bad things because of COW. After we switching to
qcow2 files on plain ssd ext4 fs and happy =).


2017-11-04 23:21 GMT+03:00 Jan Hutař &lt;a class="moz-txt-link-rfc2396E" \
href="mailto:jhutar@redhat.com"&gt;&lt;jhutar@redhat.com&gt;&lt;/a&gt;: &lt;/pre&gt;
      &lt;blockquote type="cite"&gt;
        &lt;pre wrap=""&gt;Hello,
as usual, I'm few years behind trends so I have learned about LVM thin
volumes recently and I especially like that your volumes can be "sparse"
- that you can have 1TB thin volume on 250GB VG/thin pool.

Is it somehow possible to use that with libvirt?

I have found this post from 2014:

   &lt;a class="moz-txt-link-freetext" \
href="https://www.redhat.com/archives/libvirt-users/2014-August/msg00010.html"&gt;https://www.redhat.com/archives/libvirt-users/2014-August/msg00010.html&lt;/a&gt;


which says you should be able to create "sparse" volume with `virsh
vol-create ...` or that libvirt should be able to see thin volumes you
create yourself, but neither of that works for me
(libvirt-3.2.1-6.fc26.x86_64).

This way I try to create new:

   # vgs storage
     VG      #PV #LV #SN Attr   VSize   VFree
     storage   1   1   0 wz--n- 267.93g    0    # lvs storage -a
     LV              VG      Attr       LSize   Pool Origin Data%  Meta%
Move Log Cpy%Sync Convert
     [lvol0_pmspare] storage ewi-------  68.00m
lvol1           storage twi-aotz-- 267.80g             0.00   0.44
[lvol1_tdata]   storage Twi-ao---- 267.80g
[lvol1_tmeta]   storage ewi-ao----  68.00m
   # virsh pool-dumpxml storage
   &lt;pool type='logical'&gt;
     &lt;name&gt;storage&lt;/name&gt;
     &lt;uuid&gt;f523aed2-a7e4-4dc2-88db-0193a7337704&lt;/uuid&gt;
     &lt;capacity unit='bytes'&gt;287687311360&lt;/capacity&gt;
     &lt;allocation unit='bytes'&gt;287687311360&lt;/allocation&gt;
     &lt;available unit='bytes'&gt;0&lt;/available&gt;
     &lt;source&gt;
       &lt;device path='/dev/nvme0n1p3'/&gt;
       &lt;name&gt;storage&lt;/name&gt;
       &lt;format type='lvm2'/&gt;
     &lt;/source&gt;
     &lt;target&gt;
       &lt;path&gt;/dev/storage&lt;/path&gt;
     &lt;/target&gt;
   &lt;/pool&gt;
   # cat /tmp/big.xml
   &lt;volume&gt;
     &lt;name&gt;big&lt;/name&gt;
     &lt;capacity&gt;1073741824&lt;/capacity&gt;
     &lt;allocation&gt;1048576&lt;/allocation&gt;
     &lt;target&gt;
       &lt;path&gt;/dev/storage/big&lt;/path&gt;
     &lt;/target&gt;
   &lt;/volume&gt;
   # virsh vol-create storage /tmp/big.xml    error: Failed to create vol
from /tmp/big.xml
   error: internal error: Child process (/usr/sbin/lvcreate --name big -L
1024K --type snapshot --virtualsize 1048576K storage) unexpected exit status
5:   Volume group "storage" has insufficient free space (0 extents): 1
required.

When I create thin volume manually, I do not see it:

   # lvcreate -n big -V 500G --thinpool storage/lvol1
     Using default stripesize 64.00 KiB.
     WARNING: Sum of all thin volume sizes (500.00 GiB) exceeds the size of
thin pool storage/lvol1 and the size of whole volume group (267.93 GiB)!
     For thin pool auto extension activation/thin_pool_autoextend_threshold
should be below 100.
     Logical volume "big" created.
   # lvs storage -a
     LV              VG      Attr       LSize   Pool  Origin Data%  Meta%
Move Log Cpy%Sync Convert
     big             storage Vwi-a-tz-- 500.00g lvol1        0.00
[lvol0_pmspare] storage ewi-------  68.00m
lvol1           storage twi-aotz-- 267.80g              0.00   0.45
[lvol1_tdata]   storage Twi-ao---- 267.80g
[lvol1_tmeta]   storage ewi-ao----  68.00m
# virsh vol-list storage
    Name                 Path
------------------------------------------------------------------------------


Do I understand the concept incorrectly, or is there something else to
configure?

At the end I want to get max IO performance with possibility to
"overcommit disk space". I know I can use storage "dir", but thought
there might be something faster?

Thank you very much for a response,
Jan



--
Jan Hutar     Systems Management QA
&lt;a class="moz-txt-link-abbreviated" \
href="mailto:jhutar@redhat.com"&gt;jhutar@redhat.com&lt;/a&gt;     Red Hat, Inc.

_______________________________________________
libvirt-users mailing list
&lt;a class="moz-txt-link-abbreviated" \
href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt; &lt;a \
class="moz-txt-link-freetext" \
href="https://www.redhat.com/mailman/listinfo/libvirt-users"&gt;https://www.redhat.com/mailman/listinfo/libvirt-users&lt;/a&gt;
 &lt;/pre&gt;
      &lt;/blockquote&gt;
      &lt;pre wrap=""&gt;


&lt;/pre&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
    &lt;div class="moz-signature"&gt;-- &lt;br&gt;
      &lt;table&gt;
        &lt;tbody&gt;
          &lt;tr&gt;
            &lt;td style="padding-left: 20px" width="90%"&gt;Doug Hughes&lt;br&gt;
              Keystone NAP&lt;br&gt;
              Fairless Hills, PA&lt;br&gt;
              1.844.KEYBLOCK (539.2562)&lt;/td&gt;
            &lt;td style="align: right;padding-right: 20px"&gt;&lt;img
                src="cid:part1.561B528B.58787817@keystonenap.com"&gt;
            &lt;/td&gt;
          &lt;/tr&gt;
        &lt;/tbody&gt;
      &lt;/table&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;


["keystone-nap.png" (image/png)]

</body></email><email><emailId>20171113173331</emailId><senderName>mxs kolo</senderName><senderEmail>kolomaxes@gmail.com</senderEmail><timestampReceived>2017-11-13 17:33:31-0400</timestampReceived><subject>[libvirt-users] how to add mount options for root filesystem inside lxc container</subject><body>

 Hi all

We use libvirt 3.0.0 + lxc, disk for container described with
&lt;filesystem/&gt; tag, example:
 &lt;filesystem type='block' accessmode='passthrough'&gt;
      &lt;source dev='/dev/data/lvm-part1'/&gt;
      &lt;target dir='/'/&gt;
&lt;/filesystem&gt;
Now we start use ssd disk and think how to provide additional options
for mount root FS in container: "discard" and "nobarrier" options for
XFS.
All level below XFS configured for support trim command ("options
raid0 devices_discard_performance=Y" and "issue_discards = 1")
I try set options inside container in /etc/fstab, it's not worked:
/dev/root       /       rootfs  discard,nobarrier,defaults      0       0
or
/dev/root       /       rootfs  discard,nobarrier      0       0
or
/dev/root       /       rootfs  remount,discard,nobarrier,defaults
 0       0
or
/dev/root       /       rootfs  remount,discard,nobarrier      0       0

I found 2 solutions:
1) use 2 lvm partitions - one for base OS system, and second - for
data. Second lvs attach as block device /dev/vdX inside container.
Now we can mount /dev/vd? with desirable options inside container
2) more tricky variant - before container start, mount her root
filesystem on hardware node with desirable options. Then after
container started, her filesystem would be mounted with same options
as on hardware node.
But probably exists another way ? Has &lt;filesystem/&gt; support for mount options ?

b.r.
 Maxim Kozin

</body></email><email><emailId>20171113211359</emailId><senderName>xmbbb</senderName><senderEmail>xmbbb@protonmail.com</senderEmail><timestampReceived>2017-11-13 21:13:59-0400</timestampReceived><subject>[libvirt-users] KVM guest incorrect CPU frequency</subject><body>

[Attachment #2 (text/plain)]

Hello,

I am facing an issue where the detected CPU frequencies in KVM guests are incorrect.

I am using the new Core i9 7900x with base clock 3.3GHz with "host-passthrough". Both \
Win10 and Linux guests incorrectly detect 3.45GHz for some reason.

The workaround I have found is to temporarily switch to use HPET clocksource in the \
HOST before starting the VM. This makes the VMs correctly detect a 3.3GHz CPU. Then I \
can safely switch back to TSC in the VM HOST.

This mostly does not impact much for day to day use. The only reproducible bug I can \
find with an incorrect CPU frequency is playing Bink videos that come with PC games. \
If I play any Bink video cut scene from the 2013 Tomb Raider game with the incorrect \
CPU frequency, the video plays a little slower than intended which results in audio \
cut out once in a while so that the video can "catch up" to the audio.

Anyone having experiences with similar issues?


[Attachment #3 (text/html)]

&lt;div&gt;Hello,&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I am facing an issue where the detected CPU \
frequencies in KVM guests are incorrect. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I am using the \
new Core i9 7900x with base clock 3.3GHz with "host-passthrough". Both Win10 and \
Linux guests incorrectly detect 3.45GHz for some \
reason.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The workaround I have found is to temporarily \
switch to use HPET clocksource in the HOST before starting the VM. This makes the VMs \
correctly detect a 3.3GHz CPU. Then I can safely switch back to TSC in the VM \
HOST.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This mostly does not impact much for day to day \
use. The only reproducible bug I can find with an incorrect CPU frequency is playing \
Bink videos that come with PC games. If I play any Bink video cut scene from the 2013 \
Tomb Raider game with the incorrect CPU frequency, the video plays a little  slower \
than intended which results in audio cut out once in a while so that the video can \
"catch up" to the audio.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Anyone having experiences with \
similar issues?&lt;/div&gt;



</body></email><email><emailId>20171114015314</emailId><senderName>"Chenjia (C)"</senderName><senderEmail>chenjia09@huawei.com</senderEmail><timestampReceived>2017-11-14 01:53:14-0400</timestampReceived><subject>[libvirt-users] =?gb2312?b?SGVscKO6Q2FuIGxpYnZpcnQgcmVzdG9yZSBz?= =?gb2312?b?ZXZlcmFsIHhlbiBzbmFwc2h</subject><body>

[Attachment #2 (text/plain)]

Dear libvirt expert,

we find a blocker issue in our project. Would you please offer us some feedback?



Our project have a requirement: restore as much as xen snapshot at same time.   we \
have done the following test(our environment is cpu E52620,  256G memory, SSD hard \
disk. The xen snapshot is Win7 OS with 1G memory):

1)      Save 40 xen snapshots to disk, then restore these snapshot at sametime, we \
found the restore speed is too slow, and the bottleneck is the IO speed.

2)      we save all the 40 xen snapshot to ramdisk,  then we got a good performance, \
but the space is too big, about 40G, it is too expensive .



Our question is :

1)      each our xen snapshot is almost same except IP address(Win7 OS with 1G \
memory), does there have some way to reduce the 40 snapshots space? (we find the \
¡®virsh resotre¡¯ cmd have an argument ¡®¨Cxml¡¯ , but it seems not work in source \
code)

2)      Do you have some suggestion to improve the performance of restore as much as  \
xen snapshot at same time?



Best regards, wish your reply.


[Attachment #3 (text/html)]

&lt;html xmlns:v="urn:schemas-microsoft-com:vml" \
xmlns:o="urn:schemas-microsoft-com:office:office" \
xmlns:w="urn:schemas-microsoft-com:office:word" \
xmlns:x="urn:schemas-microsoft-com:office:excel" \
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" \
xmlns="http://www.w3.org/TR/REC-html40"&gt; &lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=gb2312"&gt;
&lt;meta name="Generator" content="Microsoft Word 15 (filtered medium)"&gt;
&lt;style&gt;&lt;!--
/* Font Definitions */
@font-face
	{font-family:ËÎÌå;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:"\@ËÎÌå";
	panose-1:2 1 6 0 3 1 1 1 1 1;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:#0563C1;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:#954F72;
	text-decoration:underline;}
p.MsoPlainText, li.MsoPlainText, div.MsoPlainText
	{mso-style-priority:99;
	mso-style-link:"´¿ÎÄ±¾ Char";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
span.Char
	{mso-style-name:"´¿ÎÄ±¾ Char";
	mso-style-priority:99;
	mso-style-link:´¿ÎÄ±¾;
	font-family:"Calibri",sans-serif;}
span.EmailStyle19
	{mso-style-type:personal;
	font-family:"Calibri",sans-serif;
	color:windowtext;}
span.EmailStyle20
	{mso-style-type:personal-reply;
	font-family:"Calibri",sans-serif;
	color:#1F497D;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-size:10.0pt;}
@page WordSection1
	{size:612.0pt 792.0pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;}
div.WordSection1
	{page:WordSection1;}
/* List Definitions */
@list l0
	{mso-list-id:1378964942;
	mso-list-type:hybrid;
	mso-list-template-ids:167829100 -465655050 67698713 67698715 67698703 67698713 \
67698715 67698703 67698713 67698715;} @list l0:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:54.0pt;
	text-indent:-18.0pt;}
@list l0:level2
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:90.0pt;
	text-indent:-18.0pt;}
@list l0:level3
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:right;
	margin-left:126.0pt;
	text-indent:-9.0pt;}
@list l0:level4
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:162.0pt;
	text-indent:-18.0pt;}
@list l0:level5
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:198.0pt;
	text-indent:-18.0pt;}
@list l0:level6
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:right;
	margin-left:234.0pt;
	text-indent:-9.0pt;}
@list l0:level7
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:270.0pt;
	text-indent:-18.0pt;}
@list l0:level8
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:306.0pt;
	text-indent:-18.0pt;}
@list l0:level9
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:right;
	margin-left:342.0pt;
	text-indent:-9.0pt;}
@list l1
	{mso-list-id:1594628942;
	mso-list-type:hybrid;
	mso-list-template-ids:-838446970 1166844666 67698713 67698715 67698703 67698713 \
67698715 67698703 67698713 67698715;} @list l1:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:54.0pt;
	text-indent:-18.0pt;}
@list l1:level2
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:90.0pt;
	text-indent:-18.0pt;}
@list l1:level3
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:right;
	margin-left:126.0pt;
	text-indent:-9.0pt;}
@list l1:level4
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:162.0pt;
	text-indent:-18.0pt;}
@list l1:level5
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:198.0pt;
	text-indent:-18.0pt;}
@list l1:level6
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:right;
	margin-left:234.0pt;
	text-indent:-9.0pt;}
@list l1:level7
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:270.0pt;
	text-indent:-18.0pt;}
@list l1:level8
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:306.0pt;
	text-indent:-18.0pt;}
@list l1:level9
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:right;
	margin-left:342.0pt;
	text-indent:-9.0pt;}
ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
--&gt;&lt;/style&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapedefaults v:ext="edit" spidmax="1026" /&gt;
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapelayout v:ext="edit"&gt;
&lt;o:idmap v:ext="edit" data="1" /&gt;
&lt;/o:shapelayout&gt;&lt;/xml&gt;&lt;![endif]--&gt;
&lt;/head&gt;
&lt;body lang="EN-US" link="#0563C1" vlink="#954F72"&gt;
&lt;div class="WordSection1"&gt;
&lt;p class="MsoPlainText"&gt;Dear libvirt expert,&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoPlainText" style="text-indent:36.0pt"&gt;we find a blocker issue in our \
project. Would you please offer us some feedback?&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p \
class="MsoPlainText" style="text-indent:36.0pt"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt; &lt;p \
class="MsoPlainText" style="text-indent:36.0pt"&gt;Our project have a requirement: \
restore as much as xen snapshot at same time.   we have done the following \
test(our environment is cpu E52620,  256G memory, SSD hard disk. The xen \
snapshot is Win7 OS with 1G  memory):&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoPlainText" style="margin-left:54.0pt;text-indent:-18.0pt;mso-list:l1 \
level1 lfo2"&gt; &lt;![if !supportLists]&gt;&lt;span style="mso-list:Ignore"&gt;1)&lt;span \
style="font:7.0pt "Times New Roman""&gt;      \
&lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;Save 40 xen snapshots to disk, then restore these snapshot at \
sametime, we found the restore speed is too slow, and the bottleneck is the IO \
speed.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p class="MsoPlainText" \
style="margin-left:54.0pt;text-indent:-18.0pt;mso-list:l1 level1 lfo2"&gt; &lt;![if \
!supportLists]&gt;&lt;span style="mso-list:Ignore"&gt;2)&lt;span style="font:7.0pt "Times \
New Roman""&gt;      &lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;we save all \
the 40 xen snapshot to ramdisk,  then we got a good performance, but the space \
is too big, about 40G, it is too expensive .&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p class="MsoPlainText" \
style="margin-left:36.0pt"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt; &lt;p class="MsoPlainText" \
style="margin-left:36.0pt"&gt;Our question is :&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p class="MsoPlainText" \
style="margin-left:54.0pt;text-indent:-18.0pt;mso-list:l0 level1 lfo4"&gt; &lt;![if \
!supportLists]&gt;&lt;span style="mso-list:Ignore"&gt;1)&lt;span style="font:7.0pt "Times \
New Roman""&gt;      &lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;each our xen \
snapshot is almost same except IP address(Win7 OS with 1G memory), does there have \
some way to reduce the 40 snapshots space? &lt;span style="color:#1F497D"&gt;(we find the \
¡®virsh resotre¡¯ cmd have an argument ¡®¨Cxml¡¯ , but it seems not work in source \
code)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p class="MsoPlainText" \
style="margin-left:54.0pt;text-indent:-18.0pt;mso-list:l0 level1 lfo4"&gt; &lt;![if \
!supportLists]&gt;&lt;span style="mso-list:Ignore"&gt;2)&lt;span style="font:7.0pt "Times \
New Roman""&gt;      &lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;Do you have \
some suggestion to improve the performance of restore as much as  xen snapshot \
at same time?&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p class="MsoPlainText"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoPlainText"&gt;Best regards, wish your reply.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoPlainText"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoPlainText"&gt;        &lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20171106133817</emailId><senderName>Hans Knecht</senderName><senderEmail>hans.knecht@kinsaleins.com</senderEmail><timestampReceived>2017-11-06 13:38:17-0400</timestampReceived><subject>[libvirt-users] Live Migration Issue</subject><body>

This is a multipart message in MIME format.
[Attachment #2 (multipart/alternative)]


I'm hoping someone here can help me figure out what's going on here.

 

I've got two CentOS 7 hosts with shared storage that I'm trying to do live
migrations between and I'm running into an error with VMs that were
originally created on a CentOS 6 host and then moved the CentOS 7 hosts.
The CentOS 6 VM runs fine on the host, and can do non-live migrations
without any issues, however when attempting to live migrate the VM it
fails with the following error message:

 

Hans Knecht - DevOps Network Administrator

Kinsale Insurance Company  I  2221 Edward Holland Drive I  Suite 600  I
Richmond, VA 23230

(804) 289-1300 x5102 office  I (804) 673-5697 fax I
&lt;mailto:hans.knecht@kinsaleins.com&gt; hans.knecht@kinsaleins.com I
www.kinsaleins.com

 &lt;http://www.kinsaleins.com/&gt;   

This communication constitutes an electronic communication within the
meaning of the Electronic Communications Privacy Act, 19 USC 2510, and its
disclosure is strictly limited to the recipient intended by the sender of
this message. This communication may contain confidential and privileged
material for the sole use of the intended recipient and the disclosure to
anyone other than the intended recipient does not constitute a loss of the
confidential or privileged nature of the communication. If you are not the
intended recipient, please contact the sender by return electronic mail
and delete all copies of this communication. Please check for any defects
or viruses before opening or using any attachments. There is no warranty
that this e-mail is virus free or without error.  No Kinsale Company is
liable if an attachment is altered without its written consent. Thank you.


 


[Attachment #5 (text/html)]

&lt;html xmlns:v="urn:schemas-microsoft-com:vml" \
xmlns:o="urn:schemas-microsoft-com:office:office" \
xmlns:w="urn:schemas-microsoft-com:office:word" \
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" \
xmlns="http://www.w3.org/TR/REC-html40"&gt;&lt;head&gt;&lt;META HTTP-EQUIV="Content-Type" \
CONTENT="text/html; charset=us-ascii"&gt;&lt;meta name=Generator content="Microsoft Word 15 \
(filtered medium)"&gt;&lt;!--[if !mso]&gt;&lt;style&gt;v\:* {behavior:url(#default#VML);} o\:* \
{behavior:url(#default#VML);} w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
&lt;/style&gt;&lt;![endif]--&gt;&lt;style&gt;&lt;!--
/* Font Definitions */
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:"Arial Narrow";
	panose-1:2 11 6 6 2 2 2 3 2 4;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:#0563C1;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:#954F72;
	text-decoration:underline;}
span.EmailStyle17
	{mso-style-type:personal-compose;
	font-family:"Calibri",sans-serif;
	color:windowtext;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-family:"Calibri",sans-serif;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
--&gt;&lt;/style&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapedefaults v:ext="edit" spidmax="1026" /&gt;
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapelayout v:ext="edit"&gt;
&lt;o:idmap v:ext="edit" data="1" /&gt;
&lt;/o:shapelayout&gt;&lt;/xml&gt;&lt;![endif]--&gt;&lt;/head&gt;&lt;body lang=EN-US link="#0563C1" \
vlink="#954F72"&gt;&lt;div class=WordSection1&gt;&lt;p class=MsoNormal&gt;I’m hoping someone \
here can help me figure out what’s going on here.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;I’ve got two CentOS 7 \
hosts with shared storage that I’m trying to do live migrations between and \
I’m running into an error with VMs that were originally created on a CentOS 6 \
host and then moved the CentOS 7 hosts. The CentOS 6 VM runs fine on the host, and \
can do non-live migrations without any issues, however when attempting to live \
migrate the VM it fails with the following error message:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;b&gt;&lt;span \
style='font-size:10.5pt;font-family:"Arial Narrow",sans-serif;color:#1F497D'&gt;Hans \
Knecht – DevOps Network Administrator&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/b&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;span style='font-size:10.5pt;font-family:"Arial \
Narrow",sans-serif;color:#1F497D'&gt;Kinsale Insurance Company  I  2221 Edward \
Holland Drive I  Suite 600  I  Richmond, VA \
23230&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;span \
style='font-size:10.5pt;font-family:"Arial Narrow",sans-serif;color:#1F497D'&gt;(804) \
289-1300 x5102 office  I (804) 673-5697 fax I &lt;/span&gt;&lt;a \
href="mailto:hans.knecht@kinsaleins.com"&gt;&lt;span \
style='font-size:10.5pt;font-family:"Arial \
Narrow",sans-serif;color:blue'&gt;hans.knecht@kinsaleins.com&lt;/span&gt;&lt;/a&gt;&lt;span \
style='font-size:10.5pt;font-family:"Arial Narrow",sans-serif;color:#1F497D'&gt; I \
&lt;/span&gt;&lt;a href="www.kinsaleins.com"&gt;&lt;span style='font-size:10.5pt;font-family:"Arial \
Narrow",sans-serif;color:blue'&gt;www.kinsaleins.com&lt;/span&gt;&lt;/a&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;a href="http://www.kinsaleins.com/"&gt;&lt;span \
style='color:windowtext;text-decoration:none'&gt;&lt;img border=0 width=219 height=85 \
id="Picture_x0020_2" src="cid:image001.jpg@01D356DA.97E23540" \
alt="KinsaleInsurance__logo.jpg"&gt;&lt;/span&gt;&lt;/a&gt;  &lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;span \
style='font-size:8.0pt;font-family:"Arial",sans-serif;color:#7F7F7F'&gt;This \
communication constitutes an electronic communication within the meaning of the \
Electronic Communications Privacy Act, 19 USC 2510, and its disclosure is strictly \
limited to the recipient intended by the sender of this message. This communication \
may contain confidential and privileged material for the sole use of the intended \
recipient and the disclosure to anyone other than the intended recipient does not \
constitute a loss of the confidential or privileged nature of the communication. If \
you are not the intended recipient, please contact the sender by return electronic \
mail and delete all copies of this communication. Please check for any defects or \
viruses before opening or using any attachments. There is no warranty that this \
e-mail is virus free or without error.  No Kinsale Company is liable if an \
attachment is altered without its written consent. Thank you.  \
&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;


["image001.jpg" (image/jpeg)]

</body></email><email><emailId>20171104202135</emailId><senderName>Jan =?utf-8?B?SHV0YcWZ?=</senderName><senderEmail>jhutar@redhat.com</senderEmail><timestampReceived>2017-11-04 20:21:35-0400</timestampReceived><subject>[libvirt-users] using LVM thin pool LVs as a storage for libvirt guest</subject><body>

Hello,
as usual, I'm few years behind trends so I have learned about LVM thin
volumes recently and I especially like that your volumes can be "sparse"
- that you can have 1TB thin volume on 250GB VG/thin pool.

Is it somehow possible to use that with libvirt?

I have found this post from 2014:

    https://www.redhat.com/archives/libvirt-users/2014-August/msg00010.html

which says you should be able to create "sparse" volume with `virsh
vol-create ...` or that libvirt should be able to see thin volumes you
create yourself, but neither of that works for me
(libvirt-3.2.1-6.fc26.x86_64).

This way I try to create new:

    # vgs storage
      VG      #PV #LV #SN Attr   VSize   VFree
      storage   1   1   0 wz--n- 267.93g    0 
    # lvs storage -a
      LV              VG      Attr       LSize   Pool Origin Data%  Meta%  Move Log \
                Cpy%Sync Convert
      [lvol0_pmspare] storage ewi-------  68.00m                                      \
                
      lvol1           storage twi-aotz-- 267.80g             0.00   0.44              \
                
      [lvol1_tdata]   storage Twi-ao---- 267.80g                                      \
  [lvol1_tmeta]   storage ewi-ao----  68.00m
    # virsh pool-dumpxml storage
    &lt;pool type='logical'&gt;
      &lt;name&gt;storage&lt;/name&gt;
      &lt;uuid&gt;f523aed2-a7e4-4dc2-88db-0193a7337704&lt;/uuid&gt;
      &lt;capacity unit='bytes'&gt;287687311360&lt;/capacity&gt;
      &lt;allocation unit='bytes'&gt;287687311360&lt;/allocation&gt;
      &lt;available unit='bytes'&gt;0&lt;/available&gt;
      &lt;source&gt;
        &lt;device path='/dev/nvme0n1p3'/&gt;
        &lt;name&gt;storage&lt;/name&gt;
        &lt;format type='lvm2'/&gt;
      &lt;/source&gt;
      &lt;target&gt;
        &lt;path&gt;/dev/storage&lt;/path&gt;
      &lt;/target&gt;
    &lt;/pool&gt;
    # cat /tmp/big.xml
    &lt;volume&gt;
      &lt;name&gt;big&lt;/name&gt;
      &lt;capacity&gt;1073741824&lt;/capacity&gt;
      &lt;allocation&gt;1048576&lt;/allocation&gt;
      &lt;target&gt;
        &lt;path&gt;/dev/storage/big&lt;/path&gt;
      &lt;/target&gt;
    &lt;/volume&gt;
    # virsh vol-create storage /tmp/big.xml 
    error: Failed to create vol from /tmp/big.xml
    error: internal error: Child process (/usr/sbin/lvcreate --name big -L 1024K \
--type snapshot --virtualsize 1048576K storage) unexpected exit status 5:   Volume \
group "storage" has insufficient free space (0 extents): 1 required.

When I create thin volume manually, I do not see it:

    # lvcreate -n big -V 500G --thinpool storage/lvol1
      Using default stripesize 64.00 KiB.
      WARNING: Sum of all thin volume sizes (500.00 GiB) exceeds the size of thin \
                pool storage/lvol1 and the size of whole volume group (267.93 GiB)!
      For thin pool auto extension activation/thin_pool_autoextend_threshold should \
be below 100.  Logical volume "big" created.
    # lvs storage -a
      LV              VG      Attr       LSize   Pool  Origin Data%  Meta%  Move Log \
                Cpy%Sync Convert
      big             storage Vwi-a-tz-- 500.00g lvol1        0.00                    \
                
      [lvol0_pmspare] storage ewi-------  68.00m                                      \
                
      lvol1           storage twi-aotz-- 267.80g              0.00   0.45             \
                
      [lvol1_tdata]   storage Twi-ao---- 267.80g                                      \
                
      [lvol1_tmeta]   storage ewi-ao----  68.00m                                      \
  # virsh vol-list storage
     Name                 Path                                    
    ------------------------------------------------------------------------------


Do I understand the concept incorrectly, or is there something else to
configure?

At the end I want to get max IO performance with possibility to
"overcommit disk space". I know I can use storage "dir", but thought
there might be something faster?

Thank you very much for a response,
Jan



-- 
Jan Hutar     Systems Management QA
jhutar@redhat.com     Red Hat, Inc.


</body></email><email><emailId>20171114172356</emailId><senderName>Blair Bethwaite</senderName><senderEmail>blair.bethwaite@gmail.com</senderEmail><timestampReceived>2017-11-14 17:23:56-0400</timestampReceived><subject>[libvirt-users] dramatic performance slowdown due to THP allocation failure with full pagecache</subject><body>

Hi all,

This is not really a libvirt issue but I'm hoping some of the smart folks
here will know more about this problem...

We have noticed when running some HPC applications on our OpenStack
(libvirt+KVM) cloud that the same application occasionally performs much
worse (4-5x slowdown) than normal. We can reproduce this quite easily by
filling pagecache (i.e. dd-ing a single large file to /dev/null) before
running the application. The problem seems to be that the kernel is not
freeing (or has some trouble freeing) the non-dirty and (presumably
immediately) reclaimable pagecache in order to allocate THPs for the
application.

This behaviour is also observable on regular bare-metal, but the slowdown
is only 10-20% there - the nested paging of the guest really makes THP
allocation important there (1). Both current CentOS and Ubuntu guests have
the issue. Some more environmental context: the VMs are tuned (CPU pinning,
NUMA topology, hugepage backing), so we normally see no difference between
host and guest performance.

After talking to many other colleagues in the HPC space it seems common
that people setup their batch schedulers to put drop_caches between jobs,
which can help to workaround this and other similar issues, but no-one has
been able to explain why this is happening. Hopefully someone who knows
about the guts of the Linux MM can shed some light...?

(1) a related and possibly dumb question: in the case of a high-performance
KVM where the guest is hugepage backed and pinned in host memory anyway,
why do we still have a table based resolution for guest physical to host
virtual address translation - couldn't this just be done by offset?

-- 
Cheers,
~Blairo

[Attachment #3 (text/html)]

&lt;div dir="auto"&gt;Hi all,&lt;br&gt;&lt;br&gt;This is not really a libvirt issue but I'm hoping \
some of the smart folks here will know more about this problem...&lt;br&gt;&lt;br&gt;We have \
noticed when running some HPC applications on our OpenStack (libvirt+KVM) cloud that \
the same application occasionally performs much worse (4-5x slowdown) than normal. We \
can reproduce this quite easily by filling pagecache (i.e. dd-ing a single large file \
to /dev/null) before running the application. The problem seems to be that the kernel \
is not freeing (or has some trouble freeing) the non-dirty and (presumably \
immediately) reclaimable pagecache in order to allocate THPs for the \
application.&lt;br&gt;&lt;br&gt;This behaviour is also observable on regular bare-metal, but the \
slowdown is only 10-20% there - the nested paging of the guest really makes THP \
allocation important there (1). Both current CentOS and Ubuntu guests have the issue. \
Some more environmental context: the VMs are tuned (CPU pinning, NUMA topology, \
hugepage backing), so we normally see no difference between host and guest \
performance.&lt;br&gt;&lt;br&gt;After talking to many other colleagues in the HPC space it seems \
common that people setup their batch schedulers to put drop_caches between jobs, \
which can help to workaround this and other similar issues, but no-one has been able \
to explain why this is happening. Hopefully someone who knows about the guts of the \
Linux MM can shed some light...?&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;(1) a \
related and possibly dumb question: in the case of a high-performance KVM where the \
guest is hugepage backed and pinned in host memory anyway, why do we still have a \
table based resolution for guest physical to host virtual address translation - \
couldn't this just be done by offset?&lt;br&gt;&lt;br&gt;-- \
&lt;br&gt;Cheers,&lt;br&gt;~Blairo&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20171114173245</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-11-14 17:32:45-0400</timestampReceived><subject>Re: [libvirt-users] dramatic performance slowdown due to THP allocation failure with full pagecache</subject><body>

On Tue, Nov 14, 2017 at 10:23:56AM -0700, Blair Bethwaite wrote:
&gt; Hi all,
&gt; 
&gt; This is not really a libvirt issue but I'm hoping some of the smart folks
&gt; here will know more about this problem...
&gt; 
&gt; We have noticed when running some HPC applications on our OpenStack
&gt; (libvirt+KVM) cloud that the same application occasionally performs much
&gt; worse (4-5x slowdown) than normal. We can reproduce this quite easily by
&gt; filling pagecache (i.e. dd-ing a single large file to /dev/null) before
&gt; running the application. The problem seems to be that the kernel is not
&gt; freeing (or has some trouble freeing) the non-dirty and (presumably
&gt; immediately) reclaimable pagecache in order to allocate THPs for the
&gt; application.
&gt; 
&gt; This behaviour is also observable on regular bare-metal, but the slowdown
&gt; is only 10-20% there - the nested paging of the guest really makes THP
&gt; allocation important there (1). Both current CentOS and Ubuntu guests have
&gt; the issue. Some more environmental context: the VMs are tuned (CPU pinning,
&gt; NUMA topology, hugepage backing), so we normally see no difference between
&gt; host and guest performance.
&gt; 
&gt; After talking to many other colleagues in the HPC space it seems common
&gt; that people setup their batch schedulers to put drop_caches between jobs,
&gt; which can help to workaround this and other similar issues, but no-one has
&gt; been able to explain why this is happening. Hopefully someone who knows
&gt; about the guts of the Linux MM can shed some light...?

Transparent huge pages were never intended to provide any guarantees of
performance for applications. They are essentially an optimization so that if
there is free RAM, huge pages can be opportunistically given to a process even
if it didn't ask for them. This gives KVM some improved performance in the
default "out of the box" scenario where the user hasn't taken time to manually
optimize setting.

The kernel can't predict the future usage pattern of processes so it is not at
all clear cut that evicting the entire pagecache in order to allocate more
huge pages is going to be beneficial for system performance as a whole.

IOW, if your application has a certain expectation of performance that can only
be satisfied by having the KVM guest backed by huge pages, then you should
really change to explicitly reserve huge pages for the guests, and not rely on
THP which inherantly can't provide any guarantee in this area.

&gt; (1) a related and possibly dumb question: in the case of a high-performance
&gt; KVM where the guest is hugepage backed and pinned in host memory anyway,
&gt; why do we still have a table based resolution for guest physical to host
&gt; virtual address translation - couldn't this just be done by offset?


Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20171114175203</emailId><senderName>Blair Bethwaite</senderName><senderEmail>blair.bethwaite@gmail.com</senderEmail><timestampReceived>2017-11-14 17:52:03-0400</timestampReceived><subject>Re: [libvirt-users] dramatic performance slowdown due to THP allocation failure with full pagecache</subject><body>

Thanks for the reply Daniel,

However I think you slightly misunderstood the scenario...

On 14 November 2017 at 10:32, Daniel P. Berrange &lt;berrange@redhat.com&gt; wrote:
&gt; IOW, if your application has a certain expectation of performance that can only
&gt; be satisfied by having the KVM guest backed by huge pages, then you should
&gt; really change to explicitly reserve huge pages for the guests, and not rely on
&gt; THP which inherantly can't provide any guarantee in this area.

We already do this. The problem is not hugepage backing of the guest,
it is THP allocation inside the guest (or indeed on a bare-metal
host). The issue in the HPC world is that we support so many different
applications (some of which are complete black-boxes) that explicit
hugepage allocation for application memory is generally not viable, so
we are reliant on THP to avoid TLB thrashing.

&gt; The kernel can't predict the future usage pattern of processes so it is not at
&gt; all clear cut that evicting the entire pagecache in order to allocate more
&gt; huge pages is going to be beneficial for system performance as a whole.

Yet the default behaviour seems to be to stall on fault, then directly
reclaim and defrag in order to allocate a hugepage if at all possible.
In my test-case there is almost no free memory, so some pagecache has
to be reclaimed for the process, I don't understand why the THP
allocation fails in this case versus when pagecache is lower though.

-- 
Cheers,
~Blairo

</body></email><email><emailId>20171114174704</emailId><senderName>Holger Schranz</senderName><senderEmail>holger@fam-schranz.de</senderEmail><timestampReceived>2017-11-14 17:47:04-0400</timestampReceived><subject>[libvirt-users] Urgent: virsh - change-media run into a promptly close of libvirt</subject><body>

Hello,

I use the virsh change-media command and since the combination of:

etcsvms5:/kvm/CS8400/M1 # virsh version
Compiled against library: libvirt 3.9.0
Using library: libvirt 3.9.0
Using API: QEMU 3.9.0
Running hypervisor: QEMU 2.10.1

etcsvms5:/kvm/CS8400/M1 #

I got the following problem:

----------------------

etcsvms5:/kvm/CS8400/M1 # virsh change-media S5VCS84M1-VLP0 hdc --eject
Successfully ejected media.

etcsvms5:/kvm/CS8400/M1 # virsh change-media S5VCS84M1-VLP0 hdc 
/home/kvm/etcsdvmb/Medien/V7.0A/CS_licenses/key-cd_VCS85FTSVTL.iso --insert
error: Disconnected from qemu:///system due to end of file
error: Failed to complete action insert on media
error: End of file while reading data: Input/output error

----------------------

journalctl -b | less shows the following:

Nov 14 10:11:32 etcsvms5 kernel: libvirtd[10178]: segfault at 10 ip 
00007f49ff969170 sp 00007f4a069cb940 error 4 in 
libvirt_driver_qemu.so[7f49ff8d9000+172000]
Nov 14 10:11:37 etcsvms5 systemd-coredump[42152]: Process 10177 
(libvirtd) of user 0 dumped core.

----------------------

At the end all open consoles of all virtual machines closed and the 
virt-manager also.
A restart of the libvirtd is possible but not helpful

The virsh change-media commands are in procedure andused since a long time.
I need the change-media function at the installation of our test systems.
Therefor I need an urgent help please

Best regards

Holger




---
Diese E-Mail wurde von Avast Antivirus-Software auf Viren geprüft.
https://www.avast.com/antivirus


</body></email><email><emailId>20171108064235</emailId><senderName>Han Han</senderName><senderEmail>hhan@redhat.com</senderEmail><timestampReceived>2017-11-08 06:42:35-0400</timestampReceived><subject>[libvirt-users] Does libvirt-sanlock support network disk?</subject><body>

Hello,
As we know, libvirt sanlock support file type storage. I wonder *if it
supports network storage.*
I tried *iSCSI*, but found it didn't generate any resource file:
Version: *qemu-2.10 libvirt-3.9 sanlock-3.5*
1. Set configuration:
qemu.conf:
*lock_manager = "sanlock"*

qemu-sanlock.conf:




*auto_disk_leases = 1disk_lease_dir = "/var/lib/libvirt/sanlock"host_id =
1user = "sanlock"group = "sanlock"*

# systemctl restart sanlock
# systemctl restart libvirtd

2. Start a VM with iSCSI disk and check
*resource file*
VM disk xml:
    &lt;disk type='network' device='disk'&gt;
      &lt;driver name='qemu' type='raw'/&gt;
      &lt;source protocol='iscsi'
name='iqn.2003-01.org.linux-iscsi.localhost.x8664:sn.cb4bfb00df2f/0'&gt;
        &lt;host name='xx.xx.xx.xx' port='3260'/&gt;
      &lt;/source&gt;
      &lt;target dev='vda' bus='virtio'/&gt;
      &lt;alias name='virtio-disk0'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x07'
function='0x0'/&gt;
    &lt;/disk&gt;

Start VM:
# virsh start iscsi
Domain iscsi started

Check resource file:
# ls  /var/lib/libvirt/sanlock
__LIBVIRT__DISKS__

No resource file generated.

So, does libvirt sanlock only support file or block type storage?



-- 
Han Han
Quality Engineer
Redhat.

Email: hhan@redhat.com
Phone: +861065339333

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hello, &lt;br&gt;&lt;/div&gt;As we know, libvirt sanlock \
support file type storage. I wonder &lt;b&gt;if it supports network storage.&lt;/b&gt;&lt;br&gt;&lt;/div&gt;I \
tried &lt;b&gt;iSCSI&lt;/b&gt;, but found it didn't generate any resource \
file:&lt;br&gt;&lt;/div&gt;&lt;div&gt;Version: &lt;b&gt;qemu-2.10 libvirt-3.9 sanlock-3.5&lt;/b&gt; &lt;br&gt;&lt;/div&gt;1. \
Set configuration:&lt;br&gt;&lt;/div&gt;qemu.conf:&lt;br&gt;&lt;i&gt;lock_manager = \
"sanlock"&lt;/i&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;qemu-sanlock.conf:&lt;br&gt;&lt;i&gt;auto_disk_leases = \
1&lt;br&gt;disk_lease_dir = "/var/lib/libvirt/sanlock"&lt;br&gt;host_id = 1&lt;br&gt;user = \
"sanlock"&lt;br&gt;group = "sanlock"&lt;/i&gt;&lt;br \
clear="all"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;# systemctl \
restart sanlock&lt;br&gt;# systemctl restart libvirtd&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2. Start a VM with \
iSCSI disk and check &lt;b&gt;resource file&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;VM disk xml:&lt;br&gt;       \
&lt;disk type='network' device='disk'&gt;&lt;br&gt;           &lt;driver \
name='qemu' type='raw'/&gt;&lt;br&gt;           &lt;source \
protocol='iscsi' \
name='iqn.2003-01.org.linux-iscsi.localhost.x8664:sn.cb4bfb00df2f/0'&gt;&lt;br&gt;  \
&lt;host name='xx.xx.xx.xx' port='3260'/&gt;&lt;br&gt;           \
&lt;/source&gt;&lt;br&gt;           &lt;target dev='vda' \
bus='virtio'/&gt;&lt;br&gt;           &lt;alias \
name='virtio-disk0'/&gt;&lt;br&gt;           &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x07' \
function='0x0'/&gt;&lt;br&gt;       &lt;/disk&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Start VM:&lt;br&gt;# \
virsh start iscsi&lt;br&gt;Domain iscsi started&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Check resource file:&lt;br&gt;# \
ls   /var/lib/libvirt/sanlock &lt;br&gt;__LIBVIRT__DISKS__&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;No resource \
file generated. &lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So, does libvirt sanlock only support file or \
block type storage?&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;-- \
&lt;br&gt;&lt;div class="gmail_signature"&gt;&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div dir="ltr"&gt;Han \
Han&lt;br&gt;Quality Engineer&lt;br&gt;Redhat.&lt;br&gt;&lt;br&gt;Email: &lt;a href="mailto:hhan@redhat.com" \
target="_blank"&gt;hhan@redhat.com&lt;/a&gt;&lt;br&gt;Phone: \
+861065339333&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20171115142448</emailId><senderName>Branimir Pejakovic</senderName><senderEmail>branimirp@gmail.com</senderEmail><timestampReceived>2017-11-15 14:24:48-0400</timestampReceived><subject>[libvirt-users] virtlock - a VM goes read-only</subject><body>

Dear colleagues,

I am facing a problem that has been troubling me for last week and a half.
Please if you are able to help or offer some guidance.

I have a non-prod POC environment with 2 CentOS7 fully updated hypervisors
and an NFS filer that serves as a VM image storage. The overall environment
works exceptionally well. However, starting a few weeks ago I have been
trying to implement virtlock in order to prevent a VM running on 2
hypervisors at the same time.

Here is the description how the environment looks like in terms of virtlock
configuration on both hypervisors:

-- Content of /etc/libvirt/qemu.conf --
lock_manager = "lockd"

Only the above line is uncommented for direct locking.

# libvirtd --version; python -c "import platform;
print(platform.platform())"; virtlockd -V
libvirtd (libvirt) 3.2.0
Linux-3.10.0-693.2.2.el7.x86_64-x86_64-with-centos-7.4.1708-Core
virtlockd (libvirt) 3.2.0

# getenforce
Permissive

Here is the issue:

h1 # virsh list
 Id    Name                           State
----------------------------------------------------
 1     test09                         running

h1 # virsh domblklist test09
Target     Source
------------------------------------------------
vda        /storage_nfs/images_001/test09.qcow2


h1 #

h2 # virsh list
 Id    Name                           State
----------------------------------------------------

h2 # virsh list --all | grep test09
 -     test09                         shut off

h2 # virsh start test09
error: Failed to start domain test09
error: resource busy: Lockspace resource
'/storage_nfs/images_001/test09.qcow2' is locked

h2 # virsh list
 Id    Name                           State
----------------------------------------------------

h2 #

Before I start test09 I open a console to the guest and observe what is
going on in it. Once I try to start test09 (and get a message about locked
resource) on h2 hypervisor, I can see the following messages in the console
and the vm goes to ro mode:

on test09's console:

[  567.394148] blk_update_request: I/O error, dev vda, sector 13296056
[  567.395883] blk_update_request: I/O error, dev vda, sector 13296056

[  572.871905] blk_update_request: I/O error, dev vda, sector 8654040
[  572.872627] Aborting journal on device vda1-8.
[  572.873978] blk_update_request: I/O error, dev vda, sector 8652800
[  572.874707] Buffer I/O error on dev vda1, logical block 1081344, lost
sync page write
[  572.875472] blk_update_request: I/O error, dev vda, sector 2048
[  572.876009] Buffer I/O error on dev vda1, logical block 0, lost sync
page write
[  572.876727] EXT4-fs error (device vda1): ext4_journal_check_start:56:
Detected aborted journal[  572.878061] JBD2: Error -5 detected when
updating journal superblock for vda1-8.

[  572.878807] EXT4-fs (vda1): Remounting filesystem read-only
[  572.879311] EXT4-fs (vda1): previous I/O error to superblock detected
[  572.880937] blk_update_request: I/O error, dev vda, sector 2048
[  572.881538] Buffer I/O error on dev vda1, logical block 0, lost sync
page write

I also observe the guests'log:

-- /var/log/libvirt/qemu/test09.log --

block I/O error in device 'drive-virtio-disk0': Permission denied (13)
block I/O error in device 'drive-virtio-disk0': Permission denied (13)
block I/O error in device 'drive-virtio-disk0': Permission denied (13)
block I/O error in device 'drive-virtio-disk0': Permission denied (13)
block I/O error in device 'drive-virtio-disk0': Permission denied (13)
block I/O error in device 'drive-virtio-disk0': Permission denied (13)
block I/O error in device 'drive-virtio-disk0': Permission denied (13)

If it helps, here is the disk portion of an XML file:

    &lt;disk type='file' device='disk'&gt;
      &lt;driver name='qemu' type='qcow2' cache='none'/&gt;
      &lt;source file='/storage_nfs/images_001/test09.qcow2'/&gt;
      &lt;backingStore/&gt;
      &lt;target dev='vda' bus='virtio'/&gt;
      &lt;alias name='virtio-disk0'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x06'
function='0x0'/&gt;
    &lt;/disk&gt;

I usually do implement SELinux on a hypervisor to isolate guests even
further but this time I set it to permissive mode just to rule out SELinux
factor. The same thing happens when SELinux is in enforcing mode
(virt_use_nfs is set to on in that case) and audit2why doesn't report any
anomalies when parsing audit logs.

I have tried to use indirect locking via the same filer and with a
separated export for the hashes by removing the comment in
/etc/libvirt/qemu-lockd.conf for the following line:

file_lockspace_dir = "/var/lib/libvirt/lockd/files"

In this case the hashes are normally created on the NFS export mounted
under /var/lib/libvirt/lockd/files. I have also tried playing with both
QCOW2 and raw disk images for VMs (and even with XFS/ext4 based guests) but
the outcome is always the same. I have a couple of KVM books - consulted
them on this topic, consulted  Red Hat and SUSE docs but pretty much the
configuration instructions are, naturally, the same. I saw that  some
colleagues posted a few emails (ie
https://www.redhat.com/archives/libvirt-users/2015-September/msg00004.html)
to the list related to virtlock but it seems that it is not the same issue.
I have also, as a last resort, completely disabled SELinux, rebooted both
hypervisors, created a new vm, repeated all the steps listed above but with
the same results.

Now, I am pretty sure that I am missing something simple here since this is
a standard feature and should work out of the box if set correctly but so
far I cannot see what I am missing.

I would really appreciate any tip/help.

Thank you very much!!


Regards,

Branimir

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Dear colleagues,&lt;br&gt;&lt;br&gt;I am facing a problem that has been troubling \
me for last week and a half. Please if you are able to help or offer some \
guidance.&lt;br&gt;&lt;br&gt;I have a non-prod POC environment with 2 CentOS7 fully updated \
hypervisors and an NFS filer that serves as a VM image storage. The overall \
environment works exceptionally well. However, starting a few weeks ago I have been \
trying to implement virtlock in order to prevent a VM running on 2 hypervisors at the \
same time.&lt;br&gt;&lt;br&gt;Here is the description how the environment looks like in terms of \
virtlock configuration on both hypervisors:&lt;br&gt;&lt;br&gt;-- Content of \
/etc/libvirt/qemu.conf --&lt;br&gt;lock_manager = "lockd"&lt;br&gt;&lt;br&gt;Only the above \
line is uncommented for direct locking.&lt;br&gt;&lt;br&gt;# libvirtd --version; python -c \
"import platform; print(platform.platform())"; virtlockd -V&lt;br&gt;libvirtd \
(libvirt) 3.2.0&lt;br&gt;Linux-3.10.0-693.2.2.el7.x86_64-x86_64-with-centos-7.4.1708-Core&lt;br&gt;virtlockd \
(libvirt) 3.2.0&lt;br&gt;&lt;br&gt;# getenforce&lt;br&gt;Permissive&lt;br&gt;&lt;br&gt;Here is the issue:&lt;br&gt;&lt;br&gt;h1 \
# virsh list&lt;br&gt;  Id       Name                                                     \
State&lt;br&gt;----------------------------------------------------&lt;br&gt;  1         test09   \
running&lt;br&gt;&lt;br&gt;h1 # virsh domblklist test09&lt;br&gt;Target         \
Source&lt;br&gt;------------------------------------------------&lt;br&gt;vda               \
/storage_nfs/images_001/test09.qcow2&lt;br&gt;&lt;br&gt;&lt;br&gt;h1 #&lt;br&gt;&lt;br&gt;h2 # virsh list&lt;br&gt;  Id   \
Name                                                     \
State&lt;br&gt;----------------------------------------------------&lt;br&gt;&lt;br&gt;h2 # virsh list \
--all | grep test09&lt;br&gt;  -         test09                                             \
shut off&lt;br&gt;&lt;br&gt;h2 # virsh start test09&lt;br&gt;error: Failed to start domain \
test09&lt;br&gt;error: resource busy: Lockspace resource \
'/storage_nfs/images_001/test09.qcow2' is locked&lt;br&gt;&lt;br&gt;h2 # virsh list&lt;br&gt;  \
Id       Name                                                     \
State&lt;br&gt;----------------------------------------------------&lt;br&gt;&lt;br&gt;h2 \
#&lt;br&gt;&lt;br&gt;Before I start test09 I open a console to the guest and observe what is \
going on in it. Once I try to start test09 (and get a message about locked resource) \
on h2 hypervisor, I can see the following messages in the console and the vm goes to \
ro mode:&lt;br&gt;&lt;br&gt;on test09's console:&lt;br&gt;&lt;br&gt;[   567.394148] blk_update_request: \
I/O error, dev vda, sector 13296056&lt;br&gt;[   567.395883] blk_update_request: I/O error, \
dev vda, sector 13296056&lt;br&gt;&lt;br&gt;[   572.871905] blk_update_request: I/O error, dev \
vda, sector 8654040&lt;br&gt;[   572.872627] Aborting journal on device vda1-8.&lt;br&gt;[   \
572.873978] blk_update_request: I/O error, dev vda, sector 8652800&lt;br&gt;[   572.874707] \
Buffer I/O error on dev vda1, logical block 1081344, lost sync page write&lt;br&gt;[   \
572.875472] blk_update_request: I/O error, dev vda, sector 2048&lt;br&gt;[   572.876009] \
Buffer I/O error on dev vda1, logical block 0, lost sync page write&lt;br&gt;[   \
572.876727] EXT4-fs error (device vda1): ext4_journal_check_start:56: Detected \
aborted journal[   572.878061] JBD2: Error -5 detected when updating journal \
superblock for vda1-8.&lt;br&gt;&lt;br&gt;[   572.878807] EXT4-fs (vda1): Remounting filesystem \
read-only&lt;br&gt;[   572.879311] EXT4-fs (vda1): previous I/O error to superblock \
detected&lt;br&gt;[   572.880937] blk_update_request: I/O error, dev vda, sector 2048&lt;br&gt;[  \
572.881538] Buffer I/O error on dev vda1, logical block 0, lost sync page \
write&lt;br&gt;&lt;br&gt;I also observe the guests'log:&lt;br&gt;&lt;br&gt;-- \
/var/log/libvirt/qemu/test09.log --&lt;br&gt;&lt;br&gt;block I/O error in device \
'drive-virtio-disk0': Permission denied (13)&lt;br&gt;block I/O error in device \
'drive-virtio-disk0': Permission denied (13)&lt;br&gt;block I/O error in device \
'drive-virtio-disk0': Permission denied (13)&lt;br&gt;block I/O error in device \
'drive-virtio-disk0': Permission denied (13)&lt;br&gt;block I/O error in device \
'drive-virtio-disk0': Permission denied (13)&lt;br&gt;block I/O error in device \
'drive-virtio-disk0': Permission denied (13)&lt;br&gt;block I/O error in device \
'drive-virtio-disk0': Permission denied (13)&lt;br&gt;&lt;br&gt;If it helps, here is the \
disk portion of an XML file:&lt;br&gt;&lt;br&gt;       &lt;disk type='file' \
device='disk'&gt;&lt;br&gt;           &lt;driver name='qemu' \
type='qcow2' cache='none'/&gt;&lt;br&gt;           &lt;source \
file='/storage_nfs/images_001/test09.qcow2'/&gt;&lt;br&gt;           \
&lt;backingStore/&gt;&lt;br&gt;           &lt;target dev='vda' \
bus='virtio'/&gt;&lt;br&gt;           &lt;alias \
name='virtio-disk0'/&gt;&lt;br&gt;           &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x06' \
function='0x0'/&gt;&lt;br&gt;       &lt;/disk&gt;&lt;br&gt;&lt;br&gt;I usually do implement \
SELinux on a hypervisor to isolate guests even further but this time I set it to \
permissive mode just to rule out SELinux factor. The same thing happens when SELinux \
is in enforcing mode (virt_use_nfs is set to on in that case) and audit2why \
doesn't report any anomalies when parsing audit logs.&lt;br&gt;&lt;br&gt;I have tried to use \
indirect locking via the same filer and with a separated export for the hashes by \
removing the comment in /etc/libvirt/qemu-lockd.conf for the following \
line:&lt;br&gt;&lt;br&gt;file_lockspace_dir = "/var/lib/libvirt/lockd/files"&lt;br&gt;&lt;br&gt;In \
this case the hashes are normally created on the NFS export mounted under \
/var/lib/libvirt/lockd/files. I have also tried playing with both QCOW2 and raw disk \
images for VMs (and even with XFS/ext4 based guests) but the outcome is always the \
same. I have a couple of KVM books - consulted them on this topic, consulted   Red \
Hat and SUSE docs but pretty much the configuration instructions are, naturally, the \
same. I saw that   some colleagues posted a few emails (ie &lt;a \
href="https://www.redhat.com/archives/libvirt-users/2015-September/msg00004.html"&gt;https://www.redhat.com/archives/libvirt-users/2015-September/msg00004.html&lt;/a&gt;) \
to the list related to virtlock but it seems that it is not the same issue. I have \
also, as a last resort, completely disabled SELinux, rebooted both hypervisors, \
created a new vm, repeated all the steps listed above but with the same \
results.&lt;br&gt;&lt;br&gt;Now, I am pretty sure that I am missing something simple here since \
this is a standard feature and should work out of the box if set correctly but so far \
I cannot see what I am missing.&lt;br&gt;&lt;br&gt;I would really appreciate any \
tip/help.&lt;br&gt;&lt;br&gt;Thank you very \
much!!&lt;br&gt;&lt;br&gt;&lt;br&gt;Regards,&lt;br&gt;&lt;br&gt;Branimir&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20171116124848</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-11-16 12:48:48-0400</timestampReceived><subject>Re: [libvirt-users] virtlock - a VM goes read-only</subject><body>

On Wed, Nov 15, 2017 at 02:24:48PM +0000, Branimir Pejakovic wrote:
&gt; Dear colleagues,
&gt; 
&gt; I am facing a problem that has been troubling me for last week and a half.
&gt; Please if you are able to help or offer some guidance.
&gt; 
&gt; I have a non-prod POC environment with 2 CentOS7 fully updated hypervisors
&gt; and an NFS filer that serves as a VM image storage. The overall environment
&gt; works exceptionally well. However, starting a few weeks ago I have been
&gt; trying to implement virtlock in order to prevent a VM running on 2
&gt; hypervisors at the same time.

[snip]

&gt; h2 # virsh start test09
&gt; error: Failed to start domain test09
&gt; error: resource busy: Lockspace resource
&gt; '/storage_nfs/images_001/test09.qcow2' is locked

[snip]

&gt; Now, I am pretty sure that I am missing something simple here since this is
&gt; a standard feature and should work out of the box if set correctly but so
&gt; far I cannot see what I am missing.

So I think you are hitting the little surprise in the way our locking
works. Specifically, right now the locking only protects the image
file contents from concurrent writes. We don't have locking around
the file attributes (permissions, user/group ownership, selinux label,
etc)

Unfortunately with the current libvirt design, the security drivers run
before locking takes effect. So what happens is that you have your first
VM running normally. It has been granted ability to write to the image
in terms of SELinux label &amp; permissions/owership. The lock manager is
holding locks protecting the image contents

Now you try to start the second guest, and libvirt will apply the SELinux
label &amp; permissions/ownership needed for that second guest, despite it
being used by the first guest. Only then do we acquire the locks for the
disk image, and fail because the first guest holds the lock. We now
reset the permissions/ownership we just granted for the second guest,
and thus unfortunately blocks the first guest from using the images,
causing the I/O errors you mention

We *have* successfully prevented 2 guests from writing to the same
image at once, so your data is still safe. Unfortunately though the
first guest cannot write any further datas, so that previously
running guest is now fubar :-(

I appreciated this is rather surprising &amp; unhelpful in general. Just
console yourself with the fact that at least your disk iamge is not
corrupted.

Note, this should only happen with SELinux enforcing though - if it is
permissive, then I'd expect the first guest to carry on working.

We would like to improve our locking so that we can apply locks before
we even try to change ownership/permissions/selinux, which would make
it far more useful. We've never succesfully completed that work though.

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20171108085840</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-11-08 08:58:40-0400</timestampReceived><subject>Re: [libvirt-users] Does libvirt-sanlock support network disk?</subject><body>

On Wed, Nov 08, 2017 at 02:42:35PM +0800, Han Han wrote:
&gt; Hello,
&gt; As we know, libvirt sanlock support file type storage. I wonder *if it
&gt; supports network storage.*
&gt; I tried *iSCSI*, but found it didn't generate any resource file:

Correct, the code currently ignores locking for any non-local
disk.


Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20171114175112</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-11-14 17:51:12-0400</timestampReceived><subject>Re: [libvirt-users] Urgent: virsh - change-media run into a promptly close of libvirt</subject><body>

On Tue, Nov 14, 2017 at 06:47:04PM +0100, Holger Schranz wrote:
&gt; Hello,
&gt; 
&gt; I use the virsh change-media command and since the combination of:
&gt; 
&gt; etcsvms5:/kvm/CS8400/M1 # virsh version
&gt; Compiled against library: libvirt 3.9.0
&gt; Using library: libvirt 3.9.0
&gt; Using API: QEMU 3.9.0
&gt; Running hypervisor: QEMU 2.10.1
&gt; 
&gt; etcsvms5:/kvm/CS8400/M1 #
&gt; 
&gt; I got the following problem:
&gt; 
&gt; ----------------------
&gt; 
&gt; etcsvms5:/kvm/CS8400/M1 # virsh change-media S5VCS84M1-VLP0 hdc --eject
&gt; Successfully ejected media.
&gt; 
&gt; etcsvms5:/kvm/CS8400/M1 # virsh change-media S5VCS84M1-VLP0 hdc
&gt; /home/kvm/etcsdvmb/Medien/V7.0A/CS_licenses/key-cd_VCS85FTSVTL.iso --insert
&gt; error: Disconnected from qemu:///system due to end of file
&gt; error: Failed to complete action insert on media
&gt; error: End of file while reading data: Input/output error
&gt; 
&gt; ----------------------
&gt; 
&gt; journalctl -b | less shows the following:
&gt; 
&gt; Nov 14 10:11:32 etcsvms5 kernel: libvirtd[10178]: segfault at 10 ip
&gt; 00007f49ff969170 sp 00007f4a069cb940 error 4 in
&gt; libvirt_driver_qemu.so[7f49ff8d9000+172000]
&gt; Nov 14 10:11:37 etcsvms5 systemd-coredump[42152]: Process 10177 (libvirtd)
&gt; of user 0 dumped core.

Seeing the stack trace of libvirtd will be key to identifying the bug. With
any luck systemd-coredump will have captured that. So can you run 'coredumpctl'
to get the stack trace it saved.

Then I'd suggest filing a bugzilla ticket against libvirt with the resulting
info so we have a record of it.

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20171114181523</emailId><senderName>Holger Schranz</senderName><senderEmail>holger@fam-schranz.de</senderEmail><timestampReceived>2017-11-14 18:15:23-0400</timestampReceived><subject>Re: [libvirt-users] Urgent: virsh - change-media run into a promptly close of libvirt</subject><body>

Hi Daniel,

here are any informations.

A little bit strange, coredumpctl showthe libvirtd.
coredumpctl dump libvirt and info libvirt  no information.

Best regards

Holger

--------------------------------------------------------------------------

etcsvms5:/var/adm # coredumpctl
TIME                            PID   UID   GID SIG PRESENT EXE
Tue 2017-11-07 16:22:57 CET     485     0     0  11 /usr/sbin/plymouthd
Wed 2017-11-08 14:44:12 CET     485     0     0  11 /usr/sbin/plymouthd
Tue 2017-11-14 10:11:37 CET   10177     0     0  11 * 
/usr/local/sbin/libvirtd
etcsvms5:/var/adm # coredumpctl --help

etcsvms5:/var/adm # coredumpctl dump libvirt
No match found.
etcsvms5:/var/adm # coredumpctl info libvirt
No coredumps found.
etcsvms5:/var/adm #

etcsvms5:/var/adm # coredumpctl info
.
.
            PID: 10177 (libvirtd)
            UID: 0 (root)
            GID: 0 (root)
         Signal: 11 (SEGV)
      Timestamp: Tue 2017-11-14 10:11:32 CET (8h ago)
   Command Line: /usr/local/sbin/libvirtd -d
     Executable: /usr/local/sbin/libvirtd
  Control Group: /
          Slice: -.slice
        Boot ID: 4d5f74eefb0244c2bc3b2c99986dcee8
     Machine ID: beeb301fe87a14b2eabdb6a75a01cbae
       Hostname: etcsvms5
       Coredump: 
/var/lib/systemd/coredump/core.libvirtd.0.4d5f74eefb0244c2bc3b2c99986dcee8.10177.1510650692000000.xz
        Message: Process 10177 (libvirtd) of user 0 dumped core.
etcsvms5:/var/adm #

Am 14.11.2017 um 18:51 schrieb Daniel P. Berrange:
&gt; On Tue, Nov 14, 2017 at 06:47:04PM +0100, Holger Schranz wrote:
&gt;&gt; Hello,
&gt;&gt;
&gt;&gt; I use the virsh change-media command and since the combination of:
&gt;&gt;
&gt;&gt; etcsvms5:/kvm/CS8400/M1 # virsh version
&gt;&gt; Compiled against library: libvirt 3.9.0
&gt;&gt; Using library: libvirt 3.9.0
&gt;&gt; Using API: QEMU 3.9.0
&gt;&gt; Running hypervisor: QEMU 2.10.1
&gt;&gt;
&gt;&gt; etcsvms5:/kvm/CS8400/M1 #
&gt;&gt;
&gt;&gt; I got the following problem:
&gt;&gt;
&gt;&gt; ----------------------
&gt;&gt;
&gt;&gt; etcsvms5:/kvm/CS8400/M1 # virsh change-media S5VCS84M1-VLP0 hdc --eject
&gt;&gt; Successfully ejected media.
&gt;&gt;
&gt;&gt; etcsvms5:/kvm/CS8400/M1 # virsh change-media S5VCS84M1-VLP0 hdc
&gt;&gt; /home/kvm/etcsdvmb/Medien/V7.0A/CS_licenses/key-cd_VCS85FTSVTL.iso --insert
&gt;&gt; error: Disconnected from qemu:///system due to end of file
&gt;&gt; error: Failed to complete action insert on media
&gt;&gt; error: End of file while reading data: Input/output error
&gt;&gt;
&gt;&gt; ----------------------
&gt;&gt;
&gt;&gt; journalctl -b | less shows the following:
&gt;&gt;
&gt;&gt; Nov 14 10:11:32 etcsvms5 kernel: libvirtd[10178]: segfault at 10 ip
&gt;&gt; 00007f49ff969170 sp 00007f4a069cb940 error 4 in
&gt;&gt; libvirt_driver_qemu.so[7f49ff8d9000+172000]
&gt;&gt; Nov 14 10:11:37 etcsvms5 systemd-coredump[42152]: Process 10177 (libvirtd)
&gt;&gt; of user 0 dumped core.
&gt; Seeing the stack trace of libvirtd will be key to identifying the bug. With
&gt; any luck systemd-coredump will have captured that. So can you run 'coredumpctl'
&gt; to get the stack trace it saved.
&gt;
&gt; Then I'd suggest filing a bugzilla ticket against libvirt with the resulting
&gt; info so we have a record of it.
&gt;
&gt; Regards,
&gt; Daniel


---
Diese E-Mail wurde von Avast Antivirus-Software auf Viren geprüft.
https://www.avast.com/antivirus

</body></email><email><emailId>20171114181901</emailId><senderName>Holger Schranz</senderName><senderEmail>holger@fam-schranz.de</senderEmail><timestampReceived>2017-11-14 18:19:01-0400</timestampReceived><subject>Re: [libvirt-users] Urgent: virsh - change-media run into a promptly close of libvirt</subject><body>

Ups ... my fault ...

libvirtd instead libvirt ....


etcsvms5:/var/lib/systemd/coredump # coredumpctl info libvirtd
            PID: 10177 (libvirtd)
            UID: 0 (root)
            GID: 0 (root)
         Signal: 11 (SEGV)
      Timestamp: Tue 2017-11-14 10:11:32 CET (9h ago)
   Command Line: /usr/local/sbin/libvirtd -d
     Executable: /usr/local/sbin/libvirtd
  Control Group: /
          Slice: -.slice
        Boot ID: 4d5f74eefb0244c2bc3b2c99986dcee8
     Machine ID: beeb301fe87a14b2eabdb6a75a01cbae
       Hostname: etcsvms5
       Coredump: 
/var/lib/systemd/coredump/core.libvirtd.0.4d5f74eefb0244c2bc3b2c99986dcee8.10177.1510650692000000.xz
        Message: Process 10177 (libvirtd) of user 0 dumped core.
etcsvms5:/var/lib/systemd/coredump # coredumpctl dump libvirtd
            PID: 10177 (libvirtd)
            UID: 0 (root)
            GID: 0 (root)
         Signal: 11 (SEGV)
      Timestamp: Tue 2017-11-14 10:11:32 CET (9h ago)
   Command Line: /usr/local/sbin/libvirtd -d
     Executable: /usr/local/sbin/libvirtd
  Control Group: /
          Slice: -.slice
        Boot ID: 4d5f74eefb0244c2bc3b2c99986dcee8
     Machine ID: beeb301fe87a14b2eabdb6a75a01cbae
       Hostname: etcsvms5
       Coredump: 
/var/lib/systemd/coredump/core.libvirtd.0.4d5f74eefb0244c2bc3b2c99986dcee8.10177.1510650692000000.xz
        Message: Process 10177 (libvirtd) of user 0 dumped core.
Refusing to dump core to tty.
etcsvms5:/var/lib/systemd/coredump #

Am 14.11.2017 um 19:15 schrieb Holger Schranz:
&gt; Hi Daniel,
&gt;
&gt; here are any informations.
&gt;
&gt; A little bit strange, coredumpctl showthe libvirtd.
&gt; coredumpctl dump libvirt and info libvirt  no information.
&gt;
&gt; Best regards
&gt;
&gt; Holger
&gt;
&gt; -------------------------------------------------------------------------- 
&gt;
&gt;
&gt; etcsvms5:/var/adm # coredumpctl
&gt; TIME                            PID   UID   GID SIG PRESENT EXE
&gt; Tue 2017-11-07 16:22:57 CET     485     0     0  11 /usr/sbin/plymouthd
&gt; Wed 2017-11-08 14:44:12 CET     485     0     0  11 /usr/sbin/plymouthd
&gt; Tue 2017-11-14 10:11:37 CET   10177     0     0  11 * 
&gt; /usr/local/sbin/libvirtd
&gt; etcsvms5:/var/adm # coredumpctl --help
&gt;
&gt; etcsvms5:/var/adm # coredumpctl dump libvirt
&gt; No match found.
&gt; etcsvms5:/var/adm # coredumpctl info libvirt
&gt; No coredumps found.
&gt; etcsvms5:/var/adm #
&gt;
&gt; etcsvms5:/var/adm # coredumpctl info
&gt; .
&gt; .
&gt;            PID: 10177 (libvirtd)
&gt;            UID: 0 (root)
&gt;            GID: 0 (root)
&gt;         Signal: 11 (SEGV)
&gt;      Timestamp: Tue 2017-11-14 10:11:32 CET (8h ago)
&gt;   Command Line: /usr/local/sbin/libvirtd -d
&gt;     Executable: /usr/local/sbin/libvirtd
&gt;  Control Group: /
&gt;          Slice: -.slice
&gt;        Boot ID: 4d5f74eefb0244c2bc3b2c99986dcee8
&gt;     Machine ID: beeb301fe87a14b2eabdb6a75a01cbae
&gt;       Hostname: etcsvms5
&gt;       Coredump: 
&gt; /var/lib/systemd/coredump/core.libvirtd.0.4d5f74eefb0244c2bc3b2c99986dcee8.10177.1510650692000000.xz
&gt;        Message: Process 10177 (libvirtd) of user 0 dumped core.
&gt; etcsvms5:/var/adm #
&gt;
&gt; Am 14.11.2017 um 18:51 schrieb Daniel P. Berrange:
&gt;&gt; On Tue, Nov 14, 2017 at 06:47:04PM +0100, Holger Schranz wrote:
&gt;&gt;&gt; Hello,
&gt;&gt;&gt;
&gt;&gt;&gt; I use the virsh change-media command and since the combination of:
&gt;&gt;&gt;
&gt;&gt;&gt; etcsvms5:/kvm/CS8400/M1 # virsh version
&gt;&gt;&gt; Compiled against library: libvirt 3.9.0
&gt;&gt;&gt; Using library: libvirt 3.9.0
&gt;&gt;&gt; Using API: QEMU 3.9.0
&gt;&gt;&gt; Running hypervisor: QEMU 2.10.1
&gt;&gt;&gt;
&gt;&gt;&gt; etcsvms5:/kvm/CS8400/M1 #
&gt;&gt;&gt;
&gt;&gt;&gt; I got the following problem:
&gt;&gt;&gt;
&gt;&gt;&gt; ----------------------
&gt;&gt;&gt;
&gt;&gt;&gt; etcsvms5:/kvm/CS8400/M1 # virsh change-media S5VCS84M1-VLP0 hdc --eject
&gt;&gt;&gt; Successfully ejected media.
&gt;&gt;&gt;
&gt;&gt;&gt; etcsvms5:/kvm/CS8400/M1 # virsh change-media S5VCS84M1-VLP0 hdc
&gt;&gt;&gt; /home/kvm/etcsdvmb/Medien/V7.0A/CS_licenses/key-cd_VCS85FTSVTL.iso 
&gt;&gt;&gt; --insert
&gt;&gt;&gt; error: Disconnected from qemu:///system due to end of file
&gt;&gt;&gt; error: Failed to complete action insert on media
&gt;&gt;&gt; error: End of file while reading data: Input/output error
&gt;&gt;&gt;
&gt;&gt;&gt; ----------------------
&gt;&gt;&gt;
&gt;&gt;&gt; journalctl -b | less shows the following:
&gt;&gt;&gt;
&gt;&gt;&gt; Nov 14 10:11:32 etcsvms5 kernel: libvirtd[10178]: segfault at 10 ip
&gt;&gt;&gt; 00007f49ff969170 sp 00007f4a069cb940 error 4 in
&gt;&gt;&gt; libvirt_driver_qemu.so[7f49ff8d9000+172000]
&gt;&gt;&gt; Nov 14 10:11:37 etcsvms5 systemd-coredump[42152]: Process 10177 
&gt;&gt;&gt; (libvirtd)
&gt;&gt;&gt; of user 0 dumped core.
&gt;&gt; Seeing the stack trace of libvirtd will be key to identifying the 
&gt;&gt; bug. With
&gt;&gt; any luck systemd-coredump will have captured that. So can you run 
&gt;&gt; 'coredumpctl'
&gt;&gt; to get the stack trace it saved.
&gt;&gt;
&gt;&gt; Then I'd suggest filing a bugzilla ticket against libvirt with the 
&gt;&gt; resulting
&gt;&gt; info so we have a record of it.
&gt;&gt;
&gt;&gt; Regards,
&gt;&gt; Daniel
&gt;
&gt;
&gt; ---
&gt; Diese E-Mail wurde von Avast Antivirus-Software auf Viren geprüft.
&gt; https://www.avast.com/antivirus
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users

</body></email><email><emailId>20171115101940</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-11-15 10:19:40-0400</timestampReceived><subject>Re: [libvirt-users] Urgent: virsh - change-media run into a promptly close of libvirt</subject><body>

On Tue, Nov 14, 2017 at 07:19:01PM +0100, Holger Schranz wrote:
&gt; Ups ... my fault ...
&gt; 
&gt; libvirtd instead libvirt ....
&gt; 
&gt; 
&gt; etcsvms5:/var/lib/systemd/coredump # coredumpctl info libvirtd
&gt; PID: 10177 (libvirtd)
&gt; UID: 0 (root)
&gt; GID: 0 (root)
&gt; Signal: 11 (SEGV)
&gt; Timestamp: Tue 2017-11-14 10:11:32 CET (9h ago)
&gt; Command Line: /usr/local/sbin/libvirtd -d
&gt; Executable: /usr/local/sbin/libvirtd
&gt; Control Group: /
&gt; Slice: -.slice
&gt; Boot ID: 4d5f74eefb0244c2bc3b2c99986dcee8
&gt; Machine ID: beeb301fe87a14b2eabdb6a75a01cbae
&gt; Hostname: etcsvms5
&gt; Coredump: /var/lib/systemd/coredump/core.libvirtd.0.4d5f74eefb0244c2bc3b2c99986dcee8.10177.1510650692000000.xz
&gt;                 
&gt; Message: Process 10177 (libvirtd) of user 0 dumped core.
&gt; etcsvms5:/var/lib/systemd/coredump # coredumpctl dump libvirtd
&gt; PID: 10177 (libvirtd)
&gt; UID: 0 (root)
&gt; GID: 0 (root)
&gt; Signal: 11 (SEGV)
&gt; Timestamp: Tue 2017-11-14 10:11:32 CET (9h ago)
&gt; Command Line: /usr/local/sbin/libvirtd -d
&gt; Executable: /usr/local/sbin/libvirtd
&gt; Control Group: /
&gt; Slice: -.slice
&gt; Boot ID: 4d5f74eefb0244c2bc3b2c99986dcee8
&gt; Machine ID: beeb301fe87a14b2eabdb6a75a01cbae
&gt; Hostname: etcsvms5
&gt; Coredump: /var/lib/systemd/coredump/core.libvirtd.0.4d5f74eefb0244c2bc3b2c99986dcee8.10177.1510650692000000.xz
&gt;                 
&gt; Message: Process 10177 (libvirtd) of user 0 dumped core.
&gt; Refusing to dump core to tty.
&gt; etcsvms5:/var/lib/systemd/coredump #

Probably need to try 'coredumpctl gdb libvirtd' to launch the debugger
from where you can use 'thread apply all backtrace' to get the stack


Regards,
Daniel
-- 
&gt; &gt; https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
&gt; &gt; https://libvirt.org         -o-            https://fstop138.berrange.com :|
&gt; &gt; https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|


</body></email><email><emailId>20171115115457</emailId><senderName>Holger Schranz</senderName><senderEmail>holger@fam-schranz.de</senderEmail><timestampReceived>2017-11-15 11:54:57-0400</timestampReceived><subject>Re: [libvirt-users] Urgent: virsh - change-media run into a promptly close of libvirt</subject><body>

Hi Daniel,

attached you will find the information you requested.

Best regards

Holger

Am 15.11.2017 um 11:19 schrieb Daniel P. Berrange:
&gt; On Tue, Nov 14, 2017 at 07:19:01PM +0100, Holger Schranz wrote:
&gt; &gt; Ups ... my fault ...
&gt; &gt; 
&gt; &gt; libvirtd instead libvirt ....
&gt; &gt; 
&gt; &gt; 
&gt; &gt; etcsvms5:/var/lib/systemd/coredump # coredumpctl info libvirtd
&gt; &gt; PID: 10177 (libvirtd)
&gt; &gt; UID: 0 (root)
&gt; &gt; GID: 0 (root)
&gt; &gt; Signal: 11 (SEGV)
&gt; &gt; Timestamp: Tue 2017-11-14 10:11:32 CET (9h ago)
&gt; &gt; Command Line: /usr/local/sbin/libvirtd -d
&gt; &gt; Executable: /usr/local/sbin/libvirtd
&gt; &gt; Control Group: /
&gt; &gt; Slice: -.slice
&gt; &gt; Boot ID: 4d5f74eefb0244c2bc3b2c99986dcee8
&gt; &gt; Machine ID: beeb301fe87a14b2eabdb6a75a01cbae
&gt; &gt; Hostname: etcsvms5
&gt; &gt; Coredump: /var/lib/systemd/coredump/core.libvirtd.0.4d5f74eefb0244c2bc3b2c99986dcee8.10177.1510650692000000.xz
&gt; &gt;                 
&gt; &gt; Message: Process 10177 (libvirtd) of user 0 dumped core.
&gt; &gt; etcsvms5:/var/lib/systemd/coredump # coredumpctl dump libvirtd
&gt; &gt; PID: 10177 (libvirtd)
&gt; &gt; UID: 0 (root)
&gt; &gt; GID: 0 (root)
&gt; &gt; Signal: 11 (SEGV)
&gt; &gt; Timestamp: Tue 2017-11-14 10:11:32 CET (9h ago)
&gt; &gt; Command Line: /usr/local/sbin/libvirtd -d
&gt; &gt; Executable: /usr/local/sbin/libvirtd
&gt; &gt; Control Group: /
&gt; &gt; Slice: -.slice
&gt; &gt; Boot ID: 4d5f74eefb0244c2bc3b2c99986dcee8
&gt; &gt; Machine ID: beeb301fe87a14b2eabdb6a75a01cbae
&gt; &gt; Hostname: etcsvms5
&gt; &gt; Coredump: /var/lib/systemd/coredump/core.libvirtd.0.4d5f74eefb0244c2bc3b2c99986dcee8.10177.1510650692000000.xz
&gt; &gt;                 
&gt; &gt; Message: Process 10177 (libvirtd) of user 0 dumped core.
&gt; &gt; Refusing to dump core to tty.
&gt; &gt; etcsvms5:/var/lib/systemd/coredump #
&gt; Probably need to try 'coredumpctl gdb libvirtd' to launch the debugger
&gt; from where you can use 'thread apply all backtrace' to get the stack
&gt; 
&gt; 
&gt; Regards,
&gt; Daniel



---
Diese E-Mail wurde von Avast Antivirus-Software auf Viren geprüft.
https://www.avast.com/antivirus


["virsh_change_media_gdb.txt" (text/plain)]

GNU gdb (GDB; openSUSE Leap 42.3) 8.0.1
Copyright (C) 2017 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-suse-linux".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
&lt;http://bugs.opensuse.org/&gt;.
Find the GDB manual and other documentation resources online at:
&lt;http://www.gnu.org/software/gdb/documentation/&gt;.
For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from /usr/local/sbin/libvirtd...done.
[New LWP 10178]
[New LWP 10187]
[New LWP 10180]
[New LWP 10192]
[New LWP 10188]
[New LWP 10184]
[New LWP 10191]
[New LWP 10186]
[New LWP 10183]
[New LWP 10182]
[New LWP 10179]
[New LWP 10181]
[New LWP 10190]
[New LWP 10185]
[New LWP 10177]
[New LWP 10189]
[New LWP 10203]
[New LWP 10554]
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib64/libthread_db.so.1".
Core was generated by `/usr/local/sbin/libvirtd -d'.
Program terminated with signal SIGSEGV, Segmentation fault.
#0  0x00007f49ff969170 in qemuDomainChangeEjectableMedia (
    driver=driver@entry=0x7f49f841b700, vm=vm@entry=0x7f49ec02fbd0, 
    disk=disk@entry=0x7f49ec0375d0, newsrc=0x7f49e8014d10, force=force@entry=false)
    at qemu/qemu_hotplug.c:303
303	        if (qemuGetDriveSourceString(newsrc, srcPriv-&gt;secinfo, &amp;sourcestr) &lt; 0)
[Current thread is 1 (Thread 0x7f4a069cc700 (LWP 10178))]
Missing separate debuginfos, use: zypper install \
device-mapper-debuginfo-1.02.97-77.1.x86_64 glibc-debuginfo-2.22-8.4.x86_64 \
krb5-debuginfo-1.12.5-12.1.x86_64 libapparmor1-debuginfo-2.10.2-14.19.x86_64 \
libavahi-client3-debuginfo-0.6.32-3.5.x86_64 \
libavahi-common3-debuginfo-0.6.32-3.5.x86_64 libblkid1-debuginfo-2.29.2-3.4.x86_64 \
libcap2-debuginfo-2.22-18.16.x86_64 libcom_err2-debuginfo-1.42.11-15.1.x86_64 \
libcurl4-debuginfo-7.37.0-23.1.x86_64 libdbus-1-3-debuginfo-1.8.22-5.1.x86_64 \
libffi4-debuginfo-5.3.1+r233831-10.1.x86_64 libgmp10-debuginfo-5.1.3-7.15.x86_64 \
libgnutls28-debuginfo-3.3.27-1.5.x86_64 libhogweed2-debuginfo-2.7.1-12.1.x86_64 \
libidn11-debuginfo-1.28-8.3.x86_64 libkeyutils1-debuginfo-1.5.9-7.13.x86_64 \
libldap-2_4-2-debuginfo-2.4.44-18.1.x86_64 liblzma5-debuginfo-5.2.2-3.15.x86_64 \
libnettle4-debuginfo-2.7.1-12.1.x86_64 libnl1-debuginfo-1.1.4-6.13.x86_64 \
libopenssl1_0_0-debuginfo-1.0.2j-10.1.x86_64 libp11-kit0-debuginfo-0.20.7-1.2.x86_64 \
libpciaccess0-debuginfo-0.13.4-4.3.x86_64 libpcre1-debuginfo-8.39-11.1.x86_64 \
libsasl2-3-debuginfo-2.1.26-14.1.x86_64 libselinux1-debuginfo-2.5-4.17.x86_64 \
libssh2-1-debuginfo-1.4.3-18.3.x86_64 libtasn1-6-debuginfo-4.9-1.2.x86_64 \
libudev1-debuginfo-228-35.1.x86_64 libuuid1-debuginfo-2.29.2-3.4.x86_64 \
libxml2-2-debuginfo-2.9.4-12.1.x86_64 libyajl2-debuginfo-2.0.1-21.3.x86_64 \
libz1-debuginfo-1.2.8-13.15.x86_64

Thread 18 (Thread 0x7f49fc9d9700 (LWP 10554)):
(gdb) thread apply all backtrace

Thread 18 (Thread 0x7f49fc9d9700 (LWP 10554)):
#0  0x00007f4a0a2590bf in pthread_cond_wait@@GLIBC_2.3.2 () from \
/lib64/libpthread.so.0 #1  0x00007f4a0cd0bdda in virCondWait \
(c=c@entry=0x7f49f84c1fc8,   m=m@entry=0x7f49f84c1fa0) at util/virthread.c:154
#2  0x00007f4a0cd0cbb3 in virThreadPoolWorker (opaque=opaque@entry=0x56177ca96420)
    at util/virthreadpool.c:124
#3  0x00007f4a0cd0b8f8 in virThreadHelper (data=&lt;optimized out&gt;) at \
util/virthread.c:206 #4  0x00007f4a0a254744 in start_thread () from \
/lib64/libpthread.so.0 #5  0x00007f4a09f92aad in clone () from /lib64/libc.so.6

Thread 17 (Thread 0x7f49f7fff700 (LWP 10203)):
#0  0x00007f4a0a2590bf in pthread_cond_wait@@GLIBC_2.3.2 () from \
/lib64/libpthread.so.0 #1  0x00007f4a0cd0bdda in virCondWait \
(c=c@entry=0x7f49f80195c0,   m=m@entry=0x7f49f8019580) at util/virthread.c:154
#2  0x00007f4a002a4e18 in udevEventHandleThread (opaque=&lt;optimized out&gt;)
    at node_device/node_device_udev.c:1729
#3  0x00007f4a0cd0b922 in virThreadHelper (data=&lt;optimized out&gt;) at \
util/virthread.c:206 #4  0x00007f4a0a254744 in start_thread () from \
/lib64/libpthread.so.0 #5  0x00007f4a09f92aad in clone () from /lib64/libc.so.6

Thread 16 (Thread 0x7f49fe9dd700 (LWP 10189)):
#0  0x00007f4a0a2590bf in pthread_cond_wait@@GLIBC_2.3.2 () from \
/lib64/libpthread.so.0 #1  0x00007f4a0cd0bdda in virCondWait \
(c=c@entry=0x56177ca945e8,   m=m@entry=0x56177ca945c0) at util/virthread.c:154
#2  0x00007f4a0cd0cbb3 in virThreadPoolWorker (opaque=opaque@entry=0x56177ca94890)
    at util/virthreadpool.c:124
#3  0x00007f4a0cd0b8f8 in virThreadHelper (data=&lt;optimized out&gt;) at \
util/virthread.c:206 #4  0x00007f4a0a254744 in start_thread () from \
/lib64/libpthread.so.0 #5  0x00007f4a09f92aad in clone () from /lib64/libc.so.6

Thread 15 (Thread 0x7f4a0d9ed840 (LWP 10177)):
#0  0x00007f4a09f8a20d in poll () from /lib64/libc.so.6
#1  0x00007f4a0ccabeaa in poll (__timeout=4997, __nfds=19, __fds=&lt;optimized out&gt;)
    at /usr/include/bits/poll2.h:46
#2  virEventPollRunOnce () at util/vireventpoll.c:641
#3  0x00007f4a0ccaa8d2 in virEventRunDefaultImpl () at util/virevent.c:327
#4  0x00007f4a0ce42b3d in virNetDaemonRun (dmn=0x56177ca8ca50) at \
rpc/virnetdaemon.c:837 #5  0x000056177c3c7004 in main (argc=&lt;optimized out&gt;, \
argv=&lt;optimized out&gt;)  at libvirtd.c:1494

Thread 14 (Thread 0x7f4a031c5700 (LWP 10185)):
#0  0x00007f4a0a2590bf in pthread_cond_wait@@GLIBC_2.3.2 () from \
/lib64/libpthread.so.0 #1  0x00007f4a0cd0bdda in virCondWait \
(c=c@entry=0x56177ca8bc58,   m=m@entry=0x56177ca8bb90) at util/virthread.c:154
#2  0x00007f4a0cd0cb4b in virThreadPoolWorker (opaque=opaque@entry=0x56177ca98720)
    at util/virthreadpool.c:124
#3  0x00007f4a0cd0b8f8 in virThreadHelper (data=&lt;optimized out&gt;) at \
util/virthread.c:206 #4  0x00007f4a0a254744 in start_thread () from \
/lib64/libpthread.so.0 #5  0x00007f4a09f92aad in clone () from /lib64/libc.so.6

Thread 13 (Thread 0x7f49fe1dc700 (LWP 10190)):
#0  0x00007f4a0a2590bf in pthread_cond_wait@@GLIBC_2.3.2 () from \
/lib64/libpthread.so.0 #1  0x00007f4a0cd0bdda in virCondWait \
(c=c@entry=0x56177ca945e8,   m=m@entry=0x56177ca945c0) at util/virthread.c:154
#2  0x00007f4a0cd0cbb3 in virThreadPoolWorker (opaque=opaque@entry=0x56177ca94a60)
    at util/virthreadpool.c:124
#3  0x00007f4a0cd0b8f8 in virThreadHelper (data=&lt;optimized out&gt;) at \
util/virthread.c:206 #4  0x00007f4a0a254744 in start_thread () from \
/lib64/libpthread.so.0 #5  0x00007f4a09f92aad in clone () from /lib64/libc.so.6

Thread 12 (Thread 0x7f4a051c9700 (LWP 10181)):
#0  0x00007f4a0a2590bf in pthread_cond_wait@@GLIBC_2.3.2 () from \
/lib64/libpthread.so.0 #1  0x00007f4a0cd0bdda in virCondWait \
(c=c@entry=0x56177ca8bbb8,   m=m@entry=0x56177ca8bb90) at util/virthread.c:154
#2  0x00007f4a0cd0cbb3 in virThreadPoolWorker (opaque=opaque@entry=0x56177ca98640)
    at util/virthreadpool.c:124
#3  0x00007f4a0cd0b8f8 in virThreadHelper (data=&lt;optimized out&gt;) at \
util/virthread.c:206 #4  0x00007f4a0a254744 in start_thread () from \
/lib64/libpthread.so.0 #5  0x00007f4a09f92aad in clone () from /lib64/libc.so.6

Thread 11 (Thread 0x7f4a061cb700 (LWP 10179)):
#0  0x00007f4a0a2590bf in pthread_cond_wait@@GLIBC_2.3.2 () from \
/lib64/libpthread.so.0 #1  0x00007f4a0cd0bdda in virCondWait \
(c=c@entry=0x56177ca8bbb8,   m=m@entry=0x56177ca8bb90) at util/virthread.c:154
#2  0x00007f4a0cd0cbb3 in virThreadPoolWorker (opaque=opaque@entry=0x56177ca98850)
    at util/virthreadpool.c:124
#3  0x00007f4a0cd0b8f8 in virThreadHelper (data=&lt;optimized out&gt;) at \
util/virthread.c:206 #4  0x00007f4a0a254744 in start_thread () from \
/lib64/libpthread.so.0 #5  0x00007f4a09f92aad in clone () from /lib64/libc.so.6

Thread 10 (Thread 0x7f4a049c8700 (LWP 10182)):
#0  0x00007f4a0a2590bf in pthread_cond_wait@@GLIBC_2.3.2 () from \
/lib64/libpthread.so.0 #1  0x00007f4a0cd0bdda in virCondWait \
(c=c@entry=0x56177ca8bbb8,   m=m@entry=0x56177ca8bb90) at util/virthread.c:154
#2  0x00007f4a0cd0cbb3 in virThreadPoolWorker (opaque=opaque@entry=0x56177ca98720)
    at util/virthreadpool.c:124
#3  0x00007f4a0cd0b8f8 in virThreadHelper (data=&lt;optimized out&gt;) at \
util/virthread.c:206 #4  0x00007f4a0a254744 in start_thread () from \
/lib64/libpthread.so.0 #5  0x00007f4a09f92aad in clone () from /lib64/libc.so.6

Thread 9 (Thread 0x7f4a041c7700 (LWP 10183)):
#0  0x00007f4a0a2590bf in pthread_cond_wait@@GLIBC_2.3.2 () from \
/lib64/libpthread.so.0 #1  0x00007f4a0cd0bdda in virCondWait \
(c=c@entry=0x56177ca8bc58,   m=m@entry=0x56177ca8bb90) at util/virthread.c:154
#2  0x00007f4a0cd0cb4b in virThreadPoolWorker (opaque=opaque@entry=0x56177ca989f0)
    at util/virthreadpool.c:124
#3  0x00007f4a0cd0b8f8 in virThreadHelper (data=&lt;optimized out&gt;) at \
util/virthread.c:206 #4  0x00007f4a0a254744 in start_thread () from \
/lib64/libpthread.so.0 #5  0x00007f4a09f92aad in clone () from /lib64/libc.so.6

Thread 8 (Thread 0x7f4a029c4700 (LWP 10186)):
#0  0x00007f4a0a2590bf in pthread_cond_wait@@GLIBC_2.3.2 () from \
/lib64/libpthread.so.0 #1  0x00007f4a0cd0bdda in virCondWait \
(c=c@entry=0x56177ca8bc58,   m=m@entry=0x56177ca8bb90) at util/virthread.c:154
#2  0x00007f4a0cd0cb4b in virThreadPoolWorker (opaque=opaque@entry=0x56177ca98640)
    at util/virthreadpool.c:124
#3  0x00007f4a0cd0b8f8 in virThreadHelper (data=&lt;optimized out&gt;) at \
util/virthread.c:206 #4  0x00007f4a0a254744 in start_thread () from \
/lib64/libpthread.so.0 #5  0x00007f4a09f92aad in clone () from /lib64/libc.so.6

Thread 7 (Thread 0x7f49fd9db700 (LWP 10191)):
#0  0x00007f4a0a2590bf in pthread_cond_wait@@GLIBC_2.3.2 () from \
/lib64/libpthread.so.0 #1  0x00007f4a0cd0bdda in virCondWait \
(c=c@entry=0x56177ca945e8,   m=m@entry=0x56177ca945c0) at util/virthread.c:154
#2  0x00007f4a0cd0cbb3 in virThreadPoolWorker (opaque=opaque@entry=0x56177ca946c0)
    at util/virthreadpool.c:124
#3  0x00007f4a0cd0b8f8 in virThreadHelper (data=&lt;optimized out&gt;) at \
util/virthread.c:206 #4  0x00007f4a0a254744 in start_thread () from \
/lib64/libpthread.so.0 #5  0x00007f4a09f92aad in clone () from /lib64/libc.so.6

Thread 6 (Thread 0x7f4a039c6700 (LWP 10184)):
#0  0x00007f4a0a2590bf in pthread_cond_wait@@GLIBC_2.3.2 () from \
/lib64/libpthread.so.0 #1  0x00007f4a0cd0bdda in virCondWait \
(c=c@entry=0x56177ca8bc58,   m=m@entry=0x56177ca8bb90) at util/virthread.c:154
#2  0x00007f4a0cd0cb4b in virThreadPoolWorker (opaque=opaque@entry=0x56177ca98640)
    at util/virthreadpool.c:124
#3  0x00007f4a0cd0b8f8 in virThreadHelper (data=&lt;optimized out&gt;) at \
util/virthread.c:206 #4  0x00007f4a0a254744 in start_thread () from \
/lib64/libpthread.so.0 #5  0x00007f4a09f92aad in clone () from /lib64/libc.so.6

Thread 5 (Thread 0x7f49ff1de700 (LWP 10188)):
#0  0x00007f4a0a2590bf in pthread_cond_wait@@GLIBC_2.3.2 () from \
/lib64/libpthread.so.0 #1  0x00007f4a0cd0bdda in virCondWait \
(c=c@entry=0x56177ca945e8,   m=m@entry=0x56177ca945c0) at util/virthread.c:154
#2  0x00007f4a0cd0cbb3 in virThreadPoolWorker (opaque=opaque@entry=0x56177ca946c0)
    at util/virthreadpool.c:124
#3  0x00007f4a0cd0b8f8 in virThreadHelper (data=&lt;optimized out&gt;) at \
util/virthread.c:206 #4  0x00007f4a0a254744 in start_thread () from \
/lib64/libpthread.so.0 #5  0x00007f4a09f92aad in clone () from /lib64/libc.so.6

Thread 4 (Thread 0x7f49fd1da700 (LWP 10192)):
#0  0x00007f4a0a2590bf in pthread_cond_wait@@GLIBC_2.3.2 () from \
/lib64/libpthread.so.0 #1  0x00007f4a0cd0bdda in virCondWait \
(c=c@entry=0x56177ca945e8,   m=m@entry=0x56177ca945c0) at util/virthread.c:154
#2  0x00007f4a0cd0cbb3 in virThreadPoolWorker (opaque=opaque@entry=0x56177ca94890)
    at util/virthreadpool.c:124
#3  0x00007f4a0cd0b8f8 in virThreadHelper (data=&lt;optimized out&gt;) at \
util/virthread.c:206 #4  0x00007f4a0a254744 in start_thread () from \
/lib64/libpthread.so.0 #5  0x00007f4a09f92aad in clone () from /lib64/libc.so.6

Thread 3 (Thread 0x7f4a059ca700 (LWP 10180)):
#0  0x00007f4a0a2590bf in pthread_cond_wait@@GLIBC_2.3.2 () from \
/lib64/libpthread.so.0 #1  0x00007f4a0cd0bdda in virCondWait \
(c=c@entry=0x56177ca8bbb8,   m=m@entry=0x56177ca8bb90) at util/virthread.c:154
#2  0x00007f4a0cd0cbb3 in virThreadPoolWorker (opaque=opaque@entry=0x56177ca98720)
    at util/virthreadpool.c:124
#3  0x00007f4a0cd0b8f8 in virThreadHelper (data=&lt;optimized out&gt;) at \
util/virthread.c:206 #4  0x00007f4a0a254744 in start_thread () from \
/lib64/libpthread.so.0 #5  0x00007f4a09f92aad in clone () from /lib64/libc.so.6

Thread 2 (Thread 0x7f4a021c3700 (LWP 10187)):
#0  0x00007f4a0a2590bf in pthread_cond_wait@@GLIBC_2.3.2 () from \
/lib64/libpthread.so.0 #1  0x00007f4a0cd0bdda in virCondWait \
(c=c@entry=0x56177ca8bc58,   m=m@entry=0x56177ca8bb90) at util/virthread.c:154
#2  0x00007f4a0cd0cb4b in virThreadPoolWorker (opaque=opaque@entry=0x56177ca989f0)
    at util/virthreadpool.c:124
#3  0x00007f4a0cd0b8f8 in virThreadHelper (data=&lt;optimized out&gt;) at \
util/virthread.c:206 #4  0x00007f4a0a254744 in start_thread () from \
/lib64/libpthread.so.0 #5  0x00007f4a09f92aad in clone () from /lib64/libc.so.6

Thread 1 (Thread 0x7f4a069cc700 (LWP 10178)):
#0  0x00007f49ff969170 in qemuDomainChangeEjectableMedia (
    driver=driver@entry=0x7f49f841b700, vm=vm@entry=0x7f49ec02fbd0, 
    disk=disk@entry=0x7f49ec0375d0, newsrc=0x7f49e8014d10, force=force@entry=false)
    at qemu/qemu_hotplug.c:303
#1  0x00007f49ff9e9253 in qemuDomainChangeDiskLive (force=false, \
driver=0x7f49f841b700,   dev=&lt;optimized out&gt;, vm=&lt;optimized out&gt;, conn=&lt;optimized \
out&gt;)  at qemu/qemu_driver.c:7842
#2  qemuDomainUpdateDeviceLive (dom=&lt;optimized out&gt;, force=false, dev=&lt;optimized \
out&gt;,   vm=&lt;optimized out&gt;, conn=&lt;optimized out&gt;) at qemu/qemu_driver.c:7873
#3  qemuDomainUpdateDeviceFlags (dom=&lt;optimized out&gt;, xml=&lt;optimized out&gt;, flags=1)
    at qemu/qemu_driver.c:8583
#4  0x00007f4a0cdd3f47 in virDomainUpdateDeviceFlags (
    domain=domain@entry=0x7f49e800a470, 
    xml=0x7f49e800a530 "&lt;disk type=\"file\" device=\"cdrom\"&gt;\n      &lt;driver \
name=\"qemu\" type=\"raw\"/&gt;\n      &lt;source \
file=\"/home/kvm/etcsdvmb/Medien/V7.0A/CS_licenses/key-cd_VCS85FTSVTL.iso\"/&gt;\n      \
&lt;target dev=\"hdc\" bus=\"sata\" tr"..., flags=0)  at libvirt-domain.c:8338
#5  0x000056177c3e3c3e in remoteDispatchDomainUpdateDeviceFlags \
(server=0x56177ca8ba60,   msg=0x56177ca98210, args=0x7f49e8002e10, \
rerr=0x7f4a069cbc90,   client=&lt;optimized out&gt;) at remote_dispatch.h:12339
#6  remoteDispatchDomainUpdateDeviceFlagsHelper (server=0x56177ca8ba60, 
    client=&lt;optimized out&gt;, msg=0x56177ca98210, rerr=0x7f4a069cbc90, 
    args=0x7f49e8002e10, ret=0x7f49e8004770) at remote_dispatch.h:12315
#7  0x00007f4a0ce49a02 in virNetServerProgramDispatchCall (msg=0x56177ca98210, 
    client=0x56177ca99b80, server=0x56177ca8ba60, prog=0x56177ca986f0)
    at rpc/virnetserverprogram.c:437
#8  virNetServerProgramDispatch (prog=0x56177ca986f0, 
    server=server@entry=0x56177ca8ba60, client=0x56177ca99b80, msg=0x56177ca98210)
    at rpc/virnetserverprogram.c:307
#9  0x000056177c40ab6d in virNetServerProcessMsg (msg=&lt;optimized out&gt;, 
    prog=&lt;optimized out&gt;, client=&lt;optimized out&gt;, srv=0x56177ca8ba60)
    at rpc/virnetserver.c:148
#10 virNetServerHandleJob (jobOpaque=&lt;optimized out&gt;, opaque=0x56177ca8ba60)
    at rpc/virnetserver.c:169
#11 0x00007f4a0cd0cb01 in virThreadPoolWorker (opaque=opaque@entry=0x56177ca989f0)
    at util/virthreadpool.c:167
#12 0x00007f4a0cd0b8f8 in virThreadHelper (data=&lt;optimized out&gt;) at \
util/virthread.c:206 #13 0x00007f4a0a254744 in start_thread () from \
/lib64/libpthread.so.0 #14 0x00007f4a09f92aad in clone () from /lib64/libc.so.6
(gdb) q
           PID: 10177 (libvirtd)
           UID: 0 (root)
           GID: 0 (root)
        Signal: 11 (SEGV)
     Timestamp: Tue 2017-11-14 10:11:32 CET (1 day 2h ago)
  Command Line: /usr/local/sbin/libvirtd -d
    Executable: /usr/local/sbin/libvirtd
 Control Group: /
         Slice: -.slice
       Boot ID: 4d5f74eefb0244c2bc3b2c99986dcee8
    Machine ID: beeb301fe87a14b2eabdb6a75a01cbae
      Hostname: etcsvms5
      Coredump: /var/lib/systemd/coredump/core.libvirtd.0.4d5f74eefb0244c2bc3b2c99986dcee8.10177.1510650692000000.xz
  Message: Process 10177 (libvirtd) of user 0 dumped core.



</body></email><email><emailId>20171115190940</emailId><senderName>John Ferlan</senderName><senderEmail>jferlan@redhat.com</senderEmail><timestampReceived>2017-11-15 19:09:40-0400</timestampReceived><subject>Re: [libvirt-users] Urgent: virsh - change-media run into a promptly close of libvirt</subject><body>



On 11/15/2017 06:54 AM, Holger Schranz wrote:
&gt; Thread 1 (Thread 0x7f4a069cc700 (LWP 10178)):
&gt; #0  0x00007f49ff969170 in qemuDomainChangeEjectableMedia (
&gt; driver=driver@entry=0x7f49f841b700, vm=vm@entry=0x7f49ec02fbd0, 
&gt; disk=disk@entry=0x7f49ec0375d0, newsrc=0x7f49e8014d10, force=force@entry=false)
&gt; at qemu/qemu_hotplug.c:303

This is fixed in current upstream by commit id '8056721cbb'

John


&gt; #1  0x00007f49ff9e9253 in qemuDomainChangeDiskLive (force=false, \
&gt; driver=0x7f49f841b700,  dev=&lt;optimized out&gt;, vm=&lt;optimized out&gt;, conn=&lt;optimized \
&gt; out&gt;) at qemu/qemu_driver.c:7842
&gt; #2  qemuDomainUpdateDeviceLive (dom=&lt;optimized out&gt;, force=false, dev=&lt;optimized \
&gt; out&gt;,  vm=&lt;optimized out&gt;, conn=&lt;optimized out&gt;) at qemu/qemu_driver.c:7873
&gt; #3  qemuDomainUpdateDeviceFlags (dom=&lt;optimized out&gt;, xml=&lt;optimized out&gt;, flags=1)
&gt; at qemu/qemu_driver.c:8583
&gt; #4  0x00007f4a0cdd3f47 in virDomainUpdateDeviceFlags (
&gt; domain=domain@entry=0x7f49e800a470, 
&gt; xml=0x7f49e800a530 "&lt;disk type=\"file\" device=\"cdrom\"&gt;\n      &lt;driver \
&gt; name=\"qemu\" type=\"raw\"/&gt;\n      &lt;source \
&gt; file=\"/home/kvm/etcsdvmb/Medien/V7.0A/CS_licenses/key-cd_VCS85FTSVTL.iso\"/&gt;\n     \
&gt; &lt;target dev=\"hdc\" bus=\"sata\" tr"..., flags=0) at libvirt-domain.c:8338
&gt; #5  0x000056177c3e3c3e in remoteDispatchDomainUpdateDeviceFlags \
&gt; (server=0x56177ca8ba60,  msg=0x56177ca98210, args=0x7f49e8002e10, \
&gt; rerr=0x7f4a069cbc90,  client=&lt;optimized out&gt;) at remote_dispatch.h:12339
&gt; #6  remoteDispatchDomainUpdateDeviceFlagsHelper (server=0x56177ca8ba60, 
&gt; client=&lt;optimized out&gt;, msg=0x56177ca98210, rerr=0x7f4a069cbc90, 
&gt; args=0x7f49e8002e10, ret=0x7f49e8004770) at remote_dispatch.h:12315
&gt; #7  0x00007f4a0ce49a02 in virNetServerProgramDispatchCall (msg=0x56177ca98210, 
&gt; client=0x56177ca99b80, server=0x56177ca8ba60, prog=0x56177ca986f0)
&gt; at rpc/virnetserverprogram.c:437
&gt; #8  virNetServerProgramDispatch (prog=0x56177ca986f0, 
&gt; server=server@entry=0x56177ca8ba60, client=0x56177ca99b80, msg=0x56177ca98210)
&gt; at rpc/virnetserverprogram.c:307
&gt; #9  0x000056177c40ab6d in virNetServerProcessMsg (msg=&lt;optimized out&gt;, 
&gt; prog=&lt;optimized out&gt;, client=&lt;optimized out&gt;, srv=0x56177ca8ba60)
&gt; at rpc/virnetserver.c:148
&gt; #10 virNetServerHandleJob (jobOpaque=&lt;optimized out&gt;, opaque=0x56177ca8ba60)
&gt; at rpc/virnetserver.c:169
&gt; #11 0x00007f4a0cd0cb01 in virThreadPoolWorker (opaque=opaque@entry=0x56177ca989f0)
&gt; at util/virthreadpool.c:167
&gt; #12 0x00007f4a0cd0b8f8 in virThreadHelper (data=&lt;optimized out&gt;) at \
&gt; util/virthread.c:206 #13 0x00007f4a0a254744 in start_thread () from \
&gt; /lib64/libpthread.so.0 #14 0x00007f4a09f92aad in clone () from /lib64/libc.so.6
&gt; (gdb) q
&gt; PID: 10177 (libvirtd)
&gt; UID: 0 (root)
&gt; GID: 0 (root)
&gt; Signal: 11 (SEGV)
&gt; Timestamp: Tue 2017-11-14 10:11:32 CET (1 day 2h ago)
&gt; Command Line: /usr/local/sbin/libvirtd -d
&gt; Executable: /usr/local/sbin/libvirtd
&gt; Control Group: /
&gt; Slice: -.slice
&gt; Boot ID: 4d5f74eefb0244c2bc3b2c99986dcee8
&gt; Machine ID: beeb301fe87a14b2eabdb6a75a01cbae
&gt; Hostname: etcsvms5
&gt; Coredump: /var/lib/systemd/coredump/core.libvirtd.0.4d5f74eefb0244c2bc3b2c99986dcee8.10177.1510650692000000.xz
&gt;                 
&gt; Message: Process 10177 (libvirtd) of user 0 dumped core.


</body></email><email><emailId>20171114175651</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-11-14 17:56:51-0400</timestampReceived><subject>Re: [libvirt-users] dramatic performance slowdown due to THP allocation failure with full pagecache</subject><body>

On Tue, Nov 14, 2017 at 10:52:03AM -0700, Blair Bethwaite wrote:
&gt; Thanks for the reply Daniel,
&gt; 
&gt; However I think you slightly misunderstood the scenario...
&gt; 
&gt; On 14 November 2017 at 10:32, Daniel P. Berrange &lt;berrange@redhat.com&gt; wrote:
&gt; &gt; IOW, if your application has a certain expectation of performance that can only
&gt; &gt; be satisfied by having the KVM guest backed by huge pages, then you should
&gt; &gt; really change to explicitly reserve huge pages for the guests, and not rely on
&gt; &gt; THP which inherantly can't provide any guarantee in this area.
&gt; 
&gt; We already do this. The problem is not hugepage backing of the guest,
&gt; it is THP allocation inside the guest (or indeed on a bare-metal
&gt; host). The issue in the HPC world is that we support so many different
&gt; applications (some of which are complete black-boxes) that explicit
&gt; hugepage allocation for application memory is generally not viable, so
&gt; we are reliant on THP to avoid TLB thrashing.

Oh well THP usage inside the guest is then not really anything todo with
virt, just a regular Linux questions, so not sure libvirt is the best
place to ask.


Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20171114180330</emailId><senderName>Blair Bethwaite</senderName><senderEmail>blair.bethwaite@gmail.com</senderEmail><timestampReceived>2017-11-14 18:03:30-0400</timestampReceived><subject>Re: [libvirt-users] dramatic performance slowdown due to THP allocation failure with full pagecache</subject><body>

On 14 November 2017 at 10:56, Daniel P. Berrange &lt;berrange@redhat.com&gt; wrote:
&gt; Oh well THP usage inside the guest is then not really anything todo with
&gt; virt, just a regular Linux questions, so not sure libvirt is the best
&gt; place to ask.

True, I just hoped you or one of the other devs might have some
insight on reclaim behaviour that would provide a clue. I guess I'll
try a linux list.

Any comment on this (which is virt related):
(1) a related and possibly dumb question: in the case of a
high-performance KVM where the guest is hugepage backed and pinned in
host memory anyway, why do we still have a table based resolution for
guest physical to host virtual address translation - couldn't this
just be done by offset?

-- 
Cheers,
~Blairo

</body></email><email><emailId>20171107101630</emailId><senderName>Vasiliy Tolstov</senderName><senderEmail>v.tolstov@selfip.ru</senderEmail><timestampReceived>2017-11-07 10:16:30-0400</timestampReceived><subject>Re: [libvirt-users] using LVM thin pool LVs as a storage for libvirt guest</subject><body>

Please don't use lvm thin for vm. In our hosting in Russia we have
100-150 vps on each node with lvm thin pool on ssd and have locks,
slowdowns and other bad things because of COW. After we switching to
qcow2 files on plain ssd ext4 fs and happy =).


2017-11-04 23:21 GMT+03:00 Jan Hutař &lt;jhutar@redhat.com&gt;:
&gt; Hello,
&gt; as usual, I'm few years behind trends so I have learned about LVM thin
&gt; volumes recently and I especially like that your volumes can be "sparse"
&gt; - that you can have 1TB thin volume on 250GB VG/thin pool.
&gt;
&gt; Is it somehow possible to use that with libvirt?
&gt;
&gt; I have found this post from 2014:
&gt;
&gt;    https://www.redhat.com/archives/libvirt-users/2014-August/msg00010.html
&gt;
&gt; which says you should be able to create "sparse" volume with `virsh
&gt; vol-create ...` or that libvirt should be able to see thin volumes you
&gt; create yourself, but neither of that works for me
&gt; (libvirt-3.2.1-6.fc26.x86_64).
&gt;
&gt; This way I try to create new:
&gt;
&gt;    # vgs storage
&gt;      VG      #PV #LV #SN Attr   VSize   VFree
&gt;      storage   1   1   0 wz--n- 267.93g    0    # lvs storage -a
&gt;      LV              VG      Attr       LSize   Pool Origin Data%  Meta%
&gt; Move Log Cpy%Sync Convert
&gt;      [lvol0_pmspare] storage ewi-------  68.00m
&gt; lvol1           storage twi-aotz-- 267.80g             0.00   0.44
&gt; [lvol1_tdata]   storage Twi-ao---- 267.80g
&gt; [lvol1_tmeta]   storage ewi-ao----  68.00m
&gt;    # virsh pool-dumpxml storage
&gt;    &lt;pool type='logical'&gt;
&gt;      &lt;name&gt;storage&lt;/name&gt;
&gt;      &lt;uuid&gt;f523aed2-a7e4-4dc2-88db-0193a7337704&lt;/uuid&gt;
&gt;      &lt;capacity unit='bytes'&gt;287687311360&lt;/capacity&gt;
&gt;      &lt;allocation unit='bytes'&gt;287687311360&lt;/allocation&gt;
&gt;      &lt;available unit='bytes'&gt;0&lt;/available&gt;
&gt;      &lt;source&gt;
&gt;        &lt;device path='/dev/nvme0n1p3'/&gt;
&gt;        &lt;name&gt;storage&lt;/name&gt;
&gt;        &lt;format type='lvm2'/&gt;
&gt;      &lt;/source&gt;
&gt;      &lt;target&gt;
&gt;        &lt;path&gt;/dev/storage&lt;/path&gt;
&gt;      &lt;/target&gt;
&gt;    &lt;/pool&gt;
&gt;    # cat /tmp/big.xml
&gt;    &lt;volume&gt;
&gt;      &lt;name&gt;big&lt;/name&gt;
&gt;      &lt;capacity&gt;1073741824&lt;/capacity&gt;
&gt;      &lt;allocation&gt;1048576&lt;/allocation&gt;
&gt;      &lt;target&gt;
&gt;        &lt;path&gt;/dev/storage/big&lt;/path&gt;
&gt;      &lt;/target&gt;
&gt;    &lt;/volume&gt;
&gt;    # virsh vol-create storage /tmp/big.xml    error: Failed to create vol
&gt; from /tmp/big.xml
&gt;    error: internal error: Child process (/usr/sbin/lvcreate --name big -L
&gt; 1024K --type snapshot --virtualsize 1048576K storage) unexpected exit status
&gt; 5:   Volume group "storage" has insufficient free space (0 extents): 1
&gt; required.
&gt;
&gt; When I create thin volume manually, I do not see it:
&gt;
&gt;    # lvcreate -n big -V 500G --thinpool storage/lvol1
&gt;      Using default stripesize 64.00 KiB.
&gt;      WARNING: Sum of all thin volume sizes (500.00 GiB) exceeds the size of
&gt; thin pool storage/lvol1 and the size of whole volume group (267.93 GiB)!
&gt;      For thin pool auto extension activation/thin_pool_autoextend_threshold
&gt; should be below 100.
&gt;      Logical volume "big" created.
&gt;    # lvs storage -a
&gt;      LV              VG      Attr       LSize   Pool  Origin Data%  Meta%
&gt; Move Log Cpy%Sync Convert
&gt;      big             storage Vwi-a-tz-- 500.00g lvol1        0.00
&gt; [lvol0_pmspare] storage ewi-------  68.00m
&gt; lvol1           storage twi-aotz-- 267.80g              0.00   0.45
&gt; [lvol1_tdata]   storage Twi-ao---- 267.80g
&gt; [lvol1_tmeta]   storage ewi-ao----  68.00m
&gt; # virsh vol-list storage
&gt;     Name                 Path
&gt; ------------------------------------------------------------------------------
&gt;
&gt;
&gt; Do I understand the concept incorrectly, or is there something else to
&gt; configure?
&gt;
&gt; At the end I want to get max IO performance with possibility to
&gt; "overcommit disk space". I know I can use storage "dir", but thought
&gt; there might be something faster?
&gt;
&gt; Thank you very much for a response,
&gt; Jan
&gt;
&gt;
&gt;
&gt; --
&gt; Jan Hutar     Systems Management QA
&gt; jhutar@redhat.com     Red Hat, Inc.
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users



-- 
Vasiliy Tolstov,
e-mail: v.tolstov@selfip.ru

</body></email><email><emailId>20171107104655</emailId><senderName>Jan =?utf-8?B?SHV0YcWZ?=</senderName><senderEmail>jhutar@redhat.com</senderEmail><timestampReceived>2017-11-07 10:46:55-0400</timestampReceived><subject>Re: [libvirt-users] using LVM thin pool LVs as a storage for libvirt guest</subject><body>

Do you have some comparasion of IO performance on thin pool vs. qcow2
file on fs?

In my case each VM would have its own thin volume. I just want to
overcommit disk-space.

Regards,
Jan



On 2017-11-07 13:16 +0300, Vasiliy Tolstov wrote:
&gt;Please don't use lvm thin for vm. In our hosting in Russia we have
&gt;100-150 vps on each node with lvm thin pool on ssd and have locks,
&gt;slowdowns and other bad things because of COW. After we switching to
&gt;qcow2 files on plain ssd ext4 fs and happy =).
&gt;
&gt;
&gt;2017-11-04 23:21 GMT+03:00 Jan Hutař &lt;jhutar@redhat.com&gt;:
&gt;&gt; Hello,
&gt;&gt; as usual, I'm few years behind trends so I have learned about LVM thin
&gt;&gt; volumes recently and I especially like that your volumes can be "sparse"
&gt;&gt; - that you can have 1TB thin volume on 250GB VG/thin pool.
&gt;&gt;
&gt;&gt; Is it somehow possible to use that with libvirt?
&gt;&gt;
&gt;&gt; I have found this post from 2014:
&gt;&gt;
&gt;&gt;    https://www.redhat.com/archives/libvirt-users/2014-August/msg00010.html
&gt;&gt;
&gt;&gt; which says you should be able to create "sparse" volume with `virsh
&gt;&gt; vol-create ...` or that libvirt should be able to see thin volumes you
&gt;&gt; create yourself, but neither of that works for me
&gt;&gt; (libvirt-3.2.1-6.fc26.x86_64).
&gt;&gt;
&gt;&gt; This way I try to create new:
&gt;&gt;
&gt;&gt;    # vgs storage
&gt;&gt;      VG      #PV #LV #SN Attr   VSize   VFree
&gt;&gt;      storage   1   1   0 wz--n- 267.93g    0    # lvs storage -a
&gt;&gt;      LV              VG      Attr       LSize   Pool Origin Data%  Meta%
&gt;&gt; Move Log Cpy%Sync Convert
&gt;&gt;      [lvol0_pmspare] storage ewi-------  68.00m
&gt;&gt; lvol1           storage twi-aotz-- 267.80g             0.00   0.44
&gt;&gt; [lvol1_tdata]   storage Twi-ao---- 267.80g
&gt;&gt; [lvol1_tmeta]   storage ewi-ao----  68.00m
&gt;&gt;    # virsh pool-dumpxml storage
&gt;&gt;    &lt;pool type='logical'&gt;
&gt;&gt;      &lt;name&gt;storage&lt;/name&gt;
&gt;&gt;      &lt;uuid&gt;f523aed2-a7e4-4dc2-88db-0193a7337704&lt;/uuid&gt;
&gt;&gt;      &lt;capacity unit='bytes'&gt;287687311360&lt;/capacity&gt;
&gt;&gt;      &lt;allocation unit='bytes'&gt;287687311360&lt;/allocation&gt;
&gt;&gt;      &lt;available unit='bytes'&gt;0&lt;/available&gt;
&gt;&gt;      &lt;source&gt;
&gt;&gt;        &lt;device path='/dev/nvme0n1p3'/&gt;
&gt;&gt;        &lt;name&gt;storage&lt;/name&gt;
&gt;&gt;        &lt;format type='lvm2'/&gt;
&gt;&gt;      &lt;/source&gt;
&gt;&gt;      &lt;target&gt;
&gt;&gt;        &lt;path&gt;/dev/storage&lt;/path&gt;
&gt;&gt;      &lt;/target&gt;
&gt;&gt;    &lt;/pool&gt;
&gt;&gt;    # cat /tmp/big.xml
&gt;&gt;    &lt;volume&gt;
&gt;&gt;      &lt;name&gt;big&lt;/name&gt;
&gt;&gt;      &lt;capacity&gt;1073741824&lt;/capacity&gt;
&gt;&gt;      &lt;allocation&gt;1048576&lt;/allocation&gt;
&gt;&gt;      &lt;target&gt;
&gt;&gt;        &lt;path&gt;/dev/storage/big&lt;/path&gt;
&gt;&gt;      &lt;/target&gt;
&gt;&gt;    &lt;/volume&gt;
&gt;&gt;    # virsh vol-create storage /tmp/big.xml    error: Failed to create vol
&gt;&gt; from /tmp/big.xml
&gt;&gt;    error: internal error: Child process (/usr/sbin/lvcreate --name big -L
&gt;&gt; 1024K --type snapshot --virtualsize 1048576K storage) unexpected exit status
&gt;&gt; 5:   Volume group "storage" has insufficient free space (0 extents): 1
&gt;&gt; required.
&gt;&gt;
&gt;&gt; When I create thin volume manually, I do not see it:
&gt;&gt;
&gt;&gt;    # lvcreate -n big -V 500G --thinpool storage/lvol1
&gt;&gt;      Using default stripesize 64.00 KiB.
&gt;&gt;      WARNING: Sum of all thin volume sizes (500.00 GiB) exceeds the size of
&gt;&gt; thin pool storage/lvol1 and the size of whole volume group (267.93 GiB)!
&gt;&gt;      For thin pool auto extension activation/thin_pool_autoextend_threshold
&gt;&gt; should be below 100.
&gt;&gt;      Logical volume "big" created.
&gt;&gt;    # lvs storage -a
&gt;&gt;      LV              VG      Attr       LSize   Pool  Origin Data%  Meta%
&gt;&gt; Move Log Cpy%Sync Convert
&gt;&gt;      big             storage Vwi-a-tz-- 500.00g lvol1        0.00
&gt;&gt; [lvol0_pmspare] storage ewi-------  68.00m
&gt;&gt; lvol1           storage twi-aotz-- 267.80g              0.00   0.45
&gt;&gt; [lvol1_tdata]   storage Twi-ao---- 267.80g
&gt;&gt; [lvol1_tmeta]   storage ewi-ao----  68.00m
&gt;&gt; # virsh vol-list storage
&gt;&gt;     Name                 Path
&gt;&gt; ------------------------------------------------------------------------------
&gt;&gt;
&gt;&gt;
&gt;&gt; Do I understand the concept incorrectly, or is there something else to
&gt;&gt; configure?
&gt;&gt;
&gt;&gt; At the end I want to get max IO performance with possibility to
&gt;&gt; "overcommit disk space". I know I can use storage "dir", but thought
&gt;&gt; there might be something faster?
&gt;&gt;
&gt;&gt; Thank you very much for a response,
&gt;&gt; Jan
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Jan Hutar     Systems Management QA
&gt;&gt; jhutar@redhat.com     Red Hat, Inc.
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; libvirt-users mailing list
&gt;&gt; libvirt-users@redhat.com
&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;
&gt;
&gt;
&gt;-- 
&gt;Vasiliy Tolstov,
&gt;e-mail: v.tolstov@selfip.ru
&gt;

-- 
Jan Hutar     Systems Management QA
jhutar@redhat.com     Red Hat, Inc.

</body></email><email><emailId>20171107144950</emailId><senderName>Vasiliy Tolstov</senderName><senderEmail>v.tolstov@selfip.ru</senderEmail><timestampReceived>2017-11-07 14:49:50-0400</timestampReceived><subject>Re: [libvirt-users] using LVM thin pool LVs as a storage for libvirt guest</subject><body>

2017-11-07 13:46 GMT+03:00 Jan Hutař &lt;jhutar@redhat.com&gt;:
&gt; Do you have some comparasion of IO performance on thin pool vs. qcow2
&gt; file on fs?
&gt;

I don't have actual data (i'm switched from lvm thinp is about 1-1.5
year ago. But when we test it - sometimes qcow2 gave us better
performance when raw on fs and thin volume. If you increase number of
running vm on the same time performance of lvm thinp lowering.

&gt; In my case each VM would have its own thin volume. I just want to
&gt; overcommit disk-space.
&gt;

Yes, we do something like this, but if you lost time when thin pool
has no space - all you vm stopped and you can lost you data inside vm!
So overcommit and vm on thin pool is really dangerous.



Vasiliy Tolstov,
e-mail: v.tolstov@selfip.ru

</body></email><email><emailId>20171107021312</emailId><senderName>netsurfed</senderName><senderEmail>zhuohaofan@126.com</senderEmail><timestampReceived>2017-11-07 02:13:12-0400</timestampReceived><subject>[libvirt-users] this function is not supported by the connection driver: virInterfaceDefineXML</subject><body>

[Attachment #2 (text/plain)]

Hi all:
I'm facing problems trying to define a bridge on Ubuntu 16.04, using libvirt 3.4.0.
When I try to do:
root@ubuntu-180:/tmp# virsh iface-define iface-testbr1.xml

I get the following error:
error: Failed to define interface from iface-testbr1.xml
error: this function is not supported by the connection driver: virInterfaceDefineXML

What can i do to make this function works normally? THX.
The xml file as:
&lt;interface type='bridge' name='testbr1'&gt;
  &lt;mtu size='1500'/&gt;
  &lt;bridge stp='on' delay='1500'&gt;
      &lt;interface type='ethernet' name='enp9s0'&gt;
            &lt;link speed='1000' state='up'/&gt;
            &lt;mac address='0c:c4:7a:c1:63:17'/&gt;
      &lt;/interface&gt;
   &lt;/bridge&gt;
&lt;/interface&gt;
root@ubuntu-180:/tmp# uname -a
Linux ubuntu-180 4.4.0-62-generic #83-Ubuntu SMP Wed Jan 18 14:10:15 UTC 2017 x86_64 \
x86_64 x86_64 GNU/Linux


[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div&gt;Hi \
all:&lt;/div&gt;&lt;div&gt;&lt;pre&gt;I'm facing problems trying to define a bridge on Ubuntu 16.04, \
using libvirt 3.4.0.&lt;/pre&gt;&lt;pre&gt;When I try to do: root@ubuntu-180:/tmp# virsh \
iface-define iface-testbr1.xml

I get the following error:
error: Failed to define interface from iface-testbr1.xml
error: this function is not supported by the connection driver: \
virInterfaceDefineXML&lt;br&gt;&lt;/pre&gt;&lt;pre&gt;What can i do to make this function works \
normally? THX.&lt;/pre&gt;&lt;pre&gt;The xml file as:&lt;/pre&gt;&lt;pre&gt;&lt;interface type='bridge' \
name='testbr1'&gt;&lt;/pre&gt;&lt;pre&gt;  &lt;mtu size='1500'/&gt;  &lt;bridge stp='on' \
delay='1500'&gt;  &lt;interface type='ethernet' name='enp9s0'&gt;
            &lt;link speed='1000' state='up'/&gt;
            &lt;mac address='0c:c4:7a:c1:63:17'/&gt;
      &lt;/interface&gt;
   &lt;/bridge&gt;
&lt;/interface&gt;&lt;/pre&gt;&lt;pre&gt;root@ubuntu-180:/tmp# uname -a
Linux ubuntu-180 4.4.0-62-generic #83-Ubuntu SMP Wed Jan 18 14:10:15 UTC 2017 x86_64 \
x86_64 x86_64 GNU/Linux &lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20171106134331</emailId><senderName>Hans Knecht</senderName><senderEmail>hans.knecht@kinsaleins.com</senderEmail><timestampReceived>2017-11-06 13:43:31-0400</timestampReceived><subject>Re: [libvirt-users] Live Migration Issue</subject><body>

This is a multipart message in MIME format.
[Attachment #2 (multipart/alternative)]


Sorry, ctrl entered.

 

I'm hoping someone here can help me figure out what's going on here.

 

I've got two CentOS 7 hosts with shared storage that I'm trying to do live
migrations between and I'm running into an error with VMs that were
originally created on a CentOS 6 host and then moved the CentOS 7 hosts.
The CentOS 6 VM runs fine on the host, and can do non-live migrations
without any issues, however when attempting to live migrate the VM it
fails. The VM itself is CentOS 7. Live migration does work when using VMs
created using CentOS 7.

 

Error message: 

"libvirtd virKeepAliveTimerInternal connection closed due to keep alive
timeout.

Cannot acquire state change lock (held by
remoteDispatchDomainMigratePrepare3params)"

 

Surrounding error messages here: 

Origin Host: https://pastebin.com/fLN6DRiq

Recipient Host: https://pastebin.com/xR6mnaW2

 

The command being run is: 

Virsh --connect qemu:///system migrate --live vmname
qemu+SSH://host2/system

 

Firewall is turned off, SELinux is turned off, CentOS 7 CPUs are
identical, both hosts fully updated.

 

I've tried: 

 

Converting the VM from QCOW2 to Raw

Converting the VM from QCOW2 to QCOW2 to try to get it to regenerate the
XML/inject CentOS 7 Drivers

Installed new drivers

Updated all the packages in the VM.

Removed all the Devices from the VM, except the HDDs.

 

 

Hans Knecht - DevOps Network Administrator

Kinsale Insurance Company  I  2221 Edward Holland Drive I  Suite 600  I
Richmond, VA 23230

(804) 289-1300 x5102 office  I (804) 673-5697 fax I
&lt;mailto:hans.knecht@kinsaleins.com&gt; hans.knecht@kinsaleins.com I
www.kinsaleins.com

 

From: Hans Knecht [mailto:hans.knecht@kinsaleins.com] 
Sent: Monday, November 06, 2017 8:38 AM
To: 'libvirt-users@redhat.com' &lt;libvirt-users@redhat.com&gt;
Subject: Live Migration Issue

 

I'm hoping someone here can help me figure out what's going on here.

 

I've got two CentOS 7 hosts with shared storage that I'm trying to do live
migrations between and I'm running into an error with VMs that were
originally created on a CentOS 6 host and then moved the CentOS 7 hosts.
The CentOS 6 VM runs fine on the host, and can do non-live migrations
without any issues, however when attempting to live migrate the VM it
fails with the following error message:

 

Hans Knecht - DevOps Network Administrator

Kinsale Insurance Company  I  2221 Edward Holland Drive I  Suite 600  I
Richmond, VA 23230

(804) 289-1300 x5102 office  I (804) 673-5697 fax I
&lt;mailto:hans.knecht@kinsaleins.com&gt; hans.knecht@kinsaleins.com I
www.kinsaleins.com

 &lt;http://www.kinsaleins.com/&gt;   

This communication constitutes an electronic communication within the
meaning of the Electronic Communications Privacy Act, 19 USC 2510, and its
disclosure is strictly limited to the recipient intended by the sender of
this message. This communication may contain confidential and privileged
material for the sole use of the intended recipient and the disclosure to
anyone other than the intended recipient does not constitute a loss of the
confidential or privileged nature of the communication. If you are not the
intended recipient, please contact the sender by return electronic mail
and delete all copies of this communication. Please check for any defects
or viruses before opening or using any attachments. There is no warranty
that this e-mail is virus free or without error.  No Kinsale Company is
liable if an attachment is altered without its written consent. Thank you.


 


[Attachment #5 (text/html)]

&lt;html xmlns:v="urn:schemas-microsoft-com:vml" \
xmlns:o="urn:schemas-microsoft-com:office:office" \
xmlns:w="urn:schemas-microsoft-com:office:word" \
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" \
xmlns="http://www.w3.org/TR/REC-html40"&gt;&lt;head&gt;&lt;META HTTP-EQUIV="Content-Type" \
CONTENT="text/html; charset=us-ascii"&gt;&lt;meta name=Generator content="Microsoft Word 15 \
(filtered medium)"&gt;&lt;!--[if !mso]&gt;&lt;style&gt;v\:* {behavior:url(#default#VML);} o\:* \
{behavior:url(#default#VML);} w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
&lt;/style&gt;&lt;![endif]--&gt;&lt;style&gt;&lt;!--
/* Font Definitions */
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:"Arial Narrow";
	panose-1:2 11 6 6 2 2 2 3 2 4;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:#0563C1;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:#954F72;
	text-decoration:underline;}
span.EmailStyle17
	{mso-style-type:personal;
	font-family:"Calibri",sans-serif;
	color:windowtext;}
span.EmailStyle18
	{mso-style-type:personal-reply;
	font-family:"Calibri",sans-serif;
	color:#1F497D;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-size:10.0pt;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
--&gt;&lt;/style&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapedefaults v:ext="edit" spidmax="1026" /&gt;
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapelayout v:ext="edit"&gt;
&lt;o:idmap v:ext="edit" data="1" /&gt;
&lt;/o:shapelayout&gt;&lt;/xml&gt;&lt;![endif]--&gt;&lt;/head&gt;&lt;body lang=EN-US link="#0563C1" \
vlink="#954F72"&gt;&lt;div class=WordSection1&gt;&lt;p class=MsoNormal&gt;&lt;span \
style='color:#1F497D'&gt;Sorry, ctrl entered.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;span style='color:#1F497D'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;I’m hoping someone here can help me figure out what’s \
going on here.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;I’ve got two CentOS 7 hosts with shared storage that I’m \
trying to do live migrations between and I’m running into an error with VMs \
that were originally created on a CentOS 6 host and then moved the CentOS 7 hosts. \
The CentOS 6 VM runs fine on the host, and can do non-live migrations without any \
issues, however when attempting to live migrate the VM it fails. The VM itself is \
CentOS 7. Live migration does work when using VMs created using CentOS \
7.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;Error \
message: &lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;“libvirtd virKeepAliveTimerInternal \
connection closed due to keep alive timeout.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;Cannot \
acquire state change lock (held by \
remoteDispatchDomainMigratePrepare3params)”&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;Surrounding error messages \
here: &lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;Origin Host: &lt;a \
href="https://pastebin.com/fLN6DRiq"&gt;https://pastebin.com/fLN6DRiq&lt;/a&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;Recipient Host: &lt;a \
href="https://pastebin.com/xR6mnaW2"&gt;https://pastebin.com/xR6mnaW2&lt;/a&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;The command being run is: \
&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;Virsh --connect qemu:///system migrate --live \
vmname qemu+SSH://host2/system&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;Firewall is turned off, \
SELinux is turned off, CentOS 7 CPUs are identical, both hosts fully \
updated.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;I’ve tried: &lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;Converting the VM from QCOW2 \
to Raw&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;Converting the VM from QCOW2 to QCOW2 to try \
to get it to regenerate the XML/inject CentOS 7 Drivers&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;Installed new drivers&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;Updated all \
the packages in the VM.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;Removed all the Devices from \
the VM, except the HDDs.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;div&gt;&lt;p class=MsoNormal&gt;&lt;b&gt;&lt;span \
style='font-size:10.5pt;font-family:"Arial Narrow",sans-serif;color:#1F497D'&gt;Hans \
Knecht – DevOps Network Administrator&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/b&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;span style='font-size:10.5pt;font-family:"Arial \
Narrow",sans-serif;color:#1F497D'&gt;Kinsale Insurance Company  I  2221 Edward \
Holland Drive I  Suite 600  I  Richmond, VA \
23230&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;span \
style='font-size:10.5pt;font-family:"Arial Narrow",sans-serif;color:#1F497D'&gt;(804) \
289-1300 x5102 office  I (804) 673-5697 fax I &lt;/span&gt;&lt;span \
style='color:#1F497D'&gt;&lt;a href="mailto:hans.knecht@kinsaleins.com"&gt;&lt;span \
style='font-size:10.5pt;font-family:"Arial \
Narrow",sans-serif;color:blue'&gt;hans.knecht@kinsaleins.com&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;&lt;span \
style='font-size:10.5pt;font-family:"Arial Narrow",sans-serif;color:#1F497D'&gt; I \
&lt;/span&gt;&lt;span style='color:#1F497D'&gt;&lt;a href="www.kinsaleins.com"&gt;&lt;span \
style='font-size:10.5pt;font-family:"Arial \
Narrow",sans-serif;color:blue'&gt;www.kinsaleins.com&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;&lt;span \
style='color:#1F497D'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p class=MsoNormal&gt;&lt;span \
style='color:#1F497D'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;div&gt;&lt;div \
style='border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in'&gt;&lt;p \
class=MsoNormal&gt;&lt;b&gt;From:&lt;/b&gt; Hans Knecht [mailto:hans.knecht@kinsaleins.com] \
&lt;br&gt;&lt;b&gt;Sent:&lt;/b&gt; Monday, November 06, 2017 8:38 AM&lt;br&gt;&lt;b&gt;To:&lt;/b&gt; \
'libvirt-users@redhat.com' &lt;libvirt-users@redhat.com&gt;&lt;br&gt;&lt;b&gt;Subject:&lt;/b&gt; Live \
Migration Issue&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;I’m hoping someone here can help me figure out what’s \
going on here.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;I’ve got two CentOS 7 hosts with shared storage that I’m \
trying to do live migrations between and I’m running into an error with VMs \
that were originally created on a CentOS 6 host and then moved the CentOS 7 hosts. \
The CentOS 6 VM runs fine on the host, and can do non-live migrations without any \
issues, however when attempting to live migrate the VM it fails with the following \
error message:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;b&gt;&lt;span style='font-size:10.5pt;font-family:"Arial \
Narrow",sans-serif;color:#1F497D'&gt;Hans Knecht – DevOps Network \
Administrator&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/b&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;span \
style='font-size:10.5pt;font-family:"Arial Narrow",sans-serif;color:#1F497D'&gt;Kinsale \
Insurance Company  I  2221 Edward Holland Drive I  Suite \
600  I  Richmond, VA 23230&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;span \
style='font-size:10.5pt;font-family:"Arial Narrow",sans-serif;color:#1F497D'&gt;(804) \
289-1300 x5102 office  I (804) 673-5697 fax I &lt;/span&gt;&lt;a \
href="mailto:hans.knecht@kinsaleins.com"&gt;&lt;span \
style='font-size:10.5pt;font-family:"Arial \
Narrow",sans-serif;color:blue'&gt;hans.knecht@kinsaleins.com&lt;/span&gt;&lt;/a&gt;&lt;span \
style='font-size:10.5pt;font-family:"Arial Narrow",sans-serif;color:#1F497D'&gt; I \
&lt;/span&gt;&lt;a href="www.kinsaleins.com"&gt;&lt;span style='font-size:10.5pt;font-family:"Arial \
Narrow",sans-serif;color:blue'&gt;www.kinsaleins.com&lt;/span&gt;&lt;/a&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;a href="http://www.kinsaleins.com/"&gt;&lt;span \
style='color:windowtext;text-decoration:none'&gt;&lt;img border=0 width=219 height=85 \
id="Picture_x0020_2" src="cid:image001.jpg@01D356DB.52B645A0" \
alt="KinsaleInsurance__logo.jpg"&gt;&lt;/span&gt;&lt;/a&gt;  &lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;span \
style='font-size:8.0pt;font-family:"Arial",sans-serif;color:#7F7F7F'&gt;This \
communication constitutes an electronic communication within the meaning of the \
Electronic Communications Privacy Act, 19 USC 2510, and its disclosure is strictly \
limited to the recipient intended by the sender of this message. This communication \
may contain confidential and privileged material for the sole use of the intended \
recipient and the disclosure to anyone other than the intended recipient does not \
constitute a loss of the confidential or privileged nature of the communication. If \
you are not the intended recipient, please contact the sender by return electronic \
mail and delete all copies of this communication. Please check for any defects or \
viruses before opening or using any attachments. There is no warranty that this \
e-mail is virus free or without error.  No Kinsale Company is liable if an \
attachment is altered without its written consent. Thank you.  \
&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;


["image001.jpg" (image/jpeg)]

</body></email><email><emailId>20171115101731</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-11-15 10:17:31-0400</timestampReceived><subject>Re: [libvirt-users] dramatic performance slowdown due to THP allocation failure with full pagecache</subject><body>

On Tue, Nov 14, 2017 at 11:03:30AM -0700, Blair Bethwaite wrote:
&gt; On 14 November 2017 at 10:56, Daniel P. Berrange &lt;berrange@redhat.com&gt; wrote:
&gt; &gt; Oh well THP usage inside the guest is then not really anything todo with
&gt; &gt; virt, just a regular Linux questions, so not sure libvirt is the best
&gt; &gt; place to ask.
&gt; 
&gt; True, I just hoped you or one of the other devs might have some
&gt; insight on reclaim behaviour that would provide a clue. I guess I'll
&gt; try a linux list.
&gt; 
&gt; Any comment on this (which is virt related):
&gt; (1) a related and possibly dumb question: in the case of a
&gt; high-performance KVM where the guest is hugepage backed and pinned in
&gt; host memory anyway, why do we still have a table based resolution for
&gt; guest physical to host virtual address translation - couldn't this
&gt; just be done by offset?

I don't know enough about KVM memory management to answer that. You probably
need to ask on the KVM mailing list to get the expert answer.


Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20171115154738</emailId><senderName>Francesc Guasch</senderName><senderEmail>frankie@telecos.upc.edu</senderEmail><timestampReceived>2017-11-15 15:47:38-0400</timestampReceived><subject>[libvirt-users] Issues on hibernated domains</subject><body>

Hello.

I am using libvirt and KVM for a VDI project. It works fine,
great job ! I have only a small issue that bothers some
users from time to time.

This is libvirt-bin 2.5.0-3ubuntu5.5.

When restoring a saved domain that has been many hours or
days down, the network address may be taken by some other
virtual machine. Then both are in conflict.

I found this patch:

https://www.redhat.com/archives/libvir-list/2016-October/msg00561.html

And I tried setting it in my host but it discards silently
my settings after doing virsh net-edit. So It may not be
apllied to the 2.5.0 release ?

That's what I tried:

   &lt;dhcp&gt;
      &lt;leasetime&gt;24h&lt;/leasetime&gt;
      &lt;range start='192.168.122.2' end='192.168.122.254'/&gt;
   &lt;/dhcp&gt;

I also tried leasetime -1 with the same results.

I also found about adding infinite to the dhcp-range at
/var/lib/libvirt/dnsmasq/default.conf. But this file has
a comment about it shouldn't be edited and it should be
done with net-edit. But I don't know how to add this
tag to the network.

  dhcp-range=192.168.122.2,192.168.122.254,infinite

Any hints ? Thank you for your time.

--
Francesc Guasch
ETSETB - UPC

</body></email><email><emailId>20171115194430</emailId><senderName>Holger Schranz</senderName><senderEmail>holger@fam-schranz.de</senderEmail><timestampReceived>2017-11-15 19:44:30-0400</timestampReceived><subject>Re: [libvirt-users] Urgent: virsh - change-media run into a promptly close of libvirt</subject><body>

Hello John, Daniel,

thanks a lot for the very fast work!

Best regards

Holger

Am 15.11.2017 um 20:09 schrieb John Ferlan:
&gt; 
&gt; On 11/15/2017 06:54 AM, Holger Schranz wrote:
&gt; &gt; Thread 1 (Thread 0x7f4a069cc700 (LWP 10178)):
&gt; &gt; #0  0x00007f49ff969170 in qemuDomainChangeEjectableMedia (
&gt; &gt; driver=driver@entry=0x7f49f841b700, vm=vm@entry=0x7f49ec02fbd0,
&gt; &gt; disk=disk@entry=0x7f49ec0375d0, newsrc=0x7f49e8014d10, force=force@entry=false)
&gt; &gt; at qemu/qemu_hotplug.c:303
&gt; This is fixed in current upstream by commit id '8056721cbb'
&gt; 
&gt; John
&gt; 
&gt; 
&gt; &gt; #1  0x00007f49ff9e9253 in qemuDomainChangeDiskLive (force=false, \
&gt; &gt; driver=0x7f49f841b700, dev=&lt;optimized out&gt;, vm=&lt;optimized out&gt;, conn=&lt;optimized \
&gt; &gt; out&gt;) at qemu/qemu_driver.c:7842
&gt; &gt; #2  qemuDomainUpdateDeviceLive (dom=&lt;optimized out&gt;, force=false, dev=&lt;optimized \
&gt; &gt; out&gt;, vm=&lt;optimized out&gt;, conn=&lt;optimized out&gt;) at qemu/qemu_driver.c:7873
&gt; &gt; #3  qemuDomainUpdateDeviceFlags (dom=&lt;optimized out&gt;, xml=&lt;optimized out&gt;, \
&gt; &gt; flags=1) at qemu/qemu_driver.c:8583
&gt; &gt; #4  0x00007f4a0cdd3f47 in virDomainUpdateDeviceFlags (
&gt; &gt; domain=domain@entry=0x7f49e800a470,
&gt; &gt; xml=0x7f49e800a530 "&lt;disk type=\"file\" device=\"cdrom\"&gt;\n      &lt;driver \
&gt; &gt; name=\"qemu\" type=\"raw\"/&gt;\n      &lt;source \
&gt; &gt; file=\"/home/kvm/etcsdvmb/Medien/V7.0A/CS_licenses/key-cd_VCS85FTSVTL.iso\"/&gt;\n   \
&gt; &gt; &lt;target dev=\"hdc\" bus=\"sata\" tr"..., flags=0) at libvirt-domain.c:8338
&gt; &gt; #5  0x000056177c3e3c3e in remoteDispatchDomainUpdateDeviceFlags \
&gt; &gt; (server=0x56177ca8ba60, msg=0x56177ca98210, args=0x7f49e8002e10, \
&gt; &gt; rerr=0x7f4a069cbc90, client=&lt;optimized out&gt;) at remote_dispatch.h:12339
&gt; &gt; #6  remoteDispatchDomainUpdateDeviceFlagsHelper (server=0x56177ca8ba60,
&gt; &gt; client=&lt;optimized out&gt;, msg=0x56177ca98210, rerr=0x7f4a069cbc90,
&gt; &gt; args=0x7f49e8002e10, ret=0x7f49e8004770) at remote_dispatch.h:12315
&gt; &gt; #7  0x00007f4a0ce49a02 in virNetServerProgramDispatchCall (msg=0x56177ca98210,
&gt; &gt; client=0x56177ca99b80, server=0x56177ca8ba60, prog=0x56177ca986f0)
&gt; &gt; at rpc/virnetserverprogram.c:437
&gt; &gt; #8  virNetServerProgramDispatch (prog=0x56177ca986f0,
&gt; &gt; server=server@entry=0x56177ca8ba60, client=0x56177ca99b80, msg=0x56177ca98210)
&gt; &gt; at rpc/virnetserverprogram.c:307
&gt; &gt; #9  0x000056177c40ab6d in virNetServerProcessMsg (msg=&lt;optimized out&gt;,
&gt; &gt; prog=&lt;optimized out&gt;, client=&lt;optimized out&gt;, srv=0x56177ca8ba60)
&gt; &gt; at rpc/virnetserver.c:148
&gt; &gt; #10 virNetServerHandleJob (jobOpaque=&lt;optimized out&gt;, opaque=0x56177ca8ba60)
&gt; &gt; at rpc/virnetserver.c:169
&gt; &gt; #11 0x00007f4a0cd0cb01 in virThreadPoolWorker \
&gt; &gt; (opaque=opaque@entry=0x56177ca989f0) at util/virthreadpool.c:167
&gt; &gt; #12 0x00007f4a0cd0b8f8 in virThreadHelper (data=&lt;optimized out&gt;) at \
&gt; &gt; util/virthread.c:206 #13 0x00007f4a0a254744 in start_thread () from \
&gt; &gt; /lib64/libpthread.so.0 #14 0x00007f4a09f92aad in clone () from /lib64/libc.so.6
&gt; &gt; (gdb) q
&gt; &gt; PID: 10177 (libvirtd)
&gt; &gt; UID: 0 (root)
&gt; &gt; GID: 0 (root)
&gt; &gt; Signal: 11 (SEGV)
&gt; &gt; Timestamp: Tue 2017-11-14 10:11:32 CET (1 day 2h ago)
&gt; &gt; Command Line: /usr/local/sbin/libvirtd -d
&gt; &gt; Executable: /usr/local/sbin/libvirtd
&gt; &gt; Control Group: /
&gt; &gt; Slice: -.slice
&gt; &gt; Boot ID: 4d5f74eefb0244c2bc3b2c99986dcee8
&gt; &gt; Machine ID: beeb301fe87a14b2eabdb6a75a01cbae
&gt; &gt; Hostname: etcsvms5
&gt; &gt; Coredump: /var/lib/systemd/coredump/core.libvirtd.0.4d5f74eefb0244c2bc3b2c99986dcee8.10177.1510650692000000.xz
&gt; &gt;                 
&gt; &gt; Message: Process 10177 (libvirtd) of user 0 dumped core.


---
Diese E-Mail wurde von Avast Antivirus-Software auf Viren geprüft.
https://www.avast.com/antivirus


</body></email><email><emailId>20171120030408</emailId><senderName>Han Han</senderName><senderEmail>hhan@redhat.com</senderEmail><timestampReceived>2017-11-20 03:04:08-0400</timestampReceived><subject>Re: [libvirt-users] Does libvirt-sanlock support network disk?</subject><body>

Thanks for your reply.

On Wed, Nov 8, 2017 at 4:58 PM, Daniel P. Berrange &lt;berrange@redhat.com&gt;
wrote:

&gt; On Wed, Nov 08, 2017 at 02:42:35PM +0800, Han Han wrote:
&gt; &gt; Hello,
&gt; &gt; As we know, libvirt sanlock support file type storage. I wonder *if it
&gt; &gt; supports network storage.*
&gt; &gt; I tried *iSCSI*, but found it didn't generate any resource file:
&gt;
&gt; Correct, the code currently ignores locking for any non-local
&gt; disk.
&gt;
&gt;
&gt; Regards,
&gt; Daniel
&gt; --
&gt; |: https://berrange.com      -o-    https://www.flickr.com/photos/
&gt; dberrange :|
&gt; |: https://libvirt.org         -o-
&gt; https://fstop138.berrange.com :|
&gt; |: https://entangle-photo.org    -o-    https://www.instagram.com/
&gt; dberrange :|
&gt;



-- 
Han Han
Quality Engineer
Redhat.

Email: hhan@redhat.com
Phone: +861065339333

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Thanks for your reply.&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Wed, Nov 8, 2017 at 4:58 PM, Daniel P. Berrange &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:berrange@redhat.com" \
target="_blank"&gt;berrange@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span class=""&gt;On Wed, Nov 08, 2017 at 02:42:35PM +0800, Han \
Han wrote:&lt;br&gt; &gt; Hello,&lt;br&gt;
&lt;/span&gt;&gt; As we know, libvirt sanlock support file type storage. I wonder *if \
it&lt;br&gt; &gt; supports network storage.*&lt;br&gt;
&gt; I tried *iSCSI*, but found it didn't generate any resource file:&lt;br&gt;
&lt;br&gt;
Correct, the code currently ignores locking for any non-local&lt;br&gt;
disk.&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
Regards,&lt;br&gt;
Daniel&lt;br&gt;
&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;--&lt;br&gt;
&gt; &gt; &lt;a href="https://berrange.com" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://berrange.com&lt;/a&gt;         -o-      &lt;a \
&gt; &gt; href="https://www.flickr.com/photos/dberrange" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://www.flickr.com/photos/&lt;wbr&gt;dberrange&lt;/a&gt; :|&lt;br&gt;
&gt; &gt; &lt;a href="https://libvirt.org" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://libvirt.org&lt;/a&gt;              -o-                  &lt;a \
&gt; &gt; href="https://fstop138.berrange.com" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://fstop138.berrange.com&lt;/a&gt; :|&lt;br&gt;
&gt; &gt; &lt;a href="https://entangle-photo.org" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://entangle-photo.org&lt;/a&gt;      -o-      &lt;a \
&gt; &gt; href="https://www.instagram.com/dberrange" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://www.instagram.com/&lt;wbr&gt;dberrange&lt;/a&gt; :|&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;br&gt;-- &lt;br&gt;&lt;div \
class="gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div \
dir="ltr"&gt;Han Han&lt;br&gt;Quality Engineer&lt;br&gt;Redhat.&lt;br&gt;&lt;br&gt;Email: &lt;a \
href="mailto:hhan@redhat.com" target="_blank"&gt;hhan@redhat.com&lt;/a&gt;&lt;br&gt;Phone: \
+861065339333&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;



</body></email><email><emailId>20171120225618</emailId><senderName>Branimir Pejakovic</senderName><senderEmail>branimirp@gmail.com</senderEmail><timestampReceived>2017-11-20 22:56:18-0400</timestampReceived><subject>Re: [libvirt-users] virtlock - a VM goes read-only</subject><body>

On Thu, Nov 16, 2017 at 12:48 PM, Daniel P. Berrange &lt;berrange@redhat.com&gt;
wrote:

&gt; On Wed, Nov 15, 2017 at 02:24:48PM +0000, Branimir Pejakovic wrote:
&gt; &gt; Dear colleagues,
&gt; &gt;
&gt; &gt; I am facing a problem that has been troubling me for last week and a
&gt; half.
&gt; &gt; Please if you are able to help or offer some guidance.
&gt; &gt;
&gt; &gt; I have a non-prod POC environment with 2 CentOS7 fully updated
&gt; hypervisors
&gt; &gt; and an NFS filer that serves as a VM image storage. The overall
&gt; environment
&gt; &gt; works exceptionally well. However, starting a few weeks ago I have been
&gt; &gt; trying to implement virtlock in order to prevent a VM running on 2
&gt; &gt; hypervisors at the same time.
&gt;
&gt; [snip]
&gt;
&gt; &gt; h2 # virsh start test09
&gt; &gt; error: Failed to start domain test09
&gt; &gt; error: resource busy: Lockspace resource
&gt; &gt; '/storage_nfs/images_001/test09.qcow2' is locked
&gt;
&gt; [snip]
&gt;
&gt; &gt; Now, I am pretty sure that I am missing something simple here since this
&gt; is
&gt; &gt; a standard feature and should work out of the box if set correctly but so
&gt; &gt; far I cannot see what I am missing.
&gt;
&gt; So I think you are hitting the little surprise in the way our locking
&gt; works. Specifically, right now the locking only protects the image
&gt; file contents from concurrent writes. We don't have locking around
&gt; the file attributes (permissions, user/group ownership, selinux label,
&gt; etc)
&gt;
&gt; Unfortunately with the current libvirt design, the security drivers run
&gt; before locking takes effect. So what happens is that you have your first
&gt; VM running normally. It has been granted ability to write to the image
&gt; in terms of SELinux label &amp; permissions/owership. The lock manager is
&gt; holding locks protecting the image contents
&gt;
&gt; Now you try to start the second guest, and libvirt will apply the SELinux
&gt; label &amp; permissions/ownership needed for that second guest, despite it
&gt; being used by the first guest. Only then do we acquire the locks for the
&gt; disk image, and fail because the first guest holds the lock. We now
&gt; reset the permissions/ownership we just granted for the second guest,
&gt; and thus unfortunately blocks the first guest from using the images,
&gt; causing the I/O errors you mention
&gt;
&gt; We *have* successfully prevented 2 guests from writing to the same
&gt; image at once, so your data is still safe. Unfortunately though the
&gt; first guest cannot write any further datas, so that previously
&gt; running guest is now fubar :-(
&gt;
&gt; I appreciated this is rather surprising &amp; unhelpful in general. Just
&gt; console yourself with the fact that at least your disk iamge is not
&gt; corrupted.
&gt;
&gt; Note, this should only happen with SELinux enforcing though - if it is
&gt; permissive, then I'd expect the first guest to carry on working.
&gt;
&gt; We would like to improve our locking so that we can apply locks before
&gt; we even try to change ownership/permissions/selinux, which would make
&gt; it far more useful. We've never succesfully completed that work though.
&gt;
&gt;
Hi Daniel

Thank you very much for your answer. Apologies for late reply.

I got it working but I had to do a few modifications.

Usually, qemu-kvm runs as a qemu user as configured in
/etc/libvirt/qemu.conf (user/group parameters). My QCOW files were owned by
root during this experiment (usually I set them to be owned by qemu user).
Once a VM starts, the ownership is changed to qemu and it keeps that way
until I try to start the same VM on another hypervisor and lock kicks in.
In that moment, the file ownership is changed to root again (observed via
watch in 2nd terminal) and the VM goes read only.

I can do a workaround and then lock works normally (no ro-VM) if I do the
following:
- set 0777 permissions on the QEMU file
- change user/group parameters in qemu.conf to root and restart libvirtd

I like to have a bit of a security so I searched through qemu.conf file and
found option dynamic_ownership. The option is set to 1 by default. I set it
to 0 and then changed ownership of the image files to qemu, set user/group
in qemu.conf
to qemu, normal permissions on the files and finally restarted libvirtd.
After that, lock works as expected.

The side effect is that if you want to do template based provisioning via
python-libvirt based app or from the shell by using virt-sysprep,
virt-clone or some other libvirt/libguestfs based app and you want to
modify a VM after cloning (hostname/network/vCPU/etc..), it will throw an
exception - permission denied on the image file. This one was solved by
looking at https://access.redhat.com/solutions/2110391 and it works great
once applied. During all this time, SELinux was disabled.

I would like to take this opportunity to personally thank you and the team
in Red Hat for all hard work on libvirt and libvirt-based tools. I heavily
use python-libvirt module and what I can say is that if you don't have
RHEV-M/oVirt as a single
pane of glass for your virtualization layer, it helps you a great deal in
managing and inspecting (and making statistics!) of a large pool of KVM
hypervisors. Please keep up a good work!

Regards,

Branimir

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;On Thu, Nov 16, \
2017 at 12:48 PM, Daniel P. Berrange &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:berrange@redhat.com" target="_blank"&gt;berrange@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; \
wrote:&lt;br&gt;&lt;blockquote class="gmail_quote" style="margin:0px 0px 0px \
0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex"&gt;&lt;span \
class="gmail-"&gt;On Wed, Nov 15, 2017 at 02:24:48PM +0000, Branimir Pejakovic \
wrote:&lt;br&gt; &gt; Dear colleagues,&lt;br&gt;
&gt;&lt;br&gt;
&gt; I am facing a problem that has been troubling me for last week and a half.&lt;br&gt;
&gt; Please if you are able to help or offer some guidance.&lt;br&gt;
&gt;&lt;br&gt;
&gt; I have a non-prod POC environment with 2 CentOS7 fully updated hypervisors&lt;br&gt;
&gt; and an NFS filer that serves as a VM image storage. The overall environment&lt;br&gt;
&gt; works exceptionally well. However, starting a few weeks ago I have been&lt;br&gt;
&gt; trying to implement virtlock in order to prevent a VM running on 2&lt;br&gt;
&gt; hypervisors at the same time.&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;[snip]&lt;br&gt;
&lt;span class="gmail-"&gt;&lt;br&gt;
&gt; h2 # virsh start test09&lt;br&gt;
&gt; error: Failed to start domain test09&lt;br&gt;
&gt; error: resource busy: Lockspace resource&lt;br&gt;
&gt; '/storage_nfs/images_001/&lt;wbr&gt;test09.qcow2' is locked&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;[snip]&lt;br&gt;
&lt;span class="gmail-"&gt;&lt;br&gt;
&gt; Now, I am pretty sure that I am missing something simple here since this is&lt;br&gt;
&gt; a standard feature and should work out of the box if set correctly but so&lt;br&gt;
&gt; far I cannot see what I am missing.&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;So I think you are hitting the little surprise in the way our locking&lt;br&gt;
works. Specifically, right now the locking only protects the image&lt;br&gt;
file contents from concurrent writes. We don't have locking around&lt;br&gt;
the file attributes (permissions, user/group ownership, selinux label,&lt;br&gt;
etc)&lt;br&gt;
&lt;br&gt;
Unfortunately with the current libvirt design, the security drivers run&lt;br&gt;
before locking takes effect. So what happens is that you have your first&lt;br&gt;
VM running normally. It has been granted ability to write to the image&lt;br&gt;
in terms of SELinux label &amp; permissions/owership. The lock manager is&lt;br&gt;
holding locks protecting the image contents&lt;br&gt;
&lt;br&gt;
Now you try to start the second guest, and libvirt will apply the SELinux&lt;br&gt;
label &amp; permissions/ownership needed for that second guest, despite it&lt;br&gt;
being used by the first guest. Only then do we acquire the locks for the&lt;br&gt;
disk image, and fail because the first guest holds the lock. We now&lt;br&gt;
reset the permissions/ownership we just granted for the second guest,&lt;br&gt;
and thus unfortunately blocks the first guest from using the images,&lt;br&gt;
causing the I/O errors you mention&lt;br&gt;
&lt;br&gt;
We *have* successfully prevented 2 guests from writing to the same&lt;br&gt;
image at once, so your data is still safe. Unfortunately though the&lt;br&gt;
first guest cannot write any further datas, so that previously&lt;br&gt;
running guest is now fubar :-(&lt;br&gt;
&lt;br&gt;
I appreciated this is rather surprising &amp; unhelpful in general. Just&lt;br&gt;
console yourself with the fact that at least your disk iamge is not&lt;br&gt;
corrupted.&lt;br&gt;
&lt;br&gt;
Note, this should only happen with SELinux enforcing though - if it is&lt;br&gt;
permissive, then I'd expect the first guest to carry on working.&lt;br&gt;
&lt;br&gt;
We would like to improve our locking so that we can apply locks before&lt;br&gt;
we even try to change ownership/permissions/selinux, which would make&lt;br&gt;
it far more useful. We've never succesfully completed that work though.&lt;br&gt;
&lt;br clear="all"&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Hi \
Daniel&lt;br&gt;&lt;br&gt;Thank you very much for your answer. Apologies for late reply.&lt;br&gt;&lt;br&gt;I \
got it working but I had to do a few modifications.&lt;br&gt;&lt;br&gt;Usually, qemu-kvm runs as \
a qemu user as configured in /etc/libvirt/qemu.conf (user/group parameters). My QCOW \
files were owned by root during this experiment (usually I set them to be owned by \
qemu user). Once a VM starts, the ownership is changed to qemu and it keeps that way \
until I try to start the same VM on another hypervisor and lock kicks in. In that \
moment, the file ownership is changed to root again (observed via watch in 2nd \
terminal) and the VM goes read only.&lt;br&gt;&lt;br&gt;I can do a workaround and then lock works \
normally (no ro-VM) if I do the following:&lt;br&gt;- set 0777 permissions on the QEMU \
file&lt;br&gt;- change user/group parameters in qemu.conf to root and restart \
libvirtd&lt;br&gt;&lt;br&gt;I like to have a bit of a security so I searched through qemu.conf \
file and found option dynamic_ownership. The option is set to 1 by default. I set it \
to 0 and then changed ownership of the image files to qemu, set user/group in \
qemu.conf &lt;br&gt;to qemu, normal permissions on the files and finally restarted \
libvirtd. After that, lock works as expected.&lt;br&gt;&lt;br&gt;The side effect is that if you \
want to do template based provisioning via python-libvirt based app or from the shell \
by using virt-sysprep, virt-clone or some other libvirt/libguestfs based app and you \
want to modify a VM after cloning (hostname/network/vCPU/etc..), it will throw an \
exception - permission denied on the image file. This one was solved by looking at &lt;a \
href="https://access.redhat.com/solutions/2110391"&gt;https://access.redhat.com/solutions/2110391&lt;/a&gt; \
and it works great once applied. During all this time, SELinux was disabled.&lt;br&gt;&lt;br&gt;I \
would like to take this opportunity to personally thank you and the team in Red Hat \
for all hard work on libvirt and libvirt-based tools. I heavily use python-libvirt \
module and what I can say is that if you don't have RHEV-M/oVirt as a \
single&lt;br&gt;pane of glass for your virtualization layer, it helps you a great deal in \
managing and inspecting (and making statistics!) of a large pool of KVM hypervisors. \
Please keep up a good work!&lt;br&gt;&lt;br&gt;Regards,&lt;br&gt;&lt;br&gt;Branimir&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt; &lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20171121023424</emailId><senderName>Lying</senderName><senderEmail>15700157322@163.com</senderEmail><timestampReceived>2017-11-21 02:34:24-0400</timestampReceived><subject>[libvirt-users] Export Video on Graphics Card</subject><body>

[Attachment #2 (text/plain)]

I have two graphics card on my machine
And i want to export my video on one card when VM switched on
What should i do?
[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div&gt;I \
have two graphics card on my machine&lt;/div&gt;&lt;div&gt;And i want to export my video on one \
card when VM switched on&lt;/div&gt;&lt;div&gt;What should i do?&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;span \
title="neteasefooter"&gt;&lt;p&gt;&lt;br/&gt; &lt;/p&gt;&lt;/span&gt;



</body></email><email><emailId>20171128070824</emailId><senderName>Lying</senderName><senderEmail>15700157322@163.com</senderEmail><timestampReceived>2017-11-28 07:08:24-0400</timestampReceived><subject>[libvirt-users] vga passthroufh fail</subject><body>

[Attachment #2 (text/plain)]

Hello, I encounter a problem, my display is not light when guest running.


But it's successful that i check guest with command "ping".


Following message is my xml and refer topic from https://libvirt.org/formatdomain.html#elementsHostDev:
&lt;hostdev mode='subsystem' type='pci' managed='yes'&gt;
 &lt;driver name='vfio' /&gt;
    &lt;source&gt;
      &lt;address domain='0x0000' bus='0x06' slot='0x02' function='0x0'/&gt;
    &lt;/source&gt;

&lt;/hostdev&gt;


[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div&gt;Hello, \
I encounter a problem, my display is not light when guest \
running.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;But it's successful that i check guest with command \
"ping".&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Following message is my xml and refer topic from \
https://libvirt.org/formatdomain.html#elementsHostDev:&lt;/div&gt;&lt;div&gt;&lt;pre&gt;&lt;hostdev \
mode='subsystem' type='pci' managed='yes'&gt;&lt;/pre&gt;&lt;pre&gt; &lt;driver name='vfio' \
/&gt;&lt;/pre&gt;&lt;pre&gt;    &lt;source&gt;&lt;/pre&gt;&lt;pre&gt;      &lt;address domain='0x0000' \
bus='0x06' slot='0x02' function='0x0'/&gt;&lt;/pre&gt;&lt;pre&gt;    &lt;/source&gt; \
&lt;/pre&gt;&lt;pre&gt;&lt;/hostdev&gt;&lt;/pre&gt;&lt;pre&gt;&lt;br&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;span \
title="neteasefooter"&gt;&lt;p&gt;&lt;br/&gt; &lt;/p&gt;&lt;/span&gt;



</body></email><email><emailId>20171129062545</emailId><senderName>Tony Brian Albers</senderName><senderEmail>tba@kb.dk</senderEmail><timestampReceived>2017-11-29 06:25:45-0400</timestampReceived><subject>Re: [libvirt-users] kvm/libvirt on CentOS7 w/Windows 10 Pro guest</subject><body>

On 2017-11-29 01:28, Sam Varshavchik wrote:
&gt; Tony Brian Albers writes:
&gt; 
&gt;&gt; &gt;&gt; Hmm.. could this somehow be related to the fast startup thing in 
&gt;&gt; win10?
&gt;&gt; &gt;&gt; I mean, if fast startup is disabled, will that help?
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Just a thought.
&gt;&gt; &gt;
&gt;&gt; &gt; Fast startup does not get utilized for reboots, only for regular
&gt;&gt; &gt; shutdowns. The actual option in Windows settings reads:
&gt;&gt; &gt;
&gt;&gt; &gt; "This helps starts your PC faster after shutdown. Restart isn't 
&gt;&gt; affected."
&gt;&gt; &gt;
&gt;&gt;
&gt;&gt; Thanks, I wasn't sure about that.
&gt;&gt; So a restart/reboot is closer to a cold-start than a shutdown and
&gt;&gt; power-up is. Makes sense....
&gt;&gt;
&gt;&gt; Yeah, I know there's a way to disable fast-start end also to avoid it
&gt;&gt; when shutting down.
&gt;&gt;
&gt;&gt; So restart avoids the hibernation-thing that fast start uses, but does
&gt;&gt; it do so to full extent? If it saves just the least bit of info, that
&gt;&gt; could be the reason for the boot issue.
&gt; 
&gt; It's also entirely possible that "Restart isn't affected" part refers 
&gt; only to restarts that get initiated after applying system updates, so a 
&gt; manually-initiated restart still hibernates, despite this claim otherwise.
&gt; 
&gt;&gt;   Just me thinking.. I haven't
&gt;&gt; really used windows for the last 17 yrs.
&gt; 
&gt; Well, some Googling around found the instructions for disabling fast 
&gt; start up in Windows 10.
&gt; 
&gt; Then, I took a Windows 10 guest that I successfully nursed through the 
&gt; fall creator's update by manually starting it for every reboot. The host 
&gt; was also updated to Fedora 27 and qemu 2.10 during the same timeframe.
&gt; 
&gt; I reenabled the reboots in domain XML file, and disabled fast startup in 
&gt; Windows 10. So far, I've succesfully rebooted that VM twice without any 
&gt; issues. I'll probably need to reboot it 3-4 times more, before 
&gt; cautiously marking this as a solved issue; but not quite sure whether 
&gt; the deciding factor is the fall creator's update, qemu 2.10, or 
&gt; disabling fast startup.
&gt; 
&gt; I have not noticed any marked difference in the actual startup speed. If 
&gt; anything, Windows seems to boot a bit faster, and the CPU utilization 
&gt; seems to settle down pretty quickly, after a reboot. Which kind of makes 
&gt; sense, actually, now that I'm aware of the fast startup "feature", and I 
&gt; find it absolutely hillarious.
&gt; 
&gt; See: if Windows was really hibernating, then after it boots up the dumb 
&gt; thing obviously wants to immediately kick off every frigging last 
&gt; scheduled task it has, since it probably came due during the time the 
&gt; whole bloody thing was off. I always had a laugh looking at virt-manager 
&gt; showing the guest pegging the CPU at 100% for 10-30 minutes after I 
&gt; start up the VM. That's Windows for you. Well, now, with the fast 
&gt; startup disabled, the virtual CPU settles down pretty quickly.
&gt; 
&gt; Also the system startup audio chime reliably plays every time now, too. 
&gt; I guess waking up from hibernation doesn't merit the audio chime.
&gt; 
&gt; 

I can't say I'm surprised, but thanks a lot for the info. Saves me the 
time of testing.

-- 
Tony Albers
Systems administrator, IT-development
Royal Danish Library, Victor Albecks Vej 1, 8000 Aarhus C, Denmark.
Tel: +45 2566 2383 / +45 8946 2316

</body></email><email><emailId>20171002114622</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-10-02 11:46:22-0400</timestampReceived><subject>Re: [libvirt-users] virDomainSaveImageDefineXML</subject><body>

On 09/26/2017 11:59 AM, llilulu wrote:
&gt; Hi:
&gt; When I make snapshot use virDomainSave,before I resume the snapshot , I use \
&gt; virDomainSaveImageDefineXML change the domain info, like disk path. but I can't \
&gt; change the &lt;devices&gt; , for example detach a disk or interface, Can't tell me what \
&gt; can I change use virDomainSaveImageDefineXML before resume snapshot.

Well, saving &amp; restoring domain is like migration. Therefore, guest ABI
must be preserved. Therefore it's not possible to hotplug or hotunlpug
devices as it would change the guest ABI. What you can do though, is to
change the backends (e.g. disk location to your domain has changed, so
you should be able to change the disk &lt;source/&gt;).

Michal


</body></email><email><emailId>20171004212241</emailId><senderName>Nick Gilmour</senderName><senderEmail>nickeforos@gmail.com</senderEmail><timestampReceived>2017-10-04 21:22:41-0400</timestampReceived><subject>Re: [libvirt-users] error: internal error: missing backend for pool type 11 (zfs)</subject><body>

&gt;
&gt;  it was necessary is set the user to root in the /etc/libvirt/qemu.conf.

It works if group is set to kvm...

On Wed, Oct 4, 2017 at 6:04 PM, Nick Gilmour &lt;nickeforos@gmail.com&gt; wrote:

&gt; I have finally found the solution here:
&gt;
&gt; https://www.mail-archive.com/search?l=ubuntu-bugs@lists.
&gt; ubuntu.com&amp;q=subject:%22%5C%5BBug+405388%5C%5D+Re%5C%3A+
&gt; virt%5C-manager+cannot+create+image+file%22&amp;o=newest&amp;f=1
&gt;
&gt; By default is qemu:///system activated but I had to change to
&gt; qemu:///session because I was getting errors. I created a VM with
&gt; qemu:///session and it was running without any issues. But it didn't work
&gt; for ZFS Volums. I suppose the other change that it was necessary is set the
&gt; user to root in the /etc/libvirt/qemu.conf. I have created a new volume
&gt; in VMM and installed Fedora. Everything seems to be working fine inclusive
&gt; ZFS snapshots.
&gt;
&gt; Regards,
&gt; Nick
&gt;
&gt;
&gt;
&gt; On Wed, Oct 4, 2017 at 4:58 PM, Peter Krempa &lt;pkrempa@redhat.com&gt; wrote:
&gt;
&gt;&gt; On Tue, Oct 03, 2017 at 08:44:10 +0200, Michal Privoznik wrote:
&gt;&gt; &gt; On 10/02/2017 11:42 PM, Nick Gilmour wrote:
&gt;&gt;
&gt;&gt; [...]
&gt;&gt;
&gt;&gt; &gt;
&gt;&gt; &gt; 2) storage backends are static. While we have libvirt drivers in
&gt;&gt; &gt; separate modules (.so files) and load them at start up, it's not the
&gt;&gt; &gt; same story with storage driver backends. These are hardcoded into the
&gt;&gt; &gt; storage driver. Might be worth it to have them dynamically loadable too.
&gt;&gt;
&gt;&gt; This was changed some time ago. Backends are loadable now:
&gt;&gt;
&gt;&gt; src/.libs/libvirt_storage_backend_disk.so
&gt;&gt; src/.libs/libvirt_storage_backend_fs.so
&gt;&gt; src/.libs/libvirt_storage_backend_gluster.so
&gt;&gt; src/.libs/libvirt_storage_backend_iscsi.so
&gt;&gt; src/.libs/libvirt_storage_backend_logical.so
&gt;&gt; src/.libs/libvirt_storage_backend_mpath.so
&gt;&gt; src/.libs/libvirt_storage_backend_rbd.so
&gt;&gt; src/.libs/libvirt_storage_backend_scsi.so
&gt;&gt; src/.libs/libvirt_storage_backend_sheepdog.so
&gt;&gt; src/.libs/libvirt_storage_backend_vstorage.so
&gt;&gt; src/.libs/libvirt_storage_backend_zfs.so
&gt;&gt;
&gt;&gt; Similarly to driver backends they are loaded at start of libvirtd.
&gt;&gt;
&gt;
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;blockquote class="gmail_quote" style="margin:0px 0px 0px \
0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex"&gt;&lt;span \
style="font-size:12.8px"&gt;  it was necessary is set the user to root in the  \
&lt;/span&gt;&lt;span style="font-size:12.8px"&gt;/etc/libvirt/qemu.conf.&lt;/span&gt;&lt;/blockquote&gt;&lt;div&gt;It \
works if group is set to kvm...&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Wed, Oct 4, 2017 at 6:04 PM, Nick Gilmour &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:nickeforos@gmail.com" \
target="_blank"&gt;nickeforos@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div&gt;I have finally found the solution \
here:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;a \
href="https://www.mail-archive.com/search?l=ubuntu-bugs@lists.ubuntu.com&amp;q=subject \
:%22%5C%5BBug+405388%5C%5D+Re%5C%3A+virt%5C-manager+cannot+create+image+file%22&amp;o=newest&amp;f=1" \
target="_blank"&gt;https://www.mail-archive.com/&lt;wbr&gt;search?l=ubuntu-bugs@lists.&lt;wbr&gt;ubun \
tu.com&amp;q=subject:%22%5C%&lt;wbr&gt;5BBug+405388%5C%5D+Re%5C%3A+&lt;wbr&gt;virt%5C-manager+cannot+create+&lt;wbr&gt;image+file%22&amp;o=newest&amp;f=1&lt;/a&gt;&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;By \
default is qemu:///system activated but I had to change to qemu:///session because I \
was getting errors. I created a VM with qemu:///session  and it was running without \
any issues. But it didn't work for ZFS Volums. I suppose the other change that it \
was necessary is set the user to root in the  &lt;span \
style="font-size:12.8px"&gt;/etc/libvirt/qemu.conf. I have created a new volume in VMM \
and installed Fedora. Everything seems to be working fine inclusive ZFS \
snapshots.&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;Regards,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;Nick&lt;br&gt;&lt;/span&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="HOEnZb"&gt;&lt;div class="h5"&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Wed, Oct 4, 2017 at 4:58 PM, Peter Krempa &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:pkrempa@redhat.com" \
target="_blank"&gt;pkrempa@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span&gt;On Tue, Oct 03, 2017 at 08:44:10 +0200, Michal \
Privoznik wrote:&lt;br&gt; &gt; On 10/02/2017 11:42 PM, Nick Gilmour wrote:&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;[...]&lt;br&gt;
&lt;span&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; 2) storage backends are static. While we have libvirt drivers in&lt;br&gt;
&gt; separate modules (.so files) and load them at start up, it's not the&lt;br&gt;
&gt; same story with storage driver backends. These are hardcoded into the&lt;br&gt;
&gt; storage driver. Might be worth it to have them dynamically loadable too.&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;This was changed some time ago. Backends are loadable now:&lt;br&gt;
&lt;br&gt;
src/.libs/libvirt_storage_back&lt;wbr&gt;end_disk.so&lt;br&gt;
src/.libs/libvirt_storage_back&lt;wbr&gt;end_fs.so&lt;br&gt;
src/.libs/libvirt_storage_back&lt;wbr&gt;end_gluster.so&lt;br&gt;
src/.libs/libvirt_storage_back&lt;wbr&gt;end_iscsi.so&lt;br&gt;
src/.libs/libvirt_storage_back&lt;wbr&gt;end_logical.so&lt;br&gt;
src/.libs/libvirt_storage_back&lt;wbr&gt;end_mpath.so&lt;br&gt;
src/.libs/libvirt_storage_back&lt;wbr&gt;end_rbd.so&lt;br&gt;
src/.libs/libvirt_storage_back&lt;wbr&gt;end_scsi.so&lt;br&gt;
src/.libs/libvirt_storage_back&lt;wbr&gt;end_sheepdog.so&lt;br&gt;
src/.libs/libvirt_storage_back&lt;wbr&gt;end_vstorage.so&lt;br&gt;
src/.libs/libvirt_storage_back&lt;wbr&gt;end_zfs.so&lt;br&gt;
&lt;br&gt;
Similarly to driver backends they are loaded at start of libvirtd.&lt;br&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20171011183631</emailId><senderName>lejeczek</senderName><senderEmail>peljasz@yahoo.co.uk</senderEmail><timestampReceived>2017-10-11 18:36:31-0400</timestampReceived><subject>Re: [libvirt-users] add/attache vol from pool - without xml ?</subject><body>



On 10/10/17 00:06, Michal Privoznik wrote:
&gt; On 10/09/2017 06:14 AM, lejeczek wrote:
&gt;&gt; hi fellows
&gt;&gt;
&gt;&gt; is that possible, as per subject? If yes then how would such a command
&gt;&gt; like look like?
&gt; Attach where? To a domain? Via C/Python/... API or virsh?
&gt;
&gt; virsh attach-disk  might be what you're looking for.
&gt;
&gt; Michal

I fiddled in virsh with all I could find, gee, I failed, a 
have one pool off a gluster, I cannot attach a disk/vol to a 
domain.

</body></email><email><emailId>20171013005841</emailId><senderName>Laine Stump</senderName><senderEmail>laine@laine.org</senderEmail><timestampReceived>2017-10-13 00:58:41-0400</timestampReceived><subject>Re: [libvirt-users] should not libvirtd when stopped dismantle/remove net connections</subject><body>

On 10/11/2017 02:39 PM, lejeczek wrote:
&gt; hi,
&gt;
&gt; I stop libvirsh and I see it removes vnetx interfaces,

What do you mean by "libvirsh"?

If you destroy a guest (aka vm aka domain), e.g. by using "virsh destroy
blah", then the vnet interfaces for that guest are also destroyed
(because they are no longer needed - they are just tap devices used to
connect the guest's emulated ethernet devices to a bridge). But if you
stop the libvirt daemon (e.g. "systemctl stop libvirtd.service" on a
RHEL-based distro), the guests are still running, so the tap devices
(vnet) are still needed, so they are not touched.


&gt; but those(at least) of bridge type remain in the system after daemon
&gt; is stopped. Is this intended would you know?

A bridge device is used by potentially several different guests to
connect to the host and or the outside world. If it was destroyed when
the libvirt daemon was stopped, then all the guests would lose their
network connectivity. This would make it impossible to upgrade libvirt
without disrupting guest operation.


</body></email><email><emailId>20171017081513</emailId><senderName>Ján Tomko</senderName><senderEmail>jtomko@redhat.com</senderEmail><timestampReceived>2017-10-17 08:15:13-0400</timestampReceived><subject>Re: [libvirt-users] virConnectIsAlive</subject><body>


On Tue, Oct 17, 2017 at 01:51:57PM +0800, llilulu wrote:
&gt; Hi
&gt; In my program , When libvirtd restart , the old libvirtd connection(virConnectPtr) \
&gt; has to reconnect, Before usr old virConnectPtr , I call virConnectIsAlive. but when \
&gt; I restart libvirtd , virConnectIsAlive return 1, and I continue other operate use \
&gt; the old virConnectPtr, program will receive signal pipe. I use libvirt event. \
&gt; before any api use, I call virEventRegisterDefaultImpl, and run \
&gt; virEventRunDefaultImpl. then use virConnectIsAlive, when I restart libvirtd, \
&gt; virConnectIsAlive will return 0, I want know how to use virConnectIsAliveï¼Œ if \
&gt; virConnectIsAlive use  keep alive message, what default the interval and count.

Hi,

using virConnectIsAlive without running an event loop is pointless.
It only tells you about the state of virConnectPtr's internal data
and this state changes after the event loop processes it:
https://libvirt.org/html/libvirt-libvirt-event.html#virEventRegisterDefaultImpl

By default the daemon does send keepalive messages (and the client needs
to run the event loop to process them), to send keepalive messages
from the client you need to call virConnectSetKeepAlive:
https://libvirt.org/html/libvirt-libvirt-host.html#virConnectSetKeepAlive

Jan


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20171009131435</emailId><senderName>lejeczek</senderName><senderEmail>peljasz@yahoo.co.uk</senderEmail><timestampReceived>2017-10-09 13:14:35-0400</timestampReceived><subject>[libvirt-users] add/attache vol from pool - without xml ?</subject><body>

hi fellows

is that possible, as per subject? If yes then how would such 
a command like look like?

many thanks, L.

</body></email><email><emailId>20171011183908</emailId><senderName>lejeczek</senderName><senderEmail>peljasz@yahoo.co.uk</senderEmail><timestampReceived>2017-10-11 18:39:08-0400</timestampReceived><subject>[libvirt-users] should not libvirtd when stopped dismantle/remove net connections</subject><body>

hi,

I stop libvirsh and I see it removes vnetx interfaces, but 
those(at least) of bridge type remain in the system after 
daemon is stopped. Is this intended would you know?

thanks, L.

</body></email><email><emailId>20171017055157</emailId><senderName>llilulu</senderName><senderEmail>llilulu@yeah.net</senderEmail><timestampReceived>2017-10-17 05:51:57-0400</timestampReceived><subject>[libvirt-users] virConnectIsAlive</subject><body>

[Attachment #2 (text/plain)]

Hi
    In my program , When libvirtd restart , the old libvirtd \
connection(virConnectPtr) has to reconnect, Before usr old virConnectPtr , I call \
virConnectIsAlive. but when I restart libvirtd , virConnectIsAlive return 1, and I \
continue other operate use the old virConnectPtr, program will receive signal pipe.  \
I use libvirt event. before any api use, I call virEventRegisterDefaultImpl, and run \
virEventRunDefaultImpl. then use virConnectIsAlive, when I restart libvirtd, \
virConnectIsAlive will return 0, I want know how to use virConnectIsAlive��� if \
virConnectIsAlive use  keep alive message, what default the interval and count.  \
Thanks


[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div&gt;Hi&lt;/div&gt;&lt;div&gt;    \
In my program , When libvirtd restart , the old libvirtd connection(virConnectPtr) \
has to reconnect, Before usr old virConnectPtr , I call virConnectIsAlive. but when I \
restart libvirtd , virConnectIsAlive return 1, and I continue other operate use the \
old virConnectPtr, program will receive signal pipe.&lt;/div&gt;&lt;div&gt;    I \
use libvirt event. before any api use, I call virEventRegisterDefaultImpl, and run \
virEventRunDefaultImpl. then use virConnectIsAlive, when I restart libvirtd, \
virConnectIsAlive will return 0, I want know how to use virConnectIsAlive��� if \
virConnectIsAlive use  keep alive message, what default the interval and \
count.&lt;/div&gt;&lt;div&gt;   Thanks&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;span \
title="neteasefooter"&gt;&lt;div id="netease_mail_footer"&gt;&lt;div style="border-top:#CCC 1px \
solid;padding:10px 5px;font-size:17px;color:#777;line-height:22px"&gt;&lt;a \
href="http://you.163.com/item/detail?id=1183001&amp;from=web_gg_mail_jiaobiao_7" \
target="_blank" style="color:#3366FF;text-decoration:none"&gt;����������������������������������������������� \
������������������13���/������������������75���3���&gt;&gt;   &lt;/a&gt;    \
 &lt;/div&gt;&lt;/div&gt;&lt;/span&gt;



</body></email><email><emailId>20171018180017</emailId><senderName>mxs kolo</senderName><senderEmail>kolomaxes@gmail.com</senderEmail><timestampReceived>2017-10-18 18:00:17-0400</timestampReceived><subject>[libvirt-users] Can we disable write to /sys/fs/cgroup tree inside container ?</subject><body>

 Hi all

Each lxc container on node have mounted tmpfs for cgroups tree:
[root-inside-lxc@tst1 ~]# mount | grep cgroups
cgroup on /sys/fs/cgroup/cpu,cpuacct type cgroup
(rw,nosuid,nodev,noexec,relatime,cpuacct,cpu)
cgroup on /sys/fs/cgroup/cpuset type cgroup
(rw,nosuid,nodev,noexec,relatime,cpuset)
cgroup on /sys/fs/cgroup/memory type cgroup
(rw,nosuid,nodev,noexec,relatime,memory)
cgroup on /sys/fs/cgroup/devices type cgroup
(rw,nosuid,nodev,noexec,relatime,devices)
cgroup on /sys/fs/cgroup/freezer type cgroup
(rw,nosuid,nodev,noexec,relatime,freezer)
cgroup on /sys/fs/cgroup/blkio type cgroup
(rw,nosuid,nodev,noexec,relatime,blkio)
cgroup on /sys/fs/cgroup/net_cls,net_prio type cgroup
(rw,nosuid,nodev,noexec,relatime,net_prio,net_cls)
cgroup on /sys/fs/cgroup/perf_event type cgroup
(rw,nosuid,nodev,noexec,relatime,perf_event)
cgroup on /sys/fs/cgroup/systemd type cgroup
(rw,nosuid,nodev,noexec,relatime,xattr,release_agent=/usr/lib/systemd/systemd-cgroups-agent,name=systemd)
cgroup on /sys/fs/cgroup/hugetlb type cgroup
(rw,nosuid,nodev,noexec,relatime,hugetlb)
cgroup on /sys/fs/cgroup/pids type cgroup (rw,nosuid,nodev,noexec,relatime,pids)

It's by default,  at least in my case.
Problem is, that it's full cgroups tree -  from hardware node and from
all another containers on node.
[root-inside-lxc@tst1 ~]#  for i in `ls
/sys/fs/cgroup/devices/machine.slice/machine-lxc*/devices.list`; do
echo $i; cat $i; done
/sys/fs/cgroup/devices/machine.slice/machine-lxc\x2d10297\x2dtst2.scope/devices.list
c 1:3 rwm
c 1:5 rwm
c 1:7 rwm
c 1:8 rwm
c 1:9 rwm
c 5:0 rwm
c 5:2 rwm
c 10:229 rwm
b 253:6 rw
c 136:* rwm
/sys/fs/cgroup/devices/machine.slice/machine-lxc\x2d9951\x2dtst1.scope/devices.list
c 1:3 rwm
c 1:5 rwm
c 1:7 rwm
c 1:8 rwm
c 1:9 rwm
c 5:0 rwm
c 5:2 rwm
c 10:229 rwm
b 253:7 rw
c 136:* rwm

Hardware node file, view inside tst1 container:
[root-inside-lxc@tst1 ~]# cat /sys/fs/cgroup/devices/devices.list
a *:* rwm

What is best way to prevent viewing and editing of all cgroups
structures except belonging to current lxc container (selinux,
apparmor ) ?
Why libvirt mount  /sys/fs/cgroup/* inside container as rw ?

We use kernel 3.10.0-693.2.2.el7.x86_64 and XFS and therefore our
containers are privileged. Yes, we know that in such containers root
can use SysRq at least for reboot hardware node. But problem with
cgroups can be more hidden and  cryptic.

p.s.
 As show short test, root user can disable device zero on node
[root-lxc@tst1 ~]# echo "c 1:5 rwm"  &gt; /sys/fs/cgroup/devices/devices.deny
or all devices in another container
[root-lxc@tst1 ~]# echo "a *:* rwm"  &gt;
/sys/fs/cgroup/devices/machine.slice/machine-lxc\x2d10297\x2dtst2.scope/devices.deny

b.r.
 Maxim Kozin

</body></email><email><emailId>20171018105957</emailId><senderName>d tbsky</senderName><senderEmail>tbskyd@gmail.com</senderEmail><timestampReceived>2017-10-18 10:59:57-0400</timestampReceived><subject>[libvirt-users] "virsh define" modify xml configuration file</subject><body>

hi:
   I upgrade my system from rhel 7.3 to 7.4. so libvirt upgrade to 3.2.

   I found command "virsh define vm.xml" sometimes  modify "vm.xml". I
thought the command will read vm.xml, not write to it. is this kind of
behavior by design?

   for example vm.xml with the line

   &lt;cpu mode='custom' match='exact'&gt;

   will be replaced with

  &lt;cpu mode='custom' match='exact' check='partial'&gt;


Regards,
tbskyd

</body></email><email><emailId>20171024145252</emailId><senderName>lejeczek</senderName><senderEmail>peljasz@yahoo.co.uk</senderEmail><timestampReceived>2017-10-24 14:52:52-0400</timestampReceived><subject>[libvirt-users] net interface direct - no IP communication between guest &amp; host</subject><body>

hi everyone

I wonder why, when I attach an interface like this:

virsh # attach-interface --domain win10Ent --type direct 
--source nm-team --config --persistent --model virtio

host cannot ip ping the guest and vice versa, yet guest can 
ping other nodes(outside of its host, connected via phys net 
via a switch)

Would you know?

I thought maybe routing on the host, so I did:
$ route add -host 192.168.2.222 dev nm-team

but to no avail.

I wonder if it's lower layer, arp kernel bits?

thanks, L.

</body></email><email><emailId>20171024134018</emailId><senderName>Konstantin Suvorov</senderName><senderEmail>i.am@berlic.net</senderEmail><timestampReceived>2017-10-24 13:40:18-0400</timestampReceived><subject>[libvirt-users] virsh + remote VirtualBox</subject><body>

Hello,

I have the following setup:
1. MacOS host with VirtualBox installed
2. Ubuntu 16.04 host with libvirt installed

What I try to do:
Manage VMs executed inside VirtualBox on host 1 with libvirt tools from
host 2.

I have vboxwebsrv up and running on my MacOS host.
I can successfully manage VMs remotely (e.g. with phpvirtualbox).

But libvirt (virsh in particular) doesn't work.

Reading debug logs, manuals and numerous internet threads leads me to a
conclusion, that libvirt does not support remote connection to VirtualBox
directly and only via libvirtd daemon installed on the same remote host as
VirtualBox. Is this correct?

If my assumption is correct, why is that so? Why libvirt can't manage
remote VirtualBox directly?

Regards, Konstantin.

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hello,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I have the following setup:&lt;/div&gt;&lt;div&gt;1. \
MacOS host with VirtualBox installed&lt;/div&gt;&lt;div&gt;2. Ubuntu 16.04 host with libvirt \
installed&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What I try to do:&lt;/div&gt;&lt;div&gt;Manage VMs executed \
inside VirtualBox on host 1 with libvirt tools from host \
2.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I have  vboxwebsrv up and running on my MacOS \
host.&lt;/div&gt;&lt;div&gt;I can successfully manage VMs remotely (e.g. with  \
phpvirtualbox).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;But libvirt (virsh in particular) \
doesn't work.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Reading debug logs, manuals and numerous \
internet threads leads me to a conclusion, that libvirt does not support remote \
connection to VirtualBox directly and only via libvirtd daemon installed on the same \
remote host as VirtualBox. Is this correct?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If my assumption \
is correct, why is that so? Why libvirt can't manage remote VirtualBox \
directly?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regards, Konstantin.&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20171022120409</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-10-22 12:04:09-0400</timestampReceived><subject>[libvirt-users] virsh does no longer respond to commands</subject><body>

Hi,

after a recent live backup done with a snapshot, blockcommit failed and a
subsequent (manual) blockjob abort got stuck. Now we are unable to do basic
operations on the virtual machine like if it was frozen and when issuing
another command we see the following:

$ virsh shutdown $domain
error: Failed to shutdown domain $domain
error: Timed out during operation: cannot acquire state change lock (held
by remoteDispatchDomainBlockJobAbort)

$ virsh blockcommit $domain --active --pivot
error: Timed out during operation: cannot acquire state change lock (held
by remoteDispatchDomainBlockJobAbort)

$ virsh blockjob $domain --abort
error: Timed out during operation: cannot acquire state change lock (held
by remoteDispatchDomainBlockJobAbort)

Houston, we've got a problem. We have roughly 16 hours to fix this. Any
help is appreciated!
-- 
Dominik Psenner

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;after a recent live backup done with a \
snapshot, blockcommit failed and a subsequent (manual) blockjob abort got stuck. Now \
we are unable to do basic operations on the virtual machine like if it was frozen and \
when issuing another command we see the following:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;$ \
virsh shutdown $domain&lt;/div&gt;&lt;div&gt;error: Failed to shutdown domain \
$domain&lt;/div&gt;&lt;div&gt;error: Timed out during operation: cannot acquire state change lock \
(held by remoteDispatchDomainBlockJobAbort)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;$ virsh \
blockcommit $domain --active --pivot&lt;/div&gt;&lt;div&gt;error: Timed out during operation: \
cannot acquire state change lock (held by \
remoteDispatchDomainBlockJobAbort)&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;$ virsh blockjob \
$domain --abort&lt;/div&gt;&lt;div&gt;error: Timed out during operation: cannot acquire state \
change lock (held by \
remoteDispatchDomainBlockJobAbort)&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Houston, we've \
got a problem. We have roughly 16 hours to fix this. Any help is appreciated!&lt;/div&gt;-- \
&lt;br&gt;&lt;div class="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;/div&gt;&lt;/div&gt; \
&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20171024150106</emailId><senderName>"Fortman, Andrew"</senderName><senderEmail>andy.fortman@assett.net</senderEmail><timestampReceived>2017-10-24 15:01:06-0400</timestampReceived><subject>[libvirt-users] How to assign to PCI slot 0</subject><body>

Hi,

I'm new to this group so bear with me.

So I need to passthrough a pci device on a particular bus and slot to get Linux to \
recognize it correctly.

I need pci bus 6, slot 0.

However whenever I try to use this slot inside of virsh edit it complains:

error: XML error: Invalid PCI address 0000:06:00.0. slot must be &gt;= 1
Failed. Try again? [y,n,i,f,?]:

Is there a way to work around this ? Like can I disable the strict XML checking or \
even run the qemu commands manually?

Thanks,
Andy


[Attachment #3 (text/html)]

&lt;html xmlns:v="urn:schemas-microsoft-com:vml" \
xmlns:o="urn:schemas-microsoft-com:office:office" \
xmlns:w="urn:schemas-microsoft-com:office:word" \
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" \
xmlns="http://www.w3.org/TR/REC-html40"&gt; &lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=us-ascii"&gt;
&lt;meta name="Generator" content="Microsoft Word 15 (filtered medium)"&gt;
&lt;style&gt;&lt;!--
/* Font Definitions */
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:#0563C1;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:#954F72;
	text-decoration:underline;}
span.EmailStyle17
	{mso-style-type:personal-compose;
	font-family:"Calibri",sans-serif;
	color:windowtext;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-family:"Calibri",sans-serif;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
--&gt;&lt;/style&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapedefaults v:ext="edit" spidmax="1026" /&gt;
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapelayout v:ext="edit"&gt;
&lt;o:idmap v:ext="edit" data="1" /&gt;
&lt;/o:shapelayout&gt;&lt;/xml&gt;&lt;![endif]--&gt;
&lt;/head&gt;
&lt;body lang="EN-US" link="#0563C1" vlink="#954F72"&gt;
&lt;div class="WordSection1"&gt;
&lt;p class="MsoNormal"&gt;Hi,&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;I’m new to this group so bear with me.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;So I need to passthrough a pci device on a particular bus and \
slot to get Linux to recognize it correctly.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;I need pci bus 6, slot \
0.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;However whenever I try to use this slot inside of virsh edit it \
complains: &lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;error: XML error: Invalid PCI address 0000:06:00.0. slot must be \
&gt;= 1&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;Failed. Try again? \
[y,n,i,f,?]:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;Is there a way to work around this ? Like can I disable the \
strict XML checking or even run the qemu commands manually?&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;Thanks,&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;Andy&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20171019181100</emailId><senderName>"Matwey V. Kornilov"</senderName><senderEmail>matwey.kornilov@gmail.com</senderEmail><timestampReceived>2017-10-19 18:11:00-0400</timestampReceived><subject>[libvirt-users] terminating on signal 15 from pid 2146 (/usr/sbin/libvirtd)</subject><body>

Hello,

I use libvirt 3.3.0 and qemu 2.9.0

My domain XML spec is the following:

&lt;domain type='qemu'&gt;
  &lt;name&gt;s390_generic&lt;/name&gt;
  &lt;uuid&gt;82b4d16e-b636-447e-9fda-41d44616bce8&lt;/uuid&gt;
  &lt;memory unit='KiB'&gt;1048576&lt;/memory&gt;
  &lt;currentMemory unit='KiB'&gt;1048576&lt;/currentMemory&gt;
  &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
  &lt;os&gt;
    &lt;type arch='s390x' machine='s390-ccw-virtio-2.9'&gt;hvm&lt;/type&gt;
    &lt;boot dev='hd'/&gt;
  &lt;/os&gt;
  &lt;clock offset='utc'/&gt;
  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
  &lt;on_crash&gt;destroy&lt;/on_crash&gt;
  &lt;devices&gt;
    &lt;emulator&gt;/usr/bin/qemu-system-s390x&lt;/emulator&gt;
    &lt;disk type='block' device='disk'&gt;
      &lt;driver name='qemu' type='raw' cache='none' io='native'/&gt;
      &lt;source dev='/dev/lvm_pda/libvirt_s390'/&gt;
      &lt;target dev='vda' bus='virtio'/&gt;
      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0000'/&gt;
    &lt;/disk&gt;
    &lt;disk type='file' device='cdrom'&gt;
      &lt;driver name='qemu' type='raw'/&gt;
      &lt;target dev='sda' bus='scsi'/&gt;
      &lt;readonly/&gt;
      &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
    &lt;/disk&gt;
    &lt;controller type='scsi' index='0' model='virtio-scsi'&gt;
      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0002'/&gt;
    &lt;/controller&gt;
    &lt;interface type='bridge'&gt;
      &lt;mac address='52:54:00:e8:61:7e'/&gt;
      &lt;source bridge='br0'/&gt;
      &lt;model type='virtio'/&gt;
      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0001'/&gt;
    &lt;/interface&gt;
    &lt;console type='pty'&gt;
      &lt;target type='sclp' port='0'/&gt;
    &lt;/console&gt;
    &lt;memballoon model='virtio'&gt;
      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0003'/&gt;
    &lt;/memballoon&gt;
    &lt;panic model='s390'/&gt;
  &lt;/devices&gt;
&lt;/domain&gt;

The issue is that when I try to start it, it starts and shutdowns
immediately:

virsh # start s390_generic
Domain s390_generic started

virsh #

In the domain log file I see the following:

2017-10-19 18:10:21.633+0000: starting up libvirt version: 3.3.0, qemu
version: 2.9.0(openSUSE Leap 42.3), hostname: oak.local
LC_ALL=C
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
QEMU_AUDIO_DRV=none /usr/bin/qemu-system-s390x -name
guest=s390_generic,debug-threads=on -S -object
secret,id=masterKey0,format=raw,file=/var/lib/libvirt/qemu/domain-7-s390_generic/master-key.aes
-machine s390-ccw-virtio-2.9,accel=tcg,usb=off,dump-guest-core=off -m
1024 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -uuid
82b4d16e-b636-447e-9fda-41d44616bce8 -display none -no-user-config
-nodefaults -chardev
socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-7-s390_generic/monitor.sock,server,nowait
-mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc
-no-shutdown -boot strict=on -device
virtio-scsi-ccw,id=scsi0,devno=fe.0.0002 -drive
file=/dev/lvm_pda/libvirt_s390,format=raw,if=none,id=drive-virtio-disk0,cache=none,aio=native
-device
virtio-blk-ccw,scsi=off,devno=fe.0.0000,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1
-drive if=none,id=drive-scsi0-0-0-0,readonly=on -device
scsi-cd,bus=scsi0.0,channel=0,scsi-id=0,lun=0,drive=drive-scsi0-0-0-0,id=scsi0-0-0-0
-netdev tap,fd=26,id=hostnet0 -device
virtio-net-ccw,netdev=hostnet0,id=net0,mac=52:54:00:e8:61:7e,devno=fe.0.0001
-chardev pty,id=charconsole0 -device
sclpconsole,chardev=charconsole0,id=console0 -device
virtio-balloon-ccw,id=balloon0,devno=fe.0.0003 -msg timestamp=on
2017-10-19T18:10:21.701184Z qemu-system-s390x: -chardev
pty,id=charconsole0: char device redirected to /dev/pts/5 (label
charconsole0)
2017-10-19T18:10:21.721299Z qemu-system-s390x: terminating on signal 15
from pid 2146 (/usr/sbin/libvirtd)
2017-10-19 18:10:21.985+0000: shutting down, reason=shutdown


What is the issue?

</body></email><email><emailId>20171025134153</emailId><senderName>Yalan Zhang</senderName><senderEmail>yalzhang@redhat.com</senderEmail><timestampReceived>2017-10-25 13:41:53-0400</timestampReceived><subject>[libvirt-users] question about how to set rng device on vm</subject><body>

Hi Amos,

I'm a libvirt QE, and I can not understand the setting on libvirt.org for
rng device.
Could you please help to explain a little?
(The xml in  https://libvirt.org/formatdomain.html#elementsRng)
&lt;devices&gt;
  &lt;rng model='virtio'&gt;
    &lt;rate period="2000" bytes="1234"/&gt;
    &lt;backend model='random'&gt;/dev/random&lt;/backend&gt;
    &lt;!-- OR --&gt;
    &lt;backend model='egd' type='udp'&gt;
      *&lt;source mode='bind' service='1234'/&gt;*
*      &lt;source mode='connect' host='1.2.3.4' service='1234'/&gt;*
    &lt;/backend&gt;
  &lt;/rng&gt;
&lt;/devices&gt;

How did it work with source mode='bind' and source mode='connect' together?
which process on guest or host will act as server part, which for client
part?

One detail example:
start a vm with below device, and no egd running on host:
 &lt;rng model='virtio'&gt;
      &lt;backend model='egd' type='udp'&gt;
        &lt;source mode='bind' service='1234'/&gt;
        &lt;source mode='connect' host='127.0.0.1' service='1234'/&gt;
      &lt;/backend&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x09'
function='0x0'/&gt;
    &lt;/rng&gt;

qemu command line:
-chardev udp,id=charrng0,host=127.0.0.1,port=1234,localaddr=,localport=1234
-object rng-egd,id=objrng0,chardev=charrng0 -device
virtio-rng-pci,rng=objrng0,id=rng0,bus=pci.0,addr=0x9


In my understanding the purpose of the rng device on guest is to provide
guest a hardware RNG device /dev/hwrng which obtain seeds from the host.
The source can be /dev/random on host, then the xml will be:
&lt;rng model='virtio'&gt;
      &lt;backend model='random'&gt;/dev/random&lt;/backend&gt;
    &lt;/rng&gt;

can be hardware on host:
&lt;rng model='virtio'&gt;
      &lt;backend model='random'&gt;/dev/hwrng&lt;/backend&gt;
    &lt;/rng&gt;

can be edg daemon running on host:
   &lt;rng model='virtio'&gt;
      &lt;backend model='egd' type='tcp'&gt;
        &lt;source mode='connect' host='127.0.0.1' service='1234'/&gt;
      &lt;/backend&gt;
    &lt;/rng&gt;
(on host, there should be a egd daemon running on tcp 127.0.0.1:1234
 # egd.pl --debug-client --nofork localhost:1234)

Thank you very much and look forward for your response!


-------
Best Regards,
Yalan Zhang
IRC: yalzhang
Internal phone: 8389413

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi Amos,  &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I'm a libvirt QE, and I can not \
understand the setting on &lt;a href="http://libvirt.org"&gt;libvirt.org&lt;/a&gt; for rng \
device.&lt;/div&gt;&lt;div&gt;Could you please help to explain a little?  &lt;/div&gt;&lt;div&gt;(The xml in  \
&lt;a href="https://libvirt.org/formatdomain.html#elementsRng"&gt;https://libvirt.org/formatdomain.html#elementsRng&lt;/a&gt;)&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;devices&gt;&lt;/div&gt;&lt;div&gt; \
&lt;rng model='virtio'&gt;&lt;/div&gt;&lt;div&gt;      &lt;rate period="2000" \
bytes="1234"/&gt;&lt;/div&gt;&lt;div&gt;      &lt;backend \
model='random'&gt;/dev/random&lt;/backend&gt;&lt;/div&gt;&lt;div&gt;      &lt;!-- OR \
--&gt;&lt;/div&gt;&lt;div&gt;      &lt;backend model='egd' \
type='udp'&gt;&lt;/div&gt;&lt;div&gt;         &lt;b&gt;&lt;source mode='bind' \
service='1234'/&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;         &lt;source \
mode='connect' host='1.2.3.4' \
service='1234'/&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;      &lt;/backend&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;/rng&gt;&lt;/div&gt;&lt;div&gt;&lt;/devices&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;How \
did it work with source mode='bind' and source mode='connect' \
together?  &lt;/div&gt;&lt;div&gt;which process on guest or host will act as server part, which \
for client part?&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;One detail example:  &lt;/div&gt;&lt;div&gt;start \
a vm with below device, and no egd running on host:&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;  &lt;rng \
model='virtio'&gt;&lt;/div&gt;&lt;div&gt;         &lt;backend model='egd' \
type='udp'&gt;&lt;/div&gt;&lt;div&gt;            &lt;source mode='bind' \
service='1234'/&gt;&lt;/div&gt;&lt;div&gt;            &lt;source mode='connect' \
host='127.0.0.1' service='1234'/&gt;&lt;/div&gt;&lt;div&gt;         \
&lt;/backend&gt;&lt;/div&gt;&lt;div&gt;         &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x09' \
function='0x0'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/rng&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;qemu command line:&lt;/div&gt;&lt;div&gt;-chardev \
udp,id=charrng0,host=127.0.0.1,port=1234,localaddr=,localport=1234 -object \
rng-egd,id=objrng0,chardev=charrng0 -device \
virtio-rng-pci,rng=objrng0,id=rng0,bus=pci.0,addr=0x9  \
&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div \
class="gmail_signature"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In my understanding the purpose of the \
rng device on guest is to provide guest a hardware RNG device /dev/hwrng which obtain \
seeds from the host.  &lt;/div&gt;&lt;div&gt;The source can be /dev/random on host, then the xml \
will be:&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;rng model='virtio'&gt;&lt;/div&gt;&lt;div&gt;         \
&lt;backend model='random'&gt;/dev/random&lt;/backend&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/rng&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;can be hardware on \
host:&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;rng model='virtio'&gt;&lt;/div&gt;&lt;div&gt;         \
&lt;backend model='random'&gt;/dev/hwrng&lt;/backend&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/rng&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;can be edg daemon running on \
host:&lt;/div&gt;&lt;div&gt;&lt;div&gt;     &lt;rng model='virtio'&gt;&lt;/div&gt;&lt;div&gt;         \
&lt;backend model='egd' type='tcp'&gt;&lt;/div&gt;&lt;div&gt;            \
&lt;source mode='connect' host='127.0.0.1' \
service='1234'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;/backend&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/rng&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;(on host, there should be a egd daemon running on tcp &lt;a \
href="http://127.0.0.1:1234"&gt;127.0.0.1:1234&lt;/a&gt;&lt;/div&gt;&lt;div&gt;  # &lt;a \
href="http://egd.pl"&gt;egd.pl&lt;/a&gt; --debug-client --nofork \
localhost:1234)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank you very much and look forward for \
your response!&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_signature"&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_signature"&gt;-------&lt;br&gt;Best Regards,&lt;br&gt;Yalan Zhang&lt;br&gt;IRC: \
yalzhang&lt;br&gt;Internal phone: 8389413&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20171025115302</emailId><senderName>Ashish Kurian</senderName><senderEmail>ashishbnv@gmail.com</senderEmail><timestampReceived>2017-10-25 11:53:02-0400</timestampReceived><subject>[libvirt-users] Need to increase the rx and tx buffer size of my interface</subject><body>

Dear Users/Developers,

I am using a KVM Ubuntu VM as a degrader to apply specific delays to
incoming packets. As the delay for my packets can be higher than 7.5
seconds, there is not enough buffer on my interface to buffer all the
packets. Therefore those overflowing packets are dropped in the machine and
not forwarded.

When I tried to use the command  ethtool -G ens8 rx 512 to increase the
buffer size, I get the following error.

Cannot set device ring parameters: Operation not permitted

I have kept the VM xml files as specified in the link :
https://libvirt.org/formatdomain.html. The value that I kept in my xml file
is as follows.

&lt;interface type='direct'&gt;
      &lt;mac address='52:54:00:72:f9:eb'/&gt;
      &lt;source dev='enp7s0f0' mode='vepa'/&gt;
      &lt;model type='virtio'/&gt;
      &lt;driver name='vhost' queues='5' rx_queue_size='512'
tx_queue_size='512'&gt;
      &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off' ufo='off'
mrg_rxbuf='off'/&gt;
      &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
      &lt;/driver&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08'
function='0x0'/&gt;
    &lt;/interface&gt;
    &lt;interface type='direct'&gt;
      &lt;mac address='52:54:00:00:b5:99'/&gt;
      &lt;source dev='enp7s0f1' mode='vepa'/&gt;
      &lt;model type='virtio'/&gt;
      &lt;driver name='vhost' queues='5' rx_queue_size='512'
tx_queue_size='512'&gt;
      &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off' ufo='off'
mrg_rxbuf='off'/&gt;
      &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
      &lt;/driver&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x09'
function='0x0'/&gt;

After I saved the xml and redefined the machine and started it up, I
checked to see if the buffers are increased. I still see that the buffers
are as follows.

Ring parameters for ens9:
Pre-set maximums:
RX: 4096
RX Mini: 0
RX Jumbo: 0
TX: 4096
Current hardware settings:
RX: *256*
RX Mini: 0
RX Jumbo: 0
TX: *256*


How can I increase the buffer on my KVM VM?

Best Regards,
Ashish Kurian

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Dear Users/Developers,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I am using a KVM Ubuntu VM \
as a degrader to apply specific delays to incoming packets. As the delay for my \
packets can be higher than 7.5 seconds, there is not enough buffer on my interface to \
buffer all the packets. Therefore those overflowing packets are dropped in the \
machine and not forwarded.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When I tried to use the command   \
ethtool -G ens8 rx 512 to increase the buffer size, I get the following \
error.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cannot set device ring parameters: Operation not \
permitted&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I have kept the VM xml files as specified in \
the link :  &lt;a href="https://libvirt.org/formatdomain.html"&gt;https://libvirt.org/formatdomain.html&lt;/a&gt;. \
The value that I kept in my xml file is as \
follows.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;interface \
type='direct'&gt;&lt;/div&gt;&lt;div&gt;         &lt;mac \
address='52:54:00:72:f9:eb'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;source \
dev='enp7s0f0' mode='vepa'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;model \
type='virtio'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;driver name='vhost' \
queues='5' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;/div&gt;&lt;div&gt;         &lt;host csum='off' \
gso='off' tso4='off' tso6='off' ecn='off' \
ufo='off' mrg_rxbuf='off'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;guest \
csum='off' tso4='off' tso6='off' ecn='off' \
ufo='off'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;/driver&gt;&lt;/div&gt;&lt;div&gt;         \
&lt;address type='pci' domain='0x0000' bus='0x00' \
slot='0x08' function='0x0'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/interface&gt;&lt;/div&gt;&lt;div&gt;      &lt;interface type='direct'&gt;&lt;/div&gt;&lt;div&gt; \
&lt;mac address='52:54:00:00:b5:99'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;source \
dev='enp7s0f1' mode='vepa'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;model \
type='virtio'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;driver name='vhost' \
queues='5' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;/div&gt;&lt;div&gt;         &lt;host csum='off' \
gso='off' tso4='off' tso6='off' ecn='off' \
ufo='off' mrg_rxbuf='off'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;guest \
csum='off' tso4='off' tso6='off' ecn='off' \
ufo='off'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;/driver&gt;&lt;/div&gt;&lt;div&gt;         \
&lt;address type='pci' domain='0x0000' bus='0x00' \
slot='0x09' function='0x0'/&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;After \
I saved the xml and redefined the machine and started it up, I checked to see if the \
buffers are increased. I still see that the buffers are as \
follows.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;Ring parameters for ens9:&lt;/div&gt;&lt;div&gt;Pre-set \
maximums:&lt;/div&gt;&lt;div&gt;RX:&lt;span style="white-space:pre"&gt;		&lt;/span&gt;4096&lt;/div&gt;&lt;div&gt;RX \
Mini:&lt;span style="white-space:pre"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;RX Jumbo:&lt;span \
style="white-space:pre"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre"&gt;		&lt;/span&gt;4096&lt;/div&gt;&lt;div&gt;Current hardware \
settings:&lt;/div&gt;&lt;div&gt;RX:&lt;span style="white-space:pre"&gt;		&lt;/span&gt;&lt;b&gt;256&lt;/b&gt;&lt;/div&gt;&lt;div&gt;RX \
Mini:&lt;span style="white-space:pre"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;RX Jumbo:&lt;span \
style="white-space:pre"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre"&gt;		&lt;/span&gt;&lt;b&gt;256&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;How \
can I increase the buffer on my KVM VM?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div \
class="gmail_signature"&gt;Best Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20171030002614</emailId><senderName>Dagmawi Biru</senderName><senderEmail>admin@dbvoid.com</senderEmail><timestampReceived>2017-10-30 00:26:14-0400</timestampReceived><subject>[libvirt-users] libvirt/dnsmasq is not adhering to static DHCP assignments</subject><body>

Given the following network configuration:
===========
&lt;network&gt;
  &lt;name&gt;osc_mgmt&lt;/name&gt;
  &lt;uuid&gt;d93fe709-14ae-4a0e-8989-aeaa8c76c513&lt;/uuid&gt;
  &lt;forward mode='route'/&gt;
  &lt;bridge name='osc_mgmt' stp='on' delay='0'/&gt;
  &lt;mac address='52:54:00:3f:fe:10'/&gt;
  &lt;ip address='192.168.80.254' netmask='255.255.255.0'&gt;
    &lt;dhcp&gt;
      &lt;range start='192.168.80.1' end='192.168.80.200'/&gt;
      &lt;host mac='52:54:00:2c:85:92' name='openstack-controller-00'
ip='192.168.80.1'/&gt;
      &lt;host mac='52:54:00:e2:4b:25' name='openstack-database-00'
ip='192.168.80.2'/&gt;
      &lt;host mac='52:54:00:50:91:04' name='openstack-keystone-00'
ip='192.168.80.3'/&gt;
      &lt;host mac='52:54:00:fe:5b:36' name='openstack-rabbitmq-00'
ip='192.168.80.7'/&gt;
      &lt;host mac='52:54:00:95:ca:bd' name='openstack-glance-00'
ip='192.168.80.5'/&gt;
    &lt;/dhcp&gt;
  &lt;/ip&gt;
&lt;/network&gt;

When attempting to bring up the relevant interface in the virtual machine,
I get an incorrect IP address assigned, different from the one I statically
set up per the XML above. As you can see, the device with MAC
'52:54:00:e2:4b:25' should really be getting 192.168.80.2, but what happens
when we bring this interface up is this:

===========
root@openstack-database-00:/home/osc# ifup ens11
Internet Systems Consortium DHCP Client 4.3.3
Copyright 2004-2015 Internet Systems Consortium.
All rights reserved.
For info, please visit https://www.isc.org/software/dhcp/

Listening on LPF/ens11/...
Sending on   LPF/ens11/...
Sending on   Socket/fallback
DHCPDISCOVER on ens11 to 255.255.255.255 port 67 interval 3 (xid=0x6769e42a)
DHCPREQUEST of 192.168.80.27 on ens11 to 255.255.255.255 port 67
(xid=0x2ae46967)
DHCPOFFER of 192.168.80.27 from 192.168.80.254
DHCPACK of 192.168.80.27 from 192.168.80.254
bound to 192.168.80.27 -- renewal in 1407 seconds.


Some additional info about the VM and network it's attached to
===========

[root@dragon dnsmasq]# virsh domiflist openstack-database-00
Interface  Type       Source     Model       MAC
-------------------------------------------------------
vnet12     bridge     br20       virtio      52:54:00:6c:ce:b9
vnet13     network    VM_MGMT    rtl8139     52:54:00:7d:ca:87
vnet14     network    osc_mgmt   rtl8139     52:54:00:e2:4b:25

[root@dragon dnsmasq]# virsh net-info osc_mgmt
Name:           osc_mgmt
UUID:           d93fe709-14ae-4a0e-8989-aeaa8c76c513
Active:         yes
Persistent:     yes
Autostart:      yes
Bridge:         osc_mgmt
===========


What's strange is that the first VM seems to work correctly and gets an
assigned address of 192.168.80.1, but for some reason the others don't. Any
ideas?

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;Given the following network \
configuration:&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;===========&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;network&gt;&lt;/div&gt;&lt;div&gt; \
&lt;name&gt;osc_mgmt&lt;/name&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;uuid&gt;d93fe709-14ae-4a0e-8989-aeaa8c76c513&lt;/uuid&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;forward mode='route'/&gt;&lt;/div&gt;&lt;div&gt;   &lt;bridge name='osc_mgmt' \
stp='on' delay='0'/&gt;&lt;/div&gt;&lt;div&gt;   &lt;mac \
address='52:54:00:3f:fe:10'/&gt;&lt;/div&gt;&lt;div&gt;   &lt;ip \
address='192.168.80.254' netmask='255.255.255.0'&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;dhcp&gt;&lt;/div&gt;&lt;div&gt;         &lt;range start='192.168.80.1' \
end='192.168.80.200'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;host \
mac='52:54:00:2c:85:92' name='openstack-controller-00' \
ip='192.168.80.1'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;host \
mac='52:54:00:e2:4b:25' name='openstack-database-00' \
ip='192.168.80.2'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;host \
mac='52:54:00:50:91:04' name='openstack-keystone-00' \
ip='192.168.80.3'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;host \
mac='52:54:00:fe:5b:36' name='openstack-rabbitmq-00' \
ip='192.168.80.7'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;host \
mac='52:54:00:95:ca:bd' name='openstack-glance-00' \
ip='192.168.80.5'/&gt;&lt;/div&gt;&lt;div&gt;      &lt;/dhcp&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;/ip&gt;&lt;/div&gt;&lt;div&gt;&lt;/network&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When \
attempting to bring up the relevant interface in the virtual machine, I get an \
incorrect IP address assigned, different from the one I statically set up per the XML \
above. As you can see, the device with MAC '52:54:00:e2:4b:25'  should really \
be getting 192.168.80.2, but what happens when we bring this interface up is \
this:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;===========&lt;/div&gt;&lt;div&gt;&lt;div&gt;root@openstack-database-00:/home/osc# \
ifup ens11&lt;/div&gt;&lt;div&gt;Internet Systems Consortium DHCP Client \
4.3.3&lt;/div&gt;&lt;div&gt;Copyright 2004-2015 Internet Systems Consortium.&lt;/div&gt;&lt;div&gt;All rights \
reserved.&lt;/div&gt;&lt;div&gt;For info, please visit &lt;a \
href="https://www.isc.org/software/dhcp/"&gt;https://www.isc.org/software/dhcp/&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Listening \
on LPF/ens11/...&lt;/div&gt;&lt;div&gt;Sending on     LPF/ens11/...&lt;/div&gt;&lt;div&gt;Sending on     \
Socket/fallback&lt;/div&gt;&lt;div&gt;DHCPDISCOVER on ens11 to 255.255.255.255 port 67 interval 3 \
(xid=0x6769e42a)&lt;/div&gt;&lt;div&gt;DHCPREQUEST of 192.168.80.27 on ens11 to 255.255.255.255 \
port 67 (xid=0x2ae46967)&lt;/div&gt;&lt;div&gt;DHCPOFFER of 192.168.80.27 from \
192.168.80.254&lt;/div&gt;&lt;div&gt;DHCPACK of 192.168.80.27 from 192.168.80.254&lt;/div&gt;&lt;div&gt;bound \
to 192.168.80.27 -- renewal in 1407 \
seconds.&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Some additional info about the \
VM and network it's attached \
to&lt;/div&gt;&lt;div&gt;===========&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;[root@dragon dnsmasq]# \
virsh domiflist openstack-database-00&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;Interface   Type           \
Source        Model           \
MAC&lt;/div&gt;&lt;div&gt;-------------------------------------------------------&lt;/div&gt;&lt;div&gt;vnet12 \
bridge        br20           virtio         52:54:00:6c:ce:b9&lt;/div&gt;&lt;div&gt;vnet13        \
network      VM_MGMT      rtl8139        52:54:00:7d:ca:87&lt;/div&gt;&lt;div&gt;vnet14        \
network      osc_mgmt     rtl8139        \
52:54:00:e2:4b:25&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@dragon dnsmasq]# virsh net-info \
osc_mgmt&lt;/div&gt;&lt;div&gt;Name:                 osc_mgmt&lt;/div&gt;&lt;div&gt;UUID:                 \
d93fe709-14ae-4a0e-8989-aeaa8c76c513&lt;/div&gt;&lt;div&gt;Active:              \
yes&lt;/div&gt;&lt;div&gt;Persistent:        yes&lt;/div&gt;&lt;div&gt;Autostart:         \
yes&lt;/div&gt;&lt;div&gt;Bridge:              \
osc_mgmt&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;===========&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;What's \
strange is that the first VM seems to work correctly and gets an assigned address of \
192.168.80.1, but for some reason the others don't. Any \
ideas?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20171030102125</emailId><senderName>Yalan Zhang</senderName><senderEmail>yalzhang@redhat.com</senderEmail><timestampReceived>2017-10-30 10:21:25-0400</timestampReceived><subject>Re: [libvirt-users] libvirt/dnsmasq is not adhering to static DHCP assignments</subject><body>

Please check the dnsmasq hostsfile, should have all the records there:

# cat /var/lib/libvirt/dnsmasq/osc_mgmt.hostsfile
52:54:00:2c:85:92,192.168.80.1,openstack-controller-00
52:54:00:e2:4b:25,192.168.80.2,openstack-database-00
52:54:00:50:91:04,192.168.80.3,openstack-keystone-00
52:54:00:fe:5b:36,192.168.80.7,openstack-rabbitmq-00
52:54:00:95:ca:bd,192.168.80.5,openstack-glance-00





-------
Best Regards,
Yalan Zhang
IRC: yalzhang
Internal phone: 8389413

On Mon, Oct 30, 2017 at 8:26 AM, Dagmawi Biru &lt;admin@dbvoid.com&gt; wrote:

&gt; Given the following network configuration:
&gt; ===========
&gt; &lt;network&gt;
&gt;   &lt;name&gt;osc_mgmt&lt;/name&gt;
&gt;   &lt;uuid&gt;d93fe709-14ae-4a0e-8989-aeaa8c76c513&lt;/uuid&gt;
&gt;   &lt;forward mode='route'/&gt;
&gt;   &lt;bridge name='osc_mgmt' stp='on' delay='0'/&gt;
&gt;   &lt;mac address='52:54:00:3f:fe:10'/&gt;
&gt;   &lt;ip address='192.168.80.254' netmask='255.255.255.0'&gt;
&gt;     &lt;dhcp&gt;
&gt;       &lt;range start='192.168.80.1' end='192.168.80.200'/&gt;
&gt;       &lt;host mac='52:54:00:2c:85:92' name='openstack-controller-00'
&gt; ip='192.168.80.1'/&gt;
&gt;       &lt;host mac='52:54:00:e2:4b:25' name='openstack-database-00'
&gt; ip='192.168.80.2'/&gt;
&gt;       &lt;host mac='52:54:00:50:91:04' name='openstack-keystone-00'
&gt; ip='192.168.80.3'/&gt;
&gt;       &lt;host mac='52:54:00:fe:5b:36' name='openstack-rabbitmq-00'
&gt; ip='192.168.80.7'/&gt;
&gt;       &lt;host mac='52:54:00:95:ca:bd' name='openstack-glance-00'
&gt; ip='192.168.80.5'/&gt;
&gt;     &lt;/dhcp&gt;
&gt;   &lt;/ip&gt;
&gt; &lt;/network&gt;
&gt;
&gt; When attempting to bring up the relevant interface in the virtual machine,
&gt; I get an incorrect IP address assigned, different from the one I statically
&gt; set up per the XML above. As you can see, the device with MAC
&gt; '52:54:00:e2:4b:25' should really be getting 192.168.80.2, but what happens
&gt; when we bring this interface up is this:
&gt;
&gt; ===========
&gt; root@openstack-database-00:/home/osc# ifup ens11
&gt; Internet Systems Consortium DHCP Client 4.3.3
&gt; Copyright 2004-2015 Internet Systems Consortium.
&gt; All rights reserved.
&gt; For info, please visit https://www.isc.org/software/dhcp/
&gt;
&gt; Listening on LPF/ens11/...
&gt; Sending on   LPF/ens11/...
&gt; Sending on   Socket/fallback
&gt; DHCPDISCOVER on ens11 to 255.255.255.255 port 67 interval 3
&gt; (xid=0x6769e42a)
&gt; DHCPREQUEST of 192.168.80.27 on ens11 to 255.255.255.255 port 67
&gt; (xid=0x2ae46967)
&gt; DHCPOFFER of 192.168.80.27 from 192.168.80.254
&gt; DHCPACK of 192.168.80.27 from 192.168.80.254
&gt; bound to 192.168.80.27 -- renewal in 1407 seconds.
&gt;
&gt;
&gt; Some additional info about the VM and network it's attached to
&gt; ===========
&gt;
&gt; [root@dragon dnsmasq]# virsh domiflist openstack-database-00
&gt; Interface  Type       Source     Model       MAC
&gt; -------------------------------------------------------
&gt; vnet12     bridge     br20       virtio      52:54:00:6c:ce:b9
&gt; vnet13     network    VM_MGMT    rtl8139     52:54:00:7d:ca:87
&gt; vnet14     network    osc_mgmt   rtl8139     52:54:00:e2:4b:25
&gt;
&gt; [root@dragon dnsmasq]# virsh net-info osc_mgmt
&gt; Name:           osc_mgmt
&gt; UUID:           d93fe709-14ae-4a0e-8989-aeaa8c76c513
&gt; Active:         yes
&gt; Persistent:     yes
&gt; Autostart:      yes
&gt; Bridge:         osc_mgmt
&gt; ===========
&gt;
&gt;
&gt; What's strange is that the first VM seems to work correctly and gets an
&gt; assigned address of 192.168.80.1, but for some reason the others don't. Any
&gt; ideas?
&gt;
&gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Please check the dnsmasq hostsfile, should have all the records \
there:&lt;div&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;# cat \
/var/lib/libvirt/dnsmasq/osc_mgmt.hostsfile&lt;/div&gt;&lt;div&gt;52:54:00:2c:85:92,192.168.80.1,o \
penstack-controller-00&lt;/div&gt;&lt;div&gt;52:54:00:e2:4b:25,192.168.80.2,openstack-database-00&lt; \
/div&gt;&lt;div&gt;52:54:00:50:91:04,192.168.80.3,openstack-keystone-00&lt;/div&gt;&lt;div&gt;52:54:00:fe:5 \
b:36,192.168.80.7,openstack-rabbitmq-00&lt;/div&gt;&lt;div&gt;52:54:00:95:ca:bd,192.168.80.5,openstack-glance-00&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div class="gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;br&gt;&lt;br&gt;-------&lt;br&gt;Best Regards,&lt;br&gt;Yalan \
Zhang&lt;br&gt;IRC: yalzhang&lt;br&gt;Internal phone: 8389413&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Mon, Oct 30, 2017 at 8:26 AM, Dagmawi Biru &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:admin@dbvoid.com" \
target="_blank"&gt;admin@dbvoid.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;Given the following network \
configuration:&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;===========&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;network&gt;&lt;/div&gt;&lt;div&gt; \
&lt;name&gt;osc_mgmt&lt;/name&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;uuid&gt;d93fe709-14ae-4a0e-8989-&lt;wbr&gt;aeaa8c76c513&lt;/uuid&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;forward mode='route'/&gt;&lt;/div&gt;&lt;div&gt;   &lt;bridge name='osc_mgmt' \
stp='on' delay='0'/&gt;&lt;/div&gt;&lt;div&gt;   &lt;mac \
address='52:54:00:3f:fe:10'/&gt;&lt;/div&gt;&lt;div&gt;   &lt;ip \
address='192.168.80.254' netmask='255.255.255.0'&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;dhcp&gt;&lt;/div&gt;&lt;div&gt;         &lt;range start='192.168.80.1' \
end='192.168.80.200'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;host \
mac='52:54:00:2c:85:92' name='openstack-controller-00' \
ip='192.168.80.1'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;host \
mac='52:54:00:e2:4b:25' name='openstack-database-00' \
ip='192.168.80.2'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;host \
mac='52:54:00:50:91:04' name='openstack-keystone-00' \
ip='192.168.80.3'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;host \
mac='52:54:00:fe:5b:36' name='openstack-rabbitmq-00' \
ip='192.168.80.7'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;host \
mac='52:54:00:95:ca:bd' name='openstack-glance-00' \
ip='192.168.80.5'/&gt;&lt;/div&gt;&lt;div&gt;      &lt;/dhcp&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;/ip&gt;&lt;/div&gt;&lt;div&gt;&lt;/network&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When \
attempting to bring up the relevant interface in the virtual machine, I get an \
incorrect IP address assigned, different from the one I statically set up per the XML \
above. As you can see, the device with MAC '52:54:00:e2:4b:25'  should really \
be getting 192.168.80.2, but what happens when we bring this interface up is \
this:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;===========&lt;/div&gt;&lt;div&gt;&lt;div&gt;root@openstack-database-00:/&lt;wbr&gt;home/osc# \
ifup ens11&lt;/div&gt;&lt;div&gt;Internet Systems Consortium DHCP Client \
4.3.3&lt;/div&gt;&lt;div&gt;Copyright 2004-2015 Internet Systems Consortium.&lt;/div&gt;&lt;div&gt;All rights \
reserved.&lt;/div&gt;&lt;div&gt;For info, please visit &lt;a \
href="https://www.isc.org/software/dhcp/" \
target="_blank"&gt;https://www.isc.org/software/&lt;wbr&gt;dhcp/&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Listening \
on LPF/ens11/...&lt;/div&gt;&lt;div&gt;Sending on     LPF/ens11/...&lt;/div&gt;&lt;div&gt;Sending on     \
Socket/fallback&lt;/div&gt;&lt;div&gt;DHCPDISCOVER on ens11 to 255.255.255.255 port 67 interval 3 \
(xid=0x6769e42a)&lt;/div&gt;&lt;div&gt;DHCPREQUEST of 192.168.80.27 on ens11 to 255.255.255.255 \
port 67 (xid=0x2ae46967)&lt;/div&gt;&lt;div&gt;DHCPOFFER of 192.168.80.27 from \
192.168.80.254&lt;/div&gt;&lt;div&gt;DHCPACK of 192.168.80.27 from 192.168.80.254&lt;/div&gt;&lt;div&gt;bound \
to 192.168.80.27 -- renewal in 1407 \
seconds.&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Some additional info about the \
VM and network it's attached \
to&lt;/div&gt;&lt;div&gt;===========&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;[root@dragon dnsmasq]# \
virsh domiflist openstack-database-00&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;Interface   Type           \
Source        Model           \
MAC&lt;/div&gt;&lt;div&gt;------------------------------&lt;wbr&gt;-------------------------&lt;/div&gt;&lt;div&gt;vnet12 \
bridge        br20           virtio         52:54:00:6c:ce:b9&lt;/div&gt;&lt;div&gt;vnet13        \
network      VM_MGMT      rtl8139        52:54:00:7d:ca:87&lt;/div&gt;&lt;div&gt;vnet14        \
network      osc_mgmt     rtl8139        \
52:54:00:e2:4b:25&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@dragon dnsmasq]# virsh net-info \
osc_mgmt&lt;/div&gt;&lt;div&gt;Name:                 osc_mgmt&lt;/div&gt;&lt;div&gt;UUID:                 \
d93fe709-14ae-4a0e-8989-&lt;wbr&gt;aeaa8c76c513&lt;/div&gt;&lt;div&gt;Active:              \
yes&lt;/div&gt;&lt;div&gt;Persistent:        yes&lt;/div&gt;&lt;div&gt;Autostart:         \
yes&lt;/div&gt;&lt;div&gt;Bridge:              \
osc_mgmt&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;===========&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;What's \
strange is that the first VM seems to work correctly and gets an assigned address of \
192.168.80.1, but for some reason the others don't. Any \
ideas?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;br&gt;______________________________&lt;wbr&gt;_________________&lt;br&gt; libvirt-users mailing \
list&lt;br&gt; &lt;a href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;
&lt;a href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/&lt;wbr&gt;mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;




</body></email><email><emailId>20171031052715</emailId><senderName>Dagmawi Biru</senderName><senderEmail>admin@dbvoid.com</senderEmail><timestampReceived>2017-10-31 05:27:15-0400</timestampReceived><subject>Re: [libvirt-users] libvirt/dnsmasq is not adhering to static DHCP assignments</subject><body>

Hi,

It looks like that's the issue:
# cat /var/lib/libvirt/dnsmasq/osc_mgmt.hostsfile
52:54:00:2c:85:92,192.168.80.1,openstack-controller-00

But it makes me wonder...libvirt should be generating and managing this
file right? Do I need to edit this myself or should libvirt be updating
this file? If so then why isn't it?



On Mon, Oct 30, 2017 at 5:21 AM, Yalan Zhang &lt;yalzhang@redhat.com&gt; wrote:

&gt; Please check the dnsmasq hostsfile, should have all the records there:
&gt;
&gt; # cat /var/lib/libvirt/dnsmasq/osc_mgmt.hostsfile
&gt; 52:54:00:2c:85:92,192.168.80.1,openstack-controller-00
&gt; 52:54:00:e2:4b:25,192.168.80.2,openstack-database-00
&gt; 52:54:00:50:91:04,192.168.80.3,openstack-keystone-00
&gt; 52:54:00:fe:5b:36,192.168.80.7,openstack-rabbitmq-00
&gt; 52:54:00:95:ca:bd,192.168.80.5,openstack-glance-00
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; -------
&gt; Best Regards,
&gt; Yalan Zhang
&gt; IRC: yalzhang
&gt; Internal phone: 8389413
&gt;
&gt; On Mon, Oct 30, 2017 at 8:26 AM, Dagmawi Biru &lt;admin@dbvoid.com&gt; wrote:
&gt;
&gt;&gt; Given the following network configuration:
&gt;&gt; ===========
&gt;&gt; &lt;network&gt;
&gt;&gt;   &lt;name&gt;osc_mgmt&lt;/name&gt;
&gt;&gt;   &lt;uuid&gt;d93fe709-14ae-4a0e-8989-aeaa8c76c513&lt;/uuid&gt;
&gt;&gt;   &lt;forward mode='route'/&gt;
&gt;&gt;   &lt;bridge name='osc_mgmt' stp='on' delay='0'/&gt;
&gt;&gt;   &lt;mac address='52:54:00:3f:fe:10'/&gt;
&gt;&gt;   &lt;ip address='192.168.80.254' netmask='255.255.255.0'&gt;
&gt;&gt;     &lt;dhcp&gt;
&gt;&gt;       &lt;range start='192.168.80.1' end='192.168.80.200'/&gt;
&gt;&gt;       &lt;host mac='52:54:00:2c:85:92' name='openstack-controller-00'
&gt;&gt; ip='192.168.80.1'/&gt;
&gt;&gt;       &lt;host mac='52:54:00:e2:4b:25' name='openstack-database-00'
&gt;&gt; ip='192.168.80.2'/&gt;
&gt;&gt;       &lt;host mac='52:54:00:50:91:04' name='openstack-keystone-00'
&gt;&gt; ip='192.168.80.3'/&gt;
&gt;&gt;       &lt;host mac='52:54:00:fe:5b:36' name='openstack-rabbitmq-00'
&gt;&gt; ip='192.168.80.7'/&gt;
&gt;&gt;       &lt;host mac='52:54:00:95:ca:bd' name='openstack-glance-00'
&gt;&gt; ip='192.168.80.5'/&gt;
&gt;&gt;     &lt;/dhcp&gt;
&gt;&gt;   &lt;/ip&gt;
&gt;&gt; &lt;/network&gt;
&gt;&gt;
&gt;&gt; When attempting to bring up the relevant interface in the virtual
&gt;&gt; machine, I get an incorrect IP address assigned, different from the one I
&gt;&gt; statically set up per the XML above. As you can see, the device with MAC
&gt;&gt; '52:54:00:e2:4b:25' should really be getting 192.168.80.2, but what happens
&gt;&gt; when we bring this interface up is this:
&gt;&gt;
&gt;&gt; ===========
&gt;&gt; root@openstack-database-00:/home/osc# ifup ens11
&gt;&gt; Internet Systems Consortium DHCP Client 4.3.3
&gt;&gt; Copyright 2004-2015 Internet Systems Consortium.
&gt;&gt; All rights reserved.
&gt;&gt; For info, please visit https://www.isc.org/software/dhcp/
&gt;&gt;
&gt;&gt; Listening on LPF/ens11/...
&gt;&gt; Sending on   LPF/ens11/...
&gt;&gt; Sending on   Socket/fallback
&gt;&gt; DHCPDISCOVER on ens11 to 255.255.255.255 port 67 interval 3
&gt;&gt; (xid=0x6769e42a)
&gt;&gt; DHCPREQUEST of 192.168.80.27 on ens11 to 255.255.255.255 port 67
&gt;&gt; (xid=0x2ae46967)
&gt;&gt; DHCPOFFER of 192.168.80.27 from 192.168.80.254
&gt;&gt; DHCPACK of 192.168.80.27 from 192.168.80.254
&gt;&gt; bound to 192.168.80.27 -- renewal in 1407 seconds.
&gt;&gt;
&gt;&gt;
&gt;&gt; Some additional info about the VM and network it's attached to
&gt;&gt; ===========
&gt;&gt;
&gt;&gt; [root@dragon dnsmasq]# virsh domiflist openstack-database-00
&gt;&gt; Interface  Type       Source     Model       MAC
&gt;&gt; -------------------------------------------------------
&gt;&gt; vnet12     bridge     br20       virtio      52:54:00:6c:ce:b9
&gt;&gt; vnet13     network    VM_MGMT    rtl8139     52:54:00:7d:ca:87
&gt;&gt; vnet14     network    osc_mgmt   rtl8139     52:54:00:e2:4b:25
&gt;&gt;
&gt;&gt; [root@dragon dnsmasq]# virsh net-info osc_mgmt
&gt;&gt; Name:           osc_mgmt
&gt;&gt; UUID:           d93fe709-14ae-4a0e-8989-aeaa8c76c513
&gt;&gt; Active:         yes
&gt;&gt; Persistent:     yes
&gt;&gt; Autostart:      yes
&gt;&gt; Bridge:         osc_mgmt
&gt;&gt; ===========
&gt;&gt;
&gt;&gt;
&gt;&gt; What's strange is that the first VM seems to work correctly and gets an
&gt;&gt; assigned address of 192.168.80.1, but for some reason the others don't. Any
&gt;&gt; ideas?
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; libvirt-users mailing list
&gt;&gt; libvirt-users@redhat.com
&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;
&gt;
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi,  &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It looks like that's the \
issue:&lt;/div&gt;&lt;div&gt;&lt;div&gt;# cat \
/var/lib/libvirt/dnsmasq/osc_mgmt.hostsfile&lt;/div&gt;&lt;div&gt;52:54:00:2c:85:92,192.168.80.1,openstack-controller-00&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;But \
it makes me wonder...libvirt should be generating and managing this file right? Do I \
need to edit this myself or should libvirt be updating this file? If so then why \
isn't it?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Mon, Oct 30, 2017 at 5:21 AM, Yalan Zhang &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:yalzhang@redhat.com" \
target="_blank"&gt;yalzhang@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Please check the dnsmasq hostsfile, should \
have all the records there:&lt;div&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;# cat \
/var/lib/libvirt/dnsmasq/osc_&lt;wbr&gt;mgmt.hostsfile&lt;/div&gt;&lt;div&gt;52:54:00:2c:85:92,192.168.8 \
0.&lt;wbr&gt;1,openstack-controller-00&lt;/div&gt;&lt;div&gt;52:54:00:e2:4b:25,192.168.80.&lt;wbr&gt;2,opensta \
ck-database-00&lt;/div&gt;&lt;div&gt;52:54:00:50:91:04,192.168.80.&lt;wbr&gt;3,openstack-keystone-00&lt;/di \
v&gt;&lt;div&gt;52:54:00:fe:5b:36,192.168.80.&lt;wbr&gt;7,openstack-rabbitmq-00&lt;/div&gt;&lt;div&gt;52:54:00:95 \
:ca:bd,192.168.80.&lt;wbr&gt;5,openstack-glance-00&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_2196363388425348928gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;br&gt;&lt;br&gt;-------&lt;br&gt;Best Regards,&lt;br&gt;Yalan \
Zhang&lt;br&gt;IRC: yalzhang&lt;br&gt;Internal phone: 8389413&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;div \
class="gmail_quote"&gt;&lt;div&gt;&lt;div class="h5"&gt;On Mon, Oct 30, 2017 at 8:26 AM, Dagmawi \
Biru &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:admin@dbvoid.com" \
target="_blank"&gt;admin@dbvoid.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div&gt;&lt;div class="h5"&gt;&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;Given the \
following network configuration:&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;===========&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;network&gt;&lt;/div&gt;&lt;div&gt; \
&lt;name&gt;osc_mgmt&lt;/name&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;uuid&gt;d93fe709-14ae-4a0e-8989-&lt;wbr&gt;aeaa8c76c513&lt;/uuid&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;forward mode='route'/&gt;&lt;/div&gt;&lt;div&gt;   &lt;bridge name='osc_mgmt' \
stp='on' delay='0'/&gt;&lt;/div&gt;&lt;div&gt;   &lt;mac \
address='52:54:00:3f:fe:10'/&gt;&lt;/div&gt;&lt;div&gt;   &lt;ip \
address='192.168.80.254' netmask='255.255.255.0'&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;dhcp&gt;&lt;/div&gt;&lt;div&gt;         &lt;range start='192.168.80.1' \
end='192.168.80.200'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;host \
mac='52:54:00:2c:85:92' name='openstack-controller-00' \
ip='192.168.80.1'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;host \
mac='52:54:00:e2:4b:25' name='openstack-database-00' \
ip='192.168.80.2'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;host \
mac='52:54:00:50:91:04' name='openstack-keystone-00' \
ip='192.168.80.3'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;host \
mac='52:54:00:fe:5b:36' name='openstack-rabbitmq-00' \
ip='192.168.80.7'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;host \
mac='52:54:00:95:ca:bd' name='openstack-glance-00' \
ip='192.168.80.5'/&gt;&lt;/div&gt;&lt;div&gt;      &lt;/dhcp&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;/ip&gt;&lt;/div&gt;&lt;div&gt;&lt;/network&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When \
attempting to bring up the relevant interface in the virtual machine, I get an \
incorrect IP address assigned, different from the one I statically set up per the XML \
above. As you can see, the device with MAC '52:54:00:e2:4b:25'  should really \
be getting 192.168.80.2, but what happens when we bring this interface up is \
this:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;===========&lt;/div&gt;&lt;div&gt;&lt;div&gt;root@openstack-database-00:/ho&lt;wbr&gt;me/osc# \
ifup ens11&lt;/div&gt;&lt;div&gt;Internet Systems Consortium DHCP Client \
4.3.3&lt;/div&gt;&lt;div&gt;Copyright 2004-2015 Internet Systems Consortium.&lt;/div&gt;&lt;div&gt;All rights \
reserved.&lt;/div&gt;&lt;div&gt;For info, please visit &lt;a \
href="https://www.isc.org/software/dhcp/" \
target="_blank"&gt;https://www.isc.org/software/d&lt;wbr&gt;hcp/&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Listening \
on LPF/ens11/...&lt;/div&gt;&lt;div&gt;Sending on     LPF/ens11/...&lt;/div&gt;&lt;div&gt;Sending on     \
Socket/fallback&lt;/div&gt;&lt;div&gt;DHCPDISCOVER on ens11 to 255.255.255.255 port 67 interval 3 \
(xid=0x6769e42a)&lt;/div&gt;&lt;div&gt;DHCPREQUEST of 192.168.80.27 on ens11 to 255.255.255.255 \
port 67 (xid=0x2ae46967)&lt;/div&gt;&lt;div&gt;DHCPOFFER of 192.168.80.27 from \
192.168.80.254&lt;/div&gt;&lt;div&gt;DHCPACK of 192.168.80.27 from 192.168.80.254&lt;/div&gt;&lt;div&gt;bound \
to 192.168.80.27 -- renewal in 1407 \
seconds.&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Some additional info about the \
VM and network it's attached \
to&lt;/div&gt;&lt;div&gt;===========&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;[root@dragon dnsmasq]# \
virsh domiflist openstack-database-00&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;Interface   Type           \
Source        Model           \
MAC&lt;/div&gt;&lt;div&gt;------------------------------&lt;wbr&gt;-------------------------&lt;/div&gt;&lt;div&gt;vnet12 \
bridge        br20           virtio         52:54:00:6c:ce:b9&lt;/div&gt;&lt;div&gt;vnet13        \
network      VM_MGMT      rtl8139        52:54:00:7d:ca:87&lt;/div&gt;&lt;div&gt;vnet14        \
network      osc_mgmt     rtl8139        \
52:54:00:e2:4b:25&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@dragon dnsmasq]# virsh net-info \
osc_mgmt&lt;/div&gt;&lt;div&gt;Name:                 osc_mgmt&lt;/div&gt;&lt;div&gt;UUID:                 \
d93fe709-14ae-4a0e-8989-aeaa8&lt;wbr&gt;c76c513&lt;/div&gt;&lt;div&gt;Active:              \
yes&lt;/div&gt;&lt;div&gt;Persistent:        yes&lt;/div&gt;&lt;div&gt;Autostart:         \
yes&lt;/div&gt;&lt;div&gt;Bridge:              \
osc_mgmt&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;===========&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;What's \
strange is that the first VM seems to work correctly and gets an assigned address of \
192.168.80.1, but for some reason the others don't. Any \
ideas?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;br&gt;&lt;/div&gt;&lt;/div&gt;______________________________&lt;wbr&gt;_________________&lt;br&gt; \
libvirt-users mailing list&lt;br&gt; &lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
 &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20171025125014</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-10-25 12:50:14-0400</timestampReceived><subject>Re: [libvirt-users] Need to increase the rx and tx buffer size of my interface</subject><body>

On 10/25/2017 01:53 PM, Ashish Kurian wrote:
&gt; Dear Users/Developers,
&gt; 
&gt; I am using a KVM Ubuntu VM as a degrader to apply specific delays to
&gt; incoming packets. As the delay for my packets can be higher than 7.5
&gt; seconds, there is not enough buffer on my interface to buffer all the
&gt; packets. Therefore those overflowing packets are dropped in the machine and
&gt; not forwarded.
&gt; 
&gt; When I tried to use the command  ethtool -G ens8 rx 512 to increase the
&gt; buffer size, I get the following error.
&gt; 
&gt; Cannot set device ring parameters: Operation not permitted
&gt; 
&gt; I have kept the VM xml files as specified in the link :
&gt; https://libvirt.org/formatdomain.html. The value that I kept in my xml file
&gt; is as follows.
&gt; 
&gt; &lt;interface type='direct'&gt;
&gt;       &lt;mac address='52:54:00:72:f9:eb'/&gt;
&gt;       &lt;source dev='enp7s0f0' mode='vepa'/&gt;
&gt;       &lt;model type='virtio'/&gt;
&gt;       &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt; tx_queue_size='512'&gt;
&gt;       &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off' ufo='off'
&gt; mrg_rxbuf='off'/&gt;
&gt;       &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;       &lt;/driver&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08'
&gt; function='0x0'/&gt;
&gt;     &lt;/interface&gt;
&gt;     &lt;interface type='direct'&gt;
&gt;       &lt;mac address='52:54:00:00:b5:99'/&gt;
&gt;       &lt;source dev='enp7s0f1' mode='vepa'/&gt;
&gt;       &lt;model type='virtio'/&gt;
&gt;       &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt; tx_queue_size='512'&gt;
&gt;       &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off' ufo='off'
&gt; mrg_rxbuf='off'/&gt;
&gt;       &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;       &lt;/driver&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x09'
&gt; function='0x0'/&gt;

So what does the qemu command line look like? You can find it in either
libvirtd log or domain log.

http://wiki.libvirt.org/page/DebugLogs

Michal

</body></email><email><emailId>20171025150751</emailId><senderName>Ashish Kurian</senderName><senderEmail>ashishbnv@gmail.com</senderEmail><timestampReceived>2017-10-25 15:07:51-0400</timestampReceived><subject>Re: [libvirt-users] Need to increase the rx and tx buffer size of my interface</subject><body>

Hi Michal,

What I found was that when I restarted the machine and did a virsh edit
command to see the xml config, I see that it is was not actually changed.
This suggests why I saw 256 again after restarting.

So now I tried again to edit the xml via virsh edit command and used the
following to set the parameters.

&lt;driver name='qemu' txmode='iothread' ioeventfd='on' event_idx='off'
queues='1' rx_queue_size='512' tx_queue_size='512'&gt;
&lt;/driver&gt;

It was not accepted and I got the error saying :


error: XML document failed to validate against schema: Unable to validate
doc against /usr/share/libvirt/schemas/domain.rng
Extra element devices in interleave
Element domain failed to validate content

What does this imply? I have two more other interfaces and do I have to the
same to them also?

Btw, there are now logs generated now in the domain log or libvirtd log





Best Regards,
Ashish Kurian

On Wed, Oct 25, 2017 at 2:50 PM, Michal Privoznik &lt;mprivozn@redhat.com&gt;
wrote:

&gt; On 10/25/2017 01:53 PM, Ashish Kurian wrote:
&gt; &gt; Dear Users/Developers,
&gt; &gt;
&gt; &gt; I am using a KVM Ubuntu VM as a degrader to apply specific delays to
&gt; &gt; incoming packets. As the delay for my packets can be higher than 7.5
&gt; &gt; seconds, there is not enough buffer on my interface to buffer all the
&gt; &gt; packets. Therefore those overflowing packets are dropped in the machine
&gt; and
&gt; &gt; not forwarded.
&gt; &gt;
&gt; &gt; When I tried to use the command  ethtool -G ens8 rx 512 to increase the
&gt; &gt; buffer size, I get the following error.
&gt; &gt;
&gt; &gt; Cannot set device ring parameters: Operation not permitted
&gt; &gt;
&gt; &gt; I have kept the VM xml files as specified in the link :
&gt; &gt; https://libvirt.org/formatdomain.html. The value that I kept in my xml
&gt; file
&gt; &gt; is as follows.
&gt; &gt;
&gt; &gt; &lt;interface type='direct'&gt;
&gt; &gt;       &lt;mac address='52:54:00:72:f9:eb'/&gt;
&gt; &gt;       &lt;source dev='enp7s0f0' mode='vepa'/&gt;
&gt; &gt;       &lt;model type='virtio'/&gt;
&gt; &gt;       &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt; &gt; tx_queue_size='512'&gt;
&gt; &gt;       &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt; ufo='off'
&gt; &gt; mrg_rxbuf='off'/&gt;
&gt; &gt;       &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt; &gt;       &lt;/driver&gt;
&gt; &gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08'
&gt; &gt; function='0x0'/&gt;
&gt; &gt;     &lt;/interface&gt;
&gt; &gt;     &lt;interface type='direct'&gt;
&gt; &gt;       &lt;mac address='52:54:00:00:b5:99'/&gt;
&gt; &gt;       &lt;source dev='enp7s0f1' mode='vepa'/&gt;
&gt; &gt;       &lt;model type='virtio'/&gt;
&gt; &gt;       &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt; &gt; tx_queue_size='512'&gt;
&gt; &gt;       &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt; ufo='off'
&gt; &gt; mrg_rxbuf='off'/&gt;
&gt; &gt;       &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt; &gt;       &lt;/driver&gt;
&gt; &gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x09'
&gt; &gt; function='0x0'/&gt;
&gt;
&gt; So what does the qemu command line look like? You can find it in either
&gt; libvirtd log or domain log.
&gt;
&gt; http://wiki.libvirt.org/page/DebugLogs
&gt;
&gt; Michal
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi Michal,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What I found was that when I restarted \
the machine and did a virsh edit command to see the xml config, I see that it is was \
not actually changed. This suggests why I saw 256 again after \
restarting.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So now I tried again to edit the xml via virsh \
edit command and used the following to set the \
parameters.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;driver name='qemu' \
txmode='iothread' ioeventfd='on' event_idx='off' \
queues='1' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/driver&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It \
was not accepted and I got the error saying \
:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;error: XML document failed to validate \
against schema: Unable to validate doc against \
/usr/share/libvirt/schemas/domain.rng&lt;/div&gt;&lt;div&gt;Extra element devices in \
interleave&lt;/div&gt;&lt;div&gt;Element domain failed to validate \
content&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What does this imply? I have two more other \
interfaces and do I have to the same to them also?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Btw, \
there are now logs generated now in the domain log or libvirtd \
log&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div class="gmail_signature" \
data-smartmail="gmail_signature"&gt;Best Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Wed, Oct 25, 2017 at 2:50 PM, Michal Privoznik &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:mprivozn@redhat.com" \
target="_blank"&gt;mprivozn@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div class="HOEnZb"&gt;&lt;div class="h5"&gt;On 10/25/2017 01:53 PM, \
Ashish Kurian wrote:&lt;br&gt; &gt; Dear Users/Developers,&lt;br&gt;
&gt;&lt;br&gt;
&gt; I am using a KVM Ubuntu VM as a degrader to apply specific delays to&lt;br&gt;
&gt; incoming packets. As the delay for my packets can be higher than 7.5&lt;br&gt;
&gt; seconds, there is not enough buffer on my interface to buffer all the&lt;br&gt;
&gt; packets. Therefore those overflowing packets are dropped in the machine and&lt;br&gt;
&gt; not forwarded.&lt;br&gt;
&gt;&lt;br&gt;
&gt; When I tried to use the command   ethtool -G ens8 rx 512 to increase the&lt;br&gt;
&gt; buffer size, I get the following error.&lt;br&gt;
&gt;&lt;br&gt;
&gt; Cannot set device ring parameters: Operation not permitted&lt;br&gt;
&gt;&lt;br&gt;
&gt; I have kept the VM xml files as specified in the link :&lt;br&gt;
&gt; &lt;a href="https://libvirt.org/formatdomain.html" rel="noreferrer" \
target="_blank"&gt;https://libvirt.org/&lt;wbr&gt;formatdomain.html&lt;/a&gt;. The value that I kept \
in my xml file&lt;br&gt; &gt; is as follows.&lt;br&gt;
&gt;&lt;br&gt;
&gt; &lt;interface type='direct'&gt;&lt;br&gt;
&gt;           &lt;mac address='52:54:00:72:f9:eb'/&gt;&lt;br&gt;
&gt;           &lt;source dev='enp7s0f0' mode='vepa'/&gt;&lt;br&gt;
&gt;           &lt;model type='virtio'/&gt;&lt;br&gt;
&gt;           &lt;driver name='vhost' queues='5' \
rx_queue_size='512'&lt;br&gt; &gt; tx_queue_size='512'&gt;&lt;br&gt;
&gt;           &lt;host csum='off' gso='off' tso4='off' \
tso6='off' ecn='off' ufo='off'&lt;br&gt; &gt; \
mrg_rxbuf='off'/&gt;&lt;br&gt; &gt;           &lt;guest csum='off' \
tso4='off' tso6='off' ecn='off' ufo='off'/&gt;&lt;br&gt; \
&gt;           &lt;/driver&gt;&lt;br&gt; &gt;           &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x08'&lt;br&gt; &gt; \
function='0x0'/&gt;&lt;br&gt; &gt;        &lt;/interface&gt;&lt;br&gt;
&gt;        &lt;interface type='direct'&gt;&lt;br&gt;
&gt;           &lt;mac address='52:54:00:00:b5:99'/&gt;&lt;br&gt;
&gt;           &lt;source dev='enp7s0f1' mode='vepa'/&gt;&lt;br&gt;
&gt;           &lt;model type='virtio'/&gt;&lt;br&gt;
&gt;           &lt;driver name='vhost' queues='5' \
rx_queue_size='512'&lt;br&gt; &gt; tx_queue_size='512'&gt;&lt;br&gt;
&gt;           &lt;host csum='off' gso='off' tso4='off' \
tso6='off' ecn='off' ufo='off'&lt;br&gt; &gt; \
mrg_rxbuf='off'/&gt;&lt;br&gt; &gt;           &lt;guest csum='off' \
tso4='off' tso6='off' ecn='off' ufo='off'/&gt;&lt;br&gt; \
&gt;           &lt;/driver&gt;&lt;br&gt; &gt;           &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x09'&lt;br&gt; &gt; \
function='0x0'/&gt;&lt;br&gt; &lt;br&gt;
&lt;/div&gt;&lt;/div&gt;So what does the qemu command line look like? You can find it in \
either&lt;br&gt; libvirtd log or domain log.&lt;br&gt;
&lt;br&gt;
&lt;a href="http://wiki.libvirt.org/page/DebugLogs" rel="noreferrer" \
target="_blank"&gt;http://wiki.libvirt.org/page/&lt;wbr&gt;DebugLogs&lt;/a&gt;&lt;br&gt; &lt;span \
class="HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;br&gt; Michal&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20171025183342</emailId><senderName>Ashish Kurian</senderName><senderEmail>ashishbnv@gmail.com</senderEmail><timestampReceived>2017-10-25 18:33:42-0400</timestampReceived><subject>Re: [libvirt-users] Need to increase the rx and tx buffer size of my interface</subject><body>

Hi Michal,

An update to what I have already said : when I try adding &lt;driver
name='qemu' txmode='iothread' ioeventfd='on' event_idx='off' queues='1'
rx_queue_size='512' tx_queue_size='512'&gt; although it showed me the error as
mentioned, when I checked the xml again I saw that &lt;driver name='qemu'
txmode='iothread' ioeventfd='on' event_idx='off' &gt; is added to the
interface.

The missing parameters are : queues='1' rx_queue_size='512'
tx_queue_size='512'

Best Regards,
Ashish Kurian

On Wed, Oct 25, 2017 at 5:07 PM, Ashish Kurian &lt;ashishbnv@gmail.com&gt; wrote:

&gt; Hi Michal,
&gt;
&gt; What I found was that when I restarted the machine and did a virsh edit
&gt; command to see the xml config, I see that it is was not actually changed.
&gt; This suggests why I saw 256 again after restarting.
&gt;
&gt; So now I tried again to edit the xml via virsh edit command and used the
&gt; following to set the parameters.
&gt;
&gt; &lt;driver name='qemu' txmode='iothread' ioeventfd='on' event_idx='off'
&gt; queues='1' rx_queue_size='512' tx_queue_size='512'&gt;
&gt; &lt;/driver&gt;
&gt;
&gt; It was not accepted and I got the error saying :
&gt;
&gt;
&gt; error: XML document failed to validate against schema: Unable to validate
&gt; doc against /usr/share/libvirt/schemas/domain.rng
&gt; Extra element devices in interleave
&gt; Element domain failed to validate content
&gt;
&gt; What does this imply? I have two more other interfaces and do I have to
&gt; the same to them also?
&gt;
&gt; Btw, there are now logs generated now in the domain log or libvirtd log
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; Best Regards,
&gt; Ashish Kurian
&gt;
&gt; On Wed, Oct 25, 2017 at 2:50 PM, Michal Privoznik &lt;mprivozn@redhat.com&gt;
&gt; wrote:
&gt;
&gt;&gt; On 10/25/2017 01:53 PM, Ashish Kurian wrote:
&gt;&gt; &gt; Dear Users/Developers,
&gt;&gt; &gt;
&gt;&gt; &gt; I am using a KVM Ubuntu VM as a degrader to apply specific delays to
&gt;&gt; &gt; incoming packets. As the delay for my packets can be higher than 7.5
&gt;&gt; &gt; seconds, there is not enough buffer on my interface to buffer all the
&gt;&gt; &gt; packets. Therefore those overflowing packets are dropped in the machine
&gt;&gt; and
&gt;&gt; &gt; not forwarded.
&gt;&gt; &gt;
&gt;&gt; &gt; When I tried to use the command  ethtool -G ens8 rx 512 to increase the
&gt;&gt; &gt; buffer size, I get the following error.
&gt;&gt; &gt;
&gt;&gt; &gt; Cannot set device ring parameters: Operation not permitted
&gt;&gt; &gt;
&gt;&gt; &gt; I have kept the VM xml files as specified in the link :
&gt;&gt; &gt; https://libvirt.org/formatdomain.html. The value that I kept in my xml
&gt;&gt; file
&gt;&gt; &gt; is as follows.
&gt;&gt; &gt;
&gt;&gt; &gt; &lt;interface type='direct'&gt;
&gt;&gt; &gt;       &lt;mac address='52:54:00:72:f9:eb'/&gt;
&gt;&gt; &gt;       &lt;source dev='enp7s0f0' mode='vepa'/&gt;
&gt;&gt; &gt;       &lt;model type='virtio'/&gt;
&gt;&gt; &gt;       &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt;&gt; &gt; tx_queue_size='512'&gt;
&gt;&gt; &gt;       &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt; ufo='off'
&gt;&gt; &gt; mrg_rxbuf='off'/&gt;
&gt;&gt; &gt;       &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;&gt; &gt;       &lt;/driver&gt;
&gt;&gt; &gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08'
&gt;&gt; &gt; function='0x0'/&gt;
&gt;&gt; &gt;     &lt;/interface&gt;
&gt;&gt; &gt;     &lt;interface type='direct'&gt;
&gt;&gt; &gt;       &lt;mac address='52:54:00:00:b5:99'/&gt;
&gt;&gt; &gt;       &lt;source dev='enp7s0f1' mode='vepa'/&gt;
&gt;&gt; &gt;       &lt;model type='virtio'/&gt;
&gt;&gt; &gt;       &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt;&gt; &gt; tx_queue_size='512'&gt;
&gt;&gt; &gt;       &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt; ufo='off'
&gt;&gt; &gt; mrg_rxbuf='off'/&gt;
&gt;&gt; &gt;       &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;&gt; &gt;       &lt;/driver&gt;
&gt;&gt; &gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x09'
&gt;&gt; &gt; function='0x0'/&gt;
&gt;&gt;
&gt;&gt; So what does the qemu command line look like? You can find it in either
&gt;&gt; libvirtd log or domain log.
&gt;&gt;
&gt;&gt; http://wiki.libvirt.org/page/DebugLogs
&gt;&gt;
&gt;&gt; Michal
&gt;&gt;
&gt;
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi Michal,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;An update to what I have already said : \
when I try adding  &lt;span style="font-size:12.8px"&gt;&lt;driver name='qemu' \
txmode='iothread' ioeventfd='on' event_idx='off' \
queues='1' rx_queue_size='512' tx_queue_size='512'&gt; \
although it showed me the error as mentioned, when I checked the xml again I saw that \
&lt;/span&gt;&lt;span style="font-size:12.8px"&gt;&lt;driver name='qemu' \
txmode='iothread' ioeventfd='on' event_idx='off' &gt; is \
added to the interface.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;The \
missing parameters are :  &lt;/span&gt;&lt;span style="font-size:12.8px"&gt;queues='1' \
rx_queue_size='512' tx_queue_size='512'&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div class="gmail_signature" \
data-smartmail="gmail_signature"&gt;Best Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Wed, Oct 25, 2017 at 5:07 PM, Ashish Kurian &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:ashishbnv@gmail.com" \
target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Michal,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What I found was \
that when I restarted the machine and did a virsh edit command to see the xml config, \
I see that it is was not actually changed. This suggests why I saw 256 again after \
restarting.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So now I tried again to edit the xml via virsh \
edit command and used the following to set the \
parameters.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;driver name='qemu' \
txmode='iothread' ioeventfd='on' event_idx='off' \
queues='1' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/driver&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It \
was not accepted and I got the error saying \
:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;error: XML document failed to validate \
against schema: Unable to validate doc against \
/usr/share/libvirt/schemas/&lt;wbr&gt;domain.rng&lt;/div&gt;&lt;div&gt;Extra element devices in \
interleave&lt;/div&gt;&lt;div&gt;Element domain failed to validate \
content&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What does this imply? I have two more other \
interfaces and do I have to the same to them also?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Btw, \
there are now logs generated now in the domain log or libvirtd \
log&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_8788737298834798581gmail_signature" data-smartmail="gmail_signature"&gt;Best \
Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div class="h5"&gt; &lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Wed, Oct 25, 2017 at 2:50 PM, Michal Privoznik &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:mprivozn@redhat.com" \
target="_blank"&gt;mprivozn@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div class="m_8788737298834798581HOEnZb"&gt;&lt;div \
class="m_8788737298834798581h5"&gt;On 10/25/2017 01:53 PM, Ashish Kurian wrote:&lt;br&gt; &gt; \
Dear Users/Developers,&lt;br&gt; &gt;&lt;br&gt;
&gt; I am using a KVM Ubuntu VM as a degrader to apply specific delays to&lt;br&gt;
&gt; incoming packets. As the delay for my packets can be higher than 7.5&lt;br&gt;
&gt; seconds, there is not enough buffer on my interface to buffer all the&lt;br&gt;
&gt; packets. Therefore those overflowing packets are dropped in the machine and&lt;br&gt;
&gt; not forwarded.&lt;br&gt;
&gt;&lt;br&gt;
&gt; When I tried to use the command   ethtool -G ens8 rx 512 to increase the&lt;br&gt;
&gt; buffer size, I get the following error.&lt;br&gt;
&gt;&lt;br&gt;
&gt; Cannot set device ring parameters: Operation not permitted&lt;br&gt;
&gt;&lt;br&gt;
&gt; I have kept the VM xml files as specified in the link :&lt;br&gt;
&gt; &lt;a href="https://libvirt.org/formatdomain.html" rel="noreferrer" \
target="_blank"&gt;https://libvirt.org/formatdoma&lt;wbr&gt;in.html&lt;/a&gt;. The value that I kept \
in my xml file&lt;br&gt; &gt; is as follows.&lt;br&gt;
&gt;&lt;br&gt;
&gt; &lt;interface type='direct'&gt;&lt;br&gt;
&gt;           &lt;mac address='52:54:00:72:f9:eb'/&gt;&lt;br&gt;
&gt;           &lt;source dev='enp7s0f0' mode='vepa'/&gt;&lt;br&gt;
&gt;           &lt;model type='virtio'/&gt;&lt;br&gt;
&gt;           &lt;driver name='vhost' queues='5' \
rx_queue_size='512'&lt;br&gt; &gt; tx_queue_size='512'&gt;&lt;br&gt;
&gt;           &lt;host csum='off' gso='off' tso4='off' \
tso6='off' ecn='off' ufo='off'&lt;br&gt; &gt; \
mrg_rxbuf='off'/&gt;&lt;br&gt; &gt;           &lt;guest csum='off' \
tso4='off' tso6='off' ecn='off' ufo='off'/&gt;&lt;br&gt; \
&gt;           &lt;/driver&gt;&lt;br&gt; &gt;           &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x08'&lt;br&gt; &gt; \
function='0x0'/&gt;&lt;br&gt; &gt;        &lt;/interface&gt;&lt;br&gt;
&gt;        &lt;interface type='direct'&gt;&lt;br&gt;
&gt;           &lt;mac address='52:54:00:00:b5:99'/&gt;&lt;br&gt;
&gt;           &lt;source dev='enp7s0f1' mode='vepa'/&gt;&lt;br&gt;
&gt;           &lt;model type='virtio'/&gt;&lt;br&gt;
&gt;           &lt;driver name='vhost' queues='5' \
rx_queue_size='512'&lt;br&gt; &gt; tx_queue_size='512'&gt;&lt;br&gt;
&gt;           &lt;host csum='off' gso='off' tso4='off' \
tso6='off' ecn='off' ufo='off'&lt;br&gt; &gt; \
mrg_rxbuf='off'/&gt;&lt;br&gt; &gt;           &lt;guest csum='off' \
tso4='off' tso6='off' ecn='off' ufo='off'/&gt;&lt;br&gt; \
&gt;           &lt;/driver&gt;&lt;br&gt; &gt;           &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x09'&lt;br&gt; &gt; \
function='0x0'/&gt;&lt;br&gt; &lt;br&gt;
&lt;/div&gt;&lt;/div&gt;So what does the qemu command line look like? You can find it in \
either&lt;br&gt; libvirtd log or domain log.&lt;br&gt;
&lt;br&gt;
&lt;a href="http://wiki.libvirt.org/page/DebugLogs" rel="noreferrer" \
target="_blank"&gt;http://wiki.libvirt.org/page/D&lt;wbr&gt;ebugLogs&lt;/a&gt;&lt;br&gt; &lt;span \
class="m_8788737298834798581HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;br&gt; Michal&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20171026044530</emailId><senderName>Yalan Zhang</senderName><senderEmail>yalzhang@redhat.com</senderEmail><timestampReceived>2017-10-26 04:45:30-0400</timestampReceived><subject>Re: [libvirt-users] Need to increase the rx and tx buffer size of my interface</subject><body>

Hi Ashish,

I have tested with your xml in the first mail, and it works for
rx_queue_size(see
below).
multiqueue need to work with vhost backend driver. And when you set
"queues=1" it will ignored.

Please check your qemu-kvm-rhev package, should be newer than
qemu-kvm-rhev-2.9.0-16.el7_4.2
And the logs?

tx_queue_size='512' will not work in the guest with direct type interface,
in fact, no matter what you set, it will not work and guest will get the
default '256'.
We only support vhost-user backend to have more than 256. refer to
https://libvirt.org/formatdomain.html#elementsNICSEthernet

tx_queue_size
The optional tx_queue_size attribute controls the size of virtio ring for
each queue as described above. The default value is hypervisor dependent
and may change across its releases. Moreover, some hypervisors may pose
some restrictions on actual value. For instance, QEMU v2.9 requires value
to be a power of two from [256, 1024] range. In addition to that, this may
work only for a subset of interface types, e.g. aforementioned QEMU enables
this option only for vhostuser type. Since 3.7.0 (QEMU and KVM only)
multiqueue only supports vhost as backend driver.

# rpm -q libvirt qemu-kvm-rhev
libvirt-3.2.0-14.el7_4.3.x86_64
qemu-kvm-rhev-2.9.0-16.el7_4.9.x86_64

1. the xml as below
   &lt;interface type='direct'&gt;
      &lt;mac address='52:54:00:00:b5:99'/&gt;
      &lt;source dev='eno1' mode='vepa'/&gt;
      &lt;model type='virtio'/&gt;
      &lt;driver name='vhost' queues='5' rx_queue_size='512'
tx_queue_size='512'&gt;
        &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
ufo='off' mrg_rxbuf='off'/&gt;
        &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
      &lt;/driver&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
function='0x0'/&gt;
    &lt;/interface&gt;

2. after start the vm, check the qemu command line:
*-netdev
tap,fds=26:28:29:30:31,id=hostnet0,vhost=on,vhostfds=32:33:34:35:36*
-device
virtio-net-pci,csum=off,gso=off,host_tso4=off,host_tso6=off,host_ecn=off,host_ufo=off, \
mrg_rxbuf=off,guest_csum=off,guest_tso4=off,guest_tso6=off,guest_ecn=off,guest_ufo=off,
                
*mq=on,vectors=12,rx_queue_size=512,tx_queue_size=512*
,netdev=hostnet0,id=net0,mac=52:54:00:00:b5:99,bus=pci.0,addr=0x3

3. check on guest
# ethtool -g eth0
Ring parameters for eth0:
Pre-set maximums:
RX: *512 ==&gt; rx_queue_size works*
RX Mini: 0
RX Jumbo: 0
TX: *256   ===&gt; no change*
Current hardware settings:
RX: *512 **==&gt; rx_queue_size works*
RX Mini: 0
RX Jumbo: 0
TX: *256 ===&gt; no change*

# ethtool -l eth0
Channel parameters for eth0:
Pre-set maximums:
RX: 0
TX: 0
Other: 0
Combined: *5  ==&gt; queues what we set*
Current hardware settings:
RX: 0
TX: 0
Other: 0
Combined: 1


If change to qemu as driver,
# virsh edit rhel7
..
  &lt;interface type='direct'&gt;
      &lt;mac address='52:54:00:00:b5:99'/&gt;
      &lt;source dev='eno1' mode='vepa'/&gt;
      &lt;model type='virtio'/&gt;
      &lt;driver name='qemu' queues='5' rx_queue_size='512'
tx_queue_size='512'&gt;
        &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
ufo='off' mrg_rxbuf='off'/&gt;
        &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
      &lt;/driver&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
function='0x0'/&gt;
    &lt;/interface&gt;
..
Domain rhel7 XML configuration edited. ==&gt; the xml can validate and save

# virsh start rhel7
Domain rhel7 started


# virsh dumpxml rhel7 | grep /interface -B9
      &lt;source dev='eno1' mode='vepa'/&gt;
      &lt;target dev='macvtap0'/&gt;
      &lt;model type='virtio'/&gt;
      *&lt;driver name='qemu' queues='5' rx_queue_size='512'
tx_queue_size='512'&gt;*
        &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
ufo='off' mrg_rxbuf='off'/&gt;
        &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
      &lt;/driver&gt;
      &lt;alias name='net0'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
function='0x0'/&gt;
    &lt;/interface&gt;


* -netdev tap,fds=26:28:29:30:31*,id=hostnet0 -device
virtio-net-pci,csum=off,gso=off,host_tso4=off,host_tso6=off,host_ecn=off,host_ufo=off, \
mrg_rxbuf=off,guest_csum=off,guest_tso4=off,guest_tso6=off,guest_ecn=off,guest_ufo=off,
                
*rx_queue_size=512,tx_queue_size=512*
,netdev=hostnet0,id=net0,mac=52:54:00:00:b5:99,bus=pci.0,addr=0x3

*"mq=on,vectors=12" is missing*, indicates there is no multiqueue

and check on guest

# ethtool -l eth0
Channel parameters for eth0:
Pre-set maximums:
RX: 0
TX: 0
Other: 0
Combined: 1  ==&gt; no multiqueue
Current hardware settings:
RX: 0
TX: 0
Other: 0
Combined: 1

# ethtool -g eth0
Ring parameters for eth0:
Pre-set maximums:
RX: *512*
RX Mini: 0
RX Jumbo: 0
TX: 256
Current hardware settings:
RX: *512*
RX Mini: 0
RX Jumbo: 0
TX: 256




-------
Best Regards,
Yalan Zhang
IRC: yalzhang
Internal phone: 8389413

On Thu, Oct 26, 2017 at 2:33 AM, Ashish Kurian &lt;ashishbnv@gmail.com&gt; wrote:

&gt; Hi Michal,
&gt; 
&gt; An update to what I have already said : when I try adding &lt;driver
&gt; name='qemu' txmode='iothread' ioeventfd='on' event_idx='off' queues='1'
&gt; rx_queue_size='512' tx_queue_size='512'&gt; although it showed me the error as
&gt; mentioned, when I checked the xml again I saw that &lt;driver name='qemu'
&gt; txmode='iothread' ioeventfd='on' event_idx='off' &gt; is added to the
&gt; interface.
&gt; 
&gt; The missing parameters are : queues='1' rx_queue_size='512'
&gt; tx_queue_size='512'
&gt; 
&gt; Best Regards,
&gt; Ashish Kurian
&gt; 
&gt; On Wed, Oct 25, 2017 at 5:07 PM, Ashish Kurian &lt;ashishbnv@gmail.com&gt;
&gt; wrote:
&gt; 
&gt; &gt; Hi Michal,
&gt; &gt; 
&gt; &gt; What I found was that when I restarted the machine and did a virsh edit
&gt; &gt; command to see the xml config, I see that it is was not actually changed.
&gt; &gt; This suggests why I saw 256 again after restarting.
&gt; &gt; 
&gt; &gt; So now I tried again to edit the xml via virsh edit command and used the
&gt; &gt; following to set the parameters.
&gt; &gt; 
&gt; &gt; &lt;driver name='qemu' txmode='iothread' ioeventfd='on' event_idx='off'
&gt; &gt; queues='1' rx_queue_size='512' tx_queue_size='512'&gt;
&gt; &gt; &lt;/driver&gt;
&gt; &gt; 
&gt; &gt; It was not accepted and I got the error saying :
&gt; &gt; 
&gt; &gt; 
&gt; &gt; error: XML document failed to validate against schema: Unable to validate
&gt; &gt; doc against /usr/share/libvirt/schemas/domain.rng
&gt; &gt; Extra element devices in interleave
&gt; &gt; Element domain failed to validate content
&gt; &gt; 
&gt; &gt; What does this imply? I have two more other interfaces and do I have to
&gt; &gt; the same to them also?
&gt; &gt; 
&gt; &gt; Btw, there are now logs generated now in the domain log or libvirtd log
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; Best Regards,
&gt; &gt; Ashish Kurian
&gt; &gt; 
&gt; &gt; On Wed, Oct 25, 2017 at 2:50 PM, Michal Privoznik &lt;mprivozn@redhat.com&gt;
&gt; &gt; wrote:
&gt; &gt; 
&gt; &gt; &gt; On 10/25/2017 01:53 PM, Ashish Kurian wrote:
&gt; &gt; &gt; &gt; Dear Users/Developers,
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; I am using a KVM Ubuntu VM as a degrader to apply specific delays to
&gt; &gt; &gt; &gt; incoming packets. As the delay for my packets can be higher than 7.5
&gt; &gt; &gt; &gt; seconds, there is not enough buffer on my interface to buffer all the
&gt; &gt; &gt; &gt; packets. Therefore those overflowing packets are dropped in the
&gt; &gt; &gt; machine and
&gt; &gt; &gt; &gt; not forwarded.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; When I tried to use the command  ethtool -G ens8 rx 512 to increase the
&gt; &gt; &gt; &gt; buffer size, I get the following error.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Cannot set device ring parameters: Operation not permitted
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; I have kept the VM xml files as specified in the link :
&gt; &gt; &gt; &gt; https://libvirt.org/formatdomain.html. The value that I kept in my
&gt; &gt; &gt; xml file
&gt; &gt; &gt; &gt; is as follows.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &lt;interface type='direct'&gt;
&gt; &gt; &gt; &gt; &lt;mac address='52:54:00:72:f9:eb'/&gt;
&gt; &gt; &gt; &gt; &lt;source dev='enp7s0f0' mode='vepa'/&gt;
&gt; &gt; &gt; &gt; &lt;model type='virtio'/&gt;
&gt; &gt; &gt; &gt; &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt; &gt; &gt; &gt; tx_queue_size='512'&gt;
&gt; &gt; &gt; &gt; &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt; &gt; &gt; ufo='off'
&gt; &gt; &gt; &gt; mrg_rxbuf='off'/&gt;
&gt; &gt; &gt; &gt; &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt; &gt; &gt; &gt; &lt;/driver&gt;
&gt; &gt; &gt; &gt; &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08'
&gt; &gt; &gt; &gt; function='0x0'/&gt;
&gt; &gt; &gt; &gt; &lt;/interface&gt;
&gt; &gt; &gt; &gt; &lt;interface type='direct'&gt;
&gt; &gt; &gt; &gt; &lt;mac address='52:54:00:00:b5:99'/&gt;
&gt; &gt; &gt; &gt; &lt;source dev='enp7s0f1' mode='vepa'/&gt;
&gt; &gt; &gt; &gt; &lt;model type='virtio'/&gt;
&gt; &gt; &gt; &gt; &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt; &gt; &gt; &gt; tx_queue_size='512'&gt;
&gt; &gt; &gt; &gt; &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt; &gt; &gt; ufo='off'
&gt; &gt; &gt; &gt; mrg_rxbuf='off'/&gt;
&gt; &gt; &gt; &gt; &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt; &gt; &gt; &gt; &lt;/driver&gt;
&gt; &gt; &gt; &gt; &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x09'
&gt; &gt; &gt; &gt; function='0x0'/&gt;
&gt; &gt; &gt; 
&gt; &gt; &gt; So what does the qemu command line look like? You can find it in either
&gt; &gt; &gt; libvirtd log or domain log.
&gt; &gt; &gt; 
&gt; &gt; &gt; http://wiki.libvirt.org/page/DebugLogs
&gt; &gt; &gt; 
&gt; &gt; &gt; Michal
&gt; &gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; 
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt; 


[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi Ashish,  &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I have tested with your xml in the \
first mail, and it works for  &lt;span style="font-size:12.8px"&gt;rx_queue_size(see \
below)&lt;/span&gt;.  &lt;/div&gt;&lt;div&gt;multiqueue need to work with vhost backend driver. And \
when you set "queues=1" it will ignored.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Please \
check your qemu-kvm-rhev package, should be newer than  &lt;span \
style="color:rgb(51,51,51);font-family:Arial,sans-serif;font-size:14px"&gt;qemu-kvm-rhev-2.9.0-16.&lt;wbr&gt;el7_4.2&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
color="#333333" face="Arial, sans-serif"&gt;&lt;span style="font-size:14px"&gt;And the \
logs?&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="color:rgb(51,51,51);font-family:Arial,sans-serif;font-size:14px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;tx_queue_size='512' \
will not work in the guest with direct type interface, in fact, no matter what you \
set, it will not work and guest will get the default '256'.  \
&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="color:rgb(0,0,0);white-space:pre-wrap"&gt;We only support \
vhost-user backend to have more than 256. &lt;/span&gt;refer to  &lt;a \
href="https://libvirt.org/formatdomain.html#elementsNICSEthernet" \
target="_blank"&gt;https://libvirt.org/&lt;wbr&gt;formatdomain.html#&lt;wbr&gt;elementsNICSEthernet&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;span \
style="font-family:LibvirtOverpassMono;font-weight:bold;color:rgb(0,0,0);font-size:medium"&gt;tx_queue_size&lt;/span&gt;&lt;/div&gt;&lt;dd \
style="margin-left:2em;margin-right:2em;margin-bottom:0.5em;color:rgb(0,0,0);font-family:LibvirtOverpass;font-size:medium"&gt;The \
optional  &lt;code style="font-family:LibvirtOverpassMono;background-color:rgb(238,238,238)"&gt;tx_queue_size&lt;/code&gt; \
&lt;wbr&gt;attribute controls the size of virtio ring for each queue as described above. \
The default value is hypervisor dependent and may change across its releases. \
Moreover, some hypervisors may pose some restrictions on actual value. For instance, \
QEMU v2.9 requires value to be a power of two from [256, 1024] range. In addition to \
that, this may work only for a subset of interface types, e.g. aforementioned QEMU \
enables this option only for  &lt;code \
style="font-family:LibvirtOverpassMono;background-color:rgb(238,238,238)"&gt;vhostuser&lt;/code&gt; \
type.  &lt;span class="gmail-m_843597909639990587gmail-since" \
style="color:rgb(60,133,124);font-style:italic;font-weight:bold"&gt;Since 3.7.0 (QEMU \
and KVM only)&lt;/span&gt;&lt;/dd&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;multiqueue only supports vhost as backend \
driver.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# rpm -q libvirt \
qemu-kvm-rhev&lt;/div&gt;&lt;div&gt;libvirt-3.2.0-14.el7_4.3.x86_64&lt;/div&gt;&lt;div&gt;qemu-kvm-rhev-2.9.0-16.el7_4.9.x86_64&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1. \
the xml as below&lt;/div&gt;&lt;div&gt;&lt;div&gt;     &lt;interface \
type='direct'&gt;&lt;/div&gt;&lt;div&gt;         &lt;mac \
address='52:54:00:00:b5:99'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;source \
dev='eno1' mode='vepa'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;model \
type='virtio'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;driver name='vhost' \
queues='5' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;/div&gt;&lt;div&gt;            &lt;host csum='off' \
gso='off' tso4='off' tso6='off' ecn='off' \
ufo='off' mrg_rxbuf='off'/&gt;&lt;/div&gt;&lt;div&gt;            &lt;guest \
csum='off' tso4='off' tso6='off' ecn='off' \
ufo='off'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;/driver&gt;&lt;/div&gt;&lt;div&gt;         \
&lt;address type='pci' domain='0x0000' bus='0x00' \
slot='0x03' function='0x0'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/interface&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2. after start the vm, check the \
qemu command line:&lt;/div&gt;&lt;div&gt;&lt;b&gt;-netdev \
tap,fds=26:28:29:30:31,id=hostnet0,vhost=on,vhostfds=32:33:34:35:36&lt;/b&gt; -device \
virtio-net-pci,csum=off,gso=off,host_tso4=off,host_tso6=off,host_ecn=off,host_ufo=off, \
mrg_rxbuf=off,guest_csum=off,guest_tso4=off,guest_tso6=off,guest_ecn=off,guest_ufo=off \
,&lt;b&gt;mq=on,vectors=12,rx_queue_size=512,tx_queue_size=512&lt;/b&gt;,netdev=hostnet0,id=net0,mac=52:54:00:00:b5:99,bus=pci.0,addr=0x3 \
&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3. check on guest&lt;/div&gt;&lt;div&gt;&lt;div&gt;# ethtool -g \
eth0&lt;/div&gt;&lt;div&gt;Ring parameters for eth0:&lt;/div&gt;&lt;div&gt;Pre-set \
maximums:&lt;/div&gt;&lt;div&gt;RX:&lt;span style="white-space:pre"&gt;		&lt;/span&gt;&lt;b&gt;512 ==&gt; \
rx_queue_size works&lt;/b&gt;&lt;/div&gt;&lt;div&gt;RX Mini:&lt;span \
style="white-space:pre"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;RX Jumbo:&lt;span \
style="white-space:pre"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre"&gt;		&lt;/span&gt;&lt;b&gt;256    ===&gt; no change&lt;/b&gt;&lt;/div&gt;&lt;div&gt;Current \
hardware settings:&lt;/div&gt;&lt;div&gt;RX:&lt;span style="white-space:pre"&gt;		&lt;/span&gt;&lt;b&gt;512  \
&lt;/b&gt;&lt;b&gt;==&gt; rx_queue_size works&lt;/b&gt;&lt;/div&gt;&lt;div&gt;RX Mini:&lt;span \
style="white-space:pre"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;RX Jumbo:&lt;span \
style="white-space:pre"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre"&gt;		&lt;/span&gt;&lt;b&gt;256 ===&gt; no \
change&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# ethtool -l eth0&lt;/div&gt;&lt;div&gt;Channel \
parameters for eth0:&lt;/div&gt;&lt;div&gt;Pre-set maximums:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Other:&lt;span \
style="white-space:pre"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Combined:&lt;span \
style="white-space:pre"&gt;	&lt;/span&gt;&lt;b&gt;5   ==&gt; queues what we \
set&lt;/b&gt;&lt;/div&gt;&lt;div&gt;Current hardware settings:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Other:&lt;span \
style="white-space:pre"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Combined:&lt;span \
style="white-space:pre"&gt;	&lt;/span&gt;1&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If \
change to qemu as driver,  &lt;/div&gt;&lt;div&gt;# virsh edit \
rhel7&lt;br&gt;&lt;/div&gt;&lt;div&gt;..&lt;/div&gt;&lt;div&gt;&lt;div&gt;   &lt;interface \
type='direct'&gt;&lt;/div&gt;&lt;div&gt;         &lt;mac \
address='52:54:00:00:b5:99'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;source \
dev='eno1' mode='vepa'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;model \
type='virtio'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;driver name='qemu' \
queues='5' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;/div&gt;&lt;div&gt;            &lt;host csum='off' \
gso='off' tso4='off' tso6='off' ecn='off' \
ufo='off' mrg_rxbuf='off'/&gt;&lt;/div&gt;&lt;div&gt;            &lt;guest \
csum='off' tso4='off' tso6='off' ecn='off' \
ufo='off'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;/driver&gt;&lt;/div&gt;&lt;div&gt;         \
&lt;address type='pci' domain='0x0000' bus='0x00' \
slot='0x03' function='0x0'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/interface&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;..&lt;/div&gt;&lt;div&gt;Domain rhel7 XML configuration \
edited. ==&gt; the xml can validate and save&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# \
virsh start rhel7&lt;/div&gt;&lt;div&gt;Domain rhel7 \
started&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# virsh dumpxml rhel7 | \
grep /interface -B9&lt;/div&gt;&lt;div&gt;         &lt;source dev='eno1' \
mode='vepa'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;target \
dev='macvtap0'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;model \
type='virtio'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;b&gt;&lt;driver name='qemu' \
queues='5' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;            &lt;host csum='off' \
gso='off' tso4='off' tso6='off' ecn='off' \
ufo='off' mrg_rxbuf='off'/&gt;&lt;/div&gt;&lt;div&gt;            &lt;guest \
csum='off' tso4='off' tso6='off' ecn='off' \
ufo='off'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;/driver&gt;&lt;/div&gt;&lt;div&gt;         \
&lt;alias name='net0'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x03' \
function='0x0'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/interface&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;  -netdev \
tap,fds=26:28:29:30:31&lt;/b&gt;,id=hostnet0 -device \
virtio-net-pci,csum=off,gso=off,host_tso4=off,host_tso6=off,host_ecn=off,host_ufo=off, \
mrg_rxbuf=off,guest_csum=off,guest_tso4=off,guest_tso6=off,guest_ecn=off,guest_ufo=off \
,&lt;b&gt;rx_queue_size=512,tx_queue_size=512&lt;/b&gt;,netdev=hostnet0,id=net0,mac=52:54:00:00:b5:99,bus=pci.0,addr=0x3&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;"mq=on,vectors=12" \
is missing&lt;/b&gt;, indicates there is no multiqueue&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;and \
check on guest&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# ethtool -l eth0&lt;/div&gt;&lt;div&gt;Channel \
parameters for eth0:&lt;/div&gt;&lt;div&gt;Pre-set maximums:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Other:&lt;span \
style="white-space:pre"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Combined:&lt;span \
style="white-space:pre"&gt;	&lt;/span&gt;1   ==&gt; no multiqueue&lt;/div&gt;&lt;div&gt;Current hardware \
settings:&lt;/div&gt;&lt;div&gt;RX:&lt;span style="white-space:pre"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Other:&lt;span \
style="white-space:pre"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Combined:&lt;span \
style="white-space:pre"&gt;	&lt;/span&gt;1&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;# ethtool -g \
eth0&lt;/div&gt;&lt;div&gt;Ring parameters for eth0:&lt;/div&gt;&lt;div&gt;Pre-set \
maximums:&lt;/div&gt;&lt;div&gt;RX:&lt;span style="white-space:pre"&gt;		&lt;/span&gt;&lt;b&gt;512&lt;/b&gt;&lt;/div&gt;&lt;div&gt;RX \
Mini:&lt;span style="white-space:pre"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;RX Jumbo:&lt;span \
style="white-space:pre"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre"&gt;		&lt;/span&gt;256&lt;/div&gt;&lt;div&gt;Current hardware \
settings:&lt;/div&gt;&lt;div&gt;RX:&lt;span style="white-space:pre"&gt;		&lt;/span&gt;&lt;b&gt;512&lt;/b&gt;&lt;/div&gt;&lt;div&gt;RX \
Mini:&lt;span style="white-space:pre"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;RX Jumbo:&lt;span \
style="white-space:pre"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre"&gt;		&lt;/span&gt;256&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div class="gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;br&gt;&lt;br&gt;-------&lt;br&gt;Best Regards,&lt;br&gt;Yalan \
Zhang&lt;br&gt;IRC: yalzhang&lt;br&gt;Internal phone: 8389413&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Thu, Oct 26, 2017 at 2:33 AM, Ashish Kurian &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:ashishbnv@gmail.com" \
target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Michal,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;An update to \
what I have already said : when I try adding  &lt;span \
style="font-size:12.8px"&gt;&lt;driver name='qemu' txmode='iothread' \
ioeventfd='on' event_idx='off' queues='1' \
rx_queue_size='512' tx_queue_size='512'&gt; although it showed me the \
error as mentioned, when I checked the xml again I saw that  &lt;/span&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;driver name='qemu' txmode='iothread' \
ioeventfd='on' event_idx='off' &gt; is added to the \
interface.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;The \
missing parameters are :  &lt;/span&gt;&lt;span style="font-size:12.8px"&gt;queues='1' \
rx_queue_size='512' tx_queue_size='512'&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_-212787898175025196gmail_signature" data-smartmail="gmail_signature"&gt;Best \
Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div class="h5"&gt; &lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Wed, Oct 25, 2017 at 5:07 PM, Ashish Kurian &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:ashishbnv@gmail.com" \
target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Michal,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What I found was \
that when I restarted the machine and did a virsh edit command to see the xml config, \
I see that it is was not actually changed. This suggests why I saw 256 again after \
restarting.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So now I tried again to edit the xml via virsh \
edit command and used the following to set the \
parameters.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;driver name='qemu' \
txmode='iothread' ioeventfd='on' event_idx='off' \
queues='1' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/driver&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It \
was not accepted and I got the error saying \
:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;error: XML document failed to validate \
against schema: Unable to validate doc against \
/usr/share/libvirt/schemas/dom&lt;wbr&gt;ain.rng&lt;/div&gt;&lt;div&gt;Extra element devices in \
interleave&lt;/div&gt;&lt;div&gt;Element domain failed to validate \
content&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What does this imply? I have two more other \
interfaces and do I have to the same to them also?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Btw, \
there are now logs generated now in the domain log or libvirtd \
log&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_-212787898175025196m_8788737298834798581gmail_signature" \
data-smartmail="gmail_signature"&gt;Best Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div \
class="m_-212787898175025196h5"&gt; &lt;br&gt;&lt;div class="gmail_quote"&gt;On Wed, Oct 25, 2017 at \
2:50 PM, Michal Privoznik &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:mprivozn@redhat.com" \
target="_blank"&gt;mprivozn@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div \
class="m_-212787898175025196m_8788737298834798581HOEnZb"&gt;&lt;div \
class="m_-212787898175025196m_8788737298834798581h5"&gt;On 10/25/2017 01:53 PM, Ashish \
Kurian wrote:&lt;br&gt; &gt; Dear Users/Developers,&lt;br&gt;
&gt;&lt;br&gt;
&gt; I am using a KVM Ubuntu VM as a degrader to apply specific delays to&lt;br&gt;
&gt; incoming packets. As the delay for my packets can be higher than 7.5&lt;br&gt;
&gt; seconds, there is not enough buffer on my interface to buffer all the&lt;br&gt;
&gt; packets. Therefore those overflowing packets are dropped in the machine and&lt;br&gt;
&gt; not forwarded.&lt;br&gt;
&gt;&lt;br&gt;
&gt; When I tried to use the command   ethtool -G ens8 rx 512 to increase the&lt;br&gt;
&gt; buffer size, I get the following error.&lt;br&gt;
&gt;&lt;br&gt;
&gt; Cannot set device ring parameters: Operation not permitted&lt;br&gt;
&gt;&lt;br&gt;
&gt; I have kept the VM xml files as specified in the link :&lt;br&gt;
&gt; &lt;a href="https://libvirt.org/formatdomain.html" rel="noreferrer" \
target="_blank"&gt;https://libvirt.org/formatdoma&lt;wbr&gt;in.html&lt;/a&gt;. The value that I kept \
in my xml file&lt;br&gt; &gt; is as follows.&lt;br&gt;
&gt;&lt;br&gt;
&gt; &lt;interface type='direct'&gt;&lt;br&gt;
&gt;           &lt;mac address='52:54:00:72:f9:eb'/&gt;&lt;br&gt;
&gt;           &lt;source dev='enp7s0f0' mode='vepa'/&gt;&lt;br&gt;
&gt;           &lt;model type='virtio'/&gt;&lt;br&gt;
&gt;           &lt;driver name='vhost' queues='5' \
rx_queue_size='512'&lt;br&gt; &gt; tx_queue_size='512'&gt;&lt;br&gt;
&gt;           &lt;host csum='off' gso='off' tso4='off' \
tso6='off' ecn='off' ufo='off'&lt;br&gt; &gt; \
mrg_rxbuf='off'/&gt;&lt;br&gt; &gt;           &lt;guest csum='off' \
tso4='off' tso6='off' ecn='off' ufo='off'/&gt;&lt;br&gt; \
&gt;           &lt;/driver&gt;&lt;br&gt; &gt;           &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x08'&lt;br&gt; &gt; \
function='0x0'/&gt;&lt;br&gt; &gt;        &lt;/interface&gt;&lt;br&gt;
&gt;        &lt;interface type='direct'&gt;&lt;br&gt;
&gt;           &lt;mac address='52:54:00:00:b5:99'/&gt;&lt;br&gt;
&gt;           &lt;source dev='enp7s0f1' mode='vepa'/&gt;&lt;br&gt;
&gt;           &lt;model type='virtio'/&gt;&lt;br&gt;
&gt;           &lt;driver name='vhost' queues='5' \
rx_queue_size='512'&lt;br&gt; &gt; tx_queue_size='512'&gt;&lt;br&gt;
&gt;           &lt;host csum='off' gso='off' tso4='off' \
tso6='off' ecn='off' ufo='off'&lt;br&gt; &gt; \
mrg_rxbuf='off'/&gt;&lt;br&gt; &gt;           &lt;guest csum='off' \
tso4='off' tso6='off' ecn='off' ufo='off'/&gt;&lt;br&gt; \
&gt;           &lt;/driver&gt;&lt;br&gt; &gt;           &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x09'&lt;br&gt; &gt; \
function='0x0'/&gt;&lt;br&gt; &lt;br&gt;
&lt;/div&gt;&lt;/div&gt;So what does the qemu command line look like? You can find it in \
either&lt;br&gt; libvirtd log or domain log.&lt;br&gt;
&lt;br&gt;
&lt;a href="http://wiki.libvirt.org/page/DebugLogs" rel="noreferrer" \
target="_blank"&gt;http://wiki.libvirt.org/page/D&lt;wbr&gt;ebugLogs&lt;/a&gt;&lt;br&gt; &lt;span \
class="m_-212787898175025196m_8788737298834798581HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;br&gt; \
Michal&lt;br&gt; &lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;br&gt;______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;
&lt;a href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/&lt;wbr&gt;mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;




</body></email><email><emailId>20171026053009</emailId><senderName>Ashish Kurian</senderName><senderEmail>ashishbnv@gmail.com</senderEmail><timestampReceived>2017-10-26 05:30:09-0400</timestampReceived><subject>Re: [libvirt-users] Need to increase the rx and tx buffer size of my interface</subject><body>

Hi Yalan,

Thank you for your response. I do not have the following packages installed

vhost backend driver
qemu-kvm-rhev package

Are these packages available for free? How can I install them?

In my KVM VM, I must have an IP address to the interfaces that I am trying
to increasing the buffers. That is the reason I was using macvtap (direct
type interface). Is it possible to have my interfaces with an IP address
inside the VM to be bridged to the physical interfaces on the host?

Is it also a possibility that I change the rx and tx buffer on the physical
interface on the host and it is reflected automatically inside the VM as
you said it will always receive the default value of the host?


Best Regards,
Ashish Kurian

On Thu, Oct 26, 2017 at 6:45 AM, Yalan Zhang &lt;yalzhang@redhat.com&gt; wrote:

&gt; Hi Ashish,
&gt;
&gt; I have tested with your xml in the first mail, and it works for rx_queue_size(see
&gt; below).
&gt; multiqueue need to work with vhost backend driver. And when you set
&gt; "queues=1" it will ignored.
&gt;
&gt; Please check your qemu-kvm-rhev package, should be newer than
&gt; qemu-kvm-rhev-2.9.0-16.el7_4.2
&gt; And the logs?
&gt;
&gt; tx_queue_size='512' will not work in the guest with direct type interface,
&gt; in fact, no matter what you set, it will not work and guest will get the
&gt; default '256'.
&gt; We only support vhost-user backend to have more than 256. refer to
&gt; https://libvirt.org/formatdomain.html#elementsNICSEthernet
&gt;
&gt; tx_queue_size
&gt; The optional tx_queue_size attribute controls the size of virtio ring for
&gt; each queue as described above. The default value is hypervisor dependent
&gt; and may change across its releases. Moreover, some hypervisors may pose
&gt; some restrictions on actual value. For instance, QEMU v2.9 requires value
&gt; to be a power of two from [256, 1024] range. In addition to that, this may
&gt; work only for a subset of interface types, e.g. aforementioned QEMU enables
&gt; this option only for vhostuser type. Since 3.7.0 (QEMU and KVM only)
&gt; multiqueue only supports vhost as backend driver.
&gt;
&gt; # rpm -q libvirt qemu-kvm-rhev
&gt; libvirt-3.2.0-14.el7_4.3.x86_64
&gt; qemu-kvm-rhev-2.9.0-16.el7_4.9.x86_64
&gt;
&gt; 1. the xml as below
&gt;    &lt;interface type='direct'&gt;
&gt;       &lt;mac address='52:54:00:00:b5:99'/&gt;
&gt;       &lt;source dev='eno1' mode='vepa'/&gt;
&gt;       &lt;model type='virtio'/&gt;
&gt;       &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt; tx_queue_size='512'&gt;
&gt;         &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt; ufo='off' mrg_rxbuf='off'/&gt;
&gt;         &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;       &lt;/driver&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
&gt; function='0x0'/&gt;
&gt;     &lt;/interface&gt;
&gt;
&gt; 2. after start the vm, check the qemu command line:
&gt; *-netdev
&gt; tap,fds=26:28:29:30:31,id=hostnet0,vhost=on,vhostfds=32:33:34:35:36*
&gt; -device virtio-net-pci,csum=off,gso=off,host_tso4=off,host_tso6=
&gt; off,host_ecn=off,host_ufo=off,mrg_rxbuf=off,guest_csum=off,
&gt; guest_tso4=off,guest_tso6=off,guest_ecn=off,guest_ufo=off,
&gt; *mq=on,vectors=12,rx_queue_size=512,tx_queue_size=512*,netdev=
&gt; hostnet0,id=net0,mac=52:54:00:00:b5:99,bus=pci.0,addr=0x3
&gt;
&gt; 3. check on guest
&gt; # ethtool -g eth0
&gt; Ring parameters for eth0:
&gt; Pre-set maximums:
&gt; RX: *512 ==&gt; rx_queue_size works*
&gt; RX Mini: 0
&gt; RX Jumbo: 0
&gt; TX: *256   ===&gt; no change*
&gt; Current hardware settings:
&gt; RX: *512 **==&gt; rx_queue_size works*
&gt; RX Mini: 0
&gt; RX Jumbo: 0
&gt; TX: *256 ===&gt; no change*
&gt;
&gt; # ethtool -l eth0
&gt; Channel parameters for eth0:
&gt; Pre-set maximums:
&gt; RX: 0
&gt; TX: 0
&gt; Other: 0
&gt; Combined: *5  ==&gt; queues what we set*
&gt; Current hardware settings:
&gt; RX: 0
&gt; TX: 0
&gt; Other: 0
&gt; Combined: 1
&gt;
&gt;
&gt; If change to qemu as driver,
&gt; # virsh edit rhel7
&gt; ..
&gt;   &lt;interface type='direct'&gt;
&gt;       &lt;mac address='52:54:00:00:b5:99'/&gt;
&gt;       &lt;source dev='eno1' mode='vepa'/&gt;
&gt;       &lt;model type='virtio'/&gt;
&gt;       &lt;driver name='qemu' queues='5' rx_queue_size='512'
&gt; tx_queue_size='512'&gt;
&gt;         &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt; ufo='off' mrg_rxbuf='off'/&gt;
&gt;         &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;       &lt;/driver&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
&gt; function='0x0'/&gt;
&gt;     &lt;/interface&gt;
&gt; ..
&gt; Domain rhel7 XML configuration edited. ==&gt; the xml can validate and save
&gt;
&gt; # virsh start rhel7
&gt; Domain rhel7 started
&gt;
&gt;
&gt; # virsh dumpxml rhel7 | grep /interface -B9
&gt;       &lt;source dev='eno1' mode='vepa'/&gt;
&gt;       &lt;target dev='macvtap0'/&gt;
&gt;       &lt;model type='virtio'/&gt;
&gt;       *&lt;driver name='qemu' queues='5' rx_queue_size='512'
&gt; tx_queue_size='512'&gt;*
&gt;         &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt; ufo='off' mrg_rxbuf='off'/&gt;
&gt;         &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;       &lt;/driver&gt;
&gt;       &lt;alias name='net0'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
&gt; function='0x0'/&gt;
&gt;     &lt;/interface&gt;
&gt;
&gt;
&gt; * -netdev tap,fds=26:28:29:30:31*,id=hostnet0 -device
&gt; virtio-net-pci,csum=off,gso=off,host_tso4=off,host_tso6=
&gt; off,host_ecn=off,host_ufo=off,mrg_rxbuf=off,guest_csum=off,
&gt; guest_tso4=off,guest_tso6=off,guest_ecn=off,guest_ufo=off,
&gt; *rx_queue_size=512,tx_queue_size=512*,netdev=hostnet0,id=net0,
&gt; mac=52:54:00:00:b5:99,bus=pci.0,addr=0x3
&gt;
&gt; *"mq=on,vectors=12" is missing*, indicates there is no multiqueue
&gt;
&gt; and check on guest
&gt;
&gt; # ethtool -l eth0
&gt; Channel parameters for eth0:
&gt; Pre-set maximums:
&gt; RX: 0
&gt; TX: 0
&gt; Other: 0
&gt; Combined: 1  ==&gt; no multiqueue
&gt; Current hardware settings:
&gt; RX: 0
&gt; TX: 0
&gt; Other: 0
&gt; Combined: 1
&gt;
&gt; # ethtool -g eth0
&gt; Ring parameters for eth0:
&gt; Pre-set maximums:
&gt; RX: *512*
&gt; RX Mini: 0
&gt; RX Jumbo: 0
&gt; TX: 256
&gt; Current hardware settings:
&gt; RX: *512*
&gt; RX Mini: 0
&gt; RX Jumbo: 0
&gt; TX: 256
&gt;
&gt;
&gt;
&gt;
&gt; -------
&gt; Best Regards,
&gt; Yalan Zhang
&gt; IRC: yalzhang
&gt; Internal phone: 8389413
&gt;
&gt; On Thu, Oct 26, 2017 at 2:33 AM, Ashish Kurian &lt;ashishbnv@gmail.com&gt;
&gt; wrote:
&gt;
&gt;&gt; Hi Michal,
&gt;&gt;
&gt;&gt; An update to what I have already said : when I try adding &lt;driver
&gt;&gt; name='qemu' txmode='iothread' ioeventfd='on' event_idx='off' queues='1'
&gt;&gt; rx_queue_size='512' tx_queue_size='512'&gt; although it showed me the error as
&gt;&gt; mentioned, when I checked the xml again I saw that &lt;driver name='qemu'
&gt;&gt; txmode='iothread' ioeventfd='on' event_idx='off' &gt; is added to the
&gt;&gt; interface.
&gt;&gt;
&gt;&gt; The missing parameters are : queues='1' rx_queue_size='512'
&gt;&gt; tx_queue_size='512'
&gt;&gt;
&gt;&gt; Best Regards,
&gt;&gt; Ashish Kurian
&gt;&gt;
&gt;&gt; On Wed, Oct 25, 2017 at 5:07 PM, Ashish Kurian &lt;ashishbnv@gmail.com&gt;
&gt;&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; Hi Michal,
&gt;&gt;&gt;
&gt;&gt;&gt; What I found was that when I restarted the machine and did a virsh edit
&gt;&gt;&gt; command to see the xml config, I see that it is was not actually changed.
&gt;&gt;&gt; This suggests why I saw 256 again after restarting.
&gt;&gt;&gt;
&gt;&gt;&gt; So now I tried again to edit the xml via virsh edit command and used the
&gt;&gt;&gt; following to set the parameters.
&gt;&gt;&gt;
&gt;&gt;&gt; &lt;driver name='qemu' txmode='iothread' ioeventfd='on' event_idx='off'
&gt;&gt;&gt; queues='1' rx_queue_size='512' tx_queue_size='512'&gt;
&gt;&gt;&gt; &lt;/driver&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; It was not accepted and I got the error saying :
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; error: XML document failed to validate against schema: Unable to
&gt;&gt;&gt; validate doc against /usr/share/libvirt/schemas/domain.rng
&gt;&gt;&gt; Extra element devices in interleave
&gt;&gt;&gt; Element domain failed to validate content
&gt;&gt;&gt;
&gt;&gt;&gt; What does this imply? I have two more other interfaces and do I have to
&gt;&gt;&gt; the same to them also?
&gt;&gt;&gt;
&gt;&gt;&gt; Btw, there are now logs generated now in the domain log or libvirtd log
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Best Regards,
&gt;&gt;&gt; Ashish Kurian
&gt;&gt;&gt;
&gt;&gt;&gt; On Wed, Oct 25, 2017 at 2:50 PM, Michal Privoznik &lt;mprivozn@redhat.com&gt;
&gt;&gt;&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On 10/25/2017 01:53 PM, Ashish Kurian wrote:
&gt;&gt;&gt;&gt; &gt; Dear Users/Developers,
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; I am using a KVM Ubuntu VM as a degrader to apply specific delays to
&gt;&gt;&gt;&gt; &gt; incoming packets. As the delay for my packets can be higher than 7.5
&gt;&gt;&gt;&gt; &gt; seconds, there is not enough buffer on my interface to buffer all the
&gt;&gt;&gt;&gt; &gt; packets. Therefore those overflowing packets are dropped in the
&gt;&gt;&gt;&gt; machine and
&gt;&gt;&gt;&gt; &gt; not forwarded.
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; When I tried to use the command  ethtool -G ens8 rx 512 to increase
&gt;&gt;&gt;&gt; the
&gt;&gt;&gt;&gt; &gt; buffer size, I get the following error.
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; Cannot set device ring parameters: Operation not permitted
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; I have kept the VM xml files as specified in the link :
&gt;&gt;&gt;&gt; &gt; https://libvirt.org/formatdomain.html. The value that I kept in my
&gt;&gt;&gt;&gt; xml file
&gt;&gt;&gt;&gt; &gt; is as follows.
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; &lt;interface type='direct'&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;mac address='52:54:00:72:f9:eb'/&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;source dev='enp7s0f0' mode='vepa'/&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt;&gt;&gt;&gt; &gt; tx_queue_size='512'&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt; ufo='off'
&gt;&gt;&gt;&gt; &gt; mrg_rxbuf='off'/&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;/driver&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08'
&gt;&gt;&gt;&gt; &gt; function='0x0'/&gt;
&gt;&gt;&gt;&gt; &gt;     &lt;/interface&gt;
&gt;&gt;&gt;&gt; &gt;     &lt;interface type='direct'&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;mac address='52:54:00:00:b5:99'/&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;source dev='enp7s0f1' mode='vepa'/&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt;&gt;&gt;&gt; &gt; tx_queue_size='512'&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt; ufo='off'
&gt;&gt;&gt;&gt; &gt; mrg_rxbuf='off'/&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;/driver&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x09'
&gt;&gt;&gt;&gt; &gt; function='0x0'/&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; So what does the qemu command line look like? You can find it in either
&gt;&gt;&gt;&gt; libvirtd log or domain log.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; http://wiki.libvirt.org/page/DebugLogs
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Michal
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; libvirt-users mailing list
&gt;&gt; libvirt-users@redhat.com
&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;
&gt;
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi Yalan,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank you for your response. I do not \
have the following packages installed&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;vhost backend \
driver&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;qemu-kvm-rhev \
package&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;Are \
these packages available for free? How can I install them?&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;In my \
KVM VM, I must have an IP address to the interfaces that I am trying to increasing \
the buffers. That is the reason I was using macvtap (direct type interface). Is it \
possible to have my interfaces with an IP address inside the VM to be bridged to the \
physical interfaces on the host?  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;Is it \
also a possibility that I change the rx and tx buffer on the physical interface on \
the host and it is reflected automatically inside the VM as you said it will always \
receive the default value of the host?&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div class="gmail_signature" \
data-smartmail="gmail_signature"&gt;Best Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Thu, Oct 26, 2017 at 6:45 AM, Yalan Zhang &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:yalzhang@redhat.com" \
target="_blank"&gt;yalzhang@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Ashish,  &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I have tested \
with your xml in the first mail, and it works for  &lt;span \
style="font-size:12.8px"&gt;rx_queue_size(see below)&lt;/span&gt;.  &lt;/div&gt;&lt;div&gt;multiqueue need \
to work with vhost backend driver. And when you set "queues=1" it will \
ignored.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Please check your qemu-kvm-rhev package, should be \
newer than  &lt;span style="color:rgb(51,51,51);font-family:Arial,sans-serif;font-size:14px"&gt;qemu-kvm-rhev-2.9.0-16.el&lt;wbr&gt;7_4.2&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
color="#333333" face="Arial, sans-serif"&gt;&lt;span style="font-size:14px"&gt;And the \
logs?&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="color:rgb(51,51,51);font-family:Arial,sans-serif;font-size:14px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;tx_queue_size='512' \
will not work in the guest with direct type interface, in fact, no matter what you \
set, it will not work and guest will get the default '256'.  \
&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="color:rgb(0,0,0);white-space:pre-wrap"&gt;We only support \
vhost-user backend to have more than 256. &lt;/span&gt;refer to  &lt;a \
href="https://libvirt.org/formatdomain.html#elementsNICSEthernet" \
target="_blank"&gt;https://libvirt.org/formatd&lt;wbr&gt;omain.html#elementsNICSEtherne&lt;wbr&gt;t&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;span \
style="font-family:LibvirtOverpassMono;font-weight:bold;color:rgb(0,0,0);font-size:medium"&gt;tx_queue_size&lt;/span&gt;&lt;/div&gt;&lt;dd \
style="margin-left:2em;margin-right:2em;margin-bottom:0.5em;color:rgb(0,0,0);font-family:LibvirtOverpass;font-size:medium"&gt;The \
optional  &lt;code style="font-family:LibvirtOverpassMono;background-color:rgb(238,238,238)"&gt;tx_queue_size&lt;/code&gt; \
attribu&lt;wbr&gt;te controls the size of virtio ring for each queue as described above. \
The default value is hypervisor dependent and may change across its releases. \
Moreover, some hypervisors may pose some restrictions on actual value. For instance, \
QEMU v2.9 requires value to be a power of two from [256, 1024] range. In addition to \
that, this may work only for a subset of interface types, e.g. aforementioned QEMU \
enables this option only for  &lt;code \
style="font-family:LibvirtOverpassMono;background-color:rgb(238,238,238)"&gt;vhostuser&lt;/code&gt; \
type.  &lt;span class="m_-515258420855843595gmail-m_843597909639990587gmail-since" \
style="color:rgb(60,133,124);font-style:italic;font-weight:bold"&gt;Since 3.7.0 (QEMU \
and KVM only)&lt;/span&gt;&lt;/dd&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;multiqueue only supports vhost as backend \
driver.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# rpm -q libvirt \
qemu-kvm-rhev&lt;/div&gt;&lt;div&gt;libvirt-3.2.0-14.el7_4.3.x86_&lt;wbr&gt;64&lt;/div&gt;&lt;div&gt;qemu-kvm-rhev-2.9.0-16.el7_4.&lt;wbr&gt;9.x86_64&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1. \
the xml as below&lt;/div&gt;&lt;div&gt;&lt;span class=""&gt;&lt;div&gt;     &lt;interface \
type='direct'&gt;&lt;/div&gt;&lt;div&gt;         &lt;mac \
address='52:54:00:00:b5:99'/&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;         &lt;source \
dev='eno1' mode='vepa'/&gt;&lt;/div&gt;&lt;span class=""&gt;&lt;div&gt;         \
&lt;model type='virtio'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;driver \
name='vhost' queues='5' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;/div&gt;&lt;div&gt;            &lt;host csum='off' \
gso='off' tso4='off' tso6='off' ecn='off' \
ufo='off' mrg_rxbuf='off'/&gt;&lt;/div&gt;&lt;div&gt;            &lt;guest \
csum='off' tso4='off' tso6='off' ecn='off' \
ufo='off'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;/driver&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;         \
&lt;address type='pci' domain='0x0000' bus='0x00' \
slot='0x03' function='0x0'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/interface&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2. after start the vm, check the \
qemu command line:&lt;/div&gt;&lt;div&gt;&lt;b&gt;-netdev \
tap,fds=26:28:29:30:31,id=&lt;wbr&gt;hostnet0,vhost=on,vhostfds=32:&lt;wbr&gt;33:34:35:36&lt;/b&gt; \
-device virtio-net-pci,csum=off,gso=&lt;wbr&gt;off,host_tso4=off,host_tso6=&lt;wbr&gt;off,host_ecn \
=off,host_ufo=off,&lt;wbr&gt;mrg_rxbuf=off,guest_csum=off,&lt;wbr&gt;guest_tso4=off,guest_tso6=off \
,&lt;wbr&gt;guest_ecn=off,guest_ufo=off,&lt;b&gt;mq&lt;wbr&gt;=on,vectors=12,rx_queue_size=&lt;wbr&gt;512,tx_q \
ueue_size=512&lt;/b&gt;,netdev=&lt;wbr&gt;hostnet0,id=net0,mac=52:54:00:&lt;wbr&gt;00:b5:99,bus=pci.0,addr=0x3 \
&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3. check on guest&lt;/div&gt;&lt;div&gt;&lt;div&gt;# ethtool -g \
eth0&lt;/div&gt;&lt;div&gt;Ring parameters for eth0:&lt;/div&gt;&lt;div&gt;Pre-set \
maximums:&lt;/div&gt;&lt;div&gt;RX:&lt;span style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;512 ==&gt; \
rx_queue_size works&lt;/b&gt;&lt;/div&gt;&lt;span class=""&gt;&lt;div&gt;RX Mini:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;RX Jumbo:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;/span&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;256    ===&gt; no \
change&lt;/b&gt;&lt;/div&gt;&lt;div&gt;Current hardware settings:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;512  &lt;/b&gt;&lt;b&gt;==&gt; rx_queue_size \
works&lt;/b&gt;&lt;/div&gt;&lt;span class=""&gt;&lt;div&gt;RX Mini:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;RX Jumbo:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;/span&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;256 ===&gt; no \
change&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# ethtool -l eth0&lt;/div&gt;&lt;div&gt;Channel \
parameters for eth0:&lt;/div&gt;&lt;div&gt;Pre-set maximums:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Other:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Combined:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;&lt;b&gt;5   ==&gt; queues what we \
set&lt;/b&gt;&lt;/div&gt;&lt;div&gt;Current hardware settings:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Other:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Combined:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;1&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If \
change to qemu as driver,  &lt;/div&gt;&lt;div&gt;# virsh edit \
rhel7&lt;br&gt;&lt;/div&gt;&lt;div&gt;..&lt;/div&gt;&lt;div&gt;&lt;span class=""&gt;&lt;div&gt;   &lt;interface \
type='direct'&gt;&lt;/div&gt;&lt;div&gt;         &lt;mac \
address='52:54:00:00:b5:99'/&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;         &lt;source \
dev='eno1' mode='vepa'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;model \
type='virtio'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;driver name='qemu' \
queues='5' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;/div&gt;&lt;span class=""&gt;&lt;div&gt;            &lt;host \
csum='off' gso='off' tso4='off' tso6='off' \
ecn='off' ufo='off' mrg_rxbuf='off'/&gt;&lt;/div&gt;&lt;div&gt;           \
&lt;guest csum='off' tso4='off' tso6='off' ecn='off' \
ufo='off'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;/driver&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;         \
&lt;address type='pci' domain='0x0000' bus='0x00' \
slot='0x03' function='0x0'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/interface&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;..&lt;/div&gt;&lt;div&gt;Domain rhel7 XML configuration \
edited. ==&gt; the xml can validate and save&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# \
virsh start rhel7&lt;/div&gt;&lt;div&gt;Domain rhel7 \
started&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# virsh dumpxml rhel7 | \
grep /interface -B9&lt;/div&gt;&lt;div&gt;         &lt;source dev='eno1' \
mode='vepa'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;target \
dev='macvtap0'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;model \
type='virtio'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;b&gt;&lt;driver name='qemu' \
queues='5' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;/b&gt;&lt;/div&gt;&lt;span class=""&gt;&lt;div&gt;            &lt;host \
csum='off' gso='off' tso4='off' tso6='off' \
ecn='off' ufo='off' mrg_rxbuf='off'/&gt;&lt;/div&gt;&lt;div&gt;           \
&lt;guest csum='off' tso4='off' tso6='off' ecn='off' \
ufo='off'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;/driver&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;         \
&lt;alias name='net0'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x03' \
function='0x0'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/interface&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;  -netdev \
tap,fds=26:28:29:30:31&lt;/b&gt;,id=&lt;wbr&gt;hostnet0 -device \
virtio-net-pci,csum=off,gso=&lt;wbr&gt;off,host_tso4=off,host_tso6=&lt;wbr&gt;off,host_ecn=off,hos \
t_ufo=off,&lt;wbr&gt;mrg_rxbuf=off,guest_csum=off,&lt;wbr&gt;guest_tso4=off,guest_tso6=off,&lt;wbr&gt;gu \
est_ecn=off,guest_ufo=off,&lt;b&gt;rx&lt;wbr&gt;_queue_size=512,tx_queue_size=&lt;wbr&gt;512&lt;/b&gt;,netdev= \
hostnet0,id=net0,&lt;wbr&gt;mac=52:54:00:00:b5:99,bus=pci.&lt;wbr&gt;0,addr=0x3&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;"mq=on,vectors=12" \
is missing&lt;/b&gt;, indicates there is no multiqueue&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;and \
check on guest&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# ethtool -l eth0&lt;/div&gt;&lt;div&gt;Channel \
parameters for eth0:&lt;/div&gt;&lt;div&gt;Pre-set maximums:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Other:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Combined:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;1   ==&gt; no multiqueue&lt;/div&gt;&lt;div&gt;Current \
hardware settings:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Other:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Combined:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;1&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;# ethtool -g \
eth0&lt;/div&gt;&lt;div&gt;Ring parameters for eth0:&lt;/div&gt;&lt;div&gt;Pre-set \
maximums:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;512&lt;/b&gt;&lt;/div&gt;&lt;span class=""&gt;&lt;div&gt;RX \
Mini:&lt;span style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;RX Jumbo:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;256&lt;/div&gt;&lt;/span&gt;&lt;div&gt;Current hardware \
settings:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;512&lt;/b&gt;&lt;/div&gt;&lt;span class=""&gt;&lt;div&gt;RX \
Mini:&lt;span style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;RX Jumbo:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;256&lt;/div&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_-515258420855843595gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;br&gt;&lt;br&gt;-------&lt;br&gt;Best Regards,&lt;br&gt;Yalan \
Zhang&lt;br&gt;IRC: yalzhang&lt;br&gt;Internal phone: 8389413&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;div \
class="gmail_quote"&gt;&lt;div&gt;&lt;div class="h5"&gt;On Thu, Oct 26, 2017 at 2:33 AM, Ashish \
Kurian &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:ashishbnv@gmail.com" \
target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div&gt;&lt;div class="h5"&gt;&lt;div dir="ltr"&gt;Hi \
Michal,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;An update to what I have already said : when I try adding  \
&lt;span style="font-size:12.8px"&gt;&lt;driver name='qemu' \
txmode='iothread' ioeventfd='on' event_idx='off' \
queues='1' rx_queue_size='512' tx_queue_size='512'&gt; \
although it showed me the error as mentioned, when I checked the xml again I saw that \
&lt;/span&gt;&lt;span style="font-size:12.8px"&gt;&lt;driver name='qemu' \
txmode='iothread' ioeventfd='on' event_idx='off' &gt; is \
added to the interface.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;The \
missing parameters are :  &lt;/span&gt;&lt;span style="font-size:12.8px"&gt;queues='1' \
rx_queue_size='512' tx_queue_size='512'&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_-515258420855843595m_-212787898175025196gmail_signature" \
data-smartmail="gmail_signature"&gt;Best Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div \
class="m_-515258420855843595h5"&gt; &lt;br&gt;&lt;div class="gmail_quote"&gt;On Wed, Oct 25, 2017 at \
5:07 PM, Ashish Kurian &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:ashishbnv@gmail.com" \
target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Michal,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What I found was \
that when I restarted the machine and did a virsh edit command to see the xml config, \
I see that it is was not actually changed. This suggests why I saw 256 again after \
restarting.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So now I tried again to edit the xml via virsh \
edit command and used the following to set the \
parameters.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;driver name='qemu' \
txmode='iothread' ioeventfd='on' event_idx='off' \
queues='1' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/driver&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It \
was not accepted and I got the error saying \
:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;error: XML document failed to validate \
against schema: Unable to validate doc against \
/usr/share/libvirt/schemas/dom&lt;wbr&gt;ain.rng&lt;/div&gt;&lt;div&gt;Extra element devices in \
interleave&lt;/div&gt;&lt;div&gt;Element domain failed to validate \
content&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What does this imply? I have two more other \
interfaces and do I have to the same to them also?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Btw, \
there are now logs generated now in the domain log or libvirtd \
log&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_-515258420855843595m_-212787898175025196m_8788737298834798581gmail_signature" \
&lt;br&gt;&lt;div class="gmail_quote"&gt;On Wed, Oct 25, 2017 at 2:50 PM, Michal Privoznik &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:mprivozn@redhat.com" \
target="_blank"&gt;mprivozn@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div \
class="m_-515258420855843595m_-212787898175025196m_8788737298834798581HOEnZb"&gt;&lt;div \
class="m_-515258420855843595m_-212787898175025196m_8788737298834798581h5"&gt;On \
10/25/2017 01:53 PM, Ashish Kurian wrote:&lt;br&gt; &gt; Dear Users/Developers,&lt;br&gt;
&gt;&lt;br&gt;
&gt; I am using a KVM Ubuntu VM as a degrader to apply specific delays to&lt;br&gt;
&gt; incoming packets. As the delay for my packets can be higher than 7.5&lt;br&gt;
&gt; seconds, there is not enough buffer on my interface to buffer all the&lt;br&gt;
&gt; packets. Therefore those overflowing packets are dropped in the machine and&lt;br&gt;
&gt; not forwarded.&lt;br&gt;
&gt;&lt;br&gt;
&gt; When I tried to use the command   ethtool -G ens8 rx 512 to increase the&lt;br&gt;
&gt; buffer size, I get the following error.&lt;br&gt;
&gt;&lt;br&gt;
&gt; Cannot set device ring parameters: Operation not permitted&lt;br&gt;
&gt;&lt;br&gt;
&gt; I have kept the VM xml files as specified in the link :&lt;br&gt;
&gt; &lt;a href="https://libvirt.org/formatdomain.html" rel="noreferrer" \
target="_blank"&gt;https://libvirt.org/formatdoma&lt;wbr&gt;in.html&lt;/a&gt;. The value that I kept \
in my xml file&lt;br&gt; &gt; is as follows.&lt;br&gt;
&gt;&lt;br&gt;
&gt; &lt;interface type='direct'&gt;&lt;br&gt;
&gt;           &lt;mac address='52:54:00:72:f9:eb'/&gt;&lt;br&gt;
&gt;           &lt;source dev='enp7s0f0' mode='vepa'/&gt;&lt;br&gt;
&gt;           &lt;model type='virtio'/&gt;&lt;br&gt;
&gt;           &lt;driver name='vhost' queues='5' \
rx_queue_size='512'&lt;br&gt; &gt; tx_queue_size='512'&gt;&lt;br&gt;
&gt;           &lt;host csum='off' gso='off' tso4='off' \
tso6='off' ecn='off' ufo='off'&lt;br&gt; &gt; \
mrg_rxbuf='off'/&gt;&lt;br&gt; &gt;           &lt;guest csum='off' \
tso4='off' tso6='off' ecn='off' ufo='off'/&gt;&lt;br&gt; \
&gt;           &lt;/driver&gt;&lt;br&gt; &gt;           &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x08'&lt;br&gt; &gt; \
function='0x0'/&gt;&lt;br&gt; &gt;        &lt;/interface&gt;&lt;br&gt;
&gt;        &lt;interface type='direct'&gt;&lt;br&gt;
&gt;           &lt;mac address='52:54:00:00:b5:99'/&gt;&lt;br&gt;
&gt;           &lt;source dev='enp7s0f1' mode='vepa'/&gt;&lt;br&gt;
&gt;           &lt;model type='virtio'/&gt;&lt;br&gt;
&gt;           &lt;driver name='vhost' queues='5' \
rx_queue_size='512'&lt;br&gt; &gt; tx_queue_size='512'&gt;&lt;br&gt;
&gt;           &lt;host csum='off' gso='off' tso4='off' \
tso6='off' ecn='off' ufo='off'&lt;br&gt; &gt; \
mrg_rxbuf='off'/&gt;&lt;br&gt; &gt;           &lt;guest csum='off' \
tso4='off' tso6='off' ecn='off' ufo='off'/&gt;&lt;br&gt; \
&gt;           &lt;/driver&gt;&lt;br&gt; &gt;           &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x09'&lt;br&gt; &gt; \
function='0x0'/&gt;&lt;br&gt; &lt;br&gt;
&lt;/div&gt;&lt;/div&gt;So what does the qemu command line look like? You can find it in \
either&lt;br&gt; libvirtd log or domain log.&lt;br&gt;
&lt;br&gt;
&lt;a href="http://wiki.libvirt.org/page/DebugLogs" rel="noreferrer" \
target="_blank"&gt;http://wiki.libvirt.org/page/D&lt;wbr&gt;ebugLogs&lt;/a&gt;&lt;br&gt; &lt;span \
class="m_-515258420855843595m_-212787898175025196m_8788737298834798581HOEnZb"&gt;&lt;font \
color="#888888"&gt;&lt;br&gt; Michal&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;br&gt;&lt;/div&gt;&lt;/div&gt;______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
 &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20171026062244</emailId><senderName>Yalan Zhang</senderName><senderEmail>yalzhang@redhat.com</senderEmail><timestampReceived>2017-10-26 06:22:44-0400</timestampReceived><subject>Re: [libvirt-users] Need to increase the rx and tx buffer size of my interface</subject><body>

Hi Ashish,

Are these packages available for free? How can I install them?
=&gt; You did have vhost backend driver. Do not set &lt;driver name='qemu'...&gt;,
by default it will use vhost as backend driver.

 Is it possible to have my interfaces with an IP address inside the VM to
be bridged to the physical interfaces on the host?
=&gt; Yes, you can create a linux bridge with physical interface connected,
and use bridge type interface. Refer to https://libvirt.org/
formatdomain.html#elementsNICSBridge
direct type is also ok (but your host and guest have no access to each
other).

Is it also a possibility that I change the rx and tx buffer on the physical
interface on the host and it is reflected automatically inside the VM as
you said it will always receive the default value of the host?
=&gt; No, it do not receive the default value of the host. It's the default
value related with the virtual device driver on the guest.
hostdev type interface will passthrough the physical interface or VF of the
host to guest, it will get the device's parameters for rx and tx buffer.



-------
Best Regards,
Yalan Zhang
IRC: yalzhang
Internal phone: 8389413

On Thu, Oct 26, 2017 at 1:30 PM, Ashish Kurian &lt;ashishbnv@gmail.com&gt; wrote:

&gt; Hi Yalan,
&gt;
&gt; Thank you for your response. I do not have the following packages installed
&gt;
&gt; vhost backend driver
&gt; qemu-kvm-rhev package
&gt;
&gt; Are these packages available for free? How can I install them?
&gt;
&gt; In my KVM VM, I must have an IP address to the interfaces that I am trying
&gt; to increasing the buffers. That is the reason I was using macvtap (direct
&gt; type interface). Is it possible to have my interfaces with an IP address
&gt; inside the VM to be bridged to the physical interfaces on the host?
&gt;
&gt; Is it also a possibility that I change the rx and tx buffer on the
&gt; physical interface on the host and it is reflected automatically inside the
&gt; VM as you said it will always receive the default value of the host?
&gt;
&gt;
&gt; Best Regards,
&gt; Ashish Kurian
&gt;
&gt; On Thu, Oct 26, 2017 at 6:45 AM, Yalan Zhang &lt;yalzhang@redhat.com&gt; wrote:
&gt;
&gt;&gt; Hi Ashish,
&gt;&gt;
&gt;&gt; I have tested with your xml in the first mail, and it works for rx_queue_size(see
&gt;&gt; below).
&gt;&gt; multiqueue need to work with vhost backend driver. And when you set
&gt;&gt; "queues=1" it will ignored.
&gt;&gt;
&gt;&gt; Please check your qemu-kvm-rhev package, should be newer than
&gt;&gt; qemu-kvm-rhev-2.9.0-16.el7_4.2
&gt;&gt; And the logs?
&gt;&gt;
&gt;&gt; tx_queue_size='512' will not work in the guest with direct type
&gt;&gt; interface, in fact, no matter what you set, it will not work and guest will
&gt;&gt; get the default '256'.
&gt;&gt; We only support vhost-user backend to have more than 256. refer to
&gt;&gt; https://libvirt.org/formatdomain.html#elementsNICSEthernet
&gt;&gt;
&gt;&gt; tx_queue_size
&gt;&gt; The optional tx_queue_size attribute controls the size of virtio ring
&gt;&gt; for each queue as described above. The default value is hypervisor
&gt;&gt; dependent and may change across its releases. Moreover, some hypervisors
&gt;&gt; may pose some restrictions on actual value. For instance, QEMU v2.9
&gt;&gt; requires value to be a power of two from [256, 1024] range. In addition to
&gt;&gt; that, this may work only for a subset of interface types, e.g.
&gt;&gt; aforementioned QEMU enables this option only for vhostuser type. Since
&gt;&gt; 3.7.0 (QEMU and KVM only)
&gt;&gt; multiqueue only supports vhost as backend driver.
&gt;&gt;
&gt;&gt; # rpm -q libvirt qemu-kvm-rhev
&gt;&gt; libvirt-3.2.0-14.el7_4.3.x86_64
&gt;&gt; qemu-kvm-rhev-2.9.0-16.el7_4.9.x86_64
&gt;&gt;
&gt;&gt; 1. the xml as below
&gt;&gt;    &lt;interface type='direct'&gt;
&gt;&gt;       &lt;mac address='52:54:00:00:b5:99'/&gt;
&gt;&gt;       &lt;source dev='eno1' mode='vepa'/&gt;
&gt;&gt;       &lt;model type='virtio'/&gt;
&gt;&gt;       &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt;&gt; tx_queue_size='512'&gt;
&gt;&gt;         &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt; ufo='off' mrg_rxbuf='off'/&gt;
&gt;&gt;         &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;&gt;       &lt;/driver&gt;
&gt;&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
&gt;&gt; function='0x0'/&gt;
&gt;&gt;     &lt;/interface&gt;
&gt;&gt;
&gt;&gt; 2. after start the vm, check the qemu command line:
&gt;&gt; *-netdev
&gt;&gt; tap,fds=26:28:29:30:31,id=hostnet0,vhost=on,vhostfds=32:33:34:35:36*
&gt;&gt; -device virtio-net-pci,csum=off,gso=off,host_tso4=off,host_tso6=off,
&gt;&gt; host_ecn=off,host_ufo=off,mrg_rxbuf=off,guest_csum=off,guest
&gt;&gt; _tso4=off,guest_tso6=off,guest_ecn=off,guest_ufo=off,
&gt;&gt; *mq=on,vectors=12,rx_queue_size=512,tx_queue_size=512*,netdev=hostnet
&gt;&gt; 0,id=net0,mac=52:54:00:00:b5:99,bus=pci.0,addr=0x3
&gt;&gt;
&gt;&gt; 3. check on guest
&gt;&gt; # ethtool -g eth0
&gt;&gt; Ring parameters for eth0:
&gt;&gt; Pre-set maximums:
&gt;&gt; RX: *512 ==&gt; rx_queue_size works*
&gt;&gt; RX Mini: 0
&gt;&gt; RX Jumbo: 0
&gt;&gt; TX: *256   ===&gt; no change*
&gt;&gt; Current hardware settings:
&gt;&gt; RX: *512 **==&gt; rx_queue_size works*
&gt;&gt; RX Mini: 0
&gt;&gt; RX Jumbo: 0
&gt;&gt; TX: *256 ===&gt; no change*
&gt;&gt;
&gt;&gt; # ethtool -l eth0
&gt;&gt; Channel parameters for eth0:
&gt;&gt; Pre-set maximums:
&gt;&gt; RX: 0
&gt;&gt; TX: 0
&gt;&gt; Other: 0
&gt;&gt; Combined: *5  ==&gt; queues what we set*
&gt;&gt; Current hardware settings:
&gt;&gt; RX: 0
&gt;&gt; TX: 0
&gt;&gt; Other: 0
&gt;&gt; Combined: 1
&gt;&gt;
&gt;&gt;
&gt;&gt; If change to qemu as driver,
&gt;&gt; # virsh edit rhel7
&gt;&gt; ..
&gt;&gt;   &lt;interface type='direct'&gt;
&gt;&gt;       &lt;mac address='52:54:00:00:b5:99'/&gt;
&gt;&gt;       &lt;source dev='eno1' mode='vepa'/&gt;
&gt;&gt;       &lt;model type='virtio'/&gt;
&gt;&gt;       &lt;driver name='qemu' queues='5' rx_queue_size='512'
&gt;&gt; tx_queue_size='512'&gt;
&gt;&gt;         &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt; ufo='off' mrg_rxbuf='off'/&gt;
&gt;&gt;         &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;&gt;       &lt;/driver&gt;
&gt;&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
&gt;&gt; function='0x0'/&gt;
&gt;&gt;     &lt;/interface&gt;
&gt;&gt; ..
&gt;&gt; Domain rhel7 XML configuration edited. ==&gt; the xml can validate and save
&gt;&gt;
&gt;&gt; # virsh start rhel7
&gt;&gt; Domain rhel7 started
&gt;&gt;
&gt;&gt;
&gt;&gt; # virsh dumpxml rhel7 | grep /interface -B9
&gt;&gt;       &lt;source dev='eno1' mode='vepa'/&gt;
&gt;&gt;       &lt;target dev='macvtap0'/&gt;
&gt;&gt;       &lt;model type='virtio'/&gt;
&gt;&gt;       *&lt;driver name='qemu' queues='5' rx_queue_size='512'
&gt;&gt; tx_queue_size='512'&gt;*
&gt;&gt;         &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt; ufo='off' mrg_rxbuf='off'/&gt;
&gt;&gt;         &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;&gt;       &lt;/driver&gt;
&gt;&gt;       &lt;alias name='net0'/&gt;
&gt;&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
&gt;&gt; function='0x0'/&gt;
&gt;&gt;     &lt;/interface&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; * -netdev tap,fds=26:28:29:30:31*,id=hostnet0 -device
&gt;&gt; virtio-net-pci,csum=off,gso=off,host_tso4=off,host_tso6=off,
&gt;&gt; host_ecn=off,host_ufo=off,mrg_rxbuf=off,guest_csum=off,guest
&gt;&gt; _tso4=off,guest_tso6=off,guest_ecn=off,guest_ufo=off,
&gt;&gt; *rx_queue_size=512,tx_queue_size=512*,netdev=hostnet0,id=net0,mac=
&gt;&gt; 52:54:00:00:b5:99,bus=pci.0,addr=0x3
&gt;&gt;
&gt;&gt; *"mq=on,vectors=12" is missing*, indicates there is no multiqueue
&gt;&gt;
&gt;&gt; and check on guest
&gt;&gt;
&gt;&gt; # ethtool -l eth0
&gt;&gt; Channel parameters for eth0:
&gt;&gt; Pre-set maximums:
&gt;&gt; RX: 0
&gt;&gt; TX: 0
&gt;&gt; Other: 0
&gt;&gt; Combined: 1  ==&gt; no multiqueue
&gt;&gt; Current hardware settings:
&gt;&gt; RX: 0
&gt;&gt; TX: 0
&gt;&gt; Other: 0
&gt;&gt; Combined: 1
&gt;&gt;
&gt;&gt; # ethtool -g eth0
&gt;&gt; Ring parameters for eth0:
&gt;&gt; Pre-set maximums:
&gt;&gt; RX: *512*
&gt;&gt; RX Mini: 0
&gt;&gt; RX Jumbo: 0
&gt;&gt; TX: 256
&gt;&gt; Current hardware settings:
&gt;&gt; RX: *512*
&gt;&gt; RX Mini: 0
&gt;&gt; RX Jumbo: 0
&gt;&gt; TX: 256
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; -------
&gt;&gt; Best Regards,
&gt;&gt; Yalan Zhang
&gt;&gt; IRC: yalzhang
&gt;&gt; Internal phone: 8389413
&gt;&gt;
&gt;&gt; On Thu, Oct 26, 2017 at 2:33 AM, Ashish Kurian &lt;ashishbnv@gmail.com&gt;
&gt;&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; Hi Michal,
&gt;&gt;&gt;
&gt;&gt;&gt; An update to what I have already said : when I try adding &lt;driver
&gt;&gt;&gt; name='qemu' txmode='iothread' ioeventfd='on' event_idx='off' queues='1'
&gt;&gt;&gt; rx_queue_size='512' tx_queue_size='512'&gt; although it showed me the error as
&gt;&gt;&gt; mentioned, when I checked the xml again I saw that &lt;driver name='qemu'
&gt;&gt;&gt; txmode='iothread' ioeventfd='on' event_idx='off' &gt; is added to the
&gt;&gt;&gt; interface.
&gt;&gt;&gt;
&gt;&gt;&gt; The missing parameters are : queues='1' rx_queue_size='512'
&gt;&gt;&gt; tx_queue_size='512'
&gt;&gt;&gt;
&gt;&gt;&gt; Best Regards,
&gt;&gt;&gt; Ashish Kurian
&gt;&gt;&gt;
&gt;&gt;&gt; On Wed, Oct 25, 2017 at 5:07 PM, Ashish Kurian &lt;ashishbnv@gmail.com&gt;
&gt;&gt;&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi Michal,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; What I found was that when I restarted the machine and did a virsh edit
&gt;&gt;&gt;&gt; command to see the xml config, I see that it is was not actually changed.
&gt;&gt;&gt;&gt; This suggests why I saw 256 again after restarting.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; So now I tried again to edit the xml via virsh edit command and used
&gt;&gt;&gt;&gt; the following to set the parameters.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &lt;driver name='qemu' txmode='iothread' ioeventfd='on' event_idx='off'
&gt;&gt;&gt;&gt; queues='1' rx_queue_size='512' tx_queue_size='512'&gt;
&gt;&gt;&gt;&gt; &lt;/driver&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; It was not accepted and I got the error saying :
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; error: XML document failed to validate against schema: Unable to
&gt;&gt;&gt;&gt; validate doc against /usr/share/libvirt/schemas/domain.rng
&gt;&gt;&gt;&gt; Extra element devices in interleave
&gt;&gt;&gt;&gt; Element domain failed to validate content
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; What does this imply? I have two more other interfaces and do I have to
&gt;&gt;&gt;&gt; the same to them also?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Btw, there are now logs generated now in the domain log or libvirtd log
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Best Regards,
&gt;&gt;&gt;&gt; Ashish Kurian
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Wed, Oct 25, 2017 at 2:50 PM, Michal Privoznik &lt;mprivozn@redhat.com&gt;
&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On 10/25/2017 01:53 PM, Ashish Kurian wrote:
&gt;&gt;&gt;&gt;&gt; &gt; Dear Users/Developers,
&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt; &gt; I am using a KVM Ubuntu VM as a degrader to apply specific delays to
&gt;&gt;&gt;&gt;&gt; &gt; incoming packets. As the delay for my packets can be higher than 7.5
&gt;&gt;&gt;&gt;&gt; &gt; seconds, there is not enough buffer on my interface to buffer all the
&gt;&gt;&gt;&gt;&gt; &gt; packets. Therefore those overflowing packets are dropped in the
&gt;&gt;&gt;&gt;&gt; machine and
&gt;&gt;&gt;&gt;&gt; &gt; not forwarded.
&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt; &gt; When I tried to use the command  ethtool -G ens8 rx 512 to increase
&gt;&gt;&gt;&gt;&gt; the
&gt;&gt;&gt;&gt;&gt; &gt; buffer size, I get the following error.
&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt; &gt; Cannot set device ring parameters: Operation not permitted
&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt; &gt; I have kept the VM xml files as specified in the link :
&gt;&gt;&gt;&gt;&gt; &gt; https://libvirt.org/formatdomain.html. The value that I kept in my
&gt;&gt;&gt;&gt;&gt; xml file
&gt;&gt;&gt;&gt;&gt; &gt; is as follows.
&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt; &gt; &lt;interface type='direct'&gt;
&gt;&gt;&gt;&gt;&gt; &gt;       &lt;mac address='52:54:00:72:f9:eb'/&gt;
&gt;&gt;&gt;&gt;&gt; &gt;       &lt;source dev='enp7s0f0' mode='vepa'/&gt;
&gt;&gt;&gt;&gt;&gt; &gt;       &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt;&gt; &gt;       &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt;&gt;&gt;&gt;&gt; &gt; tx_queue_size='512'&gt;
&gt;&gt;&gt;&gt;&gt; &gt;       &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt;&gt; ufo='off'
&gt;&gt;&gt;&gt;&gt; &gt; mrg_rxbuf='off'/&gt;
&gt;&gt;&gt;&gt;&gt; &gt;       &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;&gt;&gt;&gt;&gt; &gt;       &lt;/driver&gt;
&gt;&gt;&gt;&gt;&gt; &gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08'
&gt;&gt;&gt;&gt;&gt; &gt; function='0x0'/&gt;
&gt;&gt;&gt;&gt;&gt; &gt;     &lt;/interface&gt;
&gt;&gt;&gt;&gt;&gt; &gt;     &lt;interface type='direct'&gt;
&gt;&gt;&gt;&gt;&gt; &gt;       &lt;mac address='52:54:00:00:b5:99'/&gt;
&gt;&gt;&gt;&gt;&gt; &gt;       &lt;source dev='enp7s0f1' mode='vepa'/&gt;
&gt;&gt;&gt;&gt;&gt; &gt;       &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt;&gt; &gt;       &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt;&gt;&gt;&gt;&gt; &gt; tx_queue_size='512'&gt;
&gt;&gt;&gt;&gt;&gt; &gt;       &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt;&gt; ufo='off'
&gt;&gt;&gt;&gt;&gt; &gt; mrg_rxbuf='off'/&gt;
&gt;&gt;&gt;&gt;&gt; &gt;       &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;&gt;&gt;&gt;&gt; &gt;       &lt;/driver&gt;
&gt;&gt;&gt;&gt;&gt; &gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x09'
&gt;&gt;&gt;&gt;&gt; &gt; function='0x0'/&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; So what does the qemu command line look like? You can find it in either
&gt;&gt;&gt;&gt;&gt; libvirtd log or domain log.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; http://wiki.libvirt.org/page/DebugLogs
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Michal
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt; libvirt-users mailing list
&gt;&gt;&gt; libvirt-users@redhat.com
&gt;&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi Ashish,  &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div style="font-size:12.8px"&gt;&lt;span \
style="font-size:12.8px"&gt;Are these packages available for free? How can I install \
them?&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;=&gt; You did have vhost backend driver. Do not set \
&lt;driver name='qemu'...&gt;, by default it will use vhost as backend \
driver.  &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;  Is it possible to \
have my interfaces with an IP address inside the VM to be bridged to the physical \
interfaces on the host?  &lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;=&gt; Yes, you can create a linux \
bridge with physical interface connected, and use bridge type interface. Refer to  &lt;a \
href="https://libvirt.org/formatdomain.html#elementsNICSBridge" \
target="_blank"&gt;https://libvirt.org/&lt;wbr&gt;formatdomain.html#&lt;wbr&gt;elementsNICSBridge&lt;/a&gt; \
&lt;br&gt;&lt;/div&gt;&lt;div&gt;direct type is also ok (but your host and guest have no access to each \
other).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div style="font-size:12.8px"&gt;&lt;span \
style="font-size:12.8px"&gt;Is it also a possibility that I change the rx and tx buffer \
on the physical interface on the host and it is reflected automatically inside the VM \
as you said it will always receive the default value of the \
host?&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;=&gt; No, it do not \
receive the default value of the host. It's the default value related with the \
virtual device driver on the guest.&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;hostdev type interface will passthrough the physical \
interface or VF of the host to guest, it will get the device's parameters for rx \
and tx buffer.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;div&gt;&lt;div class="m_-6540617163388826959gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;br&gt;-------&lt;br&gt;Best Regards,&lt;br&gt;Yalan Zhang&lt;br&gt;IRC: \
yalzhang&lt;br&gt;Internal phone: 8389413&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;div class="gmail_quote"&gt;On Thu, \
Oct 26, 2017 at 1:30 PM, Ashish Kurian &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:ashishbnv@gmail.com" target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; \
wrote:&lt;br&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px \
#ccc solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Yalan,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank you \
for your response. I do not have the following packages \
installed&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;vhost backend driver&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;qemu-kvm-rhev package&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;Are \
these packages available for free? How can I install them?&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;In my \
KVM VM, I must have an IP address to the interfaces that I am trying to increasing \
the buffers. That is the reason I was using macvtap (direct type interface). Is it \
possible to have my interfaces with an IP address inside the VM to be bridged to the \
physical interfaces on the host?  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;Is it \
also a possibility that I change the rx and tx buffer on the physical interface on \
the host and it is reflected automatically inside the VM as you said it will always \
receive the default value of the host?&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_-6540617163388826959m_5293176283835252071gmail_signature" \
data-smartmail="gmail_signature"&gt;Best Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div \
class="m_-6540617163388826959h5"&gt; &lt;br&gt;&lt;div class="gmail_quote"&gt;On Thu, Oct 26, 2017 \
at 6:45 AM, Yalan Zhang &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:yalzhang@redhat.com" \
target="_blank"&gt;yalzhang@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Ashish,  &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I have tested \
with your xml in the first mail, and it works for  &lt;span \
style="font-size:12.8px"&gt;rx_queue_size(see below)&lt;/span&gt;.  &lt;/div&gt;&lt;div&gt;multiqueue need \
to work with vhost backend driver. And when you set "queues=1" it will \
ignored.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Please check your qemu-kvm-rhev package, should be \
newer than  &lt;span style="color:rgb(51,51,51);font-family:Arial,sans-serif;font-size:14px"&gt;qemu-kvm-rhev-2.9.0-16.el&lt;wbr&gt;7_4.2&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
color="#333333" face="Arial, sans-serif"&gt;&lt;span style="font-size:14px"&gt;And the \
logs?&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="color:rgb(51,51,51);font-family:Arial,sans-serif;font-size:14px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;tx_queue_size='512' \
will not work in the guest with direct type interface, in fact, no matter what you \
set, it will not work and guest will get the default '256'.  \
&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="color:rgb(0,0,0);white-space:pre-wrap"&gt;We only support \
vhost-user backend to have more than 256. &lt;/span&gt;refer to  &lt;a \
href="https://libvirt.org/formatdomain.html#elementsNICSEthernet" \
target="_blank"&gt;https://libvirt.org/formatd&lt;wbr&gt;omain.html#elementsNICSEtherne&lt;wbr&gt;t&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;span \
style="font-family:LibvirtOverpassMono;font-weight:bold;color:rgb(0,0,0);font-size:medium"&gt;tx_queue_size&lt;/span&gt;&lt;/div&gt;&lt;dd \
style="margin-left:2em;margin-right:2em;margin-bottom:0.5em;color:rgb(0,0,0);font-family:LibvirtOverpass;font-size:medium"&gt;The \
optional  &lt;code style="font-family:LibvirtOverpassMono;background-color:rgb(238,238,238)"&gt;tx_queue_size&lt;/code&gt; \
attribu&lt;wbr&gt;te controls the size of virtio ring for each queue as described above. \
The default value is hypervisor dependent and may change across its releases. \
Moreover, some hypervisors may pose some restrictions on actual value. For instance, \
QEMU v2.9 requires value to be a power of two from [256, 1024] range. In addition to \
that, this may work only for a subset of interface types, e.g. aforementioned QEMU \
enables this option only for  &lt;code \
style="font-family:LibvirtOverpassMono;background-color:rgb(238,238,238)"&gt;vhostuser&lt;/code&gt; \
type.  &lt;span class="m_-6540617163388826959m_5293176283835252071m_-515258420855843595gmail-m_843597909639990587gmail-since" \
style="color:rgb(60,133,124);font-style:italic;font-weight:bold"&gt;Since 3.7.0 (QEMU \
and KVM only)&lt;/span&gt;&lt;/dd&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;multiqueue only supports vhost as backend \
driver.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# rpm -q libvirt \
qemu-kvm-rhev&lt;/div&gt;&lt;div&gt;libvirt-3.2.0-14.el7_4.3.x86_6&lt;wbr&gt;4&lt;/div&gt;&lt;div&gt;qemu-kvm-rhev-2.9.0-16.el7_4.9&lt;wbr&gt;.x86_64&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1. \
the xml as below&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;div&gt;     &lt;interface \
type='direct'&gt;&lt;/div&gt;&lt;div&gt;         &lt;mac \
address='52:54:00:00:b5:99'/&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;         &lt;source \
dev='eno1' mode='vepa'/&gt;&lt;/div&gt;&lt;span&gt;&lt;div&gt;         &lt;model \
type='virtio'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;driver name='vhost' \
queues='5' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;/div&gt;&lt;div&gt;            &lt;host csum='off' \
gso='off' tso4='off' tso6='off' ecn='off' \
ufo='off' mrg_rxbuf='off'/&gt;&lt;/div&gt;&lt;div&gt;            &lt;guest \
csum='off' tso4='off' tso6='off' ecn='off' \
ufo='off'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;/driver&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;         \
&lt;address type='pci' domain='0x0000' bus='0x00' \
slot='0x03' function='0x0'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/interface&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2. after start the vm, check the \
qemu command line:&lt;/div&gt;&lt;div&gt;&lt;b&gt;-netdev \
tap,fds=26:28:29:30:31,id=host&lt;wbr&gt;net0,vhost=on,vhostfds=32:33:3&lt;wbr&gt;4:35:36&lt;/b&gt; \
-device virtio-net-pci,csum=off,gso=of&lt;wbr&gt;f,host_tso4=off,host_tso6=off,&lt;wbr&gt;host_ecn \
=off,host_ufo=off,mrg_&lt;wbr&gt;rxbuf=off,guest_csum=off,guest&lt;wbr&gt;_tso4=off,guest_tso6=off \
,guest&lt;wbr&gt;_ecn=off,guest_ufo=off,&lt;b&gt;mq=on,v&lt;wbr&gt;ectors=12,rx_queue_size=512,tx&lt;wbr&gt;_q \
ueue_size=512&lt;/b&gt;,netdev=hostnet&lt;wbr&gt;0,id=net0,mac=52:54:00:00:b5:&lt;wbr&gt;99,bus=pci.0,addr=0x3 \
&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3. check on guest&lt;/div&gt;&lt;div&gt;&lt;div&gt;# ethtool -g \
eth0&lt;/div&gt;&lt;div&gt;Ring parameters for eth0:&lt;/div&gt;&lt;div&gt;Pre-set \
maximums:&lt;/div&gt;&lt;div&gt;RX:&lt;span style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;512 ==&gt; \
rx_queue_size works&lt;/b&gt;&lt;/div&gt;&lt;span&gt;&lt;div&gt;RX Mini:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;RX Jumbo:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;/span&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;256    ===&gt; no \
change&lt;/b&gt;&lt;/div&gt;&lt;div&gt;Current hardware settings:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;512  &lt;/b&gt;&lt;b&gt;==&gt; rx_queue_size \
works&lt;/b&gt;&lt;/div&gt;&lt;span&gt;&lt;div&gt;RX Mini:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;RX Jumbo:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;/span&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;256 ===&gt; no \
change&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# ethtool -l eth0&lt;/div&gt;&lt;div&gt;Channel \
parameters for eth0:&lt;/div&gt;&lt;div&gt;Pre-set maximums:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Other:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Combined:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;&lt;b&gt;5   ==&gt; queues what we \
set&lt;/b&gt;&lt;/div&gt;&lt;div&gt;Current hardware settings:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Other:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Combined:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;1&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If \
change to qemu as driver,  &lt;/div&gt;&lt;div&gt;# virsh edit \
rhel7&lt;br&gt;&lt;/div&gt;&lt;div&gt;..&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;div&gt;   &lt;interface \
type='direct'&gt;&lt;/div&gt;&lt;div&gt;         &lt;mac \
address='52:54:00:00:b5:99'/&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;         &lt;source \
dev='eno1' mode='vepa'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;model \
type='virtio'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;driver name='qemu' \
queues='5' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;/div&gt;&lt;span&gt;&lt;div&gt;            &lt;host \
csum='off' gso='off' tso4='off' tso6='off' \
ecn='off' ufo='off' mrg_rxbuf='off'/&gt;&lt;/div&gt;&lt;div&gt;           \
&lt;guest csum='off' tso4='off' tso6='off' ecn='off' \
ufo='off'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;/driver&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;         \
&lt;address type='pci' domain='0x0000' bus='0x00' \
slot='0x03' function='0x0'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/interface&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;..&lt;/div&gt;&lt;div&gt;Domain rhel7 XML configuration \
edited. ==&gt; the xml can validate and save&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# \
virsh start rhel7&lt;/div&gt;&lt;div&gt;Domain rhel7 \
started&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# virsh dumpxml rhel7 | \
grep /interface -B9&lt;/div&gt;&lt;div&gt;         &lt;source dev='eno1' \
mode='vepa'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;target \
dev='macvtap0'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;model \
type='virtio'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;b&gt;&lt;driver name='qemu' \
queues='5' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;/b&gt;&lt;/div&gt;&lt;span&gt;&lt;div&gt;            &lt;host \
csum='off' gso='off' tso4='off' tso6='off' \
ecn='off' ufo='off' mrg_rxbuf='off'/&gt;&lt;/div&gt;&lt;div&gt;           \
&lt;guest csum='off' tso4='off' tso6='off' ecn='off' \
ufo='off'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;/driver&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;         \
&lt;alias name='net0'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x03' \
function='0x0'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/interface&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;  -netdev \
tap,fds=26:28:29:30:31&lt;/b&gt;,id=host&lt;wbr&gt;net0 -device \
virtio-net-pci,csum=off,gso=of&lt;wbr&gt;f,host_tso4=off,host_tso6=off,&lt;wbr&gt;host_ecn=off,hos \
t_ufo=off,mrg_&lt;wbr&gt;rxbuf=off,guest_csum=off,guest&lt;wbr&gt;_tso4=off,guest_tso6=off,guest&lt;w \
br&gt;_ecn=off,guest_ufo=off,&lt;b&gt;rx_queu&lt;wbr&gt;e_size=512,tx_queue_size=512&lt;/b&gt;,&lt;wbr&gt;netdev= \
hostnet0,id=net0,mac=&lt;wbr&gt;52:54:00:00:b5:99,bus=pci.0,ad&lt;wbr&gt;dr=0x3&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;"mq=on,vectors=12" \
is missing&lt;/b&gt;, indicates there is no multiqueue&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;and \
check on guest&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# ethtool -l eth0&lt;/div&gt;&lt;div&gt;Channel \
parameters for eth0:&lt;/div&gt;&lt;div&gt;Pre-set maximums:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Other:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Combined:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;1   ==&gt; no multiqueue&lt;/div&gt;&lt;div&gt;Current \
hardware settings:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Other:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Combined:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;1&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;# ethtool -g \
eth0&lt;/div&gt;&lt;div&gt;Ring parameters for eth0:&lt;/div&gt;&lt;div&gt;Pre-set \
maximums:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;512&lt;/b&gt;&lt;/div&gt;&lt;span&gt;&lt;div&gt;RX Mini:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;RX Jumbo:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;256&lt;/div&gt;&lt;/span&gt;&lt;div&gt;Current hardware \
settings:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;512&lt;/b&gt;&lt;/div&gt;&lt;span&gt;&lt;div&gt;RX Mini:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;RX Jumbo:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;256&lt;/div&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_-6540617163388826959m_5293176283835252071m_-515258420855843595gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;br&gt;&lt;br&gt;-------&lt;br&gt;Best Regards,&lt;br&gt;Yalan \
Zhang&lt;br&gt;IRC: yalzhang&lt;br&gt;Internal phone: 8389413&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;div \
class="gmail_quote"&gt;&lt;div&gt;&lt;div \
class="m_-6540617163388826959m_5293176283835252071h5"&gt;On Thu, Oct 26, 2017 at 2:33 \
AM, Ashish Kurian &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:ashishbnv@gmail.com" \
target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div&gt;&lt;div \
class="m_-6540617163388826959m_5293176283835252071h5"&gt;&lt;div dir="ltr"&gt;Hi \
Michal,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;An update to what I have already said : when I try adding  \
&lt;span style="font-size:12.8px"&gt;&lt;driver name='qemu' \
txmode='iothread' ioeventfd='on' event_idx='off' \
queues='1' rx_queue_size='512' tx_queue_size='512'&gt; \
although it showed me the error as mentioned, when I checked the xml again I saw that \
&lt;/span&gt;&lt;span style="font-size:12.8px"&gt;&lt;driver name='qemu' \
txmode='iothread' ioeventfd='on' event_idx='off' &gt; is \
added to the interface.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
&lt;br&gt;&lt;div class="gmail_quote"&gt;On Wed, Oct 25, 2017 at 5:07 PM, Ashish Kurian &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:ashishbnv@gmail.com" \
target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Michal,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What I found was \
that when I restarted the machine and did a virsh edit command to see the xml config, \
I see that it is was not actually changed. This suggests why I saw 256 again after \
restarting.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So now I tried again to edit the xml via virsh \
edit command and used the following to set the \
parameters.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;driver name='qemu' \
txmode='iothread' ioeventfd='on' event_idx='off' \
queues='1' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/driver&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It \
was not accepted and I got the error saying \
:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;error: XML document failed to validate \
against schema: Unable to validate doc against \
/usr/share/libvirt/schemas/dom&lt;wbr&gt;ain.rng&lt;/div&gt;&lt;div&gt;Extra element devices in \
interleave&lt;/div&gt;&lt;div&gt;Element domain failed to validate \
content&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What does this imply? I have two more other \
interfaces and do I have to the same to them also?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Btw, \
there are now logs generated now in the domain log or libvirtd \
log&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_-6540617163388826959m_5293176283835252071m_-515258420855843595m_-212787898175025196m_8788737298834798581gmail_signature" \
data-smartmail="gmail_signature"&gt;Best Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div \
class="m_-6540617163388826959m_5293176283835252071m_-515258420855843595m_-212787898175025196h5"&gt;
 &lt;br&gt;&lt;div class="gmail_quote"&gt;On Wed, Oct 25, 2017 at 2:50 PM, Michal Privoznik &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:mprivozn@redhat.com" \
target="_blank"&gt;mprivozn@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div \
class="m_-6540617163388826959m_5293176283835252071m_-515258420855843595m_-212787898175025196m_8788737298834798581HOEnZb"&gt;&lt;div \
class="m_-6540617163388826959m_5293176283835252071m_-515258420855843595m_-212787898175025196m_8788737298834798581h5"&gt;On \
10/25/2017 01:53 PM, Ashish Kurian wrote:&lt;br&gt; &gt; Dear Users/Developers,&lt;br&gt;
&gt;&lt;br&gt;
&gt; I am using a KVM Ubuntu VM as a degrader to apply specific delays to&lt;br&gt;
&gt; incoming packets. As the delay for my packets can be higher than 7.5&lt;br&gt;
&gt; seconds, there is not enough buffer on my interface to buffer all the&lt;br&gt;
&gt; packets. Therefore those overflowing packets are dropped in the machine and&lt;br&gt;
&gt; not forwarded.&lt;br&gt;
&gt;&lt;br&gt;
&gt; When I tried to use the command   ethtool -G ens8 rx 512 to increase the&lt;br&gt;
&gt; buffer size, I get the following error.&lt;br&gt;
&gt;&lt;br&gt;
&gt; Cannot set device ring parameters: Operation not permitted&lt;br&gt;
&gt;&lt;br&gt;
&gt; I have kept the VM xml files as specified in the link :&lt;br&gt;
&gt; &lt;a href="https://libvirt.org/formatdomain.html" rel="noreferrer" \
target="_blank"&gt;https://libvirt.org/formatdoma&lt;wbr&gt;in.html&lt;/a&gt;. The value that I kept \
in my xml file&lt;br&gt; &gt; is as follows.&lt;br&gt;
&gt;&lt;br&gt;
&gt; &lt;interface type='direct'&gt;&lt;br&gt;
&gt;           &lt;mac address='52:54:00:72:f9:eb'/&gt;&lt;br&gt;
&gt;           &lt;source dev='enp7s0f0' mode='vepa'/&gt;&lt;br&gt;
&gt;           &lt;model type='virtio'/&gt;&lt;br&gt;
&gt;           &lt;driver name='vhost' queues='5' \
rx_queue_size='512'&lt;br&gt; &gt; tx_queue_size='512'&gt;&lt;br&gt;
&gt;           &lt;host csum='off' gso='off' tso4='off' \
tso6='off' ecn='off' ufo='off'&lt;br&gt; &gt; \
mrg_rxbuf='off'/&gt;&lt;br&gt; &gt;           &lt;guest csum='off' \
tso4='off' tso6='off' ecn='off' ufo='off'/&gt;&lt;br&gt; \
&gt;           &lt;/driver&gt;&lt;br&gt; &gt;           &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x08'&lt;br&gt; &gt; \
function='0x0'/&gt;&lt;br&gt; &gt;        &lt;/interface&gt;&lt;br&gt;
&gt;        &lt;interface type='direct'&gt;&lt;br&gt;
&gt;           &lt;mac address='52:54:00:00:b5:99'/&gt;&lt;br&gt;
&gt;           &lt;source dev='enp7s0f1' mode='vepa'/&gt;&lt;br&gt;
&gt;           &lt;model type='virtio'/&gt;&lt;br&gt;
&gt;           &lt;driver name='vhost' queues='5' \
rx_queue_size='512'&lt;br&gt; &gt; tx_queue_size='512'&gt;&lt;br&gt;
&gt;           &lt;host csum='off' gso='off' tso4='off' \
tso6='off' ecn='off' ufo='off'&lt;br&gt; &gt; \
mrg_rxbuf='off'/&gt;&lt;br&gt; &gt;           &lt;guest csum='off' \
tso4='off' tso6='off' ecn='off' ufo='off'/&gt;&lt;br&gt; \
&gt;           &lt;/driver&gt;&lt;br&gt; &gt;           &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x09'&lt;br&gt; &gt; \
function='0x0'/&gt;&lt;br&gt; &lt;br&gt;
&lt;/div&gt;&lt;/div&gt;So what does the qemu command line look like? You can find it in \
either&lt;br&gt; libvirtd log or domain log.&lt;br&gt;
&lt;br&gt;
&lt;a href="http://wiki.libvirt.org/page/DebugLogs" rel="noreferrer" \
target="_blank"&gt;http://wiki.libvirt.org/page/D&lt;wbr&gt;ebugLogs&lt;/a&gt;&lt;br&gt; &lt;span \
class="m_-6540617163388826959m_5293176283835252071m_-515258420855843595m_-212787898175025196m_8788737298834798581HOEnZb"&gt;&lt;font \
color="#888888"&gt;&lt;br&gt; Michal&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;br&gt;&lt;/div&gt;&lt;/div&gt;______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
 &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20171026073849</emailId><senderName>Ashish Kurian</senderName><senderEmail>ashishbnv@gmail.com</senderEmail><timestampReceived>2017-10-26 07:38:49-0400</timestampReceived><subject>Re: [libvirt-users] Need to increase the rx and tx buffer size of my interface</subject><body>

Hi Yalan,

In the previous email you mentioned "tx_queue_size='512' will not work in
the guest with direct type interface, in fact, no matter what you set, it
will not work and guest will get the default '256'. "

So if I am using macvtap for my interfaces, then the device type will
always be direct type. Does it mean that there is no way I can increase the
buffer size with the macvtap interfaces?



Best Regards,
Ashish Kurian

On Thu, Oct 26, 2017 at 9:04 AM, Ashish Kurian &lt;ashishbnv@gmail.com&gt; wrote:

&gt; Hi Yalan,
&gt;
&gt; Thank you for your comment on qemu-kvm-rhev
&gt;
&gt; I am waiting for a response about my previous email with the logs
&gt; attached. I do not understand what is the problem.
&gt;
&gt;
&gt; On Oct 26, 2017 8:58 AM, "Yalan Zhang" &lt;yalzhang@redhat.com&gt; wrote:
&gt;
&gt; Hi Ashish,
&gt;
&gt; Please never mind for qemu-kvm-rhev.
&gt; qemu with the code base 2.10.0 will support the tx_queue_size and
&gt; rx_queue_size.
&gt;
&gt; Thank you~
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; -------
&gt; Best Regards,
&gt; Yalan Zhang
&gt; IRC: yalzhang
&gt; Internal phone: 8389413
&gt;
&gt; On Thu, Oct 26, 2017 at 2:22 PM, Yalan Zhang &lt;yalzhang@redhat.com&gt; wrote:
&gt;
&gt;&gt; Hi Ashish,
&gt;&gt;
&gt;&gt; Are these packages available for free? How can I install them?
&gt;&gt; =&gt; You did have vhost backend driver. Do not set &lt;driver name='qemu'...&gt;,
&gt;&gt; by default it will use vhost as backend driver.
&gt;&gt;
&gt;&gt;  Is it possible to have my interfaces with an IP address inside the VM to
&gt;&gt; be bridged to the physical interfaces on the host?
&gt;&gt; =&gt; Yes, you can create a linux bridge with physical interface connected,
&gt;&gt; and use bridge type interface. Refer to https://libvirt.org/formatd
&gt;&gt; omain.html#elementsNICSBridge
&gt;&gt; direct type is also ok (but your host and guest have no access to each
&gt;&gt; other).
&gt;&gt;
&gt;&gt; Is it also a possibility that I change the rx and tx buffer on the
&gt;&gt; physical interface on the host and it is reflected automatically inside the
&gt;&gt; VM as you said it will always receive the default value of the host?
&gt;&gt; =&gt; No, it do not receive the default value of the host. It's the default
&gt;&gt; value related with the virtual device driver on the guest.
&gt;&gt; hostdev type interface will passthrough the physical interface or VF of
&gt;&gt; the host to guest, it will get the device's parameters for rx and tx buffer.
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; -------
&gt;&gt; Best Regards,
&gt;&gt; Yalan Zhang
&gt;&gt; IRC: yalzhang
&gt;&gt; Internal phone: 8389413
&gt;&gt;
&gt;&gt; On Thu, Oct 26, 2017 at 1:30 PM, Ashish Kurian &lt;ashishbnv@gmail.com&gt;
&gt;&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; Hi Yalan,
&gt;&gt;&gt;
&gt;&gt;&gt; Thank you for your response. I do not have the following packages
&gt;&gt;&gt; installed
&gt;&gt;&gt;
&gt;&gt;&gt; vhost backend driver
&gt;&gt;&gt; qemu-kvm-rhev package
&gt;&gt;&gt;
&gt;&gt;&gt; Are these packages available for free? How can I install them?
&gt;&gt;&gt;
&gt;&gt;&gt; In my KVM VM, I must have an IP address to the interfaces that I am
&gt;&gt;&gt; trying to increasing the buffers. That is the reason I was using macvtap
&gt;&gt;&gt; (direct type interface). Is it possible to have my interfaces with an IP
&gt;&gt;&gt; address inside the VM to be bridged to the physical interfaces on the host?
&gt;&gt;&gt;
&gt;&gt;&gt; Is it also a possibility that I change the rx and tx buffer on the
&gt;&gt;&gt; physical interface on the host and it is reflected automatically inside the
&gt;&gt;&gt; VM as you said it will always receive the default value of the host?
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Best Regards,
&gt;&gt;&gt; Ashish Kurian
&gt;&gt;&gt;
&gt;&gt;&gt; On Thu, Oct 26, 2017 at 6:45 AM, Yalan Zhang &lt;yalzhang@redhat.com&gt;
&gt;&gt;&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi Ashish,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I have tested with your xml in the first mail, and it works for rx_queue_size(see
&gt;&gt;&gt;&gt; below).
&gt;&gt;&gt;&gt; multiqueue need to work with vhost backend driver. And when you set
&gt;&gt;&gt;&gt; "queues=1" it will ignored.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Please check your qemu-kvm-rhev package, should be newer than
&gt;&gt;&gt;&gt; qemu-kvm-rhev-2.9.0-16.el7_4.2
&gt;&gt;&gt;&gt; And the logs?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; tx_queue_size='512' will not work in the guest with direct type
&gt;&gt;&gt;&gt; interface, in fact, no matter what you set, it will not work and guest will
&gt;&gt;&gt;&gt; get the default '256'.
&gt;&gt;&gt;&gt; We only support vhost-user backend to have more than 256. refer to
&gt;&gt;&gt;&gt; https://libvirt.org/formatdomain.html#elementsNICSEthernet
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; tx_queue_size
&gt;&gt;&gt;&gt; The optional tx_queue_size attribute controls the size of virtio ring
&gt;&gt;&gt;&gt; for each queue as described above. The default value is hypervisor
&gt;&gt;&gt;&gt; dependent and may change across its releases. Moreover, some hypervisors
&gt;&gt;&gt;&gt; may pose some restrictions on actual value. For instance, QEMU v2.9
&gt;&gt;&gt;&gt; requires value to be a power of two from [256, 1024] range. In addition to
&gt;&gt;&gt;&gt; that, this may work only for a subset of interface types, e.g.
&gt;&gt;&gt;&gt; aforementioned QEMU enables this option only for vhostuser type. Since
&gt;&gt;&gt;&gt; 3.7.0 (QEMU and KVM only)
&gt;&gt;&gt;&gt; multiqueue only supports vhost as backend driver.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; # rpm -q libvirt qemu-kvm-rhev
&gt;&gt;&gt;&gt; libvirt-3.2.0-14.el7_4.3.x86_64
&gt;&gt;&gt;&gt; qemu-kvm-rhev-2.9.0-16.el7_4.9.x86_64
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 1. the xml as below
&gt;&gt;&gt;&gt;    &lt;interface type='direct'&gt;
&gt;&gt;&gt;&gt;       &lt;mac address='52:54:00:00:b5:99'/&gt;
&gt;&gt;&gt;&gt;       &lt;source dev='eno1' mode='vepa'/&gt;
&gt;&gt;&gt;&gt;       &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt;       &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt;&gt;&gt;&gt; tx_queue_size='512'&gt;
&gt;&gt;&gt;&gt;         &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt; ufo='off' mrg_rxbuf='off'/&gt;
&gt;&gt;&gt;&gt;         &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;&gt;&gt;&gt;       &lt;/driver&gt;
&gt;&gt;&gt;&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
&gt;&gt;&gt;&gt; function='0x0'/&gt;
&gt;&gt;&gt;&gt;     &lt;/interface&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 2. after start the vm, check the qemu command line:
&gt;&gt;&gt;&gt; *-netdev
&gt;&gt;&gt;&gt; tap,fds=26:28:29:30:31,id=hostnet0,vhost=on,vhostfds=32:33:34:35:36*
&gt;&gt;&gt;&gt; -device virtio-net-pci,csum=off,gso=off,host_tso4=off,host_tso6=off,
&gt;&gt;&gt;&gt; host_ecn=off,host_ufo=off,mrg_rxbuf=off,guest_csum=off,guest
&gt;&gt;&gt;&gt; _tso4=off,guest_tso6=off,guest_ecn=off,guest_ufo=off,
&gt;&gt;&gt;&gt; *mq=on,vectors=12,rx_queue_size=512,tx_queue_size=512*,netdev=hostnet
&gt;&gt;&gt;&gt; 0,id=net0,mac=52:54:00:00:b5:99,bus=pci.0,addr=0x3
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 3. check on guest
&gt;&gt;&gt;&gt; # ethtool -g eth0
&gt;&gt;&gt;&gt; Ring parameters for eth0:
&gt;&gt;&gt;&gt; Pre-set maximums:
&gt;&gt;&gt;&gt; RX: *512 ==&gt; rx_queue_size works*
&gt;&gt;&gt;&gt; RX Mini: 0
&gt;&gt;&gt;&gt; RX Jumbo: 0
&gt;&gt;&gt;&gt; TX: *256   ===&gt; no change*
&gt;&gt;&gt;&gt; Current hardware settings:
&gt;&gt;&gt;&gt; RX: *512 **==&gt; rx_queue_size works*
&gt;&gt;&gt;&gt; RX Mini: 0
&gt;&gt;&gt;&gt; RX Jumbo: 0
&gt;&gt;&gt;&gt; TX: *256 ===&gt; no change*
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; # ethtool -l eth0
&gt;&gt;&gt;&gt; Channel parameters for eth0:
&gt;&gt;&gt;&gt; Pre-set maximums:
&gt;&gt;&gt;&gt; RX: 0
&gt;&gt;&gt;&gt; TX: 0
&gt;&gt;&gt;&gt; Other: 0
&gt;&gt;&gt;&gt; Combined: *5  ==&gt; queues what we set*
&gt;&gt;&gt;&gt; Current hardware settings:
&gt;&gt;&gt;&gt; RX: 0
&gt;&gt;&gt;&gt; TX: 0
&gt;&gt;&gt;&gt; Other: 0
&gt;&gt;&gt;&gt; Combined: 1
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; If change to qemu as driver,
&gt;&gt;&gt;&gt; # virsh edit rhel7
&gt;&gt;&gt;&gt; ..
&gt;&gt;&gt;&gt;   &lt;interface type='direct'&gt;
&gt;&gt;&gt;&gt;       &lt;mac address='52:54:00:00:b5:99'/&gt;
&gt;&gt;&gt;&gt;       &lt;source dev='eno1' mode='vepa'/&gt;
&gt;&gt;&gt;&gt;       &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt;       &lt;driver name='qemu' queues='5' rx_queue_size='512'
&gt;&gt;&gt;&gt; tx_queue_size='512'&gt;
&gt;&gt;&gt;&gt;         &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt; ufo='off' mrg_rxbuf='off'/&gt;
&gt;&gt;&gt;&gt;         &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;&gt;&gt;&gt;       &lt;/driver&gt;
&gt;&gt;&gt;&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
&gt;&gt;&gt;&gt; function='0x0'/&gt;
&gt;&gt;&gt;&gt;     &lt;/interface&gt;
&gt;&gt;&gt;&gt; ..
&gt;&gt;&gt;&gt; Domain rhel7 XML configuration edited. ==&gt; the xml can validate and save
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; # virsh start rhel7
&gt;&gt;&gt;&gt; Domain rhel7 started
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; # virsh dumpxml rhel7 | grep /interface -B9
&gt;&gt;&gt;&gt;       &lt;source dev='eno1' mode='vepa'/&gt;
&gt;&gt;&gt;&gt;       &lt;target dev='macvtap0'/&gt;
&gt;&gt;&gt;&gt;       &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt;       *&lt;driver name='qemu' queues='5' rx_queue_size='512'
&gt;&gt;&gt;&gt; tx_queue_size='512'&gt;*
&gt;&gt;&gt;&gt;         &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt; ufo='off' mrg_rxbuf='off'/&gt;
&gt;&gt;&gt;&gt;         &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;&gt;&gt;&gt;       &lt;/driver&gt;
&gt;&gt;&gt;&gt;       &lt;alias name='net0'/&gt;
&gt;&gt;&gt;&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
&gt;&gt;&gt;&gt; function='0x0'/&gt;
&gt;&gt;&gt;&gt;     &lt;/interface&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; * -netdev tap,fds=26:28:29:30:31*,id=hostnet0 -device
&gt;&gt;&gt;&gt; virtio-net-pci,csum=off,gso=off,host_tso4=off,host_tso6=off,
&gt;&gt;&gt;&gt; host_ecn=off,host_ufo=off,mrg_rxbuf=off,guest_csum=off,guest
&gt;&gt;&gt;&gt; _tso4=off,guest_tso6=off,guest_ecn=off,guest_ufo=off,
&gt;&gt;&gt;&gt; *rx_queue_size=512,tx_queue_size=512*,netdev=hostnet0,id=net0,mac=52:
&gt;&gt;&gt;&gt; 54:00:00:b5:99,bus=pci.0,addr=0x3
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; *"mq=on,vectors=12" is missing*, indicates there is no multiqueue
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; and check on guest
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; # ethtool -l eth0
&gt;&gt;&gt;&gt; Channel parameters for eth0:
&gt;&gt;&gt;&gt; Pre-set maximums:
&gt;&gt;&gt;&gt; RX: 0
&gt;&gt;&gt;&gt; TX: 0
&gt;&gt;&gt;&gt; Other: 0
&gt;&gt;&gt;&gt; Combined: 1  ==&gt; no multiqueue
&gt;&gt;&gt;&gt; Current hardware settings:
&gt;&gt;&gt;&gt; RX: 0
&gt;&gt;&gt;&gt; TX: 0
&gt;&gt;&gt;&gt; Other: 0
&gt;&gt;&gt;&gt; Combined: 1
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; # ethtool -g eth0
&gt;&gt;&gt;&gt; Ring parameters for eth0:
&gt;&gt;&gt;&gt; Pre-set maximums:
&gt;&gt;&gt;&gt; RX: *512*
&gt;&gt;&gt;&gt; RX Mini: 0
&gt;&gt;&gt;&gt; RX Jumbo: 0
&gt;&gt;&gt;&gt; TX: 256
&gt;&gt;&gt;&gt; Current hardware settings:
&gt;&gt;&gt;&gt; RX: *512*
&gt;&gt;&gt;&gt; RX Mini: 0
&gt;&gt;&gt;&gt; RX Jumbo: 0
&gt;&gt;&gt;&gt; TX: 256
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; -------
&gt;&gt;&gt;&gt; Best Regards,
&gt;&gt;&gt;&gt; Yalan Zhang
&gt;&gt;&gt;&gt; IRC: yalzhang
&gt;&gt;&gt;&gt; Internal phone: 8389413
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Thu, Oct 26, 2017 at 2:33 AM, Ashish Kurian &lt;ashishbnv@gmail.com&gt;
&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Hi Michal,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; An update to what I have already said : when I try adding &lt;driver
&gt;&gt;&gt;&gt;&gt; name='qemu' txmode='iothread' ioeventfd='on' event_idx='off' queues='1'
&gt;&gt;&gt;&gt;&gt; rx_queue_size='512' tx_queue_size='512'&gt; although it showed me the error as
&gt;&gt;&gt;&gt;&gt; mentioned, when I checked the xml again I saw that &lt;driver
&gt;&gt;&gt;&gt;&gt; name='qemu' txmode='iothread' ioeventfd='on' event_idx='off' &gt; is added to
&gt;&gt;&gt;&gt;&gt; the interface.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; The missing parameters are : queues='1' rx_queue_size='512'
&gt;&gt;&gt;&gt;&gt; tx_queue_size='512'
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Best Regards,
&gt;&gt;&gt;&gt;&gt; Ashish Kurian
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On Wed, Oct 25, 2017 at 5:07 PM, Ashish Kurian &lt;ashishbnv@gmail.com&gt;
&gt;&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Hi Michal,
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; What I found was that when I restarted the machine and did a virsh
&gt;&gt;&gt;&gt;&gt;&gt; edit command to see the xml config, I see that it is was not actually
&gt;&gt;&gt;&gt;&gt;&gt; changed. This suggests why I saw 256 again after restarting.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; So now I tried again to edit the xml via virsh edit command and used
&gt;&gt;&gt;&gt;&gt;&gt; the following to set the parameters.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; &lt;driver name='qemu' txmode='iothread' ioeventfd='on' event_idx='off'
&gt;&gt;&gt;&gt;&gt;&gt; queues='1' rx_queue_size='512' tx_queue_size='512'&gt;
&gt;&gt;&gt;&gt;&gt;&gt; &lt;/driver&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; It was not accepted and I got the error saying :
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; error: XML document failed to validate against schema: Unable to
&gt;&gt;&gt;&gt;&gt;&gt; validate doc against /usr/share/libvirt/schemas/domain.rng
&gt;&gt;&gt;&gt;&gt;&gt; Extra element devices in interleave
&gt;&gt;&gt;&gt;&gt;&gt; Element domain failed to validate content
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; What does this imply? I have two more other interfaces and do I have
&gt;&gt;&gt;&gt;&gt;&gt; to the same to them also?
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Btw, there are now logs generated now in the domain log or libvirtd
&gt;&gt;&gt;&gt;&gt;&gt; log
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Best Regards,
&gt;&gt;&gt;&gt;&gt;&gt; Ashish Kurian
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; On Wed, Oct 25, 2017 at 2:50 PM, Michal Privoznik &lt;
&gt;&gt;&gt;&gt;&gt;&gt; mprivozn@redhat.com&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; On 10/25/2017 01:53 PM, Ashish Kurian wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; Dear Users/Developers,
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; I am using a KVM Ubuntu VM as a degrader to apply specific delays
&gt;&gt;&gt;&gt;&gt;&gt;&gt; to
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; incoming packets. As the delay for my packets can be higher than
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 7.5
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; seconds, there is not enough buffer on my interface to buffer all
&gt;&gt;&gt;&gt;&gt;&gt;&gt; the
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; packets. Therefore those overflowing packets are dropped in the
&gt;&gt;&gt;&gt;&gt;&gt;&gt; machine and
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; not forwarded.
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; When I tried to use the command  ethtool -G ens8 rx 512 to
&gt;&gt;&gt;&gt;&gt;&gt;&gt; increase the
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; buffer size, I get the following error.
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; Cannot set device ring parameters: Operation not permitted
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; I have kept the VM xml files as specified in the link :
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; https://libvirt.org/formatdomain.html. The value that I kept in
&gt;&gt;&gt;&gt;&gt;&gt;&gt; my xml file
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; is as follows.
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; &lt;interface type='direct'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;mac address='52:54:00:72:f9:eb'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;source dev='enp7s0f0' mode='vepa'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; tx_queue_size='512'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt;&gt;&gt;&gt; ufo='off'
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; mrg_rxbuf='off'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;/driver&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08'
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; function='0x0'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;     &lt;/interface&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;     &lt;interface type='direct'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;mac address='52:54:00:00:b5:99'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;source dev='enp7s0f1' mode='vepa'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; tx_queue_size='512'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt;&gt;&gt;&gt; ufo='off'
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; mrg_rxbuf='off'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;/driver&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x09'
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; function='0x0'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; So what does the qemu command line look like? You can find it in
&gt;&gt;&gt;&gt;&gt;&gt;&gt; either
&gt;&gt;&gt;&gt;&gt;&gt;&gt; libvirtd log or domain log.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://wiki.libvirt.org/page/DebugLogs
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Michal
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt;&gt;&gt; libvirt-users mailing list
&gt;&gt;&gt;&gt;&gt; libvirt-users@redhat.com
&gt;&gt;&gt;&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi Yalan,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In the previous email you mentioned \
"&lt;span style="font-size:12.8px"&gt;tx_queue_size='512' will not work in the \
guest with direct type interface, in fact, no matter what you set, it will not work \
and guest will get the default '256'.  \
&lt;/span&gt;"&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So if I am using macvtap for my interfaces, \
then the device type will always be direct type. Does it mean that there is no way I \
can increase the buffer size with the macvtap \
interfaces?&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div class="gmail_signature" \
data-smartmail="gmail_signature"&gt;Best Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Thu, Oct 26, 2017 at 9:04 AM, Ashish Kurian &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:ashishbnv@gmail.com" \
target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="auto"&gt;Hi Yalan,&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
dir="auto"&gt;Thank you for your comment on qemu-kvm-rhev&lt;/div&gt;&lt;div \
dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;I am waiting for a response about my previous \
email with the logs attached. I do not understand what is the problem.&lt;/div&gt;&lt;div&gt;&lt;div \
class="h5"&gt;&lt;br&gt;&lt;div class="gmail_extra" dir="auto"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;On \
Oct 26, 2017 8:58 AM, "Yalan Zhang" &lt;&lt;a \
href="mailto:yalzhang@redhat.com" target="_blank"&gt;yalzhang@redhat.com&lt;/a&gt;&gt; \
wrote:&lt;br type="attribution"&gt;&lt;blockquote class="m_5408290801497859655quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;&lt;div&gt;Hi Ashish,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Please never mind for \
qemu-kvm-rhev.&lt;/div&gt;qemu with the code base 2.10.0 will support the tx_queue_size and \
rx_queue_size.  &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank \
you~&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;div class="m_5408290801497859655quoted-text"&gt;&lt;br \
clear="all"&gt;&lt;div&gt;&lt;div \
class="m_5408290801497859655m_-5900777116898549406gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;br&gt;&lt;br&gt;-------&lt;br&gt;Best Regards,&lt;br&gt;Yalan \
Zhang&lt;br&gt;IRC: yalzhang&lt;br&gt;Internal phone: 8389413&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;/div&gt;&lt;div \
class="m_5408290801497859655elided-text"&gt;&lt;div class="gmail_quote"&gt;On Thu, Oct 26, \
2017 at 2:22 PM, Yalan Zhang &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:yalzhang@redhat.com" \
target="_blank"&gt;yalzhang@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Ashish,  &lt;span&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div \
style="font-size:12.8px"&gt;&lt;span style="font-size:12.8px"&gt;Are these packages available \
for free? How can I install them?&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;=&gt; You did have \
vhost backend driver. Do not set &lt;driver name='qemu'...&gt;, by default it \
will use vhost as backend driver.  &lt;/div&gt;&lt;span&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;  Is it possible to have my interfaces with an IP address \
inside the VM to be bridged to the physical interfaces on the host?  \
&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;=&gt; Yes, you can create a linux bridge with physical \
interface connected, and use bridge type interface. Refer to  &lt;a \
href="https://libvirt.org/formatdomain.html#elementsNICSBridge" \
target="_blank"&gt;https://libvirt.org/formatd&lt;wbr&gt;omain.html#elementsNICSBridge&lt;/a&gt;  \
&lt;br&gt;&lt;/div&gt;&lt;div&gt;direct type is also ok (but your host and guest have no access to each \
other).&lt;/div&gt;&lt;span&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div style="font-size:12.8px"&gt;&lt;span \
style="font-size:12.8px"&gt;Is it also a possibility that I change the rx and tx buffer \
on the physical interface on the host and it is reflected automatically inside the VM \
as you said it will always receive the default value of the \
host?&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;=&gt; No, it do \
not receive the default value of the host. It's the default value related with \
the virtual device driver on the guest.&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;hostdev type interface will passthrough the physical \
interface or VF of the host to guest, it will get the device's parameters for rx \
and tx buffer.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;span&gt;&lt;div&gt;&lt;div \
class="m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-6540617163388826959gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;br&gt;-------&lt;br&gt;Best Regards,&lt;br&gt;Yalan Zhang&lt;br&gt;IRC: \
yalzhang&lt;br&gt;Internal phone: 8389413&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;/span&gt;&lt;div&gt;&lt;div \
class="m_5408290801497859655m_-5900777116898549406h5"&gt;&lt;div class="gmail_quote"&gt;On \
Thu, Oct 26, 2017 at 1:30 PM, Ashish Kurian &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:ashishbnv@gmail.com" target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; \
wrote:&lt;br&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px \
#ccc solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Yalan,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank you \
for your response. I do not have the following packages \
installed&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;vhost backend driver&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;qemu-kvm-rhev package&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;Are \
these packages available for free? How can I install them?&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;In my \
KVM VM, I must have an IP address to the interfaces that I am trying to increasing \
the buffers. That is the reason I was using macvtap (direct type interface). Is it \
possible to have my interfaces with an IP address inside the VM to be bridged to the \
physical interfaces on the host?  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;Is it \
also a possibility that I change the rx and tx buffer on the physical interface on \
the host and it is reflected automatically inside the VM as you said it will always \
receive the default value of the host?&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-6540617163388826959m_5293176283835252071gmail_signature" \
data-smartmail="gmail_signature"&gt;Best Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div \
class="m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-6540617163388826959h5"&gt;
 &lt;br&gt;&lt;div class="gmail_quote"&gt;On Thu, Oct 26, 2017 at 6:45 AM, Yalan Zhang &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:yalzhang@redhat.com" \
target="_blank"&gt;yalzhang@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Ashish,  &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I have tested \
with your xml in the first mail, and it works for  &lt;span \
style="font-size:12.8px"&gt;rx_queue_size(see below)&lt;/span&gt;.  &lt;/div&gt;&lt;div&gt;multiqueue need \
to work with vhost backend driver. And when you set "queues=1" it will \
ignored.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Please check your qemu-kvm-rhev package, should be \
newer than  &lt;span style="color:rgb(51,51,51);font-family:Arial,sans-serif;font-size:14px"&gt;qemu-kvm-rhev-2.9.0-16.el&lt;wbr&gt;7_4.2&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
color="#333333" face="Arial, sans-serif"&gt;&lt;span style="font-size:14px"&gt;And the \
logs?&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="color:rgb(51,51,51);font-family:Arial,sans-serif;font-size:14px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;tx_queue_size='512' \
will not work in the guest with direct type interface, in fact, no matter what you \
set, it will not work and guest will get the default '256'.  \
&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="color:rgb(0,0,0);white-space:pre-wrap"&gt;We only support \
vhost-user backend to have more than 256. &lt;/span&gt;refer to  &lt;a \
href="https://libvirt.org/formatdomain.html#elementsNICSEthernet" \
target="_blank"&gt;https://libvirt.org/formatd&lt;wbr&gt;omain.html#elementsNICSEtherne&lt;wbr&gt;t&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;span \
style="font-family:LibvirtOverpassMono;font-weight:bold;color:rgb(0,0,0);font-size:medium"&gt;tx_queue_size&lt;/span&gt;&lt;/div&gt;&lt;dd \
style="margin-left:2em;margin-right:2em;margin-bottom:0.5em;color:rgb(0,0,0);font-family:LibvirtOverpass;font-size:medium"&gt;The \
optional  &lt;code style="font-family:LibvirtOverpassMono;background-color:rgb(238,238,238)"&gt;tx_queue_size&lt;/code&gt; \
attribu&lt;wbr&gt;te controls the size of virtio ring for each queue as described above. \
The default value is hypervisor dependent and may change across its releases. \
Moreover, some hypervisors may pose some restrictions on actual value. For instance, \
QEMU v2.9 requires value to be a power of two from [256, 1024] range. In addition to \
that, this may work only for a subset of interface types, e.g. aforementioned QEMU \
enables this option only for  &lt;code \
style="font-family:LibvirtOverpassMono;background-color:rgb(238,238,238)"&gt;vhostuser&lt;/code&gt; \
type.  &lt;span class="m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m \
_-6540617163388826959m_5293176283835252071m_-515258420855843595gmail-m_843597909639990587gmail-since" \
style="color:rgb(60,133,124);font-style:italic;font-weight:bold"&gt;Since 3.7.0 (QEMU \
and KVM only)&lt;/span&gt;&lt;/dd&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;multiqueue only supports vhost as backend \
driver.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# rpm -q libvirt \
qemu-kvm-rhev&lt;/div&gt;&lt;div&gt;libvirt-3.2.0-14.el7_4.3.x86_6&lt;wbr&gt;4&lt;/div&gt;&lt;div&gt;qemu-kvm-rhev-2.9.0-16.el7_4.9&lt;wbr&gt;.x86_64&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1. \
the xml as below&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;div&gt;     &lt;interface \
type='direct'&gt;&lt;/div&gt;&lt;div&gt;         &lt;mac \
address='52:54:00:00:b5:99'/&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;         &lt;source \
dev='eno1' mode='vepa'/&gt;&lt;/div&gt;&lt;span&gt;&lt;div&gt;         &lt;model \
type='virtio'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;driver name='vhost' \
queues='5' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;/div&gt;&lt;div&gt;            &lt;host csum='off' \
gso='off' tso4='off' tso6='off' ecn='off' \
ufo='off' mrg_rxbuf='off'/&gt;&lt;/div&gt;&lt;div&gt;            &lt;guest \
csum='off' tso4='off' tso6='off' ecn='off' \
ufo='off'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;/driver&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;         \
&lt;address type='pci' domain='0x0000' bus='0x00' \
slot='0x03' function='0x0'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/interface&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2. after start the vm, check the \
qemu command line:&lt;/div&gt;&lt;div&gt;&lt;b&gt;-netdev \
tap,fds=26:28:29:30:31,id=host&lt;wbr&gt;net0,vhost=on,vhostfds=32:33:3&lt;wbr&gt;4:35:36&lt;/b&gt; \
-device virtio-net-pci,csum=off,gso=of&lt;wbr&gt;f,host_tso4=off,host_tso6=off,&lt;wbr&gt;host_ecn \
=off,host_ufo=off,mrg_&lt;wbr&gt;rxbuf=off,guest_csum=off,guest&lt;wbr&gt;_tso4=off,guest_tso6=off \
,guest&lt;wbr&gt;_ecn=off,guest_ufo=off,&lt;b&gt;mq=on,v&lt;wbr&gt;ectors=12,rx_queue_size=512,tx&lt;wbr&gt;_q \
ueue_size=512&lt;/b&gt;,netdev=hostnet&lt;wbr&gt;0,id=net0,mac=52:54:00:00:b5:9&lt;wbr&gt;9,bus=pci.0,addr=0x3 \
&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3. check on guest&lt;/div&gt;&lt;div&gt;&lt;div&gt;# ethtool -g \
eth0&lt;/div&gt;&lt;div&gt;Ring parameters for eth0:&lt;/div&gt;&lt;div&gt;Pre-set \
maximums:&lt;/div&gt;&lt;div&gt;RX:&lt;span style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;512 ==&gt; \
rx_queue_size works&lt;/b&gt;&lt;/div&gt;&lt;span&gt;&lt;div&gt;RX Mini:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;RX Jumbo:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;/span&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;256    ===&gt; no \
change&lt;/b&gt;&lt;/div&gt;&lt;div&gt;Current hardware settings:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;512  &lt;/b&gt;&lt;b&gt;==&gt; rx_queue_size \
works&lt;/b&gt;&lt;/div&gt;&lt;span&gt;&lt;div&gt;RX Mini:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;RX Jumbo:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;/span&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;256 ===&gt; no \
change&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# ethtool -l eth0&lt;/div&gt;&lt;div&gt;Channel \
parameters for eth0:&lt;/div&gt;&lt;div&gt;Pre-set maximums:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Other:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Combined:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;&lt;b&gt;5   ==&gt; queues what we \
set&lt;/b&gt;&lt;/div&gt;&lt;div&gt;Current hardware settings:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Other:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Combined:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;1&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If \
change to qemu as driver,  &lt;/div&gt;&lt;div&gt;# virsh edit \
rhel7&lt;br&gt;&lt;/div&gt;&lt;div&gt;..&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;div&gt;   &lt;interface \
type='direct'&gt;&lt;/div&gt;&lt;div&gt;         &lt;mac \
address='52:54:00:00:b5:99'/&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;         &lt;source \
dev='eno1' mode='vepa'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;model \
type='virtio'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;driver name='qemu' \
queues='5' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;/div&gt;&lt;span&gt;&lt;div&gt;            &lt;host \
csum='off' gso='off' tso4='off' tso6='off' \
ecn='off' ufo='off' mrg_rxbuf='off'/&gt;&lt;/div&gt;&lt;div&gt;           \
&lt;guest csum='off' tso4='off' tso6='off' ecn='off' \
ufo='off'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;/driver&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;         \
&lt;address type='pci' domain='0x0000' bus='0x00' \
slot='0x03' function='0x0'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/interface&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;..&lt;/div&gt;&lt;div&gt;Domain rhel7 XML configuration \
edited. ==&gt; the xml can validate and save&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# \
virsh start rhel7&lt;/div&gt;&lt;div&gt;Domain rhel7 \
started&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# virsh dumpxml rhel7 | \
grep /interface -B9&lt;/div&gt;&lt;div&gt;         &lt;source dev='eno1' \
mode='vepa'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;target \
dev='macvtap0'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;model \
type='virtio'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;b&gt;&lt;driver name='qemu' \
queues='5' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;/b&gt;&lt;/div&gt;&lt;span&gt;&lt;div&gt;            &lt;host \
csum='off' gso='off' tso4='off' tso6='off' \
ecn='off' ufo='off' mrg_rxbuf='off'/&gt;&lt;/div&gt;&lt;div&gt;           \
&lt;guest csum='off' tso4='off' tso6='off' ecn='off' \
ufo='off'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;/driver&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;         \
&lt;alias name='net0'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x03' \
function='0x0'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/interface&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;  -netdev \
tap,fds=26:28:29:30:31&lt;/b&gt;,id=host&lt;wbr&gt;net0 -device \
virtio-net-pci,csum=off,gso=of&lt;wbr&gt;f,host_tso4=off,host_tso6=off,&lt;wbr&gt;host_ecn=off,hos \
t_ufo=off,mrg_&lt;wbr&gt;rxbuf=off,guest_csum=off,guest&lt;wbr&gt;_tso4=off,guest_tso6=off,guest&lt;w \
br&gt;_ecn=off,guest_ufo=off,&lt;b&gt;rx_queu&lt;wbr&gt;e_size=512,tx_queue_size=512&lt;/b&gt;,n&lt;wbr&gt;etdev= \
hostnet0,id=net0,mac=52:&lt;wbr&gt;54:00:00:b5:99,bus=pci.0,addr=&lt;wbr&gt;0x3&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;"mq=on,vectors=12" \
is missing&lt;/b&gt;, indicates there is no multiqueue&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;and \
&lt;br&gt;&lt;div class="gmail_quote"&gt;&lt;div&gt;&lt;div \
class="m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-6540617163388826959m_5293176283835252071h5"&gt;On \
Thu, Oct 26, 2017 at 2:33 AM, Ashish Kurian &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:ashishbnv@gmail.com" target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; \
wrote:&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div&gt;&lt;div \
class="m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-6540617163388826959m_5293176283835252071h5"&gt;&lt;div \
dir="ltr"&gt;Hi Michal,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;An update to what I have already said : when \
I try adding  &lt;span style="font-size:12.8px"&gt;&lt;driver name='qemu' \
txmode='iothread' ioeventfd='on' event_idx='off' \
queues='1' rx_queue_size='512' tx_queue_size='512'&gt; \
although it showed me the error as mentioned, when I checked the xml again I saw that \
&lt;/span&gt;&lt;span style="font-size:12.8px"&gt;&lt;driver name='qemu' \
txmode='iothread' ioeventfd='on' event_idx='off' &gt; is \
added to the interface.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;The \
missing parameters are :  &lt;/span&gt;&lt;span style="font-size:12.8px"&gt;queues='1' \
rx_queue_size='512' tx_queue_size='512'&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-65406171633 \
88826959m_5293176283835252071m_-515258420855843595m_-212787898175025196gmail_signature" \
data-smartmail="gmail_signature"&gt;Best Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div \
class="m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-6540617163388826959m_5293176283835252071m_-515258420855843595h5"&gt;
 &lt;br&gt;&lt;div class="gmail_quote"&gt;On Wed, Oct 25, 2017 at 5:07 PM, Ashish Kurian &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:ashishbnv@gmail.com" \
target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Michal,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What I found was \
that when I restarted the machine and did a virsh edit command to see the xml config, \
I see that it is was not actually changed. This suggests why I saw 256 again after \
restarting.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So now I tried again to edit the xml via virsh \
edit command and used the following to set the \
parameters.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;driver name='qemu' \
txmode='iothread' ioeventfd='on' event_idx='off' \
queues='1' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/driver&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It \
was not accepted and I got the error saying \
:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;error: XML document failed to validate \
against schema: Unable to validate doc against \
/usr/share/libvirt/schemas/dom&lt;wbr&gt;ain.rng&lt;/div&gt;&lt;div&gt;Extra element devices in \
interleave&lt;/div&gt;&lt;div&gt;Element domain failed to validate \
content&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What does this imply? I have two more other \
interfaces and do I have to the same to them also?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Btw, \
there are now logs generated now in the domain log or libvirtd \
log&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-65406171633 \
88826959m_5293176283835252071m_-515258420855843595m_-212787898175025196m_8788737298834798581gmail_signature" \
data-smartmail="gmail_signature"&gt;Best Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div \
class="m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-6540617163388826959m_5293176283835252071m_-515258420855843595m_-212787898175025196h5"&gt;
 &lt;br&gt;&lt;div class="gmail_quote"&gt;On Wed, Oct 25, 2017 at 2:50 PM, Michal Privoznik &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:mprivozn@redhat.com" \
target="_blank"&gt;mprivozn@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div \
class="m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-65406171633 \
88826959m_5293176283835252071m_-515258420855843595m_-212787898175025196m_8788737298834798581HOEnZb"&gt;&lt;div \
class="m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-65406171633 \
88826959m_5293176283835252071m_-515258420855843595m_-212787898175025196m_8788737298834798581h5"&gt;On \
10/25/2017 01:53 PM, Ashish Kurian wrote:&lt;br&gt; &gt; Dear Users/Developers,&lt;br&gt;
&gt;&lt;br&gt;
&gt; I am using a KVM Ubuntu VM as a degrader to apply specific delays to&lt;br&gt;
&gt; incoming packets. As the delay for my packets can be higher than 7.5&lt;br&gt;
&gt; seconds, there is not enough buffer on my interface to buffer all the&lt;br&gt;
&gt; packets. Therefore those overflowing packets are dropped in the machine and&lt;br&gt;
&gt; not forwarded.&lt;br&gt;
&gt;&lt;br&gt;
&gt; When I tried to use the command   ethtool -G ens8 rx 512 to increase the&lt;br&gt;
&gt; buffer size, I get the following error.&lt;br&gt;
&gt;&lt;br&gt;
&gt; Cannot set device ring parameters: Operation not permitted&lt;br&gt;
&gt;&lt;br&gt;
&gt; I have kept the VM xml files as specified in the link :&lt;br&gt;
&gt; &lt;a href="https://libvirt.org/formatdomain.html" rel="noreferrer" \
target="_blank"&gt;https://libvirt.org/formatdoma&lt;wbr&gt;in.html&lt;/a&gt;. The value that I kept \
in my xml file&lt;br&gt; &gt; is as follows.&lt;br&gt;
&gt;&lt;br&gt;
&gt; &lt;interface type='direct'&gt;&lt;br&gt;
&gt;           &lt;mac address='52:54:00:72:f9:eb'/&gt;&lt;br&gt;
&gt;           &lt;source dev='enp7s0f0' mode='vepa'/&gt;&lt;br&gt;
&gt;           &lt;model type='virtio'/&gt;&lt;br&gt;
&gt;           &lt;driver name='vhost' queues='5' \
rx_queue_size='512'&lt;br&gt; &gt; tx_queue_size='512'&gt;&lt;br&gt;
&gt;           &lt;host csum='off' gso='off' tso4='off' \
tso6='off' ecn='off' ufo='off'&lt;br&gt; &gt; \
mrg_rxbuf='off'/&gt;&lt;br&gt; &gt;           &lt;guest csum='off' \
tso4='off' tso6='off' ecn='off' ufo='off'/&gt;&lt;br&gt; \
&gt;           &lt;/driver&gt;&lt;br&gt; &gt;           &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x08'&lt;br&gt; &gt; \
function='0x0'/&gt;&lt;br&gt; &gt;        &lt;/interface&gt;&lt;br&gt;
&gt;        &lt;interface type='direct'&gt;&lt;br&gt;
&gt;           &lt;mac address='52:54:00:00:b5:99'/&gt;&lt;br&gt;
&gt;           &lt;source dev='enp7s0f1' mode='vepa'/&gt;&lt;br&gt;
&gt;           &lt;model type='virtio'/&gt;&lt;br&gt;
&gt;           &lt;driver name='vhost' queues='5' \
rx_queue_size='512'&lt;br&gt; &gt; tx_queue_size='512'&gt;&lt;br&gt;
&gt;           &lt;host csum='off' gso='off' tso4='off' \
tso6='off' ecn='off' ufo='off'&lt;br&gt; &gt; \
mrg_rxbuf='off'/&gt;&lt;br&gt; &gt;           &lt;guest csum='off' \
tso4='off' tso6='off' ecn='off' ufo='off'/&gt;&lt;br&gt; \
&gt;           &lt;/driver&gt;&lt;br&gt; &gt;           &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x09'&lt;br&gt; &gt; \
function='0x0'/&gt;&lt;br&gt; &lt;br&gt;
&lt;/div&gt;&lt;/div&gt;So what does the qemu command line look like? You can find it in \
either&lt;br&gt; libvirtd log or domain log.&lt;br&gt;
&lt;br&gt;
&lt;a href="http://wiki.libvirt.org/page/DebugLogs" rel="noreferrer" \
target="_blank"&gt;http://wiki.libvirt.org/page/D&lt;wbr&gt;ebugLogs&lt;/a&gt;&lt;br&gt; &lt;span \
class="m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-65406171633 \
88826959m_5293176283835252071m_-515258420855843595m_-212787898175025196m_8788737298834798581HOEnZb"&gt;&lt;font \
color="#888888"&gt;&lt;br&gt; Michal&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;br&gt;&lt;/div&gt;&lt;/div&gt;______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
 &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20171026075656</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-10-26 07:56:56-0400</timestampReceived><subject>Re: [libvirt-users] Need to increase the rx and tx buffer size of my interface</subject><body>

On 10/26/2017 09:38 AM, Ashish Kurian wrote:
&gt; Hi Yalan,
&gt; 
&gt; In the previous email you mentioned "tx_queue_size='512' will not work in
&gt; the guest with direct type interface, in fact, no matter what you set, it
&gt; will not work and guest will get the default '256'. "
&gt; 
&gt; So if I am using macvtap for my interfaces, then the device type will
&gt; always be direct type. Does it mean that there is no way I can increase the
&gt; buffer size with the macvtap interfaces?
&gt; 

Correct. However, this is limitation of qemu. You should talk to them to
find out if there are plans to extend the implementation.

BTW: rx_queue_size should work with any backend as long as the model is
virtio (obviously).

Michal

</body></email><email><emailId>20171026080155</emailId><senderName>Yalan Zhang</senderName><senderEmail>yalzhang@redhat.com</senderEmail><timestampReceived>2017-10-26 08:01:55-0400</timestampReceived><subject>Re: [libvirt-users] Need to increase the rx and tx buffer size of my interface</subject><body>

Hi Ashish,

IMO, it is yes, no way to increase tx_queue_size for direct type interface






-------
Best Regards,
Yalan Zhang
IRC: yalzhang
Internal phone: 8389413

On Thu, Oct 26, 2017 at 3:38 PM, Ashish Kurian &lt;ashishbnv@gmail.com&gt; wrote:

&gt; Hi Yalan,
&gt;
&gt; In the previous email you mentioned "tx_queue_size='512' will not work in
&gt; the guest with direct type interface, in fact, no matter what you set, it
&gt; will not work and guest will get the default '256'. "
&gt;
&gt; So if I am using macvtap for my interfaces, then the device type will
&gt; always be direct type. Does it mean that there is no way I can increase the
&gt; buffer size with the macvtap interfaces?
&gt;
&gt;
&gt;
&gt; Best Regards,
&gt; Ashish Kurian
&gt;
&gt; On Thu, Oct 26, 2017 at 9:04 AM, Ashish Kurian &lt;ashishbnv@gmail.com&gt;
&gt; wrote:
&gt;
&gt;&gt; Hi Yalan,
&gt;&gt;
&gt;&gt; Thank you for your comment on qemu-kvm-rhev
&gt;&gt;
&gt;&gt; I am waiting for a response about my previous email with the logs
&gt;&gt; attached. I do not understand what is the problem.
&gt;&gt;
&gt;&gt;
&gt;&gt; On Oct 26, 2017 8:58 AM, "Yalan Zhang" &lt;yalzhang@redhat.com&gt; wrote:
&gt;&gt;
&gt;&gt; Hi Ashish,
&gt;&gt;
&gt;&gt; Please never mind for qemu-kvm-rhev.
&gt;&gt; qemu with the code base 2.10.0 will support the tx_queue_size and
&gt;&gt; rx_queue_size.
&gt;&gt;
&gt;&gt; Thank you~
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; -------
&gt;&gt; Best Regards,
&gt;&gt; Yalan Zhang
&gt;&gt; IRC: yalzhang
&gt;&gt; Internal phone: 8389413
&gt;&gt;
&gt;&gt; On Thu, Oct 26, 2017 at 2:22 PM, Yalan Zhang &lt;yalzhang@redhat.com&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; Hi Ashish,
&gt;&gt;&gt;
&gt;&gt;&gt; Are these packages available for free? How can I install them?
&gt;&gt;&gt; =&gt; You did have vhost backend driver. Do not set &lt;driver
&gt;&gt;&gt; name='qemu'...&gt;, by default it will use vhost as backend driver.
&gt;&gt;&gt;
&gt;&gt;&gt;  Is it possible to have my interfaces with an IP address inside the VM
&gt;&gt;&gt; to be bridged to the physical interfaces on the host?
&gt;&gt;&gt; =&gt; Yes, you can create a linux bridge with physical interface connected,
&gt;&gt;&gt; and use bridge type interface. Refer to https://libvirt.org/formatd
&gt;&gt;&gt; omain.html#elementsNICSBridge
&gt;&gt;&gt; direct type is also ok (but your host and guest have no access to each
&gt;&gt;&gt; other).
&gt;&gt;&gt;
&gt;&gt;&gt; Is it also a possibility that I change the rx and tx buffer on the
&gt;&gt;&gt; physical interface on the host and it is reflected automatically inside the
&gt;&gt;&gt; VM as you said it will always receive the default value of the host?
&gt;&gt;&gt; =&gt; No, it do not receive the default value of the host. It's the default
&gt;&gt;&gt; value related with the virtual device driver on the guest.
&gt;&gt;&gt; hostdev type interface will passthrough the physical interface or VF of
&gt;&gt;&gt; the host to guest, it will get the device's parameters for rx and tx buffer.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; -------
&gt;&gt;&gt; Best Regards,
&gt;&gt;&gt; Yalan Zhang
&gt;&gt;&gt; IRC: yalzhang
&gt;&gt;&gt; Internal phone: 8389413
&gt;&gt;&gt;
&gt;&gt;&gt; On Thu, Oct 26, 2017 at 1:30 PM, Ashish Kurian &lt;ashishbnv@gmail.com&gt;
&gt;&gt;&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi Yalan,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Thank you for your response. I do not have the following packages
&gt;&gt;&gt;&gt; installed
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; vhost backend driver
&gt;&gt;&gt;&gt; qemu-kvm-rhev package
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Are these packages available for free? How can I install them?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; In my KVM VM, I must have an IP address to the interfaces that I am
&gt;&gt;&gt;&gt; trying to increasing the buffers. That is the reason I was using macvtap
&gt;&gt;&gt;&gt; (direct type interface). Is it possible to have my interfaces with an IP
&gt;&gt;&gt;&gt; address inside the VM to be bridged to the physical interfaces on the host?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Is it also a possibility that I change the rx and tx buffer on the
&gt;&gt;&gt;&gt; physical interface on the host and it is reflected automatically inside the
&gt;&gt;&gt;&gt; VM as you said it will always receive the default value of the host?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Best Regards,
&gt;&gt;&gt;&gt; Ashish Kurian
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Thu, Oct 26, 2017 at 6:45 AM, Yalan Zhang &lt;yalzhang@redhat.com&gt;
&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Hi Ashish,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I have tested with your xml in the first mail, and it works for rx_queue_size(see
&gt;&gt;&gt;&gt;&gt; below).
&gt;&gt;&gt;&gt;&gt; multiqueue need to work with vhost backend driver. And when you set
&gt;&gt;&gt;&gt;&gt; "queues=1" it will ignored.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Please check your qemu-kvm-rhev package, should be newer than
&gt;&gt;&gt;&gt;&gt; qemu-kvm-rhev-2.9.0-16.el7_4.2
&gt;&gt;&gt;&gt;&gt; And the logs?
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; tx_queue_size='512' will not work in the guest with direct type
&gt;&gt;&gt;&gt;&gt; interface, in fact, no matter what you set, it will not work and guest will
&gt;&gt;&gt;&gt;&gt; get the default '256'.
&gt;&gt;&gt;&gt;&gt; We only support vhost-user backend to have more than 256. refer to
&gt;&gt;&gt;&gt;&gt; https://libvirt.org/formatdomain.html#elementsNICSEthernet
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; tx_queue_size
&gt;&gt;&gt;&gt;&gt; The optional tx_queue_size attribute controls the size of virtio ring
&gt;&gt;&gt;&gt;&gt; for each queue as described above. The default value is hypervisor
&gt;&gt;&gt;&gt;&gt; dependent and may change across its releases. Moreover, some hypervisors
&gt;&gt;&gt;&gt;&gt; may pose some restrictions on actual value. For instance, QEMU v2.9
&gt;&gt;&gt;&gt;&gt; requires value to be a power of two from [256, 1024] range. In addition to
&gt;&gt;&gt;&gt;&gt; that, this may work only for a subset of interface types, e.g.
&gt;&gt;&gt;&gt;&gt; aforementioned QEMU enables this option only for vhostuser type. Since
&gt;&gt;&gt;&gt;&gt; 3.7.0 (QEMU and KVM only)
&gt;&gt;&gt;&gt;&gt; multiqueue only supports vhost as backend driver.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; # rpm -q libvirt qemu-kvm-rhev
&gt;&gt;&gt;&gt;&gt; libvirt-3.2.0-14.el7_4.3.x86_64
&gt;&gt;&gt;&gt;&gt; qemu-kvm-rhev-2.9.0-16.el7_4.9.x86_64
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; 1. the xml as below
&gt;&gt;&gt;&gt;&gt;    &lt;interface type='direct'&gt;
&gt;&gt;&gt;&gt;&gt;       &lt;mac address='52:54:00:00:b5:99'/&gt;
&gt;&gt;&gt;&gt;&gt;       &lt;source dev='eno1' mode='vepa'/&gt;
&gt;&gt;&gt;&gt;&gt;       &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt;&gt;       &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt;&gt;&gt;&gt;&gt; tx_queue_size='512'&gt;
&gt;&gt;&gt;&gt;&gt;         &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt;&gt; ufo='off' mrg_rxbuf='off'/&gt;
&gt;&gt;&gt;&gt;&gt;         &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;&gt;&gt;&gt;&gt;       &lt;/driver&gt;
&gt;&gt;&gt;&gt;&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
&gt;&gt;&gt;&gt;&gt; function='0x0'/&gt;
&gt;&gt;&gt;&gt;&gt;     &lt;/interface&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; 2. after start the vm, check the qemu command line:
&gt;&gt;&gt;&gt;&gt; *-netdev
&gt;&gt;&gt;&gt;&gt; tap,fds=26:28:29:30:31,id=hostnet0,vhost=on,vhostfds=32:33:34:35:36*
&gt;&gt;&gt;&gt;&gt; -device virtio-net-pci,csum=off,gso=off,host_tso4=off,host_tso6=off,
&gt;&gt;&gt;&gt;&gt; host_ecn=off,host_ufo=off,mrg_rxbuf=off,guest_csum=off,guest
&gt;&gt;&gt;&gt;&gt; _tso4=off,guest_tso6=off,guest_ecn=off,guest_ufo=off,
&gt;&gt;&gt;&gt;&gt; *mq=on,vectors=12,rx_queue_size=512,tx_queue_size=512*,netdev=hostnet
&gt;&gt;&gt;&gt;&gt; 0,id=net0,mac=52:54:00:00:b5:99,bus=pci.0,addr=0x3
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; 3. check on guest
&gt;&gt;&gt;&gt;&gt; # ethtool -g eth0
&gt;&gt;&gt;&gt;&gt; Ring parameters for eth0:
&gt;&gt;&gt;&gt;&gt; Pre-set maximums:
&gt;&gt;&gt;&gt;&gt; RX: *512 ==&gt; rx_queue_size works*
&gt;&gt;&gt;&gt;&gt; RX Mini: 0
&gt;&gt;&gt;&gt;&gt; RX Jumbo: 0
&gt;&gt;&gt;&gt;&gt; TX: *256   ===&gt; no change*
&gt;&gt;&gt;&gt;&gt; Current hardware settings:
&gt;&gt;&gt;&gt;&gt; RX: *512 **==&gt; rx_queue_size works*
&gt;&gt;&gt;&gt;&gt; RX Mini: 0
&gt;&gt;&gt;&gt;&gt; RX Jumbo: 0
&gt;&gt;&gt;&gt;&gt; TX: *256 ===&gt; no change*
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; # ethtool -l eth0
&gt;&gt;&gt;&gt;&gt; Channel parameters for eth0:
&gt;&gt;&gt;&gt;&gt; Pre-set maximums:
&gt;&gt;&gt;&gt;&gt; RX: 0
&gt;&gt;&gt;&gt;&gt; TX: 0
&gt;&gt;&gt;&gt;&gt; Other: 0
&gt;&gt;&gt;&gt;&gt; Combined: *5  ==&gt; queues what we set*
&gt;&gt;&gt;&gt;&gt; Current hardware settings:
&gt;&gt;&gt;&gt;&gt; RX: 0
&gt;&gt;&gt;&gt;&gt; TX: 0
&gt;&gt;&gt;&gt;&gt; Other: 0
&gt;&gt;&gt;&gt;&gt; Combined: 1
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; If change to qemu as driver,
&gt;&gt;&gt;&gt;&gt; # virsh edit rhel7
&gt;&gt;&gt;&gt;&gt; ..
&gt;&gt;&gt;&gt;&gt;   &lt;interface type='direct'&gt;
&gt;&gt;&gt;&gt;&gt;       &lt;mac address='52:54:00:00:b5:99'/&gt;
&gt;&gt;&gt;&gt;&gt;       &lt;source dev='eno1' mode='vepa'/&gt;
&gt;&gt;&gt;&gt;&gt;       &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt;&gt;       &lt;driver name='qemu' queues='5' rx_queue_size='512'
&gt;&gt;&gt;&gt;&gt; tx_queue_size='512'&gt;
&gt;&gt;&gt;&gt;&gt;         &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt;&gt; ufo='off' mrg_rxbuf='off'/&gt;
&gt;&gt;&gt;&gt;&gt;         &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;&gt;&gt;&gt;&gt;       &lt;/driver&gt;
&gt;&gt;&gt;&gt;&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
&gt;&gt;&gt;&gt;&gt; function='0x0'/&gt;
&gt;&gt;&gt;&gt;&gt;     &lt;/interface&gt;
&gt;&gt;&gt;&gt;&gt; ..
&gt;&gt;&gt;&gt;&gt; Domain rhel7 XML configuration edited. ==&gt; the xml can validate and
&gt;&gt;&gt;&gt;&gt; save
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; # virsh start rhel7
&gt;&gt;&gt;&gt;&gt; Domain rhel7 started
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; # virsh dumpxml rhel7 | grep /interface -B9
&gt;&gt;&gt;&gt;&gt;       &lt;source dev='eno1' mode='vepa'/&gt;
&gt;&gt;&gt;&gt;&gt;       &lt;target dev='macvtap0'/&gt;
&gt;&gt;&gt;&gt;&gt;       &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt;&gt;       *&lt;driver name='qemu' queues='5' rx_queue_size='512'
&gt;&gt;&gt;&gt;&gt; tx_queue_size='512'&gt;*
&gt;&gt;&gt;&gt;&gt;         &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt;&gt; ufo='off' mrg_rxbuf='off'/&gt;
&gt;&gt;&gt;&gt;&gt;         &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;&gt;&gt;&gt;&gt;       &lt;/driver&gt;
&gt;&gt;&gt;&gt;&gt;       &lt;alias name='net0'/&gt;
&gt;&gt;&gt;&gt;&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
&gt;&gt;&gt;&gt;&gt; function='0x0'/&gt;
&gt;&gt;&gt;&gt;&gt;     &lt;/interface&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; * -netdev tap,fds=26:28:29:30:31*,id=hostnet0 -device
&gt;&gt;&gt;&gt;&gt; virtio-net-pci,csum=off,gso=off,host_tso4=off,host_tso6=off,
&gt;&gt;&gt;&gt;&gt; host_ecn=off,host_ufo=off,mrg_rxbuf=off,guest_csum=off,guest
&gt;&gt;&gt;&gt;&gt; _tso4=off,guest_tso6=off,guest_ecn=off,guest_ufo=off,
&gt;&gt;&gt;&gt;&gt; *rx_queue_size=512,tx_queue_size=512*,netdev=hostnet0,id=net0,mac=52:
&gt;&gt;&gt;&gt;&gt; 54:00:00:b5:99,bus=pci.0,addr=0x3
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; *"mq=on,vectors=12" is missing*, indicates there is no multiqueue
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; and check on guest
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; # ethtool -l eth0
&gt;&gt;&gt;&gt;&gt; Channel parameters for eth0:
&gt;&gt;&gt;&gt;&gt; Pre-set maximums:
&gt;&gt;&gt;&gt;&gt; RX: 0
&gt;&gt;&gt;&gt;&gt; TX: 0
&gt;&gt;&gt;&gt;&gt; Other: 0
&gt;&gt;&gt;&gt;&gt; Combined: 1  ==&gt; no multiqueue
&gt;&gt;&gt;&gt;&gt; Current hardware settings:
&gt;&gt;&gt;&gt;&gt; RX: 0
&gt;&gt;&gt;&gt;&gt; TX: 0
&gt;&gt;&gt;&gt;&gt; Other: 0
&gt;&gt;&gt;&gt;&gt; Combined: 1
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; # ethtool -g eth0
&gt;&gt;&gt;&gt;&gt; Ring parameters for eth0:
&gt;&gt;&gt;&gt;&gt; Pre-set maximums:
&gt;&gt;&gt;&gt;&gt; RX: *512*
&gt;&gt;&gt;&gt;&gt; RX Mini: 0
&gt;&gt;&gt;&gt;&gt; RX Jumbo: 0
&gt;&gt;&gt;&gt;&gt; TX: 256
&gt;&gt;&gt;&gt;&gt; Current hardware settings:
&gt;&gt;&gt;&gt;&gt; RX: *512*
&gt;&gt;&gt;&gt;&gt; RX Mini: 0
&gt;&gt;&gt;&gt;&gt; RX Jumbo: 0
&gt;&gt;&gt;&gt;&gt; TX: 256
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; -------
&gt;&gt;&gt;&gt;&gt; Best Regards,
&gt;&gt;&gt;&gt;&gt; Yalan Zhang
&gt;&gt;&gt;&gt;&gt; IRC: yalzhang
&gt;&gt;&gt;&gt;&gt; Internal phone: 8389413
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On Thu, Oct 26, 2017 at 2:33 AM, Ashish Kurian &lt;ashishbnv@gmail.com&gt;
&gt;&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Hi Michal,
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; An update to what I have already said : when I try adding &lt;driver
&gt;&gt;&gt;&gt;&gt;&gt; name='qemu' txmode='iothread' ioeventfd='on' event_idx='off' queues='1'
&gt;&gt;&gt;&gt;&gt;&gt; rx_queue_size='512' tx_queue_size='512'&gt; although it showed me the error as
&gt;&gt;&gt;&gt;&gt;&gt; mentioned, when I checked the xml again I saw that &lt;driver
&gt;&gt;&gt;&gt;&gt;&gt; name='qemu' txmode='iothread' ioeventfd='on' event_idx='off' &gt; is added to
&gt;&gt;&gt;&gt;&gt;&gt; the interface.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; The missing parameters are : queues='1' rx_queue_size='512'
&gt;&gt;&gt;&gt;&gt;&gt; tx_queue_size='512'
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Best Regards,
&gt;&gt;&gt;&gt;&gt;&gt; Ashish Kurian
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; On Wed, Oct 25, 2017 at 5:07 PM, Ashish Kurian &lt;ashishbnv@gmail.com&gt;
&gt;&gt;&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Hi Michal,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; What I found was that when I restarted the machine and did a virsh
&gt;&gt;&gt;&gt;&gt;&gt;&gt; edit command to see the xml config, I see that it is was not actually
&gt;&gt;&gt;&gt;&gt;&gt;&gt; changed. This suggests why I saw 256 again after restarting.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; So now I tried again to edit the xml via virsh edit command and used
&gt;&gt;&gt;&gt;&gt;&gt;&gt; the following to set the parameters.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &lt;driver name='qemu' txmode='iothread' ioeventfd='on' event_idx='off'
&gt;&gt;&gt;&gt;&gt;&gt;&gt; queues='1' rx_queue_size='512' tx_queue_size='512'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &lt;/driver&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; It was not accepted and I got the error saying :
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; error: XML document failed to validate against schema: Unable to
&gt;&gt;&gt;&gt;&gt;&gt;&gt; validate doc against /usr/share/libvirt/schemas/domain.rng
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Extra element devices in interleave
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Element domain failed to validate content
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; What does this imply? I have two more other interfaces and do I have
&gt;&gt;&gt;&gt;&gt;&gt;&gt; to the same to them also?
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Btw, there are now logs generated now in the domain log or libvirtd
&gt;&gt;&gt;&gt;&gt;&gt;&gt; log
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Best Regards,
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Ashish Kurian
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; On Wed, Oct 25, 2017 at 2:50 PM, Michal Privoznik &lt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; mprivozn@redhat.com&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; On 10/25/2017 01:53 PM, Ashish Kurian wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; Dear Users/Developers,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; I am using a KVM Ubuntu VM as a degrader to apply specific delays
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; to
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; incoming packets. As the delay for my packets can be higher than
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 7.5
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; seconds, there is not enough buffer on my interface to buffer all
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; the
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; packets. Therefore those overflowing packets are dropped in the
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; machine and
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; not forwarded.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; When I tried to use the command  ethtool -G ens8 rx 512 to
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; increase the
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; buffer size, I get the following error.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; Cannot set device ring parameters: Operation not permitted
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; I have kept the VM xml files as specified in the link :
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; https://libvirt.org/formatdomain.html. The value that I kept in
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; my xml file
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; is as follows.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; &lt;interface type='direct'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;mac address='52:54:00:72:f9:eb'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;source dev='enp7s0f0' mode='vepa'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; tx_queue_size='512'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; ufo='off'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; mrg_rxbuf='off'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;guest csum='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; ufo='off'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;/driver&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; function='0x0'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;     &lt;/interface&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;     &lt;interface type='direct'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;mac address='52:54:00:00:b5:99'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;source dev='enp7s0f1' mode='vepa'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; tx_queue_size='512'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; ufo='off'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; mrg_rxbuf='off'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;guest csum='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; ufo='off'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;/driver&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x09'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; function='0x0'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; So what does the qemu command line look like? You can find it in
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; either
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; libvirtd log or domain log.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://wiki.libvirt.org/page/DebugLogs
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Michal
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt;&gt;&gt;&gt; libvirt-users mailing list
&gt;&gt;&gt;&gt;&gt;&gt; libvirt-users@redhat.com
&gt;&gt;&gt;&gt;&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;Hi Ashish,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;IMO, it is yes, no way to increase \
&lt;span style="font-size:12.8px"&gt;tx_queue_size for direct type \
interface&lt;/span&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br \
clear="all"&gt;&lt;div&gt;&lt;div class="gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;br&gt;&lt;br&gt;-------&lt;br&gt;Best Regards,&lt;br&gt;Yalan \
Zhang&lt;br&gt;IRC: yalzhang&lt;br&gt;Internal phone: 8389413&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Thu, Oct 26, 2017 at 3:38 PM, Ashish Kurian &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:ashishbnv@gmail.com" \
target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Yalan,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In the previous \
email you mentioned "&lt;span style="font-size:12.8px"&gt;tx_queue_size='512' \
will not work in the guest with direct type interface, in fact, no matter what you \
set, it will not work and guest will get the default '256'.  \
&lt;/span&gt;"&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So if I am using macvtap for my interfaces, \
then the device type will always be direct type. Does it mean that there is no way I \
can increase the buffer size with the macvtap \
interfaces?&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_3181712413401109781gmail_signature" data-smartmail="gmail_signature"&gt;Best \
Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div class="h5"&gt; &lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Thu, Oct 26, 2017 at 9:04 AM, Ashish Kurian &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:ashishbnv@gmail.com" \
target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="auto"&gt;Hi Yalan,&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
dir="auto"&gt;Thank you for your comment on qemu-kvm-rhev&lt;/div&gt;&lt;div \
dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;I am waiting for a response about my previous \
email with the logs attached. I do not understand what is the problem.&lt;/div&gt;&lt;div&gt;&lt;div \
class="m_3181712413401109781h5"&gt;&lt;br&gt;&lt;div class="gmail_extra" dir="auto"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Oct 26, 2017 8:58 AM, "Yalan Zhang" &lt;&lt;a \
href="mailto:yalzhang@redhat.com" target="_blank"&gt;yalzhang@redhat.com&lt;/a&gt;&gt; \
wrote:&lt;br type="attribution"&gt;&lt;blockquote \
class="m_3181712413401109781m_5408290801497859655quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div&gt;Hi \
Ashish,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Please never mind for qemu-kvm-rhev.&lt;/div&gt;qemu with \
the code base 2.10.0 will support the tx_queue_size and rx_queue_size.  \
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank \
you~&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;div \
class="m_3181712413401109781m_5408290801497859655quoted-text"&gt;&lt;br \
clear="all"&gt;&lt;div&gt;&lt;div \
class="m_3181712413401109781m_5408290801497859655m_-5900777116898549406gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;br&gt;&lt;br&gt;-------&lt;br&gt;Best Regards,&lt;br&gt;Yalan \
Zhang&lt;br&gt;IRC: yalzhang&lt;br&gt;Internal phone: 8389413&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;/div&gt;&lt;div \
class="m_3181712413401109781m_5408290801497859655elided-text"&gt;&lt;div \
class="gmail_quote"&gt;On Thu, Oct 26, 2017 at 2:22 PM, Yalan Zhang &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:yalzhang@redhat.com" \
target="_blank"&gt;yalzhang@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Ashish,  &lt;span&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div \
style="font-size:12.8px"&gt;&lt;span style="font-size:12.8px"&gt;Are these packages available \
for free? How can I install them?&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;=&gt; You did have \
vhost backend driver. Do not set &lt;driver name='qemu'...&gt;, by default it \
will use vhost as backend driver.  &lt;/div&gt;&lt;span&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;  Is it possible to have my interfaces with an IP address \
inside the VM to be bridged to the physical interfaces on the host?  \
&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;=&gt; Yes, you can create a linux bridge with physical \
interface connected, and use bridge type interface. Refer to  &lt;a \
href="https://libvirt.org/formatdomain.html#elementsNICSBridge" \
target="_blank"&gt;https://libvirt.org/formatd&lt;wbr&gt;omain.html#elementsNICSBridge&lt;/a&gt;  \
&lt;br&gt;&lt;/div&gt;&lt;div&gt;direct type is also ok (but your host and guest have no access to each \
other).&lt;/div&gt;&lt;span&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div style="font-size:12.8px"&gt;&lt;span \
style="font-size:12.8px"&gt;Is it also a possibility that I change the rx and tx buffer \
on the physical interface on the host and it is reflected automatically inside the VM \
as you said it will always receive the default value of the \
host?&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;=&gt; No, it do \
not receive the default value of the host. It's the default value related with \
the virtual device driver on the guest.&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;hostdev type interface will passthrough the physical \
interface or VF of the host to guest, it will get the device's parameters for rx \
and tx buffer.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;span&gt;&lt;div&gt;&lt;div \
class="m_3181712413401109781m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-6540617163388826959gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;br&gt;-------&lt;br&gt;Best Regards,&lt;br&gt;Yalan Zhang&lt;br&gt;IRC: \
yalzhang&lt;br&gt;Internal phone: 8389413&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;/span&gt;&lt;div&gt;&lt;div \
class="m_3181712413401109781m_5408290801497859655m_-5900777116898549406h5"&gt;&lt;div \
class="gmail_quote"&gt;On Thu, Oct 26, 2017 at 1:30 PM, Ashish Kurian &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:ashishbnv@gmail.com" \
target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Yalan,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank you for \
your response. I do not have the following packages \
installed&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;vhost backend driver&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;qemu-kvm-rhev package&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;Are \
these packages available for free? How can I install them?&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;In my \
KVM VM, I must have an IP address to the interfaces that I am trying to increasing \
the buffers. That is the reason I was using macvtap (direct type interface). Is it \
possible to have my interfaces with an IP address inside the VM to be bridged to the \
physical interfaces on the host?  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;Is it \
also a possibility that I change the rx and tx buffer on the physical interface on \
the host and it is reflected automatically inside the VM as you said it will always \
receive the default value of the host?&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_3181712413401109781m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-6540617163388826959m_5293176283835252071gmail_signature" \
data-smartmail="gmail_signature"&gt;Best Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div \
class="m_3181712413401109781m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-6540617163388826959h5"&gt;
 &lt;br&gt;&lt;div class="gmail_quote"&gt;On Thu, Oct 26, 2017 at 6:45 AM, Yalan Zhang &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:yalzhang@redhat.com" \
target="_blank"&gt;yalzhang@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Ashish,  &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I have tested \
with your xml in the first mail, and it works for  &lt;span \
style="font-size:12.8px"&gt;rx_queue_size(see below)&lt;/span&gt;.  &lt;/div&gt;&lt;div&gt;multiqueue need \
to work with vhost backend driver. And when you set "queues=1" it will \
ignored.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Please check your qemu-kvm-rhev package, should be \
newer than  &lt;span style="color:rgb(51,51,51);font-family:Arial,sans-serif;font-size:14px"&gt;qemu-kvm-rhev-2.9.0-16.el&lt;wbr&gt;7_4.2&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
color="#333333" face="Arial, sans-serif"&gt;&lt;span style="font-size:14px"&gt;And the \
logs?&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="color:rgb(51,51,51);font-family:Arial,sans-serif;font-size:14px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;tx_queue_size='512' \
will not work in the guest with direct type interface, in fact, no matter what you \
set, it will not work and guest will get the default '256'.  \
&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="color:rgb(0,0,0);white-space:pre-wrap"&gt;We only support \
vhost-user backend to have more than 256. &lt;/span&gt;refer to  &lt;a \
href="https://libvirt.org/formatdomain.html#elementsNICSEthernet" \
target="_blank"&gt;https://libvirt.org/formatd&lt;wbr&gt;omain.html#elementsNICSEtherne&lt;wbr&gt;t&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;span \
style="font-family:LibvirtOverpassMono;font-weight:bold;color:rgb(0,0,0);font-size:medium"&gt;tx_queue_size&lt;/span&gt;&lt;/div&gt;&lt;dd \
style="margin-left:2em;margin-right:2em;margin-bottom:0.5em;color:rgb(0,0,0);font-family:LibvirtOverpass;font-size:medium"&gt;The \
optional  &lt;code style="font-family:LibvirtOverpassMono;background-color:rgb(238,238,238)"&gt;tx_queue_size&lt;/code&gt; \
attribu&lt;wbr&gt;te controls the size of virtio ring for each queue as described above. \
The default value is hypervisor dependent and may change across its releases. \
Moreover, some hypervisors may pose some restrictions on actual value. For instance, \
QEMU v2.9 requires value to be a power of two from [256, 1024] range. In addition to \
that, this may work only for a subset of interface types, e.g. aforementioned QEMU \
enables this option only for  &lt;code \
style="font-family:LibvirtOverpassMono;background-color:rgb(238,238,238)"&gt;vhostuser&lt;/code&gt; \
type.  &lt;span class="m_3181712413401109781m_5408290801497859655m_-5900777116898549406m_ \
-7501657407322612784m_-6540617163388826959m_5293176283835252071m_-515258420855843595gmail-m_843597909639990587gmail-since" \
style="color:rgb(60,133,124);font-style:italic;font-weight:bold"&gt;Since 3.7.0 (QEMU \
and KVM only)&lt;/span&gt;&lt;/dd&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;multiqueue only supports vhost as backend \
driver.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# rpm -q libvirt \
qemu-kvm-rhev&lt;/div&gt;&lt;div&gt;libvirt-3.2.0-14.el7_4.3.x86_6&lt;wbr&gt;4&lt;/div&gt;&lt;div&gt;qemu-kvm-rhev-2.9.0-16.el7_4.9&lt;wbr&gt;.x86_64&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1. \
the xml as below&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;div&gt;     &lt;interface \
type='direct'&gt;&lt;/div&gt;&lt;div&gt;         &lt;mac \
address='52:54:00:00:b5:99'/&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;         &lt;source \
dev='eno1' mode='vepa'/&gt;&lt;/div&gt;&lt;span&gt;&lt;div&gt;         &lt;model \
type='virtio'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;driver name='vhost' \
queues='5' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;/div&gt;&lt;div&gt;            &lt;host csum='off' \
gso='off' tso4='off' tso6='off' ecn='off' \
ufo='off' mrg_rxbuf='off'/&gt;&lt;/div&gt;&lt;div&gt;            &lt;guest \
csum='off' tso4='off' tso6='off' ecn='off' \
ufo='off'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;/driver&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;         \
&lt;address type='pci' domain='0x0000' bus='0x00' \
slot='0x03' function='0x0'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/interface&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2. after start the vm, check the \
qemu command line:&lt;/div&gt;&lt;div&gt;&lt;b&gt;-netdev \
tap,fds=26:28:29:30:31,id=host&lt;wbr&gt;net0,vhost=on,vhostfds=32:33:3&lt;wbr&gt;4:35:36&lt;/b&gt; \
-device virtio-net-pci,csum=off,gso=of&lt;wbr&gt;f,host_tso4=off,host_tso6=off,&lt;wbr&gt;host_ecn \
=off,host_ufo=off,mrg_&lt;wbr&gt;rxbuf=off,guest_csum=off,guest&lt;wbr&gt;_tso4=off,guest_tso6=off \
,guest&lt;wbr&gt;_ecn=off,guest_ufo=off,&lt;b&gt;mq=on,v&lt;wbr&gt;ectors=12,rx_queue_size=512,tx&lt;wbr&gt;_q \
ueue_size=512&lt;/b&gt;,netdev=hostnet&lt;wbr&gt;0,id=net0,mac=52:54:00:00:b5:9&lt;wbr&gt;9,bus=pci.0,addr=0x3 \
&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3. check on guest&lt;/div&gt;&lt;div&gt;&lt;div&gt;# ethtool -g \
eth0&lt;/div&gt;&lt;div&gt;Ring parameters for eth0:&lt;/div&gt;&lt;div&gt;Pre-set \
maximums:&lt;/div&gt;&lt;div&gt;RX:&lt;span style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;512 ==&gt; \
rx_queue_size works&lt;/b&gt;&lt;/div&gt;&lt;span&gt;&lt;div&gt;RX Mini:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;RX Jumbo:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;/span&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;256    ===&gt; no \
change&lt;/b&gt;&lt;/div&gt;&lt;div&gt;Current hardware settings:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;512  &lt;/b&gt;&lt;b&gt;==&gt; rx_queue_size \
works&lt;/b&gt;&lt;/div&gt;&lt;span&gt;&lt;div&gt;RX Mini:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;RX Jumbo:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;/span&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;256 ===&gt; no \
change&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# ethtool -l eth0&lt;/div&gt;&lt;div&gt;Channel \
parameters for eth0:&lt;/div&gt;&lt;div&gt;Pre-set maximums:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Other:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Combined:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;&lt;b&gt;5   ==&gt; queues what we \
set&lt;/b&gt;&lt;/div&gt;&lt;div&gt;Current hardware settings:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Other:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Combined:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;1&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If \
change to qemu as driver,  &lt;/div&gt;&lt;div&gt;# virsh edit \
rhel7&lt;br&gt;&lt;/div&gt;&lt;div&gt;..&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;div&gt;   &lt;interface \
type='direct'&gt;&lt;/div&gt;&lt;div&gt;         &lt;mac \
address='52:54:00:00:b5:99'/&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;         &lt;source \
dev='eno1' mode='vepa'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;model \
type='virtio'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;driver name='qemu' \
queues='5' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;/div&gt;&lt;span&gt;&lt;div&gt;            &lt;host \
csum='off' gso='off' tso4='off' tso6='off' \
ecn='off' ufo='off' mrg_rxbuf='off'/&gt;&lt;/div&gt;&lt;div&gt;           \
&lt;guest csum='off' tso4='off' tso6='off' ecn='off' \
ufo='off'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;/driver&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;         \
&lt;address type='pci' domain='0x0000' bus='0x00' \
slot='0x03' function='0x0'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/interface&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;..&lt;/div&gt;&lt;div&gt;Domain rhel7 XML configuration \
edited. ==&gt; the xml can validate and save&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# \
virsh start rhel7&lt;/div&gt;&lt;div&gt;Domain rhel7 \
started&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# virsh dumpxml rhel7 | \
grep /interface -B9&lt;/div&gt;&lt;div&gt;         &lt;source dev='eno1' \
mode='vepa'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;target \
dev='macvtap0'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;model \
&lt;br&gt;&lt;div class="gmail_quote"&gt;&lt;div&gt;&lt;div \
class="m_3181712413401109781m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-6540617163388826959m_5293176283835252071h5"&gt;On \
Thu, Oct 26, 2017 at 2:33 AM, Ashish Kurian &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:ashishbnv@gmail.com" target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; \
wrote:&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div&gt;&lt;div \
class="m_3181712413401109781m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-6540617163388826959m_5293176283835252071h5"&gt;&lt;div \
dir="ltr"&gt;Hi Michal,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;An update to what I have already said : when \
I try adding  &lt;span style="font-size:12.8px"&gt;&lt;driver name='qemu' \
txmode='iothread' ioeventfd='on' event_idx='off' \
queues='1' rx_queue_size='512' tx_queue_size='512'&gt; \
although it showed me the error as mentioned, when I checked the xml again I saw that \
&lt;/span&gt;&lt;span style="font-size:12.8px"&gt;&lt;driver name='qemu' \
txmode='iothread' ioeventfd='on' event_idx='off' &gt; is \
added to the interface.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;The \
missing parameters are :  &lt;/span&gt;&lt;span style="font-size:12.8px"&gt;queues='1' \
rx_queue_size='512' tx_queue_size='512'&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_3181712413401109781m_5408290801497859655m_-5900777116898549406m_-750165740732 \
2612784m_-6540617163388826959m_5293176283835252071m_-515258420855843595m_-212787898175025196gmail_signature" \
data-smartmail="gmail_signature"&gt;Best Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div \
class="m_3181712413401109781m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-6540617163388826959m_5293176283835252071m_-515258420855843595h5"&gt;
 &lt;br&gt;&lt;div class="gmail_quote"&gt;On Wed, Oct 25, 2017 at 5:07 PM, Ashish Kurian &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:ashishbnv@gmail.com" \
target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Michal,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What I found was \
that when I restarted the machine and did a virsh edit command to see the xml config, \
I see that it is was not actually changed. This suggests why I saw 256 again after \
restarting.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So now I tried again to edit the xml via virsh \
edit command and used the following to set the \
parameters.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;driver name='qemu' \
txmode='iothread' ioeventfd='on' event_idx='off' \
queues='1' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/driver&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It \
was not accepted and I got the error saying \
:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;error: XML document failed to validate \
against schema: Unable to validate doc against \
/usr/share/libvirt/schemas/dom&lt;wbr&gt;ain.rng&lt;/div&gt;&lt;div&gt;Extra element devices in \
interleave&lt;/div&gt;&lt;div&gt;Element domain failed to validate \
content&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What does this imply? I have two more other \
interfaces and do I have to the same to them also?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Btw, \
there are now logs generated now in the domain log or libvirtd \
log&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_3181712413401109781m_5408290801497859655m_-5900777116898549406m_-750165740732 \
2612784m_-6540617163388826959m_5293176283835252071m_-515258420855843595m_-212787898175025196m_8788737298834798581gmail_signature" \
data-smartmail="gmail_signature"&gt;Best Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div \
class="m_3181712413401109781m_5408290801497859655m_-5900777116898549406m_-750165740732 \
2612784m_-6540617163388826959m_5293176283835252071m_-515258420855843595m_-212787898175025196h5"&gt;
 &lt;br&gt;&lt;div class="gmail_quote"&gt;On Wed, Oct 25, 2017 at 2:50 PM, Michal Privoznik &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:mprivozn@redhat.com" \
target="_blank"&gt;mprivozn@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div \
class="m_3181712413401109781m_5408290801497859655m_-5900777116898549406m_-750165740732 \
2612784m_-6540617163388826959m_5293176283835252071m_-515258420855843595m_-212787898175025196m_8788737298834798581HOEnZb"&gt;&lt;div \
class="m_3181712413401109781m_5408290801497859655m_-5900777116898549406m_-750165740732 \
2612784m_-6540617163388826959m_5293176283835252071m_-515258420855843595m_-212787898175025196m_8788737298834798581h5"&gt;On \
10/25/2017 01:53 PM, Ashish Kurian wrote:&lt;br&gt; &gt; Dear Users/Developers,&lt;br&gt;
&gt;&lt;br&gt;
&gt; I am using a KVM Ubuntu VM as a degrader to apply specific delays to&lt;br&gt;
&gt; incoming packets. As the delay for my packets can be higher than 7.5&lt;br&gt;
&gt; seconds, there is not enough buffer on my interface to buffer all the&lt;br&gt;
&gt; packets. Therefore those overflowing packets are dropped in the machine and&lt;br&gt;
&gt; not forwarded.&lt;br&gt;
&gt;&lt;br&gt;
&gt; When I tried to use the command   ethtool -G ens8 rx 512 to increase the&lt;br&gt;
&gt; buffer size, I get the following error.&lt;br&gt;
&gt;&lt;br&gt;
&gt; Cannot set device ring parameters: Operation not permitted&lt;br&gt;
&gt;&lt;br&gt;
&gt; I have kept the VM xml files as specified in the link :&lt;br&gt;
&gt; &lt;a href="https://libvirt.org/formatdomain.html" rel="noreferrer" \
target="_blank"&gt;https://libvirt.org/formatdoma&lt;wbr&gt;in.html&lt;/a&gt;. The value that I kept \
in my xml file&lt;br&gt; &gt; is as follows.&lt;br&gt;
&gt;&lt;br&gt;
&gt; &lt;interface type='direct'&gt;&lt;br&gt;
&gt;           &lt;mac address='52:54:00:72:f9:eb'/&gt;&lt;br&gt;
&gt;           &lt;source dev='enp7s0f0' mode='vepa'/&gt;&lt;br&gt;
&gt;           &lt;model type='virtio'/&gt;&lt;br&gt;
&gt;           &lt;driver name='vhost' queues='5' \
rx_queue_size='512'&lt;br&gt; &gt; tx_queue_size='512'&gt;&lt;br&gt;
&gt;           &lt;host csum='off' gso='off' tso4='off' \
tso6='off' ecn='off' ufo='off'&lt;br&gt; &gt; \
mrg_rxbuf='off'/&gt;&lt;br&gt; &gt;           &lt;guest csum='off' \
tso4='off' tso6='off' ecn='off' ufo='off'/&gt;&lt;br&gt; \
&gt;           &lt;/driver&gt;&lt;br&gt; &gt;           &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x08'&lt;br&gt; &gt; \
function='0x0'/&gt;&lt;br&gt; &gt;        &lt;/interface&gt;&lt;br&gt;
&gt;        &lt;interface type='direct'&gt;&lt;br&gt;
&gt;           &lt;mac address='52:54:00:00:b5:99'/&gt;&lt;br&gt;
&gt;           &lt;source dev='enp7s0f1' mode='vepa'/&gt;&lt;br&gt;
&gt;           &lt;model type='virtio'/&gt;&lt;br&gt;
&gt;           &lt;driver name='vhost' queues='5' \
rx_queue_size='512'&lt;br&gt; &gt; tx_queue_size='512'&gt;&lt;br&gt;
&gt;           &lt;host csum='off' gso='off' tso4='off' \
tso6='off' ecn='off' ufo='off'&lt;br&gt; &gt; \
mrg_rxbuf='off'/&gt;&lt;br&gt; &gt;           &lt;guest csum='off' \
tso4='off' tso6='off' ecn='off' ufo='off'/&gt;&lt;br&gt; \
&gt;           &lt;/driver&gt;&lt;br&gt; &gt;           &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x09'&lt;br&gt; &gt; \
function='0x0'/&gt;&lt;br&gt; &lt;br&gt;
&lt;/div&gt;&lt;/div&gt;So what does the qemu command line look like? You can find it in \
either&lt;br&gt; libvirtd log or domain log.&lt;br&gt;
&lt;br&gt;
&lt;a href="http://wiki.libvirt.org/page/DebugLogs" rel="noreferrer" \
target="_blank"&gt;http://wiki.libvirt.org/page/D&lt;wbr&gt;ebugLogs&lt;/a&gt;&lt;br&gt; &lt;span \
class="m_3181712413401109781m_5408290801497859655m_-5900777116898549406m_-750165740732 \
2612784m_-6540617163388826959m_5293176283835252071m_-515258420855843595m_-212787898175025196m_8788737298834798581HOEnZb"&gt;&lt;font \
color="#888888"&gt;&lt;br&gt; Michal&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;br&gt;&lt;/div&gt;&lt;/div&gt;______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
 &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20171026083848</emailId><senderName>Ashish Kurian</senderName><senderEmail>ashishbnv@gmail.com</senderEmail><timestampReceived>2017-10-26 08:38:48-0400</timestampReceived><subject>Re: [libvirt-users] Need to increase the rx and tx buffer size of my interface</subject><body>

Hi Yalan and Michal,

Thank you for your response. So what I understand is that I can change
rx_queue size even if I use direct type interface and qemu driver as long
as the driver is virtio. Am I right? If that is the case why am I getting
the error saying that

error: XML document failed to validate against schema: Unable to validate
doc against /usr/share/libvirt/schemas/domain.rng
Extra element devices in interleave
Element domain failed to validate content

for the following xml config? Btw I changed vepa to bridged mode hoping it
would help me. Also note that I tried the following without any driver name
and it still failed.


&lt;interface type='direct'&gt;
      &lt;mac address='52:54:00:72:f9:eb'/&gt;
      &lt;source dev='enp7s0f0' mode='bridge'/&gt;
      &lt;model type='virtio'/&gt;
      &lt;driver name='qemu' queues='5' rx_queue_size='512'&gt;
        &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
ufo='off' mrg_rxbuf='off'/&gt;
        &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
      &lt;/driver&gt;


Best Regards,
Ashish Kurian

On Thu, Oct 26, 2017 at 10:01 AM, Yalan Zhang &lt;yalzhang@redhat.com&gt; wrote:

&gt; Hi Ashish,
&gt;
&gt; IMO, it is yes, no way to increase tx_queue_size for direct type interface
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; -------
&gt; Best Regards,
&gt; Yalan Zhang
&gt; IRC: yalzhang
&gt; Internal phone: 8389413
&gt;
&gt; On Thu, Oct 26, 2017 at 3:38 PM, Ashish Kurian &lt;ashishbnv@gmail.com&gt;
&gt; wrote:
&gt;
&gt;&gt; Hi Yalan,
&gt;&gt;
&gt;&gt; In the previous email you mentioned "tx_queue_size='512' will not work
&gt;&gt; in the guest with direct type interface, in fact, no matter what you set,
&gt;&gt; it will not work and guest will get the default '256'. "
&gt;&gt;
&gt;&gt; So if I am using macvtap for my interfaces, then the device type will
&gt;&gt; always be direct type. Does it mean that there is no way I can increase the
&gt;&gt; buffer size with the macvtap interfaces?
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; Best Regards,
&gt;&gt; Ashish Kurian
&gt;&gt;
&gt;&gt; On Thu, Oct 26, 2017 at 9:04 AM, Ashish Kurian &lt;ashishbnv@gmail.com&gt;
&gt;&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; Hi Yalan,
&gt;&gt;&gt;
&gt;&gt;&gt; Thank you for your comment on qemu-kvm-rhev
&gt;&gt;&gt;
&gt;&gt;&gt; I am waiting for a response about my previous email with the logs
&gt;&gt;&gt; attached. I do not understand what is the problem.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Oct 26, 2017 8:58 AM, "Yalan Zhang" &lt;yalzhang@redhat.com&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Hi Ashish,
&gt;&gt;&gt;
&gt;&gt;&gt; Please never mind for qemu-kvm-rhev.
&gt;&gt;&gt; qemu with the code base 2.10.0 will support the tx_queue_size and
&gt;&gt;&gt; rx_queue_size.
&gt;&gt;&gt;
&gt;&gt;&gt; Thank you~
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; -------
&gt;&gt;&gt; Best Regards,
&gt;&gt;&gt; Yalan Zhang
&gt;&gt;&gt; IRC: yalzhang
&gt;&gt;&gt; Internal phone: 8389413
&gt;&gt;&gt;
&gt;&gt;&gt; On Thu, Oct 26, 2017 at 2:22 PM, Yalan Zhang &lt;yalzhang@redhat.com&gt;
&gt;&gt;&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi Ashish,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Are these packages available for free? How can I install them?
&gt;&gt;&gt;&gt; =&gt; You did have vhost backend driver. Do not set &lt;driver
&gt;&gt;&gt;&gt; name='qemu'...&gt;, by default it will use vhost as backend driver.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;  Is it possible to have my interfaces with an IP address inside the VM
&gt;&gt;&gt;&gt; to be bridged to the physical interfaces on the host?
&gt;&gt;&gt;&gt; =&gt; Yes, you can create a linux bridge with physical interface
&gt;&gt;&gt;&gt; connected, and use bridge type interface. Refer to
&gt;&gt;&gt;&gt; https://libvirt.org/formatdomain.html#elementsNICSBridge
&gt;&gt;&gt;&gt; direct type is also ok (but your host and guest have no access to each
&gt;&gt;&gt;&gt; other).
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Is it also a possibility that I change the rx and tx buffer on the
&gt;&gt;&gt;&gt; physical interface on the host and it is reflected automatically inside the
&gt;&gt;&gt;&gt; VM as you said it will always receive the default value of the host?
&gt;&gt;&gt;&gt; =&gt; No, it do not receive the default value of the host. It's the
&gt;&gt;&gt;&gt; default value related with the virtual device driver on the guest.
&gt;&gt;&gt;&gt; hostdev type interface will passthrough the physical interface or VF of
&gt;&gt;&gt;&gt; the host to guest, it will get the device's parameters for rx and tx buffer.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; -------
&gt;&gt;&gt;&gt; Best Regards,
&gt;&gt;&gt;&gt; Yalan Zhang
&gt;&gt;&gt;&gt; IRC: yalzhang
&gt;&gt;&gt;&gt; Internal phone: 8389413
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Thu, Oct 26, 2017 at 1:30 PM, Ashish Kurian &lt;ashishbnv@gmail.com&gt;
&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Hi Yalan,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Thank you for your response. I do not have the following packages
&gt;&gt;&gt;&gt;&gt; installed
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; vhost backend driver
&gt;&gt;&gt;&gt;&gt; qemu-kvm-rhev package
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Are these packages available for free? How can I install them?
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; In my KVM VM, I must have an IP address to the interfaces that I am
&gt;&gt;&gt;&gt;&gt; trying to increasing the buffers. That is the reason I was using macvtap
&gt;&gt;&gt;&gt;&gt; (direct type interface). Is it possible to have my interfaces with an IP
&gt;&gt;&gt;&gt;&gt; address inside the VM to be bridged to the physical interfaces on the host?
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Is it also a possibility that I change the rx and tx buffer on the
&gt;&gt;&gt;&gt;&gt; physical interface on the host and it is reflected automatically inside the
&gt;&gt;&gt;&gt;&gt; VM as you said it will always receive the default value of the host?
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Best Regards,
&gt;&gt;&gt;&gt;&gt; Ashish Kurian
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On Thu, Oct 26, 2017 at 6:45 AM, Yalan Zhang &lt;yalzhang@redhat.com&gt;
&gt;&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Hi Ashish,
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; I have tested with your xml in the first mail, and it works for rx_queue_size(see
&gt;&gt;&gt;&gt;&gt;&gt; below).
&gt;&gt;&gt;&gt;&gt;&gt; multiqueue need to work with vhost backend driver. And when you set
&gt;&gt;&gt;&gt;&gt;&gt; "queues=1" it will ignored.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Please check your qemu-kvm-rhev package, should be newer than
&gt;&gt;&gt;&gt;&gt;&gt; qemu-kvm-rhev-2.9.0-16.el7_4.2
&gt;&gt;&gt;&gt;&gt;&gt; And the logs?
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; tx_queue_size='512' will not work in the guest with direct type
&gt;&gt;&gt;&gt;&gt;&gt; interface, in fact, no matter what you set, it will not work and guest will
&gt;&gt;&gt;&gt;&gt;&gt; get the default '256'.
&gt;&gt;&gt;&gt;&gt;&gt; We only support vhost-user backend to have more than 256. refer to
&gt;&gt;&gt;&gt;&gt;&gt; https://libvirt.org/formatdomain.html#elementsNICSEthernet
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; tx_queue_size
&gt;&gt;&gt;&gt;&gt;&gt; The optional tx_queue_size attribute controls the size of virtio
&gt;&gt;&gt;&gt;&gt;&gt; ring for each queue as described above. The default value is hypervisor
&gt;&gt;&gt;&gt;&gt;&gt; dependent and may change across its releases. Moreover, some hypervisors
&gt;&gt;&gt;&gt;&gt;&gt; may pose some restrictions on actual value. For instance, QEMU v2.9
&gt;&gt;&gt;&gt;&gt;&gt; requires value to be a power of two from [256, 1024] range. In addition to
&gt;&gt;&gt;&gt;&gt;&gt; that, this may work only for a subset of interface types, e.g.
&gt;&gt;&gt;&gt;&gt;&gt; aforementioned QEMU enables this option only for vhostuser type. Since
&gt;&gt;&gt;&gt;&gt;&gt; 3.7.0 (QEMU and KVM only)
&gt;&gt;&gt;&gt;&gt;&gt; multiqueue only supports vhost as backend driver.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; # rpm -q libvirt qemu-kvm-rhev
&gt;&gt;&gt;&gt;&gt;&gt; libvirt-3.2.0-14.el7_4.3.x86_64
&gt;&gt;&gt;&gt;&gt;&gt; qemu-kvm-rhev-2.9.0-16.el7_4.9.x86_64
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; 1. the xml as below
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;interface type='direct'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       &lt;mac address='52:54:00:00:b5:99'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       &lt;source dev='eno1' mode='vepa'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt;&gt;&gt;&gt;&gt;&gt; tx_queue_size='512'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;         &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt;&gt;&gt; ufo='off' mrg_rxbuf='off'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;         &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       &lt;/driver&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
&gt;&gt;&gt;&gt;&gt;&gt; function='0x0'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;     &lt;/interface&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; 2. after start the vm, check the qemu command line:
&gt;&gt;&gt;&gt;&gt;&gt; *-netdev
&gt;&gt;&gt;&gt;&gt;&gt; tap,fds=26:28:29:30:31,id=hostnet0,vhost=on,vhostfds=32:33:34:35:36*
&gt;&gt;&gt;&gt;&gt;&gt; -device virtio-net-pci,csum=off,gso=off,host_tso4=off,host_tso6=off,
&gt;&gt;&gt;&gt;&gt;&gt; host_ecn=off,host_ufo=off,mrg_rxbuf=off,guest_csum=off,guest
&gt;&gt;&gt;&gt;&gt;&gt; _tso4=off,guest_tso6=off,guest_ecn=off,guest_ufo=off,
&gt;&gt;&gt;&gt;&gt;&gt; *mq=on,vectors=12,rx_queue_size=512,tx_queue_size=512*,netdev=hostnet
&gt;&gt;&gt;&gt;&gt;&gt; 0,id=net0,mac=52:54:00:00:b5:99,bus=pci.0,addr=0x3
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; 3. check on guest
&gt;&gt;&gt;&gt;&gt;&gt; # ethtool -g eth0
&gt;&gt;&gt;&gt;&gt;&gt; Ring parameters for eth0:
&gt;&gt;&gt;&gt;&gt;&gt; Pre-set maximums:
&gt;&gt;&gt;&gt;&gt;&gt; RX: *512 ==&gt; rx_queue_size works*
&gt;&gt;&gt;&gt;&gt;&gt; RX Mini: 0
&gt;&gt;&gt;&gt;&gt;&gt; RX Jumbo: 0
&gt;&gt;&gt;&gt;&gt;&gt; TX: *256   ===&gt; no change*
&gt;&gt;&gt;&gt;&gt;&gt; Current hardware settings:
&gt;&gt;&gt;&gt;&gt;&gt; RX: *512 **==&gt; rx_queue_size works*
&gt;&gt;&gt;&gt;&gt;&gt; RX Mini: 0
&gt;&gt;&gt;&gt;&gt;&gt; RX Jumbo: 0
&gt;&gt;&gt;&gt;&gt;&gt; TX: *256 ===&gt; no change*
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; # ethtool -l eth0
&gt;&gt;&gt;&gt;&gt;&gt; Channel parameters for eth0:
&gt;&gt;&gt;&gt;&gt;&gt; Pre-set maximums:
&gt;&gt;&gt;&gt;&gt;&gt; RX: 0
&gt;&gt;&gt;&gt;&gt;&gt; TX: 0
&gt;&gt;&gt;&gt;&gt;&gt; Other: 0
&gt;&gt;&gt;&gt;&gt;&gt; Combined: *5  ==&gt; queues what we set*
&gt;&gt;&gt;&gt;&gt;&gt; Current hardware settings:
&gt;&gt;&gt;&gt;&gt;&gt; RX: 0
&gt;&gt;&gt;&gt;&gt;&gt; TX: 0
&gt;&gt;&gt;&gt;&gt;&gt; Other: 0
&gt;&gt;&gt;&gt;&gt;&gt; Combined: 1
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; If change to qemu as driver,
&gt;&gt;&gt;&gt;&gt;&gt; # virsh edit rhel7
&gt;&gt;&gt;&gt;&gt;&gt; ..
&gt;&gt;&gt;&gt;&gt;&gt;   &lt;interface type='direct'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       &lt;mac address='52:54:00:00:b5:99'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       &lt;source dev='eno1' mode='vepa'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       &lt;driver name='qemu' queues='5' rx_queue_size='512'
&gt;&gt;&gt;&gt;&gt;&gt; tx_queue_size='512'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;         &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt;&gt;&gt; ufo='off' mrg_rxbuf='off'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;         &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       &lt;/driver&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
&gt;&gt;&gt;&gt;&gt;&gt; function='0x0'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;     &lt;/interface&gt;
&gt;&gt;&gt;&gt;&gt;&gt; ..
&gt;&gt;&gt;&gt;&gt;&gt; Domain rhel7 XML configuration edited. ==&gt; the xml can validate and
&gt;&gt;&gt;&gt;&gt;&gt; save
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; # virsh start rhel7
&gt;&gt;&gt;&gt;&gt;&gt; Domain rhel7 started
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; # virsh dumpxml rhel7 | grep /interface -B9
&gt;&gt;&gt;&gt;&gt;&gt;       &lt;source dev='eno1' mode='vepa'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       &lt;target dev='macvtap0'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       *&lt;driver name='qemu' queues='5' rx_queue_size='512'
&gt;&gt;&gt;&gt;&gt;&gt; tx_queue_size='512'&gt;*
&gt;&gt;&gt;&gt;&gt;&gt;         &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt;&gt;&gt; ufo='off' mrg_rxbuf='off'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;         &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       &lt;/driver&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       &lt;alias name='net0'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
&gt;&gt;&gt;&gt;&gt;&gt; function='0x0'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;     &lt;/interface&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; * -netdev tap,fds=26:28:29:30:31*,id=hostnet0 -device
&gt;&gt;&gt;&gt;&gt;&gt; virtio-net-pci,csum=off,gso=off,host_tso4=off,host_tso6=off,
&gt;&gt;&gt;&gt;&gt;&gt; host_ecn=off,host_ufo=off,mrg_rxbuf=off,guest_csum=off,guest
&gt;&gt;&gt;&gt;&gt;&gt; _tso4=off,guest_tso6=off,guest_ecn=off,guest_ufo=off,
&gt;&gt;&gt;&gt;&gt;&gt; *rx_queue_size=512,tx_queue_size=512*,netdev=hostnet0,id=net0,mac=52:
&gt;&gt;&gt;&gt;&gt;&gt; 54:00:00:b5:99,bus=pci.0,addr=0x3
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; *"mq=on,vectors=12" is missing*, indicates there is no multiqueue
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; and check on guest
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; # ethtool -l eth0
&gt;&gt;&gt;&gt;&gt;&gt; Channel parameters for eth0:
&gt;&gt;&gt;&gt;&gt;&gt; Pre-set maximums:
&gt;&gt;&gt;&gt;&gt;&gt; RX: 0
&gt;&gt;&gt;&gt;&gt;&gt; TX: 0
&gt;&gt;&gt;&gt;&gt;&gt; Other: 0
&gt;&gt;&gt;&gt;&gt;&gt; Combined: 1  ==&gt; no multiqueue
&gt;&gt;&gt;&gt;&gt;&gt; Current hardware settings:
&gt;&gt;&gt;&gt;&gt;&gt; RX: 0
&gt;&gt;&gt;&gt;&gt;&gt; TX: 0
&gt;&gt;&gt;&gt;&gt;&gt; Other: 0
&gt;&gt;&gt;&gt;&gt;&gt; Combined: 1
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; # ethtool -g eth0
&gt;&gt;&gt;&gt;&gt;&gt; Ring parameters for eth0:
&gt;&gt;&gt;&gt;&gt;&gt; Pre-set maximums:
&gt;&gt;&gt;&gt;&gt;&gt; RX: *512*
&gt;&gt;&gt;&gt;&gt;&gt; RX Mini: 0
&gt;&gt;&gt;&gt;&gt;&gt; RX Jumbo: 0
&gt;&gt;&gt;&gt;&gt;&gt; TX: 256
&gt;&gt;&gt;&gt;&gt;&gt; Current hardware settings:
&gt;&gt;&gt;&gt;&gt;&gt; RX: *512*
&gt;&gt;&gt;&gt;&gt;&gt; RX Mini: 0
&gt;&gt;&gt;&gt;&gt;&gt; RX Jumbo: 0
&gt;&gt;&gt;&gt;&gt;&gt; TX: 256
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; -------
&gt;&gt;&gt;&gt;&gt;&gt; Best Regards,
&gt;&gt;&gt;&gt;&gt;&gt; Yalan Zhang
&gt;&gt;&gt;&gt;&gt;&gt; IRC: yalzhang
&gt;&gt;&gt;&gt;&gt;&gt; Internal phone: 8389413
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; On Thu, Oct 26, 2017 at 2:33 AM, Ashish Kurian &lt;ashishbnv@gmail.com&gt;
&gt;&gt;&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Hi Michal,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; An update to what I have already said : when I try adding &lt;driver
&gt;&gt;&gt;&gt;&gt;&gt;&gt; name='qemu' txmode='iothread' ioeventfd='on' event_idx='off' queues='1'
&gt;&gt;&gt;&gt;&gt;&gt;&gt; rx_queue_size='512' tx_queue_size='512'&gt; although it showed me the error as
&gt;&gt;&gt;&gt;&gt;&gt;&gt; mentioned, when I checked the xml again I saw that &lt;driver
&gt;&gt;&gt;&gt;&gt;&gt;&gt; name='qemu' txmode='iothread' ioeventfd='on' event_idx='off' &gt; is added to
&gt;&gt;&gt;&gt;&gt;&gt;&gt; the interface.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; The missing parameters are : queues='1' rx_queue_size='512'
&gt;&gt;&gt;&gt;&gt;&gt;&gt; tx_queue_size='512'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Best Regards,
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Ashish Kurian
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; On Wed, Oct 25, 2017 at 5:07 PM, Ashish Kurian &lt;ashishbnv@gmail.com&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Hi Michal,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; What I found was that when I restarted the machine and did a virsh
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; edit command to see the xml config, I see that it is was not actually
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; changed. This suggests why I saw 256 again after restarting.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; So now I tried again to edit the xml via virsh edit command and
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; used the following to set the parameters.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &lt;driver name='qemu' txmode='iothread' ioeventfd='on'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; event_idx='off' queues='1' rx_queue_size='512' tx_queue_size='512'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &lt;/driver&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; It was not accepted and I got the error saying :
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; error: XML document failed to validate against schema: Unable to
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; validate doc against /usr/share/libvirt/schemas/domain.rng
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Extra element devices in interleave
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Element domain failed to validate content
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; What does this imply? I have two more other interfaces and do I
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; have to the same to them also?
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Btw, there are now logs generated now in the domain log or libvirtd
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; log
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Best Regards,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Ashish Kurian
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; On Wed, Oct 25, 2017 at 2:50 PM, Michal Privoznik &lt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; mprivozn@redhat.com&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; On 10/25/2017 01:53 PM, Ashish Kurian wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; Dear Users/Developers,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; I am using a KVM Ubuntu VM as a degrader to apply specific
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; delays to
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; incoming packets. As the delay for my packets can be higher than
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 7.5
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; seconds, there is not enough buffer on my interface to buffer
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; all the
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; packets. Therefore those overflowing packets are dropped in the
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; machine and
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; not forwarded.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; When I tried to use the command  ethtool -G ens8 rx 512 to
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; increase the
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; buffer size, I get the following error.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; Cannot set device ring parameters: Operation not permitted
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; I have kept the VM xml files as specified in the link :
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; https://libvirt.org/formatdomain.html. The value that I kept in
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; my xml file
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; is as follows.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; &lt;interface type='direct'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;mac address='52:54:00:72:f9:eb'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;source dev='enp7s0f0' mode='vepa'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; tx_queue_size='512'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; ufo='off'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; mrg_rxbuf='off'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;guest csum='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; ufo='off'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;/driver&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; function='0x0'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;     &lt;/interface&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;     &lt;interface type='direct'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;mac address='52:54:00:00:b5:99'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;source dev='enp7s0f1' mode='vepa'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;driver name='vhost' queues='5' rx_queue_size='512'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; tx_queue_size='512'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; ufo='off'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; mrg_rxbuf='off'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;guest csum='off' tso4='off' tso6='off' ecn='off'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; ufo='off'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;/driver&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x09'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; function='0x0'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; So what does the qemu command line look like? You can find it in
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; either
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; libvirtd log or domain log.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://wiki.libvirt.org/page/DebugLogs
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Michal
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt;&gt;&gt;&gt;&gt; libvirt-users mailing list
&gt;&gt;&gt;&gt;&gt;&gt;&gt; libvirt-users@redhat.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;Hi Yalan and Michal,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank you for your \
response. So what I understand is that I can change rx_queue size even if I use \
direct type interface and qemu driver as long as the driver is virtio. Am I right? If \
that is the case why am I getting the error saying that  \
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;error: XML document failed to validate against schema: \
Unable to validate doc against /usr/share/libvirt/schemas/domain.rng&lt;/div&gt;&lt;div&gt;Extra \
element devices in interleave&lt;/div&gt;&lt;div&gt;Element domain failed to validate \
content&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;for the following xml config? Btw I changed \
vepa to bridged mode hoping it would help me. Also note that I tried the following \
without any driver name and it still \
failed.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;interface \
type='direct'&gt;&lt;/div&gt;&lt;div&gt;         &lt;mac \
address='52:54:00:72:f9:eb'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;source \
dev='enp7s0f0' mode='bridge'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;model \
type='virtio'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;driver name='qemu' \
queues='5' rx_queue_size='512'&gt;&lt;/div&gt;&lt;div&gt;            &lt;host \
csum='off' gso='off' tso4='off' tso6='off' \
ecn='off' ufo='off' mrg_rxbuf='off'/&gt;&lt;/div&gt;&lt;div&gt;           \
&lt;guest csum='off' tso4='off' tso6='off' ecn='off' \
ufo='off'/&gt;&lt;/div&gt;&lt;div&gt;         \
&lt;/driver&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br \
clear="all"&gt;&lt;div&gt;&lt;div class="gmail_signature" data-smartmail="gmail_signature"&gt;Best \
Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;div class="gmail_quote"&gt;On Thu, Oct 26, \
2017 at 10:01 AM, Yalan Zhang &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:yalzhang@redhat.com" target="_blank"&gt;yalzhang@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; \
wrote:&lt;br&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px \
#ccc solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div&gt;Hi Ashish,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;IMO, \
it is yes, no way to increase  &lt;span style="font-size:12.8px"&gt;tx_queue_size for \
direct type interface&lt;/span&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;span \
class=""&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div class="m_6066214734943565840gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;br&gt;&lt;br&gt;-------&lt;br&gt;Best Regards,&lt;br&gt;Yalan \
Zhang&lt;br&gt;IRC: yalzhang&lt;br&gt;Internal phone: 8389413&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;/span&gt;&lt;div&gt;&lt;div \
class="h5"&gt;&lt;div class="gmail_quote"&gt;On Thu, Oct 26, 2017 at 3:38 PM, Ashish Kurian \
&lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:ashishbnv@gmail.com" \
target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Yalan,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In the previous \
email you mentioned "&lt;span style="font-size:12.8px"&gt;tx_queue_size='512' \
will not work in the guest with direct type interface, in fact, no matter what you \
set, it will not work and guest will get the default '256'.  \
&lt;/span&gt;"&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So if I am using macvtap for my interfaces, \
then the device type will always be direct type. Does it mean that there is no way I \
can increase the buffer size with the macvtap \
interfaces?&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_6066214734943565840m_3181712413401109781gmail_signature" \
data-smartmail="gmail_signature"&gt;Best Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div \
class="m_6066214734943565840h5"&gt; &lt;br&gt;&lt;div class="gmail_quote"&gt;On Thu, Oct 26, 2017 at \
9:04 AM, Ashish Kurian &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:ashishbnv@gmail.com" \
target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="auto"&gt;Hi Yalan,&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
dir="auto"&gt;Thank you for your comment on qemu-kvm-rhev&lt;/div&gt;&lt;div \
dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;I am waiting for a response about my previous \
email with the logs attached. I do not understand what is the problem.&lt;/div&gt;&lt;div&gt;&lt;div \
class="m_6066214734943565840m_3181712413401109781h5"&gt;&lt;br&gt;&lt;div class="gmail_extra" \
dir="auto"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;On Oct 26, 2017 8:58 AM, "Yalan \
Zhang" &lt;&lt;a href="mailto:yalzhang@redhat.com" \
target="_blank"&gt;yalzhang@redhat.com&lt;/a&gt;&gt; wrote:&lt;br type="attribution"&gt;&lt;blockquote \
class="m_6066214734943565840m_3181712413401109781m_5408290801497859655quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;&lt;div&gt;Hi Ashish,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Please never mind for \
qemu-kvm-rhev.&lt;/div&gt;qemu with the code base 2.10.0 will support the tx_queue_size and \
rx_queue_size.  &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank \
you~&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;div \
class="m_6066214734943565840m_3181712413401109781m_5408290801497859655quoted-text"&gt;&lt;br \
clear="all"&gt;&lt;div&gt;&lt;div \
class="m_6066214734943565840m_3181712413401109781m_5408290801497859655m_-5900777116898549406gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;br&gt;&lt;br&gt;-------&lt;br&gt;Best Regards,&lt;br&gt;Yalan \
Zhang&lt;br&gt;IRC: yalzhang&lt;br&gt;Internal phone: 8389413&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;/div&gt;&lt;div \
class="m_6066214734943565840m_3181712413401109781m_5408290801497859655elided-text"&gt;&lt;div \
class="gmail_quote"&gt;On Thu, Oct 26, 2017 at 2:22 PM, Yalan Zhang &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:yalzhang@redhat.com" \
target="_blank"&gt;yalzhang@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Ashish,  &lt;span&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div \
style="font-size:12.8px"&gt;&lt;span style="font-size:12.8px"&gt;Are these packages available \
for free? How can I install them?&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;=&gt; You did have \
vhost backend driver. Do not set &lt;driver name='qemu'...&gt;, by default it \
will use vhost as backend driver.  &lt;/div&gt;&lt;span&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;  Is it possible to have my interfaces with an IP address \
inside the VM to be bridged to the physical interfaces on the host?  \
&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;=&gt; Yes, you can create a linux bridge with physical \
interface connected, and use bridge type interface. Refer to  &lt;a \
href="https://libvirt.org/formatdomain.html#elementsNICSBridge" \
target="_blank"&gt;https://libvirt.org/formatd&lt;wbr&gt;omain.html#elementsNICSBridge&lt;/a&gt;  \
&lt;br&gt;&lt;/div&gt;&lt;div&gt;direct type is also ok (but your host and guest have no access to each \
other).&lt;/div&gt;&lt;span&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div style="font-size:12.8px"&gt;&lt;span \
style="font-size:12.8px"&gt;Is it also a possibility that I change the rx and tx buffer \
on the physical interface on the host and it is reflected automatically inside the VM \
as you said it will always receive the default value of the \
host?&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;=&gt; No, it do \
not receive the default value of the host. It's the default value related with \
the virtual device driver on the guest.&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;hostdev type interface will passthrough the physical \
interface or VF of the host to guest, it will get the device's parameters for rx \
and tx buffer.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;span&gt;&lt;div&gt;&lt;div \
class="m_6066214734943565840m_3181712413401109781m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-6540617163388826959gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;br&gt;-------&lt;br&gt;Best Regards,&lt;br&gt;Yalan Zhang&lt;br&gt;IRC: \
yalzhang&lt;br&gt;Internal phone: 8389413&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;/span&gt;&lt;div&gt;&lt;div \
class="m_6066214734943565840m_3181712413401109781m_5408290801497859655m_-5900777116898549406h5"&gt;&lt;div \
class="gmail_quote"&gt;On Thu, Oct 26, 2017 at 1:30 PM, Ashish Kurian &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:ashishbnv@gmail.com" \
target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Yalan,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank you for \
your response. I do not have the following packages \
installed&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;vhost backend driver&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;qemu-kvm-rhev package&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;Are \
these packages available for free? How can I install them?&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;In my \
KVM VM, I must have an IP address to the interfaces that I am trying to increasing \
the buffers. That is the reason I was using macvtap (direct type interface). Is it \
possible to have my interfaces with an IP address inside the VM to be bridged to the \
physical interfaces on the host?  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;Is it \
also a possibility that I change the rx and tx buffer on the physical interface on \
the host and it is reflected automatically inside the VM as you said it will always \
receive the default value of the host?&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_6066214734943565840m_3181712413401109781m_5408290801497859655m_-5900777116898 \
549406m_-7501657407322612784m_-6540617163388826959m_5293176283835252071gmail_signature" \
data-smartmail="gmail_signature"&gt;Best Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div \
class="m_6066214734943565840m_3181712413401109781m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-6540617163388826959h5"&gt;
 &lt;br&gt;&lt;div class="gmail_quote"&gt;On Thu, Oct 26, 2017 at 6:45 AM, Yalan Zhang &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:yalzhang@redhat.com" \
target="_blank"&gt;yalzhang@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Ashish,  &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I have tested \
with your xml in the first mail, and it works for  &lt;span \
style="font-size:12.8px"&gt;rx_queue_size(see below)&lt;/span&gt;.  &lt;/div&gt;&lt;div&gt;multiqueue need \
to work with vhost backend driver. And when you set "queues=1" it will \
ignored.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Please check your qemu-kvm-rhev package, should be \
newer than  &lt;span style="color:rgb(51,51,51);font-family:Arial,sans-serif;font-size:14px"&gt;qemu-kvm-rhev-2.9.0-16.el&lt;wbr&gt;7_4.2&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
color="#333333" face="Arial, sans-serif"&gt;&lt;span style="font-size:14px"&gt;And the \
logs?&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="color:rgb(51,51,51);font-family:Arial,sans-serif;font-size:14px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;tx_queue_size='512' \
will not work in the guest with direct type interface, in fact, no matter what you \
set, it will not work and guest will get the default '256'.  \
&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="color:rgb(0,0,0);white-space:pre-wrap"&gt;We only support \
vhost-user backend to have more than 256. &lt;/span&gt;refer to  &lt;a \
href="https://libvirt.org/formatdomain.html#elementsNICSEthernet" \
target="_blank"&gt;https://libvirt.org/formatd&lt;wbr&gt;omain.html#elementsNICSEtherne&lt;wbr&gt;t&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;span \
style="font-family:LibvirtOverpassMono;font-weight:bold;color:rgb(0,0,0);font-size:medium"&gt;tx_queue_size&lt;/span&gt;&lt;/div&gt;&lt;dd \
style="margin-left:2em;margin-right:2em;margin-bottom:0.5em;color:rgb(0,0,0);font-family:LibvirtOverpass;font-size:medium"&gt;The \
optional  &lt;code style="font-family:LibvirtOverpassMono;background-color:rgb(238,238,238)"&gt;tx_queue_size&lt;/code&gt; \
attribu&lt;wbr&gt;te controls the size of virtio ring for each queue as described above. \
The default value is hypervisor dependent and may change across its releases. \
Moreover, some hypervisors may pose some restrictions on actual value. For instance, \
QEMU v2.9 requires value to be a power of two from [256, 1024] range. In addition to \
that, this may work only for a subset of interface types, e.g. aforementioned QEMU \
enables this option only for  &lt;code \
style="font-family:LibvirtOverpassMono;background-color:rgb(238,238,238)"&gt;vhostuser&lt;/code&gt; \
type.  &lt;span class="m_6066214734943565840m_3181712413401109781m_5408290801497859655m_- \
5900777116898549406m_-7501657407322612784m_-6540617163388826959m_5293176283835252071m_-515258420855843595gmail-m_843597909639990587gmail-since" \
style="color:rgb(60,133,124);font-style:italic;font-weight:bold"&gt;Since 3.7.0 (QEMU \
and KVM only)&lt;/span&gt;&lt;/dd&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;multiqueue only supports vhost as backend \
driver.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# rpm -q libvirt \
qemu-kvm-rhev&lt;/div&gt;&lt;div&gt;libvirt-3.2.0-14.el7_4.3.x86_6&lt;wbr&gt;4&lt;/div&gt;&lt;div&gt;qemu-kvm-rhev-2.9.0-16.el7_4.9&lt;wbr&gt;.x86_64&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1. \
the xml as below&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;div&gt;     &lt;interface \
type='direct'&gt;&lt;/div&gt;&lt;div&gt;         &lt;mac \
address='52:54:00:00:b5:99'/&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;         &lt;source \
dev='eno1' mode='vepa'/&gt;&lt;/div&gt;&lt;span&gt;&lt;div&gt;         &lt;model \
type='virtio'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;driver name='vhost' \
queues='5' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;/div&gt;&lt;div&gt;            &lt;host csum='off' \
gso='off' tso4='off' tso6='off' ecn='off' \
ufo='off' mrg_rxbuf='off'/&gt;&lt;/div&gt;&lt;div&gt;            &lt;guest \
csum='off' tso4='off' tso6='off' ecn='off' \
ufo='off'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;/driver&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;         \
&lt;address type='pci' domain='0x0000' bus='0x00' \
slot='0x03' function='0x0'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/interface&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2. after start the vm, check the \
qemu command line:&lt;/div&gt;&lt;div&gt;&lt;b&gt;-netdev \
tap,fds=26:28:29:30:31,id=host&lt;wbr&gt;net0,vhost=on,vhostfds=32:33:3&lt;wbr&gt;4:35:36&lt;/b&gt; \
-device virtio-net-pci,csum=off,gso=of&lt;wbr&gt;f,host_tso4=off,host_tso6=off,&lt;wbr&gt;host_ecn \
=off,host_ufo=off,mrg_&lt;wbr&gt;rxbuf=off,guest_csum=off,guest&lt;wbr&gt;_tso4=off,guest_tso6=off \
,guest&lt;wbr&gt;_ecn=off,guest_ufo=off,&lt;b&gt;mq=on,v&lt;wbr&gt;ectors=12,rx_queue_size=512,tx&lt;wbr&gt;_q \
ueue_size=512&lt;/b&gt;,netdev=hostnet&lt;wbr&gt;0,id=net0,mac=52:54:00:00:b5:9&lt;wbr&gt;9,bus=pci.0,addr=0x3 \
&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3. check on guest&lt;/div&gt;&lt;div&gt;&lt;div&gt;# ethtool -g \
eth0&lt;/div&gt;&lt;div&gt;Ring parameters for eth0:&lt;/div&gt;&lt;div&gt;Pre-set \
maximums:&lt;/div&gt;&lt;div&gt;RX:&lt;span style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;512 ==&gt; \
rx_queue_size works&lt;/b&gt;&lt;/div&gt;&lt;span&gt;&lt;div&gt;RX Mini:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;RX Jumbo:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;/span&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;256    ===&gt; no \
change&lt;/b&gt;&lt;/div&gt;&lt;div&gt;Current hardware settings:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;512  &lt;/b&gt;&lt;b&gt;==&gt; rx_queue_size \
works&lt;/b&gt;&lt;/div&gt;&lt;span&gt;&lt;div&gt;RX Mini:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;RX Jumbo:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;0&lt;/div&gt;&lt;/span&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;&lt;b&gt;256 ===&gt; no \
change&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# ethtool -l eth0&lt;/div&gt;&lt;div&gt;Channel \
parameters for eth0:&lt;/div&gt;&lt;div&gt;Pre-set maximums:&lt;/div&gt;&lt;div&gt;RX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;TX:&lt;span \
style="white-space:pre-wrap"&gt;		&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;Other:&lt;span \
&lt;br&gt;&lt;div class="gmail_quote"&gt;&lt;div&gt;&lt;div \
class="m_6066214734943565840m_3181712413401109781m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-6540617163388826959m_5293176283835252071h5"&gt;On \
Thu, Oct 26, 2017 at 2:33 AM, Ashish Kurian &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:ashishbnv@gmail.com" target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; \
wrote:&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div&gt;&lt;div \
class="m_6066214734943565840m_3181712413401109781m_5408290801497859655m_-5900777116898549406m_-7501657407322612784m_-6540617163388826959m_5293176283835252071h5"&gt;&lt;div \
dir="ltr"&gt;Hi Michal,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;An update to what I have already said : when \
I try adding  &lt;span style="font-size:12.8px"&gt;&lt;driver name='qemu' \
txmode='iothread' ioeventfd='on' event_idx='off' \
queues='1' rx_queue_size='512' tx_queue_size='512'&gt; \
although it showed me the error as mentioned, when I checked the xml again I saw that \
&lt;/span&gt;&lt;span style="font-size:12.8px"&gt;&lt;driver name='qemu' \
txmode='iothread' ioeventfd='on' event_idx='off' &gt; is \
added to the interface.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;The \
missing parameters are :  &lt;/span&gt;&lt;span style="font-size:12.8px"&gt;queues='1' \
rx_queue_size='512' tx_queue_size='512'&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_6066214734943565840m_3181712413401109781m_5408290801497859655m_-5900777116898 \
549406m_-7501657407322612784m_-6540617163388826959m_5293176283835252071m_-515258420855843595m_-212787898175025196gmail_signature" \
data-smartmail="gmail_signature"&gt;Best Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div \
class="m_6066214734943565840m_3181712413401109781m_5408290801497859655m_-5900777116898 \
549406m_-7501657407322612784m_-6540617163388826959m_5293176283835252071m_-515258420855843595h5"&gt;
 &lt;br&gt;&lt;div class="gmail_quote"&gt;On Wed, Oct 25, 2017 at 5:07 PM, Ashish Kurian &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:ashishbnv@gmail.com" \
target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Michal,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What I found was \
that when I restarted the machine and did a virsh edit command to see the xml config, \
I see that it is was not actually changed. This suggests why I saw 256 again after \
restarting.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So now I tried again to edit the xml via virsh \
edit command and used the following to set the \
parameters.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;driver name='qemu' \
txmode='iothread' ioeventfd='on' event_idx='off' \
queues='1' rx_queue_size='512' \
tx_queue_size='512'&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/driver&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It \
was not accepted and I got the error saying \
:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;error: XML document failed to validate \
against schema: Unable to validate doc against \
/usr/share/libvirt/schemas/dom&lt;wbr&gt;ain.rng&lt;/div&gt;&lt;div&gt;Extra element devices in \
interleave&lt;/div&gt;&lt;div&gt;Element domain failed to validate \
content&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What does this imply? I have two more other \
interfaces and do I have to the same to them also?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Btw, \
there are now logs generated now in the domain log or libvirtd \
log&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_6066214734943565840m_3181712413401109781m_5408290801497859655m_-5900777116898 \
549406m_-7501657407322612784m_-6540617163388826959m_5293176283835252071m_-515258420855843595m_-212787898175025196m_8788737298834798581gmail_signature" \
data-smartmail="gmail_signature"&gt;Best Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div \
class="m_6066214734943565840m_3181712413401109781m_5408290801497859655m_-5900777116898 \
549406m_-7501657407322612784m_-6540617163388826959m_5293176283835252071m_-515258420855843595m_-212787898175025196h5"&gt;
 &lt;br&gt;&lt;div class="gmail_quote"&gt;On Wed, Oct 25, 2017 at 2:50 PM, Michal Privoznik &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:mprivozn@redhat.com" \
target="_blank"&gt;mprivozn@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div \
class="m_6066214734943565840m_3181712413401109781m_5408290801497859655m_-5900777116898 \
549406m_-7501657407322612784m_-6540617163388826959m_5293176283835252071m_-515258420855843595m_-212787898175025196m_8788737298834798581HOEnZb"&gt;&lt;div \
class="m_6066214734943565840m_3181712413401109781m_5408290801497859655m_-5900777116898 \
549406m_-7501657407322612784m_-6540617163388826959m_5293176283835252071m_-515258420855843595m_-212787898175025196m_8788737298834798581h5"&gt;On \
10/25/2017 01:53 PM, Ashish Kurian wrote:&lt;br&gt; &gt; Dear Users/Developers,&lt;br&gt;
&gt;&lt;br&gt;
&gt; I am using a KVM Ubuntu VM as a degrader to apply specific delays to&lt;br&gt;
&gt; incoming packets. As the delay for my packets can be higher than 7.5&lt;br&gt;
&gt; seconds, there is not enough buffer on my interface to buffer all the&lt;br&gt;
&gt; packets. Therefore those overflowing packets are dropped in the machine and&lt;br&gt;
&gt; not forwarded.&lt;br&gt;
&gt;&lt;br&gt;
&gt; When I tried to use the command   ethtool -G ens8 rx 512 to increase the&lt;br&gt;
&gt; buffer size, I get the following error.&lt;br&gt;
&gt;&lt;br&gt;
&gt; Cannot set device ring parameters: Operation not permitted&lt;br&gt;
&gt;&lt;br&gt;
&gt; I have kept the VM xml files as specified in the link :&lt;br&gt;
&gt; &lt;a href="https://libvirt.org/formatdomain.html" rel="noreferrer" \
target="_blank"&gt;https://libvirt.org/formatdoma&lt;wbr&gt;in.html&lt;/a&gt;. The value that I kept \
in my xml file&lt;br&gt; &gt; is as follows.&lt;br&gt;
&gt;&lt;br&gt;
&gt; &lt;interface type='direct'&gt;&lt;br&gt;
&gt;           &lt;mac address='52:54:00:72:f9:eb'/&gt;&lt;br&gt;
&gt;           &lt;source dev='enp7s0f0' mode='vepa'/&gt;&lt;br&gt;
&gt;           &lt;model type='virtio'/&gt;&lt;br&gt;
&gt;           &lt;driver name='vhost' queues='5' \
rx_queue_size='512'&lt;br&gt; &gt; tx_queue_size='512'&gt;&lt;br&gt;
&gt;           &lt;host csum='off' gso='off' tso4='off' \
tso6='off' ecn='off' ufo='off'&lt;br&gt; &gt; \
mrg_rxbuf='off'/&gt;&lt;br&gt; &gt;           &lt;guest csum='off' \
tso4='off' tso6='off' ecn='off' ufo='off'/&gt;&lt;br&gt; \
&gt;           &lt;/driver&gt;&lt;br&gt; &gt;           &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x08'&lt;br&gt; &gt; \
function='0x0'/&gt;&lt;br&gt; &gt;        &lt;/interface&gt;&lt;br&gt;
&gt;        &lt;interface type='direct'&gt;&lt;br&gt;
&gt;           &lt;mac address='52:54:00:00:b5:99'/&gt;&lt;br&gt;
&gt;           &lt;source dev='enp7s0f1' mode='vepa'/&gt;&lt;br&gt;
&gt;           &lt;model type='virtio'/&gt;&lt;br&gt;
&gt;           &lt;driver name='vhost' queues='5' \
rx_queue_size='512'&lt;br&gt; &gt; tx_queue_size='512'&gt;&lt;br&gt;
&gt;           &lt;host csum='off' gso='off' tso4='off' \
tso6='off' ecn='off' ufo='off'&lt;br&gt; &gt; \
mrg_rxbuf='off'/&gt;&lt;br&gt; &gt;           &lt;guest csum='off' \
tso4='off' tso6='off' ecn='off' ufo='off'/&gt;&lt;br&gt; \
&gt;           &lt;/driver&gt;&lt;br&gt; &gt;           &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x09'&lt;br&gt; &gt; \
function='0x0'/&gt;&lt;br&gt; &lt;br&gt;
&lt;/div&gt;&lt;/div&gt;So what does the qemu command line look like? You can find it in \
either&lt;br&gt; libvirtd log or domain log.&lt;br&gt;
&lt;br&gt;
&lt;a href="http://wiki.libvirt.org/page/DebugLogs" rel="noreferrer" \
target="_blank"&gt;http://wiki.libvirt.org/page/D&lt;wbr&gt;ebugLogs&lt;/a&gt;&lt;br&gt; &lt;span \
class="m_6066214734943565840m_3181712413401109781m_5408290801497859655m_-5900777116898 \
549406m_-7501657407322612784m_-6540617163388826959m_5293176283835252071m_-515258420855843595m_-212787898175025196m_8788737298834798581HOEnZb"&gt;&lt;font \
color="#888888"&gt;&lt;br&gt; Michal&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;br&gt;&lt;/div&gt;&lt;/div&gt;______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
 &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20171026084628</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-10-26 08:46:28-0400</timestampReceived><subject>Re: [libvirt-users] Need to increase the rx and tx buffer size of my interface</subject><body>

On 10/26/2017 10:38 AM, Ashish Kurian wrote:
&gt; Hi Yalan and Michal,
&gt; 
&gt; Thank you for your response. So what I understand is that I can change
&gt; rx_queue size even if I use direct type interface and qemu driver as long
&gt; as the driver is virtio. Am I right? 

Yes.

&gt; If that is the case why am I getting
&gt; the error saying that
&gt; 
&gt; error: XML document failed to validate against schema: Unable to validate
&gt; doc against /usr/share/libvirt/schemas/domain.rng
&gt; Extra element devices in interleave
&gt; Element domain failed to validate content

What's your libvirt version? For rx_queue_size you need 2.3.0 or newer.
For tx_queue_size you need 3.7.0 or newer (not that there's one yet).

&gt; 
&gt; for the following xml config? Btw I changed vepa to bridged mode hoping it
&gt; would help me. Also note that I tried the following without any driver name
&gt; and it still failed.
&gt; 
&gt; 
&gt; &lt;interface type='direct'&gt;
&gt;       &lt;mac address='52:54:00:72:f9:eb'/&gt;
&gt;       &lt;source dev='enp7s0f0' mode='bridge'/&gt;
&gt;       &lt;model type='virtio'/&gt;
&gt;       &lt;driver name='qemu' queues='5' rx_queue_size='512'&gt;
&gt;         &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt; ufo='off' mrg_rxbuf='off'/&gt;
&gt;         &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;       &lt;/driver&gt;
&gt; 

This works for me. I'm running recent git.

Michal

</body></email><email><emailId>20171026085017</emailId><senderName>Ashish Kurian</senderName><senderEmail>ashishbnv@gmail.com</senderEmail><timestampReceived>2017-10-26 08:50:17-0400</timestampReceived><subject>Re: [libvirt-users] Need to increase the rx and tx buffer size of my interface</subject><body>

Hi Michal,

Mine is

iplab@iceman:~$ libvirtd --version
libvirtd (libvirt) 1.3.1

I think this can be the issue. I will update and try again



Best Regards,
Ashish Kurian

On Thu, Oct 26, 2017 at 10:46 AM, Michal Privoznik &lt;mprivozn@redhat.com&gt;
wrote:

&gt; On 10/26/2017 10:38 AM, Ashish Kurian wrote:
&gt; &gt; Hi Yalan and Michal,
&gt; &gt;
&gt; &gt; Thank you for your response. So what I understand is that I can change
&gt; &gt; rx_queue size even if I use direct type interface and qemu driver as long
&gt; &gt; as the driver is virtio. Am I right?
&gt;
&gt; Yes.
&gt;
&gt; &gt; If that is the case why am I getting
&gt; &gt; the error saying that
&gt; &gt;
&gt; &gt; error: XML document failed to validate against schema: Unable to validate
&gt; &gt; doc against /usr/share/libvirt/schemas/domain.rng
&gt; &gt; Extra element devices in interleave
&gt; &gt; Element domain failed to validate content
&gt;
&gt; What's your libvirt version? For rx_queue_size you need 2.3.0 or newer.
&gt; For tx_queue_size you need 3.7.0 or newer (not that there's one yet).
&gt;
&gt; &gt;
&gt; &gt; for the following xml config? Btw I changed vepa to bridged mode hoping
&gt; it
&gt; &gt; would help me. Also note that I tried the following without any driver
&gt; name
&gt; &gt; and it still failed.
&gt; &gt;
&gt; &gt;
&gt; &gt; &lt;interface type='direct'&gt;
&gt; &gt;       &lt;mac address='52:54:00:72:f9:eb'/&gt;
&gt; &gt;       &lt;source dev='enp7s0f0' mode='bridge'/&gt;
&gt; &gt;       &lt;model type='virtio'/&gt;
&gt; &gt;       &lt;driver name='qemu' queues='5' rx_queue_size='512'&gt;
&gt; &gt;         &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt; &gt; ufo='off' mrg_rxbuf='off'/&gt;
&gt; &gt;         &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt; &gt;       &lt;/driver&gt;
&gt; &gt;
&gt;
&gt; This works for me. I'm running recent git.
&gt;
&gt; Michal
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi Michal,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Mine is  \
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;iplab@iceman:~$ libvirtd --version&lt;/div&gt;&lt;div&gt;libvirtd \
(libvirt) 1.3.1&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I think this can be the issue. I will \
update and try again&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div class="gmail_signature" \
data-smartmail="gmail_signature"&gt;Best Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Thu, Oct 26, 2017 at 10:46 AM, Michal Privoznik &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:mprivozn@redhat.com" \
target="_blank"&gt;mprivozn@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span class=""&gt;On 10/26/2017 10:38 AM, Ashish Kurian \
wrote:&lt;br&gt; &gt; Hi Yalan and Michal,&lt;br&gt;
&gt;&lt;br&gt;
&gt; Thank you for your response. So what I understand is that I can change&lt;br&gt;
&gt; rx_queue size even if I use direct type interface and qemu driver as long&lt;br&gt;
&gt; as the driver is virtio. Am I right?&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;Yes.&lt;br&gt;
&lt;span class=""&gt;&lt;br&gt;
&gt; If that is the case why am I getting&lt;br&gt;
&gt; the error saying that&lt;br&gt;
&gt;&lt;br&gt;
&gt; error: XML document failed to validate against schema: Unable to validate&lt;br&gt;
&gt; doc against /usr/share/libvirt/schemas/&lt;wbr&gt;domain.rng&lt;br&gt;
&gt; Extra element devices in interleave&lt;br&gt;
&gt; Element domain failed to validate content&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;What's your libvirt version? For rx_queue_size you need 2.3.0 or \
newer.&lt;br&gt; For tx_queue_size you need 3.7.0 or newer (not that there's one \
yet).&lt;br&gt; &lt;span class=""&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; for the following xml config? Btw I changed vepa to bridged mode hoping it&lt;br&gt;
&gt; would help me. Also note that I tried the following without any driver name&lt;br&gt;
&gt; and it still failed.&lt;br&gt;
&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; &lt;interface type='direct'&gt;&lt;br&gt;
&gt;           &lt;mac address='52:54:00:72:f9:eb'/&gt;&lt;br&gt;
&gt;           &lt;source dev='enp7s0f0' mode='bridge'/&gt;&lt;br&gt;
&gt;           &lt;model type='virtio'/&gt;&lt;br&gt;
&gt;           &lt;driver name='qemu' queues='5' \
rx_queue_size='512'&gt;&lt;br&gt; &gt;              &lt;host csum='off' \
gso='off' tso4='off' tso6='off' ecn='off'&lt;br&gt; &gt; \
ufo='off' mrg_rxbuf='off'/&gt;&lt;br&gt; &gt;              &lt;guest \
csum='off' tso4='off' tso6='off' ecn='off' \
ufo='off'/&gt;&lt;br&gt; &gt;           &lt;/driver&gt;&lt;br&gt;
&gt;&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;This works for me. I'm running recent git.&lt;br&gt;
&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;br&gt;
Michal&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20171026101843</emailId><senderName>Ashish Kurian</senderName><senderEmail>ashishbnv@gmail.com</senderEmail><timestampReceived>2017-10-26 10:18:43-0400</timestampReceived><subject>Re: [libvirt-users] Need to increase the rx and tx buffer size of my interface</subject><body>

Hi Michal,

I installed the latest version from the git and did run the libvirt from
the new directory using /home/to/your/checkout/daemon/libvirtd

But I still see that the version is 1.3.1. I have also stopped the already
running libvirt daemon and ran the new daemon from the directory and it is
showing 1.3.1

Best Regards,
Ashish Kurian

On Thu, Oct 26, 2017 at 10:50 AM, Ashish Kurian &lt;ashishbnv@gmail.com&gt; wrote:

&gt; Hi Michal,
&gt;
&gt; Mine is
&gt;
&gt; iplab@iceman:~$ libvirtd --version
&gt; libvirtd (libvirt) 1.3.1
&gt;
&gt; I think this can be the issue. I will update and try again
&gt;
&gt;
&gt;
&gt; Best Regards,
&gt; Ashish Kurian
&gt;
&gt; On Thu, Oct 26, 2017 at 10:46 AM, Michal Privoznik &lt;mprivozn@redhat.com&gt;
&gt; wrote:
&gt;
&gt;&gt; On 10/26/2017 10:38 AM, Ashish Kurian wrote:
&gt;&gt; &gt; Hi Yalan and Michal,
&gt;&gt; &gt;
&gt;&gt; &gt; Thank you for your response. So what I understand is that I can change
&gt;&gt; &gt; rx_queue size even if I use direct type interface and qemu driver as
&gt;&gt; long
&gt;&gt; &gt; as the driver is virtio. Am I right?
&gt;&gt;
&gt;&gt; Yes.
&gt;&gt;
&gt;&gt; &gt; If that is the case why am I getting
&gt;&gt; &gt; the error saying that
&gt;&gt; &gt;
&gt;&gt; &gt; error: XML document failed to validate against schema: Unable to
&gt;&gt; validate
&gt;&gt; &gt; doc against /usr/share/libvirt/schemas/domain.rng
&gt;&gt; &gt; Extra element devices in interleave
&gt;&gt; &gt; Element domain failed to validate content
&gt;&gt;
&gt;&gt; What's your libvirt version? For rx_queue_size you need 2.3.0 or newer.
&gt;&gt; For tx_queue_size you need 3.7.0 or newer (not that there's one yet).
&gt;&gt;
&gt;&gt; &gt;
&gt;&gt; &gt; for the following xml config? Btw I changed vepa to bridged mode hoping
&gt;&gt; it
&gt;&gt; &gt; would help me. Also note that I tried the following without any driver
&gt;&gt; name
&gt;&gt; &gt; and it still failed.
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; &lt;interface type='direct'&gt;
&gt;&gt; &gt;       &lt;mac address='52:54:00:72:f9:eb'/&gt;
&gt;&gt; &gt;       &lt;source dev='enp7s0f0' mode='bridge'/&gt;
&gt;&gt; &gt;       &lt;model type='virtio'/&gt;
&gt;&gt; &gt;       &lt;driver name='qemu' queues='5' rx_queue_size='512'&gt;
&gt;&gt; &gt;         &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off'
&gt;&gt; &gt; ufo='off' mrg_rxbuf='off'/&gt;
&gt;&gt; &gt;         &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
&gt;&gt; &gt;       &lt;/driver&gt;
&gt;&gt; &gt;
&gt;&gt;
&gt;&gt; This works for me. I'm running recent git.
&gt;&gt;
&gt;&gt; Michal
&gt;&gt;
&gt;
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi Michal,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I installed the latest version from the \
git and did run the libvirt from the new directory using  &lt;span \
style="background-color:rgb(238,238,238);color:rgb(0,0,0);font-family:LibvirtOverpassM \
ono;font-size:14.4px"&gt;/home/to/your/checkout/daemon/libvirtd&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;But \
I still see that the version is 1.3.1. I have also stopped the already running \
libvirt daemon and ran the new daemon from the directory and it is showing \
1.3.1&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="gmail_signature" data-smartmail="gmail_signature"&gt;Best Regards,&lt;br&gt;Ashish \
Kurian&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;div class="gmail_quote"&gt;On Thu, Oct 26, 2017 at 10:50 AM, \
Ashish Kurian &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:ashishbnv@gmail.com" \
target="_blank"&gt;ashishbnv@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi Michal,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Mine is  \
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;iplab@iceman:~$ libvirtd --version&lt;/div&gt;&lt;div&gt;libvirtd \
(libvirt) 1.3.1&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I think this can be the issue. I will \
update and try again&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="m_-9119871003846609812gmail_signature" data-smartmail="gmail_signature"&gt;Best \
Regards,&lt;br&gt;Ashish Kurian&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div class="h5"&gt; &lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Thu, Oct 26, 2017 at 10:46 AM, Michal Privoznik &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:mprivozn@redhat.com" \
target="_blank"&gt;mprivozn@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span&gt;On 10/26/2017 10:38 AM, Ashish Kurian wrote:&lt;br&gt; &gt; \
Hi Yalan and Michal,&lt;br&gt; &gt;&lt;br&gt;
&gt; Thank you for your response. So what I understand is that I can change&lt;br&gt;
&gt; rx_queue size even if I use direct type interface and qemu driver as long&lt;br&gt;
&gt; as the driver is virtio. Am I right?&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;Yes.&lt;br&gt;
&lt;span&gt;&lt;br&gt;
&gt; If that is the case why am I getting&lt;br&gt;
&gt; the error saying that&lt;br&gt;
&gt;&lt;br&gt;
&gt; error: XML document failed to validate against schema: Unable to validate&lt;br&gt;
&gt; doc against /usr/share/libvirt/schemas/dom&lt;wbr&gt;ain.rng&lt;br&gt;
&gt; Extra element devices in interleave&lt;br&gt;
&gt; Element domain failed to validate content&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;What's your libvirt version? For rx_queue_size you need 2.3.0 or \
newer.&lt;br&gt; For tx_queue_size you need 3.7.0 or newer (not that there's one \
yet).&lt;br&gt; &lt;span&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; for the following xml config? Btw I changed vepa to bridged mode hoping it&lt;br&gt;
&gt; would help me. Also note that I tried the following without any driver name&lt;br&gt;
&gt; and it still failed.&lt;br&gt;
&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; &lt;interface type='direct'&gt;&lt;br&gt;
&gt;           &lt;mac address='52:54:00:72:f9:eb'/&gt;&lt;br&gt;
&gt;           &lt;source dev='enp7s0f0' mode='bridge'/&gt;&lt;br&gt;
&gt;           &lt;model type='virtio'/&gt;&lt;br&gt;
&gt;           &lt;driver name='qemu' queues='5' \
rx_queue_size='512'&gt;&lt;br&gt; &gt;              &lt;host csum='off' \
gso='off' tso4='off' tso6='off' ecn='off'&lt;br&gt; &gt; \
ufo='off' mrg_rxbuf='off'/&gt;&lt;br&gt; &gt;              &lt;guest \
csum='off' tso4='off' tso6='off' ecn='off' \
ufo='off'/&gt;&lt;br&gt; &gt;           &lt;/driver&gt;&lt;br&gt;
&gt;&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;This works for me. I'm running recent git.&lt;br&gt;
&lt;span class="m_-9119871003846609812HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;br&gt;
Michal&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20171026073055</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-10-26 07:30:55-0400</timestampReceived><subject>Re: [libvirt-users] question about how to set rng device on vm</subject><body>

On 10/25/2017 03:41 PM, Yalan Zhang wrote:
&gt; Hi Amos,
&gt; 
&gt; I'm a libvirt QE, and I can not understand the setting on libvirt.org for
&gt; rng device.
&gt; Could you please help to explain a little?
&gt; (The xml in  https://libvirt.org/formatdomain.html#elementsRng)
&gt; &lt;devices&gt;
&gt;   &lt;rng model='virtio'&gt;
&gt;     &lt;rate period="2000" bytes="1234"/&gt;
&gt;     &lt;backend model='random'&gt;/dev/random&lt;/backend&gt;
&gt;     &lt;!-- OR --&gt;
&gt;     &lt;backend model='egd' type='udp'&gt;
&gt;       *&lt;source mode='bind' service='1234'/&gt;*
&gt; *      &lt;source mode='connect' host='1.2.3.4' service='1234'/&gt;*
&gt;     &lt;/backend&gt;
&gt;   &lt;/rng&gt;
&gt; &lt;/devices&gt;
&gt; 
&gt; How did it work with source mode='bind' and source mode='connect' together?

It doesn't. That's just an example that you can have two types of
backend. Either the backend connects somewhere (mode='connect'), or
expect somebody to connect (mode='bind'). Just try to define domain with
that RNG, dump the XML back and see what got applied.

Michal

</body></email><email><emailId>20171020115917</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-10-20 11:59:17-0400</timestampReceived><subject>Re: [libvirt-users] terminating on signal 15 from pid 2146 (/usr/sbin/libvirtd)</subject><body>


On Thu, Oct 19, 2017 at 09:11:00PM +0300, Matwey V. Kornilov wrote:
&gt;Hello,
&gt;
&gt;I use libvirt 3.3.0 and qemu 2.9.0
&gt;
&gt;My domain XML spec is the following:
&gt;
&gt;&lt;domain type='qemu'&gt;
&gt;  &lt;name&gt;s390_generic&lt;/name&gt;
&gt;  &lt;uuid&gt;82b4d16e-b636-447e-9fda-41d44616bce8&lt;/uuid&gt;
&gt;  &lt;memory unit='KiB'&gt;1048576&lt;/memory&gt;
&gt;  &lt;currentMemory unit='KiB'&gt;1048576&lt;/currentMemory&gt;
&gt;  &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
&gt;  &lt;os&gt;
&gt;    &lt;type arch='s390x' machine='s390-ccw-virtio-2.9'&gt;hvm&lt;/type&gt;
&gt;    &lt;boot dev='hd'/&gt;
&gt;  &lt;/os&gt;
&gt;  &lt;clock offset='utc'/&gt;
&gt;  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
&gt;  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
&gt;  &lt;on_crash&gt;destroy&lt;/on_crash&gt;
&gt;  &lt;devices&gt;
&gt;    &lt;emulator&gt;/usr/bin/qemu-system-s390x&lt;/emulator&gt;
&gt;    &lt;disk type='block' device='disk'&gt;
&gt;      &lt;driver name='qemu' type='raw' cache='none' io='native'/&gt;
&gt;      &lt;source dev='/dev/lvm_pda/libvirt_s390'/&gt;
&gt;      &lt;target dev='vda' bus='virtio'/&gt;
&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0000'/&gt;
&gt;    &lt;/disk&gt;
&gt;    &lt;disk type='file' device='cdrom'&gt;
&gt;      &lt;driver name='qemu' type='raw'/&gt;
&gt;      &lt;target dev='sda' bus='scsi'/&gt;
&gt;      &lt;readonly/&gt;
&gt;      &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt;    &lt;/disk&gt;
&gt;    &lt;controller type='scsi' index='0' model='virtio-scsi'&gt;
&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0002'/&gt;
&gt;    &lt;/controller&gt;
&gt;    &lt;interface type='bridge'&gt;
&gt;      &lt;mac address='52:54:00:e8:61:7e'/&gt;
&gt;      &lt;source bridge='br0'/&gt;
&gt;      &lt;model type='virtio'/&gt;
&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0001'/&gt;
&gt;    &lt;/interface&gt;
&gt;    &lt;console type='pty'&gt;
&gt;      &lt;target type='sclp' port='0'/&gt;
&gt;    &lt;/console&gt;
&gt;    &lt;memballoon model='virtio'&gt;
&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0003'/&gt;
&gt;    &lt;/memballoon&gt;
&gt;    &lt;panic model='s390'/&gt;
&gt;  &lt;/devices&gt;
&gt;&lt;/domain&gt;
&gt;
&gt;The issue is that when I try to start it, it starts and shutdowns
&gt;immediately:
&gt;
&gt;virsh # start s390_generic
&gt;Domain s390_generic started
&gt;
&gt;virsh #
&gt;
&gt;In the domain log file I see the following:
&gt;
&gt;2017-10-19 18:10:21.633+0000: starting up libvirt version: 3.3.0, qemu
&gt;version: 2.9.0(openSUSE Leap 42.3), hostname: oak.local
&gt;LC_ALL=C
&gt;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
&gt;QEMU_AUDIO_DRV=none /usr/bin/qemu-system-s390x -name
&gt;guest=s390_generic,debug-threads=on -S -object
&gt;secret,id=masterKey0,format=raw,file=/var/lib/libvirt/qemu/domain-7-s390_generic/master-key.aes
&gt;-machine s390-ccw-virtio-2.9,accel=tcg,usb=off,dump-guest-core=off -m
&gt;1024 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -uuid
&gt;82b4d16e-b636-447e-9fda-41d44616bce8 -display none -no-user-config
&gt;-nodefaults -chardev
&gt;socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-7-s390_generic/monitor.sock,server,nowait
&gt;-mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc
&gt;-no-shutdown -boot strict=on -device
&gt;virtio-scsi-ccw,id=scsi0,devno=fe.0.0002 -drive
&gt;file=/dev/lvm_pda/libvirt_s390,format=raw,if=none,id=drive-virtio-disk0,cache=none,aio=native
&gt;-device
&gt;virtio-blk-ccw,scsi=off,devno=fe.0.0000,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1
&gt;-drive if=none,id=drive-scsi0-0-0-0,readonly=on -device
&gt;scsi-cd,bus=scsi0.0,channel=0,scsi-id=0,lun=0,drive=drive-scsi0-0-0-0,id=scsi0-0-0-0
&gt;-netdev tap,fd=26,id=hostnet0 -device
&gt;virtio-net-ccw,netdev=hostnet0,id=net0,mac=52:54:00:e8:61:7e,devno=fe.0.0001
&gt;-chardev pty,id=charconsole0 -device
&gt;sclpconsole,chardev=charconsole0,id=console0 -device
&gt;virtio-balloon-ccw,id=balloon0,devno=fe.0.0003 -msg timestamp=on
&gt;2017-10-19T18:10:21.701184Z qemu-system-s390x: -chardev
&gt;pty,id=charconsole0: char device redirected to /dev/pts/5 (label
&gt;charconsole0)
&gt;2017-10-19T18:10:21.721299Z qemu-system-s390x: terminating on signal 15
&gt;from pid 2146 (/usr/sbin/libvirtd)
&gt;2017-10-19 18:10:21.985+0000: shutting down, reason=shutdown
&gt;

You don't have much logging enabled, so there's not that much info.  What's in
the libvirtd.log?  what is the status reason for the domain?  I.e. output of
`virsh domstate --reason` ?

&gt;
&gt;What is the issue?
&gt;
&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20171020120719</emailId><senderName>"Matwey V. Kornilov"</senderName><senderEmail>matwey.kornilov@gmail.com</senderEmail><timestampReceived>2017-10-20 12:07:19-0400</timestampReceived><subject>Re: [libvirt-users] terminating on signal 15 from pid 2146 (/usr/sbin/libvirtd)</subject><body>

2017-10-20 14:59 GMT+03:00 Martin Kletzander &lt;mkletzan@redhat.com&gt;:
&gt; On Thu, Oct 19, 2017 at 09:11:00PM +0300, Matwey V. Kornilov wrote:
&gt;&gt;
&gt;&gt; Hello,
&gt;&gt;
&gt;&gt; I use libvirt 3.3.0 and qemu 2.9.0
&gt;&gt;
&gt;&gt; My domain XML spec is the following:
&gt;&gt;
&gt;&gt; &lt;domain type='qemu'&gt;
&gt;&gt;  &lt;name&gt;s390_generic&lt;/name&gt;
&gt;&gt;  &lt;uuid&gt;82b4d16e-b636-447e-9fda-41d44616bce8&lt;/uuid&gt;
&gt;&gt;  &lt;memory unit='KiB'&gt;1048576&lt;/memory&gt;
&gt;&gt;  &lt;currentMemory unit='KiB'&gt;1048576&lt;/currentMemory&gt;
&gt;&gt;  &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
&gt;&gt;  &lt;os&gt;
&gt;&gt;    &lt;type arch='s390x' machine='s390-ccw-virtio-2.9'&gt;hvm&lt;/type&gt;
&gt;&gt;    &lt;boot dev='hd'/&gt;
&gt;&gt;  &lt;/os&gt;
&gt;&gt;  &lt;clock offset='utc'/&gt;
&gt;&gt;  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
&gt;&gt;  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
&gt;&gt;  &lt;on_crash&gt;destroy&lt;/on_crash&gt;
&gt;&gt;  &lt;devices&gt;
&gt;&gt;    &lt;emulator&gt;/usr/bin/qemu-system-s390x&lt;/emulator&gt;
&gt;&gt;    &lt;disk type='block' device='disk'&gt;
&gt;&gt;      &lt;driver name='qemu' type='raw' cache='none' io='native'/&gt;
&gt;&gt;      &lt;source dev='/dev/lvm_pda/libvirt_s390'/&gt;
&gt;&gt;      &lt;target dev='vda' bus='virtio'/&gt;
&gt;&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0000'/&gt;
&gt;&gt;    &lt;/disk&gt;
&gt;&gt;    &lt;disk type='file' device='cdrom'&gt;
&gt;&gt;      &lt;driver name='qemu' type='raw'/&gt;
&gt;&gt;      &lt;target dev='sda' bus='scsi'/&gt;
&gt;&gt;      &lt;readonly/&gt;
&gt;&gt;      &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt;&gt;    &lt;/disk&gt;
&gt;&gt;    &lt;controller type='scsi' index='0' model='virtio-scsi'&gt;
&gt;&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0002'/&gt;
&gt;&gt;    &lt;/controller&gt;
&gt;&gt;    &lt;interface type='bridge'&gt;
&gt;&gt;      &lt;mac address='52:54:00:e8:61:7e'/&gt;
&gt;&gt;      &lt;source bridge='br0'/&gt;
&gt;&gt;      &lt;model type='virtio'/&gt;
&gt;&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0001'/&gt;
&gt;&gt;    &lt;/interface&gt;
&gt;&gt;    &lt;console type='pty'&gt;
&gt;&gt;      &lt;target type='sclp' port='0'/&gt;
&gt;&gt;    &lt;/console&gt;
&gt;&gt;    &lt;memballoon model='virtio'&gt;
&gt;&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0003'/&gt;
&gt;&gt;    &lt;/memballoon&gt;
&gt;&gt;    &lt;panic model='s390'/&gt;
&gt;&gt;  &lt;/devices&gt;
&gt;&gt; &lt;/domain&gt;
&gt;&gt;
&gt;&gt; The issue is that when I try to start it, it starts and shutdowns
&gt;&gt; immediately:
&gt;&gt;
&gt;&gt; virsh # start s390_generic
&gt;&gt; Domain s390_generic started
&gt;&gt;
&gt;&gt; virsh #
&gt;&gt;
&gt;&gt; In the domain log file I see the following:
&gt;&gt;
&gt;&gt; 2017-10-19 18:10:21.633+0000: starting up libvirt version: 3.3.0, qemu
&gt;&gt; version: 2.9.0(openSUSE Leap 42.3), hostname: oak.local
&gt;&gt; LC_ALL=C
&gt;&gt; PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
&gt;&gt; QEMU_AUDIO_DRV=none /usr/bin/qemu-system-s390x -name
&gt;&gt; guest=s390_generic,debug-threads=on -S -object
&gt;&gt;
&gt;&gt; secret,id=masterKey0,format=raw,file=/var/lib/libvirt/qemu/domain-7-s390_generic/master-key.aes
&gt;&gt; -machine s390-ccw-virtio-2.9,accel=tcg,usb=off,dump-guest-core=off -m
&gt;&gt; 1024 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -uuid
&gt;&gt; 82b4d16e-b636-447e-9fda-41d44616bce8 -display none -no-user-config
&gt;&gt; -nodefaults -chardev
&gt;&gt;
&gt;&gt; socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-7-s390_generic/monitor.sock,server,nowait
&gt;&gt; -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc
&gt;&gt; -no-shutdown -boot strict=on -device
&gt;&gt; virtio-scsi-ccw,id=scsi0,devno=fe.0.0002 -drive
&gt;&gt;
&gt;&gt; file=/dev/lvm_pda/libvirt_s390,format=raw,if=none,id=drive-virtio-disk0,cache=none,aio=native
&gt;&gt; -device
&gt;&gt;
&gt;&gt; virtio-blk-ccw,scsi=off,devno=fe.0.0000,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1
&gt;&gt; -drive if=none,id=drive-scsi0-0-0-0,readonly=on -device
&gt;&gt;
&gt;&gt; scsi-cd,bus=scsi0.0,channel=0,scsi-id=0,lun=0,drive=drive-scsi0-0-0-0,id=scsi0-0-0-0
&gt;&gt; -netdev tap,fd=26,id=hostnet0 -device
&gt;&gt;
&gt;&gt; virtio-net-ccw,netdev=hostnet0,id=net0,mac=52:54:00:e8:61:7e,devno=fe.0.0001
&gt;&gt; -chardev pty,id=charconsole0 -device
&gt;&gt; sclpconsole,chardev=charconsole0,id=console0 -device
&gt;&gt; virtio-balloon-ccw,id=balloon0,devno=fe.0.0003 -msg timestamp=on
&gt;&gt; 2017-10-19T18:10:21.701184Z qemu-system-s390x: -chardev
&gt;&gt; pty,id=charconsole0: char device redirected to /dev/pts/5 (label
&gt;&gt; charconsole0)
&gt;&gt; 2017-10-19T18:10:21.721299Z qemu-system-s390x: terminating on signal 15
&gt;&gt; from pid 2146 (/usr/sbin/libvirtd)
&gt;&gt; 2017-10-19 18:10:21.985+0000: shutting down, reason=shutdown
&gt;&gt;
&gt;
&gt; You don't have much logging enabled, so there's not that much info.  What's
&gt; in
&gt; the libvirtd.log?  what is the status reason for the domain?  I.e. output of
&gt; `virsh domstate --reason` ?

How could I increase log level? There is nothing in libvirtd.log.

The reason is shutdown.

virsh # start s390_generic
Domain s390_generic started

virsh # domstate --reason s390_generic
shut off (shutdown)


&gt;
&gt;&gt;
&gt;&gt; What is the issue?
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; libvirt-users mailing list
&gt;&gt; libvirt-users@redhat.com
&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users



-- 
With best regards,
Matwey V. Kornilov

</body></email><email><emailId>20171020121607</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-10-20 12:16:07-0400</timestampReceived><subject>Re: [libvirt-users] terminating on signal 15 from pid 2146 (/usr/sbin/libvirtd)</subject><body>


On Fri, Oct 20, 2017 at 03:07:19PM +0300, Matwey V. Kornilov wrote:
&gt;2017-10-20 14:59 GMT+03:00 Martin Kletzander &lt;mkletzan@redhat.com&gt;:
&gt;&gt; On Thu, Oct 19, 2017 at 09:11:00PM +0300, Matwey V. Kornilov wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Hello,
&gt;&gt;&gt;
&gt;&gt;&gt; I use libvirt 3.3.0 and qemu 2.9.0
&gt;&gt;&gt;
&gt;&gt;&gt; My domain XML spec is the following:
&gt;&gt;&gt;
&gt;&gt;&gt; &lt;domain type='qemu'&gt;
&gt;&gt;&gt;  &lt;name&gt;s390_generic&lt;/name&gt;
&gt;&gt;&gt;  &lt;uuid&gt;82b4d16e-b636-447e-9fda-41d44616bce8&lt;/uuid&gt;
&gt;&gt;&gt;  &lt;memory unit='KiB'&gt;1048576&lt;/memory&gt;
&gt;&gt;&gt;  &lt;currentMemory unit='KiB'&gt;1048576&lt;/currentMemory&gt;
&gt;&gt;&gt;  &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
&gt;&gt;&gt;  &lt;os&gt;
&gt;&gt;&gt;    &lt;type arch='s390x' machine='s390-ccw-virtio-2.9'&gt;hvm&lt;/type&gt;
&gt;&gt;&gt;    &lt;boot dev='hd'/&gt;
&gt;&gt;&gt;  &lt;/os&gt;
&gt;&gt;&gt;  &lt;clock offset='utc'/&gt;
&gt;&gt;&gt;  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
&gt;&gt;&gt;  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
&gt;&gt;&gt;  &lt;on_crash&gt;destroy&lt;/on_crash&gt;
&gt;&gt;&gt;  &lt;devices&gt;
&gt;&gt;&gt;    &lt;emulator&gt;/usr/bin/qemu-system-s390x&lt;/emulator&gt;
&gt;&gt;&gt;    &lt;disk type='block' device='disk'&gt;
&gt;&gt;&gt;      &lt;driver name='qemu' type='raw' cache='none' io='native'/&gt;
&gt;&gt;&gt;      &lt;source dev='/dev/lvm_pda/libvirt_s390'/&gt;
&gt;&gt;&gt;      &lt;target dev='vda' bus='virtio'/&gt;
&gt;&gt;&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0000'/&gt;
&gt;&gt;&gt;    &lt;/disk&gt;
&gt;&gt;&gt;    &lt;disk type='file' device='cdrom'&gt;
&gt;&gt;&gt;      &lt;driver name='qemu' type='raw'/&gt;
&gt;&gt;&gt;      &lt;target dev='sda' bus='scsi'/&gt;
&gt;&gt;&gt;      &lt;readonly/&gt;
&gt;&gt;&gt;      &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt;&gt;&gt;    &lt;/disk&gt;
&gt;&gt;&gt;    &lt;controller type='scsi' index='0' model='virtio-scsi'&gt;
&gt;&gt;&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0002'/&gt;
&gt;&gt;&gt;    &lt;/controller&gt;
&gt;&gt;&gt;    &lt;interface type='bridge'&gt;
&gt;&gt;&gt;      &lt;mac address='52:54:00:e8:61:7e'/&gt;
&gt;&gt;&gt;      &lt;source bridge='br0'/&gt;
&gt;&gt;&gt;      &lt;model type='virtio'/&gt;
&gt;&gt;&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0001'/&gt;
&gt;&gt;&gt;    &lt;/interface&gt;
&gt;&gt;&gt;    &lt;console type='pty'&gt;
&gt;&gt;&gt;      &lt;target type='sclp' port='0'/&gt;
&gt;&gt;&gt;    &lt;/console&gt;
&gt;&gt;&gt;    &lt;memballoon model='virtio'&gt;
&gt;&gt;&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0003'/&gt;
&gt;&gt;&gt;    &lt;/memballoon&gt;
&gt;&gt;&gt;    &lt;panic model='s390'/&gt;
&gt;&gt;&gt;  &lt;/devices&gt;
&gt;&gt;&gt; &lt;/domain&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; The issue is that when I try to start it, it starts and shutdowns
&gt;&gt;&gt; immediately:
&gt;&gt;&gt;
&gt;&gt;&gt; virsh # start s390_generic
&gt;&gt;&gt; Domain s390_generic started
&gt;&gt;&gt;
&gt;&gt;&gt; virsh #
&gt;&gt;&gt;
&gt;&gt;&gt; In the domain log file I see the following:
&gt;&gt;&gt;
&gt;&gt;&gt; 2017-10-19 18:10:21.633+0000: starting up libvirt version: 3.3.0, qemu
&gt;&gt;&gt; version: 2.9.0(openSUSE Leap 42.3), hostname: oak.local
&gt;&gt;&gt; LC_ALL=C
&gt;&gt;&gt; PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
&gt;&gt;&gt; QEMU_AUDIO_DRV=none /usr/bin/qemu-system-s390x -name
&gt;&gt;&gt; guest=s390_generic,debug-threads=on -S -object
&gt;&gt;&gt;
&gt;&gt;&gt; secret,id=masterKey0,format=raw,file=/var/lib/libvirt/qemu/domain-7-s390_generic/master-key.aes
&gt;&gt;&gt; -machine s390-ccw-virtio-2.9,accel=tcg,usb=off,dump-guest-core=off -m
&gt;&gt;&gt; 1024 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -uuid
&gt;&gt;&gt; 82b4d16e-b636-447e-9fda-41d44616bce8 -display none -no-user-config
&gt;&gt;&gt; -nodefaults -chardev
&gt;&gt;&gt;
&gt;&gt;&gt; socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-7-s390_generic/monitor.sock,server,nowait
&gt;&gt;&gt; -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc
&gt;&gt;&gt; -no-shutdown -boot strict=on -device
&gt;&gt;&gt; virtio-scsi-ccw,id=scsi0,devno=fe.0.0002 -drive
&gt;&gt;&gt;
&gt;&gt;&gt; file=/dev/lvm_pda/libvirt_s390,format=raw,if=none,id=drive-virtio-disk0,cache=none,aio=native
&gt;&gt;&gt; -device
&gt;&gt;&gt;
&gt;&gt;&gt; virtio-blk-ccw,scsi=off,devno=fe.0.0000,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1
&gt;&gt;&gt; -drive if=none,id=drive-scsi0-0-0-0,readonly=on -device
&gt;&gt;&gt;
&gt;&gt;&gt; scsi-cd,bus=scsi0.0,channel=0,scsi-id=0,lun=0,drive=drive-scsi0-0-0-0,id=scsi0-0-0-0
&gt;&gt;&gt; -netdev tap,fd=26,id=hostnet0 -device
&gt;&gt;&gt;
&gt;&gt;&gt; virtio-net-ccw,netdev=hostnet0,id=net0,mac=52:54:00:e8:61:7e,devno=fe.0.0001
&gt;&gt;&gt; -chardev pty,id=charconsole0 -device
&gt;&gt;&gt; sclpconsole,chardev=charconsole0,id=console0 -device
&gt;&gt;&gt; virtio-balloon-ccw,id=balloon0,devno=fe.0.0003 -msg timestamp=on
&gt;&gt;&gt; 2017-10-19T18:10:21.701184Z qemu-system-s390x: -chardev
&gt;&gt;&gt; pty,id=charconsole0: char device redirected to /dev/pts/5 (label
&gt;&gt;&gt; charconsole0)
&gt;&gt;&gt; 2017-10-19T18:10:21.721299Z qemu-system-s390x: terminating on signal 15
&gt;&gt;&gt; from pid 2146 (/usr/sbin/libvirtd)
&gt;&gt;&gt; 2017-10-19 18:10:21.985+0000: shutting down, reason=shutdown
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; You don't have much logging enabled, so there's not that much info.  What's
&gt;&gt; in
&gt;&gt; the libvirtd.log?  what is the status reason for the domain?  I.e. output of
&gt;&gt; `virsh domstate --reason` ?
&gt;
&gt;How could I increase log level? There is nothing in libvirtd.log.
&gt;

https://wiki.libvirt.org/page/DebugLogs

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20171020191219</emailId><senderName>"Matwey V. Kornilov"</senderName><senderEmail>matwey.kornilov@gmail.com</senderEmail><timestampReceived>2017-10-20 19:12:19-0400</timestampReceived><subject>Re: [libvirt-users] terminating on signal 15 from pid 2146 (/usr/sbin/libvirtd)</subject><body>


2017-10-20 17:14 GMT+03:00 Matwey V. Kornilov &lt;matwey.kornilov@gmail.com&gt;:
&gt; 2017-10-20 15:16 GMT+03:00 Martin Kletzander &lt;mkletzan@redhat.com&gt;:
&gt;&gt; On Fri, Oct 20, 2017 at 03:07:19PM +0300, Matwey V. Kornilov wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; 2017-10-20 14:59 GMT+03:00 Martin Kletzander &lt;mkletzan@redhat.com&gt;:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Thu, Oct 19, 2017 at 09:11:00PM +0300, Matwey V. Kornilov wrote:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Hello,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I use libvirt 3.3.0 and qemu 2.9.0
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; My domain XML spec is the following:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; &lt;domain type='qemu'&gt;
&gt;&gt;&gt;&gt;&gt;  &lt;name&gt;s390_generic&lt;/name&gt;
&gt;&gt;&gt;&gt;&gt;  &lt;uuid&gt;82b4d16e-b636-447e-9fda-41d44616bce8&lt;/uuid&gt;
&gt;&gt;&gt;&gt;&gt;  &lt;memory unit='KiB'&gt;1048576&lt;/memory&gt;
&gt;&gt;&gt;&gt;&gt;  &lt;currentMemory unit='KiB'&gt;1048576&lt;/currentMemory&gt;
&gt;&gt;&gt;&gt;&gt;  &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
&gt;&gt;&gt;&gt;&gt;  &lt;os&gt;
&gt;&gt;&gt;&gt;&gt;    &lt;type arch='s390x' machine='s390-ccw-virtio-2.9'&gt;hvm&lt;/type&gt;
&gt;&gt;&gt;&gt;&gt;    &lt;boot dev='hd'/&gt;
&gt;&gt;&gt;&gt;&gt;  &lt;/os&gt;
&gt;&gt;&gt;&gt;&gt;  &lt;clock offset='utc'/&gt;
&gt;&gt;&gt;&gt;&gt;  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
&gt;&gt;&gt;&gt;&gt;  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
&gt;&gt;&gt;&gt;&gt;  &lt;on_crash&gt;destroy&lt;/on_crash&gt;
&gt;&gt;&gt;&gt;&gt;  &lt;devices&gt;
&gt;&gt;&gt;&gt;&gt;    &lt;emulator&gt;/usr/bin/qemu-system-s390x&lt;/emulator&gt;
&gt;&gt;&gt;&gt;&gt;    &lt;disk type='block' device='disk'&gt;
&gt;&gt;&gt;&gt;&gt;      &lt;driver name='qemu' type='raw' cache='none' io='native'/&gt;
&gt;&gt;&gt;&gt;&gt;      &lt;source dev='/dev/lvm_pda/libvirt_s390'/&gt;
&gt;&gt;&gt;&gt;&gt;      &lt;target dev='vda' bus='virtio'/&gt;
&gt;&gt;&gt;&gt;&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0000'/&gt;
&gt;&gt;&gt;&gt;&gt;    &lt;/disk&gt;
&gt;&gt;&gt;&gt;&gt;    &lt;disk type='file' device='cdrom'&gt;
&gt;&gt;&gt;&gt;&gt;      &lt;driver name='qemu' type='raw'/&gt;
&gt;&gt;&gt;&gt;&gt;      &lt;target dev='sda' bus='scsi'/&gt;
&gt;&gt;&gt;&gt;&gt;      &lt;readonly/&gt;
&gt;&gt;&gt;&gt;&gt;      &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt;&gt;&gt;&gt;&gt;    &lt;/disk&gt;
&gt;&gt;&gt;&gt;&gt;    &lt;controller type='scsi' index='0' model='virtio-scsi'&gt;
&gt;&gt;&gt;&gt;&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0002'/&gt;
&gt;&gt;&gt;&gt;&gt;    &lt;/controller&gt;
&gt;&gt;&gt;&gt;&gt;    &lt;interface type='bridge'&gt;
&gt;&gt;&gt;&gt;&gt;      &lt;mac address='52:54:00:e8:61:7e'/&gt;
&gt;&gt;&gt;&gt;&gt;      &lt;source bridge='br0'/&gt;
&gt;&gt;&gt;&gt;&gt;      &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt;&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0001'/&gt;
&gt;&gt;&gt;&gt;&gt;    &lt;/interface&gt;
&gt;&gt;&gt;&gt;&gt;    &lt;console type='pty'&gt;
&gt;&gt;&gt;&gt;&gt;      &lt;target type='sclp' port='0'/&gt;
&gt;&gt;&gt;&gt;&gt;    &lt;/console&gt;
&gt;&gt;&gt;&gt;&gt;    &lt;memballoon model='virtio'&gt;
&gt;&gt;&gt;&gt;&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0003'/&gt;
&gt;&gt;&gt;&gt;&gt;    &lt;/memballoon&gt;
&gt;&gt;&gt;&gt;&gt;    &lt;panic model='s390'/&gt;
&gt;&gt;&gt;&gt;&gt;  &lt;/devices&gt;
&gt;&gt;&gt;&gt;&gt; &lt;/domain&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; The issue is that when I try to start it, it starts and shutdowns
&gt;&gt;&gt;&gt;&gt; immediately:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; virsh # start s390_generic
&gt;&gt;&gt;&gt;&gt; Domain s390_generic started
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; virsh #
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; In the domain log file I see the following:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; 2017-10-19 18:10:21.633+0000: starting up libvirt version: 3.3.0, qemu
&gt;&gt;&gt;&gt;&gt; version: 2.9.0(openSUSE Leap 42.3), hostname: oak.local
&gt;&gt;&gt;&gt;&gt; LC_ALL=C
&gt;&gt;&gt;&gt;&gt; PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
&gt;&gt;&gt;&gt;&gt; QEMU_AUDIO_DRV=none /usr/bin/qemu-system-s390x -name
&gt;&gt;&gt;&gt;&gt; guest=s390_generic,debug-threads=on -S -object
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; secret,id=masterKey0,format=raw,file=/var/lib/libvirt/qemu/domain-7-s390_generic/master-key.aes
&gt;&gt;&gt;&gt;&gt; -machine s390-ccw-virtio-2.9,accel=tcg,usb=off,dump-guest-core=off -m
&gt;&gt;&gt;&gt;&gt; 1024 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -uuid
&gt;&gt;&gt;&gt;&gt; 82b4d16e-b636-447e-9fda-41d44616bce8 -display none -no-user-config
&gt;&gt;&gt;&gt;&gt; -nodefaults -chardev
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-7-s390_generic/monitor.sock,server,nowait
&gt;&gt;&gt;&gt;&gt; -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc
&gt;&gt;&gt;&gt;&gt; -no-shutdown -boot strict=on -device
&gt;&gt;&gt;&gt;&gt; virtio-scsi-ccw,id=scsi0,devno=fe.0.0002 -drive
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; file=/dev/lvm_pda/libvirt_s390,format=raw,if=none,id=drive-virtio-disk0,cache=none,aio=native
&gt;&gt;&gt;&gt;&gt; -device
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; virtio-blk-ccw,scsi=off,devno=fe.0.0000,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1
&gt;&gt;&gt;&gt;&gt; -drive if=none,id=drive-scsi0-0-0-0,readonly=on -device
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; scsi-cd,bus=scsi0.0,channel=0,scsi-id=0,lun=0,drive=drive-scsi0-0-0-0,id=scsi0-0-0-0
&gt;&gt;&gt;&gt;&gt; -netdev tap,fd=26,id=hostnet0 -device
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; virtio-net-ccw,netdev=hostnet0,id=net0,mac=52:54:00:e8:61:7e,devno=fe.0.0001
&gt;&gt;&gt;&gt;&gt; -chardev pty,id=charconsole0 -device
&gt;&gt;&gt;&gt;&gt; sclpconsole,chardev=charconsole0,id=console0 -device
&gt;&gt;&gt;&gt;&gt; virtio-balloon-ccw,id=balloon0,devno=fe.0.0003 -msg timestamp=on
&gt;&gt;&gt;&gt;&gt; 2017-10-19T18:10:21.701184Z qemu-system-s390x: -chardev
&gt;&gt;&gt;&gt;&gt; pty,id=charconsole0: char device redirected to /dev/pts/5 (label
&gt;&gt;&gt;&gt;&gt; charconsole0)
&gt;&gt;&gt;&gt;&gt; 2017-10-19T18:10:21.721299Z qemu-system-s390x: terminating on signal 15
&gt;&gt;&gt;&gt;&gt; from pid 2146 (/usr/sbin/libvirtd)
&gt;&gt;&gt;&gt;&gt; 2017-10-19 18:10:21.985+0000: shutting down, reason=shutdown
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; You don't have much logging enabled, so there's not that much info.
&gt;&gt;&gt;&gt; What's
&gt;&gt;&gt;&gt; in
&gt;&gt;&gt;&gt; the libvirtd.log?  what is the status reason for the domain?  I.e. output
&gt;&gt;&gt;&gt; of
&gt;&gt;&gt;&gt; `virsh domstate --reason` ?
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; How could I increase log level? There is nothing in libvirtd.log.
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; https://wiki.libvirt.org/page/DebugLogs
&gt;
&gt; Too much info for me...
&gt;
&gt; --
&gt; With best regards,
&gt; Matwey V. Kornilov



-- 
With best regards,
Matwey V. Kornilov

["debug.log.xz" (application/x-xz)]

</body></email><email><emailId>20171024095845</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-10-24 09:58:45-0400</timestampReceived><subject>Re: [libvirt-users] terminating on signal 15 from pid 2146 (/usr/sbin/libvirtd)</subject><body>


On Fri, Oct 20, 2017 at 10:12:19PM +0300, Matwey V. Kornilov wrote:
&gt;2017-10-20 17:14 GMT+03:00 Matwey V. Kornilov &lt;matwey.kornilov@gmail.com&gt;:
&gt;&gt; 2017-10-20 15:16 GMT+03:00 Martin Kletzander &lt;mkletzan@redhat.com&gt;:
&gt;&gt;&gt; On Fri, Oct 20, 2017 at 03:07:19PM +0300, Matwey V. Kornilov wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 2017-10-20 14:59 GMT+03:00 Martin Kletzander &lt;mkletzan@redhat.com&gt;:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On Thu, Oct 19, 2017 at 09:11:00PM +0300, Matwey V. Kornilov wrote:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Hello,
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; I use libvirt 3.3.0 and qemu 2.9.0
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; My domain XML spec is the following:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; &lt;domain type='qemu'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;  &lt;name&gt;s390_generic&lt;/name&gt;
&gt;&gt;&gt;&gt;&gt;&gt;  &lt;uuid&gt;82b4d16e-b636-447e-9fda-41d44616bce8&lt;/uuid&gt;
&gt;&gt;&gt;&gt;&gt;&gt;  &lt;memory unit='KiB'&gt;1048576&lt;/memory&gt;
&gt;&gt;&gt;&gt;&gt;&gt;  &lt;currentMemory unit='KiB'&gt;1048576&lt;/currentMemory&gt;
&gt;&gt;&gt;&gt;&gt;&gt;  &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
&gt;&gt;&gt;&gt;&gt;&gt;  &lt;os&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;type arch='s390x' machine='s390-ccw-virtio-2.9'&gt;hvm&lt;/type&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;boot dev='hd'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;  &lt;/os&gt;
&gt;&gt;&gt;&gt;&gt;&gt;  &lt;clock offset='utc'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
&gt;&gt;&gt;&gt;&gt;&gt;  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
&gt;&gt;&gt;&gt;&gt;&gt;  &lt;on_crash&gt;destroy&lt;/on_crash&gt;
&gt;&gt;&gt;&gt;&gt;&gt;  &lt;devices&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;emulator&gt;/usr/bin/qemu-system-s390x&lt;/emulator&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;disk type='block' device='disk'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;driver name='qemu' type='raw' cache='none' io='native'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;source dev='/dev/lvm_pda/libvirt_s390'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;target dev='vda' bus='virtio'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0000'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;/disk&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;disk type='file' device='cdrom'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;driver name='qemu' type='raw'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;target dev='sda' bus='scsi'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;readonly/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;/disk&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;controller type='scsi' index='0' model='virtio-scsi'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0002'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;/controller&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;interface type='bridge'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;mac address='52:54:00:e8:61:7e'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;source bridge='br0'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0001'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;/interface&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;console type='pty'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;target type='sclp' port='0'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;/console&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;memballoon model='virtio'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0003'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;/memballoon&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;panic model='s390'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;  &lt;/devices&gt;
&gt;&gt;&gt;&gt;&gt;&gt; &lt;/domain&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; The issue is that when I try to start it, it starts and shutdowns
&gt;&gt;&gt;&gt;&gt;&gt; immediately:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; virsh # start s390_generic
&gt;&gt;&gt;&gt;&gt;&gt; Domain s390_generic started
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; virsh #
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; In the domain log file I see the following:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; 2017-10-19 18:10:21.633+0000: starting up libvirt version: 3.3.0, qemu
&gt;&gt;&gt;&gt;&gt;&gt; version: 2.9.0(openSUSE Leap 42.3), hostname: oak.local
&gt;&gt;&gt;&gt;&gt;&gt; LC_ALL=C
&gt;&gt;&gt;&gt;&gt;&gt; PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
&gt;&gt;&gt;&gt;&gt;&gt; QEMU_AUDIO_DRV=none /usr/bin/qemu-system-s390x -name
&gt;&gt;&gt;&gt;&gt;&gt; guest=s390_generic,debug-threads=on -S -object
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; secret,id=masterKey0,format=raw,file=/var/lib/libvirt/qemu/domain-7-s390_generic/master-key.aes
&gt;&gt;&gt;&gt;&gt;&gt; -machine s390-ccw-virtio-2.9,accel=tcg,usb=off,dump-guest-core=off -m
&gt;&gt;&gt;&gt;&gt;&gt; 1024 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -uuid
&gt;&gt;&gt;&gt;&gt;&gt; 82b4d16e-b636-447e-9fda-41d44616bce8 -display none -no-user-config
&gt;&gt;&gt;&gt;&gt;&gt; -nodefaults -chardev
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-7-s390_generic/monitor.sock,server,nowait
&gt;&gt;&gt;&gt;&gt;&gt; -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc
&gt;&gt;&gt;&gt;&gt;&gt; -no-shutdown -boot strict=on -device
&gt;&gt;&gt;&gt;&gt;&gt; virtio-scsi-ccw,id=scsi0,devno=fe.0.0002 -drive
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; file=/dev/lvm_pda/libvirt_s390,format=raw,if=none,id=drive-virtio-disk0,cache=none,aio=native
&gt;&gt;&gt;&gt;&gt;&gt; -device
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; virtio-blk-ccw,scsi=off,devno=fe.0.0000,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1
&gt;&gt;&gt;&gt;&gt;&gt; -drive if=none,id=drive-scsi0-0-0-0,readonly=on -device
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; scsi-cd,bus=scsi0.0,channel=0,scsi-id=0,lun=0,drive=drive-scsi0-0-0-0,id=scsi0-0-0-0
&gt;&gt;&gt;&gt;&gt;&gt; -netdev tap,fd=26,id=hostnet0 -device
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; virtio-net-ccw,netdev=hostnet0,id=net0,mac=52:54:00:e8:61:7e,devno=fe.0.0001
&gt;&gt;&gt;&gt;&gt;&gt; -chardev pty,id=charconsole0 -device
&gt;&gt;&gt;&gt;&gt;&gt; sclpconsole,chardev=charconsole0,id=console0 -device
&gt;&gt;&gt;&gt;&gt;&gt; virtio-balloon-ccw,id=balloon0,devno=fe.0.0003 -msg timestamp=on
&gt;&gt;&gt;&gt;&gt;&gt; 2017-10-19T18:10:21.701184Z qemu-system-s390x: -chardev
&gt;&gt;&gt;&gt;&gt;&gt; pty,id=charconsole0: char device redirected to /dev/pts/5 (label
&gt;&gt;&gt;&gt;&gt;&gt; charconsole0)
&gt;&gt;&gt;&gt;&gt;&gt; 2017-10-19T18:10:21.721299Z qemu-system-s390x: terminating on signal 15
&gt;&gt;&gt;&gt;&gt;&gt; from pid 2146 (/usr/sbin/libvirtd)
&gt;&gt;&gt;&gt;&gt;&gt; 2017-10-19 18:10:21.985+0000: shutting down, reason=shutdown
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; You don't have much logging enabled, so there's not that much info.
&gt;&gt;&gt;&gt;&gt; What's
&gt;&gt;&gt;&gt;&gt; in
&gt;&gt;&gt;&gt;&gt; the libvirtd.log?  what is the status reason for the domain?  I.e. output
&gt;&gt;&gt;&gt;&gt; of
&gt;&gt;&gt;&gt;&gt; `virsh domstate --reason` ?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; How could I increase log level? There is nothing in libvirtd.log.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; https://wiki.libvirt.org/page/DebugLogs
&gt;&gt;
&gt;&gt; Too much info for me...
&gt;&gt;

We are getting 'shutdown' event from the QEMU process, so this is not done by
libvirt.  Could you also check the qemu log now that you have debug logs
enabled?

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20171025142837</emailId><senderName>"Matwey V. Kornilov"</senderName><senderEmail>matwey.kornilov@gmail.com</senderEmail><timestampReceived>2017-10-25 14:28:37-0400</timestampReceived><subject>Re: [libvirt-users] terminating on signal 15 from pid 2146 (/usr/sbin/libvirtd)</subject><body>

2017-10-24 12:58 GMT+03:00 Martin Kletzander &lt;mkletzan@redhat.com&gt;:
&gt; On Fri, Oct 20, 2017 at 10:12:19PM +0300, Matwey V. Kornilov wrote:
&gt;&gt;
&gt;&gt; 2017-10-20 17:14 GMT+03:00 Matwey V. Kornilov &lt;matwey.kornilov@gmail.com&gt;:
&gt;&gt;&gt;
&gt;&gt;&gt; 2017-10-20 15:16 GMT+03:00 Martin Kletzander &lt;mkletzan@redhat.com&gt;:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Fri, Oct 20, 2017 at 03:07:19PM +0300, Matwey V. Kornilov wrote:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; 2017-10-20 14:59 GMT+03:00 Martin Kletzander &lt;mkletzan@redhat.com&gt;:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; On Thu, Oct 19, 2017 at 09:11:00PM +0300, Matwey V. Kornilov wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Hello,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; I use libvirt 3.3.0 and qemu 2.9.0
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; My domain XML spec is the following:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &lt;domain type='qemu'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;  &lt;name&gt;s390_generic&lt;/name&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;  &lt;uuid&gt;82b4d16e-b636-447e-9fda-41d44616bce8&lt;/uuid&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;  &lt;memory unit='KiB'&gt;1048576&lt;/memory&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;  &lt;currentMemory unit='KiB'&gt;1048576&lt;/currentMemory&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;  &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;  &lt;os&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;    &lt;type arch='s390x' machine='s390-ccw-virtio-2.9'&gt;hvm&lt;/type&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;    &lt;boot dev='hd'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;  &lt;/os&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;  &lt;clock offset='utc'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;  &lt;on_crash&gt;destroy&lt;/on_crash&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;  &lt;devices&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;    &lt;emulator&gt;/usr/bin/qemu-system-s390x&lt;/emulator&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;    &lt;disk type='block' device='disk'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;      &lt;driver name='qemu' type='raw' cache='none' io='native'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;      &lt;source dev='/dev/lvm_pda/libvirt_s390'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;      &lt;target dev='vda' bus='virtio'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0000'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;    &lt;/disk&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;    &lt;disk type='file' device='cdrom'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;      &lt;driver name='qemu' type='raw'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;      &lt;target dev='sda' bus='scsi'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;      &lt;readonly/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;      &lt;address type='drive' controller='0' bus='0' target='0'
&gt;&gt;&gt;&gt;&gt;&gt;&gt; unit='0'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;    &lt;/disk&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;    &lt;controller type='scsi' index='0' model='virtio-scsi'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0002'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;    &lt;/controller&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;    &lt;interface type='bridge'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;      &lt;mac address='52:54:00:e8:61:7e'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;      &lt;source bridge='br0'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;      &lt;model type='virtio'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0001'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;    &lt;/interface&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;    &lt;console type='pty'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;      &lt;target type='sclp' port='0'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;    &lt;/console&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;    &lt;memballoon model='virtio'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0003'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;    &lt;/memballoon&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;    &lt;panic model='s390'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;  &lt;/devices&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &lt;/domain&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; The issue is that when I try to start it, it starts and shutdowns
&gt;&gt;&gt;&gt;&gt;&gt;&gt; immediately:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; virsh # start s390_generic
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Domain s390_generic started
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; virsh #
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; In the domain log file I see the following:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 2017-10-19 18:10:21.633+0000: starting up libvirt version: 3.3.0,
&gt;&gt;&gt;&gt;&gt;&gt;&gt; qemu
&gt;&gt;&gt;&gt;&gt;&gt;&gt; version: 2.9.0(openSUSE Leap 42.3), hostname: oak.local
&gt;&gt;&gt;&gt;&gt;&gt;&gt; LC_ALL=C
&gt;&gt;&gt;&gt;&gt;&gt;&gt; PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
&gt;&gt;&gt;&gt;&gt;&gt;&gt; QEMU_AUDIO_DRV=none /usr/bin/qemu-system-s390x -name
&gt;&gt;&gt;&gt;&gt;&gt;&gt; guest=s390_generic,debug-threads=on -S -object
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; secret,id=masterKey0,format=raw,file=/var/lib/libvirt/qemu/domain-7-s390_generic/master-key.aes
&gt;&gt;&gt;&gt;&gt;&gt;&gt; -machine s390-ccw-virtio-2.9,accel=tcg,usb=off,dump-guest-core=off -m
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 1024 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -uuid
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 82b4d16e-b636-447e-9fda-41d44616bce8 -display none -no-user-config
&gt;&gt;&gt;&gt;&gt;&gt;&gt; -nodefaults -chardev
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-7-s390_generic/monitor.sock,server,nowait
&gt;&gt;&gt;&gt;&gt;&gt;&gt; -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc
&gt;&gt;&gt;&gt;&gt;&gt;&gt; -no-shutdown -boot strict=on -device
&gt;&gt;&gt;&gt;&gt;&gt;&gt; virtio-scsi-ccw,id=scsi0,devno=fe.0.0002 -drive
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; file=/dev/lvm_pda/libvirt_s390,format=raw,if=none,id=drive-virtio-disk0,cache=none,aio=native
&gt;&gt;&gt;&gt;&gt;&gt;&gt; -device
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; virtio-blk-ccw,scsi=off,devno=fe.0.0000,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1
&gt;&gt;&gt;&gt;&gt;&gt;&gt; -drive if=none,id=drive-scsi0-0-0-0,readonly=on -device
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; scsi-cd,bus=scsi0.0,channel=0,scsi-id=0,lun=0,drive=drive-scsi0-0-0-0,id=scsi0-0-0-0
&gt;&gt;&gt;&gt;&gt;&gt;&gt; -netdev tap,fd=26,id=hostnet0 -device
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; virtio-net-ccw,netdev=hostnet0,id=net0,mac=52:54:00:e8:61:7e,devno=fe.0.0001
&gt;&gt;&gt;&gt;&gt;&gt;&gt; -chardev pty,id=charconsole0 -device
&gt;&gt;&gt;&gt;&gt;&gt;&gt; sclpconsole,chardev=charconsole0,id=console0 -device
&gt;&gt;&gt;&gt;&gt;&gt;&gt; virtio-balloon-ccw,id=balloon0,devno=fe.0.0003 -msg timestamp=on
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 2017-10-19T18:10:21.701184Z qemu-system-s390x: -chardev
&gt;&gt;&gt;&gt;&gt;&gt;&gt; pty,id=charconsole0: char device redirected to /dev/pts/5 (label
&gt;&gt;&gt;&gt;&gt;&gt;&gt; charconsole0)
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 2017-10-19T18:10:21.721299Z qemu-system-s390x: terminating on signal
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 15
&gt;&gt;&gt;&gt;&gt;&gt;&gt; from pid 2146 (/usr/sbin/libvirtd)
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 2017-10-19 18:10:21.985+0000: shutting down, reason=shutdown
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; You don't have much logging enabled, so there's not that much info.
&gt;&gt;&gt;&gt;&gt;&gt; What's
&gt;&gt;&gt;&gt;&gt;&gt; in
&gt;&gt;&gt;&gt;&gt;&gt; the libvirtd.log?  what is the status reason for the domain?  I.e.
&gt;&gt;&gt;&gt;&gt;&gt; output
&gt;&gt;&gt;&gt;&gt;&gt; of
&gt;&gt;&gt;&gt;&gt;&gt; `virsh domstate --reason` ?
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; How could I increase log level? There is nothing in libvirtd.log.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; https://wiki.libvirt.org/page/DebugLogs
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Too much info for me...
&gt;&gt;&gt;
&gt;
&gt; We are getting 'shutdown' event from the QEMU process, so this is not done
&gt; by
&gt; libvirt.  Could you also check the qemu log now that you have debug logs
&gt; enabled?

2017-10-20 13:49:12.596+0000: starting up libvirt version: 3.3.0, qemu
version: 2.9.0(openSUSE Leap 42.3), hostname: oak.local
LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
QEMU_AUDIO_DRV=none /usr/bin/qemu-system-s390x -name
guest=s390_generic,debug-threads=on -S -object
secret,id=masterKey0,format=raw,file=/var/lib/libvirt/qemu/domain-3-s390_generic/master-key.aes
-machine s390-ccw-virtio-2.9,accel=tcg,usb=off,dump-guest-core=off -m
1024 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -uuid
82b4d16e-b636-447e-9fda-41d44616bce8 -display none -no-user-config
-nodefaults -chardev
socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-3-s390_generic/monitor.sock,server,nowait
-mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc
-no-shutdown -boot strict=on -device
virtio-scsi-ccw,id=scsi0,devno=fe.0.0002 -drive
file=/dev/lvm_pda/libvirt_s390,format=raw,if=none,id=drive-virtio-disk0,cache=none,aio=native
-device virtio-blk-ccw,scsi=off,devno=fe.0.0000,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1
-drive if=none,id=drive-scsi0-0-0-0,readonly=on -device
scsi-cd,bus=scsi0.0,channel=0,scsi-id=0,lun=0,drive=drive-scsi0-0-0-0,id=scsi0-0-0-0
-netdev tap,fd=26,id=hostnet0 -device
virtio-net-ccw,netdev=hostnet0,id=net0,mac=52:54:00:e8:61:7e,devno=fe.0.0001
-chardev pty,id=charconsole0 -device
sclpconsole,chardev=charconsole0,id=console0 -device
virtio-balloon-ccw,id=balloon0,devno=fe.0.0003 -msg timestamp=on
2017-10-20 13:49:12.600+0000: 11179: debug : virFileClose:110 : Closed fd 27
2017-10-20 13:49:12.600+0000: 11179: debug : virFileClose:110 : Closed fd 32
2017-10-20 13:49:12.601+0000: 11179: debug : virFileClose:110 : Closed fd 3
2017-10-20 13:49:12.601+0000: 11181: debug : virExec:697 : Run hook
0x7fc7e7d339c0 0x7fc8080cb650
2017-10-20 13:49:12.601+0000: 11181: debug : qemuProcessHook:2663 :
Obtaining domain lock
2017-10-20 13:49:12.601+0000: 11181: debug :
virDomainLockProcessStart:179 : plugin=0x7fc7b41e7290
dom=0x7fc7b4256400 paused=1 fd=0x7fc8080cb1b8
2017-10-20 13:49:12.601+0000: 11181: debug :
virDomainLockManagerNew:134 : plugin=0x7fc7b41e7290 dom=0x7fc7b4256400
withResources=1
2017-10-20 13:49:12.601+0000: 11181: debug :
virLockManagerPluginGetDriver:281 : plugin=0x7fc7b41e7290
2017-10-20 13:49:12.601+0000: 11181: debug : virLockManagerNew:305 :
driver=0x7fc81283a3a0 type=0 nparams=5 params=0x7fc8080cb070 flags=1
2017-10-20 13:49:12.601+0000: 11181: debug :
virLockManagerLogParams:98 :   key=uuid type=uuid
value=82b4d16e-b636-447e-9fda-41d44616bce8
2017-10-20 13:49:12.601+0000: 11181: debug :
virLockManagerLogParams:91 :   key=name type=string value=s390_generic
2017-10-20 13:49:12.601+0000: 11181: debug :
virLockManagerLogParams:79 :   key=id type=uint value=3
2017-10-20 13:49:12.601+0000: 11181: debug :
virLockManagerLogParams:79 :   key=pid type=uint value=11181
2017-10-20 13:49:12.601+0000: 11181: debug :
virLockManagerLogParams:94 :   key=uri type=cstring
value=qemu:///system
2017-10-20 13:49:12.601+0000: 11181: debug :
virDomainLockManagerNew:146 : Adding leases
2017-10-20 13:49:12.601+0000: 11181: debug :
virDomainLockManagerNew:151 : Adding disks
2017-10-20 13:49:12.601+0000: 11181: debug :
virDomainLockManagerAddImage:90 : Add disk /dev/lvm_pda/libvirt_s390
2017-10-20 13:49:12.601+0000: 11181: debug :
virLockManagerAddResource:332 : lock=0x7fc7ec002350 type=0
name=/dev/lvm_pda/libvirt_s390 nparams=0 params=(nil) flags=0
2017-10-20 13:49:12.601+0000: 11181: debug : virLockManagerAcquire:350
: lock=0x7fc7ec002350 state='&lt;null&gt;' flags=3 action=0
fd=0x7fc8080cb1b8
2017-10-20 13:49:12.601+0000: 11181: debug : virLockManagerFree:387 :
lock=0x7fc7ec002350
2017-10-20 13:49:12.601+0000: 11181: debug :
virFileGetMountSubtreeImpl:1923 : prefix=/dev
2017-10-20 13:49:12.602+0000: 11181: debug : qemuDomainSetupDev:7701 :
Setting up /dev/ for domain s390_generic
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 :
path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 : path=/var/run/libvirt/qemu mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug : virFileSetupDev:3597 :
Mount devfs on /var/run/libvirt/qemu/s390_generic.dev type=tmpfs
flags=2, opts=mode=755,size=65536
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakeParentPath:2984 :
path=/var/run/libvirt/qemu/s390_generic.dev/null
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 :
path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainCreateDeviceRecursive:7517 : Creating dev /dev/null
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakeParentPath:2984 :
path=/var/run/libvirt/qemu/s390_generic.dev/full
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 :
path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainCreateDeviceRecursive:7517 : Creating dev /dev/full
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakeParentPath:2984 :
path=/var/run/libvirt/qemu/s390_generic.dev/zero
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 :
path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainCreateDeviceRecursive:7517 : Creating dev /dev/zero
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakeParentPath:2984 :
path=/var/run/libvirt/qemu/s390_generic.dev/random
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 :
path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainCreateDeviceRecursive:7517 : Creating dev /dev/random
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakeParentPath:2984 :
path=/var/run/libvirt/qemu/s390_generic.dev/urandom
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 :
path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainCreateDeviceRecursive:7517 : Creating dev /dev/urandom
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakeParentPath:2984 :
path=/var/run/libvirt/qemu/s390_generic.dev/ptmx
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 :
path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainCreateDeviceRecursive:7517 : Creating dev /dev/ptmx
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakeParentPath:2984 :
path=/var/run/libvirt/qemu/s390_generic.dev/kvm
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 :
path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainCreateDeviceRecursive:7517 : Creating dev /dev/kvm
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakeParentPath:2984 :
path=/var/run/libvirt/qemu/s390_generic.dev/rtc
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 :
path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainCreateDeviceRecursive:7517 : Creating dev /dev/rtc
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakeParentPath:2984 :
path=/var/run/libvirt/qemu/s390_generic.dev/rtc0
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 :
path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainCreateDeviceRecursive:7517 : Creating dev /dev/rtc0
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakeParentPath:2984 :
path=/var/run/libvirt/qemu/s390_generic.dev/hpet
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 :
path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainCreateDeviceRecursive:7517 : Creating dev /dev/hpet
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainSetupAllDisks:7763 : Setting up disks
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakeParentPath:2984 :
path=/var/run/libvirt/qemu/s390_generic.dev/lvm_pda/libvirt_s390
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 :
path=/var/run/libvirt/qemu/s390_generic.dev/lvm_pda mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 :
path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainCreateDeviceRecursive:7517 : Creating dev
/dev/lvm_pda/libvirt_s390
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakeParentPath:2984 :
path=/var/run/libvirt/qemu/s390_generic.dev/lvm_pda/../dm-27
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 :
path=/var/run/libvirt/qemu/s390_generic.dev/lvm_pda/.. mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainCreateDeviceRecursive:7517 : Creating dev
/dev/lvm_pda/../dm-27
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainSetupAllDisks:7772 : Setup all disks
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainSetupAllHostdevs:7810 : Setting up hostdevs
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainSetupAllHostdevs:7817 : Setup all hostdevs
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainSetupAllMemories:7841 : Setting up memories
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainSetupAllMemories:7848 : Setup all memories
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainSetupAllChardevs:7872 : Setting up chardevs
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainSetupAllChardevs:7880 : Setup all chardevs
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainSetupAllGraphics:7937 : Setting up graphics
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainSetupAllGraphics:7945 : Setup all graphics
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainSetupAllInputs:7984 : Setting up inputs
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainSetupAllInputs:7991 : Setup all inputs
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainSetupAllRNGs:8023 : Setting up RNGs
2017-10-20 13:49:12.602+0000: 11181: debug :
qemuDomainSetupAllRNGs:8031 : Setup all RNGs
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 :
path=/var/run/libvirt/qemu/s390_generic.hugepages mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 : path=/var/run/libvirt/qemu mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 :
path=/var/run/libvirt/qemu/s390_generic.mqueue mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 : path=/var/run/libvirt/qemu mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 :
path=/var/run/libvirt/qemu/s390_generic.pts mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 : path=/var/run/libvirt/qemu mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 :
path=/var/run/libvirt/qemu/s390_generic.shm mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 : path=/var/run/libvirt/qemu mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 : path=/dev/hugepages mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 : path=/dev mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 : path=/dev/mqueue mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 : path=/dev mode=0777
2017-10-20 13:49:12.602+0000: 11181: debug :
virFileMakePathHelper:2912 : path=/dev/pts mode=0777
2017-10-20 13:49:12.603+0000: 11181: debug :
virFileMakePathHelper:2912 : path=/dev mode=0777
2017-10-20 13:49:12.603+0000: 11181: debug :
virFileMakePathHelper:2912 : path=/dev/shm mode=0777
2017-10-20 13:49:12.603+0000: 11181: debug :
virFileMakePathHelper:2912 : path=/dev mode=0777
2017-10-20 13:49:12.603+0000: 11181: info : virObjectUnref:259 :
OBJECT_UNREF: obj=0x7fc7b4150120
2017-10-20 13:49:12.603+0000: 11181: debug : qemuProcessHook:2707 :
Hook complete ret=0
2017-10-20 13:49:12.603+0000: 11181: debug : virExec:699 : Done hook 0
2017-10-20 13:49:12.603+0000: 11181: debug : virExec:736 : Setting
child uid:gid to 479:476 with caps 0
2017-10-20 13:49:12.603+0000: 11181: debug :
virCommandHandshakeChild:435 : Notifying parent for handshake start on
29
2017-10-20 13:49:12.603+0000: 11181: debug :
virCommandHandshakeChild:443 : Waiting on parent for handshake
complete on 30
2017-10-20 13:49:12.649+0000: 11181: debug : virFileClose:110 : Closed fd 29
2017-10-20 13:49:12.649+0000: 11181: debug : virFileClose:110 : Closed fd 30
2017-10-20 13:49:12.649+0000: 11181: debug :
virCommandHandshakeChild:463 : Handshake with parent is done
2017-10-20T13:49:12.675569Z qemu-system-s390x: -chardev
pty,id=charconsole0: char device redirected to /dev/pts/7 (label
charconsole0)
2017-10-20T13:49:12.715606Z qemu-system-s390x: terminating on signal
15 from pid 10645 (/usr/sbin/libvirtd)
2017-10-20 13:49:12.998+0000: shutting down, reason=shutdown


-- 
With best regards,
Matwey V. Kornilov

</body></email><email><emailId>20171025184158</emailId><senderName>"Matwey V. Kornilov"</senderName><senderEmail>matwey.kornilov@gmail.com</senderEmail><timestampReceived>2017-10-25 18:41:58-0400</timestampReceived><subject>Re: [libvirt-users] terminating on signal 15 from pid 2146 (/usr/sbin/libvirtd)</subject><body>

2017-10-25 17:28 GMT+03:00 Matwey V. Kornilov &lt;matwey.kornilov@gmail.com&gt;:
&gt; 2017-10-24 12:58 GMT+03:00 Martin Kletzander &lt;mkletzan@redhat.com&gt;:
&gt; &gt; On Fri, Oct 20, 2017 at 10:12:19PM +0300, Matwey V. Kornilov wrote:
&gt; &gt; &gt; 
&gt; &gt; &gt; 2017-10-20 17:14 GMT+03:00 Matwey V. Kornilov &lt;matwey.kornilov@gmail.com&gt;:
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 2017-10-20 15:16 GMT+03:00 Martin Kletzander &lt;mkletzan@redhat.com&gt;:
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; On Fri, Oct 20, 2017 at 03:07:19PM +0300, Matwey V. Kornilov wrote:
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; 2017-10-20 14:59 GMT+03:00 Martin Kletzander &lt;mkletzan@redhat.com&gt;:
&gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; On Thu, Oct 19, 2017 at 09:11:00PM +0300, Matwey V. Kornilov wrote:
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Hello,
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; I use libvirt 3.3.0 and qemu 2.9.0
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; My domain XML spec is the following:
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;domain type='qemu'&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;name&gt;s390_generic&lt;/name&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;uuid&gt;82b4d16e-b636-447e-9fda-41d44616bce8&lt;/uuid&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;memory unit='KiB'&gt;1048576&lt;/memory&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;currentMemory unit='KiB'&gt;1048576&lt;/currentMemory&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;os&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;type arch='s390x' machine='s390-ccw-virtio-2.9'&gt;hvm&lt;/type&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;boot dev='hd'/&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;/os&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;clock offset='utc'/&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;on_crash&gt;destroy&lt;/on_crash&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;devices&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;emulator&gt;/usr/bin/qemu-system-s390x&lt;/emulator&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;disk type='block' device='disk'&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;driver name='qemu' type='raw' cache='none' io='native'/&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;source dev='/dev/lvm_pda/libvirt_s390'/&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;target dev='vda' bus='virtio'/&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0000'/&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;/disk&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;disk type='file' device='cdrom'&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;driver name='qemu' type='raw'/&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;target dev='sda' bus='scsi'/&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;readonly/&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;address type='drive' controller='0' bus='0' target='0'
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; unit='0'/&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;/disk&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;controller type='scsi' index='0' model='virtio-scsi'&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0002'/&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;/controller&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;interface type='bridge'&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;mac address='52:54:00:e8:61:7e'/&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;source bridge='br0'/&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;model type='virtio'/&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0001'/&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;/interface&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;console type='pty'&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;target type='sclp' port='0'/&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;/console&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;memballoon model='virtio'&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0003'/&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;/memballoon&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;panic model='s390'/&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;/devices&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt;/domain&gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; The issue is that when I try to start it, it starts and shutdowns
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; immediately:
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; virsh # start s390_generic
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Domain s390_generic started
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; virsh #
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; In the domain log file I see the following:
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 2017-10-19 18:10:21.633+0000: starting up libvirt version: 3.3.0,
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; qemu
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; version: 2.9.0(openSUSE Leap 42.3), hostname: oak.local
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; LC_ALL=C
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; QEMU_AUDIO_DRV=none /usr/bin/qemu-system-s390x -name
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; guest=s390_generic,debug-threads=on -S -object
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; secret,id=masterKey0,format=raw,file=/var/lib/libvirt/qemu/domain-7-s390_generic/master-key.aes
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;                 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; -machine s390-ccw-virtio-2.9,accel=tcg,usb=off,dump-guest-core=off -m
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 1024 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -uuid
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 82b4d16e-b636-447e-9fda-41d44616bce8 -display none -no-user-config
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; -nodefaults -chardev
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-7-s390_generic/monitor.sock,server,nowait
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;                 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; -no-shutdown -boot strict=on -device
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; virtio-scsi-ccw,id=scsi0,devno=fe.0.0002 -drive
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; file=/dev/lvm_pda/libvirt_s390,format=raw,if=none,id=drive-virtio-disk0,cache=none,aio=native
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;                 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; -device
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; virtio-blk-ccw,scsi=off,devno=fe.0.0000,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;                 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; -drive if=none,id=drive-scsi0-0-0-0,readonly=on -device
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; scsi-cd,bus=scsi0.0,channel=0,scsi-id=0,lun=0,drive=drive-scsi0-0-0-0,id=scsi0-0-0-0
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;                 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; -netdev tap,fd=26,id=hostnet0 -device
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; virtio-net-ccw,netdev=hostnet0,id=net0,mac=52:54:00:e8:61:7e,devno=fe.0.0001
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;                 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; -chardev pty,id=charconsole0 -device
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; sclpconsole,chardev=charconsole0,id=console0 -device
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; virtio-balloon-ccw,id=balloon0,devno=fe.0.0003 -msg timestamp=on
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 2017-10-19T18:10:21.701184Z qemu-system-s390x: -chardev
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; pty,id=charconsole0: char device redirected to /dev/pts/5 (label
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; charconsole0)
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 2017-10-19T18:10:21.721299Z qemu-system-s390x: terminating on signal
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 15
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; from pid 2146 (/usr/sbin/libvirtd)
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 2017-10-19 18:10:21.985+0000: shutting down, reason=shutdown
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; You don't have much logging enabled, so there's not that much info.
&gt; &gt; &gt; &gt; &gt; &gt; &gt; What's
&gt; &gt; &gt; &gt; &gt; &gt; &gt; in
&gt; &gt; &gt; &gt; &gt; &gt; &gt; the libvirtd.log?  what is the status reason for the domain?  I.e.
&gt; &gt; &gt; &gt; &gt; &gt; &gt; output
&gt; &gt; &gt; &gt; &gt; &gt; &gt; of
&gt; &gt; &gt; &gt; &gt; &gt; &gt; `virsh domstate --reason` ?
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; How could I increase log level? There is nothing in libvirtd.log.
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; https://wiki.libvirt.org/page/DebugLogs
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Too much info for me...
&gt; &gt; &gt; &gt; 
&gt; &gt; 
&gt; &gt; We are getting 'shutdown' event from the QEMU process, so this is not done
&gt; &gt; by
&gt; &gt; libvirt.  Could you also check the qemu log now that you have debug logs
&gt; &gt; enabled?
&gt; 
&gt; 2017-10-20 13:49:12.596+0000: starting up libvirt version: 3.3.0, qemu
&gt; version: 2.9.0(openSUSE Leap 42.3), hostname: oak.local
&gt; LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
&gt; QEMU_AUDIO_DRV=none /usr/bin/qemu-system-s390x -name
&gt; guest=s390_generic,debug-threads=on -S -object
&gt; secret,id=masterKey0,format=raw,file=/var/lib/libvirt/qemu/domain-3-s390_generic/master-key.aes
&gt;                 
&gt; -machine s390-ccw-virtio-2.9,accel=tcg,usb=off,dump-guest-core=off -m
&gt; 1024 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -uuid
&gt; 82b4d16e-b636-447e-9fda-41d44616bce8 -display none -no-user-config
&gt; -nodefaults -chardev
&gt; socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-3-s390_generic/monitor.sock,server,nowait
&gt;                 
&gt; -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc
&gt; -no-shutdown -boot strict=on -device
&gt; virtio-scsi-ccw,id=scsi0,devno=fe.0.0002 -drive
&gt; file=/dev/lvm_pda/libvirt_s390,format=raw,if=none,id=drive-virtio-disk0,cache=none,aio=native
&gt;                 
&gt; -device virtio-blk-ccw,scsi=off,devno=fe.0.0000,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1
&gt;                 
&gt; -drive if=none,id=drive-scsi0-0-0-0,readonly=on -device
&gt; scsi-cd,bus=scsi0.0,channel=0,scsi-id=0,lun=0,drive=drive-scsi0-0-0-0,id=scsi0-0-0-0
&gt;                 
&gt; -netdev tap,fd=26,id=hostnet0 -device
&gt; virtio-net-ccw,netdev=hostnet0,id=net0,mac=52:54:00:e8:61:7e,devno=fe.0.0001
&gt; -chardev pty,id=charconsole0 -device
&gt; sclpconsole,chardev=charconsole0,id=console0 -device
&gt; virtio-balloon-ccw,id=balloon0,devno=fe.0.0003 -msg timestamp=on
&gt; 2017-10-20 13:49:12.600+0000: 11179: debug : virFileClose:110 : Closed fd 27
&gt; 2017-10-20 13:49:12.600+0000: 11179: debug : virFileClose:110 : Closed fd 32
&gt; 2017-10-20 13:49:12.601+0000: 11179: debug : virFileClose:110 : Closed fd 3
&gt; 2017-10-20 13:49:12.601+0000: 11181: debug : virExec:697 : Run hook
&gt; 0x7fc7e7d339c0 0x7fc8080cb650
&gt; 2017-10-20 13:49:12.601+0000: 11181: debug : qemuProcessHook:2663 :
&gt; Obtaining domain lock
&gt; 2017-10-20 13:49:12.601+0000: 11181: debug :
&gt; virDomainLockProcessStart:179 : plugin=0x7fc7b41e7290
&gt; dom=0x7fc7b4256400 paused=1 fd=0x7fc8080cb1b8
&gt; 2017-10-20 13:49:12.601+0000: 11181: debug :
&gt; virDomainLockManagerNew:134 : plugin=0x7fc7b41e7290 dom=0x7fc7b4256400
&gt; withResources=1
&gt; 2017-10-20 13:49:12.601+0000: 11181: debug :
&gt; virLockManagerPluginGetDriver:281 : plugin=0x7fc7b41e7290
&gt; 2017-10-20 13:49:12.601+0000: 11181: debug : virLockManagerNew:305 :
&gt; driver=0x7fc81283a3a0 type=0 nparams=5 params=0x7fc8080cb070 flags=1
&gt; 2017-10-20 13:49:12.601+0000: 11181: debug :
&gt; virLockManagerLogParams:98 :   key=uuid type=uuid
&gt; value=82b4d16e-b636-447e-9fda-41d44616bce8
&gt; 2017-10-20 13:49:12.601+0000: 11181: debug :
&gt; virLockManagerLogParams:91 :   key=name type=string value=s390_generic
&gt; 2017-10-20 13:49:12.601+0000: 11181: debug :
&gt; virLockManagerLogParams:79 :   key=id type=uint value=3
&gt; 2017-10-20 13:49:12.601+0000: 11181: debug :
&gt; virLockManagerLogParams:79 :   key=pid type=uint value=11181
&gt; 2017-10-20 13:49:12.601+0000: 11181: debug :
&gt; virLockManagerLogParams:94 :   key=uri type=cstring
&gt; value=qemu:///system
&gt; 2017-10-20 13:49:12.601+0000: 11181: debug :
&gt; virDomainLockManagerNew:146 : Adding leases
&gt; 2017-10-20 13:49:12.601+0000: 11181: debug :
&gt; virDomainLockManagerNew:151 : Adding disks
&gt; 2017-10-20 13:49:12.601+0000: 11181: debug :
&gt; virDomainLockManagerAddImage:90 : Add disk /dev/lvm_pda/libvirt_s390
&gt; 2017-10-20 13:49:12.601+0000: 11181: debug :
&gt; virLockManagerAddResource:332 : lock=0x7fc7ec002350 type=0
&gt; name=/dev/lvm_pda/libvirt_s390 nparams=0 params=(nil) flags=0
&gt; 2017-10-20 13:49:12.601+0000: 11181: debug : virLockManagerAcquire:350
&gt; &gt; lock=0x7fc7ec002350 state='&lt;null&gt;' flags=3 action=0
&gt; fd=0x7fc8080cb1b8
&gt; 2017-10-20 13:49:12.601+0000: 11181: debug : virLockManagerFree:387 :
&gt; lock=0x7fc7ec002350
&gt; 2017-10-20 13:49:12.601+0000: 11181: debug :
&gt; virFileGetMountSubtreeImpl:1923 : prefix=/dev
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug : qemuDomainSetupDev:7701 :
&gt; Setting up /dev/ for domain s390_generic
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 : path=/var/run/libvirt/qemu mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug : virFileSetupDev:3597 :
&gt; Mount devfs on /var/run/libvirt/qemu/s390_generic.dev type=tmpfs
&gt; flags=2, opts=mode=755,size=65536
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakeParentPath:2984 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev/null
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainCreateDeviceRecursive:7517 : Creating dev /dev/null
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakeParentPath:2984 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev/full
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainCreateDeviceRecursive:7517 : Creating dev /dev/full
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakeParentPath:2984 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev/zero
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainCreateDeviceRecursive:7517 : Creating dev /dev/zero
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakeParentPath:2984 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev/random
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainCreateDeviceRecursive:7517 : Creating dev /dev/random
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakeParentPath:2984 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev/urandom
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainCreateDeviceRecursive:7517 : Creating dev /dev/urandom
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakeParentPath:2984 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev/ptmx
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainCreateDeviceRecursive:7517 : Creating dev /dev/ptmx
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakeParentPath:2984 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev/kvm
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainCreateDeviceRecursive:7517 : Creating dev /dev/kvm
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakeParentPath:2984 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev/rtc
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainCreateDeviceRecursive:7517 : Creating dev /dev/rtc
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakeParentPath:2984 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev/rtc0
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainCreateDeviceRecursive:7517 : Creating dev /dev/rtc0
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakeParentPath:2984 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev/hpet
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainCreateDeviceRecursive:7517 : Creating dev /dev/hpet
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainSetupAllDisks:7763 : Setting up disks
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakeParentPath:2984 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev/lvm_pda/libvirt_s390
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev/lvm_pda mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainCreateDeviceRecursive:7517 : Creating dev
&gt; /dev/lvm_pda/libvirt_s390
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakeParentPath:2984 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev/lvm_pda/../dm-27
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 :
&gt; path=/var/run/libvirt/qemu/s390_generic.dev/lvm_pda/.. mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainCreateDeviceRecursive:7517 : Creating dev
&gt; /dev/lvm_pda/../dm-27
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainSetupAllDisks:7772 : Setup all disks
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainSetupAllHostdevs:7810 : Setting up hostdevs
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainSetupAllHostdevs:7817 : Setup all hostdevs
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainSetupAllMemories:7841 : Setting up memories
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainSetupAllMemories:7848 : Setup all memories
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainSetupAllChardevs:7872 : Setting up chardevs
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainSetupAllChardevs:7880 : Setup all chardevs
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainSetupAllGraphics:7937 : Setting up graphics
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainSetupAllGraphics:7945 : Setup all graphics
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainSetupAllInputs:7984 : Setting up inputs
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainSetupAllInputs:7991 : Setup all inputs
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainSetupAllRNGs:8023 : Setting up RNGs
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; qemuDomainSetupAllRNGs:8031 : Setup all RNGs
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 :
&gt; path=/var/run/libvirt/qemu/s390_generic.hugepages mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 : path=/var/run/libvirt/qemu mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 :
&gt; path=/var/run/libvirt/qemu/s390_generic.mqueue mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 : path=/var/run/libvirt/qemu mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 :
&gt; path=/var/run/libvirt/qemu/s390_generic.pts mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 : path=/var/run/libvirt/qemu mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 :
&gt; path=/var/run/libvirt/qemu/s390_generic.shm mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 : path=/var/run/libvirt/qemu mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 : path=/dev/hugepages mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 : path=/dev mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 : path=/dev/mqueue mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 : path=/dev mode=0777
&gt; 2017-10-20 13:49:12.602+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 : path=/dev/pts mode=0777
&gt; 2017-10-20 13:49:12.603+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 : path=/dev mode=0777
&gt; 2017-10-20 13:49:12.603+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 : path=/dev/shm mode=0777
&gt; 2017-10-20 13:49:12.603+0000: 11181: debug :
&gt; virFileMakePathHelper:2912 : path=/dev mode=0777
&gt; 2017-10-20 13:49:12.603+0000: 11181: info : virObjectUnref:259 :
&gt; OBJECT_UNREF: obj=0x7fc7b4150120
&gt; 2017-10-20 13:49:12.603+0000: 11181: debug : qemuProcessHook:2707 :
&gt; Hook complete ret=0
&gt; 2017-10-20 13:49:12.603+0000: 11181: debug : virExec:699 : Done hook 0
&gt; 2017-10-20 13:49:12.603+0000: 11181: debug : virExec:736 : Setting
&gt; child uid:gid to 479:476 with caps 0
&gt; 2017-10-20 13:49:12.603+0000: 11181: debug :
&gt; virCommandHandshakeChild:435 : Notifying parent for handshake start on
&gt; 29
&gt; 2017-10-20 13:49:12.603+0000: 11181: debug :
&gt; virCommandHandshakeChild:443 : Waiting on parent for handshake
&gt; complete on 30
&gt; 2017-10-20 13:49:12.649+0000: 11181: debug : virFileClose:110 : Closed fd 29
&gt; 2017-10-20 13:49:12.649+0000: 11181: debug : virFileClose:110 : Closed fd 30
&gt; 2017-10-20 13:49:12.649+0000: 11181: debug :
&gt; virCommandHandshakeChild:463 : Handshake with parent is done
&gt; 2017-10-20T13:49:12.675569Z qemu-system-s390x: -chardev
&gt; pty,id=charconsole0: char device redirected to /dev/pts/7 (label
&gt; charconsole0)
&gt; 2017-10-20T13:49:12.715606Z qemu-system-s390x: terminating on signal
&gt; 15 from pid 10645 (/usr/sbin/libvirtd)
&gt; 2017-10-20 13:49:12.998+0000: shutting down, reason=shutdown
&gt; 
&gt; 
&gt; --
&gt; With best regards,
&gt; Matwey V. Kornilov

Well, I really had to use start --console from the beginning. It would
have safe the time.

# start --console s390_generic
Using guessed DASD geometry.
                            Using ECKD scheme (block size  4096), CDL

                                                                     !
No zIPL section in IPL2 record. !


-- 
With best regards,
Matwey V. Kornilov


</body></email><email><emailId>20171026074529</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-10-26 07:45:29-0400</timestampReceived><subject>Re: [libvirt-users] terminating on signal 15 from pid 2146 (/usr/sbin/libvirtd)</subject><body>


On Wed, Oct 25, 2017 at 09:41:58PM +0300, Matwey V. Kornilov wrote:
&gt;Well, I really had to use start --console from the beginning. It would
&gt;have safe the time.
&gt;
&gt;# start --console s390_generic
&gt;Using guessed DASD geometry.
&gt;                            Using ECKD scheme (block size  4096), CDL
&gt;
&gt;                                                                     !
&gt;No zIPL section in IPL2 record. !
&gt;

Yeah, it all looked like the guest OS just ends normally itself.  So
precisely what libvirt was reporting.

I'm glad this is resolved.

Have a nice day,
Martin

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20171023130259</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-10-23 13:02:59-0400</timestampReceived><subject>Re: [libvirt-users] virsh does no longer respond to commands</subject><body>

Luckily, we were able to sort this problem out by rebooting the hosting 
machine and restoring the guest machine from a backup. Did we stumble 
upon a bug? "blockjob abort" should not leave behind orphaned locks when 
it completed, should it?


On 2017-10-22 14:04, Dominik Psenner wrote:
&gt; Hi,
&gt;
&gt; after a recent live backup done with a snapshot, blockcommit failed and a
&gt; subsequent (manual) blockjob abort got stuck. Now we are unable to do basic
&gt; operations on the virtual machine like if it was frozen and when issuing
&gt; another command we see the following:
&gt;
&gt; $ virsh shutdown $domain
&gt; error: Failed to shutdown domain $domain
&gt; error: Timed out during operation: cannot acquire state change lock (held
&gt; by remoteDispatchDomainBlockJobAbort)
&gt;
&gt; $ virsh blockcommit $domain --active --pivot
&gt; error: Timed out during operation: cannot acquire state change lock (held
&gt; by remoteDispatchDomainBlockJobAbort)
&gt;
&gt; $ virsh blockjob $domain --abort
&gt; error: Timed out during operation: cannot acquire state change lock (held
&gt; by remoteDispatchDomainBlockJobAbort)
&gt;
&gt; Houston, we've got a problem. We have roughly 16 hours to fix this. Any
&gt; help is appreciated!

</body></email><email><emailId>20171025123408</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-10-25 12:34:08-0400</timestampReceived><subject>Re: [libvirt-users] virsh does no longer respond to commands</subject><body>

On 10/22/2017 02:04 PM, Dominik Psenner wrote:
&gt; Hi,
&gt; 
&gt; after a recent live backup done with a snapshot, blockcommit failed and a
&gt; subsequent (manual) blockjob abort got stuck. Now we are unable to do basic
&gt; operations on the virtual machine like if it was frozen and when issuing
&gt; another command we see the following:
&gt; 
&gt; $ virsh shutdown $domain
&gt; error: Failed to shutdown domain $domain
&gt; error: Timed out during operation: cannot acquire state change lock (held
&gt; by remoteDispatchDomainBlockJobAbort)
&gt; 
&gt; $ virsh blockcommit $domain --active --pivot
&gt; error: Timed out during operation: cannot acquire state change lock (held
&gt; by remoteDispatchDomainBlockJobAbort)
&gt; 
&gt; $ virsh blockjob $domain --abort
&gt; error: Timed out during operation: cannot acquire state change lock (held
&gt; by remoteDispatchDomainBlockJobAbort)
&gt; 

This looks like some API forgot to unset the job before returning. In
that case, restarting libvirtd is the only option. If this happened on
the latest release please do file a bug. Otherwise try with the latest
release.

Michal

</body></email><email><emailId>20171025173621</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-10-25 17:36:21-0400</timestampReceived><subject>Re: [libvirt-users] virsh does no longer respond to commands</subject><body>

It has been the version available on ubuntu 16.04 lts:

$ virsh --version
1.3.1

Please file a bug for me if you think it is one.

On 25 Oct 2017 2:34 p.m., "Michal Privoznik" &lt;mprivozn@redhat.com&gt; wrote:

&gt; On 10/22/2017 02:04 PM, Dominik Psenner wrote:
&gt; &gt; Hi,
&gt; &gt;
&gt; &gt; after a recent live backup done with a snapshot, blockcommit failed and a
&gt; &gt; subsequent (manual) blockjob abort got stuck. Now we are unable to do
&gt; basic
&gt; &gt; operations on the virtual machine like if it was frozen and when issuing
&gt; &gt; another command we see the following:
&gt; &gt;
&gt; &gt; $ virsh shutdown $domain
&gt; &gt; error: Failed to shutdown domain $domain
&gt; &gt; error: Timed out during operation: cannot acquire state change lock (held
&gt; &gt; by remoteDispatchDomainBlockJobAbort)
&gt; &gt;
&gt; &gt; $ virsh blockcommit $domain --active --pivot
&gt; &gt; error: Timed out during operation: cannot acquire state change lock (held
&gt; &gt; by remoteDispatchDomainBlockJobAbort)
&gt; &gt;
&gt; &gt; $ virsh blockjob $domain --abort
&gt; &gt; error: Timed out during operation: cannot acquire state change lock (held
&gt; &gt; by remoteDispatchDomainBlockJobAbort)
&gt; &gt;
&gt;
&gt; This looks like some API forgot to unset the job before returning. In
&gt; that case, restarting libvirtd is the only option. If this happened on
&gt; the latest release please do file a bug. Otherwise try with the latest
&gt; release.
&gt;
&gt; Michal
&gt;
&gt;

[Attachment #3 (text/html)]

&lt;div dir="auto"&gt;It has been the version available on ubuntu 16.04 lts:&lt;div \
dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;$ virsh --version&lt;/div&gt;&lt;div \
dir="auto"&gt;1.3.1&lt;/div&gt;&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;Please file a bug for \
me if you think it is one.&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;On 25 Oct 2017 2:34 p.m., "Michal Privoznik" &lt;&lt;a \
href="mailto:mprivozn@redhat.com"&gt;mprivozn@redhat.com&lt;/a&gt;&gt; wrote:&lt;br \
type="attribution"&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;On 10/22/2017 02:04 PM, Dominik \
Psenner wrote:&lt;br&gt; &gt; Hi,&lt;br&gt;
&gt;&lt;br&gt;
&gt; after a recent live backup done with a snapshot, blockcommit failed and a&lt;br&gt;
&gt; subsequent (manual) blockjob abort got stuck. Now we are unable to do basic&lt;br&gt;
&gt; operations on the virtual machine like if it was frozen and when issuing&lt;br&gt;
&gt; another command we see the following:&lt;br&gt;
&gt;&lt;br&gt;
&gt; $ virsh shutdown $domain&lt;br&gt;
&gt; error: Failed to shutdown domain $domain&lt;br&gt;
&gt; error: Timed out during operation: cannot acquire state change lock (held&lt;br&gt;
&gt; by remoteDispatchDomainBlockJobAb&lt;wbr&gt;ort)&lt;br&gt;
&gt;&lt;br&gt;
&gt; $ virsh blockcommit $domain --active --pivot&lt;br&gt;
&gt; error: Timed out during operation: cannot acquire state change lock (held&lt;br&gt;
&gt; by remoteDispatchDomainBlockJobAb&lt;wbr&gt;ort)&lt;br&gt;
&gt;&lt;br&gt;
&gt; $ virsh blockjob $domain --abort&lt;br&gt;
&gt; error: Timed out during operation: cannot acquire state change lock (held&lt;br&gt;
&gt; by remoteDispatchDomainBlockJobAb&lt;wbr&gt;ort)&lt;br&gt;
&gt;&lt;br&gt;
&lt;br&gt;
This looks like some API forgot to unset the job before returning. In&lt;br&gt;
that case, restarting libvirtd is the only option. If this happened on&lt;br&gt;
the latest release please do file a bug. Otherwise try with the latest&lt;br&gt;
release.&lt;br&gt;
&lt;br&gt;
Michal&lt;br&gt;
&lt;br&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20171019014834</emailId><senderName>Laine Stump</senderName><senderEmail>laine@laine.org</senderEmail><timestampReceived>2017-10-19 01:48:34-0400</timestampReceived><subject>Re: [libvirt-users] "virsh define" modify xml configuration file</subject><body>

On 10/18/2017 06:59 AM, d tbsky wrote:
&gt; hi:
&gt;    I upgrade my system from rhel 7.3 to 7.4. so libvirt upgrade to 3.2.
&gt;
&gt;    I found command "virsh define vm.xml" sometimes  modify "vm.xml".

That command would only modify the file "vm.xml" if it was located in
/etc/libvirt/qemu (or /etc/libvirt/lxc, or whatever was appropriate for
the domain type) *and* the domain's &lt;name&gt; happened to be "vm". If
that's what's happening, this email should be your warning to never
directly modify or access the files in /etc/libvirt; they are files used
internally by libvirt, and modifying them can lead to "unexpected" results.


&gt;  I
&gt; thought the command will read vm.xml, not write to it. is this kind of
&gt; behavior by design?
&gt;
&gt;    for example vm.xml with the line
&gt;
&gt;    &lt;cpu mode='custom' match='exact'&gt;
&gt;
&gt;    will be replaced with
&gt;
&gt;   &lt;cpu mode='custom' match='exact' check='partial'&gt;
&gt;
&gt;
&gt; Regards,
&gt; tbskyd
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;

</body></email><email><emailId>20171018180514</emailId><senderName>mxs kolo</senderName><senderEmail>kolomaxes@gmail.com</senderEmail><timestampReceived>2017-10-18 18:05:14-0400</timestampReceived><subject>Re: [libvirt-users] Can we disable write to /sys/fs/cgroup tree inside container ?</subject><body>

&gt; Why libvirt mount  /sys/fs/cgroup/* inside container as rw ?
&gt;
&gt; We use kernel 3.10.0-693.2.2.el7.x86_64 and XFS and therefore our
&gt; containers are privileged. Yes, we know that in such containers root
&gt; can use SysRq at least for reboot hardware node. But problem with
&gt; cgroups can be more hidden and  cryptic.

p.s.2
 we still use libvirt-3.0.0, if it's important.

</body></email><email><emailId>20171017075850</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-10-17 07:58:50-0400</timestampReceived><subject>Re: [libvirt-users] virConnectIsAlive</subject><body>

On 10/17/2017 07:51 AM, llilulu wrote:
&gt; Hi
&gt; In my program , When libvirtd restart , the old libvirtd connection(virConnectPtr) \
&gt; has to reconnect, Before usr old virConnectPtr , I call virConnectIsAlive. but when \
&gt; I restart libvirtd , virConnectIsAlive return 1, and I continue other operate use \
&gt; the old virConnectPtr, program will receive signal pipe. I use libvirt event. \
&gt; before any api use, I call virEventRegisterDefaultImpl, and run \
&gt; virEventRunDefaultImpl. then use virConnectIsAlive, when I restart libvirtd, \
&gt; virConnectIsAlive will return 0, I want know how to use virConnectIsAlive， if \
&gt; virConnectIsAlive use  keep alive message, what default the interval and count. \
&gt; Thanks 

virConnectIsAlive() will produce desired result only when event loop is
used (e.g. virEventRunDefaultImpl()). However, with this API there'll
always be TOCTOU [1] race. Therefore I suggest registering a disconnect
callback that reconnects. At least that's how it is done in virsh. This
[2] is called before every command and then this [3] is the callback.

Michal

1: https://en.wikipedia.org/wiki/Time_of_check_to_time_of_use
2:
https://libvirt.org/git/?p=libvirt.git;a=blob;f=tools/virsh.c;h=d1789f03adf1e264e5444dde9276be91bfc8a440;hb=HEAD#l336
 3:
https://libvirt.org/git/?p=libvirt.git;a=blob;f=tools/virsh.c;h=d1789f03adf1e264e5444dde9276be91bfc8a440;hb=HEAD#l97



</body></email><email><emailId>20171009230656</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-10-09 23:06:56-0400</timestampReceived><subject>Re: [libvirt-users] add/attache vol from pool - without xml ?</subject><body>

On 10/09/2017 06:14 AM, lejeczek wrote:
&gt; hi fellows
&gt; 
&gt; is that possible, as per subject? If yes then how would such a command
&gt; like look like?

Attach where? To a domain? Via C/Python/... API or virsh?

virsh attach-disk  might be what you're looking for.

Michal

</body></email><email><emailId>20171018175037</emailId><senderName>Julio Faracco</senderName><senderEmail>jcfaracco@gmail.com</senderEmail><timestampReceived>2017-10-18 17:50:37-0400</timestampReceived><subject>[libvirt-users] File option for smbios.</subject><body>

Hi guys,

Does anybody knows if there is an option to set a binary file for smbios?
Currently, I'm doing this approach:

&lt;qemu:commandline&gt;
     &lt;qemu:arg value='-smbios'/&gt;
     &lt;qemu:arg value='file=/var/run/libvirt/qemu/smbios_type_1.bin'/&gt;
&lt;/qemu:commandline&gt;

Has libvirt a method as &lt;smbios mode='host'/&gt; ?

--
Julio Cesar Faracco

</body></email><email><emailId>20171018180930</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-10-18 18:09:30-0400</timestampReceived><subject>Re: [libvirt-users] Can we disable write to /sys/fs/cgroup tree inside container ?</subject><body>

On Wed, Oct 18, 2017 at 09:00:17PM +0300, mxs kolo wrote:
&gt; Hi all
&gt; 
&gt; Each lxc container on node have mounted tmpfs for cgroups tree:
&gt; [root-inside-lxc@tst1 ~]# mount | grep cgroups
&gt; cgroup on /sys/fs/cgroup/cpu,cpuacct type cgroup
&gt; (rw,nosuid,nodev,noexec,relatime,cpuacct,cpu)
&gt; cgroup on /sys/fs/cgroup/cpuset type cgroup
&gt; (rw,nosuid,nodev,noexec,relatime,cpuset)
&gt; cgroup on /sys/fs/cgroup/memory type cgroup
&gt; (rw,nosuid,nodev,noexec,relatime,memory)
&gt; cgroup on /sys/fs/cgroup/devices type cgroup
&gt; (rw,nosuid,nodev,noexec,relatime,devices)
&gt; cgroup on /sys/fs/cgroup/freezer type cgroup
&gt; (rw,nosuid,nodev,noexec,relatime,freezer)
&gt; cgroup on /sys/fs/cgroup/blkio type cgroup
&gt; (rw,nosuid,nodev,noexec,relatime,blkio)
&gt; cgroup on /sys/fs/cgroup/net_cls,net_prio type cgroup
&gt; (rw,nosuid,nodev,noexec,relatime,net_prio,net_cls)
&gt; cgroup on /sys/fs/cgroup/perf_event type cgroup
&gt; (rw,nosuid,nodev,noexec,relatime,perf_event)
&gt; cgroup on /sys/fs/cgroup/systemd type cgroup
&gt; (rw,nosuid,nodev,noexec,relatime,xattr,release_agent=/usr/lib/systemd/systemd-cgroups-agent,name=systemd)
&gt;  cgroup on /sys/fs/cgroup/hugetlb type cgroup
&gt; (rw,nosuid,nodev,noexec,relatime,hugetlb)
&gt; cgroup on /sys/fs/cgroup/pids type cgroup (rw,nosuid,nodev,noexec,relatime,pids)
&gt; 
&gt; It's by default,  at least in my case.
&gt; Problem is, that it's full cgroups tree -  from hardware node and from
&gt; all another containers on node.
&gt; [root-inside-lxc@tst1 ~]#  for i in `ls
&gt; /sys/fs/cgroup/devices/machine.slice/machine-lxc*/devices.list`; do
&gt; echo $i; cat $i; done
&gt; /sys/fs/cgroup/devices/machine.slice/machine-lxc\x2d10297\x2dtst2.scope/devices.list
&gt;  c 1:3 rwm
&gt; c 1:5 rwm
&gt; c 1:7 rwm
&gt; c 1:8 rwm
&gt; c 1:9 rwm
&gt; c 5:0 rwm
&gt; c 5:2 rwm
&gt; c 10:229 rwm
&gt; b 253:6 rw
&gt; c 136:* rwm
&gt; /sys/fs/cgroup/devices/machine.slice/machine-lxc\x2d9951\x2dtst1.scope/devices.list
&gt; c 1:3 rwm
&gt; c 1:5 rwm
&gt; c 1:7 rwm
&gt; c 1:8 rwm
&gt; c 1:9 rwm
&gt; c 5:0 rwm
&gt; c 5:2 rwm
&gt; c 10:229 rwm
&gt; b 253:7 rw
&gt; c 136:* rwm
&gt; 
&gt; Hardware node file, view inside tst1 container:
&gt; [root-inside-lxc@tst1 ~]# cat /sys/fs/cgroup/devices/devices.list
&gt; a *:* rwm
&gt; 
&gt; What is best way to prevent viewing and editing of all cgroups
&gt; structures except belonging to current lxc container (selinux,
&gt; apparmor ) ?
&gt; Why libvirt mount  /sys/fs/cgroup/* inside container as rw ?
&gt; 
&gt; We use kernel 3.10.0-693.2.2.el7.x86_64 and XFS and therefore our
&gt; containers are privileged. Yes, we know that in such containers root
&gt; can use SysRq at least for reboot hardware node. But problem with
&gt; cgroups can be more hidden and  cryptic.
&gt; 
&gt; p.s.
&gt; As show short test, root user can disable device zero on node
&gt; [root-lxc@tst1 ~]# echo "c 1:5 rwm"  &gt; /sys/fs/cgroup/devices/devices.deny
&gt; or all devices in another container
&gt; [root-lxc@tst1 ~]# echo "a *:* rwm"  &gt;
&gt; /sys/fs/cgroup/devices/machine.slice/machine-lxc\x2d10297\x2dtst2.scope/devices.deny
&gt; 

There's only two ways to make a container secure

 - Use user namespaces
 - Apply SELinux policy to the container

If neither of those are used, we don't try to play games to hide stuff
like cgroups from root inside a container, as that's just security through
obscurity

Regards,
Daniel
-- 
&gt; &gt; https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
&gt; &gt; https://libvirt.org         -o-            https://fstop138.berrange.com :|
&gt; &gt; https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|


</body></email><email><emailId>20171019035112</emailId><senderName>d tbsky</senderName><senderEmail>tbskyd@gmail.com</senderEmail><timestampReceived>2017-10-19 03:51:12-0400</timestampReceived><subject>Re: [libvirt-users] "virsh define" modify xml configuration file</subject><body>

2017-10-19 9:48 GMT+08:00 Laine Stump &lt;laine@laine.org&gt;:
&gt; On 10/18/2017 06:59 AM, d tbsky wrote:
&gt;&gt; hi:
&gt;&gt;    I upgrade my system from rhel 7.3 to 7.4. so libvirt upgrade to 3.2.
&gt;&gt;
&gt;&gt;    I found command "virsh define vm.xml" sometimes  modify "vm.xml".
&gt;
&gt; That command would only modify the file "vm.xml" if it was located in
&gt; /etc/libvirt/qemu (or /etc/libvirt/lxc, or whatever was appropriate for
&gt; the domain type) *and* the domain's &lt;name&gt; happened to be "vm". If
&gt; that's what's happening, this email should be your warning to never
&gt; directly modify or access the files in /etc/libvirt; they are files used
&gt; internally by libvirt, and modifying them can lead to "unexpected" results.

  got it. thanks a lot for the hint!

Regards,
tbskyd

</body></email><email><emailId>20171019182522</emailId><senderName>"Matwey V. Kornilov"</senderName><senderEmail>matwey.kornilov@gmail.com</senderEmail><timestampReceived>2017-10-19 18:25:22-0400</timestampReceived><subject>[libvirt-users] Fwd: terminating on signal 15 from pid 2146 (/usr/sbin/libvirtd)</subject><body>

Hello,

I use libvirt 3.3.0 and qemu 2.9.0

My domain XML spec is the following:

&lt;domain type='qemu'&gt;
  &lt;name&gt;s390_generic&lt;/name&gt;
  &lt;uuid&gt;82b4d16e-b636-447e-9fda-41d44616bce8&lt;/uuid&gt;
  &lt;memory unit='KiB'&gt;1048576&lt;/memory&gt;
  &lt;currentMemory unit='KiB'&gt;1048576&lt;/currentMemory&gt;
  &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
  &lt;os&gt;
    &lt;type arch='s390x' machine='s390-ccw-virtio-2.9'&gt;hvm&lt;/type&gt;
    &lt;boot dev='hd'/&gt;
  &lt;/os&gt;
  &lt;clock offset='utc'/&gt;
  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
  &lt;on_crash&gt;destroy&lt;/on_crash&gt;
  &lt;devices&gt;
    &lt;emulator&gt;/usr/bin/qemu-system-s390x&lt;/emulator&gt;
    &lt;disk type='block' device='disk'&gt;
      &lt;driver name='qemu' type='raw' cache='none' io='native'/&gt;
      &lt;source dev='/dev/lvm_pda/libvirt_s390'/&gt;
      &lt;target dev='vda' bus='virtio'/&gt;
      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0000'/&gt;
    &lt;/disk&gt;
    &lt;disk type='file' device='cdrom'&gt;
      &lt;driver name='qemu' type='raw'/&gt;
      &lt;target dev='sda' bus='scsi'/&gt;
      &lt;readonly/&gt;
      &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
    &lt;/disk&gt;
    &lt;controller type='scsi' index='0' model='virtio-scsi'&gt;
      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0002'/&gt;
    &lt;/controller&gt;
    &lt;interface type='bridge'&gt;
      &lt;mac address='52:54:00:e8:61:7e'/&gt;
      &lt;source bridge='br0'/&gt;
      &lt;model type='virtio'/&gt;
      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0001'/&gt;
    &lt;/interface&gt;
    &lt;console type='pty'&gt;
      &lt;target type='sclp' port='0'/&gt;
    &lt;/console&gt;
    &lt;memballoon model='virtio'&gt;
      &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0003'/&gt;
    &lt;/memballoon&gt;
    &lt;panic model='s390'/&gt;
  &lt;/devices&gt;
&lt;/domain&gt;

The issue is that when I try to start it, it starts and shutdowns
immediately:

virsh # start s390_generic
Domain s390_generic started

virsh #

In the domain log file I see the following:

2017-10-19 18:10:21.633+0000: starting up libvirt version: 3.3.0, qemu
version: 2.9.0(openSUSE Leap 42.3), hostname: oak.local
LC_ALL=C
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
QEMU_AUDIO_DRV=none /usr/bin/qemu-system-s390x -name
guest=s390_generic,debug-threads=on -S -object
secret,id=masterKey0,format=raw,file=/var/lib/libvirt/qemu/domain-7-s390_generic/master-key.aes
-machine s390-ccw-virtio-2.9,accel=tcg,usb=off,dump-guest-core=off -m
1024 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -uuid
82b4d16e-b636-447e-9fda-41d44616bce8 -display none -no-user-config
-nodefaults -chardev
socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-7-s390_generic/monitor.sock,server,nowait
-mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc
-no-shutdown -boot strict=on -device
virtio-scsi-ccw,id=scsi0,devno=fe.0.0002 -drive
file=/dev/lvm_pda/libvirt_s390,format=raw,if=none,id=drive-virtio-disk0,cache=none,aio=native
-device
virtio-blk-ccw,scsi=off,devno=fe.0.0000,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1
-drive if=none,id=drive-scsi0-0-0-0,readonly=on -device
scsi-cd,bus=scsi0.0,channel=0,scsi-id=0,lun=0,drive=drive-scsi0-0-0-0,id=scsi0-0-0-0
-netdev tap,fd=26,id=hostnet0 -device
virtio-net-ccw,netdev=hostnet0,id=net0,mac=52:54:00:e8:61:7e,devno=fe.0.0001
-chardev pty,id=charconsole0 -device
sclpconsole,chardev=charconsole0,id=console0 -device
virtio-balloon-ccw,id=balloon0,devno=fe.0.0003 -msg timestamp=on
2017-10-19T18:10:21.701184Z qemu-system-s390x: -chardev
pty,id=charconsole0: char device redirected to /dev/pts/5 (label
charconsole0)
2017-10-19T18:10:21.721299Z qemu-system-s390x: terminating on signal 15
from pid 2146 (/usr/sbin/libvirtd)
2017-10-19 18:10:21.985+0000: shutting down, reason=shutdown


What is the issue?


-- 
With best regards,
Matwey V. Kornilov

</body></email><email><emailId>20171020011421</emailId><senderName>"=?ISO-8859-1?B?Q2hhcmxvdHRl?="</senderName><senderEmail>1696879205@qq.com</senderEmail><timestampReceived>2017-10-20 01:14:21-0400</timestampReceived><subject>[libvirt-users] virsh configure bridge network</subject><body>

[Attachment #2 (multipart/alternative)]

[Attachment #4 (text/plain)]

i creat a docker-machine-kvm,now,virsh edit mymachine,there show :

i don't know how configure, let my machine can accessed by public network.
please help me
[Attachment #5 (text/html)]

&lt;div&gt;i creat a docker-machine-kvm,now,virsh edit mymachine,there show \
:&lt;/div&gt;&lt;div&gt;&lt;img src="cid:2D02F801@6CCB5438.ED4DE959"&gt;&lt;/div&gt;&lt;div&gt;i don't know how \
configure, let my machine can accessed by public network.&lt;/div&gt;&lt;div&gt;please help me \
&lt;br&gt;&lt;/div&gt;


["2D02F801@6CCB5438.ED4DE959.jpg" (image/jpeg)]

</body></email><email><emailId>20171023073106</emailId><senderName>llilulu</senderName><senderEmail>llilulu@yeah.net</senderEmail><timestampReceived>2017-10-23 07:31:06-0400</timestampReceived><subject>[libvirt-users] libvirtd audit log</subject><body>

[Attachment #2 (text/plain)]

Hi

   I according to libvirt.org Audit log guide ,I install auditd in my system(ubuntu \
16.04.2), but when I operate guest running in host, I can't not find guest audit log \
in /var/log/audit/audit.log, audit_level=1.  when I change audit_level=2, I restart \
libvirtd, libvirtd start failed.  Thanks


[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div&gt;Hi \
&lt;br&gt;&lt;/div&gt;&lt;div&gt;   I according to libvirt.org Audit log guide ,I install \
auditd in my system(ubuntu 16.04.2), but when I operate guest running in host, I \
can't not find guest audit log in /var/log/audit/audit.log, \
audit_level=1.&lt;/div&gt;&lt;div&gt;  when I change audit_level=2, I restart libvirtd, \
libvirtd start failed.&lt;/div&gt;&lt;div&gt;  Thanks&lt;br&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20171024024355</emailId><senderName>llilulu</senderName><senderEmail>llilulu@yeah.net</senderEmail><timestampReceived>2017-10-24 02:43:55-0400</timestampReceived><subject>[libvirt-users] domain CPU topology</subject><body>

[Attachment #2 (text/plain)]

Hi

    When I create a domain from xml file, the vcpu number point in &lt;vcpu/&gt;,  I not \
point &lt;cpu&gt;&lt;topology&gt; in xml file, when allocate more than 2 vpcus, some(windows) \
system can't use all vcpu. But I point &lt;cpu&gt;&lt;topology  sockets='1' cores='num' \
threads='1'/&gt;&lt;/cpu&gt;. num is &lt;vcpu&gt;'num'&lt;/vcpu&gt;. then whindows can use all vcpus. I \
want to know when no ponit &lt;cpu&gt;&lt;topology&gt; ,what default cpu topology. if point cpu \
topology, what rule guide cpu topology, I find VMware Workstation can point cpu \
num,and core of per cpu. all cores is cpu*core.


[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div&gt;Hi \
&lt;br&gt;&lt;/div&gt;&lt;div&gt;    When I create a domain from xml file, the vcpu \
number point in &lt;vcpu/&gt;,  I not point &lt;cpu&gt;&lt;topology&gt; in xml \
file, when allocate more than 2 vpcus, some(windows) system can't use all vcpu. But I \
point &lt;cpu&gt;&lt;topology  sockets='1' cores='num' \
threads='1'/&gt;&lt;/cpu&gt;. num is &lt;vcpu&gt;'num'&lt;/vcpu&gt;. then whindows \
can use all vcpus. I want to know when no ponit &lt;cpu&gt;&lt;topology&gt; ,what \
default cpu topology. if point cpu topology, what rule guide cpu topology, I find \
VMware Workstation can point cpu num,and core of per cpu. all cores is \
cpu*core.&lt;br&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20171025070515</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-10-25 07:05:15-0400</timestampReceived><subject>Re: [libvirt-users] net interface direct - no IP communication between guest &amp; host</subject><body>

On Tue, Oct 24, 2017 at 03:52:52PM +0100, lejeczek wrote:
&gt; hi everyone
&gt; 
&gt; I wonder why, when I attach an interface like this:
&gt; 
&gt; virsh # attach-interface --domain win10Ent --type direct --source nm-team
&gt; --config --persistent --model virtio
&gt; 
&gt; host cannot ip ping the guest and vice versa, yet guest can ping other
&gt; nodes(outside of its host, connected via phys net via a switch)
&gt; 
&gt; Would you know?
&gt; 
&gt; I thought maybe routing on the host, so I did:
&gt; $ route add -host 192.168.2.222 dev nm-team
&gt; 
&gt; but to no avail.
&gt; 
&gt; I wonder if it's lower layer, arp kernel bits?

I expect you'll be hitting this unfortunate gotcha:

https://wiki.libvirt.org/page/TroubleshootMacvtapHostFail

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20171025123822</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-10-25 12:38:22-0400</timestampReceived><subject>Re: [libvirt-users] virsh + remote VirtualBox</subject><body>

On 10/24/2017 03:40 PM, Konstantin Suvorov wrote:
&gt; Hello,
&gt; 
&gt; I have the following setup:
&gt; 1. MacOS host with VirtualBox installed
&gt; 2. Ubuntu 16.04 host with libvirt installed
&gt; 
&gt; What I try to do:
&gt; Manage VMs executed inside VirtualBox on host 1 with libvirt tools from
&gt; host 2.
&gt; 
&gt; I have vboxwebsrv up and running on my MacOS host.
&gt; I can successfully manage VMs remotely (e.g. with phpvirtualbox).
&gt; 
&gt; But libvirt (virsh in particular) doesn't work.
&gt; 
&gt; Reading debug logs, manuals and numerous internet threads leads me to a
&gt; conclusion, that libvirt does not support remote connection to VirtualBox
&gt; directly and only via libvirtd daemon installed on the same remote host as
&gt; VirtualBox. Is this correct?
&gt; 
&gt; If my assumption is correct, why is that so? Why libvirt can't manage
&gt; remote VirtualBox directly?

Legal reasons. We had to make VirtualBox driver local only. We can't
ship libvirtd with VirtualBox enabled. Sorry. Maybe their license had
changed meanwhile, but I'm not sure about it.

Michal

</body></email><email><emailId>20171026070139</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-10-26 07:01:39-0400</timestampReceived><subject>Re: [libvirt-users] virsh does no longer respond to commands</subject><body>

On 10/25/2017 07:36 PM, Dominik Psenner wrote:
&gt; It has been the version available on ubuntu 16.04 lts:
&gt; 
&gt; $ virsh --version
&gt; 1.3.1
&gt; 

That is ancient libvirt.

&gt; Please file a bug for me if you think it is one.

You should file a bug against your distro so that they can backport
fixes. I don't use ubuntu, so I can't do it.

Michal

</body></email><email><emailId>20171026070753</emailId><senderName></senderName><senderEmail>15700157322@163.com</senderEmail><timestampReceived>2017-10-26 07:07:53-0400</timestampReceived><subject>[libvirt-users] guest cost long time to boot</subject><body>

hello, my virtual guest always cost long times to boot, all device load finish ,but \
still cost 15s to make display light


[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;span \
style="font-family: verdana, sans-serif; font-size: 12px;"&gt;hello, my virtual guest \
always cost long times to boot, all device load finish ,but still cost 15s to make \
display light&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;span \
title="neteasefooter"&gt;&lt;p&gt;&lt;br/&gt; &lt;/p&gt;&lt;/span&gt;



</body></email><email><emailId>20171026074038</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-10-26 07:40:38-0400</timestampReceived><subject>Re: [libvirt-users] How to assign to PCI slot 0</subject><body>

On 10/24/2017 05:01 PM, Fortman, Andrew wrote:
&gt; Hi,
&gt; 
&gt; I'm new to this group so bear with me.
&gt; 
&gt; So I need to passthrough a pci device on a particular bus and slot to get Linux to \
&gt; recognize it correctly. 
&gt; I need pci bus 6, slot 0.

There are HOST PCI addresses and GUEST PCI addresses. For instance,

  &lt;hostdev mode='subsystem' type='pci' managed='yes'&gt;
    &lt;source&gt;
      &lt;address domain='0x0000' bus='0x06' slot='0x12' function='0x5'/&gt;
    &lt;/source&gt;
    &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
function='0x0'/&gt;
  &lt;/hostdev&gt;

This will assign (PCI passthrough is bad term BTW) PCI device which is
found on the HOST on address 06:12.5 to the GUEST where it will be at
00:03.0. Or do you need the device to appear at specific address in the
GUEST?

&gt; 
&gt; However whenever I try to use this slot inside of virsh edit it complains:
&gt; 
&gt; error: XML error: Invalid PCI address 0000:06:00.0. slot must be &gt;= 1
&gt; Failed. Try again? [y,n,i,f,?]:

This suggests that you have a controller that creates bus 6 but already
has something plugged on slot 1 so it is not available.

&gt; 
&gt; Is there a way to work around this ? Like can I disable the strict XML checking or \
&gt; even run the qemu commands manually?

No, we don't support disabling XML checking. If we did the code would
explode because of all the special casing. Also, if you didn't get the
error from libvirt, you'd get it from qemu. It doesn't matter.

As for manual qemu commands - sure 'virsh qemu-monitor-command'

Michal


</body></email><email><emailId>20171026074714</emailId><senderName>"Matwey V. Kornilov"</senderName><senderEmail>matwey.kornilov@gmail.com</senderEmail><timestampReceived>2017-10-26 07:47:14-0400</timestampReceived><subject>Re: [libvirt-users] terminating on signal 15 from pid 2146 (/usr/sbin/libvirtd)</subject><body>

2017-10-26 10:45 GMT+03:00 Martin Kletzander &lt;mkletzan@redhat.com&gt;:
&gt; On Wed, Oct 25, 2017 at 09:41:58PM +0300, Matwey V. Kornilov wrote:
&gt;&gt;
&gt;&gt; Well, I really had to use start --console from the beginning. It would
&gt;&gt; have safe the time.
&gt;&gt;
&gt;&gt; # start --console s390_generic
&gt;&gt; Using guessed DASD geometry.
&gt;&gt;                            Using ECKD scheme (block size  4096), CDL
&gt;&gt;
&gt;&gt;                                                                     !
&gt;&gt; No zIPL section in IPL2 record. !
&gt;&gt;
&gt;
&gt; Yeah, it all looked like the guest OS just ends normally itself.  So
&gt; precisely what libvirt was reporting.
&gt;
&gt; I'm glad this is resolved.

Thank you very much for patience.

&gt;
&gt; Have a nice day,
&gt; Martin



-- 
With best regards,
Matwey V. Kornilov

</body></email><email><emailId>20171026081807</emailId><senderName>Peter Krempa</senderName><senderEmail>pkrempa@redhat.com</senderEmail><timestampReceived>2017-10-26 08:18:07-0400</timestampReceived><subject>Re: [libvirt-users] question about how to set rng device on vm</subject><body>


On Thu, Oct 26, 2017 at 09:30:55 +0200, Michal Privoznik wrote:
&gt; On 10/25/2017 03:41 PM, Yalan Zhang wrote:
&gt; &gt; Hi Amos,
&gt; &gt; 
&gt; &gt; I'm a libvirt QE, and I can not understand the setting on libvirt.org for
&gt; &gt; rng device.
&gt; &gt; Could you please help to explain a little?
&gt; &gt; (The xml in  https://libvirt.org/formatdomain.html#elementsRng)
&gt; &gt; &lt;devices&gt;
&gt; &gt;   &lt;rng model='virtio'&gt;
&gt; &gt;     &lt;rate period="2000" bytes="1234"/&gt;
&gt; &gt;     &lt;backend model='random'&gt;/dev/random&lt;/backend&gt;
&gt; &gt;     &lt;!-- OR --&gt;
&gt; &gt;     &lt;backend model='egd' type='udp'&gt;
&gt; &gt;       *&lt;source mode='bind' service='1234'/&gt;*
&gt; &gt; *      &lt;source mode='connect' host='1.2.3.4' service='1234'/&gt;*
&gt; &gt;     &lt;/backend&gt;
&gt; &gt;   &lt;/rng&gt;
&gt; &gt; &lt;/devices&gt;
&gt; &gt; 
&gt; &gt; How did it work with source mode='bind' and source mode='connect' together?
&gt; 
&gt; It doesn't. That's just an example that you can have two types of
&gt; backend. Either the backend connects somewhere (mode='connect'), or
&gt; expect somebody to connect (mode='bind'). Just try to define domain with
&gt; that RNG, dump the XML back and see what got applied.

Note that both are required to establish a bidirectional connection with
UDP as configured above. For EGD you really need both directions since
it's a bidirectional protocol.

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20171026102335</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-10-26 10:23:35-0400</timestampReceived><subject>Re: [libvirt-users] Need to increase the rx and tx buffer size of my interface</subject><body>

On 10/26/2017 12:18 PM, Ashish Kurian wrote:
&gt; Hi Michal,
&gt; 
&gt; I installed the latest version from the git and did run the libvirt from
&gt; the new directory using /home/to/your/checkout/daemon/libvirtd

Try:

libvirt.git $ ./autogen.sh --system &amp;&amp; make;

&gt;From a root terminal then:

libvirt.git # ./run ./daemon/libvirtd

Now, if you check the version (virsh version --daemon) you should see
the new version. Although, it'd be probably better if you build the
package for your distro and install it.

Michal

</body></email><email><emailId>20171030082930</emailId><senderName>Lying</senderName><senderEmail>15700157322@163.com</senderEmail><timestampReceived>2017-10-30 08:29:30-0400</timestampReceived><subject>[libvirt-users] guest state "in shutdown"</subject><body>

[Attachment #2 (text/plain)]

Hello,I just encountered a problem
my virtual machine is not a normal shutdown
and I get state is "in shutdown" when i check it using "virsh list --all"
why i get the error state,and how i should solve it?

[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div&gt;Hello,&lt;span \
id="result_box" class="" lang="en"&gt;&lt;span class=""&gt;I just encountered a \
problem&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span id="result_box" class="" lang="en"&gt;&lt;span \
class=""&gt; my virtual machine is not a normal shutdown&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
id="result_box" class="" lang="en"&gt;&lt;span class=""&gt;and I get state is "in shutdown" \
when i check it using "virsh list --all"&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
id="result_box" class="" lang="en"&gt;&lt;span class=""&gt;why i get the error state,and how i \
should solve it?&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;span \
title="neteasefooter"&gt;&lt;p&gt;&lt;br/&gt; &lt;/p&gt;&lt;/span&gt;



</body></email><email><emailId>20171031062037</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-10-31 06:20:37-0400</timestampReceived><subject>Re: [libvirt-users] libvirt/dnsmasq is not adhering to static DHCP assignments</subject><body>

On 10/31/2017 06:27 AM, Dagmawi Biru wrote:
&gt; Hi,
&gt; 
&gt; It looks like that's the issue:
&gt; # cat /var/lib/libvirt/dnsmasq/osc_mgmt.hostsfile
&gt; 52:54:00:2c:85:92,192.168.80.1,openstack-controller-00
&gt; 
&gt; But it makes me wonder...libvirt should be generating and managing this
&gt; file right? Do I need to edit this myself or should libvirt be updating
&gt; this file? If so then why isn't it?
&gt; 

Have you restarted the libvirt network after you've edited it?
virsh net-destroy osc_mgmt
virsh net-start osc_mgmt

The hostsfile is generated when network is started. It's the same as
editing domain XML while it is running. Changes get applied on next start.

Michal

</body></email><email><emailId>20170907155610</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-09-07 15:56:10-0400</timestampReceived><subject>Re: [libvirt-users] Failed building wheel for libvirt-python</subject><body>

On Thu, Sep 07, 2017 at 05:25:46PM +0200, Silvia Fichera wrote:
&gt; Hi all,
&gt; I'm installing Openstack using devstack netwon branch in my PC with Ubuntu
&gt; 16.04 and I have this error.
&gt; Could someone of you help me please?

The version of libvirt-python must be the same as, or newer than, the
version of the libvirt C library you're building against.

This error suggests you

&gt; Thanks
&gt; 
&gt; Collecting libvirt-python===2.1.0 (from -c
&gt; /opt/stack/requirements/upper-constraints.txt (line 169))
&gt;   Using cached libvirt-python-2.1.0.tar.gz
&gt; Building wheels for collected packages: libvirt-python
&gt;   Running setup.py bdist_wheel for libvirt-python ... error
&gt;   Complete output from command /usr/bin/python -u -c "import setuptools,
&gt; tokenize;__file__='/tmp/pip-build-g9ai0P/libvirt-python/setup.py';f=getattr(tokenize,
&gt; 'open', open)(__file__);code=f.read().replace('\r\n',
&gt; '\n');f.close();exec(compile(code, __file__, 'exec'))" bdist_wheel -d
&gt; /tmp/tmpsHlvcmpip-wheel- --python-tag cp27:
&gt;   running bdist_wheel
&gt;   running build
&gt;   /usr/bin/pkg-config --print-errors --atleast-version=0.9.11 libvirt
&gt;   /usr/bin/python generator.py libvirt
&gt; /usr/share/libvirt/api/libvirt-api.xml
&gt;   Found 415 functions in /usr/share/libvirt/api/libvirt-api.xml
&gt;   Found 0 functions in libvirt-override-api.xml
&gt;   Generated 344 wrapper functions
&gt;   Missing type converters:
&gt;   virConnectNodeDeviceEventGenericCallback:1
&gt;   ERROR: failed virConnectNodeDeviceEventRegisterAny

This API was introduced in libvirt 2.2.0

IOW you need to use a newer version of libvirt-python


Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170912132312</emailId><senderName>Kartik Vaishnav</senderName><senderEmail>kartikvaishnav@gmail.com</senderEmail><timestampReceived>2017-09-12 13:23:12-0400</timestampReceived><subject>[libvirt-users] Regarding Libvirt Java Bindings</subject><body>

I am developing a Java Application using Libvirt. I found that the Java
Bindings are not in active development.
I need to obtain the IP Address of the Domain. In C, it may relate to
virDomainInterfaceAddresses. Is there any way to implement it in Java.

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;I am developing a Java Application using Libvirt. I found that the \
Java Bindings are not in active development.&lt;div&gt;I need to obtain the IP Address of \
the Domain. In C, it may relate to virDomainInterfaceAddresses. Is there any way to \
implement it in Java.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170913081204</emailId><senderName>Peter Krempa</senderName><senderEmail>pkrempa@redhat.com</senderEmail><timestampReceived>2017-09-13 08:12:04-0400</timestampReceived><subject>Re: [libvirt-users] external snapshot is missing object secrets</subject><body>


On Fri, Aug 25, 2017 at 09:49:10 +0200, Markus Schade wrote:
&gt; Hello,
&gt; 
&gt; I have virtual machines running with a ceph storage backend.
&gt; 
&gt; When creating an external qcow2 snapshot with a libvirt version without
&gt; support for the new object secret passing, the backing file info would
&gt; list the ceph secret in plain,e.g.
&gt; 
&gt; # virsh snapshot-create-as vm-123 --no-metadata --disk-only --diskspec
&gt; sda,file=/var/lib/libvirt/qemu/snapshot/vm-123-wrapper.qcow2
&gt; 
&gt; # qemu-img info /var/lib/libvirt/qemu/snapshot/vm-123-wrapper.qcow2
&gt; ...
&gt; backing file:
&gt; rbd:vms_pool0/disk-123:id=libvirt:key=SECRET:auth_supported=cephx\;none:mon_host=192.168.1.1\:6789\;192.168.1.11\:6789\;192.168.1.21\:6789
&gt;  
&gt; While this is problematic from a security perspective (and one of the
&gt; reasons for the new method), it enabled starting the virtual machine
&gt; again in case it died or got powered off.
&gt; 
&gt; With the newer libvirt object secret passing the backing file
&gt; of the qcow image only references the secret id.
&gt; 
&gt; # qemu-img info /var/lib/libvirt/qemu/snapshot/vm-123-wrapper.qcow2
&gt; ...
&gt; backing file: json:{"driver": "raw", "file": {"password-secret":
&gt; "scsi0-0-0-0-secret0", "pool": "vms_pool", "image": "disk-123",
&gt; "driver": "rbd", "user": "libvirt", "=keyvalue-pairs":
&gt; "[\"auth_supported\", \"cephx;none\", \"mon_host\",
&gt; \"192.168.1.1:6789;192.168.1.11:6789;192.168.1.21:6789\"]"}}
&gt; 
&gt; This is fine as long as the virtual machine is running and with
&gt; qemu-2.10 it is even possible to block-commit this external snapshot
&gt; (Yeah!).
&gt; 
&gt; However, should the VM die or be powered off, it is now longer possible
&gt; to start the domain or at least recover the data:
&gt; 
&gt; Could not open backing file: No secret with id 'scsi0-0-0-0-secret0'

Yes, the issue here is that even if qemu records the secret alias,
libvirt does not remember it in the XML and thus does not create the
objects.

&gt; I guess this problems happens with any disk type that is accessed with
&gt; object secrets, which is why I would consider this a bug.
&gt; 
&gt; The question is, should/can this be fixed in libvirt or qemu?

I'm currently working on this. This needs to be fixed in libvirt by
tracking the full backing chain.

&gt; 
&gt; I think libvirt should create the snapshot file with the object secret
&gt; stored in a persistent file (and reference this file in the backing file
&gt; definition)

Libvirt will store the authentication credentials in the XML along with
the backing chain. With that you can specify the authentication for
every image, so a new start of the VM should work as expected.

The {"password-secret": field in the backing chain then will be ignored
and libvirt will create a new secret object with the proper name.


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170913164753</emailId><senderName>Laine Stump</senderName><senderEmail>laine@laine.org</senderEmail><timestampReceived>2017-09-13 16:47:53-0400</timestampReceived><subject>Re: [libvirt-users] [virtual interface] detach interface during boot succeed with no changes</subject><body>

On 09/04/2017 03:37 AM, Yalan Zhang wrote:
&gt; Hi guys,
&gt;
&gt; when I detach an interface from vm during boot (vm boot not finished), it
&gt; always fail. I'm not sure if there is an existing bug. I have
&gt; confirmed with someone that for disk, there is similar behavior, if
&gt; this is also acceptable?

unplugging a PCI device properly requires cooperation from the guest OS.
If the guest OS isn't running yet, the unplug won't complete, so qemu
(and libvirt) still show the device as plugged into the guest.

virsh reports success on the unplug because unplugging a device is done
asynchronously - the "success" means "libvirt successfully told qemu to
unplug the device, qemu has told the virtual machine to unplug the
device, and is waiting for acknowledgment from the virtual machine that
the guest has completed removal". At some later time the guest OS may
complete its part of the unplug; when that happens, qemu will get a
notification and will send an event to libvirt - at that time the device
will be removed from libvirt's list of devices.

tl;dr - this is all expected.


&gt;
&gt; # virsh destroy rhel7.2; virsh start rhel7.2 ;sleep 2;  virsh
&gt; detach-interface rhel7.2 network 52:54:00:98:c4:a0; sleep 2; virsh
&gt; dumpxml rhel7.2 |grep /interface -B9
&gt; Domain rhel7.2 destroyed
&gt;
&gt; Domain rhel7.2 started
&gt;
&gt; Interface detached successfully
&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x06'
&gt; function='0x0'/&gt;
&gt;     &lt;/controller&gt;
&gt;     &lt;interface type='network'&gt;
&gt;       &lt;mac address='52:54:00:98:c4:a0'/&gt;
&gt;       &lt;source network='default' bridge='virbr0'/&gt;
&gt;       &lt;target dev='vnet0'/&gt;
&gt;       &lt;model type='rtl8139'/&gt;
&gt;       &lt;alias name='net0'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
&gt; function='0x0'/&gt;
&gt;     &lt;/interface&gt;
&gt;
&gt; When I detach after the vm boot, expand the sleep time to 10, it will succeed.
&gt;
&gt; # virsh destroy rhel7.2; virsh start rhel7.2 ;sleep 10;  virsh
&gt; detach-interface rhel7.2 network 52:54:00:98:c4:a0; sleep 2; virsh
&gt; dumpxml rhel7.2 |grep /interface -B9
&gt; Domain rhel7.2 destroyed
&gt;
&gt; Domain rhel7.2 started
&gt;
&gt; Interface detached successfully
&gt;
&gt;
&gt; -------
&gt; Best Regards,
&gt; Yalan Zhang
&gt; IRC: yalzhang
&gt; Internal phone: 8389413
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;

</body></email><email><emailId>20170913172022</emailId><senderName>Laine Stump</senderName><senderEmail>laine@laine.org</senderEmail><timestampReceived>2017-09-13 17:20:22-0400</timestampReceived><subject>Re: [libvirt-users] network configuration for guest specific dns-servers</subject><body>

On 08/31/2017 08:17 AM, Martin Kletzander wrote:
&gt; On Thu, Aug 31, 2017 at 01:09:14PM +0200, David Ayers wrote:
&gt;&gt; Am Donnerstag, den 31.08.2017, 11:32 +0200 schrieb David Ayers:
&gt;&gt;&gt;
&gt;&gt;&gt; Am Donnerstag, den 31.08.2017, 10:11 +0200 schrieb Martin Kletzander:
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; AFAIK the support for this was not added.  Feel free to request
&gt;&gt;&gt; this in
&gt;&gt;&gt; &gt; our bugzilla [1] so that we can track it.  Or, even better, send a
&gt;&gt;&gt; patch
&gt;&gt;&gt; &gt; if you have some time ;) It should not be difficult.
&gt;&gt;&gt;
&gt;&gt;&gt; Okay, I'll be sure to add it to bugzilla sometime soon.
&gt;&gt;
&gt;&gt; Actually, this was already reported (on the last day of 2010):
&gt;&gt; https://bugzilla.redhat.com/show_bug.cgi?id=666556
&gt;&gt; and seems to restated (two years later) in:
&gt;&gt; https://bugzilla.redhat.com/show_bug.cgi?id=824573
&gt;&gt;
&gt;&gt; and by the looks of this, generic dhcp options at global scope are
&gt;&gt; already contentious, let alone at host scope.
&gt;&gt;
&gt;&gt; So I guess we my stop configuring dnsmasq via libvirt.
&gt;&gt;
&gt;
&gt; Oh, look at that.  It's good that you've found it.  Of course there are
&gt; people more proficient in the networking area who have way more thing on
&gt; their radar.  Looks like this is very often requested thing also.  I
&gt; can't speak for arbitrary options, but named ones that we know what to
&gt; map them to, should be fine and not rejected (at least not right away).
&gt; But others (especially Laine; Cc'd) could be more specific WRT your
&gt; request.

The first attempt at this was really just a passthrough for dnsmasq
commandline options, and as such was ripe with potentials for ambiguous
interpretation (when certain special characters were present),
idiosyncracies specific to dnsmasq's implementation details, etc, so we
pulled it out to re-tool, but I think I tried to be too ambitious about
the design, and so it stagnated rather than proceeding with something
simple but expandable.

What we need is for someone with enough vested interest to map out the
proper XML structure to allow supporting all dhcp options, and then
someone to write the support for the first example dhcp option. After
that, new options could be added as needed. The bit that produces the
reluctance to start is that we need to be sure that whatever we setup
for the initially-supported options needs to be expandable to work for
all options. (I tried to map out such a beast, and it was just too much
work vs. other more pressing things). If somebody wants to pick it up,
I'd be happy to offer my advice/opinions :-)

</body></email><email><emailId>20170913201442</emailId><senderName>Darac Marjal</senderName><senderEmail>mailinglist@darac.org.uk</senderEmail><timestampReceived>2017-09-13 20:14:42-0400</timestampReceived><subject>Re: [libvirt-users] DHCP logging settings</subject><body>

Have you considered filtering out the messages at your syslog daemon?


On 05/09/17 02:17, Shannon wrote:
&gt; I find that libvirt clogs up syslog with trivial DHCP notifications. I
&gt; know how to configure alternate logging with dnsmasq directly via
&gt; 'log-facility' and/or 'quiet-dhcp' options but the XML format used by
&gt; libvirt appears to have no equivalent options. Is there a way to
&gt; reduce syslog spam from libvirt without switching to a system-wide
&gt; dnsmasq service?
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users

</body></email><email><emailId>20170915155916</emailId><senderName>Homie Pawlowski</senderName><senderEmail>hpawlows@redhat.com</senderEmail><timestampReceived>2017-09-15 15:59:16-0400</timestampReceived><subject>Re: [libvirt-users] Compile libvirt on OSX 10.12</subject><body>

Thanks Andrea. I downloaded the tarball and compiling from it worked.

Homero

On Thu, Sep 14, 2017 at 9:20 AM, Andrea Bolognani &lt;abologna@redhat.com&gt;
wrote:

&gt; On Wed, 2017-09-13 at 17:20 -0400, Homie Pawlowski wrote:
&gt; &gt; I'm having issues with compiling libvirt on OSX 10.12
&gt; &gt;
&gt; &gt;  ~/Development/github/libvirt/ [master] make
&gt; &gt; /Library/Developer/CommandLineTools/usr/bin/make  all-recursive
&gt; &gt; Making all in .
&gt; &gt; Making all in gnulib/lib
&gt; &gt; /Library/Developer/CommandLineTools/usr/bin/make  all-am
&gt; &gt; make[3]: Nothing to be done for `all-am'.
&gt; &gt; Making all in include/libvirt
&gt; &gt; make[2]: Nothing to be done for `all'.
&gt; &gt; Making all in src
&gt; &gt; /Library/Developer/CommandLineTools/usr/bin/make  all-am
&gt; &gt;   CC       util/libvirt_util_la-virthread.lo
&gt; &gt; util/virthread.c:272:17: error: 'syscall' is deprecated: first
&gt; deprecated in macOS 10.12 - syscall(2) is unsupported;
&gt; &gt;       please switch to a supported interface. For SYS_kdebug_trace use
&gt; kdebug_signpost().
&gt; &gt;       [-Werror,-Wdeprecated-declarations]
&gt; &gt;     pid_t tid = syscall(SYS_gettid);
&gt; &gt;                 ^
&gt; &gt; /usr/include/unistd.h:733:6: note: 'syscall' has been explicitly marked
&gt; deprecated here
&gt; &gt; int      syscall(int, ...);
&gt; &gt;          ^
&gt; &gt; 1 error generated.
&gt; &gt; make[3]: *** [util/libvirt_util_la-virthread.lo] Error 1
&gt; &gt; make[2]: *** [all] Error 2
&gt; &gt; make[1]: *** [all-recursive] Error 1
&gt; &gt;
&gt; &gt; Anyone have any suggestion on how to do so?
&gt;
&gt; As a quick workaround, you can either pass
&gt;
&gt;   --disable-werror
&gt;
&gt; to configure/autogen.sh or (better) compile from a release
&gt; tarball rather than a git clone.
&gt;
&gt; In the long run, someone with access to macOS will have to fix
&gt; the issue and post a patch on the development mailing list.
&gt;
&gt; --
&gt; Andrea Bolognani / Red Hat / Virtualization
&gt;



-- 

HOMERO PAWLOWSKI

CLOUD CONSULTANT

Red Hat

&lt;https://www.redhat.com/&gt;

140 Broadway 24th Floor

New York, NY 10005

hpawlows@redhat.com
&lt;https://red.ht/sig&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Thanks Andrea. I downloaded the tarball and compiling from it worked.  \
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Homero&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Thu, Sep 14, 2017 at 9:20 AM, Andrea Bolognani &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:abologna@redhat.com" \
target="_blank"&gt;abologna@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div class="HOEnZb"&gt;&lt;div class="h5"&gt;On Wed, 2017-09-13 at \
17:20 -0400, Homie Pawlowski wrote:&lt;br&gt; &gt; I'm having issues with compiling \
libvirt on OSX 10.12&lt;br&gt; &gt;&lt;br&gt;
&gt;  ~/Development/github/libvirt/ [master] make&lt;br&gt;
&gt; /Library/Developer/&lt;wbr&gt;CommandLineTools/usr/bin/make   all-recursive&lt;br&gt;
&gt; Making all in .&lt;br&gt;
&gt; Making all in gnulib/lib&lt;br&gt;
&gt; /Library/Developer/&lt;wbr&gt;CommandLineTools/usr/bin/make   all-am&lt;br&gt;
&gt; make[3]: Nothing to be done for `all-am'.&lt;br&gt;
&gt; Making all in include/libvirt&lt;br&gt;
&gt; make[2]: Nothing to be done for `all'.&lt;br&gt;
&gt; Making all in src&lt;br&gt;
&gt; /Library/Developer/&lt;wbr&gt;CommandLineTools/usr/bin/make   all-am&lt;br&gt;
&gt;     CC           util/libvirt_util_la-&lt;wbr&gt;virthread.lo&lt;br&gt;
&gt; util/virthread.c:272:17: error: 'syscall' is deprecated: first \
deprecated in macOS 10.12 - syscall(2) is unsupported;&lt;br&gt; &gt;           please \
switch to a supported interface. For SYS_kdebug_trace use kdebug_signpost().&lt;br&gt; &gt; \
[-Werror,-Wdeprecated-&lt;wbr&gt;declarations]&lt;br&gt; &gt;        pid_t tid = \
syscall(SYS_gettid);&lt;br&gt; &gt;                          ^&lt;br&gt;
&gt; /usr/include/unistd.h:733:6: note: 'syscall' has been explicitly marked \
deprecated here&lt;br&gt; &gt; int         syscall(int, ...);&lt;br&gt;
&gt;               ^&lt;br&gt;
&gt; 1 error generated.&lt;br&gt;
&gt; make[3]: *** [util/libvirt_util_la-&lt;wbr&gt;virthread.lo] Error 1&lt;br&gt;
&gt; make[2]: *** [all] Error 2&lt;br&gt;
&gt; make[1]: *** [all-recursive] Error 1&lt;br&gt;
&gt;&lt;br&gt;
&gt; Anyone have any suggestion on how to do so?&lt;br&gt;
&lt;br&gt;
&lt;/div&gt;&lt;/div&gt;As a quick workaround, you can either pass&lt;br&gt;
&lt;br&gt;
   --disable-werror&lt;br&gt;
&lt;br&gt;
to configure/autogen.sh or (better) compile from a release&lt;br&gt;
tarball rather than a git clone.&lt;br&gt;
&lt;br&gt;
In the long run, someone with access to macOS will have to fix&lt;br&gt;
the issue and post a patch on the development mailing list.&lt;br&gt;
&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;br&gt;
--&lt;br&gt;
Andrea Bolognani / Red Hat / Virtualization&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- &lt;br&gt;&lt;div \
class="gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;&lt;p \
style="color:rgb(0,0,0);font-family:overpass,sans-serif;font-weight:bold;margin:0px;padding:0px;font-size:14px;text-transform:uppercase"&gt;&lt;span&gt;HOMERO&lt;/span&gt; \
&lt;span&gt;PAWLOWSKI&lt;/span&gt;&lt;/p&gt;&lt;p \
style="color:rgb(0,0,0);font-family:overpass,sans-serif;font-size:10px;margin:0px 0px \
4px;text-transform:uppercase"&gt;&lt;span&gt;CLOUD CONSULTANT&lt;/span&gt;&lt;/p&gt;&lt;p \
style="font-family:overpass,sans-serif;margin:0px;font-size:10px;color:rgb(153,153,153)"&gt;&lt;a \
href="https://www.redhat.com/" style="color:rgb(0,136,206);margin:0px" \
target="_blank"&gt;Red Hat  &lt;span&gt;&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;span \
style="font-family:overpass,sans-serif;font-size:10px;margin:0px;color:rgb(153,153,153)"&gt;&lt;p \
style="margin:0px"&gt;140 Broadway 24th Floor&lt;/p&gt;&lt;/span&gt;&lt;span \
style="color:rgb(0,0,0);font-family:overpass,sans-serif;font-size:medium"&gt;&lt;/span&gt;&lt;span \
style="color:rgb(0,0,0);font-family:overpass,sans-serif;font-size:medium"&gt;&lt;p \
style="font-size:10px;margin:0px;color:rgb(153,153,153)"&gt;New York, NY \
10005&lt;/p&gt;&lt;/span&gt;&lt;span \
style="color:rgb(0,0,0);font-family:overpass,sans-serif;font-size:medium"&gt;&lt;/span&gt;&lt;p \
style="font-family:overpass,sans-serif;margin:0px 0px \
6px;font-size:10px;color:rgb(153,153,153)"&gt;&lt;span style="margin:0px;padding:0px"&gt;&lt;a \
href="mailto:hpawlows@redhat.com" style="color:rgb(0,136,206);margin:0px" \
target="_blank"&gt;hpawlows@redhat.com&lt;/a&gt;     &lt;/span&gt;&lt;/p&gt;&lt;table border="0" \
style="color:rgb(0,0,0);font-family:overpass,sans-serif;font-size:medium"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td \
width="100px"&gt;&lt;a href="https://red.ht/sig" target="_blank"&gt;&lt;img \
src="https://www.redhat.com/profiles/rh/themes/redhatdotcom/img/logo-red-hat-black.png" \
width="90" height="auto"&gt;&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;



</body></email><email><emailId>20170916172741</emailId><senderName>Shashwat shagun</senderName><senderEmail>me@shashwat.tech</senderEmail><timestampReceived>2017-09-16 17:27:41-0400</timestampReceived><subject>[libvirt-users] Question: How do i set data transfer quota</subject><body>

Hi,
I want to limit my user's internet data transfer of his VPS. Is this possible?

P.S I'm not talking about the internet speed. I'm talking about data usage limit

Regards,
Shashwat Shagun
me@shashwat.tech


[Attachment #3 (text/html)]

&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
&lt;head&gt;
&lt;title&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div name="messageBodySection" style="font-size: 14px; font-family: -apple-system, \
BlinkMacSystemFont, sans-serif;"&gt;Hi, &lt;div&gt;I want to limit my user's internet data \
transfer of his VPS. Is this possible?&lt;/div&gt; &lt;div&gt;&lt;br /&gt;&lt;/div&gt;
&lt;div&gt;P.S I'm not talking about the internet speed. I'm talking about data usage \
limit &lt;/div&gt; &lt;/div&gt;
&lt;div name="messageSignatureSection" style="font-size: 14px; font-family: \
-apple-system, BlinkMacSystemFont, sans-serif;"&gt;&lt;br /&gt; Regards,
&lt;div&gt;Shashwat Shagun&lt;/div&gt;
&lt;div&gt;me@shashwat.tech&lt;/div&gt;
&lt;/div&gt;
&lt;div name="messageReplySection" style="font-size: 14px; font-family: -apple-system, \
BlinkMacSystemFont, sans-serif;"&gt;&lt;br /&gt; &lt;div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170918083056</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-09-18 08:30:56-0400</timestampReceived><subject>Re: [libvirt-users] How to configure dnsmasq using libvirt?</subject><body>


On Wed, Aug 23, 2017 at 05:02:48PM -0400, Don Zickus wrote:
&gt;Hi,
&gt;
&gt;I am working on a project, beaker, where they use anisble scripts to setup
&gt;an environment with 4 virtual machines.  One acts as a server to the other
&gt;3.
&gt;
&gt;We noticed after the network was setup, the domainname is not properly
&gt;reported with using the 'hostname' command.  We believe that dnsmasq was not
&gt;correctly configured.
&gt;
&gt;Is there a recommended way to setup dnsmasq using libvirt and ansible?
&gt;

Not that I know of (for now).  What is the problem you have?  Can't the
VMs reach each other using hostnames?  Do they properly report hostnames
when asking for a lease?  I've seen bunch of problems with this, but it
was always about not-so-well behaving machines.  By default it should
just work.  Can you elaborate more on how stuff does not work?  Thanks.

&gt;Thanks!
&gt;
&gt;Cheers,
&gt;Don
&gt;
&gt;ps - please cc me as I am not subscribed to the list
&gt;
&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170919112057</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-09-19 11:20:57-0400</timestampReceived><subject>Re: [libvirt-users] How can i limit CPU allowance to 25% of a single core</subject><body>


On Tue, Sep 19, 2017 at 02:57:09AM +0530, Shashwat shagun wrote:
&gt;Hi,
&gt;How do Hard limit a CPU allowance to 25% of a single core in KVM?
&gt;

Using `period`/`quota` and `shares` parameters of cgroups.  This is
mapped to the domain XML's respective `cputune` elements [1].

Martin

[1] https://libvirt.org/formatdomain.html#elementsCPUTuning

&gt;Regards,
&gt;Shashwat Shagun
&gt;

&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170920094139</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-09-20 09:41:39-0400</timestampReceived><subject>Re: [libvirt-users] Re : Libvirt Java Bindings</subject><body>

On Wed, Sep 20, 2017 at 02:37:51PM +0530, Kartik Vaishnav wrote:
&gt; I am developing a Java Application using Libvirt. I found that the Java
&gt; Bindings are not in active development.
&gt; I need to obtain the IP Address of the Domain. In C, it may relate to
&gt; virDomainInterfaceAddresses. Is there any way to implement it in Java.

I'm afraid you'll have to write a patch for the libvirt-java code to
add support exposing the C virDomainInterfaceAddresses  method to Java.

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170921144550</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-09-21 14:45:50-0400</timestampReceived><subject>Re: [libvirt-users] How automatically set group.devices.allow for libvirt-lxc container after start </subject><body>

On Thu, Sep 21, 2017 at 05:14:38PM +0300, mxs kolo wrote:

&gt; p.s.
&gt; It would be nice specify any device in the xml domain config, for example:
&gt; &lt;devices&gt;
&gt;   &lt;device type='char' maj='108' min='0' allow='rwm' name="/dev/ppp"/&gt;
&gt; &lt;/devices&gt;
&gt; At start libvirt executes mknod and then writes the necessary rights
&gt; to cgroups device.allow.

You can do exactly that

&lt;hostdev mode='capabilities' type='misc'&gt;
  &lt;source&gt;
    &lt;char&gt;/dev/input/event3&lt;/char&gt;
  &lt;/source&gt;
&lt;/hostdev&gt;

or for block devs

&lt;hostdev mode='capabilities' type='storage'&gt;
  &lt;source&gt;
    &lt;block&gt;/dev/sdf1&lt;/block&gt;
  &lt;/source&gt;
&lt;/hostdev&gt;


See:

http://libvirt.org/formatdomain.html#elementsHostDevCaps


The device path you've listed must exist in the host's /dev for this
to work though - we don't make it possible to create devices in the
container which don't exist in the host


Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170922073136</emailId><senderName></senderName><senderEmail>fordoothers@126.com</senderEmail><timestampReceived>2017-09-22 07:31:36-0400</timestampReceived><subject>[libvirt-users] How could I set a VNC server's screen size?</subject><body>

[Attachment #2 (text/plain)]

Dear Libvirt,

How could I set a VNC server¡¯s screen size? I access my virtual machine via NoVNC \
from web browser, but the desktop¡¯s size is different based on OS. For example, A \
RHEL5¡¯s screen is about half of RHEL7¡¯s. But it has same graphics configuration. I \
read the online doc, but I don¡¯t find any to set this. So could you help me? Thanks \
for your reply.

Best Regards,

Clark Liu


[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;!--[if \
gte mso 9]&gt;&lt;xml&gt;  &lt;o:officedocumentsettings&gt;
  &lt;o:allowpng /&gt;
 &lt;/o:officedocumentsettings&gt;
&lt;/xml&gt;&lt;![endif]--&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Dear Libvirt,&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;How could I set a VNC server¡¯s screen size?
I access my virtual machine via NoVNC from web browser, but the desktop¡¯s size
is different based on OS. For example, A RHEL5¡¯s screen is about half of RHEL7¡¯s.
But it has same graphics configuration. I read the online doc, but I don¡¯t find
any to set this. So could you help me? Thanks for your reply.&lt;/span&gt;&lt;/p&gt;

&lt;div class="MsoNormal"&gt;&lt;span style="font-size:11.0pt;color:black;
mso-no-proof:yes" lang="EN-US"&gt;Best Regards,&lt;/span&gt;&lt;span \
style="font-size:11.0pt;font-family:"Calibri","sans-serif"; \
mso-ascii-theme-font:minor-latin;mso-fareast-font-family:ËÎÌå;mso-fareast-theme-font: \
minor-fareast;mso-hansi-theme-font:minor-latin;mso-bidi-font-family:"Times New \
Roman"; mso-bidi-theme-font:minor-bidi;color:black;mso-ansi-language:EN-US;mso-fareast-language:
 ZH-CN;mso-bidi-language:AR-SA;mso-no-proof:yes" lang="EN-US"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div \
class="MsoNormal"&gt;&lt;span \
style="font-size:11.0pt;font-family:"Calibri","sans-serif"; \
mso-ascii-theme-font:minor-latin;mso-fareast-font-family:ËÎÌå;mso-fareast-theme-font: \
minor-fareast;mso-hansi-theme-font:minor-latin;mso-bidi-font-family:"Times New \
Roman"; mso-bidi-theme-font:minor-bidi;color:black;mso-ansi-language:EN-US;mso-fareast-language:
 ZH-CN;mso-bidi-language:AR-SA;mso-no-proof:yes" lang="EN-US"&gt;Clark \
Liu&lt;/span&gt;&lt;/div&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;  &lt;w:worddocument&gt;
  &lt;w:view&gt;Normal&lt;/w:view&gt;
  &lt;w:zoom&gt;0&lt;/w:zoom&gt;
  &lt;w:trackmoves /&gt;
  &lt;w:trackformatting /&gt;
  &lt;w:punctuationkerning /&gt;
  &lt;w:drawinggridverticalspacing&gt;7.8 pt&lt;/w:drawinggridverticalspacing&gt;
  &lt;w:displayhorizontaldrawinggridevery&gt;0&lt;/w:displayhorizontaldrawinggridevery&gt;
  &lt;w:displayverticaldrawinggridevery&gt;2&lt;/w:displayverticaldrawinggridevery&gt;
  &lt;w:validateagainstschemas /&gt;
  &lt;w:saveifxmlinvalid&gt;false&lt;/w:saveifxmlinvalid&gt;
  &lt;w:ignoremixedcontent&gt;false&lt;/w:ignoremixedcontent&gt;
  &lt;w:alwaysshowplaceholdertext&gt;false&lt;/w:alwaysshowplaceholdertext&gt;
  &lt;w:donotpromoteqf /&gt;
  &lt;w:lidthemeother&gt;EN-US&lt;/w:lidthemeother&gt;
  &lt;w:lidthemeasian&gt;ZH-CN&lt;/w:lidthemeasian&gt;
  &lt;w:lidthemecomplexscript&gt;X-NONE&lt;/w:lidthemecomplexscript&gt;
  &lt;w:compatibility&gt;
   &lt;w:spaceforul /&gt;
   &lt;w:balancesinglebytedoublebytewidth /&gt;
   &lt;w:donotleavebackslashalone /&gt;
   &lt;w:ultrailspace /&gt;
   &lt;w:donotexpandshiftreturn /&gt;
   &lt;w:adjustlineheightintable /&gt;
   &lt;w:breakwrappedtables /&gt;
   &lt;w:snaptogridincell /&gt;
   &lt;w:wraptextwithpunct /&gt;
   &lt;w:useasianbreakrules /&gt;
   &lt;w:dontgrowautofit /&gt;
   &lt;w:splitpgbreakandparamark /&gt;
   &lt;w:enableopentypekerning /&gt;
   &lt;w:dontflipmirrorindents /&gt;
   &lt;w:overridetablestylehps /&gt;
   &lt;w:usefelayout /&gt;
  &lt;/w:compatibility&gt;
  &lt;m:mathpr&gt;
   &lt;m:mathfont m:val="Cambria Math" /&gt;
   &lt;m:brkbin m:val="before" /&gt;
   &lt;m:brkbinsub m:val="--" /&gt;
   &lt;m:smallfrac m:val="off" /&gt;
   &lt;m:dispdef /&gt;
   &lt;m:lmargin m:val="0" /&gt;
   &lt;m:rmargin m:val="0" /&gt;
   &lt;m:defjc m:val="centerGroup" /&gt;
   &lt;m:wrapindent m:val="1440" /&gt;
   &lt;m:intlim m:val="subSup" /&gt;
   &lt;m:narylim m:val="undOvr" /&gt;
  &lt;/m:mathpr&gt;&lt;/w:worddocument&gt;
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
 &lt;w:latentstyles deflockedstate="false" defunhidewhenused="true" defsemihidden="true" \
defqformat="false" defpriority="99" latentstylecount="267"&gt;  &lt;w:lsdexception \
locked="false" priority="0" semihidden="false" unhidewhenused="false" qformat="true" \
name="Normal" /&gt;  &lt;w:lsdexception locked="false" priority="9" semihidden="false" \
unhidewhenused="false" qformat="true" name="heading 1" /&gt;  &lt;w:lsdexception \
locked="false" priority="9" qformat="true" name="heading 2" /&gt;  &lt;w:lsdexception \
locked="false" priority="9" qformat="true" name="heading 3" /&gt;  &lt;w:lsdexception \
locked="false" priority="9" qformat="true" name="heading 4" /&gt;  &lt;w:lsdexception \
locked="false" priority="9" qformat="true" name="heading 5" /&gt;  &lt;w:lsdexception \
locked="false" priority="9" qformat="true" name="heading 6" /&gt;  &lt;w:lsdexception \
locked="false" priority="9" qformat="true" name="heading 7" /&gt;  &lt;w:lsdexception \
locked="false" priority="9" qformat="true" name="heading 8" /&gt;  &lt;w:lsdexception \
locked="false" priority="9" qformat="true" name="heading 9" /&gt;  &lt;w:lsdexception \
locked="false" priority="39" name="toc 1" /&gt;  &lt;w:lsdexception locked="false" \
priority="39" name="toc 2" /&gt;  &lt;w:lsdexception locked="false" priority="39" name="toc \
3" /&gt;  &lt;w:lsdexception locked="false" priority="39" name="toc 4" /&gt;
  &lt;w:lsdexception locked="false" priority="39" name="toc 5" /&gt;
  &lt;w:lsdexception locked="false" priority="39" name="toc 6" /&gt;
  &lt;w:lsdexception locked="false" priority="39" name="toc 7" /&gt;
  &lt;w:lsdexception locked="false" priority="39" name="toc 8" /&gt;
  &lt;w:lsdexception locked="false" priority="39" name="toc 9" /&gt;
  &lt;w:lsdexception locked="false" priority="35" qformat="true" name="caption" /&gt;
  &lt;w:lsdexception locked="false" priority="10" semihidden="false" \
unhidewhenused="false" qformat="true" name="Title" /&gt;  &lt;w:lsdexception locked="false" \
priority="1" name="Default Paragraph Font" /&gt;  &lt;w:lsdexception locked="false" \
priority="11" semihidden="false" unhidewhenused="false" qformat="true" \
name="Subtitle" /&gt;  &lt;w:lsdexception locked="false" priority="22" semihidden="false" \
unhidewhenused="false" qformat="true" name="Strong" /&gt;  &lt;w:lsdexception \
locked="false" priority="20" semihidden="false" unhidewhenused="false" qformat="true" \
name="Emphasis" /&gt;  &lt;w:lsdexception locked="false" priority="59" semihidden="false" \
unhidewhenused="false" name="Table Grid" /&gt;  &lt;w:lsdexception locked="false" \
unhidewhenused="false" name="Placeholder Text" /&gt;  &lt;w:lsdexception locked="false" \
priority="1" semihidden="false" unhidewhenused="false" qformat="true" name="No \
Spacing" /&gt;  &lt;w:lsdexception locked="false" priority="60" semihidden="false" \
unhidewhenused="false" name="Light Shading" /&gt;  &lt;w:lsdexception locked="false" \
priority="61" semihidden="false" unhidewhenused="false" name="Light List" /&gt;  \
&lt;w:lsdexception locked="false" priority="62" semihidden="false" \
unhidewhenused="false" name="Light Grid" /&gt;  &lt;w:lsdexception locked="false" \
priority="63" semihidden="false" unhidewhenused="false" name="Medium Shading 1" /&gt;  \
&lt;w:lsdexception locked="false" priority="64" semihidden="false" \
unhidewhenused="false" name="Medium Shading 2" /&gt;  &lt;w:lsdexception locked="false" \
priority="65" semihidden="false" unhidewhenused="false" name="Medium List 1" /&gt;  \
&lt;w:lsdexception locked="false" priority="66" semihidden="false" \
unhidewhenused="false" name="Medium List 2" /&gt;  &lt;w:lsdexception locked="false" \
priority="67" semihidden="false" unhidewhenused="false" name="Medium Grid 1" /&gt;  \
&lt;w:lsdexception locked="false" priority="68" semihidden="false" \
unhidewhenused="false" name="Medium Grid 2" /&gt;  &lt;w:lsdexception locked="false" \
priority="69" semihidden="false" unhidewhenused="false" name="Medium Grid 3" /&gt;  \
&lt;w:lsdexception locked="false" priority="70" semihidden="false" \
unhidewhenused="false" name="Dark List" /&gt;  &lt;w:lsdexception locked="false" \
priority="71" semihidden="false" unhidewhenused="false" name="Colorful Shading" /&gt;  \
&lt;w:lsdexception locked="false" priority="72" semihidden="false" \
unhidewhenused="false" name="Colorful List" /&gt;  &lt;w:lsdexception locked="false" \
priority="73" semihidden="false" unhidewhenused="false" name="Colorful Grid" /&gt;  \
&lt;w:lsdexception locked="false" priority="60" semihidden="false" \
unhidewhenused="false" name="Light Shading Accent 1" /&gt;  &lt;w:lsdexception \
locked="false" priority="61" semihidden="false" unhidewhenused="false" name="Light \
List Accent 1" /&gt;  &lt;w:lsdexception locked="false" priority="62" semihidden="false" \
unhidewhenused="false" name="Light Grid Accent 1" /&gt;  &lt;w:lsdexception locked="false" \
priority="63" semihidden="false" unhidewhenused="false" name="Medium Shading 1 Accent \
1" /&gt;  &lt;w:lsdexception locked="false" priority="64" semihidden="false" \
unhidewhenused="false" name="Medium Shading 2 Accent 1" /&gt;  &lt;w:lsdexception \
locked="false" priority="65" semihidden="false" unhidewhenused="false" name="Medium \
List 1 Accent 1" /&gt;  &lt;w:lsdexception locked="false" unhidewhenused="false" \
name="Revision" /&gt;  &lt;w:lsdexception locked="false" priority="34" semihidden="false" \
unhidewhenused="false" qformat="true" name="List Paragraph" /&gt;  &lt;w:lsdexception \
locked="false" priority="29" semihidden="false" unhidewhenused="false" qformat="true" \
name="Quote" /&gt;  &lt;w:lsdexception locked="false" priority="30" semihidden="false" \
unhidewhenused="false" qformat="true" name="Intense Quote" /&gt;  &lt;w:lsdexception \
locked="false" priority="66" semihidden="false" unhidewhenused="false" name="Medium \
List 2 Accent 1" /&gt;  &lt;w:lsdexception locked="false" priority="67" semihidden="false" \
unhidewhenused="false" name="Medium Grid 1 Accent 1" /&gt;  &lt;w:lsdexception \
locked="false" priority="68" semihidden="false" unhidewhenused="false" name="Medium \
Grid 2 Accent 1" /&gt;  &lt;w:lsdexception locked="false" priority="69" semihidden="false" \
unhidewhenused="false" name="Medium Grid 3 Accent 1" /&gt;  &lt;w:lsdexception \
locked="false" priority="70" semihidden="false" unhidewhenused="false" name="Dark \
List Accent 1" /&gt;  &lt;w:lsdexception locked="false" priority="71" semihidden="false" \
unhidewhenused="false" name="Colorful Shading Accent 1" /&gt;  &lt;w:lsdexception \
locked="false" priority="72" semihidden="false" unhidewhenused="false" name="Colorful \
List Accent 1" /&gt;  &lt;w:lsdexception locked="false" priority="73" semihidden="false" \
unhidewhenused="false" name="Colorful Grid Accent 1" /&gt;  &lt;w:lsdexception \
locked="false" priority="60" semihidden="false" unhidewhenused="false" name="Light \
Shading Accent 2" /&gt;  &lt;w:lsdexception locked="false" priority="61" semihidden="false" \
unhidewhenused="false" name="Light List Accent 2" /&gt;  &lt;w:lsdexception locked="false" \
priority="62" semihidden="false" unhidewhenused="false" name="Light Grid Accent 2" /&gt; \
&lt;w:lsdexception locked="false" priority="63" semihidden="false" \
unhidewhenused="false" name="Medium Shading 1 Accent 2" /&gt;  &lt;w:lsdexception \
locked="false" priority="64" semihidden="false" unhidewhenused="false" name="Medium \
Shading 2 Accent 2" /&gt;  &lt;w:lsdexception locked="false" priority="65" \
semihidden="false" unhidewhenused="false" name="Medium List 1 Accent 2" /&gt;  \
&lt;w:lsdexception locked="false" priority="66" semihidden="false" \
unhidewhenused="false" name="Medium List 2 Accent 2" /&gt;  &lt;w:lsdexception \
locked="false" priority="67" semihidden="false" unhidewhenused="false" name="Medium \
Grid 1 Accent 2" /&gt;  &lt;w:lsdexception locked="false" priority="68" semihidden="false" \
unhidewhenused="false" name="Medium Grid 2 Accent 2" /&gt;  &lt;w:lsdexception \
locked="false" priority="69" semihidden="false" unhidewhenused="false" name="Medium \
Grid 3 Accent 2" /&gt;  &lt;w:lsdexception locked="false" priority="70" semihidden="false" \
unhidewhenused="false" name="Dark List Accent 2" /&gt;  &lt;w:lsdexception locked="false" \
priority="71" semihidden="false" unhidewhenused="false" name="Colorful Shading Accent \
2" /&gt;  &lt;w:lsdexception locked="false" priority="72" semihidden="false" \
unhidewhenused="false" name="Colorful List Accent 2" /&gt;  &lt;w:lsdexception \
locked="false" priority="73" semihidden="false" unhidewhenused="false" name="Colorful \
Grid Accent 2" /&gt;  &lt;w:lsdexception locked="false" priority="60" semihidden="false" \
unhidewhenused="false" name="Light Shading Accent 3" /&gt;  &lt;w:lsdexception \
locked="false" priority="61" semihidden="false" unhidewhenused="false" name="Light \
List Accent 3" /&gt;  &lt;w:lsdexception locked="false" priority="62" semihidden="false" \
unhidewhenused="false" name="Light Grid Accent 3" /&gt;  &lt;w:lsdexception locked="false" \
priority="63" semihidden="false" unhidewhenused="false" name="Medium Shading 1 Accent \
3" /&gt;  &lt;w:lsdexception locked="false" priority="64" semihidden="false" \
unhidewhenused="false" name="Medium Shading 2 Accent 3" /&gt;  &lt;w:lsdexception \
locked="false" priority="65" semihidden="false" unhidewhenused="false" name="Medium \
List 1 Accent 3" /&gt;  &lt;w:lsdexception locked="false" priority="66" semihidden="false" \
unhidewhenused="false" name="Medium List 2 Accent 3" /&gt;  &lt;w:lsdexception \
locked="false" priority="67" semihidden="false" unhidewhenused="false" name="Medium \
Grid 1 Accent 3" /&gt;  &lt;w:lsdexception locked="false" priority="68" semihidden="false" \
unhidewhenused="false" name="Medium Grid 2 Accent 3" /&gt;  &lt;w:lsdexception \
locked="false" priority="69" semihidden="false" unhidewhenused="false" name="Medium \
Grid 3 Accent 3" /&gt;  &lt;w:lsdexception locked="false" priority="70" semihidden="false" \
unhidewhenused="false" name="Dark List Accent 3" /&gt;  &lt;w:lsdexception locked="false" \
priority="71" semihidden="false" unhidewhenused="false" name="Colorful Shading Accent \
3" /&gt;  &lt;w:lsdexception locked="false" priority="72" semihidden="false" \
unhidewhenused="false" name="Colorful List Accent 3" /&gt;  &lt;w:lsdexception \
locked="false" priority="73" semihidden="false" unhidewhenused="false" name="Colorful \
Grid Accent 3" /&gt;  &lt;w:lsdexception locked="false" priority="60" semihidden="false" \
unhidewhenused="false" name="Light Shading Accent 4" /&gt;  &lt;w:lsdexception \
locked="false" priority="61" semihidden="false" unhidewhenused="false" name="Light \
List Accent 4" /&gt;  &lt;w:lsdexception locked="false" priority="62" semihidden="false" \
unhidewhenused="false" name="Light Grid Accent 4" /&gt;  &lt;w:lsdexception locked="false" \
priority="63" semihidden="false" unhidewhenused="false" name="Medium Shading 1 Accent \
4" /&gt;  &lt;w:lsdexception locked="false" priority="64" semihidden="false" \
unhidewhenused="false" name="Medium Shading 2 Accent 4" /&gt;  &lt;w:lsdexception \
locked="false" priority="65" semihidden="false" unhidewhenused="false" name="Medium \
List 1 Accent 4" /&gt;  &lt;w:lsdexception locked="false" priority="66" semihidden="false" \
unhidewhenused="false" name="Medium List 2 Accent 4" /&gt;  &lt;w:lsdexception \
locked="false" priority="67" semihidden="false" unhidewhenused="false" name="Medium \
Grid 1 Accent 4" /&gt;  &lt;w:lsdexception locked="false" priority="68" semihidden="false" \
unhidewhenused="false" name="Medium Grid 2 Accent 4" /&gt;  &lt;w:lsdexception \
locked="false" priority="69" semihidden="false" unhidewhenused="false" name="Medium \
Grid 3 Accent 4" /&gt;  &lt;w:lsdexception locked="false" priority="70" semihidden="false" \
unhidewhenused="false" name="Dark List Accent 4" /&gt;  &lt;w:lsdexception locked="false" \
priority="71" semihidden="false" unhidewhenused="false" name="Colorful Shading Accent \
4" /&gt;  &lt;w:lsdexception locked="false" priority="72" semihidden="false" \
unhidewhenused="false" name="Colorful List Accent 4" /&gt;  &lt;w:lsdexception \
locked="false" priority="73" semihidden="false" unhidewhenused="false" name="Colorful \
Grid Accent 4" /&gt;  &lt;w:lsdexception locked="false" priority="60" semihidden="false" \
unhidewhenused="false" name="Light Shading Accent 5" /&gt;  &lt;w:lsdexception \
locked="false" priority="61" semihidden="false" unhidewhenused="false" name="Light \
List Accent 5" /&gt;  &lt;w:lsdexception locked="false" priority="62" semihidden="false" \
unhidewhenused="false" name="Light Grid Accent 5" /&gt;  &lt;w:lsdexception locked="false" \
priority="63" semihidden="false" unhidewhenused="false" name="Medium Shading 1 Accent \
5" /&gt;  &lt;w:lsdexception locked="false" priority="64" semihidden="false" \
unhidewhenused="false" name="Medium Shading 2 Accent 5" /&gt;  &lt;w:lsdexception \
locked="false" priority="65" semihidden="false" unhidewhenused="false" name="Medium \
List 1 Accent 5" /&gt;  &lt;w:lsdexception locked="false" priority="66" semihidden="false" \
unhidewhenused="false" name="Medium List 2 Accent 5" /&gt;  &lt;w:lsdexception \
locked="false" priority="67" semihidden="false" unhidewhenused="false" name="Medium \
Grid 1 Accent 5" /&gt;  &lt;w:lsdexception locked="false" priority="68" semihidden="false" \
unhidewhenused="false" name="Medium Grid 2 Accent 5" /&gt;  &lt;w:lsdexception \
locked="false" priority="69" semihidden="false" unhidewhenused="false" name="Medium \
Grid 3 Accent 5" /&gt;  &lt;w:lsdexception locked="false" priority="70" semihidden="false" \
unhidewhenused="false" name="Dark List Accent 5" /&gt;  &lt;w:lsdexception locked="false" \
priority="71" semihidden="false" unhidewhenused="false" name="Colorful Shading Accent \
5" /&gt;  &lt;w:lsdexception locked="false" priority="72" semihidden="false" \
unhidewhenused="false" name="Colorful List Accent 5" /&gt;  &lt;w:lsdexception \
locked="false" priority="73" semihidden="false" unhidewhenused="false" name="Colorful \
Grid Accent 5" /&gt;  &lt;w:lsdexception locked="false" priority="60" semihidden="false" \
unhidewhenused="false" name="Light Shading Accent 6" /&gt;  &lt;w:lsdexception \
locked="false" priority="61" semihidden="false" unhidewhenused="false" name="Light \
List Accent 6" /&gt;  &lt;w:lsdexception locked="false" priority="62" semihidden="false" \
unhidewhenused="false" name="Light Grid Accent 6" /&gt;  &lt;w:lsdexception locked="false" \
priority="63" semihidden="false" unhidewhenused="false" name="Medium Shading 1 Accent \
6" /&gt;  &lt;w:lsdexception locked="false" priority="64" semihidden="false" \
unhidewhenused="false" name="Medium Shading 2 Accent 6" /&gt;  &lt;w:lsdexception \
locked="false" priority="65" semihidden="false" unhidewhenused="false" name="Medium \
List 1 Accent 6" /&gt;  &lt;w:lsdexception locked="false" priority="66" semihidden="false" \
unhidewhenused="false" name="Medium List 2 Accent 6" /&gt;  &lt;w:lsdexception \
locked="false" priority="67" semihidden="false" unhidewhenused="false" name="Medium \
Grid 1 Accent 6" /&gt;  &lt;w:lsdexception locked="false" priority="68" semihidden="false" \
unhidewhenused="false" name="Medium Grid 2 Accent 6" /&gt;  &lt;w:lsdexception \
locked="false" priority="69" semihidden="false" unhidewhenused="false" name="Medium \
Grid 3 Accent 6" /&gt;  &lt;w:lsdexception locked="false" priority="70" semihidden="false" \
unhidewhenused="false" name="Dark List Accent 6" /&gt;  &lt;w:lsdexception locked="false" \
priority="71" semihidden="false" unhidewhenused="false" name="Colorful Shading Accent \
6" /&gt;  &lt;w:lsdexception locked="false" priority="72" semihidden="false" \
unhidewhenused="false" name="Colorful List Accent 6" /&gt;  &lt;w:lsdexception \
locked="false" priority="73" semihidden="false" unhidewhenused="false" name="Colorful \
Grid Accent 6" /&gt;  &lt;w:lsdexception locked="false" priority="19" semihidden="false" \
unhidewhenused="false" qformat="true" name="Subtle Emphasis" /&gt;  &lt;w:lsdexception \
locked="false" priority="21" semihidden="false" unhidewhenused="false" qformat="true" \
name="Intense Emphasis" /&gt;  &lt;w:lsdexception locked="false" priority="31" \
semihidden="false" unhidewhenused="false" qformat="true" name="Subtle Reference" /&gt;  \
&lt;w:lsdexception locked="false" priority="32" semihidden="false" \
unhidewhenused="false" qformat="true" name="Intense Reference" /&gt;  &lt;w:lsdexception \
locked="false" priority="33" semihidden="false" unhidewhenused="false" qformat="true" \
name="Book Title" /&gt;  &lt;w:lsdexception locked="false" priority="37" \
name="Bibliography" /&gt;  &lt;w:lsdexception locked="false" priority="39" qformat="true" \
name="TOC Heading" /&gt;  &lt;/w:latentstyles&gt;
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if gte mso 10]&gt;
&lt;style&gt;
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.5pt;
	mso-bidi-font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-ascii-font-family:Calibri;
	mso-ascii-theme-font:minor-latin;
	mso-hansi-font-family:Calibri;
	mso-hansi-theme-font:minor-latin;
	mso-font-kerning:1.0pt;}
&lt;/style&gt;
&lt;![endif]--&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;span title="neteasefooter"&gt;&lt;p&gt; &lt;/p&gt;&lt;/span&gt;



</body></email><email><emailId>20170926095930</emailId><senderName>llilulu</senderName><senderEmail>llilulu@yeah.net</senderEmail><timestampReceived>2017-09-26 09:59:30-0400</timestampReceived><subject>[libvirt-users] virDomainSaveImageDefineXML</subject><body>

[Attachment #2 (text/plain)]

Hi:
    When I make snapshot use virDomainSave,before I resume the snapshot , I use \
virDomainSaveImageDefineXML change the domain info, like disk path. but I can't \
change the &lt;devices&gt; , for example detach a disk or interface, Can't tell me what can \
I change use virDomainSaveImageDefineXML before resume snapshot.


[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div&gt;Hi:&lt;/div&gt;&lt;div&gt;    \
When I make snapshot use virDomainSave,before I resume the snapshot , I use \
virDomainSaveImageDefineXML change the domain info, like disk path. but I can't \
change the &lt;devices&gt; , for example detach a disk or interface, Can't tell me \
what can I change use virDomainSaveImageDefineXML before resume \
snapshot.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;span title="neteasefooter"&gt;&lt;div \
id="netease_mail_footer"&gt;&lt;div style="border-top:#CCC 1px solid;padding:10px \
5px;font-size:17px;color:#777;line-height:22px"&gt;&lt;a \
href="http://you.163.com/item/detail?id=1165011&amp;from=web_gg_mail_jiaobiao_9" \
target="_blank" style="color:#3366FF;text-decoration:none"&gt;���������������|30����� \
���������������������������1/4���MUJI����� \
���"2017������������������������������"���������34.9���&gt;&gt;  &lt;/a&gt;    \
 &lt;/div&gt;&lt;/div&gt;&lt;/span&gt;



</body></email><email><emailId>20170926212045</emailId><senderName>"Jackson, Gary L."</senderName><senderEmail>gary.jackson@jhuapl.edu</senderEmail><timestampReceived>2017-09-26 21:20:45-0400</timestampReceived><subject>Re: [libvirt-users] Rollback to running VM</subject><body>

[Attachment #2 (multipart/alternative)]

[Attachment #4 (text/plain)]

Putting the image on tmpfs cut the snapshot time down by quite a bit. It didn't do \
much for the restore time, probably because the images I'm using fit in the file \
cache already.

Now I'm going to look in to profiling qemu to see where it's spending all of its \
time.

--
Gary Jackson

From: Doug Hughes &lt;doug.hughes@keystonenap.com&gt;
Date: Tuesday, September 19, 2017 at 12:59 PM
To: "Jackson, Gary L." &lt;Gary.Jackson@jhuapl.edu&gt;, "libvirt-users@redhat.com" \
                &lt;libvirt-users@redhat.com&gt;
Subject: Re: [libvirt-users] Rollback to running VM


I would estimate you are bounded by memory bandwidth (GB/sec - so not much, but \
proportional to memory size) and disk bandwidth. So, using SSD will help for certain \
vs spinning. I'm not sure about the catch-22 implicit with using a ramdisk, but since \
the ramdisk should be previsioned from the host to the guest, it seems like it should \
work.

There may be other bottlenecks in drivers, etc. Not in my knowledge domain.

On 9/19/2017 12:53 PM, Jackson, Gary L. wrote:

Thanks! The vanilla snapshot-create-as and revert commands work just exactly the way \
I'd want them to. I'd gotten a bit confused by the documentation and went down a \
rabbit hole with external snapshots.

Is there any way to make the snapshot and restore faster, like maybe by a decimal \
order of magnitude? For example, will PXE booting the VM and running it entirely off \
of a RAM disk and also using a RAM disk for the backing store help?

--
Gary Jackson

From: Doug Hughes &lt;doug.hughes@keystonenap.com&gt;&lt;mailto:doug.hughes@keystonenap.com&gt;
Date: Tuesday, September 19, 2017 at 11:25 AM
To: "Jackson, Gary L." &lt;Gary.Jackson@jhuapl.edu&gt;&lt;mailto:Gary.Jackson@jhuapl.edu&gt;, \
"libvirt-users@redhat.com"&lt;mailto:libvirt-users@redhat.com&gt; \
                &lt;libvirt-users@redhat.com&gt;&lt;mailto:libvirt-users@redhat.com&gt;
Subject: Re: [libvirt-users] Rollback to running VM

According to this page: https://wiki.libvirt.org/page/Snapshots
It saves complete memory state, or crash-consistent disk state, but not both.

You probably want to test it thoroughly and see how it does.  I only use the \
disk-consistent snapshots. On 9/19/2017 11:17 AM, Jackson, Gary L. wrote:

Will snapshot-revert restore the processor and memory state of the VM as it was at \
the time of the snapshot?



--
Doug Hughes
Keystone NAP
Fairless Hills, PA
1.844.KEYBLOCK (539.2562)

[cid:image001.png@01D33386.90476A70]



--
Doug Hughes
Keystone NAP
Fairless Hills, PA
1.844.KEYBLOCK (539.2562)

[cid:image002.png@01D33386.90476A70]


[Attachment #5 (text/html)]

&lt;html xmlns:v="urn:schemas-microsoft-com:vml" \
xmlns:o="urn:schemas-microsoft-com:office:office" \
xmlns:w="urn:schemas-microsoft-com:office:word" \
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" \
xmlns:mv="http://macVmlSchemaUri" xmlns="http://www.w3.org/TR/REC-html40"&gt; &lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
&lt;meta name="Title" content=""&gt;
&lt;meta name="Keywords" content=""&gt;
&lt;meta name="Generator" content="Microsoft Word 15 (filtered medium)"&gt;
&lt;!--[if !mso]&gt;&lt;style&gt;v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
&lt;/style&gt;&lt;![endif]--&gt;&lt;style&gt;&lt;!--
/* Font Definitions */
@font-face
	{font-family:"Courier New";
	panose-1:2 7 3 9 2 2 5 2 4 4;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:purple;
	text-decoration:underline;}
p
	{mso-style-priority:99;
	mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
pre
	{mso-style-priority:99;
	mso-style-link:"HTML Preformatted Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Courier New",serif;}
span.HTMLPreformattedChar
	{mso-style-name:"HTML Preformatted Char";
	mso-style-priority:99;
	mso-style-link:"HTML Preformatted";
	font-family:"Courier",serif;}
span.EmailStyle20
	{mso-style-type:personal;
	font-family:"Calibri",sans-serif;
	color:windowtext;}
span.EmailStyle21
	{mso-style-type:personal;
	font-family:"Calibri",sans-serif;
	color:windowtext;}
span.EmailStyle22
	{mso-style-type:personal-compose;
	font-family:"Calibri",sans-serif;
	color:windowtext;}
span.msoIns
	{mso-style-type:export-only;
	mso-style-name:"";
	text-decoration:underline;
	color:teal;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-size:10.0pt;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
--&gt;&lt;/style&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapedefaults v:ext="edit" spidmax="1026"/&gt;
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapelayout v:ext="edit"&gt;
&lt;o:idmap v:ext="edit" data="1"/&gt;
&lt;/o:shapelayout&gt;&lt;/xml&gt;&lt;![endif]--&gt;
&lt;/head&gt;
&lt;body bgcolor="white" lang="EN-US" link="blue" vlink="purple"&gt;
&lt;div class="WordSection1"&gt;
&lt;p class="MsoNormal"&gt;Putting the image on tmpfs cut the snapshot time down by quite a \
bit. It didn't do much for the restore time, probably because the images I'm using \
fit in the file cache already.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;Now I'm going to look in \
to profiling qemu to see where it's spending all of its time.&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt; &lt;div&gt;
&lt;div&gt;
&lt;div&gt;
&lt;p class="MsoNormal"&gt;&lt;span \
style="font-size:10.5pt;color:black"&gt;-- &lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;/div&gt;
&lt;div&gt;
&lt;p class="MsoNormal"&gt;&lt;span style="font-size:10.5pt;color:black"&gt;Gary \
Jackson&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;div style="border:none;border-top:solid #B5C4DF 1.0pt;padding:3.0pt 0in 0in 0in"&gt;
&lt;p class="MsoNormal"&gt;&lt;b&gt;&lt;span style="font-size:12.0pt;color:black"&gt;From: \
&lt;/span&gt;&lt;/b&gt;&lt;span style="font-size:12.0pt;color:black"&gt;Doug Hughes \
&lt;doug.hughes@keystonenap.com&gt;&lt;br&gt; &lt;b&gt;Date: &lt;/b&gt;Tuesday, September 19, 2017 at \
12:59 PM&lt;br&gt; &lt;b&gt;To: &lt;/b&gt;"Jackson, Gary L." &lt;Gary.Jackson@jhuapl.edu&gt;, \
"libvirt-users@redhat.com" &lt;libvirt-users@redhat.com&gt;&lt;br&gt; &lt;b&gt;Subject: \
&lt;/b&gt;Re: [libvirt-users] Rollback to running VM&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;/div&gt;
&lt;div&gt;
&lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;I would estimate you are bounded by memory bandwidth (GB/sec - so not much, but \
proportional to memory size) and disk bandwidth. So, using SSD will help for certain \
vs spinning. I'm not sure about the catch-22 implicit with using a ramdisk, but since \
the  ramdisk should be previsioned from the host to the guest, it seems like it \
should work.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p&gt;There may be other bottlenecks in drivers, etc. Not in \
my knowledge domain.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;div&gt;
&lt;p class="MsoNormal"&gt;On 9/19/2017 12:53 PM, Jackson, Gary L. wrote:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;blockquote style="margin-top:5.0pt;margin-bottom:5.0pt"&gt;
&lt;p class="MsoNormal"&gt; &lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;Thanks! The vanilla snapshot-create-as and revert commands work \
just exactly the way I'd want them to. I'd gotten a bit confused by the documentation \
and went down a rabbit hole with external snapshots.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt; &lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;Is there any way to make \
the snapshot and restore faster, like maybe by a decimal order of magnitude? For \
example, will PXE booting the VM and running it entirely off of a RAM disk and also \
using a RAM disk for the backing store help?&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt; &lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;div&gt;
&lt;div&gt;
&lt;div&gt;
&lt;p class="MsoNormal"&gt;&lt;span \
style="font-size:10.5pt;color:black"&gt;-- &lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;/div&gt;
&lt;div&gt;
&lt;p class="MsoNormal"&gt;&lt;span style="font-size:10.5pt;color:black"&gt;Gary \
Jackson&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p class="MsoNormal"&gt; &lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;div style="border:none;border-top:solid #B5C4DF 1.0pt;padding:3.0pt 0in 0in 0in"&gt;
&lt;p class="MsoNormal"&gt;&lt;b&gt;&lt;span style="font-size:12.0pt;color:black"&gt;From: \
&lt;/span&gt;&lt;/b&gt;&lt;span style="font-size:12.0pt;color:black"&gt;Doug Hughes &lt;/span&gt;&lt;a \
href="mailto:doug.hughes@keystonenap.com"&gt;&lt;span \
style="font-size:12.0pt"&gt;&lt;doug.hughes@keystonenap.com&gt;&lt;/span&gt;&lt;/a&gt;&lt;span \
style="font-size:12.0pt;color:black"&gt;&lt;br&gt; &lt;b&gt;Date: &lt;/b&gt;Tuesday, September 19, 2017 at \
11:25 AM&lt;br&gt; &lt;b&gt;To: &lt;/b&gt;"Jackson, Gary L." &lt;/span&gt;&lt;a \
href="mailto:Gary.Jackson@jhuapl.edu"&gt;&lt;span \
style="font-size:12.0pt"&gt;&lt;Gary.Jackson@jhuapl.edu&gt;&lt;/span&gt;&lt;/a&gt;&lt;span \
style="font-size:12.0pt;color:black"&gt;, &lt;/span&gt;&lt;a \
href="mailto:libvirt-users@redhat.com"&gt;&lt;span \
style="font-size:12.0pt"&gt;"libvirt-users@redhat.com"&lt;/span&gt;&lt;/a&gt;&lt;span \
style="font-size:12.0pt;color:black"&gt; &lt;/span&gt;&lt;a \
href="mailto:libvirt-users@redhat.com"&gt;&lt;span \
style="font-size:12.0pt"&gt;&lt;libvirt-users@redhat.com&gt;&lt;/span&gt;&lt;/a&gt;&lt;span \
style="font-size:12.0pt;color:black"&gt;&lt;br&gt; &lt;b&gt;Subject: &lt;/b&gt;Re: [libvirt-users] \
Rollback to running VM&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;/div&gt;
&lt;div&gt;
&lt;p class="MsoNormal"&gt; &lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;According to this page: &lt;a \
href="https://wiki.libvirt.org/page/Snapshots"&gt; \
https://wiki.libvirt.org/page/Snapshots&lt;/a&gt;&lt;br&gt; It saves complete memory state, or \
crash-consistent disk state, but not both.&lt;br&gt; &lt;br&gt;
You probably want to test it thoroughly and see how it does.  I only use the \
disk-consistent snapshots.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;div&gt;
&lt;p class="MsoNormal"&gt;On 9/19/2017 11:17 AM, Jackson, Gary L. wrote:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;blockquote style="margin-top:5.0pt;margin-bottom:5.0pt"&gt;
&lt;pre&gt;Will snapshot-revert restore the processor and memory state of the VM as it was \
at the time of the snapshot?&lt;o:p&gt;&lt;/o:p&gt;&lt;/pre&gt; &lt;pre&gt; &lt;o:p&gt;&lt;/o:p&gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p class="MsoNormal"&gt; &lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;div&gt;
&lt;p class="MsoNormal"&gt;-- &lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;table class="MsoNormalTable" border="0" cellpadding="0"&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td width="90%" style="width:90.0%;padding:.75pt .75pt .75pt 15.0pt"&gt;
&lt;p class="MsoNormal"&gt;Doug Hughes&lt;br&gt;
Keystone NAP&lt;br&gt;
Fairless Hills, PA&lt;br&gt;
1.844.KEYBLOCK (539.2562)&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td style="padding:.75pt 15.0pt .75pt .75pt;align:
                  right"&gt;
&lt;p class="MsoNormal"&gt;&lt;img border="0" width="185" height="110" id="Picture_x0020_1" \
src="cid:image001.png@01D336EB.C974B600" \
alt="cid:image001.png@01D33386.90476A70"&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class="MsoNormal"&gt; &lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/blockquote&gt;
&lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;div&gt;
&lt;p class="MsoNormal"&gt;-- &lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;table class="MsoNormalTable" border="0" cellpadding="0"&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td width="90%" style="width:90.0%;padding:.75pt .75pt .75pt 15.0pt"&gt;
&lt;p class="MsoNormal"&gt;Doug Hughes&lt;br&gt;
Keystone NAP&lt;br&gt;
Fairless Hills, PA&lt;br&gt;
1.844.KEYBLOCK (539.2562)&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td style="padding:.75pt 15.0pt .75pt .75pt;align: right"&gt;
&lt;p class="MsoNormal"&gt;&lt;img border="0" width="185" height="110" id="Picture_x0020_2" \
src="cid:image002.png@01D336EB.C974B600" \
alt="cid:image002.png@01D33386.90476A70"&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


["image001.png" (image/png)]
["image002.png" (image/png)]

</body></email><email><emailId>20170904073748</emailId><senderName>Yalan Zhang</senderName><senderEmail>yalzhang@redhat.com</senderEmail><timestampReceived>2017-09-04 07:37:48-0400</timestampReceived><subject>[libvirt-users] [virtual interface] detach interface during boot succeed with no changes</subject><body>

Hi guys,

when I detach an interface from vm during boot (vm boot not finished), it
always fail. I'm not sure if there is an existing bug. I have
confirmed with someone that for disk, there is similar behavior, if
this is also acceptable?

# virsh destroy rhel7.2; virsh start rhel7.2 ;sleep 2;  virsh
detach-interface rhel7.2 network 52:54:00:98:c4:a0; sleep 2; virsh
dumpxml rhel7.2 |grep /interface -B9
Domain rhel7.2 destroyed

Domain rhel7.2 started

Interface detached successfully

      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x06'
function='0x0'/&gt;
    &lt;/controller&gt;
    &lt;interface type='network'&gt;
      &lt;mac address='52:54:00:98:c4:a0'/&gt;
      &lt;source network='default' bridge='virbr0'/&gt;
      &lt;target dev='vnet0'/&gt;
      &lt;model type='rtl8139'/&gt;
      &lt;alias name='net0'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
function='0x0'/&gt;
    &lt;/interface&gt;

When I detach after the vm boot, expand the sleep time to 10, it will succeed.

# virsh destroy rhel7.2; virsh start rhel7.2 ;sleep 10;  virsh
detach-interface rhel7.2 network 52:54:00:98:c4:a0; sleep 2; virsh
dumpxml rhel7.2 |grep /interface -B9
Domain rhel7.2 destroyed

Domain rhel7.2 started

Interface detached successfully


-------
Best Regards,
Yalan Zhang
IRC: yalzhang
Internal phone: 8389413

</body></email><email><emailId>20170905011748</emailId><senderName>Shannon</senderName><senderEmail>shannon@arc.net.au</senderEmail><timestampReceived>2017-09-05 01:17:48-0400</timestampReceived><subject>[libvirt-users] DHCP logging settings</subject><body>

I find that libvirt clogs up syslog with trivial DHCP notifications. I 
know how to configure alternate logging with dnsmasq directly via 
'log-facility' and/or 'quiet-dhcp' options but the XML format used by 
libvirt appears to have no equivalent options. Is there a way to reduce 
syslog spam from libvirt without switching to a system-wide dnsmasq service?

</body></email><email><emailId>20170913212021</emailId><senderName>Homie Pawlowski</senderName><senderEmail>hpawlows@redhat.com</senderEmail><timestampReceived>2017-09-13 21:20:21-0400</timestampReceived><subject>[libvirt-users] Compile libvirt on OSX 10.12</subject><body>

I'm having issues with compiling libvirt on OSX 10.12

 ~/Development/github/libvirt/ [master] make
/Library/Developer/CommandLineTools/usr/bin/make  all-recursive

Making all in .
Making all in gnulib/lib
/Library/Developer/CommandLineTools/usr/bin/make  all-am
make[3]: Nothing to be done for `all-am'.
Making all in include/libvirt
make[2]: Nothing to be done for `all'.
Making all in src
/Library/Developer/CommandLineTools/usr/bin/make  all-am
  CC       util/libvirt_util_la-virthread.lo
util/virthread.c:272:17: error: 'syscall' is deprecated: first deprecated
in macOS 10.12 - syscall(2) is unsupported;
      please switch to a supported interface. For SYS_kdebug_trace use
kdebug_signpost().
      [-Werror,-Wdeprecated-declarations]
    pid_t tid = syscall(SYS_gettid);
                ^
/usr/include/unistd.h:733:6: note: 'syscall' has been explicitly marked
deprecated here
int      syscall(int, ...);
         ^
1 error generated.
make[3]: *** [util/libvirt_util_la-virthread.lo] Error 1
make[2]: *** [all] Error 2
make[1]: *** [all-recursive] Error 1

Anyone have any suggestion on how to do so?

Thanks,
-- 

HOMERO PAWLOWSKI

CLOUD CONSULTANT

Red Hat

&lt;https://www.redhat.com/&gt;

140 Broadway 24th Floor

New York, NY 10005

hpawlows@redhat.com
&lt;https://red.ht/sig&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;I'm having issues with compiling libvirt on OSX 10.12  \
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt; ~/Development/github/libvirt/ [master] make         \
&lt;/div&gt;&lt;div&gt;/Library/Developer/CommandLineTools/usr/bin/make   all-recursive           \
&lt;/div&gt;&lt;div&gt;Making all in .                     &lt;/div&gt;&lt;div&gt;Making all in gnulib/lib    \
&lt;/div&gt;&lt;div&gt;/Library/Developer/CommandLineTools/usr/bin/make   all-am     \
&lt;/div&gt;&lt;div&gt;make[3]: Nothing to be done for `all-am'.                           \
&lt;/div&gt;&lt;div&gt;Making all in include/libvirt                                             \
&lt;/div&gt;&lt;div&gt;make[2]: Nothing to be done for `all'.                                \
&lt;/div&gt;&lt;div&gt;Making all in src                  \
&lt;/div&gt;&lt;div&gt;/Library/Developer/CommandLineTools/usr/bin/make   all-am     &lt;/div&gt;&lt;div&gt;  \
CC          util/libvirt_util_la-virthread.lo                       &lt;/div&gt;&lt;div&gt;&lt;span \
style="background-color:rgb(255,255,0)"&gt;util/virthread.c:272:17: error: \
'syscall' is deprecated: first deprecated in macOS 10.12 - syscall(2) is \
unsupported;   &lt;/span&gt;&lt;/div&gt;&lt;div&gt;         please switch to a supported interface. For \
SYS_kdebug_trace use kdebug_signpost().                                             \
&lt;/div&gt;&lt;div&gt;         [-Werror,-Wdeprecated-declarations]                           \
&lt;/div&gt;&lt;div&gt;      pid_t tid = syscall(SYS_gettid);                                   \
&lt;/div&gt;&lt;div&gt;                        ^                  \
&lt;/div&gt;&lt;div&gt;/usr/include/unistd.h:733:6: note: 'syscall' has been explicitly \
marked deprecated here                                                &lt;/div&gt;&lt;div&gt;int  \
syscall(int, ...);   &lt;/div&gt;&lt;div&gt;              ^                             \
&lt;/div&gt;&lt;div&gt;1 error generated.                 &lt;/div&gt;&lt;div&gt;make[3]: *** \
[util/libvirt_util_la-virthread.lo] Error 1     &lt;/div&gt;&lt;div&gt;make[2]: *** [all] Error 2 \
&lt;/div&gt;&lt;div&gt;make[1]: *** [all-recursive] Error 1              \
&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Anyone have any suggestion on how to do \
so?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;-- &lt;br&gt;&lt;div class="gmail_signature"&gt;&lt;div \
dir="ltr"&gt;&lt;p style="color:rgb(0,0,0);font-family:overpass,sans-serif;font-weight:bold; \
margin:0px;padding:0px;font-size:14px;text-transform:uppercase"&gt;&lt;span&gt;HOMERO&lt;/span&gt;  \
&lt;span&gt;PAWLOWSKI&lt;/span&gt;&lt;/p&gt;&lt;p \
style="color:rgb(0,0,0);font-family:overpass,sans-serif;font-size:10px;margin:0px 0px \
4px;text-transform:uppercase"&gt;&lt;span&gt;CLOUD CONSULTANT&lt;/span&gt;&lt;/p&gt;&lt;p \
style="font-family:overpass,sans-serif;margin:0px;font-size:10px;color:rgb(153,153,153)"&gt;&lt;a \
href="https://www.redhat.com/" style="color:rgb(0,136,206);margin:0px" \
target="_blank"&gt;Red Hat  &lt;span&gt;&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;span \
style="font-family:overpass,sans-serif;font-size:10px;margin:0px;color:rgb(153,153,153)"&gt;&lt;p \
style="margin:0px"&gt;140 Broadway 24th Floor&lt;/p&gt;&lt;/span&gt;&lt;span \
style="color:rgb(0,0,0);font-family:overpass,sans-serif;font-size:medium"&gt;&lt;/span&gt;&lt;span \
style="color:rgb(0,0,0);font-family:overpass,sans-serif;font-size:medium"&gt;&lt;p \
style="font-size:10px;margin:0px;color:rgb(153,153,153)"&gt;New York, NY \
10005&lt;/p&gt;&lt;/span&gt;&lt;span \
style="color:rgb(0,0,0);font-family:overpass,sans-serif;font-size:medium"&gt;&lt;/span&gt;&lt;p \
style="font-family:overpass,sans-serif;margin:0px 0px \
6px;font-size:10px;color:rgb(153,153,153)"&gt;&lt;span style="margin:0px;padding:0px"&gt;&lt;a \
href="mailto:hpawlows@redhat.com" style="color:rgb(0,136,206);margin:0px" \
target="_blank"&gt;hpawlows@redhat.com&lt;/a&gt;     &lt;/span&gt;&lt;/p&gt;&lt;table border="0" \
style="color:rgb(0,0,0);font-family:overpass,sans-serif;font-size:medium"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td \
width="100px"&gt;&lt;a href="https://red.ht/sig" target="_blank"&gt;&lt;img \
src="https://www.redhat.com/profiles/rh/themes/redhatdotcom/img/logo-red-hat-black.png" \
width="90" height="auto"&gt;&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170918213909</emailId><senderName>Shashwat shagun</senderName><senderEmail>me@shashwat.tech</senderEmail><timestampReceived>2017-09-18 21:39:09-0400</timestampReceived><subject>[libvirt-users] How can i limit CPU allowance to 25% of a single core</subject><body>

Hi,
How do Hard limit a CPU allowance to 25% of a single core in KVM?

Regards,
Shashwat Shagun


[Attachment #3 (text/html)]

&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
&lt;head&gt;
&lt;title&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div name="messageBodySection" style="font-size: 14px; font-family: -apple-system, \
BlinkMacSystemFont, sans-serif;"&gt;Hi, &lt;div&gt;How do Hard limit a CPU allowance to 25% of \
a single core in KVM?&lt;/div&gt; &lt;/div&gt;
&lt;div name="messageSignatureSection" style="font-size: 14px; font-family: \
-apple-system, BlinkMacSystemFont, sans-serif;"&gt;&lt;br /&gt; Regards,
&lt;div&gt;Shashwat Shagun&lt;/div&gt;
&lt;/div&gt;
&lt;div name="messageReplySection" style="font-size: 14px; font-family: -apple-system, \
BlinkMacSystemFont, sans-serif;"&gt;&lt;br /&gt; &lt;div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170920091951</emailId><senderName>Kartik Vaishnav</senderName><senderEmail>kartikvaishnav@gmail.com</senderEmail><timestampReceived>2017-09-20 09:19:51-0400</timestampReceived><subject>[libvirt-users] Re : Libvirt Java Bindings</subject><body>

I am developing a Java Application using Libvirt. I found that the Java
Bindings are not in active development.
I need to obtain the IP Address of the Domain. In C, it may relate to
virDomainInterfaceAddresses. Is there any way to implement it in Java.

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;span style="font-size:12.8px"&gt;I am developing a Java Application \
using Libvirt. I found that the Java Bindings are not in active \
development.&lt;/span&gt;&lt;div style="font-size:12.8px"&gt;I need to obtain the IP Address of \
the Domain. In C, it may relate to virDomainInterfaceAddresses. Is there any way to \
implement it in Java.&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170921141438</emailId><senderName>mxs kolo</senderName><senderEmail>kolomaxes@gmail.com</senderEmail><timestampReceived>2017-09-21 14:14:38-0400</timestampReceived><subject>[libvirt-users] How automatically set group.devices.allow for libvirt-lxc container after start ?</subject><body>

  Hi.

I need to use /dev/ppp inside the lxc container, for very ancient software.
Problem solved this way:
1) virsh edit container name and add section:
  &lt;features&gt;
    &lt;capabilities policy='default'&gt;
      &lt;mknod state='on'/&gt;
    &lt;/capabilities&gt;
  &lt;/features&gt;
2) start container
3) attach or ssh container, be root:
#mknod /dev/ppp c 108 0
4) inside container (or from hardware node, no difference) run:
# echo "c 108:0 rwm" &gt;
/sys/fs/cgroup/devices/machine.slice/machine-lxc\\x2d${PID}\\x2d${CONTAINER_NAEM}scope/devices.allow
5) Now pppd  work inside lxc:
#pppd call reuters debug nodetach
using channel 1
Using interface ppp0
Connect: ppp0 &lt;--&gt; /dev/pts/2
sent [LCP ConfReq id=0x1 &lt;mru 1000&gt; &lt;asyncmap 0x0&gt; &lt;magic 0x567d90ae&gt;]
...

But such method has several drawbacks.
1) I do not want to give cap_mknod, no need extra holes. With
cap_mknod you can make /de/block_device and using device.allow to give
it the rights rwm.

2) libvirt-lxc has some analog of lxc/lxd options lxc.group.devices.allow ?
 lxc.cgroup.devices.allow = c 108:0 rwm

And yes, I need run "mknod" and "echo" each time after container
restart and before start pppd daemon inside.

p.s.
It would be nice specify any device in the xml domain config, for example:
&lt;devices&gt;
  &lt;device type='char' maj='108' min='0' allow='rwm' name="/dev/ppp"/&gt;
&lt;/devices&gt;
At start libvirt executes mknod and then writes the necessary rights
to cgroups device.allow.

b.r.
 Maxim Kozin

</body></email><email><emailId>20170919132845</emailId><senderName>"Jackson, Gary L."</senderName><senderEmail>gary.jackson@jhuapl.edu</senderEmail><timestampReceived>2017-09-19 13:28:45-0400</timestampReceived><subject>[libvirt-users] Rollback to running VM</subject><body>

[Attachment #2 (text/plain)]


I would like to make a snapshot of a running VM, let it continue to run after the \
shapshot, and then at some later time roll back the VM to that previous running \
state. Can I do that with libvirt? If so, how? I understand that this will cause all \
kinds of havoc with things like ongoing TCP connections, and I accept that risk.

--
Gary Jackson


[Attachment #3 (text/html)]

&lt;html xmlns:o="urn:schemas-microsoft-com:office:office" \
xmlns:w="urn:schemas-microsoft-com:office:word" \
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" \
xmlns="http://www.w3.org/TR/REC-html40"&gt; &lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
&lt;meta name="Title" content=""&gt;
&lt;meta name="Keywords" content=""&gt;
&lt;meta name="Generator" content="Microsoft Word 15 (filtered medium)"&gt;
&lt;style&gt;&lt;!--
/* Font Definitions */
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Calibri",sans-serif;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:#0563C1;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:#954F72;
	text-decoration:underline;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{mso-style-priority:34;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Calibri",sans-serif;}
span.EmailStyle17
	{mso-style-type:personal-compose;
	font-family:"Calibri",sans-serif;
	color:windowtext;}
span.msoIns
	{mso-style-type:export-only;
	mso-style-name:"";
	text-decoration:underline;
	color:teal;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-family:"Calibri",sans-serif;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
/* List Definitions */
@list l0
	{mso-list-id:649527321;
	mso-list-type:hybrid;
	mso-list-template-ids:1628060788 67698703 67698713 67698715 67698703 67698713 \
67698715 67698703 67698713 67698715;} @list l0:level1
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level2
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level3
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:right;
	text-indent:-9.0pt;}
@list l0:level4
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level5
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level6
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:right;
	text-indent:-9.0pt;}
@list l0:level7
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level8
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level9
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:right;
	text-indent:-9.0pt;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
--&gt;&lt;/style&gt;
&lt;/head&gt;
&lt;body bgcolor="white" lang="EN-US" link="#0563C1" vlink="#954F72"&gt;
&lt;div class="WordSection1"&gt;
&lt;p class="MsoNormal"&gt;&lt;span style="font-size:11.0pt"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span style="font-size:11.0pt"&gt;I would like to make a snapshot \
of a running VM, let it continue to run after the shapshot, and then at some later \
time roll back the VM to that previous running state. Can I do that with libvirt? If \
so, how?  I understand that this will cause all kinds of havoc with things like \
ongoing TCP connections, and I accept that risk.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;&lt;span style="font-size:11.0pt"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;div&gt;
&lt;div&gt;
&lt;p class="MsoNormal"&gt;&lt;span \
style="font-size:10.5pt;color:black"&gt;-- &lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;/div&gt;
&lt;div&gt;
&lt;p class="MsoNormal"&gt;&lt;span style="font-size:10.5pt;color:black"&gt;Gary \
Jackson&lt;/span&gt;&lt;/p&gt; &lt;/div&gt;
&lt;/div&gt;
&lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170927102317</emailId><senderName>llilulu</senderName><senderEmail>llilulu@yeah.net</senderEmail><timestampReceived>2017-09-27 10:23:17-0400</timestampReceived><subject>[libvirt-users] domain xml  &lt;video&gt;  doubt</subject><body>

[Attachment #2 (text/plain)]

Hi

    My libvirt is 3.4.0,When I create a kvm domain,  I use default &lt;video&gt; \
(type=cirrus, I not set video) create guest(debian9.1.0), but when finish install the \
guest and reboot, the guest will block in "started update utmp about system runlevel \
changes", I search on Internet, and find  is graphics card problem, I change the \
&lt;video&gt; type=vga, the problem disppear���The domain xml docs say��� I can set \
type=qxl, ...��� but qemu -vga args has other type support, (qemu  --help,  -vga \
[std|cirrus|qxl....), I want to know how I use other &lt;video&gt; type in my domain xml.  \
Thanks very!!!


[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div&gt;Hi \
&lt;br&gt;&lt;/div&gt;&lt;div&gt;    My libvirt is 3.4.0,When I create a kvm \
domain,  I use default &lt;video&gt; (type=cirrus, I not set video) create \
guest(debian9.1.0), but when finish install the guest and reboot, the guest will \
block in "started update utmp about system runlevel changes", I search on Internet, \
and find  is graphics card problem, I change the &lt;video&gt; type=vga, the \
problem disppear���The domain xml docs say��� I can set type=qxl, ...��� but qemu \
-vga args has other type support, (qemu  --help,  -vga \
[std|cirrus|qxl....), I want to know how I use other &lt;video&gt; type in my domain \
xml.&lt;/div&gt;&lt;div&gt;    Thanks very!!!&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;span \
title="neteasefooter"&gt;&lt;div id="netease_mail_footer"&gt;&lt;div style="border-top:#CCC 1px \
solid;padding:10px 5px;font-size:17px;color:#777;line-height:22px"&gt;&lt;a \
href="http://you.163.com/item/detail?id=1183001&amp;from=web_gg_mail_jiaobiao_7" \
target="_blank" style="color:#3366FF;text-decoration:none"&gt;����������������������������������������������� \
������������������13���/������������������75���3���&gt;&gt;   &lt;/a&gt;    \
 &lt;/div&gt;&lt;/div&gt;&lt;/span&gt;



</body></email><email><emailId>20170919135634</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-09-19 13:56:34-0400</timestampReceived><subject>Re: [libvirt-users] Rollback to running VM</subject><body>


On Tue, Sep 19, 2017 at 01:28:45PM +0000, Jackson, Gary L. wrote:
&gt;
&gt;I would like to make a snapshot of a running VM, let it continue to run
&gt;after the shapshot, and then at some later time roll back the VM to
&gt;that previous running state. Can I do that with libvirt? If so, how? I
&gt;understand that this will cause all kinds of havoc with things like
&gt;ongoing TCP connections, and I accept that risk.
&gt;

Check `man virsh` and the description to commands `snapshot-create-as`
and `snapshot-revert`.  If more information is needed, feel free to ask,
although if deep knowledge is required I might need to rely on someone
else to reply then.

Have a nice day,
Martin

&gt;--
&gt;Gary Jackson
&gt;

&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170919144737</emailId><senderName>Doug Hughes</senderName><senderEmail>doug.hughes@keystonenap.com</senderEmail><timestampReceived>2017-09-19 14:47:37-0400</timestampReceived><subject>Re: [libvirt-users] Rollback to running VM</subject><body>

[Attachment #2 (multipart/mixed)]


On 9/19/2017 9:56 AM, Martin Kletzander wrote:
&gt; On Tue, Sep 19, 2017 at 01:28:45PM +0000, Jackson, Gary L. wrote:
&gt;&gt;
&gt;&gt; I would like to make a snapshot of a running VM, let it continue to ru=
n
&gt;&gt; after the shapshot, and then at some later time roll back the VM to
&gt;&gt; that previous running state. Can I do that with libvirt? If so, how? I=

&gt;&gt; understand that this will cause all kinds of havoc with things like
&gt;&gt; ongoing TCP connections, and I accept that risk.
&gt;&gt;
&gt;
&gt; Check `man virsh` and the description to commands `snapshot-create-as`
&gt; and `snapshot-revert`.=A0 If more information is needed, feel free to a=
sk,
&gt; although if deep knowledge is required I might need to rely on someone
&gt; else to reply then.

agreed. This is definitely achievable with snapshot-create-as. You'll
prefer to shutdown the VM to make it work, but it can be done live using
the --running flag. I've never tried this. The man page isnt entirely
clear but it seems like it will effectively reboot to the state when the
snapshot was taken.
=A0Mechanics wise, you take the snapshot. Now you have a new disk image
file (usually with -snap, but you can name it whatever using
snapshot-as), that will be recording the changes that are happening to
the OS. The old image at the time of the snapshot is still there under
the original name. If you look in the xml file, you'll see it has
changed the path of the disk image to the new snapshot file. The new
snapshot is a 'sparse copy' in that is recording all of the new changes
happening, but it has a reference pointer pointing back to the original
image for things that have not changed. At any point, you can shut down
your VM and boot off the original image, which discards all of the
changes. Or you can decide that you want to 'blockcommit' all of the
changes back to the original image which you can do online without impact=
=2E

(I use this with ZFS replication to provide rollback capability per VM
image to another host in case of host failure)



["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170919151708</emailId><senderName>"Jackson, Gary L."</senderName><senderEmail>gary.jackson@jhuapl.edu</senderEmail><timestampReceived>2017-09-19 15:17:08-0400</timestampReceived><subject>Re: [libvirt-users] Rollback to running VM</subject><body>


Will snapshot-revert restore the processor and memory state of the VM as it was at \
the time of the snapshot?

-- 
Gary Jackson

On 9/19/17, 11:10 AM, "libvirt-users-bounces@redhat.com on behalf of Doug Hughes" \
&lt;libvirt-users-bounces@redhat.com on behalf of doug.hughes@keystonenap.com&gt; wrote:

    
    
    On 9/19/2017 9:56 AM, Martin Kletzander wrote:
    &gt; On Tue, Sep 19, 2017 at 01:28:45PM +0000, Jackson, Gary L. wrote:
    &gt;&gt;
    &gt;&gt; I would like to make a snapshot of a running VM, let it continue to run
    &gt;&gt; after the shapshot, and then at some later time roll back the VM to
    &gt;&gt; that previous running state. Can I do that with libvirt? If so, how? I
    &gt;&gt; understand that this will cause all kinds of havoc with things like
    &gt;&gt; ongoing TCP connections, and I accept that risk.
    &gt;&gt;
    &gt;
    &gt; Check `man virsh` and the description to commands `snapshot-create-as`
    &gt; and `snapshot-revert`.  If more information is needed, feel free to ask,
    &gt; although if deep knowledge is required I might need to rely on someone
    &gt; else to reply then.
    
    agreed. This is definitely achievable with snapshot-create-as. You'll
    prefer to shutdown the VM to make it work, but it can be done live using
    the --running flag. I've never tried this. The man page isnt entirely
    clear but it seems like it will effectively reboot to the state when the
    snapshot was taken.
     Mechanics wise, you take the snapshot. Now you have a new disk image
    file (usually with -snap, but you can name it whatever using
    snapshot-as), that will be recording the changes that are happening to
    the OS. The old image at the time of the snapshot is still there under
    the original name. If you look in the xml file, you'll see it has
    changed the path of the disk image to the new snapshot file. The new
    snapshot is a 'sparse copy' in that is recording all of the new changes
    happening, but it has a reference pointer pointing back to the original
    image for things that have not changed. At any point, you can shut down
    your VM and boot off the original image, which discards all of the
    changes. Or you can decide that you want to 'blockcommit' all of the
    changes back to the original image which you can do online without impact.
    
    (I use this with ZFS replication to provide rollback capability per VM
    image to another host in case of host failure)
    
    
    


</body></email><email><emailId>20170919152513</emailId><senderName>Doug Hughes</senderName><senderEmail>doug.hughes@keystonenap.com</senderEmail><timestampReceived>2017-09-19 15:25:13-0400</timestampReceived><subject>Re: [libvirt-users] Rollback to running VM</subject><body>

According to this page: https://wiki.libvirt.org/page/Snapshots
It saves complete memory state, or crash-consistent disk state, but not
both.

You probably want to test it thoroughly and see how it does.   I only use
the disk-consistent snapshots.

On 9/19/2017 11:17 AM, Jackson, Gary L. wrote:
&gt; Will snapshot-revert restore the processor and memory state of the VM as it was at \
&gt; the time of the snapshot? 

-- 
Doug Hughes
Keystone NAP
Fairless Hills, PA
1.844.KEYBLOCK (539.2562) 	


[Attachment #3 (multipart/related)]

[Attachment #5 (text/html)]

&lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
  &lt;/head&gt;
  &lt;body text="#000000" bgcolor="#FFFFFF"&gt;
    According to this page: &lt;a class="moz-txt-link-freetext" \
href="https://wiki.libvirt.org/page/Snapshots"&gt;https://wiki.libvirt.org/page/Snapshots&lt;/a&gt;&lt;br&gt;
  It saves complete memory state, or crash-consistent disk state, but
    not both.&lt;br&gt;
    &lt;br&gt;
    You probably want to test it thoroughly and see how it does.   I only
    use the disk-consistent snapshots.&lt;br&gt;
    &lt;br&gt;
    &lt;div class="moz-cite-prefix"&gt;On 9/19/2017 11:17 AM, Jackson, Gary L.
      wrote:&lt;br&gt;
    &lt;/div&gt;
    &lt;blockquote type="cite"
      cite="mid:75DD2FBF-94DC-4489-AD4B-8AA81312D491@jhuapl.edu"&gt;
      &lt;pre wrap=""&gt;
Will snapshot-revert restore the processor and memory state of the VM as it was at \
the time of the snapshot?

&lt;/pre&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
    &lt;div class="moz-signature"&gt;-- &lt;br&gt;
      &lt;table&gt;
        &lt;tbody&gt;
          &lt;tr&gt;
            &lt;td style="padding-left: 20px" width="90%"&gt;Doug Hughes&lt;br&gt;
              Keystone NAP&lt;br&gt;
              Fairless Hills, PA&lt;br&gt;
              1.844.KEYBLOCK (539.2562)&lt;/td&gt;
            &lt;td style="align: right;padding-right: 20px"&gt;&lt;img
                src="cid:part1.D158D895.F39A6355@keystonenap.com"&gt;
            &lt;/td&gt;
          &lt;/tr&gt;
        &lt;/tbody&gt;
      &lt;/table&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;


["keystone-nap.png" (image/png)]

</body></email><email><emailId>20170919165343</emailId><senderName>"Jackson, Gary L."</senderName><senderEmail>gary.jackson@jhuapl.edu</senderEmail><timestampReceived>2017-09-19 16:53:43-0400</timestampReceived><subject>Re: [libvirt-users] Rollback to running VM</subject><body>

[Attachment #2 (multipart/alternative)]

[Attachment #4 (text/plain)]


Thanks! The vanilla snapshot-create-as and revert commands work just exactly the way \
I'd want them to. I'd gotten a bit confused by the documentation and went down a \
rabbit hole with external snapshots.

Is there any way to make the snapshot and restore faster, like maybe by a decimal \
order of magnitude? For example, will PXE booting the VM and running it entirely off \
of a RAM disk and also using a RAM disk for the backing store help?

--
Gary Jackson

From: Doug Hughes &lt;doug.hughes@keystonenap.com&gt;
Date: Tuesday, September 19, 2017 at 11:25 AM
To: "Jackson, Gary L." &lt;Gary.Jackson@jhuapl.edu&gt;, "libvirt-users@redhat.com" \
                &lt;libvirt-users@redhat.com&gt;
Subject: Re: [libvirt-users] Rollback to running VM

According to this page: https://wiki.libvirt.org/page/Snapshots
It saves complete memory state, or crash-consistent disk state, but not both.

You probably want to test it thoroughly and see how it does.  I only use the \
disk-consistent snapshots. On 9/19/2017 11:17 AM, Jackson, Gary L. wrote:

Will snapshot-revert restore the processor and memory state of the VM as it was at \
the time of the snapshot?



--
Doug Hughes
Keystone NAP
Fairless Hills, PA
1.844.KEYBLOCK (539.2562)

[cid:image001.png@01D33146.522ABA40]


[Attachment #5 (text/html)]

&lt;html xmlns:v="urn:schemas-microsoft-com:vml" \
xmlns:o="urn:schemas-microsoft-com:office:office" \
xmlns:w="urn:schemas-microsoft-com:office:word" \
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" \
xmlns:mv="http://macVmlSchemaUri" xmlns="http://www.w3.org/TR/REC-html40"&gt; &lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
&lt;meta name="Title" content=""&gt;
&lt;meta name="Keywords" content=""&gt;
&lt;meta name="Generator" content="Microsoft Word 15 (filtered medium)"&gt;
&lt;!--[if !mso]&gt;&lt;style&gt;v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
&lt;/style&gt;&lt;![endif]--&gt;&lt;style&gt;&lt;!--
/* Font Definitions */
@font-face
	{font-family:"Courier New";
	panose-1:2 7 3 9 2 2 5 2 4 4;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:purple;
	text-decoration:underline;}
pre
	{mso-style-priority:99;
	mso-style-link:"HTML Preformatted Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Courier New",serif;}
span.HTMLPreformattedChar
	{mso-style-name:"HTML Preformatted Char";
	mso-style-priority:99;
	mso-style-link:"HTML Preformatted";
	font-family:Courier;}
span.EmailStyle19
	{mso-style-type:personal-reply;
	font-family:"Calibri",sans-serif;
	color:windowtext;}
span.msoIns
	{mso-style-type:export-only;
	mso-style-name:"";
	text-decoration:underline;
	color:teal;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-size:10.0pt;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
--&gt;&lt;/style&gt;
&lt;/head&gt;
&lt;body bgcolor="white" lang="EN-US" link="blue" vlink="purple"&gt;
&lt;div class="WordSection1"&gt;
&lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;Thanks! The vanilla snapshot-create-as and revert commands work \
just exactly the way I'd want them to. I'd gotten a bit confused by the documentation \
and went down a rabbit hole with external snapshots.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;Is there any way to make \
the snapshot and restore faster, like maybe by a decimal order of magnitude? For \
example, will PXE booting the VM and running it entirely off of a RAM disk and also \
using a RAM disk for the backing store help?&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt; &lt;div&gt;
&lt;div&gt;
&lt;div&gt;
&lt;p class="MsoNormal"&gt;&lt;span \
style="font-size:10.5pt;color:black"&gt;-- &lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;/div&gt;
&lt;div&gt;
&lt;p class="MsoNormal"&gt;&lt;span style="font-size:10.5pt;color:black"&gt;Gary \
Jackson&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;div style="border:none;border-top:solid #B5C4DF 1.0pt;padding:3.0pt 0in 0in 0in"&gt;
&lt;p class="MsoNormal"&gt;&lt;b&gt;&lt;span style="font-size:12.0pt;color:black"&gt;From: \
&lt;/span&gt;&lt;/b&gt;&lt;span style="font-size:12.0pt;color:black"&gt;Doug Hughes \
&lt;doug.hughes@keystonenap.com&gt;&lt;br&gt; &lt;b&gt;Date: &lt;/b&gt;Tuesday, September 19, 2017 at \
11:25 AM&lt;br&gt; &lt;b&gt;To: &lt;/b&gt;"Jackson, Gary L." &lt;Gary.Jackson@jhuapl.edu&gt;, \
"libvirt-users@redhat.com" &lt;libvirt-users@redhat.com&gt;&lt;br&gt; &lt;b&gt;Subject: \
&lt;/b&gt;Re: [libvirt-users] Rollback to running VM&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;/div&gt;
&lt;div&gt;
&lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;According to this page: &lt;a \
href="https://wiki.libvirt.org/page/Snapshots"&gt; \
https://wiki.libvirt.org/page/Snapshots&lt;/a&gt;&lt;br&gt; It saves complete memory state, or \
crash-consistent disk state, but not both.&lt;br&gt; &lt;br&gt;
You probably want to test it thoroughly and see how it does.  I only use the \
disk-consistent snapshots.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;div&gt;
&lt;p class="MsoNormal"&gt;On 9/19/2017 11:17 AM, Jackson, Gary L. wrote:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;blockquote style="margin-top:5.0pt;margin-bottom:5.0pt"&gt;
&lt;pre&gt;Will snapshot-revert restore the processor and memory state of the VM as it was \
at the time of the snapshot?&lt;o:p&gt;&lt;/o:p&gt;&lt;/pre&gt; &lt;pre&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;div&gt;
&lt;p class="MsoNormal"&gt;-- &lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;table class="MsoNormalTable" border="0" cellpadding="0"&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td width="90%" style="width:90.0%;padding:.75pt .75pt .75pt 15.0pt"&gt;
&lt;p class="MsoNormal"&gt;Doug Hughes&lt;br&gt;
Keystone NAP&lt;br&gt;
Fairless Hills, PA&lt;br&gt;
1.844.KEYBLOCK (539.2562)&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td style="padding:.75pt 15.0pt .75pt .75pt;align: right"&gt;
&lt;p class="MsoNormal"&gt;&lt;img border="0" width="185" height="110" id="_x0000_i1025" \
src="cid:image001.png@01D33146.522ABA40"&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


["image001.png" (image/png)]

</body></email><email><emailId>20170919165921</emailId><senderName>Doug Hughes</senderName><senderEmail>doug.hughes@keystonenap.com</senderEmail><timestampReceived>2017-09-19 16:59:21-0400</timestampReceived><subject>Re: [libvirt-users] Rollback to running VM</subject><body>

I would estimate you are bounded by memory bandwidth (GB/sec - so not
much, but proportional to memory size) and disk bandwidth. So, using SSD
will help for certain vs spinning. I'm not sure about the catch-22
implicit with using a ramdisk, but since the ramdisk should be
previsioned from the host to the guest, it seems like it should work.

There may be other bottlenecks in drivers, etc. Not in my knowledge domain.


On 9/19/2017 12:53 PM, Jackson, Gary L. wrote:
&gt; 
&gt; 
&gt; 
&gt; Thanks! The vanilla snapshot-create-as and revert commands work just
&gt; exactly the way I’d want them to. I’d gotten a bit confused by the
&gt; documentation and went down a rabbit hole with external snapshots.
&gt; 
&gt; 
&gt; 
&gt; Is there any way to make the snapshot and restore faster, like maybe
&gt; by a decimal order of magnitude? For example, will PXE booting the VM
&gt; and running it entirely off of a RAM disk and also using a RAM disk
&gt; for the backing store help?
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; 
&gt; Gary Jackson
&gt; 
&gt; 
&gt; 
&gt; *From: *Doug Hughes &lt;doug.hughes@keystonenap.com&gt;
&gt; *Date: *Tuesday, September 19, 2017 at 11:25 AM
&gt; *To: *"Jackson, Gary L." &lt;Gary.Jackson@jhuapl.edu&gt;,
&gt; "libvirt-users@redhat.com" &lt;libvirt-users@redhat.com&gt;
&gt; *Subject: *Re: [libvirt-users] Rollback to running VM
&gt; 
&gt; 
&gt; 
&gt; According to this page: https://wiki.libvirt.org/page/Snapshots
&gt; &lt;https://wiki.libvirt.org/page/Snapshots&gt;
&gt; It saves complete memory state, or crash-consistent disk state, but
&gt; not both.
&gt; 
&gt; You probably want to test it thoroughly and see how it does.  I only
&gt; use the disk-consistent snapshots.
&gt; 
&gt; On 9/19/2017 11:17 AM, Jackson, Gary L. wrote:
&gt; 
&gt; Will snapshot-revert restore the processor and memory state of the VM as it was at \
&gt; the time of the snapshot? 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; 
&gt; Doug Hughes
&gt; Keystone NAP
&gt; Fairless Hills, PA
&gt; 1.844.KEYBLOCK (539.2562)
&gt; 
&gt; 	
&gt; 
&gt; 
&gt; 

-- 
Doug Hughes
Keystone NAP
Fairless Hills, PA
1.844.KEYBLOCK (539.2562) 	


[Attachment #3 (multipart/related)]

[Attachment #5 (text/html)]

&lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
  &lt;/head&gt;
  &lt;body text="#000000" bgcolor="#FFFFFF"&gt;
    &lt;p&gt;I would estimate you are bounded by memory bandwidth (GB/sec - so
      not much, but proportional to memory size) and disk bandwidth. So,
      using SSD will help for certain vs spinning. I'm not sure about
      the catch-22 implicit with using a ramdisk, but since the ramdisk
      should be previsioned from the host to the guest, it seems like it
      should work.&lt;/p&gt;
    &lt;p&gt;There may be other bottlenecks in drivers, etc. Not in my
      knowledge domain.&lt;br&gt;
    &lt;/p&gt;
    &lt;br&gt;
    &lt;div class="moz-cite-prefix"&gt;On 9/19/2017 12:53 PM, Jackson, Gary L.
      wrote:&lt;br&gt;
    &lt;/div&gt;
    &lt;blockquote type="cite"
      cite="mid:3B8F69B3-C7C2-4094-854F-484BAE3DC51F@jhuapl.edu"&gt;
      &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
      &lt;meta name="Title" content=""&gt;
      &lt;meta name="Keywords" content=""&gt;
      &lt;meta name="Generator" content="Microsoft Word 15 (filtered
        medium)"&gt;
      &lt;!--[if !mso]&gt;&lt;style&gt;v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
&lt;/style&gt;&lt;![endif]--&gt;
      &lt;style&gt;&lt;!--
/* Font Definitions */
@font-face
	{font-family:"Courier New";
	panose-1:2 7 3 9 2 2 5 2 4 4;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:purple;
	text-decoration:underline;}
pre
	{mso-style-priority:99;
	mso-style-link:"HTML Preformatted Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Courier New",serif;}
span.HTMLPreformattedChar
	{mso-style-name:"HTML Preformatted Char";
	mso-style-priority:99;
	mso-style-link:"HTML Preformatted";
	font-family:Courier;}
span.EmailStyle19
	{mso-style-type:personal-reply;
	font-family:"Calibri",sans-serif;
	color:windowtext;}
span.msoIns
	{mso-style-type:export-only;
	mso-style-name:"";
	text-decoration:underline;
	color:teal;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-size:10.0pt;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
--&gt;&lt;/style&gt;
      &lt;div class="WordSection1"&gt;
        &lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
        &lt;p class="MsoNormal"&gt;Thanks! The vanilla snapshot-create-as and
          revert commands work just exactly the way I’d want them to.
          I’d gotten a bit confused by the documentation and went down a
          rabbit hole with external snapshots.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
        &lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
        &lt;p class="MsoNormal"&gt;Is there any way to make the snapshot and
          restore faster, like maybe by a decimal order of magnitude?
          For example, will PXE booting the VM and running it entirely
          off of a RAM disk and also using a RAM disk for the backing
          store help?&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
        &lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
        &lt;div&gt;
          &lt;div&gt;
            &lt;div&gt;
              &lt;p class="MsoNormal"&gt;&lt;span
                  style="font-size:10.5pt;color:black"&gt;-- &lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
            &lt;/div&gt;
            &lt;div&gt;
              &lt;p class="MsoNormal"&gt;&lt;span
                  style="font-size:10.5pt;color:black"&gt;Gary \
Jackson&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;  &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        &lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
        &lt;div style="border:none;border-top:solid #B5C4DF
          1.0pt;padding:3.0pt 0in 0in 0in"&gt;
          &lt;p class="MsoNormal"&gt;&lt;b&gt;&lt;span
                style="font-size:12.0pt;color:black"&gt;From: &lt;/span&gt;&lt;/b&gt;&lt;span
              style="font-size:12.0pt;color:black"&gt;Doug Hughes
              &lt;a class="moz-txt-link-rfc2396E" \
href="mailto:doug.hughes@keystonenap.com"&gt;&lt;doug.hughes@keystonenap.com&gt;&lt;/a&gt;&lt;br&gt; \
&lt;b&gt;Date: &lt;/b&gt;Tuesday, September 19, 2017 at 11:25 AM&lt;br&gt;  &lt;b&gt;To: &lt;/b&gt;"Jackson, Gary \
                L."
              &lt;a class="moz-txt-link-rfc2396E" \
                href="mailto:Gary.Jackson@jhuapl.edu"&gt;&lt;Gary.Jackson@jhuapl.edu&gt;&lt;/a&gt;,
                
              &lt;a class="moz-txt-link-rfc2396E" \
                href="mailto:libvirt-users@redhat.com"&gt;"libvirt-users@redhat.com"&lt;/a&gt;
              &lt;a class="moz-txt-link-rfc2396E" \
href="mailto:libvirt-users@redhat.com"&gt;&lt;libvirt-users@redhat.com&gt;&lt;/a&gt;&lt;br&gt;  \
&lt;b&gt;Subject: &lt;/b&gt;Re: [libvirt-users] Rollback to running  VM&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
        &lt;/div&gt;
        &lt;div&gt;
          &lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
        &lt;/div&gt;
        &lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;According to
          this page: &lt;a href="https://wiki.libvirt.org/page/Snapshots"
            moz-do-not-send="true"&gt;
            https://wiki.libvirt.org/page/Snapshots&lt;/a&gt;&lt;br&gt;
          It saves complete memory state, or crash-consistent disk
          state, but not both.&lt;br&gt;
          &lt;br&gt;
          You probably want to test it thoroughly and see how it does. 
          I only use the disk-consistent snapshots.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
        &lt;div&gt;
          &lt;p class="MsoNormal"&gt;On 9/19/2017 11:17 AM, Jackson, Gary L.
            wrote:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
        &lt;/div&gt;
        &lt;blockquote style="margin-top:5.0pt;margin-bottom:5.0pt"&gt;
          &lt;pre&gt;Will snapshot-revert restore the processor and memory state of the VM \
as it was at the time of the snapshot?&lt;o:p&gt;&lt;/o:p&gt;&lt;/pre&gt;  &lt;pre&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/pre&gt;
        &lt;/blockquote&gt;
        &lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
        &lt;div&gt;
          &lt;p class="MsoNormal"&gt;-- &lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
          &lt;table class="MsoNormalTable" cellpadding="0" border="0"&gt;
            &lt;tbody&gt;
              &lt;tr&gt;
                &lt;td style="width:90.0%;padding:.75pt .75pt .75pt 15.0pt"
                  width="90%"&gt;
                  &lt;p class="MsoNormal"&gt;Doug Hughes&lt;br&gt;
                    Keystone NAP&lt;br&gt;
                    Fairless Hills, PA&lt;br&gt;
                    1.844.KEYBLOCK (539.2562)&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
                &lt;/td&gt;
                &lt;td style="padding:.75pt 15.0pt .75pt .75pt;align:
                  right"&gt;
                  &lt;p class="MsoNormal"&gt;&lt;img id="_x0000_i1025"
                      src="cid:part2.B4097F91.B26C1A02@keystonenap.com"
                      class="" height="110" width="185" border="0"&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
            &lt;/tbody&gt;
          &lt;/table&gt;
          &lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
    &lt;div class="moz-signature"&gt;-- &lt;br&gt;
      &lt;table&gt;
        &lt;tbody&gt;
          &lt;tr&gt;
            &lt;td style="padding-left: 20px" width="90%"&gt;Doug Hughes&lt;br&gt;
              Keystone NAP&lt;br&gt;
              Fairless Hills, PA&lt;br&gt;
              1.844.KEYBLOCK (539.2562)&lt;/td&gt;
            &lt;td style="align: right;padding-right: 20px"&gt;&lt;img
                src="cid:part3.E128A06D.11D06AEA@keystonenap.com"&gt;
            &lt;/td&gt;
          &lt;/tr&gt;
        &lt;/tbody&gt;
      &lt;/table&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;


["image001.png" (image/png)]
["keystone-nap.png" (image/png)]

</body></email><email><emailId>20170914132036</emailId><senderName>Andrea Bolognani</senderName><senderEmail>abologna@redhat.com</senderEmail><timestampReceived>2017-09-14 13:20:36-0400</timestampReceived><subject>Re: [libvirt-users] Compile libvirt on OSX 10.12</subject><body>

On Wed, 2017-09-13 at 17:20 -0400, Homie Pawlowski wrote:
&gt; I'm having issues with compiling libvirt on OSX 10.12
&gt; 
&gt;  ~/Development/github/libvirt/ [master] make
&gt; /Library/Developer/CommandLineTools/usr/bin/make  all-recursive
&gt; Making all in .
&gt; Making all in gnulib/lib
&gt; /Library/Developer/CommandLineTools/usr/bin/make  all-am
&gt; make[3]: Nothing to be done for `all-am'.
&gt; Making all in include/libvirt
&gt; make[2]: Nothing to be done for `all'.
&gt; Making all in src
&gt; /Library/Developer/CommandLineTools/usr/bin/make  all-am
&gt; CC       util/libvirt_util_la-virthread.lo
&gt; util/virthread.c:272:17: error: 'syscall' is deprecated: first deprecated in macOS \
&gt; 10.12 - syscall(2) is unsupported; please switch to a supported interface. For \
&gt; SYS_kdebug_trace use kdebug_signpost(). [-Werror,-Wdeprecated-declarations]
&gt; pid_t tid = syscall(SYS_gettid);
&gt; ^
&gt; /usr/include/unistd.h:733:6: note: 'syscall' has been explicitly marked deprecated \
&gt; here int      syscall(int, ...);
&gt; ^
&gt; 1 error generated.
&gt; make[3]: *** [util/libvirt_util_la-virthread.lo] Error 1
&gt; make[2]: *** [all] Error 2
&gt; make[1]: *** [all-recursive] Error 1
&gt; 
&gt; Anyone have any suggestion on how to do so?

As a quick workaround, you can either pass

  --disable-werror

to configure/autogen.sh or (better) compile from a release
tarball rather than a git clone.

In the long run, someone with access to macOS will have to fix
the issue and post a patch on the development mailing list.

-- 
Andrea Bolognani / Red Hat / Virtualization


</body></email><email><emailId>20170913165957</emailId><senderName>Laine Stump</senderName><senderEmail>laine@laine.org</senderEmail><timestampReceived>2017-09-13 16:59:57-0400</timestampReceived><subject>Re: [libvirt-users] DHCP logging settings</subject><body>

On 09/04/2017 09:17 PM, Shannon wrote:
&gt; I find that libvirt clogs up syslog with trivial DHCP notifications. I
&gt; know how to configure alternate logging with dnsmasq directly via
&gt; 'log-facility' and/or 'quiet-dhcp' options

(Unfortunately there isn't currently any knob you can easily turn to
reduce dnsmasq's logs)

Interesting. A long time ago I was annoyed by all the logging produced
by dnsmasq and searched the standard/sample dnsmasq.conf for an option
to reduce the logging, but all I saw were options to *increase* it! I
guess I didn't look far enough.

It would be nice for libvirt to take advantage of this, but since the
logging levels of other parts of libvirt are handled in libvirtd.conf
and qemu.conf, maybe it would be better to add the option there rather
than making it a part of the config for each network. (on the other
hand, it might be nice to be able to have more verbose logs for some
networks than for others).

Does anyone have an opinion about this? Maybe we could have a
"dhcp_quiet" option in libvirtd.conf? (alternately I guess we could a
&lt;log&gt; element to networks, but that would require something sufficiently
generic that it would also be useful if someone decided to, e.g., write
a network driver that used the ISC dhcpd instead of dnsmasq).

Adding a conf file option could be a good candidate for a "My first
libvirt patch" task for someone...

&gt; but the XML format used by libvirt appears to have no equivalent
&gt; options. Is there a way to reduce syslog spam from libvirt without
&gt; switching to a system-wide dnsmasq service?
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;

</body></email><email><emailId>20170913173550</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-09-13 17:35:50-0400</timestampReceived><subject>Re: [libvirt-users] DHCP logging settings</subject><body>

On Wed, Sep 13, 2017 at 12:59:57PM -0400, Laine Stump wrote:
&gt; On 09/04/2017 09:17 PM, Shannon wrote:
&gt; &gt; I find that libvirt clogs up syslog with trivial DHCP notifications. I
&gt; &gt; know how to configure alternate logging with dnsmasq directly via
&gt; &gt; 'log-facility' and/or 'quiet-dhcp' options
&gt; 
&gt; (Unfortunately there isn't currently any knob you can easily turn to
&gt; reduce dnsmasq's logs)
&gt; 
&gt; Interesting. A long time ago I was annoyed by all the logging produced
&gt; by dnsmasq and searched the standard/sample dnsmasq.conf for an option
&gt; to reduce the logging, but all I saw were options to *increase* it! I
&gt; guess I didn't look far enough.
&gt; 
&gt; It would be nice for libvirt to take advantage of this, but since the
&gt; logging levels of other parts of libvirt are handled in libvirtd.conf
&gt; and qemu.conf, maybe it would be better to add the option there rather
&gt; than making it a part of the config for each network. (on the other
&gt; hand, it might be nice to be able to have more verbose logs for some
&gt; networks than for others).
&gt; 
&gt; Does anyone have an opinion about this? Maybe we could have a
&gt; "dhcp_quiet" option in libvirtd.conf? (alternately I guess we could a
&gt; &lt;log&gt; element to networks, but that would require something sufficiently
&gt; generic that it would also be useful if someone decided to, e.g., write
&gt; a network driver that used the ISC dhcpd instead of dnsmasq).

NB it would want to be in /etc/libvirt/network.conf, since this would
be specific to the network driver.  It seems reasonable to add such
a thing.

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170927124132</emailId><senderName>Pavel Hrdina</senderName><senderEmail>phrdina@redhat.com</senderEmail><timestampReceived>2017-09-27 12:41:32-0400</timestampReceived><subject>Re: [libvirt-users] domain xml  &lt;video&gt;  doubt</subject><body>


On Wed, Sep 27, 2017 at 06:23:17PM +0800, llilulu wrote:
&gt; Hi
&gt; 
&gt; My libvirt is 3.4.0,When I create a kvm domain,  I use default &lt;video&gt; \
&gt; (type=cirrus, I not set video) create guest(debian9.1.0), but when finish install \
&gt; the guest and reboot, the guest will block in "started update utmp about system \
&gt; runlevel changes", I search on Internet, and find  is graphics card problem, I \
&gt; change the &lt;video&gt; type=vga, the problem disppear。The domain xml docs say， I \
&gt; can set type=qxl, ...， but qemu -vga args has other type support, (qemu  --help,  \
&gt; -vga [std|cirrus|qxl....), I want to know how I use other &lt;video&gt; type in my domain \
&gt; xml. Thanks very!!!

Hi,

To get the list of supported video devices in libvirt read the
"Video devices" section in libvirt documentation [1].  Only those
video devices are supported in libvirt.

The only confusing thing with that can be the fact, that "-vga std"
is mapped to "-device VGA" and in libvirt it's "vga".  Similarly
the "-vga vmware" is mapped to "-device vmware-svga" and the name in
libvirt is "vmvga".

In most cases the best choice is "qxl", but some systems have a bugs in
driver for the "qxl" device so if it doesn't work you can change it to
"vga".

You might be interested in virt-manager, if you install a guest using
virt-manager and you tell it what typo of OS you are installing
virt-manager tries to configure the best defaults for that OS.


For the implementation details, libvirt doesn't use the "-vga" option
because you cannot easily configure other parameters using this option.
Libvirt uses a -device option to configure video device.  To get the
list of devices just run "qemu -device ?", there is a section
"Display devices", with the version of the qemu in my system I have the
following output:

    Display devices:
    name "cirrus-vga", bus PCI, desc "Cirrus CLGD 54xx VGA"
    name "isa-cirrus-vga", bus ISA
    name "isa-vga", bus ISA
    name "qxl", bus PCI, desc "Spice QXL GPU (secondary)"
    name "qxl-vga", bus PCI, desc "Spice QXL GPU (primary, vga compatible)"
    name "secondary-vga", bus PCI
    name "sga", bus ISA, desc "Serial Graphics Adapter"
    name "VGA", bus PCI
    name "virtio-gpu-pci", bus PCI, alias "virtio-gpu"
    name "virtio-vga", bus PCI
    name "vmware-svga", bus PCI

Pavel

[1] &lt;http://libvirt.org/formatdomain.html#elementsVideo&gt;

&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170802113701</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-08-02 11:37:01-0400</timestampReceived><subject>Re: [libvirt-users] Regarding KVM-Qemu Migration code</subject><body>


On Wed, Aug 02, 2017 at 02:48:17PM +0530, Aditya Bhardwaj wrote:
&gt;Respected Sir,
&gt;I need to modify kvm-qemu migration code. Please tell me where i can
&gt;find the code.
&gt;

If I were in a bad mood, I would just send you this:

  http://lmgtfy.com/?s=d&amp;q=qemu-kvm+repository

I never send these:

  http://lmgtfy.com/?s=d&amp;iie=1&amp;q=qemu-kvm+repository

these are just mean and that doesn't align with who I am ;)

But since I'm not, I will explain it for you.  qemu-kvm is part of qemu
(it's not separate repo any more), it is not part of libvirt (mailing
list you are sending this mail to), but it has rather its own community
(even those these two overlap quite a bit) with mailing lists listed
here:

  https://wiki.qemu.org/index.php/MailingLists

They have their own web pages ( https://www.qemu.org/ ) where you can
get all the information ( clicking a "contribute" link will lead you to
https://www.qemu.org/contribute/ where you should find everything
necessary )

When you clone the repository, there will be a folder called "migration"
in which most of the code handling migration is (be sure to check
docs/devel/*migration.txt files as well).

I would also be wise to follow other links from the contribute page,
such as the Getting started for developers:

  https://wiki.qemu.org/index.php/Documentation/GettingStartedDevelopers

Contributor FAQ:

  https://wiki.qemu.org/index.php/Contribute/FAQ

and last, but not least, How to submit a patch:

  https://wiki.qemu.org/index.php/Contribute/SubmitAPatch


Good luck with your contributions and have a nice day,
Martin

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170802174334</emailId><senderName>Fred Rolland</senderName><senderEmail>frolland@redhat.com</senderEmail><timestampReceived>2017-08-02 17:43:34-0400</timestampReceived><subject>Re: [libvirt-users] Libvirt fails on network disk with ISCSI protocol</subject><body>

Thanks, it was the issue.
I guess the documentation should be updated.

Thank you for your help !

On Wed, Aug 2, 2017 at 7:06 PM, Ján Tomko &lt;jtomko@redhat.com&gt; wrote:

&gt; On Wed, Aug 02, 2017 at 05:47:31PM +0300, Fred Rolland wrote:
&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; I am working on oVirt, and I am trying to run a VM with a network disk
&gt;&gt; with
&gt;&gt; ISCSI protocol ( the storage is on a Cinder server).
&gt;&gt;
&gt;&gt; Here is the disk XML I use:
&gt;&gt;
&gt;&gt;        &lt;disk device="disk" snapshot="no" type="network"&gt;
&gt;&gt;            &lt;address bus="0" controller="0" target="0" type="drive"
&gt;&gt; unit="0" /&gt;
&gt;&gt;            &lt;source
&gt;&gt; name="iqn.2010-10.org.openstack:volume-37fea687-040c-4a88-
&gt;&gt; 844c-117d1a90e9b2"
&gt;&gt; protocol="iscsi"&gt;
&gt;&gt;                &lt;host name="10.35.0.20" port="3260" /&gt;
&gt;&gt;            &lt;/source&gt;
&gt;&gt;            &lt;target bus="scsi" dev="sda" /&gt;
&gt;&gt;            &lt;boot order="1" /&gt;
&gt;&gt;            &lt;driver cache="none" error_policy="stop" io="threads"
&gt;&gt; name="qemu" type="raw" /&gt;
&gt;&gt;        &lt;/disk&gt;
&gt;&gt;
&gt;&gt; I get the following error:
&gt;&gt;
&gt;&gt; libvirtError: internal error: process exited while connecting to monitor:
&gt;&gt; 2017-08-02T14:38:58.378430Z qemu-kvm: -drive file=iscsi://
&gt;&gt; 10.35.0.20:3260/iqn.2010-10.org.openstack%3Avolume-37fea687-
&gt;&gt; 040c-4a88-844c-117d1a90e9b2,format=raw,if=none,id=drive-
&gt;&gt; scsi0-0-0-0,cache=none,werror=stop,rerror=stop,aio=threads:
&gt;&gt; Failed to parse URL : iscsi://
&gt;&gt; 10.35.0.20:3260/iqn.2010-10.org.openstack%3Avolume-37fea687-
&gt;&gt; 040c-4a88-844c-117d1a90e9b2
&gt;&gt;
&gt;&gt; It seems that the ':' character got changed on the way to %3A.
&gt;&gt;
&gt;&gt; Any suggestions on the root cause of this issue?
&gt;&gt;
&gt;&gt;
&gt; The name seems to be missing the LUN. Even though our documentation
&gt; states:
&gt;  If not specified, the default LUN is zero.
&gt; http://libvirt.org/formatdomain.html#elementsDisks
&gt;
&gt; Maybe something changed in QEMU or libiscsi since that document was
&gt; written?
&gt;
&gt; Jan
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;Thanks, it was the issue.&lt;br&gt;&lt;/div&gt;I guess the documentation \
should be updated.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Thank you for your help !&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;On Wed, Aug 2, 2017 at 7:06 PM, Ján \
Tomko &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:jtomko@redhat.com" \
target="_blank"&gt;jtomko@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div class="HOEnZb"&gt;&lt;div class="h5"&gt;On Wed, Aug 02, 2017 at \
05:47:31PM +0300, Fred Rolland wrote:&lt;br&gt; &lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt; Hi,&lt;br&gt;
&lt;br&gt;
I am working on oVirt, and I am trying to run a VM with a network disk with&lt;br&gt;
ISCSI protocol ( the storage is on a Cinder server).&lt;br&gt;
&lt;br&gt;
Here is the disk XML I use:&lt;br&gt;
&lt;br&gt;
           &lt;disk device="disk" snapshot="no" \
                type="network"&gt;&lt;br&gt;
                 &lt;address bus="0" controller="0" \
target="0" type="drive"&lt;br&gt; unit="0" /&gt;&lt;br&gt;
                 &lt;source&lt;br&gt;
name="&lt;a href="http://iqn.2010-10.org" \
target="_blank"&gt;iqn.2010-10.org&lt;/a&gt;.openstac&lt;wbr&gt;k:volume-37fea687-040c-4a88-&lt;wbr&gt;844c-117d1a90e9b2"&lt;br&gt;
 protocol="iscsi"&gt;&lt;br&gt;
                       &lt;host name="10.35.0.20" port="3260" \
/&gt;&lt;br&gt;  &lt;/source&gt;&lt;br&gt;
                 &lt;target bus="scsi" dev="sda" /&gt;&lt;br&gt;
                 &lt;boot order="1" /&gt;&lt;br&gt;
                 &lt;driver cache="none" error_policy="stop" \
io="threads"&lt;br&gt; name="qemu" type="raw" /&gt;&lt;br&gt;
           &lt;/disk&gt;&lt;br&gt;
&lt;br&gt;
I get the following error:&lt;br&gt;
&lt;br&gt;
libvirtError: internal error: process exited while connecting to monitor:&lt;br&gt;
2017-08-02T14:38:58.378430Z qemu-kvm: -drive file=iscsi://&lt;br&gt;
&lt;a href="http://10.35.0.20:3260/iqn.2010-10.org.openstack%3Avolume-37fea687-040c-4a88- \
844c-117d1a90e9b2,format=raw,if=none,id=drive-scsi0-0-0-0,cache=none,werror=stop,rerror=stop,aio=threads" \
rel="noreferrer" target="_blank"&gt;10.35.0.20:3260/iqn.2010-10.or&lt;wbr&gt;g.openstack%3Avolu \
me-37fea687-&lt;wbr&gt;040c-4a88-844c-117d1a90e9b2,&lt;wbr&gt;format=raw,if=none,id=drive-&lt;wbr&gt;scsi0-0-0-0,cache=none,werror=&lt;wbr&gt;stop,rerror=stop,aio=threads&lt;/a&gt;:&lt;br&gt;
 Failed to parse URL : iscsi://&lt;br&gt;
&lt;a href="http://10.35.0.20:3260/iqn.2010-10.org.openstack%3Avolume-37fea687-040c-4a88-844c-117d1a90e9b2" \
rel="noreferrer" target="_blank"&gt;10.35.0.20:3260/iqn.2010-10.or&lt;wbr&gt;g.openstack%3Avolume-37fea687-&lt;wbr&gt;040c-4a88-844c-117d1a90e9b2&lt;/a&gt;&lt;br&gt;
 &lt;br&gt;
It seems that the ':' character got changed on the way to %3A.&lt;br&gt;
&lt;br&gt;
Any suggestions on the root cause of this issue?&lt;br&gt;
&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;&lt;/div&gt;&lt;/div&gt;
The name seems to be missing the LUN. Even though our documentation&lt;br&gt;
states:&lt;br&gt;
  If not specified, the default LUN is zero.&lt;br&gt;
&lt;a href="http://libvirt.org/formatdomain.html#elementsDisks" rel="noreferrer" \
target="_blank"&gt;http://libvirt.org/formatdomai&lt;wbr&gt;n.html#elementsDisks&lt;/a&gt;&lt;br&gt; &lt;br&gt;
Maybe something changed in QEMU or libiscsi since that document was&lt;br&gt;
written?&lt;br&gt;
&lt;br&gt;
Jan&lt;br&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170802203804</emailId><senderName>Arnabjyoti Kalita</senderName><senderEmail>akalita@cs.stonybrook.edu</senderEmail><timestampReceived>2017-08-02 20:38:04-0400</timestampReceived><subject>Re: [libvirt-users] Understanding the contents of virsh dump --memory-only</subject><body>

Hi Martin,

Thanks for your answer!
I had 7 PT_LOAD segments -- each of which are being shown above in my
formatted readelf output. All of the 7 PT_LOAD segments had a virtual
address of 0 and some 4 KB aligned physical address.
Anyway I will try to ask the same query in the QEMU mailing list.

On Wed, Aug 2, 2017 at 7:55 AM, Martin Kletzander &lt;mkletzan@redhat.com&gt;
wrote:

&gt; On Tue, Aug 01, 2017 at 10:22:43PM -0400, Arnabjyoti Kalita wrote:
&gt;
&gt;&gt; Hello,
&gt;&gt;
&gt;&gt; I was trying to understand the ELF file generated by the virsh dump
&gt;&gt; (--memory-only) command. I have successfully generated a dump of the VM
&gt;&gt; memory using this command.
&gt;&gt;
&gt;&gt;
&gt; You are running a QEMU machine and the dump is generated by qemu, so
&gt; they would be able to explain to much further detail, I'm sure.  Anyway,
&gt; here goes my try.
&gt;
&gt; I specifically am trying to understand the loadable segments of this ELF
&gt;&gt; file.
&gt;&gt;
&gt;&gt; I ran readelf -a &lt;filename&gt; to get the information that I need. Below
&gt;&gt; shows
&gt;&gt; the details of the loadable segments in a much better format :-
&gt;&gt;
&gt;&gt; Loading ELF header #1. offset: 1320 filesize: 655360 memsize: 655360
&gt;&gt; vaddr:
&gt;&gt; 0 paddr: 0 align: 0 flags: 0
&gt;&gt; Loading ELF header #2. offset: 656680 filesize: 65536 memsize: 65536
&gt;&gt; vaddr:
&gt;&gt; 0 paddr: a0000 align: 0 flags: 0
&gt;&gt; Loading ELF header #3. offset: 722216 filesize: 1072955392 memsize:
&gt;&gt; 1072955392 vaddr: 0 paddr: c0000 align: 0 flags: 0
&gt;&gt; Loading ELF header #4. offset: 1073677608 filesize: 67108864 memsize:
&gt;&gt; 67108864 vaddr: 0 paddr: f4000000 align: 0 flags: 0
&gt;&gt; Loading ELF header #5. offset: 1140786472 filesize: 67108864 memsize:
&gt;&gt; 67108864 vaddr: 0 paddr: f8000000 align: 0 flags: 0
&gt;&gt; Loading ELF header #6. offset: 1207895336 filesize: 8192 memsize: 8192
&gt;&gt; vaddr: 0 paddr: fc054000 align: 0 flags: 0
&gt;&gt; Loading ELF header #7. offset: 1207903528 filesize: 262144 memsize: 262144
&gt;&gt; vaddr: 0 paddr: fffc0000 align: 0 flags: 0
&gt;&gt;
&gt;&gt;
&gt; Just to be clear, this is the memory of the machine with kernel and
&gt; several other things loaded.  I'm not sure what are all the segments,
&gt; but since the dump acts as something you can use to debug the guest OS
&gt; using the crash utility, which is somehow enhanced gdb for this purpose,
&gt; IIRC, then I guess it's the MMU mapping of everything in the guest OS.
&gt;
&gt; I wanted to know why in this case, is the virtual address (denoted by
&gt;&gt; vaddr) 0 for each of the loadable segments ? Will it be okay if I load the
&gt;&gt; elf file taking the values of physical address (denoted by paddr) into
&gt;&gt; account ?
&gt;&gt;
&gt;&gt;
&gt; My guess is that those are the addresses from the MMU.  Each segment has
&gt; it's own vaddr &lt;-&gt; paddr mapping.
&gt;
&gt; Specifically after loading the file, can I be certain that all of my
&gt;&gt; contents will have been loaded into memory address starting from 0 ? Will
&gt;&gt; the loaded contents be present in the exact location as specified (by
&gt;&gt; paddr) here ?
&gt;&gt;
&gt;&gt;
&gt; It depends on what you mean by loading.  You wouldn't be starting that
&gt; binary as any other program, it's rather a dump as you would have with a
&gt; coredump.  Physical address is probably just the location in the guest
&gt; machine, so the thing with paddr 0 would be seabios or something
&gt; BIOS-related, etc.
&gt;
&gt; If you want precise answers and not guesses, I would suggest the qemu
&gt; mailing list or any other related list.  libvirt is not the best choice
&gt; here unless someone from the other communities replies here.
&gt;
&gt; HTH,
&gt; Martin
&gt;
&gt; Thanks and Regards.
&gt;&gt; Arnab
&gt;&gt;
&gt;
&gt; _______________________________________________
&gt;&gt; libvirt-users mailing list
&gt;&gt; libvirt-users@redhat.com
&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;Hi Martin,&lt;br&gt;&lt;br&gt;&lt;/div&gt;Thanks for your answer! &lt;br&gt;I had 7 \
PT_LOAD segments -- each of which are being shown above in my formatted readelf \
output. All of the 7 PT_LOAD segments had a virtual address of 0 and some 4 KB \
aligned physical address.&lt;br&gt;Anyway I will try to ask the same query in the QEMU \
mailing list. &lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;On Wed, \
Aug 2, 2017 at 7:55 AM, Martin Kletzander &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:mkletzan@redhat.com" target="_blank"&gt;mkletzan@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; \
wrote:&lt;br&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px \
#ccc solid;padding-left:1ex"&gt;&lt;span class=""&gt;On Tue, Aug 01, 2017 at 10:22:43PM -0400, \
Arnabjyoti Kalita wrote:&lt;br&gt; &lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt; Hello,&lt;br&gt;
&lt;br&gt;
I was trying to understand the ELF file generated by the virsh dump&lt;br&gt;
(--memory-only) command. I have successfully generated a dump of the VM&lt;br&gt;
memory using this command.&lt;br&gt;
&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;&lt;/span&gt;
You are running a QEMU machine and the dump is generated by qemu, so&lt;br&gt;
they would be able to explain to much further detail, I'm sure.   Anyway,&lt;br&gt;
here goes my try.&lt;span class=""&gt;&lt;br&gt;
&lt;br&gt;
&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt; I specifically am trying to understand the loadable segments \
of this ELF&lt;br&gt; file.&lt;br&gt;
&lt;br&gt;
I ran readelf -a &lt;filename&gt; to get the information that I need. Below shows&lt;br&gt;
the details of the loadable segments in a much better format :-&lt;br&gt;
&lt;br&gt;
Loading ELF header #1. offset: 1320 filesize: 655360 memsize: 655360 vaddr:&lt;br&gt;
0 paddr: 0 align: 0 flags: 0&lt;br&gt;
Loading ELF header #2. offset: 656680 filesize: 65536 memsize: 65536 vaddr:&lt;br&gt;
0 paddr: a0000 align: 0 flags: 0&lt;br&gt;
Loading ELF header #3. offset: 722216 filesize: 1072955392 memsize:&lt;br&gt;
1072955392 vaddr: 0 paddr: c0000 align: 0 flags: 0&lt;br&gt;
Loading ELF header #4. offset: 1073677608 filesize: 67108864 memsize:&lt;br&gt;
67108864 vaddr: 0 paddr: f4000000 align: 0 flags: 0&lt;br&gt;
Loading ELF header #5. offset: 1140786472 filesize: 67108864 memsize:&lt;br&gt;
67108864 vaddr: 0 paddr: f8000000 align: 0 flags: 0&lt;br&gt;
Loading ELF header #6. offset: 1207895336 filesize: 8192 memsize: 8192&lt;br&gt;
vaddr: 0 paddr: fc054000 align: 0 flags: 0&lt;br&gt;
Loading ELF header #7. offset: 1207903528 filesize: 262144 memsize: 262144&lt;br&gt;
vaddr: 0 paddr: fffc0000 align: 0 flags: 0&lt;br&gt;
&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;&lt;/span&gt;
Just to be clear, this is the memory of the machine with kernel and&lt;br&gt;
several other things loaded.   I'm not sure what are all the segments,&lt;br&gt;
but since the dump acts as something you can use to debug the guest OS&lt;br&gt;
using the crash utility, which is somehow enhanced gdb for this purpose,&lt;br&gt;
IIRC, then I guess it's the MMU mapping of everything in the guest OS.&lt;span \
class=""&gt;&lt;br&gt; &lt;br&gt;
&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt; I wanted to know why in this case, is the virtual address \
(denoted by&lt;br&gt; vaddr) 0 for each of the loadable segments ? Will it be okay if I \
load the&lt;br&gt; elf file taking the values of physical address (denoted by paddr) \
into&lt;br&gt; account ?&lt;br&gt;
&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;&lt;/span&gt;
My guess is that those are the addresses from the MMU.   Each segment has&lt;br&gt;
it's own vaddr &lt;-&gt; paddr mapping.&lt;span class=""&gt;&lt;br&gt;
&lt;br&gt;
&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt; Specifically after loading the file, can I be certain that \
all of my&lt;br&gt; contents will have been loaded into memory address starting from 0 ? \
Will&lt;br&gt; the loaded contents be present in the exact location as specified (by&lt;br&gt;
paddr) here ?&lt;br&gt;
&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;&lt;/span&gt;
It depends on what you mean by loading.   You wouldn't be starting that&lt;br&gt;
binary as any other program, it's rather a dump as you would have with a&lt;br&gt;
coredump.   Physical address is probably just the location in the guest&lt;br&gt;
machine, so the thing with paddr 0 would be seabios or something&lt;br&gt;
BIOS-related, etc.&lt;br&gt;
&lt;br&gt;
If you want precise answers and not guesses, I would suggest the qemu&lt;br&gt;
mailing list or any other related list.   libvirt is not the best choice&lt;br&gt;
here unless someone from the other communities replies here.&lt;br&gt;
&lt;br&gt;
HTH,&lt;br&gt;
Martin&lt;br&gt;
&lt;br&gt;
&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt; Thanks and Regards.&lt;br&gt;
Arnab&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;
&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt; ______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt; \
&lt;/blockquote&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170803110851</emailId><senderName>Marko Weber</senderName><senderEmail>weber@zbfmail.de</senderEmail><timestampReceived>2017-08-03 11:08:51-0400</timestampReceived><subject>Re: [libvirt-users] creating new vm with virt-manager, existing disk failure</subject><body>


Hi pavel,

Am 2017-07-19 14:01, schrieb Pavel Hrdina:
&gt; On Wed, Jul 19, 2017 at 11:45:36AM +0200, Marko Weber | 8000 wrote:
&gt;&gt; 
&gt;&gt; hello,
&gt;&gt; i rsynced a kvm vm from one host to another.
&gt;&gt; i start virt-manager and tell virt-manager to use an existing disk.
&gt;&gt; i set cpu to haswell that is on the host.
&gt;&gt; 
&gt;&gt; configure before start is set, and i start "begin installation".
&gt;&gt; I get this output by virt-manager:
&gt;&gt; 
&gt;&gt; Unable to complete install: 'internal error: process exited while
&gt;&gt; connecting to monitor: 2017-07-19T09:27:10.861928Z qemu-system-x86_64:
&gt;&gt; can't apply global Haswell-x86_64-cpu.cmt=on: Property '.cmt' not 
&gt;&gt; found'
&gt;&gt; 
&gt;&gt; Traceback (most recent call last):
&gt;&gt;    File "/usr/share/virt-manager/virtManager/asyncjob.py", line 88, in
&gt;&gt; cb_wrapper
&gt;&gt;      callback(asyncjob, *args, **kwargs)
&gt;&gt;    File "/usr/share/virt-manager/virtManager/create.py", line 2288, in
&gt;&gt; _do_async_install
&gt;&gt;      guest.start_install(meter=meter)
&gt;&gt;    File "/usr/share/virt-manager/virtinst/guest.py", line 477, in
&gt;&gt; start_install
&gt;&gt;      doboot, transient)
&gt;&gt;    File "/usr/share/virt-manager/virtinst/guest.py", line 405, in
&gt;&gt; _create_guest
&gt;&gt;      self.domain.create()
&gt;&gt;    File "/usr/lib64/python2.7/site-packages/libvirt.py", line 1062, in
&gt;&gt; create
&gt;&gt;      if ret == -1: raise libvirtError ('virDomainCreate() failed',
&gt;&gt; dom=self)
&gt;&gt; libvirtError: internal error: process exited while connecting to
&gt;&gt; monitor: 2017-07-19T09:27:10.861928Z qemu-system-x86_64: can't apply
&gt;&gt; global Haswell-x86_64-cpu.cmt=on: Property '.cmt' not found
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; try to set it to another cpu and clicking start, i get this:
&gt;&gt; 
&gt;&gt; Unable to complete install: 'Domain has already been started!'
&gt;&gt; 
&gt;&gt; Traceback (most recent call last):
&gt;&gt;    File "/usr/share/virt-manager/virtManager/asyncjob.py", line 88, in
&gt;&gt; cb_wrapper
&gt;&gt;      callback(asyncjob, *args, **kwargs)
&gt;&gt;    File "/usr/share/virt-manager/virtManager/create.py", line 2288, in
&gt;&gt; _do_async_install
&gt;&gt;      guest.start_install(meter=meter)
&gt;&gt;    File "/usr/share/virt-manager/virtinst/guest.py", line 455, in
&gt;&gt; start_install
&gt;&gt;      raise RuntimeError(_("Domain has already been started!"))
&gt;&gt; RuntimeError: Domain has already been started!
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; how do i stop the already runing vm? virsh list dont show the vm
&gt;&gt; and why do i get the error on haswell?
&gt; 
&gt; Hi, this is actually a bug in virt-manager which was fixed in upstream
&gt; by these commits:
&gt; 
&gt;     2099a1946e22b62d31b954dc3e7b813404c2d019
&gt;     93085d2b9d4a3dd6cbb9edfeae9b6cefee9419c1
&gt;     8181e8609867fe6ed101e48212d42a1c38373539
&gt; 
&gt; To work-around this issue cancel the installation and start it again.
&gt; There is no official release of virt-manager with that fix included, we
&gt; should probably make the release.
&gt; 
&gt; Pavel

can you tell me if this problem is solved in the time?
We need this way to migrate machines. Or is it not planned to fix this 
bug?


kind regards
marko

</body></email><email><emailId>20170807120736</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-08-07 12:07:36-0400</timestampReceived><subject>Re: [libvirt-users] Avoiding console prints by Libvirt Qemu python APIs</subject><body>

On Mon, Aug 07, 2017 at 01:15:45PM +0530, swaroop sp wrote:
&gt; Hi,
&gt; 
&gt; I am trying to check if a domain exists by using the libvirt python API
&gt; *"lookupbyname()*". If the domain does not exist, it prints an error
&gt; message on the console saying "*Domain not found*".
&gt; 
&gt; I need the errors or logs only in syslog. I have tried redirecting stderr
&gt; and stdout. But, it doesn't have any effect. I have also tried playing
&gt; around with the libvirt logging settings described in
&gt; https://libvirt.org/logging.html . No effect again. "stdio_handler" flag in
&gt; /etc/libvirt/qemu.conf is set to "file" as well.
&gt; 
&gt; Following is my test code:
&gt; 
&gt; import os, sysimport libvirt
&gt; conn = libvirt.open('qemu:///system')
&gt; # Find the application in the virsh domaintry:
&gt;     sys.stdout = open(os.devnull, "w")
&gt;     sys.stderr = open(os.devnull, "w")
&gt;     dom = conn.lookupByName('abcd')
&gt;     sys.stdout = sys.__stdout__
&gt;     sys.stderr = sys.__stderr__except Exception as e:
&gt;     syslog.syslog (syslog.LOG_ERR, 'Could not find the domain. ERROR:
&gt; %s.' % (e))
&gt;     sys.stdout = sys.__stdout__
&gt;     sys.stderr = sys.__stderr__
&gt; 
&gt; Output:
&gt; 
&gt; $ python test.py
&gt; libvirt: QEMU Driver error : Domain not found: no domain with matching
&gt; name 'abcd'
&gt; $
&gt; 
&gt; Is there a way to avoid this console print?

Use this:

def libvirt_callback(userdata, err):
    pass

libvirt.registerErrorHandler(f=libvirt_callback, ctx=None)

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170802144731</emailId><senderName>Fred Rolland</senderName><senderEmail>frolland@redhat.com</senderEmail><timestampReceived>2017-08-02 14:47:31-0400</timestampReceived><subject>[libvirt-users] Libvirt fails on network disk with ISCSI protocol</subject><body>

Hi,

I am working on oVirt, and I am trying to run a VM with a network disk with
ISCSI protocol ( the storage is on a Cinder server).

Here is the disk XML I use:

        &lt;disk device="disk" snapshot="no" type="network"&gt;
            &lt;address bus="0" controller="0" target="0" type="drive"
unit="0" /&gt;
            &lt;source
name="iqn.2010-10.org.openstack:volume-37fea687-040c-4a88-844c-117d1a90e9b2"
protocol="iscsi"&gt;
                &lt;host name="10.35.0.20" port="3260" /&gt;
            &lt;/source&gt;
            &lt;target bus="scsi" dev="sda" /&gt;
            &lt;boot order="1" /&gt;
            &lt;driver cache="none" error_policy="stop" io="threads"
name="qemu" type="raw" /&gt;
        &lt;/disk&gt;

I get the following error:

libvirtError: internal error: process exited while connecting to monitor:
2017-08-02T14:38:58.378430Z qemu-kvm: -drive file=iscsi://
10.35.0.20:3260/iqn.2010-10.org.openstack%3Avolume-37fea687-040c-4a88-844c-117d1a90e9b \
2,format=raw,if=none,id=drive-scsi0-0-0-0,cache=none,werror=stop,rerror=stop,aio=threads:
 Failed to parse URL : iscsi://
10.35.0.20:3260/iqn.2010-10.org.openstack%3Avolume-37fea687-040c-4a88-844c-117d1a90e9b2


It seems that the ':' character got changed on the way to %3A.

Any suggestions on the root cause of this issue?

Thanks,

Fred Rolland


[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hi,&lt;br&gt;&lt;br&gt;&lt;/div&gt;I am working on oVirt, and I am trying \
to run a VM with a network disk with ISCSI protocol ( the storage is on a Cinder \
server).&lt;br&gt;&lt;br&gt;&lt;/div&gt;Here is the disk XML I use:&lt;br&gt;&lt;br&gt;               &lt;disk \
device="disk" snapshot="no" type="network"&gt;&lt;br&gt;      \
&lt;address bus="0" controller="0" target="0" \
type="drive" unit="0" /&gt;&lt;br&gt;                       &lt;source \
name="iqn.2010-10.org.openstack:volume-37fea687-040c-4a88-844c-117d1a90e9b2" \
protocol="iscsi"&gt;&lt;br&gt;                               &lt;host \
name="10.35.0.20" port="3260" /&gt;&lt;br&gt;                       \
&lt;/source&gt;&lt;br&gt;                       &lt;target bus="scsi" \
dev="sda" /&gt;&lt;br&gt;                       &lt;boot order="1" \
/&gt;&lt;br&gt;                       &lt;driver cache="none" \
error_policy="stop" io="threads" name="qemu" \
type="raw" /&gt;&lt;br&gt;               &lt;/disk&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;I get the \
following error:&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;libvirtError: internal error: process \
exited while connecting to monitor: 2017-08-02T14:38:58.378430Z qemu-kvm: -drive \
file=iscsi://&lt;a href="http://10.35.0.20:3260/iqn.2010-10.org.openstack%3Avolume-37fea6 \
87-040c-4a88-844c-117d1a90e9b2,format=raw,if=none,id=drive-scsi0-0-0-0,cache=none,werr \
or=stop,rerror=stop,aio=threads"&gt;10.35.0.20:3260/iqn.2010-10.org.openstack%3Avolume-37 \
fea687-040c-4a88-844c-117d1a90e9b2,format=raw,if=none,id=drive-scsi0-0-0-0,cache=none,werror=stop,rerror=stop,aio=threads&lt;/a&gt;: \
Failed to parse URL : iscsi://&lt;a \
href="http://10.35.0.20:3260/iqn.2010-10.org.openstack%3Avolume-37fea687-040c-4a88-844 \
c-117d1a90e9b2"&gt;10.35.0.20:3260/iqn.2010-10.org.openstack%3Avolume-37fea687-040c-4a88-844c-117d1a90e9b2&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It \
seems that the ':' character got changed on the way to \
%3A.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Any suggestions on the root cause of this \
issue?&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Fred \
Rolland&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170802022243</emailId><senderName>Arnabjyoti Kalita</senderName><senderEmail>akalita@cs.stonybrook.edu</senderEmail><timestampReceived>2017-08-02 02:22:43-0400</timestampReceived><subject>[libvirt-users] Understanding the contents of virsh dump --memory-only</subject><body>

Hello,

I was trying to understand the ELF file generated by the virsh dump
(--memory-only) command. I have successfully generated a dump of the VM
memory using this command.

I specifically am trying to understand the loadable segments of this ELF
file.

I ran readelf -a &lt;filename&gt; to get the information that I need. Below shows
the details of the loadable segments in a much better format :-

Loading ELF header #1. offset: 1320 filesize: 655360 memsize: 655360 vaddr:
0 paddr: 0 align: 0 flags: 0
Loading ELF header #2. offset: 656680 filesize: 65536 memsize: 65536 vaddr:
0 paddr: a0000 align: 0 flags: 0
Loading ELF header #3. offset: 722216 filesize: 1072955392 memsize:
1072955392 vaddr: 0 paddr: c0000 align: 0 flags: 0
Loading ELF header #4. offset: 1073677608 filesize: 67108864 memsize:
67108864 vaddr: 0 paddr: f4000000 align: 0 flags: 0
Loading ELF header #5. offset: 1140786472 filesize: 67108864 memsize:
67108864 vaddr: 0 paddr: f8000000 align: 0 flags: 0
Loading ELF header #6. offset: 1207895336 filesize: 8192 memsize: 8192
vaddr: 0 paddr: fc054000 align: 0 flags: 0
Loading ELF header #7. offset: 1207903528 filesize: 262144 memsize: 262144
vaddr: 0 paddr: fffc0000 align: 0 flags: 0

I wanted to know why in this case, is the virtual address (denoted by
vaddr) 0 for each of the loadable segments ? Will it be okay if I load the
elf file taking the values of physical address (denoted by paddr) into
account ?

Specifically after loading the file, can I be certain that all of my
contents will have been loaded into memory address starting from 0 ? Will
the loaded contents be present in the exact location as specified (by
paddr) here ?

Thanks and Regards.
Arnab

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hello,&lt;br&gt;&lt;br&gt;&lt;/div&gt;I was trying to \
understand the ELF file generated by the virsh dump (--memory-only) command. I have \
successfully generated a dump of the VM memory using this command.&lt;br&gt;&lt;br&gt;&lt;/div&gt;I \
specifically am trying to understand the loadable segments of this ELF file. \
&lt;br&gt;&lt;br&gt;I ran readelf -a &lt;filename&gt; to get the information that I need. Below \
shows the details of the loadable segments in a much better format :-&lt;br&gt;&lt;br&gt;Loading \
ELF header #1. offset: 1320 filesize: 655360 memsize: 655360 vaddr: 0 paddr: 0 align: \
0 flags: 0&lt;br&gt;Loading ELF header #2. offset: 656680 filesize: 65536 memsize: 65536 \
vaddr: 0 paddr: a0000 align: 0 flags: 0&lt;br&gt;Loading ELF header #3. offset: 722216 \
filesize: 1072955392 memsize: 1072955392 vaddr: 0 paddr: c0000 align: 0 flags: \
0&lt;br&gt;Loading ELF header #4. offset: 1073677608 filesize: 67108864 memsize: 67108864 \
vaddr: 0 paddr: f4000000 align: 0 flags: 0&lt;br&gt;Loading ELF header #5. offset: \
1140786472 filesize: 67108864 memsize: 67108864 vaddr: 0 paddr: f8000000 align: 0 \
flags: 0&lt;br&gt;Loading ELF header #6. offset: 1207895336 filesize: 8192 memsize: 8192 \
vaddr: 0 paddr: fc054000 align: 0 flags: 0&lt;br&gt;Loading ELF header #7. offset: \
1207903528 filesize: 262144 memsize: 262144 vaddr: 0 paddr: fffc0000 align: 0 flags: \
0&lt;br&gt;&lt;br&gt;&lt;/div&gt;I wanted to know why in this case, is the virtual address (denoted by \
vaddr) 0 for each of the loadable segments ? Will it be okay if I load the elf file \
taking the values of physical address (denoted by paddr) into account \
?&lt;br&gt;&lt;br&gt;&lt;/div&gt;Specifically after loading the file, can I be certain that all of my \
contents will have been loaded into memory address starting from 0 ? Will the loaded \
contents be present in the exact location as specified (by paddr) here \
?&lt;br&gt;&lt;br&gt;&lt;/div&gt;Thanks and \
Regards.&lt;br&gt;&lt;/div&gt;Arnab&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170807075745</emailId><senderName>swaroop sp</senderName><senderEmail>naanuswaroop@gmail.com</senderEmail><timestampReceived>2017-08-07 07:57:45-0400</timestampReceived><subject>[libvirt-users] Avoiding console prints by Libvirt Qemu python APIs</subject><body>

Hi,

I am trying to check if a domain exists by using the libvirt python API
*"lookupbyname()*". If the domain does not exist, it prints an error
message on the console saying "*Domain not found*".

I need the errors or logs only in syslog. I have tried redirecting stderr
and stdout. But, it doesn't have any effect. I have also tried playing
around with the libvirt logging settings described in
https://libvirt.org/logging.html . No effect again. "stdio_handler" flag in
/etc/libvirt/qemu.conf is set to "file" as well.

Following is my test code:

import os, sysimport libvirt
conn = libvirt.open('qemu:///system')
# Find the application in the virsh domaintry:
    sys.stdout = open(os.devnull, "w")
    sys.stderr = open(os.devnull, "w")
    dom = conn.lookupByName('abcd')
    sys.stdout = sys.__stdout__
    sys.stderr = sys.__stderr__except Exception as e:
    syslog.syslog (syslog.LOG_ERR, 'Could not find the domain. ERROR:
%s.' % (e))
    sys.stdout = sys.__stdout__
    sys.stderr = sys.__stderr__

Output:

$ python test.py
libvirt: QEMU Driver error : Domain not found: no domain with matching
name 'abcd'
$

Is there a way to avoid this console print?


Regards,

Swaroop

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;p style="margin:0px 0px \
1em;padding:0px;border:0px;font-variant-numeric:inherit;font-stretch:inherit;font-size:15px;line-height:inherit;font-family:Arial,"Helvetica \
Neue",Helvetica,sans-serif;vertical-align:baseline;clear:both;color:rgb(36,39,41)"&gt;Hi,&lt;/p&gt;&lt;p \
style="margin:0px 0px \
1em;padding:0px;border:0px;font-variant-numeric:inherit;font-stretch:inherit;font-size:15px;line-height:inherit;font-family:Arial,"Helvetica \
Neue",Helvetica,sans-serif;vertical-align:baseline;clear:both;color:rgb(36,39,41)"&gt;I \
am trying to check if a domain exists by using the libvirt python API  &lt;strong \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline"&gt;"lookupbyname()&lt;/strong&gt;". \
If the domain does not exist, it prints an error message on the console saying \
"&lt;strong style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant \
:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline"&gt;Domain \
not found&lt;/strong&gt;".  &lt;/p&gt;&lt;p style="margin:0px 0px \
1em;padding:0px;border:0px;font-variant-numeric:inherit;font-stretch:inherit;font-size:15px;line-height:inherit;font-family:Arial,"Helvetica \
Neue",Helvetica,sans-serif;vertical-align:baseline;clear:both;color:rgb(36,39,41)"&gt;I \
need the errors or logs only in syslog. I have tried redirecting stderr and stdout. \
But, it doesn't have any effect. I have also tried playing around with the \
libvirt logging settings described in  &lt;a href="https://libvirt.org/logging.html" \
rel="nofollow noreferrer" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family: \
inherit;vertical-align:baseline;color:rgb(0,89,153);text-decoration-line:none"&gt;https://libvirt.org/logging.html&lt;/a&gt; \
. No effect again. "stdio_handler" flag in /etc/libvirt/qemu.conf is set to \
"file" as well.&lt;/p&gt;&lt;p style="margin:0px 0px \
1em;padding:0px;border:0px;font-variant-numeric:inherit;font-stretch:inherit;font-size:15px;line-height:inherit;font-family:Arial,"Helvetica \
Neue",Helvetica,sans-serif;vertical-align:baseline;clear:both;color:rgb(36,39,41)"&gt;Following \
is my test code:&lt;/p&gt;&lt;pre class="gmail-lang-py gmail-prettyprint gmail-prettyprinted" \
style="margin-top:0px;margin-bottom:1em;padding:5px;border:0px;font-variant-numeric:in \
herit;font-stretch:inherit;font-size:13px;line-height:inherit;font-family:Consolas,Menlo,Monaco,"Lucida \
Console","Liberation Mono","DejaVu Sans \
Mono","Bitstream Vera Sans Mono","Courier \
New",monospace,sans-serif;vertical-align:baseline;width:auto;max-height:600px;ove \
rflow:auto;background-color:rgb(239,240,241);color:rgb(57,51,24);word-wrap:normal"&gt;&lt;code \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;line-height:inherit;font-family:Consolas,Menlo,Monaco,"Lucida \
Console","Liberation Mono","DejaVu Sans \
Mono","Bitstream Vera Sans Mono","Courier \
New",monospace,sans-serif;vertical-align:baseline;white-space:inherit"&gt;&lt;span \
class="gmail-kwd" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(16,16,148)"&gt;import&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
os&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;,&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
sys &lt;/span&gt;&lt;span class="gmail-kwd" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(16,16,148)"&gt;import&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
libvirt conn &lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;=&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
libvirt&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;.&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;open&lt;/span&gt;&lt;span \
class="gmail-pun" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;(&lt;/span&gt;&lt;span \
class="gmail-str" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(125,39,39)"&gt;'qemu:///system'&lt;/span&gt;&lt;span \
class="gmail-pun" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;)&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;


&lt;/span&gt;&lt;span class="gmail-com" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(133,140,147)"&gt;# \
Find the application in the virsh domain&lt;/span&gt;&lt;span class="gmail-pln" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;
 &lt;/span&gt;&lt;span class="gmail-kwd" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(16,16,148)"&gt;try&lt;/span&gt;&lt;span \
class="gmail-pun" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;:&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;
  sys&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;.&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;stdout \
&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;=&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
open&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;(&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;os&lt;/span&gt;&lt;span \
class="gmail-pun" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;.&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;devnull&lt;/span&gt;&lt;span \
class="gmail-pun" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;,&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
&lt;/span&gt;&lt;span class="gmail-str" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(125,39,39)"&gt;"w"&lt;/span&gt;&lt;span \
class="gmail-pun" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;)&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;
  sys&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;.&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;stderr \
&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;=&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
open&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;(&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;os&lt;/span&gt;&lt;span \
class="gmail-pun" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;.&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;devnull&lt;/span&gt;&lt;span \
class="gmail-pun" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;,&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
&lt;/span&gt;&lt;span class="gmail-str" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(125,39,39)"&gt;"w"&lt;/span&gt;&lt;span \
class="gmail-pun" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;)&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;
  dom &lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;=&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
conn&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;.&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;lookupByName&lt;/span&gt;&lt;span \
class="gmail-pun" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;(&lt;/span&gt;&lt;span \
class="gmail-str" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(125,39,39)"&gt;'abcd'&lt;/span&gt;&lt;span \
class="gmail-pun" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;)&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;
  sys&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;.&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;stdout \
&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;=&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
sys&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;.&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;__stdout__  \
sys&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;.&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;stderr \
&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;=&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
sys&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;.&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;__stderr__ \
&lt;/span&gt;&lt;span class="gmail-kwd" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(16,16,148)"&gt;except&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
&lt;/span&gt;&lt;span class="gmail-typ" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(43,145,175)"&gt;Exception&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
&lt;/span&gt;&lt;span class="gmail-kwd" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(16,16,148)"&gt;as&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
e&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;:&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;
  syslog&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;.&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;syslog \
&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;(&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;syslog&lt;/span&gt;&lt;span \
class="gmail-pun" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;.&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;LOG_ERR&lt;/span&gt;&lt;span \
class="gmail-pun" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;,&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
&lt;/span&gt;&lt;span class="gmail-str" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(125,39,39)"&gt;'Could \
not find the domain. ERROR: %s.'&lt;/span&gt;&lt;span class="gmail-pln" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;%&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;(&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;e&lt;/span&gt;&lt;span \
class="gmail-pun" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;))&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;
    sys&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;.&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;stderr \
&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;=&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
sys&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;.&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:in \
herit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;__stderr__&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p \
style="margin:0px 0px \
1em;padding:0px;border:0px;font-variant-numeric:inherit;font-stretch:inherit;font-size:15px;line-height:inherit;font-family:Arial,"Helvetica \
Neue",Helvetica,sans-serif;vertical-align:baseline;clear:both;color:rgb(36,39,41)"&gt;Output:&lt;/p&gt;&lt;pre \
class="gmail-lang-py gmail-prettyprint gmail-prettyprinted" \
style="margin-top:0px;margin-bottom:1em;padding:5px;border:0px;font-variant-numeric:in \
herit;font-stretch:inherit;font-size:13px;line-height:inherit;font-family:Consolas,Menlo,Monaco,"Lucida \
Console","Liberation Mono","DejaVu Sans \
Mono","Bitstream Vera Sans Mono","Courier \
New",monospace,sans-serif;vertical-align:baseline;width:auto;max-height:600px;ove \
rflow:auto;background-color:rgb(239,240,241);color:rgb(57,51,24);word-wrap:normal"&gt;&lt;code \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;line-height:inherit;font-family:Consolas,Menlo,Monaco,"Lucida \
Console","Liberation Mono","DejaVu Sans \
Mono","Bitstream Vera Sans Mono","Courier \
New",monospace,sans-serif;vertical-align:baseline;white-space:inherit"&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;$ \
python test&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;.&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;py
 libvirt&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;:&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
QEMU &lt;/span&gt;&lt;span class="gmail-typ" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(43,145,175)"&gt;Driver&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
error &lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;:&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
&lt;/span&gt;&lt;span class="gmail-typ" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(43,145,175)"&gt;Domain&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
&lt;/span&gt;&lt;span class="gmail-kwd" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(16,16,148)"&gt;not&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
found&lt;/span&gt;&lt;span class="gmail-pun" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;:&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
no domain &lt;/span&gt;&lt;span class="gmail-kwd" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(16,16,148)"&gt;with&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt; \
matching name &lt;/span&gt;&lt;span class="gmail-str" \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(125,39,39)"&gt;'abcd'&lt;/span&gt;&lt;span \
class="gmail-pln" style="margin:0px;padding:0px;border:0px;font-style:inherit;font-var \
iant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;line-height:inherit;font-family:inherit;vertical-align:baseline;color:rgb(48,51,54)"&gt;
 $&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style="margin:0px 0px \
1em;padding:0px;border:0px;font-variant-numeric:inherit;font-stretch:inherit;font-size:15px;line-height:inherit;font-family:Arial,"Helvetica \
Neue",Helvetica,sans-serif;vertical-align:baseline;clear:both;color:rgb(36,39,41)"&gt;Is \
there a way to avoid this console print?&lt;/p&gt;&lt;p style="margin:0px 0px \
1em;padding:0px;border:0px;font-variant-numeric:inherit;font-stretch:inherit;font-size:15px;line-height:inherit;font-family:Arial,"Helvetica \
Neue",Helvetica,sans-serif;vertical-align:baseline;clear:both;color:rgb(36,39,41)"&gt;&lt;br&gt;&lt;/p&gt;&lt;p \
style="margin:0px 0px \
1em;padding:0px;border:0px;font-variant-numeric:inherit;font-stretch:inherit;font-size:15px;line-height:inherit;font-family:Arial,"Helvetica \
Neue",Helvetica,sans-serif;vertical-align:baseline;clear:both;color:rgb(36,39,41)"&gt;Regards,&lt;/p&gt;&lt;p \
style="margin:0px 0px \
1em;padding:0px;border:0px;font-variant-numeric:inherit;font-stretch:inherit;font-size:15px;line-height:inherit;font-family:Arial,"Helvetica \
Neue",Helvetica,sans-serif;vertical-align:baseline;clear:both;color:rgb(36,39,41)"&gt;Swaroop&lt;/p&gt;&lt;/div&gt;




</body></email><email><emailId>20170809035354</emailId><senderName>netsurfed</senderName><senderEmail>zhuohaofan@126.com</senderEmail><timestampReceived>2017-08-09 03:53:54-0400</timestampReceived><subject>[libvirt-users] libvirt: XML-RPC error : Cannot write data: Broken pipe</subject><body>

[Attachment #2 (multipart/alternative)]

[Attachment #4 (text/plain)]

Hi all, 
I think it's a bug, when call virDomainGetState after "service libvirtd stop", I receive signal SIGPIPE.
I want to know how to avoid this problem? And Other interfaces will also encounter this problem£¿
Below the bt information:
Below some information about my hypervisor:
root@ubuntu-05:/datapool/zhuohf# virsh -v
3.4.0
root@ubuntu-05:/datapool/zhuohf# qemu-x86_64 -version
qemu-x86_64 version 2.9.0
Copyright (c) 2003-2017 Fabrice Bellard and the QEMU Project developers
[Attachment #5 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div&gt;Hi \
all, &lt;/div&gt;&lt;div&gt;I think it's a bug, when call virDomainGetState after \
"service libvirtd stop", I receive signal SIGPIPE.&lt;/div&gt;&lt;div&gt;I want to know how to \
avoid this problem? And Other interfaces will also encounter this \
problem£¿&lt;/div&gt;&lt;div&gt;&lt;pre style="width: 1076.34px;"&gt;Below the bt information:&lt;img \
src="cid:762d4b8e$1$15dc5209928$Coremail$zhuohaofan$126.com" orgwidth="1294" \
orgheight="466" data-image="1" style="font-family: Arial; width: 1294px; height: \
466px; border: none;"&gt;&lt;span style="font-family: Arial;"&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div&gt;&lt;pre \
style="width: 1076.34px;"&gt;Below some information about my hypervisor:&lt;/pre&gt;&lt;pre \
style="width: 1076.34px;"&gt;root@ubuntu-05:/datapool/zhuohf# virsh -v 3.4.0&lt;/pre&gt;&lt;pre \
style="width: 1076.34px;"&gt;root@ubuntu-05:/datapool/zhuohf# qemu-x86_64 -version \
qemu-x86_64 version 2.9.0 Copyright (c) 2003-2017 Fabrice Bellard and the QEMU \
Project developers&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;


["image.png" (image/png)]

</body></email><email><emailId>20170814064224</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-08-14 06:42:24-0400</timestampReceived><subject>[libvirt-users] virsh blockcommit fails regularily (was: virtual drive performance)</subject><body>

Hi,

a small update on this. We have migrated the virtualized host to use the
virtio drivers and now the drive performance is improved so that we can see
a constant transfer rate. Before it used to be the same rate but regularly
dropped to a few bytes/sec for a few seconds and then was fast again.

However we still observe that the following fails regularily:

$ virsh snapshot-create-as --domain domain --name backup --no-metadata
--atomic --disk-only --diskspec hda,snapshot=external
$ virsh blockcommit domain hda --active --pivot
error: failed to pivot job for disk hda
error: block copy still active: disk 'hda' not ready for pivot yet
Could not merge changes for disk hda of domain. VM may be in invalid state.

Then running the following in the morning succeeds and successfully pivotes
the snapshot into the base image while the vm is live:

$ virsh blockjob domain hda --abort
$ virsh blockcommit domain hda --active --pivot
Successfully pivoted

We run the backup process every day once and it failed on the following
days:

2017-07-07
2017-07-20
2017-07-27
2017-08-12
2017-08-14

Looking at this it roughly happens once a week and the guest from then on
writes into the snapshot backlog. That snapshot backlog file grows about
8gb every day and thus the issue always needs immediate attention.

Any ideas what could cause this issue? Is this a bug (race condition) of
`virsh blockcommit` that sometimes fails because it is invoked at the wrong
time?

Cheers,
Dominik

2017-07-07 9:21 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:

&gt; Of course the cronjob fails when trying to virsh blockcommit and not when
&gt; creating the snapshot, sorry for the noise.
&gt;
&gt; 2017-07-07 9:15 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; different day, same issue.. cronjob runs and fails:
&gt;&gt;
&gt;&gt; $ virsh snapshot-create-as --domain domain --name backup --no-metadata
&gt;&gt; --atomic --disk-only --diskspec hda,snapshot=external
&gt;&gt; error: failed to pivot job for disk hda
&gt;&gt; error: block copy still active: disk 'hda' not ready for pivot yet
&gt;&gt; Could not merge changes for disk hda of domain. VM may be in invalid
&gt;&gt; state.
&gt;&gt;
&gt;&gt; Then running the following in the morning succeeds and successfully
&gt;&gt; pivotes the snapshot into the base image while the vm is live:
&gt;&gt;
&gt;&gt; $ virsh blockjob domain hda --abort
&gt;&gt; $ virsh blockcommit domain hda --active --pivot
&gt;&gt; Successfully pivoted
&gt;&gt;
&gt;&gt; This need of manual interventions is becoming a tiring job..
&gt;&gt;
&gt;&gt; I someone else seeing the same issue or has an idea what the cause could
&gt;&gt; be?
&gt;&gt; Can I trust the output and is the base image really up to the latest
&gt;&gt; state?
&gt;&gt;
&gt;&gt; Cheers
&gt;&gt;
&gt;&gt; 2017-07-02 10:30 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;&gt;
&gt;&gt;&gt; Just a little catch-up. This time I was able to resolve the issue by
&gt;&gt;&gt; doing:
&gt;&gt;&gt;
&gt;&gt;&gt; virsh blockjob domain hda --abort
&gt;&gt;&gt; virsh blockcommit domain hda --active --pivot
&gt;&gt;&gt;
&gt;&gt;&gt; Last time I had to shut down the virtual machine and do this while being
&gt;&gt;&gt; offline.
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks Wang for your valuable input. As far as the memory goes, there's
&gt;&gt;&gt; plenty of head room:
&gt;&gt;&gt;
&gt;&gt;&gt; $ free -h
&gt;&gt;&gt;               total        used        free      shared  buff/cache
&gt;&gt;&gt; available
&gt;&gt;&gt; Mem:           7.8G        1.8G        407M        9.7M
&gt;&gt;&gt; 5.5G        5.5G
&gt;&gt;&gt; Swap:          8.0G        619M        7.4G
&gt;&gt;&gt;
&gt;&gt;&gt; 2017-07-02 10:26 GMT+02:00 王李明 &lt;wanglm@certusnet.com.cn&gt;:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; mybe this is because you physic host memory is small
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; then this will Causing instability of the virtual machine
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; But I'm just guessing
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; You can try to increase your memory
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Wang Liming
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; *发件人:* libvirt-users-bounces@redhat.com [mailto:libvirt-users-bounces@
&gt;&gt;&gt;&gt; redhat.com] *代表 *Dominik Psenner
&gt;&gt;&gt;&gt; *发送时间:* 2017年7月2日 16:22
&gt;&gt;&gt;&gt; *收件人:* libvirt-users@redhat.com
&gt;&gt;&gt;&gt; *主题:* Re: [libvirt-users] virtual drive performance
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi again,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; just today an issue I've thought to be resolved popped up again. We
&gt;&gt;&gt;&gt; backup the machine by doing:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; virsh snapshot-create-as --domain domain --name backup --no-metadata
&gt;&gt;&gt;&gt; --atomic --disk-only --diskspec hda,snapshot=external
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; # backup hda.qcow2
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; virsh blockcommit domain hda --active --pivot
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Every now and then this process fails with the following error message:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; error: failed to pivot job for disk hda
&gt;&gt;&gt;&gt; error: block copy still active: disk 'hda' not ready for pivot yet
&gt;&gt;&gt;&gt; Could not merge changes for disk hda of domain. VM may be in invalid
&gt;&gt;&gt;&gt; state.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I expect live backups are a great asset and should work. Is this a bug
&gt;&gt;&gt;&gt; that may relates also to the virtual drive performance issues we observe?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Cheers
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 2017-07-02 10:10 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; a small update on this. I just migrated the vm from the site to my
&gt;&gt;&gt;&gt; laptop and fired it up. The exact same xml configuration (except file paths
&gt;&gt;&gt;&gt; and such) starts up and bursts with 50Mb/s to 115Mb/s in the guest. This
&gt;&gt;&gt;&gt; allows only one reasonable answer: the cpu on my laptop is somehow better
&gt;&gt;&gt;&gt; suited to emulate IO than the CPU built into the host on site. The host
&gt;&gt;&gt;&gt; there is a HP proliant microserver gen8 with xeon processor. But the
&gt;&gt;&gt;&gt; processor there is also never capped at 100% when the guest copies files.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I just ran another test by copying a 3Gb large file on the guest. What
&gt;&gt;&gt;&gt; I can observe on my computer is that the copy process is not at a constant
&gt;&gt;&gt;&gt; rate but rather starts with 90Mb/s, then drops down to 30Mb/s, goes up to
&gt;&gt;&gt;&gt; 70Mb/s, drops down to 1Mb/s, goes up to 75Mb/s, drops to 1Mb/s, goes up to
&gt;&gt;&gt;&gt; 55Mb/s and the pattern continues. Please note that the drive is still
&gt;&gt;&gt;&gt; configured as:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &lt;driver name='qemu' type='qcow2' cache='none' io='threads'/&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; and I would expect a constant rate that is either high or low since
&gt;&gt;&gt;&gt; there is no caching involved and the underlying hard drive is a samsung ssd
&gt;&gt;&gt;&gt; evo 850. To have an idea how fast that drive is on my laptop:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; $ dd if=/dev/zero of=testfile bs=1M count=1000 oflag=direct
&gt;&gt;&gt;&gt; 1000+0 records in
&gt;&gt;&gt;&gt; 1000+0 records out
&gt;&gt;&gt;&gt; 1048576000 bytes (1.0 GB, 1000 MiB) copied, 2.47301 s, 424 MB/s
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I can further observe that the smaller the saved chunks are the slower
&gt;&gt;&gt;&gt; the overall performance is:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; dd if=/dev/zero of=testfile bs=512K count=1000 oflag=direct
&gt;&gt;&gt;&gt; 1000+0 records in
&gt;&gt;&gt;&gt; 1000+0 records out
&gt;&gt;&gt;&gt; 524288000 bytes (524 MB, 500 MiB) copied, 1.34874 s, 389 MB/s
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; $ dd if=/dev/zero of=testfile bs=5K count=1000 oflag=direct
&gt;&gt;&gt;&gt; 1000+0 records in
&gt;&gt;&gt;&gt; 1000+0 records out
&gt;&gt;&gt;&gt; 5120000 bytes (5.1 MB, 4.9 MiB) copied, 0.105109 s, 48.7 MB/s
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; $ dd if=/dev/zero of=testfile bs=1K count=10000 oflag=direct
&gt;&gt;&gt;&gt; 10000+0 records in
&gt;&gt;&gt;&gt; 10000+0 records out
&gt;&gt;&gt;&gt; 10240000 bytes (10 MB, 9.8 MiB) copied, 0.668438 s, 15.3 MB/s
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; $ dd if=/dev/zero of=testfile bs=512 count=20000 oflag=direct
&gt;&gt;&gt;&gt; 20000+0 records in
&gt;&gt;&gt;&gt; 20000+0 records out
&gt;&gt;&gt;&gt; 10240000 bytes (10 MB, 9.8 MiB) copied, 1.10964 s, 9.2 MB/s
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Could this be a limiting factor? Does qemu/kvm do many many writes of
&gt;&gt;&gt;&gt; just a few bytes?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Ideas, anyone?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Cheers
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 2017-06-21 20:46 GMT+02:00 Dan &lt;srwx4096@gmail.com&gt;:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Tue, Jun 20, 2017 at 04:24:32PM +0200, Gianluca Cecchi wrote:
&gt;&gt;&gt;&gt; &gt; On Tue, Jun 20, 2017 at 3:38 PM, Dominik Psenner &lt;dpsenner@gmail.com&gt;
&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; &gt;
&gt;&gt;&gt;&gt; &gt; &gt; to the following:
&gt;&gt;&gt;&gt; &gt; &gt;
&gt;&gt;&gt;&gt; &gt; &gt; &lt;disk type='file' device='disk'&gt;
&gt;&gt;&gt;&gt; &gt; &gt;   &lt;driver name='qemu' type='qcow2' cache='none'/&gt;
&gt;&gt;&gt;&gt; &gt; &gt;   &lt;source file='/var/data/virtuals/machines/windows-server-2016-
&gt;&gt;&gt;&gt; &gt; &gt; x64/image.qcow2'/&gt;
&gt;&gt;&gt;&gt; &gt; &gt;   &lt;backingStore/&gt;
&gt;&gt;&gt;&gt; &gt; &gt;   &lt;target dev='hda' bus='scsi'/&gt;
&gt;&gt;&gt;&gt; &gt; &gt;   &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt;&gt;&gt;&gt; &gt; &gt; &lt;/disk&gt;
&gt;&gt;&gt;&gt; &gt; &gt;
&gt;&gt;&gt;&gt; &gt; &gt; Do you see any gotchas in this configuration that could prevent the
&gt;&gt;&gt;&gt; &gt; &gt; virtualized guest to power on and boot up?
&gt;&gt;&gt;&gt; &gt; &gt;
&gt;&gt;&gt;&gt; &gt; &gt;
&gt;&gt;&gt;&gt; &gt; When I configure like this, from a linux guest point of view I get
&gt;&gt;&gt;&gt; this
&gt;&gt;&gt;&gt; &gt; Symbios Logic SCSI Controller:
&gt;&gt;&gt;&gt; &gt; 00:08.0 SCSI storage controller: LSI Logic / Symbios Logic 53c895a
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; But htis is true only if you add the SCSI controller too, not only
&gt;&gt;&gt;&gt; the disk
&gt;&gt;&gt;&gt; &gt; definition.
&gt;&gt;&gt;&gt; &gt; In my case
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt;     &lt;controller type='scsi' index='0'&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08'
&gt;&gt;&gt;&gt; &gt; function='0x0'/&gt;
&gt;&gt;&gt;&gt; &gt;     &lt;/controller&gt;
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; Note the slot='0x08' that is reflected into the first field of lspci
&gt;&gt;&gt;&gt; inside
&gt;&gt;&gt;&gt; &gt; my linux guest.
&gt;&gt;&gt;&gt; &gt; So between your controllers you have to add the SCSI one
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; In my case (Fedora 25 with virt-manager-1.4.1-2.fc25.noarch,
&gt;&gt;&gt;&gt; &gt; qemu-kvm-2.7.1-6.fc25.x86_64, libvirt-2.2.1-2.fc25.x86_64) with "Disk
&gt;&gt;&gt;&gt; bus"
&gt;&gt;&gt;&gt; &gt; set as SCSI in virt-manager, the xml defintiion for the guest is
&gt;&gt;&gt;&gt; &gt; automatically updated with the controller if not existent yet.
&gt;&gt;&gt;&gt; &gt; And the disk definition sections is like this:
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt;     &lt;disk type='file' device='disk'&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;driver name='qemu' type='qcow2'/&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;source file='/var/lib/libvirt/images/slaxsmall.qcow2'/&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;target dev='sda' bus='scsi'/&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;boot order='1'/&gt;
&gt;&gt;&gt;&gt; &gt;       &lt;address type='drive' controller='0' bus='0' target='0'
&gt;&gt;&gt;&gt; unit='0'/&gt;
&gt;&gt;&gt;&gt; &gt;     &lt;/disk&gt;
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; So I think you should set dev='sda' and not 'hda' in your xml for it
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I am actually very curious to know if that would make a difference. I
&gt;&gt;&gt;&gt; don't have a such windows vm images ready to test at present.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Dan
&gt;&gt;&gt;&gt; &gt; I don't kknow if w2016 contains the symbios logic drivers already
&gt;&gt;&gt;&gt; &gt; installed, so that a "simple" reboot could imply an automatic
&gt;&gt;&gt;&gt; &gt; reconfiguration of the guest....
&gt;&gt;&gt;&gt; &gt; Note also that in Windows when the hw configuration is considered
&gt;&gt;&gt;&gt; heavily
&gt;&gt;&gt;&gt; &gt; changed, you could be asked to register again (I don't think that the
&gt;&gt;&gt;&gt; IDE
&gt;&gt;&gt;&gt; &gt; --&gt; SCSI should imply it...)
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; Gianluca
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &gt; _______________________________________________
&gt;&gt;&gt;&gt; &gt; libvirt-users mailing list
&gt;&gt;&gt;&gt; &gt; libvirt-users@redhat.com
&gt;&gt;&gt;&gt; &gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Dominik Psenner
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Dominik Psenner
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Dominik Psenner
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Dominik Psenner
&gt;&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Dominik Psenner
&gt;



-- 
Dominik Psenner

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;a small update on this. We have migrated the \
virtualized host to use the virtio drivers and now the drive performance is improved \
so that we can see a constant transfer rate. Before it used to be the same rate but \
regularly dropped to a few bytes/sec for a few seconds and then was fast \
again.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;However we still observe that the following fails \
regularily:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div style="font-size:12.8px"&gt;&lt;span \
style="font-size:12.8px"&gt;$ virsh snapshot-create-as --domain domain --name backup \
--no-metadata --atomic --disk-only --diskspec \
hda,snapshot=external&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;$  virsh \
blockcommit domain hda --active --pivot&lt;/span&gt;&lt;/div&gt;&lt;span class="gmail-im" \
style="font-size:12.8px"&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;error: failed to pivot \
job for disk hda&lt;/span&gt;&lt;br style="font-size:12.8px"&gt;&lt;span \
style="font-size:12.8px"&gt;error: block copy still active: disk 'hda' not ready \
for pivot yet&lt;/span&gt;&lt;br style="font-size:12.8px"&gt;&lt;span style="font-size:12.8px"&gt;Could \
not merge changes for disk hda of domain. VM may be in invalid \
state.&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;/span&gt;&lt;div style="font-size:12.8px"&gt;&lt;span \
style="font-size:12.8px"&gt;Then running the following in the morning succeeds and \
successfully pivotes the snapshot into the base image while the vm is \
live:&lt;/span&gt;&lt;/div&gt;&lt;div style="font-size:12.8px"&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style="font-size:12.8px"&gt;&lt;div \
style="font-size:12.8px"&gt;$ virsh blockjob domain hda --abort&lt;br&gt;&lt;/div&gt;&lt;span \
class="gmail-m_7791346801108799745gmail-im" style="font-size:12.8px"&gt;$ virsh \
blockcommit domain hda --active --pivot&lt;/span&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style="font-size:12.8px"&gt;&lt;span \
class="gmail-m_7791346801108799745gmail-im"&gt;Successfully \
pivoted&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style="font-size:12.8px"&gt;&lt;span \
class="gmail-m_7791346801108799745gmail-im"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div \
style="font-size:12.8px"&gt;&lt;span class="gmail-m_7791346801108799745gmail-im"&gt;We run the \
backup process every day once and it failed on the following days:&lt;/span&gt;&lt;/div&gt;&lt;div \
style="font-size:12.8px"&gt;&lt;span \
class="gmail-m_7791346801108799745gmail-im"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div \
style="font-size:12.8px"&gt;&lt;span \
class="gmail-m_7791346801108799745gmail-im"&gt;2017-07-07&lt;/span&gt;&lt;/div&gt;&lt;div \
style="font-size:12.8px"&gt;&lt;span \
class="gmail-m_7791346801108799745gmail-im"&gt;2017-07-20&lt;/span&gt;&lt;/div&gt;&lt;div \
style="font-size:12.8px"&gt;&lt;span \
class="gmail-m_7791346801108799745gmail-im"&gt;2017-07-27&lt;/span&gt;&lt;/div&gt;&lt;div \
style="font-size:12.8px"&gt;&lt;span \
class="gmail-m_7791346801108799745gmail-im"&gt;2017-08-12&lt;/span&gt;&lt;/div&gt;&lt;div \
style="font-size:12.8px"&gt;&lt;span \
class="gmail-m_7791346801108799745gmail-im"&gt;2017-08-14&lt;/span&gt;&lt;/div&gt;&lt;div \
style="font-size:12.8px"&gt;&lt;span \
class="gmail-m_7791346801108799745gmail-im"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div \
style="font-size:12.8px"&gt;&lt;span class="gmail-m_7791346801108799745gmail-im"&gt;Looking at \
this it roughly happens once a week and the guest from then on writes into the \
snapshot backlog.  &lt;/span&gt;&lt;span style="font-size:12.8px"&gt;That snapshot backlog file \
grows about 8gb every day and thus the issue always needs immediate \
attention.&lt;/span&gt;&lt;/div&gt;&lt;div style="font-size:12.8px"&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style="font-size:12.8px"&gt;&lt;span \
style="font-size:12.8px"&gt;Any ideas what could cause this issue? Is this a bug (race \
condition) of `virsh blockcommit` that sometimes fails because it is invoked at the \
wrong time?&lt;/span&gt;&lt;/div&gt;&lt;div style="font-size:12.8px"&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style="font-size:12.8px"&gt;&lt;span \
style="font-size:12.8px"&gt;Cheers,&lt;/span&gt;&lt;/div&gt;&lt;div style="font-size:12.8px"&gt;&lt;span \
style="font-size:12.8px"&gt;Dominik&lt;/span&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-07 9:21 GMT+02:00 Dominik Psenner &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;&lt;span style="font-size:12.8px"&gt;Of course the cronjob fails when trying to \
virsh blockcommit and not when creating the snapshot, sorry for the \
noise.&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;div&gt;&lt;div class="h5"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-07 9:15 GMT+02:00 Dominik Psenner &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;different day, same issue.. cronjob runs and \
fails:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;$ virsh \
snapshot-create-as --domain domain --name backup --no-metadata --atomic --disk-only \
--diskspec hda,snapshot=external&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;span&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;error: failed to pivot job for disk hda&lt;/span&gt;&lt;br \
style="font-size:12.8px"&gt;&lt;span style="font-size:12.8px"&gt;error: block copy still \
active: disk 'hda' not ready for pivot yet&lt;/span&gt;&lt;br \
style="font-size:12.8px"&gt;&lt;span style="font-size:12.8px"&gt;Could not merge changes for \
disk hda of domain. VM may be in invalid state.&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;Then running the following in the morning succeeds and \
successfully pivotes the snapshot into the base image while the vm is \
live:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div \
style="font-size:12.8px"&gt;$ virsh blockjob domain hda --abort&lt;br&gt;&lt;/div&gt;&lt;span \
class="m_176365912477658107m_-4622351790740132041gmail-im" style="font-size:12.8px"&gt;$ \
virsh blockcommit domain hda --active --pivot&lt;/span&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
class="m_176365912477658107m_-4622351790740132041gmail-im"&gt;&lt;span \
style="font-size:12.8px"&gt;Successfully pivoted&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
class="m_176365912477658107m_-4622351790740132041gmail-im" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
class="m_176365912477658107m_-4622351790740132041gmail-im" \
style="font-size:12.8px"&gt;This need of manual interventions is becoming a tiring \
job..&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
class="m_176365912477658107m_-4622351790740132041gmail-im" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
class="m_176365912477658107m_-4622351790740132041gmail-im" style="font-size:12.8px"&gt;I \
someone else seeing the same issue or has an idea what the cause could \
be?&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span class="m_176365912477658107m_-4622351790740132041gmail-im" \
style="font-size:12.8px"&gt;Can I trust the output and is the base image really up to \
the latest state?&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
class="m_176365912477658107m_-4622351790740132041gmail-im" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
class="m_176365912477658107m_-4622351790740132041gmail-im" \
style="font-size:12.8px"&gt;Cheers&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;div&gt;&lt;div \
class="m_176365912477658107h5"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-02 10:30 \
GMT+02:00 Dominik Psenner &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Just a little catch-up. This time I was able to resolve the \
issue by doing:&lt;br&gt;&lt;br&gt;&lt;/div&gt;virsh blockjob domain hda --abort&lt;br&gt;&lt;/div&gt;&lt;span&gt;virsh \
blockcommit domain hda --active --pivot&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;Last  time I had to shut \
down the virtual machine and do this while being  offline.&lt;br&gt;&lt;br&gt;Thanks Wang for \
your valuable input. As far as the memory goes, there's plenty of head \
room:&lt;br&gt;&lt;br&gt;$ free -h&lt;br&gt;                           total               used         \
free           shared   buff/cache     available&lt;br&gt;Mem:                     7.8G     \
1.8G               407M               9.7M               5.5G               \
5.5G&lt;br&gt;Swap:                   8.0G               619M               \
7.4G&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;div&gt;&lt;div \
class="m_176365912477658107m_-4622351790740132041h5"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-02 10:26 GMT+02:00 王李明 &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:wanglm@certusnet.com.cn" \
target="_blank"&gt;wanglm@certusnet.com.cn&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;








&lt;div link="blue" vlink="purple" lang="ZH-CN"&gt;

&lt;div class="m_176365912477658107m_-4622351790740132041m_2863693438744199861m_2683241285725809605Section1"&gt;


&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;mybe this is because you physic host memory is \
small&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;then this will Causing instability of the virtual \
machine&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;But I'm just guessing&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;You can try to increase your memory&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal" style="text-align:justify;text-justify:inter-ideograph"&gt;&lt;span \
style="font-size:10.5pt;font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal" style="text-align:justify;text-justify:inter-ideograph"&gt;&lt;span \
style="font-size:10.5pt;font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;Wang Liming&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal" style="text-align:justify;text-justify:inter-ideograph"&gt;&lt;span \
style="font-size:10.5pt;font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;  &lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div style="border:none;border-top:solid #b5c4df 1.0pt;padding:3.0pt 0cm 0cm 0cm"&gt;

&lt;p class="MsoNormal"&gt;&lt;b&gt;&lt;span style="font-size:10.0pt"&gt;发件人&lt;span \
lang="EN-US"&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;span style="font-size:10.0pt" lang="EN-US"&gt; &lt;a \
href="mailto:libvirt-users-bounces@redhat.com" \
target="_blank"&gt;libvirt-users-bounces@redhat.c&lt;wbr&gt;om&lt;/a&gt; [mailto:&lt;a \
href="mailto:libvirt-users-bounces@redhat.com" \
target="_blank"&gt;libvirt-users-bounces@&lt;wbr&gt;redhat.com&lt;/a&gt;] &lt;/span&gt;&lt;b&gt;&lt;span \
style="font-size:10.0pt"&gt;代表 &lt;/span&gt;&lt;/b&gt;&lt;span style="font-size:10.0pt" \
lang="EN-US"&gt;Dominik Psenner&lt;br&gt; &lt;/span&gt;&lt;b&gt;&lt;span \
style="font-size:10.0pt"&gt;发送时间&lt;span lang="EN-US"&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;span \
style="font-size:10.0pt" lang="EN-US"&gt; 2017&lt;/span&gt;&lt;span \
style="font-size:10.0pt"&gt;年&lt;span lang="EN-US"&gt;7&lt;/span&gt;月&lt;span \
lang="EN-US"&gt;2&lt;/span&gt;日&lt;span lang="EN-US"&gt; 16:22&lt;br&gt; &lt;/span&gt;&lt;b&gt;收件人&lt;span \
lang="EN-US"&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US"&gt; &lt;a \
href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;/span&gt;&lt;b&gt;主题&lt;span \
lang="EN-US"&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US"&gt; Re: [libvirt-users] virtual drive \
performance&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;&lt;div&gt;&lt;div class="m_176365912477658107m_-4622351790740132041m_2863693438744199861h5"&gt;


&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;Hi \
again,&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;just today an
issue I've thought to be resolved popped up again. We backup the machine by
doing:&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;virsh snapshot-create-as --domain domain
--name backup --no-metadata --atomic --disk-only --diskspec
hda,snapshot=external&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;# backup hda.qcow2&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;virsh
blockcommit domain hda --active --pivot&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;Every now and
then this process fails with the following error message:&lt;br&gt;
&lt;br&gt;
error: failed to pivot job for disk hda&lt;br&gt;
error: block copy still active: disk 'hda' not ready for pivot yet&lt;br&gt;
Could not merge changes for disk hda of domain. VM may be in invalid \
state.&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;I expect live
backups are a great asset and should work. Is this a bug that may relates also
to the virtual drive performance issues we observe?&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Cheers&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;2017-07-02 10:10 GMT+02:00 Dominik Psenner
&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;:&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span \
lang="EN-US"&gt;Hi&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;a small update
on this. I just migrated the vm from the site to my laptop and fired it up. The
exact same xml configuration (except file paths and such) starts up and bursts
with 50Mb/s to 115Mb/s in the guest. This allows only one reasonable answer:
the cpu on my laptop is somehow better suited to emulate IO than the CPU built
into the host on site. The host there is a HP proliant microserver gen8 with
xeon processor. But the processor there is also never capped at 100% when the
guest copies files.&lt;br&gt;
&lt;br&gt;
I just ran another test by copying a 3Gb large file on the guest. What I can
observe on my computer is that the copy process is not at a constant rate but
rather starts with 90Mb/s, then drops down to 30Mb/s, goes up to 70Mb/s, drops
down to 1Mb/s, goes up to 75Mb/s, drops to 1Mb/s, goes up to 55Mb/s and the
pattern continues. Please note that the drive is still configured as:&lt;br&gt;
&lt;br&gt;
&lt;driver name='qemu' type='qcow2' cache='none' \
io='threads'/&gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;and I would expect a constant rate that is
either high or low since there is no caching involved and the underlying hard
drive is a samsung ssd evo 850. To have an idea how fast that drive is on my
laptop:&lt;br&gt;
&lt;br&gt;
$ dd if=/dev/zero of=testfile bs=1M count=1000 oflag=direct&lt;br&gt;
1000+0 records in&lt;br&gt;
1000+0 records out&lt;br&gt;
1048576000 bytes (1.0 GB, 1000 MiB) copied, 2.47301 s, 424 \
MB/s&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;I can further
observe that the smaller the saved chunks are the slower the overall
performance is:&lt;br&gt;
&lt;br&gt;
dd if=/dev/zero of=testfile bs=512K count=1000 oflag=direct&lt;br&gt;
1000+0 records in&lt;br&gt;
1000+0 records out&lt;br&gt;
524288000 bytes (524 MB, 500 MiB) copied, 1.34874 s, 389 MB/s&lt;br&gt;
&lt;br&gt;
$ dd if=/dev/zero of=testfile bs=5K count=1000 oflag=direct&lt;br&gt;
1000+0 records in&lt;br&gt;
1000+0 records out&lt;br&gt;
5120000 bytes (5.1 MB, 4.9 MiB) copied, 0.105109 s, 48.7 MB/s&lt;br&gt;
&lt;br&gt;
$ dd if=/dev/zero of=testfile bs=1K count=10000 oflag=direct&lt;br&gt;
10000+0 records in&lt;br&gt;
10000+0 records out&lt;br&gt;
10240000 bytes (10 MB, 9.8 MiB) copied, 0.668438 s, 15.3 MB/s&lt;br&gt;
&lt;br&gt;
$ dd if=/dev/zero of=testfile bs=512 count=20000 oflag=direct&lt;br&gt;
20000+0 records in&lt;br&gt;
20000+0 records out&lt;br&gt;
10240000 bytes (10 MB, 9.8 MiB) copied, 1.10964 s, 9.2 MB/s&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Could this be a limiting factor? Does
qemu/kvm do many many writes of just a few bytes?&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;&lt;br&gt;
Ideas, anyone?&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Cheers&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;2017-06-21 20:46 GMT+02:00 Dan &lt;&lt;a \
href="mailto:srwx4096@gmail.com" \
target="_blank"&gt;srwx4096@gmail.com&lt;/a&gt;&gt;:&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;blockquote style="border:none;border-left:solid #cccccc 1.0pt;padding:0cm 0cm 0cm \
6.0pt;margin-left:4.8pt;margin-right:0cm"&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;On Tue, Jun 20, 2017 at 04:24:32PM +0200,
Gianluca Cecchi wrote:&lt;br&gt;
&gt; On Tue, Jun 20, 2017 at 3:38 PM, Dominik Psenner &lt;&lt;a \
href="mailto:dpsenner@gmail.com" target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt; \
wrote:&lt;br&gt; &gt;&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; to the following:&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; &lt;disk type='file' device='disk'&gt;&lt;br&gt;
&gt; &gt;     &lt;driver name='qemu' type='qcow2' \
cache='none'/&gt;&lt;br&gt; &gt; &gt;     &lt;source
file='/var/data/virtuals/machi&lt;wbr&gt;nes/windows-server-2016-&lt;br&gt;
&gt; &gt; x64/image.qcow2'/&gt;&lt;br&gt;
&gt; &gt;     &lt;backingStore/&gt;&lt;br&gt;
&gt; &gt;     &lt;target dev='hda' bus='scsi'/&gt;&lt;br&gt;
&gt; &gt;     &lt;address type='drive' controller='0' bus='0'
target='0' unit='0'/&gt;&lt;br&gt;
&gt; &gt; &lt;/disk&gt;&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; Do you see any gotchas in this configuration that could prevent the&lt;br&gt;
&gt; &gt; virtualized guest to power on and boot up?&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; When I configure like this, from a linux guest point of view I get this&lt;br&gt;
&gt; Symbios Logic SCSI Controller:&lt;br&gt;
&gt; 00:08.0 SCSI storage controller: LSI Logic / Symbios Logic 53c895a&lt;br&gt;
&gt;&lt;br&gt;
&gt; But htis is true only if you add the SCSI controller too, not only the
disk&lt;br&gt;
&gt; definition.&lt;br&gt;
&gt; In my case&lt;br&gt;
&gt;&lt;br&gt;
&gt;        &lt;controller type='scsi' index='0'&gt;&lt;br&gt;
&gt;           &lt;address type='pci' domain='0x0000'
bus='0x00' slot='0x08'&lt;br&gt;
&gt; function='0x0'/&gt;&lt;br&gt;
&gt;        &lt;/controller&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; Note the slot='0x08' that is reflected into the first field of lspci
inside&lt;br&gt;
&gt; my linux guest.&lt;br&gt;
&gt; So between your controllers you have to add the SCSI one&lt;br&gt;
&gt;&lt;br&gt;
&gt; In my case (Fedora 25 with virt-manager-1.4.1-2.fc25.noar&lt;wbr&gt;ch,&lt;br&gt;
&gt; qemu-kvm-2.7.1-6.fc25.x86_64, libvirt-2.2.1-2.fc25.x86_64) with "Disk
bus"&lt;br&gt;
&gt; set as SCSI in virt-manager, the xml defintiion for the guest is&lt;br&gt;
&gt; automatically updated with the controller if not existent yet.&lt;br&gt;
&gt; And the disk definition sections is like this:&lt;br&gt;
&gt;&lt;br&gt;
&gt;        &lt;disk type='file' device='disk'&gt;&lt;br&gt;
&gt;           &lt;driver name='qemu' type='qcow2'/&gt;&lt;br&gt;
&gt;           &lt;source \
file='/var/lib/libvirt/images/&lt;wbr&gt;slaxsmall.qcow2'/&gt;&lt;br&gt; &gt;           \
&lt;target dev='sda' bus='scsi'/&gt;&lt;br&gt; &gt;           &lt;boot \
order='1'/&gt;&lt;br&gt; &gt;           &lt;address type='drive' \
controller='0' bus='0' target='0' unit='0'/&gt;&lt;br&gt;
&gt;        &lt;/disk&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; So I think you should set dev='sda' and not 'hda' in your xml \
for it&lt;br&gt; &gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;I am actually
very curious to know if that would make a difference. I&lt;br&gt;
don't have a such windows vm images ready to test at present.&lt;br&gt;
&lt;span style="color:#888888"&gt;&lt;br&gt;
&lt;span class="m_176365912477658107m_-4622351790740132041m_2863693438744199861m_2683241285725809605m-9222668100434188158hoenzb"&gt;Dan&lt;/span&gt;&lt;br&gt;
 &lt;/span&gt;&lt;span class="m_176365912477658107m_-4622351790740132041m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt; \
I don't kknow if w2016 contains the symbios logic drivers already&lt;/span&gt;&lt;br&gt;
&lt;span class="m_176365912477658107m_-4622351790740132041m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt; \
installed, so that a "simple" reboot could imply an automatic&lt;/span&gt;&lt;br&gt;
&lt;span class="m_176365912477658107m_-4622351790740132041m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt; \
reconfiguration of the guest....&lt;/span&gt;&lt;br&gt; &lt;span \
class="m_176365912477658107m_-4622351790740132041m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt; \
Note also that in Windows when the hw configuration is considered heavily&lt;/span&gt;&lt;br&gt;
&lt;span class="m_176365912477658107m_-4622351790740132041m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt; \
changed, you could be asked to register again (I don't think that the \
IDE&lt;/span&gt;&lt;br&gt; &lt;span \
class="m_176365912477658107m_-4622351790740132041m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt; \
--&gt; SCSI should imply it...)&lt;/span&gt;&lt;br&gt; &lt;span \
class="m_176365912477658107m_-4622351790740132041m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt;&lt;/span&gt;&lt;br&gt;
 &lt;span class="m_176365912477658107m_-4622351790740132041m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt; \
Gianluca&lt;/span&gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;&gt;
______________________________&lt;wbr&gt;_________________&lt;br&gt;
&gt; libvirt-users mailing list&lt;br&gt;
&gt; &lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;


&lt;/div&gt;

&lt;/div&gt;

&lt;/blockquote&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span style="color:#888888" lang="EN-US"&gt;&lt;br&gt;
&lt;br clear="all"&gt;
&lt;br&gt;
&lt;span class="m_176365912477658107m_-4622351790740132041m_2863693438744199861m_2683241285725809605hoenzb"&gt;-- \
&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span style="color:#888888" lang="EN-US"&gt;Dominik \
Psenner&lt;/span&gt;&lt;span lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;br&gt;
&lt;br clear="all"&gt;
&lt;br&gt;
-- &lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Dominik Psenner&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;

&lt;/div&gt;


&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;span \
class="m_176365912477658107m_-4622351790740132041HOEnZb"&gt;&lt;font color="#888888"&gt;-- \
&lt;br&gt;&lt;div class="m_176365912477658107m_-4622351790740132041m_2863693438744199861gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br \
clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span class="m_176365912477658107HOEnZb"&gt;&lt;font \
color="#888888"&gt;-- &lt;br&gt;&lt;div \
class="m_176365912477658107m_-4622351790740132041gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br \
clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;-- \
&lt;br&gt;&lt;div class="m_176365912477658107gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- \
&lt;br&gt;&lt;div class="gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div \
dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170822180118</emailId><senderName>"Sinan Polat"</senderName><senderEmail>sinan@turka.nl</senderEmail><timestampReceived>2017-08-22 18:01:18-0400</timestampReceived><subject>[libvirt-users] NTP traffic blocked</subject><body>

I have multiple VM's on the same KVM host. One of the VM's is running NTP.
All VM's can reach eachother, no firewall in between. But the problem is,
the VM's cannot communicate over port 123/udp to the NTP VM.

 

 

Network: 172.24.100.0/22

 

KVM: 172.24.101.50

 

VM ntp: 172.24.102.10

VM foo: 172.24.102.20

 

1. On the NTP server, listen for any incoming packets from VM foo on port
123:

[ntp ~]# tcpdump -i any host 172.24.102.20 and port 123 -n

 

2. Execute the following on server foo. Since server ntp is listening with
tcpdump, packets should be visible in tcpdump.

[foo ~]# ntpdate 172.24.102.10

 

This is failing:

ntpdate[30443]: no server suitable for synchronization found

 

No packets are coming in to the ntp server, tcpdump is just blank. Weird.

 

 

To troubleshoot further, start over and do the following:

[ntp ~]# tcpdump -i any host 172.24.102.20 and port 123 -n ## Listen for
packets filtering host 172.24.102.20 and port 123

[foo ~]# tcpdump -i any host 172.24.102.10 and port 123 -n ## Listen for
packets filtering host 172.24.102.10 and port 123

 

While both tcpdumps are running, execute the following:

[foo ~]# ntpdate 172.24.102.10

 

Now, on the tcpdump of VM foo, you will see outgoing packets:

19:45:26.644630 IP 172.24.102.20.ntp &gt; 172.24.102.10.ntp: NTPv4, Client,
length 48

 

As you can see, packets are exiting the server, but there is no response.

 

And the tcpdump of the ntp server is still empty, it doesn't receive the
packets (so, it won't reply). But why?

 

 

Lets troubleshoot further and run ntpdate in debugging mode:

 

[foo ~]# ntpdate -dv 172.24.102.10

22 Aug 19:51:23 ntpdate[30465]: ntpdate 4.2.6p5@1.2349-o Wed Mar  1 09:00:52
UTC 2017 (1)

Looking for host 172.24.102.10 and service ntp

host found : some-host.com

transmit(172.24.102.10)

receive(172.24.102.10)

transmit(172.24.102.10)

receive(172.24.102.10)

server 172.24.102.10, port 123

 

22 Aug 19:51:29 ntpdate[30465]: step time server 172.24.102.10 offset
1.414813 sec

 

 

Wow it worked!? But it only works with the "-d" option. What is the
difference between normal and debgging mode? Lets have a closer look;
without the "-d" option, the src and dest ports are 123. When using the "-d"
option, the src port is not 123 (it is a random high port number).

 

 

On the KVM host and on the VM's there is no firewall active, even if there
was a firewall, in tcpdump the packets should have been shown.

 

Anyone who can help? Thanks!

 

Sinan


[Attachment #3 (text/html)]

&lt;html xmlns:v="urn:schemas-microsoft-com:vml" \
xmlns:o="urn:schemas-microsoft-com:office:office" \
xmlns:w="urn:schemas-microsoft-com:office:word" \
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" \
xmlns="http://www.w3.org/TR/REC-html40"&gt;&lt;head&gt;&lt;meta http-equiv=Content-Type \
content="text/html; charset=us-ascii"&gt;&lt;meta name=Generator content="Microsoft Word 12 \
(filtered medium)"&gt;&lt;style&gt;&lt;!-- /* Font Definitions */
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:purple;
	text-decoration:underline;}
span.E-mailStijl17
	{mso-style-type:personal-compose;
	font-family:"Calibri","sans-serif";
	color:windowtext;}
.MsoChpDefault
	{mso-style-type:export-only;}
@page WordSection1
	{size:612.0pt 792.0pt;
	margin:70.85pt 70.85pt 70.85pt 70.85pt;}
div.WordSection1
	{page:WordSection1;}
--&gt;&lt;/style&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapedefaults v:ext="edit" spidmax="1026" /&gt;
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapelayout v:ext="edit"&gt;
&lt;o:idmap v:ext="edit" data="1" /&gt;
&lt;/o:shapelayout&gt;&lt;/xml&gt;&lt;![endif]--&gt;&lt;/head&gt;&lt;body lang=NL link=blue vlink=purple&gt;&lt;div \
class=WordSection1&gt;&lt;p class=MsoNormal&gt;I have multiple VM’s on the same KVM \
host. One of the VM’s is running NTP. All VM’s can reach eachother, no \
firewall in between. But the problem is, the VM’s cannot communicate over port \
123/udp to the NTP VM.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;Network: \
172.24.100.0/22&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;KVM: 172.24.101.50&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;VM ntp: \
172.24.102.10&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;VM foo: 172.24.102.20&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;1. On the NTP server, listen \
for any incoming packets from VM foo on port 123:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;[ntp ~]# tcpdump -i any host 172.24.102.20 and port 123 \
-n&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;2. \
Execute the following on server foo. Since server ntp is listening with tcpdump, \
packets should be visible in tcpdump.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;[foo ~]# \
ntpdate 172.24.102.10&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;This is failing:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;ntpdate[30443]: no \
server suitable for synchronization found&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;No packets are coming in to \
the ntp server, tcpdump is just blank. Weird.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;To troubleshoot further, start over and do the \
following:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;[ntp ~]# tcpdump -i any host \
172.24.102.20 and port 123 -n ## Listen for packets filtering host 172.24.102.20 and \
port 123&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;[foo ~]# tcpdump -i any host 172.24.102.10 \
and port 123 -n ## Listen for packets filtering host 172.24.102.10 and port \
123&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;While \
both tcpdumps are running, execute the following:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;[foo ~]# ntpdate 172.24.102.10&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;Now, on the tcpdump of VM \
foo, you will see outgoing packets:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;19:45:26.644630 \
IP 172.24.102.20.ntp &gt; 172.24.102.10.ntp: NTPv4, Client, length \
48&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;As you \
can see, packets are exiting the server, but there is no response.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;And the tcpdump of the ntp \
server is still empty, it doesn't receive the packets (so, it won't reply). But \
why?&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;Lets troubleshoot further and \
run ntpdate in debugging mode:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;[foo ~]# ntpdate -dv \
172.24.102.10&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;22 Aug 19:51:23 ntpdate[30465]: \
ntpdate 4.2.6p5@1.2349-o Wed Mar  1 09:00:52 UTC 2017 (1)&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;Looking for host 172.24.102.10 and service ntp&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;host found : some-host.com&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;transmit(172.24.102.10)&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;receive(172.24.102.10)&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;transmit(172.24.102.10)&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;receive(172.24.102.10)&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;server \
172.24.102.10, port 123&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;22 Aug 19:51:29 ntpdate[30465]: step time server 172.24.102.10 offset \
1.414813 sec&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;Wow it worked!? But it only \
works with the "-d" option. What is the difference between normal and \
debgging mode? Lets have a closer look; without the "-d" option, the src \
and dest ports are 123. When using the "-d" option, the src port is not 123 \
(it is a random high port number).&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;On the KVM host and on the VM's there is no firewall active, even if \
there was a firewall, in tcpdump the packets should have been shown.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;Anyone who can help? \
Thanks!&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p \
class=MsoNormal&gt;Sinan&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;



</body></email><email><emailId>20170814150523</emailId><senderName>Peter Krempa</senderName><senderEmail>pkrempa@redhat.com</senderEmail><timestampReceived>2017-08-14 15:05:23-0400</timestampReceived><subject>Re: [libvirt-users] virsh blockcommit fails regularily (was: virtual drive performance)</subject><body>


On Mon, Aug 14, 2017 at 08:42:24 +0200, Dominik Psenner wrote:
&gt; Hi,

Hi,

&gt; 
&gt; a small update on this. We have migrated the virtualized host to use the
&gt; virtio drivers and now the drive performance is improved so that we can see
&gt; a constant transfer rate. Before it used to be the same rate but regularly
&gt; dropped to a few bytes/sec for a few seconds and then was fast again.
&gt; 
&gt; However we still observe that the following fails regularily:
&gt; 
&gt; $ virsh snapshot-create-as --domain domain --name backup --no-metadata
&gt; --atomic --disk-only --diskspec hda,snapshot=external
&gt; $ virsh blockcommit domain hda --active --pivot
&gt; error: failed to pivot job for disk hda
&gt; error: block copy still active: disk 'hda' not ready for pivot yet
&gt; Could not merge changes for disk hda of domain. VM may be in invalid state.

since this thread was renamed, please re-state the version of libvirt
you are using. I don't really want to dig through the old thread.

&gt; Then running the following in the morning succeeds and successfully pivotes
&gt; the snapshot into the base image while the vm is live:
&gt; 
&gt; $ virsh blockjob domain hda --abort
&gt; $ virsh blockcommit domain hda --active --pivot
&gt; Successfully pivoted
&gt; 
&gt; We run the backup process every day once and it failed on the following
&gt; days:
&gt; 
&gt; 2017-07-07
&gt; 2017-07-20
&gt; 2017-07-27
&gt; 2017-08-12
&gt; 2017-08-14
&gt; 
&gt; Looking at this it roughly happens once a week and the guest from then on
&gt; writes into the snapshot backlog. That snapshot backlog file grows about
&gt; 8gb every day and thus the issue always needs immediate attention.
&gt; 
&gt; Any ideas what could cause this issue? Is this a bug (race condition) of
&gt; `virsh blockcommit` that sometimes fails because it is invoked at the wrong
&gt; time?

So the 'virsh blockcommit domain hda --active --pivot' operation
consists of 3 parts:

1) virsh blockcommit domain hda --active
2) waiting until the block job finishes
3) virsh blockjob --pivot domain hda

The problem is that some times 2) finishes too soon and then operation 3
fails. This should not happen any more, since there's code in virsh [1]
which waits for the completion event from libvirtd, which is fired only
when the job is actually ready to be pivoted.

This code has a lot of fallback options in case when libvirtd is old or
so.

At any rate, manual pivoting later should help. Also probably updating
to a more recent version.

In case you are using a farily recent version, it's possible that there
are still bugs though.

Peter

[1]:

commit 7408403560f7d054da75acaab855a95c51a92e2b
Author: Peter Krempa &lt;pkrempa@redhat.com&gt;
Date:   Mon Jul 13 17:04:49 2015 +0200

    virsh: Refactor block job waiting in cmdBlockCommit
    
    Reuse the vshBlockJobWait infrastructure to refactor cmdBlockCommit to
    use the common code. This additionally fixes a bug when working with
    new qemus, where when doing an active commit with --pivot the pivoting
    would fail, since qemu reaches 100% completion but the job doesn't
    switch to synchronized phase right away.

$ git describe --contains 7408403560f7d054da75acaab855a95c51a92e2b
v1.2.18-rc1~33


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170824155735</emailId><senderName>Marko Weber</senderName><senderEmail>weber@zbfmail.de</senderEmail><timestampReceived>2017-08-24 15:57:35-0400</timestampReceived><subject>[libvirt-users] vm in qcow2 runs on host A but not on host B</subject><body>



hello,
a vm in format qcow2 on host A  (Intel Xeon CPU E5-1650 v4)
do not start on host B ( Intel Core i7-2600 CPU @ 3.40GHz )

i get on host B by starting the vm  "trap errors" Opcode.

anyone here has an idea how to solve this?

kind regards
marko


-- 
zbfmail - Mittendrin statt nur Datei!

OpenDKIM, SPF, DSPAM, Greylisting, POSTSCREEN, AMAVIS, Mailgateways
Mailfiltering, SMTP Service, Spam Abwehr, MX-Backup, Mailserver Backup
Redundante Mailgateways, HA Mailserver, Secure Mailserver

</body></email><email><emailId>20170824161438</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-08-24 16:14:38-0400</timestampReceived><subject>Re: [libvirt-users] vm in qcow2 runs on host A but not on host B</subject><body>

This might be related to the configuration of the virtual machine. A
machine configured to have cpu X might not start up when it is changed to
cpu Y. We also observed that a windows host does not boot on a ubuntu host
with the default kvm configuration.
https://github.com/dpsenner/libvirt-administration-tools#windows-guest-crashes-with-a-blue-screen-after-migrating-the-virtual-machine-to-another-host
                
.

Good luck!

2017-08-24 17:57 GMT+02:00 Marko Weber &lt;weber@zbfmail.de&gt;:

&gt; 
&gt; 
&gt; hello,
&gt; a vm in format qcow2 on host A  (Intel Xeon CPU E5-1650 v4)
&gt; do not start on host B ( Intel Core i7-2600 CPU @ 3.40GHz )
&gt; 
&gt; i get on host B by starting the vm  "trap errors" Opcode.
&gt; 
&gt; anyone here has an idea how to solve this?
&gt; 
&gt; kind regards
&gt; marko
&gt; 
&gt; 
&gt; --
&gt; zbfmail - Mittendrin statt nur Datei!
&gt; 
&gt; OpenDKIM, SPF, DSPAM, Greylisting, POSTSCREEN, AMAVIS, Mailgateways
&gt; Mailfiltering, SMTP Service, Spam Abwehr, MX-Backup, Mailserver Backup
&gt; Redundante Mailgateways, HA Mailserver, Secure Mailserver
&gt; 
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt; 



-- 
Dominik Psenner


[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;This might be related to the configuration of the virtual machine. A \
machine configured to have cpu X might not start up when it is changed to cpu Y. We \
also observed that a windows host does not boot on a ubuntu host with the default kvm \
configuration.  &lt;a href="https://github.com/dpsenner/libvirt-administration-tools#wind \
ows-guest-crashes-with-a-blue-screen-after-migrating-the-virtual-machine-to-another-ho \
st"&gt;https://github.com/dpsenner/libvirt-administration-tools#windows-guest-crashes-wit \
h-a-blue-screen-after-migrating-the-virtual-machine-to-another-host&lt;/a&gt;.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Good \
luck!&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-08-24 \
17:57 GMT+02:00 Marko Weber &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:weber@zbfmail.de" \
target="_blank"&gt;weber@zbfmail.de&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;br&gt; &lt;br&gt;
hello,&lt;br&gt;
a vm in format qcow2 on host A   (Intel Xeon CPU E5-1650 v4)&lt;br&gt;
do not start on host B ( Intel Core i7-2600 CPU @ 3.40GHz )&lt;br&gt;
&lt;br&gt;
i get on host B by starting the vm   "trap errors" Opcode.&lt;br&gt;
&lt;br&gt;
anyone here has an idea how to solve this?&lt;br&gt;
&lt;br&gt;
kind regards&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;br&gt;
marko&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
-- &lt;br&gt;
zbfmail - Mittendrin statt nur Datei!&lt;br&gt;
&lt;br&gt;
OpenDKIM, SPF, DSPAM, Greylisting, POSTSCREEN, AMAVIS, Mailgateways&lt;br&gt;
Mailfiltering, SMTP Service, Spam Abwehr, MX-Backup, Mailserver Backup&lt;br&gt;
Redundante Mailgateways, HA Mailserver, Secure Mailserver&lt;br&gt;
&lt;br&gt;
______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- &lt;br&gt;&lt;div \
class="gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik \
Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;



</body></email><email><emailId>20170825083813</emailId><senderName>Marko Weber</senderName><senderEmail>weber@zbfmail.de</senderEmail><timestampReceived>2017-08-25 08:38:13-0400</timestampReceived><subject>Re: [libvirt-users] vm in qcow2 runs on host A but not on host B</subject><body>


hey dominik,

Am 2017-08-24 18:14, schrieb Dominik Psenner:
&gt; This might be related to the configuration of the virtual machine. A
&gt; machine configured to have cpu X might not start up when it is changed
&gt; to cpu Y. We also observed that a windows host does not boot on a
&gt; ubuntu host with the default kvm configuration.
&gt; https://github.com/dpsenner/libvirt-administration-tools#windows-guest-crashes-with-a-blue-screen-after-migrating-the-virtual-machine-to-another-host.
&gt;  
&gt; Good luck!

that doesn ´t solved it :-(

marko

&gt; 
&gt; 2017-08-24 17:57 GMT+02:00 Marko Weber &lt;weber@zbfmail.de&gt;:
&gt; 
&gt; &gt; hello,
&gt; &gt; a vm in format qcow2 on host A  (Intel Xeon CPU E5-1650 v4)
&gt; &gt; do not start on host B ( Intel Core i7-2600 CPU @ 3.40GHz )
&gt; &gt; 
&gt; &gt; i get on host B by starting the vm  "trap errors" Opcode.
&gt; &gt; 
&gt; &gt; anyone here has an idea how to solve this?
&gt; &gt; 
&gt; &gt; kind regards
&gt; &gt; marko
&gt; &gt; 
&gt; &gt; --
&gt; &gt; zbfmail - Mittendrin statt nur Datei!
&gt; &gt; 
&gt; &gt; OpenDKIM, SPF, DSPAM, Greylisting, POSTSCREEN, AMAVIS, Mailgateways
&gt; &gt; Mailfiltering, SMTP Service, Spam Abwehr, MX-Backup, Mailserver
&gt; &gt; Backup
&gt; &gt; Redundante Mailgateways, HA Mailserver, Secure Mailserver
&gt; &gt; 
&gt; &gt; _______________________________________________
&gt; &gt; libvirt-users mailing list
&gt; &gt; libvirt-users@redhat.com
&gt; &gt; https://www.redhat.com/mailman/listinfo/libvirt-users [1]
&gt; 
&gt; --
&gt; 
&gt; Dominik Psenner
&gt; 
&gt; 
&gt; Links:
&gt; ------
&gt; [1] https://www.redhat.com/mailman/listinfo/libvirt-users


</body></email><email><emailId>20170825095418</emailId><senderName>Marcos</senderName><senderEmail>mczueira@yahoo.com.br</senderEmail><timestampReceived>2017-08-25 09:54:18-0400</timestampReceived><subject>Re: [libvirt-users] vm in qcow2 runs on host A but not on host B</subject><body>

&lt;div dir='auto'&gt;Hi everyone,&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;Windows are very sensitive with hardware, mainly with CPU.&lt;/div&gt;&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;If you change, you break.&lt;/div&gt;&lt;div dir="auto"&gt;It is not the virtualization system fault.&lt;/div&gt;&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;For libvirt/kvm you can use the CPU kvm64 that hidde some specifics features from the operational system.&lt;/div&gt;&lt;div dir="auto"&gt;In this case it is easier to migrate VM from host to host.&lt;/div&gt;&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;You can use the migration feature from libvirt to test if the 2 hosts are compatible for migrating your windows VM.&lt;/div&gt;&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;If libvirt tells you that it is not compatible and you copy the VM - it would break your VM.&lt;/div&gt;&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;
</body></email><email><emailId>20170821032250</emailId><senderName>llilulu</senderName><senderEmail>llilulu@yeah.net</senderEmail><timestampReceived>2017-08-21 03:22:50-0400</timestampReceived><subject>[libvirt-users] dump in virEventPollRunOnce</subject><body>

[Attachment #2 (text/plain)]

libvirt
version: 3.4.0
architecture: x86_64 ubuntu16.04-server

hypervisor: kvm,qemu

My program use libvirt event , the program is a module(.so) file in cloud \
application, when unload the module, program will dump in virEventPoolRunOnce call. \
program frame

virInitialize
virEventAddTimeOut
virEventRunDefaultImpl
virConnectXXX
virConnectDomainEventRegisterAny
...
virConnectDomainEventDeregisterAny
...

when unload the module will dump , the gdb bt commad output is
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
Core was generated by `/usr/local/lssa/bin/lssa -f'.
Program terminated with signal SIGSEGV, Segmentation fault.
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
#0  0x00007f9a3e9fc2f2 in ?? ()
[Current thread is 1 (Thread 0x7f9a39349700 (LWP 2897))]
(gdb) bt
#0  0x00007f9a3e9fc2f2 in ?? ()
#1  0x00007f9a3e1728bd in virEventPollRunOnce () from /usr/lib/libvirt.so.0
#2  0x00007f9a3e171391 in virEventRunDefaultImpl () from /usr/lib/libvirt.so.0
#3  0x00007f9a3e9fbc16 in ?? ()
#4  0x0000000000000000 in ?? ()
(gdb)

Thanks


[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;libvirt&lt;br&gt;version: \
3.4.0&lt;br&gt;architecture: x86_64 ubuntu16.04-server&lt;br&gt;&lt;div&gt;hypervisor: \
kvm,qemu&lt;br&gt;&lt;br&gt;My program use libvirt event , the program is a module(.so) file in \
cloud application, when unload the module, program will dump in virEventPoolRunOnce \
call.&lt;br&gt;program frame&lt;br&gt;&lt;br&gt;virInitialize&lt;br&gt;virEventAddTimeOut&lt;br&gt;virEventRunDefaul \
tImpl&lt;br&gt;virConnectXXX&lt;br&gt;virConnectDomainEventRegisterAny&lt;br&gt;...&lt;br&gt;virConnectDomainEventDeregisterAny&lt;br&gt;...&lt;br&gt;&lt;br&gt;when \
unload the module will dump , the gdb bt commad output is&lt;br&gt;[Thread debugging using \
libthread_db enabled]&lt;br&gt;Using host libthread_db library \
"/lib/x86_64-linux-gnu/libthread_db.so.1".&lt;br&gt;Core was generated by \
`/usr/local/lssa/bin/lssa -f'.&lt;br&gt;Program terminated with signal SIGSEGV, \
Segmentation fault.&lt;br&gt;---Type &lt;return&gt; to continue, or q &lt;return&gt; to \
quit---&lt;br&gt;#0  0x00007f9a3e9fc2f2 in ?? ()&lt;br&gt;[Current thread is 1 (Thread \
0x7f9a39349700 (LWP 2897))]&lt;br&gt;(gdb) bt&lt;br&gt;#0  0x00007f9a3e9fc2f2 in ?? \
()&lt;br&gt;#1  0x00007f9a3e1728bd in virEventPollRunOnce () from \
/usr/lib/libvirt.so.0&lt;br&gt;#2  0x00007f9a3e171391 in virEventRunDefaultImpl () \
from /usr/lib/libvirt.so.0&lt;br&gt;#3  0x00007f9a3e9fbc16 in ?? ()&lt;br&gt;#4  \
0x0000000000000000 in ?? ()&lt;br&gt;(gdb) \
&lt;br&gt;&lt;br&gt;Thanks&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;span \
title="neteasefooter"&gt;&lt;p&gt; &lt;/p&gt;&lt;/span&gt;



</body></email><email><emailId>20170822092742</emailId><senderName>llilulu</senderName><senderEmail>llilulu@yeah.net</senderEmail><timestampReceived>2017-08-22 09:27:42-0400</timestampReceived><subject>[libvirt-users] libvirt event</subject><body>

[Attachment #2 (text/plain)]

libvirt
version: 3.4.0
    When use libvirt event in program, if I create more than one thread loop call \
virEventRunDefaultImp(), Is this invocation correct. If correct ,what happen when \
event occur.is many thread process event?  If I invocation virEventRegisterDefault \
before any hypervisor connect, and invocation virEventRunDefaultImp.Then I connect a \
hypervisor(qemu) and register some event on this connection. I connect another \
hypervisor(lxc), before lxc connection, I reinvocation virEventRegisterDefault and \
virEventRunDefaultImp, Is this operate correct?What happen after that?  Thanks


[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div \
style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div&gt;libvirt&lt;br&gt;version: \
3.4.0&lt;/div&gt;&lt;/div&gt;&lt;div&gt;    When use libvirt event in program, if I \
create more than one thread loop call virEventRunDefaultImp(), Is this invocation \
correct. If correct ,what happen when event occur.is many thread process \
event?&lt;br&gt;   If I invocation virEventRegisterDefault before any hypervisor \
connect, and invocation virEventRunDefaultImp.Then I connect a hypervisor(qemu) and \
register some event on this connection. I connect another hypervisor(lxc), before lxc \
connection, I reinvocation virEventRegisterDefault and virEventRunDefaultImp, Is this \
operate correct?What happen after that?&lt;br&gt;      \
Thanks&lt;br&gt;&lt;/div&gt;&lt;span title="neteasefooter"&gt;&lt;/span&gt;&lt;/div&gt;



</body></email><email><emailId>20170824125426</emailId><senderName>"Naud, AntoineX"</senderName><senderEmail>antoinex.naud@intel.com</senderEmail><timestampReceived>2017-08-24 12:54:26-0400</timestampReceived><subject>[libvirt-users] duplicated notifications for suspend and resume</subject><body>

Hello,

I am using domain event notifications from libvirt-event API in my applicat=
ion and it seems to work fine, except for 'suspend' and 'resume' events whe=
re I keep receiving duplicated notifications.

Similarly, the example provided with libvirt (in examples/object-events/eve=
nt-test) also produces twice as much notifications for 'suspend' and 'resum=
e' than for other events. Here is the sequence of virsh commands and the ou=
tput of event-test:

Virsh start Fed25
Virsh suspend Fed25
Virsh resume Fed25
Virsh shutdown Fed25

[~/libvirt-3.4.0/examples/object-events] ./event-test qemu:///system
Registering event callbacks
myNodeDeviceEventCallback EVENT: Node device net_vnet0_fe_54_00_a0_ba_61 Cr=
eated 0
myDomainEventCallback1 EVENT: Domain Fed25(1) Resumed Unpaused
myDomainEventCallback2 EVENT: Domain Fed25(1) Resumed Unpaused
myDomainEventCallback1 EVENT: Domain Fed25(1) Started Booted
myDomainEventCallback2 EVENT: Domain Fed25(1) Started Booted
myDomainEventCallback1 EVENT: Domain Fed25(1) Suspended Paused
myDomainEventCallback2 EVENT: Domain Fed25(1) Suspended Paused
myDomainEventCallback1 EVENT: Domain Fed25(1) Suspended Paused
myDomainEventCallback2 EVENT: Domain Fed25(1) Suspended Paused
myDomainEventCallback1 EVENT: Domain Fed25(1) Resumed Unpaused
myDomainEventCallback2 EVENT: Domain Fed25(1) Resumed Unpaused
myDomainEventCallback1 EVENT: Domain Fed25(1) Resumed Unpaused
myDomainEventCallback2 EVENT: Domain Fed25(1) Resumed Unpaused
myDomainEventCallback1 EVENT: Domain Fed25(1) Shutdown Finished
myDomainEventCallback2 EVENT: Domain Fed25(1) Shutdown Finished
myNodeDeviceEventCallback EVENT: Node device net_vnet0_fe_54_00_a0_ba_61 De=
leted 0

Note that the 2 lines printed for each event are ok since 2 callbacks are r=
egistered in the example.

Has anybody else faced this issue?

I am using libvirt-3.6.0 on Ubuntu 16.04.

Best regards,
Antoine
--------------------------------------------------------------
Intel Research and Development Ireland Limited
Registered in Ireland
Registered Office: Collinstown Industrial Park, Leixlip, County Kildare
Registered Number: 308263


This e-mail and any attachments may contain confidential material for the s=
ole
use of the intended recipient(s). Any review or distribution by others is
strictly prohibited. If you are not the intended recipient, please contact =
the
sender and delete all copies.

[Attachment #3 (text/html)]

&lt;html xmlns:v="urn:schemas-microsoft-com:vml" \
xmlns:o="urn:schemas-microsoft-com:office:office" \
xmlns:w="urn:schemas-microsoft-com:office:word" \
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" \
xmlns="http://www.w3.org/TR/REC-html40"&gt; &lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=us-ascii"&gt;
&lt;meta name="Generator" content="Microsoft Word 15 (filtered medium)"&gt;
&lt;style&gt;&lt;!--
/* Font Definitions */
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;
	mso-fareast-language:EN-US;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:#0563C1;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:#954F72;
	text-decoration:underline;}
span.EmailStyle17
	{mso-style-type:personal-compose;
	font-family:"Calibri",sans-serif;
	color:windowtext;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-family:"Calibri",sans-serif;
	mso-fareast-language:EN-US;}
@page WordSection1
	{size:612.0pt 792.0pt;
	margin:70.85pt 70.85pt 70.85pt 70.85pt;}
div.WordSection1
	{page:WordSection1;}
--&gt;&lt;/style&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapedefaults v:ext="edit" spidmax="1026" /&gt;
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapelayout v:ext="edit"&gt;
&lt;o:idmap v:ext="edit" data="1" /&gt;
&lt;/o:shapelayout&gt;&lt;/xml&gt;&lt;![endif]--&gt;
&lt;/head&gt;
&lt;body lang="PL" link="#0563C1" vlink="#954F72"&gt;
&lt;div class="WordSection1"&gt;
&lt;p class="MsoNormal"&gt;Hello,&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;I am using domain event notifications from \
libvirt-event API in my application and it seems to work fine, except for \
‘suspend’ and ‘resume’ events where I keep receiving \
duplicated notifications.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;Similarly, the example provided with libvirt (in \
examples/object-events/event-test) also produces twice as much notifications for \
‘suspend’ and ‘resume’ than for other events. Here is the \
sequence of virsh commands and  the output of event-test:&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Virsh start Fed25&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Virsh suspend Fed25&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Virsh resume Fed25&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Virsh shutdown Fed25&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;[~/libvirt-3.4.0/examples/object-events] \
./event-test qemu:///system&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;Registering event callbacks&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;myNodeDeviceEventCallback EVENT: Node device \
net_vnet0_fe_54_00_a0_ba_61 Created 0&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;myDomainEventCallback1 EVENT: Domain Fed25(1) \
Resumed Unpaused&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;myDomainEventCallback2 EVENT: Domain Fed25(1) Resumed \
Unpaused&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;myDomainEventCallback1 EVENT: Domain Fed25(1) Started \
Booted&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;myDomainEventCallback2 EVENT: Domain Fed25(1) Started \
Booted&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;myDomainEventCallback1 EVENT: Domain Fed25(1) Suspended \
Paused&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;myDomainEventCallback2 EVENT: Domain Fed25(1) Suspended \
Paused&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;myDomainEventCallback1 EVENT: Domain Fed25(1) Suspended \
Paused&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;myDomainEventCallback2 EVENT: Domain Fed25(1) Suspended \
Paused&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;myDomainEventCallback1 EVENT: Domain Fed25(1) Resumed \
Unpaused&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;myDomainEventCallback2 EVENT: Domain Fed25(1) Resumed \
Unpaused&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;myDomainEventCallback1 EVENT: Domain Fed25(1) Resumed \
Unpaused&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;myDomainEventCallback2 EVENT: Domain Fed25(1) Resumed \
Unpaused&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;myDomainEventCallback1 EVENT: Domain Fed25(1) Shutdown \
Finished&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;myDomainEventCallback2 EVENT: Domain Fed25(1) Shutdown \
Finished&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;myNodeDeviceEventCallback EVENT: Node device net_vnet0_fe_54_00_a0_ba_61 \
Deleted 0&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;Note that the 2 lines printed for each event are ok since 2 callbacks \
are registered in the example.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Has \
anybody else faced this issue?&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;I \
am using libvirt-3.6.0 on Ubuntu 16.04.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Best regards,&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Antoine&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;/div&gt;
&lt;p&gt;--------------------------------------------------------------&lt;br&gt;
Intel Research and Development Ireland Limited&lt;br&gt;
Registered in Ireland&lt;br&gt;
Registered Office: Collinstown Industrial Park, Leixlip, County Kildare&lt;br&gt;
Registered Number: 308263&lt;/p&gt;


&lt;p&gt;This e-mail and any attachments may contain confidential material for the
sole use of the intended recipient(s). Any review or distribution by others is
strictly prohibited. If you are not the intended recipient, please contact the
sender and delete all copies.&lt;/p&gt;

&lt;p&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170823144102</emailId><senderName>Doug Hughes</senderName><senderEmail>doug.hughes@keystonenap.com</senderEmail><timestampReceived>2017-08-23 14:41:02-0400</timestampReceived><subject>[libvirt-users] snapshot anomaly</subject><body>

I'm not sure how this snapshot got created, but, I cannot delete it, and
its presence prevents me from creating other snapshots. I don't know if
it was created by a command gone amok or something else.

# virsh snapshot-list serv1r2
 Name                 Creation Time             State
------------------------------------------------------------
 snap                 2017-01-30 17:01:11 -0500 shutoff

# virsh snapshot-delete serv1r2 snap --disk-only
error: command 'snapshot-delete' doesn't support option --disk-only

# virsh snapshot-dumpxml serv1r2 snap
&lt;domainsnapshot&gt;
  &lt;name&gt;snap&lt;/name&gt;
  &lt;state&gt;shutoff&lt;/state&gt;
  &lt;creationTime&gt;1485813671&lt;/creationTime&gt;
  &lt;memory snapshot='no'/&gt;
  &lt;disks&gt;
    &lt;disk name='vda' snapshot='external' type='file'&gt;
      &lt;driver type='qcow2'/&gt;
      &lt;source file='/*var/lib/libvirt/images/serv1r2-savesnap.qcow2'/*&gt;
    &lt;/disk&gt;
    &lt;disk name='fda' snapshot='no'/&gt;
    &lt;disk name='hda' snapshot='no'/&gt;
  &lt;/disks&gt;

#  ls -l /var/lib/libvirt/images/serv1r2-savesnap.qcow2
ls: cannot access /var/lib/libvirt/images/serv1r2-savesnap.qcow2: No
such file or directory

# virsh snapshot-create-as --domain serv1r2 snap --diskspec
vda,file=/var/lib/libvirt/flashimages/serv1r2-snap.qcow2  --disk-only
--atomic --no-metadata --quiesce
error: internal error: unexpected domain snapshot snap already exists

# virsh snapshot-revert serv1r2 snap
error: unsupported configuration: revert to external snapshot not
supported yet

Any idea for breaking out of this box?



-- 
Doug Hughes
Keystone NAP
Fairless Hills, PA
1.844.KEYBLOCK (539.2562) 	


[Attachment #3 (multipart/related)]

[Attachment #5 (text/html)]

&lt;html&gt;
  &lt;head&gt;

    &lt;meta http-equiv="content-type" content="text/html; charset=utf-8"&gt;
  &lt;/head&gt;
  &lt;body text="#000000" bgcolor="#FFFFFF"&gt;
    &lt;p&gt;I'm not sure how this snapshot got created, but, I cannot delete
      it, and its presence prevents me from creating other snapshots. I
      don't know if it was created by a command gone amok or something
      else.&lt;/p&gt;
    &lt;p&gt;# virsh snapshot-list serv1r2&lt;br&gt;
       Name                 Creation Time             State&lt;br&gt;
      ------------------------------------------------------------&lt;br&gt;
       snap                 2017-01-30 17:01:11 -0500 shutoff&lt;br&gt;
      &lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;# virsh snapshot-delete serv1r2 snap --disk-only&lt;br&gt;
      error: command 'snapshot-delete' doesn't support option
      --disk-only&lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;# virsh snapshot-dumpxml serv1r2 snap&lt;br&gt;
      &lt;domainsnapshot&gt;&lt;br&gt;
        &lt;name&gt;snap&lt;/name&gt;&lt;br&gt;
        &lt;state&gt;shutoff&lt;/state&gt;&lt;br&gt;
        &lt;creationTime&gt;1485813671&lt;/creationTime&gt;&lt;br&gt;
        &lt;memory snapshot='no'/&gt;&lt;br&gt;
        &lt;disks&gt;&lt;br&gt;
          &lt;disk name='vda' snapshot='external' type='file'&gt;&lt;br&gt;
            &lt;driver type='qcow2'/&gt;&lt;br&gt;
            &lt;source file='/&lt;b&gt;var/lib/libvirt/images/serv1r2-savesnap.qcow2'/&lt;/b&gt;&gt;&lt;br&gt;
          &lt;/disk&gt;&lt;br&gt;
          &lt;disk name='fda' snapshot='no'/&gt;&lt;br&gt;
          &lt;disk name='hda' snapshot='no'/&gt;&lt;br&gt;
        &lt;/disks&gt;&lt;/p&gt;
    &lt;p&gt;#  ls -l /var/lib/libvirt/images/serv1r2-savesnap.qcow2&lt;br&gt;
      ls: cannot access /var/lib/libvirt/images/serv1r2-savesnap.qcow2:
      No such file or directory&lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;# virsh snapshot-create-as --domain serv1r2 snap --diskspec
      vda,file=/var/lib/libvirt/flashimages/serv1r2-snap.qcow2 
      --disk-only --atomic --no-metadata --quiesce&lt;br&gt;
      error: internal error: unexpected domain snapshot snap already
      exists&lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;# virsh snapshot-revert serv1r2 snap&lt;br&gt;
      error: unsupported configuration: revert to external snapshot not
      supported yet&lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;Any idea for breaking out of this box?&lt;/p&gt;
    &lt;p&gt;&lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;&lt;br&gt;
    &lt;/p&gt;
    &lt;div class="moz-signature"&gt;-- &lt;br&gt;
      &lt;table&gt;
        &lt;tbody&gt;
          &lt;tr&gt;
            &lt;td style="padding-left: 20px" width="90%"&gt;Doug Hughes&lt;br&gt;
              Keystone NAP&lt;br&gt;
              Fairless Hills, PA&lt;br&gt;
              1.844.KEYBLOCK (539.2562)&lt;/td&gt;
            &lt;td style="align: right;padding-right: 20px"&gt;&lt;img
                src="cid:part1.3DC5EAFC.21EDF5B6@keystonenap.com"&gt;
            &lt;/td&gt;
          &lt;/tr&gt;
        &lt;/tbody&gt;
      &lt;/table&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;

["keystone-nap.png" (image/png)]

</body></email><email><emailId>20170830221022</emailId><senderName>David Ayers</senderName><senderEmail>ayers@fsfe.org</senderEmail><timestampReceived>2017-08-30 22:10:22-0400</timestampReceived><subject>[libvirt-users] network configuration for guest specific dns-servers</subject><body>


Hello,

similar to how one can configure guest specific IP addresses via mac
addresses:
&lt;ip address="192.168.122.1" netmask="255.255.255.0" localPtr="yes"&gt;
  &lt;dhcp&gt;
    &lt;range start="192.168.122.100" end="192.168.122.254"/&gt;
    &lt;host mac="00:16:3e:77:e2:ed" name="foo.example.com" ip="192.168.122.10"/&gt;
    &lt;host mac="00:16:3e:3e:a9:1a" name="bar.example.com" ip="192.168.122.11"/&gt;
  &lt;/dhcp&gt;
&lt;/ip&gt;

We would like to configure guest specific dns-servers as would be done
with the --dhcp-option of dnsmasq.  I was expecting to be able to do
something like:

    &lt;host mac="00:16:3e:77:e2:ed" 
	name="foo.example.com" 
	ip="192.168.122.10" 
	dhcp-option="dns-server,127.0.0.1" /&gt;

but it seems that this isn't the correct approach, as virsh net-edit
default removes that attribute definition.

Could someone point me to the correct documentation?

Thank you!
David Ayers



-- 
David Ayers - Team Austria
Free Software Foundation Europe (FSFE) []          (http://www.fsfe.org)
Join the Fellowship of FSFE!         [][][]      (https://fsfe.org/join)
Your donation powers our work!         ||       (http://fsfe.org/donate)

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170831081134</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-08-31 08:11:34-0400</timestampReceived><subject>Re: [libvirt-users] network configuration for guest specific dns-servers</subject><body>


On Thu, Aug 31, 2017 at 12:10:22AM +0200, David Ayers wrote:
&gt;Hello,
&gt;
&gt;similar to how one can configure guest specific IP addresses via mac
&gt;addresses:
&gt;&lt;ip address="192.168.122.1" netmask="255.255.255.0" localPtr="yes"&gt;
&gt;  &lt;dhcp&gt;
&gt;    &lt;range start="192.168.122.100" end="192.168.122.254"/&gt;
&gt;    &lt;host mac="00:16:3e:77:e2:ed" name="foo.example.com" ip="192.168.122.10"/&gt;
&gt;    &lt;host mac="00:16:3e:3e:a9:1a" name="bar.example.com" ip="192.168.122.11"/&gt;
&gt;  &lt;/dhcp&gt;
&gt;&lt;/ip&gt;
&gt;
&gt;We would like to configure guest specific dns-servers as would be done
&gt;with the --dhcp-option of dnsmasq.  I was expecting to be able to do
&gt;something like:
&gt;
&gt;    &lt;host mac="00:16:3e:77:e2:ed"
&gt;	name="foo.example.com"
&gt;	ip="192.168.122.10"
&gt;	dhcp-option="dns-server,127.0.0.1" /&gt;
&gt;
&gt;but it seems that this isn't the correct approach, as virsh net-edit
&gt;default removes that attribute definition.
&gt;

AFAIK the support for this was not added.  Feel free to request this in
our bugzilla [1] so that we can track it.  Or, even better, send a patch
if you have some time ;) It should not be difficult.

&gt;Could someone point me to the correct documentation?
&gt;

Sure! [2]

&gt;Thank you!
&gt;David Ayers
&gt;

You are welcome.

Martin

[1] https://bugzilla.redhat.com/enter_bug.cgi?product=Virtualization%20Tools&amp;component=libvirt
[2] https://libvirt.org/formatnetwork.html

&gt;
&gt;
&gt;--
&gt;David Ayers - Team Austria
&gt;Free Software Foundation Europe (FSFE) []          (http://www.fsfe.org)
&gt;Join the Fellowship of FSFE!         [][][]      (https://fsfe.org/join)
&gt;Your donation powers our work!         ||       (http://fsfe.org/donate)



&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170831093208</emailId><senderName>David Ayers</senderName><senderEmail>ayers@fsfe.org</senderEmail><timestampReceived>2017-08-31 09:32:08-0400</timestampReceived><subject>Re: [libvirt-users] network configuration for guest specific dns-servers</subject><body>


Thanks a lot, Martin!

Am Donnerstag, den 31.08.2017, 10:11 +0200 schrieb Martin Kletzander:
&gt; On Thu, Aug 31, 2017 at 12:10:22AM +0200, David Ayers wrote:
&gt; &gt;
&gt; &gt;We would like to configure guest specific dns-servers as would be done
&gt; &gt;with the --dhcp-option of dnsmasq.  I was expecting to be able to do
&gt; &gt;something like:
&gt; &gt;
&gt; &gt;    &lt;host mac="00:16:3e:77:e2:ed"
&gt; &gt;	name="foo.example.com"
&gt; &gt;	ip="192.168.122.10"
&gt; &gt;	dhcp-option="dns-server,127.0.0.1" /&gt;
&gt; &gt;
&gt; &gt;but it seems that this isn't the correct approach, as virsh net-edit
&gt; &gt;default removes that attribute definition.
&gt; &gt;
&gt; 
&gt; AFAIK the support for this was not added.  Feel free to request this in
&gt; our bugzilla [1] so that we can track it.  Or, even better, send a patch
&gt; if you have some time ;) It should not be difficult.

Okay, I'll be sure to add it to bugzilla sometime soon.

Your request for a patch implies that this would be a welcome feature
and will not be rediscussed on its principal merit correct?
(implementation details notwithstanding ;-) )

The reason I ask, is that I do not have a development environment ready
for libvirt and there will be quite a bit work before I've read through
all your guidelines, setup a development VM (I suppose that should be
easiest with the latest stable release of Fedora, RHEL or CentOS?)

I'm not sure yet that I can muster up the time, but it does seem
interesting, so a may give it shot.  It would be very disappointing if
it then were rejected on principle.

Thank you!
David

-- 
David Ayers - Team Austria
Free Software Foundation Europe (FSFE) []          (http://www.fsfe.org)
Join the Fellowship of FSFE!         [][][]      (https://fsfe.org/join)
Your donation powers our work!         ||       (http://fsfe.org/donate)

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170831110914</emailId><senderName>David Ayers</senderName><senderEmail>ayers@fsfe.org</senderEmail><timestampReceived>2017-08-31 11:09:14-0400</timestampReceived><subject>Re: [libvirt-users] network configuration for guest specific dns-servers</subject><body>


Am Donnerstag, den 31.08.2017, 11:32 +0200 schrieb David Ayers:
&gt; 
&gt; Am Donnerstag, den 31.08.2017, 10:11 +0200 schrieb Martin Kletzander:
&gt; &gt; 
&gt; &gt; AFAIK the support for this was not added.  Feel free to request this in
&gt; &gt; our bugzilla [1] so that we can track it.  Or, even better, send a patch
&gt; &gt; if you have some time ;) It should not be difficult.
&gt; 
&gt; Okay, I'll be sure to add it to bugzilla sometime soon.

Actually, this was already reported (on the last day of 2010):
https://bugzilla.redhat.com/show_bug.cgi?id=666556
and seems to restated (two years later) in:
https://bugzilla.redhat.com/show_bug.cgi?id=824573

and by the looks of this, generic dhcp options at global scope are
already contentious, let alone at host scope.

So I guess we my stop configuring dnsmasq via libvirt.

Cheers,
David


-- 
David Ayers - Team Austria
Free Software Foundation Europe (FSFE) []          (http://www.fsfe.org)
Join the Fellowship of FSFE!         [][][]      (https://fsfe.org/join)
Your donation powers our work!         ||       (http://fsfe.org/donate)

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170823145007</emailId><senderName>Sakhi Hadebe</senderName><senderEmail>sakhi@sanren.ac.za</senderEmail><timestampReceived>2017-08-23 14:50:07-0400</timestampReceived><subject>Re: [libvirt-users] snapshot anomaly</subject><body>

[Attachment #2 (multipart/alternative)]


Hi,

Can you try this command:
virsh snapshot-delete serv1r2 snap --metadata




On Wed, Aug 23, 2017 at 4:41 PM, Doug Hughes &lt;doug.hughes@keystonenap.com&gt;
wrote:

&gt; I'm not sure how this snapshot got created, but, I cannot delete it, and
&gt; its presence prevents me from creating other snapshots. I don't know if it
&gt; was created by a command gone amok or something else.
&gt;
&gt; # virsh snapshot-list serv1r2
&gt;  Name                 Creation Time             State
&gt; ------------------------------------------------------------
&gt;  snap                 2017-01-30 17:01:11 -0500 shutoff
&gt;
&gt; # virsh snapshot-delete serv1r2 snap --disk-only
&gt; error: command 'snapshot-delete' doesn't support option --disk-only
&gt;
&gt; # virsh snapshot-dumpxml serv1r2 snap
&gt; &lt;domainsnapshot&gt;
&gt;   &lt;name&gt;snap&lt;/name&gt;
&gt;   &lt;state&gt;shutoff&lt;/state&gt;
&gt;   &lt;creationTime&gt;1485813671&lt;/creationTime&gt;
&gt;   &lt;memory snapshot='no'/&gt;
&gt;   &lt;disks&gt;
&gt;     &lt;disk name='vda' snapshot='external' type='file'&gt;
&gt;       &lt;driver type='qcow2'/&gt;
&gt;       &lt;source file='/*var/lib/libvirt/images/serv1r2-savesnap.qcow2'/*&gt;
&gt;     &lt;/disk&gt;
&gt;     &lt;disk name='fda' snapshot='no'/&gt;
&gt;     &lt;disk name='hda' snapshot='no'/&gt;
&gt;   &lt;/disks&gt;
&gt;
&gt; #  ls -l /var/lib/libvirt/images/serv1r2-savesnap.qcow2
&gt; ls: cannot access /var/lib/libvirt/images/serv1r2-savesnap.qcow2: No such
&gt; file or directory
&gt;
&gt; # virsh snapshot-create-as --domain serv1r2 snap --diskspec
&gt; vda,file=/var/lib/libvirt/flashimages/serv1r2-snap.qcow2  --disk-only
&gt; --atomic --no-metadata --quiesce
&gt; error: internal error: unexpected domain snapshot snap already exists
&gt;
&gt; # virsh snapshot-revert serv1r2 snap
&gt; error: unsupported configuration: revert to external snapshot not
&gt; supported yet
&gt;
&gt; Any idea for breaking out of this box?
&gt;
&gt;
&gt;
&gt; --
&gt; Doug Hughes
&gt; Keystone NAP
&gt; Fairless Hills, PA
&gt; 1.844.KEYBLOCK (539.2562)
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;



-- 
Regards,
Sakhi Hadebe

Engineer: South African National Research Network (SANReN)Competency
Area, Meraka, CSIR

Tel:   +27 12 841 2308 &lt;+27128414213&gt;
Fax:   +27 12 841 4223 &lt;+27128414223&gt;
Cell:  +27 71 331 9622 &lt;+27823034657&gt;
Email: sakhi@sanren.ac.za &lt;shadebe@csir.co.za&gt;

[Attachment #5 (text/html)]

&lt;div dir="ltr"&gt;&lt;div class="gmail_default" style="font-family:"trebuchet \
ms",sans-serif"&gt;Hi,&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:"trebuchet ms",sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:"trebuchet ms",sans-serif"&gt;Can you \
try this command:&lt;/div&gt;&lt;div class="gmail_default"&gt;&lt;font face="trebuchet ms, \
sans-serif"&gt;virsh snapshot-delete  &lt;/font&gt;&lt;span style="font-size:12.8px"&gt;serv1r2 \
snap&lt;/span&gt;&lt;span style="font-family:"trebuchet ms",sans-serif"&gt;  \
--metadata&lt;/span&gt;&lt;/div&gt;&lt;div class="gmail_default"&gt;&lt;span \
style="font-family:"trebuchet ms",sans-serif"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div \
class="gmail_default"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default"&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;On Wed, Aug 23, 2017 at 4:41 PM, \
Doug Hughes &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:doug.hughes@keystonenap.com" \
target="_blank"&gt;doug.hughes@keystonenap.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;  

    
  
  &lt;div text="#000000" bgcolor="#FFFFFF"&gt;
    &lt;p&gt;I'm not sure how this snapshot got created, but, I cannot delete
      it, and its presence prevents me from creating other snapshots. I
      don't know if it was created by a command gone amok or something
      else.&lt;/p&gt;
    &lt;p&gt;# virsh snapshot-list serv1r2&lt;br&gt;
        Name                                 Creation Time                         \
                State&lt;br&gt;
      ------------------------------&lt;wbr&gt;------------------------------&lt;br&gt;
        snap                                 2017-01-30 17:01:11 -0500 shutoff&lt;br&gt;
      &lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;# virsh snapshot-delete serv1r2 snap --disk-only&lt;br&gt;
      error: command 'snapshot-delete' doesn't support option
      --disk-only&lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;# virsh snapshot-dumpxml serv1r2 snap&lt;br&gt;
      &lt;domainsnapshot&gt;&lt;br&gt;
         &lt;name&gt;snap&lt;/name&gt;&lt;br&gt;
         &lt;state&gt;shutoff&lt;/state&gt;&lt;br&gt;
         &lt;creationTime&gt;1485813671&lt;/&lt;wbr&gt;creationTime&gt;&lt;br&gt;
         &lt;memory snapshot='no'/&gt;&lt;br&gt;
         &lt;disks&gt;&lt;br&gt;
             &lt;disk name='vda' snapshot='external' \
type='file'&gt;&lt;br&gt;  &lt;driver type='qcow2'/&gt;&lt;br&gt;
                 &lt;source \
file='/&lt;b&gt;var/lib/libvirt/images/&lt;wbr&gt;serv1r2-savesnap.qcow2'/&lt;/b&gt;&gt;&lt;br&gt;  \
&lt;/disk&gt;&lt;br&gt;  &lt;disk name='fda' snapshot='no'/&gt;&lt;br&gt;
             &lt;disk name='hda' snapshot='no'/&gt;&lt;br&gt;
         &lt;/disks&gt;&lt;/p&gt;
    &lt;p&gt;#   ls -l /var/lib/libvirt/images/&lt;wbr&gt;serv1r2-savesnap.qcow2&lt;br&gt;
      ls: cannot access /var/lib/libvirt/images/&lt;wbr&gt;serv1r2-savesnap.qcow2:
      No such file or directory&lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;# virsh snapshot-create-as --domain serv1r2 snap --diskspec
      vda,file=/var/lib/libvirt/&lt;wbr&gt;flashimages/serv1r2-snap.&lt;wbr&gt;qcow2  
      --disk-only --atomic --no-metadata --quiesce&lt;br&gt;
      error: internal error: unexpected domain snapshot snap already
      exists&lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;# virsh snapshot-revert serv1r2 snap&lt;br&gt;
      error: unsupported configuration: revert to external snapshot not
      supported yet&lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;Any idea for breaking out of this box?&lt;/p&gt;&lt;span class="HOEnZb"&gt;&lt;font \
color="#888888"&gt;  &lt;p&gt;&lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;&lt;br&gt;
    &lt;/p&gt;
    &lt;div class="m_-7776500251940886334moz-signature"&gt;-- &lt;br&gt;
      &lt;table&gt;
        &lt;tbody&gt;
          &lt;tr&gt;
            &lt;td style="padding-left:20px" width="90%"&gt;Doug Hughes&lt;br&gt;
              Keystone NAP&lt;br&gt;
              Fairless Hills, PA&lt;br&gt;
              1.844.KEYBLOCK (539.2562)&lt;/td&gt;
            &lt;td style="padding-right:20px"&gt;&lt;img \
src="cid:part1.3DC5EAFC.21EDF5B6@keystonenap.com"&gt;  &lt;/td&gt;
          &lt;/tr&gt;
        &lt;/tbody&gt;
      &lt;/table&gt;
    &lt;/div&gt;
  &lt;/font&gt;&lt;/span&gt;&lt;/div&gt;

&lt;br&gt;______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;
&lt;a href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/&lt;wbr&gt;mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br \
clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- &lt;br&gt;&lt;div class="gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div dir="ltr"&gt;&lt;div \
cols="72"&gt;&lt;font size="2" face="trebuchet ms, sans-serif"&gt;Regards,&lt;/font&gt;&lt;/div&gt; &lt;div \
cols="72"&gt;&lt;font size="2" face="trebuchet ms, sans-serif"&gt;Sakhi  \
Hadebe&lt;/font&gt;&lt;/div&gt;&lt;pre cols="72"&gt;&lt;font face="trebuchet ms, sans-serif" \
size="2"&gt;Engineer: South African National Research Network (SANReN)Competency Area, \
Meraka, CSIR  
Tel:   &lt;a href="tel:+27128414213" target="_blank"&gt;+27 12 841 2308&lt;/a&gt;
Fax:   &lt;a href="tel:+27128414223" target="_blank"&gt;+27 12 841 4223&lt;/a&gt;
Cell:  &lt;a href="tel:+27823034657" target="_blank"&gt;+27 71 331 9622&lt;/a&gt;
Email: &lt;a href="mailto:shadebe@csir.co.za" \
target="_blank"&gt;sakhi@sanren.ac.za&lt;/a&gt;&lt;/font&gt; &lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;

--001a114496362ec5b205576cd564--


["keystone-nap.png" (image/png)]

</body></email><email><emailId>20170823145628</emailId><senderName>Doug Hughes</senderName><senderEmail>doug.hughes@keystonenap.com</senderEmail><timestampReceived>2017-08-23 14:56:28-0400</timestampReceived><subject>Re: [libvirt-users] snapshot anomaly</subject><body>

THat did it! Can you esplain what was going on and how that fixed it? Thanks


On 8/23/2017 10:50 AM, Sakhi Hadebe wrote:
&gt; Hi,
&gt;
&gt; Can you try this command:
&gt; virsh snapshot-delete serv1r2 snap --metadata
&gt;
&gt;
&gt;
&gt;
&gt; On Wed, Aug 23, 2017 at 4:41 PM, Doug Hughes
&gt; &lt;doug.hughes@keystonenap.com &lt;mailto:doug.hughes@keystonenap.com&gt;&gt; wrote:
&gt;
&gt;     I'm not sure how this snapshot got created, but, I cannot delete
&gt;     it, and its presence prevents me from creating other snapshots. I
&gt;     don't know if it was created by a command gone amok or something else.
&gt;
&gt;     # virsh snapshot-list serv1r2
&gt;      Name                 Creation Time             State
&gt;     ------------------------------------------------------------
&gt;      snap                 2017-01-30 17:01:11 -0500 shutoff
&gt;
&gt;     # virsh snapshot-delete serv1r2 snap --disk-only
&gt;     error: command 'snapshot-delete' doesn't support option --disk-only
&gt;
&gt;     # virsh snapshot-dumpxml serv1r2 snap
&gt;     &lt;domainsnapshot&gt;
&gt;       &lt;name&gt;snap&lt;/name&gt;
&gt;       &lt;state&gt;shutoff&lt;/state&gt;
&gt;       &lt;creationTime&gt;1485813671&lt;/creationTime&gt;
&gt;       &lt;memory snapshot='no'/&gt;
&gt;       &lt;disks&gt;
&gt;         &lt;disk name='vda' snapshot='external' type='file'&gt;
&gt;           &lt;driver type='qcow2'/&gt;
&gt;           &lt;source
&gt;     file='/*var/lib/libvirt/images/serv1r2-savesnap.qcow2'/*&gt;
&gt;         &lt;/disk&gt;
&gt;         &lt;disk name='fda' snapshot='no'/&gt;
&gt;         &lt;disk name='hda' snapshot='no'/&gt;
&gt;       &lt;/disks&gt;
&gt;
&gt;     #  ls -l /var/lib/libvirt/images/serv1r2-savesnap.qcow2
&gt;     ls: cannot access /var/lib/libvirt/images/serv1r2-savesnap.qcow2:
&gt;     No such file or directory
&gt;
&gt;     # virsh snapshot-create-as --domain serv1r2 snap --diskspec
&gt;     vda,file=/var/lib/libvirt/flashimages/serv1r2-snap.qcow2 
&gt;     --disk-only --atomic --no-metadata --quiesce
&gt;     error: internal error: unexpected domain snapshot snap already exists
&gt;
&gt;     # virsh snapshot-revert serv1r2 snap
&gt;     error: unsupported configuration: revert to external snapshot not
&gt;     supported yet
&gt;
&gt;     Any idea for breaking out of this box?
&gt;
&gt;
&gt;
&gt;     -- 
&gt;     Doug Hughes
&gt;     Keystone NAP
&gt;     Fairless Hills, PA
&gt;     1.844.KEYBLOCK (539.2562) 	
&gt;
&gt;
&gt;     _______________________________________________
&gt;     libvirt-users mailing list
&gt;     libvirt-users@redhat.com &lt;mailto:libvirt-users@redhat.com&gt;
&gt;     https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;     &lt;https://www.redhat.com/mailman/listinfo/libvirt-users&gt;
&gt;
&gt;
&gt;
&gt;
&gt; -- 
&gt; Regards,
&gt; Sakhi Hadebe
&gt; Engineer: South African National Research Network (SANReN)Competency
&gt; Area, Meraka, CSIR Tel: +27 12 841 2308 &lt;tel:+27128414213&gt; Fax: +27 12
&gt; 841 4223 &lt;tel:+27128414223&gt; Cell: +27 71 331 9622 &lt;tel:+27823034657&gt;
&gt; Email: sakhi@sanren.ac.za &lt;mailto:shadebe@csir.co.za&gt;

-- 
Doug Hughes
Keystone NAP
Fairless Hills, PA
1.844.KEYBLOCK (539.2562) 	


[Attachment #3 (multipart/related)]

[Attachment #5 (text/html)]

&lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
  &lt;/head&gt;
  &lt;body text="#000000" bgcolor="#FFFFFF"&gt;
    &lt;p&gt;THat did it! Can you esplain what was going on and how that fixed
      it? Thanks&lt;br&gt;
    &lt;/p&gt;
    &lt;br&gt;
    &lt;div class="moz-cite-prefix"&gt;On 8/23/2017 10:50 AM, Sakhi Hadebe
      wrote:&lt;br&gt;
    &lt;/div&gt;
    &lt;blockquote type="cite"
cite="mid:CAJ9ctEn-KNNR7x5B-+=mGavAUStvKTRN3J-DYhsXTQUp9GKXKg@mail.gmail.com"&gt;
      &lt;div dir="ltr"&gt;
        &lt;div class="gmail_default" style="font-family:"trebuchet
          ms",sans-serif"&gt;Hi,&lt;/div&gt;
        &lt;div class="gmail_default" style="font-family:"trebuchet
          ms",sans-serif"&gt;&lt;br&gt;
        &lt;/div&gt;
        &lt;div class="gmail_default" style="font-family:"trebuchet
          ms",sans-serif"&gt;Can you try this command:&lt;/div&gt;
        &lt;div class="gmail_default"&gt;&lt;font face="trebuchet ms, sans-serif"&gt;virsh
            snapshot-delete &lt;/font&gt;&lt;span style="font-size:12.8px"&gt;serv1r2
            snap&lt;/span&gt;&lt;span style="font-family:"trebuchet
            ms",sans-serif"&gt; --metadata&lt;/span&gt;&lt;/div&gt;
        &lt;div class="gmail_default"&gt;&lt;span
            style="font-family:"trebuchet ms",sans-serif"&gt;&lt;br&gt;
          &lt;/span&gt;&lt;/div&gt;
        &lt;div class="gmail_default"&gt;&lt;br&gt;
        &lt;/div&gt;
        &lt;div class="gmail_default"&gt;&lt;br&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="gmail_extra"&gt;&lt;br&gt;
        &lt;div class="gmail_quote"&gt;On Wed, Aug 23, 2017 at 4:41 PM, Doug
          Hughes &lt;span dir="ltr"&gt;&lt;&lt;a
              href="mailto:doug.hughes@keystonenap.com" target="_blank"
              moz-do-not-send="true"&gt;doug.hughes@keystonenap.com&lt;/a&gt;&gt;&lt;/span&gt;
          wrote:&lt;br&gt;
          &lt;blockquote class="gmail_quote" style="margin:0 0 0
            .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;
            &lt;div text="#000000" bgcolor="#FFFFFF"&gt;
              &lt;p&gt;I'm not sure how this snapshot got created, but, I
                cannot delete it, and its presence prevents me from
                creating other snapshots. I don't know if it was created
                by a command gone amok or something else.&lt;/p&gt;
              &lt;p&gt;# virsh snapshot-list serv1r2&lt;br&gt;
                 Name                 Creation Time             State&lt;br&gt;
                ------------------------------&lt;wbr&gt;------------------------------&lt;br&gt;
                 snap                 2017-01-30 17:01:11 -0500 shutoff&lt;br&gt;
                &lt;br&gt;
              &lt;/p&gt;
              &lt;p&gt;# virsh snapshot-delete serv1r2 snap --disk-only&lt;br&gt;
                error: command 'snapshot-delete' doesn't support option
                --disk-only&lt;br&gt;
              &lt;/p&gt;
              &lt;p&gt;# virsh snapshot-dumpxml serv1r2 snap&lt;br&gt;
                &lt;domainsnapshot&gt;&lt;br&gt;
                  &lt;name&gt;snap&lt;/name&gt;&lt;br&gt;
                  &lt;state&gt;shutoff&lt;/state&gt;&lt;br&gt;
                  &lt;creationTime&gt;1485813671&lt;/&lt;wbr&gt;creationTime&gt;&lt;br&gt;
                  &lt;memory snapshot='no'/&gt;&lt;br&gt;
                  &lt;disks&gt;&lt;br&gt;
                    &lt;disk name='vda' snapshot='external'
                type='file'&gt;&lt;br&gt;
                      &lt;driver type='qcow2'/&gt;&lt;br&gt;
                      &lt;source \
file='/&lt;b&gt;var/lib/libvirt/images/&lt;wbr&gt;serv1r2-savesnap.qcow2'/&lt;/b&gt;&gt;&lt;br&gt;  \
&lt;/disk&gt;&lt;br&gt;  &lt;disk name='fda' snapshot='no'/&gt;&lt;br&gt;
                    &lt;disk name='hda' snapshot='no'/&gt;&lt;br&gt;
                  &lt;/disks&gt;&lt;/p&gt;
              &lt;p&gt;#  ls -l /var/lib/libvirt/images/&lt;wbr&gt;serv1r2-savesnap.qcow2&lt;br&gt;
                ls: cannot access \
/var/lib/libvirt/images/&lt;wbr&gt;serv1r2-savesnap.qcow2:  No such file or directory&lt;br&gt;
              &lt;/p&gt;
              &lt;p&gt;# virsh snapshot-create-as --domain serv1r2 snap
                --diskspec \
                vda,file=/var/lib/libvirt/&lt;wbr&gt;flashimages/serv1r2-snap.&lt;wbr&gt;qcow2 
                --disk-only --atomic --no-metadata --quiesce&lt;br&gt;
                error: internal error: unexpected domain snapshot snap
                already exists&lt;br&gt;
              &lt;/p&gt;
              &lt;p&gt;# virsh snapshot-revert serv1r2 snap&lt;br&gt;
                error: unsupported configuration: revert to external
                snapshot not supported yet&lt;br&gt;
              &lt;/p&gt;
              &lt;p&gt;Any idea for breaking out of this box?&lt;/p&gt;
              &lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;
                  &lt;p&gt;&lt;br&gt;
                  &lt;/p&gt;
                  &lt;p&gt;&lt;br&gt;
                  &lt;/p&gt;
                  &lt;div class="m_-7776500251940886334moz-signature"&gt;-- &lt;br&gt;
                    &lt;table&gt;
                      &lt;tbody&gt;
                        &lt;tr&gt;
                          &lt;td style="padding-left:20px" width="90%"&gt;Doug
                            Hughes&lt;br&gt;
                            Keystone NAP&lt;br&gt;
                            Fairless Hills, PA&lt;br&gt;
                            1.844.KEYBLOCK (539.2562)&lt;/td&gt;
                          &lt;td style="padding-right:20px"&gt;&lt;img
                              src="cid:part2.883608D6.7C9CE2B8@keystonenap.com"
                              class=""&gt; &lt;/td&gt;
                        &lt;/tr&gt;
                      &lt;/tbody&gt;
                    &lt;/table&gt;
                  &lt;/div&gt;
                &lt;/font&gt;&lt;/span&gt;&lt;/div&gt;
            &lt;br&gt;
            ______________________________&lt;wbr&gt;_________________&lt;br&gt;
            libvirt-users mailing list&lt;br&gt;
            &lt;a href="mailto:libvirt-users@redhat.com"
              moz-do-not-send="true"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;
            &lt;a
              href="https://www.redhat.com/mailman/listinfo/libvirt-users"
              rel="noreferrer" target="_blank" \
moz-do-not-send="true"&gt;https://www.redhat.com/&lt;wbr&gt;mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;
  &lt;/blockquote&gt;
        &lt;/div&gt;
        &lt;br&gt;
        &lt;br clear="all"&gt;
        &lt;div&gt;&lt;br&gt;
        &lt;/div&gt;
        -- &lt;br&gt;
        &lt;div class="gmail_signature" data-smartmail="gmail_signature"&gt;
          &lt;div dir="ltr"&gt;
            &lt;div&gt;
              &lt;div dir="ltr"&gt;
                &lt;div cols="72"&gt;&lt;font size="2" face="trebuchet ms,
                    sans-serif"&gt;Regards,&lt;/font&gt;&lt;/div&gt;
                &lt;div cols="72"&gt;&lt;font size="2" face="trebuchet ms,
                    sans-serif"&gt;Sakhi Hadebe&lt;/font&gt;&lt;/div&gt;
                &lt;pre cols="72"&gt;&lt;font size="2" face="trebuchet ms, \
sans-serif"&gt;Engineer: South African National Research Network (SANReN)Competency \
Area, Meraka, CSIR  
Tel:   &lt;a href="tel:+27128414213" target="_blank" moz-do-not-send="true"&gt;+27 12 841 \
                2308&lt;/a&gt;
Fax:   &lt;a href="tel:+27128414223" target="_blank" moz-do-not-send="true"&gt;+27 12 841 \
                4223&lt;/a&gt;
Cell:  &lt;a href="tel:+27823034657" target="_blank" moz-do-not-send="true"&gt;+27 71 331 \
                9622&lt;/a&gt;
Email: &lt;a href="mailto:shadebe@csir.co.za" target="_blank" \
moz-do-not-send="true"&gt;sakhi@sanren.ac.za&lt;/a&gt;&lt;/font&gt; &lt;/pre&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
    &lt;div class="moz-signature"&gt;-- &lt;br&gt;
      &lt;table&gt;
        &lt;tbody&gt;
          &lt;tr&gt;
            &lt;td style="padding-left: 20px" width="90%"&gt;Doug Hughes&lt;br&gt;
              Keystone NAP&lt;br&gt;
              Fairless Hills, PA&lt;br&gt;
              1.844.KEYBLOCK (539.2562)&lt;/td&gt;
            &lt;td style="align: right;padding-right: 20px"&gt;&lt;img
                src="cid:part2.883608D6.7C9CE2B8@keystonenap.com"&gt;
            &lt;/td&gt;
          &lt;/tr&gt;
        &lt;/tbody&gt;
      &lt;/table&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;


["keystone-nap.png" (image/png)]

</body></email><email><emailId>20170823150930</emailId><senderName>Sakhi Hadebe</senderName><senderEmail>sakhi@sanren.ac.za</senderEmail><timestampReceived>2017-08-23 15:09:30-0400</timestampReceived><subject>Re: [libvirt-users] snapshot anomaly</subject><body>

[Attachment #2 (multipart/alternative)]


I had the same problem yesterday. I found the solution from this article
https://kashyapc.fedorapeople.org/virt/lc-2012/snapshots-handout.html.
According to the article it deletes the tracking metadata by libvirt.

You can physically remove the snapshot now that there is no tracking stream
data by libvirt

On Wed, Aug 23, 2017 at 4:56 PM, Doug Hughes &lt;doug.hughes@keystonenap.com&gt;
wrote:

&gt; THat did it! Can you esplain what was going on and how that fixed it?
&gt; Thanks
&gt;
&gt; On 8/23/2017 10:50 AM, Sakhi Hadebe wrote:
&gt;
&gt; Hi,
&gt;
&gt; Can you try this command:
&gt; virsh snapshot-delete serv1r2 snap --metadata
&gt;
&gt;
&gt;
&gt;
&gt; On Wed, Aug 23, 2017 at 4:41 PM, Doug Hughes &lt;doug.hughes@keystonenap.com&gt;
&gt; wrote:
&gt;
&gt;&gt; I'm not sure how this snapshot got created, but, I cannot delete it, and
&gt;&gt; its presence prevents me from creating other snapshots. I don't know if it
&gt;&gt; was created by a command gone amok or something else.
&gt;&gt;
&gt;&gt; # virsh snapshot-list serv1r2
&gt;&gt;  Name                 Creation Time             State
&gt;&gt; ------------------------------------------------------------
&gt;&gt;  snap                 2017-01-30 17:01:11 -0500 shutoff
&gt;&gt;
&gt;&gt; # virsh snapshot-delete serv1r2 snap --disk-only
&gt;&gt; error: command 'snapshot-delete' doesn't support option --disk-only
&gt;&gt;
&gt;&gt; # virsh snapshot-dumpxml serv1r2 snap
&gt;&gt; &lt;domainsnapshot&gt;
&gt;&gt;   &lt;name&gt;snap&lt;/name&gt;
&gt;&gt;   &lt;state&gt;shutoff&lt;/state&gt;
&gt;&gt;   &lt;creationTime&gt;1485813671&lt;/creationTime&gt;
&gt;&gt;   &lt;memory snapshot='no'/&gt;
&gt;&gt;   &lt;disks&gt;
&gt;&gt;     &lt;disk name='vda' snapshot='external' type='file'&gt;
&gt;&gt;       &lt;driver type='qcow2'/&gt;
&gt;&gt;       &lt;source file='/*var/lib/libvirt/images/serv1r2-savesnap.qcow2'/*&gt;
&gt;&gt;     &lt;/disk&gt;
&gt;&gt;     &lt;disk name='fda' snapshot='no'/&gt;
&gt;&gt;     &lt;disk name='hda' snapshot='no'/&gt;
&gt;&gt;   &lt;/disks&gt;
&gt;&gt;
&gt;&gt; #  ls -l /var/lib/libvirt/images/serv1r2-savesnap.qcow2
&gt;&gt; ls: cannot access /var/lib/libvirt/images/serv1r2-savesnap.qcow2: No
&gt;&gt; such file or directory
&gt;&gt;
&gt;&gt; # virsh snapshot-create-as --domain serv1r2 snap --diskspec
&gt;&gt; vda,file=/var/lib/libvirt/flashimages/serv1r2-snap.qcow2  --disk-only
&gt;&gt; --atomic --no-metadata --quiesce
&gt;&gt; error: internal error: unexpected domain snapshot snap already exists
&gt;&gt;
&gt;&gt; # virsh snapshot-revert serv1r2 snap
&gt;&gt; error: unsupported configuration: revert to external snapshot not
&gt;&gt; supported yet
&gt;&gt;
&gt;&gt; Any idea for breaking out of this box?
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Doug Hughes
&gt;&gt; Keystone NAP
&gt;&gt; Fairless Hills, PA
&gt;&gt; 1.844.KEYBLOCK (539.2562)
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; libvirt-users mailing list
&gt;&gt; libvirt-users@redhat.com
&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Regards,
&gt; Sakhi Hadebe
&gt;
&gt; Engineer: South African National Research Network (SANReN)Competency Area, Meraka, CSIR
&gt;
&gt; Tel:   +27 12 841 2308 &lt;+27128414213&gt;
&gt; Fax:   +27 12 841 4223 &lt;+27128414223&gt;
&gt; Cell:  +27 71 331 9622 &lt;+27823034657&gt;
&gt; Email: sakhi@sanren.ac.za &lt;shadebe@csir.co.za&gt;
&gt;
&gt;
&gt; --
&gt; Doug Hughes
&gt; Keystone NAP
&gt; Fairless Hills, PA
&gt; 1.844.KEYBLOCK (539.2562)
&gt;



-- 
Regards,
Sakhi Hadebe

Engineer: South African National Research Network (SANReN)Competency
Area, Meraka, CSIR

Tel:   +27 12 841 2308 &lt;+27128414213&gt;
Fax:   +27 12 841 4223 &lt;+27128414223&gt;
Cell:  +27 71 331 9622 &lt;+27823034657&gt;
Email: sakhi@sanren.ac.za &lt;shadebe@csir.co.za&gt;

[Attachment #5 (text/html)]

&lt;div dir="ltr"&gt;&lt;div class="gmail_default" style="font-family:"trebuchet \
ms",sans-serif"&gt;I had the same problem yesterday. I found the solution from this \
article &lt;a href="https://kashyapc.fedorapeople.org/virt/lc-2012/snapshots-handout.html"&gt;https://kashyapc.fedorapeople.org/virt/lc-2012/snapshots-handout.html&lt;/a&gt;. \
According to the article it deletes the tracking metadata by libvirt.&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:"trebuchet \
ms",sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:"trebuchet ms",sans-serif"&gt;You can physically remove the \
snapshot now that there is no tracking stream data by libvirt&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;On Wed, Aug 23, 2017 at 4:56 PM, \
Doug Hughes &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:doug.hughes@keystonenap.com" \
target="_blank"&gt;doug.hughes@keystonenap.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;  
    
  
  &lt;div text="#000000" bgcolor="#FFFFFF"&gt;
    &lt;p&gt;THat did it! Can you esplain what was going on and how that fixed
      it? Thanks&lt;br&gt;
    &lt;/p&gt;&lt;div&gt;&lt;div class="h5"&gt;
    &lt;br&gt;
    &lt;div class="m_-3364292027163180564moz-cite-prefix"&gt;On 8/23/2017 10:50 AM, Sakhi \
Hadebe  wrote:&lt;br&gt;
    &lt;/div&gt;
    &lt;blockquote type="cite"&gt;
      &lt;div dir="ltr"&gt;
        &lt;div class="gmail_default"&gt;Hi,&lt;/div&gt;
        &lt;div class="gmail_default"&gt;&lt;br&gt;
        &lt;/div&gt;
        &lt;div class="gmail_default"&gt;Can you try this command:&lt;/div&gt;
        &lt;div class="gmail_default"&gt;&lt;font face="trebuchet ms, sans-serif"&gt;virsh
            snapshot-delete  &lt;/font&gt;&lt;span style="font-size:12.8px"&gt;serv1r2
            snap&lt;/span&gt;&lt;span&gt;  --metadata&lt;/span&gt;&lt;/div&gt;
        &lt;div class="gmail_default"&gt;&lt;span style="font-family:"trebuchet \
ms",sans-serif"&gt;&lt;br&gt;  &lt;/span&gt;&lt;/div&gt;
        &lt;div class="gmail_default"&gt;&lt;br&gt;
        &lt;/div&gt;
        &lt;div class="gmail_default"&gt;&lt;br&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="gmail_extra"&gt;&lt;br&gt;
        &lt;div class="gmail_quote"&gt;On Wed, Aug 23, 2017 at 4:41 PM, Doug
          Hughes &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:doug.hughes@keystonenap.com" \
target="_blank"&gt;doug.hughes@keystonenap.com&lt;/a&gt;&gt;&lt;/span&gt;  wrote:&lt;br&gt;
          &lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px \
#ccc solid;padding-left:1ex"&gt;  &lt;div text="#000000" bgcolor="#FFFFFF"&gt;
              &lt;p&gt;I'm not sure how this snapshot got created, but, I
                cannot delete it, and its presence prevents me from
                creating other snapshots. I don't know if it was created
                by a command gone amok or something else.&lt;/p&gt;
              &lt;p&gt;# virsh snapshot-list serv1r2&lt;br&gt;
                  Name                                 Creation Time                  \
                State&lt;br&gt;
                ------------------------------&lt;wbr&gt;------------------------------&lt;br&gt;
                  snap                                 2017-01-30 17:01:11 -0500 \
shutoff&lt;br&gt;  &lt;br&gt;
              &lt;/p&gt;
              &lt;p&gt;# virsh snapshot-delete serv1r2 snap --disk-only&lt;br&gt;
                error: command 'snapshot-delete' doesn't support option
                --disk-only&lt;br&gt;
              &lt;/p&gt;
              &lt;p&gt;# virsh snapshot-dumpxml serv1r2 snap&lt;br&gt;
                &lt;domainsnapshot&gt;&lt;br&gt;
                   &lt;name&gt;snap&lt;/name&gt;&lt;br&gt;
                   &lt;state&gt;shutoff&lt;/state&gt;&lt;br&gt;
                   &lt;creationTime&gt;1485813671&lt;/crea&lt;wbr&gt;tionTime&gt;&lt;br&gt;
                   &lt;memory snapshot='no'/&gt;&lt;br&gt;
                   &lt;disks&gt;&lt;br&gt;
                       &lt;disk name='vda' snapshot='external'
                type='file'&gt;&lt;br&gt;
                           &lt;driver type='qcow2'/&gt;&lt;br&gt;
                           &lt;source \
file='/&lt;b&gt;var/lib/libvirt/images/&lt;wbr&gt;serv1r2-savesnap.qcow2'/&lt;/b&gt;&gt;&lt;br&gt;  \
                &lt;/disk&gt;&lt;br&gt;
                       &lt;disk name='fda' snapshot='no'/&gt;&lt;br&gt;
                       &lt;disk name='hda' snapshot='no'/&gt;&lt;br&gt;
                   &lt;/disks&gt;&lt;/p&gt;
              &lt;p&gt;#   ls -l /var/lib/libvirt/images/serv1r&lt;wbr&gt;2-savesnap.qcow2&lt;br&gt;
                ls: cannot access \
/var/lib/libvirt/images/serv1r&lt;wbr&gt;2-savesnap.qcow2:  No such file or directory&lt;br&gt;
              &lt;/p&gt;
              &lt;p&gt;# virsh snapshot-create-as --domain serv1r2 snap
                --diskspec \
                vda,file=/var/lib/libvirt/flas&lt;wbr&gt;himages/serv1r2-snap.qcow2  
                --disk-only --atomic --no-metadata --quiesce&lt;br&gt;
                error: internal error: unexpected domain snapshot snap
                already exists&lt;br&gt;
              &lt;/p&gt;
              &lt;p&gt;# virsh snapshot-revert serv1r2 snap&lt;br&gt;
                error: unsupported configuration: revert to external
                snapshot not supported yet&lt;br&gt;
              &lt;/p&gt;
              &lt;p&gt;Any idea for breaking out of this box?&lt;/p&gt;
              &lt;span class="m_-3364292027163180564HOEnZb"&gt;&lt;font color="#888888"&gt;
                  &lt;p&gt;&lt;br&gt;
                  &lt;/p&gt;
                  &lt;p&gt;&lt;br&gt;
                  &lt;/p&gt;
                  &lt;div \
class="m_-3364292027163180564m_-7776500251940886334moz-signature"&gt;-- &lt;br&gt;  &lt;table&gt;
                      &lt;tbody&gt;
                        &lt;tr&gt;
                          &lt;td style="padding-left:20px" width="90%"&gt;Doug
                            Hughes&lt;br&gt;
                            Keystone NAP&lt;br&gt;
                            Fairless Hills, PA&lt;br&gt;
                            1.844.KEYBLOCK (539.2562)&lt;/td&gt;
                          &lt;td style="padding-right:20px"&gt;&lt;img \
src="cid:part2.883608D6.7C9CE2B8@keystonenap.com"&gt; &lt;/td&gt;  &lt;/tr&gt;
                      &lt;/tbody&gt;
                    &lt;/table&gt;
                  &lt;/div&gt;
                &lt;/font&gt;&lt;/span&gt;&lt;/div&gt;
            &lt;br&gt;
            ______________________________&lt;wbr&gt;_________________&lt;br&gt;
            libvirt-users mailing list&lt;br&gt;
            &lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;  &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;  \
&lt;/blockquote&gt;  &lt;/div&gt;
        &lt;br&gt;
        &lt;br clear="all"&gt;
        &lt;div&gt;&lt;br&gt;
        &lt;/div&gt;
        -- &lt;br&gt;
        &lt;div class="m_-3364292027163180564gmail_signature" \
data-smartmail="gmail_signature"&gt;  &lt;div dir="ltr"&gt;
            &lt;div&gt;
              &lt;div dir="ltr"&gt;
                &lt;div cols="72"&gt;&lt;font size="2" face="trebuchet ms,
                    sans-serif"&gt;Regards,&lt;/font&gt;&lt;/div&gt;
                &lt;div cols="72"&gt;&lt;font size="2" face="trebuchet ms,
                    sans-serif"&gt;Sakhi Hadebe&lt;/font&gt;&lt;/div&gt;
                &lt;pre cols="72"&gt;&lt;font size="2" face="trebuchet ms, \
sans-serif"&gt;Engineer: South African National Research Network (SANReN)Competency \
Area, Meraka, CSIR  
Tel:   &lt;a href="tel:+27128414213" target="_blank"&gt;+27 12 841 2308&lt;/a&gt;
Fax:   &lt;a href="tel:+27128414223" target="_blank"&gt;+27 12 841 4223&lt;/a&gt;
Cell:  &lt;a href="tel:+27823034657" target="_blank"&gt;+27 71 331 9622&lt;/a&gt;
Email: &lt;a href="mailto:shadebe@csir.co.za" \
target="_blank"&gt;sakhi@sanren.ac.za&lt;/a&gt;&lt;/font&gt; &lt;/pre&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
    &lt;div class="m_-3364292027163180564moz-signature"&gt;-- &lt;br&gt;
      &lt;table&gt;
        &lt;tbody&gt;
          &lt;tr&gt;
            &lt;td style="padding-left:20px" width="90%"&gt;Doug Hughes&lt;br&gt;
              Keystone NAP&lt;br&gt;
              Fairless Hills, PA&lt;br&gt;
              1.844.KEYBLOCK (539.2562)&lt;/td&gt;
            &lt;td style="padding-right:20px"&gt;&lt;img \
src="cid:part2.883608D6.7C9CE2B8@keystonenap.com"&gt;  &lt;/td&gt;
          &lt;/tr&gt;
        &lt;/tbody&gt;
      &lt;/table&gt;
    &lt;/div&gt;
  &lt;/div&gt;&lt;/div&gt;&lt;/div&gt;

&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- &lt;br&gt;&lt;div \
class="gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div \
dir="ltr"&gt;&lt;div cols="72"&gt;&lt;font size="2" face="trebuchet ms, \
sans-serif"&gt;Regards,&lt;/font&gt;&lt;/div&gt; &lt;div cols="72"&gt;&lt;font size="2" face="trebuchet ms, \
sans-serif"&gt;Sakhi  Hadebe&lt;/font&gt;&lt;/div&gt;&lt;pre cols="72"&gt;&lt;font face="trebuchet ms, \
sans-serif" size="2"&gt;Engineer: South African National Research Network \
(SANReN)Competency Area, Meraka, CSIR  
Tel:   &lt;a href="tel:+27128414213" target="_blank"&gt;+27 12 841 2308&lt;/a&gt;
Fax:   &lt;a href="tel:+27128414223" target="_blank"&gt;+27 12 841 4223&lt;/a&gt;
Cell:  &lt;a href="tel:+27823034657" target="_blank"&gt;+27 71 331 9622&lt;/a&gt;
Email: &lt;a href="mailto:shadebe@csir.co.za" \
target="_blank"&gt;sakhi@sanren.ac.za&lt;/a&gt;&lt;/font&gt; &lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;

--001a11390b7a7ac65705576d1a5d--


["keystone-nap.png" (image/png)]

</body></email><email><emailId>20170823151115</emailId><senderName>Doug Hughes</senderName><senderEmail>doug.hughes@keystonenap.com</senderEmail><timestampReceived>2017-08-23 15:11:15-0400</timestampReceived><subject>Re: [libvirt-users] snapshot anomaly</subject><body>

Oddly, the physical file did not exist. I'm not sure it ever did? (no
proof one way or another on that)


On 8/23/2017 11:09 AM, Sakhi Hadebe wrote:
&gt; I had the same problem yesterday. I found the solution from this
&gt; article
&gt; https://kashyapc.fedorapeople.org/virt/lc-2012/snapshots-handout.html.
&gt; According to the article it deletes the tracking metadata by libvirt.
&gt;
&gt; You can physically remove the snapshot now that there is no tracking
&gt; stream data by libvirt
&gt;
&gt; On Wed, Aug 23, 2017 at 4:56 PM, Doug Hughes
&gt; &lt;doug.hughes@keystonenap.com &lt;mailto:doug.hughes@keystonenap.com&gt;&gt; wrote:
&gt;
&gt;     THat did it! Can you esplain what was going on and how that fixed
&gt;     it? Thanks
&gt;
&gt;
&gt;     On 8/23/2017 10:50 AM, Sakhi Hadebe wrote:
&gt;&gt;     Hi,
&gt;&gt;
&gt;&gt;     Can you try this command:
&gt;&gt;     virsh snapshot-delete serv1r2 snap --metadata
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;     On Wed, Aug 23, 2017 at 4:41 PM, Doug Hughes
&gt;&gt;     &lt;doug.hughes@keystonenap.com
&gt;&gt;     &lt;mailto:doug.hughes@keystonenap.com&gt;&gt; wrote:
&gt;&gt;
&gt;&gt;         I'm not sure how this snapshot got created, but, I cannot
&gt;&gt;         delete it, and its presence prevents me from creating other
&gt;&gt;         snapshots. I don't know if it was created by a command gone
&gt;&gt;         amok or something else.
&gt;&gt;
&gt;&gt;         # virsh snapshot-list serv1r2
&gt;&gt;          Name                 Creation Time             State
&gt;&gt;         ------------------------------------------------------------
&gt;&gt;          snap                 2017-01-30 17:01:11 -0500 shutoff
&gt;&gt;
&gt;&gt;         # virsh snapshot-delete serv1r2 snap --disk-only
&gt;&gt;         error: command 'snapshot-delete' doesn't support option
&gt;&gt;         --disk-only
&gt;&gt;
&gt;&gt;         # virsh snapshot-dumpxml serv1r2 snap
&gt;&gt;         &lt;domainsnapshot&gt;
&gt;&gt;           &lt;name&gt;snap&lt;/name&gt;
&gt;&gt;           &lt;state&gt;shutoff&lt;/state&gt;
&gt;&gt;           &lt;creationTime&gt;1485813671&lt;/creationTime&gt;
&gt;&gt;           &lt;memory snapshot='no'/&gt;
&gt;&gt;           &lt;disks&gt;
&gt;&gt;             &lt;disk name='vda' snapshot='external' type='file'&gt;
&gt;&gt;               &lt;driver type='qcow2'/&gt;
&gt;&gt;               &lt;source
&gt;&gt;         file='/*var/lib/libvirt/images/serv1r2-savesnap.qcow2'/*&gt;
&gt;&gt;             &lt;/disk&gt;
&gt;&gt;             &lt;disk name='fda' snapshot='no'/&gt;
&gt;&gt;             &lt;disk name='hda' snapshot='no'/&gt;
&gt;&gt;           &lt;/disks&gt;
&gt;&gt;
&gt;&gt;         #  ls -l /var/lib/libvirt/images/serv1r2-savesnap.qcow2
&gt;&gt;         ls: cannot access
&gt;&gt;         /var/lib/libvirt/images/serv1r2-savesnap.qcow2: No such file
&gt;&gt;         or directory
&gt;&gt;
&gt;&gt;         # virsh snapshot-create-as --domain serv1r2 snap --diskspec
&gt;&gt;         vda,file=/var/lib/libvirt/flashimages/serv1r2-snap.qcow2 
&gt;&gt;         --disk-only --atomic --no-metadata --quiesce
&gt;&gt;         error: internal error: unexpected domain snapshot snap
&gt;&gt;         already exists
&gt;&gt;
&gt;&gt;         # virsh snapshot-revert serv1r2 snap
&gt;&gt;         error: unsupported configuration: revert to external snapshot
&gt;&gt;         not supported yet
&gt;&gt;
&gt;&gt;         Any idea for breaking out of this box?
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;         -- 
&gt;&gt;         Doug Hughes
&gt;&gt;         Keystone NAP
&gt;&gt;         Fairless Hills, PA
&gt;&gt;         1.844.KEYBLOCK (539.2562) 	
&gt;&gt;
&gt;&gt;
&gt;&gt;         _______________________________________________
&gt;&gt;         libvirt-users mailing list
&gt;&gt;         libvirt-users@redhat.com &lt;mailto:libvirt-users@redhat.com&gt;
&gt;&gt;         https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;         &lt;https://www.redhat.com/mailman/listinfo/libvirt-users&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;     -- 
&gt;&gt;     Regards,
&gt;&gt;     Sakhi Hadebe
&gt;&gt;     Engineer: South African National Research Network
&gt;&gt;     (SANReN)Competency Area, Meraka, CSIR Tel: +27 12 841 2308
&gt;&gt;     &lt;tel:+27128414213&gt; Fax: +27 12 841 4223 &lt;tel:+27128414223&gt; Cell:
&gt;&gt;     +27 71 331 9622 &lt;tel:+27823034657&gt; Email: sakhi@sanren.ac.za
&gt;&gt;     &lt;mailto:shadebe@csir.co.za&gt;
&gt;
&gt;     -- 
&gt;     Doug Hughes
&gt;     Keystone NAP
&gt;     Fairless Hills, PA
&gt;     1.844.KEYBLOCK (539.2562) 	
&gt;
&gt;
&gt;
&gt;
&gt; -- 
&gt; Regards,
&gt; Sakhi Hadebe
&gt; Engineer: South African National Research Network (SANReN)Competency
&gt; Area, Meraka, CSIR Tel: +27 12 841 2308 &lt;tel:+27128414213&gt; Fax: +27 12
&gt; 841 4223 &lt;tel:+27128414223&gt; Cell: +27 71 331 9622 &lt;tel:+27823034657&gt;
&gt; Email: sakhi@sanren.ac.za &lt;mailto:shadebe@csir.co.za&gt;

-- 
Doug Hughes
Keystone NAP
Fairless Hills, PA
1.844.KEYBLOCK (539.2562) 	


[Attachment #3 (multipart/related)]

[Attachment #5 (text/html)]

&lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
  &lt;/head&gt;
  &lt;body text="#000000" bgcolor="#FFFFFF"&gt;
    &lt;p&gt;Oddly, the physical file did not exist. I'm not sure it ever did?
      (no proof one way or another on that)&lt;/p&gt;
    &lt;br&gt;
    &lt;div class="moz-cite-prefix"&gt;On 8/23/2017 11:09 AM, Sakhi Hadebe
      wrote:&lt;br&gt;
    &lt;/div&gt;
    &lt;blockquote type="cite"
cite="mid:CAJ9ctEnhysZZ46fNq3ZH7JhC0gEvbAVqv0hkyLH_SdwWRDJDDw@mail.gmail.com"&gt;
      &lt;div dir="ltr"&gt;
        &lt;div class="gmail_default" style="font-family:"trebuchet
          ms",sans-serif"&gt;I had the same problem yesterday. I found
          the solution from this article &lt;a
href="https://kashyapc.fedorapeople.org/virt/lc-2012/snapshots-handout.html"
            moz-do-not-send="true"&gt;https://kashyapc.fedorapeople.org/virt/lc-2012/snapshots-handout.html&lt;/a&gt;.
  According to the article it deletes the tracking metadata by
          libvirt.&lt;/div&gt;
        &lt;div class="gmail_default" style="font-family:"trebuchet
          ms",sans-serif"&gt;&lt;br&gt;
        &lt;/div&gt;
        &lt;div class="gmail_default" style="font-family:"trebuchet
          ms",sans-serif"&gt;You can physically remove the snapshot
          now that there is no tracking stream data by libvirt&lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="gmail_extra"&gt;&lt;br&gt;
        &lt;div class="gmail_quote"&gt;On Wed, Aug 23, 2017 at 4:56 PM, Doug
          Hughes &lt;span dir="ltr"&gt;&lt;&lt;a
              href="mailto:doug.hughes@keystonenap.com" target="_blank"
              moz-do-not-send="true"&gt;doug.hughes@keystonenap.com&lt;/a&gt;&gt;&lt;/span&gt;
          wrote:&lt;br&gt;
          &lt;blockquote class="gmail_quote" style="margin:0 0 0
            .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;
            &lt;div text="#000000" bgcolor="#FFFFFF"&gt;
              &lt;p&gt;THat did it! Can you esplain what was going on and how
                that fixed it? Thanks&lt;br&gt;
              &lt;/p&gt;
              &lt;div&gt;
                &lt;div class="h5"&gt; &lt;br&gt;
                  &lt;div class="m_-3364292027163180564moz-cite-prefix"&gt;On
                    8/23/2017 10:50 AM, Sakhi Hadebe wrote:&lt;br&gt;
                  &lt;/div&gt;
                  &lt;blockquote type="cite"&gt;
                    &lt;div dir="ltr"&gt;
                      &lt;div class="gmail_default"&gt;Hi,&lt;/div&gt;
                      &lt;div class="gmail_default"&gt;&lt;br&gt;
                      &lt;/div&gt;
                      &lt;div class="gmail_default"&gt;Can you try this
                        command:&lt;/div&gt;
                      &lt;div class="gmail_default"&gt;&lt;font face="trebuchet
                          ms, sans-serif"&gt;virsh snapshot-delete &lt;/font&gt;&lt;span
                          style="font-size:12.8px"&gt;serv1r2 snap&lt;/span&gt;&lt;span&gt; \
--metadata&lt;/span&gt;&lt;/div&gt;  &lt;div class="gmail_default"&gt;&lt;span
                          style="font-family:"trebuchet
                          ms",sans-serif"&gt;&lt;br&gt;
                        &lt;/span&gt;&lt;/div&gt;
                      &lt;div class="gmail_default"&gt;&lt;br&gt;
                      &lt;/div&gt;
                      &lt;div class="gmail_default"&gt;&lt;br&gt;
                      &lt;/div&gt;
                    &lt;/div&gt;
                    &lt;div class="gmail_extra"&gt;&lt;br&gt;
                      &lt;div class="gmail_quote"&gt;On Wed, Aug 23, 2017 at
                        4:41 PM, Doug Hughes &lt;span dir="ltr"&gt;&lt;&lt;a
                            href="mailto:doug.hughes@keystonenap.com"
                            target="_blank" \
moz-do-not-send="true"&gt;doug.hughes@keystonenap.com&lt;/a&gt;&gt;&lt;/span&gt;  wrote:&lt;br&gt;
                        &lt;blockquote class="gmail_quote" style="margin:0
                          0 0 .8ex;border-left:1px #ccc
                          solid;padding-left:1ex"&gt;
                          &lt;div text="#000000" bgcolor="#FFFFFF"&gt;
                            &lt;p&gt;I'm not sure how this snapshot got
                              created, but, I cannot delete it, and its
                              presence prevents me from creating other
                              snapshots. I don't know if it was created
                              by a command gone amok or something else.&lt;/p&gt;
                            &lt;p&gt;# virsh snapshot-list serv1r2&lt;br&gt;
                               Name                 Creation
                              Time             State&lt;br&gt;
                              \
------------------------------&lt;wbr&gt;------------------------------&lt;br&gt;  snap           \
                2017-01-30 17:01:11
                              -0500 shutoff&lt;br&gt;
                              &lt;br&gt;
                            &lt;/p&gt;
                            &lt;p&gt;# virsh snapshot-delete serv1r2 snap
                              --disk-only&lt;br&gt;
                              error: command 'snapshot-delete' doesn't
                              support option --disk-only&lt;br&gt;
                            &lt;/p&gt;
                            &lt;p&gt;# virsh snapshot-dumpxml serv1r2 snap&lt;br&gt;
                              &lt;domainsnapshot&gt;&lt;br&gt;
                                &lt;name&gt;snap&lt;/name&gt;&lt;br&gt;
                                &lt;state&gt;shutoff&lt;/state&gt;&lt;br&gt;
                                \
&lt;creationTime&gt;1485813671&lt;/crea&lt;wbr&gt;tionTime&gt;&lt;br&gt;  &lt;memory \
snapshot='no'/&gt;&lt;br&gt;  &lt;disks&gt;&lt;br&gt;
                                  &lt;disk name='vda'
                              snapshot='external' type='file'&gt;&lt;br&gt;
                                    &lt;driver type='qcow2'/&gt;&lt;br&gt;
                                    &lt;source \
file='/&lt;b&gt;var/lib/libvirt/images/&lt;wbr&gt;serv1r2-savesnap.qcow2'/&lt;/b&gt;&gt;&lt;br&gt;  \
                &lt;/disk&gt;&lt;br&gt;
                                  &lt;disk name='fda' snapshot='no'/&gt;&lt;br&gt;
                                  &lt;disk name='hda' snapshot='no'/&gt;&lt;br&gt;
                                &lt;/disks&gt;&lt;/p&gt;
                            &lt;p&gt;#  ls -l \
/var/lib/libvirt/images/serv1r&lt;wbr&gt;2-savesnap.qcow2&lt;br&gt;  ls: cannot access
                              /var/lib/libvirt/images/serv1r&lt;wbr&gt;2-savesnap.qcow2:
                              No such file or directory&lt;br&gt;
                            &lt;/p&gt;
                            &lt;p&gt;# virsh snapshot-create-as --domain
                              serv1r2 snap --diskspec
                              \
                vda,file=/var/lib/libvirt/flas&lt;wbr&gt;himages/serv1r2-snap.qcow2 
                              --disk-only --atomic --no-metadata
                              --quiesce&lt;br&gt;
                              error: internal error: unexpected domain
                              snapshot snap already exists&lt;br&gt;
                            &lt;/p&gt;
                            &lt;p&gt;# virsh snapshot-revert serv1r2 snap&lt;br&gt;
                              error: unsupported configuration: revert
                              to external snapshot not supported yet&lt;br&gt;
                            &lt;/p&gt;
                            &lt;p&gt;Any idea for breaking out of this box?&lt;/p&gt;
                            &lt;span class="m_-3364292027163180564HOEnZb"&gt;&lt;font
                                color="#888888"&gt;
                                &lt;p&gt;&lt;br&gt;
                                &lt;/p&gt;
                                &lt;p&gt;&lt;br&gt;
                                &lt;/p&gt;
                                &lt;div
                                  \
class="m_-3364292027163180564m_-7776500251940886334moz-signature"&gt;--  &lt;br&gt;
                                  &lt;table&gt;
                                    &lt;tbody&gt;
                                      &lt;tr&gt;
                                        &lt;td style="padding-left:20px"
                                          width="90%"&gt;Doug Hughes&lt;br&gt;
                                          Keystone NAP&lt;br&gt;
                                          Fairless Hills, PA&lt;br&gt;
                                          1.844.KEYBLOCK (539.2562)&lt;/td&gt;
                                        &lt;td style="padding-right:20px"&gt;&lt;img
src="cid:part4.4FD00B51.D128FD3D@keystonenap.com" class=""&gt; &lt;/td&gt;
                                      &lt;/tr&gt;
                                    &lt;/tbody&gt;
                                  &lt;/table&gt;
                                &lt;/div&gt;
                              &lt;/font&gt;&lt;/span&gt;&lt;/div&gt;
                          &lt;br&gt;
                          ______________________________&lt;wbr&gt;_________________&lt;br&gt;
                          libvirt-users mailing list&lt;br&gt;
                          &lt;a href="mailto:libvirt-users@redhat.com"
                            target="_blank" \
moz-do-not-send="true"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;  &lt;a
                            \
href="https://www.redhat.com/mailman/listinfo/libvirt-users"  rel="noreferrer" \
                target="_blank"
                            \
moz-do-not-send="true"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;
  &lt;/blockquote&gt;
                      &lt;/div&gt;
                      &lt;br&gt;
                      &lt;br clear="all"&gt;
                      &lt;div&gt;&lt;br&gt;
                      &lt;/div&gt;
                      -- &lt;br&gt;
                      &lt;div class="m_-3364292027163180564gmail_signature"
                        data-smartmail="gmail_signature"&gt;
                        &lt;div dir="ltr"&gt;
                          &lt;div&gt;
                            &lt;div dir="ltr"&gt;
                              &lt;div cols="72"&gt;&lt;font size="2"
                                  face="trebuchet ms, \
sans-serif"&gt;Regards,&lt;/font&gt;&lt;/div&gt;  &lt;div cols="72"&gt;&lt;font size="2"
                                  face="trebuchet ms, sans-serif"&gt;Sakhi
                                  Hadebe&lt;/font&gt;&lt;/div&gt;
                              &lt;pre cols="72"&gt;&lt;font size="2" face="trebuchet ms, \
sans-serif"&gt;Engineer: South African National Research Network (SANReN)Competency \
Area, Meraka, CSIR  
Tel:   &lt;a href="tel:+27128414213" target="_blank" moz-do-not-send="true"&gt;+27 12 841 \
                2308&lt;/a&gt;
Fax:   &lt;a href="tel:+27128414223" target="_blank" moz-do-not-send="true"&gt;+27 12 841 \
                4223&lt;/a&gt;
Cell:  &lt;a href="tel:+27823034657" target="_blank" moz-do-not-send="true"&gt;+27 71 331 \
                9622&lt;/a&gt;
Email: &lt;a href="mailto:shadebe@csir.co.za" target="_blank" \
moz-do-not-send="true"&gt;sakhi@sanren.ac.za&lt;/a&gt;&lt;/font&gt; &lt;/pre&gt;
                            &lt;/div&gt;
                          &lt;/div&gt;
                        &lt;/div&gt;
                      &lt;/div&gt;
                    &lt;/div&gt;
                  &lt;/blockquote&gt;
                  &lt;br&gt;
                  &lt;div class="m_-3364292027163180564moz-signature"&gt;-- &lt;br&gt;
                    &lt;table&gt;
                      &lt;tbody&gt;
                        &lt;tr&gt;
                          &lt;td style="padding-left:20px" width="90%"&gt;Doug
                            Hughes&lt;br&gt;
                            Keystone NAP&lt;br&gt;
                            Fairless Hills, PA&lt;br&gt;
                            1.844.KEYBLOCK (539.2562)&lt;/td&gt;
                          &lt;td style="padding-right:20px"&gt;&lt;img
                              src="cid:part4.4FD00B51.D128FD3D@keystonenap.com"
                              class=""&gt; &lt;/td&gt;
                        &lt;/tr&gt;
                      &lt;/tbody&gt;
                    &lt;/table&gt;
                  &lt;/div&gt;
                &lt;/div&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/blockquote&gt;
        &lt;/div&gt;
        &lt;br&gt;
        &lt;br clear="all"&gt;
        &lt;div&gt;&lt;br&gt;
        &lt;/div&gt;
        -- &lt;br&gt;
        &lt;div class="gmail_signature" data-smartmail="gmail_signature"&gt;
          &lt;div dir="ltr"&gt;
            &lt;div&gt;
              &lt;div dir="ltr"&gt;
                &lt;div cols="72"&gt;&lt;font size="2" face="trebuchet ms,
                    sans-serif"&gt;Regards,&lt;/font&gt;&lt;/div&gt;
                &lt;div cols="72"&gt;&lt;font size="2" face="trebuchet ms,
                    sans-serif"&gt;Sakhi Hadebe&lt;/font&gt;&lt;/div&gt;
                &lt;pre cols="72"&gt;&lt;font size="2" face="trebuchet ms, \
sans-serif"&gt;Engineer: South African National Research Network (SANReN)Competency \
Area, Meraka, CSIR  
Tel:   &lt;a href="tel:+27128414213" target="_blank" moz-do-not-send="true"&gt;+27 12 841 \
                2308&lt;/a&gt;
Fax:   &lt;a href="tel:+27128414223" target="_blank" moz-do-not-send="true"&gt;+27 12 841 \
                4223&lt;/a&gt;
Cell:  &lt;a href="tel:+27823034657" target="_blank" moz-do-not-send="true"&gt;+27 71 331 \
                9622&lt;/a&gt;
Email: &lt;a href="mailto:shadebe@csir.co.za" target="_blank" \
moz-do-not-send="true"&gt;sakhi@sanren.ac.za&lt;/a&gt;&lt;/font&gt; &lt;/pre&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
    &lt;div class="moz-signature"&gt;-- &lt;br&gt;
      &lt;table&gt;
        &lt;tbody&gt;
          &lt;tr&gt;
            &lt;td style="padding-left: 20px" width="90%"&gt;Doug Hughes&lt;br&gt;
              Keystone NAP&lt;br&gt;
              Fairless Hills, PA&lt;br&gt;
              1.844.KEYBLOCK (539.2562)&lt;/td&gt;
            &lt;td style="align: right;padding-right: 20px"&gt;&lt;img
                src="cid:part4.4FD00B51.D128FD3D@keystonenap.com"&gt;
            &lt;/td&gt;
          &lt;/tr&gt;
        &lt;/tbody&gt;
      &lt;/table&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;


["keystone-nap.png" (image/png)]

</body></email><email><emailId>20170825095111</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-08-25 09:51:11-0400</timestampReceived><subject>Re: [libvirt-users] duplicated notifications for suspend and resume</subject><body>


On Thu, Aug 24, 2017 at 12:54:26PM +0000, Naud, AntoineX wrote:
&gt; Hello,
&gt; 
&gt; I am using domain event notifications from libvirt-event API in my application and \
&gt; it seems to work fine, except for 'suspend' and 'resume' events where I keep \
&gt; receiving duplicated notifications. 
&gt; Similarly, the example provided with libvirt (in examples/object-events/event-test) \
&gt; also produces twice as much notifications for 'suspend' and 'resume' than for other \
&gt; events. Here is the sequence of virsh commands and the output of event-test: 
&gt; Virsh start Fed25
&gt; Virsh suspend Fed25
&gt; Virsh resume Fed25
&gt; Virsh shutdown Fed25
&gt; 
&gt; [~/libvirt-3.4.0/examples/object-events] ./event-test qemu:///system
&gt; Registering event callbacks
&gt; myNodeDeviceEventCallback EVENT: Node device net_vnet0_fe_54_00_a0_ba_61 Created 0
&gt; myDomainEventCallback1 EVENT: Domain Fed25(1) Resumed Unpaused
&gt; myDomainEventCallback2 EVENT: Domain Fed25(1) Resumed Unpaused
&gt; myDomainEventCallback1 EVENT: Domain Fed25(1) Started Booted
&gt; myDomainEventCallback2 EVENT: Domain Fed25(1) Started Booted
&gt; myDomainEventCallback1 EVENT: Domain Fed25(1) Suspended Paused
&gt; myDomainEventCallback2 EVENT: Domain Fed25(1) Suspended Paused
&gt; myDomainEventCallback1 EVENT: Domain Fed25(1) Suspended Paused
&gt; myDomainEventCallback2 EVENT: Domain Fed25(1) Suspended Paused
&gt; myDomainEventCallback1 EVENT: Domain Fed25(1) Resumed Unpaused
&gt; myDomainEventCallback2 EVENT: Domain Fed25(1) Resumed Unpaused
&gt; myDomainEventCallback1 EVENT: Domain Fed25(1) Resumed Unpaused
&gt; myDomainEventCallback2 EVENT: Domain Fed25(1) Resumed Unpaused
&gt; myDomainEventCallback1 EVENT: Domain Fed25(1) Shutdown Finished
&gt; myDomainEventCallback2 EVENT: Domain Fed25(1) Shutdown Finished
&gt; myNodeDeviceEventCallback EVENT: Node device net_vnet0_fe_54_00_a0_ba_61 Deleted 0
&gt; 
&gt; Note that the 2 lines printed for each event are ok since 2 callbacks are \
&gt; registered in the example. 

We cannot guarantee that some events will not fire multiple times as is
some cases there is no way to check whether it is duplicate or not when
libvirt gets the information.  I have a hunch that the fact that events
can happen multiple times is written somewhere in the docs.

Is there any problem you are trying to solve here?

&gt; Has anybody else faced this issue?
&gt; 
&gt; I am using libvirt-3.6.0 on Ubuntu 16.04.
&gt; 
&gt; Best regards,
&gt; Antoine
&gt; --------------------------------------------------------------
&gt; Intel Research and Development Ireland Limited
&gt; Registered in Ireland
&gt; Registered Office: Collinstown Industrial Park, Leixlip, County Kildare
&gt; Registered Number: 308263
&gt; 
&gt; 
&gt; This e-mail and any attachments may contain confidential material for the sole
&gt; use of the intended recipient(s). Any review or distribution by others is
&gt; strictly prohibited. If you are not the intended recipient, please contact the
&gt; sender and delete all copies.

&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170825101545</emailId><senderName>"Naud, AntoineX"</senderName><senderEmail>antoinex.naud@intel.com</senderEmail><timestampReceived>2017-08-25 10:15:45-0400</timestampReceived><subject>Re: [libvirt-users] duplicated notifications for suspend and resume</subject><body>

Hi Martin,

Thanks for your answer!
&gt; We cannot guarantee that some events will not fire multiple times as is some cases \
&gt; there is no way to check whether it is duplicate or not when libvirt gets the \
&gt; information.  I have a hunch that the fact that events can happen multiple times is \
&gt; written somewhere in the docs. 
Ok. I did not know about that. That would be an explanation. 

&gt; Is there any problem you are trying to solve here?
No, I can handle the duplicate notifs in the application. I was just surprise to see \
the same event twice and wondering whether I used the API correctly or if this could \
possibly be a bug in libvirt.

Best
Antoine

-----Original Message-----
From: Martin Kletzander [mailto:mkletzan@redhat.com] 
Sent: Friday, August 25, 2017 11:51 AM
To: Naud, AntoineX &lt;antoinex.naud@intel.com&gt;
Cc: libvirt-users@redhat.com
Subject: Re: [libvirt-users] duplicated notifications for suspend and resume

On Thu, Aug 24, 2017 at 12:54:26PM +0000, Naud, AntoineX wrote:
&gt; Hello,
&gt; 
&gt; I am using domain event notifications from libvirt-event API in my application and \
&gt; it seems to work fine, except for 'suspend' and 'resume' events where I keep \
&gt; receiving duplicated notifications. 
&gt; Similarly, the example provided with libvirt (in examples/object-events/event-test) \
&gt; also produces twice as much notifications for 'suspend' and 'resume' than for other \
&gt; events. Here is the sequence of virsh commands and the output of event-test: 
&gt; Virsh start Fed25
&gt; Virsh suspend Fed25
&gt; Virsh resume Fed25
&gt; Virsh shutdown Fed25
&gt; 
&gt; [~/libvirt-3.4.0/examples/object-events] ./event-test qemu:///system 
&gt; Registering event callbacks myNodeDeviceEventCallback EVENT: Node 
&gt; device net_vnet0_fe_54_00_a0_ba_61 Created 0
&gt; myDomainEventCallback1 EVENT: Domain Fed25(1) Resumed Unpaused
&gt; myDomainEventCallback2 EVENT: Domain Fed25(1) Resumed Unpaused
&gt; myDomainEventCallback1 EVENT: Domain Fed25(1) Started Booted
&gt; myDomainEventCallback2 EVENT: Domain Fed25(1) Started Booted
&gt; myDomainEventCallback1 EVENT: Domain Fed25(1) Suspended Paused
&gt; myDomainEventCallback2 EVENT: Domain Fed25(1) Suspended Paused
&gt; myDomainEventCallback1 EVENT: Domain Fed25(1) Suspended Paused
&gt; myDomainEventCallback2 EVENT: Domain Fed25(1) Suspended Paused
&gt; myDomainEventCallback1 EVENT: Domain Fed25(1) Resumed Unpaused
&gt; myDomainEventCallback2 EVENT: Domain Fed25(1) Resumed Unpaused
&gt; myDomainEventCallback1 EVENT: Domain Fed25(1) Resumed Unpaused
&gt; myDomainEventCallback2 EVENT: Domain Fed25(1) Resumed Unpaused
&gt; myDomainEventCallback1 EVENT: Domain Fed25(1) Shutdown Finished
&gt; myDomainEventCallback2 EVENT: Domain Fed25(1) Shutdown Finished 
&gt; myNodeDeviceEventCallback EVENT: Node device 
&gt; net_vnet0_fe_54_00_a0_ba_61 Deleted 0
&gt; 
&gt; Note that the 2 lines printed for each event are ok since 2 callbacks are \
&gt; registered in the example. 

We cannot guarantee that some events will not fire multiple times as is some cases \
there is no way to check whether it is duplicate or not when libvirt gets the \
information.  I have a hunch that the fact that events can happen multiple times is \
written somewhere in the docs.

Is there any problem you are trying to solve here?

&gt; Has anybody else faced this issue?
&gt; 
&gt; I am using libvirt-3.6.0 on Ubuntu 16.04.
&gt; 
&gt; Best regards,
&gt; Antoine
&gt; --------------------------------------------------------------
&gt; Intel Research and Development Ireland Limited Registered in Ireland 
&gt; Registered Office: Collinstown Industrial Park, Leixlip, County Kildare 
&gt; Registered Number: 308263
&gt; 
&gt; 
&gt; This e-mail and any attachments may contain confidential material for 
&gt; the sole use of the intended recipient(s). Any review or distribution 
&gt; by others is strictly prohibited. If you are not the intended 
&gt; recipient, please contact the sender and delete all copies.

&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
--------------------------------------------------------------
Intel Research and Development Ireland Limited
Registered in Ireland
Registered Office: Collinstown Industrial Park, Leixlip, County Kildare
Registered Number: 308263


This e-mail and any attachments may contain confidential material for the sole
use of the intended recipient(s). Any review or distribution by others is
strictly prohibited. If you are not the intended recipient, please contact the
sender and delete all copies.


</body></email><email><emailId>20170825115145</emailId><senderName>Marko Weber</senderName><senderEmail>weber@zbfmail.de</senderEmail><timestampReceived>2017-08-25 11:51:45-0400</timestampReceived><subject>Re: [libvirt-users] vm in qcow2 runs on host A but not on host B</subject><body>



Hi Macros,

Am 2017-08-25 11:54, schrieb Marcos:
&gt; Hi everyone,
&gt; 
&gt; Windows are very sensitive with hardware, mainly with CPU.
&gt; 
&gt; If you change, you break.
&gt; It is not the virtualization system fault.
&gt; 
&gt; For libvirt/kvm you can use the CPU kvm64 that hidde some specifics
&gt; features from the operational system.
&gt; In this case it is easier to migrate VM from host to host.
&gt; 
&gt; You can use the migration feature from libvirt to test if the 2 hosts
&gt; are compatible for migrating your windows VM.
&gt; 
&gt; If libvirt tells you that it is not compatible and you copy the VM -
&gt; it would break your VM.

btw, its a linux vm i copied from host A to host B by rsync.
Its ´s not windows

is the vm "bookamrking" the cpu features and all? if so, how can i reset 
this?


thanks

marko

</body></email><email><emailId>20170825122657</emailId><senderName>Marcos</senderName><senderEmail>mczueira@yahoo.com.br</senderEmail><timestampReceived>2017-08-25 12:26:57-0400</timestampReceived><subject>Re: [libvirt-users] vm in qcow2 runs on host A but not on host B</subject><body>

&lt;div dir='auto'&gt;Well, linux is easier then windows.&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;The host A is 64 or 32 bits ?&lt;/div&gt;&lt;div dir="auto"&gt;The host B is 64 or 32 bits ?&lt;/div&gt;&lt;div dir="auto"&gt;The VM is 64 or 32 ?&lt;/div&gt;&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;64 bits VM does not runs on 32 bits host&lt;/div&gt;&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;
</body></email><email><emailId>20170809121851</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-08-09 12:18:51-0400</timestampReceived><subject>Re: [libvirt-users] libvirt: XML-RPC error : Cannot write data: Broken pipe</subject><body>

On Wed, Aug 09, 2017 at 11:53:54AM +0800, netsurfed wrote:
&gt; Hi all, 
&gt; I think it's a bug, when call virDomainGetState after "service libvirtd stop"
&gt; , I receive signal SIGPIPE.

For the QEMU driver, the libvirt library just talks to libvirtd over an
RPC layer. You killed libvirtd, so the libvirt library gets SIGPIPE.

&gt; I want to know how to avoid this problem? And Other interfaces will also

If you want libvirt to work, don't stop libvirtd

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170809135939</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-08-09 13:59:39-0400</timestampReceived><subject>Re: [libvirt-users] libvirt: XML-RPC error : Cannot write data: Broken pipe</subject><body>

The error message could however give a hint what is going on. It should sax
that it is impossible to talk to libvirtd and that it might be stopped.

On 9 Aug 2017 2:19 p.m., "Daniel P. Berrange" &lt;berrange@redhat.com&gt; wrote:

&gt; On Wed, Aug 09, 2017 at 11:53:54AM +0800, netsurfed wrote:
&gt; &gt; Hi all,
&gt; &gt; I think it's a bug, when call virDomainGetState after "service libvirtd
&gt; stop"
&gt; &gt; , I receive signal SIGPIPE.
&gt;
&gt; For the QEMU driver, the libvirt library just talks to libvirtd over an
&gt; RPC layer. You killed libvirtd, so the libvirt library gets SIGPIPE.
&gt;
&gt; &gt; I want to know how to avoid this problem? And Other interfaces will also
&gt;
&gt; If you want libvirt to work, don't stop libvirtd
&gt;
&gt; Regards,
&gt; Daniel
&gt; --
&gt; |: https://berrange.com      -o-    https://www.flickr.com/photos/
&gt; dberrange :|
&gt; |: https://libvirt.org         -o-
&gt; https://fstop138.berrange.com :|
&gt; |: https://entangle-photo.org    -o-    https://www.instagram.com/
&gt; dberrange :|
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;

[Attachment #3 (text/html)]

&lt;div dir="auto"&gt;The error message could however give a hint what is going on. It \
should sax that it is impossible to talk to libvirtd and that it might be \
stopped.&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;On 9 Aug 2017 \
2:19 p.m., "Daniel P. Berrange" &lt;&lt;a \
href="mailto:berrange@redhat.com"&gt;berrange@redhat.com&lt;/a&gt;&gt; wrote:&lt;br \
type="attribution"&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;On Wed, Aug 09, 2017 at 11:53:54AM \
+0800, netsurfed wrote:&lt;br&gt; &gt; Hi all,&lt;br&gt;
&gt; I think it's a bug, when call virDomainGetState after "service libvirtd \
stop"&lt;br&gt; &gt; , I receive signal SIGPIPE.&lt;br&gt;
&lt;br&gt;
For the QEMU driver, the libvirt library just talks to libvirtd over an&lt;br&gt;
RPC layer. You killed libvirtd, so the libvirt library gets SIGPIPE.&lt;br&gt;
&lt;br&gt;
&gt; I want to know how to avoid this problem? And Other interfaces will also&lt;br&gt;
&lt;br&gt;
If you want libvirt to work, don't stop libvirtd&lt;br&gt;
&lt;br&gt;
Regards,&lt;br&gt;
Daniel&lt;br&gt;
--&lt;br&gt;
&gt; &gt; &lt;a href="https://berrange.com" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://berrange.com&lt;/a&gt;         -o-      &lt;a \
&gt; &gt; href="https://www.flickr.com/photos/dberrange" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://www.flickr.com/photos/&lt;wbr&gt;dberrange&lt;/a&gt; :|&lt;br&gt;
&gt; &gt; &lt;a href="https://libvirt.org" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://libvirt.org&lt;/a&gt;              -o-                  &lt;a \
&gt; &gt; href="https://fstop138.berrange.com" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://fstop138.berrange.com&lt;/a&gt; :|&lt;br&gt;
&gt; &gt; &lt;a href="https://entangle-photo.org" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://entangle-photo.org&lt;/a&gt;      -o-      &lt;a \
&gt; &gt; href="https://www.instagram.com/dberrange" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://www.instagram.com/&lt;wbr&gt;dberrange&lt;/a&gt; :|&lt;br&gt;
&lt;br&gt;
______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;
&lt;a href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/&lt;wbr&gt;mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt; \
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170810062146</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-08-10 06:21:46-0400</timestampReceived><subject>Re: [libvirt-users] libvirt: XML-RPC error : Cannot write data: Broken pipe</subject><body>

On 08/09/2017 03:59 PM, Dominik Psenner wrote:
&gt; The error message could however give a hint what is going on. It should sax
&gt; that it is impossible to talk to libvirtd and that it might be stopped.

[Please don't top post on technical lists]

Yes and no. There can be a lot of reasons why client can't talk to
daemon. They all don't demonstrate in local connection, but imagine
talking to a daemon on distant host. And suddenly somebody cuts the
cable, or inserts incorrect firewall rules, etc. Suggesting that daemon
is not running would be wrong in this case. Also, we tend to report
system errors and leave mgmt application figure out how to deal with it.
For instance:

http://libvirt.org/git/?p=libvirt.git;a=blob;f=tools/virsh.c;h=94bb7ff6c93afa46d31d085eaa5e504f1cca7593;hb=HEAD#l90


Michal


</body></email><email><emailId>20170810084549</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-08-10 08:45:49-0400</timestampReceived><subject>Re: [libvirt-users] libvirt: XML-RPC error : Cannot write data: Broken pipe</subject><body>

2017-08-10 8:21 GMT+02:00 Michal Privoznik &lt;mprivozn@redhat.com&gt;:

&gt; On 08/09/2017 03:59 PM, Dominik Psenner wrote:
&gt; &gt; The error message could however give a hint what is going on. It should
&gt; sax
&gt; &gt; that it is impossible to talk to libvirtd and that it might be stopped.
&gt;
&gt; [Please don't top post on technical lists]


&gt; Yes and no. There can be a lot of reasons why client can't talk to
&gt; daemon. They all don't demonstrate in local connection, but imagine
&gt; talking to a daemon on distant host.

And suddenly somebody cuts the
&gt; cable, or inserts incorrect firewall rules, etc. Suggesting that daemon
&gt; is not running would be wrong in this case.


Actually, it would most probably be true in this case and still the most
probable cause if the communication went over a wire. Yes, it could be a
firewall issue but still it is more likely that the host or the service is
not up.


&gt; Also, we tend to report
&gt; system errors and leave mgmt application figure out how to deal with it.
&gt; For instance:
&gt;
&gt; http://libvirt.org/git/?p=libvirt.git;a=blob;f=tools/virsh.c;h=
&gt; 94bb7ff6c93afa46d31d085eaa5e504f1cca7593;hb=HEAD#l90


Are you indicating that a user should have to read the sourcecode of
libvirt and libvirtd to understand their error messages? Please bear in
mind that we are humans that use a software and as such the software should
be written to be used by humans. I know very well that good error handling
is a tough task to achieve, but it is still worth the effort. I suggest
that the error message:

libvirt: XML-RPC error : Cannot write data: Broken pipe

should read as:

libvirt: Could not connect to the libvirtd service : Cannot write data:
Broken pipe

The first indicates that there's an XML-RPC error going on. To a user this
sounds like a bad problem that he cannot solve by himself. Maybe it is an
incompatible API or the connection broke while transferring data or the
connection crashed, maybe trying to send something that shouldn't be sent
with XML-RPC. Anyway it doesn't give a clue to a user that does not know
how libvirt and libvirtd work internally. The latter is much clearer in
explaining that there's a connectivity issue and that it could not even
open the connection to the service. On top of that it includes the actual
cause, namely a broken pipe.

Cheers
-- 
Dominik Psenner

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;br&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-08-10 \
8:21 GMT+02:00 Michal Privoznik &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:mprivozn@redhat.com" \
target="_blank"&gt;mprivozn@redhat.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt;&lt;span class="gmail-"&gt;On 08/09/2017 03:59 PM, \
Dominik Psenner wrote:&lt;br&gt; &gt; The error message could however give a hint what is \
going on. It should sax&lt;br&gt; &gt; that it is impossible to talk to libvirtd and that \
it might be stopped.&lt;br&gt; &lt;br&gt;
&lt;/span&gt;[Please don't top post on technical lists]   &lt;/blockquote&gt;&lt;blockquote \
class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt; &lt;br&gt;
Yes and no. There can be a lot of reasons why client can't talk to&lt;br&gt;
daemon. They all don't demonstrate in local connection, but imagine&lt;br&gt;
talking to a daemon on distant host.&lt;/blockquote&gt;&lt;blockquote class="gmail_quote" \
style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt;And suddenly somebody cuts the&lt;br&gt; cable, or \
inserts incorrect firewall rules, etc. Suggesting that daemon&lt;br&gt; is not running \
would be wrong in this case.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Actually, it would most \
probably be true in this case and still the most probable cause if the communication \
went over a wire. Yes, it could be a firewall issue but still it is more likely that \
the host or the service is not up.&lt;/div&gt;&lt;div&gt;  &lt;/div&gt;&lt;blockquote class="gmail_quote" \
style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt;Also, we tend to report&lt;br&gt; system errors and \
leave mgmt application figure out how to deal with it.&lt;br&gt; For instance:&lt;br&gt;
&lt;br&gt;
&lt;a href="http://libvirt.org/git/?p=libvirt.git;a=blob;f=tools/virsh.c;h=94bb7ff6c93afa46d31d085eaa5e504f1cca7593;hb=HEAD#l90" \
rel="noreferrer" target="_blank"&gt;http://libvirt.org/git/?p=&lt;wbr&gt;libvirt.git;a=blob;f=t \
ools/&lt;wbr&gt;virsh.c;h=&lt;wbr&gt;94bb7ff6c93afa46d31d085eaa5e50&lt;wbr&gt;4f1cca7593;hb=HEAD#l90&lt;/a&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Are \
you indicating that a user should have to read the sourcecode of libvirt and libvirtd \
to understand their error messages? Please bear in mind that we are humans that use a \
software and as such the software should be written to be used by humans. I know very \
well that good error handling is a tough task to achieve, but it is still worth the \
effort. I suggest that the error message:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;libvirt: XML-RPC \
error : Cannot write data: Broken pipe&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;should read \
as:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;libvirt: Could not connect to the libvirtd service : \
Cannot write data: Broken pipe&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The first indicates that \
there's an XML-RPC error going on. To a user this sounds like a bad problem that \
he cannot solve by himself. Maybe it is an incompatible API or the connection broke \
while transferring data or the connection crashed, maybe trying to send something \
that shouldn't be sent with XML-RPC. Anyway it doesn't give a clue to a user \
that does not know how libvirt and libvirtd work internally. The latter is much \
clearer in explaining that there's a connectivity issue and that it could not \
even open the connection to the service. On top of that it includes the actual cause, \
namely a broken pipe.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers&lt;/div&gt;&lt;/div&gt;-- &lt;br&gt;&lt;div \
class="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170810095023</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-08-10 09:50:23-0400</timestampReceived><subject>Re: [libvirt-users] libvirt: XML-RPC error : Cannot write data: Broken pipe</subject><body>

On 08/10/2017 10:45 AM, Dominik Psenner wrote:
&gt; 2017-08-10 8:21 GMT+02:00 Michal Privoznik &lt;mprivozn@redhat.com&gt;:
&gt; 
&gt;&gt; On 08/09/2017 03:59 PM, Dominik Psenner wrote:
&gt;&gt;&gt; The error message could however give a hint what is going on. It should
&gt;&gt; sax
&gt;&gt;&gt; that it is impossible to talk to libvirtd and that it might be stopped.
&gt;&gt;
&gt;&gt; [Please don't top post on technical lists]
&gt; 
&gt; 
&gt;&gt; Yes and no. There can be a lot of reasons why client can't talk to
&gt;&gt; daemon. They all don't demonstrate in local connection, but imagine
&gt;&gt; talking to a daemon on distant host.
&gt; 
&gt; And suddenly somebody cuts the
&gt;&gt; cable, or inserts incorrect firewall rules, etc. Suggesting that daemon
&gt;&gt; is not running would be wrong in this case.
&gt; 
&gt; 
&gt; Actually, it would most probably be true in this case and still the most
&gt; probable cause if the communication went over a wire. Yes, it could be a
&gt; firewall issue but still it is more likely that the host or the service is
&gt; not up.
&gt; 
&gt; 
&gt;&gt; Also, we tend to report
&gt;&gt; system errors and leave mgmt application figure out how to deal with it.
&gt;&gt; For instance:
&gt;&gt;
&gt;&gt; http://libvirt.org/git/?p=libvirt.git;a=blob;f=tools/virsh.c;h=
&gt;&gt; 94bb7ff6c93afa46d31d085eaa5e504f1cca7593;hb=HEAD#l90
&gt; 
&gt; 
&gt; Are you indicating that a user should have to read the sourcecode of
&gt; libvirt and libvirtd to understand their error messages?

No, I'm indicating that you should read the documentation. What I gave
you was a usage example.

&gt; Please bear in
&gt; mind that we are humans that use a software and as such the software should
&gt; be written to be used by humans. I know very well that good error handling
&gt; is a tough task to achieve, but it is still worth the effort. I suggest
&gt; that the error message:
&gt; 
&gt; libvirt: XML-RPC error : Cannot write data: Broken pipe

Again, after reading corresponding documentation you'll find that:

XML-RPC error stands for error.domain = VIR_FROM_RPC,

and to change "XML-RPC" to something else we would need yet another
domain. It would be wrong anyway - the domain of the error is RPC code
after all.

&gt; 
&gt; should read as:
&gt; 
&gt; libvirt: Could not connect to the libvirtd service : Cannot write data:
&gt; Broken pipe

This is untrue. You are connected at this point, otherwise you wouldn't
be able to get the domain object you are passing to the API in the first
place. Only by writing to the connection socket you learn (well, the
code) that the daemon is gone. That's why we have keep alive, connection
close callbacks and all these fancy features that help you to learn this
fact sooner, without having to call any APIs. Moreover, they can take
actions once the connection gets disconnected. But I'm not going to link
any more code to not discourage you.

Michal

</body></email><email><emailId>20170802115559</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-08-02 11:55:59-0400</timestampReceived><subject>Re: [libvirt-users] Understanding the contents of virsh dump --memory-only</subject><body>


On Tue, Aug 01, 2017 at 10:22:43PM -0400, Arnabjyoti Kalita wrote:
&gt;Hello,
&gt;
&gt;I was trying to understand the ELF file generated by the virsh dump
&gt;(--memory-only) command. I have successfully generated a dump of the VM
&gt;memory using this command.
&gt;

You are running a QEMU machine and the dump is generated by qemu, so
they would be able to explain to much further detail, I'm sure.  Anyway,
here goes my try.

&gt;I specifically am trying to understand the loadable segments of this ELF
&gt;file.
&gt;
&gt;I ran readelf -a &lt;filename&gt; to get the information that I need. Below shows
&gt;the details of the loadable segments in a much better format :-
&gt;
&gt;Loading ELF header #1. offset: 1320 filesize: 655360 memsize: 655360 vaddr:
&gt;0 paddr: 0 align: 0 flags: 0
&gt;Loading ELF header #2. offset: 656680 filesize: 65536 memsize: 65536 vaddr:
&gt;0 paddr: a0000 align: 0 flags: 0
&gt;Loading ELF header #3. offset: 722216 filesize: 1072955392 memsize:
&gt;1072955392 vaddr: 0 paddr: c0000 align: 0 flags: 0
&gt;Loading ELF header #4. offset: 1073677608 filesize: 67108864 memsize:
&gt;67108864 vaddr: 0 paddr: f4000000 align: 0 flags: 0
&gt;Loading ELF header #5. offset: 1140786472 filesize: 67108864 memsize:
&gt;67108864 vaddr: 0 paddr: f8000000 align: 0 flags: 0
&gt;Loading ELF header #6. offset: 1207895336 filesize: 8192 memsize: 8192
&gt;vaddr: 0 paddr: fc054000 align: 0 flags: 0
&gt;Loading ELF header #7. offset: 1207903528 filesize: 262144 memsize: 262144
&gt;vaddr: 0 paddr: fffc0000 align: 0 flags: 0
&gt;

Just to be clear, this is the memory of the machine with kernel and
several other things loaded.  I'm not sure what are all the segments,
but since the dump acts as something you can use to debug the guest OS
using the crash utility, which is somehow enhanced gdb for this purpose,
IIRC, then I guess it's the MMU mapping of everything in the guest OS.

&gt;I wanted to know why in this case, is the virtual address (denoted by
&gt;vaddr) 0 for each of the loadable segments ? Will it be okay if I load the
&gt;elf file taking the values of physical address (denoted by paddr) into
&gt;account ?
&gt;

My guess is that those are the addresses from the MMU.  Each segment has
it's own vaddr &lt;-&gt; paddr mapping.

&gt;Specifically after loading the file, can I be certain that all of my
&gt;contents will have been loaded into memory address starting from 0 ? Will
&gt;the loaded contents be present in the exact location as specified (by
&gt;paddr) here ?
&gt;

It depends on what you mean by loading.  You wouldn't be starting that
binary as any other program, it's rather a dump as you would have with a
coredump.  Physical address is probably just the location in the guest
machine, so the thing with paddr 0 would be seabios or something
BIOS-related, etc.

If you want precise answers and not guesses, I would suggest the qemu
mailing list or any other related list.  libvirt is not the best choice
here unless someone from the other communities replies here.

HTH,
Martin

&gt;Thanks and Regards.
&gt;Arnab

&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170802160638</emailId><senderName>Ján Tomko</senderName><senderEmail>jtomko@redhat.com</senderEmail><timestampReceived>2017-08-02 16:06:38-0400</timestampReceived><subject>Re: [libvirt-users] Libvirt fails on network disk with ISCSI protocol</subject><body>


On Wed, Aug 02, 2017 at 05:47:31PM +0300, Fred Rolland wrote:
&gt; Hi,
&gt; 
&gt; I am working on oVirt, and I am trying to run a VM with a network disk with
&gt; ISCSI protocol ( the storage is on a Cinder server).
&gt; 
&gt; Here is the disk XML I use:
&gt; 
&gt; &lt;disk device="disk" snapshot="no" type="network"&gt;
&gt; &lt;address bus="0" controller="0" target="0" type="drive"
&gt; unit="0" /&gt;
&gt; &lt;source
&gt; name="iqn.2010-10.org.openstack:volume-37fea687-040c-4a88-844c-117d1a90e9b2"
&gt; protocol="iscsi"&gt;
&gt; &lt;host name="10.35.0.20" port="3260" /&gt;
&gt; &lt;/source&gt;
&gt; &lt;target bus="scsi" dev="sda" /&gt;
&gt; &lt;boot order="1" /&gt;
&gt; &lt;driver cache="none" error_policy="stop" io="threads"
&gt; name="qemu" type="raw" /&gt;
&gt; &lt;/disk&gt;
&gt; 
&gt; I get the following error:
&gt; 
&gt; libvirtError: internal error: process exited while connecting to monitor:
&gt; 2017-08-02T14:38:58.378430Z qemu-kvm: -drive file=iscsi://
&gt; 10.35.0.20:3260/iqn.2010-10.org.openstack%3Avolume-37fea687-040c-4a88-844c-117d1a90e \
&gt; 9b2,format=raw,if=none,id=drive-scsi0-0-0-0,cache=none,werror=stop,rerror=stop,aio=threads:
&gt;  Failed to parse URL : iscsi://
&gt; 10.35.0.20:3260/iqn.2010-10.org.openstack%3Avolume-37fea687-040c-4a88-844c-117d1a90e9b2
&gt;  
&gt; It seems that the ':' character got changed on the way to %3A.
&gt; 
&gt; Any suggestions on the root cause of this issue?
&gt; 

The name seems to be missing the LUN. Even though our documentation
states:
  If not specified, the default LUN is zero.
http://libvirt.org/formatdomain.html#elementsDisks

Maybe something changed in QEMU or libiscsi since that document was
written?

Jan


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170808235428</emailId><senderName>Chris Lalancette</senderName><senderEmail>clalancette@gmail.com</senderEmail><timestampReceived>2017-08-08 23:54:28-0400</timestampReceived><subject>[libvirt-users] ANNOUNCE: Oz 0.16.0 release</subject><body>

All,
    I'm pleased to announce release 0.16.0 of Oz.  Oz is a program for
doing automated installation of guest operating systems with limited input
from the user.  Release 0.16.0 is a bugfix and feature release for Oz.
Some of the highlights between Oz 0.15.0 and 0.16.0 are:

* Windows 10 and 2016 support
* All timeouts are now configurable
* Ubuntu 16.04, 16.10, 17.04 support
* Mageia 2, 3, 4, 5 support
* Properly find UEFI firmware, which should fix aarch64 installs
* Fedora 24, 25, 26 support
* FreeBSD 11 support
* Replace internal use of pycurl with requests
* OpenSUSE Leap support
* Timeouts are now based on time, not the number of iterations of the loop
* Modern Fedora and RHEL guests will print out a lot more anaconda
debugging information to the terminal that oz-install was launched from

A tarball and zipfile of this release is available on the Github releases
page: https://github.com/clalancette/oz/releases .  Packages for Fedora
rawhide and 26 have been built in Koji and will eventually make their way
to stable.  Instructions on how to get and use Oz are available at
http://github.com/clalancette/oz/wiki .

If you have questions or comments about Oz, please feel free to contact me
at clalancette at gmail.com, or open up an issue on the github page:
http://github.com/clalancette/oz/issues .

Thanks to everyone who contributed to this release through bug reports,
patches, and suggestions for improvement.

Chris Lalancette

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;All,&lt;br&gt;       I'm \
pleased to announce release 0.16.0 of Oz.   Oz is a program for doing automated \
installation of guest operating systems with limited input from the user.   Release \
0.16.0 is a bugfix and feature release for Oz.   Some of the highlights between Oz \
0.15.0 and 0.16.0 are:&lt;br&gt;&lt;br&gt;&lt;/div&gt;* Windows 10 and 2016 support&lt;br&gt;&lt;/div&gt;* All \
timeouts are now configurable&lt;br&gt;&lt;/div&gt;* Ubuntu 16.04, 16.10, 17.04 \
support&lt;br&gt;&lt;/div&gt;* Mageia 2, 3, 4, 5 support&lt;br&gt;&lt;/div&gt;* Properly find UEFI firmware, \
which should fix aarch64 installs&lt;br&gt;&lt;/div&gt;* Fedora 24, 25, 26 support&lt;br&gt;&lt;/div&gt;* \
FreeBSD 11 support&lt;br&gt;&lt;/div&gt;&lt;div&gt;* Replace internal use of pycurl with \
requests&lt;br&gt;&lt;/div&gt;&lt;div&gt;* OpenSUSE Leap support&lt;br&gt;&lt;/div&gt;&lt;div&gt;* Timeouts are now based \
on time, not the number of iterations of the loop&lt;br&gt;&lt;/div&gt;&lt;div&gt;* Modern Fedora and \
RHEL guests will print out a lot more anaconda debugging information to the terminal \
that oz-install was launched \
from&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;div&gt;A tarball and zipfile \
of this release is available on the Github releases page: &lt;a \
href="https://github.com/clalancette/oz/releases"&gt;https://github.com/clalancette/oz/releases&lt;/a&gt; \
.   Packages for Fedora rawhide and 26 have been built in Koji and will eventually \
make their way to stable.   Instructions on how to get and use Oz are available at &lt;a \
href="http://github.com/clalancette/oz/wiki"&gt;http://github.com/clalancette/oz/wiki&lt;/a&gt; \
.&lt;br&gt;&lt;br&gt;If you have questions or comments about Oz, please feel free to contact me \
at clalancette at &lt;a href="http://gmail.com"&gt;gmail.com&lt;/a&gt;, or open up an issue on \
the github page: &lt;a href="http://github.com/clalancette/oz/issues"&gt;http://github.com/clalancette/oz/issues&lt;/a&gt; \
.&lt;br&gt;&lt;br&gt;Thanks to everyone who contributed to this release through bug reports, \
patches, and suggestions for improvement.&lt;br&gt;&lt;br&gt;Chris \
Lalancette&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170810095226</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-08-10 09:52:26-0400</timestampReceived><subject>Re: [libvirt-users] libvirt: XML-RPC error : Cannot write data: Broken pipe</subject><body>

On Thu, Aug 10, 2017 at 10:45:49AM +0200, Dominik Psenner wrote:
&gt; 2017-08-10 8:21 GMT+02:00 Michal Privoznik &lt;mprivozn@redhat.com&gt;:
&gt; 
&gt; &gt; On 08/09/2017 03:59 PM, Dominik Psenner wrote:
&gt; &gt; &gt; The error message could however give a hint what is going on. It should
&gt; &gt; sax
&gt; &gt; &gt; that it is impossible to talk to libvirtd and that it might be stopped.
&gt; &gt;
&gt; &gt; [Please don't top post on technical lists]
&gt; 
&gt; 
&gt; &gt; Yes and no. There can be a lot of reasons why client can't talk to
&gt; &gt; daemon. They all don't demonstrate in local connection, but imagine
&gt; &gt; talking to a daemon on distant host.
&gt; 
&gt; And suddenly somebody cuts the
&gt; &gt; cable, or inserts incorrect firewall rules, etc. Suggesting that daemon
&gt; &gt; is not running would be wrong in this case.
&gt; 
&gt; 
&gt; Actually, it would most probably be true in this case and still the most
&gt; probable cause if the communication went over a wire. Yes, it could be a
&gt; firewall issue but still it is more likely that the host or the service is
&gt; not up.
&gt; 
&gt; 
&gt; &gt; Also, we tend to report
&gt; &gt; system errors and leave mgmt application figure out how to deal with it.
&gt; &gt; For instance:
&gt; &gt;
&gt; &gt; http://libvirt.org/git/?p=libvirt.git;a=blob;f=tools/virsh.c;h=
&gt; &gt; 94bb7ff6c93afa46d31d085eaa5e504f1cca7593;hb=HEAD#l90
&gt; 
&gt; 
&gt; Are you indicating that a user should have to read the sourcecode of
&gt; libvirt and libvirtd to understand their error messages? Please bear in
&gt; mind that we are humans that use a software and as such the software should
&gt; be written to be used by humans. I know very well that good error handling
&gt; is a tough task to achieve, but it is still worth the effort. I suggest
&gt; that the error message:
&gt; 
&gt; libvirt: XML-RPC error : Cannot write data: Broken pipe
&gt; 
&gt; should read as:
&gt; 
&gt; libvirt: Could not connect to the libvirtd service : Cannot write data:
&gt; Broken pipe

The code in question is used to communicate with *faaar* more than
just libvirtd, so such a change would be pretty misleading in
general.

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170814154646</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-08-14 15:46:46-0400</timestampReceived><subject>Re: [libvirt-users] virsh blockcommit fails regularily (was: virtual drive performance)</subject><body>

Thanks Peter for your feedback. Interestingly the version of virsh is newer
than 1.2.18 and thus should contain the fix:

$ virsh --version
1.3.1

$ uname -a
Linux agsserver 4.4.0-91-generic #114-Ubuntu SMP Tue Aug 8 11:56:56 UTC
2017 x86_64 x86_64 x86_64 GNU/Linux

$ lsb_release -a
No LSB modules are available.
Distributor ID: Ubuntu
Description: Ubuntu 16.04.3 LTS
Release: 16.04
Codename: xenial

But we're still having the issue. Is there anything else that you can think
about? Feel free to query me for more information. I'm willing to help
wherever I can because this bugs us quite regularly. We could probably
improve our daily backup cronjob to retry blockcommit after a blockjob
abort, but it feels so hacky that I would do that only as the last resort.

2017-08-14 17:05 GMT+02:00 Peter Krempa &lt;pkrempa@redhat.com&gt;:

&gt; On Mon, Aug 14, 2017 at 08:42:24 +0200, Dominik Psenner wrote:
&gt; &gt; Hi,
&gt;
&gt; Hi,
&gt;
&gt; &gt;
&gt; &gt; a small update on this. We have migrated the virtualized host to use the
&gt; &gt; virtio drivers and now the drive performance is improved so that we can
&gt; see
&gt; &gt; a constant transfer rate. Before it used to be the same rate but
&gt; regularly
&gt; &gt; dropped to a few bytes/sec for a few seconds and then was fast again.
&gt; &gt;
&gt; &gt; However we still observe that the following fails regularily:
&gt; &gt;
&gt; &gt; $ virsh snapshot-create-as --domain domain --name backup --no-metadata
&gt; &gt; --atomic --disk-only --diskspec hda,snapshot=external
&gt; &gt; $ virsh blockcommit domain hda --active --pivot
&gt; &gt; error: failed to pivot job for disk hda
&gt; &gt; error: block copy still active: disk 'hda' not ready for pivot yet
&gt; &gt; Could not merge changes for disk hda of domain. VM may be in invalid
&gt; state.
&gt;
&gt; since this thread was renamed, please re-state the version of libvirt
&gt; you are using. I don't really want to dig through the old thread.
&gt;
&gt; &gt; Then running the following in the morning succeeds and successfully
&gt; pivotes
&gt; &gt; the snapshot into the base image while the vm is live:
&gt; &gt;
&gt; &gt; $ virsh blockjob domain hda --abort
&gt; &gt; $ virsh blockcommit domain hda --active --pivot
&gt; &gt; Successfully pivoted
&gt; &gt;
&gt; &gt; We run the backup process every day once and it failed on the following
&gt; &gt; days:
&gt; &gt;
&gt; &gt; 2017-07-07
&gt; &gt; 2017-07-20
&gt; &gt; 2017-07-27
&gt; &gt; 2017-08-12
&gt; &gt; 2017-08-14
&gt; &gt;
&gt; &gt; Looking at this it roughly happens once a week and the guest from then on
&gt; &gt; writes into the snapshot backlog. That snapshot backlog file grows about
&gt; &gt; 8gb every day and thus the issue always needs immediate attention.
&gt; &gt;
&gt; &gt; Any ideas what could cause this issue? Is this a bug (race condition) of
&gt; &gt; `virsh blockcommit` that sometimes fails because it is invoked at the
&gt; wrong
&gt; &gt; time?
&gt;
&gt; So the 'virsh blockcommit domain hda --active --pivot' operation
&gt; consists of 3 parts:
&gt;
&gt; 1) virsh blockcommit domain hda --active
&gt; 2) waiting until the block job finishes
&gt; 3) virsh blockjob --pivot domain hda
&gt;
&gt; The problem is that some times 2) finishes too soon and then operation 3
&gt; fails. This should not happen any more, since there's code in virsh [1]
&gt; which waits for the completion event from libvirtd, which is fired only
&gt; when the job is actually ready to be pivoted.
&gt;
&gt; This code has a lot of fallback options in case when libvirtd is old or
&gt; so.
&gt;
&gt; At any rate, manual pivoting later should help. Also probably updating
&gt; to a more recent version.
&gt;
&gt; In case you are using a farily recent version, it's possible that there
&gt; are still bugs though.
&gt;
&gt; Peter
&gt;
&gt; [1]:
&gt;
&gt; commit 7408403560f7d054da75acaab855a95c51a92e2b
&gt; Author: Peter Krempa &lt;pkrempa@redhat.com&gt;
&gt; Date:   Mon Jul 13 17:04:49 2015 +0200
&gt;
&gt;     virsh: Refactor block job waiting in cmdBlockCommit
&gt;
&gt;     Reuse the vshBlockJobWait infrastructure to refactor cmdBlockCommit to
&gt;     use the common code. This additionally fixes a bug when working with
&gt;     new qemus, where when doing an active commit with --pivot the pivoting
&gt;     would fail, since qemu reaches 100% completion but the job doesn't
&gt;     switch to synchronized phase right away.
&gt;
&gt; $ git describe --contains 7408403560f7d054da75acaab855a95c51a92e2b
&gt; v1.2.18-rc1~33
&gt;
&gt;


-- 
Dominik Psenner

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;Thanks Peter for your feedback. Interestingly the version of \
virsh is newer than 1.2.18 and thus should contain the \
fix:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;$ virsh \
--version&lt;/div&gt;&lt;div&gt;1.3.1&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;$ uname -a&lt;/div&gt;&lt;div&gt;Linux \
agsserver 4.4.0-91-generic #114-Ubuntu SMP Tue Aug 8 11:56:56 UTC 2017 x86_64 x86_64 \
x86_64 GNU/Linux&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;$ lsb_release -a&lt;/div&gt;&lt;div&gt;No \
LSB modules are available.&lt;/div&gt;&lt;div&gt;Distributor ID:&lt;span \
style="white-space:pre"&gt;	&lt;/span&gt;Ubuntu&lt;/div&gt;&lt;div&gt;Description:&lt;span \
style="white-space:pre"&gt;	&lt;/span&gt;Ubuntu 16.04.3 LTS&lt;/div&gt;&lt;div&gt;Release:&lt;span \
style="white-space:pre"&gt;	&lt;/span&gt;16.04&lt;/div&gt;&lt;div&gt;Codename:&lt;span \
style="white-space:pre"&gt;	&lt;/span&gt;xenial&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;But we're \
still having the issue. Is there anything else that you can think about? Feel free to \
query me for more information. I'm willing to help wherever I can because this \
bugs us quite regularly. We could probably improve our daily backup cronjob to retry \
blockcommit after a blockjob abort, but it feels so hacky that I would do that only \
as the last resort.&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-08-14 17:05 GMT+02:00 Peter Krempa &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:pkrempa@redhat.com" \
target="_blank"&gt;pkrempa@redhat.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;On Mon, Aug 14, \
2017 at 08:42:24 +0200, Dominik Psenner wrote:&lt;br&gt; &gt; Hi,&lt;br&gt;
&lt;span class=""&gt;&lt;br&gt;
Hi,&lt;br&gt;
&lt;br&gt;
&gt;&lt;br&gt;
&gt; a small update on this. We have migrated the virtualized host to use the&lt;br&gt;
&gt; virtio drivers and now the drive performance is improved so that we can see&lt;br&gt;
&gt; a constant transfer rate. Before it used to be the same rate but regularly&lt;br&gt;
&gt; dropped to a few bytes/sec for a few seconds and then was fast again.&lt;br&gt;
&gt;&lt;br&gt;
&gt; However we still observe that the following fails regularily:&lt;br&gt;
&gt;&lt;br&gt;
&gt; $ virsh snapshot-create-as --domain domain --name backup --no-metadata&lt;br&gt;
&gt; --atomic --disk-only --diskspec hda,snapshot=external&lt;br&gt;
&gt; $ virsh blockcommit domain hda --active --pivot&lt;br&gt;
&gt; error: failed to pivot job for disk hda&lt;br&gt;
&gt; error: block copy still active: disk 'hda' not ready for pivot yet&lt;br&gt;
&gt; Could not merge changes for disk hda of domain. VM may be in invalid state.&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;since this thread was renamed, please re-state the version of libvirt&lt;br&gt;
you are using. I don't really want to dig through the old thread.&lt;br&gt;
&lt;span class=""&gt;&lt;br&gt;
&gt; Then running the following in the morning succeeds and successfully pivotes&lt;br&gt;
&gt; the snapshot into the base image while the vm is live:&lt;br&gt;
&gt;&lt;br&gt;
&gt; $ virsh blockjob domain hda --abort&lt;br&gt;
&gt; $ virsh blockcommit domain hda --active --pivot&lt;br&gt;
&gt; Successfully pivoted&lt;br&gt;
&gt;&lt;br&gt;
&gt; We run the backup process every day once and it failed on the following&lt;br&gt;
&gt; days:&lt;br&gt;
&gt;&lt;br&gt;
&gt; 2017-07-07&lt;br&gt;
&gt; 2017-07-20&lt;br&gt;
&gt; 2017-07-27&lt;br&gt;
&gt; 2017-08-12&lt;br&gt;
&gt; 2017-08-14&lt;br&gt;
&gt;&lt;br&gt;
&gt; Looking at this it roughly happens once a week and the guest from then on&lt;br&gt;
&gt; writes into the snapshot backlog. That snapshot backlog file grows about&lt;br&gt;
&gt; 8gb every day and thus the issue always needs immediate attention.&lt;br&gt;
&gt;&lt;br&gt;
&gt; Any ideas what could cause this issue? Is this a bug (race condition) of&lt;br&gt;
&gt; `virsh blockcommit` that sometimes fails because it is invoked at the wrong&lt;br&gt;
&gt; time?&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;So the 'virsh blockcommit domain hda --active --pivot' operation&lt;br&gt;
consists of 3 parts:&lt;br&gt;
&lt;br&gt;
1) virsh blockcommit domain hda --active&lt;br&gt;
2) waiting until the block job finishes&lt;br&gt;
3) virsh blockjob --pivot domain hda&lt;br&gt;
&lt;br&gt;
The problem is that some times 2) finishes too soon and then operation 3&lt;br&gt;
fails. This should not happen any more, since there's code in virsh [1]&lt;br&gt;
which waits for the completion event from libvirtd, which is fired only&lt;br&gt;
when the job is actually ready to be pivoted.&lt;br&gt;
&lt;br&gt;
This code has a lot of fallback options in case when libvirtd is old or&lt;br&gt;
so.&lt;br&gt;
&lt;br&gt;
At any rate, manual pivoting later should help. Also probably updating&lt;br&gt;
to a more recent version.&lt;br&gt;
&lt;br&gt;
In case you are using a farily recent version, it's possible that there&lt;br&gt;
are still bugs though.&lt;br&gt;
&lt;br&gt;
Peter&lt;br&gt;
&lt;br&gt;
[1]:&lt;br&gt;
&lt;br&gt;
commit 7408403560f7d054da75acaab855a9&lt;wbr&gt;5c51a92e2b&lt;br&gt;
Author: Peter Krempa &lt;&lt;a \
                href="mailto:pkrempa@redhat.com"&gt;pkrempa@redhat.com&lt;/a&gt;&gt;&lt;br&gt;
Date:     Mon Jul 13 17:04:49 2015 +0200&lt;br&gt;
&lt;br&gt;
      virsh: Refactor block job waiting in cmdBlockCommit&lt;br&gt;
&lt;br&gt;
      Reuse the vshBlockJobWait infrastructure to refactor cmdBlockCommit to&lt;br&gt;
      use the common code. This additionally fixes a bug when working with&lt;br&gt;
      new qemus, where when doing an active commit with --pivot the pivoting&lt;br&gt;
      would fail, since qemu reaches 100% completion but the job doesn't&lt;br&gt;
      switch to synchronized phase right away.&lt;br&gt;
&lt;br&gt;
$ git describe --contains 7408403560f7d054da75acaab855a9&lt;wbr&gt;5c51a92e2b&lt;br&gt;
v1.2.18-rc1~33&lt;br&gt;
&lt;br&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- &lt;br&gt;&lt;div \
class="gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik \
Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;



</body></email><email><emailId>20170814164848</emailId><senderName>Pavel Hrdina</senderName><senderEmail>phrdina@redhat.com</senderEmail><timestampReceived>2017-08-14 16:48:48-0400</timestampReceived><subject>Re: [libvirt-users] Increasing video memory available to Windows</subject><body>


On Sat, Aug 05, 2017 at 04:13:52PM -0400, Alex wrote:
&gt; Hi,
&gt; 
&gt; On Sun, Jul 23, 2017 at 3:45 PM, Pavel Hrdina &lt;phrdina@redhat.com&gt; wrote:
&gt; &gt; On Sat, Jul 22, 2017 at 03:03:06PM -0400, Alex wrote:
&gt; &gt;&gt; Hi,
&gt; &gt;&gt; I have a fedora25 system with a Windows10 host and would like to use
&gt; &gt;&gt; it for photoshop. However, it complains the video memory is too low.
&gt; &gt;&gt; I'm using the QXL driver and it appears to be limited to 256MB? I've
&gt; &gt;&gt; installed the Red Hat QXL driver in Windows.
&gt; &gt;
&gt; &gt; What driver did you installed?  There are two drivers, qxl and qxldod,
&gt; &gt; for windows 10 you need the qxldod and I would give it a try to use the
&gt; &gt; latest drivers [1], not the stable ones.
&gt; &gt;
&gt; &gt; [1] &lt;https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/latest-virtio/&gt;
&gt; 
&gt; It looks like that fixed it. I must have been using the x86 version
&gt; all along, thinking the amd64 was only for AMD chips, and I have an
&gt; Intel.

That's a common mistake, amd64 is an official name for that
architecture because it was AMD who introduced that architecture, but
nowadays x86_64 is used.  It's the same as i386 and x86, the original
32-bit architecture was introduced by Intel.

&gt; I tried to change the CPU settings to those you recommended, and it
&gt; didn't like it. When I use 'virsh edit" for the host, make the cpu
&gt; changes, then try to save, I receive:
&gt; 
&gt; error: XML document failed to validate against schema: Unable to
&gt; validate doc against /usr/share/libvirt/schemas/domain.rng
&gt; Extra element cpu in interleave
&gt; Element domain failed to validate content
&gt; 
&gt; Failed. Try again? [y,n,i,f,?]:

Oh, right, that was my fault, I didn't realize that you probably have
older version of libvirt, try to use this configuration:

  &lt;cpu mode='host-passthrough'&gt;
    &lt;topology sockets='1' cores='2' threads='1'/&gt;
  &lt;/cpu&gt;

There is no "check" attribute for "cpu" element in older libvirts.

Pavel

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170822093935</emailId><senderName>llilulu</senderName><senderEmail>llilulu@yeah.net</senderEmail><timestampReceived>2017-08-22 09:39:35-0400</timestampReceived><subject>[libvirt-users] virConnectClose</subject><body>

[Attachment #2 (text/plain)]

libvirt
version: 3.4.0

    When invoke virConnectDomainEventRegisteAny register event on a hypervisor \
connection, before virConnecClose, should I invoke \
virConnectDomainEventDeregisterAny. If a hypervisor connection close unexpected, call \
virConnectDomainEventDeregisterAny will return error? Can tell me more detail about \
event? This libvirt doc not more description.  Thanks


[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div \
style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;libvirt&lt;br&gt;version: \
3.4.0&lt;br&gt;&lt;br&gt;    When invoke virConnectDomainEventRegisteAny register \
event on a hypervisor connection, before virConnecClose, should I invoke \
virConnectDomainEventDeregisterAny. If a hypervisor connection close unexpected, call \
virConnectDomainEventDeregisterAny will return error? Can tell me more detail about \
event? This libvirt doc not more description.&lt;br&gt;    Thanks&lt;span \
title="neteasefooter"&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170823210248</emailId><senderName>Don Zickus</senderName><senderEmail>dzickus@redhat.com</senderEmail><timestampReceived>2017-08-23 21:02:48-0400</timestampReceived><subject>[libvirt-users] How to configure dnsmasq using libvirt?</subject><body>

Hi,

I am working on a project, beaker, where they use anisble scripts to setup
an environment with 4 virtual machines.  One acts as a server to the other
3.

We noticed after the network was setup, the domainname is not properly
reported with using the 'hostname' command.  We believe that dnsmasq was not
correctly configured.

Is there a recommended way to setup dnsmasq using libvirt and ansible?

Thanks!

Cheers,
Don

ps - please cc me as I am not subscribed to the list

</body></email><email><emailId>20170824160652</emailId><senderName>Marko Weber</senderName><senderEmail>weber@zbfmail.de</senderEmail><timestampReceived>2017-08-24 16:06:52-0400</timestampReceived><subject>Re: [libvirt-users] NTP traffic blocked</subject><body>


hello;

Am 2017-08-22 20:01, schrieb Sinan Polat:
&gt; I have multiple VM's on the same KVM host. One of the VM's is running
&gt; NTP. All VM's can reach eachother, no firewall in between. But the
&gt; problem is, the VM's cannot communicate over port 123/udp to the NTP
&gt; VM.
&gt; 
&gt; Network: 172.24.100.0/22
&gt; 
&gt; KVM: 172.24.101.50
&gt; 
&gt; VM ntp: 172.24.102.10
&gt; 
&gt; VM foo: 172.24.102.20
&gt; 
&gt; 1. On the NTP server, listen for any incoming packets from VM foo on
&gt; port 123:
&gt; 
&gt; [ntp ~]# tcpdump -i any host 172.24.102.20 and port 123 -n
&gt; 
&gt; 2. Execute the following on server foo. Since server ntp is listening
&gt; with tcpdump, packets should be visible in tcpdump.
&gt; 
&gt; [foo ~]# ntpdate 172.24.102.10
&gt; 
&gt; This is failing:
&gt; 
&gt; ntpdate[30443]: no server suitable for synchronization found
&gt; 
&gt; No packets are coming in to the ntp server, tcpdump is just blank.
&gt; Weird.
&gt; 
&gt; To troubleshoot further, start over and do the following:
&gt; 
&gt; [ntp ~]# tcpdump -i any host 172.24.102.20 and port 123 -n ## Listen
&gt; for packets filtering host 172.24.102.20 and port 123
&gt; 
&gt; [foo ~]# tcpdump -i any host 172.24.102.10 and port 123 -n ## Listen
&gt; for packets filtering host 172.24.102.10 and port 123
&gt; 
&gt; While both tcpdumps are running, execute the following:
&gt; 
&gt; [foo ~]# ntpdate 172.24.102.10
&gt; 
&gt; Now, on the tcpdump of VM foo, you will see outgoing packets:
&gt; 
&gt; 19:45:26.644630 IP 172.24.102.20.ntp &gt; 172.24.102.10.ntp: NTPv4,
&gt; Client, length 48
&gt; 
&gt; As you can see, packets are exiting the server, but there is no
&gt; response.
&gt; 
&gt; And the tcpdump of the ntp server is still empty, it doesn't receive
&gt; the packets (so, it won't reply). But why?
&gt; 
&gt; Lets troubleshoot further and run ntpdate in debugging mode:
&gt; 
&gt; [foo ~]# ntpdate -dv 172.24.102.10
&gt; 
&gt; 22 Aug 19:51:23 ntpdate[30465]: ntpdate 4.2.6p5@1.2349-o Wed Mar  1
&gt; 09:00:52 UTC 2017 (1)
&gt; 
&gt; Looking for host 172.24.102.10 and service ntp
&gt; 
&gt; host found : some-host.com
&gt; 
&gt; transmit(172.24.102.10)
&gt; 
&gt; receive(172.24.102.10)
&gt; 
&gt; transmit(172.24.102.10)
&gt; 
&gt; receive(172.24.102.10)
&gt; 
&gt; server 172.24.102.10, port 123
&gt; 
&gt; 22 Aug 19:51:29 ntpdate[30465]: step time server 172.24.102.10 offset
&gt; 1.414813 sec
&gt; 
&gt; Wow it worked!? But it only works with the "-d" option. What is the
&gt; difference between normal and debgging mode? Lets have a closer look;
&gt; without the "-d" option, the src and dest ports are 123. When using
&gt; the "-d" option, the src port is not 123 (it is a random high port
&gt; number).
&gt; 
&gt; On the KVM host and on the VM's there is no firewall active, even if
&gt; there was a firewall, in tcpdump the packets should have been shown.
&gt; 
&gt; Anyone who can help? Thanks!
&gt; 
&gt; Sinan

i think you have to allow the machine on the vm with ntp
default after install ntp is mostly restricted to 127.0.0.1
add them to allowed hosts in the ntp config should solve it

this is the default config on gentoo linux for ntp:

# Default configuration:
# - Allow only time queries, at a limited rate, sending KoD when in 
excess.
# - Allow all local queries (IPv4, IPv6)
restrict default nomodify nopeer noquery limited kod
restrict 127.0.0.1


as you can see, no other host then the local machin is allowed.
add the other hosts and retry.

slainte

marko


&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users

</body></email><email><emailId>20170825074910</emailId><senderName>Markus Schade</senderName><senderEmail>markus.schade@gmail.com</senderEmail><timestampReceived>2017-08-25 07:49:10-0400</timestampReceived><subject>[libvirt-users] external snapshot is missing object secrets</subject><body>

Hello,

I have virtual machines running with a ceph storage backend.

When creating an external qcow2 snapshot with a libvirt version without
support for the new object secret passing, the backing file info would
list the ceph secret in plain,e.g.

# virsh snapshot-create-as vm-123 --no-metadata --disk-only --diskspec
sda,file=/var/lib/libvirt/qemu/snapshot/vm-123-wrapper.qcow2

# qemu-img info /var/lib/libvirt/qemu/snapshot/vm-123-wrapper.qcow2
...
backing file:
rbd:vms_pool0/disk-123:id=libvirt:key=SECRET:auth_supported=cephx\;none:mon_host=192.168.1.1\:6789\;192.168.1.11\:6789\;192.168.1.21\:6789


While this is problematic from a security perspective (and one of the
reasons for the new method), it enabled starting the virtual machine
again in case it died or got powered off.

With the newer libvirt object secret passing the backing file
of the qcow image only references the secret id.

# qemu-img info /var/lib/libvirt/qemu/snapshot/vm-123-wrapper.qcow2
...
backing file: json:{"driver": "raw", "file": {"password-secret":
"scsi0-0-0-0-secret0", "pool": "vms_pool", "image": "disk-123",
"driver": "rbd", "user": "libvirt", "=keyvalue-pairs":
"[\"auth_supported\", \"cephx;none\", \"mon_host\",
\"192.168.1.1:6789;192.168.1.11:6789;192.168.1.21:6789\"]"}}

This is fine as long as the virtual machine is running and with
qemu-2.10 it is even possible to block-commit this external snapshot
(Yeah!).

However, should the VM die or be powered off, it is now longer possible
to start the domain or at least recover the data:

Could not open backing file: No secret with id 'scsi0-0-0-0-secret0'

I guess this problems happens with any disk type that is accessed with
object secrets, which is why I would consider this a bug.

The question is, should/can this be fixed in libvirt or qemu?

I think libvirt should create the snapshot file with the object secret
stored in a persistent file (and reference this file in the backing file
definition)


Best regards,
Markus


</body></email><email><emailId>20170825184126</emailId><senderName>Marko Weber</senderName><senderEmail>weber@zbfmail.de</senderEmail><timestampReceived>2017-08-25 18:41:26-0400</timestampReceived><subject>Re: [libvirt-users] vm in qcow2 runs on host A but not on host B</subject><body>


yes!,

host A  x86_64
host B  x86_64
vm x86_64

i try now this: on 'host B' where vm runs,  compile "generic_x86_64" 
kernel reboot and recompile complete system with no CPU_FLAGS
and will see if 'vm' runs on 'host A'

marko


Am 2017-08-25 14:26, schrieb Marcos:
&gt; Well, linux is easier then windows.
&gt; 
&gt; The host A is 64 or 32 bits ?
&gt; The host B is 64 or 32 bits ?
&gt; The VM is 64 or 32 ?
&gt; 
&gt; 64 bits VM does not runs on 32 bits host

</body></email><email><emailId>20170828112542</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-08-28 11:25:42-0400</timestampReceived><subject>Re: [libvirt-users] dump in virEventPollRunOnce</subject><body>

On 08/21/2017 05:22 AM, llilulu wrote:
&gt; libvirt
&gt; version: 3.4.0
&gt; architecture: x86_64 ubuntu16.04-server
&gt; 
&gt; hypervisor: kvm,qemu
&gt; 
&gt; My program use libvirt event , the program is a module(.so) file in cloud \
&gt; application, when unload the module, program will dump in virEventPoolRunOnce call. \
&gt; program frame 

This is perfectly expected. IIUC you're providing your own event loop
callbacks (virEventRegisterImpl()) which are implemented in your module.
Well, if you remove it dead pointers are left behind in libvirt's
internals and thus when libvirt tries to call your function it accesses
dead pointer and thus SIGSEGVs. The proper way to do it is to unload
your module only after the last call to libvirt (and after every
connection was closed).

Michal


</body></email><email><emailId>20170828113036</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-08-28 11:30:36-0400</timestampReceived><subject>Re: [libvirt-users] libvirt event</subject><body>

On 08/22/2017 11:27 AM, llilulu wrote:
&gt; libvirt
&gt; version: 3.4.0
&gt; When use libvirt event in program, if I create more than one thread loop call \
&gt; virEventRunDefaultImp(), Is this invocation correct.

No. We don't expect more than one event loop. Although, if our code is
right (i.e. it locks correctly), it should be possible to have two or
more event loops but I have never tested that and I don't think anybody
else did. On the other hand, why do you need two event loops in the
first place? This usually means poor design.

&gt; If correct ,what happen when event occur.is many thread process event?
&gt; If I invocation virEventRegisterDefault before any hypervisor connect, and \
&gt; invocation virEventRunDefaultImp.Then I connect a hypervisor(qemu) and register \
&gt; some event on this connection. I connect another hypervisor(lxc), before lxc \
&gt; connection, I reinvocation virEventRegisterDefault and virEventRunDefaultImp, Is \
&gt; this operate correct?What happen after that?

Again, why do you want to run two event loops?

Michal


</body></email><email><emailId>20170828113443</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-08-28 11:34:43-0400</timestampReceived><subject>Re: [libvirt-users] duplicated notifications for suspend and resume</subject><body>

On 08/25/2017 11:51 AM, Martin Kletzander wrote:
&gt; On Thu, Aug 24, 2017 at 12:54:26PM +0000, Naud, AntoineX wrote:
&gt;&gt; Hello,
&gt;&gt;
&gt; 
&gt; We cannot guarantee that some events will not fire multiple times as is
&gt; some cases there is no way to check whether it is duplicate or not when
&gt; libvirt gets the information.  I have a hunch that the fact that events
&gt; can happen multiple times is written somewhere in the docs.

Also, qemu happens to send some events multiple times. Libvirt has a set
of callbacks that fire a libvirt event (among some other things). That's
the reason why you see some events doubled.

Michal

</body></email><email><emailId>20170830144538</emailId><senderName>Kashyap Chamarthy</senderName><senderEmail>kchamart@redhat.com</senderEmail><timestampReceived>2017-08-30 14:45:38-0400</timestampReceived><subject>Re: [libvirt-users] snapshot anomaly</subject><body>

On Wed, Aug 23, 2017 at 11:11:15AM -0400, Doug Hughes wrote:
&gt; Oddly, the physical file did not exist. I'm not sure it ever did? (no
&gt; proof one way or another on that)

&gt;From your example, the physical snapshot file ('overlay' file is the
correct term) -- var/lib/libvirt/images/serv1r2-savesnap.qcow2 _should_
have existed, "somehow" it got deleted.   (See more info further below.)

Can you post what is the output of:

    virsh domblklist serv1r2 

&gt; On 8/23/2017 11:09 AM, Sakhi Hadebe wrote:
&gt; &gt; I had the same problem yesterday. I found the solution from this
&gt; &gt; article
&gt; &gt; https://kashyapc.fedorapeople.org/virt/lc-2012/snapshots-handout.html.
&gt; &gt; According to the article it deletes the tracking metadata by libvirt.

That page is a bit old (I should really update it to the current state
of affairs in libvirt), but that bit of content is valid.

&gt; &gt; You can physically remove the snapshot now that there is no tracking
&gt; &gt; stream data by libvirt
&gt; &gt;
&gt; &gt; On Wed, Aug 23, 2017 at 4:56 PM, Doug Hughes
&gt; &gt; &lt;doug.hughes@keystonenap.com &lt;mailto:doug.hughes@keystonenap.com&gt;&gt; wrote:
&gt; &gt;
&gt; &gt;     THat did it! Can you esplain what was going on and how that fixed
&gt; &gt;     it? Thanks

What fixed your issue was: libvirt still has the metadata tracking
information for your snapshot (with non-existent file).  Running the
`virsh snapshot-delete` command will remove the said snapshot *metadata*
for a particular VM.

I.e. if you create a snapshot as following, for a VM called 'cvm1':

    $ virsh snapshot-create-as --domain cvm1 cvm1-overlay1 \
        --diskspec vda,file=/export/cvm1-overlay1.qcow2 \
        --disk-only --atomic

You'll then see a snapshot metadata file created under:

    /var/lib/libvirt/qemu/snapshot/cvm1/cvm1-overlay1.xml 

The above file is what libvirt removes when you run the `snapshot-delete
[...] metadata`.

--- 

As to the point about reverting to external snapshots, the short story
is, lbvirt doesn't yet support reverting to an external snapshot in one
single command.  But there are easy ways to do it by running a couple of
commands manually.


&gt; &gt;     On 8/23/2017 10:50 AM, Sakhi Hadebe wrote:
&gt; &gt;&gt;     Hi,
&gt; &gt;&gt;
&gt; &gt;&gt;     Can you try this command:
&gt; &gt;&gt;     virsh snapshot-delete serv1r2 snap --metadata
&gt; &gt;&gt;

[...]


-- 
/kashyap

</body></email><email><emailId>20170831121735</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-08-31 12:17:35-0400</timestampReceived><subject>Re: [libvirt-users] network configuration for guest specific dns-servers</subject><body>


On Thu, Aug 31, 2017 at 01:09:14PM +0200, David Ayers wrote:
&gt;Am Donnerstag, den 31.08.2017, 11:32 +0200 schrieb David Ayers:
&gt;&gt;
&gt;&gt; Am Donnerstag, den 31.08.2017, 10:11 +0200 schrieb Martin Kletzander:
&gt;&gt; &gt;
&gt;&gt; &gt; AFAIK the support for this was not added.  Feel free to request this in
&gt;&gt; &gt; our bugzilla [1] so that we can track it.  Or, even better, send a patch
&gt;&gt; &gt; if you have some time ;) It should not be difficult.
&gt;&gt;
&gt;&gt; Okay, I'll be sure to add it to bugzilla sometime soon.
&gt;
&gt;Actually, this was already reported (on the last day of 2010):
&gt;https://bugzilla.redhat.com/show_bug.cgi?id=666556
&gt;and seems to restated (two years later) in:
&gt;https://bugzilla.redhat.com/show_bug.cgi?id=824573
&gt;
&gt;and by the looks of this, generic dhcp options at global scope are
&gt;already contentious, let alone at host scope.
&gt;
&gt;So I guess we my stop configuring dnsmasq via libvirt.
&gt;

Oh, look at that.  It's good that you've found it.  Of course there are
people more proficient in the networking area who have way more thing on
their radar.  Looks like this is very often requested thing also.  I
can't speak for arbitrary options, but named ones that we know what to
map them to, should be fine and not rejected (at least not right away).
But others (especially Laine; Cc'd) could be more specific WRT your
request.

&gt;Cheers,
&gt;David
&gt;
&gt;
&gt;--
&gt;David Ayers - Team Austria
&gt;Free Software Foundation Europe (FSFE) []          (http://www.fsfe.org)
&gt;Join the Fellowship of FSFE!         [][][]      (https://fsfe.org/join)
&gt;Your donation powers our work!         ||       (http://fsfe.org/donate)

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170705154249</emailId><senderName>Jim Fehlig</senderName><senderEmail>jfehlig@suse.com</senderEmail><timestampReceived>2017-07-05 15:42:49-0400</timestampReceived><subject>Re: [libvirt-users] Question about disabling '3dnowprefetch' CPU feature in Xen Guest using libvirt</subject><body>

On 06/18/2017 09:01 PM, Charles Shih wrote:
&gt; Dear All,
&gt; 
&gt;      I'm reaching this mail-list to ask a small question about disabling 
&gt; '3dnowprefetch' CPU feature in Xen Guest using libvirt.
&gt; 
&gt;      This is my environment:
&gt;      Fedora release 26 (Twenty Six)
&gt;      4.11.0-0.rc3.git0.2.fc26.x86_64
&gt;      xen-4.8.1-2.fc26.x86_64
&gt;      libvirt-3.2.1-1.fc26.x86_64
&gt; 
&gt;      I can disable '3dnowprefetch' CPU feature in guest via 'xl' command, with 
&gt; adding `cpuid='host,3dnowprefetch=0'` into the CFG file.
&gt; 
&gt;      However, follow the instruction 
&gt; (https://libvirt.org/formatdomain.html#elementsCPU 
&gt; &lt;https://libvirt.org/formatdomain.html#elementsCPU&gt;), I added the following 
&gt; block into my XML file:
&gt; 
&gt; ```
&gt;    &lt;cpu mode='host-passthrough' check='none'&gt;
&gt;      &lt;feature policy='disable' name='3dnowprefetch'/&gt;
&gt;    &lt;/cpu&gt;
&gt; ```
&gt; 
&gt;      Created the instance, seemed this feature was not being disabled in my 
&gt; guest. (I was able to see '3dnowprefetch' in `lscpu` outputs)
&gt; 
&gt;      Anybody has idea on this? Does libvirt support this for Xen?

Currently, the libvirt libxl driver only supports VMX or SVM CPU feature, and 
for that you'd need libvirt 3.3.0

http://libvirt.org/git/?p=libvirt.git;a=commit;h=c268b9eaeb4321ef311ae2e152b80752918eb289

More support for CPU customization is on the todo list. Contributions are always 
warmly welcomed :-).

Regards,
Jim

</body></email><email><emailId>20170702082624</emailId><senderName>王李明</senderName><senderEmail>wanglm@certusnet.com.cn</senderEmail><timestampReceived>2017-07-02 08:26:24-0400</timestampReceived><subject>[libvirt-users] =?utf-8?b?562U5aSNOiAgdmlydHVhbCBkcml2ZSBwZXJm?= =?utf-8?q?ormance?=</subject><body>

UbJGR;7b MIME 8qJ=5D6`2?7VSJ&lt;~!#


mybe this is because you physic host memory is small

then this will Causing instability of the virtual machine

But I'm just guessing

You can try to increase your memory

 

 

Wang Liming

 

 

发件人: libvirt-users-bounces@redhat.com [mailto:libvirt-users-bounces@redhat.com] \
代表 Dominik Psenner 发送时间: 2017年7月2日 16:22
收件人: libvirt-users@redhat.com
主题: Re: [libvirt-users] virtual drive performance

 

Hi again,

just today an issue I've thought to be resolved popped up again. We backup the \
machine by doing:

virsh snapshot-create-as --domain domain --name backup --no-metadata --atomic \
--disk-only --diskspec hda,snapshot=external

# backup hda.qcow2

virsh blockcommit domain hda --active --pivot

Every now and then this process fails with the following error message:

error: failed to pivot job for disk hda
error: block copy still active: disk 'hda' not ready for pivot yet
Could not merge changes for disk hda of domain. VM may be in invalid state.

I expect live backups are a great asset and should work. Is this a bug that may \
relates also to the virtual drive performance issues we observe?

Cheers

 

2017-07-02 10:10 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:

Hi

a small update on this. I just migrated the vm from the site to my laptop and fired \
it up. The exact same xml configuration (except file paths and such) starts up and \
bursts with 50Mb/s to 115Mb/s in the guest. This allows only one reasonable answer: \
the cpu on my laptop is somehow better suited to emulate IO than the CPU built into \
the host on site. The host there is a HP proliant microserver gen8 with xeon \
processor. But the processor there is also never capped at 100% when the guest copies \
files.

I just ran another test by copying a 3Gb large file on the guest. What I can observe \
on my computer is that the copy process is not at a constant rate but rather starts \
with 90Mb/s, then drops down to 30Mb/s, goes up to 70Mb/s, drops down to 1Mb/s, goes \
up to 75Mb/s, drops to 1Mb/s, goes up to 55Mb/s and the pattern continues. Please \
note that the drive is still configured as:

&lt;driver name='qemu' type='qcow2' cache='none' io='threads'/&gt;

and I would expect a constant rate that is either high or low since there is no \
caching involved and the underlying hard drive is a samsung ssd evo 850. To have an \
idea how fast that drive is on my laptop:

$ dd if=/dev/zero of=testfile bs=1M count=1000 oflag=direct
1000+0 records in
1000+0 records out
1048576000 bytes (1.0 GB, 1000 MiB) copied, 2.47301 s, 424 MB/s

 

I can further observe that the smaller the saved chunks are the slower the overall \
performance is:

dd if=/dev/zero of=testfile bs=512K count=1000 oflag=direct
1000+0 records in
1000+0 records out
524288000 bytes (524 MB, 500 MiB) copied, 1.34874 s, 389 MB/s

$ dd if=/dev/zero of=testfile bs=5K count=1000 oflag=direct
1000+0 records in
1000+0 records out
5120000 bytes (5.1 MB, 4.9 MiB) copied, 0.105109 s, 48.7 MB/s

$ dd if=/dev/zero of=testfile bs=1K count=10000 oflag=direct
10000+0 records in
10000+0 records out
10240000 bytes (10 MB, 9.8 MiB) copied, 0.668438 s, 15.3 MB/s

$ dd if=/dev/zero of=testfile bs=512 count=20000 oflag=direct
20000+0 records in
20000+0 records out
10240000 bytes (10 MB, 9.8 MiB) copied, 1.10964 s, 9.2 MB/s

Could this be a limiting factor? Does qemu/kvm do many many writes of just a few \
bytes?


Ideas, anyone?

Cheers

 

2017-06-21 20:46 GMT+02:00 Dan &lt;srwx4096@gmail.com&gt;:

On Tue, Jun 20, 2017 at 04:24:32PM +0200, Gianluca Cecchi wrote:
&gt; On Tue, Jun 20, 2017 at 3:38 PM, Dominik Psenner &lt;dpsenner@gmail.com&gt; wrote:
&gt; 
&gt; &gt; 
&gt; &gt; to the following:
&gt; &gt; 
&gt; &gt; &lt;disk type='file' device='disk'&gt;
&gt; &gt; &lt;driver name='qemu' type='qcow2' cache='none'/&gt;
&gt; &gt; &lt;source file='/var/data/virtuals/machines/windows-server-2016-
&gt; &gt; x64/image.qcow2'/&gt;
&gt; &gt; &lt;backingStore/&gt;
&gt; &gt; &lt;target dev='hda' bus='scsi'/&gt;
&gt; &gt; &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt; &gt; &lt;/disk&gt;
&gt; &gt; 
&gt; &gt; Do you see any gotchas in this configuration that could prevent the
&gt; &gt; virtualized guest to power on and boot up?
&gt; &gt; 
&gt; &gt; 
&gt; When I configure like this, from a linux guest point of view I get this
&gt; Symbios Logic SCSI Controller:
&gt; 00:08.0 SCSI storage controller: LSI Logic / Symbios Logic 53c895a
&gt; 
&gt; But htis is true only if you add the SCSI controller too, not only the disk
&gt; definition.
&gt; In my case
&gt; 
&gt; &lt;controller type='scsi' index='0'&gt;
&gt; &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08'
&gt; function='0x0'/&gt;
&gt; &lt;/controller&gt;
&gt; 
&gt; Note the slot='0x08' that is reflected into the first field of lspci inside
&gt; my linux guest.
&gt; So between your controllers you have to add the SCSI one
&gt; 
&gt; In my case (Fedora 25 with virt-manager-1.4.1-2.fc25.noarch,
&gt; qemu-kvm-2.7.1-6.fc25.x86_64, libvirt-2.2.1-2.fc25.x86_64) with "Disk bus"
&gt; set as SCSI in virt-manager, the xml defintiion for the guest is
&gt; automatically updated with the controller if not existent yet.
&gt; And the disk definition sections is like this:
&gt; 
&gt; &lt;disk type='file' device='disk'&gt;
&gt; &lt;driver name='qemu' type='qcow2'/&gt;
&gt; &lt;source file='/var/lib/libvirt/images/slaxsmall.qcow2'/&gt;
&gt; &lt;target dev='sda' bus='scsi'/&gt;
&gt; &lt;boot order='1'/&gt;
&gt; &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt; &lt;/disk&gt;
&gt; 
&gt; So I think you should set dev='sda' and not 'hda' in your xml for it
&gt; 

I am actually very curious to know if that would make a difference. I
don't have a such windows vm images ready to test at present.

Dan
&gt; I don't kknow if w2016 contains the symbios logic drivers already
&gt; installed, so that a "simple" reboot could imply an automatic
&gt; reconfiguration of the guest....
&gt; Note also that in Windows when the hw configuration is considered heavily
&gt; changed, you could be asked to register again (I don't think that the IDE
&gt; --&gt; SCSI should imply it...)
&gt; 
&gt; Gianluca

&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users




-- 

Dominik Psenner




-- 

Dominik Psenner


[Attachment #3 (text/html)]

&lt;html xmlns:v="urn:schemas-microsoft-com:vml" \
xmlns:o="urn:schemas-microsoft-com:office:office" \
xmlns:w="urn:schemas-microsoft-com:office:word" \
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" \
xmlns="http://www.w3.org/TR/REC-html40"&gt;

&lt;head&gt;
&lt;meta http-equiv=Content-Type content="text/html; charset=utf-8"&gt;
&lt;meta name=Generator content="Microsoft Word 12 (filtered medium)"&gt;
&lt;style&gt;
&lt;!--
 /* Font Definitions */
 @font-face
	{font-family:宋体;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:"\@宋体";
	panose-1:2 1 6 0 3 1 1 1 1 1;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:宋体;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:purple;
	text-decoration:underline;}
span.m-9222668100434188158hoenzb
	{mso-style-name:m_-9222668100434188158hoenzb;}
span.m-9222668100434188158im
	{mso-style-name:m_-9222668100434188158im;}
span.hoenzb
	{mso-style-name:hoenzb;}
span.EmailStyle20
	{mso-style-type:personal-reply;
	font-family:"Calibri","sans-serif";
	color:black;}
.MsoChpDefault
	{mso-style-type:export-only;}
@page Section1
	{size:612.0pt 792.0pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;}
div.Section1
	{page:Section1;}
--&gt;
&lt;/style&gt;
&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
 &lt;o:shapedefaults v:ext="edit" spidmax="1026" /&gt;
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
 &lt;o:shapelayout v:ext="edit"&gt;
  &lt;o:idmap v:ext="edit" data="1" /&gt;
 &lt;/o:shapelayout&gt;&lt;/xml&gt;&lt;![endif]--&gt;
&lt;/head&gt;

&lt;body lang=ZH-CN link=blue vlink=purple&gt;

&lt;div class=Section1&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='font-family:"Calibri","sans-serif";
color:black'&gt;mybe this is because you physic host memory is \
small&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='font-family:"Calibri","sans-serif";
color:black'&gt;then this will Causing instability of the virtual \
machine&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='font-family:"Calibri","sans-serif";
color:black'&gt;But I'm just guessing&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='font-family:"Calibri","sans-serif";
color:black'&gt;You can try to increase your memory&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='font-family:"Calibri","sans-serif";
color:black'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph'&gt;&lt;span
lang=EN-US style='font-size:10.5pt;font-family:"Calibri","sans-serif";
color:black'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph'&gt;&lt;span
lang=EN-US style='font-size:10.5pt;font-family:"Calibri","sans-serif";
color:black'&gt;Wang Liming&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph'&gt;&lt;span
lang=EN-US style='font-size:10.5pt;font-family:"Calibri","sans-serif";
color:black'&gt;  &lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='font-family:"Calibri","sans-serif";
color:black'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div style='border:none;border-top:solid #B5C4DF 1.0pt;padding:3.0pt 0cm 0cm 0cm'&gt;

&lt;p class=MsoNormal&gt;&lt;b&gt;&lt;span style='font-size:10.0pt'&gt;发件人&lt;span \
lang=EN-US&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;span lang=EN-US style='font-size:10.0pt'&gt; \
libvirt-users-bounces@redhat.com [mailto:libvirt-users-bounces@redhat.com] \
&lt;/span&gt;&lt;b&gt;&lt;span style='font-size: 10.0pt'&gt;代表 &lt;/span&gt;&lt;/b&gt;&lt;span lang=EN-US \
style='font-size:10.0pt'&gt;Dominik Psenner&lt;br&gt; &lt;/span&gt;&lt;b&gt;&lt;span \
style='font-size:10.0pt'&gt;发送时间&lt;span lang=EN-US&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;span \
lang=EN-US style='font-size:10.0pt'&gt; 2017&lt;/span&gt;&lt;span \
style='font-size:10.0pt'&gt;年&lt;span lang=EN-US&gt;7&lt;/span&gt;月&lt;span \
lang=EN-US&gt;2&lt;/span&gt;日&lt;span lang=EN-US&gt; 16:22&lt;br&gt; &lt;/span&gt;&lt;b&gt;收件人&lt;span \
lang=EN-US&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang=EN-US&gt; libvirt-users@redhat.com&lt;br&gt;
&lt;/span&gt;&lt;b&gt;主题&lt;span lang=EN-US&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang=EN-US&gt; Re: [libvirt-users]
virtual drive performance&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='margin-bottom:12.0pt'&gt;&lt;span lang=EN-US&gt;Hi \
again,&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class=MsoNormal style='margin-bottom:12.0pt'&gt;&lt;span lang=EN-US&gt;just today an
issue I've thought to be resolved popped up again. We backup the machine by
doing:&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US&gt;virsh snapshot-create-as --domain domain
--name backup --no-metadata --atomic --disk-only --diskspec
hda,snapshot=external&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US&gt;# backup hda.qcow2&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class=MsoNormal style='margin-bottom:12.0pt'&gt;&lt;span lang=EN-US&gt;virsh
blockcommit domain hda --active --pivot&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class=MsoNormal style='margin-bottom:12.0pt'&gt;&lt;span lang=EN-US&gt;Every now and
then this process fails with the following error message:&lt;br&gt;
&lt;br&gt;
error: failed to pivot job for disk hda&lt;br&gt;
error: block copy still active: disk 'hda' not ready for pivot yet&lt;br&gt;
Could not merge changes for disk hda of domain. VM may be in invalid \
state.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class=MsoNormal style='margin-bottom:12.0pt'&gt;&lt;span lang=EN-US&gt;I expect live
backups are a great asset and should work. Is this a bug that may relates also
to the virtual drive performance issues we observe?&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US&gt;Cheers&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US&gt;2017-07-02 10:10 GMT+02:00 Dominik Psenner
&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;:&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='margin-bottom:12.0pt'&gt;&lt;span \
lang=EN-US&gt;Hi&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class=MsoNormal style='margin-bottom:12.0pt'&gt;&lt;span lang=EN-US&gt;a small update
on this. I just migrated the vm from the site to my laptop and fired it up. The
exact same xml configuration (except file paths and such) starts up and bursts
with 50Mb/s to 115Mb/s in the guest. This allows only one reasonable answer:
the cpu on my laptop is somehow better suited to emulate IO than the CPU built
into the host on site. The host there is a HP proliant microserver gen8 with
xeon processor. But the processor there is also never capped at 100% when the
guest copies files.&lt;br&gt;
&lt;br&gt;
I just ran another test by copying a 3Gb large file on the guest. What I can
observe on my computer is that the copy process is not at a constant rate but
rather starts with 90Mb/s, then drops down to 30Mb/s, goes up to 70Mb/s, drops
down to 1Mb/s, goes up to 75Mb/s, drops to 1Mb/s, goes up to 55Mb/s and the
pattern continues. Please note that the drive is still configured as:&lt;br&gt;
&lt;br&gt;
&lt;driver name='qemu' type='qcow2' cache='none' \
io='threads'/&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US&gt;and I would expect a constant rate that is
either high or low since there is no caching involved and the underlying hard
drive is a samsung ssd evo 850. To have an idea how fast that drive is on my
laptop:&lt;br&gt;
&lt;br&gt;
$ dd if=/dev/zero of=testfile bs=1M count=1000 oflag=direct&lt;br&gt;
1000+0 records in&lt;br&gt;
1000+0 records out&lt;br&gt;
1048576000 bytes (1.0 GB, 1000 MiB) copied, 2.47301 s, 424 MB/s&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='margin-bottom:12.0pt'&gt;&lt;span lang=EN-US&gt;I can further
observe that the smaller the saved chunks are the slower the overall
performance is:&lt;br&gt;
&lt;br&gt;
dd if=/dev/zero of=testfile bs=512K count=1000 oflag=direct&lt;br&gt;
1000+0 records in&lt;br&gt;
1000+0 records out&lt;br&gt;
524288000 bytes (524 MB, 500 MiB) copied, 1.34874 s, 389 MB/s&lt;br&gt;
&lt;br&gt;
$ dd if=/dev/zero of=testfile bs=5K count=1000 oflag=direct&lt;br&gt;
1000+0 records in&lt;br&gt;
1000+0 records out&lt;br&gt;
5120000 bytes (5.1 MB, 4.9 MiB) copied, 0.105109 s, 48.7 MB/s&lt;br&gt;
&lt;br&gt;
$ dd if=/dev/zero of=testfile bs=1K count=10000 oflag=direct&lt;br&gt;
10000+0 records in&lt;br&gt;
10000+0 records out&lt;br&gt;
10240000 bytes (10 MB, 9.8 MiB) copied, 0.668438 s, 15.3 MB/s&lt;br&gt;
&lt;br&gt;
$ dd if=/dev/zero of=testfile bs=512 count=20000 oflag=direct&lt;br&gt;
20000+0 records in&lt;br&gt;
20000+0 records out&lt;br&gt;
10240000 bytes (10 MB, 9.8 MiB) copied, 1.10964 s, 9.2 MB/s&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US&gt;Could this be a limiting factor? Does
qemu/kvm do many many writes of just a few bytes?&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='margin-bottom:12.0pt'&gt;&lt;span lang=EN-US&gt;&lt;br&gt;
Ideas, anyone?&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US&gt;Cheers&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US&gt;2017-06-21 20:46 GMT+02:00 Dan &lt;&lt;a
href="mailto:srwx4096@gmail.com" \
target="_blank"&gt;srwx4096@gmail.com&lt;/a&gt;&gt;:&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;blockquote style='border:none;border-left:solid #CCCCCC 1.0pt;padding:0cm 0cm 0cm \
6.0pt; margin-left:4.8pt;margin-right:0cm'&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US&gt;On Tue, Jun 20, 2017 at 04:24:32PM +0200,
Gianluca Cecchi wrote:&lt;br&gt;
&gt; On Tue, Jun 20, 2017 at 3:38 PM, Dominik Psenner &lt;&lt;a
href="mailto:dpsenner@gmail.com" target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt; \
wrote:&lt;br&gt; &gt;&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; to the following:&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; &lt;disk type='file' device='disk'&gt;&lt;br&gt;
&gt; &gt;   &lt;driver name='qemu' type='qcow2' cache='none'/&gt;&lt;br&gt;
&gt; &gt;   &lt;source
file='/var/data/virtuals/machines/windows-server-2016-&lt;br&gt;
&gt; &gt; x64/image.qcow2'/&gt;&lt;br&gt;
&gt; &gt;   &lt;backingStore/&gt;&lt;br&gt;
&gt; &gt;   &lt;target dev='hda' bus='scsi'/&gt;&lt;br&gt;
&gt; &gt;   &lt;address type='drive' controller='0' bus='0'
target='0' unit='0'/&gt;&lt;br&gt;
&gt; &gt; &lt;/disk&gt;&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; Do you see any gotchas in this configuration that could prevent the&lt;br&gt;
&gt; &gt; virtualized guest to power on and boot up?&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; When I configure like this, from a linux guest point of view I get this&lt;br&gt;
&gt; Symbios Logic SCSI Controller:&lt;br&gt;
&gt; 00:08.0 SCSI storage controller: LSI Logic / Symbios Logic 53c895a&lt;br&gt;
&gt;&lt;br&gt;
&gt; But htis is true only if you add the SCSI controller too, not only the
disk&lt;br&gt;
&gt; definition.&lt;br&gt;
&gt; In my case&lt;br&gt;
&gt;&lt;br&gt;
&gt;     &lt;controller type='scsi' index='0'&gt;&lt;br&gt;
&gt;       &lt;address type='pci' domain='0x0000'
bus='0x00' slot='0x08'&lt;br&gt;
&gt; function='0x0'/&gt;&lt;br&gt;
&gt;     &lt;/controller&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; Note the slot='0x08' that is reflected into the first field of lspci
inside&lt;br&gt;
&gt; my linux guest.&lt;br&gt;
&gt; So between your controllers you have to add the SCSI one&lt;br&gt;
&gt;&lt;br&gt;
&gt; In my case (Fedora 25 with virt-manager-1.4.1-2.fc25.noarch,&lt;br&gt;
&gt; qemu-kvm-2.7.1-6.fc25.x86_64, libvirt-2.2.1-2.fc25.x86_64) with "Disk
bus"&lt;br&gt;
&gt; set as SCSI in virt-manager, the xml defintiion for the guest is&lt;br&gt;
&gt; automatically updated with the controller if not existent yet.&lt;br&gt;
&gt; And the disk definition sections is like this:&lt;br&gt;
&gt;&lt;br&gt;
&gt;     &lt;disk type='file' device='disk'&gt;&lt;br&gt;
&gt;       &lt;driver name='qemu' type='qcow2'/&gt;&lt;br&gt;
&gt;       &lt;source \
file='/var/lib/libvirt/images/slaxsmall.qcow2'/&gt;&lt;br&gt; &gt;      \
 &lt;target dev='sda' bus='scsi'/&gt;&lt;br&gt; &gt;      \
 &lt;boot order='1'/&gt;&lt;br&gt; &gt;       &lt;address \
type='drive' controller='0' bus='0' target='0' unit='0'/&gt;&lt;br&gt;
&gt;     &lt;/disk&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; So I think you should set dev='sda' and not 'hda' in your xml for it&lt;br&gt;
&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;p class=MsoNormal style='margin-bottom:12.0pt'&gt;&lt;span lang=EN-US&gt;I am actually
very curious to know if that would make a difference. I&lt;br&gt;
don't have a such windows vm images ready to test at present.&lt;br&gt;
&lt;span style='color:#888888'&gt;&lt;br&gt;
&lt;span class=m-9222668100434188158hoenzb&gt;Dan&lt;/span&gt;&lt;br&gt;
&lt;/span&gt;&lt;span class=m-9222668100434188158im&gt;&gt; I don't kknow if w2016 contains
the symbios logic drivers already&lt;/span&gt;&lt;br&gt;
&lt;span class=m-9222668100434188158im&gt;&gt; installed, so that a
"simple" reboot could imply an automatic&lt;/span&gt;&lt;br&gt;
&lt;span class=m-9222668100434188158im&gt;&gt; reconfiguration of the guest....&lt;/span&gt;&lt;br&gt;
&lt;span class=m-9222668100434188158im&gt;&gt; Note also that in Windows when the hw
configuration is considered heavily&lt;/span&gt;&lt;br&gt;
&lt;span class=m-9222668100434188158im&gt;&gt; changed, you could be asked to
register again (I don't think that the IDE&lt;/span&gt;&lt;br&gt;
&lt;span class=m-9222668100434188158im&gt;&gt; --&gt; SCSI should imply it...)&lt;/span&gt;&lt;br&gt;
&lt;span class=m-9222668100434188158im&gt;&gt;&lt;/span&gt;&lt;br&gt;
&lt;span class=m-9222668100434188158im&gt;&gt; Gianluca&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='margin-bottom:12.0pt'&gt;&lt;span lang=EN-US&gt;&gt;
_______________________________________________&lt;br&gt;
&gt; libvirt-users mailing list&lt;br&gt;
&gt; &lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" \
target="_blank"&gt;https://www.redhat.com/mailman/listinfo/libvirt-users&lt;/a&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;


&lt;/div&gt;

&lt;/div&gt;

&lt;/blockquote&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='color:#888888'&gt;&lt;br&gt;
&lt;br clear=all&gt;
&lt;br&gt;
&lt;span class=hoenzb&gt;-- &lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='color:#888888'&gt;Dominik Psenner&lt;/span&gt;&lt;span
lang=EN-US&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US&gt;&lt;br&gt;
&lt;br clear=all&gt;
&lt;br&gt;
-- &lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US&gt;Dominik Psenner&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/body&gt;

&lt;/html&gt;



</body></email><email><emailId>20170701073459</emailId><senderName>Masoud</senderName><senderEmail>tornado2800@gmail.com</senderEmail><timestampReceived>2017-07-01 07:34:59-0400</timestampReceived><subject>[libvirt-users] Activation of org.freedesktop.machine1 timed out</subject><body>

Hi
recently i have this error on our server....

how i can fix it?


# systemctl status libvirtd
● libvirtd.service - Virtualization daemon
   Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled;
vendor preset: enabled)
   Active: active (running) since Sat 2017-07-01 11:08:50 EDT; 2min 54s ago
     Docs: man:libvirtd(8)
           http://libvirt.org
 Main PID: 5233 (libvirtd)
   CGroup: /system.slice/libvirtd.service
           └─5233 /usr/sbin/libvirtd

Jul 01 11:10:51 localhost.localdomain libvirtd[5233]: error from service:
GetMachineByPID: Activation of org.
Jul 01 11:11:16 localhost.localdomain libvirtd[5233]: error from service:
GetMachineByPID: Activation of org.
Jul 01 11:11:16 localhost.localdomain libvirtd[5233]: error from service:
GetMachineByPID: Activation of org.
Jul 01 11:11:16 localhost.localdomain libvirtd[5233]: error from service:
GetMachineByPID: Activation of org.
Jul 01 11:11:16 localhost.localdomain libvirtd[5233]: error from service:
GetMachineByPID: Activation of org.
Jul 01 11:11:16 localhost.localdomain libvirtd[5233]: error from service:
GetMachineByPID: Activation of org.
Jul 01 11:11:16 localhost.localdomain libvirtd[5233]: error from service:
GetMachineByPID: Activation of org.
Jul 01 11:11:16 localhost.localdomain libvirtd[5233]: error from service:
GetMachineByPID: Activation of org.
Jul 01 11:11:42 localhost.localdomain libvirtd[5233]: Activation of
org.freedesktop.machine1 timed out
Jul 01 11:11:42 localhost.localdomain libvirtd[5233]: internal error:
Failed to autostart VM 'v4375': Activat


-- 
Chief Technology officer
Masoud

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi&lt;div&gt;recently i have this error on our \
server....&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;how i can fix \
it?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# systemctl status \
libvirtd&lt;/div&gt;&lt;div&gt;● libvirtd.service - Virtualization daemon&lt;/div&gt;&lt;div&gt;     \
Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled; vendor preset: \
enabled)&lt;/div&gt;&lt;div&gt;     Active: active (running) since Sat 2017-07-01 11:08:50 EDT; \
2min 54s ago&lt;/div&gt;&lt;div&gt;        Docs: man:libvirtd(8)&lt;/div&gt;&lt;div&gt;                 &lt;a \
href="http://libvirt.org"&gt;http://libvirt.org&lt;/a&gt;&lt;/div&gt;&lt;div&gt;  Main PID: 5233 \
(libvirtd)&lt;/div&gt;&lt;div&gt;     CGroup: /system.slice/libvirtd.service&lt;/div&gt;&lt;div&gt;           \
└─5233 /usr/sbin/libvirtd&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Jul 01 11:10:51 \
localhost.localdomain libvirtd[5233]: error from service: GetMachineByPID: Activation \
of org.&lt;/div&gt;&lt;div&gt;Jul 01 11:11:16 localhost.localdomain libvirtd[5233]: error from \
service: GetMachineByPID: Activation of org.&lt;/div&gt;&lt;div&gt;Jul 01 11:11:16 \
localhost.localdomain libvirtd[5233]: error from service: GetMachineByPID: Activation \
of org.&lt;/div&gt;&lt;div&gt;Jul 01 11:11:16 localhost.localdomain libvirtd[5233]: error from \
service: GetMachineByPID: Activation of org.&lt;/div&gt;&lt;div&gt;Jul 01 11:11:16 \
localhost.localdomain libvirtd[5233]: error from service: GetMachineByPID: Activation \
of org.&lt;/div&gt;&lt;div&gt;Jul 01 11:11:16 localhost.localdomain libvirtd[5233]: error from \
service: GetMachineByPID: Activation of org.&lt;/div&gt;&lt;div&gt;Jul 01 11:11:16 \
localhost.localdomain libvirtd[5233]: error from service: GetMachineByPID: Activation \
of org.&lt;/div&gt;&lt;div&gt;Jul 01 11:11:16 localhost.localdomain libvirtd[5233]: error from \
service: GetMachineByPID: Activation of org.&lt;/div&gt;&lt;div&gt;Jul 01 11:11:42 \
localhost.localdomain libvirtd[5233]: Activation of org.freedesktop.machine1 timed \
out&lt;/div&gt;&lt;div&gt;Jul 01 11:11:42 localhost.localdomain libvirtd[5233]: internal error: \
Failed to autostart VM 'v4375': Activat&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- \
&lt;br&gt;&lt;div class="gmail_signature"&gt;&lt;div dir="ltr"&gt;Chief Technology \
officer&lt;div&gt;Masoud&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170703124400</emailId><senderName></senderName><senderEmail>virt.persik</senderEmail><timestampReceived>2017-07-03 12:44:00-0400</timestampReceived><subject>[libvirt-users] Broken br0</subject><body>

Hello,

I wanted to get an extra IP on my local NIC, so I ran `sudo ip addr add
192.168.1.130/24 dev enp4s0`. This didn't work as intended, so I thought
I'd restart the Ubuntu system to have things back to how they were.

Alas, this didn't happen. While the host still has network as usual, none
of the VMs are able to get a DHCP lease from the router, or any
connectivity at all.

I can still see br0 with `ip addr`, but my guess is that it's misconfigured
now.

I tried adding a br1 with virt-manager (Edit &gt; Connection details &gt; Network
interfaces &gt; Add interface) and using that instead, but the app crashed
halfway through; and I can't disable or remove the connection with the app
now.

I wonder if this isn't a routing issue, but I am not very proficient in
that area to troubleshoot and fix.

Where should I start? I'd like to use this as an opportunity to learn more
about networking and VMs, so bear with me if I ask stupid/basic questions.
Thanks!

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hello,
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I wanted to get an extra IP on my local NIC, so I ran `sudo ip \
addr add &lt;a href="http://192.168.1.130/24"&gt;192.168.1.130/24&lt;/a&gt; dev enp4s0`. This \
didn't work as intended, so I thought I'd restart the Ubuntu system to have \
things back to how they were.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Alas, this didn't happen. \
While the host still has network as usual, none of the VMs are able to get a DHCP \
lease from the router, or any connectivity at all.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I can \
still see br0 with `ip addr`, but my guess is that it's misconfigured \
now.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I tried adding a br1 with virt-manager (Edit &gt; \
Connection details &gt; Network interfaces &gt; Add interface) and using that \
instead, but the app crashed halfway through; and I can't disable or remove the \
connection with the app now.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I wonder if this isn't a \
routing issue, but I am not very proficient in that area to troubleshoot and \
fix.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Where should I start? I'd like to use this as an \
opportunity to learn more about networking and VMs, so bear with me if I ask \
stupid/basic questions. Thanks!&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170704073157</emailId><senderName>Jędrek Domański</senderName><senderEmail>jedrek.domanski@gmail.com</senderEmail><timestampReceived>2017-07-04 07:31:57-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

Hello? What is the status of this issue?

2017-06-30 22:24 GMT+02:00 J=C4=99drek Doma=C5=84ski &lt;jedrek.domanski@gmail=
.com&gt;:

&gt; Hi
&gt;
&gt; I have recently upgraded from Ubuntu 15.04 to 16.04 and now everytime I
&gt; shutdown my PC I get a black screen where it says "libvirt-guests.sh [691=
7]
&gt; - running guests under URI address default: no running guests" and the PC
&gt; just hangs forever and will not shutdown. I need to manually kill it in
&gt; order to shut it down which is a pain in the ass. I have done some
&gt; investigation and here is what I've found out so far.
&gt;
&gt; I have uninstalled libvirt, kvm and qemu:
&gt;
&gt; sudo apt-get purge libvirt* kvm qemu*
&gt;
&gt; The problem has gone, however I noticed some error messages at boot sayin=
g
&gt; something that "FAILED Qemu .... It flashes so quickly and I am not able =
to
&gt; read what exactly it says. I installed libvirt again:
&gt;
&gt; sudo apt install qemu-kvm libvirt-bin
&gt;
&gt; and the problem is back!
&gt;
&gt; So is this script trying to shutdown my virtual machines? It looks like i=
t
&gt; does but since it does not find any it hangs? I don't have any machines,
&gt; though. I used to have one, but I removed it. What is interesting, my PC
&gt; hangs at shutdown randomly, that is sometimes it hangs for like 15 second=
s
&gt; and it shutsdown but in most cases it hangs forever. So this happens
&gt; randomly.
&gt;
&gt; So, this investigation has brought me to you guys so please help me. I
&gt; have attached a screen (sorry for polish error message but the translatio=
n
&gt; is in the email title).
&gt;
&gt; I have also posted a thread on AskUbuntu on this:
&gt;
&gt; https://askubuntu.com/questions/925696/ubuntu-16-04-libvirt-
&gt; guests-sh-6917-running-guests-under-uri-address-default
&gt;
&gt; Thank you,
&gt; J=C4=99drzej
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Hello? What is the status of this \
issue?&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-06-30 \
22:24 GMT+02:00 Jędrek Domański &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div class="HOEnZb"&gt;&lt;div class="h5"&gt;&lt;div dir="ltr"&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;Hi&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;I have recently upgraded from Ubuntu 15.04 to 16.04 and now \
everytime I shutdown my PC I get a black screen where it says "libvirt-guests.sh \
[6917] - running guests under URI address default: no running guests" and the PC \
just hangs forever and will not shutdown. I need to manually kill it in order to shut \
it down which is a pain in the ass. I have done some investigation and here is what \
I've found out so far.&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;I have uninstalled libvirt, kvm and qemu:&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;pre \
style="white-space:pre-wrap;margin-top:0px;margin-bottom:1em;padding:5px;border:0px;fo \
nt-variant-numeric:inherit;font-stretch:inherit;font-size:13px;line-height:inherit;font-family:Consolas,Menlo,Monaco,"Lucida \
Console","Liberation Mono","DejaVu Sans \
Mono","Bitstream Vera Sans Mono","Courier \
New",monospace,sans-serif;vertical-align:baseline;width:auto;max-height:600px;ove \
rflow:auto;background-color:rgb(239,240,241);word-wrap:normal;color:rgb(17,17,17)"&gt;&lt;code \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;line-height:inherit;font-family:Consolas,Menlo,Monaco,"Lucida \
Console","Liberation Mono","DejaVu Sans \
Mono","Bitstream Vera Sans Mono","Courier \
New",monospace,sans-serif;vertical-align:baseline;white-space:inherit"&gt;sudo \
apt-get purge libvirt* kvm qemu*&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;The problem has gone, however I noticed some error messages \
at boot saying something that "FAILED Qemu .... It flashes so quickly and I am \
not able to read what exactly it says. I installed libvirt again:&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;pre \
class="m_6636733946930978432gmail-m_-849249386569305750gmail-contents" \
style="white-space:pre-wrap;margin-top:0px;margin-bottom:8px;padding:0.5em \
1em;border:1px dashed \
rgb(193,180,150);font-size:13px;line-height:16px;font-family:UbuntuMono,courier,monosp \
ace;vertical-align:baseline;background-color:rgb(243,243,243);word-wrap:break-word;color:rgb(51,51,51)"&gt;&lt;span \
class="m_6636733946930978432gmail-m_-849249386569305750gmail-cmd \
m_6636733946930978432gmail-m_-849249386569305750gmail-command" \
style="margin:0px;padding:0px;border:0px;font-weight:inherit;font-style:inherit;line-h \
eight:1.5;font-family:monospace;vertical-align:baseline;background-color:rgb(242,242,242)"&gt;sudo \
apt install qemu-kvm libvirt-bin&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;and the problem is back!&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;So is this script trying to shutdown my virtual machines? It \
looks like it does but since it does not find any it hangs? I don't have any \
machines, though. I used to have one, but I removed it. What is interesting, my PC \
hangs at shutdown randomly, that is sometimes it hangs for like 15 seconds and it \
shutsdown but in most cases it hangs forever. So this happens randomly.&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;So, this investigation has brought me to you guys so please \
help me. I have attached a screen (sorry for polish error message but the translation \
is in the email title).&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;I have also posted a thread on AskUbuntu on this:&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;a href="https://askubuntu.com/questions/925696/ubuntu-16-04-libvirt-guests-sh-6917-runni" \
target="_blank"&gt;https://askubuntu.com/question&lt;wbr&gt;s/925696/ubuntu-16-04-libvirt-&lt;wbr&gt;guests-sh-6917-runni&lt;/a&gt;&lt;/font&gt;&lt;span \
style="font-family:arial,helvetica,sans-serif"&gt;ng-guests-&lt;wbr&gt;under-uri-address-default&lt;/span&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;span \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font \
face="arial, helvetica, sans-serif"&gt;Thank you,&lt;/font&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;Jędrzej&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170711053431</emailId><senderName>Leroy Tennison</senderName><senderEmail>leroy.tennison@verizon.net</senderEmail><timestampReceived>2017-07-11 05:34:31-0400</timestampReceived><subject>[libvirt-users] Is there still no easier way to shrink a VM image?</subject><body>

I have numerous qcow2 images which need to be reduced in size and have 
their maximum size (virtual size) reduced.  Physical disk space became 
so low that VMs "auto-paused" themselves, I moved enough images to solve 
the immediate problem but need to rectify the underlying issue.  It 
seems that qcow[2] files are grown in size such that the data inside of 
them takes about 50-60% of the space (does anyone know the actual 
algorithm or how to control it?).  Given the total physical disk space 
on the hypervisors, I need something more restrictive.

Our hypervisors are a mix of Ubuntu 14 or 16 LTS (qemu-img 2.2 or 2.5).  
After doing all the preparation (defragment, reduce OS partition size) 
"qemu-img resize" reports that shrinking isn't supported yet.  My web 
research indicates that, to accomplish this,  I have to:

    convert to raw

    shrink the image

    convert back to qcow[2]

    increase the image size to provide for some growth

I'm hoping I've missed something in my research and that someone knows 
an easier way.  I don't feel constrained to qemu-img but this is a 
production environment precluding consideration of experimental 
software.  Virt-resize, guestfish or any other reasonable option is fine 
with me.  Solutions or ideas?  Thanks.


[Attachment #3 (text/html)]

&lt;html&gt;
  &lt;head&gt;

    &lt;meta http-equiv="content-type" content="text/html; charset=utf-8"&gt;
  &lt;/head&gt;
  &lt;body text="#000000" bgcolor="#FFFFFF"&gt;
    &lt;p&gt;I have numerous qcow2 images which need to be reduced in size and
      have their maximum size (virtual size) reduced.   Physical disk
      space became so low that VMs "auto-paused" themselves, I moved
      enough images to solve the immediate problem but need to rectify
      the underlying issue.   It seems that qcow[2] files are grown in
      size such that the data inside of them takes about 50-60% of the
      space (does anyone know the actual algorithm or how to control
      it?).   Given the total physical disk space on the hypervisors, I
      need something more restrictive.&lt;/p&gt;
    &lt;p&gt;Our hypervisors are a mix of Ubuntu 14 or 16 LTS (qemu-img 2.2 or
      2.5).   After doing all the preparation (defragment, reduce OS
      partition size) "qemu-img resize" reports that shrinking isn't
      supported yet.   My web research indicates that, to accomplish
      this,   I have to:&lt;/p&gt;
    &lt;blockquote&gt;
      &lt;p&gt; convert to raw&lt;/p&gt;
      &lt;p&gt; shrink the image&lt;/p&gt;
      &lt;p&gt;convert back to qcow[2]&lt;/p&gt;
      &lt;p&gt;increase the image size to provide for some growth&lt;/p&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;I'm hoping I've missed something in my research and that someone
      knows an easier way.   I don't feel constrained to qemu-img but
      this is a production environment precluding consideration of
      experimental software.   Virt-resize, guestfish or any other
      reasonable option is fine with me.   Solutions or ideas?   Thanks.&lt;br&gt;
    &lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;


</body></email><email><emailId>20170709145604</emailId><senderName>jason</senderName><senderEmail>huzhijiang@gmail.com</senderEmail><timestampReceived>2017-07-09 14:56:04-0400</timestampReceived><subject>[libvirt-users] VM freezes while insmod virtio_net.ko</subject><body>

Hi all,

I encountered a tricky problem. I am using ovs+DPDK on the host side
to build the virtual network, so on the VM side , the virtio_net.ko
module is used to drive the nic. But VM always freezes while insmod
virtio_net.ko (I found  virtio_net.ko is located in initrams.img by
defualt, so I had to delete all virtio modules from initramfs.img and
insmod then one by one after system is loaded to confirm that).

After such freeze, virsh reset can not recover it due to cannot
acquire state change lock (held by remoteDispatchDomainReset) so I
have to use virsh destroy instead.

On the ovs-vswitchd side, the last log I can see is:


VHOST_CONFIG: read message VHOST_USER_SET_VRING_NUM
VHOST_CONFIG: read message VHOST_USER_SET_VRING_BASE
VHOST_CONFIG: read message VHOST_USER_SET_VRING_ADDR
VHOST_CONFIG: read message VHOST_USER_SET_VRING_KICK
VHOST_CONFIG: vring kick idx:0 file:59
VHOST_CONFIG: virtio is not ready for processing.
VHOST_CONFIG: read message VHOST_USER_SET_VRING_CALL
VHOST_CONFIG: vring call idx:0 file:60
VHOST_CONFIG: read message VHOST_USER_SET_VRING_NUM
VHOST_CONFIG: read message VHOST_USER_SET_VRING_BASE
VHOST_CONFIG: read message VHOST_USER_SET_VRING_ADDR
VHOST_CONFIG: read message VHOST_USER_SET_VRING_KICK
VHOST_CONFIG: vring kick idx:1 file:46
VHOST_CONFIG: virtio is not ready for processing.
VHOST_CONFIG: read message VHOST_USER_SET_VRING_CALL
VHOST_CONFIG: vring call idx:1 file:61
VHOST_CONFIG: read message VHOST_USER_SET_VRING_ENABLE
VHOST_CONFIG: set queue enable: 1 to qp idx: 0
VHOST_CONFIG: read message VHOST_USER_SET_VRING_ENABLE
VHOST_CONFIG: set queue enable: 1 to qp idx: 1
VHOST_CONFIG: read message VHOST_USER_SET_FEATURES

Software version I used are:

guest kernel: 3.10.0-514.26.2.el7.x86_64
host kernel: 3.10.0-514.26.2.el7.x86_64
host libvirt: 2.0.0-10.el7_3.9.x86_64
host qemu: 2.6.0-28.el7.10.1
host openvswitch: git 2.7.0
host DPDK: git  17.02.0

Please help to have a look at this issue.

-- 
B.R.,
Jason

</body></email><email><emailId>20170713112646</emailId><senderName>Laszlo Ersek</senderName><senderEmail>lersek@redhat.com</senderEmail><timestampReceived>2017-07-13 11:26:46-0400</timestampReceived><subject>Re: [libvirt-users] [Fwd:  UEFI NVRAM variables]</subject><body>

Hi,

thank you, Andrea, for the forward.

On 07/13/17 10:19, Andrea Bolognani wrote:
&gt; -------- Forwarded Message --------
&gt; From: Thomas Meyer &lt;thomas@m3y3r.de&gt;
&gt; To: libvirt-users@redhat.com
&gt; Subject: [libvirt-users] UEFI NVRAM variables
&gt; Date: Wed, 12 Jul 2017 07:49:43 +0200
&gt; 
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; how do I set the BootOrder variable in an NVRAM file for UEFI boot?

This is one of the most frequently asked questions about OVMF.

Short version:
- alternative 1: use neither &lt;boot dev="..."/&gt; nor &lt;boot index="..."/&gt;
in your domain XML, and manage the BootOrder and Boot#### variables
entirely within the guest (using the OVMF Setup TUI and/or the
efibootmgr utility).
- alternative 2: use &lt;boot index="..."/&gt; in your domain XML, and it will
mostly do what you want.

Mid-size version:

* Never use "-boot order=x,y,z" with OVMF, on the QEMU command line,
because the guest-visible effects of this QEMU option are fully useless
to UEFI guest firmware. For more details, please refer to
&lt;https://bugzilla.redhat.com/show_bug.cgi?id=1323085#c10&gt;.

Translating the above to libvirt, never use &lt;boot dev='...'/&gt; elements
in your domain XML with UEFI guest firmware. (They are also discouraged
by the libvirt documentation, for their non-unique meaning.)

* The "-device xxx,bootindex=N" properties on the QEMU command line are
usable and useful to UEFI guest firmware. (This is what libvirt's &lt;boot
order='N'/&gt; per-device elements map to, which are also what the libvirt
docs recommend.)

However, the expressive power of these properties is still lesser than
the expressive power of the UEFI boot options, therefore the best that
OVMF can do here is a kind of auto-generation of all possible boot
options, and filtering and reordering them based on translation and
prefix-matching.

For that, the long version: please refer to the OVMF whitepaper from a
few years back, where I described this algorithm in excruciating detail:

http://www.linux-kvm.org/downloads/lersek/ovmf-whitepaper-c770f8c.txt

Search it for "Platform-specific boot policy".

&gt;&gt; Is there a way to configure a domain with the bios qemu option instead of pflash?

If you want to boot a guest with OVMF as firmware, but map the firmware
as ROM, not as pflash, you can do it. For that, you have to use the
unified OVMF image (called "OVMF.fd" most commonly), not the split image
(called "OVMF_CODE.fd" and other variants). The &lt;loader&gt; element should
look like:

  &lt;loader&gt;/usr/share/OVMF/OVMF.fd&lt;/loader&gt;

and the &lt;nvram&gt; element should not be present.

This will map to "-bios OVMF.fd" on the QEMU command line.

Be *strongly* warned though that by this, you are throwing away
persistent non-volatile variables, and that the fake variable support
that OVMF falls back to does not -- cannot -- conform to the UEFI spec.
You will encounter obscure mis-behavior with variables. (One of the
obvious glitches will be that Secure Boot settings will not survive a
reboot.)

&gt;&gt;
&gt;&gt; Are there a tool available to manipulate the UEFI variables from the outside?

No, there isn't, and as far as it's up to me, there won't be. (This is
another of the most frequently asked questions.)

The reason for this is that the representation of the variable store on
the host filesystem (in /var/lib/libvirt/qemu/nvram/&lt;guest&gt;_VARS.fd) is
the functional composition of three layers in the edk2 driver stack:

- platform-specific pflash driver / layout
- generic fault tolerant write driver (implementing a kind of journaled
  system, where you can "lose power" in the middle of a write operation,
  and your varstore won't be corrupted)
- generic variable driver

None of these are standardized in UEFI, and even restricting ourselves
to edk2 (the reference implementation of PI/UEFI), only the last two
layers are documented in Intel whitepapers. Regarding examples for the
first layer, OVMF itself can be built with two distinct (and
incompatible) variable store layouts, and the ArmVirtQemu varstore
layout is again different.

In other words, a host-side utility to parse and modify these files
would have to reimplement the functionality of the above three layers,
deal with, and clean up, interrupted writes (see the fault tolerant
writer level), and generally keep chasing any pertinent changes in the
edk2 codebase. (Upstream edk2 does not guarantee backwards compatibility
with existent variable stores, and it does not provide conversion tools
either.) If someone feels up to writing and continuously maintaining
such a host-side utility, I won't try to prevent them. But, I won't be
that person.

Another approach would be to replace the above-mentioned variable driver
stack in OVMF, with a custom "paravirt" variable driver implementation.
This would be a large project, and even if I were sympathetic to it
(which I'm not), I'm pretty sure it wouldn't be welcome to upstream edk2
(because competing, parallel implementations for the same thing are a
big maintenance burden). I vaguely suspect that a giga-company whose
name starts with G and refers to a very large number has done this,
targeting their own (unreleased / proprietary) VMM, but to my knowledge
their variable driver implementation is similarly unreleased / proprietary.

Either way, massaging guest-produced data from the host side, be the
data "UEFI variable content" or "disk image content", is also a security
question. So the only one really feasible approach here would be a
libguestfs-like tool that
- booted a guest on top of the variable store,
- implemented a kind of "firmware guest agent" that manipulated the
variables "from the inside",
- and used custom commands over virtio-serial, between host and guest.

As I said, a large project.

Thanks,
Laszlo

</body></email><email><emailId>20170711144726</emailId><senderName>Antoine Millet</senderName><senderEmail>antoine@inaps.org</senderEmail><timestampReceived>2017-07-11 14:47:26-0400</timestampReceived><subject>[libvirt-users] Hot-migration of OVS Vlan configuration</subject><body>


Hi list,

I'm using OVS as backend for guest networking on my hypervisors. VLAN
configuration for each interface is specified into the guest XML
definition.

When I need to change VLAN configuration of a running guest, I first
edit the inactive XML to keep the changes for future boots, then I use
ovs-vsctl to instruct the changes on the existing OVS Port.

The problem happen when the guest is migrated to another hypervisor.
The "active" XML is used to instantiate the VM on the destination and
this XML doesn't incorporate the changes made to the inactive one. All
the changes made on source are lost on the running guest at
destination.

I'm looking for a solution to this problem:

- IFAIK, I cannot edit the "active" XML myself other than by using
provided Libvirt API (like attach-device), and such API doesn't exists
for VLANs modification on OVS interface
- I cannot use a migration hook to pass changes made to the inactive
XML into the active one because the inactive XML is not reachable from
the hook
- I found a patch allowing to transport some information attached to an
OVS port during migration[1]. Unfortunately, this patch doesn't
transport the VLAN configuration
- Modification of the active XML during the migration itself is not
desirable because it will complicate the migration process by
requesting an external tool

Did I miss something to achieve VLAN configuration migration? How to
implement that into the Libvirt properly?

Thanks!

Antoine

[1] https://www.redhat.com/archives/libvir-list/2012-September/msg01092
.html
["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170704010801</emailId><senderName>Lei Zhang</senderName><senderEmail>lei12zhang12@gmail.com</senderEmail><timestampReceived>2017-07-04 01:08:01-0400</timestampReceived><subject>Re: [libvirt-users] Way to detect virtual machine cpu features</subject><body>

Hi, any comment or suggestion

On Thu, Jun 29, 2017 at 10:55 AM, Lei Zhang &lt;lei12zhang12@gmail.com&gt; wrote:

&gt; Hello everyone
&gt;
&gt;  I want to know how can I use libvirt to detect what cpu features a
&gt; virtual machine will see.
&gt;
&gt; I guess I could do it in following way:
&gt;
&gt; 1. if cpu mode is 'custom', use 'virsh cpu-baseline --features' on the
&gt; cpu model to get model features.
&gt; 2. if cpu mode is 'host-passthrough' or 'host-model', do a 'virsh
&gt; capabilities' to list cpu features of physical host, they are identical to
&gt; features of virtual machine.
&gt;
&gt; Is this right way to do things? Look forward to your valuable comments.
&gt;
&gt; Best regards,
&gt; Lei
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi, any comment or suggestion&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Thu, Jun 29, 2017 at 10:55 AM, Lei Zhang &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:lei12zhang12@gmail.com" \
target="_blank"&gt;lei12zhang12@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hello everyone&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;  I want to \
know how can I use libvirt to detect what cpu features a virtual machine will \
see.&lt;br&gt; &lt;br&gt;
I guess I could do it in following way:&lt;br&gt;
&lt;br&gt;
&lt;span style="color:rgb(128,128,128)"&gt;1.  &lt;/span&gt;if cpu mode is 'custom', use \
'virsh cpu-baseline --features' on the cpu model to get model features.&lt;br&gt; \
&lt;span style="color:rgb(128,128,128)"&gt;2.  &lt;/span&gt;if cpu mode is \
'host-passthrough' or 'host-model', do a 'virsh capabilities' \
to list cpu features of physical host, they are identical to features of virtual \
machine.&lt;br&gt; &lt;br&gt;
Is this right way to do things?  &lt;span style="font-size:12.8px"&gt;Look forward to your \
valuable comments.&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;Best \
regards,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;Lei&lt;/span&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170719094536</emailId><senderName>Marko Weber | 8000</senderName><senderEmail>weber@zbfmail.de</senderEmail><timestampReceived>2017-07-19 09:45:36-0400</timestampReceived><subject>[libvirt-users] creating new vm with virt-manager, existing disk failure</subject><body>


hello,
i rsynced a kvm vm from one host to another.
i start virt-manager and tell virt-manager to use an existing disk.
i set cpu to haswell that is on the host.

configure before start is set, and i start "begin installation".
I get this output by virt-manager:

Unable to complete install: 'internal error: process exited while 
connecting to monitor: 2017-07-19T09:27:10.861928Z qemu-system-x86_64: 
can't apply global Haswell-x86_64-cpu.cmt=on: Property '.cmt' not found'

Traceback (most recent call last):
   File "/usr/share/virt-manager/virtManager/asyncjob.py", line 88, in 
cb_wrapper
     callback(asyncjob, *args, **kwargs)
   File "/usr/share/virt-manager/virtManager/create.py", line 2288, in 
_do_async_install
     guest.start_install(meter=meter)
   File "/usr/share/virt-manager/virtinst/guest.py", line 477, in 
start_install
     doboot, transient)
   File "/usr/share/virt-manager/virtinst/guest.py", line 405, in 
_create_guest
     self.domain.create()
   File "/usr/lib64/python2.7/site-packages/libvirt.py", line 1062, in 
create
     if ret == -1: raise libvirtError ('virDomainCreate() failed', 
dom=self)
libvirtError: internal error: process exited while connecting to 
monitor: 2017-07-19T09:27:10.861928Z qemu-system-x86_64: can't apply 
global Haswell-x86_64-cpu.cmt=on: Property '.cmt' not found




try to set it to another cpu and clicking start, i get this:

Unable to complete install: 'Domain has already been started!'

Traceback (most recent call last):
   File "/usr/share/virt-manager/virtManager/asyncjob.py", line 88, in 
cb_wrapper
     callback(asyncjob, *args, **kwargs)
   File "/usr/share/virt-manager/virtManager/create.py", line 2288, in 
_do_async_install
     guest.start_install(meter=meter)
   File "/usr/share/virt-manager/virtinst/guest.py", line 455, in 
start_install
     raise RuntimeError(_("Domain has already been started!"))
RuntimeError: Domain has already been started!



how do i stop the already runing vm? virsh list dont show the vm
and why do i get the error on haswell?



lscpu:

Architecture:          x86_64
CPU op-mode(s):        32-bit, 64-bit
Byte Order:            Little Endian
CPU(s):                12
On-line CPU(s) list:   0-11
Thread(s) per core:    2
Core(s) per socket:    6
Socket(s):             1
NUMA node(s):          1
Vendor ID:             GenuineIntel
CPU family:            6
Model:                 79
Model name:            Intel(R) Xeon(R) CPU E5-1650 v4 @ 3.60GHz
Stepping:              1
CPU MHz:               2974.658
CPU max MHz:           4000.0000
CPU min MHz:           1200.0000
BogoMIPS:              7191.87
Virtualization:        VT-x
L1d cache:             32K
L1i cache:             32K
L2 cache:              256K
L3 cache:              15360K
NUMA node0 CPU(s):     0-11
Flags:                 fpu vme de pse tsc msr pae mce cx8 apic sep mtrr 
pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe 
syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good 
nopl xtopology nonstop_tsc cpuid aperfmperf pni pclmulqdq dtes64 monitor 
ds_cpl vmx smx est tm2 ssse3 sdbg fma cx16 xtpr pdcm pcid dca sse4_1 
sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand 
lahf_lm abm 3dnowprefetch epb cat_l3 cdp_l3 intel_pt tpr_shadow vnmi 
flexpriority ept vpid fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms 
invpcid rtm cqm rdt_a rdseed adx smap xsaveopt cqm_llc cqm_occup_llc 
cqm_mbm_total cqm_mbm_local dtherm ida arat pln pts




kind regards

marko

-- 
zbfmail - Mittendrin statt nur Datei!

</body></email><email><emailId>20170717141712</emailId><senderName></senderName><senderEmail>c.monty</senderEmail><timestampReceived>2017-07-17 14:17:12-0400</timestampReceived><subject>[libvirt-users] SSH from host to domain using hostname</subject><body>

Hello!

I want to SSH from host to specific guest using hostname, e.g.
ssh &lt;user&gt;@&lt;guest&gt;
or
ssh test@vm02-fai

ssh to guest using IP works w/o issues.

I found Wiki article for "NSS module" (http://wiki.libvirt.org/page/NSS_module), but \
there are no results for the following commands: ld4004:/home # virsh net-dhcp-leases \
default  Expiry Time          MAC address        Protocol  IP address                \
                Hostname        Client ID or DUID
-------------------------------------------------------------------------------------------------------------------


ld4004:/home # virsh domifaddr --source lease vm02-fai
 Name       MAC address          Protocol     Address
-------------------------------------------------------------------------------

ld4004:/home # virsh list
 Id    Name                           State
----------------------------------------------------
 1     vm02-fai                       running


dnsmasq is running:
ld4004:/home # netstat -nulpd | grep dnsmasq
udp        0      0 192.168.33.1:53         0.0.0.0:*                           \
10318/dnsmasq udp        0      0 192.168.100.1:53        0.0.0.0:*                   \
20145/dnsmasq udp        0      0 0.0.0.0:67              0.0.0.0:*                   \
20145/dnsmasq


How can I fix this issue?

THX


</body></email><email><emailId>20170722190306</emailId><senderName>Alex</senderName><senderEmail>mysqlstudent@gmail.com</senderEmail><timestampReceived>2017-07-22 19:03:06-0400</timestampReceived><subject>[libvirt-users] Increasing video memory available to Windows</subject><body>

Hi,
I have a fedora25 system with a Windows10 host and would like to use
it for photoshop. However, it complains the video memory is too low.
I'm using the QXL driver and it appears to be limited to 256MB? I've
installed the Red Hat QXL driver in Windows.

I have 4GB of memory allocated overall, and could allocate more if necessary.

How do I increase the available video memory? Photoshop reports that
it's detected less than 512MB and isn't operating properly.

When I view "Adapter Properties" is reports there is 2047 MB of
available graphics memory and
2047 MB Shared System Memory.

Attempts to modify with "virsh edit" the vram and other video-related
variables for the host have failed.

Included below is my qemu XML configuration. Any idea greatly appreciated.

&lt;domain type='kvm'&gt;
  &lt;name&gt;alex-win10&lt;/name&gt;
  &lt;uuid&gt;337f9410-3286-4ef5-a3e8-8271e38ea1e5&lt;/uuid&gt;
  &lt;memory unit='KiB'&gt;4194304&lt;/memory&gt;
  &lt;currentMemory unit='KiB'&gt;4194304&lt;/currentMemory&gt;
  &lt;vcpu placement='static'&gt;2&lt;/vcpu&gt;
  &lt;os&gt;
    &lt;type arch='x86_64' machine='pc-i440fx-2.4'&gt;hvm&lt;/type&gt;
  &lt;/os&gt;
  &lt;features&gt;
    &lt;acpi/&gt;
    &lt;apic/&gt;
    &lt;hyperv&gt;
      &lt;relaxed state='on'/&gt;
      &lt;vapic state='on'/&gt;
      &lt;spinlocks state='on' retries='8191'/&gt;
    &lt;/hyperv&gt;
    &lt;vmport state='off'/&gt;
  &lt;/features&gt;
  &lt;cpu mode='host-model'&gt;
    &lt;model fallback='allow'/&gt;
  &lt;/cpu&gt;
  &lt;clock offset='localtime'&gt;
    &lt;timer name='rtc' tickpolicy='catchup'/&gt;
    &lt;timer name='pit' tickpolicy='delay'/&gt;
    &lt;timer name='hpet' present='no'/&gt;
    &lt;timer name='hypervclock' present='yes'/&gt;
  &lt;/clock&gt;
  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
  &lt;on_crash&gt;restart&lt;/on_crash&gt;
  &lt;pm&gt;
    &lt;suspend-to-mem enabled='no'/&gt;
    &lt;suspend-to-disk enabled='no'/&gt;
  &lt;/pm&gt;
  &lt;devices&gt;
    &lt;emulator&gt;/usr/bin/qemu-kvm&lt;/emulator&gt;
    &lt;disk type='file' device='disk'&gt;
      &lt;driver name='qemu' type='qcow2'/&gt;
      &lt;source file='/var/lib/libvirt/images/alex-win10.qcow2'/&gt;
      &lt;target dev='vda' bus='virtio'/&gt;
      &lt;boot order='2'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x07'
function='0x0'/&gt;
    &lt;/disk&gt;
    &lt;disk type='block' device='cdrom'&gt;
      &lt;driver name='qemu' type='raw'/&gt;
      &lt;source dev='/dev/sr0'/&gt;
      &lt;target dev='hdb' bus='ide'/&gt;
      &lt;readonly/&gt;
      &lt;boot order='1'/&gt;
      &lt;address type='drive' controller='0' bus='0' target='0' unit='1'/&gt;
    &lt;/disk&gt;
    &lt;disk type='file' device='cdrom'&gt;
      &lt;driver name='qemu' type='raw'/&gt;
      &lt;target dev='hdc' bus='ide'/&gt;
      &lt;readonly/&gt;
      &lt;address type='drive' controller='0' bus='1' target='0' unit='0'/&gt;
    &lt;/disk&gt;
    &lt;controller type='usb' index='0' model='ich9-ehci1'&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x06'
function='0x7'/&gt;
    &lt;/controller&gt;
    &lt;controller type='usb' index='0' model='ich9-uhci1'&gt;
      &lt;master startport='0'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x06'
function='0x0' multifunction='on'/&gt;
    &lt;/controller&gt;
    &lt;controller type='usb' index='0' model='ich9-uhci2'&gt;
      &lt;master startport='2'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x06'
function='0x1'/&gt;
    &lt;/controller&gt;
    &lt;controller type='usb' index='0' model='ich9-uhci3'&gt;
      &lt;master startport='4'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x06'
function='0x2'/&gt;
    &lt;/controller&gt;
    &lt;controller type='pci' index='0' model='pci-root'/&gt;
    &lt;controller type='ide' index='0'&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x01'
function='0x1'/&gt;
    &lt;/controller&gt;
    &lt;controller type='virtio-serial' index='0'&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05'
function='0x0'/&gt;
    &lt;/controller&gt;
    &lt;controller type='scsi' index='0'&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x09'
function='0x0'/&gt;
    &lt;/controller&gt;
    &lt;interface type='bridge'&gt;
      &lt;mac address='52:54:00:52:6b:61'/&gt;
      &lt;source bridge='br0'/&gt;
      &lt;model type='rtl8139'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
function='0x0'/&gt;
    &lt;/interface&gt;
    &lt;serial type='pty'&gt;
      &lt;target port='0'/&gt;
    &lt;/serial&gt;
    &lt;console type='pty'&gt;
      &lt;target type='serial' port='0'/&gt;
    &lt;/console&gt;
    &lt;channel type='spicevmc'&gt;
      &lt;target type='virtio' name='com.redhat.spice.0'/&gt;
      &lt;address type='virtio-serial' controller='0' bus='0' port='1'/&gt;
    &lt;/channel&gt;
    &lt;input type='tablet' bus='usb'&gt;
      &lt;address type='usb' bus='0' port='1'/&gt;
    &lt;/input&gt;
    &lt;input type='mouse' bus='ps2'/&gt;
    &lt;input type='keyboard' bus='ps2'/&gt;
    &lt;graphics type='spice' autoport='yes'&gt;
      &lt;listen type='address'/&gt;
      &lt;image compression='off'/&gt;
    &lt;/graphics&gt;
    &lt;sound model='ich6'&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x04'
function='0x0'/&gt;
    &lt;/sound&gt;
    &lt;video&gt;
      &lt;model type='qxl' ram='65536' vram='65536' vgamem='536870912'
heads='1' primary='yes'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02'
function='0x0'/&gt;
    &lt;/video&gt;
    &lt;redirdev bus='usb' type='spicevmc'&gt;
      &lt;address type='usb' bus='0' port='2'/&gt;
    &lt;/redirdev&gt;
    &lt;redirdev bus='usb' type='spicevmc'&gt;
      &lt;address type='usb' bus='0' port='3'/&gt;
    &lt;/redirdev&gt;
    &lt;memballoon model='virtio'&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08'
function='0x0'/&gt;
    &lt;/memballoon&gt;
  &lt;/devices&gt;
&lt;/domain&gt;

</body></email><email><emailId>20170725013922</emailId><senderName>"=?gb18030?B?wrbCtg==?="</senderName><senderEmail>1067889964@qq.com</senderEmail><timestampReceived>2017-07-25 01:39:22-0400</timestampReceived><subject>[libvirt-users] memory snapshot save error</subject><body>

[Attachment #2 (text/plain)]

libvirt
version: 3.4.0
architecture: x86_64 ubuntu16.04-server
hypervisor: kvm,qemu

when I want make a memery snapshot for a vm ,and I call virsh save ,but tell me this \
                error:
error: Failed to save domain 177 to /datapool/mm.img
error: operation failed: domain save job: unexpectedly failed

xml configure:
&lt;domain type='kvm' id='177'&gt;
  &lt;name&gt;virt23&lt;/name&gt;
  &lt;uuid&gt;e50c1d59-c4a3-4413-b6c9-20e90cced343&lt;/uuid&gt;
  &lt;metadata/&gt;
  &lt;memory unit='KiB'&gt;10485760&lt;/memory&gt;
  &lt;currentMemory unit='KiB'&gt;10485760&lt;/currentMemory&gt;
  &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
  &lt;resource&gt;
    &lt;partition&gt;/machine&lt;/partition&gt;
  &lt;/resource&gt;
  &lt;os&gt;
    &lt;type arch='x86_64' machine='pc-i440fx-2.5'&gt;hvm&lt;/type&gt;
    &lt;boot dev='hd'/&gt;
  &lt;/os&gt;
  &lt;clock offset='utc'/&gt;
  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
  &lt;on_crash&gt;destroy&lt;/on_crash&gt;
  &lt;devices&gt;
    &lt;emulator&gt;/usr/bin/kvm&lt;/emulator&gt;
    &lt;disk type='file' device='disk'&gt;
      &lt;driver name='qemu' type='raw'/&gt;
      &lt;source file='/datapool/zhuohf/virt23.qcow2'/&gt;
      &lt;backingStore/&gt;
      &lt;target dev='vdc' bus='virtio'/&gt;
      &lt;alias name='virtio-disk2'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/&gt;
    &lt;/disk&gt;
    &lt;disk type='file' device='cdrom'&gt;
      &lt;driver name='qemu' type='raw'/&gt;
&lt;source file='/datapool/zhuohf/ubuntu-16.04.2-desktop-amd64.iso'/&gt;      [40/38156]
      &lt;backingStore/&gt;
      &lt;target dev='hdc' bus='ide'/&gt;
      &lt;readonly/&gt;
      &lt;alias name='ide0-1-0'/&gt;
      &lt;address type='drive' controller='0' bus='1' target='0' unit='0'/&gt;
    &lt;/disk&gt;
    &lt;controller type='usb' index='0' model='piix3-uhci'&gt;
      &lt;alias name='usb'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2'/&gt;
    &lt;/controller&gt;
    &lt;controller type='pci' index='0' model='pci-root'&gt;
      &lt;alias name='pci.0'/&gt;
    &lt;/controller&gt;
    &lt;controller type='ide' index='0'&gt;
      &lt;alias name='ide'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x1'/&gt;
    &lt;/controller&gt;
    &lt;interface type='network'&gt;
      &lt;mac address='52:54:00:e0:31:68'/&gt;
      &lt;source network='default' bridge='virbr0'/&gt;
      &lt;target dev='vnet11'/&gt;
      &lt;model type='rtl8139'/&gt;
      &lt;alias name='net0'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/&gt;
    &lt;/interface&gt;
    &lt;input type='mouse' bus='ps2'&gt;
      &lt;alias name='input0'/&gt;
    &lt;/input&gt;
    &lt;input type='keyboard' bus='ps2'&gt;
      &lt;alias name='input1'/&gt;
&lt;/input&gt;
    &lt;graphics type='vnc' port='5909' autoport='yes' listen='0.0.0.0'&gt;
      &lt;listen type='address' address='0.0.0.0'/&gt;
    &lt;/graphics&gt;
    &lt;video&gt;
      &lt;model type='cirrus' vram='16384' heads='1' primary='yes'/&gt;
      &lt;alias name='video0'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/&gt;
    &lt;/video&gt;
    &lt;memballoon model='virtio'&gt;
      &lt;stats period='1'/&gt;
      &lt;alias name='balloon0'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/&gt;
    &lt;/memballoon&gt;
  &lt;/devices&gt;
  &lt;seclabel type='none' model='none'/&gt;
  &lt;seclabel type='dynamic' model='dac' relabel='yes'&gt;
    &lt;label&gt;+0:+0&lt;/label&gt;
    &lt;imagelabel&gt;+0:+0&lt;/imagelabel&gt;
  &lt;/seclabel&gt;
&lt;/domain&gt;

before I encounter the same error,that time is my disk not free space£¬but this time \
I can't find error reason.

Thanks


[Attachment #3 (text/html)]

libvirt&lt;br&gt;version: 3.4.0&lt;br&gt;architecture: x86_64 ubuntu16.04-server&lt;br&gt;hypervisor: \
kvm,qemu&lt;br&gt;&lt;br&gt;when I want make a memery snapshot for a vm ,and I call virsh save \
,but tell me this error:&lt;br&gt;error: Failed to save domain 177 to \
/datapool/mm.img&lt;br&gt;error: operation failed: domain save job: unexpectedly \
failed&lt;br&gt;&lt;br&gt;xml configure:&lt;br&gt;&lt;domain type='kvm' id='177'&gt;&lt;br&gt;  \
&lt;name&gt;virt23&lt;/name&gt;&lt;br&gt;  \
&lt;uuid&gt;e50c1d59-c4a3-4413-b6c9-20e90cced343&lt;/uuid&gt;&lt;br&gt;  \
&lt;metadata/&gt;&lt;br&gt;  &lt;memory \
unit='KiB'&gt;10485760&lt;/memory&gt;&lt;br&gt;  &lt;currentMemory \
unit='KiB'&gt;10485760&lt;/currentMemory&gt;&lt;br&gt;  &lt;vcpu \
placement='static'&gt;1&lt;/vcpu&gt;&lt;br&gt;  &lt;resource&gt;&lt;br&gt;    \
&lt;partition&gt;/machine&lt;/partition&gt;&lt;br&gt;  &lt;/resource&gt;&lt;br&gt;  \
&lt;os&gt;&lt;br&gt;    &lt;type arch='x86_64' \
machine='pc-i440fx-2.5'&gt;hvm&lt;/type&gt;&lt;br&gt;    &lt;boot \
dev='hd'/&gt;&lt;br&gt;  &lt;/os&gt;&lt;br&gt;  &lt;clock offset='utc'/&gt;&lt;br&gt;  \
&lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;&lt;br&gt;  \
&lt;on_reboot&gt;restart&lt;/on_reboot&gt;&lt;br&gt;  \
&lt;on_crash&gt;destroy&lt;/on_crash&gt;&lt;br&gt;  \
&lt;devices&gt;&lt;br&gt;    \
&lt;emulator&gt;/usr/bin/kvm&lt;/emulator&gt;&lt;br&gt;    &lt;disk \
type='file' device='disk'&gt;&lt;br&gt;      &lt;driver \
name='qemu' type='raw'/&gt;&lt;br&gt;      &lt;source \
file='/datapool/zhuohf/virt23.qcow2'/&gt;&lt;br&gt;      \
&lt;backingStore/&gt;&lt;br&gt;      &lt;target dev='vdc' \
bus='virtio'/&gt;&lt;br&gt;      &lt;alias \
name='virtio-disk2'/&gt;&lt;br&gt;      &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x05' function='0x0'/&gt;&lt;br&gt;    \
&lt;/disk&gt;&lt;br&gt;    &lt;disk type='file' \
device='cdrom'&gt;&lt;br&gt;      &lt;driver name='qemu' \
type='raw'/&gt;&lt;br&gt;&lt;source \
file='/datapool/zhuohf/ubuntu-16.04.2-desktop-amd64.iso'/&gt;      \
[40/38156]&lt;br&gt;      \
&lt;backingStore/&gt;&lt;br&gt;      &lt;target dev='hdc' \
bus='ide'/&gt;&lt;br&gt;      \
&lt;readonly/&gt;&lt;br&gt;      &lt;alias \
name='ide0-1-0'/&gt;&lt;br&gt;      &lt;address type='drive' \
controller='0' bus='1' target='0' unit='0'/&gt;&lt;br&gt;    \
&lt;/disk&gt;&lt;br&gt;    &lt;controller type='usb' index='0' \
model='piix3-uhci'&gt;&lt;br&gt;      &lt;alias \
name='usb'/&gt;&lt;br&gt;      &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x01' function='0x2'/&gt;&lt;br&gt;    \
&lt;/controller&gt;&lt;br&gt;    &lt;controller type='pci' index='0' \
model='pci-root'&gt;&lt;br&gt;      &lt;alias \
name='pci.0'/&gt;&lt;br&gt;    &lt;/controller&gt;&lt;br&gt;    \
&lt;controller type='ide' index='0'&gt;&lt;br&gt;      &lt;alias \
name='ide'/&gt;&lt;br&gt;      &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x01' function='0x1'/&gt;&lt;br&gt;    \
&lt;/controller&gt;&lt;br&gt;    &lt;interface \
type='network'&gt;&lt;br&gt;      &lt;mac \
address='52:54:00:e0:31:68'/&gt;&lt;br&gt;      &lt;source \
network='default' bridge='virbr0'/&gt;&lt;br&gt;      &lt;target \
dev='vnet11'/&gt;&lt;br&gt;      &lt;model \
type='rtl8139'/&gt;&lt;br&gt;      &lt;alias \
name='net0'/&gt;&lt;br&gt;      &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x03' function='0x0'/&gt;&lt;br&gt;    \
&lt;/interface&gt;&lt;br&gt;    &lt;input type='mouse' \
bus='ps2'&gt;&lt;br&gt;      &lt;alias \
name='input0'/&gt;&lt;br&gt;    &lt;/input&gt;&lt;br&gt;    \
&lt;input type='keyboard' bus='ps2'&gt;&lt;br&gt;      &lt;alias \
name='input1'/&gt;&lt;br&gt;&lt;/input&gt;&lt;br&gt;    &lt;graphics type='vnc' \
port='5909' autoport='yes' listen='0.0.0.0'&gt;&lt;br&gt;      \
&lt;listen type='address' address='0.0.0.0'/&gt;&lt;br&gt;    \
&lt;/graphics&gt;&lt;br&gt;    \
&lt;video&gt;&lt;br&gt;      &lt;model type='cirrus' vram='16384' \
heads='1' primary='yes'/&gt;&lt;br&gt;      &lt;alias \
name='video0'/&gt;&lt;br&gt;      &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x02' function='0x0'/&gt;&lt;br&gt;    \
&lt;/video&gt;&lt;br&gt;    &lt;memballoon \
model='virtio'&gt;&lt;br&gt;      &lt;stats \
period='1'/&gt;&lt;br&gt;      &lt;alias \
name='balloon0'/&gt;&lt;br&gt;      &lt;address type='pci' \
domain='0x0000' bus='0x00' slot='0x04' function='0x0'/&gt;&lt;br&gt;    \
&lt;/memballoon&gt;&lt;br&gt;  &lt;/devices&gt;&lt;br&gt;  &lt;seclabel type='none' \
model='none'/&gt;&lt;br&gt;  &lt;seclabel type='dynamic' model='dac' \
relabel='yes'&gt;&lt;br&gt;    \
&lt;label&gt;+0:+0&lt;/label&gt;&lt;br&gt;    \
&lt;imagelabel&gt;+0:+0&lt;/imagelabel&gt;&lt;br&gt;  \
&lt;/seclabel&gt;&lt;br&gt;&lt;/domain&gt;&lt;br&gt;&lt;br&gt;before I encounter the same error,that \
time is my disk not free space£¬but this time I can't find error \
reason.&lt;br&gt;&lt;br&gt;Thanks&lt;br&gt;&lt;br&gt;&lt;br&gt;



</body></email><email><emailId>20170725015029</emailId><senderName>"=?gb18030?B?wrbCtg==?="</senderName><senderEmail>1067889964@qq.com</senderEmail><timestampReceived>2017-07-25 01:50:29-0400</timestampReceived><subject>[libvirt-users] transient configure turn to persistent configure</subject><body>

[Attachment #2 (text/plain)]

libvirt
version: 3.4.0
architecture: x86_64 ubuntu16.04-server
hypervisor: kvm,qemu

I call virDomainCreate create a transient vm, After a period of time ,I call \
virDomainDestroy, the vm configure is stil exist£¬ the vm turn to persistent, I don't \
known the reason.

Thanks


[Attachment #3 (text/html)]

libvirt&lt;br&gt;version: 3.4.0&lt;br&gt;architecture: x86_64 ubuntu16.04-server&lt;br&gt;hypervisor: \
kvm,qemu&lt;br&gt;&lt;br&gt;I call virDomainCreate create a transient vm, After a period of time \
,I call virDomainDestroy, the vm configure is stil exist£¬ the vm turn to persistent, \
I don't known the reason.&lt;br&gt;&lt;br&gt;Thanks&lt;br&gt;&lt;span style="color: rgb(67, 67, 67); \
font-family: Tahoma, Arial, ËÎÌå, 'Malgun Gothic'; font-size: 12px; font-style: \
normal; font-variant: normal; font-weight: bold; letter-spacing: normal; line-height: \
19.1875px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; \
white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; \
background-color: rgb(242, 242, 242); display: inline !important; float: \
none;"&gt;&lt;/span&gt;



</body></email><email><emailId>20170725023611</emailId><senderName>"=?gb18030?B?wrbCtg==?="</senderName><senderEmail>1067889964@qq.com</senderEmail><timestampReceived>2017-07-25 02:36:11-0400</timestampReceived><subject>[libvirt-users] how libvirt create virbr0</subject><body>

[Attachment #2 (text/plain)]

libvirt
version: 3.4.0
architecture: x86_64 ubuntu16.04-server
hypervisor: kvm,qemu

when install libvirt from ubuntu distribution deb install libvirt, a virtual bridge \
virbr0 will be create . But when I build libvirt from souce code, how can I create a \
virbr0. If I want create another virtual bridge ,How can I create and start the \
virtual bridge. Thanks


[Attachment #3 (text/html)]

libvirt&lt;br&gt;version: 3.4.0&lt;br&gt;architecture: x86_64 ubuntu16.04-server&lt;br&gt;hypervisor: \
kvm,qemu&lt;br&gt;&lt;br&gt;when install libvirt from ubuntu distribution deb install libvirt, a \
virtual bridge virbr0 will be create . But when I build libvirt from souce code, how \
can I create a virbr0.&lt;br&gt;If I want create another virtual bridge ,How can I create \
and start the virtual bridge.&lt;br&gt;Thanks&lt;br&gt;



</body></email><email><emailId>20170805201352</emailId><senderName>Alex</senderName><senderEmail>mysqlstudent@gmail.com</senderEmail><timestampReceived>2017-08-05 20:13:52-0400</timestampReceived><subject>Re: [libvirt-users] Increasing video memory available to Windows</subject><body>

Hi,

On Sun, Jul 23, 2017 at 3:45 PM, Pavel Hrdina &lt;phrdina@redhat.com&gt; wrote:
&gt; On Sat, Jul 22, 2017 at 03:03:06PM -0400, Alex wrote:
&gt;&gt; Hi,
&gt;&gt; I have a fedora25 system with a Windows10 host and would like to use
&gt;&gt; it for photoshop. However, it complains the video memory is too low.
&gt;&gt; I'm using the QXL driver and it appears to be limited to 256MB? I've
&gt;&gt; installed the Red Hat QXL driver in Windows.
&gt;
&gt; What driver did you installed?  There are two drivers, qxl and qxldod,
&gt; for windows 10 you need the qxldod and I would give it a try to use the
&gt; latest drivers [1], not the stable ones.
&gt;
&gt; [1] &lt;https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/latest-virtio/&gt;

It looks like that fixed it. I must have been using the x86 version
all along, thinking the amd64 was only for AMD chips, and I have an
Intel.

I tried to change the CPU settings to those you recommended, and it
didn't like it. When I use 'virsh edit" for the host, make the cpu
changes, then try to save, I receive:

error: XML document failed to validate against schema: Unable to
validate doc against /usr/share/libvirt/schemas/domain.rng
Extra element cpu in interleave
Element domain failed to validate content

Failed. Try again? [y,n,i,f,?]:

I currently have the following CPU info:

  &lt;vcpu placement='static'&gt;2&lt;/vcpu&gt;
  &lt;cpu mode='host-model'&gt;
    &lt;model fallback='allow'/&gt;
  &lt;/cpu&gt;

When I made the CPU changes, I kept the vcpu config and replaced the
"cpu mode..." section.

This is the real info from /proc/cpuinfo. Do you have any idea what I
might be doing wrong?

processor       : 7
vendor_id       : GenuineIntel
cpu family      : 6
model           : 60
model name      : Intel(R) Core(TM) i7-4770 CPU @ 3.40GHz
stepping        : 3
microcode       : 0x22
cpu MHz         : 3509.777
cache size      : 8192 KB
physical id     : 0
siblings        : 8
core id         : 3
cpu cores       : 4
apicid          : 7
initial apicid  : 7
fpu             : yes
fpu_exception   : yes
cpuid level     : 13
wp              : yes
flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge
mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe
syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts
rep_good nopl xtopology nonstop_tsc cpuid aperfmperf pni pclmulqdq
dtes64 monitor ds_cpl vmx smx est tm2 ssse3 sdbg fma cx16 xtpr pdcm
pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave
avx f16c rdrand lahf_lm abm epb tpr_shadow vnmi flexpriority ept vpid
fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid xsaveopt dtherm
ida arat pln pts
bugs            :
bogomips        : 6803.22
clflush size    : 64
cache_alignment : 64
address sizes   : 39 bits physical, 48 bits virtual
power management:

Thanks,
Alex

</body></email><email><emailId>20170717151856</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-07-17 15:18:56-0400</timestampReceived><subject>Re: [libvirt-users] SSH from host to domain using hostname</subject><body>


On Mon, Jul 17, 2017 at 02:17:12PM +0000, c.monty@web.de wrote:
&gt; Hello!
&gt; 
&gt; I want to SSH from host to specific guest using hostname, e.g.
&gt; ssh &lt;user&gt;@&lt;guest&gt;
&gt; or
&gt; ssh test@vm02-fai
&gt; 
&gt; ssh to guest using IP works w/o issues.
&gt; 
&gt; I found Wiki article for "NSS module" (http://wiki.libvirt.org/page/NSS_module), \
&gt; but there are no results for the following commands: ld4004:/home # virsh \
&gt; net-dhcp-leases default Expiry Time          MAC address        Protocol  IP \
&gt;                 address                Hostname        Client ID or DUID
&gt; -------------------------------------------------------------------------------------------------------------------
&gt;  
&gt; ld4004:/home # virsh domifaddr --source lease vm02-fai
&gt; Name       MAC address          Protocol     Address
&gt; -------------------------------------------------------------------------------
&gt; 

What is the version of your libvirt?

&gt; ld4004:/home # virsh list
&gt; Id    Name                           State
&gt; ----------------------------------------------------
&gt; 1     vm02-fai                       running
&gt; 

Is this domain plugged into network controlled by libvirt?

&gt; 
&gt; dnsmasq is running:
&gt; ld4004:/home # netstat -nulpd | grep dnsmasq
&gt; udp        0      0 192.168.33.1:53         0.0.0.0:*                           \
&gt; 10318/dnsmasq udp        0      0 192.168.100.1:53        0.0.0.0:*                 \
&gt; 20145/dnsmasq udp        0      0 0.0.0.0:67              0.0.0.0:*                 \
&gt; 20145/dnsmasq 

Is this the dnsmasq for libvirt's network?

&gt; 
&gt; How can I fix this issue?
&gt; 
&gt; THX
&gt; 
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170718121317</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-07-18 12:13:17-0400</timestampReceived><subject>Re: [libvirt-users] SSH from host to domain using hostname</subject><body>

On 07/17/2017 04:17 PM, c.monty@web.de wrote:
&gt; Hello!
&gt; 
&gt; I want to SSH from host to specific guest using hostname, e.g.
&gt; ssh &lt;user&gt;@&lt;guest&gt;
&gt; or
&gt; ssh test@vm02-fai
&gt; 
&gt; ssh to guest using IP works w/o issues.
&gt; 
&gt; I found Wiki article for "NSS module" (http://wiki.libvirt.org/page/NSS_module),

Also, until 3.2.0 it was mandatory to restart the virtual network after
configuring the libvirt_guest module (I've updated the wiki accordingly).

&gt; but there are no results for the following commands:
&gt; ld4004:/home # virsh net-dhcp-leases default
&gt; Expiry Time          MAC address        Protocol  IP address                \
&gt;                 Hostname        Client ID or DUID
&gt; -------------------------------------------------------------------------------------------------------------------
&gt; 


This is the problem. Libvirt is not the one who's assigning IP addresses
and thus the NSS module doesn't work.

&gt; 
&gt; ld4004:/home # virsh domifaddr --source lease vm02-fai
&gt; Name       MAC address          Protocol     Address
&gt; -------------------------------------------------------------------------------
&gt; 
&gt; ld4004:/home # virsh list
&gt; Id    Name                           State
&gt; ----------------------------------------------------
&gt; 1     vm02-fai                       running
&gt; 
&gt; 
&gt; dnsmasq is running:
&gt; ld4004:/home # netstat -nulpd | grep dnsmasq
&gt; udp        0      0 192.168.33.1:53         0.0.0.0:*                           \
&gt; 10318/dnsmasq udp        0      0 192.168.100.1:53        0.0.0.0:*                 \
&gt; 20145/dnsmasq udp        0      0 0.0.0.0:67              0.0.0.0:*                 \
&gt; 20145/dnsmasq 
&gt; 
&gt; How can I fix this issue?

By having libvirt network assign IP addresses. Generally, &lt;interface
type='network'/&gt; is what you should look for.

Michal


</body></email><email><emailId>20170718143129</emailId><senderName></senderName><senderEmail>c.monty</senderEmail><timestampReceived>2017-07-18 14:31:29-0400</timestampReceived><subject>Re: [libvirt-users] SSH from host to domain using hostname</subject><body>

Hello!

I have upgraded all libvirt packages to version 3.5.0-655.1 and restarted host.

This is the current default network config:
ld4004:~ # virsh net-dumpxml default
&lt;network connections='1'&gt;
  &lt;name&gt;default&lt;/name&gt;
  &lt;uuid&gt;f511d113-d7d1-4714-ad2b-be29ef8f7fc4&lt;/uuid&gt;
  &lt;forward dev='br0' mode='nat'&gt;
    &lt;nat&gt;
      &lt;port start='1024' end='65535'/&gt;
    &lt;/nat&gt;
    &lt;interface dev='br0'/&gt;
  &lt;/forward&gt;
  &lt;bridge name='virbr0' stp='on' delay='0'/&gt;
  &lt;mac address='52:54:00:f5:5f:ca'/&gt;
  &lt;domain name='local.net' localOnly='yes'/&gt;
  &lt;ip address='192.168.100.1' netmask='255.255.255.0'&gt;
    &lt;dhcp&gt;
      &lt;range start='192.168.100.10' end='192.168.100.254'/&gt;
    &lt;/dhcp&gt;
  &lt;/ip&gt;
&lt;/network&gt;

What do I need to configure in order to have NSS working?

THX




18. Juli 2017 14:13, "Michal Privoznik" &lt;mprivozn@redhat.com&gt; schrieb:

&gt; On 07/17/2017 04:17 PM, c.monty@web.de wrote:
&gt; 
&gt;&gt; Hello!
&gt;&gt; 
&gt;&gt; I want to SSH from host to specific guest using hostname, e.g.
&gt;&gt; ssh &lt;user&gt;@&lt;guest&gt;
&gt;&gt; or
&gt;&gt; ssh test@vm02-fai
&gt;&gt; 
&gt;&gt; ssh to guest using IP works w/o issues.
&gt;&gt; 
&gt;&gt; I found Wiki article for "NSS module" (http://wiki.libvirt.org/page/NSS_module),
&gt; 
&gt; Also, until 3.2.0 it was mandatory to restart the virtual network after
&gt; configuring the libvirt_guest module (I've updated the wiki accordingly).
&gt; 
&gt;&gt; but there are no results for the following commands:
&gt;&gt; ld4004:/home # virsh net-dhcp-leases default
&gt;&gt; Expiry Time MAC address Protocol IP address Hostname Client ID or DUID
&gt;&gt; ----------------------------------------------------------------------------------------------------
&gt;&gt; --------------
&gt; 
&gt; This is the problem. Libvirt is not the one who's assigning IP addresses
&gt; and thus the NSS module doesn't work.
&gt; 
&gt;&gt; ld4004:/home # virsh domifaddr --source lease vm02-fai
&gt;&gt; Name MAC address Protocol Address
&gt;&gt; -------------------------------------------------------------------------------
&gt;&gt; 
&gt;&gt; ld4004:/home # virsh list
&gt;&gt; Id Name State
&gt;&gt; ----------------------------------------------------
&gt;&gt; 1 vm02-fai running
&gt;&gt; 
&gt;&gt; dnsmasq is running:
&gt;&gt; ld4004:/home # netstat -nulpd | grep dnsmasq
&gt;&gt; udp 0 0 192.168.33.1:53 0.0.0.0:* 10318/dnsmasq
&gt;&gt; udp 0 0 192.168.100.1:53 0.0.0.0:* 20145/dnsmasq
&gt;&gt; udp 0 0 0.0.0.0:67 0.0.0.0:* 20145/dnsmasq
&gt;&gt; 
&gt;&gt; How can I fix this issue?
&gt; 
&gt; By having libvirt network assign IP addresses. Generally, &lt;interface
&gt; type='network'/&gt; is what you should look for.
&gt; 
&gt; Michal

</body></email><email><emailId>20170718144527</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-07-18 14:45:27-0400</timestampReceived><subject>Re: [libvirt-users] SSH from host to domain using hostname</subject><body>

On 07/18/2017 04:31 PM, c.monty@web.de wrote:
&gt; Hello!
&gt; 
&gt; I have upgraded all libvirt packages to version 3.5.0-655.1 and restarted host.

That wasn't necessary. It's not Windows ;-)

&gt; 
&gt; This is the current default network config:
&gt; ld4004:~ # virsh net-dumpxml default
&gt; &lt;network connections='1'&gt;
&gt;   &lt;name&gt;default&lt;/name&gt;
&gt;   &lt;uuid&gt;f511d113-d7d1-4714-ad2b-be29ef8f7fc4&lt;/uuid&gt;
&gt;   &lt;forward dev='br0' mode='nat'&gt;
&gt;     &lt;nat&gt;
&gt;       &lt;port start='1024' end='65535'/&gt;
&gt;     &lt;/nat&gt;
&gt;     &lt;interface dev='br0'/&gt;
&gt;   &lt;/forward&gt;
&gt;   &lt;bridge name='virbr0' stp='on' delay='0'/&gt;
&gt;   &lt;mac address='52:54:00:f5:5f:ca'/&gt;
&gt;   &lt;domain name='local.net' localOnly='yes'/&gt;
&gt;   &lt;ip address='192.168.100.1' netmask='255.255.255.0'&gt;
&gt;     &lt;dhcp&gt;
&gt;       &lt;range start='192.168.100.10' end='192.168.100.254'/&gt;
&gt;     &lt;/dhcp&gt;
&gt;   &lt;/ip&gt;
&gt; &lt;/network&gt;

This is looking good.

&gt; 
&gt; What do I need to configure in order to have NSS working?

What's the domain's &lt;interface/&gt; type? It should look something like this:

&lt;interface type='network'&gt;
  &lt;source network='default'/&gt;
  ...
&lt;/interface&gt;

And with this you should be all set.

Michal

</body></email><email><emailId>20170719082358</emailId><senderName></senderName><senderEmail>c.monty</senderEmail><timestampReceived>2017-07-19 08:23:58-0400</timestampReceived><subject>Re: [libvirt-users] SSH from host to domain using hostname</subject><body>

18. Juli 2017 16:45, "Michal Privoznik" &lt;mprivozn@redhat.com&gt; schrieb:

&gt; On 07/18/2017 04:31 PM, c.monty@web.de wrote:
&gt; 
&gt; &gt; Hello!
&gt; &gt; 
&gt; &gt; I have upgraded all libvirt packages to version 3.5.0-655.1 and restarted host.
&gt; 
&gt; That wasn't necessary. It's not Windows ;-)
&gt; 
&gt; &gt; This is the current default network config:
&gt; &gt; ld4004:~ # virsh net-dumpxml default
&gt; &gt; &lt;network connections='1'&gt;
&gt; &gt; &lt;name&gt;default&lt;/name&gt;
&gt; &gt; &lt;uuid&gt;f511d113-d7d1-4714-ad2b-be29ef8f7fc4&lt;/uuid&gt;
&gt; &gt; &lt;forward dev='br0' mode='nat'&gt;
&gt; &gt; &lt;nat&gt;
&gt; &gt; &lt;port start='1024' end='65535'/&gt;
&gt; &gt; &lt;/nat&gt;
&gt; &gt; &lt;interface dev='br0'/&gt;
&gt; &gt; &lt;/forward&gt;
&gt; &gt; &lt;bridge name='virbr0' stp='on' delay='0'/&gt;
&gt; &gt; &lt;mac address='52:54:00:f5:5f:ca'/&gt;
&gt; &gt; &lt;domain name='local.net' localOnly='yes'/&gt;
&gt; &gt; &lt;ip address='192.168.100.1' netmask='255.255.255.0'&gt;
&gt; &gt; &lt;dhcp&gt;
&gt; &gt; &lt;range start='192.168.100.10' end='192.168.100.254'/&gt;
&gt; &gt; &lt;/dhcp&gt;
&gt; &gt; &lt;/ip&gt;
&gt; &gt; &lt;/network&gt;
&gt; 
&gt; This is looking good.
&gt; 
&gt; &gt; What do I need to configure in order to have NSS working?
&gt; 
&gt; What's the domain's &lt;interface/&gt; type? It should look something like this:
&gt; 
&gt; &lt;interface type='network'&gt;
&gt; &lt;source network='default'/&gt;
&gt; ...
&gt; &lt;/interface&gt;
&gt; 
&gt; And with this you should be all set.
&gt; 
&gt; Michal


OK, all libvirt software packages are updated.
And this is the configuration /etc/nsswitch.conf
ld4004:~ # cat /etc/nsswitch.conf
#
# /etc/nsswitch.conf
#

passwd: compat
group:  compat

hosts:          files libvirt dns
networks:       files dns

services:       files
protocols:      files
rpc:            files
ethers:         files
netmasks:       files
netgroup:       files nis
publickey:      files

bootparams:     files
automount:      files nis
aliases:        files

And this is the domain's interface type / configuration:
    &lt;interface type='network'&gt;
      &lt;mac address='52:54:00:31:dd:59'/&gt;
      &lt;source network='default'/&gt;
      &lt;model type='rtl8139'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/&gt;
    &lt;/interface&gt;
    &lt;interface type='network'&gt;
      &lt;mac address='52:54:00:5d:1e:dc'/&gt;
      &lt;source network='internal'/&gt;
      &lt;model type='rtl8139'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08' function='0x0'/&gt;
    &lt;/interface&gt;


However, there's still no record of the domain's IP address:
ld4004:~ # virsh domifaddr --source lease vm02-fai
 Name       MAC address          Protocol     Address
-------------------------------------------------------------------------------


Could this issue be related to the domain's NIC configuration, means model \
type='rtl8139' or the fact that 2 NICs are configured? For your information, it fails \
also with model type='virtio'.

Regards


</body></email><email><emailId>20170719084634</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-07-19 08:46:34-0400</timestampReceived><subject>Re: [libvirt-users] SSH from host to domain using hostname</subject><body>

On Wed, Jul 19, 2017 at 08:23:58AM +0000, c.monty@web.de wrote:
&gt; 18. Juli 2017 16:45, "Michal Privoznik" &lt;mprivozn@redhat.com&gt; schrieb:
&gt; 
&gt; &gt; On 07/18/2017 04:31 PM, c.monty@web.de wrote:
&gt; &gt; 
&gt; &gt;&gt; Hello!
&gt; &gt;&gt; 
&gt; &gt;&gt; I have upgraded all libvirt packages to version 3.5.0-655.1 and restarted host.
&gt; &gt; 
&gt; &gt; That wasn't necessary. It's not Windows ;-)
&gt; &gt; 
&gt; &gt;&gt; This is the current default network config:
&gt; &gt;&gt; ld4004:~ # virsh net-dumpxml default
&gt; &gt;&gt; &lt;network connections='1'&gt;
&gt; &gt;&gt; &lt;name&gt;default&lt;/name&gt;
&gt; &gt;&gt; &lt;uuid&gt;f511d113-d7d1-4714-ad2b-be29ef8f7fc4&lt;/uuid&gt;
&gt; &gt;&gt; &lt;forward dev='br0' mode='nat'&gt;
&gt; &gt;&gt; &lt;nat&gt;
&gt; &gt;&gt; &lt;port start='1024' end='65535'/&gt;
&gt; &gt;&gt; &lt;/nat&gt;
&gt; &gt;&gt; &lt;interface dev='br0'/&gt;
&gt; &gt;&gt; &lt;/forward&gt;
&gt; &gt;&gt; &lt;bridge name='virbr0' stp='on' delay='0'/&gt;
&gt; &gt;&gt; &lt;mac address='52:54:00:f5:5f:ca'/&gt;
&gt; &gt;&gt; &lt;domain name='local.net' localOnly='yes'/&gt;
&gt; &gt;&gt; &lt;ip address='192.168.100.1' netmask='255.255.255.0'&gt;
&gt; &gt;&gt; &lt;dhcp&gt;
&gt; &gt;&gt; &lt;range start='192.168.100.10' end='192.168.100.254'/&gt;
&gt; &gt;&gt; &lt;/dhcp&gt;
&gt; &gt;&gt; &lt;/ip&gt;
&gt; &gt;&gt; &lt;/network&gt;
&gt; &gt; 
&gt; &gt; This is looking good.
&gt; &gt; 
&gt; &gt;&gt; What do I need to configure in order to have NSS working?
&gt; &gt; 
&gt; &gt; What's the domain's &lt;interface/&gt; type? It should look something like this:
&gt; &gt; 
&gt; &gt; &lt;interface type='network'&gt;
&gt; &gt; &lt;source network='default'/&gt;
&gt; &gt; ...
&gt; &gt; &lt;/interface&gt;
&gt; &gt; 
&gt; &gt; And with this you should be all set.
&gt; &gt; 
&gt; &gt; Michal
&gt; 
&gt; 
&gt; OK, all libvirt software packages are updated.
&gt; And this is the configuration /etc/nsswitch.conf
&gt; ld4004:~ # cat /etc/nsswitch.conf
&gt; #
&gt; # /etc/nsswitch.conf
&gt; #
&gt; 
&gt; passwd: compat
&gt; group:  compat
&gt; 
&gt; hosts:          files libvirt dns
&gt; networks:       files dns
&gt; 
&gt; services:       files
&gt; protocols:      files
&gt; rpc:            files
&gt; ethers:         files
&gt; netmasks:       files
&gt; netgroup:       files nis
&gt; publickey:      files
&gt; 
&gt; bootparams:     files
&gt; automount:      files nis
&gt; aliases:        files
&gt; 
&gt; And this is the domain's interface type / configuration:
&gt;     &lt;interface type='network'&gt;
&gt;       &lt;mac address='52:54:00:31:dd:59'/&gt;
&gt;       &lt;source network='default'/&gt;
&gt;       &lt;model type='rtl8139'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/&gt;
&gt;     &lt;/interface&gt;
&gt;     &lt;interface type='network'&gt;
&gt;       &lt;mac address='52:54:00:5d:1e:dc'/&gt;
&gt;       &lt;source network='internal'/&gt;
&gt;       &lt;model type='rtl8139'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08' function='0x0'/&gt;
&gt;     &lt;/interface&gt;
&gt; 
&gt; 
&gt; However, there's still no record of the domain's IP address:
&gt; ld4004:~ # virsh domifaddr --source lease vm02-fai
&gt;  Name       MAC address          Protocol     Address
&gt; -------------------------------------------------------------------------------
&gt; 
&gt; 
&gt; Could this issue be related to the domain's NIC configuration, means
&gt; model type='rtl8139' or the fact that 2 NICs are configured?
&gt; For your information, it fails also with model type='virtio'.

Is the guest OS actually doing DHCP ? That you don't see any leases listed
with domifaddr or net-dhcp-leases suggests your guests have a static IP
address config.


Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170719142702</emailId><senderName></senderName><senderEmail>c.monty</senderEmail><timestampReceived>2017-07-19 14:27:02-0400</timestampReceived><subject>Re: [libvirt-users] SSH from host to domain using hostname</subject><body>

19. Juli 2017 10:46, "Daniel P. Berrange" &lt;berrange@redhat.com&gt; schrieb:

&gt; On Wed, Jul 19, 2017 at 08:23:58AM +0000, c.monty@web.de wrote:
&gt; 
&gt;&gt; 18. Juli 2017 16:45, "Michal Privoznik" &lt;mprivozn@redhat.com&gt; schrieb:
&gt;&gt; 
&gt;&gt; On 07/18/2017 04:31 PM, c.monty@web.de wrote:
&gt;&gt; 
&gt;&gt; Hello!
&gt;&gt; 
&gt;&gt; I have upgraded all libvirt packages to version 3.5.0-655.1 and restarted host.
&gt;&gt; 
&gt;&gt; That wasn't necessary. It's not Windows ;-)
&gt;&gt; 
&gt;&gt; This is the current default network config:
&gt;&gt; ld4004:~ # virsh net-dumpxml default
&gt;&gt; &lt;network connections='1'&gt;
&gt;&gt; &lt;name&gt;default&lt;/name&gt;
&gt;&gt; &lt;uuid&gt;f511d113-d7d1-4714-ad2b-be29ef8f7fc4&lt;/uuid&gt;
&gt;&gt; &lt;forward dev='br0' mode='nat'&gt;
&gt;&gt; &lt;nat&gt;
&gt;&gt; &lt;port start='1024' end='65535'/&gt;
&gt;&gt; &lt;/nat&gt;
&gt;&gt; &lt;interface dev='br0'/&gt;
&gt;&gt; &lt;/forward&gt;
&gt;&gt; &lt;bridge name='virbr0' stp='on' delay='0'/&gt;
&gt;&gt; &lt;mac address='52:54:00:f5:5f:ca'/&gt;
&gt;&gt; &lt;domain name='local.net' localOnly='yes'/&gt;
&gt;&gt; &lt;ip address='192.168.100.1' netmask='255.255.255.0'&gt;
&gt;&gt; &lt;dhcp&gt;
&gt;&gt; &lt;range start='192.168.100.10' end='192.168.100.254'/&gt;
&gt;&gt; &lt;/dhcp&gt;
&gt;&gt; &lt;/ip&gt;
&gt;&gt; &lt;/network&gt;
&gt;&gt; 
&gt;&gt; This is looking good.
&gt;&gt; 
&gt;&gt; What do I need to configure in order to have NSS working?
&gt;&gt; 
&gt;&gt; What's the domain's &lt;interface/&gt; type? It should look something like this:
&gt;&gt; 
&gt;&gt; &lt;interface type='network'&gt;
&gt;&gt; &lt;source network='default'/&gt;
&gt;&gt; ...
&gt;&gt; &lt;/interface&gt;
&gt;&gt; 
&gt;&gt; And with this you should be all set.
&gt;&gt; 
&gt;&gt; Michal
&gt;&gt; 
&gt;&gt; OK, all libvirt software packages are updated.
&gt;&gt; And this is the configuration /etc/nsswitch.conf
&gt;&gt; ld4004:~ # cat /etc/nsswitch.conf
&gt;&gt; #
&gt;&gt; # /etc/nsswitch.conf
&gt;&gt; #
&gt;&gt; 
&gt;&gt; passwd: compat
&gt;&gt; group: compat
&gt;&gt; 
&gt;&gt; hosts: files libvirt dns
&gt;&gt; networks: files dns
&gt;&gt; 
&gt;&gt; services: files
&gt;&gt; protocols: files
&gt;&gt; rpc: files
&gt;&gt; ethers: files
&gt;&gt; netmasks: files
&gt;&gt; netgroup: files nis
&gt;&gt; publickey: files
&gt;&gt; 
&gt;&gt; bootparams: files
&gt;&gt; automount: files nis
&gt;&gt; aliases: files
&gt;&gt; 
&gt;&gt; And this is the domain's interface type / configuration:
&gt;&gt; &lt;interface type='network'&gt;
&gt;&gt; &lt;mac address='52:54:00:31:dd:59'/&gt;
&gt;&gt; &lt;source network='default'/&gt;
&gt;&gt; &lt;model type='rtl8139'/&gt;
&gt;&gt; &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/&gt;
&gt;&gt; &lt;/interface&gt;
&gt;&gt; &lt;interface type='network'&gt;
&gt;&gt; &lt;mac address='52:54:00:5d:1e:dc'/&gt;
&gt;&gt; &lt;source network='internal'/&gt;
&gt;&gt; &lt;model type='rtl8139'/&gt;
&gt;&gt; &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08' function='0x0'/&gt;
&gt;&gt; &lt;/interface&gt;
&gt;&gt; 
&gt;&gt; However, there's still no record of the domain's IP address:
&gt;&gt; ld4004:~ # virsh domifaddr --source lease vm02-fai
&gt;&gt; Name MAC address Protocol Address
&gt;&gt; -------------------------------------------------------------------------------
&gt;&gt; 
&gt;&gt; Could this issue be related to the domain's NIC configuration, means
&gt;&gt; model type='rtl8139' or the fact that 2 NICs are configured?
&gt;&gt; For your information, it fails also with model type='virtio'.
&gt; 
&gt; Is the guest OS actually doing DHCP ? That you don't see any leases listed
&gt; with domifaddr or net-dhcp-leases suggests your guests have a static IP
&gt; address config.
&gt; 
&gt; Regards,
&gt; Daniel
&gt; --
&gt; |: https://berrange.com -o- https://www.flickr.com/photos/dberrange :|
&gt; |: https://libvirt.org -o- https://fstop138.berrange.com :|
&gt; |: https://entangle-photo.org -o- https://www.instagram.com/dberrange :|


Guest OS is Debian 9 with this network configuration:
thomas@vm02-fai:~$ cat /etc/network/interfaces
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

source /etc/network/interfaces.d/*

# The loopback network interface
auto lo
iface lo inet loopback

# The primary network interface
allow-hotplug ens3
iface ens3 inet dhcp

# The secondary network interface
allow-hotplug ens8
iface ens8 inet static
  address 192.168.33.250/25

So, to answer your question: yes, 1st interface is doing DHCP.

</body></email><email><emailId>20170719143556</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-07-19 14:35:56-0400</timestampReceived><subject>Re: [libvirt-users] SSH from host to domain using hostname</subject><body>

On 07/19/2017 04:27 PM, c.monty@web.de wrote:
&gt; &lt;snip/&gt;
&gt;
&gt; Guest OS is Debian 9 with this network configuration:
&gt; thomas@vm02-fai:~$ cat /etc/network/interfaces
&gt; # This file describes the network interfaces available on your system
&gt; # and how to activate them. For more information, see interfaces(5).
&gt; 
&gt; source /etc/network/interfaces.d/*
&gt; 
&gt; # The loopback network interface
&gt; auto lo
&gt; iface lo inet loopback
&gt; 
&gt; # The primary network interface
&gt; allow-hotplug ens3
&gt; iface ens3 inet dhcp
&gt; 
&gt; # The secondary network interface
&gt; allow-hotplug ens8
&gt; iface ens8 inet static
&gt;   address 192.168.33.250/25
&gt; 

&gt; So, to answer your question: yes, 1st interface is doing DHCP.

Well, this doesn't prove it. ens3 might actually be the one that's
connected to the 'internal' network. What's the output of 'ip a a s' ran
from within the guest? What's the output of 'virsh domifaddr --source
agent $domain'?

BTW: if you sniff on virbr0 while the domain is starting up do you see
any DHCP traffic?

Michal

</body></email><email><emailId>20170725021609</emailId><senderName>"=?gb18030?B?wrbCtg==?="</senderName><senderEmail>1067889964@qq.com</senderEmail><timestampReceived>2017-07-25 02:16:09-0400</timestampReceived><subject>[libvirt-users] About seclabel configure,Migrate error</subject><body>

[Attachment #2 (text/plain)]

libvirt
version: 3.4.0
architecture: x86_64 ubuntu16.04-server
hypervisor: kvm,qemu

When migrate vm, I encounter error:
 "Migrate VM virt21 failed unsupported configuration: Unable to find security driver \
for model apparmor" but two host are same environment.before this error, migrate can \
be success. the source host seclabel configure is this :
&lt;seclabel type='dynamic' model='apparmor' relabel='yes'&gt;
    &lt;label&gt;libvirt-8e4ec209-17ca-4b59-abb7-72f3984244f3&lt;/label&gt;
    &lt;imagelabel&gt;libvirt-8e4ec209-17ca-4b59-abb7-72f3984244f3&lt;/imagelabel&gt;
  &lt;/seclabel&gt;
I create a vm on the destination host ,the vm configure not seclabel congfigure.
I reinstall libvirt on the destination host and migrate same vm, this error \
disappear.vm seclabel configure is default. I recreate a vm on the destination host \
,the vm configure has the seclabel configure , I don't known the reason.

Another question:
I configure a vm xml's seclabel like this:
 &lt;seclabel type='none' model='none'/&gt;
and then call virDomainCreate create the vm, call virsh dumpxml, the vm xml's \
seclabel is this:  &lt;seclabel type='none' model='none'/&gt;
  &lt;seclabel type='dynamic' model='dac' relabel='yes'&gt;
    &lt;label&gt;+0:+0&lt;/label&gt;
    &lt;imagelabel&gt;+0:+0&lt;/imagelabel&gt;
  &lt;/seclabel&gt;
I don't the reason.

Is a vm seclabel configure dynamic change when it running?

Thanks


[Attachment #3 (text/html)]

libvirt&lt;br&gt;version: 3.4.0&lt;br&gt;architecture: x86_64 ubuntu16.04-server&lt;br&gt;hypervisor: \
kvm,qemu&lt;br&gt;&lt;br&gt;When migrate vm, I encounter error:&lt;br&gt; &lt;span style="color: \
rgb(0, 0, 0); font-family: Î¢ÈíÑÅºÚ, 'MS Sans Serif', sans-serif; font-size: 13px; \
font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: \
normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; \
text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; \
-webkit-text-stroke-width: 0px; background-color: rgb(255, 237, 196); display: inline \
!important; float: none;"&gt;"Migrate VM virt21 \
failed unsupported configuration: Unable to find security driver for model apparmor"&lt;br&gt;&lt;/span&gt;but \
two host are same environment.before this error, migrate can be success.&lt;br&gt;the \
source host seclabel configure is this :&lt;br&gt;&lt;seclabel type='dynamic' \
model='apparmor' relabel='yes'&gt;&lt;br&gt;    \
&lt;label&gt;libvirt-8e4ec209-17ca-4b59-abb7-72f3984244f3&lt;/label&gt;&lt;br&gt;    \
&lt;imagelabel&gt;libvirt-8e4ec209-17ca-4b59-abb7-72f3984244f3&lt;/imagelabel&gt;&lt;br&gt;  \
&lt;/seclabel&gt;&lt;br&gt;I create a vm on the destination host ,the vm configure not \
seclabel congfigure.&lt;br&gt;I reinstall libvirt on the destination host and migrate same \
vm, this error disappear.vm seclabel configure is default.&lt;br&gt;I recreate a vm on the \
destination host ,the vm configure has the seclabel configure , I don't known the \
reason.&lt;br&gt;&lt;br&gt;Another question:&lt;br&gt;I configure a vm xml's seclabel like \
this:&lt;br&gt; &lt;seclabel type='none' model='none'/&gt;&lt;br&gt;and then call \
virDomainCreate create the vm, call virsh dumpxml, the vm xml's seclabel is \
this:&lt;br&gt; &lt;seclabel type='none' model='none'/&gt;&lt;br&gt;  &lt;seclabel \
type='dynamic' model='dac' relabel='yes'&gt;&lt;br&gt;    \
&lt;label&gt;+0:+0&lt;/label&gt;&lt;br&gt;    \
&lt;imagelabel&gt;+0:+0&lt;/imagelabel&gt;&lt;br&gt;  &lt;/seclabel&gt;&lt;br&gt;I don't the \
reason.&lt;br&gt;&lt;br&gt;Is a vm seclabel configure dynamic change when it \
running?&lt;br&gt;&lt;br&gt;Thanks&lt;br&gt;&lt;span style="color: rgb(67, 67, 67); font-family: Tahoma, \
Arial, ËÎÌå, 'Malgun Gothic'; font-size: 12px; font-style: normal; font-variant: \
normal; font-weight: bold; letter-spacing: normal; line-height: 19.1875px; orphans: \
auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; \
widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: \
rgb(242, 242, 242); display: inline !important; float: none;"&gt;&lt;/span&gt;



</body></email><email><emailId>20170719150629</emailId><senderName></senderName><senderEmail>c.monty</senderEmail><timestampReceived>2017-07-19 15:06:29-0400</timestampReceived><subject>Re: [libvirt-users] SSH from host to domain using hostname</subject><body>

19. Juli 2017 16:36, "Michal Privoznik" &lt;mprivozn@redhat.com&gt; schrieb:

&gt; On 07/19/2017 04:27 PM, c.monty@web.de wrote:
&gt; 
&gt;&gt; &lt;snip/&gt;
&gt;&gt; 
&gt;&gt; Guest OS is Debian 9 with this network configuration:
&gt;&gt; thomas@vm02-fai:~$ cat /etc/network/interfaces
&gt;&gt; # This file describes the network interfaces available on your system
&gt;&gt; # and how to activate them. For more information, see interfaces(5).
&gt;&gt; 
&gt;&gt; source /etc/network/interfaces.d/*
&gt;&gt; 
&gt;&gt; # The loopback network interface
&gt;&gt; auto lo
&gt;&gt; iface lo inet loopback
&gt;&gt; 
&gt;&gt; # The primary network interface
&gt;&gt; allow-hotplug ens3
&gt;&gt; iface ens3 inet dhcp
&gt;&gt; 
&gt;&gt; # The secondary network interface
&gt;&gt; allow-hotplug ens8
&gt;&gt; iface ens8 inet static
&gt;&gt; address 192.168.33.250/25
&gt;&gt; 
&gt;&gt; So, to answer your question: yes, 1st interface is doing DHCP.
&gt; 
&gt; Well, this doesn't prove it. ens3 might actually be the one that's
&gt; connected to the 'internal' network. What's the output of 'ip a a s' ran
&gt; from within the guest? What's the output of 'virsh domifaddr --source
&gt; agent $domain'?
&gt; 
&gt; BTW: if you sniff on virbr0 while the domain is starting up do you see
&gt; any DHCP traffic?
&gt; 
&gt; Michal


Hm... 'ip a a s' is not working. Do you mean 'ip addr'?
root@vm02-fai:/home/thomas# ip a a s
Error: inet prefix is expected rather than "s".

root@vm02-fai:/home/thomas# ip addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 52:54:00:31:dd:59 brd ff:ff:ff:ff:ff:ff
    inet 192.168.100.52/24 brd 192.168.100.255 scope global ens3
       valid_lft forever preferred_lft forever
    inet6 fe80::5054:ff:fe31:dd59/64 scope link
       valid_lft forever preferred_lft forever
3: ens8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 52:54:00:9e:23:26 brd ff:ff:ff:ff:ff:ff
    inet 192.168.33.250/25 brd 192.168.33.255 scope global ens8
       valid_lft forever preferred_lft forever
    inet6 fe80::5054:ff:fe9e:2326/64 scope link
       valid_lft forever preferred_lft forever

</body></email><email><emailId>20170719151655</emailId><senderName></senderName><senderEmail>c.monty</senderEmail><timestampReceived>2017-07-19 15:16:55-0400</timestampReceived><subject>Re: [libvirt-users] SSH from host to domain using hostname</subject><body>

19. Juli 2017 17:12, c.monty@web.de schrieb:

&gt; 19. Juli 2017 16:36, "Michal Privoznik" &lt;mprivozn@redhat.com&gt; schrieb:
&gt; 
&gt; &gt; On 07/19/2017 04:27 PM, c.monty@web.de wrote:
&gt; &gt; 
&gt; &gt; &gt; &lt;snip/&gt;
&gt; &gt; &gt; 
&gt; &gt; &gt; Guest OS is Debian 9 with this network configuration:
&gt; &gt; &gt; thomas@vm02-fai:~$ cat /etc/network/interfaces
&gt; &gt; &gt; # This file describes the network interfaces available on your system
&gt; &gt; &gt; # and how to activate them. For more information, see interfaces(5).
&gt; &gt; &gt; 
&gt; &gt; &gt; source /etc/network/interfaces.d/*
&gt; &gt; &gt; 
&gt; &gt; &gt; # The loopback network interface
&gt; &gt; &gt; auto lo
&gt; &gt; &gt; iface lo inet loopback
&gt; &gt; &gt; 
&gt; &gt; &gt; # The primary network interface
&gt; &gt; &gt; allow-hotplug ens3
&gt; &gt; &gt; iface ens3 inet dhcp
&gt; &gt; &gt; 
&gt; &gt; &gt; # The secondary network interface
&gt; &gt; &gt; allow-hotplug ens8
&gt; &gt; &gt; iface ens8 inet static
&gt; &gt; &gt; address 192.168.33.250/25
&gt; &gt; &gt; 
&gt; &gt; &gt; So, to answer your question: yes, 1st interface is doing DHCP.
&gt; &gt; 
&gt; &gt; Well, this doesn't prove it. ens3 might actually be the one that's
&gt; &gt; connected to the 'internal' network. What's the output of 'ip a a s' ran
&gt; &gt; from within the guest? What's the output of 'virsh domifaddr --source
&gt; &gt; agent $domain'?
&gt; &gt; 
&gt; &gt; BTW: if you sniff on virbr0 while the domain is starting up do you see
&gt; &gt; any DHCP traffic?
&gt; &gt; 
&gt; &gt; Michal
&gt; 
&gt; Hm... 'ip a a s' is not working. Do you mean 'ip addr'?
&gt; root@vm02-fai:/home/thomas# ip a a s
&gt; Error: inet prefix is expected rather than "s".
&gt; 
&gt; root@vm02-fai:/home/thomas# ip addr
&gt; 1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default \
&gt; qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
&gt; inet 127.0.0.1/8 scope host lo
&gt; valid_lft forever preferred_lft forever
&gt; inet6 ::1/128 scope host
&gt; valid_lft forever preferred_lft forever
&gt; 2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group \
&gt; default qlen 1000
&gt; link/ether 52:54:00:31:dd:59 brd ff:ff:ff:ff:ff:ff
&gt; inet 192.168.100.52/24 brd 192.168.100.255 scope global ens3
&gt; valid_lft forever preferred_lft forever
&gt; inet6 fe80::5054:ff:fe31:dd59/64 scope link
&gt; valid_lft forever preferred_lft forever
&gt; 3: ens8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group \
&gt; default qlen 1000
&gt; link/ether 52:54:00:9e:23:26 brd ff:ff:ff:ff:ff:ff
&gt; inet 192.168.33.250/25 brd 192.168.33.255 scope global ens8
&gt; valid_lft forever preferred_lft forever
&gt; inet6 fe80::5054:ff:fe9e:2326/64 scope link
&gt; valid_lft forever preferred_lft forever
&gt; 
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users


Update:
I have captured packets on virbr0 using tcpdump.
The saved packets are attached in file virbr0.pcap to this email.

In my understanding this confirms DHCP request of guest / domain:
ld4004:~ # tcpdump -r /tmp/virbr0.pcap
reading from file /tmp/virbr0.pcap, link-type EN10MB (Ethernet)
17:10:31.433263 IP6 :: &gt; ff02::16: HBH ICMP6, multicast listener report v2, 1 group \
record(s), length 28 17:10:31.434772 IP 0.0.0.0.bootpc &gt; 255.255.255.255.bootps: \
BOOTP/DHCP, Request from 52:54:00:31:dd:59 (oui Unknown), length 300 17:10:31.435007 \
IP 192.168.100.1.bootps &gt; 192.168.100.52.bootpc: BOOTP/DHCP, Reply, length 313 \
17:10:31.513284 IP6 :: &gt; ff02::16: HBH ICMP6, multicast listener report v2, 2 group \
record(s), length 48 17:10:32.169290 IP6 :: &gt; ff02::1:ff31:dd59: ICMP6, neighbor \
solicitation, who has fe80::5054:ff:fe31:dd59, length 24 17:10:32.393283 IP6 :: &gt; \
ff02::16: HBH ICMP6, multicast listener report v2, 1 group record(s), length 28 \
17:10:33.193292 IP6 fe80::5054:ff:fe31:dd59 &gt; ff02::16: HBH ICMP6, multicast listener \
report v2, 2 group record(s), length 48 17:10:33.193414 IP6 fe80::5054:ff:fe31:dd59 &gt; \
ipv6-allrouters: ICMP6, router solicitation, length 16 17:10:33.277270 IP6 \
fe80::5054:ff:fe31:dd59 &gt; ff02::16: HBH ICMP6, multicast listener report v2, 2 group \
record(s), length 48 17:10:36.441562 ARP, Request who-has 192.168.100.52 tell \
192.168.100.1, length 28 17:10:36.441843 ARP, Reply 192.168.100.52 is-at \
52:54:00:31:dd:59 (oui Unknown), length 28 17:10:37.161253 IP6 \
fe80::5054:ff:fe31:dd59 &gt; ipv6-allrouters: ICMP6, router solicitation, length 16 \
17:10:45.097178 IP6 fe80::5054:ff:fe31:dd59 &gt; ipv6-allrouters: ICMP6, router \
solicitation, length 16 17:10:46.399986 IP 192.168.100.1.50432 &gt; 192.168.100.52.ssh: \
Flags [S], seq 3301944072, win 29200, options [mss 1460,sackOK,TS val 21694017 ecr \
0,nop,wscale 7], length 0


</body></email><email><emailId>20170719152352</emailId><senderName></senderName><senderEmail>c.monty</senderEmail><timestampReceived>2017-07-19 15:23:52-0400</timestampReceived><subject>Re: [libvirt-users] SSH from host to domain using hostname</subject><body>

19. Juli 2017 17:19, c.monty@web.de schrieb:

&gt; 19. Juli 2017 17:12, c.monty@web.de schrieb:
&gt; 
&gt;&gt; 19. Juli 2017 16:36, "Michal Privoznik" &lt;mprivozn@redhat.com&gt; schrieb:
&gt;&gt; 
&gt;&gt;&gt; On 07/19/2017 04:27 PM, c.monty@web.de wrote:
&gt;&gt; 
&gt;&gt; &lt;snip/&gt;
&gt;&gt; 
&gt;&gt; Guest OS is Debian 9 with this network configuration:
&gt;&gt; thomas@vm02-fai:~$ cat /etc/network/interfaces
&gt;&gt; # This file describes the network interfaces available on your system
&gt;&gt; # and how to activate them. For more information, see interfaces(5).
&gt;&gt; 
&gt;&gt; source /etc/network/interfaces.d/*
&gt;&gt; 
&gt;&gt; # The loopback network interface
&gt;&gt; auto lo
&gt;&gt; iface lo inet loopback
&gt;&gt; 
&gt;&gt; # The primary network interface
&gt;&gt; allow-hotplug ens3
&gt;&gt; iface ens3 inet dhcp
&gt;&gt; 
&gt;&gt; # The secondary network interface
&gt;&gt; allow-hotplug ens8
&gt;&gt; iface ens8 inet static
&gt;&gt; address 192.168.33.250/25
&gt;&gt; 
&gt;&gt; So, to answer your question: yes, 1st interface is doing DHCP.
&gt;&gt;&gt; Well, this doesn't prove it. ens3 might actually be the one that's
&gt;&gt;&gt; connected to the 'internal' network. What's the output of 'ip a a s' ran
&gt;&gt;&gt; from within the guest? What's the output of 'virsh domifaddr --source
&gt;&gt;&gt; agent $domain'?
&gt;&gt;&gt; 
&gt;&gt;&gt; BTW: if you sniff on virbr0 while the domain is starting up do you see
&gt;&gt;&gt; any DHCP traffic?
&gt;&gt;&gt; 
&gt;&gt;&gt; Michal
&gt;&gt; 
&gt;&gt; Hm... 'ip a a s' is not working. Do you mean 'ip addr'?
&gt;&gt; root@vm02-fai:/home/thomas# ip a a s
&gt;&gt; Error: inet prefix is expected rather than "s".
&gt;&gt; 
&gt;&gt; root@vm02-fai:/home/thomas# ip addr
&gt;&gt; 1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1
&gt;&gt; link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
&gt;&gt; inet 127.0.0.1/8 scope host lo
&gt;&gt; valid_lft forever preferred_lft forever
&gt;&gt; inet6 ::1/128 scope host
&gt;&gt; valid_lft forever preferred_lft forever
&gt;&gt; 2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen
&gt;&gt; 1000
&gt;&gt; link/ether 52:54:00:31:dd:59 brd ff:ff:ff:ff:ff:ff
&gt;&gt; inet 192.168.100.52/24 brd 192.168.100.255 scope global ens3
&gt;&gt; valid_lft forever preferred_lft forever
&gt;&gt; inet6 fe80::5054:ff:fe31:dd59/64 scope link
&gt;&gt; valid_lft forever preferred_lft forever
&gt;&gt; 3: ens8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen
&gt;&gt; 1000
&gt;&gt; link/ether 52:54:00:9e:23:26 brd ff:ff:ff:ff:ff:ff
&gt;&gt; inet 192.168.33.250/25 brd 192.168.33.255 scope global ens8
&gt;&gt; valid_lft forever preferred_lft forever
&gt;&gt; inet6 fe80::5054:ff:fe9e:2326/64 scope link
&gt;&gt; valid_lft forever preferred_lft forever
&gt;&gt; 
&gt;&gt; _______________________________________________
&gt;&gt; libvirt-users mailing list
&gt;&gt; libvirt-users@redhat.com
&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt; 
&gt; Update:
&gt; I have captured packets on virbr0 using tcpdump.
&gt; The saved packets are attached in file virbr0.pcap to this email.
&gt; 
&gt; In my understanding this confirms DHCP request of guest / domain:
&gt; ld4004:~ # tcpdump -r /tmp/virbr0.pcap
&gt; reading from file /tmp/virbr0.pcap, link-type EN10MB (Ethernet)
&gt; 17:10:31.433263 IP6 :: &gt; ff02::16: HBH ICMP6, multicast listener report v2, 1 group record(s),
&gt; length 28
&gt; 17:10:31.434772 IP 0.0.0.0.bootpc &gt; 255.255.255.255.bootps: BOOTP/DHCP, Request from
&gt; 52:54:00:31:dd:59 (oui Unknown), length 300
&gt; 17:10:31.435007 IP 192.168.100.1.bootps &gt; 192.168.100.52.bootpc: BOOTP/DHCP, Reply, length 313
&gt; 17:10:31.513284 IP6 :: &gt; ff02::16: HBH ICMP6, multicast listener report v2, 2 group record(s),
&gt; length 48
&gt; 17:10:32.169290 IP6 :: &gt; ff02::1:ff31:dd59: ICMP6, neighbor solicitation, who has
&gt; fe80::5054:ff:fe31:dd59, length 24
&gt; 17:10:32.393283 IP6 :: &gt; ff02::16: HBH ICMP6, multicast listener report v2, 1 group record(s),
&gt; length 28
&gt; 17:10:33.193292 IP6 fe80::5054:ff:fe31:dd59 &gt; ff02::16: HBH ICMP6, multicast listener report v2, 2
&gt; group record(s), length 48
&gt; 17:10:33.193414 IP6 fe80::5054:ff:fe31:dd59 &gt; ipv6-allrouters: ICMP6, router solicitation, length
&gt; 16
&gt; 17:10:33.277270 IP6 fe80::5054:ff:fe31:dd59 &gt; ff02::16: HBH ICMP6, multicast listener report v2, 2
&gt; group record(s), length 48
&gt; 17:10:36.441562 ARP, Request who-has 192.168.100.52 tell 192.168.100.1, length 28
&gt; 17:10:36.441843 ARP, Reply 192.168.100.52 is-at 52:54:00:31:dd:59 (oui Unknown), length 28
&gt; 17:10:37.161253 IP6 fe80::5054:ff:fe31:dd59 &gt; ipv6-allrouters: ICMP6, router solicitation, length
&gt; 16
&gt; 17:10:45.097178 IP6 fe80::5054:ff:fe31:dd59 &gt; ipv6-allrouters: ICMP6, router solicitation, length
&gt; 16
&gt; 17:10:46.399986 IP 192.168.100.1.50432 &gt; 192.168.100.52.ssh: Flags [S], seq 3301944072, win 29200,
&gt; options [mss 1460,sackOK,TS val 21694017 ecr 0,nop,wscale 7], length 0
&gt; 
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users


Update update:
Output of 'virsh domifaddr '
ld4004:~ # virsh domifaddr --source agent $domain
error: command 'domifaddr' requires &lt;domain&gt; option
ld4004:~ # virsh domifaddr --source agent vm02-fai
error: Failed to query for interfaces addresses
error: argument unsupported: QEMU guest agent is not configured

ld4004:~ # virsh domifaddr --source lease $domain
error: command 'domifaddr' requires &lt;domain&gt; option
ld4004:~ # virsh domifaddr --source lease vm02-fai
 Name       MAC address          Protocol     Address
-------------------------------------------------------------------------------

Question:
Why are variables $domain (or $network) not working?

</body></email><email><emailId>20170719153133</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-07-19 15:31:33-0400</timestampReceived><subject>Re: [libvirt-users] SSH from host to domain using hostname</subject><body>

On 07/19/2017 05:16 PM, c.monty@web.de wrote:
&gt; 19. Juli 2017 17:12, c.monty@web.de schrieb:
&gt; 
&gt; &gt; 19. Juli 2017 16:36, "Michal Privoznik" &lt;mprivozn@redhat.com&gt; schrieb:
&gt; &gt; 
&gt; &gt; &gt; On 07/19/2017 04:27 PM, c.monty@web.de wrote:
&gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &lt;snip/&gt;
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Guest OS is Debian 9 with this network configuration:
&gt; &gt; &gt; &gt; thomas@vm02-fai:~$ cat /etc/network/interfaces
&gt; &gt; &gt; &gt; # This file describes the network interfaces available on your system
&gt; &gt; &gt; &gt; # and how to activate them. For more information, see interfaces(5).
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; source /etc/network/interfaces.d/*
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; # The loopback network interface
&gt; &gt; &gt; &gt; auto lo
&gt; &gt; &gt; &gt; iface lo inet loopback
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; # The primary network interface
&gt; &gt; &gt; &gt; allow-hotplug ens3
&gt; &gt; &gt; &gt; iface ens3 inet dhcp
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; # The secondary network interface
&gt; &gt; &gt; &gt; allow-hotplug ens8
&gt; &gt; &gt; &gt; iface ens8 inet static
&gt; &gt; &gt; &gt; address 192.168.33.250/25
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; So, to answer your question: yes, 1st interface is doing DHCP.
&gt; &gt; &gt; 
&gt; &gt; &gt; Well, this doesn't prove it. ens3 might actually be the one that's
&gt; &gt; &gt; connected to the 'internal' network. What's the output of 'ip a a s' ran
&gt; &gt; &gt; from within the guest? What's the output of 'virsh domifaddr --source
&gt; &gt; &gt; agent $domain'?
&gt; &gt; &gt; 
&gt; &gt; &gt; BTW: if you sniff on virbr0 while the domain is starting up do you see
&gt; &gt; &gt; any DHCP traffic?
&gt; &gt; &gt; 
&gt; &gt; &gt; Michal
&gt; &gt; 
&gt; &gt; Hm... 'ip a a s' is not working. Do you mean 'ip addr'?
&gt; &gt; root@vm02-fai:/home/thomas# ip a a s
&gt; &gt; Error: inet prefix is expected rather than "s".
&gt; &gt; 
&gt; &gt; root@vm02-fai:/home/thomas# ip addr
&gt; &gt; 1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default \
&gt; &gt; qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
&gt; &gt; inet 127.0.0.1/8 scope host lo
&gt; &gt; valid_lft forever preferred_lft forever
&gt; &gt; inet6 ::1/128 scope host
&gt; &gt; valid_lft forever preferred_lft forever
&gt; &gt; 2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP \
&gt; &gt; group default qlen 1000
&gt; &gt; link/ether 52:54:00:31:dd:59 brd ff:ff:ff:ff:ff:ff
&gt; &gt; inet 192.168.100.52/24 brd 192.168.100.255 scope global ens3
&gt; &gt; valid_lft forever preferred_lft forever
&gt; &gt; inet6 fe80::5054:ff:fe31:dd59/64 scope link
&gt; &gt; valid_lft forever preferred_lft forever
&gt; &gt; 3: ens8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP \
&gt; &gt; group default qlen 1000
&gt; &gt; link/ether 52:54:00:9e:23:26 brd ff:ff:ff:ff:ff:ff
&gt; &gt; inet 192.168.33.250/25 brd 192.168.33.255 scope global ens8
&gt; &gt; valid_lft forever preferred_lft forever
&gt; &gt; inet6 fe80::5054:ff:fe9e:2326/64 scope link
&gt; &gt; valid_lft forever preferred_lft forever
&gt; &gt; 
&gt; &gt; _______________________________________________
&gt; &gt; libvirt-users mailing list
&gt; &gt; libvirt-users@redhat.com
&gt; &gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt; 
&gt; 
&gt; Update:
&gt; I have captured packets on virbr0 using tcpdump.
&gt; The saved packets are attached in file virbr0.pcap to this email.
&gt; 
&gt; In my understanding this confirms DHCP request of guest / domain:
&gt; ld4004:~ # tcpdump -r /tmp/virbr0.pcap
&gt; reading from file /tmp/virbr0.pcap, link-type EN10MB (Ethernet)
&gt; 17:10:31.433263 IP6 :: &gt; ff02::16: HBH ICMP6, multicast listener report v2, 1 group \
&gt; record(s), length 28 17:10:31.434772 IP 0.0.0.0.bootpc &gt; 255.255.255.255.bootps: \
&gt; BOOTP/DHCP, Request from 52:54:00:31:dd:59 (oui Unknown), length 300 \
&gt; 17:10:31.435007 IP 192.168.100.1.bootps &gt; 192.168.100.52.bootpc: BOOTP/DHCP, Reply, \
&gt; length 313

This looks suspicious. Usually, when dnsmasq is assigning IP addresses it looks like \
this:

17:27:02.822300 IP 0.0.0.0.bootpc &gt; 255.255.255.255.bootps: BOOTP/DHCP, Request from \
52:54:00:a4:6f:91 (oui Unknown), length 300 17:27:02.822408 IP 192.168.122.1 &gt; \
192.168.122.197: ICMP echo request, id 24889, seq 0, length 28 17:27:02.822443 IP \
192.168.122.1.bootps &gt; 192.168.122.197.bootpc: BOOTP/DHCP, Reply, length 300 \
17:27:02.823032 IP 0.0.0.0.bootpc &gt; 255.255.255.255.bootps: BOOTP/DHCP, Request from \
52:54:00:a4:6f:91 (oui Unknown), length 305 17:27:02.823151 IP 192.168.122.1.bootps &gt; \
192.168.122.197.bootpc: BOOTP/DHCP, Reply, length 300

Is it possible that something else than dnsmasq is assigning IP addresses?
Also, I wonder what's in the DHCP reply from 192.168.100.1. Do you think you can \
paste it here?

Michal


</body></email><email><emailId>20170720080317</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-07-20 08:03:17-0400</timestampReceived><subject>Re: [libvirt-users] SSH from host to domain using hostname</subject><body>

On 07/19/2017 05:23 PM, c.monty@web.de wrote:
&gt; &lt;snip/&gt;
&gt;
&gt; Update update:
&gt; Output of 'virsh domifaddr '
&gt; ld4004:~ # virsh domifaddr --source agent $domain
&gt; error: command 'domifaddr' requires &lt;domain&gt; option
&gt; ld4004:~ # virsh domifaddr --source agent vm02-fai
&gt; error: Failed to query for interfaces addresses
&gt; error: argument unsupported: QEMU guest agent is not configured
&gt; 
&gt; ld4004:~ # virsh domifaddr --source lease $domain
&gt; error: command 'domifaddr' requires &lt;domain&gt; option
&gt; ld4004:~ # virsh domifaddr --source lease vm02-fai
&gt;  Name       MAC address          Protocol     Address
&gt; -------------------------------------------------------------------------------
&gt; 
&gt; Question:
&gt; Why are variables $domain (or $network) not working?

So usually when discussing on lists, we don't know how are user domains
named. Or networks. Or something else. So when asking for XML we use
$domain as placeholder and users are supposed to replace that with
actual name of the domain. The same applies for network. So these are
not bash variables - how can bash possibly know what you're up to?

Michal

</body></email><email><emailId>20170719120111</emailId><senderName>Pavel Hrdina</senderName><senderEmail>phrdina@redhat.com</senderEmail><timestampReceived>2017-07-19 12:01:11-0400</timestampReceived><subject>Re: [libvirt-users] creating new vm with virt-manager, existing disk failure</subject><body>


On Wed, Jul 19, 2017 at 11:45:36AM +0200, Marko Weber | 8000 wrote:
&gt; 
&gt; hello,
&gt; i rsynced a kvm vm from one host to another.
&gt; i start virt-manager and tell virt-manager to use an existing disk.
&gt; i set cpu to haswell that is on the host.
&gt; 
&gt; configure before start is set, and i start "begin installation".
&gt; I get this output by virt-manager:
&gt; 
&gt; Unable to complete install: 'internal error: process exited while 
&gt; connecting to monitor: 2017-07-19T09:27:10.861928Z qemu-system-x86_64: 
&gt; can't apply global Haswell-x86_64-cpu.cmt=on: Property '.cmt' not found'
&gt; 
&gt; Traceback (most recent call last):
&gt;    File "/usr/share/virt-manager/virtManager/asyncjob.py", line 88, in 
&gt; cb_wrapper
&gt;      callback(asyncjob, *args, **kwargs)
&gt;    File "/usr/share/virt-manager/virtManager/create.py", line 2288, in 
&gt; _do_async_install
&gt;      guest.start_install(meter=meter)
&gt;    File "/usr/share/virt-manager/virtinst/guest.py", line 477, in 
&gt; start_install
&gt;      doboot, transient)
&gt;    File "/usr/share/virt-manager/virtinst/guest.py", line 405, in 
&gt; _create_guest
&gt;      self.domain.create()
&gt;    File "/usr/lib64/python2.7/site-packages/libvirt.py", line 1062, in 
&gt; create
&gt;      if ret == -1: raise libvirtError ('virDomainCreate() failed', 
&gt; dom=self)
&gt; libvirtError: internal error: process exited while connecting to 
&gt; monitor: 2017-07-19T09:27:10.861928Z qemu-system-x86_64: can't apply 
&gt; global Haswell-x86_64-cpu.cmt=on: Property '.cmt' not found
&gt; 
&gt; 
&gt; 
&gt; 
&gt; try to set it to another cpu and clicking start, i get this:
&gt; 
&gt; Unable to complete install: 'Domain has already been started!'
&gt; 
&gt; Traceback (most recent call last):
&gt;    File "/usr/share/virt-manager/virtManager/asyncjob.py", line 88, in 
&gt; cb_wrapper
&gt;      callback(asyncjob, *args, **kwargs)
&gt;    File "/usr/share/virt-manager/virtManager/create.py", line 2288, in 
&gt; _do_async_install
&gt;      guest.start_install(meter=meter)
&gt;    File "/usr/share/virt-manager/virtinst/guest.py", line 455, in 
&gt; start_install
&gt;      raise RuntimeError(_("Domain has already been started!"))
&gt; RuntimeError: Domain has already been started!
&gt; 
&gt; 
&gt; 
&gt; how do i stop the already runing vm? virsh list dont show the vm
&gt; and why do i get the error on haswell?

Hi, this is actually a bug in virt-manager which was fixed in upstream
by these commits:

    2099a1946e22b62d31b954dc3e7b813404c2d019
    93085d2b9d4a3dd6cbb9edfeae9b6cefee9419c1
    8181e8609867fe6ed101e48212d42a1c38373539

To work-around this issue cancel the installation and start it again.
There is no official release of virt-manager with that fix included, we
should probably make the release.

Pavel

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170711185622</emailId><senderName>Laine Stump</senderName><senderEmail>laine@laine.org</senderEmail><timestampReceived>2017-07-11 18:56:22-0400</timestampReceived><subject>Re: [libvirt-users] Hot-migration of OVS Vlan configuration</subject><body>

On 07/11/2017 10:47 AM, Antoine Millet wrote:
&gt; Hi list,
&gt;
&gt; I'm using OVS as backend for guest networking on my hypervisors. VLAN
&gt; configuration for each interface is specified into the guest XML
&gt; definition.
&gt;
&gt; When I need to change VLAN configuration of a running guest, I first
&gt; edit the inactive XML to keep the changes for future boots, then I use
&gt; ovs-vsctl to instruct the changes on the existing OVS Port.
&gt;
&gt; The problem happen when the guest is migrated to another hypervisor.
&gt; The "active" XML is used to instantiate the VM on the destination and
&gt; this XML doesn't incorporate the changes made to the inactive one. All
&gt; the changes made on source are lost on the running guest at
&gt; destination.
&gt;
&gt; I'm looking for a solution to this problem:
&gt;
&gt; - IFAIK, I cannot edit the "active" XML myself other than by using
&gt; provided Libvirt API (like attach-device), and such API doesn't exists
&gt; for VLANs modification on OVS interface
&gt; - I cannot use a migration hook to pass changes made to the inactive
&gt; XML into the active one because the inactive XML is not reachable from
&gt; the hook
&gt; - I found a patch allowing to transport some information attached to an
&gt; OVS port during migration[1]. Unfortunately, this patch doesn't
&gt; transport the VLAN configuration
&gt; - Modification of the active XML during the migration itself is not
&gt; desirable because it will complicate the migration process by
&gt; requesting an external tool
&gt;
&gt; Did I miss something to achieve VLAN configuration migration? How to
&gt; implement that into the Libvirt properly?

The cleanest way to make this work would be to enhance the function
qemuDomainChangeNet() to know what to do when it detects that the vlan
tag was changed with a device update ("virsh update-device") - this
command can take effect immediately rather than waiting until the next
time the domain is started, so the XML that is migrated would have the
new vlan tag already in place (and also you wouldn't need to issue the
ovs-vsctl command for it out of band any more!).

Currently that function notices that the vlan tag has changed, but this
just leads to an "UNSUPPORTED" error. If the network type is OVS, then
it *should* work to just reconnect the bridge (libvirt sets the vlan tag
as part of connecting to the ovs bridge).

So how are your programming chops? :-)

</body></email><email><emailId>20170713150240</emailId><senderName>Antoine Millet</senderName><senderEmail>antoine@inaps.org</senderEmail><timestampReceived>2017-07-13 15:02:40-0400</timestampReceived><subject>Re: [libvirt-users] Hot-migration of OVS Vlan configuration</subject><body>

On Tue, 2017-07-11 at 14:56 -0400, Laine Stump wrote:
&gt; The cleanest way to make this work would be to enhance the function
&gt; qemuDomainChangeNet() to know what to do when it detects that the
&gt; vlan
&gt; tag was changed with a device update ("virsh update-device") - this
&gt; command can take effect immediately rather than waiting until the
&gt; next
&gt; time the domain is started, so the XML that is migrated would have
&gt; the
&gt; new vlan tag already in place (and also you wouldn't need to issue
&gt; the
&gt; ovs-vsctl command for it out of band any more!).
&gt; 
&gt; Currently that function notices that the vlan tag has changed, but
&gt; this
&gt; just leads to an "UNSUPPORTED" error. If the network type is OVS,
&gt; then
&gt; it *should* work to just reconnect the bridge (libvirt sets the vlan
&gt; tag
&gt; as part of connecting to the ovs bridge).
&gt; 
&gt; So how are your programming chops? :-)
&gt; 

Hi Laine,

Thank you for the answer!

I finally achieved to implement what you suggested. :-) I'll post the
patch on the developer ML in a few days.

Antoine

</body></email><email><emailId>20170711075052</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-07-11 07:50:52-0400</timestampReceived><subject>Re: [libvirt-users] Is there still no easier way to shrink a VM image?</subject><body>


On Tue, Jul 11, 2017 at 12:34:31AM -0500, Leroy Tennison wrote:
&gt;I have numerous qcow2 images which need to be reduced in size and have
&gt;their maximum size (virtual size) reduced.  Physical disk space became
&gt;so low that VMs "auto-paused" themselves, I moved enough images to solve
&gt;the immediate problem but need to rectify the underlying issue.  It
&gt;seems that qcow[2] files are grown in size such that the data inside of
&gt;them takes about 50-60% of the space (does anyone know the actual
&gt;algorithm or how to control it?).  Given the total physical disk space
&gt;on the hypervisors, I need something more restrictive.
&gt;

I don't get it.  You have virtual size greater than the free space on
the physical storage and instead of the VM finding out you want the
guest OS to see it has no space at all?

&gt;Our hypervisors are a mix of Ubuntu 14 or 16 LTS (qemu-img 2.2 or 2.5).
&gt;After doing all the preparation (defragment, reduce OS partition size)
&gt;"qemu-img resize" reports that shrinking isn't supported yet.  My web
&gt;research indicates that, to accomplish this,  I have to:
&gt;
&gt;    convert to raw
&gt;
&gt;    shrink the image
&gt;
&gt;    convert back to qcow[2]
&gt;
&gt;    increase the image size to provide for some growth
&gt;
&gt;I'm hoping I've missed something in my research and that someone knows
&gt;an easier way.  I don't feel constrained to qemu-img but this is a
&gt;production environment precluding consideration of experimental
&gt;software.  Virt-resize, guestfish or any other reasonable option is fine
&gt;with me.  Solutions or ideas?  Thanks.
&gt;

&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170711092300</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-07-11 09:23:00-0400</timestampReceived><subject>Re: [libvirt-users] Is there still no easier way to shrink a VM image?</subject><body>

On 07/11/2017 07:34 AM, Leroy Tennison wrote:
&gt; I have numerous qcow2 images which need to be reduced in size and have
&gt; their maximum size (virtual size) reduced.  Physical disk space became
&gt; so low that VMs "auto-paused" themselves, I moved enough images to solve
&gt; the immediate problem but need to rectify the underlying issue.  It
&gt; seems that qcow[2] files are grown in size such that the data inside of
&gt; them takes about 50-60% of the space (does anyone know the actual
&gt; algorithm or how to control it?).  Given the total physical disk space
&gt; on the hypervisors, I need something more restrictive.
&gt; 
&gt; Our hypervisors are a mix of Ubuntu 14 or 16 LTS (qemu-img 2.2 or 2.5). 
&gt; After doing all the preparation (defragment, reduce OS partition size)
&gt; "qemu-img resize" reports that shrinking isn't supported yet.  My web
&gt; research indicates that, to accomplish this,  I have to:
&gt; 
&gt;    convert to raw
&gt; 
&gt;    shrink the image
&gt; 
&gt;    convert back to qcow[2]
&gt; 
&gt;    increase the image size to provide for some growth
&gt; 
&gt; I'm hoping I've missed something in my research and that someone knows
&gt; an easier way.  I don't feel constrained to qemu-img but this is a
&gt; production environment precluding consideration of experimental
&gt; software.  Virt-resize, guestfish or any other reasonable option is fine
&gt; with me.  Solutions or ideas?  Thanks.

In addition to what Martin replied (I don't quite understand your goal
either), I often use 'virsh domfstrim $domain' to free up some unused
blocks in a qcow2 image. However, this doesn't change the virtual size
of the disk. Just the physical footprint.

Michal

</body></email><email><emailId>20170711153900</emailId><senderName>Leroy Tennison</senderName><senderEmail>leroy.tennison@verizon.net</senderEmail><timestampReceived>2017-07-11 15:39:00-0400</timestampReceived><subject>Re: [libvirt-users] Is there still no easier way to shrink a VM image?</subject><body>

Thanks for letting me know I'm not making myself clear, let me try again with a few \
more specifics,  These are Windows VMs with three disk images for C:, D: and L:.  To \
simplify I'll focus on the image for C: which had grown to 77G physical size on the \
hypervisor's ssd (I just double-checked that with 'ls -al' because qemu-img below \
says 70G, this image had two snapshots at one time which may be the reason for the \
discrepancy).  qemu-img info reports:



file format: qcow2
virtual size: 100G (107374182400 bytes)
disk size: 70G
cluster_size: 65536
Format specific information:
    compat: 0.10


I used Windows Server 2012r2 "Optimize" (defrag) and then reduced the C: partition to \
about 67G in Disk Administrator leaving the remaining 33G as unallocated.  Afterward \
I tried a web reference technique and  used Sysinternals SDelete to zero the free \
space then used 'qemu-img convert -O qcow2 &lt;original.qcow2&gt; &lt;new.qcow2&gt;' to produce a \
physical image size of 29G.  qemu-img info reports on "new.qcow2":


 file format: qcow2
virtual size: 100G (107374182400 bytes)
disk size: 29G
cluster_size: 65536
Format specific information:
    compat: 1.1
    lazy refcounts: false


The issue is that the virtual size is still 100G.  I don't have the physical disk \
space to allow approximately 12 images (all configured for a virtual size of 100G) to \
grow to that size (6 VMs with C: and D: on a 1TB ssd, L: is on an hdd which isn't an \
issue).  I need to change that virtual size number for this image to 67 or 68G.  On \
the D: images I can drop to approximately 40G for an aggregate total of about 650G \
for all six VMs - well within the 875G physical size limitation that the ssd provides \
after overhead.


That's a long background to why I need to change the virtual disk size.  Again, any \
alternatives would be much appreciated.


-----Original Message-----
From: Martin Kletzander &lt;mkletzan@redhat.com&gt;
To: Leroy Tennison &lt;leroy.tennison@verizon.net&gt;
Cc: libvirt-users &lt;libvirt-users@redhat.com&gt;
Sent: Tue, Jul 11, 2017 2:51 am
Subject: Re: [libvirt-users] Is there still no easier way to shrink a VM image?

On Tue, Jul 11, 2017 at 12:34:31AM -0500, Leroy Tennison wrote:
&gt; I have numerous qcow2 images which need to be reduced in size and have
&gt; their maximum size (virtual size) reduced.  Physical disk space became
&gt; so low that VMs "auto-paused" themselves, I moved enough images to solve
&gt; the immediate problem but need to rectify the underlying issue.  It
&gt; seems that qcow[2] files are grown in size such that the data inside of
&gt; them takes about 50-60% of the space (does anyone know the actual
&gt; algorithm or how to control it?).  Given the total physical disk space
&gt; on the hypervisors, I need something more restrictive.
&gt; 

I don't get it.  You have virtual size greater than the free space on
the physical storage and instead of the VM finding out you want the
guest OS to see it has no space at all?

&gt; Our hypervisors are a mix of Ubuntu 14 or 16 LTS (qemu-img 2.2 or 2.5).
&gt; After doing all the preparation (defragment, reduce OS partition size)
&gt; "qemu-img resize" reports that shrinking isn't supported yet.  My web
&gt; research indicates that, to accomplish this,  I have to:
&gt; 
&gt; convert to raw
&gt; 
&gt; shrink the image
&gt; 
&gt; convert back to qcow[2]
&gt; 
&gt; increase the image size to provide for some growth
&gt; 
&gt; I'm hoping I've missed something in my research and that someone knows
&gt; an easier way.  I don't feel constrained to qemu-img but this is a
&gt; production environment precluding consideration of experimental
&gt; software.  Virt-resize, guestfish or any other reasonable option is fine
&gt; with me.  Solutions or ideas?  Thanks.
&gt; 

&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users


[Attachment #3 (text/html)]

&lt;font color='black' size='2' face='arial'&gt;Thanks for letting me know I'm not making \
myself clear, let me try again with a few more specifics,  These are Windows VMs \
with three disk images for C:, D: and L:.  To simplify I'll focus on the image \
for C: which had grown to 77G physical size on the hypervisor's ssd (I just \
double-checked that with 'ls -al' because qemu-img below says 70G, this image had two \
snapshots at one time which may be the reason for the discrepancy).  qemu-img \
info reports: &lt;div&gt;&lt;br&gt;
&lt;/div&gt;

&lt;div&gt;
&lt;div&gt;file format: qcow2&lt;/div&gt;

&lt;div&gt;virtual size: 100G (107374182400 bytes)&lt;/div&gt;

&lt;div&gt;disk size: 70G&lt;/div&gt;

&lt;div&gt;cluster_size: 65536&lt;/div&gt;

&lt;div&gt;Format specific information:&lt;/div&gt;

&lt;div&gt;    compat: 0.10&lt;/div&gt;

&lt;div&gt;&lt;br&gt;
&lt;/div&gt;

&lt;div&gt;I used Windows Server 2012r2 "Optimize" (defrag) and then reduced the C: \
partition to about 67G in Disk Administrator leaving the remaining 33G as \
unallocated.  &lt;span style="font-size: 13.3333px;"&gt;Afterward I tried a web \
reference technique and&lt;/span&gt;&lt;span style="font-size: 13.3333px;"&gt; &lt;/span&gt;&lt;span \
style="font-size: 10pt;"&gt; used Sysinternals SDelete to zero the free space then \
used 'qemu-img convert -O qcow2 &lt;original.qcow2&gt; &lt;new.qcow2&gt;' to produce \
a physical image size of 29G.  qemu-img info reports on \
"new.qcow2":&lt;/span&gt;&lt;/div&gt;

&lt;div&gt;&lt;br&gt;
&lt;/div&gt;

&lt;div&gt; file format: qcow2&lt;/div&gt;

&lt;div&gt;virtual size: 100G (107374182400 bytes)&lt;/div&gt;

&lt;div&gt;disk size: 29G&lt;/div&gt;

&lt;div&gt;cluster_size: 65536&lt;/div&gt;

&lt;div&gt;Format specific information:&lt;/div&gt;

&lt;div&gt;    compat: 1.1&lt;/div&gt;

&lt;div&gt;    lazy refcounts: false&lt;/div&gt;

&lt;div&gt;&lt;br&gt;
&lt;/div&gt;
The issue is that the virtual size is still 100G.  I don't have the physical \
disk space to allow approximately 12 images (all configured for a virtual size of \
100G) to grow to that size (6 VMs with C: and D: on a 1TB ssd, L: is on an hdd which \
isn't an issue).  I need to change that virtual size number for this image to 67 \
or 68G.  On the D: images I can drop to approximately 40G for an aggregate total \
of about 650G for all six VMs - well within the 875G physical size limitation that \
the ssd provides after overhead.&lt;/div&gt;

&lt;div&gt;&lt;br&gt;
&lt;/div&gt;

&lt;div&gt;That's a long background to why I need to change the virtual disk size. \
 Again, any alternatives would be much appreciated.&lt;br&gt; &lt;br&gt;

&lt;div style="font-family:arial,helvetica;font-size:10pt;color:black"&gt;-----Original \
                Message-----&lt;br&gt;
From: Martin Kletzander &lt;mkletzan@redhat.com&gt;&lt;br&gt;
To: Leroy Tennison &lt;leroy.tennison@verizon.net&gt;&lt;br&gt;
Cc: libvirt-users &lt;libvirt-users@redhat.com&gt;&lt;br&gt;
Sent: Tue, Jul 11, 2017 2:51 am&lt;br&gt;
Subject: Re: [libvirt-users] Is there still no easier way to shrink a VM image?&lt;br&gt;
&lt;br&gt;
On Tue, Jul 11, 2017 at 12:34:31AM -0500, Leroy Tennison wrote:&lt;br&gt;
&gt;I have numerous qcow2 images which need to be reduced in size and have&lt;br&gt;
&gt;their maximum size (virtual size) reduced.  Physical disk space became&lt;br&gt;
&gt;so low that VMs "auto-paused" themselves, I moved enough images to solve&lt;br&gt;
&gt;the immediate problem but need to rectify the underlying issue.  It&lt;br&gt;
&gt;seems that qcow[2] files are grown in size such that the data inside of&lt;br&gt;
&gt;them takes about 50-60% of the space (does anyone know the actual&lt;br&gt;
&gt;algorithm or how to control it?).  Given the total physical disk space&lt;br&gt;
&gt;on the hypervisors, I need something more restrictive.&lt;br&gt;
&gt;&lt;br&gt;
&lt;br&gt;
I don't get it.  You have virtual size greater than the free space on&lt;br&gt;
the physical storage and instead of the VM finding out you want the&lt;br&gt;
guest OS to see it has no space at all?&lt;br&gt;
&lt;br&gt;
&gt;Our hypervisors are a mix of Ubuntu 14 or 16 LTS (qemu-img 2.2 or 2.5).&lt;br&gt;
&gt;After doing all the preparation (defragment, reduce OS partition size)&lt;br&gt;
&gt;"qemu-img resize" reports that shrinking isn't supported yet.  My web&lt;br&gt;
&gt;research indicates that, to accomplish this,  I have to:&lt;br&gt;
&gt;&lt;br&gt;
&gt;    convert to raw&lt;br&gt;
&gt;&lt;br&gt;
&gt;    shrink the image&lt;br&gt;
&gt;&lt;br&gt;
&gt;    convert back to qcow[2]&lt;br&gt;
&gt;&lt;br&gt;
&gt;    increase the image size to provide for some growth&lt;br&gt;
&gt;&lt;br&gt;
&gt;I'm hoping I've missed something in my research and that someone knows&lt;br&gt;
&gt;an easier way.  I don't feel constrained to qemu-img but this is a&lt;br&gt;
&gt;production environment precluding consideration of experimental&lt;br&gt;
&gt;software.  Virt-resize, guestfish or any other reasonable option is fine&lt;br&gt;
&gt;with me.  Solutions or ideas?  Thanks.&lt;br&gt;
&gt;&lt;br&gt;
&lt;br&gt;
&gt;_______________________________________________&lt;br&gt;
&gt;libvirt-users mailing list&lt;br&gt;
&gt;libvirt-&lt;a href="mailto:users@redhat.com"&gt;users@redhat.com&lt;/a&gt;&lt;br&gt;
&gt;&lt;a href="https://www.redhat.com/mailman/listinfo/libvirt-users" \
target="_blank"&gt;https://www.redhat.com/mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt; &lt;/div&gt;
&lt;/div&gt;
&lt;/font&gt;



</body></email><email><emailId>20170711171725</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-07-11 17:17:25-0400</timestampReceived><subject>Re: [libvirt-users] Is there still no easier way to shrink a VM image?</subject><body>

Alternative one: Disks are cheap! Buy one with 3tb and you have plenty of
headroom.

On 11 Jul 2017 5:40 p.m., "Leroy Tennison" &lt;leroy.tennison@verizon.net&gt;
wrote:

&gt; Thanks for letting me know I'm not making myself clear, let me try again
&gt; with a few more specifics,  These are Windows VMs with three disk images
&gt; for C:, D: and L:.  To simplify I'll focus on the image for C: which had
&gt; grown to 77G physical size on the hypervisor's ssd (I just double-checked
&gt; that with 'ls -al' because qemu-img below says 70G, this image had two
&gt; snapshots at one time which may be the reason for the discrepancy).
&gt;  qemu-img info reports:
&gt;
&gt; file format: qcow2
&gt; virtual size: 100G (107374182400 bytes)
&gt; disk size: 70G
&gt; cluster_size: 65536
&gt; Format specific information:
&gt;     compat: 0.10
&gt;
&gt; I used Windows Server 2012r2 "Optimize" (defrag) and then reduced the C:
&gt; partition to about 67G in Disk Administrator leaving the remaining 33G as
&gt; unallocated.  Afterward I tried a web reference technique and  used
&gt; Sysinternals SDelete to zero the free space then used 'qemu-img convert -O
&gt; qcow2 &lt;original.qcow2&gt; &lt;new.qcow2&gt;' to produce a physical image size of
&gt; 29G.  qemu-img info reports on "new.qcow2":
&gt;
&gt;  file format: qcow2
&gt; virtual size: 100G (107374182400 bytes)
&gt; disk size: 29G
&gt; cluster_size: 65536
&gt; Format specific information:
&gt;     compat: 1.1
&gt;     lazy refcounts: false
&gt;
&gt; The issue is that the virtual size is still 100G.  I don't have the
&gt; physical disk space to allow approximately 12 images (all configured for a
&gt; virtual size of 100G) to grow to that size (6 VMs with C: and D: on a 1TB
&gt; ssd, L: is on an hdd which isn't an issue).  I need to change that virtual
&gt; size number for this image to 67 or 68G.  On the D: images I can drop to
&gt; approximately 40G for an aggregate total of about 650G for all six VMs -
&gt; well within the 875G physical size limitation that the ssd provides after
&gt; overhead.
&gt;
&gt; That's a long background to why I need to change the virtual disk size.
&gt; Again, any alternatives would be much appreciated.
&gt;
&gt; -----Original Message-----
&gt; From: Martin Kletzander &lt;mkletzan@redhat.com&gt;
&gt; To: Leroy Tennison &lt;leroy.tennison@verizon.net&gt;
&gt; Cc: libvirt-users &lt;libvirt-users@redhat.com&gt;
&gt; Sent: Tue, Jul 11, 2017 2:51 am
&gt; Subject: Re: [libvirt-users] Is there still no easier way to shrink a VM
&gt; image?
&gt;
&gt; On Tue, Jul 11, 2017 at 12:34:31AM -0500, Leroy Tennison wrote:
&gt; &gt;I have numerous qcow2 images which need to be reduced in size and have
&gt; &gt;their maximum size (virtual size) reduced. Physical disk space became
&gt; &gt;so low that VMs "auto-paused" themselves, I moved enough images to solve
&gt; &gt;the immediate problem but need to rectify the underlying issue. It
&gt; &gt;seems that qcow[2] files are grown in size such that the data inside of
&gt; &gt;them takes about 50-60% of the space (does anyone know the actual
&gt; &gt;algorithm or how to control it?). Given the total physical disk space
&gt; &gt;on the hypervisors, I need something more restrictive.
&gt; &gt;
&gt;
&gt; I don't get it. You have virtual size greater than the free space on
&gt; the physical storage and instead of the VM finding out you want the
&gt; guest OS to see it has no space at all?
&gt;
&gt; &gt;Our hypervisors are a mix of Ubuntu 14 or 16 LTS (qemu-img 2.2 or 2.5).
&gt; &gt;After doing all the preparation (defragment, reduce OS partition size)
&gt; &gt;"qemu-img resize" reports that shrinking isn't supported yet. My web
&gt; &gt;research indicates that, to accomplish this, I have to:
&gt; &gt;
&gt; &gt; convert to raw
&gt; &gt;
&gt; &gt; shrink the image
&gt; &gt;
&gt; &gt; convert back to qcow[2]
&gt; &gt;
&gt; &gt; increase the image size to provide for some growth
&gt; &gt;
&gt; &gt;I'm hoping I've missed something in my research and that someone knows
&gt; &gt;an easier way. I don't feel constrained to qemu-img but this is a
&gt; &gt;production environment precluding consideration of experimental
&gt; &gt;software. Virt-resize, guestfish or any other reasonable option is fine
&gt; &gt;with me. Solutions or ideas? Thanks.
&gt; &gt;
&gt;
&gt; &gt;_______________________________________________
&gt; &gt;libvirt-users mailing list
&gt; &gt;libvirt-users@redhat.com
&gt; &gt;https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;

[Attachment #3 (text/html)]

&lt;div dir="auto"&gt;Alternative one: Disks are cheap! Buy one with 3tb and you have \
plenty of headroom.&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;On 11 \
Jul 2017 5:40 p.m., "Leroy Tennison" &lt;&lt;a \
href="mailto:leroy.tennison@verizon.net"&gt;leroy.tennison@verizon.net&lt;/a&gt;&gt; wrote:&lt;br \
type="attribution"&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;font color="black" size="2" \
face="arial"&gt;Thanks for letting me know I'm not making myself clear, let me try \
again with a few more specifics,   These are Windows VMs with three disk images for \
C:, D: and L:.   To simplify I'll focus on the image for C: which had grown to \
77G physical size on the hypervisor's ssd (I just double-checked that with \
'ls -al' because qemu-img below says 70G, this image had two snapshots at one \
time which may be the reason for the discrepancy).   qemu-img info reports: &lt;div&gt;&lt;br&gt;
&lt;/div&gt;

&lt;div&gt;
&lt;div&gt;file format: qcow2&lt;/div&gt;

&lt;div&gt;virtual size: 100G (107374182400 bytes)&lt;/div&gt;

&lt;div&gt;disk size: 70G&lt;/div&gt;

&lt;div&gt;cluster_size: 65536&lt;/div&gt;

&lt;div&gt;Format specific information:&lt;/div&gt;

&lt;div&gt;      compat: 0.10&lt;/div&gt;

&lt;div&gt;&lt;br&gt;
&lt;/div&gt;

&lt;div&gt;I used Windows Server 2012r2 "Optimize" (defrag) and then reduced the \
C: partition to about 67G in Disk Administrator leaving the remaining 33G as \
unallocated.   &lt;span style="font-size:13.3333px"&gt;Afterward I tried a web reference \
technique and&lt;/span&gt;&lt;span style="font-size:13.3333px"&gt;  &lt;/span&gt;&lt;span \
style="font-size:10pt"&gt;  used Sysinternals SDelete to zero the free space then used \
'qemu-img convert -O qcow2 &lt;original.qcow2&gt; &lt;new.qcow2&gt;' to \
produce a physical image size of 29G.   qemu-img info reports on \
"new.qcow2":&lt;/span&gt;&lt;/div&gt;

&lt;div&gt;&lt;br&gt;
&lt;/div&gt;

&lt;div&gt;  file format: qcow2&lt;/div&gt;

&lt;div&gt;virtual size: 100G (107374182400 bytes)&lt;/div&gt;

&lt;div&gt;disk size: 29G&lt;/div&gt;

&lt;div&gt;cluster_size: 65536&lt;/div&gt;

&lt;div&gt;Format specific information:&lt;/div&gt;

&lt;div&gt;      compat: 1.1&lt;/div&gt;

&lt;div&gt;      lazy refcounts: false&lt;/div&gt;

&lt;div&gt;&lt;br&gt;
&lt;/div&gt;
The issue is that the virtual size is still 100G.   I don't have the physical \
disk space to allow approximately 12 images (all configured for a virtual size of \
100G) to grow to that size (6 VMs with C: and D: on a 1TB ssd, L: is on an hdd which \
isn't an issue).   I need to change that virtual size number for this image to 67 \
or 68G.   On the D: images I can drop to approximately 40G for an aggregate total of \
about 650G for all six VMs - well within the 875G physical size limitation that the \
ssd provides after overhead.&lt;/div&gt;

&lt;div&gt;&lt;br&gt;
&lt;/div&gt;

&lt;div&gt;That's a long background to why I need to change the virtual disk size.   \
Again, any alternatives would be much appreciated.&lt;br&gt; &lt;br&gt;

&lt;div style="font-family:arial,helvetica;font-size:10pt;color:black"&gt;-----Original \
                Message-----&lt;br&gt;
From: Martin Kletzander &lt;&lt;a href="mailto:mkletzan@redhat.com" \
                target="_blank"&gt;mkletzan@redhat.com&lt;/a&gt;&gt;&lt;br&gt;
To: Leroy Tennison &lt;&lt;a href="mailto:leroy.tennison@verizon.net" \
                target="_blank"&gt;leroy.tennison@verizon.net&lt;/a&gt;&gt;&lt;br&gt;
Cc: libvirt-users &lt;&lt;a href="mailto:libvirt-users@redhat.com" \
                target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&gt;&lt;br&gt;
Sent: Tue, Jul 11, 2017 2:51 am&lt;br&gt;
Subject: Re: [libvirt-users] Is there still no easier way to shrink a VM image?&lt;br&gt;
&lt;br&gt;
On Tue, Jul 11, 2017 at 12:34:31AM -0500, Leroy Tennison wrote:&lt;br&gt;
&gt;I have numerous qcow2 images which need to be reduced in size and have&lt;br&gt;
&gt;their maximum size (virtual size) reduced.  Physical disk space became&lt;br&gt;
&gt;so low that VMs "auto-paused" themselves, I moved enough images to \
solve&lt;br&gt; &gt;the immediate problem but need to rectify the underlying issue.  It&lt;br&gt;
&gt;seems that qcow[2] files are grown in size such that the data inside of&lt;br&gt;
&gt;them takes about 50-60% of the space (does anyone know the actual&lt;br&gt;
&gt;algorithm or how to control it?).  Given the total physical disk space&lt;br&gt;
&gt;on the hypervisors, I need something more restrictive.&lt;br&gt;
&gt;&lt;br&gt;
&lt;br&gt;
I don't get it.  You have virtual size greater than the free space on&lt;br&gt;
the physical storage and instead of the VM finding out you want the&lt;br&gt;
guest OS to see it has no space at all?&lt;br&gt;
&lt;br&gt;
&gt;Our hypervisors are a mix of Ubuntu 14 or 16 LTS (qemu-img 2.2 or 2.5).&lt;br&gt;
&gt;After doing all the preparation (defragment, reduce OS partition size)&lt;br&gt;
&gt;"qemu-img resize" reports that shrinking isn't supported yet.  My \
web&lt;br&gt; &gt;research indicates that, to accomplish this,  I have to:&lt;br&gt;
&gt;&lt;br&gt;
&gt;    convert to raw&lt;br&gt;
&gt;&lt;br&gt;
&gt;    shrink the image&lt;br&gt;
&gt;&lt;br&gt;
&gt;    convert back to qcow[2]&lt;br&gt;
&gt;&lt;br&gt;
&gt;    increase the image size to provide for some growth&lt;br&gt;
&gt;&lt;br&gt;
&gt;I'm hoping I've missed something in my research and that someone \
knows&lt;br&gt; &gt;an easier way.  I don't feel constrained to qemu-img but this is \
a&lt;br&gt; &gt;production environment precluding consideration of experimental&lt;br&gt;
&gt;software.  Virt-resize, guestfish or any other reasonable option is fine&lt;br&gt;
&gt;with me.  Solutions or ideas?  Thanks.&lt;br&gt;
&gt;&lt;br&gt;
&lt;br&gt;
&gt;_____________________________&lt;wbr&gt;__________________&lt;br&gt;
&gt;libvirt-users mailing list&lt;br&gt;
&gt;libvirt-&lt;a href="mailto:users@redhat.com" \
target="_blank"&gt;users@redhat.com&lt;/a&gt;&lt;br&gt; &gt;&lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" \
target="_blank"&gt;https://www.redhat.com/&lt;wbr&gt;mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt; \
&lt;/div&gt; &lt;/div&gt;
&lt;/font&gt;&lt;br&gt;______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;
&lt;a href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/&lt;wbr&gt;mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;




</body></email><email><emailId>20170706205353</emailId><senderName>Jędrek Domański</senderName><senderEmail>jedrek.domanski@gmail.com</senderEmail><timestampReceived>2017-07-06 20:53:53-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

Hello,

Am I addressing this issue to the right address? Please respond.

2017-07-04 9:31 GMT+02:00 J=C4=99drek Doma=C5=84ski &lt;jedrek.domanski@gmail.=
com&gt;:

&gt; Hello? What is the status of this issue?
&gt;
&gt; 2017-06-30 22:24 GMT+02:00 J=C4=99drek Doma=C5=84ski &lt;jedrek.domanski@gma=
il.com&gt;:
&gt;
&gt;&gt; Hi
&gt;&gt;
&gt;&gt; I have recently upgraded from Ubuntu 15.04 to 16.04 and now everytime I
&gt;&gt; shutdown my PC I get a black screen where it says "libvirt-guests.sh [69=
17]
&gt;&gt; - running guests under URI address default: no running guests" and the P=
C
&gt;&gt; just hangs forever and will not shutdown. I need to manually kill it in
&gt;&gt; order to shut it down which is a pain in the ass. I have done some
&gt;&gt; investigation and here is what I've found out so far.
&gt;&gt;
&gt;&gt; I have uninstalled libvirt, kvm and qemu:
&gt;&gt;
&gt;&gt; sudo apt-get purge libvirt* kvm qemu*
&gt;&gt;
&gt;&gt; The problem has gone, however I noticed some error messages at boot
&gt;&gt; saying something that "FAILED Qemu .... It flashes so quickly and I am n=
ot
&gt;&gt; able to read what exactly it says. I installed libvirt again:
&gt;&gt;
&gt;&gt; sudo apt install qemu-kvm libvirt-bin
&gt;&gt;
&gt;&gt; and the problem is back!
&gt;&gt;
&gt;&gt; So is this script trying to shutdown my virtual machines? It looks like
&gt;&gt; it does but since it does not find any it hangs? I don't have any machin=
es,
&gt;&gt; though. I used to have one, but I removed it. What is interesting, my PC
&gt;&gt; hangs at shutdown randomly, that is sometimes it hangs for like 15 secon=
ds
&gt;&gt; and it shutsdown but in most cases it hangs forever. So this happens
&gt;&gt; randomly.
&gt;&gt;
&gt;&gt; So, this investigation has brought me to you guys so please help me. I
&gt;&gt; have attached a screen (sorry for polish error message but the translati=
on
&gt;&gt; is in the email title).
&gt;&gt;
&gt;&gt; I have also posted a thread on AskUbuntu on this:
&gt;&gt;
&gt;&gt; https://askubuntu.com/questions/925696/ubuntu-16-04-libvirt-
&gt;&gt; guests-sh-6917-running-guests-under-uri-address-default
&gt;&gt;
&gt;&gt; Thank you,
&gt;&gt; J=C4=99drzej
&gt;&gt;
&gt;
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Hello,&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Am I addressing this issue to the \
right address? Please respond.&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-04 9:31 GMT+02:00 Jędrek Domański &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Hello? What is the status of this \
issue?&lt;/div&gt;&lt;/div&gt;&lt;div class="HOEnZb"&gt;&lt;div class="h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-06-30 22:24 GMT+02:00 Jędrek \
Domański &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div class="m_-5912502521504996974HOEnZb"&gt;&lt;div \
class="m_-5912502521504996974h5"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;Hi&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;I have recently upgraded from Ubuntu 15.04 to 16.04 and now \
everytime I shutdown my PC I get a black screen where it says "libvirt-guests.sh \
[6917] - running guests under URI address default: no running guests" and the PC \
just hangs forever and will not shutdown. I need to manually kill it in order to shut \
it down which is a pain in the ass. I have done some investigation and here is what \
I've found out so far.&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;I have uninstalled libvirt, kvm and qemu:&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;pre \
style="white-space:pre-wrap;margin-top:0px;margin-bottom:1em;padding:5px;border:0px;fo \
nt-variant-numeric:inherit;font-stretch:inherit;font-size:13px;line-height:inherit;font-family:Consolas,Menlo,Monaco,"Lucida \
Console","Liberation Mono","DejaVu Sans \
Mono","Bitstream Vera Sans Mono","Courier \
New",monospace,sans-serif;vertical-align:baseline;width:auto;max-height:600px;ove \
rflow:auto;background-color:rgb(239,240,241);word-wrap:normal;color:rgb(17,17,17)"&gt;&lt;code \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;line-height:inherit;font-family:Consolas,Menlo,Monaco,"Lucida \
Console","Liberation Mono","DejaVu Sans \
Mono","Bitstream Vera Sans Mono","Courier \
New",monospace,sans-serif;vertical-align:baseline;white-space:inherit"&gt;sudo \
apt-get purge libvirt* kvm qemu*&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;The problem has gone, however I noticed some error messages \
at boot saying something that "FAILED Qemu .... It flashes so quickly and I am \
not able to read what exactly it says. I installed libvirt again:&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;pre \
class="m_-5912502521504996974m_6636733946930978432gmail-m_-849249386569305750gmail-contents" \
style="white-space:pre-wrap;margin-top:0px;margin-bottom:8px;padding:0.5em \
1em;border:1px dashed \
rgb(193,180,150);font-size:13px;line-height:16px;font-family:UbuntuMono,courier,monosp \
ace;vertical-align:baseline;background-color:rgb(243,243,243);word-wrap:break-word;color:rgb(51,51,51)"&gt;&lt;span \
class="m_-5912502521504996974m_6636733946930978432gmail-m_-849249386569305750gmail-cmd \
m_-5912502521504996974m_6636733946930978432gmail-m_-849249386569305750gmail-command" \
style="margin:0px;padding:0px;border:0px;font-weight:inherit;font-style:inherit;line-h \
eight:1.5;font-family:monospace;vertical-align:baseline;background-color:rgb(242,242,242)"&gt;sudo \
apt install qemu-kvm libvirt-bin&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;and the problem is back!&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;So is this script trying to shutdown my virtual machines? It \
looks like it does but since it does not find any it hangs? I don't have any \
machines, though. I used to have one, but I removed it. What is interesting, my PC \
hangs at shutdown randomly, that is sometimes it hangs for like 15 seconds and it \
shutsdown but in most cases it hangs forever. So this happens randomly.&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;So, this investigation has brought me to you guys so please \
help me. I have attached a screen (sorry for polish error message but the translation \
is in the email title).&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;I have also posted a thread on AskUbuntu on this:&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;a href="https://askubuntu.com/questions/925696/ubuntu-16-04-libvirt-guests-sh-6917-runni" \
target="_blank"&gt;https://askubuntu.com/question&lt;wbr&gt;s/925696/ubuntu-16-04-libvirt-&lt;wbr&gt;guests-sh-6917-runni&lt;/a&gt;&lt;/font&gt;&lt;span \
style="font-family:arial,helvetica,sans-serif"&gt;ng-guests-&lt;wbr&gt;under-uri-address-default&lt;/span&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;span \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font \
face="arial, helvetica, sans-serif"&gt;Thank you,&lt;/font&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;Jędrzej&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170707071850</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-07-07 07:18:50-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

Hey

FWIW, I have virsh running on my laptop too and no virtual machines
registered to autostart but my laptop reboots just fine and shows no traces
of any warnings.

Cheers,
Dominik

2017-07-06 22:53 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com&gt;:

&gt; Hello,
&gt;
&gt; Am I addressing this issue to the right address? Please respond.
&gt;
&gt; 2017-07-04 9:31 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com&gt;:
&gt;
&gt;&gt; Hello? What is the status of this issue?
&gt;&gt;
&gt;&gt; 2017-06-30 22:24 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com&gt;:
&gt;&gt;
&gt;&gt;&gt; Hi
&gt;&gt;&gt;
&gt;&gt;&gt; I have recently upgraded from Ubuntu 15.04 to 16.04 and now everytime I
&gt;&gt;&gt; shutdown my PC I get a black screen where it says "libvirt-guests.sh [6917]
&gt;&gt;&gt; - running guests under URI address default: no running guests" and the PC
&gt;&gt;&gt; just hangs forever and will not shutdown. I need to manually kill it in
&gt;&gt;&gt; order to shut it down which is a pain in the ass. I have done some
&gt;&gt;&gt; investigation and here is what I've found out so far.
&gt;&gt;&gt;
&gt;&gt;&gt; I have uninstalled libvirt, kvm and qemu:
&gt;&gt;&gt;
&gt;&gt;&gt; sudo apt-get purge libvirt* kvm qemu*
&gt;&gt;&gt;
&gt;&gt;&gt; The problem has gone, however I noticed some error messages at boot
&gt;&gt;&gt; saying something that "FAILED Qemu .... It flashes so quickly and I am not
&gt;&gt;&gt; able to read what exactly it says. I installed libvirt again:
&gt;&gt;&gt;
&gt;&gt;&gt; sudo apt install qemu-kvm libvirt-bin
&gt;&gt;&gt;
&gt;&gt;&gt; and the problem is back!
&gt;&gt;&gt;
&gt;&gt;&gt; So is this script trying to shutdown my virtual machines? It looks like
&gt;&gt;&gt; it does but since it does not find any it hangs? I don't have any machines,
&gt;&gt;&gt; though. I used to have one, but I removed it. What is interesting, my PC
&gt;&gt;&gt; hangs at shutdown randomly, that is sometimes it hangs for like 15 seconds
&gt;&gt;&gt; and it shutsdown but in most cases it hangs forever. So this happens
&gt;&gt;&gt; randomly.
&gt;&gt;&gt;
&gt;&gt;&gt; So, this investigation has brought me to you guys so please help me. I
&gt;&gt;&gt; have attached a screen (sorry for polish error message but the translation
&gt;&gt;&gt; is in the email title).
&gt;&gt;&gt;
&gt;&gt;&gt; I have also posted a thread on AskUbuntu on this:
&gt;&gt;&gt;
&gt;&gt;&gt; https://askubuntu.com/questions/925696/ubuntu-16-04-libvirt-
&gt;&gt;&gt; guests-sh-6917-running-guests-under-uri-address-default
&gt;&gt;&gt;
&gt;&gt;&gt; Thank you,
&gt;&gt;&gt; Jędrzej
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;



-- 
Dominik Psenner

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;Hey&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;FWIW, I have virsh running on my laptop \
too and no virtual machines registered to autostart but my laptop reboots just fine \
and shows no traces of any \
warnings.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;Dominik&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-06 22:53 GMT+02:00 Jędrek \
Domański &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Hello,&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Am I addressing this issue to the \
right address? Please respond.&lt;/div&gt;&lt;/div&gt;&lt;div class="HOEnZb"&gt;&lt;div class="h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-04 9:31 GMT+02:00 Jędrek \
Domański &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Hello? What is the status of this \
issue?&lt;/div&gt;&lt;/div&gt;&lt;div class="m_8971097031154397227HOEnZb"&gt;&lt;div \
class="m_8971097031154397227h5"&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-06-30 22:24 GMT+02:00 Jędrek Domański &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div \
class="m_8971097031154397227m_-5912502521504996974HOEnZb"&gt;&lt;div \
class="m_8971097031154397227m_-5912502521504996974h5"&gt;&lt;div dir="ltr"&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;Hi&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;I have recently upgraded from Ubuntu 15.04 to 16.04 and now \
everytime I shutdown my PC I get a black screen where it says "libvirt-guests.sh \
[6917] - running guests under URI address default: no running guests" and the PC \
just hangs forever and will not shutdown. I need to manually kill it in order to shut \
it down which is a pain in the ass. I have done some investigation and here is what \
I've found out so far.&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;I have uninstalled libvirt, kvm and qemu:&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;pre \
style="white-space:pre-wrap;margin-top:0px;margin-bottom:1em;padding:5px;border:0px;fo \
nt-variant-numeric:inherit;font-stretch:inherit;font-size:13px;line-height:inherit;font-family:Consolas,Menlo,Monaco,"Lucida \
Console","Liberation Mono","DejaVu Sans \
Mono","Bitstream Vera Sans Mono","Courier \
New",monospace,sans-serif;vertical-align:baseline;width:auto;max-height:600px;ove \
rflow:auto;background-color:rgb(239,240,241);word-wrap:normal;color:rgb(17,17,17)"&gt;&lt;code \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;line-height:inherit;font-family:Consolas,Menlo,Monaco,"Lucida \
Console","Liberation Mono","DejaVu Sans \
Mono","Bitstream Vera Sans Mono","Courier \
New",monospace,sans-serif;vertical-align:baseline;white-space:inherit"&gt;sudo \
apt-get purge libvirt* kvm qemu*&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;The problem has gone, however I noticed some error messages \
at boot saying something that "FAILED Qemu .... It flashes so quickly and I am \
not able to read what exactly it says. I installed libvirt again:&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;pre \
class="m_8971097031154397227m_-5912502521504996974m_6636733946930978432gmail-m_-849249386569305750gmail-contents" \
style="white-space:pre-wrap;margin-top:0px;margin-bottom:8px;padding:0.5em \
1em;border:1px dashed \
rgb(193,180,150);font-size:13px;line-height:16px;font-family:UbuntuMono,courier,monosp \
ace;vertical-align:baseline;background-color:rgb(243,243,243);word-wrap:break-word;color:rgb(51,51,51)"&gt;&lt;span \
class="m_8971097031154397227m_-5912502521504996974m_6636733946930978432gmail-m_-849249386569305750gmail-cmd \
m_8971097031154397227m_-5912502521504996974m_6636733946930978432gmail-m_-849249386569305750gmail-command" \
style="margin:0px;padding:0px;border:0px;font-weight:inherit;font-style:inherit;line-h \
eight:1.5;font-family:monospace;vertical-align:baseline;background-color:rgb(242,242,242)"&gt;sudo \
apt install qemu-kvm libvirt-bin&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;and the problem is back!&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;So is this script trying to shutdown my virtual machines? It \
looks like it does but since it does not find any it hangs? I don't have any \
machines, though. I used to have one, but I removed it. What is interesting, my PC \
hangs at shutdown randomly, that is sometimes it hangs for like 15 seconds and it \
shutsdown but in most cases it hangs forever. So this happens randomly.&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;So, this investigation has brought me to you guys so please \
help me. I have attached a screen (sorry for polish error message but the translation \
is in the email title).&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;I have also posted a thread on AskUbuntu on this:&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;a href="https://askubuntu.com/questions/925696/ubuntu-16-04-libvirt-guests-sh-6917-runni" \
target="_blank"&gt;https://askubuntu.com/question&lt;wbr&gt;s/925696/ubuntu-16-04-libvirt-&lt;wbr&gt;guests-sh-6917-runni&lt;/a&gt;&lt;/font&gt;&lt;span \
style="font-family:arial,helvetica,sans-serif"&gt;ng-guests-&lt;wbr&gt;under-uri-address-default&lt;/span&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;span \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font \
face="arial, helvetica, sans-serif"&gt;Thank you,&lt;/font&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;Jędrzej&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;br&gt;______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;
&lt;a href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/&lt;wbr&gt;mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br \
clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- &lt;br&gt;&lt;div class="gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/div&gt;



</body></email><email><emailId>20170707072009</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-07-07 07:20:09-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

$ uname -a
Linux mugen 4.4.0-83-generic #106-Ubuntu SMP Mon Jun 26 17:54:43 UTC 2017
x86_64 x86_64 x86_64 GNU/Linux
$ lsb_release -a
No LSB modules are available.
Distributor ID: Ubuntu
Description: Ubuntu 16.04.2 LTS
Release: 16.04
Codename: xenial

2017-07-07 9:18 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:

&gt; Hey
&gt;
&gt; FWIW, I have virsh running on my laptop too and no virtual machines
&gt; registered to autostart but my laptop reboots just fine and shows no traces
&gt; of any warnings.
&gt;
&gt; Cheers,
&gt; Dominik
&gt;
&gt; 2017-07-06 22:53 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com&gt;:
&gt;
&gt;&gt; Hello,
&gt;&gt;
&gt;&gt; Am I addressing this issue to the right address? Please respond.
&gt;&gt;
&gt;&gt; 2017-07-04 9:31 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com&gt;:
&gt;&gt;
&gt;&gt;&gt; Hello? What is the status of this issue?
&gt;&gt;&gt;
&gt;&gt;&gt; 2017-06-30 22:24 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com&gt;:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I have recently upgraded from Ubuntu 15.04 to 16.04 and now everytime I
&gt;&gt;&gt;&gt; shutdown my PC I get a black screen where it says "libvirt-guests.sh [6917]
&gt;&gt;&gt;&gt; - running guests under URI address default: no running guests" and the PC
&gt;&gt;&gt;&gt; just hangs forever and will not shutdown. I need to manually kill it in
&gt;&gt;&gt;&gt; order to shut it down which is a pain in the ass. I have done some
&gt;&gt;&gt;&gt; investigation and here is what I've found out so far.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I have uninstalled libvirt, kvm and qemu:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; sudo apt-get purge libvirt* kvm qemu*
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; The problem has gone, however I noticed some error messages at boot
&gt;&gt;&gt;&gt; saying something that "FAILED Qemu .... It flashes so quickly and I am not
&gt;&gt;&gt;&gt; able to read what exactly it says. I installed libvirt again:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; sudo apt install qemu-kvm libvirt-bin
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; and the problem is back!
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; So is this script trying to shutdown my virtual machines? It looks like
&gt;&gt;&gt;&gt; it does but since it does not find any it hangs? I don't have any machines,
&gt;&gt;&gt;&gt; though. I used to have one, but I removed it. What is interesting, my PC
&gt;&gt;&gt;&gt; hangs at shutdown randomly, that is sometimes it hangs for like 15 seconds
&gt;&gt;&gt;&gt; and it shutsdown but in most cases it hangs forever. So this happens
&gt;&gt;&gt;&gt; randomly.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; So, this investigation has brought me to you guys so please help me. I
&gt;&gt;&gt;&gt; have attached a screen (sorry for polish error message but the translation
&gt;&gt;&gt;&gt; is in the email title).
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I have also posted a thread on AskUbuntu on this:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; https://askubuntu.com/questions/925696/ubuntu-16-04-libvirt-
&gt;&gt;&gt;&gt; guests-sh-6917-running-guests-under-uri-address-default
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Thank you,
&gt;&gt;&gt;&gt; Jędrzej
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; libvirt-users mailing list
&gt;&gt; libvirt-users@redhat.com
&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Dominik Psenner
&gt;



-- 
Dominik Psenner

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;$ uname -a&lt;/div&gt;&lt;div&gt;Linux mugen 4.4.0-83-generic #106-Ubuntu SMP \
Mon Jun 26 17:54:43 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux&lt;/div&gt;&lt;div&gt;&lt;div&gt;$ \
lsb_release -a&lt;/div&gt;&lt;div&gt;No LSB modules are available.&lt;/div&gt;&lt;div&gt;Distributor ID:&lt;span \
style="white-space:pre"&gt;	&lt;/span&gt;Ubuntu&lt;/div&gt;&lt;div&gt;Description:&lt;span \
style="white-space:pre"&gt;	&lt;/span&gt;Ubuntu 16.04.2 LTS&lt;/div&gt;&lt;div&gt;Release:&lt;span \
style="white-space:pre"&gt;	&lt;/span&gt;16.04&lt;/div&gt;&lt;div&gt;Codename:&lt;span \
style="white-space:pre"&gt;	&lt;/span&gt;xenial&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 9:18 GMT+02:00 Dominik \
Psenner &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;&lt;div&gt;Hey&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;FWIW, I have virsh running on my laptop too \
and no virtual machines registered to autostart but my laptop reboots just fine and \
shows no traces of any \
warnings.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;Dominik&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;&lt;div&gt;&lt;div class="h5"&gt;2017-07-06 \
22:53 GMT+02:00 Jędrek Domański &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div&gt;&lt;div class="h5"&gt;&lt;div dir="ltr"&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;Hello,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;Am I addressing \
this issue to the right address? Please respond.&lt;/div&gt;&lt;/div&gt;&lt;div \
class="m_6546004520477295182HOEnZb"&gt;&lt;div class="m_6546004520477295182h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-04 9:31 GMT+02:00 Jędrek \
Domański &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Hello? What is the status of this \
issue?&lt;/div&gt;&lt;/div&gt;&lt;div class="m_6546004520477295182m_8971097031154397227HOEnZb"&gt;&lt;div \
class="m_6546004520477295182m_8971097031154397227h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-06-30 22:24 GMT+02:00 Jędrek \
Domański &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div \
class="m_6546004520477295182m_8971097031154397227m_-5912502521504996974HOEnZb"&gt;&lt;div \
class="m_6546004520477295182m_8971097031154397227m_-5912502521504996974h5"&gt;&lt;div \
dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;Hi&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;I have recently upgraded from Ubuntu 15.04 to 16.04 and now \
everytime I shutdown my PC I get a black screen where it says "libvirt-guests.sh \
[6917] - running guests under URI address default: no running guests" and the PC \
just hangs forever and will not shutdown. I need to manually kill it in order to shut \
it down which is a pain in the ass. I have done some investigation and here is what \
I've found out so far.&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;I have uninstalled libvirt, kvm and qemu:&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;pre \
style="white-space:pre-wrap;margin-top:0px;margin-bottom:1em;padding:5px;border:0px;fo \
nt-variant-numeric:inherit;font-stretch:inherit;font-size:13px;line-height:inherit;font-family:Consolas,Menlo,Monaco,"Lucida \
Console","Liberation Mono","DejaVu Sans \
Mono","Bitstream Vera Sans Mono","Courier \
New",monospace,sans-serif;vertical-align:baseline;width:auto;max-height:600px;ove \
rflow:auto;background-color:rgb(239,240,241);word-wrap:normal;color:rgb(17,17,17)"&gt;&lt;code \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;line-height:inherit;font-family:Consolas,Menlo,Monaco,"Lucida \
Console","Liberation Mono","DejaVu Sans \
Mono","Bitstream Vera Sans Mono","Courier \
New",monospace,sans-serif;vertical-align:baseline;white-space:inherit"&gt;sudo \
apt-get purge libvirt* kvm qemu*&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;The problem has gone, however I noticed some error messages \
at boot saying something that "FAILED Qemu .... It flashes so quickly and I am \
not able to read what exactly it says. I installed libvirt again:&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;pre \
class="m_6546004520477295182m_8971097031154397227m_-5912502521504996974m_6636733946930978432gmail-m_-849249386569305750gmail-contents" \
style="white-space:pre-wrap;margin-top:0px;margin-bottom:8px;padding:0.5em \
1em;border:1px dashed \
rgb(193,180,150);font-size:13px;line-height:16px;font-family:UbuntuMono,courier,monosp \
ace;vertical-align:baseline;background-color:rgb(243,243,243);word-wrap:break-word;color:rgb(51,51,51)"&gt;&lt;span \
class="m_6546004520477295182m_8971097031154397227m_-5912502521504996974m_6636733946930978432gmail-m_-849249386569305750gmail-cmd \
m_6546004520477295182m_8971097031154397227m_-5912502521504996974m_6636733946930978432gmail-m_-849249386569305750gmail-command" \
style="margin:0px;padding:0px;border:0px;font-weight:inherit;font-style:inherit;line-h \
eight:1.5;font-family:monospace;vertical-align:baseline;background-color:rgb(242,242,242)"&gt;sudo \
apt install qemu-kvm libvirt-bin&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;and the problem is back!&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;So is this script trying to shutdown my virtual machines? It \
looks like it does but since it does not find any it hangs? I don't have any \
machines, though. I used to have one, but I removed it. What is interesting, my PC \
hangs at shutdown randomly, that is sometimes it hangs for like 15 seconds and it \
shutsdown but in most cases it hangs forever. So this happens randomly.&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;So, this investigation has brought me to you guys so please \
help me. I have attached a screen (sorry for polish error message but the translation \
is in the email title).&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;I have also posted a thread on AskUbuntu on this:&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;a href="https://askubuntu.com/questions/925696/ubuntu-16-04-libvirt-guests-sh-6917-runni" \
target="_blank"&gt;https://askubuntu.com/question&lt;wbr&gt;s/925696/ubuntu-16-04-libvirt-&lt;wbr&gt;guests-sh-6917-runni&lt;/a&gt;&lt;/font&gt;&lt;span \
style="font-family:arial,helvetica,sans-serif"&gt;ng-guests-&lt;wbr&gt;under-uri-address-default&lt;/span&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;span \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font \
face="arial, helvetica, sans-serif"&gt;Thank you,&lt;/font&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;Jędrzej&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;span \
class="HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;span \
class="HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- &lt;br&gt;&lt;div \
class="m_6546004520477295182gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div \
dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;/font&gt;&lt;/span&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- &lt;br&gt;&lt;div \
class="gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik \
Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;



</body></email><email><emailId>20170707072044</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-07-07 07:20:44-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

And software is up to date to latest version in LTS:

$ virsh --version
1.3.1


2017-07-07 9:20 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:

&gt; $ uname -a
&gt; Linux mugen 4.4.0-83-generic #106-Ubuntu SMP Mon Jun 26 17:54:43 UTC 2017
&gt; x86_64 x86_64 x86_64 GNU/Linux
&gt; $ lsb_release -a
&gt; No LSB modules are available.
&gt; Distributor ID: Ubuntu
&gt; Description: Ubuntu 16.04.2 LTS
&gt; Release: 16.04
&gt; Codename: xenial
&gt;
&gt; 2017-07-07 9:18 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;
&gt;&gt; Hey
&gt;&gt;
&gt;&gt; FWIW, I have virsh running on my laptop too and no virtual machines
&gt;&gt; registered to autostart but my laptop reboots just fine and shows no traces
&gt;&gt; of any warnings.
&gt;&gt;
&gt;&gt; Cheers,
&gt;&gt; Dominik
&gt;&gt;
&gt;&gt; 2017-07-06 22:53 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com&gt;:
&gt;&gt;
&gt;&gt;&gt; Hello,
&gt;&gt;&gt;
&gt;&gt;&gt; Am I addressing this issue to the right address? Please respond.
&gt;&gt;&gt;
&gt;&gt;&gt; 2017-07-04 9:31 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com&gt;:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hello? What is the status of this issue?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 2017-06-30 22:24 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com&gt;:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Hi
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I have recently upgraded from Ubuntu 15.04 to 16.04 and now everytime
&gt;&gt;&gt;&gt;&gt; I shutdown my PC I get a black screen where it says "libvirt-guests.sh
&gt;&gt;&gt;&gt;&gt; [6917] - running guests under URI address default: no running guests" and
&gt;&gt;&gt;&gt;&gt; the PC just hangs forever and will not shutdown. I need to manually kill it
&gt;&gt;&gt;&gt;&gt; in order to shut it down which is a pain in the ass. I have done some
&gt;&gt;&gt;&gt;&gt; investigation and here is what I've found out so far.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I have uninstalled libvirt, kvm and qemu:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; sudo apt-get purge libvirt* kvm qemu*
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; The problem has gone, however I noticed some error messages at boot
&gt;&gt;&gt;&gt;&gt; saying something that "FAILED Qemu .... It flashes so quickly and I am not
&gt;&gt;&gt;&gt;&gt; able to read what exactly it says. I installed libvirt again:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; sudo apt install qemu-kvm libvirt-bin
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; and the problem is back!
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; So is this script trying to shutdown my virtual machines? It looks
&gt;&gt;&gt;&gt;&gt; like it does but since it does not find any it hangs? I don't have any
&gt;&gt;&gt;&gt;&gt; machines, though. I used to have one, but I removed it. What is
&gt;&gt;&gt;&gt;&gt; interesting, my PC hangs at shutdown randomly, that is sometimes it hangs
&gt;&gt;&gt;&gt;&gt; for like 15 seconds and it shutsdown but in most cases it hangs forever. So
&gt;&gt;&gt;&gt;&gt; this happens randomly.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; So, this investigation has brought me to you guys so please help me. I
&gt;&gt;&gt;&gt;&gt; have attached a screen (sorry for polish error message but the translation
&gt;&gt;&gt;&gt;&gt; is in the email title).
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I have also posted a thread on AskUbuntu on this:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; https://askubuntu.com/questions/925696/ubuntu-16-04-libvirt-
&gt;&gt;&gt;&gt;&gt; guests-sh-6917-running-guests-under-uri-address-default
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Thank you,
&gt;&gt;&gt;&gt;&gt; Jędrzej
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt; libvirt-users mailing list
&gt;&gt;&gt; libvirt-users@redhat.com
&gt;&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Dominik Psenner
&gt;&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Dominik Psenner
&gt;



-- 
Dominik Psenner

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;And software is up to date to latest version in \
LTS:&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;$ virsh \
--version&lt;/div&gt;&lt;div&gt;1.3.1&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 9:20 GMT+02:00 Dominik \
Psenner &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;&lt;div&gt;$ uname -a&lt;/div&gt;&lt;div&gt;Linux mugen 4.4.0-83-generic #106-Ubuntu SMP Mon \
Jun 26 17:54:43 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux&lt;/div&gt;&lt;div&gt;&lt;div&gt;$ lsb_release \
-a&lt;/div&gt;&lt;div&gt;No LSB modules are available.&lt;/div&gt;&lt;div&gt;Distributor ID:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;Ubuntu&lt;/div&gt;&lt;div&gt;Description:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;Ubuntu 16.04.2 LTS&lt;/div&gt;&lt;div&gt;Release:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;16.04&lt;/div&gt;&lt;div&gt;Codename:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;xenial&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;div&gt;&lt;div class="h5"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 9:18 \
GMT+02:00 Dominik Psenner &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;&lt;div&gt;Hey&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;FWIW, I have virsh running on my laptop too \
and no virtual machines registered to autostart but my laptop reboots just fine and \
shows no traces of any \
warnings.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;Dominik&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;&lt;div&gt;&lt;div \
class="m_5550227016436092048h5"&gt;2017-07-06 22:53 GMT+02:00 Jędrek Domański &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div&gt;&lt;div class="m_5550227016436092048h5"&gt;&lt;div dir="ltr"&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;Hello,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;Am I addressing \
this issue to the right address? Please respond.&lt;/div&gt;&lt;/div&gt;&lt;div \
class="m_5550227016436092048m_6546004520477295182HOEnZb"&gt;&lt;div \
class="m_5550227016436092048m_6546004520477295182h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-04 9:31 GMT+02:00 Jędrek \
Domański &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Hello? What is the status of this \
issue?&lt;/div&gt;&lt;/div&gt;&lt;div \
class="m_5550227016436092048m_6546004520477295182m_8971097031154397227HOEnZb"&gt;&lt;div \
class="m_5550227016436092048m_6546004520477295182m_8971097031154397227h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-06-30 22:24 GMT+02:00 Jędrek \
Domański &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div \
class="m_5550227016436092048m_6546004520477295182m_8971097031154397227m_-5912502521504996974HOEnZb"&gt;&lt;div \
class="m_5550227016436092048m_6546004520477295182m_8971097031154397227m_-5912502521504996974h5"&gt;&lt;div \
dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;Hi&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;I have recently upgraded from Ubuntu 15.04 to 16.04 and now \
everytime I shutdown my PC I get a black screen where it says "libvirt-guests.sh \
[6917] - running guests under URI address default: no running guests" and the PC \
just hangs forever and will not shutdown. I need to manually kill it in order to shut \
it down which is a pain in the ass. I have done some investigation and here is what \
I've found out so far.&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;I have uninstalled libvirt, kvm and qemu:&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;pre \
style="white-space:pre-wrap;margin-top:0px;margin-bottom:1em;padding:5px;border:0px;fo \
nt-variant-numeric:inherit;font-stretch:inherit;font-size:13px;line-height:inherit;font-family:Consolas,Menlo,Monaco,"Lucida \
Console","Liberation Mono","DejaVu Sans \
Mono","Bitstream Vera Sans Mono","Courier \
New",monospace,sans-serif;vertical-align:baseline;width:auto;max-height:600px;ove \
rflow:auto;background-color:rgb(239,240,241);word-wrap:normal;color:rgb(17,17,17)"&gt;&lt;code \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;line-height:inherit;font-family:Consolas,Menlo,Monaco,"Lucida \
Console","Liberation Mono","DejaVu Sans \
Mono","Bitstream Vera Sans Mono","Courier \
New",monospace,sans-serif;vertical-align:baseline;white-space:inherit"&gt;sudo \
apt-get purge libvirt* kvm qemu*&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;The problem has gone, however I noticed some error messages \
at boot saying something that "FAILED Qemu .... It flashes so quickly and I am \
not able to read what exactly it says. I installed libvirt again:&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;pre \
class="m_5550227016436092048m_6546004520477295182m_8971097031154397227m_-5912502521504996974m_6636733946930978432gmail-m_-849249386569305750gmail-contents" \
style="white-space:pre-wrap;margin-top:0px;margin-bottom:8px;padding:0.5em \
1em;border:1px dashed \
rgb(193,180,150);font-size:13px;line-height:16px;font-family:UbuntuMono,courier,monosp \
ace;vertical-align:baseline;background-color:rgb(243,243,243);word-wrap:break-word;color:rgb(51,51,51)"&gt;&lt;span \
class="m_5550227016436092048m_6546004520477295182m_8971097031154397227m_-5912502521504996974m_6636733946930978432gmail-m_-849249386569305750gmail-cmd \
m_5550227016436092048m_6546004520477295182m_8971097031154397227m_-5912502521504996974m_6636733946930978432gmail-m_-849249386569305750gmail-command" \
style="margin:0px;padding:0px;border:0px;font-weight:inherit;font-style:inherit;line-h \
eight:1.5;font-family:monospace;vertical-align:baseline;background-color:rgb(242,242,242)"&gt;sudo \
apt install qemu-kvm libvirt-bin&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;and the problem is back!&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;So is this script trying to shutdown my virtual machines? It \
looks like it does but since it does not find any it hangs? I don't have any \
machines, though. I used to have one, but I removed it. What is interesting, my PC \
hangs at shutdown randomly, that is sometimes it hangs for like 15 seconds and it \
shutsdown but in most cases it hangs forever. So this happens randomly.&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;So, this investigation has brought me to you guys so please \
help me. I have attached a screen (sorry for polish error message but the translation \
is in the email title).&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;I have also posted a thread on AskUbuntu on this:&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;a href="https://askubuntu.com/questions/925696/ubuntu-16-04-libvirt-guests-sh-6917-runni" \
target="_blank"&gt;https://askubuntu.com/question&lt;wbr&gt;s/925696/ubuntu-16-04-libvirt-&lt;wbr&gt;guests-sh-6917-runni&lt;/a&gt;&lt;/font&gt;&lt;span \
style="font-family:arial,helvetica,sans-serif"&gt;ng-guests-&lt;wbr&gt;under-uri-address-default&lt;/span&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;span \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font \
face="arial, helvetica, sans-serif"&gt;Thank you,&lt;/font&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;Jędrzej&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;span \
class="m_5550227016436092048HOEnZb"&gt;&lt;font \
color="#888888"&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;span \
class="m_5550227016436092048HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;br&gt;&lt;br \
clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- &lt;br&gt;&lt;div \
class="m_5550227016436092048m_6546004520477295182gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br \
clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;-- \
&lt;br&gt;&lt;div class="m_5550227016436092048gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- \
&lt;br&gt;&lt;div class="gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div \
dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;



</body></email><email><emailId>20170707074635</emailId><senderName>Jędrek Domański</senderName><senderEmail>jedrek.domanski@gmail.com</senderEmail><timestampReceived>2017-07-07 07:46:35-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

Hi Dominik,

So what is going on on my computer with the script *libvirt-guests.sh*? Why
is it hanging on it? How should I address this problem?

I really appreciate your help!

Thank you!

2017-07-07 9:20 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:

&gt; And software is up to date to latest version in LTS:
&gt;
&gt; $ virsh --version
&gt; 1.3.1
&gt;
&gt;
&gt; 2017-07-07 9:20 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;
&gt;&gt; $ uname -a
&gt;&gt; Linux mugen 4.4.0-83-generic #106-Ubuntu SMP Mon Jun 26 17:54:43 UTC 201=
7
&gt;&gt; x86_64 x86_64 x86_64 GNU/Linux
&gt;&gt; $ lsb_release -a
&gt;&gt; No LSB modules are available.
&gt;&gt; Distributor ID: Ubuntu
&gt;&gt; Description: Ubuntu 16.04.2 LTS
&gt;&gt; Release: 16.04
&gt;&gt; Codename: xenial
&gt;&gt;
&gt;&gt; 2017-07-07 9:18 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;&gt;
&gt;&gt;&gt; Hey
&gt;&gt;&gt;
&gt;&gt;&gt; FWIW, I have virsh running on my laptop too and no virtual machines
&gt;&gt;&gt; registered to autostart but my laptop reboots just fine and shows no tr=
aces
&gt;&gt;&gt; of any warnings.
&gt;&gt;&gt;
&gt;&gt;&gt; Cheers,
&gt;&gt;&gt; Dominik
&gt;&gt;&gt;
&gt;&gt;&gt; 2017-07-06 22:53 GMT+02:00 J=C4=99drek Doma=C5=84ski &lt;jedrek.domanski@g=
mail.com&gt;:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hello,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Am I addressing this issue to the right address? Please respond.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 2017-07-04 9:31 GMT+02:00 J=C4=99drek Doma=C5=84ski &lt;jedrek.domanski@g=
mail.com&gt;:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Hello? What is the status of this issue?
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; 2017-06-30 22:24 GMT+02:00 J=C4=99drek Doma=C5=84ski &lt;jedrek.domanski=
@gmail.com&gt;
&gt;&gt;&gt;&gt;&gt; :
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Hi
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; I have recently upgraded from Ubuntu 15.04 to 16.04 and now everytim=
e
&gt;&gt;&gt;&gt;&gt;&gt; I shutdown my PC I get a black screen where it says "libvirt-guests.=
sh
&gt;&gt;&gt;&gt;&gt;&gt; [6917] - running guests under URI address default: no running guests=
" and
&gt;&gt;&gt;&gt;&gt;&gt; the PC just hangs forever and will not shutdown. I need to manually =
kill it
&gt;&gt;&gt;&gt;&gt;&gt; in order to shut it down which is a pain in the ass. I have done som=
e
&gt;&gt;&gt;&gt;&gt;&gt; investigation and here is what I've found out so far.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; I have uninstalled libvirt, kvm and qemu:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; sudo apt-get purge libvirt* kvm qemu*
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; The problem has gone, however I noticed some error messages at boot
&gt;&gt;&gt;&gt;&gt;&gt; saying something that "FAILED Qemu .... It flashes so quickly and I =
am not
&gt;&gt;&gt;&gt;&gt;&gt; able to read what exactly it says. I installed libvirt again:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; sudo apt install qemu-kvm libvirt-bin
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; and the problem is back!
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; So is this script trying to shutdown my virtual machines? It looks
&gt;&gt;&gt;&gt;&gt;&gt; like it does but since it does not find any it hangs? I don't have a=
ny
&gt;&gt;&gt;&gt;&gt;&gt; machines, though. I used to have one, but I removed it. What is
&gt;&gt;&gt;&gt;&gt;&gt; interesting, my PC hangs at shutdown randomly, that is sometimes it =
hangs
&gt;&gt;&gt;&gt;&gt;&gt; for like 15 seconds and it shutsdown but in most cases it hangs fore=
ver. So
&gt;&gt;&gt;&gt;&gt;&gt; this happens randomly.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; So, this investigation has brought me to you guys so please help me.
&gt;&gt;&gt;&gt;&gt;&gt; I have attached a screen (sorry for polish error message but the
&gt;&gt;&gt;&gt;&gt;&gt; translation is in the email title).
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; I have also posted a thread on AskUbuntu on this:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; https://askubuntu.com/questions/925696/ubuntu-16-04-libvirt-
&gt;&gt;&gt;&gt;&gt;&gt; guests-sh-6917-running-guests-under-uri-address-default
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Thank you,
&gt;&gt;&gt;&gt;&gt;&gt; J=C4=99drzej
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt;&gt; libvirt-users mailing list
&gt;&gt;&gt;&gt; libvirt-users@redhat.com
&gt;&gt;&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Dominik Psenner
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Dominik Psenner
&gt;&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Dominik Psenner
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Hi Dominik,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;So what is going \
on on my computer with the script &lt;b&gt;libvirt-guests.sh&lt;/b&gt;? Why is it hanging on it? \
How should I address this problem?&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;I really appreciate your \
help!&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Thank you!&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 9:20 GMT+02:00 Dominik \
Psenner &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;And software is up to date to latest version in \
LTS:&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;$ virsh \
--version&lt;/div&gt;&lt;div&gt;1.3.1&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;div&gt;&lt;div class="h5"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 9:20 \
GMT+02:00 Dominik Psenner &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;&lt;div&gt;$ uname -a&lt;/div&gt;&lt;div&gt;Linux mugen 4.4.0-83-generic #106-Ubuntu SMP Mon \
Jun 26 17:54:43 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux&lt;/div&gt;&lt;div&gt;&lt;div&gt;$ lsb_release \
-a&lt;/div&gt;&lt;div&gt;No LSB modules are available.&lt;/div&gt;&lt;div&gt;Distributor ID:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;Ubuntu&lt;/div&gt;&lt;div&gt;Description:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;Ubuntu 16.04.2 LTS&lt;/div&gt;&lt;div&gt;Release:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;16.04&lt;/div&gt;&lt;div&gt;Codename:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;xenial&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;div&gt;&lt;div class="m_-5931768430844750321h5"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-07 9:18 GMT+02:00 Dominik Psenner &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;&lt;div&gt;Hey&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;FWIW, I have virsh running on my laptop too \
and no virtual machines registered to autostart but my laptop reboots just fine and \
shows no traces of any \
warnings.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;Dominik&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;&lt;div&gt;&lt;div \
class="m_-5931768430844750321m_5550227016436092048h5"&gt;2017-07-06 22:53 GMT+02:00 \
Jędrek Domański &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div&gt;&lt;div \
class="m_-5931768430844750321m_5550227016436092048h5"&gt;&lt;div dir="ltr"&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;Hello,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;Am I addressing \
this issue to the right address? Please respond.&lt;/div&gt;&lt;/div&gt;&lt;div \
class="m_-5931768430844750321m_5550227016436092048m_6546004520477295182HOEnZb"&gt;&lt;div \
class="m_-5931768430844750321m_5550227016436092048m_6546004520477295182h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-04 9:31 GMT+02:00 Jędrek \
Domański &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Hello? What is the status of this \
issue?&lt;/div&gt;&lt;/div&gt;&lt;div \
class="m_-5931768430844750321m_5550227016436092048m_6546004520477295182m_8971097031154397227HOEnZb"&gt;&lt;div \
class="m_-5931768430844750321m_5550227016436092048m_6546004520477295182m_8971097031154397227h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-06-30 22:24 GMT+02:00 Jędrek \
Domański &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div \
class="m_-5931768430844750321m_5550227016436092048m_6546004520477295182m_8971097031154397227m_-5912502521504996974HOEnZb"&gt;&lt;div \
class="m_-5931768430844750321m_5550227016436092048m_6546004520477295182m_8971097031154397227m_-5912502521504996974h5"&gt;&lt;div \
dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;Hi&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;I have recently upgraded from Ubuntu 15.04 to 16.04 and now \
everytime I shutdown my PC I get a black screen where it says "libvirt-guests.sh \
[6917] - running guests under URI address default: no running guests" and the PC \
just hangs forever and will not shutdown. I need to manually kill it in order to shut \
it down which is a pain in the ass. I have done some investigation and here is what \
I've found out so far.&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;I have uninstalled libvirt, kvm and qemu:&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;pre \
style="white-space:pre-wrap;margin-top:0px;margin-bottom:1em;padding:5px;border:0px;fo \
nt-variant-numeric:inherit;font-stretch:inherit;font-size:13px;line-height:inherit;font-family:Consolas,Menlo,Monaco,"Lucida \
Console","Liberation Mono","DejaVu Sans \
Mono","Bitstream Vera Sans Mono","Courier \
New",monospace,sans-serif;vertical-align:baseline;width:auto;max-height:600px;ove \
rflow:auto;background-color:rgb(239,240,241);word-wrap:normal;color:rgb(17,17,17)"&gt;&lt;code \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;line-height:inherit;font-family:Consolas,Menlo,Monaco,"Lucida \
Console","Liberation Mono","DejaVu Sans \
Mono","Bitstream Vera Sans Mono","Courier \
New",monospace,sans-serif;vertical-align:baseline;white-space:inherit"&gt;sudo \
apt-get purge libvirt* kvm qemu*&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;The problem has gone, however I noticed some error messages \
at boot saying something that "FAILED Qemu .... It flashes so quickly and I am \
not able to read what exactly it says. I installed libvirt again:&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;pre \
class="m_-5931768430844750321m_5550227016436092048m_6546004520477295182m_8971097031154 \
397227m_-5912502521504996974m_6636733946930978432gmail-m_-849249386569305750gmail-contents" \
style="white-space:pre-wrap;margin-top:0px;margin-bottom:8px;padding:0.5em \
1em;border:1px dashed \
rgb(193,180,150);font-size:13px;line-height:16px;font-family:UbuntuMono,courier,monosp \
ace;vertical-align:baseline;background-color:rgb(243,243,243);word-wrap:break-word;color:rgb(51,51,51)"&gt;&lt;span \
class="m_-5931768430844750321m_5550227016436092048m_6546004520477295182m_8971097031154 \
397227m_-5912502521504996974m_6636733946930978432gmail-m_-849249386569305750gmail-cmd \
m_-5931768430844750321m_5550227016436092048m_6546004520477295182m_8971097031154397227m \
_-5912502521504996974m_6636733946930978432gmail-m_-849249386569305750gmail-command" \
style="margin:0px;padding:0px;border:0px;font-weight:inherit;font-style:inherit;line-h \
eight:1.5;font-family:monospace;vertical-align:baseline;background-color:rgb(242,242,242)"&gt;sudo \
apt install qemu-kvm libvirt-bin&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;and the problem is back!&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;So is this script trying to shutdown my virtual machines? It \
looks like it does but since it does not find any it hangs? I don't have any \
machines, though. I used to have one, but I removed it. What is interesting, my PC \
hangs at shutdown randomly, that is sometimes it hangs for like 15 seconds and it \
shutsdown but in most cases it hangs forever. So this happens randomly.&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;So, this investigation has brought me to you guys so please \
help me. I have attached a screen (sorry for polish error message but the translation \
is in the email title).&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;I have also posted a thread on AskUbuntu on this:&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;a href="https://askubuntu.com/questions/925696/ubuntu-16-04-libvirt-guests-sh-6917-runni" \
target="_blank"&gt;https://askubuntu.com/question&lt;wbr&gt;s/925696/ubuntu-16-04-libvirt-&lt;wbr&gt;guests-sh-6917-runni&lt;/a&gt;&lt;/font&gt;&lt;span \
style="font-family:arial,helvetica,sans-serif"&gt;ng-guests-&lt;wbr&gt;under-uri-address-default&lt;/span&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;span \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font \
face="arial, helvetica, sans-serif"&gt;Thank you,&lt;/font&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;Jędrzej&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;span \
class="m_-5931768430844750321m_5550227016436092048HOEnZb"&gt;&lt;font \
color="#888888"&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;span \
class="m_-5931768430844750321m_5550227016436092048HOEnZb"&gt;&lt;font \
color="#888888"&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- &lt;br&gt;&lt;div \
class="m_-5931768430844750321m_5550227016436092048m_6546004520477295182gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br \
clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span \
class="m_-5931768430844750321HOEnZb"&gt;&lt;font color="#888888"&gt;-- &lt;br&gt;&lt;div \
class="m_-5931768430844750321m_5550227016436092048gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br \
clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;-- \
&lt;br&gt;&lt;div class="m_-5931768430844750321gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170707093732</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-07-07 09:37:32-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

I truly have no idea. You could try to reinstall virsh and all its
components (qemu, kvm, ..) with:

$ apt purge [...]

and then reinstall virsh and see if the issue persists.

Or, a more drastic step would be to start with a fresh new ubuntu
installation on your computer and see if the issue just goes away? Of
course this will require you to backup your data and restore it later.. not
a nice task to do but sometimes it is necessary.

Just yesterday I discovered that an application installed mongodb as a
dependency but when I removed the application it decided to keep back
gigabytes of database files.. I managed to remove those files but I don't
trust the installation anymore and am going to do a clean reinstallation of
the entire operating system. Who knows what's being left behind while
trying out different things. Always setting up virtual machines when trying
something out is a lot of work, but advisable good practice because it
allows one to throw away all modifications made.

I'm afraid that's all I can come with.

Good luck!

2017-07-07 9:46 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com&gt;:

&gt; Hi Dominik,
&gt;
&gt; So what is going on on my computer with the script *libvirt-guests.sh*?
&gt; Why is it hanging on it? How should I address this problem?
&gt;
&gt; I really appreciate your help!
&gt;
&gt; Thank you!
&gt;
&gt; 2017-07-07 9:20 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;
&gt;&gt; And software is up to date to latest version in LTS:
&gt;&gt;
&gt;&gt; $ virsh --version
&gt;&gt; 1.3.1
&gt;&gt;
&gt;&gt;
&gt;&gt; 2017-07-07 9:20 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;&gt;
&gt;&gt;&gt; $ uname -a
&gt;&gt;&gt; Linux mugen 4.4.0-83-generic #106-Ubuntu SMP Mon Jun 26 17:54:43 UTC
&gt;&gt;&gt; 2017 x86_64 x86_64 x86_64 GNU/Linux
&gt;&gt;&gt; $ lsb_release -a
&gt;&gt;&gt; No LSB modules are available.
&gt;&gt;&gt; Distributor ID: Ubuntu
&gt;&gt;&gt; Description: Ubuntu 16.04.2 LTS
&gt;&gt;&gt; Release: 16.04
&gt;&gt;&gt; Codename: xenial
&gt;&gt;&gt;
&gt;&gt;&gt; 2017-07-07 9:18 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hey
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; FWIW, I have virsh running on my laptop too and no virtual machines
&gt;&gt;&gt;&gt; registered to autostart but my laptop reboots just fine and shows no traces
&gt;&gt;&gt;&gt; of any warnings.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Cheers,
&gt;&gt;&gt;&gt; Dominik
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 2017-07-06 22:53 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com&gt;:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Hello,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Am I addressing this issue to the right address? Please respond.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; 2017-07-04 9:31 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com&gt;:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Hello? What is the status of this issue?
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; 2017-06-30 22:24 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com
&gt;&gt;&gt;&gt;&gt;&gt; &gt;:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Hi
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; I have recently upgraded from Ubuntu 15.04 to 16.04 and now
&gt;&gt;&gt;&gt;&gt;&gt;&gt; everytime I shutdown my PC I get a black screen where it says
&gt;&gt;&gt;&gt;&gt;&gt;&gt; "libvirt-guests.sh [6917] - running guests under URI address default: no
&gt;&gt;&gt;&gt;&gt;&gt;&gt; running guests" and the PC just hangs forever and will not shutdown. I need
&gt;&gt;&gt;&gt;&gt;&gt;&gt; to manually kill it in order to shut it down which is a pain in the ass. I
&gt;&gt;&gt;&gt;&gt;&gt;&gt; have done some investigation and here is what I've found out so far.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; I have uninstalled libvirt, kvm and qemu:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; sudo apt-get purge libvirt* kvm qemu*
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; The problem has gone, however I noticed some error messages at boot
&gt;&gt;&gt;&gt;&gt;&gt;&gt; saying something that "FAILED Qemu .... It flashes so quickly and I am not
&gt;&gt;&gt;&gt;&gt;&gt;&gt; able to read what exactly it says. I installed libvirt again:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; sudo apt install qemu-kvm libvirt-bin
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; and the problem is back!
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; So is this script trying to shutdown my virtual machines? It looks
&gt;&gt;&gt;&gt;&gt;&gt;&gt; like it does but since it does not find any it hangs? I don't have any
&gt;&gt;&gt;&gt;&gt;&gt;&gt; machines, though. I used to have one, but I removed it. What is
&gt;&gt;&gt;&gt;&gt;&gt;&gt; interesting, my PC hangs at shutdown randomly, that is sometimes it hangs
&gt;&gt;&gt;&gt;&gt;&gt;&gt; for like 15 seconds and it shutsdown but in most cases it hangs forever. So
&gt;&gt;&gt;&gt;&gt;&gt;&gt; this happens randomly.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; So, this investigation has brought me to you guys so please help me.
&gt;&gt;&gt;&gt;&gt;&gt;&gt; I have attached a screen (sorry for polish error message but the
&gt;&gt;&gt;&gt;&gt;&gt;&gt; translation is in the email title).
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; I have also posted a thread on AskUbuntu on this:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; https://askubuntu.com/questions/925696/ubuntu-16-04-libvirt-
&gt;&gt;&gt;&gt;&gt;&gt;&gt; guests-sh-6917-running-guests-under-uri-address-default
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Thank you,
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Jędrzej
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt;&gt;&gt; libvirt-users mailing list
&gt;&gt;&gt;&gt;&gt; libvirt-users@redhat.com
&gt;&gt;&gt;&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt; Dominik Psenner
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Dominik Psenner
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Dominik Psenner
&gt;&gt;
&gt;
&gt;


-- 
Dominik Psenner

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;I truly have no idea. You could try to reinstall virsh and all \
its components (qemu, kvm, ..) with:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;$ apt purge \
[...]&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;and then reinstall virsh and see if the issue \
persists.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Or, a more drastic step would be to start with a \
fresh new ubuntu installation on your computer and see if the issue just goes away? \
Of course this will require you to backup your data and restore it later.. not a nice \
task to do but sometimes it is necessary.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Just yesterday I \
discovered that an application installed mongodb as a dependency but when I removed \
the application it decided to keep back gigabytes of database files.. I managed to \
remove those files but I don't trust the installation anymore and am going to do \
a clean reinstallation of the entire operating system. Who knows what's being \
left behind while trying out different things. Always setting up virtual machines \
when trying something out is a lot of work, but advisable good practice because it \
allows one to throw away all modifications made.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I'm \
afraid that's all I can come with.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Good luck!&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 9:46 GMT+02:00 Jędrek \
Domański &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;Hi Dominik,&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;So what is going on on my computer \
with the script &lt;b&gt;libvirt-guests.sh&lt;/b&gt;? Why is it hanging on it? How should I \
address this problem?&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;I really appreciate your \
help!&lt;/div&gt;&lt;div style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;Thank you!&lt;/div&gt;&lt;/div&gt;&lt;div \
class="HOEnZb"&gt;&lt;div class="h5"&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-07 9:20 GMT+02:00 Dominik Psenner &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;And software is up to date to latest version in \
LTS:&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;$ virsh \
--version&lt;/div&gt;&lt;div&gt;1.3.1&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;div&gt;&lt;div class="m_-1708201457002821905h5"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-07 9:20 GMT+02:00 Dominik Psenner &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;&lt;div&gt;$ uname -a&lt;/div&gt;&lt;div&gt;Linux mugen 4.4.0-83-generic #106-Ubuntu SMP Mon \
Jun 26 17:54:43 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux&lt;/div&gt;&lt;div&gt;&lt;div&gt;$ lsb_release \
-a&lt;/div&gt;&lt;div&gt;No LSB modules are available.&lt;/div&gt;&lt;div&gt;Distributor ID:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;Ubuntu&lt;/div&gt;&lt;div&gt;Description:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;Ubuntu 16.04.2 LTS&lt;/div&gt;&lt;div&gt;Release:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;16.04&lt;/div&gt;&lt;div&gt;Codename:&lt;span \
style="white-space:pre-wrap"&gt;	&lt;/span&gt;xenial&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;div&gt;&lt;div \
class="m_-1708201457002821905m_-5931768430844750321h5"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-07 9:18 GMT+02:00 Dominik Psenner &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;&lt;div&gt;Hey&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;FWIW, I have virsh running on my laptop too \
and no virtual machines registered to autostart but my laptop reboots just fine and \
shows no traces of any \
warnings.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;Dominik&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;&lt;div&gt;&lt;div \
class="m_-1708201457002821905m_-5931768430844750321m_5550227016436092048h5"&gt;2017-07-06 \
22:53 GMT+02:00 Jędrek Domański &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div&gt;&lt;div \
class="m_-1708201457002821905m_-5931768430844750321m_5550227016436092048h5"&gt;&lt;div \
dir="ltr"&gt;&lt;div style="font-family:arial,helvetica,sans-serif"&gt;Hello,&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;Am I addressing this issue to the \
right address? Please respond.&lt;/div&gt;&lt;/div&gt;&lt;div \
class="m_-1708201457002821905m_-5931768430844750321m_5550227016436092048m_6546004520477295182HOEnZb"&gt;&lt;div \
class="m_-1708201457002821905m_-5931768430844750321m_5550227016436092048m_6546004520477295182h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-04 9:31 GMT+02:00 Jędrek \
Domański &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;Hello? What is the status of this \
issue?&lt;/div&gt;&lt;/div&gt;&lt;div \
class="m_-1708201457002821905m_-5931768430844750321m_5550227016436092048m_6546004520477295182m_8971097031154397227HOEnZb"&gt;&lt;div \
class="m_-1708201457002821905m_-5931768430844750321m_5550227016436092048m_6546004520477295182m_8971097031154397227h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-06-30 22:24 GMT+02:00 Jędrek \
Domański &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div \
class="m_-1708201457002821905m_-5931768430844750321m_5550227016436092048m_6546004520477295182m_8971097031154397227m_-5912502521504996974HOEnZb"&gt;&lt;div \
class="m_-1708201457002821905m_-5931768430844750321m_5550227016436092048m_6546004520477295182m_8971097031154397227m_-5912502521504996974h5"&gt;&lt;div \
dir="ltr"&gt;&lt;div style="font-family:arial,helvetica,sans-serif"&gt;&lt;div \
style="font-size:12.8px"&gt;Hi&lt;/div&gt;&lt;div style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-size:12.8px"&gt;I have recently upgraded from Ubuntu 15.04 to 16.04 and now \
everytime I shutdown my PC I get a black screen where it says "libvirt-guests.sh \
[6917] - running guests under URI address default: no running guests" and the PC \
just hangs forever and will not shutdown. I need to manually kill it in order to shut \
it down which is a pain in the ass. I have done some investigation and here is what \
I've found out so far.&lt;/div&gt;&lt;div style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-size:12.8px"&gt;I have uninstalled libvirt, kvm and qemu:&lt;/div&gt;&lt;div \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div style="font-size:12.8px"&gt;&lt;pre \
style="white-space:pre-wrap;margin-top:0px;margin-bottom:1em;padding:5px;border:0px;fo \
nt-variant-numeric:inherit;font-stretch:inherit;font-size:13px;line-height:inherit;font-family:Consolas,Menlo,Monaco,"Lucida \
Console","Liberation Mono","DejaVu Sans \
Mono","Bitstream Vera Sans Mono","Courier \
New",monospace,sans-serif;vertical-align:baseline;width:auto;max-height:600px;ove \
rflow:auto;background-color:rgb(239,240,241);word-wrap:normal;color:rgb(17,17,17)"&gt;&lt;code \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;line-height:inherit;font-family:Consolas,Menlo,Monaco,"Lucida \
Console","Liberation Mono","DejaVu Sans \
Mono","Bitstream Vera Sans Mono","Courier \
New",monospace,sans-serif;vertical-align:baseline;white-space:inherit"&gt;sudo \
apt-get purge libvirt* kvm qemu*&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div style="font-size:12.8px"&gt;The \
problem has gone, however I noticed some error messages at boot saying something that \
"FAILED Qemu .... It flashes so quickly and I am not able to read what exactly \
it says. I installed libvirt again:&lt;/div&gt;&lt;div style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-size:12.8px"&gt;&lt;pre \
class="m_-1708201457002821905m_-5931768430844750321m_5550227016436092048m_654600452047 \
7295182m_8971097031154397227m_-5912502521504996974m_6636733946930978432gmail-m_-849249386569305750gmail-contents" \
style="white-space:pre-wrap;margin-top:0px;margin-bottom:8px;padding:0.5em \
1em;border:1px dashed \
rgb(193,180,150);font-size:13px;line-height:16px;font-family:UbuntuMono,courier,monosp \
ace;vertical-align:baseline;background-color:rgb(243,243,243);word-wrap:break-word;color:rgb(51,51,51)"&gt;&lt;span \
class="m_-1708201457002821905m_-5931768430844750321m_5550227016436092048m_654600452047 \
7295182m_8971097031154397227m_-5912502521504996974m_6636733946930978432gmail-m_-849249386569305750gmail-cmd \
m_-1708201457002821905m_-5931768430844750321m_5550227016436092048m_6546004520477295182 \
m_8971097031154397227m_-5912502521504996974m_6636733946930978432gmail-m_-849249386569305750gmail-command" \
style="margin:0px;padding:0px;border:0px;font-weight:inherit;font-style:inherit;line-h \
eight:1.5;font-family:monospace;vertical-align:baseline;background-color:rgb(242,242,242)"&gt;sudo \
apt install qemu-kvm libvirt-bin&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div style="font-size:12.8px"&gt;and \
the problem is back!&lt;/div&gt;&lt;div style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-size:12.8px"&gt;So is this script trying to shutdown my virtual machines? It \
looks like it does but since it does not find any it hangs? I don't have any \
machines, though. I used to have one, but I removed it. What is interesting, my PC \
hangs at shutdown randomly, that is sometimes it hangs for like 15 seconds and it \
shutsdown but in most cases it hangs forever. So this happens randomly.&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div style="font-size:12.8px"&gt;So, this \
investigation has brought me to you guys so please help me. I have attached a screen \
(sorry for polish error message but the translation is in the email title).&lt;/div&gt;&lt;div \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div style="font-size:12.8px"&gt;I have also posted a \
thread on AskUbuntu on this:&lt;/div&gt;&lt;div style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;a href="https://askubuntu.com/questions/925696/ubuntu-16-04-libvirt-guests-sh-6917-runni" \
target="_blank"&gt;https://askubuntu.com/question&lt;wbr&gt;s/925696/ubuntu-16-04-libvirt-&lt;wbr&gt;guests-sh-6917-runni&lt;/a&gt;&lt;/font&gt;&lt;span \
style="font-family:arial,helvetica,sans-serif"&gt;ng-guests-&lt;wbr&gt;under-uri-address-default&lt;/span&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;span \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;Thank you,&lt;/font&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;Jędrzej&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;span \
class="m_-1708201457002821905m_-5931768430844750321m_5550227016436092048HOEnZb"&gt;&lt;font \
color="#888888"&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;span \
class="m_-1708201457002821905m_-5931768430844750321m_5550227016436092048HOEnZb"&gt;&lt;font \
color="#888888"&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- &lt;br&gt;&lt;div \
class="m_-1708201457002821905m_-5931768430844750321m_5550227016436092048m_6546004520477295182gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br \
clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span \
class="m_-1708201457002821905m_-5931768430844750321HOEnZb"&gt;&lt;font color="#888888"&gt;-- \
&lt;br&gt;&lt;div class="m_-1708201457002821905m_-5931768430844750321m_5550227016436092048gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br \
clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span \
class="m_-1708201457002821905HOEnZb"&gt;&lt;font color="#888888"&gt;-- &lt;br&gt;&lt;div \
class="m_-1708201457002821905m_-5931768430844750321gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- &lt;br&gt;&lt;div \
class="gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik \
Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170707101436</emailId><senderName>Andrea Bolognani</senderName><senderEmail>abologna@redhat.com</senderEmail><timestampReceived>2017-07-07 10:14:36-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

On Fri, 2017-07-07 at 09:46 +0200, Jędrek Domański wrote:
&gt; Hi Dominik,
&gt; 
&gt; So what is going on on my computer with the script libvirt-guests.sh?
&gt; Why is it hanging on it? How should I address this problem?

Not sure what the root cause of your problem is, but you
can use

  # systemctl disable libvirt-guests

to verify if the script is really what causes shutdown
to hang. It might very well be that it's merely the last
thing producing output before the actual issue occurs.

-- 
Andrea Bolognani / Red Hat / Virtualization

</body></email><email><emailId>20170707142040</emailId><senderName>Jędrek Domański</senderName><senderEmail>jedrek.domanski@gmail.com</senderEmail><timestampReceived>2017-07-07 14:20:40-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

Andrea,

You are a genius!!! :D It's worked :)) Thank yo so much!!! XD

2017-07-07 12:14 GMT+02:00 Andrea Bolognani &lt;abologna@redhat.com&gt;:

&gt; On Fri, 2017-07-07 at 09:46 +0200, J=C4=99drek Doma=C5=84ski wrote:
&gt; &gt; Hi Dominik,
&gt; &gt;
&gt; &gt; So what is going on on my computer with the script libvirt-guests.sh?
&gt; &gt; Why is it hanging on it? How should I address this problem?
&gt;
&gt; Not sure what the root cause of your problem is, but you
&gt; can use
&gt;
&gt;   # systemctl disable libvirt-guests
&gt;
&gt; to verify if the script is really what causes shutdown
&gt; to hang. It might very well be that it's merely the last
&gt; thing producing output before the actual issue occurs.
&gt;
&gt; --
&gt; Andrea Bolognani / Red Hat / Virtualization
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Andrea,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;You are a \
genius!!! :D It's worked :)) Thank yo so much!!! XD&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 12:14 GMT+02:00 Andrea \
Bolognani &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:abologna@redhat.com" \
target="_blank"&gt;abologna@redhat.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span class=""&gt;On Fri, 2017-07-07 at 09:46 +0200, Jędrek \
Domański wrote:&lt;br&gt; &gt; Hi Dominik,&lt;br&gt;
&gt;  &lt;br&gt;
&gt; So what is going on on my computer with the script libvirt-guests.sh?&lt;br&gt;
&gt; Why is it hanging on it? How should I address this problem?&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;Not sure what the root cause of your problem is, but you&lt;br&gt;
can use&lt;br&gt;
&lt;br&gt;
   # systemctl disable libvirt-guests&lt;br&gt;
&lt;br&gt;
to verify if the script is really what causes shutdown&lt;br&gt;
to hang. It might very well be that it's merely the last&lt;br&gt;
thing producing output before the actual issue occurs.&lt;br&gt;
&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;br&gt;
--  &lt;br&gt;
Andrea Bolognani / Red Hat / Virtualization&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170707171351</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-07-07 17:13:51-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

Note that this disables the shutdown of libvirt guests when the host shuts
down.

2017-07-07 16:20 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com&gt;:

&gt; Andrea,
&gt;
&gt; You are a genius!!! :D It's worked :)) Thank yo so much!!! XD
&gt;
&gt; 2017-07-07 12:14 GMT+02:00 Andrea Bolognani &lt;abologna@redhat.com&gt;:
&gt;
&gt;&gt; On Fri, 2017-07-07 at 09:46 +0200, Jędrek Domański wrote:
&gt;&gt; &gt; Hi Dominik,
&gt;&gt; &gt;
&gt;&gt; &gt; So what is going on on my computer with the script libvirt-guests.sh?
&gt;&gt; &gt; Why is it hanging on it? How should I address this problem?
&gt;&gt;
&gt;&gt; Not sure what the root cause of your problem is, but you
&gt;&gt; can use
&gt;&gt;
&gt;&gt;   # systemctl disable libvirt-guests
&gt;&gt;
&gt;&gt; to verify if the script is really what causes shutdown
&gt;&gt; to hang. It might very well be that it's merely the last
&gt;&gt; thing producing output before the actual issue occurs.
&gt;&gt;
&gt;&gt; --
&gt;&gt; Andrea Bolognani / Red Hat / Virtualization
&gt;&gt;
&gt;
&gt;


-- 
Dominik Psenner

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Note that this disables the shutdown of libvirt guests when the host \
shuts down.&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 \
16:20 GMT+02:00 Jędrek Domański &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Andrea,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;You are a \
genius!!! :D It's worked :)) Thank yo so much!!! XD&lt;/div&gt;&lt;/div&gt;&lt;div \
class="HOEnZb"&gt;&lt;div class="h5"&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-07 12:14 GMT+02:00 Andrea Bolognani &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:abologna@redhat.com" \
target="_blank"&gt;abologna@redhat.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span&gt;On Fri, 2017-07-07 at 09:46 +0200, Jędrek Domański \
wrote:&lt;br&gt; &gt; Hi Dominik,&lt;br&gt;
&gt;  &lt;br&gt;
&gt; So what is going on on my computer with the script libvirt-guests.sh?&lt;br&gt;
&gt; Why is it hanging on it? How should I address this problem?&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;Not sure what the root cause of your problem is, but you&lt;br&gt;
can use&lt;br&gt;
&lt;br&gt;
   # systemctl disable libvirt-guests&lt;br&gt;
&lt;br&gt;
to verify if the script is really what causes shutdown&lt;br&gt;
to hang. It might very well be that it's merely the last&lt;br&gt;
thing producing output before the actual issue occurs.&lt;br&gt;
&lt;span class="m_-5003496856355289139HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;br&gt;
--  &lt;br&gt;
Andrea Bolognani / Red Hat / Virtualization&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- &lt;br&gt;&lt;div \
class="gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik \
Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;



</body></email><email><emailId>20170707212339</emailId><senderName>Jędrek Domański</senderName><senderEmail>jedrek.domanski@gmail.com</senderEmail><timestampReceived>2017-07-07 21:23:39-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

Dominik,

As far as I am concerned the command provided by Andrea disables
libvirt-guests service at boot.

jedrek@Home:~$ service libvirt-guests status
=E2=97=8F libvirt-guests.service - Suspend Active Libvirt Guests
   Loaded: loaded (/lib/systemd/system/libvirt-guests.service; *disabled*;
vendor preset: enabled)
   Active: inactive (dead)
     Docs: man:libvirtd(8)
           http://libvirt.org

When you enable/disable a service *sysctemctl *creates a symlink of a
service into the location on disk where systemd looks for autostart files
(usually /etc/systemd/system/some_target.target.wants

jedrek@Home:~$ ls /etc/systemd/system/ | grep libvirt*
libvirtd.service

No libvirt-guests.service

I know this is just a workaround but what's wrong with this?



2017-07-07 19:13 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:

&gt; Note that this disables the shutdown of libvirt guests when the host shut=
s
&gt; down.
&gt;
&gt; 2017-07-07 16:20 GMT+02:00 J=C4=99drek Doma=C5=84ski &lt;jedrek.domanski@gma=
il.com&gt;:
&gt;
&gt;&gt; Andrea,
&gt;&gt;
&gt;&gt; You are a genius!!! :D It's worked :)) Thank yo so much!!! XD
&gt;&gt;
&gt;&gt; 2017-07-07 12:14 GMT+02:00 Andrea Bolognani &lt;abologna@redhat.com&gt;:
&gt;&gt;
&gt;&gt;&gt; On Fri, 2017-07-07 at 09:46 +0200, J=C4=99drek Doma=C5=84ski wrote:
&gt;&gt;&gt; &gt; Hi Dominik,
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; So what is going on on my computer with the script libvirt-guests.sh?
&gt;&gt;&gt; &gt; Why is it hanging on it? How should I address this problem?
&gt;&gt;&gt;
&gt;&gt;&gt; Not sure what the root cause of your problem is, but you
&gt;&gt;&gt; can use
&gt;&gt;&gt;
&gt;&gt;&gt;   # systemctl disable libvirt-guests
&gt;&gt;&gt;
&gt;&gt;&gt; to verify if the script is really what causes shutdown
&gt;&gt;&gt; to hang. It might very well be that it's merely the last
&gt;&gt;&gt; thing producing output before the actual issue occurs.
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Andrea Bolognani / Red Hat / Virtualization
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Dominik Psenner
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Dominik,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;As far as I am \
concerned the command provided by Andrea disables libvirt-guests service at \
boot.&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;jedrek@Home:~$ service libvirt-guests \
status&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;● libvirt-guests.service - Suspend \
Active Libvirt Guests&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;     Loaded: loaded \
(/lib/systemd/system/libvirt-guests.service; &lt;b&gt;disabled&lt;/b&gt;; vendor preset: \
enabled)&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;     Active: inactive (dead)&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;        Docs: \
man:libvirtd(8)&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;                 &lt;a \
href="http://libvirt.org"&gt;http://libvirt.org&lt;/a&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;When you enable/disable a service \
&lt;b&gt;sysctemctl &lt;/b&gt;creates a symlink of a service into the location on disk where \
systemd looks for autostart files (usually \
/etc/systemd/system/some_target.target.wants&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font face="arial, \
helvetica, sans-serif"&gt;jedrek@Home:~$ ls /etc/systemd/system/ | grep \
libvirt*&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;libvirtd.service&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;No libvirt-guests.service&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;I know this is just a workaround but \
what's wrong with this?&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 19:13 GMT+02:00 Dominik \
Psenner &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;Note that this disables the shutdown of libvirt guests when the host shuts \
down.&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;div&gt;&lt;div class="h5"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-07 16:20 GMT+02:00 Jędrek Domański &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Andrea,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;You are a \
genius!!! :D It's worked :)) Thank yo so much!!! XD&lt;/div&gt;&lt;/div&gt;&lt;div \
class="m_4220321199909326956HOEnZb"&gt;&lt;div class="m_4220321199909326956h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 12:14 GMT+02:00 Andrea \
Bolognani &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:abologna@redhat.com" \
target="_blank"&gt;abologna@redhat.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span&gt;On Fri, 2017-07-07 at 09:46 +0200, Jędrek Domański \
wrote:&lt;br&gt; &gt; Hi Dominik,&lt;br&gt;
&gt;  &lt;br&gt;
&gt; So what is going on on my computer with the script libvirt-guests.sh?&lt;br&gt;
&gt; Why is it hanging on it? How should I address this problem?&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;Not sure what the root cause of your problem is, but you&lt;br&gt;
can use&lt;br&gt;
&lt;br&gt;
   # systemctl disable libvirt-guests&lt;br&gt;
&lt;br&gt;
to verify if the script is really what causes shutdown&lt;br&gt;
to hang. It might very well be that it's merely the last&lt;br&gt;
thing producing output before the actual issue occurs.&lt;br&gt;
&lt;span class="m_4220321199909326956m_-5003496856355289139HOEnZb"&gt;&lt;font \
                color="#888888"&gt;&lt;br&gt;
--  &lt;br&gt;
Andrea Bolognani / Red Hat / Virtualization&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span \
class="HOEnZb"&gt;&lt;font color="#888888"&gt;-- &lt;br&gt;&lt;div \
class="m_4220321199909326956gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div \
dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;/font&gt;&lt;/span&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170708163431</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-07-08 16:34:31-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

I just wanted to point out that you're only resolving the symptom, not the
actual cause. At the same time I'm afraid that I don't know what the cause
of your problems is. If you don't want to run virsh guests you probably
won't need the service, but then what's the point of having libvirt-bin
installed in the first place? :-)

Cheers

2017-07-07 23:23 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com&gt;:

&gt; Dominik,
&gt;
&gt; As far as I am concerned the command provided by Andrea disables
&gt; libvirt-guests service at boot.
&gt;
&gt; jedrek@Home:~$ service libvirt-guests status
&gt; ● libvirt-guests.service - Suspend Active Libvirt Guests
&gt;    Loaded: loaded (/lib/systemd/system/libvirt-guests.service; *disabled*;
&gt; vendor preset: enabled)
&gt;    Active: inactive (dead)
&gt;      Docs: man:libvirtd(8)
&gt;            http://libvirt.org
&gt;
&gt; When you enable/disable a service *sysctemctl *creates a symlink of a
&gt; service into the location on disk where systemd looks for autostart files
&gt; (usually /etc/systemd/system/some_target.target.wants
&gt;
&gt; jedrek@Home:~$ ls /etc/systemd/system/ | grep libvirt*
&gt; libvirtd.service
&gt;
&gt; No libvirt-guests.service
&gt;
&gt; I know this is just a workaround but what's wrong with this?
&gt;
&gt;
&gt;
&gt; 2017-07-07 19:13 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;
&gt;&gt; Note that this disables the shutdown of libvirt guests when the host
&gt;&gt; shuts down.
&gt;&gt;
&gt;&gt; 2017-07-07 16:20 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com&gt;:
&gt;&gt;
&gt;&gt;&gt; Andrea,
&gt;&gt;&gt;
&gt;&gt;&gt; You are a genius!!! :D It's worked :)) Thank yo so much!!! XD
&gt;&gt;&gt;
&gt;&gt;&gt; 2017-07-07 12:14 GMT+02:00 Andrea Bolognani &lt;abologna@redhat.com&gt;:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Fri, 2017-07-07 at 09:46 +0200, Jędrek Domański wrote:
&gt;&gt;&gt;&gt; &gt; Hi Dominik,
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; So what is going on on my computer with the script libvirt-guests.sh?
&gt;&gt;&gt;&gt; &gt; Why is it hanging on it? How should I address this problem?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Not sure what the root cause of your problem is, but you
&gt;&gt;&gt;&gt; can use
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;   # systemctl disable libvirt-guests
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; to verify if the script is really what causes shutdown
&gt;&gt;&gt;&gt; to hang. It might very well be that it's merely the last
&gt;&gt;&gt;&gt; thing producing output before the actual issue occurs.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt; Andrea Bolognani / Red Hat / Virtualization
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Dominik Psenner
&gt;&gt;
&gt;
&gt;


-- 
Dominik Psenner

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;I just wanted to point out that you're only resolving the symptom, \
not the actual cause. At the same time I'm afraid that I don't know what the \
cause of your problems is. If you don't want to run virsh guests you probably \
won't need the service, but then what's the point of having libvirt-bin \
installed in the first place? :-)&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 23:23 GMT+02:00 Jędrek \
Domański &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Dominik,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;As far as I am \
concerned the command provided by Andrea disables libvirt-guests service at \
boot.&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;jedrek@Home:~$ service libvirt-guests \
status&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;● libvirt-guests.service - Suspend \
Active Libvirt Guests&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;     Loaded: loaded \
(/lib/systemd/system/libvirt-&lt;wbr&gt;guests.service; &lt;b&gt;disabled&lt;/b&gt;; vendor preset: \
enabled)&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;     Active: inactive (dead)&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;        Docs: \
man:libvirtd(8)&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;                 &lt;a \
href="http://libvirt.org" target="_blank"&gt;http://libvirt.org&lt;/a&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;When you enable/disable a service \
&lt;b&gt;sysctemctl &lt;/b&gt;creates a symlink of a service into the location on disk where \
systemd looks for autostart files (usually \
/etc/systemd/system/some_&lt;wbr&gt;target.target.wants&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font face="arial, \
helvetica, sans-serif"&gt;jedrek@Home:~$ ls /etc/systemd/system/ | grep \
libvirt*&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;libvirtd.service&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;No libvirt-guests.service&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;I know this is just a workaround but \
what's wrong with this?&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="HOEnZb"&gt;&lt;div class="h5"&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-07 19:13 GMT+02:00 Dominik Psenner &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;Note that this disables the shutdown of libvirt guests when the host shuts \
down.&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;div&gt;&lt;div \
class="m_3541600639834390631h5"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 16:20 \
GMT+02:00 Jędrek Domański &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Andrea,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;You are a \
genius!!! :D It's worked :)) Thank yo so much!!! XD&lt;/div&gt;&lt;/div&gt;&lt;div \
class="m_3541600639834390631m_4220321199909326956HOEnZb"&gt;&lt;div \
class="m_3541600639834390631m_4220321199909326956h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 12:14 GMT+02:00 Andrea \
Bolognani &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:abologna@redhat.com" \
target="_blank"&gt;abologna@redhat.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span&gt;On Fri, 2017-07-07 at 09:46 +0200, Jędrek Domański \
wrote:&lt;br&gt; &gt; Hi Dominik,&lt;br&gt;
&gt;  &lt;br&gt;
&gt; So what is going on on my computer with the script libvirt-guests.sh?&lt;br&gt;
&gt; Why is it hanging on it? How should I address this problem?&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;Not sure what the root cause of your problem is, but you&lt;br&gt;
can use&lt;br&gt;
&lt;br&gt;
   # systemctl disable libvirt-guests&lt;br&gt;
&lt;br&gt;
to verify if the script is really what causes shutdown&lt;br&gt;
to hang. It might very well be that it's merely the last&lt;br&gt;
thing producing output before the actual issue occurs.&lt;br&gt;
&lt;span class="m_3541600639834390631m_4220321199909326956m_-5003496856355289139HOEnZb"&gt;&lt;font \
                color="#888888"&gt;&lt;br&gt;
--  &lt;br&gt;
Andrea Bolognani / Red Hat / Virtualization&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span \
class="m_3541600639834390631HOEnZb"&gt;&lt;font color="#888888"&gt;-- &lt;br&gt;&lt;div \
class="m_3541600639834390631m_4220321199909326956gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- &lt;br&gt;&lt;div \
class="gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik \
Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;



</body></email><email><emailId>20170708223838</emailId><senderName>Jędrek Domański</senderName><senderEmail>jedrek.domanski@gmail.com</senderEmail><timestampReceived>2017-07-08 22:38:38-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

Dominik,

What's the point of including a software to an OS that does not work?

2017-07-08 18:34 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:

&gt; I just wanted to point out that you're only resolving the symptom, not th=
e
&gt; actual cause. At the same time I'm afraid that I don't know what the caus=
e
&gt; of your problems is. If you don't want to run virsh guests you probably
&gt; won't need the service, but then what's the point of having libvirt-bin
&gt; installed in the first place? :-)
&gt;
&gt; Cheers
&gt;
&gt; 2017-07-07 23:23 GMT+02:00 J=C4=99drek Doma=C5=84ski &lt;jedrek.domanski@gma=
il.com&gt;:
&gt;
&gt;&gt; Dominik,
&gt;&gt;
&gt;&gt; As far as I am concerned the command provided by Andrea disables
&gt;&gt; libvirt-guests service at boot.
&gt;&gt;
&gt;&gt; jedrek@Home:~$ service libvirt-guests status
&gt;&gt; =E2=97=8F libvirt-guests.service - Suspend Active Libvirt Guests
&gt;&gt;    Loaded: loaded (/lib/systemd/system/libvirt-guests.service; *disabled=
*;
&gt;&gt; vendor preset: enabled)
&gt;&gt;    Active: inactive (dead)
&gt;&gt;      Docs: man:libvirtd(8)
&gt;&gt;            http://libvirt.org
&gt;&gt;
&gt;&gt; When you enable/disable a service *sysctemctl *creates a symlink of a
&gt;&gt; service into the location on disk where systemd looks for autostart file=
s
&gt;&gt; (usually /etc/systemd/system/some_target.target.wants
&gt;&gt;
&gt;&gt; jedrek@Home:~$ ls /etc/systemd/system/ | grep libvirt*
&gt;&gt; libvirtd.service
&gt;&gt;
&gt;&gt; No libvirt-guests.service
&gt;&gt;
&gt;&gt; I know this is just a workaround but what's wrong with this?
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; 2017-07-07 19:13 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;&gt;
&gt;&gt;&gt; Note that this disables the shutdown of libvirt guests when the host
&gt;&gt;&gt; shuts down.
&gt;&gt;&gt;
&gt;&gt;&gt; 2017-07-07 16:20 GMT+02:00 J=C4=99drek Doma=C5=84ski &lt;jedrek.domanski@g=
mail.com&gt;:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Andrea,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; You are a genius!!! :D It's worked :)) Thank yo so much!!! XD
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 2017-07-07 12:14 GMT+02:00 Andrea Bolognani &lt;abologna@redhat.com&gt;:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On Fri, 2017-07-07 at 09:46 +0200, J=C4=99drek Doma=C5=84ski wrote:
&gt;&gt;&gt;&gt;&gt; &gt; Hi Dominik,
&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt; &gt; So what is going on on my computer with the script libvirt-guests.s=
h?
&gt;&gt;&gt;&gt;&gt; &gt; Why is it hanging on it? How should I address this problem?
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Not sure what the root cause of your problem is, but you
&gt;&gt;&gt;&gt;&gt; can use
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;   # systemctl disable libvirt-guests
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; to verify if the script is really what causes shutdown
&gt;&gt;&gt;&gt;&gt; to hang. It might very well be that it's merely the last
&gt;&gt;&gt;&gt;&gt; thing producing output before the actual issue occurs.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;&gt; Andrea Bolognani / Red Hat / Virtualization
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Dominik Psenner
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Dominik Psenner
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Dominik,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;What's the \
point of including a software to an OS that does not work?&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-08 18:34 GMT+02:00 Dominik \
Psenner &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;I just wanted to point out that you're only resolving the symptom, not \
the actual cause. At the same time I'm afraid that I don't know what the \
cause of your problems is. If you don't want to run virsh guests you probably \
won't need the service, but then what's the point of having libvirt-bin \
installed in the first place? :-)&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;div&gt;&lt;div class="h5"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 \
23:23 GMT+02:00 Jędrek Domański &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Dominik,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;As far as I am \
concerned the command provided by Andrea disables libvirt-guests service at \
boot.&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;jedrek@Home:~$ service libvirt-guests \
status&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;● libvirt-guests.service - Suspend \
Active Libvirt Guests&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;     Loaded: loaded \
(/lib/systemd/system/libvirt-g&lt;wbr&gt;uests.service; &lt;b&gt;disabled&lt;/b&gt;; vendor preset: \
enabled)&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;     Active: inactive (dead)&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;        Docs: \
man:libvirtd(8)&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;                 &lt;a \
href="http://libvirt.org" target="_blank"&gt;http://libvirt.org&lt;/a&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;When you enable/disable a service \
&lt;b&gt;sysctemctl &lt;/b&gt;creates a symlink of a service into the location on disk where \
systemd looks for autostart files (usually \
/etc/systemd/system/some_targe&lt;wbr&gt;t.target.wants&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font face="arial, \
helvetica, sans-serif"&gt;jedrek@Home:~$ ls /etc/systemd/system/ | grep \
libvirt*&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;libvirtd.service&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;No libvirt-guests.service&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;I know this is just a workaround but \
what's wrong with this?&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="m_489605109274266030HOEnZb"&gt;&lt;div class="m_489605109274266030h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 19:13 GMT+02:00 Dominik \
Psenner &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;Note that this disables the shutdown of libvirt guests when the host shuts \
down.&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;div&gt;&lt;div \
class="m_489605109274266030m_3541600639834390631h5"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-07 16:20 GMT+02:00 Jędrek Domański &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Andrea,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;You are a \
genius!!! :D It's worked :)) Thank yo so much!!! XD&lt;/div&gt;&lt;/div&gt;&lt;div \
class="m_489605109274266030m_3541600639834390631m_4220321199909326956HOEnZb"&gt;&lt;div \
class="m_489605109274266030m_3541600639834390631m_4220321199909326956h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 12:14 GMT+02:00 Andrea \
Bolognani &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:abologna@redhat.com" \
target="_blank"&gt;abologna@redhat.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span&gt;On Fri, 2017-07-07 at 09:46 +0200, Jędrek Domański \
wrote:&lt;br&gt; &gt; Hi Dominik,&lt;br&gt;
&gt;  &lt;br&gt;
&gt; So what is going on on my computer with the script libvirt-guests.sh?&lt;br&gt;
&gt; Why is it hanging on it? How should I address this problem?&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;Not sure what the root cause of your problem is, but you&lt;br&gt;
can use&lt;br&gt;
&lt;br&gt;
   # systemctl disable libvirt-guests&lt;br&gt;
&lt;br&gt;
to verify if the script is really what causes shutdown&lt;br&gt;
to hang. It might very well be that it's merely the last&lt;br&gt;
thing producing output before the actual issue occurs.&lt;br&gt;
&lt;span class="m_489605109274266030m_3541600639834390631m_4220321199909326956m_-5003496856355289139HOEnZb"&gt;&lt;font \
                color="#888888"&gt;&lt;br&gt;
--  &lt;br&gt;
Andrea Bolognani / Red Hat / Virtualization&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span \
class="m_489605109274266030m_3541600639834390631HOEnZb"&gt;&lt;font color="#888888"&gt;-- \
&lt;br&gt;&lt;div class="m_489605109274266030m_3541600639834390631m_4220321199909326956gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span \
class="HOEnZb"&gt;&lt;font color="#888888"&gt;-- &lt;br&gt;&lt;div \
class="m_489605109274266030gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div \
dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;/font&gt;&lt;/span&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170709161207</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-07-09 16:12:07-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

You can't expect anyone to step up happily to fix a problem you experience.
If you're unhappy with the open source solution you have at least 4 options:

1. buy a license for red hat
2. get customer support from red hat
3. buy a license for vmware
4. work out why it doesn't work, give feedback to the community and may
even work out a fix that you can give back to the community. with a bit of
luck the overall open source product could evolve into something better.

I feel sorry that I couldn't you help any further. Good luck!

Cheers,
Dominik

2017-07-09 0:38 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com&gt;:

&gt; Dominik,
&gt;
&gt; What's the point of including a software to an OS that does not work?
&gt;
&gt; 2017-07-08 18:34 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;
&gt;&gt; I just wanted to point out that you're only resolving the symptom, not
&gt;&gt; the actual cause. At the same time I'm afraid that I don't know what the
&gt;&gt; cause of your problems is. If you don't want to run virsh guests you
&gt;&gt; probably won't need the service, but then what's the point of having
&gt;&gt; libvirt-bin installed in the first place? :-)
&gt;&gt;
&gt;&gt; Cheers
&gt;&gt;
&gt;&gt; 2017-07-07 23:23 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com&gt;:
&gt;&gt;
&gt;&gt;&gt; Dominik,
&gt;&gt;&gt;
&gt;&gt;&gt; As far as I am concerned the command provided by Andrea disables
&gt;&gt;&gt; libvirt-guests service at boot.
&gt;&gt;&gt;
&gt;&gt;&gt; jedrek@Home:~$ service libvirt-guests status
&gt;&gt;&gt; ● libvirt-guests.service - Suspend Active Libvirt Guests
&gt;&gt;&gt;    Loaded: loaded (/lib/systemd/system/libvirt-guests.service;
&gt;&gt;&gt; *disabled*; vendor preset: enabled)
&gt;&gt;&gt;    Active: inactive (dead)
&gt;&gt;&gt;      Docs: man:libvirtd(8)
&gt;&gt;&gt;            http://libvirt.org
&gt;&gt;&gt;
&gt;&gt;&gt; When you enable/disable a service *sysctemctl *creates a symlink of a
&gt;&gt;&gt; service into the location on disk where systemd looks for autostart files
&gt;&gt;&gt; (usually /etc/systemd/system/some_target.target.wants
&gt;&gt;&gt;
&gt;&gt;&gt; jedrek@Home:~$ ls /etc/systemd/system/ | grep libvirt*
&gt;&gt;&gt; libvirtd.service
&gt;&gt;&gt;
&gt;&gt;&gt; No libvirt-guests.service
&gt;&gt;&gt;
&gt;&gt;&gt; I know this is just a workaround but what's wrong with this?
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; 2017-07-07 19:13 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Note that this disables the shutdown of libvirt guests when the host
&gt;&gt;&gt;&gt; shuts down.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 2017-07-07 16:20 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com&gt;:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Andrea,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; You are a genius!!! :D It's worked :)) Thank yo so much!!! XD
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; 2017-07-07 12:14 GMT+02:00 Andrea Bolognani &lt;abologna@redhat.com&gt;:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; On Fri, 2017-07-07 at 09:46 +0200, Jędrek Domański wrote:
&gt;&gt;&gt;&gt;&gt;&gt; &gt; Hi Dominik,
&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt; &gt; So what is going on on my computer with the script
&gt;&gt;&gt;&gt;&gt;&gt; libvirt-guests.sh?
&gt;&gt;&gt;&gt;&gt;&gt; &gt; Why is it hanging on it? How should I address this problem?
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Not sure what the root cause of your problem is, but you
&gt;&gt;&gt;&gt;&gt;&gt; can use
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;   # systemctl disable libvirt-guests
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; to verify if the script is really what causes shutdown
&gt;&gt;&gt;&gt;&gt;&gt; to hang. It might very well be that it's merely the last
&gt;&gt;&gt;&gt;&gt;&gt; thing producing output before the actual issue occurs.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;&gt;&gt; Andrea Bolognani / Red Hat / Virtualization
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt; Dominik Psenner
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Dominik Psenner
&gt;&gt;
&gt;
&gt;


-- 
Dominik Psenner

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;You can't expect anyone to step up happily to fix a problem you \
experience. If you're unhappy with the open source solution you have at least 4 \
options:&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1. buy a license for red hat&lt;/div&gt;&lt;div&gt;2. get customer \
support from red hat&lt;/div&gt;&lt;div&gt;3. buy a license for vmware&lt;/div&gt;&lt;div&gt;4. work out why \
it doesn't work, give feedback to the community and may even work out a fix that \
you can give back to the community. with a bit of luck the overall open source \
product could evolve into something better.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I feel sorry \
that I couldn't you help any further. Good \
luck!&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;Dominik&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-09 0:38 GMT+02:00 Jędrek \
Domański &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Dominik,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;What's the \
point of including a software to an OS that does not work?&lt;/div&gt;&lt;/div&gt;&lt;div \
class="HOEnZb"&gt;&lt;div class="h5"&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-08 18:34 GMT+02:00 Dominik Psenner &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;I just wanted to point out that you're only resolving the symptom, not \
the actual cause. At the same time I'm afraid that I don't know what the \
cause of your problems is. If you don't want to run virsh guests you probably \
won't need the service, but then what's the point of having libvirt-bin \
installed in the first place? :-)&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;div&gt;&lt;div class="m_-7020071775829205870h5"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-07 23:23 GMT+02:00 Jędrek Domański &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Dominik,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;As far as I am \
concerned the command provided by Andrea disables libvirt-guests service at \
boot.&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;jedrek@Home:~$ service libvirt-guests \
status&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;● libvirt-guests.service - Suspend \
Active Libvirt Guests&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;     Loaded: loaded \
(/lib/systemd/system/libvirt-g&lt;wbr&gt;uests.service; &lt;b&gt;disabled&lt;/b&gt;; vendor preset: \
enabled)&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;     Active: inactive (dead)&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;        Docs: \
man:libvirtd(8)&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;                 &lt;a \
href="http://libvirt.org" target="_blank"&gt;http://libvirt.org&lt;/a&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;When you enable/disable a service \
&lt;b&gt;sysctemctl &lt;/b&gt;creates a symlink of a service into the location on disk where \
systemd looks for autostart files (usually \
/etc/systemd/system/some_targe&lt;wbr&gt;t.target.wants&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font face="arial, \
helvetica, sans-serif"&gt;jedrek@Home:~$ ls /etc/systemd/system/ | grep \
libvirt*&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;libvirtd.service&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;No libvirt-guests.service&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;I know this is just a workaround but \
what's wrong with this?&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="m_-7020071775829205870m_489605109274266030HOEnZb"&gt;&lt;div \
class="m_-7020071775829205870m_489605109274266030h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 19:13 GMT+02:00 Dominik \
Psenner &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;Note that this disables the shutdown of libvirt guests when the host shuts \
down.&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;div&gt;&lt;div \
class="m_-7020071775829205870m_489605109274266030m_3541600639834390631h5"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-07 16:20 GMT+02:00 Jędrek Domański &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Andrea,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;You are a \
genius!!! :D It's worked :)) Thank yo so much!!! XD&lt;/div&gt;&lt;/div&gt;&lt;div \
class="m_-7020071775829205870m_489605109274266030m_3541600639834390631m_4220321199909326956HOEnZb"&gt;&lt;div \
class="m_-7020071775829205870m_489605109274266030m_3541600639834390631m_4220321199909326956h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 12:14 GMT+02:00 Andrea \
Bolognani &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:abologna@redhat.com" \
target="_blank"&gt;abologna@redhat.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span&gt;On Fri, 2017-07-07 at 09:46 +0200, Jędrek Domański \
wrote:&lt;br&gt; &gt; Hi Dominik,&lt;br&gt;
&gt;  &lt;br&gt;
&gt; So what is going on on my computer with the script libvirt-guests.sh?&lt;br&gt;
&gt; Why is it hanging on it? How should I address this problem?&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;Not sure what the root cause of your problem is, but you&lt;br&gt;
can use&lt;br&gt;
&lt;br&gt;
   # systemctl disable libvirt-guests&lt;br&gt;
&lt;br&gt;
to verify if the script is really what causes shutdown&lt;br&gt;
to hang. It might very well be that it's merely the last&lt;br&gt;
thing producing output before the actual issue occurs.&lt;br&gt;
&lt;span class="m_-7020071775829205870m_489605109274266030m_3541600639834390631m_4220321199909326956m_-5003496856355289139HOEnZb"&gt;&lt;font \
                color="#888888"&gt;&lt;br&gt;
--  &lt;br&gt;
Andrea Bolognani / Red Hat / Virtualization&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span \
class="m_-7020071775829205870m_489605109274266030m_3541600639834390631HOEnZb"&gt;&lt;font \
color="#888888"&gt;-- &lt;br&gt;&lt;div \
class="m_-7020071775829205870m_489605109274266030m_3541600639834390631m_4220321199909326956gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span \
class="m_-7020071775829205870HOEnZb"&gt;&lt;font color="#888888"&gt;-- &lt;br&gt;&lt;div \
class="m_-7020071775829205870m_489605109274266030gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- &lt;br&gt;&lt;div \
class="gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik \
Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;



</body></email><email><emailId>20170709164908</emailId><senderName>Jędrek Domański</senderName><senderEmail>jedrek.domanski@gmail.com</senderEmail><timestampReceived>2017-07-09 16:49:08-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

Yeah, I know. Sorry for my demanding attitude.

Any hints how I could start debugging the problem?

2017-07-09 18:12 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:

&gt; You can't expect anyone to step up happily to fix a problem you
&gt; experience. If you're unhappy with the open source solution you have at
&gt; least 4 options:
&gt;
&gt; 1. buy a license for red hat
&gt; 2. get customer support from red hat
&gt; 3. buy a license for vmware
&gt; 4. work out why it doesn't work, give feedback to the community and may
&gt; even work out a fix that you can give back to the community. with a bit o=
f
&gt; luck the overall open source product could evolve into something better.
&gt;
&gt; I feel sorry that I couldn't you help any further. Good luck!
&gt;
&gt; Cheers,
&gt; Dominik
&gt;
&gt; 2017-07-09 0:38 GMT+02:00 J=C4=99drek Doma=C5=84ski &lt;jedrek.domanski@gmai=
l.com&gt;:
&gt;
&gt;&gt; Dominik,
&gt;&gt;
&gt;&gt; What's the point of including a software to an OS that does not work?
&gt;&gt;
&gt;&gt; 2017-07-08 18:34 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;&gt;
&gt;&gt;&gt; I just wanted to point out that you're only resolving the symptom, not
&gt;&gt;&gt; the actual cause. At the same time I'm afraid that I don't know what th=
e
&gt;&gt;&gt; cause of your problems is. If you don't want to run virsh guests you
&gt;&gt;&gt; probably won't need the service, but then what's the point of having
&gt;&gt;&gt; libvirt-bin installed in the first place? :-)
&gt;&gt;&gt;
&gt;&gt;&gt; Cheers
&gt;&gt;&gt;
&gt;&gt;&gt; 2017-07-07 23:23 GMT+02:00 J=C4=99drek Doma=C5=84ski &lt;jedrek.domanski@g=
mail.com&gt;:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Dominik,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; As far as I am concerned the command provided by Andrea disables
&gt;&gt;&gt;&gt; libvirt-guests service at boot.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; jedrek@Home:~$ service libvirt-guests status
&gt;&gt;&gt;&gt; =E2=97=8F libvirt-guests.service - Suspend Active Libvirt Guests
&gt;&gt;&gt;&gt;    Loaded: loaded (/lib/systemd/system/libvirt-guests.service;
&gt;&gt;&gt;&gt; *disabled*; vendor preset: enabled)
&gt;&gt;&gt;&gt;    Active: inactive (dead)
&gt;&gt;&gt;&gt;      Docs: man:libvirtd(8)
&gt;&gt;&gt;&gt;            http://libvirt.org
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; When you enable/disable a service *sysctemctl *creates a symlink of a
&gt;&gt;&gt;&gt; service into the location on disk where systemd looks for autostart fi=
les
&gt;&gt;&gt;&gt; (usually /etc/systemd/system/some_target.target.wants
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; jedrek@Home:~$ ls /etc/systemd/system/ | grep libvirt*
&gt;&gt;&gt;&gt; libvirtd.service
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; No libvirt-guests.service
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I know this is just a workaround but what's wrong with this?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 2017-07-07 19:13 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Note that this disables the shutdown of libvirt guests when the host
&gt;&gt;&gt;&gt;&gt; shuts down.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; 2017-07-07 16:20 GMT+02:00 J=C4=99drek Doma=C5=84ski &lt;jedrek.domanski=
@gmail.com&gt;
&gt;&gt;&gt;&gt;&gt; :
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Andrea,
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; You are a genius!!! :D It's worked :)) Thank yo so much!!! XD
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; 2017-07-07 12:14 GMT+02:00 Andrea Bolognani &lt;abologna@redhat.com&gt;:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; On Fri, 2017-07-07 at 09:46 +0200, J=C4=99drek Doma=C5=84ski wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; Hi Dominik,
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; So what is going on on my computer with the script
&gt;&gt;&gt;&gt;&gt;&gt;&gt; libvirt-guests.sh?
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; Why is it hanging on it? How should I address this problem?
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Not sure what the root cause of your problem is, but you
&gt;&gt;&gt;&gt;&gt;&gt;&gt; can use
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;   # systemctl disable libvirt-guests
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; to verify if the script is really what causes shutdown
&gt;&gt;&gt;&gt;&gt;&gt;&gt; to hang. It might very well be that it's merely the last
&gt;&gt;&gt;&gt;&gt;&gt;&gt; thing producing output before the actual issue occurs.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Andrea Bolognani / Red Hat / Virtualization
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;&gt; Dominik Psenner
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Dominik Psenner
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Dominik Psenner
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Yeah, I know. Sorry for my demanding \
attitude.&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Any hints how I could start debugging \
the problem?&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-09 18:12 GMT+02:00 Dominik Psenner &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;You can't expect anyone to step up happily to fix a problem you \
experience. If you're unhappy with the open source solution you have at least 4 \
options:&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1. buy a license for red hat&lt;/div&gt;&lt;div&gt;2. get customer \
support from red hat&lt;/div&gt;&lt;div&gt;3. buy a license for vmware&lt;/div&gt;&lt;div&gt;4. work out why \
it doesn't work, give feedback to the community and may even work out a fix that \
you can give back to the community. with a bit of luck the overall open source \
product could evolve into something better.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I feel sorry \
that I couldn't you help any further. Good \
luck!&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;Dominik&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;div&gt;&lt;div class="h5"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-09 0:38 \
GMT+02:00 Jędrek Domański &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Dominik,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;What's the \
point of including a software to an OS that does not work?&lt;/div&gt;&lt;/div&gt;&lt;div \
class="m_6789491495911322201HOEnZb"&gt;&lt;div class="m_6789491495911322201h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-08 18:34 GMT+02:00 Dominik \
Psenner &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;I just wanted to point out that you're only resolving the symptom, not \
the actual cause. At the same time I'm afraid that I don't know what the \
cause of your problems is. If you don't want to run virsh guests you probably \
won't need the service, but then what's the point of having libvirt-bin \
installed in the first place? :-)&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;div&gt;&lt;div \
class="m_6789491495911322201m_-7020071775829205870h5"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-07 23:23 GMT+02:00 Jędrek Domański &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Dominik,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;As far as I am \
concerned the command provided by Andrea disables libvirt-guests service at \
boot.&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;jedrek@Home:~$ service libvirt-guests \
status&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;● libvirt-guests.service - Suspend \
Active Libvirt Guests&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;     Loaded: loaded \
(/lib/systemd/system/libvirt-g&lt;wbr&gt;uests.service; &lt;b&gt;disabled&lt;/b&gt;; vendor preset: \
enabled)&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;     Active: inactive (dead)&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;        Docs: \
man:libvirtd(8)&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;                 &lt;a \
href="http://libvirt.org" target="_blank"&gt;http://libvirt.org&lt;/a&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;When you enable/disable a service \
&lt;b&gt;sysctemctl &lt;/b&gt;creates a symlink of a service into the location on disk where \
systemd looks for autostart files (usually \
/etc/systemd/system/some_targe&lt;wbr&gt;t.target.wants&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font face="arial, \
helvetica, sans-serif"&gt;jedrek@Home:~$ ls /etc/systemd/system/ | grep \
libvirt*&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;libvirtd.service&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;No libvirt-guests.service&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;I know this is just a workaround but \
what's wrong with this?&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="m_6789491495911322201m_-7020071775829205870m_489605109274266030HOEnZb"&gt;&lt;div \
class="m_6789491495911322201m_-7020071775829205870m_489605109274266030h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 19:13 GMT+02:00 Dominik \
Psenner &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;Note that this disables the shutdown of libvirt guests when the host shuts \
down.&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;div&gt;&lt;div \
class="m_6789491495911322201m_-7020071775829205870m_489605109274266030m_3541600639834390631h5"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-07 16:20 GMT+02:00 Jędrek Domański &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Andrea,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;You are a \
genius!!! :D It's worked :)) Thank yo so much!!! XD&lt;/div&gt;&lt;/div&gt;&lt;div \
class="m_6789491495911322201m_-7020071775829205870m_489605109274266030m_3541600639834390631m_4220321199909326956HOEnZb"&gt;&lt;div \
class="m_6789491495911322201m_-7020071775829205870m_489605109274266030m_3541600639834390631m_4220321199909326956h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 12:14 GMT+02:00 Andrea \
Bolognani &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:abologna@redhat.com" \
target="_blank"&gt;abologna@redhat.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span&gt;On Fri, 2017-07-07 at 09:46 +0200, Jędrek Domański \
wrote:&lt;br&gt; &gt; Hi Dominik,&lt;br&gt;
&gt;  &lt;br&gt;
&gt; So what is going on on my computer with the script libvirt-guests.sh?&lt;br&gt;
&gt; Why is it hanging on it? How should I address this problem?&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;Not sure what the root cause of your problem is, but you&lt;br&gt;
can use&lt;br&gt;
&lt;br&gt;
   # systemctl disable libvirt-guests&lt;br&gt;
&lt;br&gt;
to verify if the script is really what causes shutdown&lt;br&gt;
to hang. It might very well be that it's merely the last&lt;br&gt;
thing producing output before the actual issue occurs.&lt;br&gt;
&lt;span class="m_6789491495911322201m_-7020071775829205870m_489605109274266030m_3541600639834390631m_4220321199909326956m_-5003496856355289139HOEnZb"&gt;&lt;font \
                color="#888888"&gt;&lt;br&gt;
--  &lt;br&gt;
Andrea Bolognani / Red Hat / Virtualization&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span \
class="m_6789491495911322201m_-7020071775829205870m_489605109274266030m_3541600639834390631HOEnZb"&gt;&lt;font \
color="#888888"&gt;-- &lt;br&gt;&lt;div \
class="m_6789491495911322201m_-7020071775829205870m_489605109274266030m_3541600639834390631m_4220321199909326956gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span \
class="m_6789491495911322201m_-7020071775829205870HOEnZb"&gt;&lt;font color="#888888"&gt;-- \
&lt;br&gt;&lt;div class="m_6789491495911322201m_-7020071775829205870m_489605109274266030gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span \
class="HOEnZb"&gt;&lt;font color="#888888"&gt;-- &lt;br&gt;&lt;div \
class="m_6789491495911322201gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div \
dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;/font&gt;&lt;/span&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170709171437</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-07-09 17:14:37-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

I'm not familiar with the libvirt codebase, but the extension of
libvirt-guests.sh indicates that it is a shell script. Maybe you can modify
it to find the spot where it hangs?

2017-07-09 18:49 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com&gt;:

&gt; Yeah, I know. Sorry for my demanding attitude.
&gt;
&gt; Any hints how I could start debugging the problem?
&gt;
&gt; 2017-07-09 18:12 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;
&gt;&gt; You can't expect anyone to step up happily to fix a problem you
&gt;&gt; experience. If you're unhappy with the open source solution you have at
&gt;&gt; least 4 options:
&gt;&gt;
&gt;&gt; 1. buy a license for red hat
&gt;&gt; 2. get customer support from red hat
&gt;&gt; 3. buy a license for vmware
&gt;&gt; 4. work out why it doesn't work, give feedback to the community and may
&gt;&gt; even work out a fix that you can give back to the community. with a bit of
&gt;&gt; luck the overall open source product could evolve into something better.
&gt;&gt;
&gt;&gt; I feel sorry that I couldn't you help any further. Good luck!
&gt;&gt;
&gt;&gt; Cheers,
&gt;&gt; Dominik
&gt;&gt;
&gt;&gt; 2017-07-09 0:38 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com&gt;:
&gt;&gt;
&gt;&gt;&gt; Dominik,
&gt;&gt;&gt;
&gt;&gt;&gt; What's the point of including a software to an OS that does not work?
&gt;&gt;&gt;
&gt;&gt;&gt; 2017-07-08 18:34 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I just wanted to point out that you're only resolving the symptom, not
&gt;&gt;&gt;&gt; the actual cause. At the same time I'm afraid that I don't know what the
&gt;&gt;&gt;&gt; cause of your problems is. If you don't want to run virsh guests you
&gt;&gt;&gt;&gt; probably won't need the service, but then what's the point of having
&gt;&gt;&gt;&gt; libvirt-bin installed in the first place? :-)
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Cheers
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 2017-07-07 23:23 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com&gt;:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Dominik,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; As far as I am concerned the command provided by Andrea disables
&gt;&gt;&gt;&gt;&gt; libvirt-guests service at boot.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; jedrek@Home:~$ service libvirt-guests status
&gt;&gt;&gt;&gt;&gt; ● libvirt-guests.service - Suspend Active Libvirt Guests
&gt;&gt;&gt;&gt;&gt;    Loaded: loaded (/lib/systemd/system/libvirt-guests.service;
&gt;&gt;&gt;&gt;&gt; *disabled*; vendor preset: enabled)
&gt;&gt;&gt;&gt;&gt;    Active: inactive (dead)
&gt;&gt;&gt;&gt;&gt;      Docs: man:libvirtd(8)
&gt;&gt;&gt;&gt;&gt;            http://libvirt.org
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; When you enable/disable a service *sysctemctl *creates a symlink of a
&gt;&gt;&gt;&gt;&gt; service into the location on disk where systemd looks for autostart files
&gt;&gt;&gt;&gt;&gt; (usually /etc/systemd/system/some_target.target.wants
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; jedrek@Home:~$ ls /etc/systemd/system/ | grep libvirt*
&gt;&gt;&gt;&gt;&gt; libvirtd.service
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; No libvirt-guests.service
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I know this is just a workaround but what's wrong with this?
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; 2017-07-07 19:13 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Note that this disables the shutdown of libvirt guests when the host
&gt;&gt;&gt;&gt;&gt;&gt; shuts down.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; 2017-07-07 16:20 GMT+02:00 Jędrek Domański &lt;jedrek.domanski@gmail.com
&gt;&gt;&gt;&gt;&gt;&gt; &gt;:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Andrea,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; You are a genius!!! :D It's worked :)) Thank yo so much!!! XD
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 2017-07-07 12:14 GMT+02:00 Andrea Bolognani &lt;abologna@redhat.com&gt;:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; On Fri, 2017-07-07 at 09:46 +0200, Jędrek Domański wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; Hi Dominik,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; So what is going on on my computer with the script
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; libvirt-guests.sh?
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; Why is it hanging on it? How should I address this problem?
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Not sure what the root cause of your problem is, but you
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; can use
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;   # systemctl disable libvirt-guests
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; to verify if the script is really what causes shutdown
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; to hang. It might very well be that it's merely the last
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; thing producing output before the actual issue occurs.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Andrea Bolognani / Red Hat / Virtualization
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;&gt;&gt; Dominik Psenner
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt; Dominik Psenner
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Dominik Psenner
&gt;&gt;
&gt;
&gt;


-- 
Dominik Psenner

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;I'm not familiar with the libvirt codebase, but the extension of \
libvirt-guests.sh indicates that it is a shell script. Maybe you can modify it to \
find the spot where it hangs?&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-09 18:49 GMT+02:00 Jędrek Domański &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Yeah, I know. Sorry for my demanding \
attitude.&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Any hints how I could start debugging \
the problem?&lt;/div&gt;&lt;/div&gt;&lt;div class="HOEnZb"&gt;&lt;div class="h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-09 18:12 GMT+02:00 Dominik \
Psenner &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;You can't expect anyone to step up happily to fix a problem you \
experience. If you're unhappy with the open source solution you have at least 4 \
options:&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1. buy a license for red hat&lt;/div&gt;&lt;div&gt;2. get customer \
support from red hat&lt;/div&gt;&lt;div&gt;3. buy a license for vmware&lt;/div&gt;&lt;div&gt;4. work out why \
it doesn't work, give feedback to the community and may even work out a fix that \
you can give back to the community. with a bit of luck the overall open source \
product could evolve into something better.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I feel sorry \
that I couldn't you help any further. Good \
luck!&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;Dominik&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;div&gt;&lt;div class="m_1890396134254339651h5"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-09 0:38 GMT+02:00 Jędrek Domański &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Dominik,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;What's the \
point of including a software to an OS that does not work?&lt;/div&gt;&lt;/div&gt;&lt;div \
class="m_1890396134254339651m_6789491495911322201HOEnZb"&gt;&lt;div \
class="m_1890396134254339651m_6789491495911322201h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-08 18:34 GMT+02:00 Dominik \
Psenner &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;I just wanted to point out that you're only resolving the symptom, not \
the actual cause. At the same time I'm afraid that I don't know what the \
cause of your problems is. If you don't want to run virsh guests you probably \
won't need the service, but then what's the point of having libvirt-bin \
installed in the first place? :-)&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;div&gt;&lt;div \
class="m_1890396134254339651m_6789491495911322201m_-7020071775829205870h5"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-07 23:23 GMT+02:00 Jędrek Domański &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Dominik,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;As far as I am \
concerned the command provided by Andrea disables libvirt-guests service at \
boot.&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;jedrek@Home:~$ service libvirt-guests \
status&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;● libvirt-guests.service - Suspend \
Active Libvirt Guests&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;     Loaded: loaded \
(/lib/systemd/system/libvirt-g&lt;wbr&gt;uests.service; &lt;b&gt;disabled&lt;/b&gt;; vendor preset: \
enabled)&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;     Active: inactive (dead)&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;        Docs: \
man:libvirtd(8)&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;                 &lt;a \
href="http://libvirt.org" target="_blank"&gt;http://libvirt.org&lt;/a&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;When you enable/disable a service \
&lt;b&gt;sysctemctl &lt;/b&gt;creates a symlink of a service into the location on disk where \
systemd looks for autostart files (usually \
/etc/systemd/system/some_targe&lt;wbr&gt;t.target.wants&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font face="arial, \
helvetica, sans-serif"&gt;jedrek@Home:~$ ls /etc/systemd/system/ | grep \
libvirt*&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;libvirtd.service&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;No libvirt-guests.service&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;I know this is just a workaround but \
what's wrong with this?&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="m_1890396134254339651m_6789491495911322201m_-7020071775829205870m_489605109274266030HOEnZb"&gt;&lt;div \
class="m_1890396134254339651m_6789491495911322201m_-7020071775829205870m_489605109274266030h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 19:13 GMT+02:00 Dominik \
Psenner &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;Note that this disables the shutdown of libvirt guests when the host shuts \
down.&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;div&gt;&lt;div \
class="m_1890396134254339651m_6789491495911322201m_-7020071775829205870m_489605109274266030m_3541600639834390631h5"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-07 16:20 GMT+02:00 Jędrek Domański &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Andrea,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;You are a \
genius!!! :D It's worked :)) Thank yo so much!!! XD&lt;/div&gt;&lt;/div&gt;&lt;div \
class="m_1890396134254339651m_6789491495911322201m_-7020071775829205870m_489605109274266030m_3541600639834390631m_4220321199909326956HOEnZb"&gt;&lt;div \
class="m_1890396134254339651m_6789491495911322201m_-7020071775829205870m_489605109274266030m_3541600639834390631m_4220321199909326956h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-07 12:14 GMT+02:00 Andrea \
Bolognani &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:abologna@redhat.com" \
target="_blank"&gt;abologna@redhat.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span&gt;On Fri, 2017-07-07 at 09:46 +0200, Jędrek Domański \
wrote:&lt;br&gt; &gt; Hi Dominik,&lt;br&gt;
&gt;  &lt;br&gt;
&gt; So what is going on on my computer with the script libvirt-guests.sh?&lt;br&gt;
&gt; Why is it hanging on it? How should I address this problem?&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;Not sure what the root cause of your problem is, but you&lt;br&gt;
can use&lt;br&gt;
&lt;br&gt;
   # systemctl disable libvirt-guests&lt;br&gt;
&lt;br&gt;
to verify if the script is really what causes shutdown&lt;br&gt;
to hang. It might very well be that it's merely the last&lt;br&gt;
thing producing output before the actual issue occurs.&lt;br&gt;
&lt;span class="m_1890396134254339651m_6789491495911322201m_-7020071775829205870m_4896051 \
09274266030m_3541600639834390631m_4220321199909326956m_-5003496856355289139HOEnZb"&gt;&lt;font \
                color="#888888"&gt;&lt;br&gt;
--  &lt;br&gt;
Andrea Bolognani / Red Hat / Virtualization&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span \
class="m_1890396134254339651m_6789491495911322201m_-7020071775829205870m_489605109274266030m_3541600639834390631HOEnZb"&gt;&lt;font \
color="#888888"&gt;-- &lt;br&gt;&lt;div \
class="m_1890396134254339651m_6789491495911322201m_-7020071775829205870m_489605109274266030m_3541600639834390631m_4220321199909326956gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span \
class="m_1890396134254339651m_6789491495911322201m_-7020071775829205870HOEnZb"&gt;&lt;font \
color="#888888"&gt;-- &lt;br&gt;&lt;div \
class="m_1890396134254339651m_6789491495911322201m_-7020071775829205870m_489605109274266030gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span \
class="m_1890396134254339651HOEnZb"&gt;&lt;font color="#888888"&gt;-- &lt;br&gt;&lt;div \
class="m_1890396134254339651m_6789491495911322201gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- &lt;br&gt;&lt;div \
class="gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik \
Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;



</body></email><email><emailId>20170710063630</emailId><senderName>Andrea Bolognani</senderName><senderEmail>abologna@redhat.com</senderEmail><timestampReceived>2017-07-10 06:36:30-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

On Sun, 2017-07-09 at 19:14 +0200, Dominik Psenner wrote:
&gt; I'm not familiar with the libvirt codebase, but the
&gt; extension of libvirt-guests.sh indicates that it is a
&gt; shell script. Maybe you can modify it to find the spot
&gt; where it hangs?

That's indeed the case. On Debian/Ubuntu system, the
script is installed as

  /usr/lib/libvirt/libvirt-guests.sh

and you can definitely try debugging it if you're
familiar with shell scripting.

I installed both libvirt-bin and qemu-kvm in an Ubuntu
16.04 guest in an attempt to reproduce the issue you're
having but I was unsuccessful, so I'm afraid I can't
really help you much further.

It would probably be a good idea to open a downstream
bug report with your vendor, as they might have an
easier time reproducing the issue.

It's worth noting that the libvirt version included in
Ubuntu 16.04 is a bit old (it was released a year and
a half ago), however the libvirt-guests script hasn't
changed very much in the meantime.

-- 
Andrea Bolognani / Red Hat / Virtualization

</body></email><email><emailId>20170710092418</emailId><senderName>Jędrek Domański</senderName><senderEmail>jedrek.domanski@gmail.com</senderEmail><timestampReceived>2017-07-10 09:24:18-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

Thank you, Andrea.
After following your instructions I re-enabled it back to check to see if
it will log any messages from shutdown but no. I've noticed however that
the computer no longer freezes at shutdown. I am not sure why but it looks
like the problem is gone now. I will try to debugg it deeper and if I have
any issues I will get back to you.

J=C4=99drek

10 lip 2017 08:36 "Andrea Bolognani" &lt;abologna@redhat.com&gt; napisa=C5=82(a):

&gt; On Sun, 2017-07-09 at 19:14 +0200, Dominik Psenner wrote:
&gt; &gt; I'm not familiar with the libvirt codebase, but the
&gt; &gt; extension of libvirt-guests.sh indicates that it is a
&gt; &gt; shell script. Maybe you can modify it to find the spot
&gt; &gt; where it hangs?
&gt;
&gt; That's indeed the case. On Debian/Ubuntu system, the
&gt; script is installed as
&gt;
&gt;   /usr/lib/libvirt/libvirt-guests.sh
&gt;
&gt; and you can definitely try debugging it if you're
&gt; familiar with shell scripting.
&gt;
&gt; I installed both libvirt-bin and qemu-kvm in an Ubuntu
&gt; 16.04 guest in an attempt to reproduce the issue you're
&gt; having but I was unsuccessful, so I'm afraid I can't
&gt; really help you much further.
&gt;
&gt; It would probably be a good idea to open a downstream
&gt; bug report with your vendor, as they might have an
&gt; easier time reproducing the issue.
&gt;
&gt; It's worth noting that the libvirt version included in
&gt; Ubuntu 16.04 is a bit old (it was released a year and
&gt; a half ago), however the libvirt-guests script hasn't
&gt; changed very much in the meantime.
&gt;
&gt; --
&gt; Andrea Bolognani / Red Hat / Virtualization
&gt;

[Attachment #3 (text/html)]

&lt;div dir="auto"&gt;Thank you, Andrea.&lt;div dir="auto"&gt;After following your instructions I \
re-enabled it back to check to see if it will log any messages from shutdown but no. \
I've noticed however that the computer no longer freezes at shutdown. I am not \
sure why but it looks like the problem is gone now. I will try to debugg it deeper \
and if I have any issues I will get back to you.&lt;/div&gt;&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
dir="auto"&gt;Jędrek&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;10 lip 2017 08:36 "Andrea Bolognani" &lt;&lt;a \
href="mailto:abologna@redhat.com"&gt;abologna@redhat.com&lt;/a&gt;&gt; napisał(a):&lt;br \
type="attribution"&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;On Sun, 2017-07-09 at 19:14 +0200, \
Dominik Psenner wrote:&lt;br&gt; &gt; I'm not familiar with the libvirt codebase, but \
the&lt;br&gt; &gt; extension of libvirt-guests.sh indicates that it is a&lt;br&gt;
&gt; shell script. Maybe you can modify it to find the spot&lt;br&gt;
&gt; where it hangs?&lt;br&gt;
&lt;br&gt;
That's indeed the case. On Debian/Ubuntu system, the&lt;br&gt;
script is installed as&lt;br&gt;
&lt;br&gt;
   /usr/lib/libvirt/libvirt-&lt;wbr&gt;guests.sh&lt;br&gt;
&lt;br&gt;
and you can definitely try debugging it if you're&lt;br&gt;
familiar with shell scripting.&lt;br&gt;
&lt;br&gt;
I installed both libvirt-bin and qemu-kvm in an Ubuntu&lt;br&gt;
16.04 guest in an attempt to reproduce the issue you're&lt;br&gt;
having but I was unsuccessful, so I'm afraid I can't&lt;br&gt;
really help you much further.&lt;br&gt;
&lt;br&gt;
It would probably be a good idea to open a downstream&lt;br&gt;
bug report with your vendor, as they might have an&lt;br&gt;
easier time reproducing the issue.&lt;br&gt;
&lt;br&gt;
It's worth noting that the libvirt version included in&lt;br&gt;
Ubuntu 16.04 is a bit old (it was released a year and&lt;br&gt;
a half ago), however the libvirt-guests script hasn't&lt;br&gt;
changed very much in the meantime.&lt;br&gt;
&lt;br&gt;
--  &lt;br&gt;
Andrea Bolognani / Red Hat / Virtualization&lt;br&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170710122032</emailId><senderName>Jędrek Domański</senderName><senderEmail>jedrek.domanski@gmail.com</senderEmail><timestampReceived>2017-07-10 12:20:32-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

Andrea,

I have libvirt version 1.3.1. I am looking at libvirt.org/sources and see
more recent versions. Do I have the most up-to-date version? Do I need to
upgrade?

$libvirtd -V
libvirtd (libvirt) 1.3.1

2017-07-10 11:24 GMT+02:00 J=C4=99drek Doma=C5=84ski &lt;jedrek.domanski@gmail=
.com&gt;:

&gt; Thank you, Andrea.
&gt; After following your instructions I re-enabled it back to check to see if
&gt; it will log any messages from shutdown but no. I've noticed however that
&gt; the computer no longer freezes at shutdown. I am not sure why but it look=
s
&gt; like the problem is gone now. I will try to debugg it deeper and if I hav=
e
&gt; any issues I will get back to you.
&gt;
&gt; J=C4=99drek
&gt;
&gt; 10 lip 2017 08:36 "Andrea Bolognani" &lt;abologna@redhat.com&gt; napisa=C5=82(a=
):
&gt;
&gt;&gt; On Sun, 2017-07-09 at 19:14 +0200, Dominik Psenner wrote:
&gt;&gt; &gt; I'm not familiar with the libvirt codebase, but the
&gt;&gt; &gt; extension of libvirt-guests.sh indicates that it is a
&gt;&gt; &gt; shell script. Maybe you can modify it to find the spot
&gt;&gt; &gt; where it hangs?
&gt;&gt;
&gt;&gt; That's indeed the case. On Debian/Ubuntu system, the
&gt;&gt; script is installed as
&gt;&gt;
&gt;&gt;   /usr/lib/libvirt/libvirt-guests.sh
&gt;&gt;
&gt;&gt; and you can definitely try debugging it if you're
&gt;&gt; familiar with shell scripting.
&gt;&gt;
&gt;&gt; I installed both libvirt-bin and qemu-kvm in an Ubuntu
&gt;&gt; 16.04 guest in an attempt to reproduce the issue you're
&gt;&gt; having but I was unsuccessful, so I'm afraid I can't
&gt;&gt; really help you much further.
&gt;&gt;
&gt;&gt; It would probably be a good idea to open a downstream
&gt;&gt; bug report with your vendor, as they might have an
&gt;&gt; easier time reproducing the issue.
&gt;&gt;
&gt;&gt; It's worth noting that the libvirt version included in
&gt;&gt; Ubuntu 16.04 is a bit old (it was released a year and
&gt;&gt; a half ago), however the libvirt-guests script hasn't
&gt;&gt; changed very much in the meantime.
&gt;&gt;
&gt;&gt; --
&gt;&gt; Andrea Bolognani / Red Hat / Virtualization
&gt;&gt;
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Andrea,&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;I have libvirt \
version 1.3.1. I am looking at &lt;a \
href="http://libvirt.org/sources"&gt;libvirt.org/sources&lt;/a&gt; and see more recent \
versions. Do I have the most up-to-date version? Do I need to upgrade?&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;div \
class="gmail_default"&gt;$libvirtd -V  &lt;/div&gt;&lt;div class="gmail_default"&gt;libvirtd \
(libvirt) 1.3.1&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-10 11:24 GMT+02:00 Jędrek Domański &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:jedrek.domanski@gmail.com" \
target="_blank"&gt;jedrek.domanski@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="auto"&gt;Thank you, Andrea.&lt;div dir="auto"&gt;After \
following your instructions I re-enabled it back to check to see if it will log any \
messages from shutdown but no. I've noticed however that the computer no longer \
freezes at shutdown. I am not sure why but it looks like the problem is gone now. I \
will try to debugg it deeper and if I have any issues I will get back to \
you.&lt;/div&gt;&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
dir="auto"&gt;Jędrek&lt;/div&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class="HOEnZb"&gt;&lt;div class="h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;10 lip 2017 08:36 "Andrea \
Bolognani" &lt;&lt;a href="mailto:abologna@redhat.com" \
target="_blank"&gt;abologna@redhat.com&lt;/a&gt;&gt; napisał(a):&lt;br \
type="attribution"&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;On Sun, 2017-07-09 at 19:14 +0200, \
Dominik Psenner wrote:&lt;br&gt; &gt; I'm not familiar with the libvirt codebase, but \
the&lt;br&gt; &gt; extension of libvirt-guests.sh indicates that it is a&lt;br&gt;
&gt; shell script. Maybe you can modify it to find the spot&lt;br&gt;
&gt; where it hangs?&lt;br&gt;
&lt;br&gt;
That's indeed the case. On Debian/Ubuntu system, the&lt;br&gt;
script is installed as&lt;br&gt;
&lt;br&gt;
   /usr/lib/libvirt/libvirt-guest&lt;wbr&gt;s.sh&lt;br&gt;
&lt;br&gt;
and you can definitely try debugging it if you're&lt;br&gt;
familiar with shell scripting.&lt;br&gt;
&lt;br&gt;
I installed both libvirt-bin and qemu-kvm in an Ubuntu&lt;br&gt;
16.04 guest in an attempt to reproduce the issue you're&lt;br&gt;
having but I was unsuccessful, so I'm afraid I can't&lt;br&gt;
really help you much further.&lt;br&gt;
&lt;br&gt;
It would probably be a good idea to open a downstream&lt;br&gt;
bug report with your vendor, as they might have an&lt;br&gt;
easier time reproducing the issue.&lt;br&gt;
&lt;br&gt;
It's worth noting that the libvirt version included in&lt;br&gt;
Ubuntu 16.04 is a bit old (it was released a year and&lt;br&gt;
a half ago), however the libvirt-guests script hasn't&lt;br&gt;
changed very much in the meantime.&lt;br&gt;
&lt;br&gt;
--  &lt;br&gt;
Andrea Bolognani / Red Hat / Virtualization&lt;br&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170710131153</emailId><senderName>Andrea Bolognani</senderName><senderEmail>abologna@redhat.com</senderEmail><timestampReceived>2017-07-10 13:11:53-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

On Mon, 2017-07-10 at 14:20 +0200, Jędrek Domański wrote:
&gt; Andrea,
&gt; 
&gt; I have libvirt version 1.3.1. I am looking at
&gt; libvirt.org/sources and see more recent versions. Do I
&gt; have the most up-to-date version? Do I need to upgrade?
&gt; 
&gt; $libvirtd -V 
&gt; libvirtd (libvirt) 1.3.1

As mentioned in my previous message, libvirt 1.3.1 is
about a year and a half old.

While you can install a newer libvirt version from source,
doing so is generally not recommended because your package
manager will not be aware of it and will prevent you from
installing packages that depend on libvirt.

-- 
Andrea Bolognani / Red Hat / Virtualization

</body></email><email><emailId>20170710143703</emailId><senderName>Jędrek Domański</senderName><senderEmail>jedrek.domanski@gmail.com</senderEmail><timestampReceived>2017-07-10 14:37:03-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

Well, I see newer versions of libvirt on Launchpad so I could just add PPA
repository and install newer version from there. Would that work?

2017-07-10 15:11 GMT+02:00 Andrea Bolognani &lt;abologna@redhat.com&gt;:

&gt; On Mon, 2017-07-10 at 14:20 +0200, J=C4=99drek Doma=C5=84ski wrote:
&gt; &gt; Andrea,
&gt; &gt;
&gt; &gt; I have libvirt version 1.3.1. I am looking at
&gt; &gt; libvirt.org/sources and see more recent versions. Do I
&gt; &gt; have the most up-to-date version? Do I need to upgrade?
&gt; &gt;
&gt; &gt; $libvirtd -V
&gt; &gt; libvirtd (libvirt) 1.3.1
&gt;
&gt; As mentioned in my previous message, libvirt 1.3.1 is
&gt; about a year and a half old.
&gt;
&gt; While you can install a newer libvirt version from source,
&gt; doing so is generally not recommended because your package
&gt; manager will not be aware of it and will prevent you from
&gt; installing packages that depend on libvirt.
&gt;
&gt; --
&gt; Andrea Bolognani / Red Hat / Virtualization
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Well, I see newer versions of libvirt \
on Launchpad so I could just add PPA repository and install newer version from there. \
Would that work?&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-10 15:11 GMT+02:00 Andrea Bolognani &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:abologna@redhat.com" \
target="_blank"&gt;abologna@redhat.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span class=""&gt;On Mon, 2017-07-10 at 14:20 +0200, Jędrek \
Domański wrote:&lt;br&gt; &gt; Andrea,&lt;br&gt;
&gt;  &lt;br&gt;
&gt; I have libvirt version 1.3.1. I am looking at&lt;br&gt;
&gt; &lt;a href="http://libvirt.org/sources" rel="noreferrer" \
target="_blank"&gt;libvirt.org/sources&lt;/a&gt; and see more recent versions. Do I&lt;br&gt; &gt; \
have the most up-to-date version? Do I need to upgrade?&lt;br&gt; &gt;  &lt;br&gt;
&gt; $libvirtd -V  &lt;br&gt;
&gt; libvirtd (libvirt) 1.3.1&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;As mentioned in my previous message, libvirt 1.3.1 is&lt;br&gt;
about a year and a half old.&lt;br&gt;
&lt;br&gt;
While you can install a newer libvirt version from source,&lt;br&gt;
doing so is generally not recommended because your package&lt;br&gt;
manager will not be aware of it and will prevent you from&lt;br&gt;
installing packages that depend on libvirt.&lt;br&gt;
&lt;div class="HOEnZb"&gt;&lt;div class="h5"&gt;&lt;br&gt;
--  &lt;br&gt;
Andrea Bolognani / Red Hat / Virtualization&lt;br&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170703162746</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-07-03 16:27:46-0400</timestampReceived><subject>Re: [libvirt-users] Broken br0</subject><body>

Hi

I usually configure networks through /etc/network/interfaces especially
ones that virtual machines need.

Cheers

2017-07-03 14:44 GMT+02:00 &lt;virt.persik@9ox.net&gt;:

&gt; Hello,
&gt;
&gt; I wanted to get an extra IP on my local NIC, so I ran `sudo ip addr add
&gt; 192.168.1.130/24 dev enp4s0`. This didn't work as intended, so I thought
&gt; I'd restart the Ubuntu system to have things back to how they were.
&gt;
&gt; Alas, this didn't happen. While the host still has network as usual, none
&gt; of the VMs are able to get a DHCP lease from the router, or any
&gt; connectivity at all.
&gt;
&gt; I can still see br0 with `ip addr`, but my guess is that it's
&gt; misconfigured now.
&gt;
&gt; I tried adding a br1 with virt-manager (Edit &gt; Connection details &gt;
&gt; Network interfaces &gt; Add interface) and using that instead, but the app
&gt; crashed halfway through; and I can't disable or remove the connection with
&gt; the app now.
&gt;
&gt; I wonder if this isn't a routing issue, but I am not very proficient in
&gt; that area to troubleshoot and fix.
&gt;
&gt; Where should I start? I'd like to use this as an opportunity to learn more
&gt; about networking and VMs, so bear with me if I ask stupid/basic questions.
&gt; Thanks!
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;



-- 
Dominik Psenner

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;Hi&lt;br&gt;&lt;br&gt;&lt;/div&gt;I usually configure networks through \
/etc/network/interfaces especially ones that virtual machines \
need.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Cheers&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-03 14:44 GMT+02:00  &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:virt.persik@9ox.net" \
target="_blank"&gt;virt.persik@9ox.net&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hello, &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I wanted to get an \
extra IP on my local NIC, so I ran `sudo ip addr add &lt;a \
href="http://192.168.1.130/24" target="_blank"&gt;192.168.1.130/24&lt;/a&gt; dev enp4s0`. This \
didn't work as intended, so I thought I'd restart the Ubuntu system to have \
things back to how they were.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Alas, this didn't happen. \
While the host still has network as usual, none of the VMs are able to get a DHCP \
lease from the router, or any connectivity at all.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I can \
still see br0 with `ip addr`, but my guess is that it's misconfigured \
now.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I tried adding a br1 with virt-manager (Edit &gt; \
Connection details &gt; Network interfaces &gt; Add interface) and using that \
instead, but the app crashed halfway through; and I can't disable or remove the \
connection with the app now.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I wonder if this isn't a \
routing issue, but I am not very proficient in that area to troubleshoot and \
fix.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Where should I start? I'd like to use this as an \
opportunity to learn more about networking and VMs, so bear with me if I ask \
stupid/basic questions. Thanks!&lt;/div&gt;&lt;/div&gt; \
&lt;br&gt;______________________________&lt;wbr&gt;_________________&lt;br&gt; libvirt-users mailing \
list&lt;br&gt; &lt;a href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;
&lt;a href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/&lt;wbr&gt;mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br \
clear="all"&gt;&lt;br&gt;-- &lt;br&gt;&lt;div class="gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/div&gt;



</body></email><email><emailId>20170702083037</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-07-02 08:30:37-0400</timestampReceived><subject>Re: [libvirt-users] =?utf-8?b?562U5aSNOiAgdmlydHVhbCBkcml2ZSBwZXJm?= =?utf-8?q?ormance?=</subject><body>

Just a little catch-up. This time I was able to resolve the issue by doing:

virsh blockjob domain hda --abort
virsh blockcommit domain hda --active --pivot

Last time I had to shut down the virtual machine and do this while being
offline.

Thanks Wang for your valuable input. As far as the memory goes, there's
plenty of head room:

$ free -h
              total        used        free      shared  buff/cache
available
Mem:           7.8G        1.8G        407M        9.7M        5.5G
5.5G
Swap:          8.0G        619M        7.4G

2017-07-02 10:26 GMT+02:00 王李明 &lt;wanglm@certusnet.com.cn&gt;:

&gt; mybe this is because you physic host memory is small
&gt;
&gt; then this will Causing instability of the virtual machine
&gt;
&gt; But I'm just guessing
&gt;
&gt; You can try to increase your memory
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; Wang Liming
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; *发件人:* libvirt-users-bounces@redhat.com [mailto:libvirt-users-bounces@
&gt; redhat.com] *代表 *Dominik Psenner
&gt; *发送时间:* 2017年7月2日 16:22
&gt; *收件人:* libvirt-users@redhat.com
&gt; *主题:* Re: [libvirt-users] virtual drive performance
&gt;
&gt;
&gt;
&gt; Hi again,
&gt;
&gt; just today an issue I've thought to be resolved popped up again. We backup
&gt; the machine by doing:
&gt;
&gt; virsh snapshot-create-as --domain domain --name backup --no-metadata
&gt; --atomic --disk-only --diskspec hda,snapshot=external
&gt;
&gt; # backup hda.qcow2
&gt;
&gt; virsh blockcommit domain hda --active --pivot
&gt;
&gt; Every now and then this process fails with the following error message:
&gt;
&gt; error: failed to pivot job for disk hda
&gt; error: block copy still active: disk 'hda' not ready for pivot yet
&gt; Could not merge changes for disk hda of domain. VM may be in invalid state.
&gt;
&gt; I expect live backups are a great asset and should work. Is this a bug
&gt; that may relates also to the virtual drive performance issues we observe?
&gt;
&gt; Cheers
&gt;
&gt;
&gt;
&gt; 2017-07-02 10:10 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;
&gt; Hi
&gt;
&gt; a small update on this. I just migrated the vm from the site to my laptop
&gt; and fired it up. The exact same xml configuration (except file paths and
&gt; such) starts up and bursts with 50Mb/s to 115Mb/s in the guest. This allows
&gt; only one reasonable answer: the cpu on my laptop is somehow better suited
&gt; to emulate IO than the CPU built into the host on site. The host there is a
&gt; HP proliant microserver gen8 with xeon processor. But the processor there
&gt; is also never capped at 100% when the guest copies files.
&gt;
&gt; I just ran another test by copying a 3Gb large file on the guest. What I
&gt; can observe on my computer is that the copy process is not at a constant
&gt; rate but rather starts with 90Mb/s, then drops down to 30Mb/s, goes up to
&gt; 70Mb/s, drops down to 1Mb/s, goes up to 75Mb/s, drops to 1Mb/s, goes up to
&gt; 55Mb/s and the pattern continues. Please note that the drive is still
&gt; configured as:
&gt;
&gt; &lt;driver name='qemu' type='qcow2' cache='none' io='threads'/&gt;
&gt;
&gt; and I would expect a constant rate that is either high or low since there
&gt; is no caching involved and the underlying hard drive is a samsung ssd evo
&gt; 850. To have an idea how fast that drive is on my laptop:
&gt;
&gt; $ dd if=/dev/zero of=testfile bs=1M count=1000 oflag=direct
&gt; 1000+0 records in
&gt; 1000+0 records out
&gt; 1048576000 bytes (1.0 GB, 1000 MiB) copied, 2.47301 s, 424 MB/s
&gt;
&gt;
&gt;
&gt; I can further observe that the smaller the saved chunks are the slower the
&gt; overall performance is:
&gt;
&gt; dd if=/dev/zero of=testfile bs=512K count=1000 oflag=direct
&gt; 1000+0 records in
&gt; 1000+0 records out
&gt; 524288000 bytes (524 MB, 500 MiB) copied, 1.34874 s, 389 MB/s
&gt;
&gt; $ dd if=/dev/zero of=testfile bs=5K count=1000 oflag=direct
&gt; 1000+0 records in
&gt; 1000+0 records out
&gt; 5120000 bytes (5.1 MB, 4.9 MiB) copied, 0.105109 s, 48.7 MB/s
&gt;
&gt; $ dd if=/dev/zero of=testfile bs=1K count=10000 oflag=direct
&gt; 10000+0 records in
&gt; 10000+0 records out
&gt; 10240000 bytes (10 MB, 9.8 MiB) copied, 0.668438 s, 15.3 MB/s
&gt;
&gt; $ dd if=/dev/zero of=testfile bs=512 count=20000 oflag=direct
&gt; 20000+0 records in
&gt; 20000+0 records out
&gt; 10240000 bytes (10 MB, 9.8 MiB) copied, 1.10964 s, 9.2 MB/s
&gt;
&gt; Could this be a limiting factor? Does qemu/kvm do many many writes of just
&gt; a few bytes?
&gt;
&gt;
&gt; Ideas, anyone?
&gt;
&gt; Cheers
&gt;
&gt;
&gt;
&gt; 2017-06-21 20:46 GMT+02:00 Dan &lt;srwx4096@gmail.com&gt;:
&gt;
&gt; On Tue, Jun 20, 2017 at 04:24:32PM +0200, Gianluca Cecchi wrote:
&gt; &gt; On Tue, Jun 20, 2017 at 3:38 PM, Dominik Psenner &lt;dpsenner@gmail.com&gt;
&gt; wrote:
&gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; to the following:
&gt; &gt; &gt;
&gt; &gt; &gt; &lt;disk type='file' device='disk'&gt;
&gt; &gt; &gt;   &lt;driver name='qemu' type='qcow2' cache='none'/&gt;
&gt; &gt; &gt;   &lt;source file='/var/data/virtuals/machines/windows-server-2016-
&gt; &gt; &gt; x64/image.qcow2'/&gt;
&gt; &gt; &gt;   &lt;backingStore/&gt;
&gt; &gt; &gt;   &lt;target dev='hda' bus='scsi'/&gt;
&gt; &gt; &gt;   &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt; &gt; &gt; &lt;/disk&gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Do you see any gotchas in this configuration that could prevent the
&gt; &gt; &gt; virtualized guest to power on and boot up?
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; When I configure like this, from a linux guest point of view I get this
&gt; &gt; Symbios Logic SCSI Controller:
&gt; &gt; 00:08.0 SCSI storage controller: LSI Logic / Symbios Logic 53c895a
&gt; &gt;
&gt; &gt; But htis is true only if you add the SCSI controller too, not only the
&gt; disk
&gt; &gt; definition.
&gt; &gt; In my case
&gt; &gt;
&gt; &gt;     &lt;controller type='scsi' index='0'&gt;
&gt; &gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08'
&gt; &gt; function='0x0'/&gt;
&gt; &gt;     &lt;/controller&gt;
&gt; &gt;
&gt; &gt; Note the slot='0x08' that is reflected into the first field of lspci
&gt; inside
&gt; &gt; my linux guest.
&gt; &gt; So between your controllers you have to add the SCSI one
&gt; &gt;
&gt; &gt; In my case (Fedora 25 with virt-manager-1.4.1-2.fc25.noarch,
&gt; &gt; qemu-kvm-2.7.1-6.fc25.x86_64, libvirt-2.2.1-2.fc25.x86_64) with "Disk
&gt; bus"
&gt; &gt; set as SCSI in virt-manager, the xml defintiion for the guest is
&gt; &gt; automatically updated with the controller if not existent yet.
&gt; &gt; And the disk definition sections is like this:
&gt; &gt;
&gt; &gt;     &lt;disk type='file' device='disk'&gt;
&gt; &gt;       &lt;driver name='qemu' type='qcow2'/&gt;
&gt; &gt;       &lt;source file='/var/lib/libvirt/images/slaxsmall.qcow2'/&gt;
&gt; &gt;       &lt;target dev='sda' bus='scsi'/&gt;
&gt; &gt;       &lt;boot order='1'/&gt;
&gt; &gt;       &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt; &gt;     &lt;/disk&gt;
&gt; &gt;
&gt; &gt; So I think you should set dev='sda' and not 'hda' in your xml for it
&gt; &gt;
&gt;
&gt; I am actually very curious to know if that would make a difference. I
&gt; don't have a such windows vm images ready to test at present.
&gt;
&gt; Dan
&gt; &gt; I don't kknow if w2016 contains the symbios logic drivers already
&gt; &gt; installed, so that a "simple" reboot could imply an automatic
&gt; &gt; reconfiguration of the guest....
&gt; &gt; Note also that in Windows when the hw configuration is considered heavily
&gt; &gt; changed, you could be asked to register again (I don't think that the IDE
&gt; &gt; --&gt; SCSI should imply it...)
&gt; &gt;
&gt; &gt; Gianluca
&gt;
&gt; &gt; _______________________________________________
&gt; &gt; libvirt-users mailing list
&gt; &gt; libvirt-users@redhat.com
&gt; &gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;
&gt;
&gt;
&gt;
&gt; --
&gt;
&gt; Dominik Psenner
&gt;
&gt;
&gt;
&gt;
&gt; --
&gt;
&gt; Dominik Psenner
&gt;



-- 
Dominik Psenner

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Just a little catch-up. This time I was able to resolve \
the issue by doing:&lt;br&gt;&lt;br&gt;&lt;/div&gt;virsh blockjob domain hda --abort&lt;br&gt;&lt;/div&gt;virsh \
blockcommit domain hda --active --pivot&lt;br&gt;&lt;br&gt;&lt;/div&gt;Last  time I had to shut down \
the virtual machine and do this while being  offline.&lt;br&gt;&lt;br&gt;Thanks Wang for your \
valuable input. As far as the memory goes, there's plenty of head room:&lt;br&gt;&lt;br&gt;$ \
free -h&lt;br&gt;                           total               used               free     \
shared   buff/cache     available&lt;br&gt;Mem:                     7.8G               1.8G \
407M               9.7M               5.5G               5.5G&lt;br&gt;Swap:                \
8.0G               619M               7.4G&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-02 10:26 GMT+02:00 王李明 &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:wanglm@certusnet.com.cn" \
target="_blank"&gt;wanglm@certusnet.com.cn&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;








&lt;div link="blue" vlink="purple" lang="ZH-CN"&gt;

&lt;div class="m_2683241285725809605Section1"&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;mybe this is because you physic host memory is \
small&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;then this will Causing instability of the virtual \
machine&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;But I'm just guessing&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;You can try to increase your memory&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal" style="text-align:justify;text-justify:inter-ideograph"&gt;&lt;span \
style="font-size:10.5pt;font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal" style="text-align:justify;text-justify:inter-ideograph"&gt;&lt;span \
style="font-size:10.5pt;font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;Wang Liming&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal" style="text-align:justify;text-justify:inter-ideograph"&gt;&lt;span \
style="font-size:10.5pt;font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;  &lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div style="border:none;border-top:solid #b5c4df 1.0pt;padding:3.0pt 0cm 0cm 0cm"&gt;

&lt;p class="MsoNormal"&gt;&lt;b&gt;&lt;span style="font-size:10.0pt"&gt;发件人&lt;span \
lang="EN-US"&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;span style="font-size:10.0pt" lang="EN-US"&gt; &lt;a \
href="mailto:libvirt-users-bounces@redhat.com" \
target="_blank"&gt;libvirt-users-bounces@redhat.&lt;wbr&gt;com&lt;/a&gt; [mailto:&lt;a \
href="mailto:libvirt-users-bounces@redhat.com" \
target="_blank"&gt;libvirt-users-bounces@&lt;wbr&gt;redhat.com&lt;/a&gt;] &lt;/span&gt;&lt;b&gt;&lt;span \
style="font-size:10.0pt"&gt;代表 &lt;/span&gt;&lt;/b&gt;&lt;span style="font-size:10.0pt" \
lang="EN-US"&gt;Dominik Psenner&lt;br&gt; &lt;/span&gt;&lt;b&gt;&lt;span \
style="font-size:10.0pt"&gt;发送时间&lt;span lang="EN-US"&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;span \
style="font-size:10.0pt" lang="EN-US"&gt; 2017&lt;/span&gt;&lt;span \
style="font-size:10.0pt"&gt;年&lt;span lang="EN-US"&gt;7&lt;/span&gt;月&lt;span \
lang="EN-US"&gt;2&lt;/span&gt;日&lt;span lang="EN-US"&gt; 16:22&lt;br&gt; &lt;/span&gt;&lt;b&gt;收件人&lt;span \
lang="EN-US"&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US"&gt; &lt;a \
href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;/span&gt;&lt;b&gt;主题&lt;span \
lang="EN-US"&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US"&gt; Re: [libvirt-users] virtual drive \
performance&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;&lt;div&gt;&lt;div class="h5"&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;Hi \
again,&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;just today an
issue I've thought to be resolved popped up again. We backup the machine by
doing:&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;virsh snapshot-create-as --domain domain
--name backup --no-metadata --atomic --disk-only --diskspec
hda,snapshot=external&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;# backup hda.qcow2&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;virsh
blockcommit domain hda --active --pivot&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;Every now and
then this process fails with the following error message:&lt;br&gt;
&lt;br&gt;
error: failed to pivot job for disk hda&lt;br&gt;
error: block copy still active: disk 'hda' not ready for pivot yet&lt;br&gt;
Could not merge changes for disk hda of domain. VM may be in invalid \
state.&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;I expect live
backups are a great asset and should work. Is this a bug that may relates also
to the virtual drive performance issues we observe?&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Cheers&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;2017-07-02 10:10 GMT+02:00 Dominik Psenner
&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;:&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span \
lang="EN-US"&gt;Hi&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;a small update
on this. I just migrated the vm from the site to my laptop and fired it up. The
exact same xml configuration (except file paths and such) starts up and bursts
with 50Mb/s to 115Mb/s in the guest. This allows only one reasonable answer:
the cpu on my laptop is somehow better suited to emulate IO than the CPU built
into the host on site. The host there is a HP proliant microserver gen8 with
xeon processor. But the processor there is also never capped at 100% when the
guest copies files.&lt;br&gt;
&lt;br&gt;
I just ran another test by copying a 3Gb large file on the guest. What I can
observe on my computer is that the copy process is not at a constant rate but
rather starts with 90Mb/s, then drops down to 30Mb/s, goes up to 70Mb/s, drops
down to 1Mb/s, goes up to 75Mb/s, drops to 1Mb/s, goes up to 55Mb/s and the
pattern continues. Please note that the drive is still configured as:&lt;br&gt;
&lt;br&gt;
&lt;driver name='qemu' type='qcow2' cache='none' \
io='threads'/&gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;and I would expect a constant rate that is
either high or low since there is no caching involved and the underlying hard
drive is a samsung ssd evo 850. To have an idea how fast that drive is on my
laptop:&lt;br&gt;
&lt;br&gt;
$ dd if=/dev/zero of=testfile bs=1M count=1000 oflag=direct&lt;br&gt;
1000+0 records in&lt;br&gt;
1000+0 records out&lt;br&gt;
1048576000 bytes (1.0 GB, 1000 MiB) copied, 2.47301 s, 424 \
MB/s&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;I can further
observe that the smaller the saved chunks are the slower the overall
performance is:&lt;br&gt;
&lt;br&gt;
dd if=/dev/zero of=testfile bs=512K count=1000 oflag=direct&lt;br&gt;
1000+0 records in&lt;br&gt;
1000+0 records out&lt;br&gt;
524288000 bytes (524 MB, 500 MiB) copied, 1.34874 s, 389 MB/s&lt;br&gt;
&lt;br&gt;
$ dd if=/dev/zero of=testfile bs=5K count=1000 oflag=direct&lt;br&gt;
1000+0 records in&lt;br&gt;
1000+0 records out&lt;br&gt;
5120000 bytes (5.1 MB, 4.9 MiB) copied, 0.105109 s, 48.7 MB/s&lt;br&gt;
&lt;br&gt;
$ dd if=/dev/zero of=testfile bs=1K count=10000 oflag=direct&lt;br&gt;
10000+0 records in&lt;br&gt;
10000+0 records out&lt;br&gt;
10240000 bytes (10 MB, 9.8 MiB) copied, 0.668438 s, 15.3 MB/s&lt;br&gt;
&lt;br&gt;
$ dd if=/dev/zero of=testfile bs=512 count=20000 oflag=direct&lt;br&gt;
20000+0 records in&lt;br&gt;
20000+0 records out&lt;br&gt;
10240000 bytes (10 MB, 9.8 MiB) copied, 1.10964 s, 9.2 MB/s&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Could this be a limiting factor? Does
qemu/kvm do many many writes of just a few bytes?&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;&lt;br&gt;
Ideas, anyone?&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Cheers&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;2017-06-21 20:46 GMT+02:00 Dan &lt;&lt;a \
href="mailto:srwx4096@gmail.com" \
target="_blank"&gt;srwx4096@gmail.com&lt;/a&gt;&gt;:&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;blockquote style="border:none;border-left:solid #cccccc 1.0pt;padding:0cm 0cm 0cm \
6.0pt;margin-left:4.8pt;margin-right:0cm"&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;On Tue, Jun 20, 2017 at 04:24:32PM +0200,
Gianluca Cecchi wrote:&lt;br&gt;
&gt; On Tue, Jun 20, 2017 at 3:38 PM, Dominik Psenner &lt;&lt;a \
href="mailto:dpsenner@gmail.com" target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt; \
wrote:&lt;br&gt; &gt;&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; to the following:&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; &lt;disk type='file' device='disk'&gt;&lt;br&gt;
&gt; &gt;     &lt;driver name='qemu' type='qcow2' \
cache='none'/&gt;&lt;br&gt; &gt; &gt;     &lt;source
file='/var/data/virtuals/&lt;wbr&gt;machines/windows-server-2016-&lt;br&gt;
&gt; &gt; x64/image.qcow2'/&gt;&lt;br&gt;
&gt; &gt;     &lt;backingStore/&gt;&lt;br&gt;
&gt; &gt;     &lt;target dev='hda' bus='scsi'/&gt;&lt;br&gt;
&gt; &gt;     &lt;address type='drive' controller='0' bus='0'
target='0' unit='0'/&gt;&lt;br&gt;
&gt; &gt; &lt;/disk&gt;&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; Do you see any gotchas in this configuration that could prevent the&lt;br&gt;
&gt; &gt; virtualized guest to power on and boot up?&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; When I configure like this, from a linux guest point of view I get this&lt;br&gt;
&gt; Symbios Logic SCSI Controller:&lt;br&gt;
&gt; 00:08.0 SCSI storage controller: LSI Logic / Symbios Logic 53c895a&lt;br&gt;
&gt;&lt;br&gt;
&gt; But htis is true only if you add the SCSI controller too, not only the
disk&lt;br&gt;
&gt; definition.&lt;br&gt;
&gt; In my case&lt;br&gt;
&gt;&lt;br&gt;
&gt;        &lt;controller type='scsi' index='0'&gt;&lt;br&gt;
&gt;           &lt;address type='pci' domain='0x0000'
bus='0x00' slot='0x08'&lt;br&gt;
&gt; function='0x0'/&gt;&lt;br&gt;
&gt;        &lt;/controller&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; Note the slot='0x08' that is reflected into the first field of lspci
inside&lt;br&gt;
&gt; my linux guest.&lt;br&gt;
&gt; So between your controllers you have to add the SCSI one&lt;br&gt;
&gt;&lt;br&gt;
&gt; In my case (Fedora 25 with virt-manager-1.4.1-2.fc25.&lt;wbr&gt;noarch,&lt;br&gt;
&gt; qemu-kvm-2.7.1-6.fc25.x86_64, libvirt-2.2.1-2.fc25.x86_64) with "Disk
bus"&lt;br&gt;
&gt; set as SCSI in virt-manager, the xml defintiion for the guest is&lt;br&gt;
&gt; automatically updated with the controller if not existent yet.&lt;br&gt;
&gt; And the disk definition sections is like this:&lt;br&gt;
&gt;&lt;br&gt;
&gt;        &lt;disk type='file' device='disk'&gt;&lt;br&gt;
&gt;           &lt;driver name='qemu' type='qcow2'/&gt;&lt;br&gt;
&gt;           &lt;source \
file='/var/lib/libvirt/images/&lt;wbr&gt;slaxsmall.qcow2'/&gt;&lt;br&gt; &gt;           \
&lt;target dev='sda' bus='scsi'/&gt;&lt;br&gt; &gt;           &lt;boot \
order='1'/&gt;&lt;br&gt; &gt;           &lt;address type='drive' \
controller='0' bus='0' target='0' unit='0'/&gt;&lt;br&gt;
&gt;        &lt;/disk&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; So I think you should set dev='sda' and not 'hda' in your xml \
for it&lt;br&gt; &gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;I am actually
very curious to know if that would make a difference. I&lt;br&gt;
don't have a such windows vm images ready to test at present.&lt;br&gt;
&lt;span style="color:#888888"&gt;&lt;br&gt;
&lt;span class="m_2683241285725809605m-9222668100434188158hoenzb"&gt;Dan&lt;/span&gt;&lt;br&gt;
&lt;/span&gt;&lt;span class="m_2683241285725809605m-9222668100434188158im"&gt;&gt; I don't \
kknow if w2016 contains the symbios logic drivers already&lt;/span&gt;&lt;br&gt;
&lt;span class="m_2683241285725809605m-9222668100434188158im"&gt;&gt; installed, so that a
"simple" reboot could imply an automatic&lt;/span&gt;&lt;br&gt;
&lt;span class="m_2683241285725809605m-9222668100434188158im"&gt;&gt; reconfiguration of \
the guest....&lt;/span&gt;&lt;br&gt; &lt;span \
class="m_2683241285725809605m-9222668100434188158im"&gt;&gt; Note also that in Windows \
when the hw configuration is considered heavily&lt;/span&gt;&lt;br&gt;
&lt;span class="m_2683241285725809605m-9222668100434188158im"&gt;&gt; changed, you could be \
asked to register again (I don't think that the IDE&lt;/span&gt;&lt;br&gt;
&lt;span class="m_2683241285725809605m-9222668100434188158im"&gt;&gt; --&gt; SCSI should \
imply it...)&lt;/span&gt;&lt;br&gt; &lt;span \
class="m_2683241285725809605m-9222668100434188158im"&gt;&gt;&lt;/span&gt;&lt;br&gt; &lt;span \
class="m_2683241285725809605m-9222668100434188158im"&gt;&gt; \
Gianluca&lt;/span&gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;&gt;
______________________________&lt;wbr&gt;_________________&lt;br&gt;
&gt; libvirt-users mailing list&lt;br&gt;
&gt; &lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" \
target="_blank"&gt;https://www.redhat.com/&lt;wbr&gt;mailman/listinfo/libvirt-users&lt;/a&gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;


&lt;/div&gt;

&lt;/div&gt;

&lt;/blockquote&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span style="color:#888888" lang="EN-US"&gt;&lt;br&gt;
&lt;br clear="all"&gt;
&lt;br&gt;
&lt;span class="m_2683241285725809605hoenzb"&gt;-- &lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span style="color:#888888" lang="EN-US"&gt;Dominik \
Psenner&lt;/span&gt;&lt;span lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;br&gt;
&lt;br clear="all"&gt;
&lt;br&gt;
-- &lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Dominik Psenner&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;

&lt;/div&gt;


&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;br&gt;-- &lt;br&gt;&lt;div class="gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/div&gt;



</body></email><email><emailId>20170707071531</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-07-07 07:15:31-0400</timestampReceived><subject>Re: [libvirt-users] =?utf-8?b?562U5aSNOiAgdmlydHVhbCBkcml2ZSBwZXJm?= =?utf-8?q?ormance?=</subject><body>

Hi,

different day, same issue.. cronjob runs and fails:

$ virsh snapshot-create-as --domain domain --name backup --no-metadata
--atomic --disk-only --diskspec hda,snapshot=external
error: failed to pivot job for disk hda
error: block copy still active: disk 'hda' not ready for pivot yet
Could not merge changes for disk hda of domain. VM may be in invalid state.

Then running the following in the morning succeeds and successfully pivotes
the snapshot into the base image while the vm is live:

$ virsh blockjob domain hda --abort
$ virsh blockcommit domain hda --active --pivot
Successfully pivoted

This need of manual interventions is becoming a tiring job..

I someone else seeing the same issue or has an idea what the cause could be?
Can I trust the output and is the base image really up to the latest state?

Cheers

2017-07-02 10:30 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:

&gt; Just a little catch-up. This time I was able to resolve the issue by doing:
&gt;
&gt; virsh blockjob domain hda --abort
&gt; virsh blockcommit domain hda --active --pivot
&gt;
&gt; Last time I had to shut down the virtual machine and do this while being
&gt; offline.
&gt;
&gt; Thanks Wang for your valuable input. As far as the memory goes, there's
&gt; plenty of head room:
&gt;
&gt; $ free -h
&gt;               total        used        free      shared  buff/cache
&gt; available
&gt; Mem:           7.8G        1.8G        407M        9.7M        5.5G
&gt; 5.5G
&gt; Swap:          8.0G        619M        7.4G
&gt;
&gt; 2017-07-02 10:26 GMT+02:00 王李明 &lt;wanglm@certusnet.com.cn&gt;:
&gt;
&gt;&gt; mybe this is because you physic host memory is small
&gt;&gt;
&gt;&gt; then this will Causing instability of the virtual machine
&gt;&gt;
&gt;&gt; But I'm just guessing
&gt;&gt;
&gt;&gt; You can try to increase your memory
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; Wang Liming
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; *发件人:* libvirt-users-bounces@redhat.com [mailto:libvirt-users-bounces@
&gt;&gt; redhat.com] *代表 *Dominik Psenner
&gt;&gt; *发送时间:* 2017年7月2日 16:22
&gt;&gt; *收件人:* libvirt-users@redhat.com
&gt;&gt; *主题:* Re: [libvirt-users] virtual drive performance
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; Hi again,
&gt;&gt;
&gt;&gt; just today an issue I've thought to be resolved popped up again. We
&gt;&gt; backup the machine by doing:
&gt;&gt;
&gt;&gt; virsh snapshot-create-as --domain domain --name backup --no-metadata
&gt;&gt; --atomic --disk-only --diskspec hda,snapshot=external
&gt;&gt;
&gt;&gt; # backup hda.qcow2
&gt;&gt;
&gt;&gt; virsh blockcommit domain hda --active --pivot
&gt;&gt;
&gt;&gt; Every now and then this process fails with the following error message:
&gt;&gt;
&gt;&gt; error: failed to pivot job for disk hda
&gt;&gt; error: block copy still active: disk 'hda' not ready for pivot yet
&gt;&gt; Could not merge changes for disk hda of domain. VM may be in invalid
&gt;&gt; state.
&gt;&gt;
&gt;&gt; I expect live backups are a great asset and should work. Is this a bug
&gt;&gt; that may relates also to the virtual drive performance issues we observe?
&gt;&gt;
&gt;&gt; Cheers
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; 2017-07-02 10:10 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;&gt;
&gt;&gt; Hi
&gt;&gt;
&gt;&gt; a small update on this. I just migrated the vm from the site to my laptop
&gt;&gt; and fired it up. The exact same xml configuration (except file paths and
&gt;&gt; such) starts up and bursts with 50Mb/s to 115Mb/s in the guest. This allows
&gt;&gt; only one reasonable answer: the cpu on my laptop is somehow better suited
&gt;&gt; to emulate IO than the CPU built into the host on site. The host there is a
&gt;&gt; HP proliant microserver gen8 with xeon processor. But the processor there
&gt;&gt; is also never capped at 100% when the guest copies files.
&gt;&gt;
&gt;&gt; I just ran another test by copying a 3Gb large file on the guest. What I
&gt;&gt; can observe on my computer is that the copy process is not at a constant
&gt;&gt; rate but rather starts with 90Mb/s, then drops down to 30Mb/s, goes up to
&gt;&gt; 70Mb/s, drops down to 1Mb/s, goes up to 75Mb/s, drops to 1Mb/s, goes up to
&gt;&gt; 55Mb/s and the pattern continues. Please note that the drive is still
&gt;&gt; configured as:
&gt;&gt;
&gt;&gt; &lt;driver name='qemu' type='qcow2' cache='none' io='threads'/&gt;
&gt;&gt;
&gt;&gt; and I would expect a constant rate that is either high or low since there
&gt;&gt; is no caching involved and the underlying hard drive is a samsung ssd evo
&gt;&gt; 850. To have an idea how fast that drive is on my laptop:
&gt;&gt;
&gt;&gt; $ dd if=/dev/zero of=testfile bs=1M count=1000 oflag=direct
&gt;&gt; 1000+0 records in
&gt;&gt; 1000+0 records out
&gt;&gt; 1048576000 bytes (1.0 GB, 1000 MiB) copied, 2.47301 s, 424 MB/s
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; I can further observe that the smaller the saved chunks are the slower
&gt;&gt; the overall performance is:
&gt;&gt;
&gt;&gt; dd if=/dev/zero of=testfile bs=512K count=1000 oflag=direct
&gt;&gt; 1000+0 records in
&gt;&gt; 1000+0 records out
&gt;&gt; 524288000 bytes (524 MB, 500 MiB) copied, 1.34874 s, 389 MB/s
&gt;&gt;
&gt;&gt; $ dd if=/dev/zero of=testfile bs=5K count=1000 oflag=direct
&gt;&gt; 1000+0 records in
&gt;&gt; 1000+0 records out
&gt;&gt; 5120000 bytes (5.1 MB, 4.9 MiB) copied, 0.105109 s, 48.7 MB/s
&gt;&gt;
&gt;&gt; $ dd if=/dev/zero of=testfile bs=1K count=10000 oflag=direct
&gt;&gt; 10000+0 records in
&gt;&gt; 10000+0 records out
&gt;&gt; 10240000 bytes (10 MB, 9.8 MiB) copied, 0.668438 s, 15.3 MB/s
&gt;&gt;
&gt;&gt; $ dd if=/dev/zero of=testfile bs=512 count=20000 oflag=direct
&gt;&gt; 20000+0 records in
&gt;&gt; 20000+0 records out
&gt;&gt; 10240000 bytes (10 MB, 9.8 MiB) copied, 1.10964 s, 9.2 MB/s
&gt;&gt;
&gt;&gt; Could this be a limiting factor? Does qemu/kvm do many many writes of
&gt;&gt; just a few bytes?
&gt;&gt;
&gt;&gt;
&gt;&gt; Ideas, anyone?
&gt;&gt;
&gt;&gt; Cheers
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; 2017-06-21 20:46 GMT+02:00 Dan &lt;srwx4096@gmail.com&gt;:
&gt;&gt;
&gt;&gt; On Tue, Jun 20, 2017 at 04:24:32PM +0200, Gianluca Cecchi wrote:
&gt;&gt; &gt; On Tue, Jun 20, 2017 at 3:38 PM, Dominik Psenner &lt;dpsenner@gmail.com&gt;
&gt;&gt; wrote:
&gt;&gt; &gt;
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; to the following:
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; &lt;disk type='file' device='disk'&gt;
&gt;&gt; &gt; &gt;   &lt;driver name='qemu' type='qcow2' cache='none'/&gt;
&gt;&gt; &gt; &gt;   &lt;source file='/var/data/virtuals/machines/windows-server-2016-
&gt;&gt; &gt; &gt; x64/image.qcow2'/&gt;
&gt;&gt; &gt; &gt;   &lt;backingStore/&gt;
&gt;&gt; &gt; &gt;   &lt;target dev='hda' bus='scsi'/&gt;
&gt;&gt; &gt; &gt;   &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt;&gt; &gt; &gt; &lt;/disk&gt;
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; Do you see any gotchas in this configuration that could prevent the
&gt;&gt; &gt; &gt; virtualized guest to power on and boot up?
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; When I configure like this, from a linux guest point of view I get this
&gt;&gt; &gt; Symbios Logic SCSI Controller:
&gt;&gt; &gt; 00:08.0 SCSI storage controller: LSI Logic / Symbios Logic 53c895a
&gt;&gt; &gt;
&gt;&gt; &gt; But htis is true only if you add the SCSI controller too, not only the
&gt;&gt; disk
&gt;&gt; &gt; definition.
&gt;&gt; &gt; In my case
&gt;&gt; &gt;
&gt;&gt; &gt;     &lt;controller type='scsi' index='0'&gt;
&gt;&gt; &gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08'
&gt;&gt; &gt; function='0x0'/&gt;
&gt;&gt; &gt;     &lt;/controller&gt;
&gt;&gt; &gt;
&gt;&gt; &gt; Note the slot='0x08' that is reflected into the first field of lspci
&gt;&gt; inside
&gt;&gt; &gt; my linux guest.
&gt;&gt; &gt; So between your controllers you have to add the SCSI one
&gt;&gt; &gt;
&gt;&gt; &gt; In my case (Fedora 25 with virt-manager-1.4.1-2.fc25.noarch,
&gt;&gt; &gt; qemu-kvm-2.7.1-6.fc25.x86_64, libvirt-2.2.1-2.fc25.x86_64) with "Disk
&gt;&gt; bus"
&gt;&gt; &gt; set as SCSI in virt-manager, the xml defintiion for the guest is
&gt;&gt; &gt; automatically updated with the controller if not existent yet.
&gt;&gt; &gt; And the disk definition sections is like this:
&gt;&gt; &gt;
&gt;&gt; &gt;     &lt;disk type='file' device='disk'&gt;
&gt;&gt; &gt;       &lt;driver name='qemu' type='qcow2'/&gt;
&gt;&gt; &gt;       &lt;source file='/var/lib/libvirt/images/slaxsmall.qcow2'/&gt;
&gt;&gt; &gt;       &lt;target dev='sda' bus='scsi'/&gt;
&gt;&gt; &gt;       &lt;boot order='1'/&gt;
&gt;&gt; &gt;       &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt;&gt; &gt;     &lt;/disk&gt;
&gt;&gt; &gt;
&gt;&gt; &gt; So I think you should set dev='sda' and not 'hda' in your xml for it
&gt;&gt; &gt;
&gt;&gt;
&gt;&gt; I am actually very curious to know if that would make a difference. I
&gt;&gt; don't have a such windows vm images ready to test at present.
&gt;&gt;
&gt;&gt; Dan
&gt;&gt; &gt; I don't kknow if w2016 contains the symbios logic drivers already
&gt;&gt; &gt; installed, so that a "simple" reboot could imply an automatic
&gt;&gt; &gt; reconfiguration of the guest....
&gt;&gt; &gt; Note also that in Windows when the hw configuration is considered
&gt;&gt; heavily
&gt;&gt; &gt; changed, you could be asked to register again (I don't think that the
&gt;&gt; IDE
&gt;&gt; &gt; --&gt; SCSI should imply it...)
&gt;&gt; &gt;
&gt;&gt; &gt; Gianluca
&gt;&gt;
&gt;&gt; &gt; _______________________________________________
&gt;&gt; &gt; libvirt-users mailing list
&gt;&gt; &gt; libvirt-users@redhat.com
&gt;&gt; &gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt;
&gt;&gt; Dominik Psenner
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt;
&gt;&gt; Dominik Psenner
&gt;&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Dominik Psenner
&gt;



-- 
Dominik Psenner

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;different day, same issue.. cronjob runs and \
fails:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;$ virsh \
snapshot-create-as --domain domain --name backup --no-metadata --atomic --disk-only \
--diskspec hda,snapshot=external&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;error: failed to pivot job for disk hda&lt;/span&gt;&lt;br \
style="font-size:12.8px"&gt;&lt;span style="font-size:12.8px"&gt;error: block copy still \
active: disk 'hda' not ready for pivot yet&lt;/span&gt;&lt;br \
style="font-size:12.8px"&gt;&lt;span style="font-size:12.8px"&gt;Could not merge changes for \
disk hda of domain. VM may be in invalid state.&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;Then \
running the following in the morning succeeds and successfully pivotes the snapshot \
into the base image while the vm is live:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div style="font-size:12.8px"&gt;$ virsh \
blockjob domain hda --abort&lt;br&gt;&lt;/div&gt;&lt;span class="gmail-im" \
style="font-size:12.8px"&gt;$ virsh blockcommit domain hda --active --pivot&lt;/span&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span class="gmail-im"&gt;&lt;span \
style="font-size:12.8px"&gt;Successfully pivoted&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
class="gmail-im" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
class="gmail-im" style="font-size:12.8px"&gt;This need of manual interventions is \
becoming a tiring job..&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span class="gmail-im" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span class="gmail-im" \
style="font-size:12.8px"&gt;I someone else seeing the same issue or has an idea what the \
cause could be?&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span class="gmail-im" style="font-size:12.8px"&gt;Can \
I trust the output and is the base image really up to the latest \
state?&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span class="gmail-im" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span class="gmail-im" \
style="font-size:12.8px"&gt;Cheers&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-02 10:30 GMT+02:00 Dominik Psenner &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Just a little catch-up. This time I was able to resolve the \
issue by doing:&lt;br&gt;&lt;br&gt;&lt;/div&gt;virsh blockjob domain hda --abort&lt;br&gt;&lt;/div&gt;&lt;span \
class=""&gt;virsh blockcommit domain hda --active --pivot&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;Last  time \
I had to shut down the virtual machine and do this while being  \
offline.&lt;br&gt;&lt;br&gt;Thanks Wang for your valuable input. As far as the memory goes, \
there's plenty of head room:&lt;br&gt;&lt;br&gt;$ free -h&lt;br&gt;                           total \
used               free           shared   buff/cache     available&lt;br&gt;Mem:           \
7.8G               1.8G               407M               9.7M               5.5G      \
5.5G&lt;br&gt;Swap:                   8.0G               619M               \
7.4G&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;div&gt;&lt;div class="h5"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-02 10:26 GMT+02:00 王李明 &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:wanglm@certusnet.com.cn" \
target="_blank"&gt;wanglm@certusnet.com.cn&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;








&lt;div link="blue" vlink="purple" lang="ZH-CN"&gt;

&lt;div class="m_2863693438744199861m_2683241285725809605Section1"&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;mybe this is because you physic host memory is \
small&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;then this will Causing instability of the virtual \
machine&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;But I'm just guessing&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;You can try to increase your memory&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal" style="text-align:justify;text-justify:inter-ideograph"&gt;&lt;span \
style="font-size:10.5pt;font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal" style="text-align:justify;text-justify:inter-ideograph"&gt;&lt;span \
style="font-size:10.5pt;font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;Wang Liming&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal" style="text-align:justify;text-justify:inter-ideograph"&gt;&lt;span \
style="font-size:10.5pt;font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;  &lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div style="border:none;border-top:solid #b5c4df 1.0pt;padding:3.0pt 0cm 0cm 0cm"&gt;

&lt;p class="MsoNormal"&gt;&lt;b&gt;&lt;span style="font-size:10.0pt"&gt;发件人&lt;span \
lang="EN-US"&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;span style="font-size:10.0pt" lang="EN-US"&gt; &lt;a \
href="mailto:libvirt-users-bounces@redhat.com" \
target="_blank"&gt;libvirt-users-bounces@redhat.c&lt;wbr&gt;om&lt;/a&gt; [mailto:&lt;a \
href="mailto:libvirt-users-bounces@redhat.com" \
target="_blank"&gt;libvirt-users-bounces@&lt;wbr&gt;redhat.com&lt;/a&gt;] &lt;/span&gt;&lt;b&gt;&lt;span \
style="font-size:10.0pt"&gt;代表 &lt;/span&gt;&lt;/b&gt;&lt;span style="font-size:10.0pt" \
lang="EN-US"&gt;Dominik Psenner&lt;br&gt; &lt;/span&gt;&lt;b&gt;&lt;span \
style="font-size:10.0pt"&gt;发送时间&lt;span lang="EN-US"&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;span \
style="font-size:10.0pt" lang="EN-US"&gt; 2017&lt;/span&gt;&lt;span \
style="font-size:10.0pt"&gt;年&lt;span lang="EN-US"&gt;7&lt;/span&gt;月&lt;span \
lang="EN-US"&gt;2&lt;/span&gt;日&lt;span lang="EN-US"&gt; 16:22&lt;br&gt; &lt;/span&gt;&lt;b&gt;收件人&lt;span \
lang="EN-US"&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US"&gt; &lt;a \
href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;/span&gt;&lt;b&gt;主题&lt;span \
lang="EN-US"&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US"&gt; Re: [libvirt-users] virtual drive \
performance&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;&lt;div&gt;&lt;div class="m_2863693438744199861h5"&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;Hi \
again,&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;just today an
issue I've thought to be resolved popped up again. We backup the machine by
doing:&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;virsh snapshot-create-as --domain domain
--name backup --no-metadata --atomic --disk-only --diskspec
hda,snapshot=external&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;# backup hda.qcow2&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;virsh
blockcommit domain hda --active --pivot&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;Every now and
then this process fails with the following error message:&lt;br&gt;
&lt;br&gt;
error: failed to pivot job for disk hda&lt;br&gt;
error: block copy still active: disk 'hda' not ready for pivot yet&lt;br&gt;
Could not merge changes for disk hda of domain. VM may be in invalid \
state.&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;I expect live
backups are a great asset and should work. Is this a bug that may relates also
to the virtual drive performance issues we observe?&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Cheers&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;2017-07-02 10:10 GMT+02:00 Dominik Psenner
&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;:&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span \
lang="EN-US"&gt;Hi&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;a small update
on this. I just migrated the vm from the site to my laptop and fired it up. The
exact same xml configuration (except file paths and such) starts up and bursts
with 50Mb/s to 115Mb/s in the guest. This allows only one reasonable answer:
the cpu on my laptop is somehow better suited to emulate IO than the CPU built
into the host on site. The host there is a HP proliant microserver gen8 with
xeon processor. But the processor there is also never capped at 100% when the
guest copies files.&lt;br&gt;
&lt;br&gt;
I just ran another test by copying a 3Gb large file on the guest. What I can
observe on my computer is that the copy process is not at a constant rate but
rather starts with 90Mb/s, then drops down to 30Mb/s, goes up to 70Mb/s, drops
down to 1Mb/s, goes up to 75Mb/s, drops to 1Mb/s, goes up to 55Mb/s and the
pattern continues. Please note that the drive is still configured as:&lt;br&gt;
&lt;br&gt;
&lt;driver name='qemu' type='qcow2' cache='none' \
io='threads'/&gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;and I would expect a constant rate that is
either high or low since there is no caching involved and the underlying hard
drive is a samsung ssd evo 850. To have an idea how fast that drive is on my
laptop:&lt;br&gt;
&lt;br&gt;
$ dd if=/dev/zero of=testfile bs=1M count=1000 oflag=direct&lt;br&gt;
1000+0 records in&lt;br&gt;
1000+0 records out&lt;br&gt;
1048576000 bytes (1.0 GB, 1000 MiB) copied, 2.47301 s, 424 \
MB/s&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;I can further
observe that the smaller the saved chunks are the slower the overall
performance is:&lt;br&gt;
&lt;br&gt;
dd if=/dev/zero of=testfile bs=512K count=1000 oflag=direct&lt;br&gt;
1000+0 records in&lt;br&gt;
1000+0 records out&lt;br&gt;
524288000 bytes (524 MB, 500 MiB) copied, 1.34874 s, 389 MB/s&lt;br&gt;
&lt;br&gt;
$ dd if=/dev/zero of=testfile bs=5K count=1000 oflag=direct&lt;br&gt;
1000+0 records in&lt;br&gt;
1000+0 records out&lt;br&gt;
5120000 bytes (5.1 MB, 4.9 MiB) copied, 0.105109 s, 48.7 MB/s&lt;br&gt;
&lt;br&gt;
$ dd if=/dev/zero of=testfile bs=1K count=10000 oflag=direct&lt;br&gt;
10000+0 records in&lt;br&gt;
10000+0 records out&lt;br&gt;
10240000 bytes (10 MB, 9.8 MiB) copied, 0.668438 s, 15.3 MB/s&lt;br&gt;
&lt;br&gt;
$ dd if=/dev/zero of=testfile bs=512 count=20000 oflag=direct&lt;br&gt;
20000+0 records in&lt;br&gt;
20000+0 records out&lt;br&gt;
10240000 bytes (10 MB, 9.8 MiB) copied, 1.10964 s, 9.2 MB/s&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Could this be a limiting factor? Does
qemu/kvm do many many writes of just a few bytes?&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;&lt;br&gt;
Ideas, anyone?&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Cheers&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;2017-06-21 20:46 GMT+02:00 Dan &lt;&lt;a \
href="mailto:srwx4096@gmail.com" \
target="_blank"&gt;srwx4096@gmail.com&lt;/a&gt;&gt;:&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;blockquote style="border:none;border-left:solid #cccccc 1.0pt;padding:0cm 0cm 0cm \
6.0pt;margin-left:4.8pt;margin-right:0cm"&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;On Tue, Jun 20, 2017 at 04:24:32PM +0200,
Gianluca Cecchi wrote:&lt;br&gt;
&gt; On Tue, Jun 20, 2017 at 3:38 PM, Dominik Psenner &lt;&lt;a \
href="mailto:dpsenner@gmail.com" target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt; \
wrote:&lt;br&gt; &gt;&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; to the following:&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; &lt;disk type='file' device='disk'&gt;&lt;br&gt;
&gt; &gt;     &lt;driver name='qemu' type='qcow2' \
cache='none'/&gt;&lt;br&gt; &gt; &gt;     &lt;source
file='/var/data/virtuals/machi&lt;wbr&gt;nes/windows-server-2016-&lt;br&gt;
&gt; &gt; x64/image.qcow2'/&gt;&lt;br&gt;
&gt; &gt;     &lt;backingStore/&gt;&lt;br&gt;
&gt; &gt;     &lt;target dev='hda' bus='scsi'/&gt;&lt;br&gt;
&gt; &gt;     &lt;address type='drive' controller='0' bus='0'
target='0' unit='0'/&gt;&lt;br&gt;
&gt; &gt; &lt;/disk&gt;&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; Do you see any gotchas in this configuration that could prevent the&lt;br&gt;
&gt; &gt; virtualized guest to power on and boot up?&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; When I configure like this, from a linux guest point of view I get this&lt;br&gt;
&gt; Symbios Logic SCSI Controller:&lt;br&gt;
&gt; 00:08.0 SCSI storage controller: LSI Logic / Symbios Logic 53c895a&lt;br&gt;
&gt;&lt;br&gt;
&gt; But htis is true only if you add the SCSI controller too, not only the
disk&lt;br&gt;
&gt; definition.&lt;br&gt;
&gt; In my case&lt;br&gt;
&gt;&lt;br&gt;
&gt;        &lt;controller type='scsi' index='0'&gt;&lt;br&gt;
&gt;           &lt;address type='pci' domain='0x0000'
bus='0x00' slot='0x08'&lt;br&gt;
&gt; function='0x0'/&gt;&lt;br&gt;
&gt;        &lt;/controller&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; Note the slot='0x08' that is reflected into the first field of lspci
inside&lt;br&gt;
&gt; my linux guest.&lt;br&gt;
&gt; So between your controllers you have to add the SCSI one&lt;br&gt;
&gt;&lt;br&gt;
&gt; In my case (Fedora 25 with virt-manager-1.4.1-2.fc25.noar&lt;wbr&gt;ch,&lt;br&gt;
&gt; qemu-kvm-2.7.1-6.fc25.x86_64, libvirt-2.2.1-2.fc25.x86_64) with "Disk
bus"&lt;br&gt;
&gt; set as SCSI in virt-manager, the xml defintiion for the guest is&lt;br&gt;
&gt; automatically updated with the controller if not existent yet.&lt;br&gt;
&gt; And the disk definition sections is like this:&lt;br&gt;
&gt;&lt;br&gt;
&gt;        &lt;disk type='file' device='disk'&gt;&lt;br&gt;
&gt;           &lt;driver name='qemu' type='qcow2'/&gt;&lt;br&gt;
&gt;           &lt;source \
file='/var/lib/libvirt/images/&lt;wbr&gt;slaxsmall.qcow2'/&gt;&lt;br&gt; &gt;           \
&lt;target dev='sda' bus='scsi'/&gt;&lt;br&gt; &gt;           &lt;boot \
order='1'/&gt;&lt;br&gt; &gt;           &lt;address type='drive' \
controller='0' bus='0' target='0' unit='0'/&gt;&lt;br&gt;
&gt;        &lt;/disk&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; So I think you should set dev='sda' and not 'hda' in your xml \
for it&lt;br&gt; &gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;I am actually
very curious to know if that would make a difference. I&lt;br&gt;
don't have a such windows vm images ready to test at present.&lt;br&gt;
&lt;span style="color:#888888"&gt;&lt;br&gt;
&lt;span class="m_2863693438744199861m_2683241285725809605m-9222668100434188158hoenzb"&gt;Dan&lt;/span&gt;&lt;br&gt;
 &lt;/span&gt;&lt;span class="m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt; \
I don't kknow if w2016 contains the symbios logic drivers already&lt;/span&gt;&lt;br&gt;
&lt;span class="m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt; \
installed, so that a "simple" reboot could imply an automatic&lt;/span&gt;&lt;br&gt;
&lt;span class="m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt; \
reconfiguration of the guest....&lt;/span&gt;&lt;br&gt; &lt;span \
class="m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt; Note \
also that in Windows when the hw configuration is considered heavily&lt;/span&gt;&lt;br&gt;
&lt;span class="m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt; \
changed, you could be asked to register again (I don't think that the \
IDE&lt;/span&gt;&lt;br&gt; &lt;span \
class="m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt; --&gt; \
SCSI should imply it...)&lt;/span&gt;&lt;br&gt; &lt;span \
class="m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt;&lt;/span&gt;&lt;br&gt;
 &lt;span class="m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt; \
Gianluca&lt;/span&gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;&gt;
______________________________&lt;wbr&gt;_________________&lt;br&gt;
&gt; libvirt-users mailing list&lt;br&gt;
&gt; &lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;


&lt;/div&gt;

&lt;/div&gt;

&lt;/blockquote&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span style="color:#888888" lang="EN-US"&gt;&lt;br&gt;
&lt;br clear="all"&gt;
&lt;br&gt;
&lt;span class="m_2863693438744199861m_2683241285725809605hoenzb"&gt;-- \
&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span style="color:#888888" lang="EN-US"&gt;Dominik \
Psenner&lt;/span&gt;&lt;span lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;br&gt;
&lt;br clear="all"&gt;
&lt;br&gt;
-- &lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Dominik Psenner&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;

&lt;/div&gt;


&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;span class="HOEnZb"&gt;&lt;font \
color="#888888"&gt;-- &lt;br&gt;&lt;div class="m_2863693438744199861gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- \
&lt;br&gt;&lt;div class="gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div \
dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;



</body></email><email><emailId>20170706003931</emailId><senderName>Charles Shih</senderName><senderEmail>cheshi@redhat.com</senderEmail><timestampReceived>2017-07-06 00:39:31-0400</timestampReceived><subject>Re: [libvirt-users] Question about disabling '3dnowprefetch' CPU feature in Xen Guest using libvirt</subject><body>

Hi Jim,

  Thank you for the great support and expertise. It helps so much! :-)

Regards,
Charles

Charles Shih (史晨)
Quality Engineer
Red Hat, Platform QE, Virt QE, Section 1
Email: cheshi@redhat.com
IRC: cheshi @ #eng-china, #hyperv ,#qa, #virt
T: +86 10 65627484  - IP: 8387484
M: +86 18611268098


On Wed, Jul 5, 2017 at 11:42 PM, Jim Fehlig &lt;jfehlig@suse.com&gt; wrote:

&gt; On 06/18/2017 09:01 PM, Charles Shih wrote:
&gt;
&gt;&gt; Dear All,
&gt;&gt;
&gt;&gt;      I'm reaching this mail-list to ask a small question about disabling
&gt;&gt; '3dnowprefetch' CPU feature in Xen Guest using libvirt.
&gt;&gt;
&gt;&gt;      This is my environment:
&gt;&gt;      Fedora release 26 (Twenty Six)
&gt;&gt;      4.11.0-0.rc3.git0.2.fc26.x86_64
&gt;&gt;      xen-4.8.1-2.fc26.x86_64
&gt;&gt;      libvirt-3.2.1-1.fc26.x86_64
&gt;&gt;
&gt;&gt;      I can disable '3dnowprefetch' CPU feature in guest via 'xl' command,
&gt;&gt; with adding `cpuid='host,3dnowprefetch=0'` into the CFG file.
&gt;&gt;
&gt;&gt;      However, follow the instruction (https://libvirt.org/formatdom
&gt;&gt; ain.html#elementsCPU &lt;https://libvirt.org/formatdomain.html#elementsCPU&gt;),
&gt;&gt; I added the following block into my XML file:
&gt;&gt;
&gt;&gt; ```
&gt;&gt;    &lt;cpu mode='host-passthrough' check='none'&gt;
&gt;&gt;      &lt;feature policy='disable' name='3dnowprefetch'/&gt;
&gt;&gt;    &lt;/cpu&gt;
&gt;&gt; ```
&gt;&gt;
&gt;&gt;      Created the instance, seemed this feature was not being disabled in
&gt;&gt; my guest. (I was able to see '3dnowprefetch' in `lscpu` outputs)
&gt;&gt;
&gt;&gt;      Anybody has idea on this? Does libvirt support this for Xen?
&gt;&gt;
&gt;
&gt; Currently, the libvirt libxl driver only supports VMX or SVM CPU feature,
&gt; and for that you'd need libvirt 3.3.0
&gt;
&gt; http://libvirt.org/git/?p=libvirt.git;a=commit;h=c268b9eaeb4
&gt; 321ef311ae2e152b80752918eb289
&gt;
&gt; More support for CPU customization is on the todo list. Contributions are
&gt; always warmly welcomed :-).
&gt;
&gt; Regards,
&gt; Jim
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi Jim,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;   Thank you for the great support and \
expertise. It helps so much! \
:-)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regards,&lt;/div&gt;&lt;div&gt;Charles&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div class="gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;&lt;pre&gt;Charles Shih (史晨) Quality \
Engineer Red Hat, Platform QE, Virt QE, Section 1
Email: &lt;a href="mailto:cheshi@redhat.com" target="_blank"&gt;cheshi@redhat.com&lt;/a&gt;
IRC: cheshi @ #eng-china, #hyperv ,#qa, #virt
T: +86 10 65627484  - IP: 8387484
M: +86 18611268098&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;br&gt;&lt;div class="gmail_quote"&gt;On Wed, Jul 5, 2017 at 11:42 PM, Jim Fehlig &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:jfehlig@suse.com" \
target="_blank"&gt;jfehlig@suse.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span class=""&gt;On 06/18/2017 09:01 PM, Charles Shih \
wrote:&lt;br&gt; &lt;/span&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;span class=""&gt; Dear All,&lt;br&gt;
&lt;br&gt;
        I'm reaching this mail-list to ask a small question about disabling \
'3dnowprefetch' CPU feature in Xen Guest using libvirt.&lt;br&gt; &lt;br&gt;
        This is my environment:&lt;br&gt;
        Fedora release 26 (Twenty Six)&lt;br&gt;
        4.11.0-0.rc3.git0.2.fc26.x86_&lt;wbr&gt;64&lt;br&gt;
        xen-4.8.1-2.fc26.x86_64&lt;br&gt;
        libvirt-3.2.1-1.fc26.x86_64&lt;br&gt;
&lt;br&gt;
        I can disable '3dnowprefetch' CPU feature in guest via 'xl' \
command, with adding `cpuid='host,3dnowprefetch=0'` into the CFG file.&lt;br&gt; \
&lt;br&gt;&lt;/span&gt;  However, follow the instruction (&lt;a \
href="https://libvirt.org/formatdomain.html#elementsCPU" rel="noreferrer" \
target="_blank"&gt;https://libvirt.org/formatdom&lt;wbr&gt;ain.html#elementsCPU&lt;/a&gt; &lt;&lt;a \
href="https://libvirt.org/formatdomain.html#elementsCPU" rel="noreferrer" \
target="_blank"&gt;https://libvirt.org/formatdom&lt;wbr&gt;ain.html#elementsCPU&lt;/a&gt;&gt;), I \
added the following block into my XML file:&lt;span class=""&gt;&lt;br&gt; &lt;br&gt;
```&lt;br&gt;
     &lt;cpu mode='host-passthrough' check='none'&gt;&lt;br&gt;
        &lt;feature policy='disable' name='3dnowprefetch'/&gt;&lt;br&gt;
     &lt;/cpu&gt;&lt;br&gt;
```&lt;br&gt;
&lt;br&gt;
        Created the instance, seemed this feature was not being disabled in my guest. \
(I was able to see '3dnowprefetch' in `lscpu` outputs)&lt;br&gt; &lt;br&gt;
        Anybody has idea on this? Does libvirt support this for Xen?&lt;br&gt;
&lt;/span&gt;&lt;/blockquote&gt;
&lt;br&gt;
Currently, the libvirt libxl driver only supports VMX or SVM CPU feature, and for \
that you'd need libvirt 3.3.0&lt;br&gt; &lt;br&gt;
&lt;a href="http://libvirt.org/git/?p=libvirt.git;a=commit;h=c268b9eaeb4321ef311ae2e152b80752918eb289" \
rel="noreferrer" target="_blank"&gt;http://libvirt.org/git/?p=libv&lt;wbr&gt;irt.git;a=commit;h=c268b9eaeb4&lt;wbr&gt;321ef311ae2e152b80752918eb289&lt;/a&gt;&lt;br&gt;
 &lt;br&gt;
More support for CPU customization is on the todo list. Contributions are always \
warmly welcomed :-).&lt;br&gt; &lt;br&gt;
Regards,&lt;br&gt;
Jim&lt;br&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170707072116</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-07-07 07:21:16-0400</timestampReceived><subject>Re: [libvirt-users] =?utf-8?b?562U5aSNOiAgdmlydHVhbCBkcml2ZSBwZXJm?= =?utf-8?q?ormance?=</subject><body>

Of course the cronjob fails when trying to virsh blockcommit and not when
creating the snapshot, sorry for the noise.

2017-07-07 9:15 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:

&gt; Hi,
&gt;
&gt; different day, same issue.. cronjob runs and fails:
&gt;
&gt; $ virsh snapshot-create-as --domain domain --name backup --no-metadata
&gt; --atomic --disk-only --diskspec hda,snapshot=external
&gt; error: failed to pivot job for disk hda
&gt; error: block copy still active: disk 'hda' not ready for pivot yet
&gt; Could not merge changes for disk hda of domain. VM may be in invalid state.
&gt;
&gt; Then running the following in the morning succeeds and successfully
&gt; pivotes the snapshot into the base image while the vm is live:
&gt;
&gt; $ virsh blockjob domain hda --abort
&gt; $ virsh blockcommit domain hda --active --pivot
&gt; Successfully pivoted
&gt;
&gt; This need of manual interventions is becoming a tiring job..
&gt;
&gt; I someone else seeing the same issue or has an idea what the cause could
&gt; be?
&gt; Can I trust the output and is the base image really up to the latest state?
&gt;
&gt; Cheers
&gt;
&gt; 2017-07-02 10:30 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;
&gt;&gt; Just a little catch-up. This time I was able to resolve the issue by
&gt;&gt; doing:
&gt;&gt;
&gt;&gt; virsh blockjob domain hda --abort
&gt;&gt; virsh blockcommit domain hda --active --pivot
&gt;&gt;
&gt;&gt; Last time I had to shut down the virtual machine and do this while being
&gt;&gt; offline.
&gt;&gt;
&gt;&gt; Thanks Wang for your valuable input. As far as the memory goes, there's
&gt;&gt; plenty of head room:
&gt;&gt;
&gt;&gt; $ free -h
&gt;&gt;               total        used        free      shared  buff/cache
&gt;&gt; available
&gt;&gt; Mem:           7.8G        1.8G        407M        9.7M
&gt;&gt; 5.5G        5.5G
&gt;&gt; Swap:          8.0G        619M        7.4G
&gt;&gt;
&gt;&gt; 2017-07-02 10:26 GMT+02:00 王李明 &lt;wanglm@certusnet.com.cn&gt;:
&gt;&gt;
&gt;&gt;&gt; mybe this is because you physic host memory is small
&gt;&gt;&gt;
&gt;&gt;&gt; then this will Causing instability of the virtual machine
&gt;&gt;&gt;
&gt;&gt;&gt; But I'm just guessing
&gt;&gt;&gt;
&gt;&gt;&gt; You can try to increase your memory
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Wang Liming
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; *发件人:* libvirt-users-bounces@redhat.com [mailto:libvirt-users-bounces@
&gt;&gt;&gt; redhat.com] *代表 *Dominik Psenner
&gt;&gt;&gt; *发送时间:* 2017年7月2日 16:22
&gt;&gt;&gt; *收件人:* libvirt-users@redhat.com
&gt;&gt;&gt; *主题:* Re: [libvirt-users] virtual drive performance
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Hi again,
&gt;&gt;&gt;
&gt;&gt;&gt; just today an issue I've thought to be resolved popped up again. We
&gt;&gt;&gt; backup the machine by doing:
&gt;&gt;&gt;
&gt;&gt;&gt; virsh snapshot-create-as --domain domain --name backup --no-metadata
&gt;&gt;&gt; --atomic --disk-only --diskspec hda,snapshot=external
&gt;&gt;&gt;
&gt;&gt;&gt; # backup hda.qcow2
&gt;&gt;&gt;
&gt;&gt;&gt; virsh blockcommit domain hda --active --pivot
&gt;&gt;&gt;
&gt;&gt;&gt; Every now and then this process fails with the following error message:
&gt;&gt;&gt;
&gt;&gt;&gt; error: failed to pivot job for disk hda
&gt;&gt;&gt; error: block copy still active: disk 'hda' not ready for pivot yet
&gt;&gt;&gt; Could not merge changes for disk hda of domain. VM may be in invalid
&gt;&gt;&gt; state.
&gt;&gt;&gt;
&gt;&gt;&gt; I expect live backups are a great asset and should work. Is this a bug
&gt;&gt;&gt; that may relates also to the virtual drive performance issues we observe?
&gt;&gt;&gt;
&gt;&gt;&gt; Cheers
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; 2017-07-02 10:10 GMT+02:00 Dominik Psenner &lt;dpsenner@gmail.com&gt;:
&gt;&gt;&gt;
&gt;&gt;&gt; Hi
&gt;&gt;&gt;
&gt;&gt;&gt; a small update on this. I just migrated the vm from the site to my
&gt;&gt;&gt; laptop and fired it up. The exact same xml configuration (except file paths
&gt;&gt;&gt; and such) starts up and bursts with 50Mb/s to 115Mb/s in the guest. This
&gt;&gt;&gt; allows only one reasonable answer: the cpu on my laptop is somehow better
&gt;&gt;&gt; suited to emulate IO than the CPU built into the host on site. The host
&gt;&gt;&gt; there is a HP proliant microserver gen8 with xeon processor. But the
&gt;&gt;&gt; processor there is also never capped at 100% when the guest copies files.
&gt;&gt;&gt;
&gt;&gt;&gt; I just ran another test by copying a 3Gb large file on the guest. What I
&gt;&gt;&gt; can observe on my computer is that the copy process is not at a constant
&gt;&gt;&gt; rate but rather starts with 90Mb/s, then drops down to 30Mb/s, goes up to
&gt;&gt;&gt; 70Mb/s, drops down to 1Mb/s, goes up to 75Mb/s, drops to 1Mb/s, goes up to
&gt;&gt;&gt; 55Mb/s and the pattern continues. Please note that the drive is still
&gt;&gt;&gt; configured as:
&gt;&gt;&gt;
&gt;&gt;&gt; &lt;driver name='qemu' type='qcow2' cache='none' io='threads'/&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; and I would expect a constant rate that is either high or low since
&gt;&gt;&gt; there is no caching involved and the underlying hard drive is a samsung ssd
&gt;&gt;&gt; evo 850. To have an idea how fast that drive is on my laptop:
&gt;&gt;&gt;
&gt;&gt;&gt; $ dd if=/dev/zero of=testfile bs=1M count=1000 oflag=direct
&gt;&gt;&gt; 1000+0 records in
&gt;&gt;&gt; 1000+0 records out
&gt;&gt;&gt; 1048576000 bytes (1.0 GB, 1000 MiB) copied, 2.47301 s, 424 MB/s
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; I can further observe that the smaller the saved chunks are the slower
&gt;&gt;&gt; the overall performance is:
&gt;&gt;&gt;
&gt;&gt;&gt; dd if=/dev/zero of=testfile bs=512K count=1000 oflag=direct
&gt;&gt;&gt; 1000+0 records in
&gt;&gt;&gt; 1000+0 records out
&gt;&gt;&gt; 524288000 bytes (524 MB, 500 MiB) copied, 1.34874 s, 389 MB/s
&gt;&gt;&gt;
&gt;&gt;&gt; $ dd if=/dev/zero of=testfile bs=5K count=1000 oflag=direct
&gt;&gt;&gt; 1000+0 records in
&gt;&gt;&gt; 1000+0 records out
&gt;&gt;&gt; 5120000 bytes (5.1 MB, 4.9 MiB) copied, 0.105109 s, 48.7 MB/s
&gt;&gt;&gt;
&gt;&gt;&gt; $ dd if=/dev/zero of=testfile bs=1K count=10000 oflag=direct
&gt;&gt;&gt; 10000+0 records in
&gt;&gt;&gt; 10000+0 records out
&gt;&gt;&gt; 10240000 bytes (10 MB, 9.8 MiB) copied, 0.668438 s, 15.3 MB/s
&gt;&gt;&gt;
&gt;&gt;&gt; $ dd if=/dev/zero of=testfile bs=512 count=20000 oflag=direct
&gt;&gt;&gt; 20000+0 records in
&gt;&gt;&gt; 20000+0 records out
&gt;&gt;&gt; 10240000 bytes (10 MB, 9.8 MiB) copied, 1.10964 s, 9.2 MB/s
&gt;&gt;&gt;
&gt;&gt;&gt; Could this be a limiting factor? Does qemu/kvm do many many writes of
&gt;&gt;&gt; just a few bytes?
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Ideas, anyone?
&gt;&gt;&gt;
&gt;&gt;&gt; Cheers
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; 2017-06-21 20:46 GMT+02:00 Dan &lt;srwx4096@gmail.com&gt;:
&gt;&gt;&gt;
&gt;&gt;&gt; On Tue, Jun 20, 2017 at 04:24:32PM +0200, Gianluca Cecchi wrote:
&gt;&gt;&gt; &gt; On Tue, Jun 20, 2017 at 3:38 PM, Dominik Psenner &lt;dpsenner@gmail.com&gt;
&gt;&gt;&gt; wrote:
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; &gt;
&gt;&gt;&gt; &gt; &gt; to the following:
&gt;&gt;&gt; &gt; &gt;
&gt;&gt;&gt; &gt; &gt; &lt;disk type='file' device='disk'&gt;
&gt;&gt;&gt; &gt; &gt;   &lt;driver name='qemu' type='qcow2' cache='none'/&gt;
&gt;&gt;&gt; &gt; &gt;   &lt;source file='/var/data/virtuals/machines/windows-server-2016-
&gt;&gt;&gt; &gt; &gt; x64/image.qcow2'/&gt;
&gt;&gt;&gt; &gt; &gt;   &lt;backingStore/&gt;
&gt;&gt;&gt; &gt; &gt;   &lt;target dev='hda' bus='scsi'/&gt;
&gt;&gt;&gt; &gt; &gt;   &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt;&gt;&gt; &gt; &gt; &lt;/disk&gt;
&gt;&gt;&gt; &gt; &gt;
&gt;&gt;&gt; &gt; &gt; Do you see any gotchas in this configuration that could prevent the
&gt;&gt;&gt; &gt; &gt; virtualized guest to power on and boot up?
&gt;&gt;&gt; &gt; &gt;
&gt;&gt;&gt; &gt; &gt;
&gt;&gt;&gt; &gt; When I configure like this, from a linux guest point of view I get this
&gt;&gt;&gt; &gt; Symbios Logic SCSI Controller:
&gt;&gt;&gt; &gt; 00:08.0 SCSI storage controller: LSI Logic / Symbios Logic 53c895a
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; But htis is true only if you add the SCSI controller too, not only the
&gt;&gt;&gt; disk
&gt;&gt;&gt; &gt; definition.
&gt;&gt;&gt; &gt; In my case
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt;     &lt;controller type='scsi' index='0'&gt;
&gt;&gt;&gt; &gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08'
&gt;&gt;&gt; &gt; function='0x0'/&gt;
&gt;&gt;&gt; &gt;     &lt;/controller&gt;
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Note the slot='0x08' that is reflected into the first field of lspci
&gt;&gt;&gt; inside
&gt;&gt;&gt; &gt; my linux guest.
&gt;&gt;&gt; &gt; So between your controllers you have to add the SCSI one
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; In my case (Fedora 25 with virt-manager-1.4.1-2.fc25.noarch,
&gt;&gt;&gt; &gt; qemu-kvm-2.7.1-6.fc25.x86_64, libvirt-2.2.1-2.fc25.x86_64) with "Disk
&gt;&gt;&gt; bus"
&gt;&gt;&gt; &gt; set as SCSI in virt-manager, the xml defintiion for the guest is
&gt;&gt;&gt; &gt; automatically updated with the controller if not existent yet.
&gt;&gt;&gt; &gt; And the disk definition sections is like this:
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt;     &lt;disk type='file' device='disk'&gt;
&gt;&gt;&gt; &gt;       &lt;driver name='qemu' type='qcow2'/&gt;
&gt;&gt;&gt; &gt;       &lt;source file='/var/lib/libvirt/images/slaxsmall.qcow2'/&gt;
&gt;&gt;&gt; &gt;       &lt;target dev='sda' bus='scsi'/&gt;
&gt;&gt;&gt; &gt;       &lt;boot order='1'/&gt;
&gt;&gt;&gt; &gt;       &lt;address type='drive' controller='0' bus='0' target='0'
&gt;&gt;&gt; unit='0'/&gt;
&gt;&gt;&gt; &gt;     &lt;/disk&gt;
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; So I think you should set dev='sda' and not 'hda' in your xml for it
&gt;&gt;&gt; &gt;
&gt;&gt;&gt;
&gt;&gt;&gt; I am actually very curious to know if that would make a difference. I
&gt;&gt;&gt; don't have a such windows vm images ready to test at present.
&gt;&gt;&gt;
&gt;&gt;&gt; Dan
&gt;&gt;&gt; &gt; I don't kknow if w2016 contains the symbios logic drivers already
&gt;&gt;&gt; &gt; installed, so that a "simple" reboot could imply an automatic
&gt;&gt;&gt; &gt; reconfiguration of the guest....
&gt;&gt;&gt; &gt; Note also that in Windows when the hw configuration is considered
&gt;&gt;&gt; heavily
&gt;&gt;&gt; &gt; changed, you could be asked to register again (I don't think that the
&gt;&gt;&gt; IDE
&gt;&gt;&gt; &gt; --&gt; SCSI should imply it...)
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Gianluca
&gt;&gt;&gt;
&gt;&gt;&gt; &gt; _______________________________________________
&gt;&gt;&gt; &gt; libvirt-users mailing list
&gt;&gt;&gt; &gt; libvirt-users@redhat.com
&gt;&gt;&gt; &gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt;
&gt;&gt;&gt; Dominik Psenner
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt;
&gt;&gt;&gt; Dominik Psenner
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Dominik Psenner
&gt;&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Dominik Psenner
&gt;



-- 
Dominik Psenner

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;span style="font-size:12.8px"&gt;Of course the cronjob fails when trying \
to virsh blockcommit and not when creating the snapshot, sorry for the \
noise.&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-07 9:15 GMT+02:00 Dominik Psenner &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;different day, same issue.. cronjob runs and \
fails:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;$ virsh \
snapshot-create-as --domain domain --name backup --no-metadata --atomic --disk-only \
--diskspec hda,snapshot=external&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;span class=""&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;error: failed to pivot job for disk hda&lt;/span&gt;&lt;br \
style="font-size:12.8px"&gt;&lt;span style="font-size:12.8px"&gt;error: block copy still \
active: disk 'hda' not ready for pivot yet&lt;/span&gt;&lt;br \
style="font-size:12.8px"&gt;&lt;span style="font-size:12.8px"&gt;Could not merge changes for \
disk hda of domain. VM may be in invalid state.&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;Then running the following in the morning succeeds and \
successfully pivotes the snapshot into the base image while the vm is \
live:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div \
style="font-size:12.8px"&gt;$ virsh blockjob domain hda --abort&lt;br&gt;&lt;/div&gt;&lt;span \
class="m_-4622351790740132041gmail-im" style="font-size:12.8px"&gt;$ virsh blockcommit \
domain hda --active --pivot&lt;/span&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
class="m_-4622351790740132041gmail-im"&gt;&lt;span style="font-size:12.8px"&gt;Successfully \
pivoted&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span class="m_-4622351790740132041gmail-im" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
class="m_-4622351790740132041gmail-im" style="font-size:12.8px"&gt;This need of manual \
interventions is becoming a tiring job..&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
class="m_-4622351790740132041gmail-im" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
class="m_-4622351790740132041gmail-im" style="font-size:12.8px"&gt;I someone else seeing \
the same issue or has an idea what the cause could be?&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
class="m_-4622351790740132041gmail-im" style="font-size:12.8px"&gt;Can I trust the \
output and is the base image really up to the latest state?&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
class="m_-4622351790740132041gmail-im" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
class="m_-4622351790740132041gmail-im" \
style="font-size:12.8px"&gt;Cheers&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;div&gt;&lt;div \
class="h5"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-02 10:30 GMT+02:00 Dominik Psenner \
&lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;div \
dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Just a little catch-up. This time I was able to resolve the \
issue by doing:&lt;br&gt;&lt;br&gt;&lt;/div&gt;virsh blockjob domain hda --abort&lt;br&gt;&lt;/div&gt;&lt;span&gt;virsh \
blockcommit domain hda --active --pivot&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;Last  time I had to shut \
down the virtual machine and do this while being  offline.&lt;br&gt;&lt;br&gt;Thanks Wang for \
your valuable input. As far as the memory goes, there's plenty of head \
room:&lt;br&gt;&lt;br&gt;$ free -h&lt;br&gt;                           total               used         \
free           shared   buff/cache     available&lt;br&gt;Mem:                     7.8G     \
1.8G               407M               9.7M               5.5G               \
5.5G&lt;br&gt;Swap:                   8.0G               619M               \
7.4G&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;div&gt;&lt;div \
class="m_-4622351790740132041h5"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-07-02 10:26 \
GMT+02:00 王李明 &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:wanglm@certusnet.com.cn" \
target="_blank"&gt;wanglm@certusnet.com.cn&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;








&lt;div link="blue" vlink="purple" lang="ZH-CN"&gt;

&lt;div class="m_-4622351790740132041m_2863693438744199861m_2683241285725809605Section1"&gt;


&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;mybe this is because you physic host memory is \
small&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;then this will Causing instability of the virtual \
machine&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;But I'm just guessing&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;You can try to increase your memory&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal" style="text-align:justify;text-justify:inter-ideograph"&gt;&lt;span \
style="font-size:10.5pt;font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal" style="text-align:justify;text-justify:inter-ideograph"&gt;&lt;span \
style="font-size:10.5pt;font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;Wang Liming&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal" style="text-align:justify;text-justify:inter-ideograph"&gt;&lt;span \
style="font-size:10.5pt;font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;  &lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class="MsoNormal"&gt;&lt;span \
style="font-family:"Calibri","sans-serif";color:black" \
lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div style="border:none;border-top:solid #b5c4df 1.0pt;padding:3.0pt 0cm 0cm 0cm"&gt;

&lt;p class="MsoNormal"&gt;&lt;b&gt;&lt;span style="font-size:10.0pt"&gt;发件人&lt;span \
lang="EN-US"&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;span style="font-size:10.0pt" lang="EN-US"&gt; &lt;a \
href="mailto:libvirt-users-bounces@redhat.com" \
target="_blank"&gt;libvirt-users-bounces@redhat.c&lt;wbr&gt;om&lt;/a&gt; [mailto:&lt;a \
href="mailto:libvirt-users-bounces@redhat.com" \
target="_blank"&gt;libvirt-users-bounces@&lt;wbr&gt;redhat.com&lt;/a&gt;] &lt;/span&gt;&lt;b&gt;&lt;span \
style="font-size:10.0pt"&gt;代表 &lt;/span&gt;&lt;/b&gt;&lt;span style="font-size:10.0pt" \
lang="EN-US"&gt;Dominik Psenner&lt;br&gt; &lt;/span&gt;&lt;b&gt;&lt;span \
style="font-size:10.0pt"&gt;发送时间&lt;span lang="EN-US"&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;span \
style="font-size:10.0pt" lang="EN-US"&gt; 2017&lt;/span&gt;&lt;span \
style="font-size:10.0pt"&gt;年&lt;span lang="EN-US"&gt;7&lt;/span&gt;月&lt;span \
lang="EN-US"&gt;2&lt;/span&gt;日&lt;span lang="EN-US"&gt; 16:22&lt;br&gt; &lt;/span&gt;&lt;b&gt;收件人&lt;span \
lang="EN-US"&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US"&gt; &lt;a \
href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;/span&gt;&lt;b&gt;主题&lt;span \
lang="EN-US"&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US"&gt; Re: [libvirt-users] virtual drive \
performance&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;&lt;div&gt;&lt;div class="m_-4622351790740132041m_2863693438744199861h5"&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;Hi \
again,&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;just today an
issue I've thought to be resolved popped up again. We backup the machine by
doing:&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;virsh snapshot-create-as --domain domain
--name backup --no-metadata --atomic --disk-only --diskspec
hda,snapshot=external&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;# backup hda.qcow2&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;virsh
blockcommit domain hda --active --pivot&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;Every now and
then this process fails with the following error message:&lt;br&gt;
&lt;br&gt;
error: failed to pivot job for disk hda&lt;br&gt;
error: block copy still active: disk 'hda' not ready for pivot yet&lt;br&gt;
Could not merge changes for disk hda of domain. VM may be in invalid \
state.&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;I expect live
backups are a great asset and should work. Is this a bug that may relates also
to the virtual drive performance issues we observe?&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Cheers&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;2017-07-02 10:10 GMT+02:00 Dominik Psenner
&lt;&lt;a href="mailto:dpsenner@gmail.com" \
target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt;:&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span \
lang="EN-US"&gt;Hi&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;a small update
on this. I just migrated the vm from the site to my laptop and fired it up. The
exact same xml configuration (except file paths and such) starts up and bursts
with 50Mb/s to 115Mb/s in the guest. This allows only one reasonable answer:
the cpu on my laptop is somehow better suited to emulate IO than the CPU built
into the host on site. The host there is a HP proliant microserver gen8 with
xeon processor. But the processor there is also never capped at 100% when the
guest copies files.&lt;br&gt;
&lt;br&gt;
I just ran another test by copying a 3Gb large file on the guest. What I can
observe on my computer is that the copy process is not at a constant rate but
rather starts with 90Mb/s, then drops down to 30Mb/s, goes up to 70Mb/s, drops
down to 1Mb/s, goes up to 75Mb/s, drops to 1Mb/s, goes up to 55Mb/s and the
pattern continues. Please note that the drive is still configured as:&lt;br&gt;
&lt;br&gt;
&lt;driver name='qemu' type='qcow2' cache='none' \
io='threads'/&gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;and I would expect a constant rate that is
either high or low since there is no caching involved and the underlying hard
drive is a samsung ssd evo 850. To have an idea how fast that drive is on my
laptop:&lt;br&gt;
&lt;br&gt;
$ dd if=/dev/zero of=testfile bs=1M count=1000 oflag=direct&lt;br&gt;
1000+0 records in&lt;br&gt;
1000+0 records out&lt;br&gt;
1048576000 bytes (1.0 GB, 1000 MiB) copied, 2.47301 s, 424 \
MB/s&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;I can further
observe that the smaller the saved chunks are the slower the overall
performance is:&lt;br&gt;
&lt;br&gt;
dd if=/dev/zero of=testfile bs=512K count=1000 oflag=direct&lt;br&gt;
1000+0 records in&lt;br&gt;
1000+0 records out&lt;br&gt;
524288000 bytes (524 MB, 500 MiB) copied, 1.34874 s, 389 MB/s&lt;br&gt;
&lt;br&gt;
$ dd if=/dev/zero of=testfile bs=5K count=1000 oflag=direct&lt;br&gt;
1000+0 records in&lt;br&gt;
1000+0 records out&lt;br&gt;
5120000 bytes (5.1 MB, 4.9 MiB) copied, 0.105109 s, 48.7 MB/s&lt;br&gt;
&lt;br&gt;
$ dd if=/dev/zero of=testfile bs=1K count=10000 oflag=direct&lt;br&gt;
10000+0 records in&lt;br&gt;
10000+0 records out&lt;br&gt;
10240000 bytes (10 MB, 9.8 MiB) copied, 0.668438 s, 15.3 MB/s&lt;br&gt;
&lt;br&gt;
$ dd if=/dev/zero of=testfile bs=512 count=20000 oflag=direct&lt;br&gt;
20000+0 records in&lt;br&gt;
20000+0 records out&lt;br&gt;
10240000 bytes (10 MB, 9.8 MiB) copied, 1.10964 s, 9.2 MB/s&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Could this be a limiting factor? Does
qemu/kvm do many many writes of just a few bytes?&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;&lt;br&gt;
Ideas, anyone?&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Cheers&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;  &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;2017-06-21 20:46 GMT+02:00 Dan &lt;&lt;a \
href="mailto:srwx4096@gmail.com" \
target="_blank"&gt;srwx4096@gmail.com&lt;/a&gt;&gt;:&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div&gt;

&lt;div&gt;

&lt;blockquote style="border:none;border-left:solid #cccccc 1.0pt;padding:0cm 0cm 0cm \
6.0pt;margin-left:4.8pt;margin-right:0cm"&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;On Tue, Jun 20, 2017 at 04:24:32PM +0200,
Gianluca Cecchi wrote:&lt;br&gt;
&gt; On Tue, Jun 20, 2017 at 3:38 PM, Dominik Psenner &lt;&lt;a \
href="mailto:dpsenner@gmail.com" target="_blank"&gt;dpsenner@gmail.com&lt;/a&gt;&gt; \
wrote:&lt;br&gt; &gt;&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; to the following:&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; &lt;disk type='file' device='disk'&gt;&lt;br&gt;
&gt; &gt;     &lt;driver name='qemu' type='qcow2' \
cache='none'/&gt;&lt;br&gt; &gt; &gt;     &lt;source
file='/var/data/virtuals/machi&lt;wbr&gt;nes/windows-server-2016-&lt;br&gt;
&gt; &gt; x64/image.qcow2'/&gt;&lt;br&gt;
&gt; &gt;     &lt;backingStore/&gt;&lt;br&gt;
&gt; &gt;     &lt;target dev='hda' bus='scsi'/&gt;&lt;br&gt;
&gt; &gt;     &lt;address type='drive' controller='0' bus='0'
target='0' unit='0'/&gt;&lt;br&gt;
&gt; &gt; &lt;/disk&gt;&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; Do you see any gotchas in this configuration that could prevent the&lt;br&gt;
&gt; &gt; virtualized guest to power on and boot up?&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; When I configure like this, from a linux guest point of view I get this&lt;br&gt;
&gt; Symbios Logic SCSI Controller:&lt;br&gt;
&gt; 00:08.0 SCSI storage controller: LSI Logic / Symbios Logic 53c895a&lt;br&gt;
&gt;&lt;br&gt;
&gt; But htis is true only if you add the SCSI controller too, not only the
disk&lt;br&gt;
&gt; definition.&lt;br&gt;
&gt; In my case&lt;br&gt;
&gt;&lt;br&gt;
&gt;        &lt;controller type='scsi' index='0'&gt;&lt;br&gt;
&gt;           &lt;address type='pci' domain='0x0000'
bus='0x00' slot='0x08'&lt;br&gt;
&gt; function='0x0'/&gt;&lt;br&gt;
&gt;        &lt;/controller&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; Note the slot='0x08' that is reflected into the first field of lspci
inside&lt;br&gt;
&gt; my linux guest.&lt;br&gt;
&gt; So between your controllers you have to add the SCSI one&lt;br&gt;
&gt;&lt;br&gt;
&gt; In my case (Fedora 25 with virt-manager-1.4.1-2.fc25.noar&lt;wbr&gt;ch,&lt;br&gt;
&gt; qemu-kvm-2.7.1-6.fc25.x86_64, libvirt-2.2.1-2.fc25.x86_64) with "Disk
bus"&lt;br&gt;
&gt; set as SCSI in virt-manager, the xml defintiion for the guest is&lt;br&gt;
&gt; automatically updated with the controller if not existent yet.&lt;br&gt;
&gt; And the disk definition sections is like this:&lt;br&gt;
&gt;&lt;br&gt;
&gt;        &lt;disk type='file' device='disk'&gt;&lt;br&gt;
&gt;           &lt;driver name='qemu' type='qcow2'/&gt;&lt;br&gt;
&gt;           &lt;source \
file='/var/lib/libvirt/images/&lt;wbr&gt;slaxsmall.qcow2'/&gt;&lt;br&gt; &gt;           \
&lt;target dev='sda' bus='scsi'/&gt;&lt;br&gt; &gt;           &lt;boot \
order='1'/&gt;&lt;br&gt; &gt;           &lt;address type='drive' \
controller='0' bus='0' target='0' unit='0'/&gt;&lt;br&gt;
&gt;        &lt;/disk&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; So I think you should set dev='sda' and not 'hda' in your xml \
for it&lt;br&gt; &gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;I am actually
very curious to know if that would make a difference. I&lt;br&gt;
don't have a such windows vm images ready to test at present.&lt;br&gt;
&lt;span style="color:#888888"&gt;&lt;br&gt;
&lt;span class="m_-4622351790740132041m_2863693438744199861m_2683241285725809605m-9222668100434188158hoenzb"&gt;Dan&lt;/span&gt;&lt;br&gt;
 &lt;/span&gt;&lt;span class="m_-4622351790740132041m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt; \
I don't kknow if w2016 contains the symbios logic drivers already&lt;/span&gt;&lt;br&gt;
&lt;span class="m_-4622351790740132041m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt; \
installed, so that a "simple" reboot could imply an automatic&lt;/span&gt;&lt;br&gt;
&lt;span class="m_-4622351790740132041m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt; \
reconfiguration of the guest....&lt;/span&gt;&lt;br&gt; &lt;span \
class="m_-4622351790740132041m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt; \
Note also that in Windows when the hw configuration is considered heavily&lt;/span&gt;&lt;br&gt;
&lt;span class="m_-4622351790740132041m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt; \
changed, you could be asked to register again (I don't think that the \
IDE&lt;/span&gt;&lt;br&gt; &lt;span \
class="m_-4622351790740132041m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt; \
--&gt; SCSI should imply it...)&lt;/span&gt;&lt;br&gt; &lt;span \
class="m_-4622351790740132041m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt;&lt;/span&gt;&lt;br&gt;
 &lt;span class="m_-4622351790740132041m_2863693438744199861m_2683241285725809605m-9222668100434188158im"&gt;&gt; \
Gianluca&lt;/span&gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal" style="margin-bottom:12.0pt"&gt;&lt;span lang="EN-US"&gt;&gt;
______________________________&lt;wbr&gt;_________________&lt;br&gt;
&gt; libvirt-users mailing list&lt;br&gt;
&gt; &lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;


&lt;/div&gt;

&lt;/div&gt;

&lt;/blockquote&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span style="color:#888888" lang="EN-US"&gt;&lt;br&gt;
&lt;br clear="all"&gt;
&lt;br&gt;
&lt;span class="m_-4622351790740132041m_2863693438744199861m_2683241285725809605hoenzb"&gt;-- \
&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span style="color:#888888" lang="EN-US"&gt;Dominik \
Psenner&lt;/span&gt;&lt;span lang="EN-US"&gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;br&gt;
&lt;br clear="all"&gt;
&lt;br&gt;
-- &lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div&gt;

&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Dominik Psenner&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;

&lt;/div&gt;


&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;span \
class="m_-4622351790740132041HOEnZb"&gt;&lt;font color="#888888"&gt;-- &lt;br&gt;&lt;div \
class="m_-4622351790740132041m_2863693438744199861gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br \
clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;-- \
&lt;br&gt;&lt;div class="m_-4622351790740132041gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- \
&lt;br&gt;&lt;div class="gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div \
dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;



</body></email><email><emailId>20170710130056</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-07-10 13:00:56-0400</timestampReceived><subject>Re: [libvirt-users] Activation of org.freedesktop.machine1 timed out</subject><body>


On Sat, Jul 01, 2017 at 11:52:59AM +0430, Masoud wrote:
&gt;Hi
&gt;recently i have this error on our server....
&gt;
&gt;how i can fix it?
&gt;

Sounds like a problem with dbus maybe, rebooting maybe?  Can't tell you
much more from this info.

&gt;
&gt;# systemctl status libvirtd
&gt;=E2=97=8F libvirtd.service - Virtualization daemon
&gt;   Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled;
&gt;vendor preset: enabled)
&gt;   Active: active (running) since Sat 2017-07-01 11:08:50 EDT; 2min 54s ago
&gt;     Docs: man:libvirtd(8)
&gt;           http://libvirt.org
&gt; Main PID: 5233 (libvirtd)
&gt;   CGroup: /system.slice/libvirtd.service
&gt;           =E2=94=94=E2=94=805233 /usr/sbin/libvirtd
&gt;
&gt;Jul 01 11:10:51 localhost.localdomain libvirtd[5233]: error from service:
&gt;GetMachineByPID: Activation of org.
&gt;Jul 01 11:11:16 localhost.localdomain libvirtd[5233]: error from service:
&gt;GetMachineByPID: Activation of org.
&gt;Jul 01 11:11:16 localhost.localdomain libvirtd[5233]: error from service:
&gt;GetMachineByPID: Activation of org.
&gt;Jul 01 11:11:16 localhost.localdomain libvirtd[5233]: error from service:
&gt;GetMachineByPID: Activation of org.
&gt;Jul 01 11:11:16 localhost.localdomain libvirtd[5233]: error from service:
&gt;GetMachineByPID: Activation of org.
&gt;Jul 01 11:11:16 localhost.localdomain libvirtd[5233]: error from service:
&gt;GetMachineByPID: Activation of org.
&gt;Jul 01 11:11:16 localhost.localdomain libvirtd[5233]: error from service:
&gt;GetMachineByPID: Activation of org.
&gt;Jul 01 11:11:16 localhost.localdomain libvirtd[5233]: error from service:
&gt;GetMachineByPID: Activation of org.
&gt;Jul 01 11:11:42 localhost.localdomain libvirtd[5233]: Activation of
&gt;org.freedesktop.machine1 timed out
&gt;Jul 01 11:11:42 localhost.localdomain libvirtd[5233]: internal error:
&gt;Failed to autostart VM 'v4375': Activat
&gt;
&gt;
&gt;--
&gt;Chief Technology officer
&gt;Masoud

&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170710130923</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-07-10 13:09:23-0400</timestampReceived><subject>Re: [libvirt-users] Broken br0</subject><body>


On Mon, Jul 03, 2017 at 08:44:00AM -0400, virt.persik@9ox.net wrote:
&gt;Hello,
&gt;
&gt;I wanted to get an extra IP on my local NIC, so I ran `sudo ip addr add
&gt;192.168.1.130/24 dev enp4s0`. This didn't work as intended, so I thought

Well, this information does not have any value without us knowing what
is your setup.

&gt;I'd restart the Ubuntu system to have things back to how they were.
&gt;
&gt;Alas, this didn't happen. While the host still has network as usual, none
&gt;of the VMs are able to get a DHCP lease from the router, or any
&gt;connectivity at all.
&gt;

Still, no information about the setup (Outputs of `ip l`, `ip a`, `brctl
show`, etc.)

&gt;I can still see br0 with `ip addr`, but my guess is that it's misconfigured
&gt;now.
&gt;

Define 'misconfigured' here.

&gt;I tried adding a br1 with virt-manager (Edit &gt; Connection details &gt; Network
&gt;interfaces &gt; Add interface) and using that instead, but the app crashed
&gt;halfway through; and I can't disable or remove the connection with the app
&gt;now.
&gt;

What is the relevant information here?  Did it change any system
settings?  Do you want to report the crash?  How did it happen?  Can you
do that without the app?  And so on...

&gt;I wonder if this isn't a routing issue, but I am not very proficient in
&gt;that area to troubleshoot and fix.
&gt;

I don't see what this would have in common with routing, but since there
is no information to start from, I can't even say that it's not related.

&gt;Where should I start? I'd like to use this as an opportunity to learn more
&gt;about networking and VMs, so bear with me if I ask stupid/basic questions.
&gt;Thanks!

No problem, but try giving more information.  What I got from your mail
was not much more than "My VMs don't have network access.", so maybe try
adding some information hinted at above, check what libvirt networks you
have and which are running (virsh net-list --all), send some
configuration information for those networks (virsh net-dumpxml
$network_name) and check libvirt logs (might vary depending on your
platform and such).

&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170711070737</emailId><senderName>Andrea Bolognani</senderName><senderEmail>abologna@redhat.com</senderEmail><timestampReceived>2017-07-11 07:07:37-0400</timestampReceived><subject>Re: [libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default</subject><body>

On Mon, 2017-07-10 at 16:37 +0200, Jędrek Domański wrote:
&gt; Well, I see newer versions of libvirt on Launchpad so I
&gt; could just add PPA repository and install newer version
&gt; from there. Would that work?

I'm honestly not too familiar with PPAs, but assuming the
packages are targeted at 16.04 it should work nicely and,
most importantly, rolling back in case it doesn't should
also be pretty straighforward.

--  
Andrea Bolognani / Red Hat / Virtualization

</body></email><email><emailId>20170711092524</emailId><senderName>Vishnu Pajjuri</senderName><senderEmail>vishnu.socialac@gmail.com</senderEmail><timestampReceived>2017-07-11 09:25:24-0400</timestampReceived><subject>[libvirt-users] How to make gic_version=3 as defailt to qemu on arm64</subject><body>

Hi

   I'm running Openstack which is installed by using devstack. But it is
not launching VMs.
&gt;From command line with gic_version=3 option it is running. But openstack
glance doesn't have any privilege to specify gic version.

On my ARM64 board gicv2 is not supported, so i want to make gicv3 as
default one to pass to qemu.
Kindly suggest any specific version of vibvirt or patch such that libvirt
should pass gicv3 as default one.

Thanks in Advance
-Vishnu.

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;     I'm running Openstack which is \
installed by using devstack. But it is not launching VMs.&lt;/div&gt;&lt;div&gt;From command line \
with gic_version=3 option it is running. But openstack glance doesn't have any \
privilege to specify gic version.  &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;On my ARM64 board gicv2 \
is not supported, so i want to make gicv3 as default one to pass to \
qemu.&lt;/div&gt;&lt;div&gt;Kindly suggest any specific version of vibvirt or patch such that \
libvirt should pass gicv3 as default one.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks in \
Advance&lt;/div&gt;&lt;div&gt;-Vishnu.&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170712054943</emailId><senderName>Thomas Meyer</senderName><senderEmail>thomas@m3y3r.de</senderEmail><timestampReceived>2017-07-12 05:49:43-0400</timestampReceived><subject>[libvirt-users] UEFI NVRAM variables</subject><body>

&lt;div dir='auto'&gt;Hi,&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;how do I set the BootOrder variable in an NVRAM file for UEFI boot?&lt;/div&gt;&lt;div dir="auto"&gt;Is there a way to configure a domain with the bios qemu option instead of pflash?&lt;/div&gt;&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;Are there a tool available to manipulate the UEFI variables from the outside?&lt;/div&gt;&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;Any hints?&lt;/div&gt;&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;With kind regards&lt;/div&gt;&lt;div dir="auto"&gt;Thomas&lt;/div&gt;&lt;/div&gt;
</body></email><email><emailId>20170712071101</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-07-12 07:11:01-0400</timestampReceived><subject>Re: [libvirt-users] Is there still no easier way to shrink a VM image?</subject><body>


OK, so you basically want to change the virtual size, ok.

When the domain is running you can use 'virsh blockresize', if it is
not, then 'virsh vol-resize' will do the trick.  You should, however,
make sure the filesystem size is changed first so that there is no
access outside the volume.

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170713012942</emailId><senderName>jason</senderName><senderEmail>huzhijiang@gmail.com</senderEmail><timestampReceived>2017-07-13 01:29:42-0400</timestampReceived><subject>Re: [libvirt-users] VM freezes while insmod virtio_net.ko</subject><body>

By downgrading DPDK to 16.11, the problem was solved.

On Jul 9, 2017 10:56 PM, "jason" &lt;huzhijiang@gmail.com&gt; wrote:

&gt; Hi all,
&gt;
&gt; I encountered a tricky problem. I am using ovs+DPDK on the host side
&gt; to build the virtual network, so on the VM side , the virtio_net.ko
&gt; module is used to drive the nic. But VM always freezes while insmod
&gt; virtio_net.ko (I found  virtio_net.ko is located in initrams.img by
&gt; defualt, so I had to delete all virtio modules from initramfs.img and
&gt; insmod then one by one after system is loaded to confirm that).
&gt;
&gt; After such freeze, virsh reset can not recover it due to cannot
&gt; acquire state change lock (held by remoteDispatchDomainReset) so I
&gt; have to use virsh destroy instead.
&gt;
&gt; On the ovs-vswitchd side, the last log I can see is:
&gt;
&gt;
&gt; VHOST_CONFIG: read message VHOST_USER_SET_VRING_NUM
&gt; VHOST_CONFIG: read message VHOST_USER_SET_VRING_BASE
&gt; VHOST_CONFIG: read message VHOST_USER_SET_VRING_ADDR
&gt; VHOST_CONFIG: read message VHOST_USER_SET_VRING_KICK
&gt; VHOST_CONFIG: vring kick idx:0 file:59
&gt; VHOST_CONFIG: virtio is not ready for processing.
&gt; VHOST_CONFIG: read message VHOST_USER_SET_VRING_CALL
&gt; VHOST_CONFIG: vring call idx:0 file:60
&gt; VHOST_CONFIG: read message VHOST_USER_SET_VRING_NUM
&gt; VHOST_CONFIG: read message VHOST_USER_SET_VRING_BASE
&gt; VHOST_CONFIG: read message VHOST_USER_SET_VRING_ADDR
&gt; VHOST_CONFIG: read message VHOST_USER_SET_VRING_KICK
&gt; VHOST_CONFIG: vring kick idx:1 file:46
&gt; VHOST_CONFIG: virtio is not ready for processing.
&gt; VHOST_CONFIG: read message VHOST_USER_SET_VRING_CALL
&gt; VHOST_CONFIG: vring call idx:1 file:61
&gt; VHOST_CONFIG: read message VHOST_USER_SET_VRING_ENABLE
&gt; VHOST_CONFIG: set queue enable: 1 to qp idx: 0
&gt; VHOST_CONFIG: read message VHOST_USER_SET_VRING_ENABLE
&gt; VHOST_CONFIG: set queue enable: 1 to qp idx: 1
&gt; VHOST_CONFIG: read message VHOST_USER_SET_FEATURES
&gt;
&gt; Software version I used are:
&gt;
&gt; guest kernel: 3.10.0-514.26.2.el7.x86_64
&gt; host kernel: 3.10.0-514.26.2.el7.x86_64
&gt; host libvirt: 2.0.0-10.el7_3.9.x86_64
&gt; host qemu: 2.6.0-28.el7.10.1
&gt; host openvswitch: git 2.7.0
&gt; host DPDK: git  17.02.0
&gt;
&gt; Please help to have a look at this issue.
&gt;
&gt; --
&gt; B.R.,
&gt; Jason
&gt;

[Attachment #3 (text/html)]

&lt;div dir="auto"&gt;By downgrading DPDK to 16.11, the problem was solved.  &lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;On Jul 9, 2017 10:56 PM, \
"jason" &lt;&lt;a \
href="mailto:huzhijiang@gmail.com"&gt;huzhijiang@gmail.com&lt;/a&gt;&gt; wrote:&lt;br \
type="attribution"&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;Hi all,&lt;br&gt; &lt;br&gt;
I encountered a tricky problem. I am using ovs+DPDK on the host side&lt;br&gt;
to build the virtual network, so on the VM side , the virtio_net.ko&lt;br&gt;
module is used to drive the nic. But VM always freezes while insmod&lt;br&gt;
virtio_net.ko (I found   virtio_net.ko is located in initrams.img by&lt;br&gt;
defualt, so I had to delete all virtio modules from initramfs.img and&lt;br&gt;
insmod then one by one after system is loaded to confirm that).&lt;br&gt;
&lt;br&gt;
After such freeze, virsh reset can not recover it due to cannot&lt;br&gt;
acquire state change lock (held by remoteDispatchDomainReset) so I&lt;br&gt;
have to use virsh destroy instead.&lt;br&gt;
&lt;br&gt;
On the ovs-vswitchd side, the last log I can see is:&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
VHOST_CONFIG: read message VHOST_USER_SET_VRING_NUM&lt;br&gt;
VHOST_CONFIG: read message VHOST_USER_SET_VRING_BASE&lt;br&gt;
VHOST_CONFIG: read message VHOST_USER_SET_VRING_ADDR&lt;br&gt;
VHOST_CONFIG: read message VHOST_USER_SET_VRING_KICK&lt;br&gt;
VHOST_CONFIG: vring kick idx:0 file:59&lt;br&gt;
VHOST_CONFIG: virtio is not ready for processing.&lt;br&gt;
VHOST_CONFIG: read message VHOST_USER_SET_VRING_CALL&lt;br&gt;
VHOST_CONFIG: vring call idx:0 file:60&lt;br&gt;
VHOST_CONFIG: read message VHOST_USER_SET_VRING_NUM&lt;br&gt;
VHOST_CONFIG: read message VHOST_USER_SET_VRING_BASE&lt;br&gt;
VHOST_CONFIG: read message VHOST_USER_SET_VRING_ADDR&lt;br&gt;
VHOST_CONFIG: read message VHOST_USER_SET_VRING_KICK&lt;br&gt;
VHOST_CONFIG: vring kick idx:1 file:46&lt;br&gt;
VHOST_CONFIG: virtio is not ready for processing.&lt;br&gt;
VHOST_CONFIG: read message VHOST_USER_SET_VRING_CALL&lt;br&gt;
VHOST_CONFIG: vring call idx:1 file:61&lt;br&gt;
VHOST_CONFIG: read message VHOST_USER_SET_VRING_ENABLE&lt;br&gt;
VHOST_CONFIG: set queue enable: 1 to qp idx: 0&lt;br&gt;
VHOST_CONFIG: read message VHOST_USER_SET_VRING_ENABLE&lt;br&gt;
VHOST_CONFIG: set queue enable: 1 to qp idx: 1&lt;br&gt;
VHOST_CONFIG: read message VHOST_USER_SET_FEATURES&lt;br&gt;
&lt;br&gt;
Software version I used are:&lt;br&gt;
&lt;br&gt;
guest kernel: 3.10.0-514.26.2.el7.x86_64&lt;br&gt;
host kernel: 3.10.0-514.26.2.el7.x86_64&lt;br&gt;
host libvirt: 2.0.0-10.el7_3.9.x86_64&lt;br&gt;
host qemu: 2.6.0-28.el7.10.1&lt;br&gt;
host openvswitch: git 2.7.0&lt;br&gt;
host DPDK: git   17.02.0&lt;br&gt;
&lt;br&gt;
Please help to have a look at this issue.&lt;br&gt;
&lt;br&gt;
--&lt;br&gt;
B.R.,&lt;br&gt;
Jason&lt;br&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170713121336</emailId><senderName>Laszlo Ersek</senderName><senderEmail>lersek@redhat.com</senderEmail><timestampReceived>2017-07-13 12:13:36-0400</timestampReceived><subject>Re: [libvirt-users] [Fwd:  UEFI NVRAM variables]</subject><body>

On 07/13/17 13:26, Laszlo Ersek wrote:
&gt; On 07/13/17 10:19, Andrea Bolognani wrote:
&gt;&gt; -------- Forwarded Message --------
&gt;&gt; From: Thomas Meyer &lt;thomas@m3y3r.de&gt;
&gt;&gt; To: libvirt-users@redhat.com
&gt;&gt; Subject: [libvirt-users] UEFI NVRAM variables
&gt;&gt; Date: Wed, 12 Jul 2017 07:49:43 +0200

&gt;&gt;&gt; how do I set the BootOrder variable in an NVRAM file for UEFI boot?

&gt;&gt;&gt; Are there a tool available to manipulate the UEFI variables from the outside?

&gt; Either way, massaging guest-produced data from the host side, be the
&gt; data "UEFI variable content" or "disk image content", is also a security
&gt; question. So the only one really feasible approach here would be a
&gt; libguestfs-like tool that
&gt; - booted a guest on top of the variable store,
&gt; - implemented a kind of "firmware guest agent" that manipulated the
&gt; variables "from the inside",
&gt; - and used custom commands over virtio-serial, between host and guest.
&gt; 
&gt; As I said, a large project.

That said, "all is not lost", if your use case is simple enough, and you
don't mind a bit of ad-hoc coding. The following is viable right now,
from a POSIX shell script:

(1) Generate a UEFI shell script that uses the BCFG command.

They UEFI shell spec can be found at
&lt;http://www.uefi.org/specifications&gt;. (No registration or payment
needed, just go ahead and download it.)

(2) Call the file you generate "startup.nsh". Use CRLF line breaks, and
read the UEFI Shell Spec on "startup.nsh".

(3) Format a small disk image (MBR or GPT partition table, single FAT32
partition) with this script on it. Use guestfish for this.

(4) Boot OVMF as follows:
- use the split OVMF_CODE.fd binary that you would otherwise use
- use the variable store that otherwise belongs to your virtual machine
(managed by libvirt) -- make sure the VM is currently offline
- specify no disk image, and disable networking with "-net none"

This will drop you to the UEFI shell in the guest, and the shell should
automatically locate and run your script called "startup.nsh".

Alternatives to the above steps, on varying levels of hackery:
- replace libguestfs with mtools, or
- replace disk image formatting entirely with QEMU's vvfat protocol
  driver (so the guest would get the generated script directly from the
  host filesystem)
- replace disk image emulation entirely with serial IO communication;
  that is, use "expect", and send the commands to the UEFI shell as if
  by typing them on the serial console.

Thanks,
Laszlo

</body></email><email><emailId>20170713161613</emailId><senderName>Laine Stump</senderName><senderEmail>laine@laine.org</senderEmail><timestampReceived>2017-07-13 16:16:13-0400</timestampReceived><subject>Re: [libvirt-users] Hot-migration of OVS Vlan configuration</subject><body>

On 07/13/2017 11:02 AM, Antoine Millet wrote:
&gt; On Tue, 2017-07-11 at 14:56 -0400, Laine Stump wrote:
&gt;&gt; The cleanest way to make this work would be to enhance the function
&gt;&gt; qemuDomainChangeNet() to know what to do when it detects that the
&gt;&gt; vlan
&gt;&gt; tag was changed with a device update ("virsh update-device") - this
&gt;&gt; command can take effect immediately rather than waiting until the
&gt;&gt; next
&gt;&gt; time the domain is started, so the XML that is migrated would have
&gt;&gt; the
&gt;&gt; new vlan tag already in place (and also you wouldn't need to issue
&gt;&gt; the
&gt;&gt; ovs-vsctl command for it out of band any more!).
&gt;&gt;
&gt;&gt; Currently that function notices that the vlan tag has changed, but
&gt;&gt; this
&gt;&gt; just leads to an "UNSUPPORTED" error. If the network type is OVS,
&gt;&gt; then
&gt;&gt; it *should* work to just reconnect the bridge (libvirt sets the vlan
&gt;&gt; tag
&gt;&gt; as part of connecting to the ovs bridge).
&gt;&gt;
&gt;&gt; So how are your programming chops? :-)
&gt;&gt;
&gt; Hi Laine,
&gt;
&gt; Thank you for the answer!
&gt;
&gt; I finally achieved to implement what you suggested. :-) I'll post the
&gt; patch on the developer ML in a few days.


Nice! Please Cc me so it doesn't get lost in all my mail folders.

</body></email><email><emailId>20170718100645</emailId><senderName>wyang</senderName><senderEmail>w90p710@gmail.com</senderEmail><timestampReceived>2017-07-18 10:06:45-0400</timestampReceived><subject>[libvirt-users] Why cannot block copy local storage to network disk</subject><body>

Hi, guys

I was executing the following command to lively migrate local storage to 
network storage,

    [root@192-168-152-51 ~]# virsh blockcopy
    a75056a4-44e0-4b97-bc77-78142ee17038 vda —xml rbd.xml —wait —verbose
    —pivot
    error: argument unsupported: non-file destination not supported yet

but I get the following error:

    error: argument unsupported: non-file destination not supported yet

I check my libvirt source code, and find the following code sniff in 
/qemuDomainBlockCopyCommon/ function

|if (!virStorageSourceIsLocalStorage(mirror)) { 
virReportError(VIR_ERR_ARGUMENT_UNSUPPORTED, "%s", _("non-file 
destination not supported yet")); } |

it was introduced by Eric.

    commit e53ee6c123321a1775ef3b36e15a5fa351d10fe4
    Author: Eric Blake eblake@redhat.com &lt;http://mailto:eblake@redhat.com&gt;
    Date: Fri Aug 29 16:30:46 2014 -0600

    blockcopy: tweak how rebase calls into copy

So my question is that why we cannot block copy to network storage?

​


Thanks
Wei





[Attachment #3 (text/html)]

&lt;html&gt;
  &lt;head&gt;

    &lt;meta http-equiv="content-type" content="text/html; charset=utf-8"&gt;
  &lt;/head&gt;
  &lt;body text="#000000" bgcolor="#FFFFFF"&gt;
    Hi, guys&lt;br&gt;
    &lt;br&gt;
    &lt;div style="" class="markdown-here-wrapper"
      data-md-url="Thunderbird"&gt;
      &lt;p style="margin: 0px 0px 1.2em ! important;"&gt;I was executing the
        following command to lively migrate local storage to network
        storage,&lt;/p&gt;
      &lt;blockquote style="margin: 1.2em 0px;border-left: 4px solid
        rgb(221, 221, 221); padding: 0px 1em; color: rgb(119, 119, 119);
        quotes: none;"&gt;
        &lt;p style="margin: 0px 0px 1.2em ! important;"&gt;[root@192-168-152-51
          ~]# virsh blockcopy a75056a4-44e0-4b97-bc77-78142ee17038 vda
          —xml rbd.xml —wait —verbose —pivot&lt;br&gt;
          error: argument unsupported: non-file destination not
          supported yet&lt;/p&gt;
      &lt;/blockquote&gt;
      &lt;p style="margin: 0px 0px 1.2em ! important;"&gt; but I get the
        following error:&lt;/p&gt;
      &lt;blockquote style="margin: 1.2em 0px;border-left: 4px solid
        rgb(221, 221, 221); padding: 0px 1em; color: rgb(119, 119, 119);
        quotes: none;"&gt;
        &lt;p style="margin: 0px 0px 1.2em ! important;"&gt;error: argument
          unsupported: non-file destination not supported yet&lt;/p&gt;
      &lt;/blockquote&gt;
      &lt;p style="margin: 0px 0px 1.2em ! important;"&gt;I check my libvirt
        source code, and find the following code sniff in \
&lt;em&gt;qemuDomainBlockCopyCommon&lt;/em&gt;  function&lt;/p&gt;
      &lt;pre style="font-size: 0.85em; font-family: \
Consolas,Inconsolata,Courier,monospace;font-size: 1em; line-height: 1.2em;margin: \
1.2em 0px;"&gt;&lt;code style="font-size: 0.85em; font-family: \
Consolas,Inconsolata,Courier,monospace;margin: 0px 0.15em; padding: 0px 0.3em; \
white-space: pre-wrap; border: 1px solid rgb(234, 234, 234); background-color: \
rgb(248, 248, 248); border-radius: 3px; display: inline;white-space: pre; overflow: \
auto; border-radius: 3px; border: 1px solid rgb(204, 204, 204); padding: 0.5em 0.7em; \
display: block ! important;"&gt;    if (!virStorageSourceIsLocalStorage(mirror)) {  \
virReportError(VIR_ERR_ARGUMENT_UNSUPPORTED, "%s",  _("non-file destination not \
supported yet"));  }
&lt;/code&gt;&lt;/pre&gt;
      &lt;p style="margin: 0px 0px 1.2em ! important;"&gt;it was introduced by
        Eric.&lt;/p&gt;
      &lt;blockquote style="margin: 1.2em 0px;border-left: 4px solid
        rgb(221, 221, 221); padding: 0px 1em; color: rgb(119, 119, 119);
        quotes: none;"&gt;
        &lt;p style="margin: 0px 0px 1.2em ! important;"&gt;commit
          e53ee6c123321a1775ef3b36e15a5fa351d10fe4&lt;br&gt;
          Author: Eric Blake &lt;a \
href="http://mailto:eblake@redhat.com"&gt;eblake@redhat.com&lt;/a&gt;&lt;br&gt;  Date: Fri Aug 29 \
16:30:46 2014 -0600&lt;/p&gt;  &lt;p style="margin: 0px 0px 1.2em ! important;"&gt; blockcopy: \
tweak  how rebase calls into copy&lt;/p&gt;
      &lt;/blockquote&gt;
      &lt;p style="margin: 0px 0px 1.2em ! important;"&gt;So my question is
        that why we cannot block copy to network storage?&lt;/p&gt;
      &lt;div
title="MDH:SSB3YXMgZXhlY3V0aW5nIHRoZSBmb2xsb3dpbmcgY29tbWFuZCB0byBsaXZlbHnCoCBtaWdyYXRlIGxvY2FsIHN0b3JhZ2UgdG8gbmV0d29yayBzdG9yYWdlLDxicj48YnI+Jmd0OyBbcm9vdEAxOTIt
 MTY4LTE1Mi01MSB+XSMgdmlyc2ggYmxvY2tjb3B5IGE3NTA1NmE0LTQ0ZTAtNGI5Ny1iYzc3LTc4
MTQyZWUxNzAzOCB2ZGHCoCAtLXhtbCByYmQueG1swqAgLS13YWl0IC0tdmVyYm9zZSAtLXBpdm90
PGJyPiZndDtlcnJvcjogYXJndW1lbnQgdW5zdXBwb3J0ZWQ6IG5vbi1maWxlIGRlc3RpbmF0aW9u
IG5vdCBzdXBwb3J0ZWQgeWV0PGJyPjxicj7CoGJ1dCBJIGdldCB0aGUgZm9sbG93aW5nIGVycm9y
Ojxicj48YnI+Jmd0O2Vycm9yOiBhcmd1bWVudCB1bnN1cHBvcnRlZDogbm9uLWZpbGUgZGVzdGlu
YXRpb24gbm90IHN1cHBvcnRlZCB5ZXQ8YnI+PGJyPkkgY2hlY2sgbXkgbGlidmlydCBzb3VyY2Ug
Y29kZSwgYW5kIGZpbmQgdGhlIGZvbGxvd2luZyBjb2RlIHNuaWZmIGluICpxZW11RG9tYWluQmxv
Y2tDb3B5Q29tbW9uKiBmdW5jdGlvbjxicj48YnI+YGBgPGJyPsKgwqDCoCBpZiAoIXZpclN0b3Jh
Z2VTb3VyY2VJc0xvY2FsU3RvcmFnZShtaXJyb3IpKSB7PGJyPsKgwqDCoMKgwqDCoMKgIHZpclJl
cG9ydEVycm9yKFZJUl9FUlJfQVJHVU1FTlRfVU5TVVBQT1JURUQsICIlcyIsPGJyPsKgwqDCoMKg
wqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgIF8oIm5vbi1maWxlIGRlc3RpbmF0
aW9uIG5vdCBzdXBwb3J0ZWQgeWV0IikpOzxicj7CoMKgwqAgfTxicj5gYGA8YnI+PGJyPml0IHdh
cyBpbnRyb2R1Y2VkIGJ5IEVyaWMuPGJyPjxicj4mZ3Q7Y29tbWl0IGU1M2VlNmMxMjMzMjFhMTc3
NWVmM2IzNmUxNWE1ZmEzNTFkMTBmZTQ8YnI+Jmd0O0F1dGhvcjogRXJpYyBCbGFrZSAmbHQ7ZWJs
YWtlQHJlZGhhdC5jb20mZ3Q7PGJyPiZndDtEYXRlOsKgwqAgRnJpIEF1ZyAyOSAxNjozMDo0NiAy
MDE0IC0wNjAwPGJyPiZndDs8YnI+Jmd0O8KgwqDCoCBibG9ja2NvcHk6IHR3ZWFrIGhvdyByZWJh
c2UgY2FsbHMgaW50byBjb3B5PGJyPjxicj5TbyBteSBxdWVzdGlvbiBpcyB0aGF0IHdoeSB3ZSBj
        YW5ub3QgYmxvY2sgY29weSB0byBuZXR3b3JrIHN0b3JhZ2U/PGJyPg=="
style="height:0;width:0;max-height:0;max-width:0;overflow:hidden;font-size:0em;padding:0;margin:0;"&gt;​&lt;/div&gt;
  &lt;/div&gt;
    &lt;br&gt;
    &lt;br&gt;
    Thanks&lt;br&gt;
    Wei&lt;br&gt;
    &lt;br&gt;
    &lt;br&gt;
    &lt;br&gt;
    &lt;br&gt;
  &lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170718133324</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-07-18 13:33:24-0400</timestampReceived><subject>Re: [libvirt-users] Why cannot block copy local storage to network disk</subject><body>


On Tue, Jul 18, 2017 at 06:06:45PM +0800, wyang wrote:
&gt;Hi, guys
&gt;
&gt;I was executing the following command to lively migrate local storage to
&gt;network storage,
&gt;
&gt;    [root@192-168-152-51 ~]# virsh blockcopy
&gt;    a75056a4-44e0-4b97-bc77-78142ee17038 vda —xml rbd.xml —wait —verbose
&gt;    —pivot
&gt;    error: argument unsupported: non-file destination not supported yet
&gt;
&gt;but I get the following error:
&gt;
&gt;    error: argument unsupported: non-file destination not supported yet
&gt;
&gt;I check my libvirt source code, and find the following code sniff in
&gt;/qemuDomainBlockCopyCommon/ function
&gt;
&gt;|if (!virStorageSourceIsLocalStorage(mirror)) {
&gt;virReportError(VIR_ERR_ARGUMENT_UNSUPPORTED, "%s", _("non-file
&gt;destination not supported yet")); } |
&gt;
&gt;it was introduced by Eric.
&gt;
&gt;    commit e53ee6c123321a1775ef3b36e15a5fa351d10fe4
&gt;    Author: Eric Blake eblake@redhat.com &lt;http://mailto:eblake@redhat.com&gt;
&gt;    Date: Fri Aug 29 16:30:46 2014 -0600
&gt;
&gt;    blockcopy: tweak how rebase calls into copy
&gt;
&gt;So my question is that why we cannot block copy to network storage?
&gt;

The answer is in the commit message.  It was not supported even before
the commit, it's just that now it needs to be explicitly checked.  IIUC,
before that commit the stat() call would just fail. It's just that
nobody implemented it yet.  Having said that, I'm unaware of the actual
limitations that there are.

Martin

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170725091726</emailId><senderName>Peter Krempa</senderName><senderEmail>pkrempa@redhat.com</senderEmail><timestampReceived>2017-07-25 09:17:26-0400</timestampReceived><subject>Re: [libvirt-users] Why cannot block copy local storage to network disk</subject><body>


On Tue, Jul 18, 2017 at 15:33:24 +0200, Martin Kletzander wrote:
&gt; On Tue, Jul 18, 2017 at 06:06:45PM +0800, wyang wrote:
&gt; &gt;Hi, guys
&gt; &gt;
&gt; &gt;I was executing the following command to lively migrate local storage to
&gt; &gt;network storage,
&gt; &gt;
&gt; &gt;    [root@192-168-152-51 ~]# virsh blockcopy
&gt; &gt;    a75056a4-44e0-4b97-bc77-78142ee17038 vda —xml rbd.xml —wait —verbose
&gt; &gt;    —pivot
&gt; &gt;    error: argument unsupported: non-file destination not supported yet
&gt; &gt;
&gt; &gt;but I get the following error:
&gt; &gt;
&gt; &gt;    error: argument unsupported: non-file destination not supported yet
&gt; &gt;
&gt; &gt;I check my libvirt source code, and find the following code sniff in
&gt; &gt;/qemuDomainBlockCopyCommon/ function
&gt; &gt;
&gt; &gt;|if (!virStorageSourceIsLocalStorage(mirror)) {
&gt; &gt;virReportError(VIR_ERR_ARGUMENT_UNSUPPORTED, "%s", _("non-file
&gt; &gt;destination not supported yet")); } |
&gt; &gt;
&gt; &gt;it was introduced by Eric.
&gt; &gt;
&gt; &gt;    commit e53ee6c123321a1775ef3b36e15a5fa351d10fe4
&gt; &gt;    Author: Eric Blake eblake@redhat.com &lt;http://mailto:eblake@redhat.com&gt;
&gt; &gt;    Date: Fri Aug 29 16:30:46 2014 -0600
&gt; &gt;
&gt; &gt;    blockcopy: tweak how rebase calls into copy
&gt; &gt;
&gt; &gt;So my question is that why we cannot block copy to network storage?
&gt; &gt;
&gt; 
&gt; The answer is in the commit message.  It was not supported even before
&gt; the commit, it's just that now it needs to be explicitly checked.  IIUC,
&gt; before that commit the stat() call would just fail. It's just that
&gt; nobody implemented it yet.  Having said that, I'm unaware of the actual
&gt; limitations that there are.

I'm working on that currently. The code was never adapted to target
network in this case. As it was never implemented yet, the new approach
will use blockdev-add and blockdev-mirror, since we also need to support
multi-host based protocols, which are impossible to use with
drive-mirror command in qemu.

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170719091617</emailId><senderName>Igor Mammedov</senderName><senderEmail>imammedo@redhat.com</senderEmail><timestampReceived>2017-07-19 09:16:17-0400</timestampReceived><subject>Re: [libvirt-users] [Qemu-devel] [PATCH v2] hmp: allow cpu index for "info lapic"</subject><body>

On Wed, 19 Jul 2017 16:48:23 +0800 (CST)
&lt;wang.yi59@zte.com.cn&gt; wrote:

&gt; &gt;* wang.yi59@zte.com.cn (wang.yi59@zte.com.cn) wrote:  
&gt; 
&gt; 
&gt; &gt;&gt; Hi Eduardo,  
&gt; 
&gt; &gt;&gt;   
&gt; 
&gt; &gt;&gt; Thank you for your reply!  
&gt; 
&gt; &gt;&gt;   
&gt; 
&gt; &gt;&gt; &gt;On Mon, Jul 17, 2017 at 09:49:37PM -0400, Yi Wang wrote:  
&gt; 
&gt; &gt;&gt;   
&gt; 
&gt; &gt;&gt; &gt;&gt; Add [vcpu] index support for hmp command "info lapic", which is  
&gt; 
&gt; &gt;&gt;   
&gt; 
&gt; &gt;&gt; &gt;&gt; useful when debugging ipi and so on. Current behavior is not  
&gt; 
&gt; &gt;&gt;   
&gt; 
&gt; &gt;&gt; &gt;&gt; changed when the parameter isn't specified.  
&gt; 
&gt; &gt;&gt;   
&gt; 
&gt; &gt;&gt; &gt;&gt;   
&gt; 
&gt; &gt;&gt;   
&gt; 
&gt; &gt;&gt; &gt;&gt; Signed-off-by: Yi Wang &lt;wang.yi59@zte.com.cn&gt;  
&gt; 
&gt; &gt;&gt;   
&gt; 
&gt; &gt;&gt; &gt;&gt; Signed-off-by: Yun Liu &lt;liu.yunh@zte.com.cn&gt;  
&gt; 
&gt; &gt;&gt;   
&gt; 
&gt; &gt;&gt; &gt;  
&gt; 
&gt; &gt;&gt;   
&gt; 
&gt; &gt;&gt; &gt;We have 8 monitor commands (see below) that use the CPU set by  
&gt; 
&gt; &gt;&gt; &gt;the "cpu" command (mon_get_cpu()) as input.  Why is "info lapic"  
&gt; 
&gt; &gt;&gt; &gt;special?  
&gt; 
&gt; &gt;&gt;   
&gt; 
&gt; &gt;&gt; When we debugging a problem of ipi, we wanted to verify lapic info  
&gt; 
&gt; &gt;&gt; on each vCPU, but we found that we could only get vCPU 0's lapic  
&gt; 
&gt; &gt;&gt; through "info lapic", so we supposed this patch could help those  
&gt; 
&gt; &gt;&gt; who have the same problem as us.  
&gt; 
&gt; &gt;  
&gt; 
&gt; &gt;I think Eduardo's point is that you can already do:  
&gt; 
&gt; &gt;    cpu 0  
&gt; 
&gt; &gt;    info lapic  
&gt; 
&gt; &gt;    cpu 1  
&gt; 
&gt; &gt;    info lapic  
&gt; 
&gt; Yes, I get it, thank you.
&gt; 
&gt; The reason of the problem we met is that we use "virsh qemu-monitor-command",
&gt; 
&gt; so the 'cpu' command didn't work.
you can try to use qmp interface directly which supports specifying cpu for monitor commands:

qemu supports:

 -- Command: human-monitor-command

     Execute a command on the human monitor and return the output.

     Arguments:
     'command-line: string'
          the command to execute in the human monitor
     'cpu-index: int' (optional)
          The CPU to use for commands that require an implicit CPU

maybe "virsh qemu-monitor-command" can also do it, CCing libvirt list

&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; ---
&gt; 
&gt; Best wishes
&gt; 
&gt; Yi Wang

</body></email><email><emailId>20170719100746</emailId><senderName>Marko Weber | 8000</senderName><senderEmail>weber@zbfmail.de</senderEmail><timestampReceived>2017-07-19 10:07:46-0400</timestampReceived><subject>Re: [libvirt-users] Way to detect virtual machine cpu features</subject><body>

Hi,

Am 2017-07-04 03:08, schrieb Lei Zhang:
&gt; Hi, any comment or suggestion
&gt; 
&gt; On Thu, Jun 29, 2017 at 10:55 AM, Lei Zhang &lt;lei12zhang12@gmail.com&gt;
&gt; wrote:
&gt; 
&gt;&gt; Hello everyone
&gt;&gt; 
&gt;&gt; I want to know how can I use libvirt to detect what cpu features a
&gt;&gt; virtual machine will see.
&gt;&gt; 
&gt;&gt; I guess I could do it in following way:
&gt;&gt; 
&gt;&gt; 1. if cpu mode is 'custom', use 'virsh cpu-baseline --features' on
&gt;&gt; the cpu model to get model features.
&gt;&gt; 2. if cpu mode is 'host-passthrough' or 'host-model', do a 'virsh
&gt;&gt; capabilities' to list cpu features of physical host, they are
&gt;&gt; identical to features of virtual machine.
&gt;&gt; 
&gt;&gt; Is this right way to do things? Look forward to your valuable
&gt;&gt; comments.
&gt;&gt; 
&gt;&gt; Best regards,
&gt;&gt; Lei
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users

why dont u fire up on 'host' &amp; 'vm'  lscpu?

lscpu in vm on our server:

  # lscpu
Architecture:          x86_64
CPU op-mode(s):        32-bit, 64-bit
Byte Order:            Little Endian
CPU(s):                2
On-line CPU(s) list:   0,1
Thread(s) per core:    2
Core(s) per socket:    1
Socket(s):             1
NUMA node(s):          1
Vendor ID:             GenuineIntel
CPU family:            6
Model:                 60
Model name:            Intel Core Processor (Haswell)
Stepping:              4
CPU MHz:               3595.608
BogoMIPS:              7191.21
Hypervisor vendor:     KVM     
&lt;======================================================================================== 
  Inside a VM !!!
Virtualization type:   full
L1d cache:             32K
L1i cache:             32K
L2 cache:              4096K
L3 cache:              16384K
NUMA node0 CPU(s):     0,1


Flags:                 fpu vme de pse tsc msr pae mce cx8 apic sep mtrr 
pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx rdtscp lm 
constant_tsc rep_good nopl xtopology pni pclmulqdq ssse3 fma cx16 pcid 
sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c 
rdrand hypervisor lahf_lm abm fsgsbase bmi1 hle avx2 smep bmi2 erms 
invpcid rtm xsaveopt arat

and there u see the cpu features.......



is this what u you want to see?


marko

</body></email><email><emailId>20170719160722</emailId><senderName>Marko Weber | 8000</senderName><senderEmail>weber@zbfmail.de</senderEmail><timestampReceived>2017-07-19 16:07:22-0400</timestampReceived><subject>Re: [libvirt-users] creating new vm with virt-manager, existing disk failure</subject><body>



Am 2017-07-19 14:01, schrieb Pavel Hrdina:
&gt; On Wed, Jul 19, 2017 at 11:45:36AM +0200, Marko Weber | 8000 wrote:
&gt;&gt; 
&gt;&gt; hello,
&gt;&gt; i rsynced a kvm vm from one host to another.
&gt;&gt; i start virt-manager and tell virt-manager to use an existing disk.
&gt;&gt; i set cpu to haswell that is on the host.
&gt;&gt; 
&gt;&gt; configure before start is set, and i start "begin installation".
&gt;&gt; I get this output by virt-manager:
&gt;&gt; 
&gt;&gt; Unable to complete install: 'internal error: process exited while
&gt;&gt; connecting to monitor: 2017-07-19T09:27:10.861928Z qemu-system-x86_64:
&gt;&gt; can't apply global Haswell-x86_64-cpu.cmt=on: Property '.cmt' not 
&gt;&gt; found'
&gt;&gt; 
&gt;&gt; Traceback (most recent call last):
&gt;&gt;    File "/usr/share/virt-manager/virtManager/asyncjob.py", line 88, in
&gt;&gt; cb_wrapper
&gt;&gt;      callback(asyncjob, *args, **kwargs)
&gt;&gt;    File "/usr/share/virt-manager/virtManager/create.py", line 2288, in
&gt;&gt; _do_async_install
&gt;&gt;      guest.start_install(meter=meter)
&gt;&gt;    File "/usr/share/virt-manager/virtinst/guest.py", line 477, in
&gt;&gt; start_install
&gt;&gt;      doboot, transient)
&gt;&gt;    File "/usr/share/virt-manager/virtinst/guest.py", line 405, in
&gt;&gt; _create_guest
&gt;&gt;      self.domain.create()
&gt;&gt;    File "/usr/lib64/python2.7/site-packages/libvirt.py", line 1062, in
&gt;&gt; create
&gt;&gt;      if ret == -1: raise libvirtError ('virDomainCreate() failed',
&gt;&gt; dom=self)
&gt;&gt; libvirtError: internal error: process exited while connecting to
&gt;&gt; monitor: 2017-07-19T09:27:10.861928Z qemu-system-x86_64: can't apply
&gt;&gt; global Haswell-x86_64-cpu.cmt=on: Property '.cmt' not found
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; try to set it to another cpu and clicking start, i get this:
&gt;&gt; 
&gt;&gt; Unable to complete install: 'Domain has already been started!'
&gt;&gt; 
&gt;&gt; Traceback (most recent call last):
&gt;&gt;    File "/usr/share/virt-manager/virtManager/asyncjob.py", line 88, in
&gt;&gt; cb_wrapper
&gt;&gt;      callback(asyncjob, *args, **kwargs)
&gt;&gt;    File "/usr/share/virt-manager/virtManager/create.py", line 2288, in
&gt;&gt; _do_async_install
&gt;&gt;      guest.start_install(meter=meter)
&gt;&gt;    File "/usr/share/virt-manager/virtinst/guest.py", line 455, in
&gt;&gt; start_install
&gt;&gt;      raise RuntimeError(_("Domain has already been started!"))
&gt;&gt; RuntimeError: Domain has already been started!
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; how do i stop the already runing vm? virsh list dont show the vm
&gt;&gt; and why do i get the error on haswell?
&gt; 
&gt; Hi, this is actually a bug in virt-manager which was fixed in upstream
&gt; by these commits:
&gt; 
&gt;     2099a1946e22b62d31b954dc3e7b813404c2d019
&gt;     93085d2b9d4a3dd6cbb9edfeae9b6cefee9419c1
&gt;     8181e8609867fe6ed101e48212d42a1c38373539
&gt; 
&gt; To work-around this issue cancel the installation and start it again.
&gt; There is no official release of virt-manager with that fix included, we
&gt; should probably make the release.

Yes, i think its a great idea.
Can u do this?

kind regards

marko


&gt; 
&gt; Pavel

</body></email><email><emailId>20170725150858</emailId><senderName>Dirty Dan</senderName><senderEmail>dirtydan@waifu.club</senderEmail><timestampReceived>2017-07-25 15:08:58-0400</timestampReceived><subject>[libvirt-users] automatically reverting to a snapshot</subject><body>

&lt;div dir='auto'&gt;How can I automatically revert to a snapshot after the guest is \
stopped?&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;/etc/libvirt/hooks/qemu &lt;/div&gt;&lt;div \
dir="auto"&gt;#!/bin/sh &lt;/div&gt;&lt;div dir="auto"&gt;name="&lt;span class="money"&gt;$1&lt;/span&gt;"
&lt;/div&gt;&lt;div dir="auto"&gt;action="&lt;span class="money"&gt;$2&lt;/span&gt;"
&lt;/div&gt;&lt;div dir="auto"&gt;if [ "$name" = "name" ]; then
&lt;/div&gt;&lt;div dir="auto"&gt; virsh snapshot-revert "$name" --snapshotname "snapshot1"
&lt;/div&gt;&lt;div dir="auto"&gt;fi&lt;/div&gt;&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;I tried this \
which resulted in a deadlock, then I saw the warning further down the \
page.&lt;/div&gt;&lt;/div&gt;


</body></email><email><emailId>20170720062850</emailId><senderName>"ahongloumeng () 163 ! com"</senderName><senderEmail>ahongloumeng@163.com</senderEmail><timestampReceived>2017-07-20 06:28:50-0400</timestampReceived><subject>[libvirt-users] What may be cause vm "in shutdown" state</subject><body>

[Attachment #2 (text/plain)]

Hello£¬

We meet a question about vm state.

System environment:
linux version: centos 6.8
libvirt version: 3.4.0
qemu version: 2.4.1

When shutdown one of vms, the state of the vm stuck in in shutdown state. And the qemu process is gone.

Look up the vm log /var/log/libvirt/qemu/vm.log:
"qemu: terminating on signal 15 from pid 54601
2017-07-19 04:41:09.960+0000: shutting down, reason=crashed"

What may be cause vm "in shutdown" state

Thanks!



ahongloumeng@163.com

[Attachment #3 (text/html)]

&lt;html&gt;&lt;head&gt;&lt;meta http-equiv="content-type" content="text/html; \
charset=GB2312"&gt;&lt;style&gt;body { line-height: 1.5; }body { font-size: 10.5pt; \
font-family: Î¢ÈíÑÅºÚ; color: rgb(0, 0, 0); line-height: 1.5; }&lt;/style&gt;&lt;/head&gt;&lt;body&gt; \
&lt;div&gt;&lt;span&gt;&lt;/span&gt;Hello£¬&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We meet a question about vm \
state.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;System environment:&lt;/div&gt;&lt;div&gt;linux version: centos \
6.8&lt;/div&gt;&lt;div&gt;libvirt version: 3.4.0&lt;/div&gt;&lt;div&gt;qemu version: \
2.4.1&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When shutdown one of vms, the state of the vm stuck in \
in shutdown state. And the qemu process is gone.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Look up the \
vm log /var/log/libvirt/qemu/vm.log:&lt;/div&gt;&lt;div&gt;&lt;span style="background-color: rgba(0, \
0, 0, 0); font-size: 10.5pt; line-height: \
1.5;"&gt;"qemu: terminating on signal 15 from pid 54601&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="color: rgb(0, 0, 0); background-color: rgba(0, 0, 0, \
0);"&gt;2017-07-19 04:41:09.960+0000: shutting down, reason=crashed"&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="color: rgb(0, 0, 0); background-color: rgba(0, 0, 0, \
0);"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;What may be cause vm "in shutdown" \
state&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style="width: 210px; \
height: 1px;" color="#b5c4df" size="1" align="left"&gt; &lt;div&gt;&lt;span&gt;&lt;div style="MARGIN: \
10px; FONT-FAMILY: verdana; FONT-SIZE: \
10pt"&gt;&lt;div&gt;ahongloumeng@163.com&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;&lt;/div&gt; &lt;/body&gt;&lt;/html&gt;



</body></email><email><emailId>20170723222516</emailId><senderName>G Crowe</senderName><senderEmail>gclvirtlist@crowie.net</senderEmail><timestampReceived>2017-07-23 22:25:16-0400</timestampReceived><subject>[libvirt-users] Xen died - Fedora upgrade from 21 to 26</subject><body>

Hi,
     I am trying to upgrade my Xen host (Dom0) and are having troubles 
getting it to work.

I think that it has booted into a kernel that supports Xen (running 'xl 
info' does list some Xen capabilities), but I have three problems (that 
I have found so far).

Firstly, the "libvirtd" daemon doesn't start on bootup (and as a result 
all 'virsh' commands fail). It is set to auto-start (systemctl enable 
libvirtd), and can be manually started (systemctl start libvirtd), but 
it will not auto-start on reboot.

Secondly, Once I have manually started libvirtd, when I try to define a 
domain it gives me an error "could not find capabilities for arch=x86_64 
domaintype=xen" and I haven't yet been able to define any domains. This 
domain type works fine on Fedora 21.

Thirdly, I am unable to convert to/from xml config format, it gives me 
the error "error: invalid argument: unsupported config type xen-xl" 
however the format "xen-xl" works fine on the Fedora 21 machine.

I had these same issues when I tried to upgrade to Fedora 25 and assumed 
that something had been broken and so abandoned further attempts to 
upgrade, however since Fedora 26 is the same I am now assuming that I 
have stuffed something up myself (or missed something).

Fedora 21 uses kernel 3.19.3 and xen 4.4.1
Fedora 26 uses kernel 4.11.8 and xen 4.8.1

I have tried following the info on 
https://wiki.xen.org/wiki/Fedora_Host_Installation but it appears to be 
out of date now (I used this site when I started using Xen under Fedora 
19, and when I upgraded to Fedora 21)

Does anyone have any suggestions? outputs from "xl info" and the domain 
config are below. I have also tried disabling SELinux, but it made no 
difference.


Thanks

GC

-----------------------------------------------
On the fedora 26 box.....
# xl info
host                   : family.mydomain.mytld
release                : 4.11.8-300.fc26.x86_64
version                : #1 SMP Thu Jun 29 20:09:48 UTC 2017
machine                : x86_64
nr_cpus                : 4
max_cpu_id             : 3
nr_nodes               : 1
cores_per_socket       : 4
threads_per_core       : 1
cpu_mhz                : 2712
hw_caps                : 
b7ebfbff:77faf3bf:2c100800:00000121:0000000f:009c67af:00000000:00000100
virt_caps              : hvm hvm_directio
total_memory           : 8072
free_memory            : 128
sharing_freed_memory   : 0
sharing_used_memory    : 0
outstanding_claims     : 0
free_cpus              : 0
xen_major              : 4
xen_minor              : 8
xen_extra              : .1
xen_version            : 4.8.1
xen_caps               : xen-3.0-x86_64 xen-3.0-x86_32p hvm-3.0-x86_32 
hvm-3.0-x86_32p hvm-3.0-x86_64
xen_scheduler          : credit
xen_pagesize           : 4096
platform_params        : virt_start=0xffff800000000000
xen_changeset          :
xen_commandline        : placeholder
cc_compiler            : gcc (GCC) 7.0.1 20170421 (Red Hat 7.0.1-0.15)
cc_compile_by          : mockbuild
cc_compile_domain      : [unknown]
cc_compile_date        : Wed May  3 21:23:49 UTC 2017
build_id               : 1c6e5a40165e05837303942b54757ae1f2d5033d
xend_config_format     : 4

---------------------------------------------------
# cat vmtest.xml
&lt;domain type='xen' id='21'&gt;
   &lt;name&gt;testVM&lt;/name&gt;
   &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;
   &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMemory&gt;
   &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
   &lt;os&gt;
     &lt;type arch='x86_64' machine='xenfv'&gt;hvm&lt;/type&gt;
     &lt;loader type='rom'&gt;/usr/lib/xen/boot/hvmloader&lt;/loader&gt;
     &lt;boot dev='network'/&gt;
   &lt;/os&gt;
   &lt;features&gt;
     &lt;acpi/&gt;
     &lt;apic/&gt;
     &lt;pae/&gt;
   &lt;/features&gt;
   &lt;clock offset='variable' adjustment='0' basis='utc'/&gt;
   &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
   &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
   &lt;on_crash&gt;restart&lt;/on_crash&gt;
   &lt;devices&gt;
     &lt;interface type='bridge'&gt;
       &lt;mac address='02:02:00:03:00:00'/&gt;
       &lt;source bridge='enp1s0'/&gt;
       &lt;script path='vif-bridge'/&gt;
     &lt;/interface&gt;
     &lt;serial type='pty'&gt;
       &lt;target port='0'/&gt;
     &lt;/serial&gt;
     &lt;console type='pty'&gt;
       &lt;target type='serial' port='0'/&gt;
     &lt;/console&gt;
     &lt;input type='mouse' bus='ps2'/&gt;
     &lt;input type='keyboard' bus='ps2'/&gt;
     &lt;graphics type='vnc' port='5901' autoport='no' 
listen='192.168.131.54'&gt;
       &lt;listen type='address' address='192.168.131.54'/&gt;
     &lt;/graphics&gt;
   &lt;/devices&gt;
&lt;/domain&gt;

--------------------------------------

</body></email><email><emailId>20170728063512</emailId><senderName>Erik Lukács</senderName><senderEmail>erik_lukacs@hotmail.com</senderEmail><timestampReceived>2017-07-28 06:35:12-0400</timestampReceived><subject>[libvirt-users] Libvirt and dnsmasq</subject><body>

[Attachment #2 (text/plain)]

Hi Guys, I do. have a question on libvirt according dnsmasq.

according to the Documentation libvirt initiates for each virtual Interface a dnsmasq \
process which listens on that interface.


Now my Setup Looks like this: in Order to rebuild a Customers Setup i created a vm \
with several Interfaces ( machine1) and an API Server with two Interfaces ( \
machine2). Two of these interfaces net_ext and net_int are available on both vms. One \
of That Interface is meant for Internet (net_ext) the other other for \
intercommunication (net_int). The "Internet" network is Routed via another virtual \
Interface (net_infra) which is unavailable on both vms. On that network my outgoing \
Gateway, ntp and DNS Server is configured in the vms.

This makes me crazy due to the fact that dns resolution on machine1 does not work \
until I either kill the dnsmasq process which listens on net_infra (this makes the \
system-wide dnsmasq also react on that interface) or I make config-changes mentioned \
below (but that persists only until the host is rebooted.

Both vms and the host run with centos7


My problem now is, that dnsmasq is Running on every virtual interface. And every \
process only listens on its own interface. All changes are undone/reset by reboot.

Of course during runtime (and with restart) i can add to \
"Interface=net_infra,net_ext" which temporarily fixes My Problem.

Another thing I could do is killing the dnsmasq process on the interface and use the \
hosts own dnsmasq config.


Without These changes on DNS resolution doesn't work within my machines ( as written \
DNS MUST be set on an ip on net_infra, which must not be bound to both vms).

So my question: How do i einher configure dnsmasq Not to Start for each Interface on \
libvirt-start or how do i configure the dnsmasq-config for net_infra also to listen

On net_ext. chattr +i /var/lib/libvirt/dnsmasq/net_infra.conf is Not an Option!


Thanks in advance!


Erik


[Attachment #3 (text/html)]

&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
&lt;/head&gt;
&lt;body dir="auto"&gt;
&lt;div&gt;
&lt;p style="color: rgb(69, 69, 69); text-decoration: -webkit-letterpress; margin: 0px; \
line-height: normal; font-family: '.SF UI Text';"&gt; &lt;span style="font-family: \
'.SFUIText'; font-size: 17pt;"&gt;Hi Guys, I do. have a question on libvirt according \
dnsmasq.&lt;/span&gt;&lt;/p&gt; &lt;p style="color: rgb(69, 69, 69); text-decoration: \
-webkit-letterpress; margin: 0px; line-height: normal; font-family: '.SF UI Text'; \
min-height: 20.3px;"&gt; &lt;span style="font-family: '.SFUIText'; font-size: \
17pt;"&gt;&lt;/span&gt;&lt;/p&gt; &lt;p style="color: rgb(69, 69, 69); text-decoration: \
-webkit-letterpress; margin: 0px; line-height: normal; font-family: '.SF UI Text';"&gt; \
&lt;span style="font-family: '.SFUIText'; font-size: 17pt;"&gt;according to the \
Documentation libvirt initiates for each virtual Interface a dnsmasq process which \
listens on that interface.&lt;/span&gt;&lt;/p&gt; &lt;p style="color: rgb(69, 69, 69); \
text-decoration: -webkit-letterpress; margin: 0px; line-height: normal; font-family: \
'.SF UI Text'; min-height: 20.3px;"&gt; &lt;span style="font-family: '.SFUIText'; \
font-size: 17pt;"&gt;&lt;/span&gt;&lt;br&gt; &lt;/p&gt;
&lt;p style="color: rgb(69, 69, 69); text-decoration: -webkit-letterpress; margin: 0px; \
line-height: normal; font-family: '.SF UI Text';"&gt; &lt;span style="font-family: \
'.SFUIText'; font-size: 17pt;"&gt;Now my Setup Looks like this: in Order to rebuild a \
Customers Setup i created a vm with several Interfaces ( machine1) and an API Server \
with two Interfaces ( machine2). Two of these interfaces net_ext  and net_int are \
available on both vms. One of That Interface is meant for Internet (net_ext) the \
other other for intercommunication (net_int). The "Internet" network is \
Routed via another virtual Interface (net_infra) which is unavailable on both vms. On \
that  network my outgoing Gateway, ntp and DNS Server is configured in the \
vms.&lt;/span&gt;&lt;/p&gt; &lt;p style="color: rgb(69, 69, 69); text-decoration: \
-webkit-letterpress; margin: 0px; line-height: normal; font-family: '.SF UI Text';"&gt; \
&lt;span style="font-family: '.SFUIText'; font-size: 17pt;"&gt;This makes me crazy due to \
the fact that dns resolution on machine1 does not work until I either kill the \
dnsmasq process which listens on net_infra (this makes the system-wide dnsmasq also \
react on that  interface) or I make config-changes mentioned below (but that persists \
only until the host is rebooted.&lt;/span&gt;&lt;/p&gt; &lt;p style="color: rgb(69, 69, 69); \
text-decoration: -webkit-letterpress; margin: 0px; line-height: normal; font-family: \
'.SF UI Text';"&gt; &lt;span style="font-family: '.SFUIText'; font-size: 17pt;"&gt;Both vms \
and the host run with centos7&lt;/span&gt;&lt;/p&gt; &lt;p style="color: rgb(69, 69, 69); \
text-decoration: -webkit-letterpress; margin: 0px; line-height: normal; font-family: \
'.SF UI Text'; min-height: 20.3px;"&gt; &lt;span style="font-family: '.SFUIText'; \
font-size: 17pt;"&gt;&lt;/span&gt;&lt;br&gt; &lt;/p&gt;
&lt;p style="color: rgb(69, 69, 69); text-decoration: -webkit-letterpress; margin: 0px; \
line-height: normal; font-family: '.SF UI Text';"&gt; &lt;span style="font-family: \
'.SFUIText'; font-size: 17pt;"&gt;My problem now is, that dnsmasq is Running on every \
virtual interface. And every process only listens on its own interface. All changes \
are undone/reset by reboot.&lt;/span&gt;&lt;/p&gt; &lt;p style="color: rgb(69, 69, 69); \
text-decoration: -webkit-letterpress; margin: 0px; line-height: normal; font-family: \
'.SF UI Text';"&gt; &lt;span style="font-family: '.SFUIText'; font-size: 17pt;"&gt;Of course \
during runtime (and with restart) i can add to \
"Interface=net_infra,net_ext" which temporarily fixes My \
Problem.&lt;/span&gt;&lt;/p&gt; &lt;p style="color: rgb(69, 69, 69); text-decoration: \
-webkit-letterpress; margin: 0px; line-height: normal; font-family: '.SF UI Text';"&gt; \
&lt;span style="font-family: '.SFUIText'; font-size: 17pt;"&gt;Another thing I could do is \
killing the dnsmasq process on the interface and use the hosts own dnsmasq \
config.&lt;/span&gt;&lt;/p&gt; &lt;p style="color: rgb(69, 69, 69); text-decoration: \
-webkit-letterpress; margin: 0px; line-height: normal; font-family: '.SF UI Text'; \
min-height: 20.3px;"&gt; &lt;span style="font-family: '.SFUIText'; font-size: \
17pt;"&gt;&lt;/span&gt;&lt;br&gt; &lt;/p&gt;
&lt;p style="color: rgb(69, 69, 69); text-decoration: -webkit-letterpress; margin: 0px; \
line-height: normal; font-family: '.SF UI Text';"&gt; &lt;span style="font-family: \
'.SFUIText'; font-size: 17pt;"&gt;Without These changes on DNS resolution doesn't work \
within my machines ( as written DNS MUST be set on an ip on net_infra, which must not \
be bound to both vms).&lt;/span&gt;&lt;/p&gt; &lt;p style="color: rgb(69, 69, 69); text-decoration: \
-webkit-letterpress; margin: 0px; line-height: normal; font-family: '.SF UI Text';"&gt; \
&lt;span style="font-family: '.SFUIText'; font-size: 17pt;"&gt;So my question: How do i \
einher configure dnsmasq Not to Start for each Interface on libvirt-start or how do i \
configure the dnsmasq-config for net_infra also to listen &lt;/span&gt;&lt;/p&gt; &lt;p \
style="color: rgb(69, 69, 69); text-decoration: -webkit-letterpress; margin: 0px; \
line-height: normal; font-family: '.SF UI Text';"&gt; &lt;span style="font-family: \
'.SFUIText'; font-size: 17pt;"&gt;On net_ext. chattr +i \
/var/lib/libvirt/dnsmasq/net_infra.conf is Not an Option!&lt;/span&gt;&lt;/p&gt; &lt;p style="color: \
rgb(69, 69, 69); text-decoration: -webkit-letterpress; margin: 0px; line-height: \
normal; font-family: '.SF UI Text';"&gt; &lt;span style="font-family: '.SFUIText'; \
font-size: 17pt;"&gt;&lt;br&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p style="color: rgb(69, 69, 69); text-decoration: -webkit-letterpress; margin: 0px; \
line-height: normal; font-family: '.SF UI Text';"&gt; &lt;span style="font-family: \
'.SFUIText'; font-size: 17pt;"&gt;Thanks in advance!&lt;/span&gt;&lt;/p&gt; &lt;p style="color: rgb(69, \
69, 69); text-decoration: -webkit-letterpress; margin: 0px; line-height: normal; \
font-family: '.SF UI Text';"&gt; &lt;span style="font-family: '.SFUIText'; font-size: \
17pt;"&gt;&lt;br&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p style="color: rgb(69, 69, 69); text-decoration: -webkit-letterpress; margin: 0px; \
line-height: normal; font-family: '.SF UI Text';"&gt; &lt;span style="font-family: \
'.SFUIText'; font-size: 17pt;"&gt;Erik&lt;/span&gt;&lt;/p&gt; &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170731082351</emailId><senderName>llilulu</senderName><senderEmail>llilulu@yeah.net</senderEmail><timestampReceived>2017-07-31 08:23:51-0400</timestampReceived><subject>[libvirt-users] libvirt virDomainDestroy</subject><body>

[Attachment #2 (text/plain)]

   When stop a qemu vm via libvirt api, I call virDomainShutdown, I can seen the vm \
shutdown process, But I call virDomainDestroyFlags with  VIR_DOMAIN_DESTROY_GRACEFULL \
,I can't seen the vm shutdown process, virDomainDestroyFlags with \
VIR_DOMAIN_DESTROY_GRACEFULL is gave vm driver process a SIGTERM , how vm driver \
process SIGTERM signal (like qemu).  Thanks


[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;div&gt;   \
When stop a qemu vm via libvirt api, I call virDomainShutdown, I can  seen the vm \
shutdown process, But I call virDomainDestroyFlags with   \
VIR_DOMAIN_DESTROY_GRACEFULL ,I can't seen the vm shutdown process,  \
virDomainDestroyFlags with VIR_DOMAIN_DESTROY_GRACEFULL is gave vm  driver process a \
SIGTERM , how vm driver process SIGTERM signal (like  qemu).&lt;br&gt;   \
Thanks&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;span title="neteasefooter"&gt;&lt;p&gt; &lt;/p&gt;&lt;/span&gt;



</body></email><email><emailId>20170724152051</emailId><senderName>Jim Fehlig</senderName><senderEmail>jfehlig@suse.com</senderEmail><timestampReceived>2017-07-24 15:20:51-0400</timestampReceived><subject>Re: [libvirt-users] Xen died - Fedora upgrade from 21 to 26</subject><body>

On 07/23/2017 04:25 PM, G Crowe wrote:
&gt; Hi,
&gt;      I am trying to upgrade my Xen host (Dom0) and are having troubles getting 
&gt; it to work.
&gt; 
&gt; I think that it has booted into a kernel that supports Xen (running 'xl info' 
&gt; does list some Xen capabilities), but I have three problems (that I have found 
&gt; so far).
&gt; 
&gt; Firstly, the "libvirtd" daemon doesn't start on bootup (and as a result all 
&gt; 'virsh' commands fail). It is set to auto-start (systemctl enable libvirtd), and 
&gt; can be manually started (systemctl start libvirtd), but it will not auto-start 
&gt; on reboot.
&gt; 
&gt; Secondly, Once I have manually started libvirtd, when I try to define a domain 
&gt; it gives me an error "could not find capabilities for arch=x86_64 
&gt; domaintype=xen" and I haven't yet been able to define any domains. This domain 
&gt; type works fine on Fedora 21.
&gt; 
&gt; Thirdly, I am unable to convert to/from xml config format, it gives me the error 
&gt; "error: invalid argument: unsupported config type xen-xl" however the format 
&gt; "xen-xl" works fine on the Fedora 21 machine.

It sounds like the libvirt libxl driver is not loaded. Is the 
libvirt-daemon-driver-libxl package installed? If it's installed, enabling debug 
logging in libvirtd can provide hints why it is not loading

http://libvirt.org/logging.html

Regards,
Jim

&gt; 
&gt; I had these same issues when I tried to upgrade to Fedora 25 and assumed that 
&gt; something had been broken and so abandoned further attempts to upgrade, however 
&gt; since Fedora 26 is the same I am now assuming that I have stuffed something up 
&gt; myself (or missed something).
&gt; 
&gt; Fedora 21 uses kernel 3.19.3 and xen 4.4.1
&gt; Fedora 26 uses kernel 4.11.8 and xen 4.8.1
&gt; 
&gt; I have tried following the info on 
&gt; https://wiki.xen.org/wiki/Fedora_Host_Installation but it appears to be out of 
&gt; date now (I used this site when I started using Xen under Fedora 19, and when I 
&gt; upgraded to Fedora 21)
&gt; 
&gt; Does anyone have any suggestions? outputs from "xl info" and the domain config 
&gt; are below. I have also tried disabling SELinux, but it made no difference.
&gt; 
&gt; 
&gt; Thanks
&gt; 
&gt; GC
&gt; 
&gt; -----------------------------------------------
&gt; On the fedora 26 box.....
&gt; # xl info
&gt; host                   : family.mydomain.mytld
&gt; release                : 4.11.8-300.fc26.x86_64
&gt; version                : #1 SMP Thu Jun 29 20:09:48 UTC 2017
&gt; machine                : x86_64
&gt; nr_cpus                : 4
&gt; max_cpu_id             : 3
&gt; nr_nodes               : 1
&gt; cores_per_socket       : 4
&gt; threads_per_core       : 1
&gt; cpu_mhz                : 2712
&gt; hw_caps                : 
&gt; b7ebfbff:77faf3bf:2c100800:00000121:0000000f:009c67af:00000000:00000100
&gt; virt_caps              : hvm hvm_directio
&gt; total_memory           : 8072
&gt; free_memory            : 128
&gt; sharing_freed_memory   : 0
&gt; sharing_used_memory    : 0
&gt; outstanding_claims     : 0
&gt; free_cpus              : 0
&gt; xen_major              : 4
&gt; xen_minor              : 8
&gt; xen_extra              : .1
&gt; xen_version            : 4.8.1
&gt; xen_caps               : xen-3.0-x86_64 xen-3.0-x86_32p hvm-3.0-x86_32 
&gt; hvm-3.0-x86_32p hvm-3.0-x86_64
&gt; xen_scheduler          : credit
&gt; xen_pagesize           : 4096
&gt; platform_params        : virt_start=0xffff800000000000
&gt; xen_changeset          :
&gt; xen_commandline        : placeholder
&gt; cc_compiler            : gcc (GCC) 7.0.1 20170421 (Red Hat 7.0.1-0.15)
&gt; cc_compile_by          : mockbuild
&gt; cc_compile_domain      : [unknown]
&gt; cc_compile_date        : Wed May  3 21:23:49 UTC 2017
&gt; build_id               : 1c6e5a40165e05837303942b54757ae1f2d5033d
&gt; xend_config_format     : 4
&gt; 
&gt; ---------------------------------------------------
&gt; # cat vmtest.xml
&gt; &lt;domain type='xen' id='21'&gt;
&gt;    &lt;name&gt;testVM&lt;/name&gt;
&gt;    &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;
&gt;    &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMemory&gt;
&gt;    &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
&gt;    &lt;os&gt;
&gt;      &lt;type arch='x86_64' machine='xenfv'&gt;hvm&lt;/type&gt;
&gt;      &lt;loader type='rom'&gt;/usr/lib/xen/boot/hvmloader&lt;/loader&gt;
&gt;      &lt;boot dev='network'/&gt;
&gt;    &lt;/os&gt;
&gt;    &lt;features&gt;
&gt;      &lt;acpi/&gt;
&gt;      &lt;apic/&gt;
&gt;      &lt;pae/&gt;
&gt;    &lt;/features&gt;
&gt;    &lt;clock offset='variable' adjustment='0' basis='utc'/&gt;
&gt;    &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
&gt;    &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
&gt;    &lt;on_crash&gt;restart&lt;/on_crash&gt;
&gt;    &lt;devices&gt;
&gt;      &lt;interface type='bridge'&gt;
&gt;        &lt;mac address='02:02:00:03:00:00'/&gt;
&gt;        &lt;source bridge='enp1s0'/&gt;
&gt;        &lt;script path='vif-bridge'/&gt;
&gt;      &lt;/interface&gt;
&gt;      &lt;serial type='pty'&gt;
&gt;        &lt;target port='0'/&gt;
&gt;      &lt;/serial&gt;
&gt;      &lt;console type='pty'&gt;
&gt;        &lt;target type='serial' port='0'/&gt;
&gt;      &lt;/console&gt;
&gt;      &lt;input type='mouse' bus='ps2'/&gt;
&gt;      &lt;input type='keyboard' bus='ps2'/&gt;
&gt;      &lt;graphics type='vnc' port='5901' autoport='no' listen='192.168.131.54'&gt;
&gt;        &lt;listen type='address' address='192.168.131.54'/&gt;
&gt;      &lt;/graphics&gt;
&gt;    &lt;/devices&gt;
&gt; &lt;/domain&gt;
&gt; 
&gt; --------------------------------------
&gt; 
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt; 

</body></email><email><emailId>20170726104645</emailId><senderName>G Crowe</senderName><senderEmail>gclvirtlist@crowie.net</senderEmail><timestampReceived>2017-07-26 10:46:45-0400</timestampReceived><subject>Re: [libvirt-users] Xen died - Fedora upgrade from 21 to 26</subject><body>

Jim,
     Thanks for that, I had manually installed 
libvirt-daemon-driver-xen, but also needed to install 
libvirt-daemon-driver-libxl. I can now create VMs and convert config 
formats.

However the daemon still fails to start on bootup. It starts fine when I 
manually start it with "systemctl start libvirtd" but setting it to 
autostart with "systemctl enable libvirtd" seems to have no effect. When 
I look at the status, it tells me that the service is "enabled" which 
means that it starts on bootup (well, that's what it means for any other 
service).

This is rather critical on this PC, as it has unattended restarts and 
the VPN/routing is done in one of the VMs (i.e. I can't get to it unless 
it auto-starts at least one VM).

Unfortunatley there is nothing appearing in the libvirtd log over a 
reboot to help diagnose.

Any suggestions?


Thank you

GC


[root@testhost ~]# systemctl status libvirtd
● libvirtd.service - Virtualization daemon
    Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled; 
vendor preset: enabled)
    Active: inactive (dead)
      Docs: man:libvirtd(8)
            http://libvirt.org




On 25/07/2017 1:20 AM, Jim Fehlig wrote:
&gt; On 07/23/2017 04:25 PM, G Crowe wrote:
&gt;&gt; Hi,
&gt;&gt;      I am trying to upgrade my Xen host (Dom0) and are having 
&gt;&gt; troubles getting it to work.
&gt;&gt;
&gt;&gt; I think that it has booted into a kernel that supports Xen (running 
&gt;&gt; 'xl info' does list some Xen capabilities), but I have three problems 
&gt;&gt; (that I have found so far).
&gt;&gt;
&gt;&gt; Firstly, the "libvirtd" daemon doesn't start on bootup (and as a 
&gt;&gt; result all 'virsh' commands fail). It is set to auto-start (systemctl 
&gt;&gt; enable libvirtd), and can be manually started (systemctl start 
&gt;&gt; libvirtd), but it will not auto-start on reboot.
&gt;&gt;
&gt;&gt; Secondly, Once I have manually started libvirtd, when I try to define 
&gt;&gt; a domain it gives me an error "could not find capabilities for 
&gt;&gt; arch=x86_64 domaintype=xen" and I haven't yet been able to define any 
&gt;&gt; domains. This domain type works fine on Fedora 21.
&gt;&gt;
&gt;&gt; Thirdly, I am unable to convert to/from xml config format, it gives 
&gt;&gt; me the error "error: invalid argument: unsupported config type 
&gt;&gt; xen-xl" however the format "xen-xl" works fine on the Fedora 21 machine.
&gt;
&gt; It sounds like the libvirt libxl driver is not loaded. Is the 
&gt; libvirt-daemon-driver-libxl package installed? If it's installed, 
&gt; enabling debug logging in libvirtd can provide hints why it is not 
&gt; loading
&gt;
&gt; http://libvirt.org/logging.html
&gt;
&gt; Regards,
&gt; Jim
&gt;
&gt;&gt;
&gt;&gt; I had these same issues when I tried to upgrade to Fedora 25 and 
&gt;&gt; assumed that something had been broken and so abandoned further 
&gt;&gt; attempts to upgrade, however since Fedora 26 is the same I am now 
&gt;&gt; assuming that I have stuffed something up myself (or missed something).
&gt;&gt;
&gt;&gt; Fedora 21 uses kernel 3.19.3 and xen 4.4.1
&gt;&gt; Fedora 26 uses kernel 4.11.8 and xen 4.8.1
&gt;&gt;
&gt;&gt; I have tried following the info on 
&gt;&gt; https://wiki.xen.org/wiki/Fedora_Host_Installation but it appears to 
&gt;&gt; be out of date now (I used this site when I started using Xen under 
&gt;&gt; Fedora 19, and when I upgraded to Fedora 21)
&gt;&gt;
&gt;&gt; Does anyone have any suggestions? outputs from "xl info" and the 
&gt;&gt; domain config are below. I have also tried disabling SELinux, but it 
&gt;&gt; made no difference.
&gt;&gt;
&gt;&gt;
&gt;&gt; Thanks
&gt;&gt;
&gt;&gt; GC
&gt;&gt;
&gt;&gt; -----------------------------------------------
&gt;&gt; On the fedora 26 box.....
&gt;&gt; # xl info
&gt;&gt; host                   : family.mydomain.mytld
&gt;&gt; release                : 4.11.8-300.fc26.x86_64
&gt;&gt; version                : #1 SMP Thu Jun 29 20:09:48 UTC 2017
&gt;&gt; machine                : x86_64
&gt;&gt; nr_cpus                : 4
&gt;&gt; max_cpu_id             : 3
&gt;&gt; nr_nodes               : 1
&gt;&gt; cores_per_socket       : 4
&gt;&gt; threads_per_core       : 1
&gt;&gt; cpu_mhz                : 2712
&gt;&gt; hw_caps                : 
&gt;&gt; b7ebfbff:77faf3bf:2c100800:00000121:0000000f:009c67af:00000000:00000100
&gt;&gt; virt_caps              : hvm hvm_directio
&gt;&gt; total_memory           : 8072
&gt;&gt; free_memory            : 128
&gt;&gt; sharing_freed_memory   : 0
&gt;&gt; sharing_used_memory    : 0
&gt;&gt; outstanding_claims     : 0
&gt;&gt; free_cpus              : 0
&gt;&gt; xen_major              : 4
&gt;&gt; xen_minor              : 8
&gt;&gt; xen_extra              : .1
&gt;&gt; xen_version            : 4.8.1
&gt;&gt; xen_caps               : xen-3.0-x86_64 xen-3.0-x86_32p 
&gt;&gt; hvm-3.0-x86_32 hvm-3.0-x86_32p hvm-3.0-x86_64
&gt;&gt; xen_scheduler          : credit
&gt;&gt; xen_pagesize           : 4096
&gt;&gt; platform_params        : virt_start=0xffff800000000000
&gt;&gt; xen_changeset          :
&gt;&gt; xen_commandline        : placeholder
&gt;&gt; cc_compiler            : gcc (GCC) 7.0.1 20170421 (Red Hat 7.0.1-0.15)
&gt;&gt; cc_compile_by          : mockbuild
&gt;&gt; cc_compile_domain      : [unknown]
&gt;&gt; cc_compile_date        : Wed May  3 21:23:49 UTC 2017
&gt;&gt; build_id               : 1c6e5a40165e05837303942b54757ae1f2d5033d
&gt;&gt; xend_config_format     : 4
&gt;&gt;
&gt;&gt; ---------------------------------------------------
&gt;&gt; # cat vmtest.xml
&gt;&gt; &lt;domain type='xen' id='21'&gt;
&gt;&gt;    &lt;name&gt;testVM&lt;/name&gt;
&gt;&gt;    &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;
&gt;&gt;    &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMemory&gt;
&gt;&gt;    &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
&gt;&gt;    &lt;os&gt;
&gt;&gt;      &lt;type arch='x86_64' machine='xenfv'&gt;hvm&lt;/type&gt;
&gt;&gt;      &lt;loader type='rom'&gt;/usr/lib/xen/boot/hvmloader&lt;/loader&gt;
&gt;&gt;      &lt;boot dev='network'/&gt;
&gt;&gt;    &lt;/os&gt;
&gt;&gt;    &lt;features&gt;
&gt;&gt;      &lt;acpi/&gt;
&gt;&gt;      &lt;apic/&gt;
&gt;&gt;      &lt;pae/&gt;
&gt;&gt;    &lt;/features&gt;
&gt;&gt;    &lt;clock offset='variable' adjustment='0' basis='utc'/&gt;
&gt;&gt;    &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
&gt;&gt;    &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
&gt;&gt;    &lt;on_crash&gt;restart&lt;/on_crash&gt;
&gt;&gt;    &lt;devices&gt;
&gt;&gt;      &lt;interface type='bridge'&gt;
&gt;&gt;        &lt;mac address='02:02:00:03:00:00'/&gt;
&gt;&gt;        &lt;source bridge='enp1s0'/&gt;
&gt;&gt;        &lt;script path='vif-bridge'/&gt;
&gt;&gt;      &lt;/interface&gt;
&gt;&gt;      &lt;serial type='pty'&gt;
&gt;&gt;        &lt;target port='0'/&gt;
&gt;&gt;      &lt;/serial&gt;
&gt;&gt;      &lt;console type='pty'&gt;
&gt;&gt;        &lt;target type='serial' port='0'/&gt;
&gt;&gt;      &lt;/console&gt;
&gt;&gt;      &lt;input type='mouse' bus='ps2'/&gt;
&gt;&gt;      &lt;input type='keyboard' bus='ps2'/&gt;
&gt;&gt;      &lt;graphics type='vnc' port='5901' autoport='no' 
&gt;&gt; listen='192.168.131.54'&gt;
&gt;&gt;        &lt;listen type='address' address='192.168.131.54'/&gt;
&gt;&gt;      &lt;/graphics&gt;
&gt;&gt;    &lt;/devices&gt;
&gt;&gt; &lt;/domain&gt;
&gt;&gt;
&gt;&gt; --------------------------------------
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; libvirt-users mailing list
&gt;&gt; libvirt-users@redhat.com
&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;
&gt;

</body></email><email><emailId>20170726133249</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-07-26 13:32:49-0400</timestampReceived><subject>Re: [libvirt-users] Xen died - Fedora upgrade from 21 to 26</subject><body>

Note that this does not help with the original problem but points out a
critical design flaw.

To me your it infrastructure design has no working disaster recovery plan.
You should always be able to access critical functionality and from there
be able to restore complete functionality step by step. In your case the
outermost functionality is the vm host. You should always be able to log
into that machine once it has all cables plugged in, regardless of what
runs on it (or not).

This means that even though you might get this to work you should rethink
your design so that you do not have to rely on the vm that does the
networking.

On 26 Jul 2017 12:50 p.m., "G Crowe" &lt;gclvirtlist@crowie.net&gt; wrote:

Jim,
    Thanks for that, I had manually installed libvirt-daemon-driver-xen,
but also needed to install libvirt-daemon-driver-libxl. I can now create
VMs and convert config formats.

However the daemon still fails to start on bootup. It starts fine when I
manually start it with "systemctl start libvirtd" but setting it to
autostart with "systemctl enable libvirtd" seems to have no effect. When I
look at the status, it tells me that the service is "enabled" which means
that it starts on bootup (well, that's what it means for any other service).

This is rather critical on this PC, as it has unattended restarts and the
VPN/routing is done in one of the VMs (i.e. I can't get to it unless it
auto-starts at least one VM).

Unfortunatley there is nothing appearing in the libvirtd log over a reboot
to help diagnose.

Any suggestions?


Thank you

GC


[root@testhost ~]# systemctl status libvirtd
● libvirtd.service - Virtualization daemon
   Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled;
vendor preset: enabled)
   Active: inactive (dead)
     Docs: man:libvirtd(8)
           http://libvirt.org





On 25/07/2017 1:20 AM, Jim Fehlig wrote:

&gt; On 07/23/2017 04:25 PM, G Crowe wrote:
&gt;
&gt;&gt; Hi,
&gt;&gt;      I am trying to upgrade my Xen host (Dom0) and are having troubles
&gt;&gt; getting it to work.
&gt;&gt;
&gt;&gt; I think that it has booted into a kernel that supports Xen (running 'xl
&gt;&gt; info' does list some Xen capabilities), but I have three problems (that I
&gt;&gt; have found so far).
&gt;&gt;
&gt;&gt; Firstly, the "libvirtd" daemon doesn't start on bootup (and as a result
&gt;&gt; all 'virsh' commands fail). It is set to auto-start (systemctl enable
&gt;&gt; libvirtd), and can be manually started (systemctl start libvirtd), but it
&gt;&gt; will not auto-start on reboot.
&gt;&gt;
&gt;&gt; Secondly, Once I have manually started libvirtd, when I try to define a
&gt;&gt; domain it gives me an error "could not find capabilities for arch=x86_64
&gt;&gt; domaintype=xen" and I haven't yet been able to define any domains. This
&gt;&gt; domain type works fine on Fedora 21.
&gt;&gt;
&gt;&gt; Thirdly, I am unable to convert to/from xml config format, it gives me
&gt;&gt; the error "error: invalid argument: unsupported config type xen-xl" however
&gt;&gt; the format "xen-xl" works fine on the Fedora 21 machine.
&gt;&gt;
&gt;
&gt; It sounds like the libvirt libxl driver is not loaded. Is the
&gt; libvirt-daemon-driver-libxl package installed? If it's installed, enabling
&gt; debug logging in libvirtd can provide hints why it is not loading
&gt;
&gt; http://libvirt.org/logging.html
&gt;
&gt; Regards,
&gt; Jim
&gt;
&gt;
&gt;&gt; I had these same issues when I tried to upgrade to Fedora 25 and assumed
&gt;&gt; that something had been broken and so abandoned further attempts to
&gt;&gt; upgrade, however since Fedora 26 is the same I am now assuming that I have
&gt;&gt; stuffed something up myself (or missed something).
&gt;&gt;
&gt;&gt; Fedora 21 uses kernel 3.19.3 and xen 4.4.1
&gt;&gt; Fedora 26 uses kernel 4.11.8 and xen 4.8.1
&gt;&gt;
&gt;&gt; I have tried following the info on https://wiki.xen.org/wiki/Fedo
&gt;&gt; ra_Host_Installation but it appears to be out of date now (I used this
&gt;&gt; site when I started using Xen under Fedora 19, and when I upgraded to
&gt;&gt; Fedora 21)
&gt;&gt;
&gt;&gt; Does anyone have any suggestions? outputs from "xl info" and the domain
&gt;&gt; config are below. I have also tried disabling SELinux, but it made no
&gt;&gt; difference.
&gt;&gt;
&gt;&gt;
&gt;&gt; Thanks
&gt;&gt;
&gt;&gt; GC
&gt;&gt;
&gt;&gt; -----------------------------------------------
&gt;&gt; On the fedora 26 box.....
&gt;&gt; # xl info
&gt;&gt; host                   : family.mydomain.mytld
&gt;&gt; release                : 4.11.8-300.fc26.x86_64
&gt;&gt; version                : #1 SMP Thu Jun 29 20:09:48 UTC 2017
&gt;&gt; machine                : x86_64
&gt;&gt; nr_cpus                : 4
&gt;&gt; max_cpu_id             : 3
&gt;&gt; nr_nodes               : 1
&gt;&gt; cores_per_socket       : 4
&gt;&gt; threads_per_core       : 1
&gt;&gt; cpu_mhz                : 2712
&gt;&gt; hw_caps                : b7ebfbff:77faf3bf:2c100800:000
&gt;&gt; 00121:0000000f:009c67af:00000000:00000100
&gt;&gt; virt_caps              : hvm hvm_directio
&gt;&gt; total_memory           : 8072
&gt;&gt; free_memory            : 128
&gt;&gt; sharing_freed_memory   : 0
&gt;&gt; sharing_used_memory    : 0
&gt;&gt; outstanding_claims     : 0
&gt;&gt; free_cpus              : 0
&gt;&gt; xen_major              : 4
&gt;&gt; xen_minor              : 8
&gt;&gt; xen_extra              : .1
&gt;&gt; xen_version            : 4.8.1
&gt;&gt; xen_caps               : xen-3.0-x86_64 xen-3.0-x86_32p hvm-3.0-x86_32
&gt;&gt; hvm-3.0-x86_32p hvm-3.0-x86_64
&gt;&gt; xen_scheduler          : credit
&gt;&gt; xen_pagesize           : 4096
&gt;&gt; platform_params        : virt_start=0xffff800000000000
&gt;&gt; xen_changeset          :
&gt;&gt; xen_commandline        : placeholder
&gt;&gt; cc_compiler            : gcc (GCC) 7.0.1 20170421 (Red Hat 7.0.1-0.15)
&gt;&gt; cc_compile_by          : mockbuild
&gt;&gt; cc_compile_domain      : [unknown]
&gt;&gt; cc_compile_date        : Wed May  3 21:23:49 UTC 2017
&gt;&gt; build_id               : 1c6e5a40165e05837303942b54757ae1f2d5033d
&gt;&gt; xend_config_format     : 4
&gt;&gt;
&gt;&gt; ---------------------------------------------------
&gt;&gt; # cat vmtest.xml
&gt;&gt; &lt;domain type='xen' id='21'&gt;
&gt;&gt;    &lt;name&gt;testVM&lt;/name&gt;
&gt;&gt;    &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;
&gt;&gt;    &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMemory&gt;
&gt;&gt;    &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
&gt;&gt;    &lt;os&gt;
&gt;&gt;      &lt;type arch='x86_64' machine='xenfv'&gt;hvm&lt;/type&gt;
&gt;&gt;      &lt;loader type='rom'&gt;/usr/lib/xen/boot/hvmloader&lt;/loader&gt;
&gt;&gt;      &lt;boot dev='network'/&gt;
&gt;&gt;    &lt;/os&gt;
&gt;&gt;    &lt;features&gt;
&gt;&gt;      &lt;acpi/&gt;
&gt;&gt;      &lt;apic/&gt;
&gt;&gt;      &lt;pae/&gt;
&gt;&gt;    &lt;/features&gt;
&gt;&gt;    &lt;clock offset='variable' adjustment='0' basis='utc'/&gt;
&gt;&gt;    &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
&gt;&gt;    &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
&gt;&gt;    &lt;on_crash&gt;restart&lt;/on_crash&gt;
&gt;&gt;    &lt;devices&gt;
&gt;&gt;      &lt;interface type='bridge'&gt;
&gt;&gt;        &lt;mac address='02:02:00:03:00:00'/&gt;
&gt;&gt;        &lt;source bridge='enp1s0'/&gt;
&gt;&gt;        &lt;script path='vif-bridge'/&gt;
&gt;&gt;      &lt;/interface&gt;
&gt;&gt;      &lt;serial type='pty'&gt;
&gt;&gt;        &lt;target port='0'/&gt;
&gt;&gt;      &lt;/serial&gt;
&gt;&gt;      &lt;console type='pty'&gt;
&gt;&gt;        &lt;target type='serial' port='0'/&gt;
&gt;&gt;      &lt;/console&gt;
&gt;&gt;      &lt;input type='mouse' bus='ps2'/&gt;
&gt;&gt;      &lt;input type='keyboard' bus='ps2'/&gt;
&gt;&gt;      &lt;graphics type='vnc' port='5901' autoport='no'
&gt;&gt; listen='192.168.131.54'&gt;
&gt;&gt;        &lt;listen type='address' address='192.168.131.54'/&gt;
&gt;&gt;      &lt;/graphics&gt;
&gt;&gt;    &lt;/devices&gt;
&gt;&gt; &lt;/domain&gt;
&gt;&gt;
&gt;&gt; --------------------------------------
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; libvirt-users mailing list
&gt;&gt; libvirt-users@redhat.com
&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;
&gt;&gt;
&gt;
_______________________________________________
libvirt-users mailing list
libvirt-users@redhat.com
https://www.redhat.com/mailman/listinfo/libvirt-users

[Attachment #3 (text/html)]

&lt;div dir="auto"&gt;Note that this does not help with the original problem but points out \
a critical design flaw.&lt;div dir="auto"&gt;&lt;br&gt;&lt;div dir="auto"&gt;To me your it \
infrastructure design has no working disaster recovery plan. You should always be \
able to access critical functionality and from there be able to restore complete \
functionality step by step. In your case the outermost functionality is the vm host. \
You should always be able to log into that machine once it has all cables plugged in, \
regardless of what runs on it (or not).&lt;/div&gt;&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;This means \
that even though you might get this to work you should rethink your design so that \
you do not have to rely on the vm that does the networking.&lt;br&gt;&lt;div \
class="gmail_extra" dir="auto"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;On 26 Jul 2017 12:50 \
p.m., "G Crowe" &lt;&lt;a \
href="mailto:gclvirtlist@crowie.net"&gt;gclvirtlist@crowie.net&lt;/a&gt;&gt; wrote:&lt;br \
type="attribution"&gt;&lt;blockquote class="quote" style="margin:0 0 0 .8ex;border-left:1px \
#ccc solid;padding-left:1ex"&gt;Jim,&lt;br&gt;  Thanks for that, I had manually installed \
libvirt-daemon-driver-xen, but also needed to install libvirt-daemon-driver-libxl. I \
can now create VMs and convert config formats.&lt;br&gt; &lt;br&gt;
However the daemon still fails to start on bootup. It starts fine when I manually \
start it with "systemctl start libvirtd" but setting it to autostart with \
"systemctl enable libvirtd" seems to have no effect. When I look at the \
status, it tells me that the service is "enabled" which means that it \
starts on bootup (well, that's what it means for any other service).&lt;br&gt; &lt;br&gt;
This is rather critical on this PC, as it has unattended restarts and the VPN/routing \
is done in one of the VMs (i.e. I can't get to it unless it auto-starts at least \
one VM).&lt;br&gt; &lt;br&gt;
Unfortunatley there is nothing appearing in the libvirtd log over a reboot to help \
diagnose.&lt;br&gt; &lt;br&gt;
Any suggestions?&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
Thank you&lt;br&gt;
&lt;br&gt;
GC&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
[root@testhost ~]# systemctl status libvirtd&lt;br&gt;
● libvirtd.service - Virtualization daemon&lt;br&gt;
     Loaded: loaded (/usr/lib/systemd/system/libvi&lt;wbr&gt;rtd.service; enabled; vendor \
preset: enabled)&lt;br&gt;  Active: inactive (dead)&lt;br&gt;
        Docs: man:libvirtd(8)&lt;br&gt;
                 &lt;a href="http://libvirt.org" rel="noreferrer" \
target="_blank"&gt;http://libvirt.org&lt;/a&gt;&lt;div class="elided-text"&gt;&lt;br&gt; &lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
On 25/07/2017 1:20 AM, Jim Fehlig wrote:&lt;br&gt;
&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt; On 07/23/2017 04:25 PM, G Crowe wrote:&lt;br&gt;
&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt; Hi,&lt;br&gt;
        I am trying to upgrade my Xen host (Dom0) and are having troubles getting it \
to work.&lt;br&gt; &lt;br&gt;
I think that it has booted into a kernel that supports Xen (running 'xl info' \
does list some Xen capabilities), but I have three problems (that I have found so \
far).&lt;br&gt; &lt;br&gt;
Firstly, the "libvirtd" daemon doesn't start on bootup (and as a result \
all 'virsh' commands fail). It is set to auto-start (systemctl enable \
libvirtd), and can be manually started (systemctl start libvirtd), but it will not \
auto-start on reboot.&lt;br&gt; &lt;br&gt;
Secondly, Once I have manually started libvirtd, when I try to define a domain it \
gives me an error "could not find capabilities for arch=x86_64 \
domaintype=xen" and I haven't yet been able to define any domains. This \
domain type works fine on Fedora 21.&lt;br&gt; &lt;br&gt;
Thirdly, I am unable to convert to/from xml config format, it gives me the error \
"error: invalid argument: unsupported config type xen-xl" however the \
format "xen-xl" works fine on the Fedora 21 machine.&lt;br&gt; &lt;/blockquote&gt;
&lt;br&gt;
It sounds like the libvirt libxl driver is not loaded. Is the \
libvirt-daemon-driver-libxl package installed? If it's installed, enabling debug \
logging in libvirtd can provide hints why it is not loading&lt;br&gt; &lt;br&gt;
&lt;a href="http://libvirt.org/logging.html" rel="noreferrer" \
target="_blank"&gt;http://libvirt.org/logging.htm&lt;wbr&gt;l&lt;/a&gt;&lt;br&gt; &lt;br&gt;
Regards,&lt;br&gt;
Jim&lt;br&gt;
&lt;br&gt;
&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt; &lt;br&gt;
I had these same issues when I tried to upgrade to Fedora 25 and assumed that \
something had been broken and so abandoned further attempts to upgrade, however since \
Fedora 26 is the same I am now assuming that I have stuffed something up myself (or \
missed something).&lt;br&gt; &lt;br&gt;
Fedora 21 uses kernel 3.19.3 and xen 4.4.1&lt;br&gt;
Fedora 26 uses kernel 4.11.8 and xen 4.8.1&lt;br&gt;
&lt;br&gt;
I have tried following the info on &lt;a \
href="https://wiki.xen.org/wiki/Fedora_Host_Installation" rel="noreferrer" \
target="_blank"&gt;https://wiki.xen.org/wiki/Fedo&lt;wbr&gt;ra_Host_Installation&lt;/a&gt; but it \
appears to be out of date now (I used this site when I started using Xen under Fedora \
19, and when I upgraded to Fedora 21)&lt;br&gt; &lt;br&gt;
Does anyone have any suggestions? outputs from "xl info" and the domain \
config are below. I have also tried disabling SELinux, but it made no difference.&lt;br&gt; \
&lt;br&gt; &lt;br&gt;
Thanks&lt;br&gt;
&lt;br&gt;
GC&lt;br&gt;
&lt;br&gt;
------------------------------&lt;wbr&gt;-----------------&lt;br&gt;
On the fedora 26 box.....&lt;br&gt;
# xl info&lt;br&gt;
host                             : family.mydomain.mytld&lt;br&gt;
release                        : 4.11.8-300.fc26.x86_64&lt;br&gt;
version                        : #1 SMP Thu Jun 29 20:09:48 UTC 2017&lt;br&gt;
machine                        : x86_64&lt;br&gt;
nr_cpus                        : 4&lt;br&gt;
max_cpu_id                    : 3&lt;br&gt;
nr_nodes                       : 1&lt;br&gt;
cores_per_socket           : 4&lt;br&gt;
threads_per_core           : 1&lt;br&gt;
cpu_mhz                        : 2712&lt;br&gt;
hw_caps                        : \
b7ebfbff:77faf3bf:2c100800:000&lt;wbr&gt;00121:0000000f:009c67af:000000&lt;wbr&gt;00:00000100&lt;br&gt; \
virt_caps                     : hvm hvm_directio&lt;br&gt; total_memory                 : \
8072&lt;br&gt; free_memory                  : 128&lt;br&gt;
sharing_freed_memory     : 0&lt;br&gt;
sharing_used_memory      : 0&lt;br&gt;
outstanding_claims        : 0&lt;br&gt;
free_cpus                     : 0&lt;br&gt;
xen_major                     : 4&lt;br&gt;
xen_minor                     : 8&lt;br&gt;
xen_extra                     : .1&lt;br&gt;
xen_version                  : 4.8.1&lt;br&gt;
xen_caps                       : xen-3.0-x86_64 xen-3.0-x86_32p hvm-3.0-x86_32 \
hvm-3.0-x86_32p hvm-3.0-x86_64&lt;br&gt; xen_scheduler               : credit&lt;br&gt;
xen_pagesize                 : 4096&lt;br&gt;
platform_params            : virt_start=0xffff800000000000&lt;br&gt;
xen_changeset               :&lt;br&gt;
xen_commandline            : placeholder&lt;br&gt;
cc_compiler                  : gcc (GCC) 7.0.1 20170421 (Red Hat 7.0.1-0.15)&lt;br&gt;
cc_compile_by               : mockbuild&lt;br&gt;
cc_compile_domain         : [unknown]&lt;br&gt;
cc_compile_date            : Wed May   3 21:23:49 UTC 2017&lt;br&gt;
build_id                       : 1c6e5a40165e05837303942b54757a&lt;wbr&gt;e1f2d5033d&lt;br&gt;
xend_config_format        : 4&lt;br&gt;
&lt;br&gt;
------------------------------&lt;wbr&gt;---------------------&lt;br&gt;
# cat vmtest.xml&lt;br&gt;
&lt;domain type='xen' id='21'&gt;&lt;br&gt;
     &lt;name&gt;testVM&lt;/name&gt;&lt;br&gt;
     &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;&lt;br&gt;
     &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMem&lt;wbr&gt;ory&gt;&lt;br&gt;
     &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;&lt;br&gt;
     &lt;os&gt;&lt;br&gt;
        &lt;type arch='x86_64' \
                machine='xenfv'&gt;hvm&lt;/type&gt;&lt;br&gt;
        &lt;loader type='rom'&gt;/usr/lib/xen/boot/h&lt;wbr&gt;vmloader&lt;/loader&gt;&lt;br&gt;
  &lt;boot dev='network'/&gt;&lt;br&gt;
     &lt;/os&gt;&lt;br&gt;
     &lt;features&gt;&lt;br&gt;
        &lt;acpi/&gt;&lt;br&gt;
        &lt;apic/&gt;&lt;br&gt;
        &lt;pae/&gt;&lt;br&gt;
     &lt;/features&gt;&lt;br&gt;
     &lt;clock offset='variable' adjustment='0' \
basis='utc'/&gt;&lt;br&gt;  &lt;on_poweroff&gt;destroy&lt;/on_powe&lt;wbr&gt;roff&gt;&lt;br&gt;
     &lt;on_reboot&gt;restart&lt;/on_&lt;wbr&gt;reboot&gt;&lt;br&gt;
     &lt;on_crash&gt;restart&lt;/on_crash&gt;&lt;br&gt;
     &lt;devices&gt;&lt;br&gt;
        &lt;interface type='bridge'&gt;&lt;br&gt;
           &lt;mac address='02:02:00:03:00:00'/&gt;&lt;br&gt;
           &lt;source bridge='enp1s0'/&gt;&lt;br&gt;
           &lt;script path='vif-bridge'/&gt;&lt;br&gt;
        &lt;/interface&gt;&lt;br&gt;
        &lt;serial type='pty'&gt;&lt;br&gt;
           &lt;target port='0'/&gt;&lt;br&gt;
        &lt;/serial&gt;&lt;br&gt;
        &lt;console type='pty'&gt;&lt;br&gt;
           &lt;target type='serial' port='0'/&gt;&lt;br&gt;
        &lt;/console&gt;&lt;br&gt;
        &lt;input type='mouse' bus='ps2'/&gt;&lt;br&gt;
        &lt;input type='keyboard' bus='ps2'/&gt;&lt;br&gt;
        &lt;graphics type='vnc' port='5901' autoport='no' \
                listen='192.168.131.54'&gt;&lt;br&gt;
           &lt;listen type='address' \
address='192.168.131.54'/&gt;&lt;br&gt;  &lt;/graphics&gt;&lt;br&gt;
     &lt;/devices&gt;&lt;br&gt;
&lt;/domain&gt;&lt;br&gt;
&lt;br&gt;
------------------------------&lt;wbr&gt;--------&lt;br&gt;
&lt;br&gt;
______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt; \
&lt;br&gt; &lt;/blockquote&gt;
&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;
______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;




</body></email><email><emailId>20170726141934</emailId><senderName>Jim Fehlig</senderName><senderEmail>jfehlig@suse.com</senderEmail><timestampReceived>2017-07-26 14:19:34-0400</timestampReceived><subject>Re: [libvirt-users] Xen died - Fedora upgrade from 21 to 26</subject><body>

On 07/26/2017 04:46 AM, G Crowe wrote:
&gt; Jim,
&gt;      Thanks for that, I had manually installed libvirt-daemon-driver-xen, but 
&gt; also needed to install libvirt-daemon-driver-libxl. I can now create VMs and 
&gt; convert config formats.
&gt; 
&gt; However the daemon still fails to start on bootup. It starts fine when I 
&gt; manually start it with "systemctl start libvirtd" but setting it to autostart 
&gt; with "systemctl enable libvirtd" seems to have no effect. When I look at the 
&gt; status, it tells me that the service is "enabled" which means that it starts on 
&gt; bootup (well, that's what it means for any other service).

I think you'll need to debug the startup problem via systemd, e.g. using 
systemd-analyze. Perhaps it is not starting do to conflicts with other services, 
e.g. xendomains. Do you also have xendomains service enabled? If so, disable it 
since it should not be used with libvirt.

Regards,
Jim

</body></email><email><emailId>20170730010818</emailId><senderName>Sam Varshavchik</senderName><senderEmail>mrsam@courier-mta.com</senderEmail><timestampReceived>2017-07-30 01:08:18-0400</timestampReceived><subject>[libvirt-users] =?utf-8?q?Changing_=3Con=5Freboot=3E_in_the_domai?= =?utf-8?q?n_XML_file?=</subject><body>


Using virsh edit, I made the following change to the domain XML file:

&lt;on_reboot&gt;destroy&lt;/on_reboot&gt;

But this appears to do nothing. The VM guest is Windows 10, and when  
directing it to reboot, it still reboots, instead of shutting off the VM.

I was trying to work around some kind of a bug, somewhere, that started  
happening after updating to Fedora 26 and qemu 2.9, where a reboot throws my  
Windows 10 guests into some kind of a bizarre automatic recovery mode, which  
then claims that the hard drive is hosed. It's not, and a forced shutdown  
followed by a cold start boots everything back up like nothing has happened  
(which I didn't figure out until reinstalling one of the guests, sigh...),  
and everything is peachy once again.

So, anyway, I was trying to figure out a way around it, and  
&lt;on_reboot&gt;destroy&lt;/on-reboot&gt; seemed to be exactly what I was looking for.

Perusing qemu's man page, it seems that this option should result in a -no- 
reboot option getting added to qemu's command line. But, looking at the  
actual command line, after starting the VM, it's nowhere to be seen.

A bit more Google-fu found this:

http://blog.vmsplice.net/2011/04/how-to-pass-qemu-command-line-options.html

And I manually added a -no-reboot option to the domain XML file that way.

And you know what? After doing that, telling Windows 10 to reboot simply  
shuts off the VM. Wonderful.

But that still leaves me wondering: what's up with the &lt;on_reboot&gt; tag? Why  
didn't it work? Is this a PEBCAK, or something worth throwing a ticket for?



[Attachment #3 (application/pgp-signature)]

</body></email><email><emailId>20170726142825</emailId><senderName>Alvin Starr</senderName><senderEmail>alvin@netvel.net</senderEmail><timestampReceived>2017-07-26 14:28:25-0400</timestampReceived><subject>Re: [libvirt-users] Xen died - Fedora upgrade from 21 to 26</subject><body>

I believe this problem also exists in F25.

There are upsides to having a vm do the networking and I have used that 
scheme for something like a decade.

The point is that libvirt should start up and start its VM's correctly.

If you cannot depend on the system starting correctly then very quickly 
you cannot depend on the system at all and then your backing out to your 
switches and network cables and power supplies .....

My guess is that its related to libvirt trying to start before the xen 
subsystems have come up.



On 07/26/2017 09:32 AM, Dominik Psenner wrote:
&gt; Note that this does not help with the original problem but points out 
&gt; a critical design flaw.
&gt;
&gt; To me your it infrastructure design has no working disaster recovery 
&gt; plan. You should always be able to access critical functionality and 
&gt; from there be able to restore complete functionality step by step. In 
&gt; your case the outermost functionality is the vm host. You should 
&gt; always be able to log into that machine once it has all cables plugged 
&gt; in, regardless of what runs on it (or not).
&gt;
&gt; This means that even though you might get this to work you should 
&gt; rethink your design so that you do not have to rely on the vm that 
&gt; does the networking.
&gt;
&gt; On 26 Jul 2017 12:50 p.m., "G Crowe" &lt;gclvirtlist@crowie.net 
&gt; &lt;mailto:gclvirtlist@crowie.net&gt;&gt; wrote:
&gt;
&gt;     Jim,
&gt;         Thanks for that, I had manually installed
&gt;     libvirt-daemon-driver-xen, but also needed to install
&gt;     libvirt-daemon-driver-libxl. I can now create VMs and convert
&gt;     config formats.
&gt;
&gt;     However the daemon still fails to start on bootup. It starts fine
&gt;     when I manually start it with "systemctl start libvirtd" but
&gt;     setting it to autostart with "systemctl enable libvirtd" seems to
&gt;     have no effect. When I look at the status, it tells me that the
&gt;     service is "enabled" which means that it starts on bootup (well,
&gt;     that's what it means for any other service).
&gt;
&gt;     This is rather critical on this PC, as it has unattended restarts
&gt;     and the VPN/routing is done in one of the VMs (i.e. I can't get to
&gt;     it unless it auto-starts at least one VM).
&gt;
&gt;     Unfortunatley there is nothing appearing in the libvirtd log over
&gt;     a reboot to help diagnose.
&gt;
&gt;     Any suggestions?
&gt;
&gt;
&gt;     Thank you
&gt;
&gt;     GC
&gt;
&gt;
&gt;     [root@testhost ~]# systemctl status libvirtd
&gt;     â libvirtd.service - Virtualization daemon
&gt;        Loaded: loaded (/usr/lib/systemd/system/libvirtd.service;
&gt;     enabled; vendor preset: enabled)
&gt;        Active: inactive (dead)
&gt;          Docs: man:libvirtd(8)
&gt;     http://libvirt.org
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;     On 25/07/2017 1:20 AM, Jim Fehlig wrote:
&gt;
&gt;         On 07/23/2017 04:25 PM, G Crowe wrote:
&gt;
&gt;             Hi,
&gt;                  I am trying to upgrade my Xen host (Dom0) and are
&gt;             having troubles getting it to work.
&gt;
&gt;             I think that it has booted into a kernel that supports Xen
&gt;             (running 'xl info' does list some Xen capabilities), but I
&gt;             have three problems (that I have found so far).
&gt;
&gt;             Firstly, the "libvirtd" daemon doesn't start on bootup
&gt;             (and as a result all 'virsh' commands fail). It is set to
&gt;             auto-start (systemctl enable libvirtd), and can be
&gt;             manually started (systemctl start libvirtd), but it will
&gt;             not auto-start on reboot.
&gt;
&gt;             Secondly, Once I have manually started libvirtd, when I
&gt;             try to define a domain it gives me an error "could not
&gt;             find capabilities for arch=x86_64 domaintype=xen" and I
&gt;             haven't yet been able to define any domains. This domain
&gt;             type works fine on Fedora 21.
&gt;
&gt;             Thirdly, I am unable to convert to/from xml config format,
&gt;             it gives me the error "error: invalid argument:
&gt;             unsupported config type xen-xl" however the format
&gt;             "xen-xl" works fine on the Fedora 21 machine.
&gt;
&gt;
&gt;         It sounds like the libvirt libxl driver is not loaded. Is the
&gt;         libvirt-daemon-driver-libxl package installed? If it's
&gt;         installed, enabling debug logging in libvirtd can provide
&gt;         hints why it is not loading
&gt;
&gt;         http://libvirt.org/logging.html &lt;http://libvirt.org/logging.html&gt;
&gt;
&gt;         Regards,
&gt;         Jim
&gt;
&gt;
&gt;             I had these same issues when I tried to upgrade to Fedora
&gt;             25 and assumed that something had been broken and so
&gt;             abandoned further attempts to upgrade, however since
&gt;             Fedora 26 is the same I am now assuming that I have
&gt;             stuffed something up myself (or missed something).
&gt;
&gt;             Fedora 21 uses kernel 3.19.3 and xen 4.4.1
&gt;             Fedora 26 uses kernel 4.11.8 and xen 4.8.1
&gt;
&gt;             I have tried following the info on
&gt;             https://wiki.xen.org/wiki/Fedora_Host_Installation
&gt;             &lt;https://wiki.xen.org/wiki/Fedora_Host_Installation&gt; but
&gt;             it appears to be out of date now (I used this site when I
&gt;             started using Xen under Fedora 19, and when I upgraded to
&gt;             Fedora 21)
&gt;
&gt;             Does anyone have any suggestions? outputs from "xl info"
&gt;             and the domain config are below. I have also tried
&gt;             disabling SELinux, but it made no difference.
&gt;
&gt;
&gt;             Thanks
&gt;
&gt;             GC
&gt;
&gt;             -----------------------------------------------
&gt;             On the fedora 26 box.....
&gt;             # xl info
&gt;             host                   : family.mydomain.mytld
&gt;             release                : 4.11.8-300.fc26.x86_64
&gt;             version                : #1 SMP Thu Jun 29 20:09:48 UTC 2017
&gt;             machine                : x86_64
&gt;             nr_cpus                : 4
&gt;             max_cpu_id             : 3
&gt;             nr_nodes               : 1
&gt;             cores_per_socket       : 4
&gt;             threads_per_core       : 1
&gt;             cpu_mhz                : 2712
&gt;             hw_caps                :
&gt;             b7ebfbff:77faf3bf:2c100800:00000121:0000000f:009c67af:00000000:00000100
&gt;             virt_caps              : hvm hvm_directio
&gt;             total_memory           : 8072
&gt;             free_memory            : 128
&gt;             sharing_freed_memory   : 0
&gt;             sharing_used_memory    : 0
&gt;             outstanding_claims     : 0
&gt;             free_cpus              : 0
&gt;             xen_major              : 4
&gt;             xen_minor              : 8
&gt;             xen_extra              : .1
&gt;             xen_version            : 4.8.1
&gt;             xen_caps               : xen-3.0-x86_64 xen-3.0-x86_32p
&gt;             hvm-3.0-x86_32 hvm-3.0-x86_32p hvm-3.0-x86_64
&gt;             xen_scheduler          : credit
&gt;             xen_pagesize           : 4096
&gt;             platform_params        : virt_start=0xffff800000000000
&gt;             xen_changeset          :
&gt;             xen_commandline        : placeholder
&gt;             cc_compiler            : gcc (GCC) 7.0.1 20170421 (Red Hat
&gt;             7.0.1-0.15)
&gt;             cc_compile_by          : mockbuild
&gt;             cc_compile_domain      : [unknown]
&gt;             cc_compile_date        : Wed May  3 21:23:49 UTC 2017
&gt;             build_id               :
&gt;             1c6e5a40165e05837303942b54757ae1f2d5033d
&gt;             xend_config_format     : 4
&gt;
&gt;             ---------------------------------------------------
&gt;             # cat vmtest.xml
&gt;             &lt;domain type='xen' id='21'&gt;
&gt;                &lt;name&gt;testVM&lt;/name&gt;
&gt;                &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;
&gt;                &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMemory&gt;
&gt;                &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
&gt;                &lt;os&gt;
&gt;                  &lt;type arch='x86_64' machine='xenfv'&gt;hvm&lt;/type&gt;
&gt;                  &lt;loader type='rom'&gt;/usr/lib/xen/boot/hvmloader&lt;/loader&gt;
&gt;                  &lt;boot dev='network'/&gt;
&gt;                &lt;/os&gt;
&gt;                &lt;features&gt;
&gt;                  &lt;acpi/&gt;
&gt;                  &lt;apic/&gt;
&gt;                  &lt;pae/&gt;
&gt;                &lt;/features&gt;
&gt;                &lt;clock offset='variable' adjustment='0' basis='utc'/&gt;
&gt;                &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
&gt;                &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
&gt;                &lt;on_crash&gt;restart&lt;/on_crash&gt;
&gt;                &lt;devices&gt;
&gt;                  &lt;interface type='bridge'&gt;
&gt;                    &lt;mac address='02:02:00:03:00:00'/&gt;
&gt;                    &lt;source bridge='enp1s0'/&gt;
&gt;                    &lt;script path='vif-bridge'/&gt;
&gt;                  &lt;/interface&gt;
&gt;                  &lt;serial type='pty'&gt;
&gt;                    &lt;target port='0'/&gt;
&gt;                  &lt;/serial&gt;
&gt;                  &lt;console type='pty'&gt;
&gt;                    &lt;target type='serial' port='0'/&gt;
&gt;                  &lt;/console&gt;
&gt;                  &lt;input type='mouse' bus='ps2'/&gt;
&gt;                  &lt;input type='keyboard' bus='ps2'/&gt;
&gt;                  &lt;graphics type='vnc' port='5901' autoport='no'
&gt;             listen='192.168.131.54'&gt;
&gt;                    &lt;listen type='address' address='192.168.131.54'/&gt;
&gt;                  &lt;/graphics&gt;
&gt;                &lt;/devices&gt;
&gt;             &lt;/domain&gt;
&gt;
&gt;             --------------------------------------
&gt;
&gt;             _______________________________________________
&gt;             libvirt-users mailing list
&gt;             libvirt-users@redhat.com &lt;mailto:libvirt-users@redhat.com&gt;
&gt;             https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;             &lt;https://www.redhat.com/mailman/listinfo/libvirt-users&gt;
&gt;
&gt;
&gt;
&gt;     _______________________________________________
&gt;     libvirt-users mailing list
&gt;     libvirt-users@redhat.com &lt;mailto:libvirt-users@redhat.com&gt;
&gt;     https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;     &lt;https://www.redhat.com/mailman/listinfo/libvirt-users&gt;
&gt;
&gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users

-- 
Alvin Starr                   ||   land:  (905)513-7688
Netvel Inc.                   ||   Cell:  (416)806-0133
alvin@netvel.net              ||


[Attachment #3 (text/html)]

&lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
  &lt;/head&gt;
  &lt;body text="#000000" bgcolor="#FFFFFF"&gt;
    &lt;p&gt;I believe this problem also exists in F25.&lt;/p&gt;
    &lt;p&gt;There are upsides to having a vm do the networking and I have
      used that scheme for something like a decade.&lt;/p&gt;
    &lt;p&gt;The point is that libvirt should start up and start its VM's
      correctly.&lt;/p&gt;
    &lt;p&gt;If you cannot depend on the system starting correctly then very
      quickly you cannot depend on the system at all and then your
      backing out to your switches and network cables and power supplies
      .....&lt;/p&gt;
    &lt;p&gt;My guess is that its related to libvirt trying to start before
      the xen subsystems have come up.&lt;/p&gt;
    &lt;p&gt;&lt;br&gt;
    &lt;/p&gt;
    &lt;br&gt;
    &lt;div class="moz-cite-prefix"&gt;On 07/26/2017 09:32 AM, Dominik Psenner
      wrote:&lt;br&gt;
    &lt;/div&gt;
    &lt;blockquote type="cite"
cite="mid:CA+0K2P-_irhVSB2hWszgMasNRz98jw+xenn+zE_LjV28gdoCKQ@mail.gmail.com"&gt;
      &lt;div dir="auto"&gt;Note that this does not help with the original
        problem but points out a critical design flaw.
        &lt;div dir="auto"&gt;&lt;br&gt;
          &lt;div dir="auto"&gt;To me your it infrastructure design has no
            working disaster recovery plan. You should always be able to
            access critical functionality and from there be able to
            restore complete functionality step by step. In your case
            the outermost functionality is the vm host. You should
            always be able to log into that machine once it has all
            cables plugged in, regardless of what runs on it (or not).&lt;/div&gt;
          &lt;div dir="auto"&gt;&lt;br&gt;
          &lt;/div&gt;
          This means that even though you might get this to work you
          should rethink your design so that you do not have to rely on
          the vm that does the networking.&lt;br&gt;
          &lt;div class="gmail_extra" dir="auto"&gt;&lt;br&gt;
            &lt;div class="gmail_quote"&gt;On 26 Jul 2017 12:50 p.m., "G
              Crowe" &lt;&lt;a href="mailto:gclvirtlist@crowie.net"
                moz-do-not-send="true"&gt;gclvirtlist@crowie.net&lt;/a&gt;&gt;
              wrote:&lt;br type="attribution"&gt;
              &lt;blockquote class="quote" style="margin:0 0 0
                .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;Jim,&lt;br&gt;
                    Thanks for that, I had manually installed
                libvirt-daemon-driver-xen, but also needed to install
                libvirt-daemon-driver-libxl. I can now create VMs and
                convert config formats.&lt;br&gt;
                &lt;br&gt;
                However the daemon still fails to start on bootup. It
                starts fine when I manually start it with "systemctl
                start libvirtd" but setting it to autostart with
                "systemctl enable libvirtd" seems to have no effect.
                When I look at the status, it tells me that the service
                is "enabled" which means that it starts on bootup (well,
                that's what it means for any other service).&lt;br&gt;
                &lt;br&gt;
                This is rather critical on this PC, as it has unattended
                restarts and the VPN/routing is done in one of the VMs
                (i.e. I can't get to it unless it auto-starts at least
                one VM).&lt;br&gt;
                &lt;br&gt;
                Unfortunatley there is nothing appearing in the libvirtd
                log over a reboot to help diagnose.&lt;br&gt;
                &lt;br&gt;
                Any suggestions?&lt;br&gt;
                &lt;br&gt;
                &lt;br&gt;
                Thank you&lt;br&gt;
                &lt;br&gt;
                GC&lt;br&gt;
                &lt;br&gt;
                &lt;br&gt;
                [root@testhost ~]# systemctl status libvirtd&lt;br&gt;
                ● libvirtd.service - Virtualization daemon&lt;br&gt;
                   Loaded: loaded (/usr/lib/systemd/system/libvi&lt;wbr&gt;rtd.service;
                enabled; vendor preset: enabled)&lt;br&gt;
                   Active: inactive (dead)&lt;br&gt;
                     Docs: &lt;a class="moz-txt-link-freetext" \
href="man:libvirtd(8)"&gt;man:libvirtd(8)&lt;/a&gt;&lt;br&gt;  &lt;a href="http://libvirt.org" \
                rel="noreferrer"
                  target="_blank" moz-do-not-send="true"&gt;http://libvirt.org&lt;/a&gt;
                &lt;div class="elided-text"&gt;&lt;br&gt;
                  &lt;br&gt;
                  &lt;br&gt;
                  &lt;br&gt;
                  &lt;br&gt;
                  On 25/07/2017 1:20 AM, Jim Fehlig wrote:&lt;br&gt;
                  &lt;blockquote class="gmail_quote" style="margin:0 0 0
                    .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;
                    On 07/23/2017 04:25 PM, G Crowe wrote:&lt;br&gt;
                    &lt;blockquote class="gmail_quote" style="margin:0 0 0
                      .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;
                      Hi,&lt;br&gt;
                           I am trying to upgrade my Xen host (Dom0) and
                      are having troubles getting it to work.&lt;br&gt;
                      &lt;br&gt;
                      I think that it has booted into a kernel that
                      supports Xen (running 'xl info' does list some Xen
                      capabilities), but I have three problems (that I
                      have found so far).&lt;br&gt;
                      &lt;br&gt;
                      Firstly, the "libvirtd" daemon doesn't start on
                      bootup (and as a result all 'virsh' commands
                      fail). It is set to auto-start (systemctl enable
                      libvirtd), and can be manually started (systemctl
                      start libvirtd), but it will not auto-start on
                      reboot.&lt;br&gt;
                      &lt;br&gt;
                      Secondly, Once I have manually started libvirtd,
                      when I try to define a domain it gives me an error
                      "could not find capabilities for arch=x86_64
                      domaintype=xen" and I haven't yet been able to
                      define any domains. This domain type works fine on
                      Fedora 21.&lt;br&gt;
                      &lt;br&gt;
                      Thirdly, I am unable to convert to/from xml config
                      format, it gives me the error "error: invalid
                      argument: unsupported config type xen-xl" however
                      the format "xen-xl" works fine on the Fedora 21
                      machine.&lt;br&gt;
                    &lt;/blockquote&gt;
                    &lt;br&gt;
                    It sounds like the libvirt libxl driver is not
                    loaded. Is the libvirt-daemon-driver-libxl package
                    installed? If it's installed, enabling debug logging
                    in libvirtd can provide hints why it is not loading&lt;br&gt;
                    &lt;br&gt;
                    &lt;a href="http://libvirt.org/logging.html"
                      rel="noreferrer" target="_blank"
                      \
moz-do-not-send="true"&gt;http://libvirt.org/logging.htm&lt;wbr&gt;l&lt;/a&gt;&lt;br&gt;  &lt;br&gt;
                    Regards,&lt;br&gt;
                    Jim&lt;br&gt;
                    &lt;br&gt;
                    &lt;blockquote class="gmail_quote" style="margin:0 0 0
                      .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;
                      &lt;br&gt;
                      I had these same issues when I tried to upgrade to
                      Fedora 25 and assumed that something had been
                      broken and so abandoned further attempts to
                      upgrade, however since Fedora 26 is the same I am
                      now assuming that I have stuffed something up
                      myself (or missed something).&lt;br&gt;
                      &lt;br&gt;
                      Fedora 21 uses kernel 3.19.3 and xen 4.4.1&lt;br&gt;
                      Fedora 26 uses kernel 4.11.8 and xen 4.8.1&lt;br&gt;
                      &lt;br&gt;
                      I have tried following the info on &lt;a
                        href="https://wiki.xen.org/wiki/Fedora_Host_Installation"
                        rel="noreferrer" target="_blank"
                        \
moz-do-not-send="true"&gt;https://wiki.xen.org/wiki/Fedo&lt;wbr&gt;ra_Host_Installation&lt;/a&gt;  \
but it appears to be out of date now (I used this  site when I started using Xen \
under Fedora 19, and  when I upgraded to Fedora 21)&lt;br&gt;
                      &lt;br&gt;
                      Does anyone have any suggestions? outputs from "xl
                      info" and the domain config are below. I have also
                      tried disabling SELinux, but it made no
                      difference.&lt;br&gt;
                      &lt;br&gt;
                      &lt;br&gt;
                      Thanks&lt;br&gt;
                      &lt;br&gt;
                      GC&lt;br&gt;
                      &lt;br&gt;
                      ------------------------------&lt;wbr&gt;-----------------&lt;br&gt;
                      On the fedora 26 box.....&lt;br&gt;
                      # xl info&lt;br&gt;
                      host                   : family.mydomain.mytld&lt;br&gt;
                      release                : 4.11.8-300.fc26.x86_64&lt;br&gt;
                      version                : #1 SMP Thu Jun 29
                      20:09:48 UTC 2017&lt;br&gt;
                      machine                : x86_64&lt;br&gt;
                      nr_cpus                : 4&lt;br&gt;
                      max_cpu_id             : 3&lt;br&gt;
                      nr_nodes               : 1&lt;br&gt;
                      cores_per_socket       : 4&lt;br&gt;
                      threads_per_core       : 1&lt;br&gt;
                      cpu_mhz                : 2712&lt;br&gt;
                      hw_caps                :
                      \
b7ebfbff:77faf3bf:2c100800:000&lt;wbr&gt;00121:0000000f:009c67af:000000&lt;wbr&gt;00:00000100&lt;br&gt; \
virt_caps              : hvm hvm_directio&lt;br&gt;  total_memory           : 8072&lt;br&gt;
                      free_memory            : 128&lt;br&gt;
                      sharing_freed_memory   : 0&lt;br&gt;
                      sharing_used_memory    : 0&lt;br&gt;
                      outstanding_claims     : 0&lt;br&gt;
                      free_cpus              : 0&lt;br&gt;
                      xen_major              : 4&lt;br&gt;
                      xen_minor              : 8&lt;br&gt;
                      xen_extra              : .1&lt;br&gt;
                      xen_version            : 4.8.1&lt;br&gt;
                      xen_caps               : xen-3.0-x86_64
                      xen-3.0-x86_32p hvm-3.0-x86_32 hvm-3.0-x86_32p
                      hvm-3.0-x86_64&lt;br&gt;
                      xen_scheduler          : credit&lt;br&gt;
                      xen_pagesize           : 4096&lt;br&gt;
                      platform_params        :
                      virt_start=0xffff800000000000&lt;br&gt;
                      xen_changeset          :&lt;br&gt;
                      xen_commandline        : placeholder&lt;br&gt;
                      cc_compiler            : gcc (GCC) 7.0.1 20170421
                      (Red Hat 7.0.1-0.15)&lt;br&gt;
                      cc_compile_by          : mockbuild&lt;br&gt;
                      cc_compile_domain      : [unknown]&lt;br&gt;
                      cc_compile_date        : Wed May  3 21:23:49 UTC
                      2017&lt;br&gt;
                      build_id               :
                      1c6e5a40165e05837303942b54757a&lt;wbr&gt;e1f2d5033d&lt;br&gt;
                      xend_config_format     : 4&lt;br&gt;
                      &lt;br&gt;
                      ------------------------------&lt;wbr&gt;---------------------&lt;br&gt;
                      # cat vmtest.xml&lt;br&gt;
                      &lt;domain type='xen' id='21'&gt;&lt;br&gt;
                         &lt;name&gt;testVM&lt;/name&gt;&lt;br&gt;
                         &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;&lt;br&gt;
                         &lt;currentMemory
                      unit='KiB'&gt;2097152&lt;/currentMem&lt;wbr&gt;ory&gt;&lt;br&gt;
                         &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;&lt;br&gt;
                         &lt;os&gt;&lt;br&gt;
                           &lt;type arch='x86_64'
                      machine='xenfv'&gt;hvm&lt;/type&gt;&lt;br&gt;
                           &lt;loader \
type='rom'&gt;/usr/lib/xen/boot/h&lt;wbr&gt;vmloader&lt;/loader&gt;&lt;br&gt;  &lt;boot \
dev='network'/&gt;&lt;br&gt;  &lt;/os&gt;&lt;br&gt;
                         &lt;features&gt;&lt;br&gt;
                           &lt;acpi/&gt;&lt;br&gt;
                           &lt;apic/&gt;&lt;br&gt;
                           &lt;pae/&gt;&lt;br&gt;
                         &lt;/features&gt;&lt;br&gt;
                         &lt;clock offset='variable' adjustment='0'
                      basis='utc'/&gt;&lt;br&gt;
                         &lt;on_poweroff&gt;destroy&lt;/on_powe&lt;wbr&gt;roff&gt;&lt;br&gt;
                         &lt;on_reboot&gt;restart&lt;/on_&lt;wbr&gt;reboot&gt;&lt;br&gt;
                         &lt;on_crash&gt;restart&lt;/on_crash&gt;&lt;br&gt;
                         &lt;devices&gt;&lt;br&gt;
                           &lt;interface type='bridge'&gt;&lt;br&gt;
                             &lt;mac address='02:02:00:03:00:00'/&gt;&lt;br&gt;
                             &lt;source bridge='enp1s0'/&gt;&lt;br&gt;
                             &lt;script path='vif-bridge'/&gt;&lt;br&gt;
                           &lt;/interface&gt;&lt;br&gt;
                           &lt;serial type='pty'&gt;&lt;br&gt;
                             &lt;target port='0'/&gt;&lt;br&gt;
                           &lt;/serial&gt;&lt;br&gt;
                           &lt;console type='pty'&gt;&lt;br&gt;
                             &lt;target type='serial' port='0'/&gt;&lt;br&gt;
                           &lt;/console&gt;&lt;br&gt;
                           &lt;input type='mouse' bus='ps2'/&gt;&lt;br&gt;
                           &lt;input type='keyboard' bus='ps2'/&gt;&lt;br&gt;
                           &lt;graphics type='vnc' port='5901'
                      autoport='no' listen='192.168.131.54'&gt;&lt;br&gt;
                             &lt;listen type='address'
                      address='192.168.131.54'/&gt;&lt;br&gt;
                           &lt;/graphics&gt;&lt;br&gt;
                         &lt;/devices&gt;&lt;br&gt;
                      &lt;/domain&gt;&lt;br&gt;
                      &lt;br&gt;
                      ------------------------------&lt;wbr&gt;--------&lt;br&gt;
                      &lt;br&gt;
                      ______________________________&lt;wbr&gt;_________________&lt;br&gt;
                      libvirt-users mailing list&lt;br&gt;
                      &lt;a href="mailto:libvirt-users@redhat.com"
                        target="_blank" \
moz-do-not-send="true"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;  &lt;a
                        href="https://www.redhat.com/mailman/listinfo/libvirt-users"
                        rel="noreferrer" target="_blank"
                        \
moz-do-not-send="true"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;
  &lt;br&gt;
                    &lt;/blockquote&gt;
                    &lt;br&gt;
                  &lt;/blockquote&gt;
                  &lt;br&gt;
                  ______________________________&lt;wbr&gt;_________________&lt;br&gt;
                  libvirt-users mailing list&lt;br&gt;
                  &lt;a href="mailto:libvirt-users@redhat.com"
                    target="_blank" \
moz-do-not-send="true"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;  &lt;a
                    href="https://www.redhat.com/mailman/listinfo/libvirt-users"
                    rel="noreferrer" target="_blank"
                    moz-do-not-send="true"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;/div&gt;
  &lt;/blockquote&gt;
            &lt;/div&gt;
            &lt;br&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;br&gt;
      &lt;fieldset class="mimeAttachmentHeader"&gt;&lt;/fieldset&gt;
      &lt;br&gt;
      &lt;pre wrap=""&gt;_______________________________________________
libvirt-users mailing list
&lt;a class="moz-txt-link-abbreviated" \
href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt; &lt;a \
class="moz-txt-link-freetext" \
href="https://www.redhat.com/mailman/listinfo/libvirt-users"&gt;https://www.redhat.com/mailman/listinfo/libvirt-users&lt;/a&gt;&lt;/pre&gt;
  &lt;/blockquote&gt;
    &lt;br&gt;
    &lt;pre class="moz-signature" cols="72"&gt;-- 
Alvin Starr                   ||   land:  (905)513-7688
Netvel Inc.                   ||   Cell:  (416)806-0133
&lt;a class="moz-txt-link-abbreviated" \
href="mailto:alvin@netvel.net"&gt;alvin@netvel.net&lt;/a&gt;              ||

&lt;/pre&gt;
  &lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170726151226</emailId><senderName>Alvin Starr</senderName><senderEmail>alvin@netvel.net</senderEmail><timestampReceived>2017-07-26 15:12:26-0400</timestampReceived><subject>Re: [libvirt-users] Xen died - Fedora upgrade from 21 to 26</subject><body>

libvirtd is not started by systemd on my f25 laptop

so this may not be xen related.

On 07/26/2017 10:19 AM, Jim Fehlig wrote:
&gt; On 07/26/2017 04:46 AM, G Crowe wrote:
&gt;&gt; Jim,
&gt;&gt;      Thanks for that, I had manually installed 
&gt;&gt; libvirt-daemon-driver-xen, but also needed to install 
&gt;&gt; libvirt-daemon-driver-libxl. I can now create VMs and convert config 
&gt;&gt; formats.
&gt;&gt;
&gt;&gt; However the daemon still fails to start on bootup. It starts fine 
&gt;&gt; when I manually start it with "systemctl start libvirtd" but setting 
&gt;&gt; it to autostart with "systemctl enable libvirtd" seems to have no 
&gt;&gt; effect. When I look at the status, it tells me that the service is 
&gt;&gt; "enabled" which means that it starts on bootup (well, that's what it 
&gt;&gt; means for any other service).
&gt;
&gt; I think you'll need to debug the startup problem via systemd, e.g. 
&gt; using systemd-analyze. Perhaps it is not starting do to conflicts with 
&gt; other services, e.g. xendomains. Do you also have xendomains service 
&gt; enabled? If so, disable it since it should not be used with libvirt.
&gt;
&gt; Regards,
&gt; Jim
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users

-- 
Alvin Starr                   ||   land:  (905)513-7688
Netvel Inc.                   ||   Cell:  (416)806-0133
alvin@netvel.net              ||

</body></email><email><emailId>20170726153529</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-07-26 15:35:29-0400</timestampReceived><subject>Re: [libvirt-users] Xen died - Fedora upgrade from 21 to 26</subject><body>

[off topic]

One day someone had the idea to test a disaster scenario and plugged the
power supply on the server that guarded the security doors. All went quite
well until that someone wanted to enter the server room to power on that
server again. At this moment he noticed that the doors would no longer open
and there was no lock to put a key in. :-D That was a really good lesson to
learn and today it is a good joke that we can laugh about.

It is simple to have a second network cable to provide a fallback mechanism
to log into a critical component of a system. Think about such things, the
day will come when you'll be happy to have it.

[eof off topic]

For me, on the latest ubuntu lts, the libvirtd service starts up fine along
with all guests and shutdown works just fine too in the sense that the host
shuts down the guests by ACPI power off. This might be a regression in the
Fedora dist?

2017-07-26 16:28 GMT+02:00 Alvin Starr &lt;alvin@netvel.net&gt;:

&gt; I believe this problem also exists in F25.
&gt;
&gt; There are upsides to having a vm do the networking and I have used that
&gt; scheme for something like a decade.
&gt;
&gt; The point is that libvirt should start up and start its VM's correctly.
&gt;
&gt; If you cannot depend on the system starting correctly then very quickly
&gt; you cannot depend on the system at all and then your backing out to your
&gt; switches and network cables and power supplies .....
&gt;
&gt; My guess is that its related to libvirt trying to start before the xen
&gt; subsystems have come up.
&gt;
&gt;
&gt;
&gt; On 07/26/2017 09:32 AM, Dominik Psenner wrote:
&gt;
&gt; Note that this does not help with the original problem but points out a
&gt; critical design flaw.
&gt;
&gt; To me your it infrastructure design has no working disaster recovery plan.
&gt; You should always be able to access critical functionality and from there
&gt; be able to restore complete functionality step by step. In your case the
&gt; outermost functionality is the vm host. You should always be able to log
&gt; into that machine once it has all cables plugged in, regardless of what
&gt; runs on it (or not).
&gt;
&gt; This means that even though you might get this to work you should rethink
&gt; your design so that you do not have to rely on the vm that does the
&gt; networking.
&gt;
&gt; On 26 Jul 2017 12:50 p.m., "G Crowe" &lt;gclvirtlist@crowie.net&gt; wrote:
&gt;
&gt; Jim,
&gt;     Thanks for that, I had manually installed libvirt-daemon-driver-xen,
&gt; but also needed to install libvirt-daemon-driver-libxl. I can now create
&gt; VMs and convert config formats.
&gt;
&gt; However the daemon still fails to start on bootup. It starts fine when I
&gt; manually start it with "systemctl start libvirtd" but setting it to
&gt; autostart with "systemctl enable libvirtd" seems to have no effect. When I
&gt; look at the status, it tells me that the service is "enabled" which means
&gt; that it starts on bootup (well, that's what it means for any other service).
&gt;
&gt; This is rather critical on this PC, as it has unattended restarts and the
&gt; VPN/routing is done in one of the VMs (i.e. I can't get to it unless it
&gt; auto-starts at least one VM).
&gt;
&gt; Unfortunatley there is nothing appearing in the libvirtd log over a reboot
&gt; to help diagnose.
&gt;
&gt; Any suggestions?
&gt;
&gt;
&gt; Thank you
&gt;
&gt; GC
&gt;
&gt;
&gt; [root@testhost ~]# systemctl status libvirtd
&gt; ● libvirtd.service - Virtualization daemon
&gt;    Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled;
&gt; vendor preset: enabled)
&gt;    Active: inactive (dead)
&gt;      Docs: man:libvirtd(8)
&gt;            http://libvirt.org
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; On 25/07/2017 1:20 AM, Jim Fehlig wrote:
&gt;
&gt;&gt; On 07/23/2017 04:25 PM, G Crowe wrote:
&gt;&gt;
&gt;&gt;&gt; Hi,
&gt;&gt;&gt;      I am trying to upgrade my Xen host (Dom0) and are having troubles
&gt;&gt;&gt; getting it to work.
&gt;&gt;&gt;
&gt;&gt;&gt; I think that it has booted into a kernel that supports Xen (running 'xl
&gt;&gt;&gt; info' does list some Xen capabilities), but I have three problems (that I
&gt;&gt;&gt; have found so far).
&gt;&gt;&gt;
&gt;&gt;&gt; Firstly, the "libvirtd" daemon doesn't start on bootup (and as a result
&gt;&gt;&gt; all 'virsh' commands fail). It is set to auto-start (systemctl enable
&gt;&gt;&gt; libvirtd), and can be manually started (systemctl start libvirtd), but it
&gt;&gt;&gt; will not auto-start on reboot.
&gt;&gt;&gt;
&gt;&gt;&gt; Secondly, Once I have manually started libvirtd, when I try to define a
&gt;&gt;&gt; domain it gives me an error "could not find capabilities for arch=x86_64
&gt;&gt;&gt; domaintype=xen" and I haven't yet been able to define any domains. This
&gt;&gt;&gt; domain type works fine on Fedora 21.
&gt;&gt;&gt;
&gt;&gt;&gt; Thirdly, I am unable to convert to/from xml config format, it gives me
&gt;&gt;&gt; the error "error: invalid argument: unsupported config type xen-xl" however
&gt;&gt;&gt; the format "xen-xl" works fine on the Fedora 21 machine.
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; It sounds like the libvirt libxl driver is not loaded. Is the
&gt;&gt; libvirt-daemon-driver-libxl package installed? If it's installed, enabling
&gt;&gt; debug logging in libvirtd can provide hints why it is not loading
&gt;&gt;
&gt;&gt; http://libvirt.org/logging.html
&gt;&gt;
&gt;&gt; Regards,
&gt;&gt; Jim
&gt;&gt;
&gt;&gt;
&gt;&gt;&gt; I had these same issues when I tried to upgrade to Fedora 25 and assumed
&gt;&gt;&gt; that something had been broken and so abandoned further attempts to
&gt;&gt;&gt; upgrade, however since Fedora 26 is the same I am now assuming that I have
&gt;&gt;&gt; stuffed something up myself (or missed something).
&gt;&gt;&gt;
&gt;&gt;&gt; Fedora 21 uses kernel 3.19.3 and xen 4.4.1
&gt;&gt;&gt; Fedora 26 uses kernel 4.11.8 and xen 4.8.1
&gt;&gt;&gt;
&gt;&gt;&gt; I have tried following the info on https://wiki.xen.org/wiki/Fedo
&gt;&gt;&gt; ra_Host_Installation but it appears to be out of date now (I used this
&gt;&gt;&gt; site when I started using Xen under Fedora 19, and when I upgraded to
&gt;&gt;&gt; Fedora 21)
&gt;&gt;&gt;
&gt;&gt;&gt; Does anyone have any suggestions? outputs from "xl info" and the domain
&gt;&gt;&gt; config are below. I have also tried disabling SELinux, but it made no
&gt;&gt;&gt; difference.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks
&gt;&gt;&gt;
&gt;&gt;&gt; GC
&gt;&gt;&gt;
&gt;&gt;&gt; -----------------------------------------------
&gt;&gt;&gt; On the fedora 26 box.....
&gt;&gt;&gt; # xl info
&gt;&gt;&gt; host                   : family.mydomain.mytld
&gt;&gt;&gt; release                : 4.11.8-300.fc26.x86_64
&gt;&gt;&gt; version                : #1 SMP Thu Jun 29 20:09:48 UTC 2017
&gt;&gt;&gt; machine                : x86_64
&gt;&gt;&gt; nr_cpus                : 4
&gt;&gt;&gt; max_cpu_id             : 3
&gt;&gt;&gt; nr_nodes               : 1
&gt;&gt;&gt; cores_per_socket       : 4
&gt;&gt;&gt; threads_per_core       : 1
&gt;&gt;&gt; cpu_mhz                : 2712
&gt;&gt;&gt; hw_caps                : b7ebfbff:77faf3bf:2c100800:000
&gt;&gt;&gt; 00121:0000000f:009c67af:00000000:00000100
&gt;&gt;&gt; virt_caps              : hvm hvm_directio
&gt;&gt;&gt; total_memory           : 8072
&gt;&gt;&gt; free_memory            : 128
&gt;&gt;&gt; sharing_freed_memory   : 0
&gt;&gt;&gt; sharing_used_memory    : 0
&gt;&gt;&gt; outstanding_claims     : 0
&gt;&gt;&gt; free_cpus              : 0
&gt;&gt;&gt; xen_major              : 4
&gt;&gt;&gt; xen_minor              : 8
&gt;&gt;&gt; xen_extra              : .1
&gt;&gt;&gt; xen_version            : 4.8.1
&gt;&gt;&gt; xen_caps               : xen-3.0-x86_64 xen-3.0-x86_32p hvm-3.0-x86_32
&gt;&gt;&gt; hvm-3.0-x86_32p hvm-3.0-x86_64
&gt;&gt;&gt; xen_scheduler          : credit
&gt;&gt;&gt; xen_pagesize           : 4096
&gt;&gt;&gt; platform_params        : virt_start=0xffff800000000000
&gt;&gt;&gt; xen_changeset          :
&gt;&gt;&gt; xen_commandline        : placeholder
&gt;&gt;&gt; cc_compiler            : gcc (GCC) 7.0.1 20170421 (Red Hat 7.0.1-0.15)
&gt;&gt;&gt; cc_compile_by          : mockbuild
&gt;&gt;&gt; cc_compile_domain      : [unknown]
&gt;&gt;&gt; cc_compile_date        : Wed May  3 21:23:49 UTC 2017
&gt;&gt;&gt; build_id               : 1c6e5a40165e05837303942b54757ae1f2d5033d
&gt;&gt;&gt; xend_config_format     : 4
&gt;&gt;&gt;
&gt;&gt;&gt; ---------------------------------------------------
&gt;&gt;&gt; # cat vmtest.xml
&gt;&gt;&gt; &lt;domain type='xen' id='21'&gt;
&gt;&gt;&gt;    &lt;name&gt;testVM&lt;/name&gt;
&gt;&gt;&gt;    &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;
&gt;&gt;&gt;    &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMemory&gt;
&gt;&gt;&gt;    &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
&gt;&gt;&gt;    &lt;os&gt;
&gt;&gt;&gt;      &lt;type arch='x86_64' machine='xenfv'&gt;hvm&lt;/type&gt;
&gt;&gt;&gt;      &lt;loader type='rom'&gt;/usr/lib/xen/boot/hvmloader&lt;/loader&gt;
&gt;&gt;&gt;      &lt;boot dev='network'/&gt;
&gt;&gt;&gt;    &lt;/os&gt;
&gt;&gt;&gt;    &lt;features&gt;
&gt;&gt;&gt;      &lt;acpi/&gt;
&gt;&gt;&gt;      &lt;apic/&gt;
&gt;&gt;&gt;      &lt;pae/&gt;
&gt;&gt;&gt;    &lt;/features&gt;
&gt;&gt;&gt;    &lt;clock offset='variable' adjustment='0' basis='utc'/&gt;
&gt;&gt;&gt;    &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
&gt;&gt;&gt;    &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
&gt;&gt;&gt;    &lt;on_crash&gt;restart&lt;/on_crash&gt;
&gt;&gt;&gt;    &lt;devices&gt;
&gt;&gt;&gt;      &lt;interface type='bridge'&gt;
&gt;&gt;&gt;        &lt;mac address='02:02:00:03:00:00'/&gt;
&gt;&gt;&gt;        &lt;source bridge='enp1s0'/&gt;
&gt;&gt;&gt;        &lt;script path='vif-bridge'/&gt;
&gt;&gt;&gt;      &lt;/interface&gt;
&gt;&gt;&gt;      &lt;serial type='pty'&gt;
&gt;&gt;&gt;        &lt;target port='0'/&gt;
&gt;&gt;&gt;      &lt;/serial&gt;
&gt;&gt;&gt;      &lt;console type='pty'&gt;
&gt;&gt;&gt;        &lt;target type='serial' port='0'/&gt;
&gt;&gt;&gt;      &lt;/console&gt;
&gt;&gt;&gt;      &lt;input type='mouse' bus='ps2'/&gt;
&gt;&gt;&gt;      &lt;input type='keyboard' bus='ps2'/&gt;
&gt;&gt;&gt;      &lt;graphics type='vnc' port='5901' autoport='no'
&gt;&gt;&gt; listen='192.168.131.54'&gt;
&gt;&gt;&gt;        &lt;listen type='address' address='192.168.131.54'/&gt;
&gt;&gt;&gt;      &lt;/graphics&gt;
&gt;&gt;&gt;    &lt;/devices&gt;
&gt;&gt;&gt; &lt;/domain&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; --------------------------------------
&gt;&gt;&gt;
&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt; libvirt-users mailing list
&gt;&gt;&gt; libvirt-users@redhat.com
&gt;&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;
&gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing listlibvirt-users@redhat.comhttps://www.redhat.com/mailman/listinfo/libvirt-users
&gt;
&gt;
&gt; --
&gt; Alvin Starr                   ||   land:  (905)513-7688
&gt; Netvel Inc.                   ||   Cell:  (416)806-0133alvin@netvel.net              ||
&gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;



-- 
Dominik Psenner

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;[off topic]&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;One day someone had the idea to \
test a disaster scenario and plugged the power supply on the server that guarded the \
security doors. All went quite well until that someone wanted to enter the server \
room to power on that server again. At this moment he noticed that the doors would no \
longer open and there was no lock to put a key in. :-D That was a really good lesson \
to learn and today it is a good joke that we can laugh about.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It \
is simple to have a second network cable to provide a fallback mechanism to log into \
a critical component of a system. Think about such things, the day will come when \
you'll be happy to have it.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[eof off \
topic]&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;For me, on the latest ubuntu lts, the libvirtd \
service starts up fine along with all guests and shutdown works just fine too in the \
sense that the host shuts down the guests by ACPI power off. This might be a \
regression in the Fedora dist?&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-07-26 16:28 GMT+02:00 Alvin Starr &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:alvin@netvel.net" \
target="_blank"&gt;alvin@netvel.net&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;  
    
  
  &lt;div text="#000000" bgcolor="#FFFFFF"&gt;
    &lt;p&gt;I believe this problem also exists in F25.&lt;/p&gt;
    &lt;p&gt;There are upsides to having a vm do the networking and I have
      used that scheme for something like a decade.&lt;/p&gt;
    &lt;p&gt;The point is that libvirt should start up and start its VM's
      correctly.&lt;/p&gt;
    &lt;p&gt;If you cannot depend on the system starting correctly then very
      quickly you cannot depend on the system at all and then your
      backing out to your switches and network cables and power supplies
      .....&lt;/p&gt;
    &lt;p&gt;My guess is that its related to libvirt trying to start before
      the xen subsystems have come up.&lt;/p&gt;&lt;div&gt;&lt;div class="h5"&gt;
    &lt;p&gt;&lt;br&gt;
    &lt;/p&gt;
    &lt;br&gt;
    &lt;div class="m_-8157491304586002949moz-cite-prefix"&gt;On 07/26/2017 09:32 AM, \
Dominik Psenner  wrote:&lt;br&gt;
    &lt;/div&gt;
    &lt;blockquote type="cite"&gt;
      &lt;div dir="auto"&gt;Note that this does not help with the original
        problem but points out a critical design flaw.
        &lt;div dir="auto"&gt;&lt;br&gt;
          &lt;div dir="auto"&gt;To me your it infrastructure design has no
            working disaster recovery plan. You should always be able to
            access critical functionality and from there be able to
            restore complete functionality step by step. In your case
            the outermost functionality is the vm host. You should
            always be able to log into that machine once it has all
            cables plugged in, regardless of what runs on it (or not).&lt;/div&gt;
          &lt;div dir="auto"&gt;&lt;br&gt;
          &lt;/div&gt;
          This means that even though you might get this to work you
          should rethink your design so that you do not have to rely on
          the vm that does the networking.&lt;br&gt;
          &lt;div class="gmail_extra" dir="auto"&gt;&lt;br&gt;
            &lt;div class="gmail_quote"&gt;On 26 Jul 2017 12:50 p.m., "G
              Crowe" &lt;&lt;a href="mailto:gclvirtlist@crowie.net" \
target="_blank"&gt;gclvirtlist@crowie.net&lt;/a&gt;&gt;  wrote:&lt;br type="attribution"&gt;
              &lt;blockquote class="m_-8157491304586002949quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;Jim,&lt;br&gt;  Thanks for that, I had \
manually installed  libvirt-daemon-driver-xen, but also needed to install
                libvirt-daemon-driver-libxl. I can now create VMs and
                convert config formats.&lt;br&gt;
                &lt;br&gt;
                However the daemon still fails to start on bootup. It
                starts fine when I manually start it with "systemctl
                start libvirtd" but setting it to autostart with
                "systemctl enable libvirtd" seems to have no effect.
                When I look at the status, it tells me that the service
                is "enabled" which means that it starts on bootup (well,
                that's what it means for any other service).&lt;br&gt;
                &lt;br&gt;
                This is rather critical on this PC, as it has unattended
                restarts and the VPN/routing is done in one of the VMs
                (i.e. I can't get to it unless it auto-starts at least
                one VM).&lt;br&gt;
                &lt;br&gt;
                Unfortunatley there is nothing appearing in the libvirtd
                log over a reboot to help diagnose.&lt;br&gt;
                &lt;br&gt;
                Any suggestions?&lt;br&gt;
                &lt;br&gt;
                &lt;br&gt;
                Thank you&lt;br&gt;
                &lt;br&gt;
                GC&lt;br&gt;
                &lt;br&gt;
                &lt;br&gt;
                [root@testhost ~]# systemctl status libvirtd&lt;br&gt;
                ● libvirtd.service - Virtualization daemon&lt;br&gt;
                     Loaded: loaded (/usr/lib/systemd/system/libvi&lt;wbr&gt;rtd.service;
                enabled; vendor preset: enabled)&lt;br&gt;
                     Active: inactive (dead)&lt;br&gt;
                        Docs: &lt;a \
                class="m_-8157491304586002949moz-txt-link-freetext"&gt;man:libvirtd(8)&lt;/a&gt;&lt;br&gt;
                
                                 &lt;a href="http://libvirt.org" rel="noreferrer" \
target="_blank"&gt;http://libvirt.org&lt;/a&gt;  &lt;div \
class="m_-8157491304586002949elided-text"&gt;&lt;br&gt;  &lt;br&gt;
                  &lt;br&gt;
                  &lt;br&gt;
                  &lt;br&gt;
                  On 25/07/2017 1:20 AM, Jim Fehlig wrote:&lt;br&gt;
                  &lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;  On 07/23/2017 04:25 PM, G Crowe \
                wrote:&lt;br&gt;
                    &lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;  Hi,&lt;br&gt;
                              I am trying to upgrade my Xen host (Dom0) and
                      are having troubles getting it to work.&lt;br&gt;
                      &lt;br&gt;
                      I think that it has booted into a kernel that
                      supports Xen (running 'xl info' does list some Xen
                      capabilities), but I have three problems (that I
                      have found so far).&lt;br&gt;
                      &lt;br&gt;
                      Firstly, the "libvirtd" daemon doesn't start on
                      bootup (and as a result all 'virsh' commands
                      fail). It is set to auto-start (systemctl enable
                      libvirtd), and can be manually started (systemctl
                      start libvirtd), but it will not auto-start on
                      reboot.&lt;br&gt;
                      &lt;br&gt;
                      Secondly, Once I have manually started libvirtd,
                      when I try to define a domain it gives me an error
                      "could not find capabilities for arch=x86_64
                      domaintype=xen" and I haven't yet been able to
                      define any domains. This domain type works fine on
                      Fedora 21.&lt;br&gt;
                      &lt;br&gt;
                      Thirdly, I am unable to convert to/from xml config
                      format, it gives me the error "error: invalid
                      argument: unsupported config type xen-xl" however
                      the format "xen-xl" works fine on the Fedora 21
                      machine.&lt;br&gt;
                    &lt;/blockquote&gt;
                    &lt;br&gt;
                    It sounds like the libvirt libxl driver is not
                    loaded. Is the libvirt-daemon-driver-libxl package
                    installed? If it's installed, enabling debug logging
                    in libvirtd can provide hints why it is not loading&lt;br&gt;
                    &lt;br&gt;
                    &lt;a href="http://libvirt.org/logging.html" rel="noreferrer" \
target="_blank"&gt;http://libvirt.org/logging.htm&lt;wbr&gt;l&lt;/a&gt;&lt;br&gt;  &lt;br&gt;
                    Regards,&lt;br&gt;
                    Jim&lt;br&gt;
                    &lt;br&gt;
                    &lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;  &lt;br&gt;
                      I had these same issues when I tried to upgrade to
                      Fedora 25 and assumed that something had been
                      broken and so abandoned further attempts to
                      upgrade, however since Fedora 26 is the same I am
                      now assuming that I have stuffed something up
                      myself (or missed something).&lt;br&gt;
                      &lt;br&gt;
                      Fedora 21 uses kernel 3.19.3 and xen 4.4.1&lt;br&gt;
                      Fedora 26 uses kernel 4.11.8 and xen 4.8.1&lt;br&gt;
                      &lt;br&gt;
                      I have tried following the info on &lt;a \
href="https://wiki.xen.org/wiki/Fedora_Host_Installation" rel="noreferrer" \
target="_blank"&gt;https://wiki.xen.org/wiki/Fedo&lt;wbr&gt;ra_Host_Installation&lt;/a&gt;  but it \
appears to be out of date now (I used this  site when I started using Xen under \
Fedora 19, and  when I upgraded to Fedora 21)&lt;br&gt;
                      &lt;br&gt;
                      Does anyone have any suggestions? outputs from "xl
                      info" and the domain config are below. I have also
                      tried disabling SELinux, but it made no
                      difference.&lt;br&gt;
                      &lt;br&gt;
                      &lt;br&gt;
                      Thanks&lt;br&gt;
                      &lt;br&gt;
                      GC&lt;br&gt;
                      &lt;br&gt;
                      ------------------------------&lt;wbr&gt;-----------------&lt;br&gt;
                      On the fedora 26 box.....&lt;br&gt;
                      # xl info&lt;br&gt;
                      host                             : family.mydomain.mytld&lt;br&gt;
                      release                        : 4.11.8-300.fc26.x86_64&lt;br&gt;
                      version                        : #1 SMP Thu Jun 29
                      20:09:48 UTC 2017&lt;br&gt;
                      machine                        : x86_64&lt;br&gt;
                      nr_cpus                        : 4&lt;br&gt;
                      max_cpu_id                    : 3&lt;br&gt;
                      nr_nodes                       : 1&lt;br&gt;
                      cores_per_socket           : 4&lt;br&gt;
                      threads_per_core           : 1&lt;br&gt;
                      cpu_mhz                        : 2712&lt;br&gt;
                      hw_caps                        :
                      \
b7ebfbff:77faf3bf:2c100800:000&lt;wbr&gt;00121:0000000f:009c67af:000000&lt;wbr&gt;00:00000100&lt;br&gt; \
virt_caps                     : hvm hvm_directio&lt;br&gt;  total_memory                 : \
8072&lt;br&gt;  free_memory                  : 128&lt;br&gt;
                      sharing_freed_memory     : 0&lt;br&gt;
                      sharing_used_memory      : 0&lt;br&gt;
                      outstanding_claims        : 0&lt;br&gt;
                      free_cpus                     : 0&lt;br&gt;
                      xen_major                     : 4&lt;br&gt;
                      xen_minor                     : 8&lt;br&gt;
                      xen_extra                     : .1&lt;br&gt;
                      xen_version                  : 4.8.1&lt;br&gt;
                      xen_caps                       : xen-3.0-x86_64
                      xen-3.0-x86_32p hvm-3.0-x86_32 hvm-3.0-x86_32p
                      hvm-3.0-x86_64&lt;br&gt;
                      xen_scheduler               : credit&lt;br&gt;
                      xen_pagesize                 : 4096&lt;br&gt;
                      platform_params            :
                      virt_start=0xffff800000000000&lt;br&gt;
                      xen_changeset               :&lt;br&gt;
                      xen_commandline            : placeholder&lt;br&gt;
                      cc_compiler                  : gcc (GCC) 7.0.1 20170421
                      (Red Hat 7.0.1-0.15)&lt;br&gt;
                      cc_compile_by               : mockbuild&lt;br&gt;
                      cc_compile_domain         : [unknown]&lt;br&gt;
                      cc_compile_date            : Wed May   3 21:23:49 UTC
                      2017&lt;br&gt;
                      build_id                       :
                      1c6e5a40165e05837303942b54757a&lt;wbr&gt;e1f2d5033d&lt;br&gt;
                      xend_config_format        : 4&lt;br&gt;
                      &lt;br&gt;
                      ------------------------------&lt;wbr&gt;---------------------&lt;br&gt;
                      # cat vmtest.xml&lt;br&gt;
                      &lt;domain type='xen' id='21'&gt;&lt;br&gt;
                           &lt;name&gt;testVM&lt;/name&gt;&lt;br&gt;
                           &lt;memory \
unit='KiB'&gt;2097152&lt;/memory&gt;&lt;br&gt;  &lt;currentMemory
                      unit='KiB'&gt;2097152&lt;/currentMem&lt;wbr&gt;ory&gt;&lt;br&gt;
                           &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;&lt;br&gt;
                           &lt;os&gt;&lt;br&gt;
                              &lt;type arch='x86_64'
                      machine='xenfv'&gt;hvm&lt;/type&gt;&lt;br&gt;
                              &lt;loader \
type='rom'&gt;/usr/lib/xen/boot/h&lt;wbr&gt;vmloader&lt;/loader&gt;&lt;br&gt;  &lt;boot \
dev='network'/&gt;&lt;br&gt;  &lt;/os&gt;&lt;br&gt;
                           &lt;features&gt;&lt;br&gt;
                              &lt;acpi/&gt;&lt;br&gt;
                              &lt;apic/&gt;&lt;br&gt;
                              &lt;pae/&gt;&lt;br&gt;
                           &lt;/features&gt;&lt;br&gt;
                           &lt;clock offset='variable' adjustment='0'
                      basis='utc'/&gt;&lt;br&gt;
                           &lt;on_poweroff&gt;destroy&lt;/on_powe&lt;wbr&gt;roff&gt;&lt;br&gt;
                           &lt;on_reboot&gt;restart&lt;/on_reboot&lt;wbr&gt;&gt;&lt;br&gt;
                           &lt;on_crash&gt;restart&lt;/on_crash&gt;&lt;br&gt;
                           &lt;devices&gt;&lt;br&gt;
                              &lt;interface type='bridge'&gt;&lt;br&gt;
                                 &lt;mac address='02:02:00:03:00:00'/&gt;&lt;br&gt;
                                 &lt;source bridge='enp1s0'/&gt;&lt;br&gt;
                                 &lt;script path='vif-bridge'/&gt;&lt;br&gt;
                              &lt;/interface&gt;&lt;br&gt;
                              &lt;serial type='pty'&gt;&lt;br&gt;
                                 &lt;target port='0'/&gt;&lt;br&gt;
                              &lt;/serial&gt;&lt;br&gt;
                              &lt;console type='pty'&gt;&lt;br&gt;
                                 &lt;target type='serial' \
port='0'/&gt;&lt;br&gt;  &lt;/console&gt;&lt;br&gt;
                              &lt;input type='mouse' \
                bus='ps2'/&gt;&lt;br&gt;
                              &lt;input type='keyboard' \
                bus='ps2'/&gt;&lt;br&gt;
                              &lt;graphics type='vnc' port='5901'
                      autoport='no' listen='192.168.131.54'&gt;&lt;br&gt;
                                 &lt;listen type='address'
                      address='192.168.131.54'/&gt;&lt;br&gt;
                              &lt;/graphics&gt;&lt;br&gt;
                           &lt;/devices&gt;&lt;br&gt;
                      &lt;/domain&gt;&lt;br&gt;
                      &lt;br&gt;
                      ------------------------------&lt;wbr&gt;--------&lt;br&gt;
                      &lt;br&gt;
                      ______________________________&lt;wbr&gt;_________________&lt;br&gt;
                      libvirt-users mailing list&lt;br&gt;
                      &lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;  &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;  \
&lt;br&gt;  &lt;/blockquote&gt;
                    &lt;br&gt;
                  &lt;/blockquote&gt;
                  &lt;br&gt;
                  ______________________________&lt;wbr&gt;_________________&lt;br&gt;
                  libvirt-users mailing list&lt;br&gt;
                  &lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;  &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;/div&gt;  \
&lt;/blockquote&gt;  &lt;/div&gt;
            &lt;br&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;br&gt;
      &lt;fieldset class="m_-8157491304586002949mimeAttachmentHeader"&gt;&lt;/fieldset&gt;
      &lt;br&gt;
      &lt;pre&gt;______________________________&lt;wbr&gt;_________________
libvirt-users mailing list
&lt;a class="m_-8157491304586002949moz-txt-link-abbreviated" \
href="mailto:libvirt-users@redhat.com" target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt; \
&lt;a class="m_-8157491304586002949moz-txt-link-freetext" \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" \
target="_blank"&gt;https://www.redhat.com/&lt;wbr&gt;mailman/listinfo/libvirt-users&lt;/a&gt;&lt;/pre&gt;  \
&lt;/blockquote&gt;  &lt;br&gt;
    &lt;/div&gt;&lt;/div&gt;&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;pre \
class="m_-8157491304586002949moz-signature" cols="72"&gt;--  Alvin Starr                 \
||   land:  (905)513-7688 Netvel Inc.                   ||   Cell:  (416)806-0133
&lt;a class="m_-8157491304586002949moz-txt-link-abbreviated" \
href="mailto:alvin@netvel.net" target="_blank"&gt;alvin@netvel.net&lt;/a&gt;              ||

&lt;/pre&gt;
  &lt;/font&gt;&lt;/span&gt;&lt;/div&gt;

&lt;br&gt;______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;
&lt;a href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/&lt;wbr&gt;mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br \
clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- &lt;br&gt;&lt;div class="gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/div&gt;



</body></email><email><emailId>20170726191802</emailId><senderName>Alvin Starr</senderName><senderEmail>alvin@netvel.net</senderEmail><timestampReceived>2017-07-26 19:18:02-0400</timestampReceived><subject>Re: [libvirt-users] Xen died - Fedora upgrade from 21 to 26</subject><body>

Jim:

Try systemctl disable xendomains.service

It is conflicting with libvirtd.service.
I found it by using
"systemd-analyze  dot libvirtd.service | dot -Tgif &gt; /tmp/dot1.gif"


On 07/26/2017 10:19 AM, Jim Fehlig wrote:
&gt; On 07/26/2017 04:46 AM, G Crowe wrote:
&gt;&gt; Jim,
&gt;&gt;      Thanks for that, I had manually installed 
&gt;&gt; libvirt-daemon-driver-xen, but also needed to install 
&gt;&gt; libvirt-daemon-driver-libxl. I can now create VMs and convert config 
&gt;&gt; formats.
&gt;&gt;
&gt;&gt; However the daemon still fails to start on bootup. It starts fine 
&gt;&gt; when I manually start it with "systemctl start libvirtd" but setting 
&gt;&gt; it to autostart with "systemctl enable libvirtd" seems to have no 
&gt;&gt; effect. When I look at the status, it tells me that the service is 
&gt;&gt; "enabled" which means that it starts on bootup (well, that's what it 
&gt;&gt; means for any other service).
&gt;
&gt; I think you'll need to debug the startup problem via systemd, e.g. 
&gt; using systemd-analyze. Perhaps it is not starting do to conflicts with 
&gt; other services, e.g. xendomains. Do you also have xendomains service 
&gt; enabled? If so, disable it since it should not be used with libvirt.
&gt;
&gt; Regards,
&gt; Jim
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users

-- 
Alvin Starr                   ||   land:  (905)513-7688
Netvel Inc.                   ||   Cell:  (416)806-0133
alvin@netvel.net              ||

</body></email><email><emailId>20170726222738</emailId><senderName>G Crowe</senderName><senderEmail>gclvirtlist@crowie.net</senderEmail><timestampReceived>2017-07-26 22:27:38-0400</timestampReceived><subject>Re: [libvirt-users] Xen died - Fedora upgrade from 21 to 26</subject><body>

Alvin,
     Thanks for that. I disabled the xendomains service (I had to do it 
twice, as it seemed to re-enable itself after the first reboot) and it 
now starts libvirtd automatically on startup.

However, all is not well!
"xl list" and "virsh list" will just hang
"systemctl stop libvirtd" just hangs and after this "ps aux" lists the 
process as defunct
     root       673  0.0  0.0      0     0 ?        Zsl  08:04   0:00 
[libvirtd] &lt;defunct&gt;
"kill -KILL 673" has no effect
"shutdown -r now" also hangs (I have to physically power off the 
machine) irrespectively of whether I have tried to stop the service 
before shutdown or not.

None of this happened yesterday when I manually started libvirtd after 
bootup (when xendomains was still running).

The logs show nothing in error or warning category, just a heap of info 
(I have the logs set to level 2). Is there anything in particular that I 
should be looking for in the logs?



Regarding the use of a VM to access the host in a remote location... I 
had considered this and there was little choice. The machine is on the 
end of a VDSL line and was installed to consolidate a few servers in 
that location in order to save power. I figured that automatically 
starting a VM that ran the networking was not much more risk than a 
physical server that had to start up its networking, and that has (so 
far) proven to be true with all of the remote restarts &amp; power outages 
to date. The only other option is an expensive second link to the host, 
and I've decided to live with the possibility of having to talk someone 
through a restart over the phone rather than go down that route.

Interestingly, with the NBN in Australia (the country-wide rollout of 
fibre or broadband to every premises) they have effectively converted 
all our phone lines to VoIP. This has resulted in the old physical 
landline now requiring one of the VMs to be running as well, so if I 
ever need to talk someone through a restart it will need to be on a 
mobile phone.


Thank you

GC


On 27/07/2017 5:47 AM, Alvin Starr wrote:
&gt; I addressed the fix to Jim but I should have addressed it to you.
&gt;
&gt;
&gt; Try systemctl disable xendomains.service
&gt;
&gt; It is conflicting with libvirtd.service.
&gt; I found it by using
&gt; "systemd-analyze  dot libvirtd.service | dot -Tgif &gt; /tmp/dot1.gif"
&gt;
&gt;
&gt; It looks like libvirt-daemon-driver-xen or 
&gt; libvirt-daemon-driver-libxl  should  disable the xendomains.service
&gt;
&gt;
&gt; On 07/26/2017 06:46 AM, G Crowe wrote:
&gt;&gt; Jim,
&gt;&gt;     Thanks for that, I had manually installed 
&gt;&gt; libvirt-daemon-driver-xen, but also needed to install 
&gt;&gt; libvirt-daemon-driver-libxl. I can now create VMs and convert config 
&gt;&gt; formats.
&gt;&gt;
&gt;&gt; However the daemon still fails to start on bootup. It starts fine 
&gt;&gt; when I manually start it with "systemctl start libvirtd" but setting 
&gt;&gt; it to autostart with "systemctl enable libvirtd" seems to have no 
&gt;&gt; effect. When I look at the status, it tells me that the service is 
&gt;&gt; "enabled" which means that it starts on bootup (well, that's what it 
&gt;&gt; means for any other service).
&gt;&gt;
&gt;&gt; This is rather critical on this PC, as it has unattended restarts and 
&gt;&gt; the VPN/routing is done in one of the VMs (i.e. I can't get to it 
&gt;&gt; unless it auto-starts at least one VM).
&gt;&gt;
&gt;&gt; Unfortunatley there is nothing appearing in the libvirtd log over a 
&gt;&gt; reboot to help diagnose.
&gt;&gt;
&gt;&gt; Any suggestions?
&gt;&gt;
&gt;&gt;
&gt;&gt; Thank you
&gt;&gt;
&gt;&gt; GC
&gt;&gt;
&gt;&gt;
&gt;&gt; [root@testhost ~]# systemctl status libvirtd
&gt;&gt; ● libvirtd.service - Virtualization daemon
&gt;&gt;    Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled; 
&gt;&gt; vendor preset: enabled)
&gt;&gt;    Active: inactive (dead)
&gt;&gt;      Docs: man:libvirtd(8)
&gt;&gt;            http://libvirt.org
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On 25/07/2017 1:20 AM, Jim Fehlig wrote:
&gt;&gt;&gt; On 07/23/2017 04:25 PM, G Crowe wrote:
&gt;&gt;&gt;&gt; Hi,
&gt;&gt;&gt;&gt;      I am trying to upgrade my Xen host (Dom0) and are having 
&gt;&gt;&gt;&gt; troubles getting it to work.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I think that it has booted into a kernel that supports Xen (running 
&gt;&gt;&gt;&gt; 'xl info' does list some Xen capabilities), but I have three 
&gt;&gt;&gt;&gt; problems (that I have found so far).
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Firstly, the "libvirtd" daemon doesn't start on bootup (and as a 
&gt;&gt;&gt;&gt; result all 'virsh' commands fail). It is set to auto-start 
&gt;&gt;&gt;&gt; (systemctl enable libvirtd), and can be manually started (systemctl 
&gt;&gt;&gt;&gt; start libvirtd), but it will not auto-start on reboot.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Secondly, Once I have manually started libvirtd, when I try to 
&gt;&gt;&gt;&gt; define a domain it gives me an error "could not find capabilities 
&gt;&gt;&gt;&gt; for arch=x86_64 domaintype=xen" and I haven't yet been able to 
&gt;&gt;&gt;&gt; define any domains. This domain type works fine on Fedora 21.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Thirdly, I am unable to convert to/from xml config format, it gives 
&gt;&gt;&gt;&gt; me the error "error: invalid argument: unsupported config type 
&gt;&gt;&gt;&gt; xen-xl" however the format "xen-xl" works fine on the Fedora 21 
&gt;&gt;&gt;&gt; machine.
&gt;&gt;&gt;
&gt;&gt;&gt; It sounds like the libvirt libxl driver is not loaded. Is the 
&gt;&gt;&gt; libvirt-daemon-driver-libxl package installed? If it's installed, 
&gt;&gt;&gt; enabling debug logging in libvirtd can provide hints why it is not 
&gt;&gt;&gt; loading
&gt;&gt;&gt;
&gt;&gt;&gt; http://libvirt.org/logging.html
&gt;&gt;&gt;
&gt;&gt;&gt; Regards,
&gt;&gt;&gt; Jim
&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I had these same issues when I tried to upgrade to Fedora 25 and 
&gt;&gt;&gt;&gt; assumed that something had been broken and so abandoned further 
&gt;&gt;&gt;&gt; attempts to upgrade, however since Fedora 26 is the same I am now 
&gt;&gt;&gt;&gt; assuming that I have stuffed something up myself (or missed 
&gt;&gt;&gt;&gt; something).
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Fedora 21 uses kernel 3.19.3 and xen 4.4.1
&gt;&gt;&gt;&gt; Fedora 26 uses kernel 4.11.8 and xen 4.8.1
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I have tried following the info on 
&gt;&gt;&gt;&gt; https://wiki.xen.org/wiki/Fedora_Host_Installation but it appears 
&gt;&gt;&gt;&gt; to be out of date now (I used this site when I started using Xen 
&gt;&gt;&gt;&gt; under Fedora 19, and when I upgraded to Fedora 21)
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Does anyone have any suggestions? outputs from "xl info" and the 
&gt;&gt;&gt;&gt; domain config are below. I have also tried disabling SELinux, but 
&gt;&gt;&gt;&gt; it made no difference.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Thanks
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; GC
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; -----------------------------------------------
&gt;&gt;&gt;&gt; On the fedora 26 box.....
&gt;&gt;&gt;&gt; # xl info
&gt;&gt;&gt;&gt; host                   : family.mydomain.mytld
&gt;&gt;&gt;&gt; release                : 4.11.8-300.fc26.x86_64
&gt;&gt;&gt;&gt; version                : #1 SMP Thu Jun 29 20:09:48 UTC 2017
&gt;&gt;&gt;&gt; machine                : x86_64
&gt;&gt;&gt;&gt; nr_cpus                : 4
&gt;&gt;&gt;&gt; max_cpu_id             : 3
&gt;&gt;&gt;&gt; nr_nodes               : 1
&gt;&gt;&gt;&gt; cores_per_socket       : 4
&gt;&gt;&gt;&gt; threads_per_core       : 1
&gt;&gt;&gt;&gt; cpu_mhz                : 2712
&gt;&gt;&gt;&gt; hw_caps                : 
&gt;&gt;&gt;&gt; b7ebfbff:77faf3bf:2c100800:00000121:0000000f:009c67af:00000000:00000100 
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; virt_caps              : hvm hvm_directio
&gt;&gt;&gt;&gt; total_memory           : 8072
&gt;&gt;&gt;&gt; free_memory            : 128
&gt;&gt;&gt;&gt; sharing_freed_memory   : 0
&gt;&gt;&gt;&gt; sharing_used_memory    : 0
&gt;&gt;&gt;&gt; outstanding_claims     : 0
&gt;&gt;&gt;&gt; free_cpus              : 0
&gt;&gt;&gt;&gt; xen_major              : 4
&gt;&gt;&gt;&gt; xen_minor              : 8
&gt;&gt;&gt;&gt; xen_extra              : .1
&gt;&gt;&gt;&gt; xen_version            : 4.8.1
&gt;&gt;&gt;&gt; xen_caps               : xen-3.0-x86_64 xen-3.0-x86_32p 
&gt;&gt;&gt;&gt; hvm-3.0-x86_32 hvm-3.0-x86_32p hvm-3.0-x86_64
&gt;&gt;&gt;&gt; xen_scheduler          : credit
&gt;&gt;&gt;&gt; xen_pagesize           : 4096
&gt;&gt;&gt;&gt; platform_params        : virt_start=0xffff800000000000
&gt;&gt;&gt;&gt; xen_changeset          :
&gt;&gt;&gt;&gt; xen_commandline        : placeholder
&gt;&gt;&gt;&gt; cc_compiler            : gcc (GCC) 7.0.1 20170421 (Red Hat 7.0.1-0.15)
&gt;&gt;&gt;&gt; cc_compile_by          : mockbuild
&gt;&gt;&gt;&gt; cc_compile_domain      : [unknown]
&gt;&gt;&gt;&gt; cc_compile_date        : Wed May  3 21:23:49 UTC 2017
&gt;&gt;&gt;&gt; build_id               : 1c6e5a40165e05837303942b54757ae1f2d5033d
&gt;&gt;&gt;&gt; xend_config_format     : 4
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; ---------------------------------------------------
&gt;&gt;&gt;&gt; # cat vmtest.xml
&gt;&gt;&gt;&gt; &lt;domain type='xen' id='21'&gt;
&gt;&gt;&gt;&gt;    &lt;name&gt;testVM&lt;/name&gt;
&gt;&gt;&gt;&gt;    &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;
&gt;&gt;&gt;&gt;    &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMemory&gt;
&gt;&gt;&gt;&gt;    &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
&gt;&gt;&gt;&gt;    &lt;os&gt;
&gt;&gt;&gt;&gt;      &lt;type arch='x86_64' machine='xenfv'&gt;hvm&lt;/type&gt;
&gt;&gt;&gt;&gt;      &lt;loader type='rom'&gt;/usr/lib/xen/boot/hvmloader&lt;/loader&gt;
&gt;&gt;&gt;&gt;      &lt;boot dev='network'/&gt;
&gt;&gt;&gt;&gt;    &lt;/os&gt;
&gt;&gt;&gt;&gt;    &lt;features&gt;
&gt;&gt;&gt;&gt;      &lt;acpi/&gt;
&gt;&gt;&gt;&gt;      &lt;apic/&gt;
&gt;&gt;&gt;&gt;      &lt;pae/&gt;
&gt;&gt;&gt;&gt;    &lt;/features&gt;
&gt;&gt;&gt;&gt;    &lt;clock offset='variable' adjustment='0' basis='utc'/&gt;
&gt;&gt;&gt;&gt;    &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
&gt;&gt;&gt;&gt;    &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
&gt;&gt;&gt;&gt;    &lt;on_crash&gt;restart&lt;/on_crash&gt;
&gt;&gt;&gt;&gt;    &lt;devices&gt;
&gt;&gt;&gt;&gt;      &lt;interface type='bridge'&gt;
&gt;&gt;&gt;&gt;        &lt;mac address='02:02:00:03:00:00'/&gt;
&gt;&gt;&gt;&gt;        &lt;source bridge='enp1s0'/&gt;
&gt;&gt;&gt;&gt;        &lt;script path='vif-bridge'/&gt;
&gt;&gt;&gt;&gt;      &lt;/interface&gt;
&gt;&gt;&gt;&gt;      &lt;serial type='pty'&gt;
&gt;&gt;&gt;&gt;        &lt;target port='0'/&gt;
&gt;&gt;&gt;&gt;      &lt;/serial&gt;
&gt;&gt;&gt;&gt;      &lt;console type='pty'&gt;
&gt;&gt;&gt;&gt;        &lt;target type='serial' port='0'/&gt;
&gt;&gt;&gt;&gt;      &lt;/console&gt;
&gt;&gt;&gt;&gt;      &lt;input type='mouse' bus='ps2'/&gt;
&gt;&gt;&gt;&gt;      &lt;input type='keyboard' bus='ps2'/&gt;
&gt;&gt;&gt;&gt;      &lt;graphics type='vnc' port='5901' autoport='no' 
&gt;&gt;&gt;&gt; listen='192.168.131.54'&gt;
&gt;&gt;&gt;&gt;        &lt;listen type='address' address='192.168.131.54'/&gt;
&gt;&gt;&gt;&gt;      &lt;/graphics&gt;
&gt;&gt;&gt;&gt;    &lt;/devices&gt;
&gt;&gt;&gt;&gt; &lt;/domain&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --------------------------------------
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt;&gt; libvirt-users mailing list
&gt;&gt;&gt;&gt; libvirt-users@redhat.com
&gt;&gt;&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; libvirt-users mailing list
&gt;&gt; libvirt-users@redhat.com
&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;

</body></email><email><emailId>20170720081315</emailId><senderName>Dominik Psenner</senderName><senderEmail>dpsenner@gmail.com</senderEmail><timestampReceived>2017-07-20 08:13:15-0400</timestampReceived><subject>[libvirt-users] libvirt administration tools</subject><body>

Hi!

To give something back to the community I just now made our daily live
backup scripts open source. It is hosted on github and licensed under the
Apache-2.0.

https://github.com/dpsenner/libvirt-administration-tools

Feel free to use it in your production environment or fork and adapt it to
fit your needs or even improve it and open pull requests!

Cheers
-- 
Dominik Psenner

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;Hi!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;To give something back to the \
community  I just now made our daily live backup scripts open source. It is hosted on \
github and licensed under the Apache-2.0.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;a \
href="https://github.com/dpsenner/libvirt-administration-tools"&gt;https://github.com/dpsenner/libvirt-administration-tools&lt;/a&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Feel \
free to use it in your production environment or fork and adapt it to fit your needs \
or even improve it and open pull requests!&lt;br \
clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers&lt;/div&gt;-- &lt;br&gt;&lt;div class="gmail_signature"&gt;&lt;div \
dir="ltr"&gt;Dominik Psenner&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170720083853</emailId><senderName></senderName><senderEmail>c.monty</senderEmail><timestampReceived>2017-07-20 08:38:53-0400</timestampReceived><subject>Re: [libvirt-users] SSH from host to domain using hostname</subject><body>

20. Juli 2017 10:03, "Michal Privoznik" &lt;mprivozn@redhat.com&gt; schrieb:

&gt; On 07/19/2017 05:23 PM, c.monty@web.de wrote:
&gt; 
&gt; &gt; &lt;snip/&gt;
&gt; &gt; 
&gt; &gt; Update update:
&gt; &gt; Output of 'virsh domifaddr '
&gt; &gt; ld4004:~ # virsh domifaddr --source agent $domain
&gt; &gt; error: command 'domifaddr' requires &lt;domain&gt; option
&gt; &gt; ld4004:~ # virsh domifaddr --source agent vm02-fai
&gt; &gt; error: Failed to query for interfaces addresses
&gt; &gt; error: argument unsupported: QEMU guest agent is not configured
&gt; &gt; 
&gt; &gt; ld4004:~ # virsh domifaddr --source lease $domain
&gt; &gt; error: command 'domifaddr' requires &lt;domain&gt; option
&gt; &gt; ld4004:~ # virsh domifaddr --source lease vm02-fai
&gt; &gt; Name MAC address Protocol Address
&gt; &gt; -------------------------------------------------------------------------------
&gt; &gt; 
&gt; &gt; Question:
&gt; &gt; Why are variables $domain (or $network) not working?
&gt; 
&gt; So usually when discussing on lists, we don't know how are user domains
&gt; named. Or networks. Or something else. So when asking for XML we use
&gt; $domain as placeholder and users are supposed to replace that with
&gt; actual name of the domain. The same applies for network. So these are
&gt; not bash variables - how can bash possibly know what you're up to?
&gt; 
&gt; Michal

Hi!

This is now very clear and understood... this topic regarding variables ($domain or \
$network) can be closed.

Regards
Thomas


</body></email><email><emailId>20170720212847</emailId><senderName>임영빈</senderName><senderEmail>ovinee@gmail.com</senderEmail><timestampReceived>2017-07-20 21:28:47-0400</timestampReceived><subject>[libvirt-users] cannot set maxMemory</subject><body>

Hi all,

I'm testing the memory hotplugging on devstack (ocata version).

According to the article in
https://medium.com/@juergen_thomann/memory-hotplug-with-qemu-kvm-and-libvirt-558f1c635972
,
I'm trying to create a virtual machine by setting &lt;maxMemory&gt;.
However, I've got an error message in libvirt log as below.

2017-07-20 20:33:21.175+0000: 529: error :
virDomainDefCheckUnsupportedMemoryHotplug:1192 : unsupported configuration:
memory hotplug tunables &lt;maxMemory&gt; are not supported by this hypervisor
driver
virt-aa-helper: error: could not parse XML
virt-aa-helper: error: could not get VM definition

I'm using qemu hypervisor (2.8), and libvirt (2.5.0).
As I know, these qemu, libvirt versions support hotplugging memory.
Below is the xml file I used to create a virtual machine by using 'virsh
create test.xml' command.

&lt;domain type='qemu'&gt;
  &lt;name&gt;QEmu-fedora-i686&lt;/name&gt;
  &lt;uuid&gt;c7a5fdbd-cdaf-9455-926a-d65c16db1809&lt;/uuid&gt;
  &lt;maxMemory slots='4' unit='KiB'&gt;2097152&lt;/maxMemory&gt;
  &lt;memory&gt;219200&lt;/memory&gt;
  &lt;currentMemory&gt;219200&lt;/currentMemory&gt;
  &lt;vcpu&gt;2&lt;/vcpu&gt;
  &lt;cpu&gt;
    &lt;numa&gt;
      &lt;cell id="0" cpus="0" memory="2097152" unit="KiB"/&gt;
    &lt;/numa&gt;
  &lt;/cpu&gt;
  &lt;driver name="qemu" type="qcow2" cache="none"/&gt;
  &lt;os&gt;
    &lt;type arch='i686' machine='pc'&gt;hvm&lt;/type&gt;
    &lt;boot dev='cdrom'/&gt;
  &lt;/os&gt;
  &lt;devices&gt;
    &lt;emulator&gt;/usr/bin/qemu-system-ppc&lt;/emulator&gt;
    &lt;disk type='file' device='cdrom'&gt;
      &lt;source file='/home/user/boot.iso'/&gt;
      &lt;target dev='hdc'/&gt;
      &lt;readonly/&gt;
    &lt;/disk&gt;
    &lt;disk type='file' device='disk'&gt;
      &lt;source file='/home/user/fedora.img'/&gt;
      &lt;target dev='hda'/&gt;
    &lt;/disk&gt;
    &lt;interface type='network'&gt;
      &lt;source network='default'/&gt;
    &lt;/interface&gt;
  &lt;/devices&gt;
&lt;/domain&gt;

Does anyone know the reason?

Thanks,
Youngbin

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi all,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I'm testing the memory hotplugging on \
devstack (ocata version).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;According to the article \
in&lt;/div&gt;&lt;div&gt;&lt;a href="https://medium.com/@juergen_thomann/memory-hotplug-with-qemu-kvm \
-and-libvirt-558f1c635972"&gt;https://medium.com/@juergen_thomann/memory-hotplug-with-qemu-kvm-and-libvirt-558f1c635972&lt;/a&gt;,&lt;br&gt;&lt;/div&gt;&lt;div&gt;I'm \
trying to create a virtual machine by setting &lt;maxMemory&gt;.&lt;/div&gt;&lt;div&gt;However, \
I've got an error message in libvirt log as \
below.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;2017-07-20 20:33:21.175+0000: 529: error : \
virDomainDefCheckUnsupportedMemoryHotplug:1192 : unsupported configuration: memory \
hotplug tunables &lt;maxMemory&gt; are not supported by this hypervisor \
driver&lt;/div&gt;&lt;div&gt;virt-aa-helper: error: could not parse XML&lt;/div&gt;&lt;div&gt;virt-aa-helper: \
error: could not get VM definition&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I'm using qemu \
hypervisor (2.8), and libvirt (2.5.0).&lt;/div&gt;&lt;div&gt;As I know, these qemu, libvirt \
versions support hotplugging memory.&lt;/div&gt;&lt;div&gt;Below is the xml file I used to create \
a virtual machine by using 'virsh create test.xml' \
command.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;domain type='qemu'&gt;&lt;/div&gt;&lt;div&gt;  \
&lt;name&gt;QEmu-fedora-i686&lt;/name&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;uuid&gt;c7a5fdbd-cdaf-9455-926a-d65c16db1809&lt;/uuid&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;maxMemory slots='4' \
unit='KiB'&gt;2097152&lt;/maxMemory&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;memory&gt;219200&lt;/memory&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;currentMemory&gt;219200&lt;/currentMemory&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;vcpu&gt;2&lt;/vcpu&gt;&lt;/div&gt;&lt;div&gt;   &lt;cpu&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;numa&gt;&lt;/div&gt;&lt;div&gt;         &lt;cell id="0" cpus="0" \
memory="2097152" unit="KiB"/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/numa&gt;&lt;/div&gt;&lt;div&gt;   &lt;/cpu&gt;&lt;/div&gt;&lt;div&gt;   &lt;driver name="qemu" \
type="qcow2" cache="none"/&gt;&lt;/div&gt;&lt;div&gt;   &lt;os&gt;&lt;/div&gt;&lt;div&gt; \
&lt;type arch='i686' machine='pc'&gt;hvm&lt;/type&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;boot dev='cdrom'/&gt;&lt;/div&gt;&lt;div&gt;   &lt;/os&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;devices&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;emulator&gt;/usr/bin/qemu-system-ppc&lt;/emulator&gt;&lt;/div&gt;&lt;div&gt;      &lt;disk \
type='file' device='cdrom'&gt;&lt;/div&gt;&lt;div&gt;         &lt;source \
file='/home/user/boot.iso'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;target \
dev='hdc'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;readonly/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/disk&gt;&lt;/div&gt;&lt;div&gt;      &lt;disk type='file' \
device='disk'&gt;&lt;/div&gt;&lt;div&gt;         &lt;source \
file='/home/user/fedora.img'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;target \
dev='hda'/&gt;&lt;/div&gt;&lt;div&gt;      &lt;/disk&gt;&lt;/div&gt;&lt;div&gt;      &lt;interface \
type='network'&gt;&lt;/div&gt;&lt;div&gt;         &lt;source \
network='default'/&gt;&lt;/div&gt;&lt;div&gt;      &lt;/interface&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;/devices&gt;&lt;/div&gt;&lt;div&gt;&lt;/domain&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Does anyone \
know the reason?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;Youngbin&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;




</body></email><email><emailId>20170723194523</emailId><senderName>Pavel Hrdina</senderName><senderEmail>phrdina@redhat.com</senderEmail><timestampReceived>2017-07-23 19:45:23-0400</timestampReceived><subject>Re: [libvirt-users] Increasing video memory available to Windows</subject><body>


On Sat, Jul 22, 2017 at 03:03:06PM -0400, Alex wrote:
&gt; Hi,
&gt; I have a fedora25 system with a Windows10 host and would like to use
&gt; it for photoshop. However, it complains the video memory is too low.
&gt; I'm using the QXL driver and it appears to be limited to 256MB? I've
&gt; installed the Red Hat QXL driver in Windows.

What driver did you installed?  There are two drivers, qxl and qxldod,
for windows 10 you need the qxldod and I would give it a try to use the
latest drivers [1], not the stable ones.

[1] &lt;https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/latest-virtio/&gt;

&gt; 
&gt; I have 4GB of memory allocated overall, and could allocate more if necessary.
&gt; 
&gt; How do I increase the available video memory? Photoshop reports that
&gt; it's detected less than 512MB and isn't operating properly.
&gt; 
&gt; When I view "Adapter Properties" is reports there is 2047 MB of
&gt; available graphics memory and
&gt; 2047 MB Shared System Memory.
&gt; 
&gt; Attempts to modify with "virsh edit" the vram and other video-related
&gt; variables for the host have failed.
&gt; 
&gt; Included below is my qemu XML configuration. Any idea greatly appreciated.
&gt; 
&gt; &lt;domain type='kvm'&gt;
&gt;   &lt;name&gt;alex-win10&lt;/name&gt;
&gt;   &lt;uuid&gt;337f9410-3286-4ef5-a3e8-8271e38ea1e5&lt;/uuid&gt;
&gt;   &lt;memory unit='KiB'&gt;4194304&lt;/memory&gt;
&gt;   &lt;currentMemory unit='KiB'&gt;4194304&lt;/currentMemory&gt;
&gt;   &lt;vcpu placement='static'&gt;2&lt;/vcpu&gt;
&gt;   &lt;os&gt;
&gt;     &lt;type arch='x86_64' machine='pc-i440fx-2.4'&gt;hvm&lt;/type&gt;
&gt;   &lt;/os&gt;
&gt;   &lt;features&gt;
&gt;     &lt;acpi/&gt;
&gt;     &lt;apic/&gt;
&gt;     &lt;hyperv&gt;
&gt;       &lt;relaxed state='on'/&gt;
&gt;       &lt;vapic state='on'/&gt;
&gt;       &lt;spinlocks state='on' retries='8191'/&gt;
&gt;     &lt;/hyperv&gt;
&gt;     &lt;vmport state='off'/&gt;
&gt;   &lt;/features&gt;
&gt;   &lt;cpu mode='host-model'&gt;
&gt;     &lt;model fallback='allow'/&gt;
&gt;   &lt;/cpu&gt;

Small tip, if you don't care about migration and this is just a guest
that will be used only on one host, I would go with:

&lt;cpu mode='host-passthrough' check='none'&gt;
  &lt;topology sockets='1' cores='2' threads='1'/&gt;
&lt;/cpu&gt;

The "host-passthrough" is a mode where it tries to present the CPU to
guest as close as possible to the host CPU.  The topology configuration
is required for windows, because of licensing, it supports only 2
sockets, so for your configuration it works but if you would like to add
more vcpus to the guest, it could cause problems.  Without this
configuration QEMU by default sets the number of sockets and each socket
has only 1 core and 1 thread.

&gt;   &lt;clock offset='localtime'&gt;
&gt;     &lt;timer name='rtc' tickpolicy='catchup'/&gt;
&gt;     &lt;timer name='pit' tickpolicy='delay'/&gt;
&gt;     &lt;timer name='hpet' present='no'/&gt;
&gt;     &lt;timer name='hypervclock' present='yes'/&gt;
&gt;   &lt;/clock&gt;
&gt;   &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
&gt;   &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
&gt;   &lt;on_crash&gt;restart&lt;/on_crash&gt;
&gt;   &lt;pm&gt;
&gt;     &lt;suspend-to-mem enabled='no'/&gt;
&gt;     &lt;suspend-to-disk enabled='no'/&gt;
&gt;   &lt;/pm&gt;
&gt;   &lt;devices&gt;
&gt;     &lt;emulator&gt;/usr/bin/qemu-kvm&lt;/emulator&gt;
&gt;     &lt;disk type='file' device='disk'&gt;
&gt;       &lt;driver name='qemu' type='qcow2'/&gt;
&gt;       &lt;source file='/var/lib/libvirt/images/alex-win10.qcow2'/&gt;
&gt;       &lt;target dev='vda' bus='virtio'/&gt;
&gt;       &lt;boot order='2'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x07'
&gt; function='0x0'/&gt;
&gt;     &lt;/disk&gt;
&gt;     &lt;disk type='block' device='cdrom'&gt;
&gt;       &lt;driver name='qemu' type='raw'/&gt;
&gt;       &lt;source dev='/dev/sr0'/&gt;
&gt;       &lt;target dev='hdb' bus='ide'/&gt;
&gt;       &lt;readonly/&gt;
&gt;       &lt;boot order='1'/&gt;
&gt;       &lt;address type='drive' controller='0' bus='0' target='0' unit='1'/&gt;
&gt;     &lt;/disk&gt;
&gt;     &lt;disk type='file' device='cdrom'&gt;
&gt;       &lt;driver name='qemu' type='raw'/&gt;
&gt;       &lt;target dev='hdc' bus='ide'/&gt;
&gt;       &lt;readonly/&gt;
&gt;       &lt;address type='drive' controller='0' bus='1' target='0' unit='0'/&gt;
&gt;     &lt;/disk&gt;
&gt;     &lt;controller type='usb' index='0' model='ich9-ehci1'&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x06'
&gt; function='0x7'/&gt;
&gt;     &lt;/controller&gt;
&gt;     &lt;controller type='usb' index='0' model='ich9-uhci1'&gt;
&gt;       &lt;master startport='0'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x06'
&gt; function='0x0' multifunction='on'/&gt;
&gt;     &lt;/controller&gt;
&gt;     &lt;controller type='usb' index='0' model='ich9-uhci2'&gt;
&gt;       &lt;master startport='2'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x06'
&gt; function='0x1'/&gt;
&gt;     &lt;/controller&gt;
&gt;     &lt;controller type='usb' index='0' model='ich9-uhci3'&gt;
&gt;       &lt;master startport='4'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x06'
&gt; function='0x2'/&gt;
&gt;     &lt;/controller&gt;
&gt;     &lt;controller type='pci' index='0' model='pci-root'/&gt;
&gt;     &lt;controller type='ide' index='0'&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x01'
&gt; function='0x1'/&gt;
&gt;     &lt;/controller&gt;
&gt;     &lt;controller type='virtio-serial' index='0'&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05'
&gt; function='0x0'/&gt;
&gt;     &lt;/controller&gt;
&gt;     &lt;controller type='scsi' index='0'&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x09'
&gt; function='0x0'/&gt;
&gt;     &lt;/controller&gt;
&gt;     &lt;interface type='bridge'&gt;
&gt;       &lt;mac address='52:54:00:52:6b:61'/&gt;
&gt;       &lt;source bridge='br0'/&gt;
&gt;       &lt;model type='rtl8139'/&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
&gt; function='0x0'/&gt;
&gt;     &lt;/interface&gt;
&gt;     &lt;serial type='pty'&gt;
&gt;       &lt;target port='0'/&gt;
&gt;     &lt;/serial&gt;
&gt;     &lt;console type='pty'&gt;
&gt;       &lt;target type='serial' port='0'/&gt;
&gt;     &lt;/console&gt;
&gt;     &lt;channel type='spicevmc'&gt;
&gt;       &lt;target type='virtio' name='com.redhat.spice.0'/&gt;
&gt;       &lt;address type='virtio-serial' controller='0' bus='0' port='1'/&gt;
&gt;     &lt;/channel&gt;
&gt;     &lt;input type='tablet' bus='usb'&gt;
&gt;       &lt;address type='usb' bus='0' port='1'/&gt;
&gt;     &lt;/input&gt;
&gt;     &lt;input type='mouse' bus='ps2'/&gt;
&gt;     &lt;input type='keyboard' bus='ps2'/&gt;
&gt;     &lt;graphics type='spice' autoport='yes'&gt;
&gt;       &lt;listen type='address'/&gt;
&gt;       &lt;image compression='off'/&gt;
&gt;     &lt;/graphics&gt;
&gt;     &lt;sound model='ich6'&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x04'
&gt; function='0x0'/&gt;
&gt;     &lt;/sound&gt;
&gt;     &lt;video&gt;
&gt;       &lt;model type='qxl' ram='65536' vram='65536' vgamem='536870912'
&gt; heads='1' primary='yes'/&gt;

So there are some limits for the memory configuration, if you start the
guest and run "virsh dumpxml $guestName" you will see how much memory is
actually configure.  It should be this:

    ram='524288' vram='65536' vgamem='262144'

I have a windows 10 guest installed and I installed a Photoshop 12.0 and
it starts without any warning.

You don't need to set the vgamem that large, 32M should be good enough,
the formula to calculate the vgamem is:

    "screen_width * screen_height * 4"

And I would set the "ram" to 512M, however I'm not sure how this
actually affects the video memory seen by guest.  The documentation is
really poor.

Anyway, the same configuration works for me so I don't know what else
could help you especially while I'm not able to reproduce the issue with
video memory.

Pavel

&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02'
&gt; function='0x0'/&gt;
&gt;     &lt;/video&gt;
&gt;     &lt;redirdev bus='usb' type='spicevmc'&gt;
&gt;       &lt;address type='usb' bus='0' port='2'/&gt;
&gt;     &lt;/redirdev&gt;
&gt;     &lt;redirdev bus='usb' type='spicevmc'&gt;
&gt;       &lt;address type='usb' bus='0' port='3'/&gt;
&gt;     &lt;/redirdev&gt;
&gt;     &lt;memballoon model='virtio'&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08'
&gt; function='0x0'/&gt;
&gt;     &lt;/memballoon&gt;
&gt;   &lt;/devices&gt;
&gt; &lt;/domain&gt;

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170725092003</emailId><senderName>Peter Krempa</senderName><senderEmail>pkrempa@redhat.com</senderEmail><timestampReceived>2017-07-25 09:20:03-0400</timestampReceived><subject>Re: [libvirt-users] memory snapshot save error</subject><body>


On Tue, Jul 25, 2017 at 09:39:22 +0800, 露露 wrote:
&gt; libvirt
&gt; version: 3.4.0
&gt; architecture: x86_64 ubuntu16.04-server
&gt; hypervisor: kvm,qemu
&gt; 
&gt; when I want make a memery snapshot for a vm ,and I call virsh save ,but tell me this error:
&gt; error: Failed to save domain 177 to /datapool/mm.img
&gt; error: operation failed: domain save job: unexpectedly failed

You need to provide debug logs of the libvirt daemon in this case.

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170725092225</emailId><senderName>Peter Krempa</senderName><senderEmail>pkrempa@redhat.com</senderEmail><timestampReceived>2017-07-25 09:22:25-0400</timestampReceived><subject>Re: [libvirt-users] transient configure turn to persistent configure</subject><body>


On Tue, Jul 25, 2017 at 09:50:29 +0800, 露露 wrote:
&gt; libvirt
&gt; version: 3.4.0
&gt; architecture: x86_64 ubuntu16.04-server
&gt; hypervisor: kvm,qemu
&gt; 
&gt; I call virDomainCreate create a transient vm, After a period of time ,I call \
&gt; virDomainDestroy, the vm configure is stil exist， the vm turn to persistent, I \
&gt; don't known the reason.

Did you mean virDomainCreateXML? virDomainCreate actually requires the
domain to be persistent since the argument is a virDomainPtr.

If you indeed meant virDomainCreateXML then from your description it's
impossible to say why that happened. You need to provide information
what you did when that happened.


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170725112859</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-07-25 11:28:59-0400</timestampReceived><subject>Re: [libvirt-users] how libvirt create virbr0</subject><body>

On 07/25/2017 04:36 AM,  ¶ ¶ wrote:
&gt; libvirt
&gt; version: 3.4.0
&gt; architecture: x86_64 ubuntu16.04-server
&gt; hypervisor: kvm,qemu
&gt; 
&gt; when install libvirt from ubuntu distribution deb install libvirt, a virtual bridge \
&gt; virbr0 will be create . But when I build libvirt from souce code, how can I create \
&gt; a virbr0.

This may be due to the libvirt built from source doesn't have the
correct prefix? I don't know how/whether ubuntu does it, but in many
distros I've seen that they install default libvirt network (virsh
net-dumpxml default) and also set it to autostart. Now, the configs for
libvirt networks, domains, etc. is stored under /etc/libvirt. But if you
build libvirt from sources and do not set --prefix, that libvirt will
look under /usr/local/etc/libvirt. And since there is no network config,
it doesn't start any. I should point out here that network should remain
running even if libvirtd is shut down. The reason for that is to
maintain connectivity for the domains.

&gt; If I want create another virtual bridge ,How can I create and start the virtual \
&gt; bridge.

You need to define another network.

http://libvirt.org/formatnetwork.html

Michal


</body></email><email><emailId>20170725114348</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-07-25 11:43:48-0400</timestampReceived><subject>Re: [libvirt-users] About seclabel configure,Migrate error</subject><body>

On 07/25/2017 04:16 AM,  ¶ ¶ wrote:
&gt; libvirt
&gt; version: 3.4.0
&gt; architecture: x86_64 ubuntu16.04-server
&gt; hypervisor: kvm,qemu
&gt; 
&gt; When migrate vm, I encounter error:
&gt; "Migrate VM virt21 failed unsupported configuration: Unable to find security driver \
&gt; for model apparmor" but two host are same environment.before this error, migrate \
&gt; can be success. the source host seclabel configure is this :
&gt; &lt;seclabel type='dynamic' model='apparmor' relabel='yes'&gt;
&gt; &lt;label&gt;libvirt-8e4ec209-17ca-4b59-abb7-72f3984244f3&lt;/label&gt;
&gt; &lt;imagelabel&gt;libvirt-8e4ec209-17ca-4b59-abb7-72f3984244f3&lt;/imagelabel&gt;
&gt; &lt;/seclabel&gt;
&gt; I create a vm on the destination host ,the vm configure not seclabel congfigure.

You mean, there's no apparmor seclabel when you run the domain on the
destination? Well, then the two hosts are not identical in
configuration. What's the output of `aa-status` ran on the destination?

&gt; I reinstall libvirt on the destination host and migrate same vm, this error \
&gt; disappear.vm seclabel configure is default. I recreate a vm on the destination host \
&gt; ,the vm configure has the seclabel configure , I don't known the reason.

Is this the latest release? If not, can you try it because the bug might
have been fixed.

&gt; 
&gt; Another question:
&gt; I configure a vm xml's seclabel like this:
&gt; &lt;seclabel type='none' model='none'/&gt;

Not quite sure what are you trying to achieve with this.

&gt; and then call virDomainCreate create the vm, call virsh dumpxml, the vm xml's \
&gt; seclabel is this: &lt;seclabel type='none' model='none'/&gt;
&gt; &lt;seclabel type='dynamic' model='dac' relabel='yes'&gt;
&gt; &lt;label&gt;+0:+0&lt;/label&gt;
&gt; &lt;imagelabel&gt;+0:+0&lt;/imagelabel&gt;
&gt; &lt;/seclabel&gt;
&gt; I don't the reason.

This is because DAC security driver is enabled by default. Therefore
when libvirt is starting new domain it changes ownership of files qemu
is going to touch (again, by default). If you want to suppress this
behaviour you can:

&lt;seclabel type='none' model='dac' relabel='no'/&gt;

Michal


</body></email><email><emailId>20170726040623</emailId><senderName>wyang</senderName><senderEmail>w90p710@gmail.com</senderEmail><timestampReceived>2017-07-26 04:06:23-0400</timestampReceived><subject>Re: [libvirt-users] Why cannot block copy local storage to network disk</subject><body>



On 2017年07月25日 17:17, Peter Krempa wrote:
&gt; On Tue, Jul 18, 2017 at 15:33:24 +0200, Martin Kletzander wrote:
&gt;&gt; On Tue, Jul 18, 2017 at 06:06:45PM +0800, wyang wrote:
&gt;&gt;&gt; Hi, guys
&gt;&gt;&gt;
&gt;&gt;&gt; I was executing the following command to lively migrate local storage to
&gt;&gt;&gt; network storage,
&gt;&gt;&gt;
&gt;&gt;&gt;     [root@192-168-152-51 ~]# virsh blockcopy
&gt;&gt;&gt;     a75056a4-44e0-4b97-bc77-78142ee17038 vda —xml rbd.xml —wait —verbose
&gt;&gt;&gt;     —pivot
&gt;&gt;&gt;     error: argument unsupported: non-file destination not supported yet
&gt;&gt;&gt;
&gt;&gt;&gt; but I get the following error:
&gt;&gt;&gt;
&gt;&gt;&gt;     error: argument unsupported: non-file destination not supported yet
&gt;&gt;&gt;
&gt;&gt;&gt; I check my libvirt source code, and find the following code sniff in
&gt;&gt;&gt; /qemuDomainBlockCopyCommon/ function
&gt;&gt;&gt;
&gt;&gt;&gt; |if (!virStorageSourceIsLocalStorage(mirror)) {
&gt;&gt;&gt; virReportError(VIR_ERR_ARGUMENT_UNSUPPORTED, "%s", _("non-file
&gt;&gt;&gt; destination not supported yet")); } |
&gt;&gt;&gt;
&gt;&gt;&gt; it was introduced by Eric.
&gt;&gt;&gt;
&gt;&gt;&gt;     commit e53ee6c123321a1775ef3b36e15a5fa351d10fe4
&gt;&gt;&gt;     Author: Eric Blake eblake@redhat.com &lt;http://mailto:eblake@redhat.com&gt;
&gt;&gt;&gt;     Date: Fri Aug 29 16:30:46 2014 -0600
&gt;&gt;&gt;
&gt;&gt;&gt;     blockcopy: tweak how rebase calls into copy
&gt;&gt;&gt;
&gt;&gt;&gt; So my question is that why we cannot block copy to network storage?
&gt;&gt;&gt;
&gt;&gt; The answer is in the commit message.  It was not supported even before
&gt;&gt; the commit, it's just that now it needs to be explicitly checked.  IIUC,
&gt;&gt; before that commit the stat() call would just fail. It's just that
&gt;&gt; nobody implemented it yet.  Having said that, I'm unaware of the actual
&gt;&gt; limitations that there are.
&gt; I'm working on that currently. The code was never adapted to target
&gt; network in this case. As it was never implemented yet, the new approach
&gt; will use blockdev-add and blockdev-mirror, since we also need to support
&gt; multi-host based protocols, which are impossible to use with
&gt; drive-mirror command in qemu..
Look forward to your patch.  live migration  should also use 
blockdev-mirror.  I do not know whether somebody else is dong it.

Wei

</body></email><email><emailId>20170726162745</emailId><senderName>Peter Krempa</senderName><senderEmail>pkrempa@redhat.com</senderEmail><timestampReceived>2017-07-26 16:27:45-0400</timestampReceived><subject>Re: [libvirt-users] automatically reverting to a snapshot</subject><body>


Please configure your mail client to send plain-text version to mailing
lists ...

On Tue, Jul 25, 2017 at 16:08:58 +0100, Dirty Dan wrote:
&gt; &lt;div dir='auto'&gt;How can I automatically revert to a snapshot after the guest is \
&gt; stopped?&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="auto"&gt;/etc/libvirt/hooks/qemu&lt;/div&gt;&lt;div \
&gt; dir="auto"&gt;#!/bin/sh&lt;/div&gt;&lt;div dir="auto"&gt;name="&lt;span \
&gt; class="money"&gt;$1&lt;/span&gt;"&lt;/div&gt;&lt;div dir="auto"&gt;action="&lt;span \
&gt; class="money"&gt;$2&lt;/span&gt;"&lt;/div&gt;&lt;div dir="auto"&gt;if [ "$name" = "name" ]; \
&gt; then&lt;/div&gt;&lt;div dir="auto"&gt; virsh snapshot-revert "$name" --snapshotname \
&gt; "snapshot1"&lt;/div&gt;&lt;div dir="auto"&gt;fi&lt;/div&gt;&lt;div dir="auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
&gt; dir="auto"&gt;I tried this which resulted in a deadlock, then I saw the warning \
&gt; further down the page.&lt;/div&gt;&lt;/div&gt;

The hook documentation explicitly states that no calls to libvirt shoudl
be executed from the hook.

You can start a process in background, which will terminate the hook and
that process should be able to do libvirt calls.


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170727111617</emailId><senderName>G Crowe</senderName><senderEmail>gclvirtlist@crowie.net</senderEmail><timestampReceived>2017-07-27 11:16:17-0400</timestampReceived><subject>Re: [libvirt-users] Xen died - Fedora upgrade from 21 to 26</subject><body>

My server was installed as a "minimal install" in text mode, so there 
may be some difference between my setup and your laptop. Are you able to 
email the output of "systemctl list-unit-files" to me so that I can see 
what services are enabled?

I tried installing a couple of the other drivers mentioned in the log 
file...
# dnf install libvirt-daemon-driver-lxc
# dnf install libvirt-daemon-driver-uml
# dnf install libvirt-daemon-driver-vbox
But this made no difference.

I then tried disabling xenconsole.service, which fixed some things and 
broke others.
- reboots now work (I don't have to hard power cycle - it was locking up 
when trying to kill both the libvirtd and the xenconsole services)
- "virsh list" now works (shows an empty list)
- "xl list" now gives an error instead of just locking up (the same 
error as if libvirtd wasn't running - see below).
- "virsh define vmtest.xml" now gives an error (the same error that it 
gave before I installed libvirt-daemon-driver-libxl - see below)
- libvirtd.service starts fine on bootup. Manually restarting libvirtd 
does not resolve the above problems.

Note that on my Fedora 21 machine, it has libvirtd.service and 
xendomains.service and xenconsoled.service all running simultaneously, 
and it has been running for years without issues (even on reboots)

Is there any documentation on what needs to be installed and/or running 
to use Xen, and what conflicts?

Or is there any documentation on how Xen should be installed for the 
current version of Fedora?


Thank you

GC


# virsh define vmtest.xml
error: Failed to define domain from vmtest.xml
error: invalid argument: could not find capabilities for arch=x86_64 
domaintype=xen

# xl list
xencall: error: Could not obtain handle on privileged command interface: 
No such file or directory
libxl: error: libxl.c:108:libxl_ctx_alloc: cannot open libxc handle: No 
such file or directory
cannot init xl context




On 27/07/2017 11:40 AM, Alvin Starr wrote:
&gt; I just tried my laptop and booted xen and can virsh list and xl seem 
&gt; to work.
&gt;
&gt;
&gt; On 07/26/2017 06:27 PM, G Crowe wrote:
&gt;&gt; Alvin,
&gt;&gt;     Thanks for that. I disabled the xendomains service (I had to do 
&gt;&gt; it twice, as it seemed to re-enable itself after the first reboot) 
&gt;&gt; and it now starts libvirtd automatically on startup.
&gt;&gt;
&gt;&gt; However, all is not well!
&gt;&gt; "xl list" and "virsh list" will just hang
&gt;&gt; "systemctl stop libvirtd" just hangs and after this "ps aux" lists 
&gt;&gt; the process as defunct
&gt;&gt;     root       673  0.0  0.0      0     0 ?        Zsl  08:04 0:00 
&gt;&gt; [libvirtd] &lt;defunct&gt;
&gt;&gt; "kill -KILL 673" has no effect
&gt;&gt; "shutdown -r now" also hangs (I have to physically power off the 
&gt;&gt; machine) irrespectively of whether I have tried to stop the service 
&gt;&gt; before shutdown or not.
&gt;&gt;
&gt;&gt; None of this happened yesterday when I manually started libvirtd 
&gt;&gt; after bootup (when xendomains was still running).
&gt;&gt;
&gt;&gt; The logs show nothing in error or warning category, just a heap of 
&gt;&gt; info (I have the logs set to level 2). Is there anything in 
&gt;&gt; particular that I should be looking for in the logs?
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; Regarding the use of a VM to access the host in a remote location... 
&gt;&gt; I had considered this and there was little choice. The machine is on 
&gt;&gt; the end of a VDSL line and was installed to consolidate a few servers 
&gt;&gt; in that location in order to save power. I figured that automatically 
&gt;&gt; starting a VM that ran the networking was not much more risk than a 
&gt;&gt; physical server that had to start up its networking, and that has (so 
&gt;&gt; far) proven to be true with all of the remote restarts &amp; power 
&gt;&gt; outages to date. The only other option is an expensive second link to 
&gt;&gt; the host, and I've decided to live with the possibility of having to 
&gt;&gt; talk someone through a restart over the phone rather than go down 
&gt;&gt; that route.
&gt;&gt;
&gt;&gt; Interestingly, with the NBN in Australia (the country-wide rollout of 
&gt;&gt; fibre or broadband to every premises) they have effectively converted 
&gt;&gt; all our phone lines to VoIP. This has resulted in the old physical 
&gt;&gt; landline now requiring one of the VMs to be running as well, so if I 
&gt;&gt; ever need to talk someone through a restart it will need to be on a 
&gt;&gt; mobile phone.
&gt;&gt;
&gt;&gt;
&gt;&gt; Thank you
&gt;&gt;
&gt;&gt; GC
&gt;&gt;
&gt;&gt;
&gt;&gt; On 27/07/2017 5:47 AM, Alvin Starr wrote:
&gt;&gt;&gt; I addressed the fix to Jim but I should have addressed it to you.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Try systemctl disable xendomains.service
&gt;&gt;&gt;
&gt;&gt;&gt; It is conflicting with libvirtd.service.
&gt;&gt;&gt; I found it by using
&gt;&gt;&gt; "systemd-analyze  dot libvirtd.service | dot -Tgif &gt; /tmp/dot1.gif"
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; It looks like libvirt-daemon-driver-xen or 
&gt;&gt;&gt; libvirt-daemon-driver-libxl  should  disable the xendomains.service
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On 07/26/2017 06:46 AM, G Crowe wrote:
&gt;&gt;&gt;&gt; Jim,
&gt;&gt;&gt;&gt;     Thanks for that, I had manually installed 
&gt;&gt;&gt;&gt; libvirt-daemon-driver-xen, but also needed to install 
&gt;&gt;&gt;&gt; libvirt-daemon-driver-libxl. I can now create VMs and convert 
&gt;&gt;&gt;&gt; config formats.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; However the daemon still fails to start on bootup. It starts fine 
&gt;&gt;&gt;&gt; when I manually start it with "systemctl start libvirtd" but 
&gt;&gt;&gt;&gt; setting it to autostart with "systemctl enable libvirtd" seems to 
&gt;&gt;&gt;&gt; have no effect. When I look at the status, it tells me that the 
&gt;&gt;&gt;&gt; service is "enabled" which means that it starts on bootup (well, 
&gt;&gt;&gt;&gt; that's what it means for any other service).
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; This is rather critical on this PC, as it has unattended restarts 
&gt;&gt;&gt;&gt; and the VPN/routing is done in one of the VMs (i.e. I can't get to 
&gt;&gt;&gt;&gt; it unless it auto-starts at least one VM).
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Unfortunatley there is nothing appearing in the libvirtd log over a 
&gt;&gt;&gt;&gt; reboot to help diagnose.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Any suggestions?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Thank you
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; GC
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; [root@testhost ~]# systemctl status libvirtd
&gt;&gt;&gt;&gt; ● libvirtd.service - Virtualization daemon
&gt;&gt;&gt;&gt;    Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; 
&gt;&gt;&gt;&gt; enabled; vendor preset: enabled)
&gt;&gt;&gt;&gt;    Active: inactive (dead)
&gt;&gt;&gt;&gt;      Docs: man:libvirtd(8)
&gt;&gt;&gt;&gt;            http://libvirt.org
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On 25/07/2017 1:20 AM, Jim Fehlig wrote:
&gt;&gt;&gt;&gt;&gt; On 07/23/2017 04:25 PM, G Crowe wrote:
&gt;&gt;&gt;&gt;&gt;&gt; Hi,
&gt;&gt;&gt;&gt;&gt;&gt;      I am trying to upgrade my Xen host (Dom0) and are having 
&gt;&gt;&gt;&gt;&gt;&gt; troubles getting it to work.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; I think that it has booted into a kernel that supports Xen 
&gt;&gt;&gt;&gt;&gt;&gt; (running 'xl info' does list some Xen capabilities), but I have 
&gt;&gt;&gt;&gt;&gt;&gt; three problems (that I have found so far).
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Firstly, the "libvirtd" daemon doesn't start on bootup (and as a 
&gt;&gt;&gt;&gt;&gt;&gt; result all 'virsh' commands fail). It is set to auto-start 
&gt;&gt;&gt;&gt;&gt;&gt; (systemctl enable libvirtd), and can be manually started 
&gt;&gt;&gt;&gt;&gt;&gt; (systemctl start libvirtd), but it will not auto-start on reboot.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Secondly, Once I have manually started libvirtd, when I try to 
&gt;&gt;&gt;&gt;&gt;&gt; define a domain it gives me an error "could not find capabilities 
&gt;&gt;&gt;&gt;&gt;&gt; for arch=x86_64 domaintype=xen" and I haven't yet been able to 
&gt;&gt;&gt;&gt;&gt;&gt; define any domains. This domain type works fine on Fedora 21.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Thirdly, I am unable to convert to/from xml config format, it 
&gt;&gt;&gt;&gt;&gt;&gt; gives me the error "error: invalid argument: unsupported config 
&gt;&gt;&gt;&gt;&gt;&gt; type xen-xl" however the format "xen-xl" works fine on the Fedora 
&gt;&gt;&gt;&gt;&gt;&gt; 21 machine.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; It sounds like the libvirt libxl driver is not loaded. Is the 
&gt;&gt;&gt;&gt;&gt; libvirt-daemon-driver-libxl package installed? If it's installed, 
&gt;&gt;&gt;&gt;&gt; enabling debug logging in libvirtd can provide hints why it is not 
&gt;&gt;&gt;&gt;&gt; loading
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; http://libvirt.org/logging.html
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Regards,
&gt;&gt;&gt;&gt;&gt; Jim
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; I had these same issues when I tried to upgrade to Fedora 25 and 
&gt;&gt;&gt;&gt;&gt;&gt; assumed that something had been broken and so abandoned further 
&gt;&gt;&gt;&gt;&gt;&gt; attempts to upgrade, however since Fedora 26 is the same I am now 
&gt;&gt;&gt;&gt;&gt;&gt; assuming that I have stuffed something up myself (or missed 
&gt;&gt;&gt;&gt;&gt;&gt; something).
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Fedora 21 uses kernel 3.19.3 and xen 4.4.1
&gt;&gt;&gt;&gt;&gt;&gt; Fedora 26 uses kernel 4.11.8 and xen 4.8.1
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; I have tried following the info on 
&gt;&gt;&gt;&gt;&gt;&gt; https://wiki.xen.org/wiki/Fedora_Host_Installation but it appears 
&gt;&gt;&gt;&gt;&gt;&gt; to be out of date now (I used this site when I started using Xen 
&gt;&gt;&gt;&gt;&gt;&gt; under Fedora 19, and when I upgraded to Fedora 21)
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Does anyone have any suggestions? outputs from "xl info" and the 
&gt;&gt;&gt;&gt;&gt;&gt; domain config are below. I have also tried disabling SELinux, but 
&gt;&gt;&gt;&gt;&gt;&gt; it made no difference.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Thanks
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; GC
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; -----------------------------------------------
&gt;&gt;&gt;&gt;&gt;&gt; On the fedora 26 box.....
&gt;&gt;&gt;&gt;&gt;&gt; # xl info
&gt;&gt;&gt;&gt;&gt;&gt; host                   : family.mydomain.mytld
&gt;&gt;&gt;&gt;&gt;&gt; release                : 4.11.8-300.fc26.x86_64
&gt;&gt;&gt;&gt;&gt;&gt; version                : #1 SMP Thu Jun 29 20:09:48 UTC 2017
&gt;&gt;&gt;&gt;&gt;&gt; machine                : x86_64
&gt;&gt;&gt;&gt;&gt;&gt; nr_cpus                : 4
&gt;&gt;&gt;&gt;&gt;&gt; max_cpu_id             : 3
&gt;&gt;&gt;&gt;&gt;&gt; nr_nodes               : 1
&gt;&gt;&gt;&gt;&gt;&gt; cores_per_socket       : 4
&gt;&gt;&gt;&gt;&gt;&gt; threads_per_core       : 1
&gt;&gt;&gt;&gt;&gt;&gt; cpu_mhz                : 2712
&gt;&gt;&gt;&gt;&gt;&gt; hw_caps                : 
&gt;&gt;&gt;&gt;&gt;&gt; b7ebfbff:77faf3bf:2c100800:00000121:0000000f:009c67af:00000000:00000100 
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; virt_caps              : hvm hvm_directio
&gt;&gt;&gt;&gt;&gt;&gt; total_memory           : 8072
&gt;&gt;&gt;&gt;&gt;&gt; free_memory            : 128
&gt;&gt;&gt;&gt;&gt;&gt; sharing_freed_memory   : 0
&gt;&gt;&gt;&gt;&gt;&gt; sharing_used_memory    : 0
&gt;&gt;&gt;&gt;&gt;&gt; outstanding_claims     : 0
&gt;&gt;&gt;&gt;&gt;&gt; free_cpus              : 0
&gt;&gt;&gt;&gt;&gt;&gt; xen_major              : 4
&gt;&gt;&gt;&gt;&gt;&gt; xen_minor              : 8
&gt;&gt;&gt;&gt;&gt;&gt; xen_extra              : .1
&gt;&gt;&gt;&gt;&gt;&gt; xen_version            : 4.8.1
&gt;&gt;&gt;&gt;&gt;&gt; xen_caps               : xen-3.0-x86_64 xen-3.0-x86_32p 
&gt;&gt;&gt;&gt;&gt;&gt; hvm-3.0-x86_32 hvm-3.0-x86_32p hvm-3.0-x86_64
&gt;&gt;&gt;&gt;&gt;&gt; xen_scheduler          : credit
&gt;&gt;&gt;&gt;&gt;&gt; xen_pagesize           : 4096
&gt;&gt;&gt;&gt;&gt;&gt; platform_params        : virt_start=0xffff800000000000
&gt;&gt;&gt;&gt;&gt;&gt; xen_changeset          :
&gt;&gt;&gt;&gt;&gt;&gt; xen_commandline        : placeholder
&gt;&gt;&gt;&gt;&gt;&gt; cc_compiler            : gcc (GCC) 7.0.1 20170421 (Red Hat 
&gt;&gt;&gt;&gt;&gt;&gt; 7.0.1-0.15)
&gt;&gt;&gt;&gt;&gt;&gt; cc_compile_by          : mockbuild
&gt;&gt;&gt;&gt;&gt;&gt; cc_compile_domain      : [unknown]
&gt;&gt;&gt;&gt;&gt;&gt; cc_compile_date        : Wed May  3 21:23:49 UTC 2017
&gt;&gt;&gt;&gt;&gt;&gt; build_id               : 1c6e5a40165e05837303942b54757ae1f2d5033d
&gt;&gt;&gt;&gt;&gt;&gt; xend_config_format     : 4
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; ---------------------------------------------------
&gt;&gt;&gt;&gt;&gt;&gt; # cat vmtest.xml
&gt;&gt;&gt;&gt;&gt;&gt; &lt;domain type='xen' id='21'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;name&gt;testVM&lt;/name&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMemory&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;os&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;type arch='x86_64' machine='xenfv'&gt;hvm&lt;/type&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;loader type='rom'&gt;/usr/lib/xen/boot/hvmloader&lt;/loader&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;boot dev='network'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;/os&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;features&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;acpi/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;apic/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;pae/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;/features&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;clock offset='variable' adjustment='0' basis='utc'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;on_crash&gt;restart&lt;/on_crash&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;devices&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;interface type='bridge'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;        &lt;mac address='02:02:00:03:00:00'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;        &lt;source bridge='enp1s0'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;        &lt;script path='vif-bridge'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;/interface&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;serial type='pty'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;        &lt;target port='0'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;/serial&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;console type='pty'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;        &lt;target type='serial' port='0'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;/console&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;input type='mouse' bus='ps2'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;input type='keyboard' bus='ps2'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;graphics type='vnc' port='5901' autoport='no' 
&gt;&gt;&gt;&gt;&gt;&gt; listen='192.168.131.54'&gt;
&gt;&gt;&gt;&gt;&gt;&gt;        &lt;listen type='address' address='192.168.131.54'/&gt;
&gt;&gt;&gt;&gt;&gt;&gt;      &lt;/graphics&gt;
&gt;&gt;&gt;&gt;&gt;&gt;    &lt;/devices&gt;
&gt;&gt;&gt;&gt;&gt;&gt; &lt;/domain&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; --------------------------------------
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt;&gt;&gt;&gt; libvirt-users mailing list
&gt;&gt;&gt;&gt;&gt;&gt; libvirt-users@redhat.com
&gt;&gt;&gt;&gt;&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt;&gt; libvirt-users mailing list
&gt;&gt;&gt;&gt; libvirt-users@redhat.com
&gt;&gt;&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;&gt;
&gt;&gt;
&gt;

</body></email><email><emailId>20170731121748</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-07-31 12:17:48-0400</timestampReceived><subject>Re: [libvirt-users] Libvirt and dnsmasq</subject><body>

On 07/28/2017 08:35 AM, Erik Lukács wrote:
&gt; Hi Guys, I do. have a question on libvirt according dnsmasq.
&gt; 
&gt; according to the Documentation libvirt initiates for each virtual Interface a \
&gt; dnsmasq process which listens on that interface. 
&gt; 
&gt; Now my Setup Looks like this: in Order to rebuild a Customers Setup i created a vm \
&gt; with several Interfaces ( machine1) and an API Server with two Interfaces ( \
&gt; machine2). Two of these interfaces net_ext and net_int are available on both vms. \
&gt; One of That Interface is meant for Internet (net_ext) the other other for \
&gt; intercommunication (net_int). The "Internet" network is Routed via another virtual \
&gt; Interface (net_infra) which is unavailable on both vms. On that network my outgoing \
&gt; Gateway, ntp and DNS Server is configured in the vms. 
&gt; This makes me crazy due to the fact that dns resolution on machine1 does not work \
&gt; until I either kill the dnsmasq process which listens on net_infra (this makes the \
&gt; system-wide dnsmasq also react on that interface) or I make config-changes \
&gt; mentioned below (but that persists only until the host is rebooted. 
&gt; Both vms and the host run with centos7
&gt; 
&gt; 
&gt; My problem now is, that dnsmasq is Running on every virtual interface. And every \
&gt; process only listens on its own interface. All changes are undone/reset by reboot. 
&gt; Of course during runtime (and with restart) i can add to \
&gt; "Interface=net_infra,net_ext" which temporarily fixes My Problem. 
&gt; Another thing I could do is killing the dnsmasq process on the interface and use \
&gt; the hosts own dnsmasq config. 
&gt; 
&gt; Without These changes on DNS resolution doesn't work within my machines ( as \
&gt; written DNS MUST be set on an ip on net_infra, which must not be bound to both \
&gt; vms). 
&gt; So my question: How do i einher configure dnsmasq Not to Start for each Interface \
&gt; on libvirt-start or how do i configure the dnsmasq-config for net_infra also to \
&gt; listen

We don't allow users to pass arbitrary configuration string to dnsmasq.
Not only it is considered internal implementation, it may render your
settings unusable.

To not start dnsmasq don't include any &lt;ip/&gt; with dhcp range or &lt;dns/&gt;.

But others might have some more bright ideas on this.

Michal


</body></email><email><emailId>20170731122639</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-07-31 12:26:39-0400</timestampReceived><subject>Re: [libvirt-users] libvirt virDomainDestroy</subject><body>

On Mon, Jul 31, 2017 at 04:23:51PM +0800, llilulu wrote:
&gt;    When stop a qemu vm via libvirt api, I call virDomainShutdown, I can seen
&gt; the vm shutdown process, But I call virDomainDestroyFlags with
&gt; VIR_DOMAIN_DESTROY_GRACEFULL ,I can't seen the vm shutdown process,
&gt; virDomainDestroyFlags with VIR_DOMAIN_DESTROY_GRACEFULL is gave vm
&gt; driver process a SIGTERM , how vm driver process SIGTERM signal (like qemu).

The GRACEFUL flag isn't about allowing the guest OS to shutdown. It is the
difference between allowing QEMU to cleanly release resources, vs making
QEMU exit immediately. eg it allows pending / cached I/O operations  to
complete before QEMU exits.

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170731125809</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-07-31 12:58:09-0400</timestampReceived><subject>Re: [libvirt-users] Changing &lt;on_reboot&gt; in the domain XML file</subject><body>

On 07/30/2017 03:08 AM, Sam Varshavchik wrote:
&gt; Using virsh edit, I made the following change to the domain XML file:
&gt; 
&gt; &lt;on_reboot&gt;destroy&lt;/on_reboot&gt;
&gt; 
&gt; But this appears to do nothing. The VM guest is Windows 10, and when
&gt; directing it to reboot, it still reboots, instead of shutting off the VM.
&gt; 
&gt; I was trying to work around some kind of a bug, somewhere, that started
&gt; happening after updating to Fedora 26 and qemu 2.9, where a reboot
&gt; throws my Windows 10 guests into some kind of a bizarre automatic
&gt; recovery mode, which then claims that the hard drive is hosed. It's not,
&gt; and a forced shutdown followed by a cold start boots everything back up
&gt; like nothing has happened (which I didn't figure out until reinstalling
&gt; one of the guests, sigh...), and everything is peachy once again.
&gt; 
&gt; So, anyway, I was trying to figure out a way around it, and
&gt; &lt;on_reboot&gt;destroy&lt;/on-reboot&gt; seemed to be exactly what I was looking for.
&gt; 
&gt; Perusing qemu's man page, it seems that this option should result in a
&gt; -no-reboot option getting added to qemu's command line. But, looking at
&gt; the actual command line, after starting the VM, it's nowhere to be seen.
&gt; 
&gt; A bit more Google-fu found this:
&gt; 
&gt; http://blog.vmsplice.net/2011/04/how-to-pass-qemu-command-line-options.html
&gt; 
&gt; And I manually added a -no-reboot option to the domain XML file that way.
&gt; 
&gt; And you know what? After doing that, telling Windows 10 to reboot simply
&gt; shuts off the VM. Wonderful.

Libvirt doesn't append -no-reboot because of this commit:

libvirt.org/git/?p=libvirt.git;a=commitdiff;h=0e034efaf9

Having said that, I believe libvirt puts -no-shutdown on your command
line. Then, libvirt has a handler for various guest events - e.g. when
the guest reboots (well, when it calls 'reset'). But when looking at its
implementation it looks like there is something missing:

http://libvirt.org/git/?p=libvirt.git;a=blob;f=src/qemu/qemu_process.c;h=a11d75b80fb018da777fa013a1c5c0762568ac19;hb=HEAD#l478



Compare it to say SHUTDOWN event:

http://libvirt.org/git/?p=libvirt.git;a=blob;f=src/qemu/qemu_process.c;h=a11d75b80fb018da777fa013a1c5c0762568ac19;hb=HEAD#l631


Therefore I think this is a bug. Let me see if I can propose a fix for
it. Meanwhile - you can report a bug if you want.

Michal


</body></email><email><emailId>20170731162701</emailId><senderName>Sam Varshavchik</senderName><senderEmail>mrsam@courier-mta.com</senderEmail><timestampReceived>2017-07-31 16:27:01-0400</timestampReceived><subject>Re: [libvirt-users] =?utf-8?q?Changing_=3Con=5Freboot=3E_in_the______?=</subject><body>


Michal Privoznik writes:

&gt; Libvirt doesn't append -no-reboot because of this commit:
&gt;
&gt; libvirt.org/git/?p=libvirt.git;a=commitdiff;h=0e034efaf9
&gt;
&gt; Having said that, I believe libvirt puts -no-shutdown on your command

Yes, I see that option getting passed in.

&gt; line. Then, libvirt has a handler for various guest events - e.g. when
&gt; the guest reboots (well, when it calls 'reset'). But when looking at its
&gt; implementation it looks like there is something missing:

The end result is that left to its own devices, the guest still reboots,  
with -no-shutdown.

&gt; Therefore I think this is a bug. Let me see if I can propose a fix for
&gt; it. Meanwhile - you can report a bug if you want.

Ok, it's bug 1476866



[Attachment #3 (application/pgp-signature)]

</body></email><email><emailId>20170601093550</emailId><senderName>"zhunxun () gmail ! com"</senderName><senderEmail>zhunxun@gmail.com</senderEmail><timestampReceived>2017-06-01 09:35:50-0400</timestampReceived><subject>[libvirt-users] VM memory monitor</subject><body>

[Attachment #2 (text/plain)]

Hello£¬I  want to know what the "virsh dommemstat " really stand for?the rss in \
result really indicatre the physical memory that the VM has used? thanks!



zhunxun@gmail.com


[Attachment #3 (text/html)]

&lt;html&gt;&lt;head&gt;&lt;meta http-equiv="content-type" content="text/html; \
charset=GB2312"&gt;&lt;style&gt;body { line-height: 1.5; }body { font-size: 10.5pt; \
font-family: 'Microsoft YaHei UI'; color: rgb(0, 0, 0); line-height: 1.5; \
}&lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;div&gt;&lt;span&gt;&lt;/span&gt;Hello£¬I  want to know what the "virsh \
dommemstat " really stand for?the rss in result really indicatre the physical memory \
that the VM has used?&lt;/div&gt;&lt;div&gt;thanks!&lt;/div&gt; &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style="width: 210px; \
height: 1px;" color="#b5c4df" size="1" align="left"&gt; &lt;div&gt;&lt;span&gt;&lt;div style="MARGIN: \
10px; FONT-FAMILY: verdana; FONT-SIZE: \
10pt"&gt;&lt;div&gt;zhunxun@gmail.com&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;&lt;/div&gt; &lt;/body&gt;&lt;/html&gt;



</body></email><email><emailId>20170602103331</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-06-02 10:33:31-0400</timestampReceived><subject>Re: [libvirt-users] No way to stop virStream error after guest stop</subject><body>


On Wed, May 24, 2017 at 03:10:41PM +0000, Jos=C9 Luis Valencia Gutierrez wr=
ote:
&gt;That is great, calling Abort also should remove the callbacks.
&gt;

This didn't go through, I'll at least try documenting it, although that
brings in a lot of other changes that should be in the documentation.

&gt;On Wed, 24 May 2017 11:11 Martin Kletzander, &lt;mkletzan@redhat.com&gt; wrote:
&gt;
&gt;&gt; On Wed, May 17, 2017 at 07:53:35PM +0000, Jos=C9 Luis Valencia Gutierrez
&gt;&gt; wrote:
&gt;&gt; &gt;I just tried removing the callback before calling virStreamFinish and it
&gt;&gt; &gt;worked right, I thought by simply finish the stream would stop the even=
ts
&gt;&gt; &gt;and close it, the example I was based on only calls virStreamFinish on =
EOF
&gt;&gt; &gt;event.
&gt;&gt; &gt;
&gt;&gt;
&gt;&gt; I'm working on a patch that removes the callbacks after calling Finish.
&gt;&gt; Our docs don't really say it's needed and I don't (yet) see the point in
&gt;&gt; requiring that.
&gt;&gt;

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170602145637</emailId><senderName>David Morrison</senderName><senderEmail>drmorr@evokewonder.com</senderEmail><timestampReceived>2017-06-02 14:56:37-0400</timestampReceived><subject>[libvirt-users] Debugging Windows 10 Guest Flakiness</subject><body>

Hello,

I'm not sure if I'm asking this question in the right place, so please 
redirect me if there's a better list.

I recently set up a Windows 10 guest on an Arch Linux host with libvirt 
and KVM/Qemu, using IOMMU to enable GPU passthrough.  I followed this 
guide to set up the VM:

https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF

The problem that I'm having is that the guest is very flaky: sometimes 
the guest will just hang indefinitely, and sometimes the guest loses 
network connectivity.  Usually when either of these behaviors happens, 
restarting the libvirtd daemon on the host resolves the issue, but 
that's not always true, and sometimes when I restart libvirtd it causes 
my entire (host) machine to lock up!

I have enabled log_output level 1 in /etc/libvirt/libvirtd.conf and have 
monitored the log file during one of these hangs, but I don't see any 
obvious errors or problems in the log file itself (and there's a lot of 
information to sort through, so I may have missed something).

Some specifics about my setup:

Motherboard: ASUS Sabertooth X79
CPU: Intel i7 4930K
Host GPU: GeForce GT 730
Guest GPU: GeForce GTX 780
Virtual network interface: NAT with the virtio driver

I'm *reasonably* confident that the problem is not with the GPU 
passthrough setup, as I'm able to run FurMark (a GPU burn-in tool) on 
the guest with no problems.  However, I haven't yet been able to 
reliably reproduce the error at all, so I'm pretty much at a loss as to 
where to go from here.

Can anyone on this list point me in a good direction to look, or have 
you seen anything like this before?  I'm happy to provide debug logs or 
any other information that is helpful, as well.

Thanks for your time,
David

</body></email><email><emailId>20170604095008</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-06-04 09:50:08-0400</timestampReceived><subject>Re: [libvirt-users] vm live migration memory copy</subject><body>


On Sun, Jun 04, 2017 at 11:43:35AM +0200, Hui Jing wrote:
&gt;Hi All,
&gt;
&gt;I am wondering when we do live migration, how much memory is transferred? I
&gt;guess it must be one of the three below, but not sure which one:
&gt;1. The amount of memory allocated to VM
&gt;2. The memory currently used by VM (actual Mem usage in guest)
&gt;3. The memory used by the qemu process (RSS).
&gt;

It is more complicated than that.  You need to transfer all the memory
that the VM used, that's for sure, right?  Then it depends on the
hypervisor whether or not they include the nulls, how much of their
memory they need transfer, how much memory is there for all the devices
that the VM has, whether there's any compression algorithm applied, and,
most importantly, you need to retransfer any memory that was changed
after it was transferred.  And when you are re-transferring, the same
can happen.  So at the end it depends on how fast your guest is changing
how much memory and how fast your transfer is.  Plus bunch of other
things that I forgot, for sure.

&gt;Best Regards,
&gt;Hui

&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170606093659</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-06-06 09:36:59-0400</timestampReceived><subject>Re: [libvirt-users] why increasing vCPUs increasing the CPU sockets for QEMU+KVM</subject><body>

On Tue, Jun 06, 2017 at 12:57:25AM +0530, girish kumar wrote:
&gt; Hi Daniel,
&gt; 
&gt; Thanks a lot for the quick and detailed explanation. Please see my another
&gt; query below.
&gt; 
&gt; &gt;&gt;In normal usage, the guest vCPUs will be floating arbitrarily across any
&gt; &gt;&gt;host physical CPUs.  So trying to match host / guest topology is not only
&gt; &gt;&gt;useless, it might actually degrade your performance - eg if you give the
&gt; &gt;&gt;guest 1 socket, 1 core and 2 threads, but he vCPUs get scheduled on
&gt; different
&gt; &gt;&gt;thost sockets, the guest OS will make very bad decisions.
&gt; 
&gt; The above is true, only if the the host have multiple sockets. As long as
&gt; the host has single socket, there will not be any performance degradation
&gt; right?

Even if you only have a single socket, you may still have multiple cores
and multiple threads, so it still potentially applies.

&gt; &gt;&gt;If you are willing, however, to assign dedicated host CPUs to each guest
&gt; &gt;&gt;CPU, then you can try to match the host + guest topology. That will
&gt; improve
&gt; &gt;&gt;performance, since the guest CPUs will be fixed to specific host CPUs.
&gt; THis
&gt; &gt;&gt;isn't suitable as a default config though, hence libvirt/QEMU's default
&gt; &gt;&gt;behaviour of using sockets for all vCPUs.
&gt; Will try the advanced configuration to match the guest to host. I am kind
&gt; of looking for a configuration which launches qemu with "-cpu host" option.

The '-cpu host' setup is not related to sockets/cores/threads topology.
That exclusively controls CPU feature flags. This is accessible in
libvirt using

   &lt;cpu mode="host-passthrough"/&gt;

&gt; 
&gt; On 5 June 2017 at 21:10, Daniel P. Berrange &lt;berrange@redhat.com&gt; wrote:
&gt; 
&gt; &gt; On Mon, Jun 05, 2017 at 08:40:19PM +0530, girish kumar wrote:
&gt; &gt; &gt; Hi All,
&gt; &gt; &gt;
&gt; &gt; &gt; I am new here, please warn me If I am not following proper etiquette of
&gt; &gt; &gt; this mailing list.
&gt; &gt; &gt;
&gt; &gt; &gt; I am breaking my head, regarding why libvirt is defining multiple CPU
&gt; &gt; &gt; sockets when I increase the vCPU count. As and when I increase the vCPU
&gt; &gt; &gt; count in libvirt guest XML, it is increasing the CPU sockets in qemu
&gt; &gt; &gt; instance.
&gt; &gt; &gt;
&gt; &gt; &gt; " -smp 4,sockets=4,cores=1,threads=1 " instead " -smp
&gt; &gt; &gt; 4,sockets=1,cores=4,threads=1"
&gt; &gt; &gt;
&gt; &gt; &gt; Does not this lower the performance of the guest as the host and guest
&gt; &gt; &gt; architectures gets different in that case.
&gt; &gt; &gt;
&gt; &gt; &gt; Also please suggest a guest configuration which will take advantage of
&gt; &gt; the
&gt; &gt; &gt; host CPU architecture.
&gt; &gt;
&gt; &gt; In normal usage, the guest vCPUs will be floating arbitrarily across any
&gt; &gt; host physical CPUs.  So trying to match host / guest topology is not only
&gt; &gt; useless, it might actually degrade your performance - eg if you give the
&gt; &gt; guest 1 socket, 1 core and 2 threads, but he vCPUs get scheduled on
&gt; &gt; different
&gt; &gt; thost sockets, the guest OS will make very bad decisions.
&gt; &gt;
&gt; &gt; By defaulting to giving the guest only sockets, you get fixed predictable
&gt; &gt; behaviour from the guest OS, as the host OS moves vCPUs threads around.
&gt; &gt;
&gt; &gt; If you are willing, however, to assign dedicated host CPUs to each guest
&gt; &gt; CPU, then you can try to match the host + guest topology. That will improve
&gt; &gt; performance, since the guest CPUs will be fixed to specific host CPUs. THis
&gt; &gt; isn't suitable as a default config though, hence libvirt/QEMU's default
&gt; &gt; behaviour of using sockets for all vCPUs.
&gt; &gt;
&gt; &gt; Regards,
&gt; &gt; Daniel
&gt; &gt; --
&gt; &gt; |: https://berrange.com      -o-    https://www.flickr.com/photos/
&gt; &gt; dberrange :|
&gt; &gt; |: https://libvirt.org         -o-
&gt; &gt; https://fstop138.berrange.com :|
&gt; &gt; |: https://entangle-photo.org    -o-    https://www.instagram.com/
&gt; &gt; dberrange :|
&gt; &gt;
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Regards,
&gt; Girish

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170606151831</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-06-06 15:18:31-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd not accepting connections</subject><body>


On Tue, Jun 06, 2017 at 10:19:32AM -0400, Michael C. Cambria wrote:
&gt;Using qemu installed from source, I decided to try to create a VM.  It
&gt;worked.  I cut/pasted a script I used to create a centos72 VM, renamed
&gt;the name and cut the disk size down:
&gt;
&gt;$ cat debug-centos.sh
&gt;#/bin/bash
&gt;
&gt;sudo virt-install -n dbgcent72 \
&gt;     --ram=4096 \
&gt;     --vcpus 2 \
&gt;     --disk path=/dev/vg_guest_images/dbgcent72,device=disk,size=5 \
&gt;     --description "Centos 7.2 64Bit" \
&gt;     --network bridge:brguest0,model=e1000 \
&gt;     --cdrom /home/mcc/Downloads/CentOS-7-x86_64-DVD-1511.iso \
&gt;     --vnc \
&gt;     --noautoconsole \
&gt;     --hvm \
&gt;     --os-type=linux \
&gt;     --os-variant centos7.0 \
&gt;     --video=vmvga
&gt;
&gt;
&gt;$ ./debug-centos.sh
&gt;
&gt;Starting install...
&gt;Domain installation still in progress. You can reconnect to
&gt;the console to complete the installation process.
&gt;
&gt;$ sudo virsh list --all
&gt;  Id    Name                           State
&gt;----------------------------------------------------
&gt;  1     dbgcent72                      running
&gt;
&gt;The xml is placed next to the xml for all the other VM's that don't seem
&gt;to be found:
&gt;
&gt;# pwd
&gt;/etc/libvirt/qemu
&gt;# ls -al
&gt;total 80
&gt;drwx------. 3 root root 4096 Jun  6 09:36 .
&gt;drwx------. 5 root root 4096 Jun  6 08:38 ..
&gt;-rw-------. 1 root root 3870 Jun  6 09:36 dbgcent72.xml
&gt;-rw-------. 1 root root 3853 Jun 14  2016 dcos-bp.xml
&gt;-rw-------. 1 root root 3551 Mar 21  2015 fbsd100.xml
&gt;-rw-------. 1 root root 3273 Mar 23  2015 fbsd101.xml
&gt;-rw-------. 1 root root 3867 Feb 21  2015 fedora20.xml
&gt;drwx------. 3 root root 4096 May 10 18:08 networks
&gt;-rw-------. 1 root root 3510 Oct 11  2015 u1404s.xml
&gt;-rw-------. 1 root root 5017 Oct 11  2015 u1404.xml
&gt;-rw-------. 1 root root 3507 Jun  5 19:33 wheezy.xml
&gt;-rw-------. 1 root root 3489 Feb 21  2015 win7.xml

Well, in this case, even though you should not do that, normally, you
can do the following.  Backup your XMLs from this folder, and then try
feeding them to libvirt using 'virsh define /path/to/the/backup.xml'.
It is "essentially" what is happening when libvirt is starting, so it
will tell you why they cannot be loaded.  If they can, then compare the
output of 'virsh dumpxml $domain' to the backup XML and if it is the
same, then you restored your machines.  But that's very unlikely to
happen, because that'd mean I have no idea there's a codepath that could
fail.

Hopefully this will at least give us some more info about where to look
for the source of the problem.

Martin

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170607191836</emailId><senderName>"Chris"</senderName><senderEmail>chris2014@postbox.xyz</senderEmail><timestampReceived>2017-06-07 19:18:36-0400</timestampReceived><subject>Re: [libvirt-users] Isolate VMs' network</subject><body>

Daniel P. Berrange wrote:
&gt;       &lt;filterref filter='clean-traffic'/&gt;

&gt; There is quite alot more info here:
&gt;
&gt; http://libvirt.org/formatnwfilter.html
&gt; http://libvirt.org/firewall.html

Ok, clean-traffic! Good idea. I'll try this.

- Chris

</body></email><email><emailId>20170616082910</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-06-16 08:29:10-0400</timestampReceived><subject>Re: [libvirt-users] [qemu-kvm] Network bandwidth limits via libvirt</subject><body>

On 06/15/2017 07:56 AM, ×¿ºÆ·² wrote:
&gt; Hi all,
&gt; 
&gt; I try to understand why the network bandwidth limits are not applied to my ubuntu \
&gt; 16.04.2 VM (qemu-kvm driver) and I would need some insights. I create my VM network \
&gt; with virsh and when I issue a dumpxml on my network, I can see that bandwidth \
&gt; limits are set: 
&gt; virsh # net-dumpxml nat_limit
&gt; &lt;network&gt;
&gt; &lt;name&gt;nat_limit&lt;/name&gt;
&gt; &lt;uuid&gt;4b5e128d-9ad0-4ccc-9424-dee60b71861a&lt;/uuid&gt;
&gt; &lt;forward mode='nat'&gt;
&gt; &lt;nat&gt;
&gt; &lt;port start='1024' end='65535'/&gt;
&gt; &lt;/nat&gt;
&gt; &lt;/forward&gt;
&gt; &lt;bridge name='virbr1' stp='on' delay='0'/&gt;
&gt; &lt;mac address='52:54:00:af:99:73'/&gt;
&gt; &lt;bandwidth&gt;
&gt; &lt;inbound average='10' peak='50' burst='10'/&gt;
&gt; &lt;outbound average='128' peak='256' burst='256'/&gt;
&gt; &lt;/bandwidth&gt;
&gt; &lt;ip address='192.168.123.1' netmask='255.255.255.0'&gt;
&gt; &lt;dhcp&gt;
&gt; &lt;range start='192.168.123.2' end='192.168.123.254'/&gt;
&gt; &lt;/dhcp&gt;
&gt; &lt;/ip&gt;
&gt; 
&gt; &lt;/network&gt;

Have you restarted network after editing?
virsh net-destroy nat_limit &amp;&amp; virsh net-start nat_limit;

&gt; 
&gt; 
&gt; And the net info is:
&gt; virsh # net-info nat_limit
&gt; Name:           nat_limit
&gt; UUID:           4b5e128d-9ad0-4ccc-9424-dee60b71861a
&gt; Active:         yes
&gt; Persistent:     yes
&gt; Autostart:      yes
&gt; Bridge:         virbr1
&gt; Then, I create my VM, and the source of interface is the network, like this:
&gt; virsh # dumpxml virt20
&gt; ...
&gt; &lt;interface type='network'&gt;
&gt; &lt;mac address='52:54:00:a2:5b:10'/&gt;
&gt; &lt;source network='nat_limit' bridge='virbr1'/&gt;
&gt; &lt;target dev='vnet2'/&gt;
&gt; &lt;model type='rtl8139'/&gt;
&gt; &lt;alias name='net0'/&gt;
&gt; &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/&gt;
&gt; &lt;/interface&gt;
&gt; ...
&gt; 
&gt; 
&gt; However when I send a big file with netper I don't see any limits applied to the \
&gt; transfer rate.

Where are you sending the file from? If it is the host then the limits
should be applied. If it is from another virtual machine, then
unfortunately limits are set, but since kernel takes some shortcuts and
the packets don't travel through bridge but are copied from one vNIC to
another one. In that case you might want to use &lt;bandwidth/&gt; for your
&lt;interface/&gt; directly.

The golden rule here is follow the packets. In case of network, the
limiting is applied on the bridge, so packets must go through bridge in
order for limits to apply. In case of &lt;interface/&gt; the limits are
applied there.

Michal


</body></email><email><emailId>20170619030120</emailId><senderName>Charles Shih</senderName><senderEmail>cheshi@redhat.com</senderEmail><timestampReceived>2017-06-19 03:01:20-0400</timestampReceived><subject>[libvirt-users] Question about disabling '3dnowprefetch' CPU feature in Xen Guest using libvirt</subject><body>

Dear All,

    I'm reaching this mail-list to ask a small question about disabling
'3dnowprefetch' CPU feature in Xen Guest using libvirt.

    This is my environment:
    Fedora release 26 (Twenty Six)
    4.11.0-0.rc3.git0.2.fc26.x86_64
    xen-4.8.1-2.fc26.x86_64
    libvirt-3.2.1-1.fc26.x86_64

    I can disable '3dnowprefetch' CPU feature in guest via 'xl' command,
with adding `cpuid='host,3dnowprefetch=0'` into the CFG file.

    However, follow the instruction (https://libvirt.org/
formatdomain.html#elementsCPU), I added the following block into my XML
file:

```
  &lt;cpu mode='host-passthrough' check='none'&gt;
    &lt;feature policy='disable' name='3dnowprefetch'/&gt;
  &lt;/cpu&gt;
```

    Created the instance, seemed this feature was not being disabled in my
guest. (I was able to see '3dnowprefetch' in `lscpu` outputs)

    Anybody has idea on this? Does libvirt support this for Xen?

    Any help would be appreciated. Thank you in advance.

Regards,
Charles


Charles Shih (史晨)
Quality Engineer
Red Hat, Platform QE, Virt QE, Section 1
Email: cheshi@redhat.com
IRC: cheshi @ #eng-china, #hyperv ,#qa, #virt
T: +86 10 65627484 &lt;010%206562%207484&gt;  - IP: 8387484
M: +86 18611268098 &lt;186%201126%208098&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Dear All,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;      I'm reaching this mail-list to \
ask a small question  about disabling '3dnowprefetch' CPU feature in Xen \
Guest using libvirt.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;      This is my \
environment:&lt;/div&gt;&lt;div&gt;      Fedora release 26 (Twenty Six)&lt;/div&gt;&lt;div&gt;      \
4.11.0-0.rc3.git0.2.fc26.x86_&lt;wbr&gt;64&lt;br&gt;&lt;/div&gt;&lt;div&gt;       \
xen-4.8.1-2.fc26.x86_64&lt;/div&gt;&lt;div&gt;       \
libvirt-3.2.1-1.fc26.x86_64&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;      I can disable \
'3dnowprefetch' CPU feature in guest via 'xl' command, with adding \
`cpuid='host,3dnowprefetch=0'` into the CFG file.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;   \
However, follow the instruction (&lt;a \
href="https://libvirt.org/formatdomain.html#elementsCPU" \
target="_blank"&gt;https://libvirt.org/&lt;wbr&gt;formatdomain.html#elementsCPU&lt;/a&gt;)&lt;wbr&gt;, I \
added the following block into my XML \
file:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;```&lt;/div&gt;&lt;div&gt;&lt;div&gt;   &lt;cpu \
mode='host-passthrough' check='none'&gt;&lt;/div&gt;&lt;div&gt;      &lt;feature \
policy='disable' name='3dnowprefetch'/&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;/cpu&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;```&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;      Created the instance, \
seemed this feature was not being disabled in my guest. (I was able to see \
'3dnowprefetch' in `lscpu` outputs)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;      Anybody \
has idea on this? Does libvirt support this for Xen?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;      \
Any help would be appreciated. Thank you in \
advance.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regards,&lt;/div&gt;&lt;div&gt;Charles&lt;/div&gt;&lt;div&gt;  &lt;br \
clear="all"&gt;&lt;div&gt;&lt;div class="gmail-m_2817940541306820419gmail_signature"&gt;&lt;div \
dir="ltr"&gt;&lt;pre&gt;Charles Shih (史晨) Quality Engineer
Red Hat, Platform QE, Virt QE, Section 1
Email: &lt;a href="mailto:cheshi@redhat.com" target="_blank"&gt;cheshi@redhat.com&lt;/a&gt;
IRC: cheshi @ #eng-china, #hyperv ,#qa, #virt
T: &lt;a href="tel:010%206562%207484" value="+861065627484" target="_blank"&gt;+86 10 \
                65627484&lt;/a&gt;  - IP: 8387484
M: &lt;a href="tel:186%201126%208098" value="+8618611268098" target="_blank"&gt;+86 \
18611268098&lt;/a&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170605152219</emailId><senderName>girish kumar</senderName><senderEmail>girishbangaram@gmail.com</senderEmail><timestampReceived>2017-06-05 15:22:19-0400</timestampReceived><subject>[libvirt-users] why increasing vCPUs increasing the CPU sockets for QEMU+KVM</subject><body>

Hi All,

I am new here, please warn me If I am not following proper etiquette of
this mailing list.

I am breaking my head, regarding why libvirt is defining multiple CPU
sockets when I increase the vCPU count. As and when I increase the vCPU
count in libvirt guest XML, it is increasing the CPU sockets in qemu
instance.

" -smp 4,sockets=4,cores=1,threads=1 " instead " -smp
4,sockets=1,cores=4,threads=1"

Does not this lower the performance of the guest as the host and guest
architectures gets different in that case.

Also please suggest a guest configuration which will take advantage of the
host CPU architecture.

Your help will be highly appreciated.

-- 
Regards,
Girish

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi All,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I am new here, please warn me If I am not \
following proper etiquette of this mailing list.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I am \
breaking my head, regarding why libvirt is defining multiple CPU sockets when I \
increase the vCPU count. As and when I increase the vCPU count in libvirt guest XML, \
it is increasing the CPU sockets in qemu instance.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;" \
-smp 4,sockets=4,cores=1,threads=1 " instead "  -smp \
4,sockets=1,cores=4,threads=1"  &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Does not this \
lower the performance of the guest as the host and guest architectures gets different \
in that case.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also please suggest a guest configuration \
which will take advantage of the host CPU architecture.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Your \
help will be highly appreciated.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-- &lt;br&gt;&lt;div \
class="gmail_signature"&gt;&lt;div dir="ltr"&gt;&lt;div&gt;Regards,&lt;br&gt;Girish&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170601124755</emailId><senderName>"Michael C. Cambria"</senderName><senderEmail>mcc@fid4.com</senderEmail><timestampReceived>2017-06-01 12:47:55-0400</timestampReceived><subject>[libvirt-users] libvirtd not accepting connections</subject><body>


Hi,

Ever since I recently upgraded to Fedora 25, I can't get kvm working. 
It's worked on this system since initial fedora 20 install.  All 
upgrades were done via yum, then once available, dnf.

I do have libvirt-sock in LISTENING state:   STREAM     LISTENING 
/var/run/libvirt/libvirt-sock

I noticed I also have multiple connections in CONNECTING state:

STREAM     CONNECTING    0        /var/run/libvirt/libvirt-sock
STREAM     CONNECTING    0        /var/run/libvirt/libvirt-sock
STREAM     CONNECTING    0        /var/run/libvirt/libvirt-sock

I rebooted and tried again.  Each e.g. 'virsh -c" or virt-manager 
command I issue, I end up with another socket in CONNECTING state. 
restarting libvirtd.service close them leaving just one LISTENING

strace for virsh -c shows:


4301  socket(AF_UNIX, SOCK_STREAM, 0)   = 5
4301  connect(5, {sa_family=AF_UNIX, 
sun_path="/var/run/libvirt/libvirt-sock"}, 110) = 0
4301  getsockname(5, {sa_family=AF_UNIX}, [128-&gt;2]) = 0
4301  futex(0x7f3c0a2e4fc8, FUTEX_WAKE_PRIVATE, 2147483647) = 0
4301  fcntl(5, F_GETFD)                 = 0
4301  fcntl(5, F_SETFD, FD_CLOEXEC)     = 0
4301  fcntl(5, F_GETFL)                 = 0x2 (flags O_RDWR)
4301  fcntl(5, F_SETFL, O_RDWR|O_NONBLOCK) = 0

systemctl status libvirtd.service and journalctl -f -u libvirtd.service 
do not show any log entries for libvird after it has been started.  e.g. 
it doesn't log anything about the connection attempts.

Anyone have an idea where to look next?

Thanks,
MikeC


</body></email><email><emailId>20170605115826</emailId><senderName>"Chris"</senderName><senderEmail>chris2014@postbox.xyz</senderEmail><timestampReceived>2017-06-05 11:58:26-0400</timestampReceived><subject>[libvirt-users] Isolate VMs' network</subject><body>

All,

I'm trying to setup a network with some virtual machines, that can connect
to each other and to the internet, but neither to the host nor to other
VMs.

Is there any preconfigured network filter or best-practice for this setup?
Of course, I could setup iptables rules on the host, but I'd prefer
libvirt to handle them.

- Chris




</body></email><email><emailId>20170606203409</emailId><senderName>Sean Whalen</senderName><senderEmail>whalenster@gmail.com</senderEmail><timestampReceived>2017-06-06 20:34:09-0400</timestampReceived><subject>[libvirt-users] vendor_id state='off' not working as expected</subject><body>

Hi All,

I'm trying to counter VM detection methods for a malware sandbox, using
Pafish as a benchmark tool.

https://github.com/a0rtega/pafish

I have &lt;hyperv&gt;&lt;vendor_id state='off'/&gt;&lt;/hyperv&gt; defined in a Windows 7
domain on Ubuntu 17.10, but for some reason this just changes the
hypervisor vendor to "Microsoft Hv" instead of the default "KVMKVMKVM"
vendor.

How can I remove the hypervisor vendor completely?

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi All,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I'm trying to counter VM detection \
methods for a malware sandbox, using Pafish as a benchmark \
tool.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;a \
href="https://github.com/a0rtega/pafish"&gt;https://github.com/a0rtega/pafish&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;I \
have &lt;hyperv&gt;&lt;vendor_id state='off'/&gt;&lt;/hyperv&gt; defined in a \
Windows 7 domain on Ubuntu 17.10, but for some reason this just changes the \
hypervisor vendor to "Microsoft Hv" instead of the default \
"KVMKVMKVM" vendor.  &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;How can I remove the hypervisor \
vendor completely?&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170619074433</emailId><senderName>Andy Gibbs</senderName><senderEmail>andyg1001@hotmail.co.uk</senderEmail><timestampReceived>2017-06-19 07:44:33-0400</timestampReceived><subject>[libvirt-users] VM fails to start on boot-up</subject><body>

Hi,


I have created a VM with the option inside virt-manager to "start virtual machine on \
host boot up".  It is the only VM on the host to be configured this way.  However, I \
am getting this error in the log file when it attempts to start it on boot up:


2017-06-19 07:15:18.491+0000: starting up libvirt version: 2.0.0, package: 10.el7_3.9 \
(CentOS BuildSystem &lt;http://bugs.centos.org&gt;, 2017-05-25-20:52:28, \
c1bm.rdu2.centos.org), qemu version: 2.6.0 (qemu-kvm-ev-2.6.0-28.el7_3.9.1), \
hostname: server.mydomain.lan LC_ALL=C \
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin QEMU_AUDIO_DRV=spice \
/usr/libexec/qemu-kvm -name guest=MyVM,debug-threads=on -S -object \
secret,id=masterKey0,format=raw,file=/var/lib/libvirt/qemu/domain-1-MyVM/master-key.aes \
-machine pc-i440fx-rhel7.3.0,accel=kvm,usb=off,vmport=off -cpu Broadwell,+rtm,+hle -m \
8192 -realtime mlock=off -smp 4,sockets=4,cores=1,threads=1 -uuid \
cb6f4d45-091d-47f8-931a-8daf6b0cf2b8 -no-user-config -nodefaults -chardev \
socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-1-MyVM/monitor.sock,server,nowait \
-mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc,driftfix=slew -global \
kvm-pit.lost_tick_policy=discard -no-hpet -no-shutdown -global PIIX4_PM.disable_s3=1 \
-global PIIX4_PM.disable_s4=1 -boot menu=off,strict=on -device \
ich9-usb-ehci1,id=usb,bus=pci.0,addr=0x6.0x7 -device \
ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x6 \
-device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x6.0x1 -device \
ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x6.0x2 -device \
virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x5 -drive \
file=/var/lib/libvirt/images/MyVM.qcow2,format=qcow2,if=none,id=drive-virtio-disk0 \
-device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x7,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 \
-netdev tap,fd=28,id=hostnet0,vhost=on,vhostfd=30 -device \
virtio-net-pci,netdev=hostnet0,id=net0,mac=52:54:00:0e:2e:75,bus=pci.0,addr=0x3 \
-chardev pty,id=charserial0 -device isa-serial,chardev=charserial0,id=serial0 \
-chardev socket,id=charchannel0,path=/var/lib/libvirt/qemu/channel/target/domain-1-MyVM/org.qemu.guest_agent.0,server,nowait \
-device virtserialport,bus=virtio-serial0.0,nr=1,chardev=charchannel0,id=channel0,name=org.qemu.guest_agent.0 \
-chardev spicevmc,id=charchannel1,name=vdagent -device \
virtserialport,bus=virtio-serial0.0,nr=2,chardev=charchannel1,id=channel1,name=com.redhat.spice.0 \
-device usb-tablet,id=input0,bus=usb.0,port=1 -spice \
port=5900,tls-port=5901,addr=127.0.0.1,disable-ticketing,x509-dir=/etc/pki/vdsm/libvirt-spice,seamless-migration=on \
-device qxl-vga,id=video0,ram_size=67108864,vram_size=67108864,vram64_size_mb=0,vgamem_mb=16,bus=pci.0,addr=0x2 \
-device intel-hda,id=sound0,bus=pci.0,addr=0x4 -device \
hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -chardev \
spicevmc,id=charredir0,name=usbredir -device \
usb-redir,chardev=charredir0,id=redir0,bus=usb.0,port=2 -chardev \
spicevmc,id=charredir1,name=usbredir -device \
usb-redir,chardev=charredir1,id=redir1,bus=usb.0,port=3 -device \
virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x8 -msg timestamp=on char device \
redirected to /dev/pts/0 (label charserial0) ((null):3344): Spice-ERROR **: \
reds.c:4043:do_spice_init: statistics shm_open failed, Permission denied 2017-06-19 \
07:15:18.824+0000: shutting down

However, when I start the VM manually through virt-manager, it starts up fine.


Why might it fail during boot-up?  And is there anything I can do to solve the \
problem?


Many thanks,


Andy


[Attachment #3 (text/html)]

&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"&gt;
&lt;style type="text/css" style="display:none;"&gt;&lt;!-- P {margin-top:0;margin-bottom:0;} \
--&gt;&lt;/style&gt; &lt;/head&gt;
&lt;body dir="ltr"&gt;
&lt;div id="divtagdefaultwrapper" \
style="font-size:12pt;color:#000000;font-family:Calibri,Helvetica,sans-serif;" \
dir="ltr"&gt; &lt;p&gt;Hi,&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;p&gt;I have created a VM with the option inside virt-manager to "start virtual \
machine on host boot up".  It is the only VM on the host to be configured \
this way.  However, I am getting this error in the log file when it attempts to \
start it on boot up:&lt;/p&gt; &lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;div&gt;2017-06-19 07:15:18.491+0000: starting up libvirt version: 2.0.0, package: \
10.el7_3.9 (CentOS BuildSystem &lt;http://bugs.centos.org&gt;, 2017-05-25-20:52:28, \
c1bm.rdu2.centos.org), qemu version: 2.6.0 (qemu-kvm-ev-2.6.0-28.el7_3.9.1), \
hostname: server.mydomain.lan&lt;/div&gt; &lt;div&gt;LC_ALL=C \
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin QEMU_AUDIO_DRV=spice \
/usr/libexec/qemu-kvm -name guest=MyVM,debug-threads=on -S -object \
secret,id=masterKey0,format=raw,file=/var/lib/libvirt/qemu/domain-1-MyVM/master-key.aes \
                -machine pc-i440fx-rhel7.3.0,accel=kvm,usb=off,vmport=off
 -cpu Broadwell,+rtm,+hle -m 8192 -realtime mlock=off -smp \
4,sockets=4,cores=1,threads=1 -uuid cb6f4d45-091d-47f8-931a-8daf6b0cf2b8 \
-no-user-config -nodefaults -chardev \
socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-1-MyVM/monitor.sock,server,nowait
                
 -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc,driftfix=slew -global \
kvm-pit.lost_tick_policy=discard -no-hpet -no-shutdown -global PIIX4_PM.disable_s3=1 \
-global PIIX4_PM.disable_s4=1 -boot menu=off,strict=on -device \
                ich9-usb-ehci1,id=usb,bus=pci.0,addr=0x6.0x7
 -device ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x6 \
-device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x6.0x1 -device \
ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x6.0x2 -device \
                virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x5
 -drive file=/var/lib/libvirt/images/MyVM.qcow2,format=qcow2,if=none,id=drive-virtio-disk0 \
-device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x7,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 \
-netdev tap,fd=28,id=hostnet0,vhost=on,vhostfd=30 -device \
                virtio-net-pci,netdev=hostnet0,id=net0,mac=52:54:00:0e:2e:75,bus=pci.0,addr=0x3
                
 -chardev pty,id=charserial0 -device isa-serial,chardev=charserial0,id=serial0 \
-chardev socket,id=charchannel0,path=/var/lib/libvirt/qemu/channel/target/domain-1-MyVM/org.qemu.guest_agent.0,server,nowait \
-device virtserialport,bus=virtio-serial0.0,nr=1,chardev=charchannel0,id=channel0,name=org.qemu.guest_agent.0
                
 -chardev spicevmc,id=charchannel1,name=vdagent -device \
virtserialport,bus=virtio-serial0.0,nr=2,chardev=charchannel1,id=channel1,name=com.redhat.spice.0 \
-device usb-tablet,id=input0,bus=usb.0,port=1 -spice \
port=5900,tls-port=5901,addr=127.0.0.1,disable-ticketing,x509-dir=/etc/pki/vdsm/libvirt-spice,seamless-migration=on
                
 -device qxl-vga,id=video0,ram_size=67108864,vram_size=67108864,vram64_size_mb=0,vgamem_mb=16,bus=pci.0,addr=0x2 \
-device intel-hda,id=sound0,bus=pci.0,addr=0x4 -device \
hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -chardev \
                spicevmc,id=charredir0,name=usbredir
 -device usb-redir,chardev=charredir0,id=redir0,bus=usb.0,port=2 -chardev \
spicevmc,id=charredir1,name=usbredir -device \
usb-redir,chardev=charredir1,id=redir1,bus=usb.0,port=3 -device \
virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x8 -msg timestamp=on&lt;/div&gt; &lt;div&gt;char \
device redirected to /dev/pts/0 (label charserial0)&lt;/div&gt; &lt;div&gt;((null):3344): \
Spice-ERROR **: reds.c:4043:do_spice_init: statistics shm_open failed, Permission \
denied&lt;/div&gt; &lt;div&gt;2017-06-19 07:15:18.824+0000: shutting down&lt;/div&gt;
&lt;div&gt;&lt;br&gt;
&lt;/div&gt;
However, when I start the VM manually through virt-manager, it starts up fine.
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;p&gt;Why might it fail during boot-up?  And is there anything I can do to solve \
the problem?&lt;/p&gt; &lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;p&gt;Many thanks,&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;p&gt;Andy&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170620062659</emailId><senderName>"Travis S. Johnson"</senderName><senderEmail>johnsontravis21@gmail.com</senderEmail><timestampReceived>2017-06-20 06:26:59-0400</timestampReceived><subject>[libvirt-users] guest A from virbr0 can talk to guest B in virbr1 but not vice versa</subject><body>

Hello,

I came across an interesting problem in my home lab a few weeks ago as I'm
prepping for my RHCE exam using Michael Jang study guide. I've been at this
for days now, and I still can't wrap my head around how two or more virtual
networks in default NAT configuration are even allowed to communicate with
each other despite what the libvirt documentation said.


Here's the excerpt I'm referring to in the wiki link here:
http://wiki.libvirt.org/page/Networking#Forwarding_Incoming_Connections:

&gt; By default, guests that are connected via a virtual network with &lt;forward
&gt; mode='nat'/&gt; can make any outgoing network connection they like. Incoming
&gt; connections are allowed from the host, and from other guests connected to
&gt; the same libvirt network, but all other incoming connections are blocked by
&gt; iptables rules.


Also here's another assertion from 'The virtual network driver' section in
http://libvirt.org/firewall.html:

&gt; type=nat
&gt;
&gt; Allow inbound related to an established connection. Allow outbound, but
&gt; only from our expected subnet. Allow traffic between guests. Deny all other
&gt; inbound. Deny all other outbound.



I have three virtual networks with the following configs:
-----------------------------------------------------------------------------
&lt;network connections='1'&gt;
  &lt;name&gt;default&lt;/name&gt;
  &lt;uuid&gt;9c6796be-d54e-42bc-bcbe-2e4feee7154a&lt;/uuid&gt;
  &lt;forward mode='nat'&gt;
    &lt;nat&gt;
      &lt;port start='1024' end='65535'/&gt;
    &lt;/nat&gt;
  &lt;/forward&gt;
  &lt;bridge name='virbr0' stp='on' delay='0'/&gt;
  &lt;mac address='52:54:00:5a:5d:0e'/&gt;
  &lt;ip address='192.168.122.1' netmask='255.255.255.0'&gt;
    &lt;dhcp&gt;
      &lt;range start='192.168.122.2' end='192.168.122.254'/&gt;
    &lt;/dhcp&gt;
  &lt;/ip&gt;
&lt;/network&gt;

&lt;network connections='1'&gt;
  &lt;name&gt;outsider&lt;/name&gt;
  &lt;uuid&gt;247e380a-8795-466a-b94a-5be2d05267bb&lt;/uuid&gt;
  &lt;forward mode='nat'&gt;
    &lt;nat&gt;
      &lt;port start='1024' end='65535'/&gt;
    &lt;/nat&gt;
  &lt;/forward&gt;
  &lt;bridge name='virbr1' stp='on' delay='0'/&gt;
  &lt;mac address='52:54:00:7f:a1:fb'/&gt;
  &lt;domain name='outsider'/&gt;
  &lt;ip address='192.168.100.1' netmask='255.255.255.0'&gt;
    &lt;dhcp&gt;
      &lt;range start='192.168.100.2' end='192.168.100.254'/&gt;
    &lt;/dhcp&gt;
  &lt;/ip&gt;
&lt;/network&gt;

&lt;network connections='1'&gt;
  &lt;name&gt;besider&lt;/name&gt;
  &lt;uuid&gt;cc714cce-dbba-452d-b2bf-d36084dcb723&lt;/uuid&gt;
  &lt;forward mode='nat'&gt;
    &lt;nat&gt;
      &lt;port start='1024' end='65535'/&gt;
    &lt;/nat&gt;
  &lt;/forward&gt;
  &lt;bridge name='virbr2' stp='on' delay='0'/&gt;
  &lt;mac address='52:54:00:59:67:7f'/&gt;
  &lt;domain name='besider'/&gt;
  &lt;ip address='192.168.110.1' netmask='255.255.255.0'&gt;
    &lt;dhcp&gt;
      &lt;range start='192.168.110.2' end='192.168.110.254'/&gt;
    &lt;/dhcp&gt;
  &lt;/ip&gt;
&lt;/network&gt;
----------------------------------------------------------------------------


Here is the output of the 'FORWARD' iptables chain rules on my host (still
using firewall-cmd):
------------------------------------------------------------------------
Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source
destination
 8967   14M ACCEPT     all  --  *      virbr2  0.0.0.0/0
192.168.110.0/24     ctstate RELATED,ESTABLISHED
 5262  279K ACCEPT     all  --  virbr2 *       192.168.110.0/24
0.0.0.0/0
    0     0 ACCEPT     all  --  virbr2 virbr2  0.0.0.0/0
0.0.0.0/0
   70  5832 REJECT     all  --  *      virbr2  0.0.0.0/0
0.0.0.0/0            reject-with icmp-port-unreachable
    0     0 REJECT     all  --  virbr2 *       0.0.0.0/0
0.0.0.0/0            reject-with icmp-port-unreachable
 8510   13M ACCEPT     all  --  *      virbr0  0.0.0.0/0
192.168.122.0/24     ctstate RELATED,ESTABLISHED
 5177  275K ACCEPT     all  --  virbr0 *       192.168.122.0/24
0.0.0.0/0
    0     0 ACCEPT     all  --  virbr0 virbr0  0.0.0.0/0
0.0.0.0/0
   61  5100 REJECT     all  --  *      virbr0  0.0.0.0/0
0.0.0.0/0            reject-with icmp-port-unreachable
    0     0 REJECT     all  --  virbr0 *       0.0.0.0/0
0.0.0.0/0            reject-with icmp-port-unreachable
 8612   13M ACCEPT     all  --  *      virbr1  0.0.0.0/0
192.168.100.0/24     ctstate RELATED,ESTABLISHED
 5172  273K ACCEPT     all  --  virbr1 *       192.168.100.0/24
0.0.0.0/0
    0     0 ACCEPT     all  --  virbr1 virbr1  0.0.0.0/0
0.0.0.0/0
    0     0 REJECT     all  --  *      virbr1  0.0.0.0/0
0.0.0.0/0            reject-with icmp-port-unreachable
    0     0 REJECT     all  --  virbr1 *       0.0.0.0/0
0.0.0.0/0            reject-with icmp-port-unreachable
    0     0 ACCEPT     all  --  *      *       0.0.0.0/0
0.0.0.0/0            ctstate RELATED,ESTABLISHED
    0     0 ACCEPT     all  --  lo     *       0.0.0.0/0
0.0.0.0/0
    0     0 FORWARD_direct  all  --  *      *       0.0.0.0/0
0.0.0.0/0
    0     0 FORWARD_IN_ZONES_SOURCE  all  --  *      *       0.0.0.0/0
       0.0.0.0/0
    0     0 FORWARD_IN_ZONES  all  --  *      *       0.0.0.0/0
0.0.0.0/0
    0     0 FORWARD_OUT_ZONES_SOURCE  all  --  *      *       0.0.0.0/0
       0.0.0.0/0
    0     0 FORWARD_OUT_ZONES  all  --  *      *       0.0.0.0/0
0.0.0.0/0
    0     0 DROP       all  --  *      *       0.0.0.0/0
0.0.0.0/0            ctstate INVALID
    0     0 REJECT     all  --  *      *       0.0.0.0/0
0.0.0.0/0            reject-with icmp-host-prohibited
--------------------------------------------------------------------------

I have a VM in each network:
nest1.example.com (virbr0) - 192.168.122.50
nest2.example.org (virbr1) - 192.168.100.100
nest3.example.net (virbr2) - 192.168.110.25

I'm quite aware the above iptables rules were added by libvirt, but I'm
still managing the firewall primarily through the *firewall-cmd* command.

&gt;From what I gathered...
----------------------------------------------------------
nest3 can ping nest1 and nest2.

Nest3 ping nest1 and made a hit here:
 8967   14M ACCEPT     all  --  *      virbr2  0.0.0.0/0
192.168.110.0/24     ctstate RELATED,ESTABLISHED
 5262  279K ACCEPT     all  --  virbr2 *       192.168.110.0/24
0.0.0.0/0

Nest3 ping nest2 and made a hit here:
 8967   14M ACCEPT     all  --  *      virbr2  0.0.0.0/0
192.168.110.0/24     ctstate RELATED,ESTABLISHED
 5262  279K ACCEPT     all  --  virbr2 *       192.168.110.0/24
0.0.0.0/0
----------------------------------------------------------


----------------------------------------------------------
Nest1 can ping nest2, but cannot ping nest3.

Nest1 ping nest2 and made a hit here:
8510   13M ACCEPT     all  --  *      virbr0  0.0.0.0/0
192.168.122.0/24     ctstate RELATED,ESTABLISHED
 5177  275K ACCEPT     all  --  virbr0 *       192.168.122.0/24
0.0.0.0/0

Nest1 ping nest3 and made a hit here:
   70  5832 REJECT     all  --  *      virbr2  0.0.0.0/0
0.0.0.0/0            reject-with icmp-port-unreachable
----------------------------------------------------------


----------------------------------------------------------
Nest2 cannot ping nest1 and nest3.

Nest2 ping nest1 and made a hit here:
   61  5100 REJECT     all  --  *      virbr0  0.0.0.0/0
0.0.0.0/0            reject-with icmp-port-unreachable

Nest2 ping test3 and made a hit here:
   70  5832 REJECT     all  --  *      virbr2  0.0.0.0/0
0.0.0.0/0            reject-with icmp-port-unreachable
----------------------------------------------------------


&gt;From my observation, I see that the order of the virtual networks in the
iptables FORWARD chain makes a difference. Each chunk associated with the
virtual network in the chain, consisting of five lines, is exactly as
described in the aforementioned link (http://libvirt.org/firewall.html).
The virtual network in the top chunk of the chain can communicate with
virtually all networks as opposed to the network in the last chunk that is
consistent with the intention of the original design.

I'm using CentOS 7.3 with libvirt 2.0. I even tried reproducing this with
CentOS 6.9 as I thought it was possible the firewalld may have influenced
the change, but I was still getting similar result.

Right now, I'm not certain if this is already a reported known bug, but I'm
highly convinced this configuration is unofficially unsupported for quite a
while. Can someone confirm this? This is my very first mailing list
submission ever, and I apologize in advance if I couldn't figure out how to
conveniently search up a similar discussion as this one in the archive. If
this is in fact near impossible to implement in accordance to the intended
design, then I'd like to have this confirmation publicly included in the
docs.

Thanks,

Travis Johnson

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hello,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I came across an interesting problem in my \
home lab a few weeks ago as I'm prepping for my RHCE exam using Michael Jang \
study guide. I've been at this for days now, and I still can't wrap my head \
around how two or more virtual networks in default NAT configuration are even allowed \
to communicate with each other despite what the libvirt documentation \
said.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Here's the excerpt I'm \
referring to in the wiki link here:  &lt;a \
href="http://wiki.libvirt.org/page/Networking#Forwarding_Incoming_Connections"&gt;http:// \
wiki.libvirt.org/page/Networking#Forwarding_Incoming_Connections&lt;/a&gt;:&lt;/div&gt;&lt;blockquote \
class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt;&lt;span \
style="color:rgb(0,0,0);font-family:LibvirtOverpass"&gt;By default, guests that are \
connected via a virtual network with &lt;forward mode='nat'/&gt; can make any \
outgoing network connection they like. Incoming connections are allowed from the \
host, and from other guests connected to the same libvirt network, but all other \
incoming connections are blocked by iptables \
rules.&lt;/span&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also here's another assertion from \
'The virtual network driver' section in  &lt;a \
href="http://libvirt.org/firewall.html"&gt;http://libvirt.org/firewall.html&lt;/a&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt;&lt;span \
style="color:rgb(0,0,0);font-family:LibvirtOverpass"&gt;type=nat  &lt;/span&gt;&lt;br \
style="color:rgb(0,0,0);font-family:LibvirtOverpass"&gt;&lt;br \
style="color:rgb(0,0,0);font-family:LibvirtOverpass"&gt;&lt;span \
style="color:rgb(0,0,0);font-family:LibvirtOverpass"&gt;Allow inbound related to an \
established connection. Allow outbound, but only from our expected subnet. Allow \
traffic between guests. Deny all other inbound. Deny all other \
outbound.&lt;/span&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I have three \
virtual networks with the following \
configs:&lt;br&gt;-----------------------------------------------------------------------------&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;&lt;network \
connections='1'&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;   \
&lt;name&gt;default&lt;/name&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;  \
&lt;uuid&gt;9c6796be-d54e-42bc-bcbe-2e4feee7154a&lt;/uuid&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;   &lt;forward \
mode='nat'&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;      \
&lt;nat&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;         &lt;port \
start='1024' end='65535'/&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, \
monospace"&gt;      &lt;/nat&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;   \
&lt;/forward&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;   &lt;bridge \
name='virbr0' stp='on' delay='0'/&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;   &lt;mac \
address='52:54:00:5a:5d:0e'/&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, \
monospace"&gt;   &lt;ip address='192.168.122.1' \
netmask='255.255.255.0'&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, \
monospace"&gt;      &lt;dhcp&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;     \
&lt;range start='192.168.122.2' \
end='192.168.122.254'/&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, \
monospace"&gt;      &lt;/dhcp&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;   \
&lt;/ip&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, \
monospace"&gt;&lt;/network&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, \
monospace"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;&lt;network \
connections='1'&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;   \
&lt;name&gt;outsider&lt;/name&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt; \
&lt;uuid&gt;247e380a-8795-466a-b94a-5be2d05267bb&lt;/uuid&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;   &lt;forward \
mode='nat'&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;      \
&lt;nat&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;         &lt;port \
start='1024' end='65535'/&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, \
monospace"&gt;      &lt;/nat&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;   \
&lt;/forward&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;   &lt;bridge \
name='virbr1' stp='on' delay='0'/&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;   &lt;mac \
address='52:54:00:7f:a1:fb'/&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, \
monospace"&gt;   &lt;domain name='outsider'/&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;   &lt;ip address='192.168.100.1' \
netmask='255.255.255.0'&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, \
monospace"&gt;      &lt;dhcp&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;     \
&lt;range start='192.168.100.2' \
end='192.168.100.254'/&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, \
monospace"&gt;      &lt;/dhcp&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;   \
&lt;/ip&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, \
monospace"&gt;&lt;/network&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, \
monospace"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;&lt;network \
connections='1'&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;   \
&lt;name&gt;besider&lt;/name&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;  \
&lt;uuid&gt;cc714cce-dbba-452d-b2bf-d36084dcb723&lt;/uuid&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;   &lt;forward \
mode='nat'&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;      \
&lt;nat&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;         &lt;port \
start='1024' end='65535'/&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, \
monospace"&gt;      &lt;/nat&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;   \
&lt;/forward&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;   &lt;bridge \
name='virbr2' stp='on' delay='0'/&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;   &lt;mac \
address='52:54:00:59:67:7f'/&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, \
monospace"&gt;   &lt;domain name='besider'/&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;   &lt;ip address='192.168.110.1' \
netmask='255.255.255.0'&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, \
monospace"&gt;      &lt;dhcp&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;     \
&lt;range start='192.168.110.2' \
end='192.168.110.254'/&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, \
monospace"&gt;      &lt;/dhcp&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;   \
&lt;/ip&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, \
monospace"&gt;&lt;/network&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;----------------------------------- \
-----------------------------------------&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Here \
is the output of the 'FORWARD' iptables chain rules on my host (still using \
firewall-cmd):&lt;/div&gt;&lt;div&gt;------------------------------------------------------------------------&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;Chain FORWARD (policy ACCEPT 0 packets, 0 \
bytes)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;  pkts bytes target       \
prot opt in       out       source                      destination              \
&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;  8967    14M ACCEPT       all   \
--   *         virbr2   &lt;a href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  &lt;a \
href="http://192.168.110.0/24"&gt;192.168.110.0/24&lt;/a&gt;       ctstate \
RELATED,ESTABLISHED&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;  5262   279K \
ACCEPT       all   --   virbr2 *          &lt;a \
href="http://192.168.110.0/24"&gt;192.168.110.0/24&lt;/a&gt;       &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                 &lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;      0       0 ACCEPT       all   --   virbr2 virbr2   \
&lt;a href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                 &lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;     70   5832 REJECT       all   --   *         virbr2   \
&lt;a href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  reject-with \
icmp-port-unreachable&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;      0      \
0 REJECT       all   --   virbr2 *          &lt;a href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;  \
&lt;a href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  reject-with \
icmp-port-unreachable&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;  8510    \
13M ACCEPT       all   --   *         virbr0   &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  &lt;a \
href="http://192.168.122.0/24"&gt;192.168.122.0/24&lt;/a&gt;       ctstate \
RELATED,ESTABLISHED&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;  5177   275K \
ACCEPT       all   --   virbr0 *          &lt;a \
href="http://192.168.122.0/24"&gt;192.168.122.0/24&lt;/a&gt;       &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                 &lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;      0       0 ACCEPT       all   --   virbr0 virbr0   \
&lt;a href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                 &lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;     61   5100 REJECT       all   --   *         virbr0   \
&lt;a href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  reject-with \
icmp-port-unreachable&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;      0      \
0 REJECT       all   --   virbr0 *          &lt;a href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;  \
&lt;a href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  reject-with \
icmp-port-unreachable&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;  8612    \
13M ACCEPT       all   --   *         virbr1   &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  &lt;a \
href="http://192.168.100.0/24"&gt;192.168.100.0/24&lt;/a&gt;       ctstate \
RELATED,ESTABLISHED&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;  5172   273K \
ACCEPT       all   --   virbr1 *          &lt;a \
href="http://192.168.100.0/24"&gt;192.168.100.0/24&lt;/a&gt;       &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                 &lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;      0       0 ACCEPT       all   --   virbr1 virbr1   \
&lt;a href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                 &lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;      0       0 REJECT       all   --   *         virbr1  \
&lt;a href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  reject-with \
icmp-port-unreachable&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;      0      \
0 REJECT       all   --   virbr1 *          &lt;a href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;  \
&lt;a href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  reject-with \
icmp-port-unreachable&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;      0      \
0 ACCEPT       all   --   *         *          &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  ctstate \
RELATED,ESTABLISHED&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;      0       \
0 ACCEPT       all   --   lo       *          &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                 &lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;      0       0 FORWARD_direct   all   --   *         *   \
&lt;a href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                 &lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;      0       0 FORWARD_IN_ZONES_SOURCE   all   --   *    \
*          &lt;a href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                 &lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;      0       0 FORWARD_IN_ZONES   all   --   *         * \
&lt;a href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                 &lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;      0       0 FORWARD_OUT_ZONES_SOURCE   all   --   *   \
*          &lt;a href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                 &lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;      0       0 FORWARD_OUT_ZONES   all   --   *         \
*          &lt;a href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                 &lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="monospace, monospace"&gt;      0       0 DROP          all   --   *         *      \
&lt;a href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  ctstate \
INVALID&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;      0       0 REJECT     \
all   --   *         *          &lt;a href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;              \
&lt;a href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  reject-with \
icmp-host-prohibited&lt;/font&gt;&lt;/div&gt;--------------------------------------------------------------------------&lt;br&gt;&lt;br&gt;I \
have a VM in each network:&lt;/div&gt;&lt;div&gt;&lt;a \
href="http://nest1.example.com"&gt;nest1.example.com&lt;/a&gt; (virbr0) - \
192.168.122.50&lt;/div&gt;&lt;div&gt;&lt;a href="http://nest2.example.org"&gt;nest2.example.org&lt;/a&gt; \
(virbr1) - 192.168.100.100&lt;/div&gt;&lt;div&gt;&lt;a \
href="http://nest3.example.net"&gt;nest3.example.net&lt;/a&gt; (virbr2) - \
192.168.110.25&lt;br&gt;&lt;br&gt;I'm quite aware the above iptables rules were added by \
libvirt, but I'm still managing the firewall primarily through the \
&lt;b&gt;firewall-cmd&lt;/b&gt; command. &lt;br&gt;&lt;br&gt;From what I \
gathered...&lt;/div&gt;&lt;div&gt;&lt;div&gt;----------------------------------------------------------&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;nest3 \
can ping nest1 and nest2.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;Nest3 ping nest1 and made \
a hit here:&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;  8967  \
14M ACCEPT       all   --   *         virbr2   &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                  &lt;a \
href="http://192.168.110.0/24"&gt;192.168.110.0/24&lt;/a&gt;       ctstate \
RELATED,ESTABLISHED&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="monospace, monospace"&gt;  5262   279K \
ACCEPT       all   --   virbr2 *          &lt;a \
href="http://192.168.110.0/24"&gt;192.168.110.0/24&lt;/a&gt;       &lt;a \
href="http://0.0.0.0/0"&gt;0.0.0.0/0&lt;/a&gt;                 \
&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Nest3 ping nest2 and made a hit \
here:&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font face="monospace, \
monospace"&gt;  8967    14M ACCEPT       all   --   *         virbr2   &lt;a \



</body></email><email><emailId>20170612032108</emailId><senderName>马金舟</senderName><senderEmail>majinzhou007@gmail.com</senderEmail><timestampReceived>2017-06-12 03:21:08-0400</timestampReceived><subject>[libvirt-users] About libvirt concurrency</subject><body>

hi all:
    hello. I would like to ask a question about concurrency. Whether
libvirt can achieve at the same time open 200 virtual machines.
    I try to open 200 virtual machines at the same time. oh on. when i am
connected one of the virtual machines, i waited for a long time. I guess
libvirt can't achieve concurrent operaction. I wish I could get a real
result as soon as possible. thank you.

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;hi all:&lt;div&gt;      hello. I would like to ask a question about \
concurrency. Whether libvirt can achieve at the same time open 200 virtual \
machines.&lt;/div&gt;&lt;div&gt;      I try to open 200 virtual machines at the same time. oh on. \
when i am connected one of the virtual machines, i waited for a long time. I guess \
libvirt can't achieve concurrent operaction. I wish I could get a real result as \
soon as possible.&lt;span style="color:rgb(0,0,0);font-family:"Microsoft \
YaHei",Arial,Helvetica,sans-serif;font-size:14px"&gt;  &lt;/span&gt;thank you.  \
&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170622150241</emailId><senderName>Doug Hughes</senderName><senderEmail>doug.hughes@keystonenap.com</senderEmail><timestampReceived>2017-06-22 15:02:41-0400</timestampReceived><subject>[libvirt-users] recovering from deleted snapshot</subject><body>


I have an automatic process setup. It's still pretty new and obviously
in need of better error handling because now I find myself in a bad state.

I run snapshot-create-as across all my vms, then do zfs replication to
the target backup system, then blockcommit everything.

virsh snapshot-create-as --domain $vm snap --diskspec
$DISK,file=$VMPREFIX/"$vm"-snap.qcow2 --disk-only --atomic --no-metadata
--quiesce

...

 virsh blockcommit $vm $DISK --active --pivot

Normally this works fine, though something went wrong on the 20th.
something happened to make the blockcommit fail, but the -snap file got
deleted (note to self - check return code from blockcommit command!)

So now I'm in a state. The domain i still running. but it's running off
the -snapshot that is in the xml. I googled around for how to recover a
blockcommit from a deleted snapshot, but didn't find anything. (pointers
welcome)

[root@vm1 images]# virsh domblklist serv1r2
Target     Source
------------------------------------------------
vda        /var/lib/libvirt/images/serv1r2-snap.qcow2
fda        -
hdb        /var/lib/libvirt/images/virtio-win-0.1.126.iso

I can see the size increasing on the deleted file in lsof:

qemu-kvm  48994 49033    qemu   97u      REG               0,44    
1855913984       1078 /var/lib/libvirt/images/serv1r2-snap.qcow2 (deleted)
...

qemu-kvm  48994 49033    qemu   97u      REG               0,44    
1856110592       1078 /var/lib/libvirt/images/serv1r2-snap.qcow2 (deleted)

--

so, do I need to rollback the zfs snapshot image or is there some other
way to recover from this snafu?

Thanks.





</body></email><email><emailId>20170630100547</emailId><senderName>Peter Krempa</senderName><senderEmail>pkrempa@redhat.com</senderEmail><timestampReceived>2017-06-30 10:05:47-0400</timestampReceived><subject>Re: [libvirt-users] recovering from deleted snapshot</subject><body>


On Thu, Jun 22, 2017 at 11:02:41 -0400, Doug Hughes wrote:

[...]

&gt;  virsh blockcommit $vm $DISK --active --pivot
&gt; 
&gt; Normally this works fine, though something went wrong on the 20th.
&gt; something happened to make the blockcommit fail, but the -snap file got
&gt; deleted (note to self - check return code from blockcommit command!)
&gt; 
&gt; So now I'm in a state. The domain i still running. but it's running off
&gt; the -snapshot that is in the xml. I googled around for how to recover a
&gt; blockcommit from a deleted snapshot, but didn't find anything. (pointers
&gt; welcome)

While it's still running you are lucky as the kernel did not delete the
file until you shutdown the qemu process.

There are these options:

1) if you don't care about the snapshot hierarchy, but want to save the
full disk contents of the VM, you can use the block copy operation and
copy everything into a new image.

2) If you removed the top level image (which it seems) you can even use
shallow block copy, if you pre-create the new file properly. Then you
can even keep the top layer properly.

3) If it's any other than top layer, with a new-enugh qemu and some QMP
command magic, any layer can be restored, but that will require some
work.

Please let me know which option do you want to do and I can guide you
further.

Please just don't turn off the VM :)


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170630102249</emailId><senderName>Peter Krempa</senderName><senderEmail>pkrempa@redhat.com</senderEmail><timestampReceived>2017-06-30 10:22:49-0400</timestampReceived><subject>Re: [libvirt-users] recovering from deleted snapshot</subject><body>


On Fri, Jun 30, 2017 at 12:05:47 +0200, Peter Krempa wrote:
&gt; On Thu, Jun 22, 2017 at 11:02:41 -0400, Doug Hughes wrote:
&gt; 
&gt; [...]
&gt; 
&gt; &gt;  virsh blockcommit $vm $DISK --active --pivot
&gt; &gt; 
&gt; &gt; Normally this works fine, though something went wrong on the 20th.
&gt; &gt; something happened to make the blockcommit fail, but the -snap file got
&gt; &gt; deleted (note to self - check return code from blockcommit command!)
&gt; &gt; 
&gt; &gt; So now I'm in a state. The domain i still running. but it's running off
&gt; &gt; the -snapshot that is in the xml. I googled around for how to recover a
&gt; &gt; blockcommit from a deleted snapshot, but didn't find anything. (pointers
&gt; &gt; welcome)

In fact, it's way simpler. If libvirt still knows about the overlay
image (this is necessary only so that it can say the proper things to
qemu) you can re-do the block commit:

$ virsh list
 Id    Name                           State
----------------------------------------------------
 3     fedora23                       running

$ virsh snapshot-create-as --disk-only --no-metadata fedora23
Domain snapshot 1498817916 created
$ virsh domblklist fedora23
Target     Source
------------------------------------------------
vda        /var/lib/libvirt/images/fedora23.1498817916
hda        -

$ rm /var/lib/libvirt/images/fedora23.1498817916
$ ls /var/lib/libvirt/images/fedora23.1498817916
ls: cannot access '/var/lib/libvirt/images/fedora23.1498817916': No such file or directory
$ virsh blockcommit --active --pivot fedora23 vda

Successfully pivoted
$ virsh domblklist fedora23
Target     Source
------------------------------------------------
vda        /var/lib/libvirt/images/fedora23.qcow2
hda        -


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170630132329</emailId><senderName>Doug Hughes</senderName><senderEmail>doug.hughes@keystonenap.com</senderEmail><timestampReceived>2017-06-30 13:23:29-0400</timestampReceived><subject>Re: [libvirt-users] recovering from deleted snapshot</subject><body>

On Jun 30, 2017 6:22 AM, "Peter Krempa" &lt;pkrempa@redhat.com&gt; wrote:

&gt;

&gt; On Fri, Jun 30, 2017 at 12:05:47 +0200, Peter Krempa wrote:
&gt; &gt; On Thu, Jun 22, 2017 at 11:02:41 -0400, Doug Hughes wrote:
&gt; &gt;
&gt; &gt; [...]
&gt; &gt;
&gt; &gt; &gt;  virsh blockcommit $vm $DISK --active --pivot
&gt; &gt; &gt;
&gt; &gt; &gt; Normally this works fine, though something went wrong on the 20th.
&gt; &gt; &gt; something happened to make the blockcommit fail, but the -snap file
got
&gt; &gt; &gt; deleted (note to self - check return code from blockcommit command!)
&gt; &gt; &gt;
&gt; &gt; &gt; So now I'm in a state. The domain i still running. but it's running
off
&gt; &gt; &gt; the -snapshot that is in the xml. I googled around for how to recover
a
&gt; &gt; &gt; blockcommit from a deleted snapshot, but didn't find anything.
(pointers
&gt; &gt; &gt; welcome)
&gt;
&gt; In fact, it's way simpler. If libvirt still knows about the overlay
&gt; image (this is necessary only so that it can say the proper things to
&gt; qemu) you can re-do the block commit:
&gt;
&gt; $ virsh list
&gt;  Id    Name                           State
&gt; ----------------------------------------------------
&gt;  3     fedora23                       running
&gt;
&gt; $ virsh snapshot-create-as --disk-only --no-metadata fedora23
&gt; Domain snapshot 1498817916 created
&gt; $ virsh domblklist fedora23
&gt; Target     Source
&gt; ------------------------------------------------
&gt; vda        /var/lib/libvirt/images/fedora23.1498817916
&gt; hda        -
&gt;
&gt; $ rm /var/lib/libvirt/images/fedora23.1498817916
&gt; $ ls /var/lib/libvirt/images/fedora23.1498817916
&gt; ls: cannot access '/var/lib/libvirt/images/fedora23.1498817916': No such
file or directory
&gt; $ virsh blockcommit --active --pivot fedora23 vda
&gt;
&gt; Successfully pivoted
&gt; $ virsh domblklist fedora23
&gt; Target     Source
&gt; ------------------------------------------------
&gt; vda        /var/lib/libvirt/images/fedora23.qcow2
&gt; hda        -
&gt;

Thanks for the reply! The original image is still there. Only the 1st and
only top-level snapshot is deleted.
the blockcommit fails though:
[root@vm1 ~]# virsh blockcommit serv1r2 vda --active --pivot
error: block copy still active: disk 'vda' already in active block job

[Attachment #3 (text/html)]

&lt;p dir="ltr"&gt;&lt;/p&gt;
&lt;p dir="ltr"&gt;On Jun 30, 2017 6:22 AM, "Peter Krempa" &lt;&lt;a \
href="mailto:pkrempa@redhat.com"&gt;pkrempa@redhat.com&lt;/a&gt;&gt; wrote:&lt;br&gt; &lt;/p&gt;
&lt;blockquote&gt;&lt;p dir="ltr"&gt;&gt;&lt;br&gt;
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p dir="ltr"&gt;&gt; On Fri, Jun 30, 2017 at 12:05:47 +0200, Peter Krempa wrote:&lt;br&gt;
&gt; &gt; On Thu, Jun 22, 2017 at 11:02:41 -0400, Doug Hughes wrote:&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; [...]&lt;br&gt;
&gt; &gt;&lt;br&gt;
&gt; &gt; &gt;   virsh blockcommit $vm $DISK --active --pivot&lt;br&gt;
&gt; &gt; &gt;&lt;br&gt;
&gt; &gt; &gt; Normally this works fine, though something went wrong on the 20th.&lt;br&gt;
&gt; &gt; &gt; something happened to make the blockcommit fail, but the -snap file \
got&lt;br&gt; &gt; &gt; &gt; deleted (note to self - check return code from blockcommit \
command!)&lt;br&gt; &gt; &gt; &gt;&lt;br&gt;
&gt; &gt; &gt; So now I'm in a state. The domain i still running. but it's \
running off&lt;br&gt; &gt; &gt; &gt; the -snapshot that is in the xml. I googled around for \
how to recover a&lt;br&gt; &gt; &gt; &gt; blockcommit from a deleted snapshot, but \
didn't find anything. (pointers&lt;br&gt; &gt; &gt; &gt; welcome)&lt;br&gt;
&gt;&lt;br&gt;
&gt; In fact, it's way simpler. If libvirt still knows about the overlay&lt;br&gt;
&gt; image (this is necessary only so that it can say the proper things to&lt;br&gt;
&gt; qemu) you can re-do the block commit:&lt;br&gt;
&gt;&lt;br&gt;
&gt; $ virsh list&lt;br&gt;
&gt;   Id      Name                                         State&lt;br&gt;
&gt; ----------------------------------------------------&lt;br&gt;
&gt;   3        fedora23                                   running&lt;br&gt;
&gt;&lt;br&gt;
&gt; $ virsh snapshot-create-as --disk-only --no-metadata fedora23&lt;br&gt;
&gt; Domain snapshot 1498817916 created&lt;br&gt;
&gt; $ virsh domblklist fedora23&lt;br&gt;
&gt; Target        Source&lt;br&gt;
&gt; ------------------------------------------------&lt;br&gt;
&gt; vda            /var/lib/libvirt/images/fedora23.1498817916&lt;br&gt;
&gt; hda            -&lt;br&gt;
&gt;&lt;br&gt;
&gt; $ rm /var/lib/libvirt/images/fedora23.1498817916&lt;br&gt;
&gt; $ ls /var/lib/libvirt/images/fedora23.1498817916&lt;br&gt;
&gt; ls: cannot access '/var/lib/libvirt/images/fedora23.1498817916': No such \
file or directory&lt;br&gt; &gt; $ virsh blockcommit --active --pivot fedora23 vda&lt;br&gt;
&gt;&lt;br&gt;
&gt; Successfully pivoted&lt;br&gt;
&gt; $ virsh domblklist fedora23&lt;br&gt;
&gt; Target        Source&lt;br&gt;
&gt; ------------------------------------------------&lt;br&gt;
&gt; vda            /var/lib/libvirt/images/fedora23.qcow2&lt;br&gt;
&gt; hda            -&lt;br&gt;
&gt;&lt;/p&gt;
&lt;p dir="ltr"&gt;Thanks for the reply! The original image is still there. Only the 1st \
and only top-level snapshot is deleted.&lt;br&gt; the blockcommit fails though:&lt;br&gt;
[root@vm1 ~]# virsh blockcommit serv1r2 vda --active --pivot&lt;br&gt;
error: block copy still active: disk 'vda' already in active block job&lt;br&gt;
&lt;/p&gt;



</body></email><email><emailId>20170630133838</emailId><senderName>Peter Krempa</senderName><senderEmail>pkrempa@redhat.com</senderEmail><timestampReceived>2017-06-30 13:38:38-0400</timestampReceived><subject>Re: [libvirt-users] recovering from deleted snapshot</subject><body>


On Fri, Jun 30, 2017 at 09:23:29 -0400, Doug Hughes wrote:
&gt; On Jun 30, 2017 6:22 AM, "Peter Krempa" &lt;pkrempa@redhat.com&gt; wrote:
&gt; &gt; On Fri, Jun 30, 2017 at 12:05:47 +0200, Peter Krempa wrote:
&gt; &gt; &gt; On Thu, Jun 22, 2017 at 11:02:41 -0400, Doug Hughes wrote:

[...]

&gt; file or directory
&gt; &gt; $ virsh blockcommit --active --pivot fedora23 vda
&gt; &gt;
&gt; &gt; Successfully pivoted
&gt; &gt; $ virsh domblklist fedora23
&gt; &gt; Target     Source
&gt; &gt; ------------------------------------------------
&gt; &gt; vda        /var/lib/libvirt/images/fedora23.qcow2
&gt; &gt; hda        -
&gt; &gt;
&gt;=20
&gt; Thanks for the reply! The original image is still there. Only the 1st and
&gt; only top-level snapshot is deleted.
&gt; the blockcommit fails though:
&gt; [root@vm1 ~]# virsh blockcommit serv1r2 vda --active --pivot
&gt; error: block copy still active: disk 'vda' already in active block job

What does 'virsh blockjob serv1r2 vda' report?

If it's something like this:

$ virsh blockjob fedora23 vda
Active Block Commit: [100 %]

Then you just need to finalize the block job by:

virsh blockjob --pivot serv1r2 vda

If that's not the case, please post what virsh blockjob is reporting and
the &lt;disk&gt; part of the XML.

In case where libvirt falsely thinks that the job did not finish I'll
guide you how to recover it, since restarting libvirtd would make
libvirt clear the block job busy flag, but libvirt would lose the
metadata.

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170630144125</emailId><senderName></senderName><senderEmail>doug.hughes</senderEmail><timestampReceived>2017-06-30 14:41:25-0400</timestampReceived><subject>Re: [libvirt-users] recovering from deleted snapshot</subject><body>

[Attachment #2 (text/plain)]

sorry about top post, tablet mail client...

brilliant! that did it! Any idea what happened to cause it to partially fail and get into this state?

oot@vm1 ~]# virsh blockjob serv1r2 vda
Active Block Commit: [100 %]

[root@vm1 ~]# virsh blockjob --pivot serv1r2 vda

[root@vm1 ~]# 
[root@vm1 ~]# ls -l /var/lib/libvirt/images/serv1r2.qcow2 
-rw-r--r--. 1 qemu qemu 54200696832 Jun 30 10:39 /var/lib/libvirt/images/serv1r2.qcow2
[root@vm1 ~]# date
Fri Jun 30 10:39:12 EDT 2017
[root@vm1 ~]# date
Fri Jun 30 10:39:51 EDT 2017
[root@vm1 ~]# ls -l /var/lib/libvirt/images/serv1r2.qcow2 
-rw-r--r--. 1 qemu qemu 54200696832 Jun 30 10:40 /var/lib/libvirt/images/serv1r2.qcow2
[root@vm1 ~]# 

Sent from my android device.

-----Original Message-----
From: Peter Krempa &lt;pkrempa@redhat.com&gt;
To: Doug Hughes &lt;doug.hughes@keystonenap.com&gt;
Cc: libvirt-users@redhat.com
Sent: Fri, 30 Jun 2017 9:38
Subject: Re: [libvirt-users] recovering from deleted snapshot

On Fri, Jun 30, 2017 at 09:23:29 -0400, Doug Hughes wrote:
&gt; On Jun 30, 2017 6:22 AM, "Peter Krempa" &lt;pkrempa@redhat.com&gt; wrote:
&gt; &gt; On Fri, Jun 30, 2017 at 12:05:47 +0200, Peter Krempa wrote:
&gt; &gt; &gt; On Thu, Jun 22, 2017 at 11:02:41 -0400, Doug Hughes wrote:

[...]

&gt; file or directory
&gt; &gt; $ virsh blockcommit --active --pivot fedora23 vda
&gt; &gt;
&gt; &gt; Successfully pivoted
&gt; &gt; $ virsh domblklist fedora23
&gt; &gt; Target     Source
&gt; &gt; ------------------------------------------------
&gt; &gt; vda        /var/lib/libvirt/images/fedora23.qcow2
&gt; &gt; hda        -
&gt; &gt;
&gt; 
&gt; Thanks for the reply! The original image is still there. Only the 1st and
&gt; only top-level snapshot is deleted.
&gt; the blockcommit fails though:
&gt; [root@vm1 ~]# virsh blockcommit serv1r2 vda --active --pivot
&gt; error: block copy still active: disk 'vda' already in active block job

What does 'virsh blockjob serv1r2 vda' report?

If it's something like this:

$ virsh blockjob fedora23 vda
Active Block Commit: [100 %]

Then you just need to finalize the block job by:

virsh blockjob --pivot serv1r2 vda

If that's not the case, please post what virsh blockjob is reporting and
the &lt;disk&gt; part of the XML.

In case where libvirt falsely thinks that the job did not finish I'll
guide you how to recover it, since restarting libvirtd would make
libvirt clear the block job busy flag, but libvirt would lose the
metadata.

[Attachment #3 (text/html)]

&lt;div&gt;sorry about top post, tablet mail client...&lt;br/&gt;
&lt;br/&gt;
brilliant! that did it! Any idea what happened to cause it to partially fail and get \
into this state?&lt;br/&gt; &lt;br/&gt;
oot@vm1 ~]# virsh blockjob serv1r2 vda&lt;br/&gt;
Active Block Commit: [100 %]&lt;br/&gt;
&lt;br/&gt;
[root@vm1 ~]# virsh blockjob --pivot serv1r2 vda&lt;br/&gt;
&lt;br/&gt;
[root@vm1 ~]# &lt;br/&gt;
[root@vm1 ~]# ls -l /var/lib/libvirt/images/serv1r2.qcow2 &lt;br/&gt;
-rw-r--r--. 1 qemu qemu 54200696832 Jun 30 10:39 \
/var/lib/libvirt/images/serv1r2.qcow2&lt;br/&gt; [root@vm1 ~]# date&lt;br/&gt;
Fri Jun 30 10:39:12 EDT 2017&lt;br/&gt;
[root@vm1 ~]# date&lt;br/&gt;
Fri Jun 30 10:39:51 EDT 2017&lt;br/&gt;
[root@vm1 ~]# ls -l /var/lib/libvirt/images/serv1r2.qcow2 &lt;br/&gt;
-rw-r--r--. 1 qemu qemu 54200696832 Jun 30 10:40 \
/var/lib/libvirt/images/serv1r2.qcow2&lt;br/&gt; [root@vm1 ~]# &lt;br/&gt;
&lt;br/&gt;
&lt;font color="#888888"&gt;&lt;font color="#888888"&gt;Sent from my android \
device.&lt;/font&gt;&lt;/font&gt;&lt;br/&gt;&lt;br/&gt;-----Original Message-----&lt;br/&gt;From: Peter Krempa \
&lt;pkrempa@redhat.com&gt;&lt;br/&gt;To: Doug Hughes \
&lt;doug.hughes@keystonenap.com&gt;&lt;br/&gt;Cc: libvirt-users@redhat.com&lt;br/&gt;Sent: Fri, \
30 Jun 2017 9:38&lt;br/&gt;Subject: Re: [libvirt-users] recovering from deleted \
snapshot&lt;br/&gt;&lt;br/&gt;&lt;/div&gt;On Fri, Jun 30, 2017 at 09:23:29 -0400, Doug Hughes \
wrote:&lt;br/&gt; &gt; On Jun 30, 2017 6:22 AM, "Peter Krempa" &lt;&lt;a \
href="mailto:pkrempa@redhat.com"&gt;pkrempa@redhat.com&lt;/a&gt;&gt; wrote:&lt;br/&gt; &gt; \
&gt; On Fri, Jun 30, 2017 at 12:05:47 +0200, Peter Krempa wrote:&lt;br/&gt; &gt; &gt; \
&gt; On Thu, Jun 22, 2017 at 11:02:41 -0400, Doug Hughes wrote:&lt;br/&gt; &lt;br/&gt;
[...]&lt;br/&gt;
&lt;br/&gt;
&gt; file or directory&lt;br/&gt;
&gt; &gt; $ virsh blockcommit --active --pivot fedora23 vda&lt;br/&gt;
&gt; &gt;&lt;br/&gt;
&gt; &gt; Successfully pivoted&lt;br/&gt;
&gt; &gt; $ virsh domblklist fedora23&lt;br/&gt;
&gt; &gt; Target     Source&lt;br/&gt;
&gt; &gt; ------------------------------------------------&lt;br/&gt;
&gt; &gt; vda        \
/var/lib/libvirt/images/fedora23.qcow2&lt;br/&gt; &gt; &gt; \
hda        -&lt;br/&gt; &gt; &gt;&lt;br/&gt;
&gt; &lt;br/&gt;
&gt; Thanks for the reply! The original image is still there. Only the 1st \
and&lt;br/&gt; &gt; only top-level snapshot is deleted.&lt;br/&gt;
&gt; the blockcommit fails though:&lt;br/&gt;
&gt; [root@vm1 ~]# virsh blockcommit serv1r2 vda --active --pivot&lt;br/&gt;
&gt; error: block copy still active: disk 'vda' already in active block job&lt;br/&gt;
&lt;br/&gt;
What does 'virsh blockjob serv1r2 vda' report?&lt;br/&gt;
&lt;br/&gt;
If it's something like this:&lt;br/&gt;
&lt;br/&gt;
$ virsh blockjob fedora23 vda&lt;br/&gt;
Active Block Commit: [100 %]&lt;br/&gt;
&lt;br/&gt;
Then you just need to finalize the block job by:&lt;br/&gt;
&lt;br/&gt;
virsh blockjob --pivot serv1r2 vda&lt;br/&gt;
&lt;br/&gt;
If that's not the case, please post what virsh blockjob is reporting and&lt;br/&gt;
the &lt;disk&gt; part of the XML.&lt;br/&gt;
&lt;br/&gt;
In case where libvirt falsely thinks that the job did not finish I'll&lt;br/&gt;
guide you how to recover it, since restarting libvirtd would make&lt;br/&gt;
libvirt clear the block job busy flag, but libvirt would lose the&lt;br/&gt;
metadata.&lt;br/&gt;



</body></email><email><emailId>20170630145519</emailId><senderName>Peter Krempa</senderName><senderEmail>pkrempa@redhat.com</senderEmail><timestampReceived>2017-06-30 14:55:19-0400</timestampReceived><subject>Re: [libvirt-users] recovering from deleted snapshot</subject><body>


On Fri, Jun 30, 2017 at 10:41:25 -0400, doug.hughes@keystonenap.com wrote:
&gt; sorry about top post, tablet mail client...
&gt; 
&gt; brilliant! that did it! Any idea what happened to cause it to partially fail and get into this state?

virsh blockcommit --pivot is actually 3 operations in sequence:
1) initiate the commit job
2) wait till it finishes
3) initiate the pivot job (this is synchronous, so the wait till it
finises is itegrated in the API call)

Apparently in your case the waiting part failed for some reason and thus
the job was not finished, lingering in the synchronised state.

The unfortunate part is that you don't know which operation failed.

Unfortunately it does not seem that we have wa waiting version of 'virsh
blockjob' that could be used to do the waiting. You can do the polling
manualy though.

The third operation can be split out by default, since you can specify
--wait instead of --pivot for 'virsh blockcommit' and it will finish
after step 2 above.

Also one of the cases which would help is that libvirt could actually
remove the file after commit, which would avoid the original problem,
since the file would still be there.

&gt; oot@vm1 ~]# virsh blockjob serv1r2 vda
&gt; Active Block Commit: [100 %]
&gt; 
&gt; [root@vm1 ~]# virsh blockjob --pivot serv1r2 vda
&gt; 
&gt; [root@vm1 ~]# 
&gt; [root@vm1 ~]# ls -l /var/lib/libvirt/images/serv1r2.qcow2 
&gt; -rw-r--r--. 1 qemu qemu 54200696832 Jun 30 10:39 /var/lib/libvirt/images/serv1r2.qcow2
&gt; [root@vm1 ~]# date
&gt; Fri Jun 30 10:39:12 EDT 2017
&gt; [root@vm1 ~]# date
&gt; Fri Jun 30 10:39:51 EDT 2017
&gt; [root@vm1 ~]# ls -l /var/lib/libvirt/images/serv1r2.qcow2 
&gt; -rw-r--r--. 1 qemu qemu 54200696832 Jun 30 10:40 /var/lib/libvirt/images/serv1r2.qcow2
&gt; [root@vm1 ~]# 

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170620080519</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-06-20 08:05:19-0400</timestampReceived><subject>Re: [libvirt-users] guest A from virbr0 can talk to guest B in virbr1 but not vice versa</subject><body>


On Tue, Jun 20, 2017 at 02:26:59AM -0400, Travis S. Johnson wrote:
&gt;Hello,
&gt;
&gt;I came across an interesting problem in my home lab a few weeks ago as I'm
&gt;prepping for my RHCE exam using Michael Jang study guide. I've been at this
&gt;for days now, and I still can't wrap my head around how two or more virtual
&gt;networks in default NAT configuration are even allowed to communicate with
&gt;each other despite what the libvirt documentation said.
&gt;
&gt;
&gt;Here's the excerpt I'm referring to in the wiki link here:
&gt;http://wiki.libvirt.org/page/Networking#Forwarding_Incoming_Connections:
&gt;
&gt;&gt; By default, guests that are connected via a virtual network with &lt;forward
&gt;&gt; mode='nat'/&gt; can make any outgoing network connection they like. Incoming
&gt;&gt; connections are allowed from the host, and from other guests connected to
&gt;&gt; the same libvirt network, but all other incoming connections are blocked by
&gt;&gt; iptables rules.
&gt;
&gt;
&gt;Also here's another assertion from 'The virtual network driver' section in
&gt;http://libvirt.org/firewall.html:
&gt;
&gt;&gt; type=nat
&gt;&gt;
&gt;&gt; Allow inbound related to an established connection. Allow outbound, but
&gt;&gt; only from our expected subnet. Allow traffic between guests. Deny all other
&gt;&gt; inbound. Deny all other outbound.
&gt;
&gt;
&gt;
&gt;I have three virtual networks with the following configs:
&gt;-----------------------------------------------------------------------------
&gt;&lt;network connections='1'&gt;
&gt;  &lt;name&gt;default&lt;/name&gt;
&gt;  &lt;uuid&gt;9c6796be-d54e-42bc-bcbe-2e4feee7154a&lt;/uuid&gt;
&gt;  &lt;forward mode='nat'&gt;
&gt;    &lt;nat&gt;
&gt;      &lt;port start='1024' end='65535'/&gt;
&gt;    &lt;/nat&gt;
&gt;  &lt;/forward&gt;
&gt;  &lt;bridge name='virbr0' stp='on' delay='0'/&gt;
&gt;  &lt;mac address='52:54:00:5a:5d:0e'/&gt;
&gt;  &lt;ip address='192.168.122.1' netmask='255.255.255.0'&gt;
&gt;    &lt;dhcp&gt;
&gt;      &lt;range start='192.168.122.2' end='192.168.122.254'/&gt;
&gt;    &lt;/dhcp&gt;
&gt;  &lt;/ip&gt;
&gt;&lt;/network&gt;
&gt;
&gt;&lt;network connections='1'&gt;
&gt;  &lt;name&gt;outsider&lt;/name&gt;
&gt;  &lt;uuid&gt;247e380a-8795-466a-b94a-5be2d05267bb&lt;/uuid&gt;
&gt;  &lt;forward mode='nat'&gt;
&gt;    &lt;nat&gt;
&gt;      &lt;port start='1024' end='65535'/&gt;
&gt;    &lt;/nat&gt;
&gt;  &lt;/forward&gt;
&gt;  &lt;bridge name='virbr1' stp='on' delay='0'/&gt;
&gt;  &lt;mac address='52:54:00:7f:a1:fb'/&gt;
&gt;  &lt;domain name='outsider'/&gt;
&gt;  &lt;ip address='192.168.100.1' netmask='255.255.255.0'&gt;
&gt;    &lt;dhcp&gt;
&gt;      &lt;range start='192.168.100.2' end='192.168.100.254'/&gt;
&gt;    &lt;/dhcp&gt;
&gt;  &lt;/ip&gt;
&gt;&lt;/network&gt;
&gt;
&gt;&lt;network connections='1'&gt;
&gt;  &lt;name&gt;besider&lt;/name&gt;
&gt;  &lt;uuid&gt;cc714cce-dbba-452d-b2bf-d36084dcb723&lt;/uuid&gt;
&gt;  &lt;forward mode='nat'&gt;
&gt;    &lt;nat&gt;
&gt;      &lt;port start='1024' end='65535'/&gt;
&gt;    &lt;/nat&gt;
&gt;  &lt;/forward&gt;
&gt;  &lt;bridge name='virbr2' stp='on' delay='0'/&gt;
&gt;  &lt;mac address='52:54:00:59:67:7f'/&gt;
&gt;  &lt;domain name='besider'/&gt;
&gt;  &lt;ip address='192.168.110.1' netmask='255.255.255.0'&gt;
&gt;    &lt;dhcp&gt;
&gt;      &lt;range start='192.168.110.2' end='192.168.110.254'/&gt;
&gt;    &lt;/dhcp&gt;
&gt;  &lt;/ip&gt;
&gt;&lt;/network&gt;
&gt;----------------------------------------------------------------------------
&gt;
&gt;
&gt;Here is the output of the 'FORWARD' iptables chain rules on my host (still
&gt;using firewall-cmd):
&gt;------------------------------------------------------------------------
&gt;Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
&gt; pkts bytes target     prot opt in     out     source
&gt;destination
&gt; 8967   14M ACCEPT     all  --  *      virbr2  0.0.0.0/0
&gt;192.168.110.0/24     ctstate RELATED,ESTABLISHED
&gt; 5262  279K ACCEPT     all  --  virbr2 *       192.168.110.0/24
&gt;0.0.0.0/0
&gt;    0     0 ACCEPT     all  --  virbr2 virbr2  0.0.0.0/0
&gt;0.0.0.0/0
&gt;   70  5832 REJECT     all  --  *      virbr2  0.0.0.0/0
&gt;0.0.0.0/0            reject-with icmp-port-unreachable
&gt;    0     0 REJECT     all  --  virbr2 *       0.0.0.0/0
&gt;0.0.0.0/0            reject-with icmp-port-unreachable
&gt; 8510   13M ACCEPT     all  --  *      virbr0  0.0.0.0/0
&gt;192.168.122.0/24     ctstate RELATED,ESTABLISHED
&gt; 5177  275K ACCEPT     all  --  virbr0 *       192.168.122.0/24
&gt;0.0.0.0/0
&gt;    0     0 ACCEPT     all  --  virbr0 virbr0  0.0.0.0/0
&gt;0.0.0.0/0
&gt;   61  5100 REJECT     all  --  *      virbr0  0.0.0.0/0
&gt;0.0.0.0/0            reject-with icmp-port-unreachable
&gt;    0     0 REJECT     all  --  virbr0 *       0.0.0.0/0
&gt;0.0.0.0/0            reject-with icmp-port-unreachable
&gt; 8612   13M ACCEPT     all  --  *      virbr1  0.0.0.0/0
&gt;192.168.100.0/24     ctstate RELATED,ESTABLISHED
&gt; 5172  273K ACCEPT     all  --  virbr1 *       192.168.100.0/24
&gt;0.0.0.0/0
&gt;    0     0 ACCEPT     all  --  virbr1 virbr1  0.0.0.0/0
&gt;0.0.0.0/0
&gt;    0     0 REJECT     all  --  *      virbr1  0.0.0.0/0
&gt;0.0.0.0/0            reject-with icmp-port-unreachable
&gt;    0     0 REJECT     all  --  virbr1 *       0.0.0.0/0
&gt;0.0.0.0/0            reject-with icmp-port-unreachable
&gt;    0     0 ACCEPT     all  --  *      *       0.0.0.0/0
&gt;0.0.0.0/0            ctstate RELATED,ESTABLISHED
&gt;    0     0 ACCEPT     all  --  lo     *       0.0.0.0/0
&gt;0.0.0.0/0
&gt;    0     0 FORWARD_direct  all  --  *      *       0.0.0.0/0
&gt;0.0.0.0/0
&gt;    0     0 FORWARD_IN_ZONES_SOURCE  all  --  *      *       0.0.0.0/0
&gt;       0.0.0.0/0
&gt;    0     0 FORWARD_IN_ZONES  all  --  *      *       0.0.0.0/0
&gt;0.0.0.0/0
&gt;    0     0 FORWARD_OUT_ZONES_SOURCE  all  --  *      *       0.0.0.0/0
&gt;       0.0.0.0/0
&gt;    0     0 FORWARD_OUT_ZONES  all  --  *      *       0.0.0.0/0
&gt;0.0.0.0/0
&gt;    0     0 DROP       all  --  *      *       0.0.0.0/0
&gt;0.0.0.0/0            ctstate INVALID
&gt;    0     0 REJECT     all  --  *      *       0.0.0.0/0
&gt;0.0.0.0/0            reject-with icmp-host-prohibited
&gt;--------------------------------------------------------------------------
&gt;
&gt;I have a VM in each network:
&gt;nest1.example.com (virbr0) - 192.168.122.50
&gt;nest2.example.org (virbr1) - 192.168.100.100
&gt;nest3.example.net (virbr2) - 192.168.110.25
&gt;
&gt;I'm quite aware the above iptables rules were added by libvirt, but I'm
&gt;still managing the firewall primarily through the *firewall-cmd* command.
&gt;
&gt;&gt;From what I gathered...
&gt;----------------------------------------------------------
&gt;nest3 can ping nest1 and nest2.
&gt;
&gt;Nest3 ping nest1 and made a hit here:
&gt; 8967   14M ACCEPT     all  --  *      virbr2  0.0.0.0/0
&gt;192.168.110.0/24     ctstate RELATED,ESTABLISHED
&gt; 5262  279K ACCEPT     all  --  virbr2 *       192.168.110.0/24
&gt;0.0.0.0/0
&gt;
&gt;Nest3 ping nest2 and made a hit here:
&gt; 8967   14M ACCEPT     all  --  *      virbr2  0.0.0.0/0
&gt;192.168.110.0/24     ctstate RELATED,ESTABLISHED
&gt; 5262  279K ACCEPT     all  --  virbr2 *       192.168.110.0/24
&gt;0.0.0.0/0
&gt;----------------------------------------------------------
&gt;
&gt;
&gt;----------------------------------------------------------
&gt;Nest1 can ping nest2, but cannot ping nest3.
&gt;
&gt;Nest1 ping nest2 and made a hit here:
&gt;8510   13M ACCEPT     all  --  *      virbr0  0.0.0.0/0
&gt;192.168.122.0/24     ctstate RELATED,ESTABLISHED
&gt; 5177  275K ACCEPT     all  --  virbr0 *       192.168.122.0/24
&gt;0.0.0.0/0
&gt;
&gt;Nest1 ping nest3 and made a hit here:
&gt;   70  5832 REJECT     all  --  *      virbr2  0.0.0.0/0
&gt;0.0.0.0/0            reject-with icmp-port-unreachable
&gt;----------------------------------------------------------
&gt;
&gt;
&gt;----------------------------------------------------------
&gt;Nest2 cannot ping nest1 and nest3.
&gt;
&gt;Nest2 ping nest1 and made a hit here:
&gt;   61  5100 REJECT     all  --  *      virbr0  0.0.0.0/0
&gt;0.0.0.0/0            reject-with icmp-port-unreachable
&gt;
&gt;Nest2 ping test3 and made a hit here:
&gt;   70  5832 REJECT     all  --  *      virbr2  0.0.0.0/0
&gt;0.0.0.0/0            reject-with icmp-port-unreachable
&gt;----------------------------------------------------------
&gt;
&gt;
&gt;&gt;From my observation, I see that the order of the virtual networks in the
&gt;iptables FORWARD chain makes a difference. Each chunk associated with the
&gt;virtual network in the chain, consisting of five lines, is exactly as
&gt;described in the aforementioned link (http://libvirt.org/firewall.html).
&gt;The virtual network in the top chunk of the chain can communicate with
&gt;virtually all networks as opposed to the network in the last chunk that is
&gt;consistent with the intention of the original design.
&gt;
&gt;I'm using CentOS 7.3 with libvirt 2.0. I even tried reproducing this with
&gt;CentOS 6.9 as I thought it was possible the firewalld may have influenced
&gt;the change, but I was still getting similar result.
&gt;
&gt;Right now, I'm not certain if this is already a reported known bug, but I'm
&gt;highly convinced this configuration is unofficially unsupported for quite a
&gt;while. Can someone confirm this? This is my very first mailing list
&gt;submission ever, and I apologize in advance if I couldn't figure out how to
&gt;conveniently search up a similar discussion as this one in the archive. If
&gt;this is in fact near impossible to implement in accordance to the intended
&gt;design, then I'd like to have this confirmation publicly included in the
&gt;docs.
&gt;

Thanks for reporting this.  It's clearly a bug in libvirt.  The rules
are in this order:

  all rules for virbr0
  all rules for virbr1
  all rules for virbr2

But what we should do instead is:

  input rules for all networks
  local rules for all networks
  output rules for all networks
  reject rules for all networks

The problem is that we do not know how other rules look like.  So what
we might need to do is create chains where rules for the first network
are, then only append network rules into those chains.

Would you mind filing a bug for this issue, so we can properly track it
and don't forget about it?  I'll have a look at it in the meantime, but
don't promise anything since I'm not that familiar with that part of the
codebase.

&gt;Thanks,
&gt;
&gt;Travis Johnson

&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170620092748</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-06-20 09:27:48-0400</timestampReceived><subject>Re: [libvirt-users] guest A from virbr0 can talk to guest B in virbr1 but not vice versa</subject><body>


On Tue, Jun 20, 2017 at 10:05:19AM +0200, Martin Kletzander wrote:
&gt;On Tue, Jun 20, 2017 at 02:26:59AM -0400, Travis S. Johnson wrote:
&gt;&gt;Hello,
&gt;&gt;
&gt;&gt;I came across an interesting problem in my home lab a few weeks ago as I'm
&gt;&gt;prepping for my RHCE exam using Michael Jang study guide. I've been at this
&gt;&gt;for days now, and I still can't wrap my head around how two or more virtual
&gt;&gt;networks in default NAT configuration are even allowed to communicate with
&gt;&gt;each other despite what the libvirt documentation said.
&gt;&gt;
&gt;&gt;
&gt;&gt;Here's the excerpt I'm referring to in the wiki link here:
&gt;&gt;http://wiki.libvirt.org/page/Networking#Forwarding_Incoming_Connections:
&gt;&gt;
&gt;&gt;&gt; By default, guests that are connected via a virtual network with &lt;forward
&gt;&gt;&gt; mode='nat'/&gt; can make any outgoing network connection they like. Incoming
&gt;&gt;&gt; connections are allowed from the host, and from other guests connected to
&gt;&gt;&gt; the same libvirt network, but all other incoming connections are blocked by
&gt;&gt;&gt; iptables rules.
&gt;&gt;

I did not read this properly...

&gt;&gt;
&gt;&gt;Also here's another assertion from 'The virtual network driver' section in
&gt;&gt;http://libvirt.org/firewall.html:
&gt;&gt;
&gt;&gt;&gt; type=nat
&gt;&gt;&gt;
&gt;&gt;&gt; Allow inbound related to an established connection. Allow outbound, but
&gt;&gt;&gt; only from our expected subnet. Allow traffic between guests. Deny all other

I would expect the 'traffic between guests' to mean only guests on the
same network.  Also that lines up with what's written above.

&gt;&gt;&gt; inbound. Deny all other outbound.
&gt;&gt;

[...]

&gt;
&gt;Thanks for reporting this.  It's clearly a bug in libvirt.  The rules
&gt;are in this order:
&gt;
&gt;  all rules for virbr0
&gt;  all rules for virbr1
&gt;  all rules for virbr2
&gt;
&gt;But what we should do instead is:
&gt;
&gt;  input rules for all networks
&gt;  local rules for all networks
&gt;  output rules for all networks
&gt;  reject rules for all networks
&gt;
&gt;The problem is that we do not know how other rules look like.  So what
&gt;we might need to do is create chains where rules for the first network
&gt;are, then only append network rules into those chains.
&gt;
&gt;Would you mind filing a bug for this issue, so we can properly track it
&gt;and don't forget about it?  I'll have a look at it in the meantime, but
&gt;don't promise anything since I'm not that familiar with that part of the
&gt;codebase.
&gt;

Actually, now that I'm thinking about it, the problem is not that we
disallow the communication from virbr1 to virbr0, but the problem is
that we allow the connection from virbr0 to everywhere.

Maybe the solution would be: for each network, insert the rules on top
of the forward chain and for each started network, explicitly reject
that one.  So that after one network starts it would look like this (I'm
writing this from memory just to illustrate the idea, not actually
looking up how stuff looks):

  ACCEPT any virbr0 RELATED,ESTABLISHED
  ACCEPT virbr0 virbr0
  ACCEPT virbr0 any src:192.168.122.0/24
  REJECT any virbr0
  REJECT virbr0 any

And after second network is started, we'd have:

  # This one is new:
  REJECT virbr1 virbr0
  # These ones would be normally at the end, IIRC:
  ACCEPT any virbr1 RELATED,ESTABLISHED
  ACCEPT virbr1 virbr1
  ACCEPT virbr1 any src:192.168.122.0/24
  REJECT any virbr1
  REJECT virbr1 any
  # These are left as they were:
  ACCEPT any virbr0 RELATED,ESTABLISHED
  ACCEPT virbr0 virbr0
  ACCEPT virbr0 any src:192.168.122.0/24
  REJECT any virbr0
  REJECT virbr0 any

Cc'ing Laine so that he can weigh in as he has way more knowledge of
this part of the code =)

&gt;&gt;Thanks,
&gt;&gt;
&gt;&gt;Travis Johnson
&gt;
&gt;&gt;_______________________________________________
&gt;&gt;libvirt-users mailing list
&gt;&gt;libvirt-users@redhat.com
&gt;&gt;https://www.redhat.com/mailman/listinfo/libvirt-users



&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170620164641</emailId><senderName>Laine Stump</senderName><senderEmail>laine@laine.org</senderEmail><timestampReceived>2017-06-20 16:46:41-0400</timestampReceived><subject>Re: [libvirt-users] guest A from virbr0 can talk to guest B in virbr1 but not vice versa</subject><body>

On 06/20/2017 05:27 AM, Martin Kletzander wrote:
&gt; On Tue, Jun 20, 2017 at 10:05:19AM +0200, Martin Kletzander wrote:
&gt;&gt; On Tue, Jun 20, 2017 at 02:26:59AM -0400, Travis S. Johnson wrote:
&gt;&gt;&gt; Hello,
&gt;&gt;&gt;
&gt;&gt;&gt; I came across an interesting problem in my home lab a few weeks ago
&gt;&gt;&gt; as I'm
&gt;&gt;&gt; prepping for my RHCE exam using Michael Jang study guide. I've been
&gt;&gt;&gt; at this
&gt;&gt;&gt; for days now, and I still can't wrap my head around how two or more
&gt;&gt;&gt; virtual
&gt;&gt;&gt; networks in default NAT configuration are even allowed to communicate
&gt;&gt;&gt; with
&gt;&gt;&gt; each other despite what the libvirt documentation said.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Here's the excerpt I'm referring to in the wiki link here:
&gt;&gt;&gt; http://wiki.libvirt.org/page/Networking#Forwarding_Incoming_Connections:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; By default, guests that are connected via a virtual network with
&gt;&gt;&gt;&gt; &lt;forward
&gt;&gt;&gt;&gt; mode='nat'/&gt; can make any outgoing network connection they like.
&gt;&gt;&gt;&gt; Incoming
&gt;&gt;&gt;&gt; connections are allowed from the host, and from other guests
&gt;&gt;&gt;&gt; connected to
&gt;&gt;&gt;&gt; the same libvirt network, but all other incoming connections are
&gt;&gt;&gt;&gt; blocked by
&gt;&gt;&gt;&gt; iptables rules.
&gt;&gt;&gt;
&gt; 
&gt; I did not read this properly...
&gt; 
&gt;&gt;&gt;
&gt;&gt;&gt; Also here's another assertion from 'The virtual network driver'
&gt;&gt;&gt; section in
&gt;&gt;&gt; http://libvirt.org/firewall.html:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; type=nat
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Allow inbound related to an established connection. Allow outbound, but
&gt;&gt;&gt;&gt; only from our expected subnet. Allow traffic between guests. Deny
&gt;&gt;&gt;&gt; all other
&gt; 
&gt; I would expect the 'traffic between guests' to mean only guests on the
&gt; same network.  Also that lines up with what's written above.

That is correct.

&gt; 
&gt;&gt;&gt;&gt; inbound. Deny all other outbound.
&gt;&gt;&gt;
&gt; 
&gt; [...]
&gt; 
&gt;&gt;
&gt;&gt; Thanks for reporting this.  It's clearly a bug in libvirt.  The rules
&gt;&gt; are in this order:
&gt;&gt;
&gt;&gt;  all rules for virbr0
&gt;&gt;  all rules for virbr1
&gt;&gt;  all rules for virbr2
&gt;&gt;
&gt;&gt; But what we should do instead is:
&gt;&gt;
&gt;&gt;  input rules for all networks
&gt;&gt;  local rules for all networks
&gt;&gt;  output rules for all networks
&gt;&gt;  reject rules for all networks

That doesn't achieve the desired results (as you figured out later,
according to your followup comments.


&gt;&gt;
&gt;&gt; The problem is that we do not know how other rules look like.  So what
&gt;&gt; we might need to do is create chains where rules for the first network
&gt;&gt; are, then only append network rules into those chains.
&gt;&gt;
&gt;&gt; Would you mind filing a bug for this issue, so we can properly track it
&gt;&gt; and don't forget about it?  I'll have a look at it in the meantime, but
&gt;&gt; don't promise anything since I'm not that familiar with that part of the
&gt;&gt; codebase.
&gt;&gt;
&gt; 
&gt; Actually, now that I'm thinking about it, the problem is not that we
&gt; disallow the communication from virbr1 to virbr0, but the problem is
&gt; that we allow the connection from virbr0 to everywhere.

Yep!

That's actually a known bug that has been there "forever". It has always
been brought up in the context of "I want communication between my NATed
networks, and it only works in one direction!", rather than "I want to
block communication between my NATed networks, but it gets past in one
direction!". When people learn that it's (kind of) blocked, they work
around it by adding a new network that is shared by all the guests.
Because all of the reports have been in this direction, fixing it
properly has been very low on (my) priority list.


&gt; 
&gt; Maybe the solution would be: for each network, insert the rules on top
&gt; of the forward chain and for each started network, explicitly reject
&gt; that one.  So that after one network starts it would look like this (I'm
&gt; writing this from memory just to illustrate the idea, not actually
&gt; looking up how stuff looks):
&gt; 
&gt;  ACCEPT any virbr0 RELATED,ESTABLISHED
&gt;  ACCEPT virbr0 virbr0
&gt;  ACCEPT virbr0 any src:192.168.122.0/24
&gt;  REJECT any virbr0
&gt;  REJECT virbr0 any
&gt; 
&gt; And after second network is started, we'd have:
&gt; 
&gt;  # This one is new:
&gt;  REJECT virbr1 virbr0

Yeah, it's (mostly) this rule that makes the solution complicated.
Essentially you need one of these rules for each pair of virtual
networks, so if you have 10 networks, you'll need 45 rules, for 11
you'll need 55 (in general, for "n" networks, you'll need (n * (n-1) /
2) extra rules).

Aside from the extra packet processing overhead caused by the high
number of rules needed (which may be completely insignificant), and the
necessity to add/remove rules at specific labels rather than just
inserting them all at the beginning, there is the issue that currently
each iptables rule added for a libvirt network is dependent only on that
network, so it's simple to determine which rules to remove when a
network is destroyed. If we start adding rules that are dependent on two
networks, then proper cleanup will be more complicated.

None of that should prevent a properly motivated person from writing the
code to do it, of course!

&gt;  # These ones would be normally at the end, IIRC:
&gt;  ACCEPT any virbr1 RELATED,ESTABLISHED
&gt;  ACCEPT virbr1 virbr1
&gt;  ACCEPT virbr1 any src:192.168.122.0/24
&gt;  REJECT any virbr1
&gt;  REJECT virbr1 any
&gt;  # These are left as they were:
&gt;  ACCEPT any virbr0 RELATED,ESTABLISHED
&gt;  ACCEPT virbr0 virbr0
&gt;  ACCEPT virbr0 any src:192.168.122.0/24
&gt;  REJECT any virbr0
&gt;  REJECT virbr0 any
&gt; 
&gt; Cc'ing Laine so that he can weigh in as he has way more knowledge of
&gt; this part of the code =)

</body></email><email><emailId>20170620062339</emailId><senderName>Andy Gibbs</senderName><senderEmail>andyg1001@hotmail.co.uk</senderEmail><timestampReceived>2017-06-20 06:23:39-0400</timestampReceived><subject>[libvirt-users] VM fails to start on boot-up</subject><body>

Hi,


I have created a VM with the option inside virt-manager to "start virtual machine on \
host boot up".  It is the only VM on the host to be configured this way.  However, I \
am getting this error in the log file when it attempts to start it on boot up:


2017-06-19 07:15:18.491+0000: starting up libvirt version: 2.0.0, package: 10.el7_3.9 \
(CentOS BuildSystem &lt;http://bugs.centos.org&gt;, 2017-05-25-20:52:28, \
c1bm.rdu2.centos.org), qemu version: 2.6.0 (qemu-kvm-ev-2.6.0-28.el7_3.9.1), \
hostname: server.mydomain.lan LC_ALL=C \
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin QEMU_AUDIO_DRV=spice \
/usr/libexec/qemu-kvm -name guest=MyVM,debug-threads=on -S -object \
secret,id=masterKey0,format=raw,file=/var/lib/libvirt/qemu/domain-1-MyVM/master-key.aes \
-machine pc-i440fx-rhel7.3.0,accel=kvm,usb=off,vmport=off -cpu Broadwell,+rtm,+hle -m \
8192 -realtime mlock=off -smp 4,sockets=4,cores=1,threads=1 -uuid \
cb6f4d45-091d-47f8-931a-8daf6b0cf2b8 -no-user-config -nodefaults -chardev \
socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-1-MyVM/monitor.sock,server,nowait \
-mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc,driftfix=slew -global \
kvm-pit.lost_tick_policy=discard -no-hpet -no-shutdown -global PIIX4_PM.disable_s3=1 \
-global PIIX4_PM.disable_s4=1 -boot menu=off,strict=on -device \
ich9-usb-ehci1,id=usb,bus=pci.0,addr=0x6.0x7 -device \
ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x6 \
-device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x6.0x1 -device \
ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x6.0x2 -device \
virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x5 -drive \
file=/var/lib/libvirt/images/MyVM.qcow2,format=qcow2,if=none,id=drive-virtio-disk0 \
-device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x7,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 \
-netdev tap,fd=28,id=hostnet0,vhost=on,vhostfd=30 -device \
virtio-net-pci,netdev=hostnet0,id=net0,mac=52:54:00:0e:2e:75,bus=pci.0,addr=0x3 \
-chardev pty,id=charserial0 -device isa-serial,chardev=charserial0,id=serial0 \
-chardev socket,id=charchannel0,path=/var/lib/libvirt/qemu/channel/target/domain-1-MyVM/org.qemu.guest_agent.0,server,nowait \
-device virtserialport,bus=virtio-serial0.0,nr=1,chardev=charchannel0,id=channel0,name=org.qemu.guest_agent.0 \
-chardev spicevmc,id=charchannel1,name=vdagent -device \
virtserialport,bus=virtio-serial0.0,nr=2,chardev=charchannel1,id=channel1,name=com.redhat.spice.0 \
-device usb-tablet,id=input0,bus=usb.0,port=1 -spice \
port=5900,tls-port=5901,addr=127.0.0.1,disable-ticketing,x509-dir=/etc/pki/vdsm/libvirt-spice,seamless-migration=on \
-device qxl-vga,id=video0,ram_size=67108864,vram_size=67108864,vram64_size_mb=0,vgamem_mb=16,bus=pci.0,addr=0x2 \
-device intel-hda,id=sound0,bus=pci.0,addr=0x4 -device \
hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -chardev \
spicevmc,id=charredir0,name=usbredir -device \
usb-redir,chardev=charredir0,id=redir0,bus=usb.0,port=2 -chardev \
spicevmc,id=charredir1,name=usbredir -device \
usb-redir,chardev=charredir1,id=redir1,bus=usb.0,port=3 -device \
virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x8 -msg timestamp=on char device \
redirected to /dev/pts/0 (label charserial0) ((null):3344): Spice-ERROR **: \
reds.c:4043:do_spice_init: statistics shm_open failed, Permission denied 2017-06-19 \
07:15:18.824+0000: shutting down

However, when I start the VM manually through virt-manager, it starts up fine.


Now, if I remove all the spice-related "hardware", e.g. spice display, qxl video, \
spice channel and usb redirectors, and reboot the host PC, then I get the following:


2017-06-19 08:14:07.358+0000: starting up libvirt version: 2.0.0, (...)
LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin (...)
char device redirected to /dev/pts/1 (label charserial0)
2017-06-19T08:14:33.453300Z qemu-kvm: terminating on signal 15 from pid 2072
2017-06-19 08:14:33.670+0000: shutting down

So even this doesn't work -- if it doesn't fail to start, then something kills it \
anyway!!


Does anyone have any ideas why might it fail during boot-up?  And is there anything I \
can do to solve the problem, or further diagnose it?


Many thanks,


Andy


[Attachment #3 (text/html)]

&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"&gt;
&lt;style type="text/css" style="display:none;"&gt;&lt;!-- P {margin-top:0;margin-bottom:0;} \
--&gt;&lt;/style&gt; &lt;/head&gt;
&lt;body dir="ltr"&gt;
&lt;div id="divtagdefaultwrapper" \
style="font-size:12pt;color:#000000;font-family:Calibri,Helvetica,sans-serif;" \
dir="ltr"&gt; &lt;p&gt;&lt;span style="font-family: Calibri, Helvetica, sans-serif; font-size: \
12pt;"&gt;Hi,&lt;/span&gt;&lt;br&gt; &lt;/p&gt;
&lt;div style="color: rgb(0, 0, 0);"&gt;
&lt;div&gt;
&lt;div id="divtagdefaultwrapper" dir="ltr" style="font-size:12pt; color:#000000; \
font-family:Calibri,Helvetica,sans-serif"&gt; &lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;p&gt;I have created a VM with the option inside virt-manager to "start virtual \
machine on host boot up".  It is the only VM on the host to be configured \
this way.  However, I am getting this error in the log file when it attempts to \
start it on boot up:&lt;/p&gt; &lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;div&gt;2017-06-19 07:15:18.491+0000: starting up libvirt version: 2.0.0, package: \
10.el7_3.9 (CentOS BuildSystem &lt;http://bugs.centos.org&gt;, 2017-05-25-20:52:28, \
c1bm.rdu2.centos.org), qemu version: 2.6.0 (qemu-kvm-ev-2.6.0-28.el7_3.9.1), \
hostname: server.mydomain.lan&lt;/div&gt; &lt;div&gt;LC_ALL=C \
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin QEMU_AUDIO_DRV=spice \
/usr/libexec/qemu-kvm -name guest=MyVM,debug-threads=on -S -object \
secret,id=masterKey0,format=raw,file=/var/lib/libvirt/qemu/domain-1-MyVM/master-key.aes \
                -machine pc-i440fx-rhel7.3.0,accel=kvm,usb=off,vmport=off
 -cpu Broadwell,+rtm,+hle -m 8192 -realtime mlock=off -smp \
4,sockets=4,cores=1,threads=1 -uuid cb6f4d45-091d-47f8-931a-8daf6b0cf2b8 \
-no-user-config -nodefaults -chardev \
socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-1-MyVM/monitor.sock,server,nowait
                
 -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc,driftfix=slew -global \
kvm-pit.lost_tick_policy=discard -no-hpet -no-shutdown -global PIIX4_PM.disable_s3=1 \
-global PIIX4_PM.disable_s4=1 -boot menu=off,strict=on -device \
                ich9-usb-ehci1,id=usb,bus=pci.0,addr=0x6.0x7
 -device ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x6 \
-device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x6.0x1 -device \
ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x6.0x2 -device \
                virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x5
 -drive file=/var/lib/libvirt/images/MyVM.qcow2,format=qcow2,if=none,id=drive-virtio-disk0 \
-device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x7,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 \
-netdev tap,fd=28,id=hostnet0,vhost=on,vhostfd=30 -device \
                virtio-net-pci,netdev=hostnet0,id=net0,mac=52:54:00:0e:2e:75,bus=pci.0,addr=0x3
                
 -chardev pty,id=charserial0 -device isa-serial,chardev=charserial0,id=serial0 \
-chardev socket,id=charchannel0,path=/var/lib/libvirt/qemu/channel/target/domain-1-MyVM/org.qemu.guest_agent.0,server,nowait \
-device virtserialport,bus=virtio-serial0.0,nr=1,chardev=charchannel0,id=channel0,name=org.qemu.guest_agent.0
                
 -chardev spicevmc,id=charchannel1,name=vdagent -device \
virtserialport,bus=virtio-serial0.0,nr=2,chardev=charchannel1,id=channel1,name=com.redhat.spice.0 \
-device usb-tablet,id=input0,bus=usb.0,port=1 -spice \
port=5900,tls-port=5901,addr=127.0.0.1,disable-ticketing,x509-dir=/etc/pki/vdsm/libvirt-spice,seamless-migration=on
                
 -device qxl-vga,id=video0,ram_size=67108864,vram_size=67108864,vram64_size_mb=0,vgamem_mb=16,bus=pci.0,addr=0x2 \
-device intel-hda,id=sound0,bus=pci.0,addr=0x4 -device \
hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -chardev \
                spicevmc,id=charredir0,name=usbredir
 -device usb-redir,chardev=charredir0,id=redir0,bus=usb.0,port=2 -chardev \
spicevmc,id=charredir1,name=usbredir -device \
usb-redir,chardev=charredir1,id=redir1,bus=usb.0,port=3 -device \
virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x8 -msg timestamp=on&lt;/div&gt; &lt;div&gt;char \
device redirected to /dev/pts/0 (label charserial0)&lt;/div&gt; &lt;div&gt;((null):3344): \
Spice-ERROR **: reds.c:4043:do_spice_init: statistics shm_open failed, Permission \
denied&lt;/div&gt; &lt;div&gt;2017-06-19 07:15:18.824+0000: shutting down&lt;/div&gt;
&lt;div&gt;&lt;br&gt;
&lt;/div&gt;
However, when I start the VM manually through virt-manager, it starts up fine.
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;p&gt;Now, if I remove all the spice-related "hardware", e.g. spice display, \
qxl video, spice channel and usb redirectors, and reboot the host PC, then I get the \
following:&lt;/p&gt; &lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;div&gt;2017-06-19 08:14:07.358+0000: starting up libvirt version: 2.0.0, \
(...)&lt;/div&gt; &lt;div&gt;LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin \
(...)&lt;/div&gt; &lt;div&gt;char device redirected to /dev/pts/1 (label charserial0)&lt;/div&gt;
&lt;div&gt;2017-06-19T08:14:33.453300Z qemu-kvm: terminating on signal 15 from pid \
2072&lt;/div&gt; &lt;div&gt;2017-06-19 08:14:33.670+0000: shutting down&lt;/div&gt;
&lt;div&gt;&lt;br&gt;
&lt;/div&gt;
So even this doesn't work -- if it doesn't fail to start, then something kills it \
anyway!! &lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;p&gt;Does anyone have any ideas why might it fail during boot-up?  And is there \
anything I can do to solve the problem, or further diagnose it?&lt;/p&gt; &lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;p&gt;Many thanks,&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;p&gt;Andy&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170615055609</emailId><senderName></senderName><senderEmail>zhuohaofan@126.com</senderEmail><timestampReceived>2017-06-15 05:56:09-0400</timestampReceived><subject>[libvirt-users]  [qemu-kvm] Network bandwidth limits via libvirt</subject><body>

[Attachment #2 (text/plain)]

Hi all,

I try to understand why the network bandwidth limits are not applied to my ubuntu \
16.04.2 VM (qemu-kvm driver) and I would need some insights. I create my VM network \
with virsh and when I issue a dumpxml on my network, I can see that bandwidth limits \
are set:

virsh # net-dumpxml nat_limit
&lt;network&gt;
  &lt;name&gt;nat_limit&lt;/name&gt;
  &lt;uuid&gt;4b5e128d-9ad0-4ccc-9424-dee60b71861a&lt;/uuid&gt;
  &lt;forward mode='nat'&gt;
    &lt;nat&gt;
      &lt;port start='1024' end='65535'/&gt;
    &lt;/nat&gt;
  &lt;/forward&gt;
  &lt;bridge name='virbr1' stp='on' delay='0'/&gt;
  &lt;mac address='52:54:00:af:99:73'/&gt;
  &lt;bandwidth&gt;
    &lt;inbound average='10' peak='50' burst='10'/&gt;
    &lt;outbound average='128' peak='256' burst='256'/&gt;
  &lt;/bandwidth&gt;
  &lt;ip address='192.168.123.1' netmask='255.255.255.0'&gt;
    &lt;dhcp&gt;
      &lt;range start='192.168.123.2' end='192.168.123.254'/&gt;
    &lt;/dhcp&gt;
  &lt;/ip&gt;

&lt;/network&gt;


And the net info is:
virsh # net-info nat_limit
Name:           nat_limit
UUID:           4b5e128d-9ad0-4ccc-9424-dee60b71861a
Active:         yes
Persistent:     yes
Autostart:      yes
Bridge:         virbr1
Then, I create my VM, and the source of interface is the network, like this:
virsh # dumpxml virt20
...
    &lt;interface type='network'&gt;
      &lt;mac address='52:54:00:a2:5b:10'/&gt;
      &lt;source network='nat_limit' bridge='virbr1'/&gt;
      &lt;target dev='vnet2'/&gt;
      &lt;model type='rtl8139'/&gt;
      &lt;alias name='net0'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/&gt;
    &lt;/interface&gt;
...


However when I send a big file with netper I don't see any limits applied to the \
transfer rate.

I've checked the domain log and I didn't see any qemu command line argument related \
to bandwidth limits.


Could you tell me why the network bandwidth limits can not work? Do network limits \
are managed in another way? Thanks.

Below some information about my hypervisor:

root@ubuntu-04:~# virsh -V
Virsh command line tool of libvirt 1.3.1
See web site at http://libvirt.org/

Compiled with support for:
 Hypervisors: QEMU/KVM LXC UML Xen LibXL OpenVZ VMWare VirtualBox ESX Test
 Networking: Remote Network Bridging Interface netcf Nwfilter VirtualPort
 Storage: Dir Disk Filesystem SCSI Multipath iSCSI LVM RBD Sheepdog ZFS
 Miscellaneous: Daemon Nodedev AppArmor Secrets Debug Readline Modular

qemu version: 2.5.0

Thanks,

Netsurfed


[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;pre&gt;Hi \
all,

I try to understand why the network bandwidth limits are not applied to my ubuntu \
16.04.2 VM (qemu-kvm driver) and I would need some insights. &lt;div&gt;I create my VM \
network with virsh and when I issue a dumpxml on my network, I can see that bandwidth \
limits are set:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;virsh # net-dumpxml nat_limit &lt;network&gt;
  &lt;name&gt;nat_limit&lt;/name&gt;
  &lt;uuid&gt;4b5e128d-9ad0-4ccc-9424-dee60b71861a&lt;/uuid&gt;
  &lt;forward mode='nat'&gt;
    &lt;nat&gt;
      &lt;port start='1024' end='65535'/&gt;
    &lt;/nat&gt;
  &lt;/forward&gt;
  &lt;bridge name='virbr1' stp='on' delay='0'/&gt;
  &lt;mac address='52:54:00:af:99:73'/&gt;
  &lt;bandwidth&gt;
    &lt;inbound average='10' peak='50' burst='10'/&gt;
    &lt;outbound average='128' peak='256' burst='256'/&gt;
  &lt;/bandwidth&gt;
  &lt;ip address='192.168.123.1' netmask='255.255.255.0'&gt;
    &lt;dhcp&gt;
      &lt;range start='192.168.123.2' end='192.168.123.254'/&gt;
    &lt;/dhcp&gt;
  &lt;/ip&gt;
&lt;div&gt;&lt;/network&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;And the net info is:&lt;/div&gt;&lt;div&gt;virsh # \
                net-info nat_limit
Name:           nat_limit
UUID:           4b5e128d-9ad0-4ccc-9424-dee60b71861a
Active:         yes
Persistent:     yes
Autostart:      yes
Bridge:         virbr1&lt;/div&gt;&lt;div&gt;
&lt;/div&gt;&lt;div&gt;Then, I create my VM, and the source of interface is the network, like \
this:&lt;/div&gt;&lt;div&gt;virsh # dumpxml virt20&lt;/div&gt;&lt;div&gt;...&lt;/div&gt;&lt;div&gt;    &lt;interface \
type='network'&gt;  &lt;mac address='52:54:00:a2:5b:10'/&gt;
      &lt;source network='nat_limit' bridge='virbr1'/&gt;
      &lt;target dev='vnet2'/&gt;
      &lt;model type='rtl8139'/&gt;
      &lt;alias name='net0'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03' \
function='0x0'/&gt;  &lt;/interface&gt;&lt;/div&gt;&lt;div&gt;...&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;However \
when I send a big file with netper I don't see any limits applied to the transfer \
rate. &lt;div&gt;I've checked the domain log and I didn't see any qemu command line \
argument related to bandwidth limits.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Could you tell me why \
the network bandwidth limits can not work? Do network limits are managed in another \
way?&lt;/div&gt;&lt;div&gt;Thanks.&lt;/div&gt; Below some information about my hypervisor:

root@ubuntu-04:~# virsh -V
Virsh command line tool of libvirt 1.3.1
See web site at http://libvirt.org/

Compiled with support for:
 Hypervisors: QEMU/KVM LXC UML Xen LibXL OpenVZ VMWare VirtualBox ESX Test
 Networking: Remote Network Bridging Interface netcf Nwfilter VirtualPort
 Storage: Dir Disk Filesystem SCSI Multipath iSCSI LVM RBD Sheepdog ZFS
 Miscellaneous: Daemon Nodedev AppArmor Secrets Debug Readline Modular

qemu version: 2.5.0

Thanks,

Netsurfed&lt;/pre&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;span title="neteasefooter"&gt;&lt;p&gt; &lt;/p&gt;&lt;/span&gt;



</body></email><email><emailId>20170605133317</emailId><senderName>Thiago Oliveira</senderName><senderEmail>cpv.thiago@gmail.com</senderEmail><timestampReceived>2017-06-05 13:33:17-0400</timestampReceived><subject>Re: [libvirt-users] Isolate VMs' network</subject><body>

Hi there!

I would like to know the same! Currently I am using iptables to do it.

Thanks.

2017-06-05 8:58 GMT-03:00 Chris &lt;chris2014@postbox.xyz&gt;:

&gt; All,
&gt;
&gt; I'm trying to setup a network with some virtual machines, that can connect
&gt; to each other and to the internet, but neither to the host nor to other
&gt; VMs.
&gt;
&gt; Is there any preconfigured network filter or best-practice for this setup?
&gt; Of course, I could setup iptables rules on the host, but I'd prefer
&gt; libvirt to handle them.
&gt;
&gt; - Chris
&gt;
&gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi there!&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I would like to know the same! Currently \
I am using iptables to do it.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks.&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-06-05 8:58 GMT-03:00 Chris \
&lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:chris2014@postbox.xyz" \
target="_blank"&gt;chris2014@postbox.xyz&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;All,&lt;br&gt; &lt;br&gt;
I'm trying to setup a network with some virtual machines, that can connect&lt;br&gt;
to each other and to the internet, but neither to the host nor to other&lt;br&gt;
VMs.&lt;br&gt;
&lt;br&gt;
Is there any preconfigured network filter or best-practice for this setup?&lt;br&gt;
Of course, I could setup iptables rules on the host, but I'd prefer&lt;br&gt;
libvirt to handle them.&lt;br&gt;
&lt;br&gt;
- Chris&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;
&lt;a href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/&lt;wbr&gt;mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt; \
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170605134834</emailId><senderName>Timo Juhani Lindfors</senderName><senderEmail>timo.lindfors@iki.fi</senderEmail><timestampReceived>2017-06-05 13:48:34-0400</timestampReceived><subject>Re: [libvirt-users] Isolate VMs' network</subject><body>

Hi,

Thiago Oliveira &lt;cpv.thiago@gmail.com&gt; writes:
&gt; I would like to know the same! Currently I am using iptables to do it.

I use ebtables.

-Timo

</body></email><email><emailId>20170605140417</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-06-05 14:04:17-0400</timestampReceived><subject>Re: [libvirt-users] Isolate VMs' network</subject><body>

On Mon, Jun 05, 2017 at 01:58:26PM +0200, Chris wrote:
&gt; All,
&gt; 
&gt; I'm trying to setup a network with some virtual machines, that can connect
&gt; to each other and to the internet, but neither to the host nor to other
&gt; VMs.
&gt; 
&gt; Is there any preconfigured network filter or best-practice for this setup?
&gt; Of course, I could setup iptables rules on the host, but I'd prefer
&gt; libvirt to handle them.

This can be done with the libvirt nwfilter  APIs/commands, which will
automate the create/teardown of ebtables rules at vm start/stop. You
would have to ensure VMs get fixed IP addresses, and then define some
rules that block the VM subnet, except for whitelisted entries, as well
as blocking the host IP, but leaving other stuff open (to allow internet
access).

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170605140534</emailId><senderName>Holger Schranz</senderName><senderEmail>holger@fam-schranz.de</senderEmail><timestampReceived>2017-06-05 14:05:34-0400</timestampReceived><subject>Re: [libvirt-users] Isolate VMs' network</subject><body>

Hi Chris,

for all kinds of network configuration together with
virtual machines anf libvirt/QEMU I use openvswitch.

libvirt together with openvswitch make it veryeasy to
handle.

Best regards

Holger

Am 05.06.2017 um 13:58 schrieb Chris:
&gt; All,
&gt;
&gt; I'm trying to setup a network with some virtual machines, that can connect
&gt; to each other and to the internet, but neither to the host nor to other
&gt; VMs.
&gt;
&gt; Is there any preconfigured network filter or best-practice for this setup?
&gt; Of course, I could setup iptables rules on the host, but I'd prefer
&gt; libvirt to handle them.
&gt;
&gt; - Chris
&gt;
&gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users


---
Diese E-Mail wurde von Avast Antivirus-Software auf Viren geprüft.
https://www.avast.com/antivirus


</body></email><email><emailId>20170605140721</emailId><senderName>Thiago Oliveira</senderName><senderEmail>cpv.thiago@gmail.com</senderEmail><timestampReceived>2017-06-05 14:07:21-0400</timestampReceived><subject>Re: [libvirt-users] Isolate VMs' network</subject><body>

Hi Timo,

Could you please show me a rule example that you are using?

Thank you.

Thiago

2017-06-05 10:48 GMT-03:00 Timo Juhani Lindfors &lt;timo.lindfors@iki.fi&gt;:

&gt; Hi,
&gt;
&gt; Thiago Oliveira &lt;cpv.thiago@gmail.com&gt; writes:
&gt; &gt; I would like to know the same! Currently I am using iptables to do it.
&gt;
&gt; I use ebtables.
&gt;
&gt; -Timo
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi Timo,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Could you please show me a rule example \
that you are using?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank \
you.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thiago&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-06-05 10:48 GMT-03:00 Timo Juhani Lindfors &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:timo.lindfors@iki.fi" \
target="_blank"&gt;timo.lindfors@iki.fi&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;Hi,&lt;br&gt; &lt;br&gt;
Thiago Oliveira &lt;&lt;a \
href="mailto:cpv.thiago@gmail.com"&gt;cpv.thiago@gmail.com&lt;/a&gt;&gt; writes:&lt;br&gt; &gt; I \
would like to know the same! Currently I am using iptables to do it.&lt;br&gt; &lt;br&gt;
I use ebtables.&lt;br&gt;
&lt;br&gt;
-Timo&lt;br&gt;
&lt;br&gt;
______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;
&lt;a href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/&lt;wbr&gt;mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt; \
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170605143329</emailId><senderName>Timo Juhani Lindfors</senderName><senderEmail>timo.lindfors@iki.fi</senderEmail><timestampReceived>2017-06-05 14:33:29-0400</timestampReceived><subject>Re: [libvirt-users] Isolate VMs' network</subject><body>

Thiago Oliveira &lt;cpv.thiago@gmail.com&gt; writes:
&gt; Could you please show me a rule example that you are using?

Here are some rules I'm using on a development VM. I think most of the
ideas come from the ebtables rules used by libvirt itself. These just
prevent IP spoofing. After this you can use IP addresses for access
control much better.

ebtables -t nat -A PREROUTING -i dev-home -j i-dev
ebtables -t nat -A POSTROUTING -o dev-home -j o-dev

ebtables -t nat -A i-dev -p IPv4 -j i-dev-ipv4
ebtables -t nat -A i-dev -p ARP -j i-dev-arp
ebtables -t nat -A i-dev -j DROP

ebtables -t nat -A o-dev -p IPv4 -j o-dev-ipv4
ebtables -t nat -A o-dev -p ARP -j o-dev-arp
ebtables -t nat -A o-dev -j DROP

ebtables -t nat -A i-dev-ipv4 -s ! [CENSORED] -j DROP
ebtables -t nat -A i-dev-ipv4 -p IPv4 --ip-src ! [CENSORED] -j DROP
ebtables -t nat -A i-dev-ipv4 -p IPv4 --ip-dst ! [CENSORED] -j DROP

ebtables -t nat -A o-dev-ipv4 -p IPv4 --ip-src ! [CENSORED] -j DROP
ebtables -t nat -A o-dev-ipv4 -j ACCEPT

ebtables -t nat -A i-dev-arp -s ! [CENSORED] -j DROP
ebtables -t nat -A i-dev-arp -p ARP --arp-mac-src ! [CENSORED] -j DROP
ebtables -t nat -A i-dev-arp -p ARP --arp-ip-src ! [CENSORED] -j DROP
ebtables -t nat -A i-dev-arp -p ARP --arp-op Request -j ACCEPT
ebtables -t nat -A i-dev-arp -p ARP --arp-op Reply -j ACCEPT
ebtables -t nat -A i-dev-arp -j DROP

ebtables -t nat -A o-dev-arp -p ARP --arp-op Reply --arp-mac-dst ! [CENSORED] -j DROP
ebtables -t nat -A o-dev-arp -p ARP --arp-ip-dst ! [CENSORED] -j DROP
ebtables -t nat -A o-dev-arp -p ARP --arp-op Request -j ACCEPT
ebtables -t nat -A o-dev-arp -p ARP --arp-op Reply -j ACCEPT
ebtables -t nat -A o-dev-arp -j DROP

-Timo

</body></email><email><emailId>20170606185045</emailId><senderName>"Chris"</senderName><senderEmail>chris2014@postbox.xyz</senderEmail><timestampReceived>2017-06-06 18:50:45-0400</timestampReceived><subject>Re: [libvirt-users] Isolate VMs' network</subject><body>

Chris wrote:
&gt; I'm trying to setup a network with some virtual machines, that can connect
&gt; to each other and to the internet, but neither to the host nor to other
&gt; VMs.

Thank you for your replies. Unfortunately, I didn't mention, that I'd like
to be able to test malicious software, so my network filtering shouldn't
depend on the guests' IP addresses. I think I have to setup a new virtual
"virus" interface and configure iptables on the host for this interface.
Is this possible?

- Chris

</body></email><email><emailId>20170606210309</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-06-06 21:03:09-0400</timestampReceived><subject>Re: [libvirt-users] Isolate VMs' network</subject><body>

On Tue, Jun 06, 2017 at 08:50:45PM +0200, Chris wrote:
&gt; Chris wrote:
&gt; &gt; I'm trying to setup a network with some virtual machines, that can connect
&gt; &gt; to each other and to the internet, but neither to the host nor to other
&gt; &gt; VMs.
&gt; 
&gt; Thank you for your replies. Unfortunately, I didn't mention, that I'd like
&gt; to be able to test malicious software, so my network filtering shouldn't
&gt; depend on the guests' IP addresses. I think I have to setup a new virtual
&gt; "virus" interface and configure iptables on the host for this interface.
&gt; Is this possible?

You can use the network filters to setup antispoofing protection for both
IP addresses and MAC addresses. In fact this is what the "clean-traffic"
example filter libvirt provides will do for you.

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170607023727</emailId><senderName>Thiago Oliveira</senderName><senderEmail>cpv.thiago@gmail.com</senderEmail><timestampReceived>2017-06-07 02:37:27-0400</timestampReceived><subject>Re: [libvirt-users] Isolate VMs' network</subject><body>

Daniel,

Are you talking about XML? If yes, could please show us an example?

Thank you.

Thiago

2017-06-06 18:03 GMT-03:00 Daniel P. Berrange &lt;berrange@redhat.com&gt;:

&gt; On Tue, Jun 06, 2017 at 08:50:45PM +0200, Chris wrote:
&gt; &gt; Chris wrote:
&gt; &gt; &gt; I'm trying to setup a network with some virtual machines, that can
&gt; connect
&gt; &gt; &gt; to each other and to the internet, but neither to the host nor to other
&gt; &gt; &gt; VMs.
&gt; &gt;
&gt; &gt; Thank you for your replies. Unfortunately, I didn't mention, that I'd
&gt; like
&gt; &gt; to be able to test malicious software, so my network filtering shouldn't
&gt; &gt; depend on the guests' IP addresses. I think I have to setup a new virtual
&gt; &gt; "virus" interface and configure iptables on the host for this interface.
&gt; &gt; Is this possible?
&gt;
&gt; You can use the network filters to setup antispoofing protection for both
&gt; IP addresses and MAC addresses. In fact this is what the "clean-traffic"
&gt; example filter libvirt provides will do for you.
&gt;
&gt; Regards,
&gt; Daniel
&gt; --
&gt; |: https://berrange.com      -o-    https://www.flickr.com/photos/
&gt; dberrange :|
&gt; |: https://libvirt.org         -o-
&gt; https://fstop138.berrange.com :|
&gt; |: https://entangle-photo.org    -o-    https://www.instagram.com/
&gt; dberrange :|
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Daniel,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Are you talking about XML? If yes, could \
please show us an example?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank \
you.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thiago&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-06-06 18:03 GMT-03:00 Daniel P. Berrange &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:berrange@redhat.com" \
target="_blank"&gt;berrange@redhat.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;On Tue, Jun 06, 2017 at 08:50:45PM +0200, Chris wrote:&lt;br&gt; \
&gt; Chris wrote:&lt;br&gt; &gt; &gt; I'm trying to setup a network with some virtual \
machines, that can connect&lt;br&gt; &gt; &gt; to each other and to the internet, but \
neither to the host nor to other&lt;br&gt; &gt; &gt; VMs.&lt;br&gt;
&gt;&lt;br&gt;
&gt; Thank you for your replies. Unfortunately, I didn't mention, that I'd \
like&lt;br&gt; &gt; to be able to test malicious software, so my network filtering \
shouldn't&lt;br&gt; &gt; depend on the guests' IP addresses. I think I have to \
setup a new virtual&lt;br&gt; &gt; "virus" interface and configure iptables on \
the host for this interface.&lt;br&gt; &gt; Is this possible?&lt;br&gt;
&lt;br&gt;
You can use the network filters to setup antispoofing protection for both&lt;br&gt;
IP addresses and MAC addresses. In fact this is what the \
"clean-traffic"&lt;br&gt; example filter libvirt provides will do for you.&lt;br&gt;
&lt;br&gt;
Regards,&lt;br&gt;
Daniel&lt;br&gt;
&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;--&lt;br&gt;
&gt; &gt; &lt;a href="https://berrange.com" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://berrange.com&lt;/a&gt;         -o-      &lt;a \
&gt; &gt; href="https://www.flickr.com/photos/dberrange" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://www.flickr.com/photos/&lt;wbr&gt;dberrange&lt;/a&gt; :|&lt;br&gt;
&gt; &gt; &lt;a href="https://libvirt.org" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://libvirt.org&lt;/a&gt;              -o-                  &lt;a \
&gt; &gt; href="https://fstop138.berrange.com" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://fstop138.berrange.com&lt;/a&gt; :|&lt;br&gt;
&gt; &gt; &lt;a href="https://entangle-photo.org" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://entangle-photo.org&lt;/a&gt;      -o-      &lt;a \
&gt; &gt; href="https://www.instagram.com/dberrange" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://www.instagram.com/&lt;wbr&gt;dberrange&lt;/a&gt; :|&lt;br&gt;
&lt;br&gt;
______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;
&lt;a href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/&lt;wbr&gt;mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170607082526</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-06-07 08:25:26-0400</timestampReceived><subject>Re: [libvirt-users] Isolate VMs' network</subject><body>

On Tue, Jun 06, 2017 at 11:37:27PM -0300, Thiago Oliveira wrote:
&gt; Daniel,
&gt; 
&gt; Are you talking about XML? If yes, could please show us an example?

&lt;domain&gt;
  ...
  &lt;devices&gt;
    ....
    &lt;interface type='bridge'&gt;
      &lt;mac address='00:16:3e:5d:c7:9e'/&gt;
      &lt;filterref filter='clean-traffic'/&gt;
    &lt;/interface&gt;
    ....
  &lt;/devices&gt;
  ...
&lt;/domain&gt;

There is quite alot more info here:

http://libvirt.org/formatnwfilter.html
http://libvirt.org/firewall.html


Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170607183255</emailId><senderName>Thiago Oliveira</senderName><senderEmail>cpv.thiago@gmail.com</senderEmail><timestampReceived>2017-06-07 18:32:55-0400</timestampReceived><subject>Re: [libvirt-users] Isolate VMs' network</subject><body>

Hi Daniel,

I added the option &lt;filterref filter='clean-traffic'/&gt; and my VM stop to
ping the gateway and the others VM's in the same host.
I would like to prevent that VM's in differents subnets can ping or spoof
others VM's. Each subnet is related with a customer and I would like to
separete the traffic like VLAN does.

Is this possible with some options in xml ?

Thank you very much.

Thiago







2017-06-07 5:25 GMT-03:00 Daniel P. Berrange &lt;berrange@redhat.com&gt;:

&gt; On Tue, Jun 06, 2017 at 11:37:27PM -0300, Thiago Oliveira wrote:
&gt; &gt; Daniel,
&gt; &gt;
&gt; &gt; Are you talking about XML? If yes, could please show us an example?
&gt;
&gt; &lt;domain&gt;
&gt;   ...
&gt;   &lt;devices&gt;
&gt;     ....
&gt;     &lt;interface type='bridge'&gt;
&gt;       &lt;mac address='00:16:3e:5d:c7:9e'/&gt;
&gt;       &lt;filterref filter='clean-traffic'/&gt;
&gt;     &lt;/interface&gt;
&gt;     ....
&gt;   &lt;/devices&gt;
&gt;   ...
&gt; &lt;/domain&gt;
&gt;
&gt; There is quite alot more info here:
&gt;
&gt; http://libvirt.org/formatnwfilter.html
&gt; http://libvirt.org/firewall.html
&gt;
&gt;
&gt; Regards,
&gt; Daniel
&gt; --
&gt; |: https://berrange.com      -o-    https://www.flickr.com/photos/
&gt; dberrange :|
&gt; |: https://libvirt.org         -o-
&gt; https://fstop138.berrange.com :|
&gt; |: https://entangle-photo.org    -o-    https://www.instagram.com/
&gt; dberrange :|
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi Daniel,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I added the option  &lt;span \
style="font-size:12.8px"&gt;&lt;filterref filter='clean-traffic'/&gt; and my VM \
stop to ping the gateway and the others VM's in the same \
host.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;I would like to prevent that \
VM's in differents subnets can ping or spoof others VM's. Each subnet is \
related with a customer and I would like to separete the traffic like VLAN \
does.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;Is this possible with some options in xml \
?&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;Thank you very much.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;Thiago&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-06-07 5:25 GMT-03:00 Daniel P. Berrange &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:berrange@redhat.com" \
target="_blank"&gt;berrange@redhat.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;On Tue, Jun 06, 2017 at 11:37:27PM -0300, Thiago Oliveira \
wrote:&lt;br&gt; &gt; Daniel,&lt;br&gt;
&gt;&lt;br&gt;
&gt; Are you talking about XML? If yes, could please show us an example?&lt;br&gt;
&lt;br&gt;
&lt;domain&gt;&lt;br&gt;
   ...&lt;br&gt;
   &lt;devices&gt;&lt;br&gt;
      ....&lt;br&gt;
      &lt;interface type='bridge'&gt;&lt;br&gt;
         &lt;mac address='00:16:3e:5d:c7:9e'/&gt;&lt;br&gt;
         &lt;filterref filter='clean-traffic'/&gt;&lt;br&gt;
      &lt;/interface&gt;&lt;br&gt;
      ....&lt;br&gt;
   &lt;/devices&gt;&lt;br&gt;
   ...&lt;br&gt;
&lt;/domain&gt;&lt;br&gt;
&lt;br&gt;
There is quite alot more info here:&lt;br&gt;
&lt;br&gt;
&lt;a href="http://libvirt.org/formatnwfilter.html" rel="noreferrer" \
target="_blank"&gt;http://libvirt.org/&lt;wbr&gt;formatnwfilter.html&lt;/a&gt;&lt;br&gt; &lt;a \
href="http://libvirt.org/firewall.html" rel="noreferrer" \
target="_blank"&gt;http://libvirt.org/firewall.&lt;wbr&gt;html&lt;/a&gt;&lt;br&gt; &lt;br&gt;
&lt;br&gt;
Regards,&lt;br&gt;
Daniel&lt;br&gt;
&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;--&lt;br&gt;
&gt; &gt; &lt;a href="https://berrange.com" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://berrange.com&lt;/a&gt;         -o-      &lt;a \
&gt; &gt; href="https://www.flickr.com/photos/dberrange" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://www.flickr.com/photos/&lt;wbr&gt;dberrange&lt;/a&gt; :|&lt;br&gt;
&gt; &gt; &lt;a href="https://libvirt.org" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://libvirt.org&lt;/a&gt;              -o-                  &lt;a \
&gt; &gt; href="https://fstop138.berrange.com" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://fstop138.berrange.com&lt;/a&gt; :|&lt;br&gt;
&gt; &gt; &lt;a href="https://entangle-photo.org" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://entangle-photo.org&lt;/a&gt;      -o-      &lt;a \
&gt; &gt; href="https://www.instagram.com/dberrange" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://www.instagram.com/&lt;wbr&gt;dberrange&lt;/a&gt; :|&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170601135652</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-06-01 13:56:52-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd not accepting connections</subject><body>


On Thu, Jun 01, 2017 at 08:47:55AM -0400, Michael C. Cambria wrote:
&gt;
&gt;Hi,
&gt;
&gt;Ever since I recently upgraded to Fedora 25, I can't get kvm working.

It's not really about KVM but about libvirt.  So the daemon is running...

&gt;It's worked on this system since initial fedora 20 install.  All
&gt;upgrades were done via yum, then once available, dnf.
&gt;
&gt;I do have libvirt-sock in LISTENING state:   STREAM     LISTENING
&gt;/var/run/libvirt/libvirt-sock
&gt;
&gt;I noticed I also have multiple connections in CONNECTING state:
&gt;
&gt;STREAM     CONNECTING    0        /var/run/libvirt/libvirt-sock
&gt;STREAM     CONNECTING    0        /var/run/libvirt/libvirt-sock
&gt;STREAM     CONNECTING    0        /var/run/libvirt/libvirt-sock
&gt;
&gt;I rebooted and tried again.  Each e.g. 'virsh -c" or virt-manager
&gt;command I issue, I end up with another socket in CONNECTING state.
&gt;restarting libvirtd.service close them leaving just one LISTENING
&gt;
&gt;strace for virsh -c shows:
&gt;
&gt;
&gt;4301  socket(AF_UNIX, SOCK_STREAM, 0)   = 5
&gt;4301  connect(5, {sa_family=AF_UNIX,
&gt;sun_path="/var/run/libvirt/libvirt-sock"}, 110) = 0
&gt;4301  getsockname(5, {sa_family=AF_UNIX}, [128-&gt;2]) = 0
&gt;4301  futex(0x7f3c0a2e4fc8, FUTEX_WAKE_PRIVATE, 2147483647) = 0
&gt;4301  fcntl(5, F_GETFD)                 = 0
&gt;4301  fcntl(5, F_SETFD, FD_CLOEXEC)     = 0
&gt;4301  fcntl(5, F_GETFL)                 = 0x2 (flags O_RDWR)
&gt;4301  fcntl(5, F_SETFL, O_RDWR|O_NONBLOCK) = 0
&gt;

virsh is just waiting for the daemon, there's no useful info.

&gt;systemctl status libvirtd.service and journalctl -f -u libvirtd.service
&gt;do not show any log entries for libvird after it has been started.  e.g.
&gt;it doesn't log anything about the connection attempts.
&gt;
&gt;Anyone have an idea where to look next?
&gt;

Check if the daemon is running, check any possible QEMU processes that
might be running, enable debug logs for libvirtd [1] and try grabbing a
backtrace of the process (For example `gdb -batch -p $(pidof libvirtd)
-ex "t a a bt full"' after you install debuginfo packages).

&gt;Thanks,
&gt;MikeC
&gt;
&gt;
&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170602134356</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-06-02 13:43:56-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd not accepting connections</subject><body>


[adding back the ML, you probably hit reply instead of reply-all, this
 way other people might help if they know more]

On Fri, Jun 02, 2017 at 08:10:01AM -0400, Michael C. Cambria wrote:
&gt;
&gt;Hi,
&gt;
&gt;libvirtd never seems to get notified that there is work to do. journalct
&gt;-f indicated that nothing was logged when connections were attempted via
&gt;virsh.
&gt;
&gt;I also tried 'LIBVIRT_DEBUG=1 libvirtd --verbose' and once startup
&gt;finished, there were no more log entries even though virsh attempts were
&gt;made.
&gt;

That's because it gets overridden by the configuration files.  This
might be a bug, but it's not related to what's happening.

&gt;"ps ax" shows about a dozen "qemu-system-alpha" processes.  I don't know
&gt;if it matters but I didn't expect to see this.  I didn't intentionally
&gt;configure alpha emulations (assuming that's what it is) and certainly
&gt;don't want to waste resources having it running.
&gt;

Libvirt caches the capabilities of the emulators it can find in your
system in order not to waste resources.  These processes are expected to
go away after they reply with all libvirt asks them for.  However, it
seems like the initialization cannot be completed precisely due to the
fact that these processes don't communicate.

There might be some details about qemu-system-alpha that are different
when compared to, e.g. qemu-system-x86 and libvirt is not (yet) adapted
to them, but I installed that emulator and libvirt daemon runs as
usual.  It looks like a problem in QEMU.  Could you, as a workaround,
try uninstalling that qemu binary from your system and restarting the
service?

Also, what versions of libvirt and qemu do you have installed?

&gt;Here is gdb output:
&gt;
&gt;$ sudo gdb -batch -p $(pidof libvirtd) -ex "t a a bt full" &gt; batch.out
&gt;[mcc@eastie-fid4-com triage]$ cat batch.out
&gt;[New LWP 17587]
&gt;[New LWP 17588]
&gt;[New LWP 17589]
&gt;[New LWP 17590]
&gt;[New LWP 17591]
&gt;[New LWP 17592]
&gt;[New LWP 17593]
&gt;[New LWP 17594]
&gt;[New LWP 17595]
&gt;[New LWP 17596]
&gt;[New LWP 17597]
&gt;[New LWP 17598]
&gt;[New LWP 17599]
&gt;[New LWP 17600]
&gt;[New LWP 17601]
&gt;[New LWP 17602]
&gt;[Thread debugging using libthread_db enabled]
&gt;Using host libthread_db library "/lib64/libthread_db.so.1".
&gt;0x00007fcd6b4a501d in poll () at ../sysdeps/unix/syscall-template.S:84
&gt;84      T_PSEUDO (SYSCALL_SYMBOL, SYSCALL_NAME, SYSCALL_NARGS)
&gt;
&gt;Thread 17 (Thread 0x7fcd3bf18700 (LWP 17602)):
&gt;#0  0x00007fcd6b4a501d in poll () at ../sysdeps/unix/syscall-template.S:84
&gt;No locals.
&gt;#1  0x00007fcd6b4c310e in __poll_chk (fds=&lt;optimized out&gt;,
&gt;nfds=&lt;optimized out&gt;, timeout=&lt;optimized out&gt;, fdslen=&lt;optimized out&gt;)
&gt;at poll_chk.c:27
&gt;No locals.
&gt;#2  0x00007fcd6f07bf41 in poll (__timeout=-1, __nfds=&lt;optimized out&gt;,
&gt;__fds=0x7fcd3bf16ec0) at /usr/include/bits/poll2.h:41
&gt;No locals.
&gt;#3  virCommandProcessIO (cmd=cmd@entry=0x7fcd344228f0) at
&gt;util/vircommand.c:2049
&gt;         i = &lt;optimized out&gt;
&gt;         fds = {{fd = 22, events = 1, revents = 0}, {fd = 24, events =
&gt;1, revents = 0}, {fd = 1802946632, events = 32717, revents = 0}}
&gt;         nfds = &lt;optimized out&gt;
&gt;         outfd = &lt;optimized out&gt;
&gt;         errfd = 24
&gt;         inlen = 0
&gt;         outlen = 0
&gt;         errlen = 0
&gt;         inoff = 0
&gt;         ret = 0
&gt;         __func__ = "virCommandProcessIO"
&gt;         __FUNCTION__ = "virCommandProcessIO"
&gt;#4  0x00007fcd6f08025a in virCommandRun (cmd=cmd@entry=0x7fcd344228f0,
&gt;exitstatus=exitstatus@entry=0x7fcd3bf1749c) at util/vircommand.c:2274
&gt;         ret = 0
&gt;         outbuf = 0x7fcd341c1850 "`\030\034\064\315\177"
&gt;         errbuf = 0x0
&gt;         st = {st_dev = 140519450702688, st_ino = 5007254661694877440,
&gt;st_nlink = 140519321774352, st_mode = 1862726288, st_uid = 32717, st_gid
&gt;= 1865325018, __pad0 = 32717, st_rdev = 140732281970554, st_size = 0,
&gt;st_blksize = 11, st_blocks = 8, st_atim = {tv_sec = 140519321774368,
&gt;tv_nsec = 140519450703056}, st_mtim = {tv_sec = 140519321774352, tv_nsec
&gt;= 140519450703024}, st_ctim = {tv_sec = 140520244259750, tv_nsec =
&gt;140520310044608}, __glibc_reserved = {140520244259750, 140520310041179,
&gt;140519321774320}}
&gt;         string_io = &lt;optimized out&gt;
&gt;         async_io = &lt;optimized out&gt;
&gt;         str = 0x7fcd3bf17420 "\260t\361;\315\177"
&gt;         tmpfd = &lt;optimized out&gt;
&gt;         __FUNCTION__ = "virCommandRun"
&gt;         __func__ = "virCommandRun"
&gt;#5  0x00007fcd404a27cf in virQEMUCapsInitQMP (qmperr=0x7fcd3bf174a0,
&gt;runGid=107, runUid=107, libDir=&lt;optimized out&gt;, qemuCaps=0x7fcd340fd3e0)
&gt;at qemu/qemu_capabilities.c:3700
&gt;         cmd = 0x7fcd344228f0
&gt;         pid = 0
&gt;         ret = -1
&gt;         mon = 0x0
&gt;         status = 0
&gt;         monarg = 0x7fcd343a2570
&gt;"unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait"
&gt;         vm = 0x0
&gt;         config = {type = 9, data = {file = {path = 0x7fcd34151d90
&gt;"/var/lib/libvirt/qemu/capabilities.monitor.sock", append = 0}, nmdm =
&gt;{master = 0x7fcd34151d90
&gt;"/var/lib/libvirt/qemu/capabilities.monitor.sock", slave = 0x0}, tcp =
&gt;{host = 0x7fcd34151d90
&gt;"/var/lib/libvirt/qemu/capabilities.monitor.sock", service = 0x0, listen
&gt;= false, protocol = 0}, udp = {bindHost = 0x7fcd34151d90
&gt;"/var/lib/libvirt/qemu/capabilities.monitor.sock", bindService = 0x0,
&gt;connectHost = 0x0, connectService = 0x0}, nix = {path = 0x7fcd34151d90
&gt;"/var/lib/libvirt/qemu/capabilities.monitor.sock", listen = false},
&gt;spicevmc = 873799056, spiceport = {channel = 0x7fcd34151d90
&gt;"/var/lib/libvirt/qemu/capabilities.monitor.sock"}}, logfile = 0x0,
&gt;logappend = 0}
&gt;         monpath = 0x7fcd34151d90
&gt;"/var/lib/libvirt/qemu/capabilities.monitor.sock"
&gt;         pidfile = 0x7fcd341ad8b0
&gt;"/var/lib/libvirt/qemu/capabilities.pidfile"
&gt;         xmlopt = 0x0
&gt;#6  virQEMUCapsNewForBinaryInternal (binary=binary@entry=0x7fcd34016cb0
&gt;"/usr/bin/qemu-system-alpha", libDir=&lt;optimized out&gt;,
&gt;cacheDir=0x7fcd343be860 "/var/cache/libvirt/qemu", runUid=107,
&gt;runGid=107, qmpOnly=qmpOnly@entry=false) at qemu/qemu_capabilities.c:3830
&gt;         qemuCaps = 0x7fcd340fd3e0
&gt;         sb = {st_dev = 64768, st_ino = 1838294, st_nlink = 1, st_mode =
&gt;33261, st_uid = 0, st_gid = 0, __pad0 = 0, st_rdev = 0, st_size =
&gt;8829680, st_blksize = 4096, st_blocks = 17248, st_atim = {tv_sec =
&gt;1496358589, tv_nsec = 77994286}, st_mtim = {tv_sec = 1492132244, tv_nsec
&gt;= 0}, st_ctim = {tv_sec = 1494196699, tv_nsec = 451929606},
&gt;__glibc_reserved = {0, 0, 0}}
&gt;         rv = &lt;optimized out&gt;
&gt;         qmperr = 0x7fcd341c1870 ""
&gt;         __FUNCTION__ = "virQEMUCapsNewForBinaryInternal"
&gt;#7  0x00007fcd404a3a73 in virQEMUCapsNewForBinary (runGid=&lt;optimized
&gt;out&gt;, runUid=&lt;optimized out&gt;, cacheDir=&lt;optimized out&gt;,
&gt;libDir=&lt;optimized out&gt;, binary=0x7fcd34016cb0
&gt;"/usr/bin/qemu-system-alpha") at qemu/qemu_capabilities.c:3871
&gt;No locals.
&gt;#8  virQEMUCapsCacheLookup (cache=cache@entry=0x7fcd341c9000,
&gt;binary=0x7fcd34016cb0 "/usr/bin/qemu-system-alpha") at
&gt;qemu/qemu_capabilities.c:3986
&gt;         ret = 0x0
&gt;         __func__ = "virQEMUCapsCacheLookup"
&gt;#9  0x00007fcd404a3d22 in virQEMUCapsInitGuest
&gt;(guestarch=VIR_ARCH_ALPHA, hostarch=VIR_ARCH_X86_64,
&gt;cache=0x7fcd341c9000, caps=0x7fcd341a9980) at qemu/qemu_capabilities.c:824
&gt;         qemubinCaps = 0x0
&gt;         x86_32on64_kvm = &lt;optimized out&gt;
&gt;         ppc64_kvm = &lt;optimized out&gt;
&gt;         kvmbin = 0x0
&gt;         ret = -1
&gt;         i = &lt;optimized out&gt;
&gt;         binary = 0x7fcd34016cb0 "/usr/bin/qemu-system-alpha"
&gt;         kvmbinCaps = 0x0
&gt;         native_kvm = &lt;optimized out&gt;
&gt;         arm_32on64_kvm = &lt;optimized out&gt;
&gt;#10 virQEMUCapsInit (cache=0x7fcd341c9000) at qemu/qemu_capabilities.c:1109
&gt;         caps = 0x7fcd341a9980
&gt;         i = 1
&gt;         hostarch = VIR_ARCH_X86_64
&gt;         __func__ = "virQEMUCapsInit"
&gt;#11 0x00007fcd404def20 in virQEMUDriverCreateCapabilities
&gt;(driver=driver@entry=0x7fcd34342370) at qemu/qemu_conf.c:766
&gt;         i = &lt;optimized out&gt;
&gt;         j = &lt;optimized out&gt;
&gt;         caps = &lt;optimized out&gt;
&gt;         sec_managers = 0x0
&gt;         doi = &lt;optimized out&gt;
&gt;         model = &lt;optimized out&gt;
&gt;         lbl = &lt;optimized out&gt;
&gt;         type = &lt;optimized out&gt;
&gt;         cfg = 0x7fcd3448cbb0
&gt;         virtTypes = {3, 1}
&gt;         __FUNCTION__ = "virQEMUDriverCreateCapabilities"
&gt;         __func__ = "virQEMUDriverCreateCapabilities"
&gt;#12 0x00007fcd4051fef3 in qemuStateInitialize (privileged=true,
&gt;callback=&lt;optimized out&gt;, opaque=&lt;optimized out&gt;) at qemu/qemu_driver.c:844
&gt;         driverConf = 0x0
&gt;         conn = 0x0
&gt;         cfg = 0x7fcd3448cbb0
&gt;         run_uid = &lt;optimized out&gt;
&gt;         run_gid = &lt;optimized out&gt;
&gt;         hugepagePath = 0x0
&gt;         i = &lt;optimized out&gt;
&gt;         __FUNCTION__ = "qemuStateInitialize"
&gt;#13 0x00007fcd6f1789af in virStateInitialize (privileged=&lt;optimized
&gt;out&gt;, callback=0x55f56a9b3180 &lt;daemonInhibitCallback&gt;,
&gt;opaque=0x55f56be1cf00) at libvirt.c:770
&gt;         i = 9
&gt;         __func__ = "virStateInitialize"
&gt;#14 0x000055f56a9b31db in daemonRunStateInit (opaque=0x55f56be1cf00) at
&gt;libvirtd.c:959
&gt;         dmn = 0x55f56be1cf00
&gt;         sysident = 0x7fcd34000910
&gt;         __func__ = "daemonRunStateInit"
&gt;#15 0x00007fcd6f0d98f2 in virThreadHelper (data=&lt;optimized out&gt;) at
&gt;util/virthread.c:206
&gt;         args = 0x0
&gt;         local = {func = 0x55f56a9b31a0 &lt;daemonRunStateInit&gt;, funcName =
&gt;0x55f56a9f28d3 "daemonRunStateInit", worker = false, opaque =
&gt;0x55f56be1cf00}
&gt;#16 0x00007fcd6b7766ca in start_thread (arg=0x7fcd3bf18700) at
&gt;pthread_create.c:333
&gt;         __res = &lt;optimized out&gt;
&gt;         pd = 0x7fcd3bf18700
&gt;         now = &lt;optimized out&gt;
&gt;         unwind_buf = {cancel_jmp_buf = {{jmp_buf = {140519450707712,
&gt;-3574063505887647860, 0, 140732281962543, 140519450708416,
&gt;140519450707712, 3601779982174594956, 3601954753778231180},
&gt;mask_was_saved = 0}}, priv = {pad = {0x0, 0x0, 0x0, 0x0}, data = {prev =
&gt;0x0, cleanup = 0x0, canceltype = 0}}}
&gt;         not_first_call = &lt;optimized out&gt;
&gt;         pagesize_m1 = &lt;optimized out&gt;
&gt;         sp = &lt;optimized out&gt;
&gt;         freesize = &lt;optimized out&gt;
&gt;         __PRETTY_FUNCTION__ = "start_thread"
&gt;#17 0x00007fcd6b4b0f7f in clone () at
&gt;.../sysdeps/unix/sysv/linux/x86_64/clone.S:105
&gt;No locals.
&gt;

[...]

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170602135307</emailId><senderName>"Michael C. Cambria"</senderName><senderEmail>mcc@fid4.com</senderEmail><timestampReceived>2017-06-02 13:53:07-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd not accepting connections</subject><body>



On 06/02/2017 09:43 AM, Martin Kletzander wrote:
&gt; [adding back the ML, you probably hit reply instead of reply-all, this
&gt; way other people might help if they know more]
&gt;
&gt; On Fri, Jun 02, 2017 at 08:10:01AM -0400, Michael C. Cambria wrote:
&gt;&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; libvirtd never seems to get notified that there is work to do. journalct
&gt;&gt; -f indicated that nothing was logged when connections were attempted via
&gt;&gt; virsh.
&gt;&gt;
&gt;&gt; I also tried 'LIBVIRT_DEBUG=1 libvirtd --verbose' and once startup
&gt;&gt; finished, there were no more log entries even though virsh attempts were
&gt;&gt; made.
&gt;&gt;
&gt;
&gt; That's because it gets overridden by the configuration files. This
&gt; might be a bug, but it's not related to what's happening.
&gt;
&gt;&gt; "ps ax" shows about a dozen "qemu-system-alpha" processes.  I don't know
&gt;&gt; if it matters but I didn't expect to see this.  I didn't intentionally
&gt;&gt; configure alpha emulations (assuming that's what it is) and certainly
&gt;&gt; don't want to waste resources having it running.
&gt;&gt;
&gt;
&gt; Libvirt caches the capabilities of the emulators it can find in your
&gt; system in order not to waste resources.  These processes are expected to
&gt; go away after they reply with all libvirt asks them for.  However, it
&gt; seems like the initialization cannot be completed precisely due to the
&gt; fact that these processes don't communicate.
&gt;
&gt; There might be some details about qemu-system-alpha that are different
&gt; when compared to, e.g. qemu-system-x86 and libvirt is not (yet) adapted
&gt; to them, but I installed that emulator and libvirt daemon runs as
&gt; usual.  It looks like a problem in QEMU.  Could you, as a workaround,
&gt; try uninstalling that qemu binary from your system and restarting the
&gt; service?
&gt;
&gt; Also, what versions of libvirt and qemu do you have installed?

# LIBVIRT_DEBUG=1 libvirtd --verbose
2017-06-02 00:16:30.317+0000: 18088: info : libvirt version: 2.2.1, 
package: 1.fc25 (Fedora Project, 2017-05-10-22:06:21, 
buildvm-29.phx2.fedoraproject.org)

I'll check on qemu as soon as I can get to the machine.  The version 
should be the latest one gets via 'dnf update' on fedora 25

&gt;
&gt;&gt; Here is gdb output:
&gt;&gt;
&gt;&gt; $ sudo gdb -batch -p $(pidof libvirtd) -ex "t a a bt full" &gt; batch.out
&gt;&gt; [mcc@eastie-fid4-com triage]$ cat batch.out
&gt;&gt; [New LWP 17587]
&gt;&gt; [New LWP 17588]
&gt;&gt; [New LWP 17589]
&gt;&gt; [New LWP 17590]
&gt;&gt; [New LWP 17591]
&gt;&gt; [New LWP 17592]
&gt;&gt; [New LWP 17593]
&gt;&gt; [New LWP 17594]
&gt;&gt; [New LWP 17595]
&gt;&gt; [New LWP 17596]
&gt;&gt; [New LWP 17597]
&gt;&gt; [New LWP 17598]
&gt;&gt; [New LWP 17599]
&gt;&gt; [New LWP 17600]
&gt;&gt; [New LWP 17601]
&gt;&gt; [New LWP 17602]
&gt;&gt; [Thread debugging using libthread_db enabled]
&gt;&gt; Using host libthread_db library "/lib64/libthread_db.so.1".
&gt;&gt; 0x00007fcd6b4a501d in poll () at ../sysdeps/unix/syscall-template.S:84
&gt;&gt; 84      T_PSEUDO (SYSCALL_SYMBOL, SYSCALL_NAME, SYSCALL_NARGS)
&gt;&gt;
&gt;&gt; Thread 17 (Thread 0x7fcd3bf18700 (LWP 17602)):
&gt;&gt; #0  0x00007fcd6b4a501d in poll () at 
&gt;&gt; ../sysdeps/unix/syscall-template.S:84
&gt;&gt; No locals.
&gt;&gt; #1  0x00007fcd6b4c310e in __poll_chk (fds=&lt;optimized out&gt;,
&gt;&gt; nfds=&lt;optimized out&gt;, timeout=&lt;optimized out&gt;, fdslen=&lt;optimized out&gt;)
&gt;&gt; at poll_chk.c:27
&gt;&gt; No locals.
&gt;&gt; #2  0x00007fcd6f07bf41 in poll (__timeout=-1, __nfds=&lt;optimized out&gt;,
&gt;&gt; __fds=0x7fcd3bf16ec0) at /usr/include/bits/poll2.h:41
&gt;&gt; No locals.
&gt;&gt; #3  virCommandProcessIO (cmd=cmd@entry=0x7fcd344228f0) at
&gt;&gt; util/vircommand.c:2049
&gt;&gt;         i = &lt;optimized out&gt;
&gt;&gt;         fds = {{fd = 22, events = 1, revents = 0}, {fd = 24, events =
&gt;&gt; 1, revents = 0}, {fd = 1802946632, events = 32717, revents = 0}}
&gt;&gt;         nfds = &lt;optimized out&gt;
&gt;&gt;         outfd = &lt;optimized out&gt;
&gt;&gt;         errfd = 24
&gt;&gt;         inlen = 0
&gt;&gt;         outlen = 0
&gt;&gt;         errlen = 0
&gt;&gt;         inoff = 0
&gt;&gt;         ret = 0
&gt;&gt;         __func__ = "virCommandProcessIO"
&gt;&gt;         __FUNCTION__ = "virCommandProcessIO"
&gt;&gt; #4  0x00007fcd6f08025a in virCommandRun (cmd=cmd@entry=0x7fcd344228f0,
&gt;&gt; exitstatus=exitstatus@entry=0x7fcd3bf1749c) at util/vircommand.c:2274
&gt;&gt;         ret = 0
&gt;&gt;         outbuf = 0x7fcd341c1850 "`\030\034\064\315\177"
&gt;&gt;         errbuf = 0x0
&gt;&gt;         st = {st_dev = 140519450702688, st_ino = 5007254661694877440,
&gt;&gt; st_nlink = 140519321774352, st_mode = 1862726288, st_uid = 32717, st_gid
&gt;&gt; = 1865325018, __pad0 = 32717, st_rdev = 140732281970554, st_size = 0,
&gt;&gt; st_blksize = 11, st_blocks = 8, st_atim = {tv_sec = 140519321774368,
&gt;&gt; tv_nsec = 140519450703056}, st_mtim = {tv_sec = 140519321774352, tv_nsec
&gt;&gt; = 140519450703024}, st_ctim = {tv_sec = 140520244259750, tv_nsec =
&gt;&gt; 140520310044608}, __glibc_reserved = {140520244259750, 140520310041179,
&gt;&gt; 140519321774320}}
&gt;&gt;         string_io = &lt;optimized out&gt;
&gt;&gt;         async_io = &lt;optimized out&gt;
&gt;&gt;         str = 0x7fcd3bf17420 "\260t\361;\315\177"
&gt;&gt;         tmpfd = &lt;optimized out&gt;
&gt;&gt;         __FUNCTION__ = "virCommandRun"
&gt;&gt;         __func__ = "virCommandRun"
&gt;&gt; #5  0x00007fcd404a27cf in virQEMUCapsInitQMP (qmperr=0x7fcd3bf174a0,
&gt;&gt; runGid=107, runUid=107, libDir=&lt;optimized out&gt;, qemuCaps=0x7fcd340fd3e0)
&gt;&gt; at qemu/qemu_capabilities.c:3700
&gt;&gt;         cmd = 0x7fcd344228f0
&gt;&gt;         pid = 0
&gt;&gt;         ret = -1
&gt;&gt;         mon = 0x0
&gt;&gt;         status = 0
&gt;&gt;         monarg = 0x7fcd343a2570
&gt;&gt; "unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait"
&gt;&gt;         vm = 0x0
&gt;&gt;         config = {type = 9, data = {file = {path = 0x7fcd34151d90
&gt;&gt; "/var/lib/libvirt/qemu/capabilities.monitor.sock", append = 0}, nmdm =
&gt;&gt; {master = 0x7fcd34151d90
&gt;&gt; "/var/lib/libvirt/qemu/capabilities.monitor.sock", slave = 0x0}, tcp =
&gt;&gt; {host = 0x7fcd34151d90
&gt;&gt; "/var/lib/libvirt/qemu/capabilities.monitor.sock", service = 0x0, listen
&gt;&gt; = false, protocol = 0}, udp = {bindHost = 0x7fcd34151d90
&gt;&gt; "/var/lib/libvirt/qemu/capabilities.monitor.sock", bindService = 0x0,
&gt;&gt; connectHost = 0x0, connectService = 0x0}, nix = {path = 0x7fcd34151d90
&gt;&gt; "/var/lib/libvirt/qemu/capabilities.monitor.sock", listen = false},
&gt;&gt; spicevmc = 873799056, spiceport = {channel = 0x7fcd34151d90
&gt;&gt; "/var/lib/libvirt/qemu/capabilities.monitor.sock"}}, logfile = 0x0,
&gt;&gt; logappend = 0}
&gt;&gt;         monpath = 0x7fcd34151d90
&gt;&gt; "/var/lib/libvirt/qemu/capabilities.monitor.sock"
&gt;&gt;         pidfile = 0x7fcd341ad8b0
&gt;&gt; "/var/lib/libvirt/qemu/capabilities.pidfile"
&gt;&gt;         xmlopt = 0x0
&gt;&gt; #6  virQEMUCapsNewForBinaryInternal (binary=binary@entry=0x7fcd34016cb0
&gt;&gt; "/usr/bin/qemu-system-alpha", libDir=&lt;optimized out&gt;,
&gt;&gt; cacheDir=0x7fcd343be860 "/var/cache/libvirt/qemu", runUid=107,
&gt;&gt; runGid=107, qmpOnly=qmpOnly@entry=false) at 
&gt;&gt; qemu/qemu_capabilities.c:3830
&gt;&gt;         qemuCaps = 0x7fcd340fd3e0
&gt;&gt;         sb = {st_dev = 64768, st_ino = 1838294, st_nlink = 1, st_mode =
&gt;&gt; 33261, st_uid = 0, st_gid = 0, __pad0 = 0, st_rdev = 0, st_size =
&gt;&gt; 8829680, st_blksize = 4096, st_blocks = 17248, st_atim = {tv_sec =
&gt;&gt; 1496358589, tv_nsec = 77994286}, st_mtim = {tv_sec = 1492132244, tv_nsec
&gt;&gt; = 0}, st_ctim = {tv_sec = 1494196699, tv_nsec = 451929606},
&gt;&gt; __glibc_reserved = {0, 0, 0}}
&gt;&gt;         rv = &lt;optimized out&gt;
&gt;&gt;         qmperr = 0x7fcd341c1870 ""
&gt;&gt;         __FUNCTION__ = "virQEMUCapsNewForBinaryInternal"
&gt;&gt; #7  0x00007fcd404a3a73 in virQEMUCapsNewForBinary (runGid=&lt;optimized
&gt;&gt; out&gt;, runUid=&lt;optimized out&gt;, cacheDir=&lt;optimized out&gt;,
&gt;&gt; libDir=&lt;optimized out&gt;, binary=0x7fcd34016cb0
&gt;&gt; "/usr/bin/qemu-system-alpha") at qemu/qemu_capabilities.c:3871
&gt;&gt; No locals.
&gt;&gt; #8  virQEMUCapsCacheLookup (cache=cache@entry=0x7fcd341c9000,
&gt;&gt; binary=0x7fcd34016cb0 "/usr/bin/qemu-system-alpha") at
&gt;&gt; qemu/qemu_capabilities.c:3986
&gt;&gt;         ret = 0x0
&gt;&gt;         __func__ = "virQEMUCapsCacheLookup"
&gt;&gt; #9  0x00007fcd404a3d22 in virQEMUCapsInitGuest
&gt;&gt; (guestarch=VIR_ARCH_ALPHA, hostarch=VIR_ARCH_X86_64,
&gt;&gt; cache=0x7fcd341c9000, caps=0x7fcd341a9980) at 
&gt;&gt; qemu/qemu_capabilities.c:824
&gt;&gt;         qemubinCaps = 0x0
&gt;&gt;         x86_32on64_kvm = &lt;optimized out&gt;
&gt;&gt;         ppc64_kvm = &lt;optimized out&gt;
&gt;&gt;         kvmbin = 0x0
&gt;&gt;         ret = -1
&gt;&gt;         i = &lt;optimized out&gt;
&gt;&gt;         binary = 0x7fcd34016cb0 "/usr/bin/qemu-system-alpha"
&gt;&gt;         kvmbinCaps = 0x0
&gt;&gt;         native_kvm = &lt;optimized out&gt;
&gt;&gt;         arm_32on64_kvm = &lt;optimized out&gt;
&gt;&gt; #10 virQEMUCapsInit (cache=0x7fcd341c9000) at 
&gt;&gt; qemu/qemu_capabilities.c:1109
&gt;&gt;         caps = 0x7fcd341a9980
&gt;&gt;         i = 1
&gt;&gt;         hostarch = VIR_ARCH_X86_64
&gt;&gt;         __func__ = "virQEMUCapsInit"
&gt;&gt; #11 0x00007fcd404def20 in virQEMUDriverCreateCapabilities
&gt;&gt; (driver=driver@entry=0x7fcd34342370) at qemu/qemu_conf.c:766
&gt;&gt;         i = &lt;optimized out&gt;
&gt;&gt;         j = &lt;optimized out&gt;
&gt;&gt;         caps = &lt;optimized out&gt;
&gt;&gt;         sec_managers = 0x0
&gt;&gt;         doi = &lt;optimized out&gt;
&gt;&gt;         model = &lt;optimized out&gt;
&gt;&gt;         lbl = &lt;optimized out&gt;
&gt;&gt;         type = &lt;optimized out&gt;
&gt;&gt;         cfg = 0x7fcd3448cbb0
&gt;&gt;         virtTypes = {3, 1}
&gt;&gt;         __FUNCTION__ = "virQEMUDriverCreateCapabilities"
&gt;&gt;         __func__ = "virQEMUDriverCreateCapabilities"
&gt;&gt; #12 0x00007fcd4051fef3 in qemuStateInitialize (privileged=true,
&gt;&gt; callback=&lt;optimized out&gt;, opaque=&lt;optimized out&gt;) at 
&gt;&gt; qemu/qemu_driver.c:844
&gt;&gt;         driverConf = 0x0
&gt;&gt;         conn = 0x0
&gt;&gt;         cfg = 0x7fcd3448cbb0
&gt;&gt;         run_uid = &lt;optimized out&gt;
&gt;&gt;         run_gid = &lt;optimized out&gt;
&gt;&gt;         hugepagePath = 0x0
&gt;&gt;         i = &lt;optimized out&gt;
&gt;&gt;         __FUNCTION__ = "qemuStateInitialize"
&gt;&gt; #13 0x00007fcd6f1789af in virStateInitialize (privileged=&lt;optimized
&gt;&gt; out&gt;, callback=0x55f56a9b3180 &lt;daemonInhibitCallback&gt;,
&gt;&gt; opaque=0x55f56be1cf00) at libvirt.c:770
&gt;&gt;         i = 9
&gt;&gt;         __func__ = "virStateInitialize"
&gt;&gt; #14 0x000055f56a9b31db in daemonRunStateInit (opaque=0x55f56be1cf00) at
&gt;&gt; libvirtd.c:959
&gt;&gt;         dmn = 0x55f56be1cf00
&gt;&gt;         sysident = 0x7fcd34000910
&gt;&gt;         __func__ = "daemonRunStateInit"
&gt;&gt; #15 0x00007fcd6f0d98f2 in virThreadHelper (data=&lt;optimized out&gt;) at
&gt;&gt; util/virthread.c:206
&gt;&gt;         args = 0x0
&gt;&gt;         local = {func = 0x55f56a9b31a0 &lt;daemonRunStateInit&gt;, funcName =
&gt;&gt; 0x55f56a9f28d3 "daemonRunStateInit", worker = false, opaque =
&gt;&gt; 0x55f56be1cf00}
&gt;&gt; #16 0x00007fcd6b7766ca in start_thread (arg=0x7fcd3bf18700) at
&gt;&gt; pthread_create.c:333
&gt;&gt;         __res = &lt;optimized out&gt;
&gt;&gt;         pd = 0x7fcd3bf18700
&gt;&gt;         now = &lt;optimized out&gt;
&gt;&gt;         unwind_buf = {cancel_jmp_buf = {{jmp_buf = {140519450707712,
&gt;&gt; -3574063505887647860, 0, 140732281962543, 140519450708416,
&gt;&gt; 140519450707712, 3601779982174594956, 3601954753778231180},
&gt;&gt; mask_was_saved = 0}}, priv = {pad = {0x0, 0x0, 0x0, 0x0}, data = {prev =
&gt;&gt; 0x0, cleanup = 0x0, canceltype = 0}}}
&gt;&gt;         not_first_call = &lt;optimized out&gt;
&gt;&gt;         pagesize_m1 = &lt;optimized out&gt;
&gt;&gt;         sp = &lt;optimized out&gt;
&gt;&gt;         freesize = &lt;optimized out&gt;
&gt;&gt;         __PRETTY_FUNCTION__ = "start_thread"
&gt;&gt; #17 0x00007fcd6b4b0f7f in clone () at
&gt;&gt; .../sysdeps/unix/sysv/linux/x86_64/clone.S:105
&gt;&gt; No locals.
&gt;&gt;
&gt;
&gt; [...]

</body></email><email><emailId>20170603132258</emailId><senderName>Michael C Cambria</senderName><senderEmail>mcc@fid4.com</senderEmail><timestampReceived>2017-06-03 13:22:58-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd not accepting connections</subject><body>



On 06/02/2017 09:53 AM, Michael C. Cambria wrote:
&gt;
&gt;
&gt; On 06/02/2017 09:43 AM, Martin Kletzander wrote:
&gt;&gt; [adding back the ML, you probably hit reply instead of reply-all, this
&gt;&gt; way other people might help if they know more]
&gt;&gt;
&gt;&gt; On Fri, Jun 02, 2017 at 08:10:01AM -0400, Michael C. Cambria wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Hi,
&gt;&gt;&gt;
&gt;&gt;&gt; libvirtd never seems to get notified that there is work to do. 
&gt;&gt;&gt; journalct
&gt;&gt;&gt; -f indicated that nothing was logged when connections were attempted 
&gt;&gt;&gt; via
&gt;&gt;&gt; virsh.
&gt;&gt;&gt;
&gt;&gt;&gt; I also tried 'LIBVIRT_DEBUG=1 libvirtd --verbose' and once startup
&gt;&gt;&gt; finished, there were no more log entries even though virsh attempts 
&gt;&gt;&gt; were
&gt;&gt;&gt; made.
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; That's because it gets overridden by the configuration files. This
&gt;&gt; might be a bug, but it's not related to what's happening.
&gt;&gt;
&gt;&gt;&gt; "ps ax" shows about a dozen "qemu-system-alpha" processes.  I don't 
&gt;&gt;&gt; know
&gt;&gt;&gt; if it matters but I didn't expect to see this.  I didn't intentionally
&gt;&gt;&gt; configure alpha emulations (assuming that's what it is) and certainly
&gt;&gt;&gt; don't want to waste resources having it running.
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; Libvirt caches the capabilities of the emulators it can find in your
&gt;&gt; system in order not to waste resources.  These processes are expected to
&gt;&gt; go away after they reply with all libvirt asks them for. However, it
&gt;&gt; seems like the initialization cannot be completed precisely due to the
&gt;&gt; fact that these processes don't communicate.
&gt;&gt;
&gt;&gt; There might be some details about qemu-system-alpha that are different
&gt;&gt; when compared to, e.g. qemu-system-x86 and libvirt is not (yet) adapted
&gt;&gt; to them, but I installed that emulator and libvirt daemon runs as
&gt;&gt; usual.  It looks like a problem in QEMU.  Could you, as a workaround,
&gt;&gt; try uninstalling that qemu binary from your system and restarting the
&gt;&gt; service?
&gt;&gt;

With qemu-system-alpha gone, I  now see qemu-system-arm.  With all 
qemu-system-* removed (using dnf remove) and stopping, then starting 
libvirtd, I still see qemu-system-arm even though the executable doesn't 
exist:

# ls -al /usr/bin | grep qemu-system
-rwxr-xr-x.   1 root root     9993416 Apr 13 21:10 qemu-system-i386
-rwxr-xr-x.   1 root root    10036032 Apr 13 21:10 qemu-system-x86_64
# systemctl status libvirtd.service
● libvirtd.service - Virtualization daemon
    Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled; 
vendor preset: enabled)
    Active: active (running) since Sat 2017-06-03 09:12:19 EDT; 8min ago
      Docs: man:libvirtd(8)
            http://libvirt.org
  Main PID: 5965 (libvirtd)
     Tasks: 23 (limit: 4915)
    Memory: 128.2M
       CPU: 411ms
    CGroup: /system.slice/libvirtd.service
            ├─1537 /usr/bin/qemu-system-arm -S -no-user-config 
-nodefaults -nographic -M none -qmp 
unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,n
            ├─1638 /usr/bin/qemu-system-arm -S -no-user-config 
-nodefaults -nographic -M none -qmp 
unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,n
            ├─5965 /usr/sbin/libvirtd
            ├─5999 /usr/bin/qemu-system-i386 -S -no-user-config 
-nodefaults -nographic -M none -qmp 
unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,
            └─6001 /usr/bin/qemu-system-i386 -S -no-user-config 
-nodefaults -nographic -M none -qmp 
unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,

Jun 03 09:12:19 example.com systemd[1]: Starting Virtualization daemon...
Jun 03 09:12:19 example.com systemd[1]: Started Virtualization daemon.


&gt;&gt; Also, what versions of libvirt and qemu do you have installed?
&gt;
&gt; # LIBVIRT_DEBUG=1 libvirtd --verbose
&gt; 2017-06-02 00:16:30.317+0000: 18088: info : libvirt version: 2.2.1, 
&gt; package: 1.fc25 (Fedora Project, 2017-05-10-22:06:21, 
&gt; buildvm-29.phx2.fedoraproject.org)
&gt;
&gt; I'll check on qemu as soon as I can get to the machine.  The version 
&gt; should be the latest one gets via 'dnf update' on fedora 25


# /usr/sbin/libvirtd --version
/usr/sbin/libvirtd (libvirt) 2.2.1
# qemu-x86_64 --version
qemu-x86_64 version 2.7.1(qemu-2.7.1-6.fc25), Copyright (c) 2003-2016 
Fabrice Bellard and the QEMU Project developers

[ gdb output deleted]

</body></email><email><emailId>20170603202209</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-06-03 20:22:09-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd not accepting connections</subject><body>


On Sat, Jun 03, 2017 at 09:22:58AM -0400, Michael C Cambria wrote:
&gt;
&gt;
&gt;On 06/02/2017 09:53 AM, Michael C. Cambria wrote:
&gt;&gt;
&gt;&gt;
&gt;&gt; On 06/02/2017 09:43 AM, Martin Kletzander wrote:
&gt;&gt;&gt; [adding back the ML, you probably hit reply instead of reply-all, this
&gt;&gt;&gt; way other people might help if they know more]
&gt;&gt;&gt;
&gt;&gt;&gt; On Fri, Jun 02, 2017 at 08:10:01AM -0400, Michael C. Cambria wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; libvirtd never seems to get notified that there is work to do.
&gt;&gt;&gt;&gt; journalct
&gt;&gt;&gt;&gt; -f indicated that nothing was logged when connections were attempted
&gt;&gt;&gt;&gt; via
&gt;&gt;&gt;&gt; virsh.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I also tried 'LIBVIRT_DEBUG=1 libvirtd --verbose' and once startup
&gt;&gt;&gt;&gt; finished, there were no more log entries even though virsh attempts
&gt;&gt;&gt;&gt; were
&gt;&gt;&gt;&gt; made.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; That's because it gets overridden by the configuration files. This
&gt;&gt;&gt; might be a bug, but it's not related to what's happening.
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; "ps ax" shows about a dozen "qemu-system-alpha" processes.  I don't
&gt;&gt;&gt;&gt; know
&gt;&gt;&gt;&gt; if it matters but I didn't expect to see this.  I didn't intentionally
&gt;&gt;&gt;&gt; configure alpha emulations (assuming that's what it is) and certainly
&gt;&gt;&gt;&gt; don't want to waste resources having it running.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Libvirt caches the capabilities of the emulators it can find in your
&gt;&gt;&gt; system in order not to waste resources.  These processes are expected to
&gt;&gt;&gt; go away after they reply with all libvirt asks them for. However, it
&gt;&gt;&gt; seems like the initialization cannot be completed precisely due to the
&gt;&gt;&gt; fact that these processes don't communicate.
&gt;&gt;&gt;
&gt;&gt;&gt; There might be some details about qemu-system-alpha that are different
&gt;&gt;&gt; when compared to, e.g. qemu-system-x86 and libvirt is not (yet) adapted
&gt;&gt;&gt; to them, but I installed that emulator and libvirt daemon runs as
&gt;&gt;&gt; usual.  It looks like a problem in QEMU.  Could you, as a workaround,
&gt;&gt;&gt; try uninstalling that qemu binary from your system and restarting the
&gt;&gt;&gt; service?
&gt;&gt;&gt;
&gt;
&gt;With qemu-system-alpha gone, I  now see qemu-system-arm.  With all
&gt;qemu-system-* removed (using dnf remove) and stopping, then starting
&gt;libvirtd, I still see qemu-system-arm even though the executable doesn't
&gt;exist:
&gt;
&gt;# ls -al /usr/bin | grep qemu-system
&gt;-rwxr-xr-x.   1 root root     9993416 Apr 13 21:10 qemu-system-i386
&gt;-rwxr-xr-x.   1 root root    10036032 Apr 13 21:10 qemu-system-x86_64
&gt;# systemctl status libvirtd.service
&gt;● libvirtd.service - Virtualization daemon
&gt;    Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled;
&gt;vendor preset: enabled)
&gt;    Active: active (running) since Sat 2017-06-03 09:12:19 EDT; 8min ago
&gt;      Docs: man:libvirtd(8)
&gt;            http://libvirt.org
&gt;  Main PID: 5965 (libvirtd)
&gt;     Tasks: 23 (limit: 4915)
&gt;    Memory: 128.2M
&gt;       CPU: 411ms
&gt;    CGroup: /system.slice/libvirtd.service
&gt;            ├─1537 /usr/bin/qemu-system-arm -S -no-user-config
&gt;-nodefaults -nographic -M none -qmp
&gt;unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,n
&gt;            ├─1638 /usr/bin/qemu-system-arm -S -no-user-config
&gt;-nodefaults -nographic -M none -qmp
&gt;unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,n
&gt;            ├─5965 /usr/sbin/libvirtd
&gt;            ├─5999 /usr/bin/qemu-system-i386 -S -no-user-config
&gt;-nodefaults -nographic -M none -qmp
&gt;unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,
&gt;            └─6001 /usr/bin/qemu-system-i386 -S -no-user-config
&gt;-nodefaults -nographic -M none -qmp
&gt;unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,
&gt;
&gt;Jun 03 09:12:19 example.com systemd[1]: Starting Virtualization daemon...
&gt;Jun 03 09:12:19 example.com systemd[1]: Started Virtualization daemon.
&gt;

Those look like leftovers from the previous run.  I have no idea why
they keep running, probably the same bug why they are not responding.
Would you mind trying one more thing:  Stopping the service, killing all
these processes, and then starting it?  Let's leave the QEMU issue on a
side until we figure this out first, then we can focus on the second
issue.  I must say this is quite bizarre.

&gt;
&gt;&gt;&gt; Also, what versions of libvirt and qemu do you have installed?
&gt;&gt;
&gt;&gt; # LIBVIRT_DEBUG=1 libvirtd --verbose
&gt;&gt; 2017-06-02 00:16:30.317+0000: 18088: info : libvirt version: 2.2.1,
&gt;&gt; package: 1.fc25 (Fedora Project, 2017-05-10-22:06:21,
&gt;&gt; buildvm-29.phx2.fedoraproject.org)
&gt;&gt;
&gt;&gt; I'll check on qemu as soon as I can get to the machine.  The version
&gt;&gt; should be the latest one gets via 'dnf update' on fedora 25
&gt;
&gt;
&gt;# /usr/sbin/libvirtd --version
&gt;/usr/sbin/libvirtd (libvirt) 2.2.1
&gt;# qemu-x86_64 --version
&gt;qemu-x86_64 version 2.7.1(qemu-2.7.1-6.fc25), Copyright (c) 2003-2016
&gt;Fabrice Bellard and the QEMU Project developers
&gt;
&gt;[ gdb output deleted]

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170603212047</emailId><senderName>Michael C Cambria</senderName><senderEmail>mcc@fid4.com</senderEmail><timestampReceived>2017-06-03 21:20:47-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd not accepting connections</subject><body>



On 06/03/2017 04:22 PM, Martin Kletzander wrote:
&gt; On Sat, Jun 03, 2017 at 09:22:58AM -0400, Michael C Cambria wrote:
&gt;&gt;
&gt;&gt;
&gt;&gt; On 06/02/2017 09:53 AM, Michael C. Cambria wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On 06/02/2017 09:43 AM, Martin Kletzander wrote:
&gt;&gt;&gt;&gt; [adding back the ML, you probably hit reply instead of reply-all, this
&gt;&gt;&gt;&gt; way other people might help if they know more]
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Fri, Jun 02, 2017 at 08:10:01AM -0400, Michael C. Cambria wrote:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Hi,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; libvirtd never seems to get notified that there is work to do.
&gt;&gt;&gt;&gt;&gt; journalct
&gt;&gt;&gt;&gt;&gt; -f indicated that nothing was logged when connections were attempted
&gt;&gt;&gt;&gt;&gt; via
&gt;&gt;&gt;&gt;&gt; virsh.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I also tried 'LIBVIRT_DEBUG=1 libvirtd --verbose' and once startup
&gt;&gt;&gt;&gt;&gt; finished, there were no more log entries even though virsh attempts
&gt;&gt;&gt;&gt;&gt; were
&gt;&gt;&gt;&gt;&gt; made.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; That's because it gets overridden by the configuration files. This
&gt;&gt;&gt;&gt; might be a bug, but it's not related to what's happening.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; "ps ax" shows about a dozen "qemu-system-alpha" processes.  I don't
&gt;&gt;&gt;&gt;&gt; know
&gt;&gt;&gt;&gt;&gt; if it matters but I didn't expect to see this.  I didn't 
&gt;&gt;&gt;&gt;&gt; intentionally
&gt;&gt;&gt;&gt;&gt; configure alpha emulations (assuming that's what it is) and certainly
&gt;&gt;&gt;&gt;&gt; don't want to waste resources having it running.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Libvirt caches the capabilities of the emulators it can find in your
&gt;&gt;&gt;&gt; system in order not to waste resources.  These processes are 
&gt;&gt;&gt;&gt; expected to
&gt;&gt;&gt;&gt; go away after they reply with all libvirt asks them for. However, it
&gt;&gt;&gt;&gt; seems like the initialization cannot be completed precisely due to the
&gt;&gt;&gt;&gt; fact that these processes don't communicate.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; There might be some details about qemu-system-alpha that are different
&gt;&gt;&gt;&gt; when compared to, e.g. qemu-system-x86 and libvirt is not (yet) 
&gt;&gt;&gt;&gt; adapted
&gt;&gt;&gt;&gt; to them, but I installed that emulator and libvirt daemon runs as
&gt;&gt;&gt;&gt; usual.  It looks like a problem in QEMU.  Could you, as a workaround,
&gt;&gt;&gt;&gt; try uninstalling that qemu binary from your system and restarting the
&gt;&gt;&gt;&gt; service?
&gt;&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; With qemu-system-alpha gone, I  now see qemu-system-arm.  With all
&gt;&gt; qemu-system-* removed (using dnf remove) and stopping, then starting
&gt;&gt; libvirtd, I still see qemu-system-arm even though the executable doesn't
&gt;&gt; exist:
&gt;&gt;
&gt;&gt; # ls -al /usr/bin | grep qemu-system
&gt;&gt; -rwxr-xr-x.   1 root root     9993416 Apr 13 21:10 qemu-system-i386
&gt;&gt; -rwxr-xr-x.   1 root root    10036032 Apr 13 21:10 qemu-system-x86_64
&gt;&gt; # systemctl status libvirtd.service
&gt;&gt; ● libvirtd.service - Virtualization daemon
&gt;&gt;    Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled;
&gt;&gt; vendor preset: enabled)
&gt;&gt;    Active: active (running) since Sat 2017-06-03 09:12:19 EDT; 8min ago
&gt;&gt;      Docs: man:libvirtd(8)
&gt;&gt;            http://libvirt.org
&gt;&gt;  Main PID: 5965 (libvirtd)
&gt;&gt;     Tasks: 23 (limit: 4915)
&gt;&gt;    Memory: 128.2M
&gt;&gt;       CPU: 411ms
&gt;&gt;    CGroup: /system.slice/libvirtd.service
&gt;&gt;            ├─1537 /usr/bin/qemu-system-arm -S -no-user-config
&gt;&gt; -nodefaults -nographic -M none -qmp
&gt;&gt; unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,n
&gt;&gt;            ├─1638 /usr/bin/qemu-system-arm -S -no-user-config
&gt;&gt; -nodefaults -nographic -M none -qmp
&gt;&gt; unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,n
&gt;&gt;            ├─5965 /usr/sbin/libvirtd
&gt;&gt;            ├─5999 /usr/bin/qemu-system-i386 -S -no-user-config
&gt;&gt; -nodefaults -nographic -M none -qmp
&gt;&gt; unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,
&gt;&gt;            └─6001 /usr/bin/qemu-system-i386 -S -no-user-config
&gt;&gt; -nodefaults -nographic -M none -qmp
&gt;&gt; unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,
&gt;&gt;
&gt;&gt; Jun 03 09:12:19 example.com systemd[1]: Starting Virtualization 
&gt;&gt; daemon...
&gt;&gt; Jun 03 09:12:19 example.com systemd[1]: Started Virtualization daemon.
&gt;&gt;
&gt;
&gt; Those look like leftovers from the previous run.  I have no idea why
&gt; they keep running, probably the same bug why they are not responding.
I dnf remove'ed every qemu-system-* in /usr/bin that dnf allowed me to.  
The only things are:

$ ls -al /usr/bin | grep qemu-system
-rwxr-xr-x.   1 root root     9993416 Apr 13 21:10 qemu-system-i386
-rwxr-xr-x.   1 root root    10036032 Apr 13 21:10 qemu-system-x86_64
$

Is there a way to remove them?  I still have the original problem, 
though at least arm and alpha don't show up.

$ sudo systemctl status libvirtd.service
● libvirtd.service - Virtualization daemon
    Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled; 
vendor preset: enabled)
    Active: active (running) since Sat 2017-06-03 16:59:40 EDT; 7min ago
      Docs: man:libvirtd(8)
            http://libvirt.org
  Main PID: 1200 (libvirtd)
     Tasks: 20 (limit: 4915)
    Memory: 101.4M
       CPU: 361ms
    CGroup: /system.slice/libvirtd.service
            ├─1200 /usr/sbin/libvirtd
            ├─1481 /usr/bin/qemu-system-i386 -S -no-user-config 
-nodefaults -nographic -M none -qmp 
unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait 
-pidfile /var/lib/libvirt/qemu/capabilities.
            └─1658 /usr/bin/qemu-system-i386 -S -no-user-config 
-nodefaults -nographic -M none -qmp 
unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait 
-pidfile /var/lib/libvirt/qemu/capabilities.

Jun 03 16:59:32 eastie.fid4.com systemd[1]: Starting Virtualization 
daemon...
Jun 03 16:59:40 eastie.fid4.com systemd[1]: Started Virtualization daemon.
$

&gt; Would you mind trying one more thing:  Stopping the service, killing all
&gt; these processes, and then starting it?  Let's leave the QEMU issue on a
&gt; side until we figure this out first, then we can focus on the second
&gt; issue.  I must say this is quite bizarre.
&gt;

As requested...

$ sudo systemctl stop libvirtd.service
$ sudo systemctl status libvirtd.service
● libvirtd.service - Virtualization daemon
    Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled; 
vendor preset: enabled)
    Active: inactive (dead) since Sat 2017-06-03 17:09:16 EDT; 1s ago
      Docs: man:libvirtd(8)
            http://libvirt.org
   Process: 1200 ExecStart=/usr/sbin/libvirtd $LIBVIRTD_ARGS 
(code=exited, status=0/SUCCESS)
  Main PID: 1200 (code=exited, status=0/SUCCESS)
     Tasks: 3 (limit: 4915)
    Memory: 92.4M
       CPU: 386ms
    CGroup: /system.slice/libvirtd.service
            ├─1481 /usr/bin/qemu-system-i386 -S -no-user-config 
-nodefaults -nographic -M none -qmp 
unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait 
-pidfile /var/lib/libvirt/qemu/capabilities.
            └─1658 /usr/bin/qemu-system-i386 -S -no-user-config 
-nodefaults -nographic -M none -qmp 
unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait 
-pidfile /var/lib/libvirt/qemu/capabilities.

Jun 03 16:59:32 exampl.com systemd[1]: Starting Virtualization daemon...
Jun 03 16:59:40 example.com systemd[1]: Started Virtualization daemon.
Jun 03 17:09:16 example.com systemd[1]: Stopping Virtualization daemon...
Jun 03 17:09:16 example.com systemd[1]: Stopped Virtualization daemon.
$ ps ax | grep virt
  1481 ?        Sl     0:00 /usr/bin/qemu-system-i386 -S -no-user-config 
-nodefaults -nographic -M none -qmp 
unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait 
-pidfile /var/lib/libvirt/qemu/capabilities.pidfile -daemonize
  1658 ?        S      0:00 /usr/bin/qemu-system-i386 -S -no-user-config 
-nodefaults -nographic -M none -qmp 
unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait 
-pidfile /var/lib/libvirt/qemu/capabilities.pidfile -daemonize
  3111 pts/1    S+     0:00 grep --color=auto virt
$ sudo kill -9 1481
$ sudo kill -9 1658
$ ps ax | grep virt
  3120 pts/1    S+     0:00 grep --color=auto virt
$ sudo systemctl start libvirtd.service
$ sudo systemctl status libvirtd.service
● libvirtd.service - Virtualization daemon
    Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled; 
vendor preset: enabled)
    Active: active (running) since Sat 2017-06-03 17:09:52 EDT; 4s ago
      Docs: man:libvirtd(8)
            http://libvirt.org
  Main PID: 3124 (libvirtd)
     Tasks: 20 (limit: 4915)
    Memory: 103.4M
       CPU: 232ms
    CGroup: /system.slice/libvirtd.service
            ├─3124 /usr/sbin/libvirtd
            ├─3158 /usr/bin/qemu-system-i386 -S -no-user-config 
-nodefaults -nographic -M none -qmp 
unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait 
-pidfile /var/lib/libvirt/qemu/capabilities.
            └─3160 /usr/bin/qemu-system-i386 -S -no-user-config 
-nodefaults -nographic -M none -qmp 
unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait 
-pidfile /var/lib/libvirt/qemu/capabilities.

Jun 03 17:09:52 example.com systemd[1]: Starting Virtualization daemon...
Jun 03 17:09:52 example.com systemd[1]: Started Virtualization daemon.
$ ps ax | grep virt
  3124 ?        Ssl    0:00 /usr/sbin/libvirtd
  3158 ?        Sl     0:00 /usr/bin/qemu-system-i386 -S -no-user-config 
-nodefaults -nographic -M none -qmp 
unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait 
-pidfile /var/lib/libvirt/qemu/capabilities.pidfile -daemonize
  3160 ?        S      0:00 /usr/bin/qemu-system-i386 -S -no-user-config 
-nodefaults -nographic -M none -qmp 
unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait 
-pidfile /var/lib/libvirt/qemu/capabilities.pidfile -daemonize
  3166 pts/1    S+     0:00 grep --color=auto virt
$

Problem still exists.

I also tried stopping libvirtd, renaming both qemu-system-i386 and 
qemu-system-x86_64, start libvirtd.  Things get further along; dnsmasq 
log messages show up.

$ sudo systemctl status libvirtd.service
● libvirtd.service - Virtualization daemon
    Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled; 
vendor preset: enabled)
    Active: active (running) since Sat 2017-06-03 17:14:25 EDT; 7s ago
      Docs: man:libvirtd(8)
            http://libvirt.org
  Main PID: 3246 (libvirtd)
     Tasks: 21 (limit: 4915)
    Memory: 107.4M
       CPU: 300ms
    CGroup: /system.slice/libvirtd.service
            ├─3158 /usr/bin/qemu-system-i386 -S -no-user-config 
-nodefaults -nographic -M none -qmp 
unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait 
-pidfile /var/lib/libvirt/qemu/capabilities.
            ├─3160 /usr/bin/qemu-system-i386 -S -no-user-config 
-nodefaults -nographic -M none -qmp 
unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait 
-pidfile /var/lib/libvirt/qemu/capabilities.
            ├─3246 /usr/sbin/libvirtd
            ├─3457 /sbin/dnsmasq 
--conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro 
--dhcp-script=/usr/libexec/libvirt_leaseshelper
            └─3458 /sbin/dnsmasq 
--conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro 
--dhcp-script=/usr/libexec/libvirt_leaseshelper

Jun 03 17:14:25 example.com libvirtd[3246]: Failed to probe capabilities 
for /usr/bin/qemu-kvm: internal error: Child process (LC_ALL=C 
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin /usr/bin/qemu-k
Jun 03 17:14:26 example.com dnsmasq[3457]: started, version 2.76 
cachesize 150
Jun 03 17:14:26 example.com dnsmasq[3457]: compile time options: IPv6 
GNU-getopt DBus no-i18n IDN DHCP DHCPv6 no-Lua TFTP no-conntrack ipset 
auth DNSSEC loop-detect inotify
Jun 03 17:14:26 example.com dnsmasq-dhcp[3457]: DHCP, IP range 
192.168.122.2 -- 192.168.122.254, lease time 1h
Jun 03 17:14:26 example.com dnsmasq-dhcp[3457]: DHCP, sockets bound 
exclusively to interface virbr0
Jun 03 17:14:26 example.com dnsmasq[3457]: reading /etc/resolv.conf
Jun 03 17:14:26 example.com dnsmasq[3457]: using nameserver 172.16.8.1#53
Jun 03 17:14:26 example.com dnsmasq[3457]: read /etc/hosts - 2 addresses
Jun 03 17:14:26 example.com dnsmasq[3457]: read 
/var/lib/libvirt/dnsmasq/default.addnhosts - 0 addresses
Jun 03 17:14:26 example.com dnsmasq-dhcp[3457]: read 
/var/lib/libvirt/dnsmasq/default.hostsfile


$ sudo virsh list
  Id    Name                           State
----------------------------------------------------

$

As you can see, none of my vm's show up.  I'm guessing the "qemu-kvm: 
internal error" results from renaming qemu-system-x86_64??

Could something else (selinux?) be involved?
&gt;&gt;
&gt;&gt;&gt;&gt; Also, what versions of libvirt and qemu do you have installed?
&gt;&gt;&gt;
&gt;&gt;&gt; # LIBVIRT_DEBUG=1 libvirtd --verbose
&gt;&gt;&gt; 2017-06-02 00:16:30.317+0000: 18088: info : libvirt version: 2.2.1,
&gt;&gt;&gt; package: 1.fc25 (Fedora Project, 2017-05-10-22:06:21,
&gt;&gt;&gt; buildvm-29.phx2.fedoraproject.org)
&gt;&gt;&gt;
&gt;&gt;&gt; I'll check on qemu as soon as I can get to the machine.  The version
&gt;&gt;&gt; should be the latest one gets via 'dnf update' on fedora 25
&gt;&gt;
&gt;&gt;
&gt;&gt; # /usr/sbin/libvirtd --version
&gt;&gt; /usr/sbin/libvirtd (libvirt) 2.2.1
&gt;&gt; # qemu-x86_64 --version
&gt;&gt; qemu-x86_64 version 2.7.1(qemu-2.7.1-6.fc25), Copyright (c) 2003-2016
&gt;&gt; Fabrice Bellard and the QEMU Project developers
&gt;&gt;
&gt;&gt; [ gdb output deleted]


</body></email><email><emailId>20170603214743</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-06-03 21:47:43-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd not accepting connections</subject><body>


On Sat, Jun 03, 2017 at 05:20:47PM -0400, Michael C Cambria wrote:
&gt;I also tried stopping libvirtd, renaming both qemu-system-i386 and
&gt;qemu-system-x86_64, start libvirtd.  Things get further along; dnsmasq
&gt;log messages show up.
&gt;
&gt;$ sudo systemctl status libvirtd.service
&gt;● libvirtd.service - Virtualization daemon
&gt;    Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled;
&gt;vendor preset: enabled)
&gt;    Active: active (running) since Sat 2017-06-03 17:14:25 EDT; 7s ago
&gt;      Docs: man:libvirtd(8)
&gt;            http://libvirt.org
&gt;  Main PID: 3246 (libvirtd)
&gt;     Tasks: 21 (limit: 4915)
&gt;    Memory: 107.4M
&gt;       CPU: 300ms
&gt;    CGroup: /system.slice/libvirtd.service
&gt;            ├─3158 /usr/bin/qemu-system-i386 -S -no-user-config
&gt;-nodefaults -nographic -M none -qmp
&gt;unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait
&gt;-pidfile /var/lib/libvirt/qemu/capabilities.
&gt;            ├─3160 /usr/bin/qemu-system-i386 -S -no-user-config
&gt;-nodefaults -nographic -M none -qmp
&gt;unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait
&gt;-pidfile /var/lib/libvirt/qemu/capabilities.
&gt;            ├─3246 /usr/sbin/libvirtd
&gt;            ├─3457 /sbin/dnsmasq
&gt;--conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro
&gt;--dhcp-script=/usr/libexec/libvirt_leaseshelper
&gt;            └─3458 /sbin/dnsmasq
&gt;--conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro
&gt;--dhcp-script=/usr/libexec/libvirt_leaseshelper
&gt;
&gt;Jun 03 17:14:25 example.com libvirtd[3246]: Failed to probe capabilities
&gt;for /usr/bin/qemu-kvm: internal error: Child process (LC_ALL=C
&gt;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin /usr/bin/qemu-k
&gt;Jun 03 17:14:26 example.com dnsmasq[3457]: started, version 2.76
&gt;cachesize 150
&gt;Jun 03 17:14:26 example.com dnsmasq[3457]: compile time options: IPv6
&gt;GNU-getopt DBus no-i18n IDN DHCP DHCPv6 no-Lua TFTP no-conntrack ipset
&gt;auth DNSSEC loop-detect inotify
&gt;Jun 03 17:14:26 example.com dnsmasq-dhcp[3457]: DHCP, IP range
&gt;192.168.122.2 -- 192.168.122.254, lease time 1h
&gt;Jun 03 17:14:26 example.com dnsmasq-dhcp[3457]: DHCP, sockets bound
&gt;exclusively to interface virbr0
&gt;Jun 03 17:14:26 example.com dnsmasq[3457]: reading /etc/resolv.conf
&gt;Jun 03 17:14:26 example.com dnsmasq[3457]: using nameserver 172.16.8.1#53
&gt;Jun 03 17:14:26 example.com dnsmasq[3457]: read /etc/hosts - 2 addresses
&gt;Jun 03 17:14:26 example.com dnsmasq[3457]: read
&gt;/var/lib/libvirt/dnsmasq/default.addnhosts - 0 addresses
&gt;Jun 03 17:14:26 example.com dnsmasq-dhcp[3457]: read
&gt;/var/lib/libvirt/dnsmasq/default.hostsfile
&gt;
&gt;
&gt;$ sudo virsh list
&gt;  Id    Name                           State
&gt;----------------------------------------------------
&gt;
&gt;$
&gt;
&gt;As you can see, none of my vm's show up.  I'm guessing the "qemu-kvm:
&gt;internal error" results from renaming qemu-system-x86_64??
&gt;

Yeah, feel free to move them back.

&gt;Could something else (selinux?) be involved?

It should not.  Now we know it is QEMU, but becuase it is disrupting
libvirt in its initialization phase, it looks like nothing works.

You could grab a backtrace of the qemu process and try on qemu-devel
ML.  Also, if you want to make sure (or see after what command gets
stuck), you can enable debug logs for libvirt into some file and then
grep that for QEMU_MONITOR_ and you'll see.

[1] http://wiki.libvirt.org/page/DebugLogs
[2] I'm not sure about the whole thing to look for, but this is enough)

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170604002708</emailId><senderName>Michael C Cambria</senderName><senderEmail>mcc@fid4.com</senderEmail><timestampReceived>2017-06-04 00:27:08-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd not accepting connections</subject><body>



On 06/03/2017 05:47 PM, Martin Kletzander wrote:
&gt; On Sat, Jun 03, 2017 at 05:20:47PM -0400, Michael C Cambria wrote:
&gt; &gt; I also tried stopping libvirtd, renaming both qemu-system-i386 and
&gt; &gt; qemu-system-x86_64, start libvirtd.  Things get further along; dnsmasq
&gt; &gt; log messages show up.
&gt; &gt; 
&gt; &gt; $ sudo systemctl status libvirtd.service
&gt; &gt; ● libvirtd.service - Virtualization daemon
&gt; &gt; Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled;
&gt; &gt; vendor preset: enabled)
&gt; &gt; Active: active (running) since Sat 2017-06-03 17:14:25 EDT; 7s ago
&gt; &gt; Docs: man:libvirtd(8)
&gt; &gt; http://libvirt.org
&gt; &gt; Main PID: 3246 (libvirtd)
&gt; &gt; Tasks: 21 (limit: 4915)
&gt; &gt; Memory: 107.4M
&gt; &gt; CPU: 300ms
&gt; &gt; CGroup: /system.slice/libvirtd.service
&gt; &gt; ├─3158 /usr/bin/qemu-system-i386 -S -no-user-config
&gt; &gt; -nodefaults -nographic -M none -qmp
&gt; &gt; unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait
&gt; &gt; -pidfile /var/lib/libvirt/qemu/capabilities.
&gt; &gt; ├─3160 /usr/bin/qemu-system-i386 -S -no-user-config
&gt; &gt; -nodefaults -nographic -M none -qmp
&gt; &gt; unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait
&gt; &gt; -pidfile /var/lib/libvirt/qemu/capabilities.
&gt; &gt; ├─3246 /usr/sbin/libvirtd
&gt; &gt; ├─3457 /sbin/dnsmasq
&gt; &gt; --conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro
&gt; &gt; --dhcp-script=/usr/libexec/libvirt_leaseshelper
&gt; &gt; └─3458 /sbin/dnsmasq
&gt; &gt; --conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro
&gt; &gt; --dhcp-script=/usr/libexec/libvirt_leaseshelper
&gt; &gt; 
&gt; &gt; Jun 03 17:14:25 example.com libvirtd[3246]: Failed to probe capabilities
&gt; &gt; for /usr/bin/qemu-kvm: internal error: Child process (LC_ALL=C
&gt; &gt; PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin /usr/bin/qemu-k
&gt; &gt; Jun 03 17:14:26 example.com dnsmasq[3457]: started, version 2.76
&gt; &gt; cachesize 150
&gt; &gt; Jun 03 17:14:26 example.com dnsmasq[3457]: compile time options: IPv6
&gt; &gt; GNU-getopt DBus no-i18n IDN DHCP DHCPv6 no-Lua TFTP no-conntrack ipset
&gt; &gt; auth DNSSEC loop-detect inotify
&gt; &gt; Jun 03 17:14:26 example.com dnsmasq-dhcp[3457]: DHCP, IP range
&gt; &gt; 192.168.122.2 -- 192.168.122.254, lease time 1h
&gt; &gt; Jun 03 17:14:26 example.com dnsmasq-dhcp[3457]: DHCP, sockets bound
&gt; &gt; exclusively to interface virbr0
&gt; &gt; Jun 03 17:14:26 example.com dnsmasq[3457]: reading /etc/resolv.conf
&gt; &gt; Jun 03 17:14:26 example.com dnsmasq[3457]: using nameserver 
&gt; &gt; 172.16.8.1#53
&gt; &gt; Jun 03 17:14:26 example.com dnsmasq[3457]: read /etc/hosts - 2 addresses
&gt; &gt; Jun 03 17:14:26 example.com dnsmasq[3457]: read
&gt; &gt; /var/lib/libvirt/dnsmasq/default.addnhosts - 0 addresses
&gt; &gt; Jun 03 17:14:26 example.com dnsmasq-dhcp[3457]: read
&gt; &gt; /var/lib/libvirt/dnsmasq/default.hostsfile
&gt; &gt; 
&gt; &gt; 
&gt; &gt; $ sudo virsh list
&gt; &gt; Id    Name                           State
&gt; &gt; ----------------------------------------------------
&gt; &gt; 
&gt; &gt; $
&gt; &gt; 
&gt; &gt; As you can see, none of my vm's show up.  I'm guessing the "qemu-kvm:
&gt; &gt; internal error" results from renaming qemu-system-x86_64??
&gt; &gt; 
&gt; 
&gt; Yeah, feel free to move them back.
&gt; 
&gt; &gt; Could something else (selinux?) be involved?
&gt; 
&gt; It should not.  Now we know it is QEMU, but becuase it is disrupting
&gt; libvirt in its initialization phase, it looks like nothing works.
&gt; 
&gt; You could grab a backtrace of the qemu process and try on qemu-devel
&gt; ML.  Also, if you want to make sure (or see after what command gets
&gt; stuck), you can enable debug logs for libvirt into some file and then
&gt; grep that for QEMU_MONITOR_ and you'll see.
&gt; 
What should I be looking for?  I see QEMU_MONITOR_ in the source 
(https://github.com/libvirt/libvirt/tree/v2.2-maint) but never see it in 
the logs.

# pwd
/etc/libvirt
# diff libvirtd.conf libvirtd.conf.hold
1,4d0
&lt; log_level = 1
&lt; log_filters="3:remote 4:event 3:json 3:rpc"
&lt; log_outputs="1:file:/var/log/libvirt/libvirtd.log"
&lt; #
# ls -al /var/log/libvirt/libvirtd.log
ls: cannot access '/var/log/libvirt/libvirtd.log': No such file or directory
# systemctl restart libvirtd.service
# ls -al /var/log/libvirt/libvirtd.log
-rw-------. 1 root root 801113 Jun  3 19:56 /var/log/libvirt/libvirtd.log
# grep QEMU_MONITOR_ /var/log/libvirt/libvirtd.log
# grep QEMU_MONITOR_ /var/log/libvirt/libvirtd.log
# grep QEMU_ /var/log/libvirt/libvirtd.log
# grep QEMU /var/log/libvirt/libvirtd.log
2017-06-04 00:04:13.825+0000: 3363: debug : virRegisterConnectDriver:684 
&gt; driver=0x7fa3f6c2e0e0 name=QEMU
2017-06-04 00:04:13.825+0000: 3363: debug : virRegisterConnectDriver:695 
&gt; registering QEMU as driver 9
2017-06-04 00:04:14.302+0000: 3379: debug : virStateInitialize:769 : 
Running global init for QEMU state driver
2017-06-04 00:04:14.303+0000: 3379: info : virObjectNew:202 : 
OBJECT_NEW: obj=0x7fa3d0122250 classname=virQEMUDriverConfig
2017-06-04 00:04:14.305+0000: 3379: debug : 
virSecurityManagerNewDriver:86 : drv=0x7fa44d580f40 (selinux) 
virtDriver=QEMU flags=a
2017-06-04 00:04:14.305+0000: 3379: debug : 
virSecuritySELinuxInitialize:561 : SELinuxInitialize QEMU
2017-06-04 00:04:14.307+0000: 3379: debug : 
virSecuritySELinuxQEMUInitialize:516 : Loaded domain context 
'system_u:system_r:svirt_t:s0', alt domain context 
'system_u:system_r:svirt_tcg_t:s0'
2017-06-04 00:04:14.307+0000: 3379: debug : 
virSecuritySELinuxQEMUInitialize:537 : Loaded file context 
'system_u:object_r:svirt_image_t:s0', content context 
'system_u:object_r:virt_content_t:s0'
2017-06-04 00:04:14.307+0000: 3379: debug : 
virSecurityManagerNewDriver:86 : drv=0x7fa44d580cc0 (stack) 
virtDriver=QEMU flags=a
2017-06-04 00:04:14.307+0000: 3379: debug : 
virSecurityManagerNewDriver:86 : drv=0x7fa44d580de0 (dac) 
virtDriver=QEMU flags=a
2017-06-04 00:04:14.313+0000: 3379: debug : virQEMUCapsCacheLookup:3985 
&gt; Creating capabilities for /usr/bin/qemu-system-alpha
2017-06-04 00:04:14.313+0000: 3379: info : virObjectNew:202 : 
OBJECT_NEW: obj=0x7fa3d010bb00 classname=virQEMUCaps
2017-06-04 00:04:14.313+0000: 3379: debug : virQEMUCapsInitCached:3292 : 
No cached capabilities 
'/var/cache/libvirt/qemu/capabilities/4b21437223cbdecdb4e776fe0bb40302a421554fc350bfbb986908518557721d.xml' \
 for '/usr/bin/qemu-system-alpha'
2017-06-04 00:04:14.313+0000: 3379: debug : virQEMUCapsInitQMP:3673 : 
Try to get caps via QMP qemuCaps=0x7fa3d010bb00
[root@eastie libvirt]#

Here are the last few lines of that log file:

2017-06-04 00:04:14.313+0000: 3379: debug : virQEMUCapsCacheLookup:3985 
&gt; Creating capabilities for /usr/bin/qemu-system-alpha
2017-06-04 00:04:14.313+0000: 3379: info : virObjectNew:202 : 
OBJECT_NEW: obj=0x7fa3d010bb00 classname=virQEMUCaps
2017-06-04 00:04:14.313+0000: 3379: debug : virFileMakePathHelper:2837 : 
path=/var/cache/libvirt/qemu/capabilities mode=0777
2017-06-04 00:04:14.313+0000: 3379: debug : virQEMUCapsInitCached:3292 : 
No cached capabilities 
'/var/cache/libvirt/qemu/capabilities/4b21437223cbdecdb4e776fe0bb40302a421554fc350bfbb986908518557721d.xml' \
 for '/usr/bin/qemu-system-alpha'
2017-06-04 00:04:14.313+0000: 3379: debug : virQEMUCapsInitQMP:3673 : 
Try to get caps via QMP qemuCaps=0x7fa3d010bb00
2017-06-04 00:04:14.313+0000: 3379: debug : virCommandRunAsync:2434 : 
About to run LC_ALL=C 
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin 
/usr/bin/qemu-system-alpha -S -no-user-config -nodefaults -nographic -M 
none -qmp 
unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait 
-pidfile /var/lib/libvirt/qemu/capabilities.pidfile -daemonize
2017-06-04 00:04:14.314+0000: 3379: debug : virFileClose:102 : Closed fd 21
2017-06-04 00:04:14.314+0000: 3379: debug : virFileClose:102 : Closed fd 23
2017-06-04 00:04:14.314+0000: 3379: debug : virFileClose:102 : Closed fd 25
2017-06-04 00:04:14.314+0000: 3379: debug : virCommandRunAsync:2437 : 
Command result 0, with PID 3405
#

I changed the log filters to:

log_filters="1:remote 1:event 1:json 1:rpc"

Tried again, QEMU_MONITOR_ isn't in the log.

Thanks again for your help.

&gt; [1] http://wiki.libvirt.org/page/DebugLogs
&gt; [2] I'm not sure about the whole thing to look for, but this is enough)


</body></email><email><emailId>20170604094619</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-06-04 09:46:19-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd not accepting connections</subject><body>


On Sat, Jun 03, 2017 at 08:27:08PM -0400, Michael C Cambria wrote:
&gt; 
&gt; 
&gt; On 06/03/2017 05:47 PM, Martin Kletzander wrote:
&gt; &gt; On Sat, Jun 03, 2017 at 05:20:47PM -0400, Michael C Cambria wrote:
&gt; &gt; &gt; I also tried stopping libvirtd, renaming both qemu-system-i386 and
&gt; &gt; &gt; qemu-system-x86_64, start libvirtd.  Things get further along; dnsmasq
&gt; &gt; &gt; log messages show up.
&gt; &gt; &gt; 
&gt; &gt; &gt; $ sudo systemctl status libvirtd.service
&gt; &gt; &gt; ● libvirtd.service - Virtualization daemon
&gt; &gt; &gt; Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled;
&gt; &gt; &gt; vendor preset: enabled)
&gt; &gt; &gt; Active: active (running) since Sat 2017-06-03 17:14:25 EDT; 7s ago
&gt; &gt; &gt; Docs: man:libvirtd(8)
&gt; &gt; &gt; http://libvirt.org
&gt; &gt; &gt; Main PID: 3246 (libvirtd)
&gt; &gt; &gt; Tasks: 21 (limit: 4915)
&gt; &gt; &gt; Memory: 107.4M
&gt; &gt; &gt; CPU: 300ms
&gt; &gt; &gt; CGroup: /system.slice/libvirtd.service
&gt; &gt; &gt; ├─3158 /usr/bin/qemu-system-i386 -S -no-user-config
&gt; &gt; &gt; -nodefaults -nographic -M none -qmp
&gt; &gt; &gt; unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait
&gt; &gt; &gt; -pidfile /var/lib/libvirt/qemu/capabilities.
&gt; &gt; &gt; ├─3160 /usr/bin/qemu-system-i386 -S -no-user-config
&gt; &gt; &gt; -nodefaults -nographic -M none -qmp
&gt; &gt; &gt; unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait
&gt; &gt; &gt; -pidfile /var/lib/libvirt/qemu/capabilities.
&gt; &gt; &gt; ├─3246 /usr/sbin/libvirtd
&gt; &gt; &gt; ├─3457 /sbin/dnsmasq
&gt; &gt; &gt; --conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro
&gt; &gt; &gt; --dhcp-script=/usr/libexec/libvirt_leaseshelper
&gt; &gt; &gt; └─3458 /sbin/dnsmasq
&gt; &gt; &gt; --conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro
&gt; &gt; &gt; --dhcp-script=/usr/libexec/libvirt_leaseshelper
&gt; &gt; &gt; 
&gt; &gt; &gt; Jun 03 17:14:25 example.com libvirtd[3246]: Failed to probe capabilities
&gt; &gt; &gt; for /usr/bin/qemu-kvm: internal error: Child process (LC_ALL=C
&gt; &gt; &gt; PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin /usr/bin/qemu-k
&gt; &gt; &gt; Jun 03 17:14:26 example.com dnsmasq[3457]: started, version 2.76
&gt; &gt; &gt; cachesize 150
&gt; &gt; &gt; Jun 03 17:14:26 example.com dnsmasq[3457]: compile time options: IPv6
&gt; &gt; &gt; GNU-getopt DBus no-i18n IDN DHCP DHCPv6 no-Lua TFTP no-conntrack ipset
&gt; &gt; &gt; auth DNSSEC loop-detect inotify
&gt; &gt; &gt; Jun 03 17:14:26 example.com dnsmasq-dhcp[3457]: DHCP, IP range
&gt; &gt; &gt; 192.168.122.2 -- 192.168.122.254, lease time 1h
&gt; &gt; &gt; Jun 03 17:14:26 example.com dnsmasq-dhcp[3457]: DHCP, sockets bound
&gt; &gt; &gt; exclusively to interface virbr0
&gt; &gt; &gt; Jun 03 17:14:26 example.com dnsmasq[3457]: reading /etc/resolv.conf
&gt; &gt; &gt; Jun 03 17:14:26 example.com dnsmasq[3457]: using nameserver
&gt; &gt; &gt; 172.16.8.1#53
&gt; &gt; &gt; Jun 03 17:14:26 example.com dnsmasq[3457]: read /etc/hosts - 2 addresses
&gt; &gt; &gt; Jun 03 17:14:26 example.com dnsmasq[3457]: read
&gt; &gt; &gt; /var/lib/libvirt/dnsmasq/default.addnhosts - 0 addresses
&gt; &gt; &gt; Jun 03 17:14:26 example.com dnsmasq-dhcp[3457]: read
&gt; &gt; &gt; /var/lib/libvirt/dnsmasq/default.hostsfile
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; $ sudo virsh list
&gt; &gt; &gt; Id    Name                           State
&gt; &gt; &gt; ----------------------------------------------------
&gt; &gt; &gt; 
&gt; &gt; &gt; $
&gt; &gt; &gt; 
&gt; &gt; &gt; As you can see, none of my vm's show up.  I'm guessing the "qemu-kvm:
&gt; &gt; &gt; internal error" results from renaming qemu-system-x86_64??
&gt; &gt; &gt; 
&gt; &gt; 
&gt; &gt; Yeah, feel free to move them back.
&gt; &gt; 
&gt; &gt; &gt; Could something else (selinux?) be involved?
&gt; &gt; 
&gt; &gt; It should not.  Now we know it is QEMU, but becuase it is disrupting
&gt; &gt; libvirt in its initialization phase, it looks like nothing works.
&gt; &gt; 
&gt; &gt; You could grab a backtrace of the qemu process and try on qemu-devel
&gt; &gt; ML.  Also, if you want to make sure (or see after what command gets
&gt; &gt; stuck), you can enable debug logs for libvirt into some file and then
&gt; &gt; grep that for QEMU_MONITOR_ and you'll see.
&gt; &gt; 
&gt; What should I be looking for?  I see QEMU_MONITOR_ in the source
&gt; (https://github.com/libvirt/libvirt/tree/v2.2-maint) but never see it in
&gt; the logs.
&gt; 
&gt; # pwd
&gt; /etc/libvirt
&gt; # diff libvirtd.conf libvirtd.conf.hold
&gt; 1,4d0
&gt; &lt; log_level = 1
&gt; &lt; log_filters="3:remote 4:event 3:json 3:rpc"
&gt; &lt; log_outputs="1:file:/var/log/libvirt/libvirtd.log"
&gt; &lt; #
&gt; # ls -al /var/log/libvirt/libvirtd.log
&gt; ls: cannot access '/var/log/libvirt/libvirtd.log': No such file or directory
&gt; # systemctl restart libvirtd.service
&gt; # ls -al /var/log/libvirt/libvirtd.log
&gt; -rw-------. 1 root root 801113 Jun  3 19:56 /var/log/libvirt/libvirtd.log
&gt; # grep QEMU_MONITOR_ /var/log/libvirt/libvirtd.log
&gt; # grep QEMU_MONITOR_ /var/log/libvirt/libvirtd.log
&gt; # grep QEMU_ /var/log/libvirt/libvirtd.log
&gt; # grep QEMU /var/log/libvirt/libvirtd.log
&gt; 2017-06-04 00:04:13.825+0000: 3363: debug : virRegisterConnectDriver:684
&gt; &gt; driver=0x7fa3f6c2e0e0 name=QEMU
&gt; 2017-06-04 00:04:13.825+0000: 3363: debug : virRegisterConnectDriver:695
&gt; &gt; registering QEMU as driver 9
&gt; 2017-06-04 00:04:14.302+0000: 3379: debug : virStateInitialize:769 :
&gt; Running global init for QEMU state driver
&gt; 2017-06-04 00:04:14.303+0000: 3379: info : virObjectNew:202 :
&gt; OBJECT_NEW: obj=0x7fa3d0122250 classname=virQEMUDriverConfig
&gt; 2017-06-04 00:04:14.305+0000: 3379: debug :
&gt; virSecurityManagerNewDriver:86 : drv=0x7fa44d580f40 (selinux)
&gt; virtDriver=QEMU flags=a
&gt; 2017-06-04 00:04:14.305+0000: 3379: debug :
&gt; virSecuritySELinuxInitialize:561 : SELinuxInitialize QEMU
&gt; 2017-06-04 00:04:14.307+0000: 3379: debug :
&gt; virSecuritySELinuxQEMUInitialize:516 : Loaded domain context
&gt; 'system_u:system_r:svirt_t:s0', alt domain context
&gt; 'system_u:system_r:svirt_tcg_t:s0'
&gt; 2017-06-04 00:04:14.307+0000: 3379: debug :
&gt; virSecuritySELinuxQEMUInitialize:537 : Loaded file context
&gt; 'system_u:object_r:svirt_image_t:s0', content context
&gt; 'system_u:object_r:virt_content_t:s0'
&gt; 2017-06-04 00:04:14.307+0000: 3379: debug :
&gt; virSecurityManagerNewDriver:86 : drv=0x7fa44d580cc0 (stack)
&gt; virtDriver=QEMU flags=a
&gt; 2017-06-04 00:04:14.307+0000: 3379: debug :
&gt; virSecurityManagerNewDriver:86 : drv=0x7fa44d580de0 (dac)
&gt; virtDriver=QEMU flags=a
&gt; 2017-06-04 00:04:14.313+0000: 3379: debug : virQEMUCapsCacheLookup:3985
&gt; &gt; Creating capabilities for /usr/bin/qemu-system-alpha
&gt; 2017-06-04 00:04:14.313+0000: 3379: info : virObjectNew:202 :
&gt; OBJECT_NEW: obj=0x7fa3d010bb00 classname=virQEMUCaps
&gt; 2017-06-04 00:04:14.313+0000: 3379: debug : virQEMUCapsInitCached:3292 :
&gt; No cached capabilities
&gt; '/var/cache/libvirt/qemu/capabilities/4b21437223cbdecdb4e776fe0bb40302a421554fc350bfbb986908518557721d.xml'
&gt;  for '/usr/bin/qemu-system-alpha'
&gt; 2017-06-04 00:04:14.313+0000: 3379: debug : virQEMUCapsInitQMP:3673 :
&gt; Try to get caps via QMP qemuCaps=0x7fa3d010bb00
&gt; [root@eastie libvirt]#
&gt; 
&gt; Here are the last few lines of that log file:
&gt; 
&gt; 2017-06-04 00:04:14.313+0000: 3379: debug : virQEMUCapsCacheLookup:3985
&gt; &gt; Creating capabilities for /usr/bin/qemu-system-alpha
&gt; 2017-06-04 00:04:14.313+0000: 3379: info : virObjectNew:202 :
&gt; OBJECT_NEW: obj=0x7fa3d010bb00 classname=virQEMUCaps
&gt; 2017-06-04 00:04:14.313+0000: 3379: debug : virFileMakePathHelper:2837 :
&gt; path=/var/cache/libvirt/qemu/capabilities mode=0777
&gt; 2017-06-04 00:04:14.313+0000: 3379: debug : virQEMUCapsInitCached:3292 :
&gt; No cached capabilities
&gt; '/var/cache/libvirt/qemu/capabilities/4b21437223cbdecdb4e776fe0bb40302a421554fc350bfbb986908518557721d.xml'
&gt;  for '/usr/bin/qemu-system-alpha'
&gt; 2017-06-04 00:04:14.313+0000: 3379: debug : virQEMUCapsInitQMP:3673 :
&gt; Try to get caps via QMP qemuCaps=0x7fa3d010bb00
&gt; 2017-06-04 00:04:14.313+0000: 3379: debug : virCommandRunAsync:2434 :
&gt; About to run LC_ALL=C
&gt; PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
&gt; /usr/bin/qemu-system-alpha -S -no-user-config -nodefaults -nographic -M
&gt; none -qmp
&gt; unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait
&gt; -pidfile /var/lib/libvirt/qemu/capabilities.pidfile -daemonize
&gt; 2017-06-04 00:04:14.314+0000: 3379: debug : virFileClose:102 : Closed fd 21
&gt; 2017-06-04 00:04:14.314+0000: 3379: debug : virFileClose:102 : Closed fd 23
&gt; 2017-06-04 00:04:14.314+0000: 3379: debug : virFileClose:102 : Closed fd 25
&gt; 2017-06-04 00:04:14.314+0000: 3379: debug : virCommandRunAsync:2437 :
&gt; Command result 0, with PID 3405
&gt; #
&gt; 
&gt; I changed the log filters to:
&gt; 
&gt; log_filters="1:remote 1:event 1:json 1:rpc"
&gt; 

you can remove this line completely, it just limits some of the messages
if there are higher numbers than the log_level.

&gt; Tried again, QEMU_MONITOR_ isn't in the log.
&gt; 

Now this is weird.  I would try a few more things, but it's lengthy
explaining them in the mail.  Plus we would be dealing with QEMU issues
at this point.  But what baffles me the most is, how come there aren't
more people having the same problem?

Anyway, if you'd like to try some more things, feel free to catch me on
IRC, although I probably won't be available during this weekend.

&gt; Thanks again for your help.
&gt; 

Not at all.  I didn't help much, did I? :)

&gt; &gt; [1] http://wiki.libvirt.org/page/DebugLogs
&gt; &gt; [2] I'm not sure about the whole thing to look for, but this is enough)
&gt; 
&gt; 
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170604224239</emailId><senderName>Michael C Cambria</senderName><senderEmail>mcc@fid4.com</senderEmail><timestampReceived>2017-06-04 22:42:39-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd not accepting connections</subject><body>



On 06/04/2017 05:46 AM, Martin Kletzander wrote:
&gt; On Sat, Jun 03, 2017 at 08:27:08PM -0400, Michael C Cambria wrote:
&gt; &gt; 
&gt; &gt; 
&gt; &gt; On 06/03/2017 05:47 PM, Martin Kletzander wrote:
&gt; &gt; &gt; On Sat, Jun 03, 2017 at 05:20:47PM -0400, Michael C Cambria wrote:
&gt; &gt; &gt; &gt; I also tried stopping libvirtd, renaming both qemu-system-i386 and
&gt; &gt; &gt; &gt; qemu-system-x86_64, start libvirtd.  Things get further along; dnsmasq
&gt; &gt; &gt; &gt; log messages show up.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; $ sudo systemctl status libvirtd.service
&gt; &gt; &gt; &gt; ● libvirtd.service - Virtualization daemon
&gt; &gt; &gt; &gt; Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled;
&gt; &gt; &gt; &gt; vendor preset: enabled)
&gt; &gt; &gt; &gt; Active: active (running) since Sat 2017-06-03 17:14:25 EDT; 7s ago
&gt; &gt; &gt; &gt; Docs: man:libvirtd(8)
&gt; &gt; &gt; &gt; http://libvirt.org
&gt; &gt; &gt; &gt; Main PID: 3246 (libvirtd)
&gt; &gt; &gt; &gt; Tasks: 21 (limit: 4915)
&gt; &gt; &gt; &gt; Memory: 107.4M
&gt; &gt; &gt; &gt; CPU: 300ms
&gt; &gt; &gt; &gt; CGroup: /system.slice/libvirtd.service
&gt; &gt; &gt; &gt; ├─3158 /usr/bin/qemu-system-i386 -S -no-user-config
&gt; &gt; &gt; &gt; -nodefaults -nographic -M none -qmp
&gt; &gt; &gt; &gt; unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait
&gt; &gt; &gt; &gt; -pidfile /var/lib/libvirt/qemu/capabilities.
&gt; &gt; &gt; &gt; ├─3160 /usr/bin/qemu-system-i386 -S -no-user-config
&gt; &gt; &gt; &gt; -nodefaults -nographic -M none -qmp
&gt; &gt; &gt; &gt; unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait
&gt; &gt; &gt; &gt; -pidfile /var/lib/libvirt/qemu/capabilities.
&gt; &gt; &gt; &gt; ├─3246 /usr/sbin/libvirtd
&gt; &gt; &gt; &gt; ├─3457 /sbin/dnsmasq
&gt; &gt; &gt; &gt; --conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro
&gt; &gt; &gt; &gt; --dhcp-script=/usr/libexec/libvirt_leaseshelper
&gt; &gt; &gt; &gt; └─3458 /sbin/dnsmasq
&gt; &gt; &gt; &gt; --conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro
&gt; &gt; &gt; &gt; --dhcp-script=/usr/libexec/libvirt_leaseshelper
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Jun 03 17:14:25 example.com libvirtd[3246]: Failed to probe 
&gt; &gt; &gt; &gt; capabilities
&gt; &gt; &gt; &gt; for /usr/bin/qemu-kvm: internal error: Child process (LC_ALL=C
&gt; &gt; &gt; &gt; PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin /usr/bin/qemu-k
&gt; &gt; &gt; &gt; Jun 03 17:14:26 example.com dnsmasq[3457]: started, version 2.76
&gt; &gt; &gt; &gt; cachesize 150
&gt; &gt; &gt; &gt; Jun 03 17:14:26 example.com dnsmasq[3457]: compile time options: IPv6
&gt; &gt; &gt; &gt; GNU-getopt DBus no-i18n IDN DHCP DHCPv6 no-Lua TFTP no-conntrack ipset
&gt; &gt; &gt; &gt; auth DNSSEC loop-detect inotify
&gt; &gt; &gt; &gt; Jun 03 17:14:26 example.com dnsmasq-dhcp[3457]: DHCP, IP range
&gt; &gt; &gt; &gt; 192.168.122.2 -- 192.168.122.254, lease time 1h
&gt; &gt; &gt; &gt; Jun 03 17:14:26 example.com dnsmasq-dhcp[3457]: DHCP, sockets bound
&gt; &gt; &gt; &gt; exclusively to interface virbr0
&gt; &gt; &gt; &gt; Jun 03 17:14:26 example.com dnsmasq[3457]: reading /etc/resolv.conf
&gt; &gt; &gt; &gt; Jun 03 17:14:26 example.com dnsmasq[3457]: using nameserver
&gt; &gt; &gt; &gt; 172.16.8.1#53
&gt; &gt; &gt; &gt; Jun 03 17:14:26 example.com dnsmasq[3457]: read /etc/hosts - 2 
&gt; &gt; &gt; &gt; addresses
&gt; &gt; &gt; &gt; Jun 03 17:14:26 example.com dnsmasq[3457]: read
&gt; &gt; &gt; &gt; /var/lib/libvirt/dnsmasq/default.addnhosts - 0 addresses
&gt; &gt; &gt; &gt; Jun 03 17:14:26 example.com dnsmasq-dhcp[3457]: read
&gt; &gt; &gt; &gt; /var/lib/libvirt/dnsmasq/default.hostsfile
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; $ sudo virsh list
&gt; &gt; &gt; &gt; Id    Name                           State
&gt; &gt; &gt; &gt; ----------------------------------------------------
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; $
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; As you can see, none of my vm's show up.  I'm guessing the "qemu-kvm:
&gt; &gt; &gt; &gt; internal error" results from renaming qemu-system-x86_64??
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; Yeah, feel free to move them back.
&gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Could something else (selinux?) be involved?
&gt; &gt; &gt; 
&gt; &gt; &gt; It should not.  Now we know it is QEMU, but becuase it is disrupting
&gt; &gt; &gt; libvirt in its initialization phase, it looks like nothing works.
&gt; &gt; &gt; 
&gt; &gt; &gt; You could grab a backtrace of the qemu process and try on qemu-devel
&gt; &gt; &gt; ML.  Also, if you want to make sure (or see after what command gets
&gt; &gt; &gt; stuck), you can enable debug logs for libvirt into some file and then
&gt; &gt; &gt; grep that for QEMU_MONITOR_ and you'll see.
&gt; &gt; &gt; 
&gt; &gt; What should I be looking for?  I see QEMU_MONITOR_ in the source
&gt; &gt; (https://github.com/libvirt/libvirt/tree/v2.2-maint) but never see it in
&gt; &gt; the logs.
&gt; &gt; 
&gt; &gt; # pwd
&gt; &gt; /etc/libvirt
&gt; &gt; # diff libvirtd.conf libvirtd.conf.hold
&gt; &gt; 1,4d0
&gt; &gt; &lt; log_level = 1
&gt; &gt; &lt; log_filters="3:remote 4:event 3:json 3:rpc"
&gt; &gt; &lt; log_outputs="1:file:/var/log/libvirt/libvirtd.log"
&gt; &gt; &lt; #
&gt; &gt; # ls -al /var/log/libvirt/libvirtd.log
&gt; &gt; ls: cannot access '/var/log/libvirt/libvirtd.log': No such file or 
&gt; &gt; directory
&gt; &gt; # systemctl restart libvirtd.service
&gt; &gt; # ls -al /var/log/libvirt/libvirtd.log
&gt; &gt; -rw-------. 1 root root 801113 Jun  3 19:56 
&gt; &gt; /var/log/libvirt/libvirtd.log
&gt; &gt; # grep QEMU_MONITOR_ /var/log/libvirt/libvirtd.log
&gt; &gt; # grep QEMU_MONITOR_ /var/log/libvirt/libvirtd.log
&gt; &gt; # grep QEMU_ /var/log/libvirt/libvirtd.log
&gt; &gt; # grep QEMU /var/log/libvirt/libvirtd.log
&gt; &gt; 2017-06-04 00:04:13.825+0000: 3363: debug : virRegisterConnectDriver:684
&gt; &gt; &gt; driver=0x7fa3f6c2e0e0 name=QEMU
&gt; &gt; 2017-06-04 00:04:13.825+0000: 3363: debug : virRegisterConnectDriver:695
&gt; &gt; &gt; registering QEMU as driver 9
&gt; &gt; 2017-06-04 00:04:14.302+0000: 3379: debug : virStateInitialize:769 :
&gt; &gt; Running global init for QEMU state driver
&gt; &gt; 2017-06-04 00:04:14.303+0000: 3379: info : virObjectNew:202 :
&gt; &gt; OBJECT_NEW: obj=0x7fa3d0122250 classname=virQEMUDriverConfig
&gt; &gt; 2017-06-04 00:04:14.305+0000: 3379: debug :
&gt; &gt; virSecurityManagerNewDriver:86 : drv=0x7fa44d580f40 (selinux)
&gt; &gt; virtDriver=QEMU flags=a
&gt; &gt; 2017-06-04 00:04:14.305+0000: 3379: debug :
&gt; &gt; virSecuritySELinuxInitialize:561 : SELinuxInitialize QEMU
&gt; &gt; 2017-06-04 00:04:14.307+0000: 3379: debug :
&gt; &gt; virSecuritySELinuxQEMUInitialize:516 : Loaded domain context
&gt; &gt; 'system_u:system_r:svirt_t:s0', alt domain context
&gt; &gt; 'system_u:system_r:svirt_tcg_t:s0'
&gt; &gt; 2017-06-04 00:04:14.307+0000: 3379: debug :
&gt; &gt; virSecuritySELinuxQEMUInitialize:537 : Loaded file context
&gt; &gt; 'system_u:object_r:svirt_image_t:s0', content context
&gt; &gt; 'system_u:object_r:virt_content_t:s0'
&gt; &gt; 2017-06-04 00:04:14.307+0000: 3379: debug :
&gt; &gt; virSecurityManagerNewDriver:86 : drv=0x7fa44d580cc0 (stack)
&gt; &gt; virtDriver=QEMU flags=a
&gt; &gt; 2017-06-04 00:04:14.307+0000: 3379: debug :
&gt; &gt; virSecurityManagerNewDriver:86 : drv=0x7fa44d580de0 (dac)
&gt; &gt; virtDriver=QEMU flags=a
&gt; &gt; 2017-06-04 00:04:14.313+0000: 3379: debug : virQEMUCapsCacheLookup:3985
&gt; &gt; &gt; Creating capabilities for /usr/bin/qemu-system-alpha
&gt; &gt; 2017-06-04 00:04:14.313+0000: 3379: info : virObjectNew:202 :
&gt; &gt; OBJECT_NEW: obj=0x7fa3d010bb00 classname=virQEMUCaps
&gt; &gt; 2017-06-04 00:04:14.313+0000: 3379: debug : virQEMUCapsInitCached:3292 :
&gt; &gt; No cached capabilities
&gt; &gt; '/var/cache/libvirt/qemu/capabilities/4b21437223cbdecdb4e776fe0bb40302a421554fc350bfbb986908518557721d.xml' \
&gt; &gt;  
&gt; &gt; for '/usr/bin/qemu-system-alpha'
&gt; &gt; 2017-06-04 00:04:14.313+0000: 3379: debug : virQEMUCapsInitQMP:3673 :
&gt; &gt; Try to get caps via QMP qemuCaps=0x7fa3d010bb00
&gt; &gt; [root@eastie libvirt]#
&gt; &gt; 
&gt; &gt; Here are the last few lines of that log file:
&gt; &gt; 
&gt; &gt; 2017-06-04 00:04:14.313+0000: 3379: debug : virQEMUCapsCacheLookup:3985
&gt; &gt; &gt; Creating capabilities for /usr/bin/qemu-system-alpha
&gt; &gt; 2017-06-04 00:04:14.313+0000: 3379: info : virObjectNew:202 :
&gt; &gt; OBJECT_NEW: obj=0x7fa3d010bb00 classname=virQEMUCaps
&gt; &gt; 2017-06-04 00:04:14.313+0000: 3379: debug : virFileMakePathHelper:2837 :
&gt; &gt; path=/var/cache/libvirt/qemu/capabilities mode=0777
&gt; &gt; 2017-06-04 00:04:14.313+0000: 3379: debug : virQEMUCapsInitCached:3292 :
&gt; &gt; No cached capabilities
&gt; &gt; '/var/cache/libvirt/qemu/capabilities/4b21437223cbdecdb4e776fe0bb40302a421554fc350bfbb986908518557721d.xml' \
&gt; &gt;  
&gt; &gt; for '/usr/bin/qemu-system-alpha'
&gt; &gt; 2017-06-04 00:04:14.313+0000: 3379: debug : virQEMUCapsInitQMP:3673 :
&gt; &gt; Try to get caps via QMP qemuCaps=0x7fa3d010bb00
&gt; &gt; 2017-06-04 00:04:14.313+0000: 3379: debug : virCommandRunAsync:2434 :
&gt; &gt; About to run LC_ALL=C
&gt; &gt; PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
&gt; &gt; /usr/bin/qemu-system-alpha -S -no-user-config -nodefaults -nographic -M
&gt; &gt; none -qmp
&gt; &gt; unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait
&gt; &gt; -pidfile /var/lib/libvirt/qemu/capabilities.pidfile -daemonize
&gt; &gt; 2017-06-04 00:04:14.314+0000: 3379: debug : virFileClose:102 : Closed 
&gt; &gt; fd 21
&gt; &gt; 2017-06-04 00:04:14.314+0000: 3379: debug : virFileClose:102 : Closed 
&gt; &gt; fd 23
&gt; &gt; 2017-06-04 00:04:14.314+0000: 3379: debug : virFileClose:102 : Closed 
&gt; &gt; fd 25
&gt; &gt; 2017-06-04 00:04:14.314+0000: 3379: debug : virCommandRunAsync:2437 :
&gt; &gt; Command result 0, with PID 3405
&gt; &gt; #
&gt; &gt; 
&gt; &gt; I changed the log filters to:
&gt; &gt; 
&gt; &gt; log_filters="1:remote 1:event 1:json 1:rpc"
&gt; &gt; 
&gt; 
&gt; you can remove this line completely, it just limits some of the messages
&gt; if there are higher numbers than the log_level.
&gt; 
&gt; &gt; Tried again, QEMU_MONITOR_ isn't in the log.
&gt; &gt; 
&gt; 
&gt; Now this is weird.  I would try a few more things, but it's lengthy
&gt; explaining them in the mail.  Plus we would be dealing with QEMU issues
&gt; at this point.  But what baffles me the most is, how come there aren't
&gt; more people having the same problem?
&gt; 

I've upgraded from Fedora 20; probably missed a merge of rpmnew with 
existing .conf; permission problem, some other mistake along the way to 
Fedora 25.

Is there a "how to" similar to [1] that lets one qemu to log that it was 
invoked and how far it got?

I removed qemu (dnf remote qemu; sudo dnf remove qemu-common)
build qemu 2.2-maint (assuming this relates to 2:2.7.1-6.fc25) from 
github sources
installed qemu from sources (into /usr/local/bin)

Things are a bit better.  Where something like "sudo virsh pool-list" 
would just hang before, now my storage pools actually are listed.  No 
luck listing my VM's, but "virsh list" and "virsh list --all" do not 
hang like before:

# virsh list
  Id    Name                           State
----------------------------------------------------

# virsh pool-list
  Name                 State      Autostart
-------------------------------------------
  default              active     yes
  Downloads            active     yes
  guest_images_lvm     active     yes

#

VM xml is /etc/libvirt/qemu.  The network, virbr0 is in 
/etc/libvirt/qemu/networks, and that gets created just fine.  All have 
root:root owner:group:

$ sudo systemctl stop libvirtd.service
$ sudo ip addr show virbr0
7: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue 
state DOWN group default qlen 1000
     link/ether 52:54:00:5b:f7:0b brd ff:ff:ff:ff:ff:ff
     inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0
        valid_lft forever preferred_lft forever
$ sudo ip link del virbr0
$ sudo ip addr show virbr0
Device "virbr0" does not exist.
$ sudo systemctl start libvirtd.service
$ sudo ip addr show virbr0
9: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue 
state DOWN group default qlen 1000
     link/ether 52:54:00:5b:f7:0b brd ff:ff:ff:ff:ff:ff
     inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0
        valid_lft forever preferred_lft forever
$


&gt; Anyway, if you'd like to try some more things, feel free to catch me on
&gt; IRC, although I probably won't be available during this weekend.
&gt; 

Not a problem.  I appreciate your help.

&gt; &gt; Thanks again for your help.
&gt; &gt; 
&gt; 
&gt; Not at all.  I didn't help much, did I? :)
&gt; 
&gt; &gt; &gt; [1] http://wiki.libvirt.org/page/DebugLogs
&gt; &gt; &gt; [2] I'm not sure about the whole thing to look for, but this is enough)
&gt; &gt; 
&gt; &gt; 
&gt; &gt; _______________________________________________
&gt; &gt; libvirt-users mailing list
&gt; &gt; libvirt-users@redhat.com
&gt; &gt; https://www.redhat.com/mailman/listinfo/libvirt-users


</body></email><email><emailId>20170605144631</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-06-05 14:46:31-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd not accepting connections</subject><body>


On Sun, Jun 04, 2017 at 06:42:39PM -0400, Michael C Cambria wrote:
&gt;I've upgraded from Fedora 20; probably missed a merge of rpmnew with
&gt;existing .conf; permission problem, some other mistake along the way to
&gt;Fedora 25.
&gt;

Yeah, probably some 'rpm -qV' (or whatever the command to verify all
packages is) could help as well.

&gt;Is there a "how to" similar to [1] that lets one qemu to log that it was
&gt;invoked and how far it got?
&gt;
&gt;I removed qemu (dnf remote qemu; sudo dnf remove qemu-common)
&gt;build qemu 2.2-maint (assuming this relates to 2:2.7.1-6.fc25) from
&gt;github sources
&gt;installed qemu from sources (into /usr/local/bin)
&gt;
&gt;Things are a bit better.  Where something like "sudo virsh pool-list"
&gt;would just hang before, now my storage pools actually are listed.  No
&gt;luck listing my VM's, but "virsh list" and "virsh list --all" do not
&gt;hang like before:
&gt;
&gt;# virsh list

Are you sure you didn't miss the --all?

&gt;  Id    Name                           State
&gt;----------------------------------------------------
&gt;
&gt;# virsh pool-list
&gt;  Name                 State      Autostart
&gt;-------------------------------------------
&gt;  default              active     yes
&gt;  Downloads            active     yes
&gt;  guest_images_lvm     active     yes
&gt;
&gt;#
&gt;
&gt;VM xml is /etc/libvirt/qemu.  The network, virbr0 is in
&gt;/etc/libvirt/qemu/networks, and that gets created just fine.  All have
&gt;root:root owner:group:
&gt;

The VMs are not visible because the XML cannot be parsed if the binaries
are not on the system (the XML contains the whole path).  Also, I think
this works because libvirt doesn't look into /usr/local/bin, but I might
be wrong.  Check whether 'virsh capabilities' tells you something about
any emulator.

You can try installing from source, but putting it in /usr/bin, you can
also remove that installation, put back the one from the package and try
running:

  { for i in qmp_capabilities query-commands quit; do echo
  "{'execute':'$i'}"; done } | qemu-system-x86_64 -nographic -nodefaults
  -no-user-config -M none -qmp stdio

And see whether the QEMU process quits, what it outputs and if it gets
stuck, you can attach gdb and see what it's waiting for.  Or maybe try
running it with strace.

You can also do a thing I used to do a lot.  You can rename
/usr/bin/qemu-system-x86_64 (for example) and create a script with that
filename that for example execs as qemu in strace with the output of
strace put in some file, or similar.  I can't think of anything else for
now, sorry.

Have a nice day,
Martin

P.S.: If qemu gets stuc even with that easy command, then it's
      definitely its fault.

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170605235258</emailId><senderName>Michael C Cambria</senderName><senderEmail>mcc@fid4.com</senderEmail><timestampReceived>2017-06-05 23:52:58-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd not accepting connections</subject><body>



On 06/05/2017 10:46 AM, Martin Kletzander wrote:
&gt; On Sun, Jun 04, 2017 at 06:42:39PM -0400, Michael C Cambria wrote:
&gt;&gt; I've upgraded from Fedora 20; probably missed a merge of rpmnew with
&gt;&gt; existing .conf; permission problem, some other mistake along the way to
&gt;&gt; Fedora 25.
&gt;&gt;
&gt;
&gt; Yeah, probably some 'rpm -qV' (or whatever the command to verify all
&gt; packages is) could help as well.

"rpm -aV" didn't turn up anything obvious:

S.5....T.  c /etc/libvirt/libvirtd.conf was modified for logging:
# diff libvirtd.conf libvirtd.conf.rpmnew
1,4d0
&lt; log_level = 1
&lt; log_filters="1:remote 1:event 1:json 1:rpc 1:qemu"
&lt; log_outputs="1:file:/var/log/libvirt/libvirtd.log"
&lt; #
#

&gt;&gt; Is there a "how to" similar to [1] that lets one qemu to log that it was
&gt;&gt; invoked and how far it got?
&gt;&gt;
&gt;&gt; I removed qemu (dnf remote qemu; sudo dnf remove qemu-common)
&gt;&gt; build qemu 2.2-maint (assuming this relates to 2:2.7.1-6.fc25) from
&gt;&gt; github sources
&gt;&gt; installed qemu from sources (into /usr/local/bin)
&gt;&gt;
&gt;&gt; Things are a bit better.  Where something like "sudo virsh pool-list"
&gt;&gt; would just hang before, now my storage pools actually are listed.  No
&gt;&gt; luck listing my VM's, but "virsh list" and "virsh list --all" do not
&gt;&gt; hang like before:
&gt;&gt;
&gt;&gt; # virsh list
&gt;
&gt; Are you sure you didn't miss the --all?
&gt;
Yes I'm sure.  I wish that was all it was &lt;g&gt;

&gt;&gt;  Id    Name State
&gt;&gt; ----------------------------------------------------
&gt;&gt;
&gt;&gt; # virsh pool-list
&gt;&gt;  Name                 State      Autostart
&gt;&gt; -------------------------------------------
&gt;&gt;  default              active     yes
&gt;&gt;  Downloads            active     yes
&gt;&gt;  guest_images_lvm     active     yes
&gt;&gt;
&gt;&gt; #
&gt;&gt;
&gt;&gt; VM xml is /etc/libvirt/qemu.  The network, virbr0 is in
&gt;&gt; /etc/libvirt/qemu/networks, and that gets created just fine. All have
&gt;&gt; root:root owner:group:
&gt;&gt;
&gt;
&gt; The VMs are not visible because the XML cannot be parsed if the binaries
&gt; are not on the system (the XML contains the whole path).  Also, I think
&gt; this works because libvirt doesn't look into /usr/local/bin, but I might
&gt; be wrong.  Check whether 'virsh capabilities' tells you something about
&gt; any emulator.
&gt;
&gt; You can try installing from source, but putting it in /usr/bin, 


I put qemu-system-x86_64 and qemu-x86_64 in /usr/bin as requested. No 
luck.  It seems /usr/local/bin/qemu-xxx is found (see CGroup: output)

$ sudo systemctl status libvirtd.service
● libvirtd.service - Virtualization daemon
    Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled; 
vendor preset: enabled)
    Active: active (running) since Mon 2017-06-05 18:21:20 EDT; 3s ago
      Docs: man:libvirtd(8)
            http://libvirt.org
  Main PID: 7076 (libvirtd)
     Tasks: 19 (limit: 4915)
    Memory: 124.7M
       CPU: 3.649s
    CGroup: /system.slice/libvirtd.service
            ├─7076 /usr/sbin/libvirtd
            └─7208 /usr/local/bin/qemu-system-sh4eb -S -no-user-config 
-nodefaults -nographic -M none -qmp 
unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait 
-pidfile /var/lib/libvirt/qemu/capabi

$ sudo virsh list --all
  Id    Name                           State
----------------------------------------------------

$ sudo virsh pool-list
  Name                 State      Autostart
-------------------------------------------
  default              active     yes
  Downloads            active     yes
  guest_images_lvm     active     yes

$

&gt; you can
&gt; also remove that installation, put back the one from the package and try
&gt; running:
&gt;
&gt;  { for i in qmp_capabilities query-commands quit; do echo
&gt;  "{'execute':'$i'}"; done } | qemu-system-x86_64 -nographic -nodefaults
&gt;  -no-user-config -M none -qmp stdio
&gt;
&gt; And see whether the QEMU process quits, what it outputs and if it gets
&gt; stuck, you can attach gdb and see what it's waiting for.  Or maybe try
&gt; running it with strace.

This completed almost instantly.

&gt; You can also do a thing I used to do a lot.  You can rename
&gt; /usr/bin/qemu-system-x86_64 (for example) and create a script with that
&gt; filename that for example execs as qemu in strace with the output of
&gt; strace put in some file, or similar.  I can't think of anything else for
&gt; now, sorry.

I'll try this ASAP.   First I'll look at all the QEMU_MONITOR_* log 
entries that contain "error" that I *am* getting with qemu installed 
from source (in /usr/local/bin/qemu-*)

2017-06-05 23:06:39.884+0000: 15559: info : 
virEventPollDispatchHandles:506 : EVENT_POLL_DISPATCH_HANDLE: watch=11 
events=1
2017-06-05 23:06:39.884+0000: 15559: info : virObjectRef:296 : 
OBJECT_REF: obj=0x7f0a603d33b0
2017-06-05 23:06:39.884+0000: 15559: info : qemuMonitorIOProcess:429 : 
QEMU_MONITOR_IO_PROCESS: mon=0x7f0a603d33b0 buf={"id": "libvirt-41", 
"error": {"class": "GenericError", "desc": "this feature or command is 
not currently supported"}}^M
  len=120
2017-06-05 23:06:39.884+0000: 15559: debug : 
qemuMonitorJSONIOProcessLine:191 : Line [{"id": "libvirt-41", "error": 
{"class": "GenericError", "desc": "this feature or command is not 
currently supported"}}]
2017-06-05 23:06:39.884+0000: 15559: debug : virJSONValueFromString:1604 
: string={"id": "libvirt-41", "error": {"class": "GenericError", "desc": 
"this feature or command is not currently supported"}}
2017-06-05 23:06:39.884+0000: 15559: debug : 
virJSONParserHandleStartMap:1478 : parser=0x7ffe4440afd0


&gt; Have a nice day,
&gt; Martin
&gt;
Thank you, you too!


</body></email><email><emailId>20170606084320</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-06-06 08:43:20-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd not accepting connections</subject><body>


On Mon, Jun 05, 2017 at 07:52:58PM -0400, Michael C Cambria wrote:
&gt;
&gt;
&gt;On 06/05/2017 10:46 AM, Martin Kletzander wrote:
&gt;&gt; On Sun, Jun 04, 2017 at 06:42:39PM -0400, Michael C Cambria wrote:
&gt;&gt;&gt; I've upgraded from Fedora 20; probably missed a merge of rpmnew with
&gt;&gt;&gt; existing .conf; permission problem, some other mistake along the way to
&gt;&gt;&gt; Fedora 25.
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; Yeah, probably some 'rpm -qV' (or whatever the command to verify all
&gt;&gt; packages is) could help as well.
&gt;
&gt;"rpm -aV" didn't turn up anything obvious:
&gt;
&gt;S.5....T.  c /etc/libvirt/libvirtd.conf was modified for logging:
&gt;# diff libvirtd.conf libvirtd.conf.rpmnew
&gt;1,4d0
&gt;&lt; log_level = 1
&gt;&lt; log_filters="1:remote 1:event 1:json 1:rpc 1:qemu"
&gt;&lt; log_outputs="1:file:/var/log/libvirt/libvirtd.log"
&gt;&lt; #
&gt;#
&gt;
&gt;&gt;&gt; Is there a "how to" similar to [1] that lets one qemu to log that it was
&gt;&gt;&gt; invoked and how far it got?
&gt;&gt;&gt;
&gt;&gt;&gt; I removed qemu (dnf remote qemu; sudo dnf remove qemu-common)
&gt;&gt;&gt; build qemu 2.2-maint (assuming this relates to 2:2.7.1-6.fc25) from
&gt;&gt;&gt; github sources
&gt;&gt;&gt; installed qemu from sources (into /usr/local/bin)
&gt;&gt;&gt;
&gt;&gt;&gt; Things are a bit better.  Where something like "sudo virsh pool-list"
&gt;&gt;&gt; would just hang before, now my storage pools actually are listed.  No
&gt;&gt;&gt; luck listing my VM's, but "virsh list" and "virsh list --all" do not
&gt;&gt;&gt; hang like before:
&gt;&gt;&gt;
&gt;&gt;&gt; # virsh list
&gt;&gt;
&gt;&gt; Are you sure you didn't miss the --all?
&gt;&gt;
&gt;Yes I'm sure.  I wish that was all it was &lt;g&gt;
&gt;
&gt;&gt;&gt;  Id    Name State
&gt;&gt;&gt; ----------------------------------------------------
&gt;&gt;&gt;
&gt;&gt;&gt; # virsh pool-list
&gt;&gt;&gt;  Name                 State      Autostart
&gt;&gt;&gt; -------------------------------------------
&gt;&gt;&gt;  default              active     yes
&gt;&gt;&gt;  Downloads            active     yes
&gt;&gt;&gt;  guest_images_lvm     active     yes
&gt;&gt;&gt;
&gt;&gt;&gt; #
&gt;&gt;&gt;
&gt;&gt;&gt; VM xml is /etc/libvirt/qemu.  The network, virbr0 is in
&gt;&gt;&gt; /etc/libvirt/qemu/networks, and that gets created just fine. All have
&gt;&gt;&gt; root:root owner:group:
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; The VMs are not visible because the XML cannot be parsed if the binaries
&gt;&gt; are not on the system (the XML contains the whole path).  Also, I think
&gt;&gt; this works because libvirt doesn't look into /usr/local/bin, but I might
&gt;&gt; be wrong.  Check whether 'virsh capabilities' tells you something about
&gt;&gt; any emulator.
&gt;&gt;
&gt;&gt; You can try installing from source, but putting it in /usr/bin,
&gt;
&gt;
&gt;I put qemu-system-x86_64 and qemu-x86_64 in /usr/bin as requested. No
&gt;luck.  It seems /usr/local/bin/qemu-xxx is found (see CGroup: output)
&gt;
&gt;$ sudo systemctl status libvirtd.service
&gt;● libvirtd.service - Virtualization daemon
&gt;    Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled;
&gt;vendor preset: enabled)
&gt;    Active: active (running) since Mon 2017-06-05 18:21:20 EDT; 3s ago
&gt;      Docs: man:libvirtd(8)
&gt;            http://libvirt.org
&gt;  Main PID: 7076 (libvirtd)
&gt;     Tasks: 19 (limit: 4915)
&gt;    Memory: 124.7M
&gt;       CPU: 3.649s
&gt;    CGroup: /system.slice/libvirtd.service
&gt;            ├─7076 /usr/sbin/libvirtd
&gt;            └─7208 /usr/local/bin/qemu-system-sh4eb -S -no-user-config
&gt;-nodefaults -nographic -M none -qmp
&gt;unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait
&gt;-pidfile /var/lib/libvirt/qemu/capabi
&gt;

So this is now only with the qemu from source installed on the system?

&gt;$ sudo virsh list --all
&gt;  Id    Name                           State
&gt;----------------------------------------------------
&gt;
&gt;$ sudo virsh pool-list
&gt;  Name                 State      Autostart
&gt;-------------------------------------------
&gt;  default              active     yes
&gt;  Downloads            active     yes
&gt;  guest_images_lvm     active     yes
&gt;
&gt;$
&gt;
&gt;&gt; you can
&gt;&gt; also remove that installation, put back the one from the package and try
&gt;&gt; running:
&gt;&gt;
&gt;&gt;  { for i in qmp_capabilities query-commands quit; do echo
&gt;&gt;  "{'execute':'$i'}"; done } | qemu-system-x86_64 -nographic -nodefaults
&gt;&gt;  -no-user-config -M none -qmp stdio
&gt;&gt;
&gt;&gt; And see whether the QEMU process quits, what it outputs and if it gets
&gt;&gt; stuck, you can attach gdb and see what it's waiting for.  Or maybe try
&gt;&gt; running it with strace.
&gt;
&gt;This completed almost instantly.
&gt;

And that is with the QEMU installed form the package, right?

&gt;&gt; You can also do a thing I used to do a lot.  You can rename
&gt;&gt; /usr/bin/qemu-system-x86_64 (for example) and create a script with that
&gt;&gt; filename that for example execs as qemu in strace with the output of
&gt;&gt; strace put in some file, or similar.  I can't think of anything else for
&gt;&gt; now, sorry.
&gt;
&gt;I'll try this ASAP.   First I'll look at all the QEMU_MONITOR_* log
&gt;entries that contain "error" that I *am* getting with qemu installed
&gt;from source (in /usr/local/bin/qemu-*)
&gt;
&gt;2017-06-05 23:06:39.884+0000: 15559: info :
&gt;virEventPollDispatchHandles:506 : EVENT_POLL_DISPATCH_HANDLE: watch=11
&gt;events=1
&gt;2017-06-05 23:06:39.884+0000: 15559: info : virObjectRef:296 :
&gt;OBJECT_REF: obj=0x7f0a603d33b0
&gt;2017-06-05 23:06:39.884+0000: 15559: info : qemuMonitorIOProcess:429 :
&gt;QEMU_MONITOR_IO_PROCESS: mon=0x7f0a603d33b0 buf={"id": "libvirt-41",
&gt;"error": {"class": "GenericError", "desc": "this feature or command is
&gt;not currently supported"}}^M
&gt;  len=120

Well, at least QEMU_MONITOR_ messages are showing, finally.  The non-x86
machines might be missing lot of commands that libvirt needs.  Like
'query-commands' which we need to know which commands we can run (bit of
a catch 22 right there).  But these should not happen with x86, x86_64,
arm, arm64 (or aarch64), and few others.  Those are being maintained
continuously.

&gt;2017-06-05 23:06:39.884+0000: 15559: debug :
&gt;qemuMonitorJSONIOProcessLine:191 : Line [{"id": "libvirt-41", "error":
&gt;{"class": "GenericError", "desc": "this feature or command is not
&gt;currently supported"}}]
&gt;2017-06-05 23:06:39.884+0000: 15559: debug : virJSONValueFromString:1604
&gt;: string={"id": "libvirt-41", "error": {"class": "GenericError", "desc":
&gt;"this feature or command is not currently supported"}}
&gt;2017-06-05 23:06:39.884+0000: 15559: debug :
&gt;virJSONParserHandleStartMap:1478 : parser=0x7ffe4440afd0
&gt;
&gt;
&gt;&gt; Have a nice day,
&gt;&gt; Martin
&gt;&gt;
&gt;Thank you, you too!
&gt;
&gt;
&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170606121707</emailId><senderName>"Michael C. Cambria"</senderName><senderEmail>mcc@fid4.com</senderEmail><timestampReceived>2017-06-06 12:17:07-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd not accepting connections</subject><body>



On 06/06/2017 04:43 AM, Martin Kletzander wrote:
&gt; On Mon, Jun 05, 2017 at 07:52:58PM -0400, Michael C Cambria wrote:
&gt;&gt;
&gt;&gt;
&gt;&gt; On 06/05/2017 10:46 AM, Martin Kletzander wrote:
&gt;&gt;&gt; On Sun, Jun 04, 2017 at 06:42:39PM -0400, Michael C Cambria wrote:
&gt;&gt;&gt;&gt; I've upgraded from Fedora 20; probably missed a merge of rpmnew with
&gt;&gt;&gt;&gt; existing .conf; permission problem, some other mistake along the 
&gt;&gt;&gt;&gt; way to
&gt;&gt;&gt;&gt; Fedora 25.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Yeah, probably some 'rpm -qV' (or whatever the command to verify all
&gt;&gt;&gt; packages is) could help as well.
&gt;&gt;
&gt;&gt; "rpm -aV" didn't turn up anything obvious:
&gt;&gt;
&gt;&gt; S.5....T.  c /etc/libvirt/libvirtd.conf was modified for logging:
&gt;&gt; # diff libvirtd.conf libvirtd.conf.rpmnew
&gt;&gt; 1,4d0
&gt;&gt; &lt; log_level = 1
&gt;&gt; &lt; log_filters="1:remote 1:event 1:json 1:rpc 1:qemu"
&gt;&gt; &lt; log_outputs="1:file:/var/log/libvirt/libvirtd.log"
&gt;&gt; &lt; #
&gt;&gt; #
&gt;&gt;
&gt;&gt;&gt;&gt; Is there a "how to" similar to [1] that lets one qemu to log that 
&gt;&gt;&gt;&gt; it was
&gt;&gt;&gt;&gt; invoked and how far it got?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I removed qemu (dnf remote qemu; sudo dnf remove qemu-common)
&gt;&gt;&gt;&gt; build qemu 2.2-maint (assuming this relates to 2:2.7.1-6.fc25) from
&gt;&gt;&gt;&gt; github sources
&gt;&gt;&gt;&gt; installed qemu from sources (into /usr/local/bin)
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Things are a bit better.  Where something like "sudo virsh pool-list"
&gt;&gt;&gt;&gt; would just hang before, now my storage pools actually are listed.  No
&gt;&gt;&gt;&gt; luck listing my VM's, but "virsh list" and "virsh list --all" do not
&gt;&gt;&gt;&gt; hang like before:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; # virsh list
&gt;&gt;&gt;
&gt;&gt;&gt; Are you sure you didn't miss the --all?
&gt;&gt;&gt;
&gt;&gt; Yes I'm sure.  I wish that was all it was &lt;g&gt;
&gt;&gt;
&gt;&gt;&gt;&gt;  Id    Name State
&gt;&gt;&gt;&gt; ----------------------------------------------------
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; # virsh pool-list
&gt;&gt;&gt;&gt;  Name                 State      Autostart
&gt;&gt;&gt;&gt; -------------------------------------------
&gt;&gt;&gt;&gt;  default              active     yes
&gt;&gt;&gt;&gt;  Downloads            active     yes
&gt;&gt;&gt;&gt;  guest_images_lvm     active     yes
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; #
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; VM xml is /etc/libvirt/qemu.  The network, virbr0 is in
&gt;&gt;&gt;&gt; /etc/libvirt/qemu/networks, and that gets created just fine. All have
&gt;&gt;&gt;&gt; root:root owner:group:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; The VMs are not visible because the XML cannot be parsed if the 
&gt;&gt;&gt; binaries
&gt;&gt;&gt; are not on the system (the XML contains the whole path). Also, I think
&gt;&gt;&gt; this works because libvirt doesn't look into /usr/local/bin, but I 
&gt;&gt;&gt; might
&gt;&gt;&gt; be wrong.  Check whether 'virsh capabilities' tells you something about
&gt;&gt;&gt; any emulator.
&gt;&gt;&gt;
&gt;&gt;&gt; You can try installing from source, but putting it in /usr/bin,
&gt;&gt;
&gt;&gt;
&gt;&gt; I put qemu-system-x86_64 and qemu-x86_64 in /usr/bin as requested. No
&gt;&gt; luck.  It seems /usr/local/bin/qemu-xxx is found (see CGroup: output)
&gt;&gt;
&gt;&gt; $ sudo systemctl status libvirtd.service
&gt;&gt; ● libvirtd.service - Virtualization daemon
&gt;&gt;    Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled;
&gt;&gt; vendor preset: enabled)
&gt;&gt;    Active: active (running) since Mon 2017-06-05 18:21:20 EDT; 3s ago
&gt;&gt;      Docs: man:libvirtd(8)
&gt;&gt;            http://libvirt.org
&gt;&gt;  Main PID: 7076 (libvirtd)
&gt;&gt;     Tasks: 19 (limit: 4915)
&gt;&gt;    Memory: 124.7M
&gt;&gt;       CPU: 3.649s
&gt;&gt;    CGroup: /system.slice/libvirtd.service
&gt;&gt;            ├─7076 /usr/sbin/libvirtd
&gt;&gt;            └─7208 /usr/local/bin/qemu-system-sh4eb -S -no-user-config
&gt;&gt; -nodefaults -nographic -M none -qmp
&gt;&gt; unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait
&gt;&gt; -pidfile /var/lib/libvirt/qemu/capabi
&gt;&gt;
&gt;
&gt; So this is now only with the qemu from source installed on the system?

Correct.
&gt;
&gt;&gt; $ sudo virsh list --all
&gt;&gt;  Id    Name                           State
&gt;&gt; ----------------------------------------------------
&gt;&gt;
&gt;&gt; $ sudo virsh pool-list
&gt;&gt;  Name                 State      Autostart
&gt;&gt; -------------------------------------------
&gt;&gt;  default              active     yes
&gt;&gt;  Downloads            active     yes
&gt;&gt;  guest_images_lvm     active     yes
&gt;&gt;
&gt;&gt; $
&gt;&gt;
&gt;&gt;&gt; you can
&gt;&gt;&gt; also remove that installation, put back the one from the package and 
&gt;&gt;&gt; try
&gt;&gt;&gt; running:
&gt;&gt;&gt;
&gt;&gt;&gt;  { for i in qmp_capabilities query-commands quit; do echo
&gt;&gt;&gt;  "{'execute':'$i'}"; done } | qemu-system-x86_64 -nographic -nodefaults
&gt;&gt;&gt;  -no-user-config -M none -qmp stdio
&gt;&gt;&gt;
&gt;&gt;&gt; And see whether the QEMU process quits, what it outputs and if it gets
&gt;&gt;&gt; stuck, you can attach gdb and see what it's waiting for.  Or maybe try
&gt;&gt;&gt; running it with strace.
&gt;&gt;
&gt;&gt; This completed almost instantly.
&gt;&gt;
&gt;
&gt; And that is with the QEMU installed form the package, right?

Correct

&gt;
&gt;&gt;&gt; You can also do a thing I used to do a lot.  You can rename
&gt;&gt;&gt; /usr/bin/qemu-system-x86_64 (for example) and create a script with that
&gt;&gt;&gt; filename that for example execs as qemu in strace with the output of
&gt;&gt;&gt; strace put in some file, or similar.  I can't think of anything else 
&gt;&gt;&gt; for
&gt;&gt;&gt; now, sorry.
&gt;&gt;
&gt;&gt; I'll try this ASAP.   First I'll look at all the QEMU_MONITOR_* log
&gt;&gt; entries that contain "error" that I *am* getting with qemu installed
&gt;&gt; from source (in /usr/local/bin/qemu-*)
&gt;&gt;
&gt;&gt; 2017-06-05 23:06:39.884+0000: 15559: info :
&gt;&gt; virEventPollDispatchHandles:506 : EVENT_POLL_DISPATCH_HANDLE: watch=11
&gt;&gt; events=1
&gt;&gt; 2017-06-05 23:06:39.884+0000: 15559: info : virObjectRef:296 :
&gt;&gt; OBJECT_REF: obj=0x7f0a603d33b0
&gt;&gt; 2017-06-05 23:06:39.884+0000: 15559: info : qemuMonitorIOProcess:429 :
&gt;&gt; QEMU_MONITOR_IO_PROCESS: mon=0x7f0a603d33b0 buf={"id": "libvirt-41",
&gt;&gt; "error": {"class": "GenericError", "desc": "this feature or command is
&gt;&gt; not currently supported"}}^M
&gt;&gt;  len=120
&gt;
&gt; Well, at least QEMU_MONITOR_ messages are showing, finally.  The non-x86
&gt; machines might be missing lot of commands that libvirt needs. Like
&gt; 'query-commands' which we need to know which commands we can run (bit of
&gt; a catch 22 right there).  But these should not happen with x86, x86_64,
&gt; arm, arm64 (or aarch64), and few others.  Those are being maintained
&gt; continuously.

The messages only show when qemu is "sudo make install" from sources.

In case it matters, all my existing VM's are x86_64.

&gt;&gt; 2017-06-05 23:06:39.884+0000: 15559: debug :
&gt;&gt; qemuMonitorJSONIOProcessLine:191 : Line [{"id": "libvirt-41", "error":
&gt;&gt; {"class": "GenericError", "desc": "this feature or command is not
&gt;&gt; currently supported"}}]
&gt;&gt; 2017-06-05 23:06:39.884+0000: 15559: debug : virJSONValueFromString:1604
&gt;&gt; : string={"id": "libvirt-41", "error": {"class": "GenericError", "desc":
&gt;&gt; "this feature or command is not currently supported"}}
&gt;&gt; 2017-06-05 23:06:39.884+0000: 15559: debug :
&gt;&gt; virJSONParserHandleStartMap:1478 : parser=0x7ffe4440afd0
&gt;&gt;
&gt;&gt;
&gt;&gt;&gt; Have a nice day,
&gt;&gt;&gt; Martin
&gt;&gt;&gt;
&gt;&gt; Thank you, you too!
&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; libvirt-users mailing list
&gt;&gt; libvirt-users@redhat.com
&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users


</body></email><email><emailId>20170606140831</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-06-06 14:08:31-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd not accepting connections</subject><body>


On Tue, Jun 06, 2017 at 08:17:07AM -0400, Michael C. Cambria wrote:
&gt;
&gt;
&gt;On 06/06/2017 04:43 AM, Martin Kletzander wrote:
&gt;&gt; On Mon, Jun 05, 2017 at 07:52:58PM -0400, Michael C Cambria wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On 06/05/2017 10:46 AM, Martin Kletzander wrote:
&gt;&gt;&gt;&gt; On Sun, Jun 04, 2017 at 06:42:39PM -0400, Michael C Cambria wrote:
&gt;&gt;&gt;&gt;&gt; I've upgraded from Fedora 20; probably missed a merge of rpmnew with
&gt;&gt;&gt;&gt;&gt; existing .conf; permission problem, some other mistake along the
&gt;&gt;&gt;&gt;&gt; way to
&gt;&gt;&gt;&gt;&gt; Fedora 25.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Yeah, probably some 'rpm -qV' (or whatever the command to verify all
&gt;&gt;&gt;&gt; packages is) could help as well.
&gt;&gt;&gt;
&gt;&gt;&gt; "rpm -aV" didn't turn up anything obvious:
&gt;&gt;&gt;
&gt;&gt;&gt; S.5....T.  c /etc/libvirt/libvirtd.conf was modified for logging:
&gt;&gt;&gt; # diff libvirtd.conf libvirtd.conf.rpmnew
&gt;&gt;&gt; 1,4d0
&gt;&gt;&gt; &lt; log_level = 1
&gt;&gt;&gt; &lt; log_filters="1:remote 1:event 1:json 1:rpc 1:qemu"
&gt;&gt;&gt; &lt; log_outputs="1:file:/var/log/libvirt/libvirtd.log"
&gt;&gt;&gt; &lt; #
&gt;&gt;&gt; #
&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Is there a "how to" similar to [1] that lets one qemu to log that
&gt;&gt;&gt;&gt;&gt; it was
&gt;&gt;&gt;&gt;&gt; invoked and how far it got?
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I removed qemu (dnf remote qemu; sudo dnf remove qemu-common)
&gt;&gt;&gt;&gt;&gt; build qemu 2.2-maint (assuming this relates to 2:2.7.1-6.fc25) from
&gt;&gt;&gt;&gt;&gt; github sources
&gt;&gt;&gt;&gt;&gt; installed qemu from sources (into /usr/local/bin)
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Things are a bit better.  Where something like "sudo virsh pool-list"
&gt;&gt;&gt;&gt;&gt; would just hang before, now my storage pools actually are listed.  No
&gt;&gt;&gt;&gt;&gt; luck listing my VM's, but "virsh list" and "virsh list --all" do not
&gt;&gt;&gt;&gt;&gt; hang like before:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; # virsh list
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Are you sure you didn't miss the --all?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt; Yes I'm sure.  I wish that was all it was &lt;g&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;  Id    Name State
&gt;&gt;&gt;&gt;&gt; ----------------------------------------------------
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; # virsh pool-list
&gt;&gt;&gt;&gt;&gt;  Name                 State      Autostart
&gt;&gt;&gt;&gt;&gt; -------------------------------------------
&gt;&gt;&gt;&gt;&gt;  default              active     yes
&gt;&gt;&gt;&gt;&gt;  Downloads            active     yes
&gt;&gt;&gt;&gt;&gt;  guest_images_lvm     active     yes
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; #
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; VM xml is /etc/libvirt/qemu.  The network, virbr0 is in
&gt;&gt;&gt;&gt;&gt; /etc/libvirt/qemu/networks, and that gets created just fine. All have
&gt;&gt;&gt;&gt;&gt; root:root owner:group:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; The VMs are not visible because the XML cannot be parsed if the
&gt;&gt;&gt;&gt; binaries
&gt;&gt;&gt;&gt; are not on the system (the XML contains the whole path). Also, I think
&gt;&gt;&gt;&gt; this works because libvirt doesn't look into /usr/local/bin, but I
&gt;&gt;&gt;&gt; might
&gt;&gt;&gt;&gt; be wrong.  Check whether 'virsh capabilities' tells you something about
&gt;&gt;&gt;&gt; any emulator.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; You can try installing from source, but putting it in /usr/bin,
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; I put qemu-system-x86_64 and qemu-x86_64 in /usr/bin as requested. No
&gt;&gt;&gt; luck.  It seems /usr/local/bin/qemu-xxx is found (see CGroup: output)
&gt;&gt;&gt;
&gt;&gt;&gt; $ sudo systemctl status libvirtd.service
&gt;&gt;&gt; ● libvirtd.service - Virtualization daemon
&gt;&gt;&gt;    Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled;
&gt;&gt;&gt; vendor preset: enabled)
&gt;&gt;&gt;    Active: active (running) since Mon 2017-06-05 18:21:20 EDT; 3s ago
&gt;&gt;&gt;      Docs: man:libvirtd(8)
&gt;&gt;&gt;            http://libvirt.org
&gt;&gt;&gt;  Main PID: 7076 (libvirtd)
&gt;&gt;&gt;     Tasks: 19 (limit: 4915)
&gt;&gt;&gt;    Memory: 124.7M
&gt;&gt;&gt;       CPU: 3.649s
&gt;&gt;&gt;    CGroup: /system.slice/libvirtd.service
&gt;&gt;&gt;            ├─7076 /usr/sbin/libvirtd
&gt;&gt;&gt;            └─7208 /usr/local/bin/qemu-system-sh4eb -S -no-user-config
&gt;&gt;&gt; -nodefaults -nographic -M none -qmp
&gt;&gt;&gt; unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait
&gt;&gt;&gt; -pidfile /var/lib/libvirt/qemu/capabi
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; So this is now only with the qemu from source installed on the system?
&gt;
&gt;Correct.
&gt;&gt;
&gt;&gt;&gt; $ sudo virsh list --all
&gt;&gt;&gt;  Id    Name                           State
&gt;&gt;&gt; ----------------------------------------------------
&gt;&gt;&gt;
&gt;&gt;&gt; $ sudo virsh pool-list
&gt;&gt;&gt;  Name                 State      Autostart
&gt;&gt;&gt; -------------------------------------------
&gt;&gt;&gt;  default              active     yes
&gt;&gt;&gt;  Downloads            active     yes
&gt;&gt;&gt;  guest_images_lvm     active     yes
&gt;&gt;&gt;
&gt;&gt;&gt; $
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; you can
&gt;&gt;&gt;&gt; also remove that installation, put back the one from the package and
&gt;&gt;&gt;&gt; try
&gt;&gt;&gt;&gt; running:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;  { for i in qmp_capabilities query-commands quit; do echo
&gt;&gt;&gt;&gt;  "{'execute':'$i'}"; done } | qemu-system-x86_64 -nographic -nodefaults
&gt;&gt;&gt;&gt;  -no-user-config -M none -qmp stdio
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; And see whether the QEMU process quits, what it outputs and if it gets
&gt;&gt;&gt;&gt; stuck, you can attach gdb and see what it's waiting for.  Or maybe try
&gt;&gt;&gt;&gt; running it with strace.
&gt;&gt;&gt;
&gt;&gt;&gt; This completed almost instantly.
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; And that is with the QEMU installed form the package, right?
&gt;
&gt;Correct
&gt;
&gt;&gt;
&gt;&gt;&gt;&gt; You can also do a thing I used to do a lot.  You can rename
&gt;&gt;&gt;&gt; /usr/bin/qemu-system-x86_64 (for example) and create a script with that
&gt;&gt;&gt;&gt; filename that for example execs as qemu in strace with the output of
&gt;&gt;&gt;&gt; strace put in some file, or similar.  I can't think of anything else
&gt;&gt;&gt;&gt; for
&gt;&gt;&gt;&gt; now, sorry.
&gt;&gt;&gt;
&gt;&gt;&gt; I'll try this ASAP.   First I'll look at all the QEMU_MONITOR_* log
&gt;&gt;&gt; entries that contain "error" that I *am* getting with qemu installed
&gt;&gt;&gt; from source (in /usr/local/bin/qemu-*)
&gt;&gt;&gt;
&gt;&gt;&gt; 2017-06-05 23:06:39.884+0000: 15559: info :
&gt;&gt;&gt; virEventPollDispatchHandles:506 : EVENT_POLL_DISPATCH_HANDLE: watch=11
&gt;&gt;&gt; events=1
&gt;&gt;&gt; 2017-06-05 23:06:39.884+0000: 15559: info : virObjectRef:296 :
&gt;&gt;&gt; OBJECT_REF: obj=0x7f0a603d33b0
&gt;&gt;&gt; 2017-06-05 23:06:39.884+0000: 15559: info : qemuMonitorIOProcess:429 :
&gt;&gt;&gt; QEMU_MONITOR_IO_PROCESS: mon=0x7f0a603d33b0 buf={"id": "libvirt-41",
&gt;&gt;&gt; "error": {"class": "GenericError", "desc": "this feature or command is
&gt;&gt;&gt; not currently supported"}}^M
&gt;&gt;&gt;  len=120
&gt;&gt;
&gt;&gt; Well, at least QEMU_MONITOR_ messages are showing, finally.  The non-x86
&gt;&gt; machines might be missing lot of commands that libvirt needs. Like
&gt;&gt; 'query-commands' which we need to know which commands we can run (bit of
&gt;&gt; a catch 22 right there).  But these should not happen with x86, x86_64,
&gt;&gt; arm, arm64 (or aarch64), and few others.  Those are being maintained
&gt;&gt; continuously.
&gt;
&gt;The messages only show when qemu is "sudo make install" from sources.
&gt;

And what are they related to?  Can you post the full log somewhere and
send a link to it?  I'll see if there's something usable.

&gt;In case it matters, all my existing VM's are x86_64.
&gt;
&gt;&gt;&gt; 2017-06-05 23:06:39.884+0000: 15559: debug :
&gt;&gt;&gt; qemuMonitorJSONIOProcessLine:191 : Line [{"id": "libvirt-41", "error":
&gt;&gt;&gt; {"class": "GenericError", "desc": "this feature or command is not
&gt;&gt;&gt; currently supported"}}]
&gt;&gt;&gt; 2017-06-05 23:06:39.884+0000: 15559: debug : virJSONValueFromString:1604
&gt;&gt;&gt; : string={"id": "libvirt-41", "error": {"class": "GenericError", "desc":
&gt;&gt;&gt; "this feature or command is not currently supported"}}
&gt;&gt;&gt; 2017-06-05 23:06:39.884+0000: 15559: debug :
&gt;&gt;&gt; virJSONParserHandleStartMap:1478 : parser=0x7ffe4440afd0
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Have a nice day,
&gt;&gt;&gt;&gt; Martin
&gt;&gt;&gt;&gt;
&gt;&gt;&gt; Thank you, you too!
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt; libvirt-users mailing list
&gt;&gt;&gt; libvirt-users@redhat.com
&gt;&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170606141932</emailId><senderName>"Michael C. Cambria"</senderName><senderEmail>mcc@fid4.com</senderEmail><timestampReceived>2017-06-06 14:19:32-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd not accepting connections</subject><body>



On 06/06/2017 08:17 AM, Michael C. Cambria wrote:
&gt;
&gt;
&gt; On 06/06/2017 04:43 AM, Martin Kletzander wrote:
&gt;&gt; On Mon, Jun 05, 2017 at 07:52:58PM -0400, Michael C Cambria wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On 06/05/2017 10:46 AM, Martin Kletzander wrote:
&gt;&gt;&gt;&gt; On Sun, Jun 04, 2017 at 06:42:39PM -0400, Michael C Cambria wrote:
&gt;&gt;&gt;&gt;&gt; I've upgraded from Fedora 20; probably missed a merge of rpmnew with
&gt;&gt;&gt;&gt;&gt; existing .conf; permission problem, some other mistake along the 
&gt;&gt;&gt;&gt;&gt; way to
&gt;&gt;&gt;&gt;&gt; Fedora 25.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Yeah, probably some 'rpm -qV' (or whatever the command to verify all
&gt;&gt;&gt;&gt; packages is) could help as well.
&gt;&gt;&gt;
&gt;&gt;&gt; "rpm -aV" didn't turn up anything obvious:
&gt;&gt;&gt;
&gt;&gt;&gt; S.5....T.  c /etc/libvirt/libvirtd.conf was modified for logging:
&gt;&gt;&gt; # diff libvirtd.conf libvirtd.conf.rpmnew
&gt;&gt;&gt; 1,4d0
&gt;&gt;&gt; &lt; log_level = 1
&gt;&gt;&gt; &lt; log_filters="1:remote 1:event 1:json 1:rpc 1:qemu"
&gt;&gt;&gt; &lt; log_outputs="1:file:/var/log/libvirt/libvirtd.log"
&gt;&gt;&gt; &lt; #
&gt;&gt;&gt; #
&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Is there a "how to" similar to [1] that lets one qemu to log that 
&gt;&gt;&gt;&gt;&gt; it was
&gt;&gt;&gt;&gt;&gt; invoked and how far it got?
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I removed qemu (dnf remote qemu; sudo dnf remove qemu-common)
&gt;&gt;&gt;&gt;&gt; build qemu 2.2-maint (assuming this relates to 2:2.7.1-6.fc25) from
&gt;&gt;&gt;&gt;&gt; github sources
&gt;&gt;&gt;&gt;&gt; installed qemu from sources (into /usr/local/bin)
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Things are a bit better.  Where something like "sudo virsh pool-list"
&gt;&gt;&gt;&gt;&gt; would just hang before, now my storage pools actually are listed.  No
&gt;&gt;&gt;&gt;&gt; luck listing my VM's, but "virsh list" and "virsh list --all" do not
&gt;&gt;&gt;&gt;&gt; hang like before:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; # virsh list
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Are you sure you didn't miss the --all?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt; Yes I'm sure.  I wish that was all it was &lt;g&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;  Id    Name State
&gt;&gt;&gt;&gt;&gt; ----------------------------------------------------
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; # virsh pool-list
&gt;&gt;&gt;&gt;&gt;  Name                 State      Autostart
&gt;&gt;&gt;&gt;&gt; -------------------------------------------
&gt;&gt;&gt;&gt;&gt;  default              active     yes
&gt;&gt;&gt;&gt;&gt;  Downloads            active     yes
&gt;&gt;&gt;&gt;&gt;  guest_images_lvm     active     yes
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; #
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; VM xml is /etc/libvirt/qemu.  The network, virbr0 is in
&gt;&gt;&gt;&gt;&gt; /etc/libvirt/qemu/networks, and that gets created just fine. All have
&gt;&gt;&gt;&gt;&gt; root:root owner:group:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; The VMs are not visible because the XML cannot be parsed if the 
&gt;&gt;&gt;&gt; binaries
&gt;&gt;&gt;&gt; are not on the system (the XML contains the whole path). Also, I think
&gt;&gt;&gt;&gt; this works because libvirt doesn't look into /usr/local/bin, but I 
&gt;&gt;&gt;&gt; might
&gt;&gt;&gt;&gt; be wrong.  Check whether 'virsh capabilities' tells you something 
&gt;&gt;&gt;&gt; about
&gt;&gt;&gt;&gt; any emulator.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; You can try installing from source, but putting it in /usr/bin,
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; I put qemu-system-x86_64 and qemu-x86_64 in /usr/bin as requested. No
&gt;&gt;&gt; luck.  It seems /usr/local/bin/qemu-xxx is found (see CGroup: output)
&gt;&gt;&gt;
&gt;&gt;&gt; $ sudo systemctl status libvirtd.service
&gt;&gt;&gt; ● libvirtd.service - Virtualization daemon
&gt;&gt;&gt;    Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled;
&gt;&gt;&gt; vendor preset: enabled)
&gt;&gt;&gt;    Active: active (running) since Mon 2017-06-05 18:21:20 EDT; 3s ago
&gt;&gt;&gt;      Docs: man:libvirtd(8)
&gt;&gt;&gt;            http://libvirt.org
&gt;&gt;&gt;  Main PID: 7076 (libvirtd)
&gt;&gt;&gt;     Tasks: 19 (limit: 4915)
&gt;&gt;&gt;    Memory: 124.7M
&gt;&gt;&gt;       CPU: 3.649s
&gt;&gt;&gt;    CGroup: /system.slice/libvirtd.service
&gt;&gt;&gt;            ├─7076 /usr/sbin/libvirtd
&gt;&gt;&gt;            └─7208 /usr/local/bin/qemu-system-sh4eb -S -no-user-config
&gt;&gt;&gt; -nodefaults -nographic -M none -qmp
&gt;&gt;&gt; unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait
&gt;&gt;&gt; -pidfile /var/lib/libvirt/qemu/capabi
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; So this is now only with the qemu from source installed on the system?
&gt;
&gt; Correct.

Using qemu installed from source, I decided to try to create a VM.  It 
worked.  I cut/pasted a script I used to create a centos72 VM, renamed 
the name and cut the disk size down:

$ cat debug-centos.sh
#/bin/bash

sudo virt-install -n dbgcent72 \
     --ram=4096 \
     --vcpus 2 \
     --disk path=/dev/vg_guest_images/dbgcent72,device=disk,size=5 \
     --description "Centos 7.2 64Bit" \
     --network bridge:brguest0,model=e1000 \
     --cdrom /home/mcc/Downloads/CentOS-7-x86_64-DVD-1511.iso \
     --vnc \
     --noautoconsole \
     --hvm \
     --os-type=linux \
     --os-variant centos7.0 \
     --video=vmvga


$ ./debug-centos.sh

Starting install...
Domain installation still in progress. You can reconnect to
the console to complete the installation process.

$ sudo virsh list --all
  Id    Name                           State
----------------------------------------------------
  1     dbgcent72                      running

The xml is placed next to the xml for all the other VM's that don't seem 
to be found:

# pwd
/etc/libvirt/qemu
# ls -al
total 80
drwx------. 3 root root 4096 Jun  6 09:36 .
drwx------. 5 root root 4096 Jun  6 08:38 ..
-rw-------. 1 root root 3870 Jun  6 09:36 dbgcent72.xml
-rw-------. 1 root root 3853 Jun 14  2016 dcos-bp.xml
-rw-------. 1 root root 3551 Mar 21  2015 fbsd100.xml
-rw-------. 1 root root 3273 Mar 23  2015 fbsd101.xml
-rw-------. 1 root root 3867 Feb 21  2015 fedora20.xml
drwx------. 3 root root 4096 May 10 18:08 networks
-rw-------. 1 root root 3510 Oct 11  2015 u1404s.xml
-rw-------. 1 root root 5017 Oct 11  2015 u1404.xml
-rw-------. 1 root root 3507 Jun  5 19:33 wheezy.xml
-rw-------. 1 root root 3489 Feb 21  2015 win7.xml
# lvs
   LV          VG              Attr       LSize   Pool Origin Data%  
Meta%  Move Log Cpy%Sync Convert
[deleted]
   dbgcent72   vg_guest_images -wi-ao---- 5.00g
   dcos-bp     vg_guest_images -wi-a----- 50.00g
   fbsd100     vg_guest_images -wi-a----- 20.00g
   fbsd101     vg_guest_images -wi-a----- 20.00g
   fedora20    vg_guest_images -wi-a----- 50.00g
   u1404s.qcow vg_guest_images -wi-a----- 40.00g
   wheezy      vg_guest_images -wi-a----- 20.00g
   win7        vg_guest_images -wi-a----- 70.00g
# ls -al /var/lib/libvirt/images
total 12494552
drwx--x--x.  2 root root        4096 May 10 18:08 .
drwxr-xr-x. 12 root root        4096 May 10 18:08 ..
-rw-------.  1 root root 22552248320 May 29  2016 u1404.qcow2
#




</body></email><email><emailId>20170605154033</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-06-05 15:40:33-0400</timestampReceived><subject>Re: [libvirt-users] why increasing vCPUs increasing the CPU sockets for QEMU+KVM</subject><body>

On Mon, Jun 05, 2017 at 08:40:19PM +0530, girish kumar wrote:
&gt; Hi All,
&gt; 
&gt; I am new here, please warn me If I am not following proper etiquette of
&gt; this mailing list.
&gt; 
&gt; I am breaking my head, regarding why libvirt is defining multiple CPU
&gt; sockets when I increase the vCPU count. As and when I increase the vCPU
&gt; count in libvirt guest XML, it is increasing the CPU sockets in qemu
&gt; instance.
&gt; 
&gt; " -smp 4,sockets=4,cores=1,threads=1 " instead " -smp
&gt; 4,sockets=1,cores=4,threads=1"
&gt; 
&gt; Does not this lower the performance of the guest as the host and guest
&gt; architectures gets different in that case.
&gt; 
&gt; Also please suggest a guest configuration which will take advantage of the
&gt; host CPU architecture.

In normal usage, the guest vCPUs will be floating arbitrarily across any
host physical CPUs.  So trying to match host / guest topology is not only
useless, it might actually degrade your performance - eg if you give the
guest 1 socket, 1 core and 2 threads, but he vCPUs get scheduled on different
thost sockets, the guest OS will make very bad decisions.

By defaulting to giving the guest only sockets, you get fixed predictable
behaviour from the guest OS, as the host OS moves vCPUs threads around.

If you are willing, however, to assign dedicated host CPUs to each guest
CPU, then you can try to match the host + guest topology. That will improve
performance, since the guest CPUs will be fixed to specific host CPUs. THis
isn't suitable as a default config though, hence libvirt/QEMU's default
behaviour of using sockets for all vCPUs.

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170605193925</emailId><senderName>girish kumar</senderName><senderEmail>girishbangaram@gmail.com</senderEmail><timestampReceived>2017-06-05 19:39:25-0400</timestampReceived><subject>Re: [libvirt-users] why increasing vCPUs increasing the CPU sockets for QEMU+KVM</subject><body>

Hi Daniel,

Thanks a lot for the quick and detailed explanation. Please see my another
query below.

&gt;&gt;In normal usage, the guest vCPUs will be floating arbitrarily across any
&gt;&gt;host physical CPUs.  So trying to match host / guest topology is not only
&gt;&gt;useless, it might actually degrade your performance - eg if you give the
&gt;&gt;guest 1 socket, 1 core and 2 threads, but he vCPUs get scheduled on
different
&gt;&gt;thost sockets, the guest OS will make very bad decisions.

The above is true, only if the the host have multiple sockets. As long as
the host has single socket, there will not be any performance degradation
right?

&gt;&gt;If you are willing, however, to assign dedicated host CPUs to each guest
&gt;&gt;CPU, then you can try to match the host + guest topology. That will
improve
&gt;&gt;performance, since the guest CPUs will be fixed to specific host CPUs.
THis
&gt;&gt;isn't suitable as a default config though, hence libvirt/QEMU's default
&gt;&gt;behaviour of using sockets for all vCPUs.
Will try the advanced configuration to match the guest to host. I am kind
of looking for a configuration which launches qemu with "-cpu host" option.

On 5 June 2017 at 21:10, Daniel P. Berrange &lt;berrange@redhat.com&gt; wrote:

&gt; On Mon, Jun 05, 2017 at 08:40:19PM +0530, girish kumar wrote:
&gt; &gt; Hi All,
&gt; &gt;
&gt; &gt; I am new here, please warn me If I am not following proper etiquette of
&gt; &gt; this mailing list.
&gt; &gt;
&gt; &gt; I am breaking my head, regarding why libvirt is defining multiple CPU
&gt; &gt; sockets when I increase the vCPU count. As and when I increase the vCPU
&gt; &gt; count in libvirt guest XML, it is increasing the CPU sockets in qemu
&gt; &gt; instance.
&gt; &gt;
&gt; &gt; " -smp 4,sockets=4,cores=1,threads=1 " instead " -smp
&gt; &gt; 4,sockets=1,cores=4,threads=1"
&gt; &gt;
&gt; &gt; Does not this lower the performance of the guest as the host and guest
&gt; &gt; architectures gets different in that case.
&gt; &gt;
&gt; &gt; Also please suggest a guest configuration which will take advantage of
&gt; the
&gt; &gt; host CPU architecture.
&gt;
&gt; In normal usage, the guest vCPUs will be floating arbitrarily across any
&gt; host physical CPUs.  So trying to match host / guest topology is not only
&gt; useless, it might actually degrade your performance - eg if you give the
&gt; guest 1 socket, 1 core and 2 threads, but he vCPUs get scheduled on
&gt; different
&gt; thost sockets, the guest OS will make very bad decisions.
&gt;
&gt; By defaulting to giving the guest only sockets, you get fixed predictable
&gt; behaviour from the guest OS, as the host OS moves vCPUs threads around.
&gt;
&gt; If you are willing, however, to assign dedicated host CPUs to each guest
&gt; CPU, then you can try to match the host + guest topology. That will improve
&gt; performance, since the guest CPUs will be fixed to specific host CPUs. THis
&gt; isn't suitable as a default config though, hence libvirt/QEMU's default
&gt; behaviour of using sockets for all vCPUs.
&gt;
&gt; Regards,
&gt; Daniel
&gt; --
&gt; |: https://berrange.com      -o-    https://www.flickr.com/photos/
&gt; dberrange :|
&gt; |: https://libvirt.org         -o-
&gt; https://fstop138.berrange.com :|
&gt; |: https://entangle-photo.org    -o-    https://www.instagram.com/
&gt; dberrange :|
&gt;



-- 
Regards,
Girish

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi Daniel,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks a lot for the quick and detailed \
explanation. Please see my another query \
below.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&gt;&gt;In normal usage, the guest vCPUs \
will be floating arbitrarily across any&lt;/div&gt;&lt;div&gt;&gt;&gt;host physical CPUs.   So \
trying to match host / guest topology is not only&lt;/div&gt;&lt;div&gt;&gt;&gt;useless, it might \
actually degrade your performance - eg if you give the&lt;/div&gt;&lt;div&gt;&gt;&gt;guest 1 \
socket, 1 core and 2 threads, but he vCPUs get scheduled on \
different&lt;/div&gt;&lt;div&gt;&gt;&gt;thost sockets, the guest OS will make very bad \
decisions.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The above is true, only if the the host have \
multiple sockets. As long as the host has single socket, there will not be any \
performance degradation right?&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&gt;&gt;If you are \
willing, however, to assign dedicated host CPUs to each guest&lt;/div&gt;&lt;div&gt;&gt;&gt;CPU, \
then you can try to match the host + guest topology. That will \
improve&lt;/div&gt;&lt;div&gt;&gt;&gt;performance, since the guest CPUs will be fixed to specific \
host CPUs. THis&lt;/div&gt;&lt;div&gt;&gt;&gt;isn't suitable as a default config though, \
hence libvirt/QEMU's default&lt;/div&gt;&lt;div&gt;&gt;&gt;behaviour of using sockets for all \
vCPUs.&lt;/div&gt;&lt;/div&gt;&lt;div&gt;Will try the advanced configuration to match the guest to \
host. I am kind of looking for a configuration which launches qemu with "-cpu \
host" option.&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;On 5 June 2017 at 21:10, Daniel P. Berrange &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:berrange@redhat.com" \
target="_blank"&gt;berrange@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span class=""&gt;On Mon, Jun 05, 2017 at 08:40:19PM +0530, \
girish kumar wrote:&lt;br&gt; &gt; Hi All,&lt;br&gt;
&gt;&lt;br&gt;
&gt; I am new here, please warn me If I am not following proper etiquette of&lt;br&gt;
&gt; this mailing list.&lt;br&gt;
&gt;&lt;br&gt;
&gt; I am breaking my head, regarding why libvirt is defining multiple CPU&lt;br&gt;
&gt; sockets when I increase the vCPU count. As and when I increase the vCPU&lt;br&gt;
&gt; count in libvirt guest XML, it is increasing the CPU sockets in qemu&lt;br&gt;
&gt; instance.&lt;br&gt;
&gt;&lt;br&gt;
&gt; " -smp 4,sockets=4,cores=1,threads=1 " instead " -smp&lt;br&gt;
&gt; 4,sockets=1,cores=4,threads=1"&lt;br&gt;
&gt;&lt;br&gt;
&gt; Does not this lower the performance of the guest as the host and guest&lt;br&gt;
&gt; architectures gets different in that case.&lt;br&gt;
&gt;&lt;br&gt;
&gt; Also please suggest a guest configuration which will take advantage of the&lt;br&gt;
&gt; host CPU architecture.&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;In normal usage, the guest vCPUs will be floating arbitrarily across any&lt;br&gt;
host physical CPUs.   So trying to match host / guest topology is not only&lt;br&gt;
useless, it might actually degrade your performance - eg if you give the&lt;br&gt;
guest 1 socket, 1 core and 2 threads, but he vCPUs get scheduled on different&lt;br&gt;
thost sockets, the guest OS will make very bad decisions.&lt;br&gt;
&lt;br&gt;
By defaulting to giving the guest only sockets, you get fixed predictable&lt;br&gt;
behaviour from the guest OS, as the host OS moves vCPUs threads around.&lt;br&gt;
&lt;br&gt;
If you are willing, however, to assign dedicated host CPUs to each guest&lt;br&gt;
CPU, then you can try to match the host + guest topology. That will improve&lt;br&gt;
performance, since the guest CPUs will be fixed to specific host CPUs. THis&lt;br&gt;
isn't suitable as a default config though, hence libvirt/QEMU's default&lt;br&gt;
behaviour of using sockets for all vCPUs.&lt;br&gt;
&lt;br&gt;
Regards,&lt;br&gt;
Daniel&lt;br&gt;
&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;--&lt;br&gt;
&gt; &gt; &lt;a href="https://berrange.com" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://berrange.com&lt;/a&gt;         -o-      &lt;a \
&gt; &gt; href="https://www.flickr.com/photos/dberrange" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://www.flickr.com/photos/&lt;wbr&gt;dberrange&lt;/a&gt; :|&lt;br&gt;
&gt; &gt; &lt;a href="https://libvirt.org" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://libvirt.org&lt;/a&gt;              -o-                  &lt;a \
&gt; &gt; href="https://fstop138.berrange.com" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://fstop138.berrange.com&lt;/a&gt; :|&lt;br&gt;
&gt; &gt; &lt;a href="https://entangle-photo.org" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://entangle-photo.org&lt;/a&gt;      -o-      &lt;a \
&gt; &gt; href="https://www.instagram.com/dberrange" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://www.instagram.com/&lt;wbr&gt;dberrange&lt;/a&gt; :|&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- &lt;br&gt;&lt;div \
class="gmail_signature" data-smartmail="gmail_signature"&gt;&lt;div \
dir="ltr"&gt;&lt;div&gt;Regards,&lt;br&gt;Girish&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;



</body></email><email><emailId>20170619141120</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-06-19 14:11:20-0400</timestampReceived><subject>Re: [libvirt-users] vendor_id state='off' not working as expected</subject><body>


On Tue, Jun 06, 2017 at 04:34:09PM -0400, Sean Whalen wrote:
&gt;Hi All,
&gt;
&gt;I'm trying to counter VM detection methods for a malware sandbox, using
&gt;Pafish as a benchmark tool.
&gt;
&gt;https://github.com/a0rtega/pafish
&gt;
&gt;I have &lt;hyperv&gt;&lt;vendor_id state='off'/&gt;&lt;/hyperv&gt; defined in a Windows 7
&gt;domain on Ubuntu 17.10, but for some reason this just changes the
&gt;hypervisor vendor to "Microsoft Hv" instead of the default "KVMKVMKVM"
&gt;vendor.
&gt;

&lt;vendor_id state='off'/&gt; is the same as not putting the tag there at
all.  The state refers to the tag, it doesn't change the configuration.
It it were 'on', you would then be able to change it with value="XXX"
where XXX is the value.

&gt;How can I remove the hypervisor vendor completely?

I'm not sure, but you can set

&lt;kvm&gt;&lt;hidden state='on'/&gt;&lt;/kvm&gt;

if that's what you mean.

&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170620074548</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-06-20 07:45:48-0400</timestampReceived><subject>Re: [libvirt-users] VM fails to start on boot-up</subject><body>


On Tue, Jun 20, 2017 at 06:23:39AM +0000, Andy Gibbs wrote:
&gt; Hi,
&gt; 
&gt; 
&gt; I have created a VM with the option inside virt-manager to "start virtual machine \
&gt; on host boot up".  It is the only VM on the host to be configured this way.  \
&gt; However, I am getting this error in the log file when it attempts to start it on \
&gt; boot up: 
&gt; 
&gt; 2017-06-19 07:15:18.491+0000: starting up libvirt version: 2.0.0, package: \
&gt; 10.el7_3.9 (CentOS BuildSystem &lt;http://bugs.centos.org&gt;, 2017-05-25-20:52:28, \
&gt; c1bm.rdu2.centos.org), qemu version: 2.6.0 (qemu-kvm-ev-2.6.0-28.el7_3.9.1), \
&gt; hostname: server.mydomain.lan LC_ALL=C \
&gt; PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin QEMU_AUDIO_DRV=spice \
&gt; /usr/libexec/qemu-kvm -name guest=MyVM,debug-threads=on -S -object \
&gt; secret,id=masterKey0,format=raw,file=/var/lib/libvirt/qemu/domain-1-MyVM/master-key.aes \
&gt; -machine pc-i440fx-rhel7.3.0,accel=kvm,usb=off,vmport=off -cpu Broadwell,+rtm,+hle \
&gt; -m 8192 -realtime mlock=off -smp 4,sockets=4,cores=1,threads=1 -uuid \
&gt; cb6f4d45-091d-47f8-931a-8daf6b0cf2b8 -no-user-config -nodefaults -chardev \
&gt; socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-1-MyVM/monitor.sock,server,nowait \
&gt; -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc,driftfix=slew \
&gt; -global kvm-pit.lost_tick_policy=discard -no-hpet -no-shutdown -global \
&gt; PIIX4_PM.disable_s3=1 -global PIIX4_PM.disable_s4=1 -boot menu=off,strict=on \
&gt; -device ich9-usb-ehci1,id=usb,bus=pci.0,addr=0x6.0x7 -device \
&gt; ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x6 \
&gt; -device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x6.0x1 -device \
&gt; ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x6.0x2 -device \
&gt; virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x5 -drive \
&gt; file=/var/lib/libvirt/images/MyVM.qcow2,format=qcow2,if=none,id=drive-virtio-disk0 \
&gt; -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x7,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 \
&gt; -netdev tap,fd=28,id=hostnet0,vhost=on,vhostfd=30 -device \
&gt; virtio-net-pci,netdev=hostnet0,id=net0,mac=52:54:00:0e:2e:75,bus=pci.0,addr=0x3 \
&gt; -chardev pty,id=charserial0 -device isa-serial,chardev=charserial0,id=serial0 \
&gt; -chardev socket,id=charchannel0,path=/var/lib/libvirt/qemu/channel/target/domain-1-MyVM/org.qemu.guest_agent.0,server,nowait \
&gt; -device virtserialport,bus=virtio-serial0.0,nr=1,chardev=charchannel0,id=channel0,name=org.qemu.guest_agent.0 \
&gt; -chardev spicevmc,id=charchannel1,name=vdagent -device \
&gt; virtserialport,bus=virtio-serial0.0,nr=2,chardev=charchannel1,id=channel1,name=com.redhat.spice.0 \
&gt; -device usb-tablet,id=input0,bus=usb.0,port=1 -spice \
&gt; port=5900,tls-port=5901,addr=127.0.0.1,disable-ticketing,x509-dir=/etc/pki/vdsm/libvirt-spice,seamless-migration=on \
&gt; -device qxl-vga,id=video0,ram_size=67108864,vram_size=67108864,vram64_size_mb=0,vgamem_mb=16,bus=pci.0,addr=0x2 \
&gt; -device intel-hda,id=sound0,bus=pci.0,addr=0x4 -device \
&gt; hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -chardev \
&gt; spicevmc,id=charredir0,name=usbredir -device \
&gt; usb-redir,chardev=charredir0,id=redir0,bus=usb.0,port=2 -chardev \
&gt; spicevmc,id=charredir1,name=usbredir -device \
&gt; usb-redir,chardev=charredir1,id=redir1,bus=usb.0,port=3 -device \
&gt; virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x8 -msg timestamp=on char device \
&gt; redirected to /dev/pts/0 (label charserial0) ((null):3344): Spice-ERROR **: \
&gt; reds.c:4043:do_spice_init: statistics shm_open failed, Permission denied 2017-06-19 \
&gt; 07:15:18.824+0000: shutting down 
&gt; However, when I start the VM manually through virt-manager, it starts up fine.
&gt; 
&gt; 
&gt; Now, if I remove all the spice-related "hardware", e.g. spice display, qxl video, \
&gt; spice channel and usb redirectors, and reboot the host PC, then I get the \
&gt; following: 
&gt; 
&gt; 2017-06-19 08:14:07.358+0000: starting up libvirt version: 2.0.0, (...)
&gt; LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin (...)
&gt; char device redirected to /dev/pts/1 (label charserial0)
&gt; 2017-06-19T08:14:33.453300Z qemu-kvm: terminating on signal 15 from pid 2072
&gt; 2017-06-19 08:14:33.670+0000: shutting down
&gt; 
&gt; So even this doesn't work -- if it doesn't fail to start, then something kills it \
&gt; anyway!! 
&gt; 
&gt; Does anyone have any ideas why might it fail during boot-up?  And is there anything \
&gt; I can do to solve the problem, or further diagnose it? 

Chack the debug logs from the daemon:

http://wiki.libvirt.org/page/DebugLogs

&gt; 
&gt; Many thanks,
&gt; 
&gt; 
&gt; Andy
&gt; 

&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170621015049</emailId><senderName>"Travis S. Johnson"</senderName><senderEmail>johnsontravis21@gmail.com</senderEmail><timestampReceived>2017-06-21 01:50:49-0400</timestampReceived><subject>Re: [libvirt-users] guest A from virbr0 can talk to guest B in virbr1 but not vice versa</subject><body>

Yep!
&gt; That's actually a known bug that has been there "forever". It has always
&gt; been brought up in the context of "I want communication between my NATed
&gt; networks, and it only works in one direction!", rather than "I want to
&gt; block communication between my NATed networks, but it gets past in one
&gt; direction!". When people learn that it's (kind of) blocked, they work
&gt; around it by adding a new network that is shared by all the guests.
&gt; Because all of the reports have been in this direction, fixing it
&gt; properly has been very low on (my) priority list.



Thanks for confirming the bug as I suspected, Laine! I knew it was too good
to be true that I'd be the first to discover this. Thanks for your huge
help, Martin.

I tried searching for this age-old you may be speaking of and I was only
able to find this:
https://bugzilla.redhat.com/show_bug.cgi?id=533193

Also found another somewhat-related bug affecting iptables (port-forwarding
to VM):
https://bugzilla.redhat.com/show_bug.cgi?id=1079088


If it's not too much trouble, can you provide me the ID number so I can
track it?


Aside from the extra packet processing overhead caused by the high
&gt; number of rules needed (which may be completely insignificant), and the
&gt; necessity to add/remove rules at specific labels rather than just
&gt; inserting them all at the beginning, there is the issue that currently
&gt; each iptables rule added for a libvirt network is dependent only on that
&gt; network, so it's simple to determine which rules to remove when a
&gt; network is destroyed. If we start adding rules that are dependent on two
&gt; networks, then proper cleanup will be more complicated.


&gt; None of that should prevent a properly motivated person from writing the
&gt; code to do it, of course!



At least now I know this is quite feasible to fix. Thank you both for the
well-elaborated responses.


Cheers,

-Travis



On Tue, Jun 20, 2017 at 12:46 PM, Laine Stump &lt;laine@laine.org&gt; wrote:

&gt; On 06/20/2017 05:27 AM, Martin Kletzander wrote:
&gt; &gt; On Tue, Jun 20, 2017 at 10:05:19AM +0200, Martin Kletzander wrote:
&gt; &gt;&gt; On Tue, Jun 20, 2017 at 02:26:59AM -0400, Travis S. Johnson wrote:
&gt; &gt;&gt;&gt; Hello,
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; I came across an interesting problem in my home lab a few weeks ago
&gt; &gt;&gt;&gt; as I'm
&gt; &gt;&gt;&gt; prepping for my RHCE exam using Michael Jang study guide. I've been
&gt; &gt;&gt;&gt; at this
&gt; &gt;&gt;&gt; for days now, and I still can't wrap my head around how two or more
&gt; &gt;&gt;&gt; virtual
&gt; &gt;&gt;&gt; networks in default NAT configuration are even allowed to communicate
&gt; &gt;&gt;&gt; with
&gt; &gt;&gt;&gt; each other despite what the libvirt documentation said.
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; Here's the excerpt I'm referring to in the wiki link here:
&gt; &gt;&gt;&gt; http://wiki.libvirt.org/page/Networking#Forwarding_
&gt; Incoming_Connections:
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; By default, guests that are connected via a virtual network with
&gt; &gt;&gt;&gt;&gt; &lt;forward
&gt; &gt;&gt;&gt;&gt; mode='nat'/&gt; can make any outgoing network connection they like.
&gt; &gt;&gt;&gt;&gt; Incoming
&gt; &gt;&gt;&gt;&gt; connections are allowed from the host, and from other guests
&gt; &gt;&gt;&gt;&gt; connected to
&gt; &gt;&gt;&gt;&gt; the same libvirt network, but all other incoming connections are
&gt; &gt;&gt;&gt;&gt; blocked by
&gt; &gt;&gt;&gt;&gt; iptables rules.
&gt; &gt;&gt;&gt;
&gt; &gt;
&gt; &gt; I did not read this properly...
&gt; &gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; Also here's another assertion from 'The virtual network driver'
&gt; &gt;&gt;&gt; section in
&gt; &gt;&gt;&gt; http://libvirt.org/firewall.html:
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; type=nat
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; Allow inbound related to an established connection. Allow outbound,
&gt; but
&gt; &gt;&gt;&gt;&gt; only from our expected subnet. Allow traffic between guests. Deny
&gt; &gt;&gt;&gt;&gt; all other
&gt; &gt;
&gt; &gt; I would expect the 'traffic between guests' to mean only guests on the
&gt; &gt; same network.  Also that lines up with what's written above.
&gt;
&gt; That is correct.
&gt;
&gt; &gt;
&gt; &gt;&gt;&gt;&gt; inbound. Deny all other outbound.
&gt; &gt;&gt;&gt;
&gt; &gt;
&gt; &gt; [...]
&gt; &gt;
&gt; &gt;&gt;
&gt; &gt;&gt; Thanks for reporting this.  It's clearly a bug in libvirt.  The rules
&gt; &gt;&gt; are in this order:
&gt; &gt;&gt;
&gt; &gt;&gt;  all rules for virbr0
&gt; &gt;&gt;  all rules for virbr1
&gt; &gt;&gt;  all rules for virbr2
&gt; &gt;&gt;
&gt; &gt;&gt; But what we should do instead is:
&gt; &gt;&gt;
&gt; &gt;&gt;  input rules for all networks
&gt; &gt;&gt;  local rules for all networks
&gt; &gt;&gt;  output rules for all networks
&gt; &gt;&gt;  reject rules for all networks
&gt;
&gt; That doesn't achieve the desired results (as you figured out later,
&gt; according to your followup comments.
&gt;
&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; The problem is that we do not know how other rules look like.  So what
&gt; &gt;&gt; we might need to do is create chains where rules for the first network
&gt; &gt;&gt; are, then only append network rules into those chains.
&gt; &gt;&gt;
&gt; &gt;&gt; Would you mind filing a bug for this issue, so we can properly track it
&gt; &gt;&gt; and don't forget about it?  I'll have a look at it in the meantime, but
&gt; &gt;&gt; don't promise anything since I'm not that familiar with that part of the
&gt; &gt;&gt; codebase.
&gt; &gt;&gt;
&gt; &gt;
&gt; &gt; Actually, now that I'm thinking about it, the problem is not that we
&gt; &gt; disallow the communication from virbr1 to virbr0, but the problem is
&gt; &gt; that we allow the connection from virbr0 to everywhere.
&gt;
&gt; Yep!
&gt;
&gt; That's actually a known bug that has been there "forever". It has always
&gt; been brought up in the context of "I want communication between my NATed
&gt; networks, and it only works in one direction!", rather than "I want to
&gt; block communication between my NATed networks, but it gets past in one
&gt; direction!". When people learn that it's (kind of) blocked, they work
&gt; around it by adding a new network that is shared by all the guests.
&gt; Because all of the reports have been in this direction, fixing it
&gt; properly has been very low on (my) priority list.
&gt;
&gt;
&gt; &gt;
&gt; &gt; Maybe the solution would be: for each network, insert the rules on top
&gt; &gt; of the forward chain and for each started network, explicitly reject
&gt; &gt; that one.  So that after one network starts it would look like this (I'm
&gt; &gt; writing this from memory just to illustrate the idea, not actually
&gt; &gt; looking up how stuff looks):
&gt; &gt;
&gt; &gt;  ACCEPT any virbr0 RELATED,ESTABLISHED
&gt; &gt;  ACCEPT virbr0 virbr0
&gt; &gt;  ACCEPT virbr0 any src:192.168.122.0/24
&gt; &gt;  REJECT any virbr0
&gt; &gt;  REJECT virbr0 any
&gt; &gt;
&gt; &gt; And after second network is started, we'd have:
&gt; &gt;
&gt; &gt;  # This one is new:
&gt; &gt;  REJECT virbr1 virbr0
&gt;
&gt; Yeah, it's (mostly) this rule that makes the solution complicated.
&gt; Essentially you need one of these rules for each pair of virtual
&gt; networks, so if you have 10 networks, you'll need 45 rules, for 11
&gt; you'll need 55 (in general, for "n" networks, you'll need (n * (n-1) /
&gt; 2) extra rules).
&gt;
&gt; Aside from the extra packet processing overhead caused by the high
&gt; number of rules needed (which may be completely insignificant), and the
&gt; necessity to add/remove rules at specific labels rather than just
&gt; inserting them all at the beginning, there is the issue that currently
&gt; each iptables rule added for a libvirt network is dependent only on that
&gt; network, so it's simple to determine which rules to remove when a
&gt; network is destroyed. If we start adding rules that are dependent on two
&gt; networks, then proper cleanup will be more complicated.
&gt;
&gt; None of that should prevent a properly motivated person from writing the
&gt; code to do it, of course!
&gt;
&gt; &gt;  # These ones would be normally at the end, IIRC:
&gt; &gt;  ACCEPT any virbr1 RELATED,ESTABLISHED
&gt; &gt;  ACCEPT virbr1 virbr1
&gt; &gt;  ACCEPT virbr1 any src:192.168.122.0/24
&gt; &gt;  REJECT any virbr1
&gt; &gt;  REJECT virbr1 any
&gt; &gt;  # These are left as they were:
&gt; &gt;  ACCEPT any virbr0 RELATED,ESTABLISHED
&gt; &gt;  ACCEPT virbr0 virbr0
&gt; &gt;  ACCEPT virbr0 any src:192.168.122.0/24
&gt; &gt;  REJECT any virbr0
&gt; &gt;  REJECT virbr0 any
&gt; &gt;
&gt; &gt; Cc'ing Laine so that he can weigh in as he has way more knowledge of
&gt; &gt; this part of the code =)
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;blockquote style="margin:0px 0px 0px \
40px;border:none;padding:0px"&gt;&lt;/blockquote&gt;&lt;blockquote class="gmail_quote" \
style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt;&lt;span \
style="font-size:12.8px"&gt;Yep!&lt;br&gt;&lt;/span&gt;&lt;span style="font-size:12.8px"&gt;That's \
actually a known bug that has been there "forever". It has \
always&lt;br&gt;&lt;/span&gt;&lt;span style="font-size:12.8px"&gt;been brought up in the context of \
"I want communication between my NATed&lt;br&gt;&lt;/span&gt;&lt;span \
style="font-size:12.8px"&gt;networks, and it only works in one direction!", rather \
than "I want to&lt;br&gt;&lt;/span&gt;&lt;span style="font-size:12.8px"&gt;block communication \
between my NATed networks, but it gets past in one&lt;br&gt;&lt;/span&gt;&lt;span \
style="font-size:12.8px"&gt;direction!". When people learn that it's (kind of) \
blocked, they work&lt;br&gt;&lt;/span&gt;&lt;span style="font-size:12.8px"&gt;around it by adding a new \
network that is shared by all the guests.&lt;br&gt;&lt;/span&gt;&lt;span \
style="font-size:12.8px"&gt;Because all of the reports have been in this direction, \
fixing it&lt;br&gt;&lt;/span&gt;&lt;span style="font-size:12.8px"&gt;properly has been very low on (my) \
priority list.&lt;/span&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks for \
confirming the bug as I suspected, Laine! I knew it was too good to be true that \
I'd be the first to discover this. Thanks for your huge help, \
Martin.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I tried searching for this age-old you may be \
speaking of and I was only able to find this:&lt;/div&gt;&lt;div&gt;&lt;a \
href="https://bugzilla.redhat.com/show_bug.cgi?id=533193" \
target="_blank"&gt;https://bugzilla.redhat.com/sh&lt;wbr&gt;ow_bug.cgi?id=533193&lt;/a&gt;     \
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also found another somewhat-related bug affecting iptables \
(port-forwarding to VM):&lt;br&gt;&lt;a \
href="https://bugzilla.redhat.com/show_bug.cgi?id=1079088" \
target="_blank"&gt;https://bugzilla.redhat.com/sh&lt;wbr&gt;ow_bug.cgi?id=1079088&lt;/a&gt;  \
&lt;br&gt;&lt;br&gt;&lt;br&gt;If it's not too much trouble, can you provide me the ID number so I \
can track it?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote class="gmail_quote" \
style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt;&lt;span style="font-size:12.8px"&gt;Aside from the \
extra packet processing overhead caused by the high&lt;br&gt;&lt;/span&gt;&lt;span \
style="font-size:12.8px"&gt;number of rules needed (which may be completely \
insignificant), and the&lt;br&gt;&lt;/span&gt;&lt;span style="font-size:12.8px"&gt;necessity to \
add/remove rules at specific labels rather than just&lt;br&gt;&lt;/span&gt;&lt;span \
style="font-size:12.8px"&gt;inserting them all at the beginning, there is the issue that \
currently&lt;br&gt;&lt;/span&gt;&lt;span style="font-size:12.8px"&gt;each iptables rule added for a \
libvirt network is dependent only on that&lt;br&gt;&lt;/span&gt;&lt;span \
style="font-size:12.8px"&gt;network, so it's simple to determine which rules to \
remove when a&lt;br&gt;&lt;/span&gt;&lt;span style="font-size:12.8px"&gt;network is destroyed. If we \
start adding rules that are dependent on two&lt;br&gt;&lt;/span&gt;&lt;span \
style="font-size:12.8px"&gt;networks, then proper cleanup will be more \
complicated.&lt;/span&gt;&lt;/blockquote&gt;&lt;blockquote class="gmail_quote" style="margin:0px 0px \
0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex"&gt;&lt;br \
style="font-size:12.8px"&gt;&lt;span style="font-size:12.8px"&gt;None of that should prevent a \
properly motivated person from writing the&lt;br&gt;&lt;/span&gt;&lt;span \
style="font-size:12.8px"&gt;code to do it, of \
course!&lt;/span&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;At least now I know \
this is quite feasible to fix. Thank you both for the well-elaborated \
responses.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-Travis&lt;/div&gt;&lt;div&gt; \
&lt;/div&gt;&lt;blockquote style="margin:0px 0px 0px \
40px;border:none;padding:0px"&gt;&lt;/blockquote&gt;&lt;blockquote style="margin:0px 0px 0px \
40px;border:none;padding:0px"&gt;&lt;/blockquote&gt;&lt;blockquote style="margin:0px 0px 0px \
40px;border:none;padding:0px"&gt;&lt;/blockquote&gt;&lt;blockquote style="margin:0px 0px 0px \
40px;border:none;padding:0px"&gt;&lt;/blockquote&gt;&lt;blockquote style="margin:0px 0px 0px \
40px;border:none;padding:0px"&gt;&lt;/blockquote&gt;&lt;blockquote style="margin:0px 0px 0px \
40px;border:none;padding:0px"&gt;&lt;/blockquote&gt;&lt;blockquote style="margin:0px 0px 0px \
40px;border:none;padding:0px"&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Tue, Jun 20, 2017 at 12:46 PM, Laine Stump &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:laine@laine.org" \
target="_blank"&gt;laine@laine.org&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div class="HOEnZb"&gt;&lt;div class="h5"&gt;On 06/20/2017 05:27 AM, \
Martin Kletzander wrote:&lt;br&gt; &gt; On Tue, Jun 20, 2017 at 10:05:19AM +0200, Martin \
Kletzander wrote:&lt;br&gt; &gt;&gt; On Tue, Jun 20, 2017 at 02:26:59AM -0400, Travis S. \
Johnson wrote:&lt;br&gt; &gt;&gt;&gt; Hello,&lt;br&gt;
&gt;&gt;&gt;&lt;br&gt;
&gt;&gt;&gt; I came across an interesting problem in my home lab a few weeks ago&lt;br&gt;
&gt;&gt;&gt; as I'm&lt;br&gt;
&gt;&gt;&gt; prepping for my RHCE exam using Michael Jang study guide. I've \
been&lt;br&gt; &gt;&gt;&gt; at this&lt;br&gt;
&gt;&gt;&gt; for days now, and I still can't wrap my head around how two or \
more&lt;br&gt; &gt;&gt;&gt; virtual&lt;br&gt;
&gt;&gt;&gt; networks in default NAT configuration are even allowed to \
communicate&lt;br&gt; &gt;&gt;&gt; with&lt;br&gt;
&gt;&gt;&gt; each other despite what the libvirt documentation said.&lt;br&gt;
&gt;&gt;&gt;&lt;br&gt;
&gt;&gt;&gt;&lt;br&gt;
&gt;&gt;&gt; Here's the excerpt I'm referring to in the wiki link here:&lt;br&gt;
&gt;&gt;&gt; &lt;a href="http://wiki.libvirt.org/page/Networking#Forwarding_Incoming_Connections" \
rel="noreferrer" target="_blank"&gt;http://wiki.libvirt.org/page/&lt;wbr&gt;Networking#Forwarding_&lt;wbr&gt;Incoming_Connections&lt;/a&gt;:&lt;br&gt;
 &gt;&gt;&gt;&lt;br&gt;
&gt;&gt;&gt;&gt; By default, guests that are connected via a virtual network with&lt;br&gt;
&gt;&gt;&gt;&gt; &lt;forward&lt;br&gt;
&gt;&gt;&gt;&gt; mode='nat'/&gt; can make any outgoing network connection \
they like.&lt;br&gt; &gt;&gt;&gt;&gt; Incoming&lt;br&gt;
&gt;&gt;&gt;&gt; connections are allowed from the host, and from other guests&lt;br&gt;
&gt;&gt;&gt;&gt; connected to&lt;br&gt;
&gt;&gt;&gt;&gt; the same libvirt network, but all other incoming connections are&lt;br&gt;
&gt;&gt;&gt;&gt; blocked by&lt;br&gt;
&gt;&gt;&gt;&gt; iptables rules.&lt;br&gt;
&gt;&gt;&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; I did not read this properly...&lt;br&gt;
&gt;&lt;br&gt;
&gt;&gt;&gt;&lt;br&gt;
&gt;&gt;&gt; Also here's another assertion from 'The virtual network \
driver'&lt;br&gt; &gt;&gt;&gt; section in&lt;br&gt;
&gt;&gt;&gt; &lt;a href="http://libvirt.org/firewall.html" rel="noreferrer" \
target="_blank"&gt;http://libvirt.org/firewall.&lt;wbr&gt;html&lt;/a&gt;:&lt;br&gt; &gt;&gt;&gt;&lt;br&gt;
&gt;&gt;&gt;&gt; type=nat&lt;br&gt;
&gt;&gt;&gt;&gt;&lt;br&gt;
&gt;&gt;&gt;&gt; Allow inbound related to an established connection. Allow outbound, \
but&lt;br&gt; &gt;&gt;&gt;&gt; only from our expected subnet. Allow traffic between guests. \
Deny&lt;br&gt; &gt;&gt;&gt;&gt; all other&lt;br&gt;
&gt;&lt;br&gt;
&gt; I would expect the 'traffic between guests' to mean only guests on \
the&lt;br&gt; &gt; same network.   Also that lines up with what's written above.&lt;br&gt;
&lt;br&gt;
&lt;/div&gt;&lt;/div&gt;That is correct.&lt;br&gt;
&lt;span class=""&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt;&gt;&gt;&gt; inbound. Deny all other outbound.&lt;br&gt;
&gt;&gt;&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; [...]&lt;br&gt;
&gt;&lt;br&gt;
&gt;&gt;&lt;br&gt;
&gt;&gt; Thanks for reporting this.   It's clearly a bug in libvirt.   The \
rules&lt;br&gt; &gt;&gt; are in this order:&lt;br&gt;
&gt;&gt;&lt;br&gt;
&gt;&gt;   all rules for virbr0&lt;br&gt;
&gt;&gt;   all rules for virbr1&lt;br&gt;
&gt;&gt;   all rules for virbr2&lt;br&gt;
&gt;&gt;&lt;br&gt;
&gt;&gt; But what we should do instead is:&lt;br&gt;
&gt;&gt;&lt;br&gt;
&gt;&gt;   input rules for all networks&lt;br&gt;
&gt;&gt;   local rules for all networks&lt;br&gt;
&gt;&gt;   output rules for all networks&lt;br&gt;
&gt;&gt;   reject rules for all networks&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;That doesn't achieve the desired results (as you figured out later,&lt;br&gt;
according to your followup comments.&lt;br&gt;
&lt;span class=""&gt;&lt;br&gt;
&lt;br&gt;
&gt;&gt;&lt;br&gt;
&gt;&gt; The problem is that we do not know how other rules look like.   So what&lt;br&gt;
&gt;&gt; we might need to do is create chains where rules for the first network&lt;br&gt;
&gt;&gt; are, then only append network rules into those chains.&lt;br&gt;
&gt;&gt;&lt;br&gt;
&gt;&gt; Would you mind filing a bug for this issue, so we can properly track it&lt;br&gt;
&gt;&gt; and don't forget about it?   I'll have a look at it in the meantime, \
but&lt;br&gt; &gt;&gt; don't promise anything since I'm not that familiar with that \
part of the&lt;br&gt; &gt;&gt; codebase.&lt;br&gt;
&gt;&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt; Actually, now that I'm thinking about it, the problem is not that we&lt;br&gt;
&gt; disallow the communication from virbr1 to virbr0, but the problem is&lt;br&gt;
&gt; that we allow the connection from virbr0 to everywhere.&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;Yep!&lt;br&gt;
&lt;br&gt;
That's actually a known bug that has been there "forever". It has \
always&lt;br&gt; been brought up in the context of "I want communication between my \
NATed&lt;br&gt; networks, and it only works in one direction!", rather than "I \
want to&lt;br&gt; block communication between my NATed networks, but it gets past in \
one&lt;br&gt; direction!". When people learn that it's (kind of) blocked, they \
work&lt;br&gt; around it by adding a new network that is shared by all the guests.&lt;br&gt;
Because all of the reports have been in this direction, fixing it&lt;br&gt;
properly has been very low on (my) priority list.&lt;br&gt;
&lt;span class=""&gt;&lt;br&gt;
&lt;br&gt;
&gt;&lt;br&gt;
&gt; Maybe the solution would be: for each network, insert the rules on top&lt;br&gt;
&gt; of the forward chain and for each started network, explicitly reject&lt;br&gt;
&gt; that one.   So that after one network starts it would look like this \
(I'm&lt;br&gt; &gt; writing this from memory just to illustrate the idea, not \
actually&lt;br&gt; &gt; looking up how stuff looks):&lt;br&gt;
&gt;&lt;br&gt;
&gt;   ACCEPT any virbr0 RELATED,ESTABLISHED&lt;br&gt;
&gt;   ACCEPT virbr0 virbr0&lt;br&gt;
&gt;   ACCEPT virbr0 any src:&lt;a href="http://192.168.122.0/24" rel="noreferrer" \
target="_blank"&gt;192.168.122.0/24&lt;/a&gt;&lt;br&gt; &gt;   REJECT any virbr0&lt;br&gt;
&gt;   REJECT virbr0 any&lt;br&gt;
&gt;&lt;br&gt;
&gt; And after second network is started, we'd have:&lt;br&gt;
&gt;&lt;br&gt;
&gt;   # This one is new:&lt;br&gt;
&gt;   REJECT virbr1 virbr0&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;Yeah, it's (mostly) this rule that makes the solution complicated.&lt;br&gt;
Essentially you need one of these rules for each pair of virtual&lt;br&gt;
networks, so if you have 10 networks, you'll need 45 rules, for 11&lt;br&gt;
you'll need 55 (in general, for "n" networks, you'll need (n * \
(n-1) /&lt;br&gt; 2) extra rules).&lt;br&gt;
&lt;br&gt;
Aside from the extra packet processing overhead caused by the high&lt;br&gt;
number of rules needed (which may be completely insignificant), and the&lt;br&gt;
necessity to add/remove rules at specific labels rather than just&lt;br&gt;
inserting them all at the beginning, there is the issue that currently&lt;br&gt;
each iptables rule added for a libvirt network is dependent only on that&lt;br&gt;
network, so it's simple to determine which rules to remove when a&lt;br&gt;
network is destroyed. If we start adding rules that are dependent on two&lt;br&gt;
networks, then proper cleanup will be more complicated.&lt;br&gt;
&lt;br&gt;
None of that should prevent a properly motivated person from writing the&lt;br&gt;
code to do it, of course!&lt;br&gt;
&lt;div class="HOEnZb"&gt;&lt;div class="h5"&gt;&lt;br&gt;
&gt;   # These ones would be normally at the end, IIRC:&lt;br&gt;
&gt;   ACCEPT any virbr1 RELATED,ESTABLISHED&lt;br&gt;
&gt;   ACCEPT virbr1 virbr1&lt;br&gt;
&gt;   ACCEPT virbr1 any src:&lt;a href="http://192.168.122.0/24" rel="noreferrer" \
target="_blank"&gt;192.168.122.0/24&lt;/a&gt;&lt;br&gt; &gt;   REJECT any virbr1&lt;br&gt;
&gt;   REJECT virbr1 any&lt;br&gt;
&gt;   # These are left as they were:&lt;br&gt;
&gt;   ACCEPT any virbr0 RELATED,ESTABLISHED&lt;br&gt;
&gt;   ACCEPT virbr0 virbr0&lt;br&gt;
&gt;   ACCEPT virbr0 any src:&lt;a href="http://192.168.122.0/24" rel="noreferrer" \
target="_blank"&gt;192.168.122.0/24&lt;/a&gt;&lt;br&gt; &gt;   REJECT any virbr0&lt;br&gt;
&gt;   REJECT virbr0 any&lt;br&gt;
&gt;&lt;br&gt;
&gt; Cc'ing Laine so that he can weigh in as he has way more knowledge of&lt;br&gt;
&gt; this part of the code =)&lt;br&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170621184637</emailId><senderName>Dan</senderName><senderEmail>srwx4096@gmail.com</senderEmail><timestampReceived>2017-06-21 18:46:37-0400</timestampReceived><subject>Re: [libvirt-users] virtual drive performance</subject><body>

On Tue, Jun 20, 2017 at 04:24:32PM +0200, Gianluca Cecchi wrote:
&gt; On Tue, Jun 20, 2017 at 3:38 PM, Dominik Psenner &lt;dpsenner@gmail.com&gt; wrote:
&gt; 
&gt; &gt;
&gt; &gt; to the following:
&gt; &gt;
&gt; &gt; &lt;disk type='file' device='disk'&gt;
&gt; &gt;   &lt;driver name='qemu' type='qcow2' cache='none'/&gt;
&gt; &gt;   &lt;source file='/var/data/virtuals/machines/windows-server-2016-
&gt; &gt; x64/image.qcow2'/&gt;
&gt; &gt;   &lt;backingStore/&gt;
&gt; &gt;   &lt;target dev='hda' bus='scsi'/&gt;
&gt; &gt;   &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt; &gt; &lt;/disk&gt;
&gt; &gt;
&gt; &gt; Do you see any gotchas in this configuration that could prevent the
&gt; &gt; virtualized guest to power on and boot up?
&gt; &gt;
&gt; &gt;
&gt; When I configure like this, from a linux guest point of view I get this
&gt; Symbios Logic SCSI Controller:
&gt; 00:08.0 SCSI storage controller: LSI Logic / Symbios Logic 53c895a
&gt; 
&gt; But htis is true only if you add the SCSI controller too, not only the disk
&gt; definition.
&gt; In my case
&gt; 
&gt;     &lt;controller type='scsi' index='0'&gt;
&gt;       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08'
&gt; function='0x0'/&gt;
&gt;     &lt;/controller&gt;
&gt; 
&gt; Note the slot='0x08' that is reflected into the first field of lspci inside
&gt; my linux guest.
&gt; So between your controllers you have to add the SCSI one
&gt; 
&gt; In my case (Fedora 25 with virt-manager-1.4.1-2.fc25.noarch,
&gt; qemu-kvm-2.7.1-6.fc25.x86_64, libvirt-2.2.1-2.fc25.x86_64) with "Disk bus"
&gt; set as SCSI in virt-manager, the xml defintiion for the guest is
&gt; automatically updated with the controller if not existent yet.
&gt; And the disk definition sections is like this:
&gt; 
&gt;     &lt;disk type='file' device='disk'&gt;
&gt;       &lt;driver name='qemu' type='qcow2'/&gt;
&gt;       &lt;source file='/var/lib/libvirt/images/slaxsmall.qcow2'/&gt;
&gt;       &lt;target dev='sda' bus='scsi'/&gt;
&gt;       &lt;boot order='1'/&gt;
&gt;       &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt;     &lt;/disk&gt;
&gt; 
&gt; So I think you should set dev='sda' and not 'hda' in your xml for it
&gt; 
I am actually very curious to know if that would make a difference. I
don't have a such windows vm images ready to test at present.

Dan
&gt; I don't kknow if w2016 contains the symbios logic drivers already
&gt; installed, so that a "simple" reboot could imply an automatic
&gt; reconfiguration of the guest....
&gt; Note also that in Windows when the hw configuration is considered heavily
&gt; changed, you could be asked to register again (I don't think that the IDE
&gt; --&gt; SCSI should imply it...)
&gt; 
&gt; Gianluca

&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users

</body></email><email><emailId>20170624013807</emailId><senderName></senderName><senderEmail>taoyuan_eddy@hotmail.com</senderEmail><timestampReceived>2017-06-24 01:38:07-0400</timestampReceived><subject>[libvirt-users] GPIO support in libvirt</subject><body>

[Attachment #2 (text/plain)]

Hi, Dear libvirt experts:

       I am deploying a Virtual Machine to my hardware running linux.

The thing is about the LED,  the LED is controlled by GPIO operation.

I do not know if my current qemu or libvirt can virtualize GPIO operation.

And if yes, where can I find the options of qemu or libvirt(preferred)

I am using qemu 2.4.0 and libvirt 1.3.2

Appreciate if hear from you

Thanks

eddy


[Attachment #3 (text/html)]

&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=gb2312"&gt;
&lt;style type="text/css" style="display:none;"&gt;&lt;!-- P {margin-top:0;margin-bottom:0;} \
--&gt;&lt;/style&gt; &lt;/head&gt;
&lt;body dir="ltr"&gt;
&lt;div id="divtagdefaultwrapper" \
style="font-size:12pt;color:#000000;font-family:Calibri,Helvetica,sans-serif;" \
dir="ltr"&gt; &lt;p&gt;Hi, Dear libvirt experts:&lt;/p&gt;
&lt;p&gt;       I am deploying a Virtual Machine to my \
hardware running linux.&lt;/p&gt; &lt;p&gt;The thing is about the LED,  the LED is \
controlled by GPIO operation.&lt;/p&gt; &lt;p&gt;I do not know if my current qemu or libvirt can \
virtualize GPIO operation.&lt;/p&gt; &lt;p&gt;And if yes, where can I find the options of qemu or \
libvirt(preferred)&lt;/p&gt; &lt;p&gt;I am using qemu 2.4.0 and libvirt 1.3.2&lt;/p&gt;
&lt;p&gt;Appreciate if hear from you&lt;br&gt;
&lt;/p&gt;
&lt;p&gt;Thanks&lt;/p&gt;
&lt;p&gt;eddy&lt;br&gt;
&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170626134455</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-06-26 13:44:55-0400</timestampReceived><subject>Re: [libvirt-users] About libvirt concurrency</subject><body>


On Mon, Jun 12, 2017 at 11:21:08AM +0800, =E9=A9=AC=E9=87=91=E8=88=9F wrote:
&gt;hi all:
&gt;    hello. I would like to ask a question about concurrency. Whether
&gt;libvirt can achieve at the same time open 200 virtual machines.
&gt;    I try to open 200 virtual machines at the same time. oh on. when i am
&gt;connected one of the virtual machines, i waited for a long time. I guess
&gt;libvirt can't achieve concurrent operaction. I wish I could get a real
&gt;result as soon as possible. thank you.

Check /etc/libvirt/libvirtd.conf for some settings that you might want
to tune.  We are minimizing the parts that starting different machines
must share, but you also need more workers to work concurrently.

&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170626144636</emailId><senderName>Brianna Moczynski</senderName><senderEmail>bmoczynski@xes-inc.com</senderEmail><timestampReceived>2017-06-26 14:46:36-0400</timestampReceived><subject>[libvirt-users] Configuring VMM for USB/Serial</subject><body>

Hello, 

I keep receiving errors such as the following: 



Error rebooting domain: Timed out during operation: cannot acquire state change 
lock (held by qemuProcessReconnect) 

Traceback (most recent call last): 
File "/usr/share/virt-manager/virtManager/asyncjob.py", line 90, in cb_wrapper 
callback(asyncjob, *args, **kwargs) 
File "/usr/share/virt-manager/virtManager/asyncjob.py", line 126, in tmpcb 
callback(*args, **kwargs) 
File "/usr/share/virt-manager/virtManager/libvirtobject.py", line 83, in newfn 
ret = fn(self, *args, **kwargs) 
File "/usr/share/virt-manager/virtManager/domain.py", line 1378, in reboot 
self._backend.reboot(0) 
File "/usr/lib/python2.7/dist-packages/libvirt.py", line 2024, in reboot 
if ret == -1: raise libvirtError ('virDomainReboot() failed', dom=self) 
libvirtError: Timed out during operation: cannot acquire state change lock (held 
by qemuProcessReconnect) 

Whereby VMM loads, showing my VM in the "Paused" state and will not start, restart, \
shout down, etc. 

Restarting libvirt did not seem to have an effect on the issue. 

I ultimately solved it by removing and reinstalling the VM itself. 

Additionally, and I believe the issues may be somewhat related, I am having the \
following issues: 

libvirt not supporting forwarding ttys as usb serial devices (for pci serial cards \
(multiple serial ports))  virt-manager not supporting redirecting usb devices by \
vendor:device id 

I was wondering if you might have any suggestions on how to configure libvirt so that \
I do not have these issues. 

Thanks, 
BJM 


[Attachment #3 (text/html)]

&lt;html&gt;&lt;body&gt;&lt;div style="font-family: arial, helvetica, sans-serif; font-size: 12pt; \
color: #000000"&gt;&lt;div&gt;Hello,&lt;br&gt;&lt;br&gt;I keep receiving errors such as the \
following:&lt;br&gt;&lt;br&gt;&lt;p style="margin: 0px;" data-mce-style="margin: 0px;"&gt;Error \
rebooting domain: Timed out during operation: cannot acquire state change&lt;br&gt;lock \
(held by qemuProcessReconnect)&lt;/p&gt;&lt;p style="margin: 0px;" data-mce-style="margin: \
0px;"&gt;Traceback (most recent call last):&lt;br&gt;File \
"/usr/share/virt-manager/virtManager/asyncjob.py", line 90, in \
cb_wrapper&lt;br&gt;callback(asyncjob, *args, **kwargs)&lt;br&gt;File \
"/usr/share/virt-manager/virtManager/asyncjob.py", line 126, in \
tmpcb&lt;br&gt;callback(*args, **kwargs)&lt;br&gt;File \
"/usr/share/virt-manager/virtManager/libvirtobject.py", line 83, in newfn&lt;br&gt;ret = \
fn(self, *args, **kwargs)&lt;br&gt;File "/usr/share/virt-manager/virtManager/domain.py", \
line 1378, in reboot&lt;br&gt;self._backend.reboot(0)&lt;br&gt;File \
"/usr/lib/python2.7/dist-packages/libvirt.py", line 2024, in reboot&lt;br&gt;if ret == -1: \
raise libvirtError ('virDomainReboot() failed', dom=self)&lt;br&gt;libvirtError: Timed out \
during operation: cannot acquire state change lock (held&lt;br&gt;by \
qemuProcessReconnect)&lt;br&gt;&lt;br&gt;Whereby VMM loads, showing my VM in the "Paused" state \
and will not start, restart, shout down, etc.&lt;br&gt;&lt;br&gt;Restarting libvirt did not seem \
to have an effect on the issue.&lt;br&gt;&lt;br&gt;I ultimately solved it by removing and \
reinstalling the VM itself.&lt;br&gt;&lt;br&gt;Additionally, and I believe the issues may be \
somewhat related, I am having the following issues:&lt;br&gt;&lt;br&gt;&lt;/p&gt;libvirt not supporting \
forwarding ttys as usb serial devices (for pci serial cards (multiple serial \
ports))&lt;br&gt;virt-manager not supporting redirecting usb devices by vendor:device \
id&lt;br&gt;&lt;br&gt;I was wondering if you might have any suggestions on how to configure \
libvirt so that I do not have these issues.&lt;br&gt;&lt;br&gt;Thanks,&lt;br&gt;BJM&lt;br \
data-mce-bogus="1"&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;



</body></email><email><emailId>20170626151644</emailId><senderName>Petr Kotas</senderName><senderEmail>pkotas@redhat.com</senderEmail><timestampReceived>2017-06-26 15:16:44-0400</timestampReceived><subject>[libvirt-users] Authenticating virsh with username and password</subject><body>

Hi,

I am new to libvirt and still learning, so thanks for any help.

I am using libvirt configured with username and password.
I need to utilize libvirt service "libvirt-guests.service" to shutdown all
my VMs on system shutdown.

Unfortunately it fails due to failed authentication.

Jun 26 15:56:55 localhost virsh[13326]: All-whitespace username.
Jun 26 15:56:55 localhost libvirt-guests.sh[13114]: Unable to connect to
libvirt currently. Retrying .. 2Please enter your authenti
Jun 26 15:56:55 localhost libvirtd[1155]: End of file while reading data:
Input/output error

Is it possible to specify user and password somehow? I cannot run kerberos
or some other token based authentication.

Thanks for any help.

Kind regards,
Petr Kotas

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hi,&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I am new to \
libvirt and still learning, so thanks for any help.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;I am using \
libvirt configured with username and password. &lt;br&gt;&lt;/div&gt;I need to utilize libvirt \
service "libvirt-guests.service" to shutdown all my VMs on system \
shutdown.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Unfortunately it fails due to failed \
authentication.&lt;br&gt;&lt;br&gt;&lt;div style="margin-left:40px"&gt;&lt;span \
style="font-family:monospace,monospace"&gt;Jun 26 15:56:55 localhost virsh[13326]: \
All-whitespace username.&lt;/span&gt;&lt;br&gt;&lt;span style="font-family:monospace,monospace"&gt;Jun \
26 15:56:55 localhost libvirt-guests.sh[13114]: Unable to connect to libvirt \
currently. Retrying .. 2Please enter your authenti&lt;/span&gt;&lt;br&gt;&lt;span \
style="font-family:monospace,monospace"&gt;Jun 26 15:56:55 localhost libvirtd[1155]: End \
of file while reading data: Input/output \
error&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;Is it possible to specify user and \
password somehow? I cannot run kerberos or some other token based \
authentication.&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;Thanks for any help.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Kind \
regards,&lt;br&gt;&lt;/div&gt;Petr \
Kotas&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;




</body></email><email><emailId>20170626190633</emailId><senderName>Wido den Hollander</senderName><senderEmail>wido@widodh.nl</senderEmail><timestampReceived>2017-06-26 19:06:33-0400</timestampReceived><subject>[libvirt-users] Accepting RELATED, ESTABLISHED (TCP) connections into VM using Network Filters</subject><body>

Hi,

Over the past few days I've been trying to get a prototype working of a stateful \
firewall for a Virtual Machine using Libvirt's network filters.

My goal is to replace the current custom Python/Java code in the Apache CloudStack \
[0] project by Network Filters of Libvirt.

Both IPv4 and IPv6 should work, but I started off with IPv4 and I have issues with \
accepting back RELATED,ESTABLISHED connections into the VM.

In the guest's XML I have this defined:

      &lt;filterref filter='nwfilter-test'&gt;
        &lt;parameter name='IP' value='192.168.200.250'/&gt;
        &lt;parameter name='IPV6' value='2001:db8:100:0:5054:ff:fe9c:6ce6'/&gt;
        &lt;parameter name='IPV6' value='fe80::5054:ff:fe9c:6ce6'/&gt;
      &lt;/filterref&gt;

And the filter currently looks like this:

&lt;filter name='nwfilter-test' chain='root'&gt;
    &lt;uuid&gt;a2493284-9dd5-4c20-98b5-7e70745b53de&lt;/uuid&gt;
    &lt;!-- These are default build-in filters from libvirt and are mainly ipv4 only--&gt;
    &lt;filterref filter='no-mac-spoofing'/&gt;
    &lt;filterref filter='no-ip-spoofing'/&gt;
    &lt;filterref filter='no-arp-spoofing'/&gt;
    &lt;filterref filter='allow-dhcp'/&gt;

    &lt;!-- IPv4 Rules --&gt;
    &lt;rule action='accept' direction='in' priority='100'&gt;
      &lt;all state='RELATED,ESTABLISHED'/&gt;
    &lt;/rule&gt;

    &lt;rule action='return' direction='in' priority='500'&gt;
      &lt;icmp/&gt;
    &lt;/rule&gt;

    &lt;rule action='accept' direction='in' priority='500'&gt;
      &lt;tcp dstportstart='22'/&gt;
    &lt;/rule&gt;

    &lt;rule action='accept' direction='in' priority='500'&gt;
      &lt;tcp dstportstart='80'/&gt;
    &lt;/rule&gt;

    &lt;rule action='reject' direction='in' priority='1000'&gt;
      &lt;all/&gt;
    &lt;/rule&gt;
&lt;/filter&gt;

I can SSH into the VM and also visit the Webserver running on it. But going out the \
VM results in issues:

root@nwfilter-test:~# telnet 109.72.92.155 80
Trying 109.72.92.155...
telnet: Unable to connect to remote host: Connection refused
root@nwfilter-test:~# 

I can however ping the same target:

root@nwfilter-test:~# ping -c 2 109.72.92.155
PING 109.72.92.155 (109.72.92.155) 56(84) bytes of data.
64 bytes from 109.72.92.155: icmp_seq=1 ttl=56 time=13.2 ms
64 bytes from 109.72.92.155: icmp_seq=2 ttl=56 time=14.1 ms

--- 109.72.92.155 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 13.225/13.703/14.182/0.492 ms
root@nwfilter-test:~#

Looking at iptables-save it seems like the right rules are programmed:

-A FI-vnet1 -p icmp -j RETURN
-A FI-vnet1 -p tcp -m tcp --sport 22 -m conntrack --ctstate ESTABLISHED -m conntrack \
                --ctdir REPLY -j RETURN
-A FI-vnet1 -p tcp -m tcp --sport 80 -m conntrack --ctstate ESTABLISHED -m conntrack \
                --ctdir REPLY -j RETURN
-A FI-vnet1 -j REJECT --reject-with icmp-port-unreachable
-A FO-vnet1 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FO-vnet1 -p icmp -j RETURN
-A FO-vnet1 -p tcp -m tcp --dport 22 -m conntrack --ctstate NEW,ESTABLISHED -m \
                conntrack --ctdir ORIGINAL -j ACCEPT
-A FO-vnet1 -p tcp -m tcp --dport 80 -m conntrack --ctstate NEW,ESTABLISHED -m \
                conntrack --ctdir ORIGINAL -j ACCEPT
-A FO-vnet1 -j REJECT --reject-with icmp-port-unreachable
-A HI-vnet1 -p icmp -j RETURN
-A HI-vnet1 -p tcp -m tcp --sport 22 -m conntrack --ctstate ESTABLISHED -m conntrack \
                --ctdir REPLY -j RETURN
-A HI-vnet1 -p tcp -m tcp --sport 80 -m conntrack --ctstate ESTABLISHED -m conntrack \
                --ctdir REPLY -j RETURN
-A HI-vnet1 -j REJECT --reject-with icmp-port-unreachable
-A libvirt-host-in -m physdev --physdev-in vnet1 -g HI-vnet1
-A libvirt-in -m physdev --physdev-in vnet1 -g FI-vnet1
-A libvirt-in-post -m physdev --physdev-in vnet1 -j ACCEPT
-A libvirt-out -m physdev --physdev-out vnet1 --physdev-is-bridged -g FO-vnet1

I tried changing 'accept' into 'return' for the incoming RELATED,ESTABLISHED rules, \
but that didn't help.

I also tried searching for example of more complex network filters, but all I keep \
finding are the default filters of Libvirt.

Does anybody know what I'm doing wrong here? Or are there any examples of working \
filters out there?

Thank you!

Wido

[0]: http://cloudstack.apache.org/


</body></email><email><emailId>20170627112744</emailId><senderName>Pablo Vieytes</senderName><senderEmail>pablo.vb80@gmail.com</senderEmail><timestampReceived>2017-06-27 11:27:44-0400</timestampReceived><subject>[libvirt-users] Problems creating a new volume</subject><body>

Hi,
I'm having troubles creating a new storage volume in c++.
This is my code:



    storageVolXml = "&lt;volume&gt;\

      &lt;name&gt;" + name +".img&lt;/name&gt;\

      &lt;allocation&gt;0&lt;/allocation&gt;\

      &lt;capacity unit=\"G\"&gt;" + hd + "&lt;/capacity&gt;\

      &lt;target&gt;\

        &lt;path&gt;" + filePath + "&lt;/path&gt;\

        &lt;format type='"+ diskFormatType  + "'/&gt;\

       &lt;/target&gt;\

    &lt;/volume&gt;";

storageVolPtr = virStorageVolCreateXML(pool,
storageVolXml.toLatin1().data(),
VIR_STORAGE_VOL_CREATE_PREALLOC_METADATA);


I don't have any error but no file is created in the specified path (filePath).


Any suggestion?


Thanks in advance.

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi,  &lt;div&gt;I'm having troubles creating a new storage volume in \
c++.  &lt;/div&gt;&lt;div&gt;This is my code:&lt;/div&gt;&lt;div&gt;&lt;br&gt;   &lt;pre \
style="margin-top:0px;margin-bottom:0px"&gt;&lt;span style="color:rgb(192,192,192)"&gt;    \
&lt;/span&gt;&lt;span style="color:rgb(0,0,0)"&gt;storageVolXml&lt;/span&gt;&lt;span \
style="color:rgb(192,192,192)"&gt; &lt;/span&gt;&lt;span style="color:rgb(0,0,0)"&gt;=&lt;/span&gt;&lt;span \
style="color:rgb(192,192,192)"&gt; &lt;/span&gt;&lt;span \
style="color:rgb(0,128,0)"&gt;"&lt;volume&gt;\&lt;/span&gt;&lt;/pre&gt; &lt;pre \
style="margin-top:0px;margin-bottom:0px"&gt;&lt;span style="color:rgb(192,192,192)"&gt;      \
&lt;/span&gt;&lt;span style="color:rgb(0,128,0)"&gt;&lt;name&gt;"&lt;/span&gt;&lt;span \
style="color:rgb(192,192,192)"&gt; &lt;/span&gt;&lt;span style="color:rgb(0,0,0)"&gt;+&lt;/span&gt;&lt;span \
style="color:rgb(192,192,192)"&gt; &lt;/span&gt;&lt;span \
style="color:rgb(0,0,0)"&gt;name&lt;/span&gt;&lt;span style="color:rgb(192,192,192)"&gt; \
&lt;/span&gt;&lt;span style="color:rgb(0,0,0)"&gt;+&lt;/span&gt;&lt;span \
style="color:rgb(0,128,0)"&gt;".img&lt;/name&gt;\&lt;/span&gt;&lt;/pre&gt; &lt;pre \
style="margin-top:0px;margin-bottom:0px"&gt;&lt;span style="color:rgb(192,192,192)"&gt;      \
&lt;/span&gt;&lt;span style="color:rgb(0,128,0)"&gt;&lt;allocation&gt;0&lt;/allocation&gt;\&lt;/span&gt;&lt;/pre&gt;
 &lt;pre style="margin-top:0px;margin-bottom:0px"&gt;&lt;span style="color:rgb(192,192,192)"&gt;  \
&lt;/span&gt;&lt;span style="color:rgb(0,128,0)"&gt;&lt;capacity&lt;/span&gt;&lt;span \
style="color:rgb(192,192,192)"&gt; &lt;/span&gt;&lt;span \
style="color:rgb(0,128,0)"&gt;unit=\"G\"&gt;"&lt;/span&gt;&lt;span \
style="color:rgb(192,192,192)"&gt; &lt;/span&gt;&lt;span style="color:rgb(0,0,0)"&gt;+&lt;/span&gt;&lt;span \
style="color:rgb(192,192,192)"&gt; &lt;/span&gt;&lt;span style="color:rgb(0,0,0)"&gt;hd&lt;/span&gt;&lt;span \
style="color:rgb(192,192,192)"&gt; &lt;/span&gt;&lt;span style="color:rgb(0,0,0)"&gt;+&lt;/span&gt;&lt;span \
style="color:rgb(192,192,192)"&gt; &lt;/span&gt;&lt;span \
style="color:rgb(0,128,0)"&gt;"&lt;/capacity&gt;\&lt;/span&gt;&lt;/pre&gt; &lt;pre \
style="margin-top:0px;margin-bottom:0px"&gt;&lt;span style="color:rgb(192,192,192)"&gt;      \
&lt;/span&gt;&lt;span style="color:rgb(0,128,0)"&gt;&lt;target&gt;\&lt;/span&gt;&lt;/pre&gt; &lt;pre \
style="margin-top:0px;margin-bottom:0px"&gt;&lt;span style="color:rgb(192,192,192)"&gt;        \
&lt;/span&gt;&lt;span style="color:rgb(0,128,0)"&gt;&lt;path&gt;"&lt;/span&gt;&lt;span \
style="color:rgb(192,192,192)"&gt; &lt;/span&gt;&lt;span style="color:rgb(0,0,0)"&gt;+&lt;/span&gt;&lt;span \
style="color:rgb(192,192,192)"&gt; &lt;/span&gt;&lt;span \
style="color:rgb(0,0,0)"&gt;filePath&lt;/span&gt;&lt;span style="color:rgb(192,192,192)"&gt; \
&lt;/span&gt;&lt;span style="color:rgb(0,0,0)"&gt;+&lt;/span&gt;&lt;span style="color:rgb(192,192,192)"&gt; \
&lt;/span&gt;&lt;span style="color:rgb(0,128,0)"&gt;"&lt;/path&gt;\&lt;/span&gt;&lt;/pre&gt; &lt;pre \
style="margin-top:0px;margin-bottom:0px"&gt;&lt;span style="color:rgb(192,192,192)"&gt;        \
&lt;/span&gt;&lt;span style="color:rgb(0,128,0)"&gt;&lt;format&lt;/span&gt;&lt;span \
style="color:rgb(192,192,192)"&gt; &lt;/span&gt;&lt;span \
style="color:rgb(0,128,0)"&gt;type='"&lt;/span&gt;&lt;span \
style="color:rgb(0,0,0)"&gt;+&lt;/span&gt;&lt;span style="color:rgb(192,192,192)"&gt; &lt;/span&gt;&lt;span \
style="color:rgb(0,0,0)"&gt;diskFormatType&lt;/span&gt;&lt;span style="color:rgb(192,192,192)"&gt;  \
&lt;/span&gt;&lt;span style="color:rgb(0,0,0)"&gt;+&lt;/span&gt;&lt;span style="color:rgb(192,192,192)"&gt; \
&lt;/span&gt;&lt;span style="color:rgb(0,128,0)"&gt;"'/&gt;\&lt;/span&gt;&lt;/pre&gt; &lt;pre \
style="margin-top:0px;margin-bottom:0px"&gt;&lt;span style="color:rgb(192,192,192)"&gt;       \
&lt;/span&gt;&lt;span style="color:rgb(0,128,0)"&gt;&lt;/target&gt;\&lt;/span&gt;&lt;/pre&gt; &lt;pre \
style="margin-top:0px;margin-bottom:0px"&gt;&lt;span style="color:rgb(192,192,192)"&gt;    \
&lt;/span&gt;&lt;span style="color:rgb(0,128,0)"&gt;&lt;/volume&gt;"&lt;/span&gt;&lt;span \
style="color:rgb(0,0,0)"&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;pre \
style="margin-top:0px;margin-bottom:0px"&gt;&lt;span \
style="color:rgb(0,0,0)"&gt;storageVolPtr&lt;/span&gt;&lt;span style="color:rgb(192,192,192)"&gt; \
&lt;/span&gt;&lt;span style="color:rgb(0,0,0)"&gt;=&lt;/span&gt;&lt;span style="color:rgb(192,192,192)"&gt; \
&lt;/span&gt;&lt;span style="color:rgb(0,0,0)"&gt;virStorageVolCreateXML&lt;/span&gt;&lt;span \
style="color:rgb(0,0,0)"&gt;(&lt;/span&gt;&lt;span style="color:rgb(0,0,0)"&gt;pool&lt;/span&gt;&lt;span \
style="color:rgb(0,0,0)"&gt;,&lt;/span&gt;&lt;span style="color:rgb(192,192,192)"&gt; &lt;/span&gt;&lt;span \
style="color:rgb(0,0,0)"&gt;storageVolXml&lt;/span&gt;&lt;span \
style="color:rgb(0,0,0)"&gt;.&lt;/span&gt;&lt;span style="color:rgb(0,0,0)"&gt;toLatin1&lt;/span&gt;&lt;span \
style="color:rgb(0,0,0)"&gt;().&lt;/span&gt;&lt;span style="color:rgb(0,0,0)"&gt;data&lt;/span&gt;&lt;span \
style="color:rgb(0,0,0)"&gt;(),&lt;/span&gt;&lt;span style="color:rgb(192,192,192)"&gt; &lt;/span&gt;&lt;span \
style="color:rgb(128,0,128)"&gt;VIR_STORAGE_VOL_CREATE_PREALLOC_METADATA&lt;/span&gt;&lt;span \
style="color:rgb(0,0,0)"&gt;);&lt;/span&gt;&lt;/pre&gt;&lt;pre \
style="margin-top:0px;margin-bottom:0px"&gt;&lt;span \
style="color:rgb(0,0,0)"&gt;&lt;br&gt;&lt;/span&gt;&lt;/pre&gt;&lt;pre \
style="margin-top:0px;margin-bottom:0px"&gt;&lt;span style="color:rgb(0,0,0)"&gt;I don't \
have any error but&lt;/span&gt; no file is created in the specified path \
(filePath).&lt;/pre&gt;&lt;pre style="margin-top:0px;margin-bottom:0px"&gt;&lt;br&gt;&lt;/pre&gt;&lt;pre \
style="margin-top:0px;margin-bottom:0px"&gt;Any suggestion?&lt;/pre&gt;&lt;pre \
style="margin-top:0px;margin-bottom:0px"&gt;&lt;br&gt;&lt;/pre&gt;&lt;pre \
style="margin-top:0px;margin-bottom:0px"&gt;Thanks in advance.&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170629025532</emailId><senderName>Lei Zhang</senderName><senderEmail>lei12zhang12@gmail.com</senderEmail><timestampReceived>2017-06-29 02:55:32-0400</timestampReceived><subject>[libvirt-users] Way to detect virtual machine cpu features</subject><body>

Hello everyone

 I want to know how can I use libvirt to detect what cpu features a virtual
machine will see.

I guess I could do it in following way:

1. if cpu mode is 'custom', use 'virsh cpu-baseline --features' on the cpu
model to get model features.
2. if cpu mode is 'host-passthrough' or 'host-model', do a 'virsh
capabilities' to list cpu features of physical host, they are identical to
features of virtual machine.

Is this right way to do things? Look forward to your valuable comments.

Best regards,
Lei

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hello everyone&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;  I want to know how can I use \
libvirt to detect what cpu features a virtual machine will see.&lt;br&gt; &lt;br&gt;
I guess I could do it in following way:&lt;br&gt;
&lt;br&gt;
&lt;span style="color:rgb(128,128,128)"&gt;1.  &lt;/span&gt;if cpu mode is 'custom', use \
'virsh cpu-baseline --features' on the cpu model to get model features.&lt;br&gt; \
&lt;span style="color:rgb(128,128,128)"&gt;2.  &lt;/span&gt;if cpu mode is \
'host-passthrough' or 'host-model', do a 'virsh capabilities' \
to list cpu features of physical host, they are identical to features of virtual \
machine.&lt;br&gt; &lt;br&gt;
Is this right way to do things?  &lt;span style="font-size:12.8px"&gt;Look forward to your \
valuable comments.&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;Best \
regards,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size:12.8px"&gt;Lei&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170630145913</emailId><senderName>Doug Hughes</senderName><senderEmail>doug.hughes@keystonenap.com</senderEmail><timestampReceived>2017-06-30 14:59:13-0400</timestampReceived><subject>Re: [libvirt-users] recovering from deleted snapshot</subject><body>

Yes, I find it annoying that I have to manually remove the no-nos bless
leftover snapshot file. That'd be a great feature. In the mean time I will
look at adding this additional error handling in my script. Thanks much!

On Jun 30, 2017 10:55 AM, "Peter Krempa" &lt;pkrempa@redhat.com&gt; wrote:

&gt; On Fri, Jun 30, 2017 at 10:41:25 -0400, doug.hughes@keystonenap.com wrote:
&gt; &gt; sorry about top post, tablet mail client...
&gt; &gt;
&gt; &gt; brilliant! that did it! Any idea what happened to cause it to partially
&gt; fail and get into this state?
&gt;
&gt; virsh blockcommit --pivot is actually 3 operations in sequence:
&gt; 1) initiate the commit job
&gt; 2) wait till it finishes
&gt; 3) initiate the pivot job (this is synchronous, so the wait till it
&gt; finises is itegrated in the API call)
&gt;
&gt; Apparently in your case the waiting part failed for some reason and thus
&gt; the job was not finished, lingering in the synchronised state.
&gt;
&gt; The unfortunate part is that you don't know which operation failed.
&gt;
&gt; Unfortunately it does not seem that we have wa waiting version of 'virsh
&gt; blockjob' that could be used to do the waiting. You can do the polling
&gt; manualy though.
&gt;
&gt; The third operation can be split out by default, since you can specify
&gt; --wait instead of --pivot for 'virsh blockcommit' and it will finish
&gt; after step 2 above.
&gt;
&gt; Also one of the cases which would help is that libvirt could actually
&gt; remove the file after commit, which would avoid the original problem,
&gt; since the file would still be there.
&gt;
&gt; &gt; oot@vm1 ~]# virsh blockjob serv1r2 vda
&gt; &gt; Active Block Commit: [100 %]
&gt; &gt;
&gt; &gt; [root@vm1 ~]# virsh blockjob --pivot serv1r2 vda
&gt; &gt;
&gt; &gt; [root@vm1 ~]#
&gt; &gt; [root@vm1 ~]# ls -l /var/lib/libvirt/images/serv1r2.qcow2
&gt; &gt; -rw-r--r--. 1 qemu qemu 54200696832 Jun 30 10:39 /var/lib/libvirt/images/
&gt; serv1r2.qcow2
&gt; &gt; [root@vm1 ~]# date
&gt; &gt; Fri Jun 30 10:39:12 EDT 2017
&gt; &gt; [root@vm1 ~]# date
&gt; &gt; Fri Jun 30 10:39:51 EDT 2017
&gt; &gt; [root@vm1 ~]# ls -l /var/lib/libvirt/images/serv1r2.qcow2
&gt; &gt; -rw-r--r--. 1 qemu qemu 54200696832 Jun 30 10:40 /var/lib/libvirt/images/
&gt; serv1r2.qcow2
&gt; &gt; [root@vm1 ~]#
&gt;

[Attachment #3 (text/html)]

&lt;div dir="auto"&gt;Yes, I find it annoying that I have to manually remove the no-nos \
bless leftover snapshot file. That'd be a great feature. In the mean time I will \
look at adding this additional error handling in my script. Thanks much!&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;On Jun 30, 2017 10:55 AM, \
"Peter Krempa" &lt;&lt;a \
href="mailto:pkrempa@redhat.com"&gt;pkrempa@redhat.com&lt;/a&gt;&gt; wrote:&lt;br \
type="attribution"&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;On Fri, Jun 30, 2017 at 10:41:25 \
-0400, &lt;a href="mailto:doug.hughes@keystonenap.com"&gt;doug.hughes@keystonenap.com&lt;/a&gt; \
wrote:&lt;br&gt; &gt; sorry about top post, tablet mail client...&lt;br&gt;
&gt;&lt;br&gt;
&gt; brilliant! that did it! Any idea what happened to cause it to partially fail and \
get into this state?&lt;br&gt; &lt;br&gt;
virsh blockcommit --pivot is actually 3 operations in sequence:&lt;br&gt;
1) initiate the commit job&lt;br&gt;
2) wait till it finishes&lt;br&gt;
3) initiate the pivot job (this is synchronous, so the wait till it&lt;br&gt;
finises is itegrated in the API call)&lt;br&gt;
&lt;br&gt;
Apparently in your case the waiting part failed for some reason and thus&lt;br&gt;
the job was not finished, lingering in the synchronised state.&lt;br&gt;
&lt;br&gt;
The unfortunate part is that you don't know which operation failed.&lt;br&gt;
&lt;br&gt;
Unfortunately it does not seem that we have wa waiting version of 'virsh&lt;br&gt;
blockjob' that could be used to do the waiting. You can do the polling&lt;br&gt;
manualy though.&lt;br&gt;
&lt;br&gt;
The third operation can be split out by default, since you can specify&lt;br&gt;
--wait instead of --pivot for 'virsh blockcommit' and it will finish&lt;br&gt;
after step 2 above.&lt;br&gt;
&lt;br&gt;
Also one of the cases which would help is that libvirt could actually&lt;br&gt;
remove the file after commit, which would avoid the original problem,&lt;br&gt;
since the file would still be there.&lt;br&gt;
&lt;br&gt;
&gt; oot@vm1 ~]# virsh blockjob serv1r2 vda&lt;br&gt;
&gt; Active Block Commit: [100 %]&lt;br&gt;
&gt;&lt;br&gt;
&gt; [root@vm1 ~]# virsh blockjob --pivot serv1r2 vda&lt;br&gt;
&gt;&lt;br&gt;
&gt; [root@vm1 ~]#&lt;br&gt;
&gt; [root@vm1 ~]# ls -l /var/lib/libvirt/images/&lt;wbr&gt;serv1r2.qcow2&lt;br&gt;
&gt; -rw-r--r--. 1 qemu qemu 54200696832 Jun 30 10:39 \
/var/lib/libvirt/images/&lt;wbr&gt;serv1r2.qcow2&lt;br&gt; &gt; [root@vm1 ~]# date&lt;br&gt;
&gt; Fri Jun 30 10:39:12 EDT 2017&lt;br&gt;
&gt; [root@vm1 ~]# date&lt;br&gt;
&gt; Fri Jun 30 10:39:51 EDT 2017&lt;br&gt;
&gt; [root@vm1 ~]# ls -l /var/lib/libvirt/images/&lt;wbr&gt;serv1r2.qcow2&lt;br&gt;
&gt; -rw-r--r--. 1 qemu qemu 54200696832 Jun 30 10:40 \
/var/lib/libvirt/images/&lt;wbr&gt;serv1r2.qcow2&lt;br&gt; &gt; [root@vm1 ~]#&lt;br&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170630202441</emailId><senderName>Jędrek Domański</senderName><senderEmail>jedrek.domanski@gmail.com</senderEmail><timestampReceived>2017-06-30 20:24:41-0400</timestampReceived><subject>[libvirt-users] Ubuntu 16.04 libvirt-guests.sh [6917] - running guests under URI address default: no</subject><body>

Hi

I have recently upgraded from Ubuntu 15.04 to 16.04 and now everytime I
shutdown my PC I get a black screen where it says "libvirt-guests.sh [6917]
- running guests under URI address default: no running guests" and the PC
just hangs forever and will not shutdown. I need to manually kill it in
order to shut it down which is a pain in the ass. I have done some
investigation and here is what I've found out so far.

I have uninstalled libvirt, kvm and qemu:

sudo apt-get purge libvirt* kvm qemu*

The problem has gone, however I noticed some error messages at boot saying
something that "FAILED Qemu .... It flashes so quickly and I am not able to
read what exactly it says. I installed libvirt again:

sudo apt install qemu-kvm libvirt-bin

and the problem is back!

So is this script trying to shutdown my virtual machines? It looks like it
does but since it does not find any it hangs? I don't have any machines,
though. I used to have one, but I removed it. What is interesting, my PC
hangs at shutdown randomly, that is sometimes it hangs for like 15 seconds
and it shutsdown but in most cases it hangs forever. So this happens
randomly.

So, this investigation has brought me to you guys so please help me. I have
attached a screen (sorry for polish error message but the translation is in
the email title).

I have also posted a thread on AskUbuntu on this:

https://askubuntu.com/questions/925696/ubuntu-16-04-
libvirt-guests-sh-6917-running-guests-under-uri-address-default

Thank you,
J=C4=99drzej

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;Hi&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;I have recently upgraded from Ubuntu 15.04 to 16.04 and now \
everytime I shutdown my PC I get a black screen where it says "libvirt-guests.sh \
[6917] - running guests under URI address default: no running guests" and the PC \
just hangs forever and will not shutdown. I need to manually kill it in order to shut \
it down which is a pain in the ass. I have done some investigation and here is what \
I've found out so far.&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;I have uninstalled libvirt, kvm and qemu:&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;pre \
style="white-space:pre-wrap;margin-top:0px;margin-bottom:1em;padding:5px;border:0px;fo \
nt-variant-numeric:inherit;font-stretch:inherit;font-size:13px;line-height:inherit;font-family:Consolas,Menlo,Monaco,"Lucida \
Console","Liberation Mono","DejaVu Sans \
Mono","Bitstream Vera Sans Mono","Courier \
New",monospace,sans-serif;vertical-align:baseline;width:auto;max-height:600px;ove \
rflow:auto;background-color:rgb(239,240,241);word-wrap:normal;color:rgb(17,17,17)"&gt;&lt;code \
style="margin:0px;padding:0px;border:0px;font-style:inherit;font-variant:inherit;font- \
weight:inherit;font-stretch:inherit;line-height:inherit;font-family:Consolas,Menlo,Monaco,"Lucida \
Console","Liberation Mono","DejaVu Sans \
Mono","Bitstream Vera Sans Mono","Courier \
New",monospace,sans-serif;vertical-align:baseline;white-space:inherit"&gt;sudo \
apt-get purge libvirt* kvm qemu*&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;The problem has gone, however I noticed some error messages \
at boot saying something that "FAILED Qemu .... It flashes so quickly and I am \
not able to read what exactly it says. I installed libvirt again:&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;pre class="gmail-m_-849249386569305750gmail-contents" \
style="white-space:pre-wrap;margin-top:0px;margin-bottom:8px;padding:0.5em \
1em;border:1px dashed \
rgb(193,180,150);font-size:13px;line-height:16px;font-family:UbuntuMono,courier,monosp \
ace;vertical-align:baseline;background-color:rgb(243,243,243);word-wrap:break-word;color:rgb(51,51,51)"&gt;&lt;span \
class="gmail-m_-849249386569305750gmail-cmd gmail-m_-849249386569305750gmail-command" \
style="margin:0px;padding:0px;border:0px;font-weight:inherit;font-style:inherit;line-h \
eight:1.5;font-family:monospace;vertical-align:baseline;background-color:rgb(242,242,242)"&gt;sudo \
apt install qemu-kvm libvirt-bin&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;and the problem is back!&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;So is this script trying to shutdown my virtual machines? It \
looks like it does but since it does not find any it hangs? I don't have any \
machines, though. I used to have one, but I removed it. What is interesting, my PC \
hangs at shutdown randomly, that is sometimes it hangs for like 15 seconds and it \
shutsdown but in most cases it hangs forever. So this happens randomly.&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;So, this investigation has brought me to you guys so please \
help me. I have attached a screen (sorry for polish error message but the translation \
is in the email title).&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-size:12.8px"&gt;I have also posted a thread on AskUbuntu on this:&lt;/div&gt;&lt;div \
class="gmail_default" style="font-size:12.8px"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;a href="https://askubuntu.com/questions/925696/ubuntu-16-04-libvirt-guests-sh-6917-runni" \
target="_blank"&gt;https://askubuntu.com/&lt;wbr&gt;questions/925696/ubuntu-16-04-&lt;wbr&gt;libvirt-guests-sh-6917-runni&lt;/a&gt;&lt;/font&gt;&lt;span \
style="font-family:arial,helvetica,sans-serif"&gt;ng&lt;wbr&gt;-guests-under-uri-address-&lt;wbr&gt;default&lt;/span&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;span \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font \
face="arial, helvetica, sans-serif"&gt;Thank you,&lt;/font&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,sans-serif;font-size:12.8px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;Jędrzej&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170502125812</emailId><senderName>Daniel Pocock</senderName><senderEmail>daniel@pocock.pro</senderEmail><timestampReceived>2017-05-02 12:58:12-0400</timestampReceived><subject>Re: [libvirt-users] building virtual desktops with libvirt, KVM, SPICE and GNOME</subject><body>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256



On 20/03/17 08:37, Martin Kletzander wrote:
&gt; On Wed, Mar 15, 2017 at 10:26:20AM +0000, Daniel Pocock wrote:
&gt;&gt; 
&gt;&gt; Can anybody comment on how to host virtual desktops on a headless
&gt;&gt; server using libvirt and KVM on the server and a SPICE client to
&gt;&gt; access the virtual desktop?  Is there a standard way of doing
&gt;&gt; this?
&gt;&gt; 
&gt;&gt; I've seen many fragments of information about how to do this but
&gt;&gt; I didn't come across a single guide describing the entire
&gt;&gt; solution. Search engines also return a lot of information about
&gt;&gt; gaining remote access to a real physical desktop but that is not
&gt;&gt; what I'm looking for. I've also come across many real-world
&gt;&gt; scenarios where people are manually starting VNC server processes
&gt;&gt; for each user on different ports but I was hoping to find out if
&gt;&gt; there is a more standard way of doing this now.
&gt;&gt; 
&gt;&gt; When I say "virtual desktop", the type of user experience I'm
&gt;&gt; thinking about is that named users can run a SPICE client
&gt;&gt; anywhere and always connect to the same host/desktop.  E.g. if
&gt;&gt; they leave some windows open, disconnect, go to another physical
&gt;&gt; machine and reconnect with the same username they will see the
&gt;&gt; same desktop with the same windows open.
&gt;&gt; 
&gt; 
&gt; How is it different to just having VM per user on that host and
&gt; having people connect to their VMs (using TLS and passwords, for
&gt; example, just to make sure).  Each VM will have its own spice (or
&gt; VNC) server and users can connect to them either directly (if there
&gt; is access and open ports etc.) or through libvirt (if they are
&gt; not).  If latter is the case, you can use ACLs to restrict
&gt; particular users to connect only to their machines.
&gt; 

That would be one solution - is there any standard solution to manage
the ACLs and to route each user's connection to the right machine
without asking each user to remember their machine name?

Is there a way to do this where multiple users are concurrently logged
in to the same virtual server, similar to different XDMCP sessions
started on the same server for different X users?

Regards,

Daniel
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2

iQIcBAEBCAAGBQJZCIJkAAoJEGxlgOd711bE6gUQALGT7dxFUWtYmKuf3/5eBLAG
CTwsTTEN69a8DNp8QNN/q1HtXRjmSCvltcCYfVYOtDlAPSvW/oHoQ2jsoa9k4CY2
YwUN10ChUILicb6braRycFwC2Ff+iA3eME3ncRjwuN9huqszyilLlqU3uAg2+xD2
yfOazAW8pta/cg6Fom41D0IC9I5HXBJLn4AOO0Sbj1eOrSGpIdZYabtKRkMSafJO
/0fuOFvYpWQ4+oMqQEICRthu+xF6fbey25hnD3TUJgCW2zM5s4a2oPZdjiFvGtw6
c5uzDcX5Uc0UlcGIKzoT2FvvgTyKkGOae9MXaZSzFXHCTPua3JZYeGcWFAYjTvqQ
934e2/WEnsEFcMaQmySeIHw/ZDxC/CMJzGzyIOr+rEuExezsJMyeXHwk+z6TGoXN
CryrApnZB+0Qye6NqdCL+7o/q0W/gxQaGUSlwp4Fjmt62ecgNPlMfq4qndASOpq3
GlSFGuVvz9yFLKkejbAgcT1+cJ3pnI2wdozUmi+nOj9ygdvVdqw0+OMQj0qmQwL1
zjRpCJnz/Algv9w8LRfo9FamUxafo2EFq3HgmMqZf28cc91H+0ekfumOuR4jK0cu
FfZCDvKm5XWs45KYknzsBsCQVMP3DyOj3J7hAElkgrGwIE8tdwrlfaS/m/U3MNtB
C3XU90VUrSsb+o0Nor+H
=b7NO
-----END PGP SIGNATURE-----

</body></email><email><emailId>20170504092339</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-05-04 09:23:39-0400</timestampReceived><subject>Re: [libvirt-users] Libvirtd freezes</subject><body>

On 05/04/2017 11:20 AM, Stefano Ricci wrote:
&gt; 2017-05-03 8:56 GMT+02:00 Michal Privoznik &lt;mprivozn@redhat.com&gt;:
&gt; &gt; On 05/01/2017 09:57 AM, Stefano Ricci wrote:
&gt; &gt; &gt; 2017-05-01 7:32 GMT+02:00 Michal Privoznik &lt;mprivozn@redhat.com&gt;:
&gt; &gt; &gt; &gt; On 04/30/2017 07:12 PM, Stefano Ricci wrote:
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; The version used for backtrace is 3.2.0, now I have also tried the
&gt; &gt; &gt; &gt; &gt; current downloaded with git but the problem is always present.
&gt; &gt; &gt; &gt; &gt; This is the current version log file, set as shown on the DebugLogs page:
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; https://drive.google.com/open?id=0By9lwQyveHENdEt4aEtZcUV3ZEU
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Couple of my findings:
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 2017-04-30 16:19:34.894+0000: 870: debug : virDriverLoadModuleFile:49 : Load \
&gt; &gt; &gt; &gt; module file '/usr/lib/libvirt/storage-backend/libvirt_storage_backend_rbd.so' \
&gt; &gt; &gt; &gt; 2017-04-30 16:19:35.324+0000: 870: debug : virDriverLoadModuleFunc:71 : \
&gt; &gt; &gt; &gt; Lookup function 'virStorageBackendRBDRegister' 
&gt; &gt; &gt; &gt; it takes nearly .5s to load libvirt_storage_backend_rbd.so
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; But apart from that there is nothing unusual in the logs. So how do you \
&gt; &gt; &gt; &gt; observe the hang? How long it is anyway - assuming it goes away after some \
&gt; &gt; &gt; &gt; time. Or does it hang indefinitely? 
&gt; &gt; &gt; &gt; BTW: is this all the debug messages you have? Because in there, the last line \
&gt; &gt; &gt; &gt; is how libvirtd starts qemu-system-x86_64 in order to fetch its capabilities. \
&gt; &gt; &gt; &gt; I'd expect libvirt setting qmp_capabilities on the monitor at least. 
&gt; &gt; &gt; &gt; Michal
&gt; &gt; &gt; 
&gt; &gt; &gt; Virtlib logs end in the way you see, only when i kill the qemu process
&gt; &gt; &gt; then it starts logging and it is possible to connect remotely with
&gt; &gt; &gt; virsh.
&gt; &gt; 
&gt; &gt; I see. There's nothing suspicious in the logs. The fact that libvirt
&gt; &gt; waits for qemu suggests that qemu did not go daemon. I mean, we pass
&gt; &gt; -daemonize to qemu, but that doesn't work. I wonder if we cannot do what
&gt; &gt; we are doing usually when spawning qemu processes: fork() + exec()
&gt; &gt; instead of relying on -daemonize which is broken.
&gt; &gt; 
&gt; &gt; BTW: you can verify that qemu did not deamonize itself by consulting the
&gt; &gt; libvirtd log:
&gt; &gt; 
&gt; &gt; 2017-04-30 16:19:36.633+0000: 886: debug : virCommandRunAsync:2451 :
&gt; &gt; Command result 0, with PID 962
&gt; &gt; 
&gt; &gt; This means, that PID 962 is qemu. However, when going daemon double fork
&gt; &gt; is needed, therefore 'pgrep qemu' should print different number than
&gt; &gt; 962. But I guess it doesn't, does it?
&gt; &gt; 
&gt; &gt; Michal
&gt; 
&gt; Fixed, the problem was qemu with the device (I saw that in certain
&gt; conditions there was segmentation fault)), I recompiled with the
&gt; correct configuration and now everything works, thanks for the
&gt; availability, patience shown.
&gt; Thanks again.

You're very welcome. Thanks to this discussion happened on the list we
now have this information available for others. Should they ever run
into the same problem, they know how to fix it.

Michal


</body></email><email><emailId>20170502041259</emailId><senderName>chihhang wu</senderName><senderEmail>chihhangw@gmail.com</senderEmail><timestampReceived>2017-05-02 04:12:59-0400</timestampReceived><subject>[libvirt-users] virsh snapshot delete / live-migration issues</subject><body>

Hi,

I'd like to live-migration after snapshots deleted.

But it doesn't work.Here's my steps:

# virsh snapshot-create VM
# virsh snapshot-delete VM Snapshot
# virsh migrate --live VM qemu+ssh://localadmin@compute3/system

And  It comes out this message:

# internal error: unable to execute QEMU command
'migrate-set-capabilities': There's a migration process in progress

Even I create a no-metadata snapshot, it still have same error.

After I reboot the VM, the live-migration finally works.

Does it has any suggestion way or command to solve this problem without
reboot the VM?

Here's my environment:

Ubuntu 14.04.5 LTS
Compiled against library: libvirt 1.3.1
Using library: libvirt 1.3.1
Using API: QEMU 1.3.1
Running hypervisor: QEMU 2.5.0

Best regards,

Chihhang Wu

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;font face="arial, helvetica, sans-serif"&gt;Hi,&lt;/font&gt;&lt;div&gt;&lt;font \
face="arial, helvetica, sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, \
helvetica, sans-serif"&gt;I'd like to live-migration after snapshots \
deleted.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, sans-serif"&gt;But it \
doesn't work.Here's my steps:&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, sans-serif"&gt;# virsh \
snapshot-create VM&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, sans-serif"&gt;# virsh \
snapshot-delete VM Snapshot&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;# virsh migrate --live VM qemu+ssh://localadmin@compute3/system  \
&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font face="arial, helvetica, sans-serif"&gt;And  \
It comes out this message:&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, sans-serif"&gt;# \
internal error: unable to execute QEMU command 'migrate-set-capabilities': \
There's a migration process in progress&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, \
helvetica, sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;Even I create a no-metadata snapshot, it still have same \
error.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, sans-serif"&gt;After I \
reboot the VM, the live-migration finally works.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, \
helvetica, sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;Does it has any suggestion way or command to solve this problem without \
reboot the VM?&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;Here's my environment:&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, sans-serif"&gt;Ubuntu \
14.04.5 LTS&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;div&gt;Compiled against library: libvirt 1.3.1&lt;/div&gt;&lt;div&gt;Using library: \
libvirt 1.3.1&lt;/div&gt;&lt;div&gt;Using API: QEMU 1.3.1&lt;/div&gt;&lt;div&gt;Running hypervisor: QEMU \
2.5.0&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Best regards,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Chihhang \
Wu&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170505202930</emailId><senderName>Nicolas Bock</senderName><senderEmail>nicolasbock@gmail.com</senderEmail><timestampReceived>2017-05-05 20:29:30-0400</timestampReceived><subject>[libvirt-users] nwfilter and address of network ip address</subject><body>

Hi,

I am running a webserver on the libvirt host and would like to add 
a nwfilter such that a VM can access that server. The 
corresponding iptables rule would look like this:

iptables --append INPUT --in-interface virbr0 --destination 192.168.122.1 --protocol \
tcp --dport 80 --jump ACCEPT

where the network is using virbr0 and sits at 192.168.122.1. I 
don't want to hardcode the host IP address in the nwfilter so that 
I can use that filter for other networks. Is it possible to 
reference the host's IP address in the filter?

Thanks!

Nick


</body></email><email><emailId>20170507193717</emailId><senderName>Vasiliy Tolstov</senderName><senderEmail>v.tolstov@selfip.ru</senderEmail><timestampReceived>2017-05-07 19:37:17-0400</timestampReceived><subject>[libvirt-users] strange error while trying to start ~60 domains</subject><body>

Hi! I'm using latest libvirt release under debian jessie (kernel 4.4.x LTS)
And after i'm try to start 65 domains i get 19 errors like:

May 07 22:32:28 cn17 libvirtd[13836]: 2017-05-07 19:32:28.188+0000:
13839: error : virDBusCall:1570 : error from service: CreateMachine:
Message did not receive a reply (timeout by message bus)

I'm use qcow2 file as vm images on ssd disk with dir storage pool
(local ssd disks).


-- 
Vasiliy Tolstov,
e-mail: v.tolstov@selfip.ru

</body></email><email><emailId>20170512090220</emailId><senderName>Sławomir Kapłoński</senderName><senderEmail>slawek@kaplonski.pl</senderEmail><timestampReceived>2017-05-12 09:02:20-0400</timestampReceived><subject>[libvirt-users] Poor network performance</subject><body>

Hello,

I have some problem with poor network performance on libvirt with qemu and \
openvswitch. I'm using libvirt 1.3.1, qemu 2.5 and openvswitch 2.6.0 on Ubuntu 16.04 \
currently. My connection diagram looks like below:

                                                                                \
                +---------------------------+
                               +---------------------------+                    |     \
Net namespace     | +------------------+           |        OVS bridge         |      \
|                           | |                  |           |                        \
|                    |                           | |        VM        |           |   \
|                    |                           | |                  |      \
+----+---+                  +----+-----+         +----+---+                       | | \
+------+tap dev |                  |  veth A  +---------+ veth B |                    \
| |                  |      +--------+                  +----------+         \
+--------+                       | |    iperf \
-s&lt;---------------------------------------------------------------------------+iperf \
-c          | |                  |           |                           |            \
|                           | +------------------+           |                        \
                |                    |                           |
                               |                           |                    |     \
                |
                               +---------------------------+                    \
+---------------------------+



I haven't got any QoS in tc configured on any interface. When I do this iperf test I \
have something about 150Mbps only. IMHO it should be something about 20-30 Gbps \
there.

Other strange thing is that if I made more such VMS (each connected in same way, with \
own OVS bridge and own namespace) bandwidth is lower for each of them and it looks \
for me that summarize bandwidth is then something about 1Gbps (30 VMs - each got \
something about 30Mbps in such test).

When I removed VM and added „tap dev" as internal port in OVS and made same test, \
then I had result about 30 Gbps. I have no idea what can be wrong there. Maybe \
someone of You had such problems earlier?

One more thing, on different host with Ubuntu 14.04, OVS 2.0.2, Libvirt 1.3.1 and \
qemu 2.3 I don't have this problem. Kernel on both hosts is 4.4.0 (from Ubuntu repo).


Pozdrawiam / Best regards
Sławek Kapłoński
slawek@kaplonski.pl


</body></email><email><emailId>20170517130823</emailId><senderName>Daniel_Kučera</senderName><senderEmail>libvirt@danman.eu</senderEmail><timestampReceived>2017-05-17 13:08:23-0400</timestampReceived><subject>[libvirt-users] Callback re-registration after libvirtd restart</subject><body>

Hi all,

I'm using libvirt-go and I following code to listen for lifecycle events:

func event_listen() {
    log.Printf("event_listen %s", conf.Libvirt.LocalUrl)
    hv, err := libvirt.NewConnect(conf.Libvirt.LocalUrl)

    lifecycleCallback := func(c *libvirt.Connect, d *libvirt.Domain, event
*libvirt.DomainEventLifecycle) {
        event_message(c, d, "lifecycle", event)
    }

    _, err = hv.DomainEventLifecycleRegister(nil, lifecycleCallback)
    if err != nil {
        log.Printf("unable to register event callback")
        return
    }

    log.Printf("Libvirt event listener started")

    go func() {
        for err == nil {
            err = libvirt.EventRunDefaultImpl()
            log.Printf("EventRunDefaultImpl err: %+v", err)
        }
        time.Sleep(time.Second)
        event_listen()
    }()

}

It works ok until I restart libvirtd (service libvirtd restart). After
that, the inner go func waits some time and continues without error. But
the callback is not working anymore.

My question is, how can I detect hv reconnect (I guess it's happening in
background) so I know when to reinitialize callbacks?

Thanks.

BR
Daniel Kucera.

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi all,&lt;br&gt;&lt;div&gt;&lt;br&gt;I'm using libvirt-go and I following code to \
listen for lifecycle events:&lt;br&gt;&lt;br&gt;func event_listen() {&lt;br&gt;       \
log.Printf("event_listen %s", conf.Libvirt.LocalUrl)&lt;br&gt;       hv, err := \
libvirt.NewConnect(conf.Libvirt.LocalUrl)&lt;br&gt;&lt;br&gt;       lifecycleCallback := func(c \
*libvirt.Connect, d *libvirt.Domain, event *libvirt.DomainEventLifecycle) {&lt;br&gt;       \
event_message(c, d, "lifecycle", event)&lt;br&gt;       }&lt;br&gt;&lt;br&gt;       _, err = \
hv.DomainEventLifecycleRegister(nil, lifecycleCallback)&lt;br&gt;       if err != nil {&lt;br&gt; \
log.Printf("unable to register event callback")&lt;br&gt;              return&lt;br&gt; \
}&lt;br&gt;&lt;br&gt;       log.Printf("Libvirt event listener started")&lt;br&gt;&lt;br&gt;       \
go func() {&lt;br&gt;              for err == nil {&lt;br&gt;                     err = \
libvirt.EventRunDefaultImpl()&lt;br&gt;                     \
log.Printf("EventRunDefaultImpl err: %+v", err)&lt;br&gt;              }&lt;br&gt;      \
time.Sleep(time.Second)&lt;br&gt;              event_listen()&lt;br&gt;       \
}()&lt;br&gt;&lt;br&gt;}&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It works ok until I restart libvirtd (service libvirtd \
restart). After that, the inner go func waits some time and continues without error. \
But the callback is not working anymore.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My question is, how can I \
detect hv reconnect (I guess it's happening in background) so I know when to \
reinitialize callbacks?&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks. \
&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;BR&lt;br&gt;&lt;/div&gt;&lt;div&gt;Daniel Kucera.&lt;br&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170516184105</emailId><senderName>"Innus, Martins"</senderName><senderEmail>minnus@buffalo.edu</senderEmail><timestampReceived>2017-05-16 18:41:05-0400</timestampReceived><subject>[libvirt-users] Duplicate reboot events</subject><body>

[Attachment #2 (text/plain)]

Hi,

Running on:

$ cat /etc/redhat-release
CentOS Linux release 7.3.1611 (Core)

And:

$ rpm -qa |grep libvirt
libvirt-daemon-2.0.0-10.el7_3.5.x86_64
libvirt-daemon-driver-qemu-2.0.0-10.el7_3.5.x86_64
libvirt-daemon-driver-secret-2.0.0-10.el7_3.5.x86_64
libvirt-client-2.0.0-10.el7_3.5.x86_64
libvirt-daemon-driver-network-2.0.0-10.el7_3.5.x86_64
libvirt-daemon-driver-storage-2.0.0-10.el7_3.5.x86_64
libvirt-daemon-config-nwfilter-2.0.0-10.el7_3.5.x86_64
libvirt-daemon-config-network-2.0.0-10.el7_3.5.x86_64
libvirt-daemon-driver-nodedev-2.0.0-10.el7_3.5.x86_64
libvirt-2.0.0-10.el7_3.5.x86_64
libvirt-python-2.0.0-2.el7.x86_64
libvirt-daemon-driver-nwfilter-2.0.0-10.el7_3.5.x86_64
libvirt-daemon-driver-lxc-2.0.0-10.el7_3.5.x86_64
libvirt-daemon-driver-interface-2.0.0-10.el7_3.5.x86_64

I'm seeing duplicated reboot events when using the python event api.  Use is \
simplified down to the simple test case attached.  Running with that results in:

$ sudo ./libvirt_events_single.py
Reboot: Domain i-06945b37(21)
1494958504.72
Reboot: Domain i-06945b37(21)
1494958504.74

This is reproducible 100% of the time by doing /sbin/reboot from within a VM started \
with qemu-kvm.  Any ideas on whats going on?

Let me know if any other information would be useful.

Thanks

Martins


["libvirt_events_single.py" (text/x-python-script)]

#!/usr/bin/env python

import libvirt
import time

def RBcallback(conn, dom, opaque):
    print "Reboot: Domain %s(%s)" % (dom.name(), dom.ID())
    print time.time()

if __name__ == '__main__':

    libvirt.virEventRegisterDefaultImpl()

    conn = libvirt.openReadOnly('qemu:///system')

    conn.domainEventRegisterAny(None, libvirt.VIR_DOMAIN_EVENT_ID_REBOOT, RBcallback, None)

    while True:
        libvirt.virEventRunDefaultImpl()


</body></email><email><emailId>20170519042348</emailId><senderName>Jlozada2426</senderName><senderEmail>jlozada2426@protonmail.com</senderEmail><timestampReceived>2017-05-19 04:23:48-0400</timestampReceived><subject>[libvirt-users] Access to the wiki</subject><body>

[Attachment #2 (text/plain)]

Hello,

I was wondering if I could get access to the wiki. I want to contribute and help out.

Jonathan Lozada De La Matta
Linux System Administrator
ask.sysadminonlinux.org

Sent with [ProtonMail](https://protonmail.com) Secure Email.
[Attachment #3 (text/html)]

&lt;div&gt;Hello,&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I was wondering if I could get access to the \
wiki. I want to contribute and help out.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="protonmail_signature_block "&gt;&lt;div class="protonmail_signature_block-user \
"&gt;&lt;div&gt;Jonathan Lozada De La Matta&lt;br&gt;&lt;/div&gt;&lt;div&gt;Linux System \
Administrator&lt;br&gt;&lt;/div&gt;&lt;div&gt;ask.sysadminonlinux.org&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="protonmail_signature_block-proton "&gt;Sent with &lt;a \
href="https://protonmail.com"&gt;ProtonMail&lt;/a&gt; Secure Email.&lt;br&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170519092804</emailId><senderName>Michael_Ströder</senderName><senderEmail>michael@stroeder.com</senderEmail><timestampReceived>2017-05-19 09:28:04-0400</timestampReceived><subject>[libvirt-users] disabling dnsmasq</subject><body>


HI!

I have some virtual networks (not only bridged) in my libvirt 3.3.0 insta=
llation and
therefore libvirt always starts dnsmasq. But I want to use my own DHCP an=
d DNS servers
which are correctly working for this VM infrastructure.

How to completely disable dnsmasq in libvirt?

Ciao, Michael.


["smime.p7s" (application/pkcs7-signature)]

</body></email><email><emailId>20170523000321</emailId><senderName>W Kern</senderName><senderEmail>wkern@pixelgate.net</senderEmail><timestampReceived>2017-05-23 00:03:21-0400</timestampReceived><subject>[libvirt-users] Odd Virsh Capabilities response</subject><body>

Tried to migrate a few VMs from existing system to an older host that we 
threw in the rack to facilitate some server reshuffling.

Migration complained about lack of capabilities (which I expected its an 
older server) but when I looked at what I should throw into the xml file 
I got a core2duo when it should have been at least Penryn or something 
(Xeon E5345)

Of course the VMs work fine with that cpu def so its not a bit deal at 
the moment, but I am still curious

Is it some sort of lookup table bug or is the server BIOS wonky?

-----------------------------------------------------------

OS: Up to date U16 Xenial on an HP DL380 server.

Stock libraries for that distro

libvirt0/xenial-updates,now 1.3.1-1ubuntu10.8 amd64 [installed,automatic]

qemu-kvm/xenial-updates,xenial-security,now 1:2.5+dfsg-5ubuntu10.14 
amd64 [installed,automatic]
   QEMU Full virtualization

cat /proc/cpu shows

processor       : 7
vendor_id       : GenuineIntel
cpu family      : 6
model           : 15
model name      : Intel(R) Xeon(R) CPU           E5345  @ 2.33GHz
stepping        : 11
microcode       : 0xb4
cpu MHz         : 2333.361

# virsh capabilities

&lt;capabilities&gt;

   &lt;host&gt;
     &lt;uuid&gt;33393138-3335-5553-4538-31324e39414b&lt;/uuid&gt;
     &lt;cpu&gt;
       &lt;arch&gt;x86_64&lt;/arch&gt;
       &lt;model&gt;core2duo&lt;/model&gt;
       &lt;vendor&gt;Intel&lt;/vendor&gt;
       &lt;topology sockets='2' cores='4' threads='1'/&gt;
       &lt;feature name='lahf_lm'/&gt;
       &lt;feature name='dca'/&gt;
       &lt;feature name='pdcm'/&gt;
       &lt;feature name='xtpr'/&gt;
       &lt;feature name='cx16'/&gt;
       &lt;feature name='tm2'/&gt;
       &lt;feature name='est'/&gt;
       &lt;feature name='vmx'/&gt;
       &lt;feature name='ds_cpl'/&gt;
       &lt;feature name='dtes64'/&gt;
       &lt;feature name='pbe'/&gt;
       &lt;feature name='tm'/&gt;
       &lt;feature name='ht'/&gt;
       &lt;feature name='ss'/&gt;
       &lt;feature name='acpi'/&gt;
       &lt;feature name='ds'/&gt;
       &lt;pages unit='KiB' size='4'/&gt;
       &lt;pages unit='KiB' size='2048'/&gt;
     &lt;/cpu&gt;
     &lt;power_management&gt;
       &lt;suspend_mem/&gt;
       &lt;suspend_disk/&gt;
       &lt;suspend_hybrid/&gt;
     &lt;/power_management&gt;
     &lt;migration_features&gt;
       &lt;live/&gt;
       &lt;uri_transports&gt;
         &lt;uri_transport&gt;tcp&lt;/uri_transport&gt;
         &lt;uri_transport&gt;rdma&lt;/uri_transport&gt;
       &lt;/uri_transports&gt;
     &lt;/migration_features&gt;
     &lt;topology&gt;
       &lt;cells num='1'&gt;
         &lt;cell id='0'&gt;
           &lt;memory unit='KiB'&gt;32945368&lt;/memory&gt;
           &lt;pages unit='KiB' size='4'&gt;8236342&lt;/pages&gt;
           &lt;pages unit='KiB' size='2048'&gt;0&lt;/pages&gt;
           &lt;distances&gt;
             &lt;sibling id='0' value='10'/&gt;
           &lt;/distances&gt;
           &lt;cpus num='8'&gt;
             &lt;cpu id='0' socket_id='0' core_id='0' siblings='0'/&gt;
             &lt;cpu id='1' socket_id='1' core_id='0' siblings='1'/&gt;
             &lt;cpu id='2' socket_id='0' core_id='2' siblings='2'/&gt;
             &lt;cpu id='3' socket_id='1' core_id='2' siblings='3'/&gt;
             &lt;cpu id='4' socket_id='0' core_id='1' siblings='4'/&gt;
             &lt;cpu id='5' socket_id='1' core_id='1' siblings='5'/&gt;
             &lt;cpu id='6' socket_id='0' core_id='3' siblings='6'/&gt;
             &lt;cpu id='7' socket_id='1' core_id='3' siblings='7'/&gt;
           &lt;/cpus&gt;
         &lt;/cell&gt;
       &lt;/cells&gt;
     &lt;/topology&gt;



</body></email><email><emailId>20170523083919</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-05-23 08:39:19-0400</timestampReceived><subject>Re: [libvirt-users] Odd Virsh Capabilities response</subject><body>


On Mon, May 22, 2017 at 05:03:21PM -0700, W Kern wrote:
&gt;Tried to migrate a few VMs from existing system to an older host that we
&gt;threw in the rack to facilitate some server reshuffling.
&gt;
&gt;Migration complained about lack of capabilities (which I expected its an
&gt;older server) but when I looked at what I should throw into the xml file
&gt;I got a core2duo when it should have been at least Penryn or something
&gt;(Xeon E5345)
&gt;

According to wikipedia:

  https://en.wikipedia.org/wiki/Xeon#5300-series_.22Clovertown.22

the microarchitecture is Core, not anything newer.

Looking at the capabilities, it could also be Conroe, it even has the
same family and model.  But it has the same number of matching features
for botha nd core2duo is older so it's closer to the start of the list.

There was some refactoring of the CPU matching, but that's not going to
be in a libvirt released 1 year and 4 months ago.  Currently it should
tell you 'Conroe' with the latest release (3.3.0), IIUC.

However it's worth noting that this is just a string in an XML.  There
is no functionality depending on that model name.

&gt;Of course the VMs work fine with that cpu def so its not a bit deal at
&gt;the moment, but I am still curious
&gt;
&gt;Is it some sort of lookup table bug or is the server BIOS wonky?
&gt;
&gt;-----------------------------------------------------------
&gt;
&gt;OS: Up to date U16 Xenial on an HP DL380 server.
&gt;
&gt;Stock libraries for that distro
&gt;
&gt;libvirt0/xenial-updates,now 1.3.1-1ubuntu10.8 amd64 [installed,automatic]
&gt;
&gt;qemu-kvm/xenial-updates,xenial-security,now 1:2.5+dfsg-5ubuntu10.14
&gt;amd64 [installed,automatic]
&gt;   QEMU Full virtualization
&gt;
&gt;cat /proc/cpu shows
&gt;
&gt;processor       : 7
&gt;vendor_id       : GenuineIntel
&gt;cpu family      : 6
&gt;model           : 15
&gt;model name      : Intel(R) Xeon(R) CPU           E5345  @ 2.33GHz
&gt;stepping        : 11
&gt;microcode       : 0xb4
&gt;cpu MHz         : 2333.361
&gt;
&gt;# virsh capabilities
&gt;
&gt;&lt;capabilities&gt;
&gt;
&gt;   &lt;host&gt;
&gt;     &lt;uuid&gt;33393138-3335-5553-4538-31324e39414b&lt;/uuid&gt;
&gt;     &lt;cpu&gt;
&gt;       &lt;arch&gt;x86_64&lt;/arch&gt;
&gt;       &lt;model&gt;core2duo&lt;/model&gt;
&gt;       &lt;vendor&gt;Intel&lt;/vendor&gt;
&gt;       &lt;topology sockets='2' cores='4' threads='1'/&gt;
&gt;       &lt;feature name='lahf_lm'/&gt;
&gt;       &lt;feature name='dca'/&gt;
&gt;       &lt;feature name='pdcm'/&gt;
&gt;       &lt;feature name='xtpr'/&gt;
&gt;       &lt;feature name='cx16'/&gt;
&gt;       &lt;feature name='tm2'/&gt;
&gt;       &lt;feature name='est'/&gt;
&gt;       &lt;feature name='vmx'/&gt;
&gt;       &lt;feature name='ds_cpl'/&gt;
&gt;       &lt;feature name='dtes64'/&gt;
&gt;       &lt;feature name='pbe'/&gt;
&gt;       &lt;feature name='tm'/&gt;
&gt;       &lt;feature name='ht'/&gt;
&gt;       &lt;feature name='ss'/&gt;
&gt;       &lt;feature name='acpi'/&gt;
&gt;       &lt;feature name='ds'/&gt;
&gt;       &lt;pages unit='KiB' size='4'/&gt;
&gt;       &lt;pages unit='KiB' size='2048'/&gt;
&gt;     &lt;/cpu&gt;
&gt;     &lt;power_management&gt;
&gt;       &lt;suspend_mem/&gt;
&gt;       &lt;suspend_disk/&gt;
&gt;       &lt;suspend_hybrid/&gt;
&gt;     &lt;/power_management&gt;
&gt;     &lt;migration_features&gt;
&gt;       &lt;live/&gt;
&gt;       &lt;uri_transports&gt;
&gt;         &lt;uri_transport&gt;tcp&lt;/uri_transport&gt;
&gt;         &lt;uri_transport&gt;rdma&lt;/uri_transport&gt;
&gt;       &lt;/uri_transports&gt;
&gt;     &lt;/migration_features&gt;
&gt;     &lt;topology&gt;
&gt;       &lt;cells num='1'&gt;
&gt;         &lt;cell id='0'&gt;
&gt;           &lt;memory unit='KiB'&gt;32945368&lt;/memory&gt;
&gt;           &lt;pages unit='KiB' size='4'&gt;8236342&lt;/pages&gt;
&gt;           &lt;pages unit='KiB' size='2048'&gt;0&lt;/pages&gt;
&gt;           &lt;distances&gt;
&gt;             &lt;sibling id='0' value='10'/&gt;
&gt;           &lt;/distances&gt;
&gt;           &lt;cpus num='8'&gt;
&gt;             &lt;cpu id='0' socket_id='0' core_id='0' siblings='0'/&gt;
&gt;             &lt;cpu id='1' socket_id='1' core_id='0' siblings='1'/&gt;
&gt;             &lt;cpu id='2' socket_id='0' core_id='2' siblings='2'/&gt;
&gt;             &lt;cpu id='3' socket_id='1' core_id='2' siblings='3'/&gt;
&gt;             &lt;cpu id='4' socket_id='0' core_id='1' siblings='4'/&gt;
&gt;             &lt;cpu id='5' socket_id='1' core_id='1' siblings='5'/&gt;
&gt;             &lt;cpu id='6' socket_id='0' core_id='3' siblings='6'/&gt;
&gt;             &lt;cpu id='7' socket_id='1' core_id='3' siblings='7'/&gt;
&gt;           &lt;/cpus&gt;
&gt;         &lt;/cell&gt;
&gt;       &lt;/cells&gt;
&gt;     &lt;/topology&gt;
&gt;
&gt;
&gt;
&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170524134033</emailId><senderName>Roman Storozhenko</senderName><senderEmail>romeusmeister@gmail.com</senderEmail><timestampReceived>2017-05-24 13:40:33-0400</timestampReceived><subject>[libvirt-users] How to set guest console size in libvirt configuration options?</subject><body>

Hello, everybody

I use virsh to run my VM and QEMU as a hypervisor. 
When I connect to it, it shows me a console with a some predefined size.
I know that I am able to update grub configuration to pass the correct
size as a kernel command line option or use stty something like:

stty rows 62 cols 213

and it's resizes correctly.

But is there any way to define the console's size  outside the guest, in
the VM's configuration?





---
Thanks in advance,
Roman Storozhenko

</body></email><email><emailId>20170516082807</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-05-16 08:28:07-0400</timestampReceived><subject>Re: [libvirt-users] No way to stop virStream error after guest stop</subject><body>


On Fri, Apr 28, 2017 at 11:01:18PM +0000, Jos=C9 Luis Valencia Gutierrez wr=
ote:
&gt;Hello everyone,
&gt;I am opening a virChannel(unix) to a domain and receiving data with a
&gt;non-blocking virStream using events, when the connected domain gets
&gt;stopped(which deletes the channel unix socket) by calling destroy,
&gt;shutdown, pause or migrate on that domain, with the stream open the read
&gt;event is triggered repeatedly, and virStreamRecv returns 0 bytes indicating
&gt; EOF but neither  virStreamFinish nor virStreamFinish is working to stop
&gt;the stream to trigger the event . Each time the event is called I got this
&gt;errors.
&gt;
&gt;libvirt: I/O Stream Utils error : this function is not supported by
&gt;the connection driver: virStreamRecv
&gt;
&gt;libvirt: I/O Stream Utils error : this function is not supported by
&gt;the connection driver: virStreamFinish
&gt;
&gt;libvirt: I/O Stream Utils error : this function is not supported by
&gt;the connection driver: virStreamEventRemoveCallback
&gt;
&gt;
&gt;Is there other way to stop getting this errors? or perhaps this is a bug.
&gt;

This sounds like a bug.  Do you get no other event than just _READABLE?
No _HANGUP or _ERROR?  Does virStreamAbort() work, even though it's
probably not what you are looking for?

&gt;Thanks in advance.
&gt;
&gt;Jose Valencia

&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170524074923</emailId><senderName>Roman Storozhenko</senderName><senderEmail>romeusmeister@gmail.com</senderEmail><timestampReceived>2017-05-24 07:49:23-0400</timestampReceived><subject>[libvirt-users] How to show underlying QEMU command line using virsh</subject><body>

Hello, everybody

I use virt to run my VM's and QEMU as a hypervisor. There is a file
describing my virtual machine:

/etc/libvirt/qemu/centos7.0.xml

As you know it contains xml representation of my VM. Is there any way to
show underlying qemu command that virsh runs using that file? For
example:

qemu-system-x86-64 -m 1024 -smp 2 -...

If no, is there any way to figure it out during VM run ?

---
Thanks in advance,
Roman Storozhenko

</body></email><email><emailId>20170525102051</emailId><senderName>dw</senderName><senderEmail>dwlinuxkernel@163.com</senderEmail><timestampReceived>2017-05-25 10:20:51-0400</timestampReceived><subject>[libvirt-users] can't establish more than 1000 connections with virsh</subject><body>

Hi:

     I'm trying to connect with libvirtd with virsh from a remote PC,but 
only can establish 1000 connections.

     If try more connections,prompt:

     "error: failed to connect to the hypervisor
     error: Failed to open file '/etc/libvirt/libvirt.conf': Too many 
open files"

     I tried in another PC,also get the same prompt.

     Anybody know why?

     Thanks!


     environment:

     libvirt:libvirt-2.0.0-10.el7

     OS:centos7.3



</body></email><email><emailId>20170528022908</emailId><senderName>Leroy Tennison</senderName><senderEmail>leroy.tennison@verizon.net</senderEmail><timestampReceived>2017-05-28 02:29:08-0400</timestampReceived><subject>[libvirt-users] Another hopefully simple question</subject><body>

Actually the last for now.  Is there a way to determine from the 
hypervisor (kvm/libvirt/qemu) if a VM has unmounted a partition?

</body></email><email><emailId>20170528022715</emailId><senderName>Leroy Tennison</senderName><senderEmail>leroy.tennison@verizon.net</senderEmail><timestampReceived>2017-05-28 02:27:15-0400</timestampReceived><subject>[libvirt-users] Hopefully simple question</subject><body>

Is there a way to determine what the hypervisor default NIC is? I'm 
using kvm/libvirt/qemu.  If this is the wrong forum please please reply 
with that.

</body></email><email><emailId>20170531141358</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-05-31 14:13:58-0400</timestampReceived><subject>Re: [libvirt-users] Hopefully simple question</subject><body>

On Sat, May 27, 2017 at 09:27:15PM -0500, Leroy Tennison wrote:
&gt; Is there a way to determine what the hypervisor default NIC is? I'm using
&gt; kvm/libvirt/qemu.  If this is the wrong forum please please reply with that.

This is not really a question you want an answer to, because no matter what
the default NIC is, it is almost certainly the wrong NIC model to use for
the majority of operating systems.

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170525103704</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-05-25 10:37:04-0400</timestampReceived><subject>Re: [libvirt-users] can't establish more than 1000 connections with virsh</subject><body>

On Thu, May 25, 2017 at 06:20:51PM +0800, dw wrote:
&gt; Hi:
&gt; 
&gt;     I'm trying to connect with libvirtd with virsh from a remote PC,but only
&gt; can establish 1000 connections.
&gt; 
&gt;     If try more connections,prompt:
&gt; 
&gt;     "error: failed to connect to the hypervisor
&gt;     error: Failed to open file '/etc/libvirt/libvirt.conf': Too many open
&gt; files"
&gt; 
&gt;     I tried in another PC,also get the same prompt.
&gt; 
&gt;     Anybody know why?

There's a limit of 1024 open file handles by default on Linux. You would
have to raise that limit in /etc/security/limits.d/ for your user.


Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170525105140</emailId><senderName>dw</senderName><senderEmail>dwlinuxkernel@163.com</senderEmail><timestampReceived>2017-05-25 10:51:40-0400</timestampReceived><subject>Re: [libvirt-users] can't establish more than 1000 connections with virsh</subject><body>

在 2017年05月25日 18:37, Daniel P. Berrange 写道:
&gt; On Thu, May 25, 2017 at 06:20:51PM +0800, dw wrote:
&gt;&gt; Hi:
&gt;&gt;
&gt;&gt;      I'm trying to connect with libvirtd with virsh from a remote PC,but only
&gt;&gt; can establish 1000 connections.
&gt;&gt;
&gt;&gt;      If try more connections,prompt:
&gt;&gt;
&gt;&gt;      "error: failed to connect to the hypervisor
&gt;&gt;      error: Failed to open file '/etc/libvirt/libvirt.conf': Too many open
&gt;&gt; files"
&gt;&gt;
&gt;&gt;      I tried in another PC,also get the same prompt.
&gt;&gt;
&gt;&gt;      Anybody know why?
&gt; There's a limit of 1024 open file handles by default on Linux. You would
&gt; have to raise that limit in /etc/security/limits.d/ for your user.
&gt;
&gt;
&gt; Regards,
&gt; Daniel

In /etc/security/limits.d/,there is only 20-nproc.conf.

I modified /etc/security/limits.conf,what I added is:

         "*       soft nofile 81920
         *       hard nofile 81920"

I also modified /etc/pam.d/login,that I added is:

     "session required        pam_limits.so"


The output of "ulimit -a" is:

     core file size          (blocks, -c) 0
     data seg size           (kbytes, -d) unlimited
     scheduling priority             (-e) 0
     file size               (blocks, -f) unlimited
     pending signals                 (-i) 385898
     max locked memory       (kbytes, -l) 64
     max memory size         (kbytes, -m) unlimited
     open files                      (-n) 81920
     pipe size            (512 bytes, -p) 8
     POSIX message queues     (bytes, -q) 819200
     real-time priority              (-r) 0
     stack size              (kbytes, -s) 8192
     cpu time               (seconds, -t) unlimited
     max user processes              (-u) 385898
     virtual memory          (kbytes, -v) unlimited
     file locks                      (-x) unlimited


What I did is right?



</body></email><email><emailId>20170525105419</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-05-25 10:54:19-0400</timestampReceived><subject>Re: [libvirt-users] can't establish more than 1000 connections with virsh</subject><body>

On Thu, May 25, 2017 at 06:51:40PM +0800, dw wrote:
&gt; 在 2017年05月25日 18:37, Daniel P. Berrange 写道:
&gt; &gt; On Thu, May 25, 2017 at 06:20:51PM +0800, dw wrote:
&gt; &gt; &gt; Hi:
&gt; &gt; &gt; 
&gt; &gt; &gt;      I'm trying to connect with libvirtd with virsh from a remote PC,but only
&gt; &gt; &gt; can establish 1000 connections.
&gt; &gt; &gt; 
&gt; &gt; &gt;      If try more connections,prompt:
&gt; &gt; &gt; 
&gt; &gt; &gt;      "error: failed to connect to the hypervisor
&gt; &gt; &gt;      error: Failed to open file '/etc/libvirt/libvirt.conf': Too many open
&gt; &gt; &gt; files"
&gt; &gt; &gt; 
&gt; &gt; &gt;      I tried in another PC,also get the same prompt.
&gt; &gt; &gt; 
&gt; &gt; &gt;      Anybody know why?
&gt; &gt; There's a limit of 1024 open file handles by default on Linux. You would
&gt; &gt; have to raise that limit in /etc/security/limits.d/ for your user.
&gt; &gt; 
&gt; 
&gt; In /etc/security/limits.d/,there is only 20-nproc.conf.

You can create any files you want in that sub-directory - they just
use the same syntax as limits.conf. It means that if RPM upgrades
limits.conf it doesn't interfere with your changes in limits.d/custom.conf

&gt; I modified /etc/security/limits.conf,what I added is:
&gt; 
&gt;         "*       soft nofile 81920
&gt;         *       hard nofile 81920"
&gt; 
&gt; I also modified /etc/pam.d/login,that I added is:
&gt; 
&gt;     "session required        pam_limits.so"

I don't think that's needed - its already activated via
pam.d/system-auth which is included from login.

&gt; The output of "ulimit -a" is:
&gt; 
&gt;     core file size          (blocks, -c) 0
&gt;     data seg size           (kbytes, -d) unlimited
&gt;     scheduling priority             (-e) 0
&gt;     file size               (blocks, -f) unlimited
&gt;     pending signals                 (-i) 385898
&gt;     max locked memory       (kbytes, -l) 64
&gt;     max memory size         (kbytes, -m) unlimited
&gt;     open files                      (-n) 81920
&gt;     pipe size            (512 bytes, -p) 8
&gt;     POSIX message queues     (bytes, -q) 819200
&gt;     real-time priority              (-r) 0
&gt;     stack size              (kbytes, -s) 8192
&gt;     cpu time               (seconds, -t) unlimited
&gt;     max user processes              (-u) 385898
&gt;     virtual memory          (kbytes, -v) unlimited
&gt;     file locks                      (-x) unlimited
&gt; 
&gt; 
&gt; What I did is right?

That at least shows the new limit is active

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170526014214</emailId><senderName>dw</senderName><senderEmail>dwlinuxkernel@163.com</senderEmail><timestampReceived>2017-05-26 01:42:14-0400</timestampReceived><subject>Re: [libvirt-users] can't establish more than 1000 connections with virsh</subject><body>

å¨ 2017å¹´05æ25æ¥ 18:54, Daniel P. Berrange åé:
&gt; On Thu, May 25, 2017 at 06:51:40PM +0800, dw wrote:
&gt;&gt; å¨ 2017å¹´05æ25æ¥ 18:37, Daniel P. Berrange åé:
&gt;&gt;&gt; On Thu, May 25, 2017 at 06:20:51PM +0800, dw wrote:
&gt;&gt;&gt;&gt; Hi:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;       I'm trying to connect with libvirtd with virsh from a remote PC,but only
&gt;&gt;&gt;&gt; can establish 1000 connections.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;       If try more connections,prompt:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;       "error: failed to connect to the hypervisor
&gt;&gt;&gt;&gt;       error: Failed to open file '/etc/libvirt/libvirt.conf': Too many open
&gt;&gt;&gt;&gt; files"
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;       I tried in another PC,also get the same prompt.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;       Anybody know why?
&gt;&gt;&gt; There's a limit of 1024 open file handles by default on Linux. You would
&gt;&gt;&gt; have to raise that limit in /etc/security/limits.d/ for your user.
&gt;&gt;&gt;
&gt;&gt; In /etc/security/limits.d/,there is only 20-nproc.conf.
&gt; You can create any files you want in that sub-directory - they just
&gt; use the same syntax as limits.conf. It means that if RPM upgrades
&gt; limits.conf it doesn't interfere with your changes in limits.d/custom.conf
&gt;
&gt;&gt; I modified /etc/security/limits.conf,what I added is:
&gt;&gt;
&gt;&gt;          "*       soft nofile 81920
&gt;&gt;          *       hard nofile 81920"
&gt;&gt;
&gt;&gt; I also modified /etc/pam.d/login,that I added is:
&gt;&gt;
&gt;&gt;      "session required        pam_limits.so"
&gt; I don't think that's needed - its already activated via
&gt; pam.d/system-auth which is included from login.
&gt;
&gt;&gt; The output of "ulimit -a" is:
&gt;&gt;
&gt;&gt;      core file size          (blocks, -c) 0
&gt;&gt;      data seg size           (kbytes, -d) unlimited
&gt;&gt;      scheduling priority             (-e) 0
&gt;&gt;      file size               (blocks, -f) unlimited
&gt;&gt;      pending signals                 (-i) 385898
&gt;&gt;      max locked memory       (kbytes, -l) 64
&gt;&gt;      max memory size         (kbytes, -m) unlimited
&gt;&gt;      open files                      (-n) 81920
&gt;&gt;      pipe size            (512 bytes, -p) 8
&gt;&gt;      POSIX message queues     (bytes, -q) 819200
&gt;&gt;      real-time priority              (-r) 0
&gt;&gt;      stack size              (kbytes, -s) 8192
&gt;&gt;      cpu time               (seconds, -t) unlimited
&gt;&gt;      max user processes              (-u) 385898
&gt;&gt;      virtual memory          (kbytes, -v) unlimited
&gt;&gt;      file locks                      (-x) unlimited
&gt;&gt;
&gt;&gt;
&gt;&gt; What I did is right?
&gt; That at least shows the new limit is active
&gt;
&gt; Regards,
&gt; Daniel

I restored  /etc/security/limits.conf and /etc/pam.d/login.

And added file /etc/security/limits.d/21-nofile.conf, the content is

      *       soft    nofile      10240
      *       hard    nofile      10240"

The output of "ulimit -a" now is:

    core file size          (blocks, -c) 0
    data seg size           (kbytes, -d) unlimited
    scheduling priority             (-e) 0
    file size               (blocks, -f) unlimited
    pending signals                 (-i) 385898
    max locked memory       (kbytes, -l) 64
    max memory size         (kbytes, -m) unlimited
    open files                      (-n) 10240
    pipe size            (512 bytes, -p) 8
    POSIX message queues     (bytes, -q) 819200
    real-time priority              (-r) 0
    stack size              (kbytes, -s) 8192
    cpu time               (seconds, -t) unlimited
    max user processes              (-u) 385898
    virtual memory          (kbytes, -v) unlimited
    file locks                      (-x) unlimited


The related config of /etc/libvirt/libvirtd.conf is:

    max_clients = 5000
    max_queued_clients = 2000
    min_workers = 200
    max_workers = 2000
    max_requests = 5000
    max_client_requests = 2000


Now I still get the error:

    error: failed to connect to the hypervisor
    error: Failed to open file '/etc/libvirt/libvirt.conf': Too many open files






[Attachment #3 (text/html)]

&lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
  &lt;/head&gt;
  &lt;body text="#000000" bgcolor="#FFFFFF"&gt;
    &lt;div class="moz-cite-prefix"&gt;在 2017年05月25日 18:54, Daniel P. Berrange
      写道:&lt;br&gt;
    &lt;/div&gt;
    &lt;blockquote type="cite" cite="mid:20170525105419.GD18049@redhat.com"&gt;
      &lt;pre wrap=""&gt;On Thu, May 25, 2017 at 06:51:40PM +0800, dw wrote:
&lt;/pre&gt;
      &lt;blockquote type="cite"&gt;
        &lt;pre wrap=""&gt;在 2017年05月25日 18:37, Daniel P. Berrange 写道:
&lt;/pre&gt;
        &lt;blockquote type="cite"&gt;
          &lt;pre wrap=""&gt;On Thu, May 25, 2017 at 06:20:51PM +0800, dw wrote:
&lt;/pre&gt;
          &lt;blockquote type="cite"&gt;
            &lt;pre wrap=""&gt;Hi:

     I'm trying to connect with libvirtd with virsh from a remote PC,but only
can establish 1000 connections.

     If try more connections,prompt:

     "error: failed to connect to the hypervisor
     error: Failed to open file '/etc/libvirt/libvirt.conf': Too many open
files"

     I tried in another PC,also get the same prompt.

     Anybody know why?
&lt;/pre&gt;
          &lt;/blockquote&gt;
          &lt;pre wrap=""&gt;There's a limit of 1024 open file handles by default on Linux. You would
have to raise that limit in /etc/security/limits.d/ for your user.

&lt;/pre&gt;
        &lt;/blockquote&gt;
        &lt;pre wrap=""&gt;
In /etc/security/limits.d/,there is only 20-nproc.conf.
&lt;/pre&gt;
      &lt;/blockquote&gt;
      &lt;pre wrap=""&gt;
You can create any files you want in that sub-directory - they just
use the same syntax as limits.conf. It means that if RPM upgrades
limits.conf it doesn't interfere with your changes in limits.d/custom.conf

&lt;/pre&gt;
      &lt;blockquote type="cite"&gt;
        &lt;pre wrap=""&gt;I modified /etc/security/limits.conf,what I added is:

        "*       soft nofile 81920
        *       hard nofile 81920"

I also modified /etc/pam.d/login,that I added is:

    "session required        pam_limits.so"
&lt;/pre&gt;
      &lt;/blockquote&gt;
      &lt;pre wrap=""&gt;
I don't think that's needed - its already activated via
pam.d/system-auth which is included from login.

&lt;/pre&gt;
      &lt;blockquote type="cite"&gt;
        &lt;pre wrap=""&gt;The output of "ulimit -a" is:

    core file size          (blocks, -c) 0
    data seg size           (kbytes, -d) unlimited
    scheduling priority             (-e) 0
    file size               (blocks, -f) unlimited
    pending signals                 (-i) 385898
    max locked memory       (kbytes, -l) 64
    max memory size         (kbytes, -m) unlimited
    open files                      (-n) 81920
    pipe size            (512 bytes, -p) 8
    POSIX message queues     (bytes, -q) 819200
    real-time priority              (-r) 0
    stack size              (kbytes, -s) 8192
    cpu time               (seconds, -t) unlimited
    max user processes              (-u) 385898
    virtual memory          (kbytes, -v) unlimited
    file locks                      (-x) unlimited


What I did is right?
&lt;/pre&gt;
      &lt;/blockquote&gt;
      &lt;pre wrap=""&gt;
That at least shows the new limit is active

Regards,
Daniel
&lt;/pre&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;I restored  /etc/security/limits.conf and /etc/pam.d/login.&lt;/p&gt;
    &lt;p&gt;And added file /etc/security/limits.d/21-nofile.conf, the content
      is&lt;/p&gt;
    &lt;blockquote&gt;
      &lt;p&gt; *       soft    nofile      10240&lt;br&gt;
         *       hard    nofile      10240"&lt;/p&gt;
    &lt;/blockquote&gt;
    &lt;p align="justify"&gt;The output of "ulimit -a" now is:&lt;/p&gt;
    &lt;blockquote&gt;
      &lt;p&gt;core file size          (blocks, -c) 0&lt;br&gt;
        data seg size           (kbytes, -d) unlimited&lt;br&gt;
        scheduling priority             (-e) 0&lt;br&gt;
        file size               (blocks, -f) unlimited&lt;br&gt;
        pending signals                 (-i) 385898&lt;br&gt;
        max locked memory       (kbytes, -l) 64&lt;br&gt;
        max memory size         (kbytes, -m) unlimited&lt;br&gt;
        open files                      (-n) 10240&lt;br&gt;
        pipe size            (512 bytes, -p) 8&lt;br&gt;
        POSIX message queues     (bytes, -q) 819200&lt;br&gt;
        real-time priority              (-r) 0&lt;br&gt;
        stack size              (kbytes, -s) 8192&lt;br&gt;
        cpu time               (seconds, -t) unlimited    &lt;br&gt;
        max user processes              (-u) 385898&lt;br&gt;
        virtual memory          (kbytes, -v) unlimited&lt;br&gt;
        file locks                      (-x) unlimited&lt;br&gt;
      &lt;/p&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
    &lt;p&gt;The related config of /etc/libvirt/libvirtd.conf is:&lt;/p&gt;
    &lt;blockquote&gt;max_clients = 5000&lt;br&gt;
      max_queued_clients = 2000&lt;br&gt;
      min_workers = 200&lt;br&gt;
      max_workers = 2000&lt;br&gt;
      max_requests = 5000&lt;br&gt;
      max_client_requests = 2000&lt;br&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
    Now I still get the error:&lt;br&gt;
    &lt;blockquote&gt;
      &lt;pre wrap=""&gt;error: failed to connect to the hypervisor
error: Failed to open file '/etc/libvirt/libvirt.conf': Too many open files&lt;/pre&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
    &lt;br&gt;
    &lt;br&gt;
    &lt;br&gt;
  &lt;/body&gt;
&lt;/html&gt;


</body></email><email><emailId>20170526014852</emailId><senderName>dw</senderName><senderEmail>dwlinuxkernel@163.com</senderEmail><timestampReceived>2017-05-26 01:48:52-0400</timestampReceived><subject>Re: [libvirt-users] can't establish more than 1000 connections with virsh</subject><body>

å¨ 2017å¹´05æ26æ¥ 09:42, dw åé:
&gt; å¨ 2017å¹´05æ25æ¥ 18:54, Daniel P. Berrange åé:
&gt;&gt; On Thu, May 25, 2017 at 06:51:40PM +0800, dw wrote:
&gt;&gt;&gt; å¨ 2017å¹´05æ25æ¥ 18:37, Daniel P. Berrange åé:
&gt;&gt;&gt;&gt; On Thu, May 25, 2017 at 06:20:51PM +0800, dw wrote:
&gt;&gt;&gt;&gt;&gt; Hi:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;       I'm trying to connect with libvirtd with virsh from a remote PC,but only
&gt;&gt;&gt;&gt;&gt; can establish 1000 connections.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;       If try more connections,prompt:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;       "error: failed to connect to the hypervisor
&gt;&gt;&gt;&gt;&gt;       error: Failed to open file '/etc/libvirt/libvirt.conf': Too many open
&gt;&gt;&gt;&gt;&gt; files"
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;       I tried in another PC,also get the same prompt.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;       Anybody know why?
&gt;&gt;&gt;&gt; There's a limit of 1024 open file handles by default on Linux. You would
&gt;&gt;&gt;&gt; have to raise that limit in /etc/security/limits.d/ for your user.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt; In /etc/security/limits.d/,there is only 20-nproc.conf.
&gt;&gt; You can create any files you want in that sub-directory - they just
&gt;&gt; use the same syntax as limits.conf. It means that if RPM upgrades
&gt;&gt; limits.conf it doesn't interfere with your changes in limits.d/custom.conf
&gt;&gt;
&gt;&gt;&gt; I modified /etc/security/limits.conf,what I added is:
&gt;&gt;&gt;
&gt;&gt;&gt;          "*       soft nofile 81920
&gt;&gt;&gt;          *       hard nofile 81920"
&gt;&gt;&gt;
&gt;&gt;&gt; I also modified /etc/pam.d/login,that I added is:
&gt;&gt;&gt;
&gt;&gt;&gt;      "session required        pam_limits.so"
&gt;&gt; I don't think that's needed - its already activated via
&gt;&gt; pam.d/system-auth which is included from login.
&gt;&gt;
&gt;&gt;&gt; The output of "ulimit -a" is:
&gt;&gt;&gt;
&gt;&gt;&gt;      core file size          (blocks, -c) 0
&gt;&gt;&gt;      data seg size           (kbytes, -d) unlimited
&gt;&gt;&gt;      scheduling priority             (-e) 0
&gt;&gt;&gt;      file size               (blocks, -f) unlimited
&gt;&gt;&gt;      pending signals                 (-i) 385898
&gt;&gt;&gt;      max locked memory       (kbytes, -l) 64
&gt;&gt;&gt;      max memory size         (kbytes, -m) unlimited
&gt;&gt;&gt;      open files                      (-n) 81920
&gt;&gt;&gt;      pipe size            (512 bytes, -p) 8
&gt;&gt;&gt;      POSIX message queues     (bytes, -q) 819200
&gt;&gt;&gt;      real-time priority              (-r) 0
&gt;&gt;&gt;      stack size              (kbytes, -s) 8192
&gt;&gt;&gt;      cpu time               (seconds, -t) unlimited
&gt;&gt;&gt;      max user processes              (-u) 385898
&gt;&gt;&gt;      virtual memory          (kbytes, -v) unlimited
&gt;&gt;&gt;      file locks                      (-x) unlimited
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; What I did is right?
&gt;&gt; That at least shows the new limit is active
&gt;&gt;
&gt;&gt; Regards,
&gt;&gt; Daniel
&gt;
&gt; I restored  /etc/security/limits.conf and /etc/pam.d/login.
&gt;
&gt; And added file /etc/security/limits.d/21-nofile.conf, the content is
&gt;
&gt;      *       soft    nofile      10240
&gt;      *       hard    nofile      10240"
&gt;
&gt; The output of "ulimit -a" now is:
&gt;
&gt;     core file size          (blocks, -c) 0
&gt;     data seg size           (kbytes, -d) unlimited
&gt;     scheduling priority             (-e) 0
&gt;     file size               (blocks, -f) unlimited
&gt;     pending signals                 (-i) 385898
&gt;     max locked memory       (kbytes, -l) 64
&gt;     max memory size         (kbytes, -m) unlimited
&gt;     open files                      (-n) 10240
&gt;     pipe size            (512 bytes, -p) 8
&gt;     POSIX message queues     (bytes, -q) 819200
&gt;     real-time priority              (-r) 0
&gt;     stack size              (kbytes, -s) 8192
&gt;     cpu time               (seconds, -t) unlimited
&gt;     max user processes              (-u) 385898
&gt;     virtual memory          (kbytes, -v) unlimited
&gt;     file locks                      (-x) unlimited
&gt;
&gt;
&gt; The related config of /etc/libvirt/libvirtd.conf is:
&gt;
&gt;     max_clients = 5000
&gt;     max_queued_clients = 2000
&gt;     min_workers = 200
&gt;     max_workers = 2000
&gt;     max_requests = 5000
&gt;     max_client_requests = 2000
&gt;
&gt;
&gt; Now I still get the error:
&gt;
&gt;     error: failed to connect to the hypervisor
&gt;     error: Failed to open file '/etc/libvirt/libvirt.conf': Too many open files
&gt;
&gt;
I tried twice,and the result is:

    virsh -c qemu+tcp://remote_pc/system
    error: failed to connect to the hypervisor
    error: Failed to open file '/etc/libvirt/libvirt.conf': Too many
    open files

      virsh -c qemu+ssh://remote_pc/system
    error: failed to connect to the hypervisor
    error: Failed to open file '/proc/4931/stat': Too many open files



[Attachment #3 (text/html)]

&lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
  &lt;/head&gt;
  &lt;body text="#000000" bgcolor="#FFFFFF"&gt;
    &lt;div class="moz-cite-prefix"&gt;在 2017年05月26日 09:42, dw 写道:&lt;br&gt;
    &lt;/div&gt;
    &lt;blockquote type="cite"
      cite="mid:a1ff4a2c-6038-76b3-2671-af547d86a111@163.com"&gt;
      &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
      &lt;div class="moz-cite-prefix"&gt;在 2017年05月25日 18:54, Daniel P.
        Berrange 写道:&lt;br&gt;
      &lt;/div&gt;
      &lt;blockquote type="cite"
        cite="mid:20170525105419.GD18049@redhat.com"&gt;
        &lt;pre wrap=""&gt;On Thu, May 25, 2017 at 06:51:40PM +0800, dw wrote:
&lt;/pre&gt;
        &lt;blockquote type="cite"&gt;
          &lt;pre wrap=""&gt;在 2017年05月25日 18:37, Daniel P. Berrange 写道:
&lt;/pre&gt;
          &lt;blockquote type="cite"&gt;
            &lt;pre wrap=""&gt;On Thu, May 25, 2017 at 06:20:51PM +0800, dw wrote:
&lt;/pre&gt;
            &lt;blockquote type="cite"&gt;
              &lt;pre wrap=""&gt;Hi:

     I'm trying to connect with libvirtd with virsh from a remote PC,but only
can establish 1000 connections.

     If try more connections,prompt:

     "error: failed to connect to the hypervisor
     error: Failed to open file '/etc/libvirt/libvirt.conf': Too many open
files"

     I tried in another PC,also get the same prompt.

     Anybody know why?
&lt;/pre&gt;
            &lt;/blockquote&gt;
            &lt;pre wrap=""&gt;There's a limit of 1024 open file handles by default on Linux. You would
have to raise that limit in /etc/security/limits.d/ for your user.

&lt;/pre&gt;
          &lt;/blockquote&gt;
          &lt;pre wrap=""&gt;In /etc/security/limits.d/,there is only 20-nproc.conf.
&lt;/pre&gt;
        &lt;/blockquote&gt;
        &lt;pre wrap=""&gt;You can create any files you want in that sub-directory - they just
use the same syntax as limits.conf. It means that if RPM upgrades
limits.conf it doesn't interfere with your changes in limits.d/custom.conf

&lt;/pre&gt;
        &lt;blockquote type="cite"&gt;
          &lt;pre wrap=""&gt;I modified /etc/security/limits.conf,what I added is:

        "*       soft nofile 81920
        *       hard nofile 81920"

I also modified /etc/pam.d/login,that I added is:

    "session required        pam_limits.so"
&lt;/pre&gt;
        &lt;/blockquote&gt;
        &lt;pre wrap=""&gt;I don't think that's needed - its already activated via
pam.d/system-auth which is included from login.

&lt;/pre&gt;
        &lt;blockquote type="cite"&gt;
          &lt;pre wrap=""&gt;The output of "ulimit -a" is:

    core file size          (blocks, -c) 0
    data seg size           (kbytes, -d) unlimited
    scheduling priority             (-e) 0
    file size               (blocks, -f) unlimited
    pending signals                 (-i) 385898
    max locked memory       (kbytes, -l) 64
    max memory size         (kbytes, -m) unlimited
    open files                      (-n) 81920
    pipe size            (512 bytes, -p) 8
    POSIX message queues     (bytes, -q) 819200
    real-time priority              (-r) 0
    stack size              (kbytes, -s) 8192
    cpu time               (seconds, -t) unlimited
    max user processes              (-u) 385898
    virtual memory          (kbytes, -v) unlimited
    file locks                      (-x) unlimited


What I did is right?
&lt;/pre&gt;
        &lt;/blockquote&gt;
        &lt;pre wrap=""&gt;That at least shows the new limit is active

Regards,
Daniel
&lt;/pre&gt;
      &lt;/blockquote&gt;
      &lt;p&gt;I restored  /etc/security/limits.conf and /etc/pam.d/login.&lt;/p&gt;
      &lt;p&gt;And added file /etc/security/limits.d/21-nofile.conf, the
        content is&lt;/p&gt;
      &lt;blockquote&gt;
        &lt;p&gt; *       soft    nofile      10240&lt;br&gt;
           *       hard    nofile      10240"&lt;/p&gt;
      &lt;/blockquote&gt;
      &lt;p align="justify"&gt;The output of "ulimit -a" now is:&lt;/p&gt;
      &lt;blockquote&gt;
        &lt;p&gt;core file size          (blocks, -c) 0&lt;br&gt;
          data seg size           (kbytes, -d) unlimited&lt;br&gt;
          scheduling priority             (-e) 0&lt;br&gt;
          file size               (blocks, -f) unlimited&lt;br&gt;
          pending signals                 (-i) 385898&lt;br&gt;
          max locked memory       (kbytes, -l) 64&lt;br&gt;
          max memory size         (kbytes, -m) unlimited&lt;br&gt;
          open files                      (-n) 10240&lt;br&gt;
          pipe size            (512 bytes, -p) 8&lt;br&gt;
          POSIX message queues     (bytes, -q) 819200&lt;br&gt;
          real-time priority              (-r) 0&lt;br&gt;
          stack size              (kbytes, -s) 8192&lt;br&gt;
          cpu time               (seconds, -t) unlimited    &lt;br&gt;
          max user processes              (-u) 385898&lt;br&gt;
          virtual memory          (kbytes, -v) unlimited&lt;br&gt;
          file locks                      (-x) unlimited&lt;br&gt;
        &lt;/p&gt;
      &lt;/blockquote&gt;
      &lt;br&gt;
      &lt;p&gt;The related config of /etc/libvirt/libvirtd.conf is:&lt;/p&gt;
      &lt;blockquote&gt;max_clients = 5000&lt;br&gt;
        max_queued_clients = 2000&lt;br&gt;
        min_workers = 200&lt;br&gt;
        max_workers = 2000&lt;br&gt;
        max_requests = 5000&lt;br&gt;
        max_client_requests = 2000&lt;br&gt;
      &lt;/blockquote&gt;
      &lt;br&gt;
      Now I still get the error:&lt;br&gt;
      &lt;blockquote&gt;
        &lt;pre wrap=""&gt;error: failed to connect to the hypervisor
error: Failed to open file '/etc/libvirt/libvirt.conf': Too many open files&lt;/pre&gt;
      &lt;/blockquote&gt;
      &lt;br&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;I tried twice,and the result is:&lt;/p&gt;
    &lt;blockquote&gt;
      &lt;p&gt;virsh -c qemu+tcp://remote_pc/system&lt;br&gt;
        error: failed to connect to the hypervisor&lt;br&gt;
        error: Failed to open file '/etc/libvirt/libvirt.conf': Too many
        open files&lt;br&gt;
        &lt;br&gt;
         virsh -c qemu+ssh://remote_pc/system&lt;br&gt;
        error: failed to connect to the hypervisor&lt;br&gt;
        error: Failed to open file '/proc/4931/stat': Too many open
        files&lt;br&gt;
      &lt;/p&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
  &lt;/body&gt;
&lt;/html&gt;


</body></email><email><emailId>20170524083842</emailId><senderName>Erik Skultety</senderName><senderEmail>eskultet@redhat.com</senderEmail><timestampReceived>2017-05-24 08:38:42-0400</timestampReceived><subject>Re: [libvirt-users] How to show underlying QEMU command line using virsh</subject><body>

On Wed, May 24, 2017 at 10:49:23AM +0300, Roman Storozhenko wrote:
&gt; Hello, everybody
&gt;
&gt; I use virt to run my VM's and QEMU as a hypervisor. There is a file
&gt; describing my virtual machine:
&gt;
&gt; /etc/libvirt/qemu/centos7.0.xml

Just a note, never edit ^these files directly behind libvirt's back and always
use 'virsh edit' for all modifications.

&gt;
&gt; As you know it contains xml representation of my VM. Is there any way to
&gt; show underlying qemu command that virsh runs using that file? For
&gt; example:

virsh doesn't spawn the qemu process, it's a frontend to libvirtd daemon which
will build the qemu cmdline according to the domain XML description and spawn
the process. As for the qemu commandline, we don't have an API to query the
command line, what you can do is get the qemu pid (e.g. with pgrep -f &lt;VM_name&gt;
and then cat /proc/&lt;pid&gt;/cmdline) or use ps and pipe its output to grep.

Erik

&gt;
&gt; qemu-system-x86-64 -m 1024 -smp 2 -...
&gt;
&gt; If no, is there any way to figure it out during VM run ?
&gt;
&gt; ---
&gt; Thanks in advance,
&gt; Roman Storozhenko
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users

</body></email><email><emailId>20170524122313</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-05-24 12:23:13-0400</timestampReceived><subject>Re: [libvirt-users] How to show underlying QEMU command line using virsh</subject><body>


On Wed, May 24, 2017 at 10:49:23AM +0300, Roman Storozhenko wrote:
&gt;Hello, everybody
&gt;
&gt;I use virt to run my VM's and QEMU as a hypervisor. There is a file
&gt;describing my virtual machine:
&gt;
&gt;/etc/libvirt/qemu/centos7.0.xml
&gt;
&gt;As you know it contains xml representation of my VM. Is there any way to
&gt;show underlying qemu command that virsh runs using that file? For
&gt;example:
&gt;
&gt;qemu-system-x86-64 -m 1024 -smp 2 -...
&gt;
&gt;If no, is there any way to figure it out during VM run ?
&gt;

There is virsh domxml-to-native, you can do:

  virsh dumpxml centos7.0 | virsh domxml-to-native qemu-argv /dev/stdin

However be warned that domxml-to-native does not support everything that
the driver will, this API is always a bit behind with some things.

&gt;---
&gt;Thanks in advance,
&gt;Roman Storozhenko
&gt;
&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170517010139</emailId><senderName>JosÃ‰_Luis_Valencia_Gutierrez</senderName><senderEmail>jvalencia@id.uff.br</senderEmail><timestampReceived>2017-05-17 01:01:39-0400</timestampReceived><subject>Re: [libvirt-users] No way to stop virStream error after guest stop</subject><body>

I get just _READABLE events repeatedly, virStreamAbort() doesn't work, it
gets out of control after the target domain stops and the unix scocket is
deleted. I ended connecting directly to the unix socket. I just wanted to
ask if it certainly is a bug or perhaps someone went through this before
and have a workaround.

Jose V.
Em ter, 16 de mai de 2017 =C3=A0s 05:28, Martin Kletzander &lt;mkletzan@redhat=
.com&gt;
escreveu:

&gt; On Fri, Apr 28, 2017 at 11:01:18PM +0000, Jos=C3=89 Luis Valencia Gutierr=
ez
&gt; wrote:
&gt; &gt;Hello everyone,
&gt; &gt;I am opening a virChannel(unix) to a domain and receiving data with a
&gt; &gt;non-blocking virStream using events, when the connected domain gets
&gt; &gt;stopped(which deletes the channel unix socket) by calling destroy,
&gt; &gt;shutdown, pause or migrate on that domain, with the stream open the read
&gt; &gt;event is triggered repeatedly, and virStreamRecv returns 0 bytes
&gt; indicating
&gt; &gt; EOF but neither  virStreamFinish nor virStreamFinish is working to stop
&gt; &gt;the stream to trigger the event . Each time the event is called I got th=
is
&gt; &gt;errors.
&gt; &gt;
&gt; &gt;libvirt: I/O Stream Utils error : this function is not supported by
&gt; &gt;the connection driver: virStreamRecv
&gt; &gt;
&gt; &gt;libvirt: I/O Stream Utils error : this function is not supported by
&gt; &gt;the connection driver: virStreamFinish
&gt; &gt;
&gt; &gt;libvirt: I/O Stream Utils error : this function is not supported by
&gt; &gt;the connection driver: virStreamEventRemoveCallback
&gt; &gt;
&gt; &gt;
&gt; &gt;Is there other way to stop getting this errors? or perhaps this is a bug=
.
&gt; &gt;
&gt;
&gt; This sounds like a bug.  Do you get no other event than just _READABLE?
&gt; No _HANGUP or _ERROR?  Does virStreamAbort() work, even though it's
&gt; probably not what you are looking for?
&gt;
&gt; &gt;Thanks in advance.
&gt; &gt;
&gt; &gt;Jose Valencia
&gt;
&gt; &gt;_______________________________________________
&gt; &gt;libvirt-users mailing list
&gt; &gt;libvirt-users@redhat.com
&gt; &gt;https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;I get just _READABLE events repeatedly, virStreamAbort() doesn't \
work, it gets out of control after the target domain stops and the unix scocket is \
deleted. I ended connecting directly to the unix socket. I just wanted to ask if it \
certainly is a bug or perhaps someone went through this before and have a \
workaround.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Jose V.&lt;/div&gt;&lt;div&gt;&lt;div class="gmail_quote"&gt;&lt;div \
dir="ltr"&gt;Em ter, 16 de mai de 2017 Ã s 05:28, Martin Kletzander &lt;&lt;a \
href="mailto:mkletzan@redhat.com" target="_blank"&gt;mkletzan@redhat.com&lt;/a&gt;&gt; \
escreveu:&lt;br&gt;&lt;/div&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;On Fri, Apr 28, 2017 at 11:01:18PM \
+0000, JosÃ‰ Luis Valencia Gutierrez wrote:&lt;br&gt; &gt;Hello everyone,&lt;br&gt;
&gt;I am opening a virChannel(unix) to a domain and receiving data with a&lt;br&gt;
&gt;non-blocking virStream using events, when the connected domain gets&lt;br&gt;
&gt;stopped(which deletes the channel unix socket) by calling destroy,&lt;br&gt;
&gt;shutdown, pause or migrate on that domain, with the stream open the read&lt;br&gt;
&gt;event is triggered repeatedly, and virStreamRecv returns 0 bytes indicating&lt;br&gt;
&gt; EOF but neither   virStreamFinish nor virStreamFinish is working to stop&lt;br&gt;
&gt;the stream to trigger the event . Each time the event is called I got this&lt;br&gt;
&gt;errors.&lt;br&gt;
&gt;&lt;br&gt;
&gt;libvirt: I/O Stream Utils error : this function is not supported by&lt;br&gt;
&gt;the connection driver: virStreamRecv&lt;br&gt;
&gt;&lt;br&gt;
&gt;libvirt: I/O Stream Utils error : this function is not supported by&lt;br&gt;
&gt;the connection driver: virStreamFinish&lt;br&gt;
&gt;&lt;br&gt;
&gt;libvirt: I/O Stream Utils error : this function is not supported by&lt;br&gt;
&gt;the connection driver: virStreamEventRemoveCallback&lt;br&gt;
&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt;Is there other way to stop getting this errors? or perhaps this is a bug.&lt;br&gt;
&gt;&lt;br&gt;
&lt;br&gt;
This sounds like a bug.   Do you get no other event than just _READABLE?&lt;br&gt;
No _HANGUP or _ERROR?   Does virStreamAbort() work, even though it's&lt;br&gt;
probably not what you are looking for?&lt;br&gt;
&lt;br&gt;
&gt;Thanks in advance.&lt;br&gt;
&gt;&lt;br&gt;
&gt;Jose Valencia&lt;br&gt;
&lt;br&gt;
&gt;_______________________________________________&lt;br&gt;
&gt;libvirt-users mailing list&lt;br&gt;
&gt;&lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &gt;&lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt; \
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170517070814</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-05-17 07:08:14-0400</timestampReceived><subject>Re: [libvirt-users] No way to stop virStream error after guest stop</subject><body>


On Wed, May 17, 2017 at 01:01:39AM +0000, Jos=C9 Luis Valencia Gutierrez wr=
ote:
&gt;I get just _READABLE events repeatedly, virStreamAbort() doesn't work, it
&gt;gets out of control after the target domain stops and the unix scocket is
&gt;deleted. I ended connecting directly to the unix socket. I just wanted to
&gt;ask if it certainly is a bug or perhaps someone went through this before
&gt;and have a workaround.
&gt;

It's OK workaround if you are on the same host and you can connect to
the unix socket directly.  But I think this is a bug and we need to fix
it for others who need to call this remotely.

Thanks for letting us know.  Would you mind filing a bug so that we can
track this issue properly?  I'm currently trying to reproduce the issue,
although I wasn't successful yet.

&gt;Jose V.
&gt;Em ter, 16 de mai de 2017 =E0s 05:28, Martin Kletzander &lt;mkletzan@redhat.c=
om&gt;
&gt;escreveu:
&gt;
&gt;&gt; On Fri, Apr 28, 2017 at 11:01:18PM +0000, Jos=C9 Luis Valencia Gutierrez
&gt;&gt; wrote:
&gt;&gt; &gt;Hello everyone,
&gt;&gt; &gt;I am opening a virChannel(unix) to a domain and receiving data with a
&gt;&gt; &gt;non-blocking virStream using events, when the connected domain gets
&gt;&gt; &gt;stopped(which deletes the channel unix socket) by calling destroy,
&gt;&gt; &gt;shutdown, pause or migrate on that domain, with the stream open the read
&gt;&gt; &gt;event is triggered repeatedly, and virStreamRecv returns 0 bytes
&gt;&gt; indicating
&gt;&gt; &gt; EOF but neither  virStreamFinish nor virStreamFinish is working to stop
&gt;&gt; &gt;the stream to trigger the event . Each time the event is called I got t=
his
&gt;&gt; &gt;errors.
&gt;&gt; &gt;
&gt;&gt; &gt;libvirt: I/O Stream Utils error : this function is not supported by
&gt;&gt; &gt;the connection driver: virStreamRecv
&gt;&gt; &gt;
&gt;&gt; &gt;libvirt: I/O Stream Utils error : this function is not supported by
&gt;&gt; &gt;the connection driver: virStreamFinish
&gt;&gt; &gt;
&gt;&gt; &gt;libvirt: I/O Stream Utils error : this function is not supported by
&gt;&gt; &gt;the connection driver: virStreamEventRemoveCallback
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt;Is there other way to stop getting this errors? or perhaps this is a bu=
g.
&gt;&gt; &gt;
&gt;&gt;
&gt;&gt; This sounds like a bug.  Do you get no other event than just _READABLE?
&gt;&gt; No _HANGUP or _ERROR?  Does virStreamAbort() work, even though it's
&gt;&gt; probably not what you are looking for?
&gt;&gt;
&gt;&gt; &gt;Thanks in advance.
&gt;&gt; &gt;
&gt;&gt; &gt;Jose Valencia
&gt;&gt;
&gt;&gt; &gt;_______________________________________________
&gt;&gt; &gt;libvirt-users mailing list
&gt;&gt; &gt;libvirt-users@redhat.com
&gt;&gt; &gt;https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170517154923</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-05-17 15:49:23-0400</timestampReceived><subject>Re: [libvirt-users] No way to stop virStream error after guest stop</subject><body>


On Wed, May 17, 2017 at 09:08:14AM +0200, Martin Kletzander wrote:
&gt;On Wed, May 17, 2017 at 01:01:39AM +0000, Jos=C9 Luis Valencia Gutierrez w=
rote:
&gt;&gt;I get just _READABLE events repeatedly, virStreamAbort() doesn't work, it
&gt;&gt;gets out of control after the target domain stops and the unix scocket is
&gt;&gt;deleted. I ended connecting directly to the unix socket. I just wanted to
&gt;&gt;ask if it certainly is a bug or perhaps someone went through this before
&gt;&gt;and have a workaround.
&gt;&gt;
&gt;
&gt;It's OK workaround if you are on the same host and you can connect to
&gt;the unix socket directly.  But I think this is a bug and we need to fix
&gt;it for others who need to call this remotely.
&gt;
&gt;Thanks for letting us know.  Would you mind filing a bug so that we can
&gt;track this issue properly?  I'm currently trying to reproduce the issue,
&gt;although I wasn't successful yet.
&gt;

So I played around with this for a while now and I can partially
reproduce what you are seeing, but with the correct usage it goes away.
So my guess is there is a stray call in your program somewhere or I
didn't reproduce exactly what you meant.

After receiving the _READABLE event and doing virStreamRecv() that
returns 0 bytes read, did you try immediatelly removing the callback and
calling virStreamFinish() on the stream?

What you see happening is something that is possible by not removing the
callback and then aborting the stream, for example.

&gt;&gt;Jose V.
&gt;&gt;Em ter, 16 de mai de 2017 =E0s 05:28, Martin Kletzander &lt;mkletzan@redhat.=
com&gt;
&gt;&gt;escreveu:
&gt;&gt;
&gt;&gt;&gt; On Fri, Apr 28, 2017 at 11:01:18PM +0000, Jos=C9 Luis Valencia Gutierrez
&gt;&gt;&gt; wrote:
&gt;&gt;&gt; &gt;Hello everyone,
&gt;&gt;&gt; &gt;I am opening a virChannel(unix) to a domain and receiving data with a
&gt;&gt;&gt; &gt;non-blocking virStream using events, when the connected domain gets
&gt;&gt;&gt; &gt;stopped(which deletes the channel unix socket) by calling destroy,
&gt;&gt;&gt; &gt;shutdown, pause or migrate on that domain, with the stream open the re=
ad
&gt;&gt;&gt; &gt;event is triggered repeatedly, and virStreamRecv returns 0 bytes
&gt;&gt;&gt; indicating
&gt;&gt;&gt; &gt; EOF but neither  virStreamFinish nor virStreamFinish is working to st=
op
&gt;&gt;&gt; &gt;the stream to trigger the event . Each time the event is called I got =
this
&gt;&gt;&gt; &gt;errors.
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt;libvirt: I/O Stream Utils error : this function is not supported by
&gt;&gt;&gt; &gt;the connection driver: virStreamRecv
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt;libvirt: I/O Stream Utils error : this function is not supported by
&gt;&gt;&gt; &gt;the connection driver: virStreamFinish
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt;libvirt: I/O Stream Utils error : this function is not supported by
&gt;&gt;&gt; &gt;the connection driver: virStreamEventRemoveCallback
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt;Is there other way to stop getting this errors? or perhaps this is a b=
ug.
&gt;&gt;&gt; &gt;
&gt;&gt;&gt;
&gt;&gt;&gt; This sounds like a bug.  Do you get no other event than just _READABLE?
&gt;&gt;&gt; No _HANGUP or _ERROR?  Does virStreamAbort() work, even though it's
&gt;&gt;&gt; probably not what you are looking for?
&gt;&gt;&gt;
&gt;&gt;&gt; &gt;Thanks in advance.
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt;Jose Valencia
&gt;&gt;&gt;
&gt;&gt;&gt; &gt;_______________________________________________
&gt;&gt;&gt; &gt;libvirt-users mailing list
&gt;&gt;&gt; &gt;libvirt-users@redhat.com
&gt;&gt;&gt; &gt;https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;&gt;



&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170517195335</emailId><senderName>JosÃ‰_Luis_Valencia_Gutierrez</senderName><senderEmail>jvalencia@id.uff.br</senderEmail><timestampReceived>2017-05-17 19:53:35-0400</timestampReceived><subject>Re: [libvirt-users] No way to stop virStream error after guest stop</subject><body>

I just tried removing the callback before calling virStreamFinish and it
worked right, I thought by simply finish the stream would stop the events
and close it, the example I was based on only calls virStreamFinish on EOF
event.


Em qua, 17 de mai de 2017 =C3=A0s 12:49, Martin Kletzander &lt;mkletzan@redhat=
.com&gt;
escreveu:

&gt; On Wed, May 17, 2017 at 09:08:14AM +0200, Martin Kletzander wrote:
&gt; &gt;On Wed, May 17, 2017 at 01:01:39AM +0000, Jos=C3=89 Luis Valencia Gutier=
rez
&gt; wrote:
&gt; &gt;&gt;I get just _READABLE events repeatedly, virStreamAbort() doesn't work, =
it
&gt; &gt;&gt;gets out of control after the target domain stops and the unix scocket =
is
&gt; &gt;&gt;deleted. I ended connecting directly to the unix socket. I just wanted =
to
&gt; &gt;&gt;ask if it certainly is a bug or perhaps someone went through this befor=
e
&gt; &gt;&gt;and have a workaround.
&gt; &gt;&gt;
&gt; &gt;
&gt; &gt;It's OK workaround if you are on the same host and you can connect to
&gt; &gt;the unix socket directly.  But I think this is a bug and we need to fix
&gt; &gt;it for others who need to call this remotely.
&gt; &gt;
&gt; &gt;Thanks for letting us know.  Would you mind filing a bug so that we can
&gt; &gt;track this issue properly?  I'm currently trying to reproduce the issue,
&gt; &gt;although I wasn't successful yet.
&gt; &gt;
&gt;
&gt; So I played around with this for a while now and I can partially
&gt; reproduce what you are seeing, but with the correct usage it goes away.
&gt; So my guess is there is a stray call in your program somewhere or I
&gt; didn't reproduce exactly what you meant.
&gt;
&gt; After receiving the _READABLE event and doing virStreamRecv() that
&gt; returns 0 bytes read, did you try immediatelly removing the callback and
&gt; calling virStreamFinish() on the stream?
&gt;
&gt; What you see happening is something that is possible by not removing the
&gt; callback and then aborting the stream, for example.
&gt;
&gt; &gt;&gt;Jose V.
&gt; &gt;&gt;Em ter, 16 de mai de 2017 =C3=A0s 05:28, Martin Kletzander &lt;
&gt; mkletzan@redhat.com&gt;
&gt; &gt;&gt;escreveu:
&gt; &gt;&gt;
&gt; &gt;&gt;&gt; On Fri, Apr 28, 2017 at 11:01:18PM +0000, Jos=C3=89 Luis Valencia Gut=
ierrez
&gt; &gt;&gt;&gt; wrote:
&gt; &gt;&gt;&gt; &gt;Hello everyone,
&gt; &gt;&gt;&gt; &gt;I am opening a virChannel(unix) to a domain and receiving data with =
a
&gt; &gt;&gt;&gt; &gt;non-blocking virStream using events, when the connected domain gets
&gt; &gt;&gt;&gt; &gt;stopped(which deletes the channel unix socket) by calling destroy,
&gt; &gt;&gt;&gt; &gt;shutdown, pause or migrate on that domain, with the stream open the
&gt; read
&gt; &gt;&gt;&gt; &gt;event is triggered repeatedly, and virStreamRecv returns 0 bytes
&gt; &gt;&gt;&gt; indicating
&gt; &gt;&gt;&gt; &gt; EOF but neither  virStreamFinish nor virStreamFinish is working to
&gt; stop
&gt; &gt;&gt;&gt; &gt;the stream to trigger the event . Each time the event is called I go=
t
&gt; this
&gt; &gt;&gt;&gt; &gt;errors.
&gt; &gt;&gt;&gt; &gt;
&gt; &gt;&gt;&gt; &gt;libvirt: I/O Stream Utils error : this function is not supported by
&gt; &gt;&gt;&gt; &gt;the connection driver: virStreamRecv
&gt; &gt;&gt;&gt; &gt;
&gt; &gt;&gt;&gt; &gt;libvirt: I/O Stream Utils error : this function is not supported by
&gt; &gt;&gt;&gt; &gt;the connection driver: virStreamFinish
&gt; &gt;&gt;&gt; &gt;
&gt; &gt;&gt;&gt; &gt;libvirt: I/O Stream Utils error : this function is not supported by
&gt; &gt;&gt;&gt; &gt;the connection driver: virStreamEventRemoveCallback
&gt; &gt;&gt;&gt; &gt;
&gt; &gt;&gt;&gt; &gt;
&gt; &gt;&gt;&gt; &gt;Is there other way to stop getting this errors? or perhaps this is a
&gt; bug.
&gt; &gt;&gt;&gt; &gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; This sounds like a bug.  Do you get no other event than just _READABL=
E?
&gt; &gt;&gt;&gt; No _HANGUP or _ERROR?  Does virStreamAbort() work, even though it's
&gt; &gt;&gt;&gt; probably not what you are looking for?
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; &gt;Thanks in advance.
&gt; &gt;&gt;&gt; &gt;
&gt; &gt;&gt;&gt; &gt;Jose Valencia
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; &gt;_______________________________________________
&gt; &gt;&gt;&gt; &gt;libvirt-users mailing list
&gt; &gt;&gt;&gt; &gt;libvirt-users@redhat.com
&gt; &gt;&gt;&gt; &gt;https://www.redhat.com/mailman/listinfo/libvirt-users
&gt; &gt;&gt;&gt;
&gt;
&gt;
&gt;
&gt; &gt;_______________________________________________
&gt; &gt;libvirt-users mailing list
&gt; &gt;libvirt-users@redhat.com
&gt; &gt;https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;I just tried removing the callback before calling virStreamFinish and \
it worked right, I thought by simply finish the stream would stop the events and \
close it, the example I was based on only calls virStreamFinish on EOF \
event.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;&lt;div dir="ltr"&gt;Em qua, 17 de \
mai de 2017 Ã s 12:49, Martin Kletzander &lt;&lt;a \
href="mailto:mkletzan@redhat.com"&gt;mkletzan@redhat.com&lt;/a&gt;&gt; \
escreveu:&lt;br&gt;&lt;/div&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;On Wed, May 17, 2017 at 09:08:14AM \
+0200, Martin Kletzander wrote:&lt;br&gt; &gt;On Wed, May 17, 2017 at 01:01:39AM +0000, \
JosÃ‰ Luis Valencia Gutierrez wrote:&lt;br&gt; &gt;&gt;I get just _READABLE events \
repeatedly, virStreamAbort() doesn't work, it&lt;br&gt; &gt;&gt;gets out of control \
after the target domain stops and the unix scocket is&lt;br&gt; &gt;&gt;deleted. I ended \
connecting directly to the unix socket. I just wanted to&lt;br&gt; &gt;&gt;ask if it \
certainly is a bug or perhaps someone went through this before&lt;br&gt; &gt;&gt;and have a \
workaround.&lt;br&gt; &gt;&gt;&lt;br&gt;
&gt;&lt;br&gt;
&gt;It's OK workaround if you are on the same host and you can connect to&lt;br&gt;
&gt;the unix socket directly.   But I think this is a bug and we need to fix&lt;br&gt;
&gt;it for others who need to call this remotely.&lt;br&gt;
&gt;&lt;br&gt;
&gt;Thanks for letting us know.   Would you mind filing a bug so that we can&lt;br&gt;
&gt;track this issue properly?   I'm currently trying to reproduce the issue,&lt;br&gt;
&gt;although I wasn't successful yet.&lt;br&gt;
&gt;&lt;br&gt;
&lt;br&gt;
So I played around with this for a while now and I can partially&lt;br&gt;
reproduce what you are seeing, but with the correct usage it goes away.&lt;br&gt;
So my guess is there is a stray call in your program somewhere or I&lt;br&gt;
didn't reproduce exactly what you meant.&lt;br&gt;
&lt;br&gt;
After receiving the _READABLE event and doing virStreamRecv() that&lt;br&gt;
returns 0 bytes read, did you try immediatelly removing the callback and&lt;br&gt;
calling virStreamFinish() on the stream?&lt;br&gt;
&lt;br&gt;
What you see happening is something that is possible by not removing the&lt;br&gt;
callback and then aborting the stream, for example.&lt;br&gt;
&lt;br&gt;
&gt;&gt;Jose V.&lt;br&gt;
&gt;&gt;Em ter, 16 de mai de 2017 Ã s 05:28, Martin Kletzander &lt;&lt;a \
href="mailto:mkletzan@redhat.com" target="_blank"&gt;mkletzan@redhat.com&lt;/a&gt;&gt;&lt;br&gt; \
&gt;&gt;escreveu:&lt;br&gt; &gt;&gt;&lt;br&gt;
&gt;&gt;&gt; On Fri, Apr 28, 2017 at 11:01:18PM +0000, JosÃ‰ Luis Valencia \
Gutierrez&lt;br&gt; &gt;&gt;&gt; wrote:&lt;br&gt;
&gt;&gt;&gt; &gt;Hello everyone,&lt;br&gt;
&gt;&gt;&gt; &gt;I am opening a virChannel(unix) to a domain and receiving data with \
a&lt;br&gt; &gt;&gt;&gt; &gt;non-blocking virStream using events, when the connected domain \
gets&lt;br&gt; &gt;&gt;&gt; &gt;stopped(which deletes the channel unix socket) by calling \
destroy,&lt;br&gt; &gt;&gt;&gt; &gt;shutdown, pause or migrate on that domain, with the \
stream open the read&lt;br&gt; &gt;&gt;&gt; &gt;event is triggered repeatedly, and \
virStreamRecv returns 0 bytes&lt;br&gt; &gt;&gt;&gt; indicating&lt;br&gt;
&gt;&gt;&gt; &gt; EOF but neither   virStreamFinish nor virStreamFinish is working to \
stop&lt;br&gt; &gt;&gt;&gt; &gt;the stream to trigger the event . Each time the event is \
called I got this&lt;br&gt; &gt;&gt;&gt; &gt;errors.&lt;br&gt;
&gt;&gt;&gt; &gt;&lt;br&gt;
&gt;&gt;&gt; &gt;libvirt: I/O Stream Utils error : this function is not supported \
by&lt;br&gt; &gt;&gt;&gt; &gt;the connection driver: virStreamRecv&lt;br&gt;
&gt;&gt;&gt; &gt;&lt;br&gt;
&gt;&gt;&gt; &gt;libvirt: I/O Stream Utils error : this function is not supported \
by&lt;br&gt; &gt;&gt;&gt; &gt;the connection driver: virStreamFinish&lt;br&gt;
&gt;&gt;&gt; &gt;&lt;br&gt;
&gt;&gt;&gt; &gt;libvirt: I/O Stream Utils error : this function is not supported \
by&lt;br&gt; &gt;&gt;&gt; &gt;the connection driver: virStreamEventRemoveCallback&lt;br&gt;
&gt;&gt;&gt; &gt;&lt;br&gt;
&gt;&gt;&gt; &gt;&lt;br&gt;
&gt;&gt;&gt; &gt;Is there other way to stop getting this errors? or perhaps this is a \
bug.&lt;br&gt; &gt;&gt;&gt; &gt;&lt;br&gt;
&gt;&gt;&gt;&lt;br&gt;
&gt;&gt;&gt; This sounds like a bug.   Do you get no other event than just \
_READABLE?&lt;br&gt; &gt;&gt;&gt; No _HANGUP or _ERROR?   Does virStreamAbort() work, even \
though it's&lt;br&gt; &gt;&gt;&gt; probably not what you are looking for?&lt;br&gt;
&gt;&gt;&gt;&lt;br&gt;
&gt;&gt;&gt; &gt;Thanks in advance.&lt;br&gt;
&gt;&gt;&gt; &gt;&lt;br&gt;
&gt;&gt;&gt; &gt;Jose Valencia&lt;br&gt;
&gt;&gt;&gt;&lt;br&gt;
&gt;&gt;&gt; &gt;_______________________________________________&lt;br&gt;
&gt;&gt;&gt; &gt;libvirt-users mailing list&lt;br&gt;
&gt;&gt;&gt; &gt;&lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &gt;&gt;&gt; &gt;&lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt; \
&gt;&gt;&gt;&lt;br&gt; &lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&gt;_______________________________________________&lt;br&gt;
&gt;libvirt-users mailing list&lt;br&gt;
&gt;&lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &gt;&lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt; \
&lt;/blockquote&gt;&lt;/div&gt;



</body></email><email><emailId>20170524141113</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-05-24 14:11:13-0400</timestampReceived><subject>Re: [libvirt-users] No way to stop virStream error after guest stop</subject><body>


On Wed, May 17, 2017 at 07:53:35PM +0000, Jos=C9 Luis Valencia Gutierrez wr=
ote:
&gt;I just tried removing the callback before calling virStreamFinish and it
&gt;worked right, I thought by simply finish the stream would stop the events
&gt;and close it, the example I was based on only calls virStreamFinish on EOF
&gt;event.
&gt;

I'm working on a patch that removes the callbacks after calling Finish.
Our docs don't really say it's needed and I don't (yet) see the point in
requiring that.

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170516194933</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-05-16 19:49:33-0400</timestampReceived><subject>Re: [libvirt-users] Duplicate reboot events</subject><body>


On Tue, May 16, 2017 at 06:41:05PM +0000, Innus, Martins wrote:
&gt; Hi,
&gt; 
&gt; Running on:
&gt; 
&gt; $ cat /etc/redhat-release
&gt; CentOS Linux release 7.3.1611 (Core)
&gt; 
&gt; And:
&gt; 
&gt; $ rpm -qa |grep libvirt
&gt; libvirt-daemon-2.0.0-10.el7_3.5.x86_64
&gt; libvirt-daemon-driver-qemu-2.0.0-10.el7_3.5.x86_64
&gt; libvirt-daemon-driver-secret-2.0.0-10.el7_3.5.x86_64
&gt; libvirt-client-2.0.0-10.el7_3.5.x86_64
&gt; libvirt-daemon-driver-network-2.0.0-10.el7_3.5.x86_64
&gt; libvirt-daemon-driver-storage-2.0.0-10.el7_3.5.x86_64
&gt; libvirt-daemon-config-nwfilter-2.0.0-10.el7_3.5.x86_64
&gt; libvirt-daemon-config-network-2.0.0-10.el7_3.5.x86_64
&gt; libvirt-daemon-driver-nodedev-2.0.0-10.el7_3.5.x86_64
&gt; libvirt-2.0.0-10.el7_3.5.x86_64
&gt; libvirt-python-2.0.0-2.el7.x86_64
&gt; libvirt-daemon-driver-nwfilter-2.0.0-10.el7_3.5.x86_64
&gt; libvirt-daemon-driver-lxc-2.0.0-10.el7_3.5.x86_64
&gt; libvirt-daemon-driver-interface-2.0.0-10.el7_3.5.x86_64
&gt; 
&gt; I'm seeing duplicated reboot events when using the python event api.  Use is \
&gt; simplified down to the simple test case attached.  Running with that results in: 
&gt; $ sudo ./libvirt_events_single.py
&gt; Reboot: Domain i-06945b37(21)
&gt; 1494958504.72
&gt; Reboot: Domain i-06945b37(21)
&gt; 1494958504.74
&gt; 

Can you try with newer libvirt?  Does this happen with 'virsh event
--loop --event lifecycle'?

Is there anything fishy going on when looking at the console (VN/spice)
during that reboot?

&gt; This is reproducible 100% of the time by doing /sbin/reboot from within a VM \
&gt; started with qemu-kvm.  Any ideas on whats going on? 
&gt; Let me know if any other information would be useful.
&gt; 
&gt; Thanks
&gt; 
&gt; Martins
&gt; 

&gt; #!/usr/bin/env python
&gt; 
&gt; import libvirt
&gt; import time
&gt; 
&gt; def RBcallback(conn, dom, opaque):
&gt; print "Reboot: Domain %s(%s)" % (dom.name(), dom.ID())
&gt; print time.time()
&gt; 
&gt; if __name__ == '__main__':
&gt; 
&gt; libvirt.virEventRegisterDefaultImpl()
&gt; 
&gt; conn = libvirt.openReadOnly('qemu:///system')
&gt; 
&gt; conn.domainEventRegisterAny(None, libvirt.VIR_DOMAIN_EVENT_ID_REBOOT, RBcallback, \
&gt; None) 
&gt; while True:
&gt; libvirt.virEventRunDefaultImpl()

&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170516201154</emailId><senderName>"Innus, Martins"</senderName><senderEmail>minnus@buffalo.edu</senderEmail><timestampReceived>2017-05-16 20:11:54-0400</timestampReceived><subject>Re: [libvirt-users] Duplicate reboot events</subject><body>


&gt; On May 16, 2017, at 3:49 PM, Martin Kletzander &lt;mkletzan@redhat.com&gt; wrote:
&gt; 
&gt; On Tue, May 16, 2017 at 06:41:05PM +0000, Innus, Martins wrote:
&gt; &gt; Hi,
&gt; &gt; 
&gt; &gt; Running on:
&gt; &gt; 
&gt; &gt; $ cat /etc/redhat-release
&gt; &gt; CentOS Linux release 7.3.1611 (Core)
&gt; &gt; 
&gt; &gt; And:
&gt; &gt; 
&gt; &gt; $ rpm -qa |grep libvirt
&gt; &gt; libvirt-daemon-2.0.0-10.el7_3.5.x86_64
&gt; &gt; libvirt-daemon-driver-qemu-2.0.0-10.el7_3.5.x86_64
&gt; &gt; libvirt-daemon-driver-secret-2.0.0-10.el7_3.5.x86_64
&gt; &gt; libvirt-client-2.0.0-10.el7_3.5.x86_64
&gt; &gt; libvirt-daemon-driver-network-2.0.0-10.el7_3.5.x86_64
&gt; &gt; libvirt-daemon-driver-storage-2.0.0-10.el7_3.5.x86_64
&gt; &gt; libvirt-daemon-config-nwfilter-2.0.0-10.el7_3.5.x86_64
&gt; &gt; libvirt-daemon-config-network-2.0.0-10.el7_3.5.x86_64
&gt; &gt; libvirt-daemon-driver-nodedev-2.0.0-10.el7_3.5.x86_64
&gt; &gt; libvirt-2.0.0-10.el7_3.5.x86_64
&gt; &gt; libvirt-python-2.0.0-2.el7.x86_64
&gt; &gt; libvirt-daemon-driver-nwfilter-2.0.0-10.el7_3.5.x86_64
&gt; &gt; libvirt-daemon-driver-lxc-2.0.0-10.el7_3.5.x86_64
&gt; &gt; libvirt-daemon-driver-interface-2.0.0-10.el7_3.5.x86_64
&gt; &gt; 
&gt; &gt; I'm seeing duplicated reboot events when using the python event api.  Use is \
&gt; &gt; simplified down to the simple test case attached.  Running with that results in: 
&gt; &gt; $ sudo ./libvirt_events_single.py
&gt; &gt; Reboot: Domain i-06945b37(21)
&gt; &gt; 1494958504.72
&gt; &gt; Reboot: Domain i-06945b37(21)
&gt; &gt; 1494958504.74
&gt; &gt; 
&gt; 
&gt; Can you try with newer libvirt?

I'm not sure.  I will have to see if I can build it, unless there is a repo somewhere \
with centos7 rpms.  I assume by this you mean that you don't see this with current \
libvirt?

&gt; Does this happen with 'virsh event
&gt; --loop --event lifecycle'?

"lifecycle" shows no output, but with "reboot" or "all":

$ sudo virsh event --loop --all
event 'reboot' for domain i-06945b37
event 'reboot' for domain i-06945b37

&gt; 
&gt; Is there anything fishy going on when looking at the console (VN/spice)
&gt; during that reboot?


Don't see anything unusual.  I can send you the full console output if you want, but \
I don't see anything strange.

Thanks

Martins

&gt; 
&gt; &gt; This is reproducible 100% of the time by doing /sbin/reboot from within a VM \
&gt; &gt; started with qemu-kvm.  Any ideas on whats going on? 
&gt; &gt; Let me know if any other information would be useful.
&gt; &gt; 
&gt; &gt; Thanks
&gt; &gt; 
&gt; &gt; Martins
&gt; &gt; 
&gt; 
&gt; &gt; #!/usr/bin/env python
&gt; &gt; 
&gt; &gt; import libvirt
&gt; &gt; import time
&gt; &gt; 
&gt; &gt; def RBcallback(conn, dom, opaque):
&gt; &gt; print "Reboot: Domain %s(%s)" % (dom.name(), dom.ID())
&gt; &gt; print time.time()
&gt; &gt; 
&gt; &gt; if __name__ == '__main__':
&gt; &gt; 
&gt; &gt; libvirt.virEventRegisterDefaultImpl()
&gt; &gt; 
&gt; &gt; conn = libvirt.openReadOnly('qemu:///system')
&gt; &gt; 
&gt; &gt; conn.domainEventRegisterAny(None, libvirt.VIR_DOMAIN_EVENT_ID_REBOOT, RBcallback, \
&gt; &gt; None) 
&gt; &gt; while True:
&gt; &gt; libvirt.virEventRunDefaultImpl()
&gt; 
&gt; &gt; _______________________________________________
&gt; &gt; libvirt-users mailing list
&gt; &gt; libvirt-users@redhat.com
&gt; &gt; https://www.redhat.com/mailman/listinfo/libvirt-users


</body></email><email><emailId>20170516202801</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-05-16 20:28:01-0400</timestampReceived><subject>Re: [libvirt-users] Duplicate reboot events</subject><body>


On Tue, May 16, 2017 at 08:11:54PM +0000, Innus, Martins wrote:
&gt; 
&gt; &gt; On May 16, 2017, at 3:49 PM, Martin Kletzander &lt;mkletzan@redhat.com&gt; wrote:
&gt; &gt; 
&gt; &gt; On Tue, May 16, 2017 at 06:41:05PM +0000, Innus, Martins wrote:
&gt; &gt; &gt; Hi,
&gt; &gt; &gt; 
&gt; &gt; &gt; Running on:
&gt; &gt; &gt; 
&gt; &gt; &gt; $ cat /etc/redhat-release
&gt; &gt; &gt; CentOS Linux release 7.3.1611 (Core)
&gt; &gt; &gt; 
&gt; &gt; &gt; And:
&gt; &gt; &gt; 
&gt; &gt; &gt; $ rpm -qa |grep libvirt
&gt; &gt; &gt; libvirt-daemon-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; libvirt-daemon-driver-qemu-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; libvirt-daemon-driver-secret-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; libvirt-client-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; libvirt-daemon-driver-network-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; libvirt-daemon-driver-storage-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; libvirt-daemon-config-nwfilter-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; libvirt-daemon-config-network-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; libvirt-daemon-driver-nodedev-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; libvirt-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; libvirt-python-2.0.0-2.el7.x86_64
&gt; &gt; &gt; libvirt-daemon-driver-nwfilter-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; libvirt-daemon-driver-lxc-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; libvirt-daemon-driver-interface-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; 
&gt; &gt; &gt; I'm seeing duplicated reboot events when using the python event api.  Use is \
&gt; &gt; &gt; simplified down to the simple test case attached.  Running with that results \
&gt; &gt; &gt; in: 
&gt; &gt; &gt; $ sudo ./libvirt_events_single.py
&gt; &gt; &gt; Reboot: Domain i-06945b37(21)
&gt; &gt; &gt; 1494958504.72
&gt; &gt; &gt; Reboot: Domain i-06945b37(21)
&gt; &gt; &gt; 1494958504.74
&gt; &gt; &gt; 
&gt; &gt; 
&gt; &gt; Can you try with newer libvirt?
&gt; 
&gt; I'm not sure.  I will have to see if I can build it, unless there is a repo \
&gt; somewhere with centos7 rpms.  I assume by this you mean that you don't see this \
&gt; with current libvirt? 
&gt; &gt; Does this happen with 'virsh event
&gt; &gt; --loop --event lifecycle'?
&gt; 
&gt; "lifecycle" shows no output, but with "reboot" or "all":
&gt; 
&gt; $ sudo virsh event --loop --all
&gt; event 'reboot' for domain i-06945b37
&gt; event 'reboot' for domain i-06945b37
&gt; 
&gt; &gt; 
&gt; &gt; Is there anything fishy going on when looking at the console (VN/spice)
&gt; &gt; during that reboot?
&gt; 
&gt; 
&gt; Don't see anything unusual.  I can send you the full console output if you want, \
&gt; but I don't see anything strange. 

I meant the graphical terminal, but that won't help much.  I tried
gathering as much info.  So we just need to figure out whether QEMU
sends us the event multiple times.  Could you either set up debug logs
[1] and then look for that in them or use the qemu-monitor.stp systemtap
script to show you what's happening on the monitor?  If it comes from
qemu two times, than there's not much we can do about it.

Martin

[1] http://wiki.libvirt.org/page/DebugLogs


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170517142402</emailId><senderName>"Innus, Martins"</senderName><senderEmail>minnus@buffalo.edu</senderEmail><timestampReceived>2017-05-17 14:24:02-0400</timestampReceived><subject>Re: [libvirt-users] Duplicate reboot events</subject><body>


&gt; On May 16, 2017, at 4:28 PM, Martin Kletzander &lt;mkletzan@redhat.com&gt; wrote:
&gt; 
&gt; On Tue, May 16, 2017 at 08:11:54PM +0000, Innus, Martins wrote:
&gt; &gt; 
&gt; &gt; &gt; On May 16, 2017, at 3:49 PM, Martin Kletzander &lt;mkletzan@redhat.com&gt; wrote:
&gt; &gt; &gt; 
&gt; &gt; &gt; On Tue, May 16, 2017 at 06:41:05PM +0000, Innus, Martins wrote:
&gt; &gt; &gt; &gt; Hi,
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Running on:
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; $ cat /etc/redhat-release
&gt; &gt; &gt; &gt; CentOS Linux release 7.3.1611 (Core)
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; And:
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; $ rpm -qa |grep libvirt
&gt; &gt; &gt; &gt; libvirt-daemon-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; &gt; libvirt-daemon-driver-qemu-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; &gt; libvirt-daemon-driver-secret-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; &gt; libvirt-client-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; &gt; libvirt-daemon-driver-network-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; &gt; libvirt-daemon-driver-storage-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; &gt; libvirt-daemon-config-nwfilter-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; &gt; libvirt-daemon-config-network-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; &gt; libvirt-daemon-driver-nodedev-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; &gt; libvirt-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; &gt; libvirt-python-2.0.0-2.el7.x86_64
&gt; &gt; &gt; &gt; libvirt-daemon-driver-nwfilter-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; &gt; libvirt-daemon-driver-lxc-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; &gt; libvirt-daemon-driver-interface-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; I'm seeing duplicated reboot events when using the python event api.  Use is \
&gt; &gt; &gt; &gt; simplified down to the simple test case attached.  Running with that results \
&gt; &gt; &gt; &gt; in: 
&gt; &gt; &gt; &gt; $ sudo ./libvirt_events_single.py
&gt; &gt; &gt; &gt; Reboot: Domain i-06945b37(21)
&gt; &gt; &gt; &gt; 1494958504.72
&gt; &gt; &gt; &gt; Reboot: Domain i-06945b37(21)
&gt; &gt; &gt; &gt; 1494958504.74
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; Can you try with newer libvirt?
&gt; &gt; 
&gt; &gt; I'm not sure.  I will have to see if I can build it, unless there is a repo \
&gt; &gt; somewhere with centos7 rpms.  I assume by this you mean that you don't see this \
&gt; &gt; with current libvirt? 
&gt; &gt; &gt; Does this happen with 'virsh event
&gt; &gt; &gt; --loop --event lifecycle'?
&gt; &gt; 
&gt; &gt; "lifecycle" shows no output, but with "reboot" or "all":
&gt; &gt; 
&gt; &gt; $ sudo virsh event --loop --all
&gt; &gt; event 'reboot' for domain i-06945b37
&gt; &gt; event 'reboot' for domain i-06945b37
&gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; Is there anything fishy going on when looking at the console (VN/spice)
&gt; &gt; &gt; during that reboot?
&gt; &gt; 
&gt; &gt; 
&gt; &gt; Don't see anything unusual.  I can send you the full console output if you want, \
&gt; &gt; but I don't see anything strange. 
&gt; 
&gt; I meant the graphical terminal, but that won't help much.  I tried
&gt; gathering as much info.  So we just need to figure out whether QEMU
&gt; sends us the event multiple times.  Could you either set up debug logs
&gt; [1] and then look for that in them or use the qemu-monitor.stp systemtap
&gt; script to show you what's happening on the monitor?  If it comes from
&gt; qemu two times, than there's not much we can do about it.
&gt; 


So I guess with:

$ sudo virsh qemu-monitor-event i-06945b37 --pretty --loop
event RESET at 1495030343.874769 for domain i-06945b37: &lt;null&gt;
event RESET at 1495030343.896221 for domain i-06945b37: &lt;null&gt;

And the following in the debug logs:


2017-05-17 14:21:03.369+0000: 31471: info : qemuMonitorJSONIOProcessLine:206 : \
QEMU_MONITOR_RECV_EVENT: mon=0x7f5a24000f50 event={"timestamp": {"seconds": \
1495030863, "microseconds": 369485}, "event": "RESET"} 2017-05-17 14:21:03.384+0000: \
31471: info : qemuMonitorJSONIOProcessLine:206 : QEMU_MONITOR_RECV_EVENT: \
mon=0x7f5a24000f50 event={"timestamp": {"seconds": 1495030863, "microseconds": \
383626}, "event": "RESET"}

That means its coming from QEMU right?  Any suggestions besides bugging the QEMU \
folks?

Thanks

Martins


</body></email><email><emailId>20170517151418</emailId><senderName>"Innus, Martins"</senderName><senderEmail>minnus@buffalo.edu</senderEmail><timestampReceived>2017-05-17 15:14:18-0400</timestampReceived><subject>Re: [libvirt-users] Duplicate reboot events</subject><body>

[Attachment #2 (text/plain)]


On May 16, 2017, at 4:28 PM, Martin Kletzander \
&lt;mkletzan@redhat.com&lt;mailto:mkletzan@redhat.com&gt;&gt; wrote:

On Tue, May 16, 2017 at 08:11:54PM +0000, Innus, Martins wrote:

On May 16, 2017, at 3:49 PM, Martin Kletzander \
&lt;mkletzan@redhat.com&lt;mailto:mkletzan@redhat.com&gt;&gt; wrote:

On Tue, May 16, 2017 at 06:41:05PM +0000, Innus, Martins wrote:
Hi,

Running on:

$ cat /etc/redhat-release
CentOS Linux release 7.3.1611 (Core)

And:

$ rpm -qa |grep libvirt
libvirt-daemon-2.0.0-10.el7_3.5.x86_64
libvirt-daemon-driver-qemu-2.0.0-10.el7_3.5.x86_64
libvirt-daemon-driver-secret-2.0.0-10.el7_3.5.x86_64
libvirt-client-2.0.0-10.el7_3.5.x86_64
libvirt-daemon-driver-network-2.0.0-10.el7_3.5.x86_64
libvirt-daemon-driver-storage-2.0.0-10.el7_3.5.x86_64
libvirt-daemon-config-nwfilter-2.0.0-10.el7_3.5.x86_64
libvirt-daemon-config-network-2.0.0-10.el7_3.5.x86_64
libvirt-daemon-driver-nodedev-2.0.0-10.el7_3.5.x86_64
libvirt-2.0.0-10.el7_3.5.x86_64
libvirt-python-2.0.0-2.el7.x86_64
libvirt-daemon-driver-nwfilter-2.0.0-10.el7_3.5.x86_64
libvirt-daemon-driver-lxc-2.0.0-10.el7_3.5.x86_64
libvirt-daemon-driver-interface-2.0.0-10.el7_3.5.x86_64

I'm seeing duplicated reboot events when using the python event api.  Use is \
simplified down to the simple test case attached.  Running with that results in:

$ sudo ./libvirt_events_single.py
Reboot: Domain i-06945b37(21)
1494958504.72
Reboot: Domain i-06945b37(21)
1494958504.74


Can you try with newer libvirt?

I'm not sure.  I will have to see if I can build it, unless there is a repo somewhere \
with centos7 rpms.  I assume by this you mean that you don't see this with current \
libvirt?

Does this happen with 'virsh event
--loop --event lifecycle'?

"lifecycle" shows no output, but with "reboot" or "all":

$ sudo virsh event --loop --all
event 'reboot' for domain i-06945b37
event 'reboot' for domain i-06945b37


Is there anything fishy going on when looking at the console (VN/spice)
during that reboot?


Don't see anything unusual.  I can send you the full console output if you want, but \
I don't see anything strange.


I meant the graphical terminal, but that won't help much.  I tried
gathering as much info.  So we just need to figure out whether QEMU
sends us the event multiple times.  Could you either set up debug logs
[1] and then look for that in them or use the qemu-monitor.stp systemtap
script to show you what's happening on the monitor?  If it comes from
qemu two times, than there's not much we can do about it.



Nevermind, as far as I can tell, this is a bug in QEMU and is closed as a WONTFIX: \
https://bugzilla.redhat.com/show_bug.cgi?id=951525

Thanks for the debugging help.

Martins


[Attachment #3 (text/html)]

&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
&lt;/head&gt;
&lt;body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: \
after-white-space;" class=""&gt; &lt;br class=""&gt;
&lt;div&gt;
&lt;blockquote type="cite" class=""&gt;
&lt;div class=""&gt;On May 16, 2017, at 4:28 PM, Martin Kletzander &lt;&lt;a \
href="mailto:mkletzan@redhat.com" class=""&gt;mkletzan@redhat.com&lt;/a&gt;&gt; wrote:&lt;/div&gt; \
&lt;br class="Apple-interchange-newline"&gt; &lt;div class=""&gt;
&lt;div class=""&gt;On Tue, May 16, 2017 at 08:11:54PM +0000, Innus, Martins wrote:&lt;br \
class=""&gt; &lt;blockquote type="cite" class=""&gt;&lt;br class=""&gt;
&lt;blockquote type="cite" class=""&gt;On May 16, 2017, at 3:49 PM, Martin Kletzander \
&lt;&lt;a href="mailto:mkletzan@redhat.com" class=""&gt;mkletzan@redhat.com&lt;/a&gt;&gt; \
wrote:&lt;br class=""&gt; &lt;br class=""&gt;
On Tue, May 16, 2017 at 06:41:05PM +0000, Innus, Martins wrote:&lt;br class=""&gt;
&lt;blockquote type="cite" class=""&gt;Hi,&lt;br class=""&gt;
&lt;br class=""&gt;
Running on:&lt;br class=""&gt;
&lt;br class=""&gt;
$ cat /etc/redhat-release&lt;br class=""&gt;
CentOS Linux release 7.3.1611 (Core)&lt;br class=""&gt;
&lt;br class=""&gt;
And:&lt;br class=""&gt;
&lt;br class=""&gt;
$ rpm -qa |grep libvirt&lt;br class=""&gt;
libvirt-daemon-2.0.0-10.el7_3.5.x86_64&lt;br class=""&gt;
libvirt-daemon-driver-qemu-2.0.0-10.el7_3.5.x86_64&lt;br class=""&gt;
libvirt-daemon-driver-secret-2.0.0-10.el7_3.5.x86_64&lt;br class=""&gt;
libvirt-client-2.0.0-10.el7_3.5.x86_64&lt;br class=""&gt;
libvirt-daemon-driver-network-2.0.0-10.el7_3.5.x86_64&lt;br class=""&gt;
libvirt-daemon-driver-storage-2.0.0-10.el7_3.5.x86_64&lt;br class=""&gt;
libvirt-daemon-config-nwfilter-2.0.0-10.el7_3.5.x86_64&lt;br class=""&gt;
libvirt-daemon-config-network-2.0.0-10.el7_3.5.x86_64&lt;br class=""&gt;
libvirt-daemon-driver-nodedev-2.0.0-10.el7_3.5.x86_64&lt;br class=""&gt;
libvirt-2.0.0-10.el7_3.5.x86_64&lt;br class=""&gt;
libvirt-python-2.0.0-2.el7.x86_64&lt;br class=""&gt;
libvirt-daemon-driver-nwfilter-2.0.0-10.el7_3.5.x86_64&lt;br class=""&gt;
libvirt-daemon-driver-lxc-2.0.0-10.el7_3.5.x86_64&lt;br class=""&gt;
libvirt-daemon-driver-interface-2.0.0-10.el7_3.5.x86_64&lt;br class=""&gt;
&lt;br class=""&gt;
I'm seeing duplicated reboot events when using the python event api.  Use is \
simplified down to the simple test case attached.  Running with that results \
in:&lt;br class=""&gt; &lt;br class=""&gt;
$ sudo ./libvirt_events_single.py&lt;br class=""&gt;
Reboot: Domain i-06945b37(21)&lt;br class=""&gt;
1494958504.72&lt;br class=""&gt;
Reboot: Domain i-06945b37(21)&lt;br class=""&gt;
1494958504.74&lt;br class=""&gt;
&lt;br class=""&gt;
&lt;/blockquote&gt;
&lt;br class=""&gt;
Can you try with newer libvirt?&lt;br class=""&gt;
&lt;/blockquote&gt;
&lt;br class=""&gt;
I'm not sure.  I will have to see if I can build it, unless there is a repo \
somewhere with centos7 rpms.  I assume by this you mean that you don't see this \
with current libvirt?&lt;br class=""&gt; &lt;br class=""&gt;
&lt;blockquote type="cite" class=""&gt;Does this happen with 'virsh event&lt;br class=""&gt;
--loop --event lifecycle'?&lt;br class=""&gt;
&lt;/blockquote&gt;
&lt;br class=""&gt;
"lifecycle" shows no output, but with "reboot" or "all":&lt;br class=""&gt;
&lt;br class=""&gt;
$ sudo virsh event --loop --all&lt;br class=""&gt;
event 'reboot' for domain i-06945b37&lt;br class=""&gt;
event 'reboot' for domain i-06945b37&lt;br class=""&gt;
&lt;br class=""&gt;
&lt;blockquote type="cite" class=""&gt;&lt;br class=""&gt;
Is there anything fishy going on when looking at the console (VN/spice)&lt;br class=""&gt;
during that reboot?&lt;br class=""&gt;
&lt;/blockquote&gt;
&lt;br class=""&gt;
&lt;br class=""&gt;
Don't see anything unusual.  I can send you the full console output if you want, \
but I don't see anything strange.&lt;br class=""&gt; &lt;br class=""&gt;
&lt;/blockquote&gt;
&lt;br class=""&gt;
I meant the graphical terminal, but that won't help much.  I tried&lt;br class=""&gt;
gathering as much info.  So we just need to figure out whether QEMU&lt;br class=""&gt;
sends us the event multiple times.  Could you either set up debug logs&lt;br \
class=""&gt; [1] and then look for that in them or use the qemu-monitor.stp systemtap&lt;br \
class=""&gt; script to show you what's happening on the monitor?  If it comes \
from&lt;br class=""&gt; qemu two times, than there's not much we can do about it.&lt;br \
class=""&gt; &lt;br class=""&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/blockquote&gt;
&lt;br class=""&gt;
&lt;/div&gt;
&lt;div&gt;&lt;br class=""&gt;
&lt;/div&gt;
&lt;div&gt;Nevermind, as far as I can tell, this is a bug in QEMU and is closed as a \
WONTFIX: &lt;a href="https://bugzilla.redhat.com/show_bug.cgi?id=951525" \
class=""&gt;https://bugzilla.redhat.com/show_bug.cgi?id=951525&lt;/a&gt;&lt;/div&gt; &lt;div&gt;&lt;br \
class=""&gt; &lt;/div&gt;
&lt;div&gt;Thanks for the debugging help.&lt;/div&gt;
&lt;div&gt;&lt;br class=""&gt;
&lt;/div&gt;
&lt;div&gt;Martins&lt;/div&gt;
&lt;div&gt;&lt;br class=""&gt;
&lt;/div&gt;
&lt;br class=""&gt;
&lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170517132412</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-05-17 13:24:12-0400</timestampReceived><subject>Re: [libvirt-users] Callback re-registration after libvirtd restart</subject><body>

On Wed, May 17, 2017 at 03:08:23PM +0200, Daniel Kučera wrote:
&gt; Hi all,
&gt; 
&gt; I'm using libvirt-go and I following code to listen for lifecycle events:
&gt; 
&gt; func event_listen() {
&gt;     log.Printf("event_listen %s", conf.Libvirt.LocalUrl)
&gt;     hv, err := libvirt.NewConnect(conf.Libvirt.LocalUrl)
&gt; 
&gt;     lifecycleCallback := func(c *libvirt.Connect, d *libvirt.Domain, event
&gt; *libvirt.DomainEventLifecycle) {
&gt;         event_message(c, d, "lifecycle", event)
&gt;     }
&gt; 
&gt;     _, err = hv.DomainEventLifecycleRegister(nil, lifecycleCallback)
&gt;     if err != nil {
&gt;         log.Printf("unable to register event callback")
&gt;         return
&gt;     }
&gt; 
&gt;     log.Printf("Libvirt event listener started")
&gt; 
&gt;     go func() {
&gt;         for err == nil {
&gt;             err = libvirt.EventRunDefaultImpl()
&gt;             log.Printf("EventRunDefaultImpl err: %+v", err)
&gt;         }
&gt;         time.Sleep(time.Second)
&gt;         event_listen()
&gt;     }()
&gt; 
&gt; }
&gt; 
&gt; It works ok until I restart libvirtd (service libvirtd restart). After
&gt; that, the inner go func waits some time and continues without error. But
&gt; the callback is not working anymore.
&gt; 
&gt; My question is, how can I detect hv reconnect (I guess it's happening in
&gt; background) so I know when to reinitialize callbacks?

There is a separate event you can listen to that notifies when the connection
is closed. See the RegisterCloseCallback() method on the Connect object.

Basically register a callback there, and when it fires, unregister your
existing domain event callbacks, and close your existing Connect object
handle. Then fire a goroutine that loops once every few seconds trying
to open a new Connect object, and when that succeeds register new
domain event callbacks.

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170517134109</emailId><senderName>Daniel_Kučera</senderName><senderEmail>libvirt@danman.eu</senderEmail><timestampReceived>2017-05-17 13:41:09-0400</timestampReceived><subject>Re: [libvirt-users] Callback re-registration after libvirtd restart</subject><body>

Hi Daniel,

I tried that but it doesn't work:

func libvirt_close_callback(conn *libvirt.Connect, reason
libvirt.ConnectCloseReason){
    log.Printf("close callback: %+v", reason)
}

func event_listen() {
    log.Printf("event_listen %s", conf.Libvirt.LocalUrl)
    hv, err := libvirt.NewConnect(conf.Libvirt.LocalUrl)

    err = hv.RegisterCloseCallback(libvirt_close_callback)
    if err != nil {
        log.Printf("unable to register close callback")
        return
    }
...

The callback fires only when I kill my app,

^CGot signal:%!(EXTRA syscall.Signal=interrupt)
close callback: 0

but not when I restart libvirtd. I tried using both local and remote
connect URIs: qemu+ssh://10.130.16.101/system, qemu+ssh://localhost/system,
qemu+ssh:///system

Thanks.

D.


2017-05-17 15:24 GMT+02:00 Daniel P. Berrange &lt;berrange@redhat.com&gt;:

&gt; On Wed, May 17, 2017 at 03:08:23PM +0200, Daniel Kučera wrote:
&gt; &gt; Hi all,
&gt; &gt;
&gt; &gt; I'm using libvirt-go and I following code to listen for lifecycle events:
&gt; &gt;
&gt; &gt; func event_listen() {
&gt; &gt;     log.Printf("event_listen %s", conf.Libvirt.LocalUrl)
&gt; &gt;     hv, err := libvirt.NewConnect(conf.Libvirt.LocalUrl)
&gt; &gt;
&gt; &gt;     lifecycleCallback := func(c *libvirt.Connect, d *libvirt.Domain,
&gt; event
&gt; &gt; *libvirt.DomainEventLifecycle) {
&gt; &gt;         event_message(c, d, "lifecycle", event)
&gt; &gt;     }
&gt; &gt;
&gt; &gt;     _, err = hv.DomainEventLifecycleRegister(nil, lifecycleCallback)
&gt; &gt;     if err != nil {
&gt; &gt;         log.Printf("unable to register event callback")
&gt; &gt;         return
&gt; &gt;     }
&gt; &gt;
&gt; &gt;     log.Printf("Libvirt event listener started")
&gt; &gt;
&gt; &gt;     go func() {
&gt; &gt;         for err == nil {
&gt; &gt;             err = libvirt.EventRunDefaultImpl()
&gt; &gt;             log.Printf("EventRunDefaultImpl err: %+v", err)
&gt; &gt;         }
&gt; &gt;         time.Sleep(time.Second)
&gt; &gt;         event_listen()
&gt; &gt;     }()
&gt; &gt;
&gt; &gt; }
&gt; &gt;
&gt; &gt; It works ok until I restart libvirtd (service libvirtd restart). After
&gt; &gt; that, the inner go func waits some time and continues without error. But
&gt; &gt; the callback is not working anymore.
&gt; &gt;
&gt; &gt; My question is, how can I detect hv reconnect (I guess it's happening in
&gt; &gt; background) so I know when to reinitialize callbacks?
&gt;
&gt; There is a separate event you can listen to that notifies when the
&gt; connection
&gt; is closed. See the RegisterCloseCallback() method on the Connect object.
&gt;
&gt; Basically register a callback there, and when it fires, unregister your
&gt; existing domain event callbacks, and close your existing Connect object
&gt; handle. Then fire a goroutine that loops once every few seconds trying
&gt; to open a new Connect object, and when that succeeds register new
&gt; domain event callbacks.
&gt;
&gt; Regards,
&gt; Daniel
&gt; --
&gt; |: https://berrange.com      -o-    https://www.flickr.com/photos/
&gt; dberrange :|
&gt; |: https://libvirt.org         -o-
&gt; https://fstop138.berrange.com :|
&gt; |: https://entangle-photo.org    -o-    https://www.instagram.com/
&gt; dberrange :|
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hi Daniel,&lt;br&gt;&lt;br&gt;&lt;/div&gt;I tried that but it \
doesn't work:&lt;br&gt;&lt;br&gt;func libvirt_close_callback(conn *libvirt.Connect, reason \
libvirt.ConnectCloseReason){&lt;br&gt;       log.Printf("close callback: %+v", \
reason)&lt;br&gt;}&lt;br&gt;&lt;br&gt;func event_listen() {&lt;br&gt;       log.Printf("event_listen \
%s", conf.Libvirt.LocalUrl)&lt;br&gt;       hv, err := \
libvirt.NewConnect(conf.Libvirt.LocalUrl)&lt;br&gt;&lt;br&gt;       err = \
hv.RegisterCloseCallback(libvirt_close_callback)&lt;br&gt;       if err != nil {&lt;br&gt;        \
log.Printf("unable to register close callback")&lt;br&gt;              return&lt;br&gt; \
}&lt;br&gt;...&lt;br&gt;&lt;br&gt;&lt;/div&gt;The callback fires only when I kill my app, &lt;br&gt;&lt;br&gt;^CGot \
signal:%!(EXTRA syscall.Signal=interrupt)&lt;br&gt;close callback: 0&lt;br&gt;&lt;br&gt;but not when I \
restart libvirtd. I tried using both local and remote connect URIs: qemu+ssh://&lt;a \
href="http://10.130.16.101/system"&gt;10.130.16.101/system&lt;/a&gt;, \
qemu+ssh://localhost/system, \
qemu+ssh:///system&lt;br&gt;&lt;br&gt;&lt;/div&gt;Thanks.&lt;br&gt;&lt;br&gt;&lt;/div&gt;D.&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-05-17 15:24 GMT+02:00 Daniel P. \
Berrange &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:berrange@redhat.com" \
target="_blank"&gt;berrange@redhat.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div class="HOEnZb"&gt;&lt;div class="h5"&gt;On Wed, May 17, 2017 at \
03:08:23PM +0200, Daniel Kučera wrote:&lt;br&gt; &gt; Hi all,&lt;br&gt;
&gt;&lt;br&gt;
&gt; I'm using libvirt-go and I following code to listen for lifecycle \
events:&lt;br&gt; &gt;&lt;br&gt;
&gt; func event_listen() {&lt;br&gt;
&gt;        log.Printf("event_listen %s", conf.Libvirt.LocalUrl)&lt;br&gt;
&gt;        hv, err := libvirt.NewConnect(conf.&lt;wbr&gt;Libvirt.LocalUrl)&lt;br&gt;
&gt;&lt;br&gt;
&gt;        lifecycleCallback := func(c *libvirt.Connect, d *libvirt.Domain, \
event&lt;br&gt; &gt; *libvirt.DomainEventLifecycle) {&lt;br&gt;
&gt;              event_message(c, d, "lifecycle", event)&lt;br&gt;
&gt;        }&lt;br&gt;
&gt;&lt;br&gt;
&gt;        _, err = hv.&lt;wbr&gt;DomainEventLifecycleRegister(&lt;wbr&gt;nil, \
lifecycleCallback)&lt;br&gt; &gt;        if err != nil {&lt;br&gt;
&gt;              log.Printf("unable to register event callback")&lt;br&gt;
&gt;              return&lt;br&gt;
&gt;        }&lt;br&gt;
&gt;&lt;br&gt;
&gt;        log.Printf("Libvirt event listener started")&lt;br&gt;
&gt;&lt;br&gt;
&gt;        go func() {&lt;br&gt;
&gt;              for err == nil {&lt;br&gt;
&gt;                    err = libvirt.EventRunDefaultImpl()&lt;br&gt;
&gt;                    log.Printf("&lt;wbr&gt;EventRunDefaultImpl err: %+v", \
err)&lt;br&gt; &gt;              }&lt;br&gt;
&gt;              time.Sleep(time.Second)&lt;br&gt;
&gt;              event_listen()&lt;br&gt;
&gt;        }()&lt;br&gt;
&gt;&lt;br&gt;
&gt; }&lt;br&gt;
&gt;&lt;br&gt;
&gt; It works ok until I restart libvirtd (service libvirtd restart). After&lt;br&gt;
&gt; that, the inner go func waits some time and continues without error. But&lt;br&gt;
&gt; the callback is not working anymore.&lt;br&gt;
&gt;&lt;br&gt;
&gt; My question is, how can I detect hv reconnect (I guess it's happening in&lt;br&gt;
&gt; background) so I know when to reinitialize callbacks?&lt;br&gt;
&lt;br&gt;
&lt;/div&gt;&lt;/div&gt;There is a separate event you can listen to that notifies when the \
connection&lt;br&gt; is closed. See the RegisterCloseCallback() method on the Connect \
object.&lt;br&gt; &lt;br&gt;
Basically register a callback there, and when it fires, unregister your&lt;br&gt;
existing domain event callbacks, and close your existing Connect object&lt;br&gt;
handle. Then fire a goroutine that loops once every few seconds trying&lt;br&gt;
to open a new Connect object, and when that succeeds register new&lt;br&gt;
domain event callbacks.&lt;br&gt;
&lt;br&gt;
Regards,&lt;br&gt;
Daniel&lt;br&gt;
&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;--&lt;br&gt;
&gt; &gt; &lt;a href="https://berrange.com" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://berrange.com&lt;/a&gt;         -o-      &lt;a \
&gt; &gt; href="https://www.flickr.com/photos/dberrange" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://www.flickr.com/photos/&lt;wbr&gt;dberrange&lt;/a&gt; :|&lt;br&gt;
&gt; &gt; &lt;a href="https://libvirt.org" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://libvirt.org&lt;/a&gt;              -o-                  &lt;a \
&gt; &gt; href="https://fstop138.berrange.com" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://fstop138.berrange.com&lt;/a&gt; :|&lt;br&gt;
&gt; &gt; &lt;a href="https://entangle-photo.org" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://entangle-photo.org&lt;/a&gt;      -o-      &lt;a \
&gt; &gt; href="https://www.instagram.com/dberrange" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://www.instagram.com/&lt;wbr&gt;dberrange&lt;/a&gt; :|&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170517134743</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-05-17 13:47:43-0400</timestampReceived><subject>Re: [libvirt-users] Callback re-registration after libvirtd restart</subject><body>

On Wed, May 17, 2017 at 03:41:09PM +0200, Daniel Kučera wrote:
&gt; Hi Daniel,
&gt; 
&gt; I tried that but it doesn't work:
&gt; 
&gt; func libvirt_close_callback(conn *libvirt.Connect, reason
&gt; libvirt.ConnectCloseReason){
&gt;     log.Printf("close callback: %+v", reason)
&gt; }
&gt; 
&gt; func event_listen() {
&gt;     log.Printf("event_listen %s", conf.Libvirt.LocalUrl)
&gt;     hv, err := libvirt.NewConnect(conf.Libvirt.LocalUrl)
&gt; 
&gt;     err = hv.RegisterCloseCallback(libvirt_close_callback)
&gt;     if err != nil {
&gt;         log.Printf("unable to register close callback")
&gt;         return
&gt;     }
&gt; ...
&gt; 
&gt; The callback fires only when I kill my app,

Looks like you are missing a call to libvirt.EventRegisterDefaultImpl(),
which must be the first you do do before even connecting to libvirt.


Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170517134945</emailId><senderName>Daniel_Kučera</senderName><senderEmail>daniel.kucera@gmail.com</senderEmail><timestampReceived>2017-05-17 13:49:45-0400</timestampReceived><subject>Re: [libvirt-users] Callback re-registration after libvirtd restart</subject><body>

No, I'm not, I'm calling it sooner:

func libvirt_start() {
        libvirt.EventRegisterDefaultImpl()
        event_listen()
}




S pozdravom / Best regards
Daniel Kucera.

2017-05-17 15:47 GMT+02:00 Daniel P. Berrange &lt;berrange@redhat.com&gt;:

&gt; On Wed, May 17, 2017 at 03:41:09PM +0200, Daniel Kučera wrote:
&gt; &gt; Hi Daniel,
&gt; &gt;
&gt; &gt; I tried that but it doesn't work:
&gt; &gt;
&gt; &gt; func libvirt_close_callback(conn *libvirt.Connect, reason
&gt; &gt; libvirt.ConnectCloseReason){
&gt; &gt;     log.Printf("close callback: %+v", reason)
&gt; &gt; }
&gt; &gt;
&gt; &gt; func event_listen() {
&gt; &gt;     log.Printf("event_listen %s", conf.Libvirt.LocalUrl)
&gt; &gt;     hv, err := libvirt.NewConnect(conf.Libvirt.LocalUrl)
&gt; &gt;
&gt; &gt;     err = hv.RegisterCloseCallback(libvirt_close_callback)
&gt; &gt;     if err != nil {
&gt; &gt;         log.Printf("unable to register close callback")
&gt; &gt;         return
&gt; &gt;     }
&gt; &gt; ...
&gt; &gt;
&gt; &gt; The callback fires only when I kill my app,
&gt;
&gt; Looks like you are missing a call to libvirt.EventRegisterDefaultImpl(),
&gt; which must be the first you do do before even connecting to libvirt.
&gt;
&gt;
&gt; Regards,
&gt; Daniel
&gt; --
&gt; |: https://berrange.com      -o-    https://www.flickr.com/photos/
&gt; dberrange :|
&gt; |: https://libvirt.org         -o-
&gt; https://fstop138.berrange.com :|
&gt; |: https://entangle-photo.org    -o-    https://www.instagram.com/
&gt; dberrange :|
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;No, I'm not, I'm calling it sooner:&lt;br&gt;&lt;br&gt;func \
libvirt_start() {&lt;br&gt;              libvirt.EventRegisterDefaultImpl()&lt;br&gt;             \
event_listen()&lt;br&gt;}&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br \
clear="all"&gt;&lt;div&gt;&lt;div class="gmail_signature" data-smartmail="gmail_signature"&gt;&lt;br&gt;S \
pozdravom / Best regards&lt;br&gt;Daniel Kucera.&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;div \
class="gmail_quote"&gt;2017-05-17 15:47 GMT+02:00 Daniel P. Berrange &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:berrange@redhat.com" \
target="_blank"&gt;berrange@redhat.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span class=""&gt;On Wed, May 17, 2017 at 03:41:09PM +0200, \
Daniel Kučera wrote:&lt;br&gt; &gt; Hi Daniel,&lt;br&gt;
&gt;&lt;br&gt;
&gt; I tried that but it doesn't work:&lt;br&gt;
&gt;&lt;br&gt;
&gt; func libvirt_close_callback(conn *libvirt.Connect, reason&lt;br&gt;
&gt; libvirt.ConnectCloseReason){&lt;br&gt;
&gt;        log.Printf("close callback: %+v", reason)&lt;br&gt;
&gt; }&lt;br&gt;
&gt;&lt;br&gt;
&gt; func event_listen() {&lt;br&gt;
&gt;        log.Printf("event_listen %s", conf.Libvirt.LocalUrl)&lt;br&gt;
&gt;        hv, err := libvirt.NewConnect(conf.&lt;wbr&gt;Libvirt.LocalUrl)&lt;br&gt;
&gt;&lt;br&gt;
&gt;        err = hv.RegisterCloseCallback(&lt;wbr&gt;libvirt_close_callback)&lt;br&gt;
&gt;        if err != nil {&lt;br&gt;
&gt;              log.Printf("unable to register close callback")&lt;br&gt;
&gt;              return&lt;br&gt;
&gt;        }&lt;br&gt;
&gt; ...&lt;br&gt;
&gt;&lt;br&gt;
&gt; The callback fires only when I kill my app,&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;Looks like you are missing a call to \
libvirt.&lt;wbr&gt;EventRegisterDefaultImpl(),&lt;br&gt; which must be the first you do do before \
even connecting to libvirt.&lt;br&gt; &lt;div class="HOEnZb"&gt;&lt;div class="h5"&gt;&lt;br&gt;
&lt;br&gt;
Regards,&lt;br&gt;
Daniel&lt;br&gt;
--&lt;br&gt;
&gt; &gt; &lt;a href="https://berrange.com" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://berrange.com&lt;/a&gt;         -o-      &lt;a \
&gt; &gt; href="https://www.flickr.com/photos/dberrange" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://www.flickr.com/photos/&lt;wbr&gt;dberrange&lt;/a&gt; :|&lt;br&gt;
&gt; &gt; &lt;a href="https://libvirt.org" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://libvirt.org&lt;/a&gt;              -o-                  &lt;a \
&gt; &gt; href="https://fstop138.berrange.com" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://fstop138.berrange.com&lt;/a&gt; :|&lt;br&gt;
&gt; &gt; &lt;a href="https://entangle-photo.org" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://entangle-photo.org&lt;/a&gt;      -o-      &lt;a \
&gt; &gt; href="https://www.instagram.com/dberrange" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://www.instagram.com/&lt;wbr&gt;dberrange&lt;/a&gt; :|&lt;br&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170517135245</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-05-17 13:52:45-0400</timestampReceived><subject>Re: [libvirt-users] Callback re-registration after libvirtd restart</subject><body>

On Wed, May 17, 2017 at 03:49:45PM +0200, Daniel Kučera wrote:
&gt; No, I'm not, I'm calling it sooner:
&gt; 
&gt; func libvirt_start() {
&gt;         libvirt.EventRegisterDefaultImpl()
&gt;         event_listen()
&gt; }

Well the following example works as expected for me

package main

import (
	"github.com/libvirt/libvirt-go"
	"log"
)

func libvirt_close_callback(conn *libvirt.Connect, reason libvirt.ConnectCloseReason) {
	log.Printf("In here")
}

func main() {
	libvirt.EventRegisterDefaultImpl()

	hv, err := libvirt.NewConnect("qemu:///session")

	err = hv.RegisterCloseCallback(libvirt_close_callback)
	if err != nil {
		log.Printf("unable to register close callback")
		return
	}

	for {
		libvirt.EventRunDefaultImpl()
	}

}


Printing out "In here" immediately when I kill libvirtd

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170517140329</emailId><senderName>Daniel_Kučera</senderName><senderEmail>daniel.kucera@gmail.com</senderEmail><timestampReceived>2017-05-17 14:03:29-0400</timestampReceived><subject>Re: [libvirt-users] Callback re-registration after libvirtd restart</subject><body>

2017-05-17 15:52 GMT+02:00 Daniel P. Berrange &lt;berrange@redhat.com&gt;:

&gt; On Wed, May 17, 2017 at 03:49:45PM +0200, Daniel Kučera wrote:
&gt; &gt; No, I'm not, I'm calling it sooner:
&gt; &gt;
&gt; &gt; func libvirt_start() {
&gt; &gt;         libvirt.EventRegisterDefaultImpl()
&gt; &gt;         event_listen()
&gt; &gt; }
&gt;
&gt; Well the following example works as expected for me
&gt;
&gt; package main
&gt;
&gt; import (
&gt;         "github.com/libvirt/libvirt-go"
&gt;         "log"
&gt; )
&gt;
&gt; func libvirt_close_callback(conn *libvirt.Connect, reason
&gt; libvirt.ConnectCloseReason) {
&gt;         log.Printf("In here")
&gt; }
&gt;
&gt; func main() {
&gt;         libvirt.EventRegisterDefaultImpl()
&gt;
&gt;         hv, err := libvirt.NewConnect("qemu:///session")
&gt;
&gt;         err = hv.RegisterCloseCallback(libvirt_close_callback)
&gt;         if err != nil {
&gt;                 log.Printf("unable to register close callback")
&gt;                 return
&gt;         }
&gt;
&gt;         for {
&gt;                 libvirt.EventRunDefaultImpl()
&gt;         }
&gt;
&gt; }
&gt;
&gt;
&gt; Printing out "In here" immediately when I kill libvirtd
&gt;
&gt; Regards,
&gt; Daniel
&gt; --
&gt; |: https://berrange.com      -o-    https://www.flickr.com/photos/
&gt; dberrange :|
&gt; |: https://libvirt.org         -o-
&gt; https://fstop138.berrange.com :|
&gt; |: https://entangle-photo.org    -o-    https://www.instagram.com/
&gt; dberrange :|
&gt;


Okay, with qemu:///session I'm getting CloseCallback but now I'm not
getting LifecycleCallback :(

S pozdravom / Best regards
Daniel Kucera.

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;br&gt;&lt;div class="gmail_extra"&gt;&lt;div class="gmail_quote"&gt;2017-05-17 15:52 \
GMT+02:00 Daniel P. Berrange &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:berrange@redhat.com" \
target="_blank"&gt;berrange@redhat.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt;&lt;span class="gmail-"&gt;On Wed, May 17, 2017 at \
03:49:45PM +0200, Daniel Kučera wrote:&lt;br&gt; &gt; No, I'm not, I'm calling it \
sooner:&lt;br&gt; &gt;&lt;br&gt;
&gt; func libvirt_start() {&lt;br&gt;
&gt;              libvirt.&lt;wbr&gt;EventRegisterDefaultImpl()&lt;br&gt;
&gt;              event_listen()&lt;br&gt;
&gt; }&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;Well the following example works as expected for me&lt;br&gt;
&lt;br&gt;
package main&lt;br&gt;
&lt;br&gt;
import (&lt;br&gt;
            "&lt;a href="http://github.com/libvirt/libvirt-go" rel="noreferrer" \
target="_blank"&gt;github.com/libvirt/libvirt-go&lt;/a&gt;&lt;wbr&gt;"&lt;br&gt;  "log"&lt;br&gt;
)&lt;br&gt;
&lt;span class="gmail-"&gt;&lt;br&gt;
func libvirt_close_callback(conn *libvirt.Connect, reason libvirt.ConnectCloseReason) \
{&lt;br&gt; &lt;/span&gt;            log.Printf("In here")&lt;br&gt;
}&lt;br&gt;
&lt;br&gt;
func main() {&lt;br&gt;
            libvirt.&lt;wbr&gt;EventRegisterDefaultImpl()&lt;br&gt;
&lt;br&gt;
            hv, err := libvirt.NewConnect("qemu:///&lt;wbr&gt;session")&lt;br&gt;
&lt;span class="gmail-"&gt;&lt;br&gt;
            err = hv.RegisterCloseCallback(&lt;wbr&gt;libvirt_close_callback)&lt;br&gt;
            if err != nil {&lt;br&gt;
                        log.Printf("unable to register close callback")&lt;br&gt;
                        return&lt;br&gt;
            }&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;            for {&lt;br&gt;
                        libvirt.EventRunDefaultImpl()&lt;br&gt;
            }&lt;br&gt;
&lt;br&gt;
}&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
Printing out "In here" immediately when I kill libvirtd&lt;br&gt;
&lt;div class="gmail-HOEnZb"&gt;&lt;div class="gmail-h5"&gt;&lt;br&gt;
Regards,&lt;br&gt;
Daniel&lt;br&gt;
--&lt;br&gt;
&gt; &gt; &lt;a href="https://berrange.com" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://berrange.com&lt;/a&gt;         -o-      &lt;a \
&gt; &gt; href="https://www.flickr.com/photos/dberrange" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://www.flickr.com/photos/&lt;wbr&gt;dberrange&lt;/a&gt; :|&lt;br&gt;
&gt; &gt; &lt;a href="https://libvirt.org" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://libvirt.org&lt;/a&gt;              -o-                  &lt;a \
&gt; &gt; href="https://fstop138.berrange.com" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://fstop138.berrange.com&lt;/a&gt; :|&lt;br&gt;
&gt; &gt; &lt;a href="https://entangle-photo.org" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://entangle-photo.org&lt;/a&gt;      -o-      &lt;a \
&gt; &gt; href="https://www.instagram.com/dberrange" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://www.instagram.com/&lt;wbr&gt;dberrange&lt;/a&gt; :|&lt;br&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;Okay, with \
qemu:///&lt;wbr&gt;session I'm getting CloseCallback but now I'm not getting \
LifecycleCallback :(&lt;br clear="all"&gt;&lt;div&gt;&lt;div class="gmail_signature"&gt;&lt;br&gt;S pozdravom \
/ Best regards&lt;br&gt;Daniel Kucera.&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170515062730</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-05-15 06:27:30-0400</timestampReceived><subject>Re: [libvirt-users] Poor network performance</subject><body>

On 05/12/2017 11:02 AM, Sławomir Kapłoński wrote:
&gt; Hello,
&gt; 
&gt; I have some problem with poor network performance on libvirt with qemu and \
&gt; openvswitch. I'm using libvirt 1.3.1, qemu 2.5 and openvswitch 2.6.0 on Ubuntu \
&gt; 16.04 currently. My connection diagram looks like below:
&gt; 
&gt; +---------------------------+
&gt; +---------------------------+                    |         Net namespace     |
&gt; +------------------+           |        OVS bridge         |                    |   \
&gt; | |                  |           |                           |                    | \
&gt; | |        VM        |           |                           |                    | \
&gt; | |                  |      +----+---+                  +----+-----+         \
&gt; +----+---+                       | |                  +------+tap dev |             \
&gt; |  veth A  +---------+ veth B |                       | |                  |      \
&gt; +--------+                  +----------+         +--------+                       | \
&gt; |    iperf -s&lt;---------------------------------------------------------------------------+iperf \
&gt; -c          | |                  |           |                           |          \
&gt; |                           | +------------------+           |                      \
&gt; |                    |                           | |                           |    \
&gt; |                           | +---------------------------+                    \
&gt; +---------------------------+ 
&gt; 
&gt; 
&gt; I haven't got any QoS in tc configured on any interface. When I do this iperf test \
&gt; I have something about 150Mbps only. IMHO it should be something about 20-30 Gbps \
&gt; there.

There could be a lot of stuff that is suboptimal here.
Firstly, you should ping your vcpus and guest memory. Then, you might
want to enable multiqueue for the tap device (that way packet processing
can be split into multiple vcpus). You also want to make sure, you're
not overcommitting the host.
BTW: you may also try setting 'noqueue' qdisc for the tap device (if
supported by your kernel). Also, the guest is type of KVM, not qemu,
right? And you're using virtio model for the VM's NIC.

Michal


</body></email><email><emailId>20170515092026</emailId><senderName>Sławomir Kapłoński</senderName><senderEmail>slawek@kaplonski.pl</senderEmail><timestampReceived>2017-05-15 09:20:26-0400</timestampReceived><subject>Re: [libvirt-users] Poor network performance</subject><body>

Hello,

I have no queue configured on tap and veth devices, quest type is of course KVM and \
I'm using virtio model for VM's NIC. What we found is that on Xenial (where \
performance is poor) during test ovs-vswitchd process is using 100% CPU and there are \
some messages in ovs logs:

2017-05-12T14:22:04.351Z|00125|poll_loop|INFO|wakeup due to [POLLIN] on fd 149 \
(AF_PACKET(tap27903b5e-06)(protocol=0x3)&lt;-&gt;) at ../lib/netdev-linux.c:1139 (86% CPU \
usage)

Identical setup (with same versions of ovs, libvirt, gemu and kernel) is working \
properly on Trusty.

Pozdrawiam / Best regards
Sławek Kapłoński
slawek@kaplonski.pl

&gt; Wiadomość napisana przez Michal Privoznik &lt;mprivozn@redhat.com&gt; w dniu \
&gt; 15.05.2017, o godz. 08:27: 
&gt; On 05/12/2017 11:02 AM, Sławomir Kapłoński wrote:
&gt; &gt; Hello,
&gt; &gt; 
&gt; &gt; I have some problem with poor network performance on libvirt with qemu and \
&gt; &gt; openvswitch. I'm using libvirt 1.3.1, qemu 2.5 and openvswitch 2.6.0 on Ubuntu \
&gt; &gt; 16.04 currently. My connection diagram looks like below:
&gt; &gt; 
&gt; &gt; +---------------------------+
&gt; &gt; +---------------------------+                    |         Net namespace    |
&gt; &gt; +------------------+           |        OVS bridge         |                    | \
&gt; &gt; | |                  |           |                           |                    \
&gt; &gt; |                         | |        VM        |           |                      \
&gt; &gt; |                    |                         | |                  |      \
&gt; &gt; +----+---+                  +----+-----+         +----+---+                     | \
&gt; &gt; |                  +------+tap dev |                  |  veth A  +---------+ veth \
&gt; &gt; B |                     | |                  |      +--------+                  \
&gt; &gt; +----------+         +--------+                     | |    iperf \
&gt; &gt; -s&lt;---------------------------------------------------------------------------+iperf \
&gt; &gt; -c        | |                  |           |                           |          \
&gt; &gt; |                         | +------------------+           |                      \
&gt; &gt; |                    |                         | |                           |    \
&gt; &gt; |                          | +---------------------------+                    \
&gt; &gt; +---------------------------+ 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; I haven't got any QoS in tc configured on any interface. When I do this iperf \
&gt; &gt; test I have something about 150Mbps only. IMHO it should be something about 20-30 \
&gt; &gt; Gbps there.
&gt; 
&gt; There could be a lot of stuff that is suboptimal here.
&gt; Firstly, you should ping your vcpus and guest memory. Then, you might
&gt; want to enable multiqueue for the tap device (that way packet processing
&gt; can be split into multiple vcpus). You also want to make sure, you're
&gt; not overcommitting the host.
&gt; BTW: you may also try setting 'noqueue' qdisc for the tap device (if
&gt; supported by your kernel). Also, the guest is type of KVM, not qemu,
&gt; right? And you're using virtio model for the VM's NIC.
&gt; 
&gt; Michal


</body></email><email><emailId>20170509065855</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-05-09 06:58:55-0400</timestampReceived><subject>Re: [libvirt-users] strange error while trying to start ~60 domains</subject><body>


On Sun, May 07, 2017 at 10:37:17PM +0300, Vasiliy Tolstov wrote:
&gt;Hi! I'm using latest libvirt release under debian jessie (kernel 4.4.x LTS)
&gt;And after i'm try to start 65 domains i get 19 errors like:
&gt;
&gt;May 07 22:32:28 cn17 libvirtd[13836]: 2017-05-07 19:32:28.188+0000:
&gt;13839: error : virDBusCall:1570 : error from service: CreateMachine:
&gt;Message did not receive a reply (timeout by message bus)
&gt;
&gt;I'm use qcow2 file as vm images on ssd disk with dir storage pool
&gt;(local ssd disks).
&gt;

Could this be related to
https://bugzilla.redhat.com/show_bug.cgi?id=1416043 ??  It looks like a
problem in dbus anyway.

&gt;
&gt;--
&gt;Vasiliy Tolstov,
&gt;e-mail: v.tolstov@selfip.ru
&gt;
&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170507000949</emailId><senderName>Dan</senderName><senderEmail>srwx4096@gmail.com</senderEmail><timestampReceived>2017-05-07 00:09:49-0400</timestampReceived><subject>Re: [libvirt-users] nwfilter and address of network ip address</subject><body>

On Fri, May 5, 2017 at 4:29 PM, Nicolas Bock &lt;nicolasbock@gmail.com&gt; wrote:

&gt; Hi,
&gt;
&gt; I am running a webserver on the libvirt host and would like to add a
&gt; nwfilter such that a VM can access that server. The corresponding iptables
&gt; rule would look like this:
&gt;
&gt; iptables --append INPUT --in-interface virbr0 --destination 192.168.122.1
&gt; --protocol tcp --dport 80 --jump ACCEPT
&gt;
&gt; where the network is using virbr0 and sits at 192.168.122.1. I don't want
&gt; to hardcode the host IP address in the nwfilter so that I can use that
&gt; filter for other networks. Is it possible to reference the host's IP
&gt; address in the filter?
&gt;
&gt; Thanks!
&gt;
&gt; Nick
&gt;
&gt; Hi Nick,

I used to have similar question before too. Not sure if this could be
helpful for you,
Probably just use arp or arpscan. But to be more specific, if the domain
name of the
client (assuming you want to confine HTTP service to only a selected few
clients, e.g.,
192.168.122.1 in your case) is known, you probably could do

$ virsh domiflist DOMAIN

In particular, to get the IP address of a domain, it is something like the
following:

$ for MAC in `virsh domiflist &lt;DOMAIN&gt; | grep -o -E
"([0-9a-f]{2}:){5}([0-9a-f]{2})"` ; do
        arp -e | grep $MAC  | grep -o -P
"^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}" ;
   done

Alternatively, if the NETWORK name is known, IP addr can be obtained
directly with

$ virsh net-dhcp-leases NETWORK

Another way to the get IP addr, if qemu guest agent is installed on the
client,

$ virsh domifaddr DOMAIN

So that you can pass IP to the XML, and somehow you can trigger the update
of
NWFILTER with some magic, quite a hack.

Or, you could just use client's MAC addr to define the filter:
https://libvirt.org/formatnwfilter.html#nwfelemsRulesProtoMAC

But I don't think there is direct way to specify a client's domain name in
the NWFILTER XML definition as of now.

P.S. I am new to libvirt, so everything above could be wrong.

Dan

_______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;br&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;On Fri, May \
5, 2017 at 4:29 PM, Nicolas Bock &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:nicolasbock@gmail.com" \
target="_blank"&gt;nicolasbock@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt;Hi,&lt;br&gt; &lt;br&gt;
I am running a webserver on the libvirt host and would like to add a nwfilter such \
that a VM can access that server. The corresponding iptables rule would look like \
this:&lt;br&gt; &lt;br&gt;
iptables --append INPUT --in-interface virbr0 --destination 192.168.122.1 --protocol \
tcp --dport 80 --jump ACCEPT&lt;br&gt; &lt;br&gt;
where the network is using virbr0 and sits at 192.168.122.1. I don't want to \
hardcode the host IP address in the nwfilter so that I can use that filter for other \
networks. Is it possible to reference the host's IP address in the filter?&lt;br&gt; \
&lt;br&gt; Thanks!&lt;br&gt;
&lt;br&gt;
Nick&lt;br&gt;
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;Hi Nick,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I used to have similar \
question before too. Not sure if this could be helpful for you,&lt;/div&gt;&lt;div&gt;Probably \
just use arp or arpscan. But to be more specific, if the domain name of the  \
&lt;/div&gt;&lt;div&gt;client (assuming you want to confine HTTP service to only a selected few \
clients, e.g.,&lt;/div&gt;&lt;div&gt;192.168.122.1 in your case) is known, you probably could \
do&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;$ virsh domiflist DOMAIN&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In \
particular, to get the IP address of a domain, it is something like the \
following:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;$ for MAC in `virsh domiflist &lt;DOMAIN&gt; | \
grep -o -E "([0-9a-f]{2}:){5}([0-9a-f]{2})"` ; do  &lt;/div&gt;&lt;div&gt;            \
arp -e | grep $MAC   | grep -o -P "^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}" ;  \
&lt;/div&gt;&lt;div&gt;     done  &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Alternatively, if the NETWORK \
name is known, IP addr can be obtained directly with&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;$ virsh \
net-dhcp-leases NETWORK&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Another way to the get IP addr, \
if qemu guest agent is installed on the client,  &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;$ virsh \
domifaddr DOMAIN&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So that you can pass IP to the XML, \
and somehow you can trigger the update of&lt;/div&gt;&lt;div&gt;NWFILTER with some magic, quite a \
hack.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Or, you could just use client's MAC addr to define \
the filter:&lt;/div&gt;&lt;div&gt;&lt;a \
href="https://libvirt.org/formatnwfilter.html#nwfelemsRulesProtoMAC"&gt;https://libvirt.o \
rg/formatnwfilter.html#nwfelemsRulesProtoMAC&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;But I \
don't think there is direct way to specify a client's domain name \
in&lt;/div&gt;&lt;div&gt;the NWFILTER XML definition as of now.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;P.S. I \
am new to libvirt, so everything above could be \
wrong.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Dan&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote \
class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt; \
______________________________&lt;wbr&gt;_________________&lt;br&gt; libvirt-users mailing \
list&lt;br&gt; &lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt; \
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170508143143</emailId><senderName>Nicolas Bock</senderName><senderEmail>nicolasbock@gmail.com</senderEmail><timestampReceived>2017-05-08 14:31:43-0400</timestampReceived><subject>Re: [libvirt-users] nwfilter and address of network ip address</subject><body>

Hi Dan,

On Sat, May 06, 2017 at 08:09:49PM -0400, Dan wrote:
&gt;On Fri, May 5, 2017 at 4:29 PM, Nicolas Bock &lt;nicolasbock@gmail.com&gt; wrote:
&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; I am running a webserver on the libvirt host and would like to add a
&gt;&gt; nwfilter such that a VM can access that server. The corresponding iptables
&gt;&gt; rule would look like this:
&gt;&gt;
&gt;&gt; iptables --append INPUT --in-interface virbr0 --destination 192.168.122.1
&gt;&gt; --protocol tcp --dport 80 --jump ACCEPT
&gt;&gt;
&gt;&gt; where the network is using virbr0 and sits at 192.168.122.1. I don't want
&gt;&gt; to hardcode the host IP address in the nwfilter so that I can use that
&gt;&gt; filter for other networks. Is it possible to reference the host's IP
&gt;&gt; address in the filter?
&gt;&gt;
&gt;&gt; Thanks!
&gt;&gt;
&gt;&gt; Nick
&gt;&gt;
&gt;&gt; Hi Nick,
&gt;
&gt;I used to have similar question before too. Not sure if this could be
&gt;helpful for you, Probably just use arp or arpscan. But to be more 
&gt;specific, if the domain name of the client (assuming you want to 
&gt;confine HTTP service to only a selected few clients, e.g.,
&gt;192.168.122.1 in your case) is known, you probably could do
&gt;
&gt;$ virsh domiflist DOMAIN
&gt;
&gt;In particular, to get the IP address of a domain, it is something like the
&gt;following:
&gt;
&gt;$ for MAC in `virsh domiflist &lt;DOMAIN&gt; | grep -o -E
&gt;"([0-9a-f]{2}:){5}([0-9a-f]{2})"` ; do
&gt;        arp -e | grep $MAC  | grep -o -P
&gt;"^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}" ;
&gt;   done
&gt;
&gt;Alternatively, if the NETWORK name is known, IP addr can be obtained
&gt;directly with
&gt;
&gt;$ virsh net-dhcp-leases NETWORK
&gt;
&gt;Another way to the get IP addr, if qemu guest agent is installed on the
&gt;client,
&gt;
&gt;$ virsh domifaddr DOMAIN
&gt;
&gt;So that you can pass IP to the XML, and somehow you can trigger the update
&gt;of NWFILTER with some magic, quite a hack.

Thanks! I was hoping for something less hacky :)

&gt;Or, you could just use client's MAC addr to define the filter:
&gt;https://libvirt.org/formatnwfilter.html#nwfelemsRulesProtoMAC
&gt;
&gt;But I don't think there is direct way to specify a client's domain name in
&gt;the NWFILTER XML definition as of now.
&gt;
&gt;P.S. I am new to libvirt, so everything above could be wrong.
&gt;
&gt;Dan

</body></email><email><emailId>20170508143519</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-05-08 14:35:19-0400</timestampReceived><subject>Re: [libvirt-users] nwfilter and address of network ip address</subject><body>

On Sat, May 06, 2017 at 08:09:49PM -0400, Dan wrote:
&gt; On Fri, May 5, 2017 at 4:29 PM, Nicolas Bock &lt;nicolasbock@gmail.com&gt; wrote:
&gt; 
&gt; &gt; Hi,
&gt; &gt;
&gt; &gt; I am running a webserver on the libvirt host and would like to add a
&gt; &gt; nwfilter such that a VM can access that server. The corresponding iptables
&gt; &gt; rule would look like this:
&gt; &gt;
&gt; &gt; iptables --append INPUT --in-interface virbr0 --destination 192.168.122.1
&gt; &gt; --protocol tcp --dport 80 --jump ACCEPT
&gt; &gt;
&gt; &gt; where the network is using virbr0 and sits at 192.168.122.1. I don't want
&gt; &gt; to hardcode the host IP address in the nwfilter so that I can use that
&gt; &gt; filter for other networks. Is it possible to reference the host's IP
&gt; &gt; address in the filter?

There is a pre-defined parameter for the VM's own IP address:

  http://libvirt.org/formatnwfilter.html#nwfelemsRulesAdvIPAddrDetection

but we don't have anything for the host's IP address. We could fairly
easily add it though I reckon - eg provide a HOST_IP parameter.

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170508153046</emailId><senderName>Nicolas Bock</senderName><senderEmail>nicolasbock@gmail.com</senderEmail><timestampReceived>2017-05-08 15:30:46-0400</timestampReceived><subject>Re: [libvirt-users] nwfilter and address of network ip address</subject><body>

On Mon, May 08, 2017 at 03:35:19PM +0100, Daniel P. Berrange wrote:
&gt;On Sat, May 06, 2017 at 08:09:49PM -0400, Dan wrote:
&gt;&gt; On Fri, May 5, 2017 at 4:29 PM, Nicolas Bock &lt;nicolasbock@gmail.com&gt; wrote:
&gt;&gt;
&gt;&gt; &gt; Hi,
&gt;&gt; &gt;
&gt;&gt; &gt; I am running a webserver on the libvirt host and would like to add a
&gt;&gt; &gt; nwfilter such that a VM can access that server. The corresponding iptables
&gt;&gt; &gt; rule would look like this:
&gt;&gt; &gt;
&gt;&gt; &gt; iptables --append INPUT --in-interface virbr0 --destination 192.168.122.1
&gt;&gt; &gt; --protocol tcp --dport 80 --jump ACCEPT
&gt;&gt; &gt;
&gt;&gt; &gt; where the network is using virbr0 and sits at 192.168.122.1. I don't want
&gt;&gt; &gt; to hardcode the host IP address in the nwfilter so that I can use that
&gt;&gt; &gt; filter for other networks. Is it possible to reference the host's IP
&gt;&gt; &gt; address in the filter?
&gt;
&gt;There is a pre-defined parameter for the VM's own IP address:
&gt;
&gt;  http://libvirt.org/formatnwfilter.html#nwfelemsRulesAdvIPAddrDetection
&gt;
&gt;but we don't have anything for the host's IP address. We could fairly
&gt;easily add it though I reckon - eg provide a HOST_IP parameter.

Thanks Daniel.

&gt;Regards,
&gt;Daniel

</body></email><email><emailId>20170508155758</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-05-08 15:57:58-0400</timestampReceived><subject>Re: [libvirt-users] nwfilter and address of network ip address</subject><body>

On Mon, May 08, 2017 at 11:30:46AM -0400, Nicolas Bock wrote:
&gt; On Mon, May 08, 2017 at 03:35:19PM +0100, Daniel P. Berrange wrote:
&gt; &gt; On Sat, May 06, 2017 at 08:09:49PM -0400, Dan wrote:
&gt; &gt; &gt; On Fri, May 5, 2017 at 4:29 PM, Nicolas Bock &lt;nicolasbock@gmail.com&gt; wrote:
&gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Hi,
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; I am running a webserver on the libvirt host and would like to add a
&gt; &gt; &gt; &gt; nwfilter such that a VM can access that server. The corresponding iptables
&gt; &gt; &gt; &gt; rule would look like this:
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; iptables --append INPUT --in-interface virbr0 --destination 192.168.122.1
&gt; &gt; &gt; &gt; --protocol tcp --dport 80 --jump ACCEPT
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; where the network is using virbr0 and sits at 192.168.122.1. I don't want
&gt; &gt; &gt; &gt; to hardcode the host IP address in the nwfilter so that I can use that
&gt; &gt; &gt; &gt; filter for other networks. Is it possible to reference the host's IP
&gt; &gt; &gt; &gt; address in the filter?
&gt; &gt; 
&gt; &gt; There is a pre-defined parameter for the VM's own IP address:
&gt; &gt; 
&gt; &gt;  http://libvirt.org/formatnwfilter.html#nwfelemsRulesAdvIPAddrDetection
&gt; &gt; 
&gt; &gt; but we don't have anything for the host's IP address. We could fairly
&gt; &gt; easily add it though I reckon - eg provide a HOST_IP parameter.
&gt; 
&gt; Thanks Daniel.

BTW, please don't misinterpret this to mean i'm going to actually implement
this myself. I mostly meant a) file a RFE bug report against libvirt's
upstream bug tracker b)  if you feel motivated to look at it, you could
try writing a patch for libvirt and submit it :-)

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170508163900</emailId><senderName>Nicolas Bock</senderName><senderEmail>nicolasbock@gmail.com</senderEmail><timestampReceived>2017-05-08 16:39:00-0400</timestampReceived><subject>Re: [libvirt-users] nwfilter and address of network ip address</subject><body>

On Mon, May 08, 2017 at 04:57:58PM +0100, Daniel P. Berrange wrote:
&gt;On Mon, May 08, 2017 at 11:30:46AM -0400, Nicolas Bock wrote:
&gt;&gt; On Mon, May 08, 2017 at 03:35:19PM +0100, Daniel P. Berrange wrote:
&gt;&gt; &gt; On Sat, May 06, 2017 at 08:09:49PM -0400, Dan wrote:
&gt;&gt; &gt; &gt; On Fri, May 5, 2017 at 4:29 PM, Nicolas Bock &lt;nicolasbock@gmail.com&gt; wrote:
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; &gt; Hi,
&gt;&gt; &gt; &gt; &gt;
&gt;&gt; &gt; &gt; &gt; I am running a webserver on the libvirt host and would like to add a
&gt;&gt; &gt; &gt; &gt; nwfilter such that a VM can access that server. The corresponding iptables
&gt;&gt; &gt; &gt; &gt; rule would look like this:
&gt;&gt; &gt; &gt; &gt;
&gt;&gt; &gt; &gt; &gt; iptables --append INPUT --in-interface virbr0 --destination 192.168.122.1
&gt;&gt; &gt; &gt; &gt; --protocol tcp --dport 80 --jump ACCEPT
&gt;&gt; &gt; &gt; &gt;
&gt;&gt; &gt; &gt; &gt; where the network is using virbr0 and sits at 192.168.122.1. I don't want
&gt;&gt; &gt; &gt; &gt; to hardcode the host IP address in the nwfilter so that I can use that
&gt;&gt; &gt; &gt; &gt; filter for other networks. Is it possible to reference the host's IP
&gt;&gt; &gt; &gt; &gt; address in the filter?
&gt;&gt; &gt;
&gt;&gt; &gt; There is a pre-defined parameter for the VM's own IP address:
&gt;&gt; &gt;
&gt;&gt; &gt;  http://libvirt.org/formatnwfilter.html#nwfelemsRulesAdvIPAddrDetection
&gt;&gt; &gt;
&gt;&gt; &gt; but we don't have anything for the host's IP address. We could fairly
&gt;&gt; &gt; easily add it though I reckon - eg provide a HOST_IP parameter.
&gt;&gt;
&gt;&gt; Thanks Daniel.
&gt;
&gt;BTW, please don't misinterpret this to mean i'm going to actually implement
&gt;this myself. I mostly meant a) file a RFE bug report against libvirt's
&gt;upstream bug tracker b)  if you feel motivated to look at it, you could
&gt;try writing a patch for libvirt and submit it :-)

No, I hadn't interpreted your statement like you were going to 
implement it :)

I'll file a bug. And I'll have a look at the code.

Thanks,

Nick

&gt;Regards,
&gt;Daniel

</body></email><email><emailId>20170502041656</emailId><senderName>chihhang wu</senderName><senderEmail>chihhangw@gmail.com</senderEmail><timestampReceived>2017-05-02 04:16:56-0400</timestampReceived><subject>[libvirt-users]  virsh snapshot delete / live-migration issues</subject><body>

Sorry, I made a mistake with my title. So I resend this email.
----------------------------------------------------------------------------------

Hi,

I'd like to live-migration after snapshots deleted.

But it doesn't work.Here's my steps:

# virsh snapshot-create VM
# virsh snapshot-delete VM Snapshot
# virsh migrate --live VM qemu+ssh://localadmin@compute3/system

And  It comes out this message:

# internal error: unable to execute QEMU command
'migrate-set-capabilities': There's a migration process in progress

Even I create a no-metadata snapshot, it still have same error.

After I reboot the VM, the live-migration finally works.

Does it has any suggestion way or command to solve this problem without
reboot the VM?

Here's my environment:

Ubuntu 14.04.5 LTS
Compiled against library: libvirt 1.3.1
Using library: libvirt 1.3.1
Using API: QEMU 1.3.1
Running hypervisor: QEMU 2.5.0

Best regards,

Chihhang Wu

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;font face="arial, helvetica, sans-serif" \
style="font-size:14px"&gt;Sorry, I made a mistake with my title. So I resend this \
email.&lt;/font&gt;&lt;/div&gt;&lt;font face="arial, helvetica, sans-serif" \
style="font-size:14px"&gt;&lt;div&gt;&lt;font face="arial, helvetica, sans-serif" \
style="font-size:14px"&gt;----------------------------------------------------------------------------------&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="arial, helvetica, sans-serif" \
style="font-size:14px"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;Hi,&lt;/font&gt;&lt;div style="font-size:14px"&gt;&lt;font \
face="arial, helvetica, sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div \
style="font-size:14px"&gt;&lt;font face="arial, helvetica, sans-serif"&gt;I'd like to \
live-migration after snapshots deleted.&lt;/font&gt;&lt;/div&gt;&lt;div style="font-size:14px"&gt;&lt;font \
face="arial, helvetica, sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div \
style="font-size:14px"&gt;&lt;font face="arial, helvetica, sans-serif"&gt;But it doesn't \
work.Here's my steps:&lt;/font&gt;&lt;/div&gt;&lt;div style="font-size:14px"&gt;&lt;font face="arial, \
helvetica, sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style="font-size:14px"&gt;&lt;font \
face="arial, helvetica, sans-serif"&gt;# virsh snapshot-create VM&lt;/font&gt;&lt;/div&gt;&lt;div \
style="font-size:14px"&gt;&lt;font face="arial, helvetica, sans-serif"&gt;# virsh \
snapshot-delete VM Snapshot&lt;/font&gt;&lt;/div&gt;&lt;div style="font-size:14px"&gt;&lt;font \
face="arial, helvetica, sans-serif"&gt;# virsh migrate --live VM \
qemu+ssh://localadmin@compute3&lt;wbr&gt;/system  &lt;/font&gt;&lt;/div&gt;&lt;div \
style="font-size:14px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style="font-size:14px"&gt;&lt;div&gt;&lt;font face="arial, \
helvetica, sans-serif"&gt;And   It comes out this message:&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="arial, helvetica, sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="arial, \
helvetica, sans-serif"&gt;# internal error: unable to execute QEMU command \
'migrate-set-capabilities': There's a migration process in \
progress&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style="font-size:14px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style="font-size:14px"&gt;&lt;font face="arial, \
helvetica, sans-serif"&gt;Even I create a no-metadata snapshot, it still have same \
error.&lt;/font&gt;&lt;/div&gt;&lt;div style="font-size:14px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style="font-size:14px"&gt;&lt;font face="arial, \
helvetica, sans-serif"&gt;After I reboot the VM, the live-migration finally \
works.&lt;/font&gt;&lt;/div&gt;&lt;div style="font-size:14px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style="font-size:14px"&gt;&lt;font face="arial, \
helvetica, sans-serif"&gt;Does it has any suggestion way or command to solve this \
problem without reboot the VM?&lt;/font&gt;&lt;/div&gt;&lt;div style="font-size:14px"&gt;&lt;font \
face="arial, helvetica, sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div \
style="font-size:14px"&gt;&lt;font face="arial, helvetica, sans-serif"&gt;Here's my \
environment:&lt;/font&gt;&lt;/div&gt;&lt;div style="font-size:14px"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style="font-size:14px"&gt;&lt;font face="arial, \
helvetica, sans-serif"&gt;Ubuntu 14.04.5 LTS&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-size:14px"&gt;&lt;font face="arial, helvetica, sans-serif"&gt;&lt;div&gt;Compiled \
against library: libvirt 1.3.1&lt;/div&gt;&lt;div&gt;Using library: libvirt 1.3.1&lt;/div&gt;&lt;div&gt;Using \
API: QEMU 1.3.1&lt;/div&gt;&lt;div&gt;Running hypervisor: QEMU \
2.5.0&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Best regards,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Chihhang \
Wu&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170505073944</emailId><senderName>Han Han</senderName><senderEmail>hhan@redhat.com</senderEmail><timestampReceived>2017-05-05 07:39:44-0400</timestampReceived><subject>Re: [libvirt-users] virsh snapshot delete / live-migration issues</subject><body>

It is a known issue: https://bugzilla.redhat.com/show_bug.cgi?id=1321304

On Tue, May 2, 2017 at 12:16 PM, chihhang wu &lt;chihhangw@gmail.com&gt; wrote:
&gt; Sorry, I made a mistake with my title. So I resend this email.
&gt; ----------------------------------------------------------------------------------
&gt;
&gt; Hi,
&gt;
&gt; I'd like to live-migration after snapshots deleted.
&gt;
&gt; But it doesn't work.Here's my steps:
&gt;
&gt; # virsh snapshot-create VM
&gt; # virsh snapshot-delete VM Snapshot
&gt; # virsh migrate --live VM qemu+ssh://localadmin@compute3/system
&gt;
&gt; And  It comes out this message:
&gt;
&gt; # internal error: unable to execute QEMU command 'migrate-set-capabilities':
&gt; There's a migration process in progress
&gt;
&gt; Even I create a no-metadata snapshot, it still have same error.
&gt;
&gt; After I reboot the VM, the live-migration finally works.
&gt;
&gt; Does it has any suggestion way or command to solve this problem without
&gt; reboot the VM?
&gt;
&gt; Here's my environment:
&gt;
&gt; Ubuntu 14.04.5 LTS
&gt; Compiled against library: libvirt 1.3.1
&gt; Using library: libvirt 1.3.1
&gt; Using API: QEMU 1.3.1
&gt; Running hypervisor: QEMU 2.5.0
&gt;
&gt; Best regards,
&gt;
&gt; Chihhang Wu
&gt;
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users



-- 
Han Han
Associate Quality Engineer
Redhat

Email: hhan@redhat.com
Phone: +861065339333

</body></email><email><emailId>20170508165020</emailId><senderName>Nicolas Bock</senderName><senderEmail>nicolasbock@gmail.com</senderEmail><timestampReceived>2017-05-08 16:50:20-0400</timestampReceived><subject>Re: [libvirt-users] nwfilter and address of network ip address</subject><body>

On Mon, May 08, 2017 at 04:57:58PM +0100, Daniel P. Berrange wrote:
&gt;On Mon, May 08, 2017 at 11:30:46AM -0400, Nicolas Bock wrote:
&gt;&gt; On Mon, May 08, 2017 at 03:35:19PM +0100, Daniel P. Berrange wrote:
&gt;&gt; &gt; On Sat, May 06, 2017 at 08:09:49PM -0400, Dan wrote:
&gt;&gt; &gt; &gt; On Fri, May 5, 2017 at 4:29 PM, Nicolas Bock &lt;nicolasbock@gmail.com&gt; wrote:
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; &gt; Hi,
&gt;&gt; &gt; &gt; &gt;
&gt;&gt; &gt; &gt; &gt; I am running a webserver on the libvirt host and would like to add a
&gt;&gt; &gt; &gt; &gt; nwfilter such that a VM can access that server. The corresponding iptables
&gt;&gt; &gt; &gt; &gt; rule would look like this:
&gt;&gt; &gt; &gt; &gt;
&gt;&gt; &gt; &gt; &gt; iptables --append INPUT --in-interface virbr0 --destination 192.168.122.1
&gt;&gt; &gt; &gt; &gt; --protocol tcp --dport 80 --jump ACCEPT
&gt;&gt; &gt; &gt; &gt;
&gt;&gt; &gt; &gt; &gt; where the network is using virbr0 and sits at 192.168.122.1. I don't want
&gt;&gt; &gt; &gt; &gt; to hardcode the host IP address in the nwfilter so that I can use that
&gt;&gt; &gt; &gt; &gt; filter for other networks. Is it possible to reference the host's IP
&gt;&gt; &gt; &gt; &gt; address in the filter?
&gt;&gt; &gt;
&gt;&gt; &gt; There is a pre-defined parameter for the VM's own IP address:
&gt;&gt; &gt;
&gt;&gt; &gt;  http://libvirt.org/formatnwfilter.html#nwfelemsRulesAdvIPAddrDetection
&gt;&gt; &gt;
&gt;&gt; &gt; but we don't have anything for the host's IP address. We could fairly
&gt;&gt; &gt; easily add it though I reckon - eg provide a HOST_IP parameter.
&gt;&gt;
&gt;&gt; Thanks Daniel.
&gt;
&gt;BTW, please don't misinterpret this to mean i'm going to actually implement
&gt;this myself. I mostly meant a) file a RFE bug report against libvirt's
&gt;upstream bug tracker b)  if you feel motivated to look at it, you could
&gt;try writing a patch for libvirt and submit it :-)

https://bugzilla.redhat.com/show_bug.cgi?id=1448926

&gt;Regards,
&gt;Daniel

</body></email><email><emailId>20170509080144</emailId><senderName>Vasiliy Tolstov</senderName><senderEmail>v.tolstov@selfip.ru</senderEmail><timestampReceived>2017-05-09 08:01:44-0400</timestampReceived><subject>Re: [libvirt-users] strange error while trying to start ~60 domains</subject><body>

2017-05-09 9:58 GMT+03:00 Martin Kletzander &lt;mkletzan@redhat.com&gt;:
&gt; Could this be related to
&gt; https://bugzilla.redhat.com/show_bug.cgi?id=1416043 ??  It looks like a
&gt; problem in dbus anyway.


I dont see that dbus restarted in my case.

-- 
Vasiliy Tolstov,
e-mail: v.tolstov@selfip.ru

</body></email><email><emailId>20170516092326</emailId><senderName>Sławomir Kapłoński</senderName><senderEmail>slawek@kaplonski.pl</senderEmail><timestampReceived>2017-05-16 09:23:26-0400</timestampReceived><subject>Re: [libvirt-users] Poor network performance</subject><body>

Hello,

We found what was the issue there. Our OVS bridge had set datapath_type=NETDEV. \
Change it to SYSTEM fixed our issue :)

Pozdrawiam / Best regards
Sławek Kapłoński
slawek@kaplonski.pl

&gt; Wiadomość napisana przez Sławomir Kapłoński &lt;slawek@kaplonski.pl&gt; w dniu \
&gt; 15.05.2017, o godz. 11:20: 
&gt; Hello,
&gt; 
&gt; I have no queue configured on tap and veth devices, quest type is of course KVM and \
&gt; I'm using virtio model for VM's NIC. What we found is that on Xenial (where \
&gt; performance is poor) during test ovs-vswitchd process is using 100% CPU and there \
&gt; are some messages in ovs logs: 
&gt; 2017-05-12T14:22:04.351Z|00125|poll_loop|INFO|wakeup due to [POLLIN] on fd 149 \
&gt; (AF_PACKET(tap27903b5e-06)(protocol=0x3)&lt;-&gt;) at ../lib/netdev-linux.c:1139 (86% CPU \
&gt; usage) 
&gt; Identical setup (with same versions of ovs, libvirt, gemu and kernel) is working \
&gt; properly on Trusty. 
&gt; Pozdrawiam / Best regards
&gt; Sławek Kapłoński
&gt; slawek@kaplonski.pl
&gt; 
&gt; &gt; Wiadomość napisana przez Michal Privoznik &lt;mprivozn@redhat.com&gt; w dniu \
&gt; &gt; 15.05.2017, o godz. 08:27: 
&gt; &gt; On 05/12/2017 11:02 AM, Sławomir Kapłoński wrote:
&gt; &gt; &gt; Hello,
&gt; &gt; &gt; 
&gt; &gt; &gt; I have some problem with poor network performance on libvirt with qemu and \
&gt; &gt; &gt; openvswitch. I'm using libvirt 1.3.1, qemu 2.5 and openvswitch 2.6.0 on Ubuntu \
&gt; &gt; &gt; 16.04 currently. My connection diagram looks like below:
&gt; &gt; &gt; 
&gt; &gt; &gt; +---------------------------+
&gt; &gt; &gt; +---------------------------+                    |         Net namespace    |
&gt; &gt; &gt; +------------------+           |        OVS bridge         |                    \
&gt; &gt; &gt; |                         | |                  |           |                    \
&gt; &gt; &gt; |                    |                         | |        VM        |           \
&gt; &gt; &gt; |                           |                    |                         | |  \
&gt; &gt; &gt; |      +----+---+                  +----+-----+         +----+---+              \
&gt; &gt; &gt; | |                  +------+tap dev |                  |  veth A  +---------+ \
&gt; &gt; &gt; veth B |                     | |                  |      +--------+             \
&gt; &gt; &gt; +----------+         +--------+                     | |    iperf \
&gt; &gt; &gt; -s&lt;---------------------------------------------------------------------------+iperf \
&gt; &gt; &gt; -c        | |                  |           |                           |        \
&gt; &gt; &gt; |                         | +------------------+           |                    \
&gt; &gt; &gt; |                    |                         | |                           |  \
&gt; &gt; &gt; |                          | +---------------------------+                    \
&gt; &gt; &gt; +---------------------------+ 
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; I haven't got any QoS in tc configured on any interface. When I do this iperf \
&gt; &gt; &gt; test I have something about 150Mbps only. IMHO it should be something about \
&gt; &gt; &gt; 20-30 Gbps there.
&gt; &gt; 
&gt; &gt; There could be a lot of stuff that is suboptimal here.
&gt; &gt; Firstly, you should ping your vcpus and guest memory. Then, you might
&gt; &gt; want to enable multiqueue for the tap device (that way packet processing
&gt; &gt; can be split into multiple vcpus). You also want to make sure, you're
&gt; &gt; not overcommitting the host.
&gt; &gt; BTW: you may also try setting 'noqueue' qdisc for the tap device (if
&gt; &gt; supported by your kernel). Also, the guest is type of KVM, not qemu,
&gt; &gt; right? And you're using virtio model for the VM's NIC.
&gt; &gt; 
&gt; &gt; Michal
&gt; 
&gt; 
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users


</body></email><email><emailId>20170517144244</emailId><senderName>Daniel_Kučera</senderName><senderEmail>daniel.kucera@gmail.com</senderEmail><timestampReceived>2017-05-17 14:42:44-0400</timestampReceived><subject>Re: [libvirt-users] Callback re-registration after libvirtd restart</subject><body>

&gt;
&gt; Okay, with qemu:///session I'm getting CloseCallback but now I'm not
&gt; getting LifecycleCallback :(
&gt;
&gt; S pozdravom / Best regards
&gt; Daniel Kucera.
&gt;

Okay, I take it back. It works.

S pozdravom / Best regards
Daniel Kucera.

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;br&gt;&lt;div class="gmail_extra"&gt;&lt;div class="gmail_quote"&gt;&lt;blockquote \
class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt;&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div class="gmail-h5"&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;Okay, with \
qemu:///session I'm getting CloseCallback but now I'm not getting \
LifecycleCallback :(&lt;span class="gmail-"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="gmail-m_-4773551606732324579gmail_signature"&gt;&lt;br&gt;S pozdravom / Best \
regards&lt;br&gt;Daniel Kucera.&lt;/div&gt;&lt;/div&gt; &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;Okay, I take it back. It works.&lt;br clear="all"&gt;&lt;div&gt;&lt;div \
class="gmail_signature"&gt;&lt;br&gt;S pozdravom / Best regards&lt;br&gt;Daniel \
Kucera.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170517154525</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-05-17 15:45:25-0400</timestampReceived><subject>Re: [libvirt-users] Duplicate reboot events</subject><body>


On Wed, May 17, 2017 at 03:14:18PM +0000, Innus, Martins wrote:
&gt; Nevermind, as far as I can tell, this is a bug in QEMU and is closed as a WONTFIX: \
&gt; https://bugzilla.redhat.com/show_bug.cgi?id=951525 
&gt; Thanks for the debugging help.
&gt; 

As you found out in the other mail, yes it is.  I didn't know about the
bug, though.  Anyway, at least we are sure it's not in libvirt as well.
Thanks for the patience.

Martin


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170519162524</emailId><senderName>Michael_Ströder</senderName><senderEmail>michael@stroeder.com</senderEmail><timestampReceived>2017-05-19 16:25:24-0400</timestampReceived><subject>[libvirt-users] &lt;source mode='private'&gt; for PPPoE?</subject><body>


HI!

I'm currently reviewing my (functional) setup with one physical ethernet interface eth1
of the host system being connected to a VDSL modem (not router!). A fully virtualized
guest acts as router with this source mode:

	&lt;source dev='eth1' mode='bridge'/&gt;

Reading the docs [1] I'm thinking whether mode='private' would be a better choice because
the network packets are supposed to be sent exclusively to the VDSL modem and received
from there.

Any thoughts?

Ciao, Michael.

[1] https://libvirt.org/formatdomain.html#elementsNICSDirect


["smime.p7s" (application/pkcs7-signature)]

</body></email><email><emailId>20170522082157</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-05-22 08:21:57-0400</timestampReceived><subject>Re: [libvirt-users] Access to the wiki</subject><body>

On Fri, May 19, 2017 at 12:23:48AM -0400, Jlozada2426 wrote:
&gt; Hello,
&gt; 
&gt; I was wondering if I could get access to the wiki. I want to
&gt; contribute and help out.

Absolutely. I'll reply offlist with login details

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170522134010</emailId><senderName>Laine Stump</senderName><senderEmail>laine@laine.org</senderEmail><timestampReceived>2017-05-22 13:40:10-0400</timestampReceived><subject>Re: [libvirt-users] disabling dnsmasq</subject><body>

On 05/19/2017 05:28 AM, Michael Ströder wrote:
&gt; HI!
&gt; 
&gt; I have some virtual networks (not only bridged) in my libvirt 3.3.0 installation and
&gt; therefore libvirt always starts dnsmasq. But I want to use my own DHCP and DNS servers
&gt; which are correctly working for this VM infrastructure.
&gt; 
&gt; How to completely disable dnsmasq in libvirt?

To disable the DHCP service of dnsmasq, siply don't include a &lt;dhcp&gt;
element in the network's definition. To disable the DNS service of
dnsmasq, add "&lt;dns enable='no'/&gt; to the network definition. If you do
both of these, there will be no dnsmasq instance for that network (since
there would be nothing for it to do).

(Disabling the DHCP server has been possible since the introduction of
libvirt virtual network. "&lt;dns enable='no'/&gt;" is available since libvirt
2.2.0)

</body></email><email><emailId>20170523092439</emailId><senderName>Hossein Azizabadi</senderName><senderEmail>djvoltan@gmail.com</senderEmail><timestampReceived>2017-05-23 09:24:39-0400</timestampReceived><subject>[libvirt-users] live migration</subject><body>

I'm interested with the modifications of live migration with all storage on
KVM .

I intend to ask, modification performed on which part of KVM?
Do storage blocks migrate sequentialy? I need information about it

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt" \
id="gmail-m_1586006571795581778gmail-docs-internal-guid-e07e9aa2-348e-5f28-e641-c4b1be32a7e7"&gt;&lt;span \
style="font-size:11pt;font-family:Arial;color:rgb(0,0,0);background-color:transparent; \
font-weight:400;font-style:normal;font-variant:normal;text-decoration:none;vertical-align:baseline"&gt;I'm \
interested with the modifications of live migration with all storage on KVM \
.&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:Arial;color:rgb(0,0,0);background-color:transparent; \
font-weight:400;font-style:normal;font-variant:normal;text-decoration:none;vertical-align:baseline"&gt;I \
intend to ask, modification performed on which part of KVM?&lt;/span&gt;&lt;span \
style="font-size:11pt;font-family:Arial;color:rgb(0,0,0);background-color:transparent; \
font-weight:400;font-style:normal;font-variant:normal;text-decoration:none;vertical-align:baseline"&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;span \
style="font-size:11pt;font-family:Arial;color:rgb(0,0,0);background-color:transparent; \
font-weight:400;font-style:normal;font-variant:normal;text-decoration:none;vertical-align:baseline"&gt;Do \
storage blocks migrate sequentialy? I need information about it&lt;/span&gt;&lt;/div&gt;



</body></email><email><emailId>20170523145251</emailId><senderName>Eric Blake</senderName><senderEmail>eblake@redhat.com</senderEmail><timestampReceived>2017-05-23 14:52:51-0400</timestampReceived><subject>[libvirt-users] error message</subject><body>

[Attachment #2 (multipart/mixed)]


[moderator note: re-posting to list with screenshot deleted, in order to
meet list policy size constraints]

hello,
i am trying to install libvirt but getting some error . even though i am
folowing your instructions and steps
please help me out this



["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170523174033</emailId><senderName>W Kern</senderName><senderEmail>wkern@pixelgate.net</senderEmail><timestampReceived>2017-05-23 17:40:33-0400</timestampReceived><subject>Re: [libvirt-users] Odd Virsh Capabilities response</subject><body>



On 5/23/2017 1:39 AM, Martin Kletzander wrote:
&gt;
&gt; According to wikipedia:
&gt;
&gt;  https://en.wikipedia.org/wiki/Xeon#5300-series_.22Clovertown.22
&gt;
&gt; the microarchitecture is Core, not anything newer.

&gt;
&gt; Looking at the capabilities, it could also be Conroe, it even has the
&gt; same family and model.  But it has the same number of matching features
&gt; for botha nd core2duo is older so it's closer to the start of the list.


OK, Mystery solved.

It would be nice if it had picked Conroe to avoid confusion, but that is 
ancient kit and as you point out the capabilities are the same,
so there would be no need to change anything

Sorry for the noise &lt;grin&gt;

-bill

</body></email><email><emailId>20170524012155</emailId><senderName>Eddie Yen</senderName><senderEmail>missile0407@gmail.com</senderEmail><timestampReceived>2017-05-24 01:21:55-0400</timestampReceived><subject>[libvirt-users] How to fit with Apparmor when upgrade to new libvirt version?</subject><body>

Hi everyone, this is my first post at this mailing list.

I have a question about upgrading libvirt, but also can fit to Apparmor.


For example, I already installed KVM + libvirt from apt-get on Ubuntu 14.04.
But the libvirt version is 1.2.9, so I want upgrade to 1.3.4 manually.

Search the Internet, only few posts show how to edit so that can launch VM
with Apparmor enabled.
Most of posts says disable Apparmor is good idea, but I don't want to do
that.

I already done these things:

1. Replace apparmor profiles from examples/apparmor into /etc/apparmor.d
2. Use --with-apparmor and --with-apparmor-profiles to compile.

But I still get virt-aa-helper DENIED message when I try to launch VM.


Any ideas?


Many thanks,
Eddie.

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi everyone, this is my first post at this mailing \
list.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I have a question about upgrading libvirt, but also can fit \
to Apparmor.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;For example, I already installed \
KVM + libvirt from apt-get on Ubuntu 14.04.&lt;/div&gt;&lt;div&gt;But the libvirt version is \
1.2.9, so I want upgrade to 1.3.4 manually.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Search the \
Internet, only few posts show how to edit so that can launch VM with Apparmor \
enabled.&lt;/div&gt;&lt;div&gt;Most of posts says disable Apparmor is good idea, but I don't \
want to do that.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I already done these \
things:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1. Replace apparmor profiles from examples/apparmor \
into /etc/apparmor.d  &lt;/div&gt;&lt;div&gt;2. Use --with-apparmor and --with-apparmor-profiles \
to compile.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;But I still get virt-aa-helper DENIED message \
when I try to launch VM.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Any \
ideas?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Many thanks,&lt;/div&gt;&lt;div&gt;Eddie.   \
&lt;br&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170524142612</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-05-24 14:26:12-0400</timestampReceived><subject>Re: [libvirt-users] How to set guest console size in libvirt configuration options?</subject><body>

On Wed, May 24, 2017 at 04:40:33PM +0300, Roman Storozhenko wrote:
&gt; Hello, everybody
&gt; 
&gt; I use virsh to run my VM and QEMU as a hypervisor. 
&gt; When I connect to it, it shows me a console with a some predefined size.
&gt; I know that I am able to update grub configuration to pass the correct
&gt; size as a kernel command line option or use stty something like:
&gt; 
&gt; stty rows 62 cols 213
&gt; 
&gt; and it's resizes correctly.
&gt; 
&gt; But is there any way to define the console's size  outside the guest, in
&gt; the VM's configuration?

Unfortunately that's not possible, nor can we notify the guest of
resizes on the client end.

Honestly the 'virsh console' is best used only in emergencies when the
VM doesn't boot. Any other time it is better to just use SSH, which
correctly deals with resizing consoles.

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170524151041</emailId><senderName>JosÉ_Luis_Valencia_Gutierrez</senderName><senderEmail>jvalencia@id.uff.br</senderEmail><timestampReceived>2017-05-24 15:10:41-0400</timestampReceived><subject>Re: [libvirt-users] No way to stop virStream error after guest stop</subject><body>

That is great, calling Abort also should remove the callbacks.

On Wed, 24 May 2017 11:11 Martin Kletzander, &lt;mkletzan@redhat.com&gt; wrote:

&gt; On Wed, May 17, 2017 at 07:53:35PM +0000, Jos=C3=89 Luis Valencia Gutierr=
ez
&gt; wrote:
&gt; &gt;I just tried removing the callback before calling virStreamFinish and it
&gt; &gt;worked right, I thought by simply finish the stream would stop the event=
s
&gt; &gt;and close it, the example I was based on only calls virStreamFinish on E=
OF
&gt; &gt;event.
&gt; &gt;
&gt;
&gt; I'm working on a patch that removes the callbacks after calling Finish.
&gt; Our docs don't really say it's needed and I don't (yet) see the point in
&gt; requiring that.
&gt;

[Attachment #3 (text/html)]

&lt;p dir="ltr"&gt;That is great, calling Abort also should remove the callbacks.&lt;/p&gt;
&lt;br&gt;&lt;div class="gmail_quote"&gt;&lt;div dir="ltr"&gt;On Wed, 24 May 2017 11:11 Martin \
Kletzander, &lt;&lt;a href="mailto:mkletzan@redhat.com"&gt;mkletzan@redhat.com&lt;/a&gt;&gt; \
wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;On Wed, May 17, 2017 at 07:53:35PM \
+0000, JosÉ Luis Valencia Gutierrez wrote:&lt;br&gt; &gt;I just tried removing the \
callback before calling virStreamFinish and it&lt;br&gt; &gt;worked right, I thought by \
simply finish the stream would stop the events&lt;br&gt; &gt;and close it, the example I \
was based on only calls virStreamFinish on EOF&lt;br&gt; &gt;event.&lt;br&gt;
&gt;&lt;br&gt;
&lt;br&gt;
I'm working on a patch that removes the callbacks after calling Finish.&lt;br&gt;
Our docs don't really say it's needed and I don't (yet) see the point \
in&lt;br&gt; requiring that.&lt;br&gt;
&lt;/blockquote&gt;&lt;/div&gt;



</body></email><email><emailId>20170524210003</emailId><senderName>Tomáš Golembiovský</senderName><senderEmail>tgolembi@redhat.com</senderEmail><timestampReceived>2017-05-24 21:00:03-0400</timestampReceived><subject>Re: [libvirt-users] How to show underlying QEMU command line using virsh</subject><body>

On Wed, 24 May 2017 10:38:42 +0200
Erik Skultety &lt;eskultet@redhat.com&gt; wrote:

&gt; On Wed, May 24, 2017 at 10:49:23AM +0300, Roman Storozhenko wrote:
&gt; &gt; Hello, everybody
&gt; &gt;
&gt; &gt; I use virt to run my VM's and QEMU as a hypervisor. There is a file
&gt; &gt; describing my virtual machine:
&gt; &gt;
&gt; &gt; /etc/libvirt/qemu/centos7.0.xml  
&gt; 
&gt; Just a note, never edit ^these files directly behind libvirt's back and always
&gt; use 'virsh edit' for all modifications.
&gt; 
&gt; &gt;
&gt; &gt; As you know it contains xml representation of my VM. Is there any way to
&gt; &gt; show underlying qemu command that virsh runs using that file? For
&gt; &gt; example:  
&gt; 
&gt; virsh doesn't spawn the qemu process, it's a frontend to libvirtd daemon which
&gt; will build the qemu cmdline according to the domain XML description and spawn
&gt; the process. As for the qemu commandline, we don't have an API to query the
&gt; command line, what you can do is get the qemu pid (e.g. with pgrep -f &lt;VM_name&gt;
&gt; and then cat /proc/&lt;pid&gt;/cmdline) or use ps and pipe its output to grep.

Or look in /var/log/libvirt/qemu/centos7.0.log. AFAIK the qemu command
gets logged every time you start the VM.

    Tomas

&gt; 
&gt; Erik
&gt; 
&gt; &gt;
&gt; &gt; qemu-system-x86-64 -m 1024 -smp 2 -...
&gt; &gt;
&gt; &gt; If no, is there any way to figure it out during VM run ?
&gt; &gt;
&gt; &gt; ---
&gt; &gt; Thanks in advance,
&gt; &gt; Roman Storozhenko
&gt; &gt;
&gt; &gt; _______________________________________________
&gt; &gt; libvirt-users mailing list
&gt; &gt; libvirt-users@redhat.com
&gt; &gt; https://www.redhat.com/mailman/listinfo/libvirt-users  
&gt; 
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users


-- 
Tomáš Golembiovský &lt;tgolembi@redhat.com&gt;

</body></email><email><emailId>20170525050839</emailId><senderName>Thiago Oliveira</senderName><senderEmail>cpv.thiago@gmail.com</senderEmail><timestampReceived>2017-05-25 05:08:39-0400</timestampReceived><subject>[libvirt-users] nwfilter - how to protect VM's</subject><body>

[Attachment #2 (multipart/alternative)]


Hello guys!

I have just one physical NIC (eth0) and some libvirt networks. Each network
created represents one customer and it is working fine. My question is how
can I protect between the customer's networks?

For example: The host 192.168.2.2 from the network 192.168.2.0/30 can not
access any VM in others networks but the 192.168.2.2 can access 192.168.0.1
because it is the gateway to the internet and this host can receive
incoming connections from the internet.

I would like to tag with VLAN for example but I don't have sure if this is
the best way.

See below my route table
[image: Imagem inline 1]


Thank you guys.

Thiago

[Attachment #5 (text/html)]

&lt;div dir="ltr"&gt;Hello guys!&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I have just one physical NIC (eth0) and \
some libvirt networks. Each network created represents one customer and it is working \
fine. My question is how can I protect between the customer's \
networks?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;For example: The host 192.168.2.2 from the network \
&lt;a href="http://192.168.2.0/30"&gt;192.168.2.0/30&lt;/a&gt; can not access any VM in others \
networks but the 192.168.2.2 can access 192.168.0.1 because it is the gateway to the \
internet and this host can receive incoming connections from the \
internet.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I would like to tag with VLAN for example but I \
don't have sure if this is the best way.  &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;See below my \
route table&lt;/div&gt;&lt;div&gt;&lt;img src="cid:ii_15c3dfb3856bcfb8" alt="Imagem inline 1" \
width="472" height="128"&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank you \
guys.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thiago&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;

--001a11441afac29157055052361d--


["image.png" (image/png)]

</body></email><email><emailId>20170526084744</emailId><senderName>dw</senderName><senderEmail>dwlinuxkernel@163.com</senderEmail><timestampReceived>2017-05-26 08:47:44-0400</timestampReceived><subject>Re: [libvirt-users] can't establish more than 1000 connections with virsh</subject><body>

å¨ 2017å¹´05æ26æ¥ 09:48, dw åé:
&gt; å¨ 2017å¹´05æ26æ¥ 09:42, dw åé:
&gt;&gt; å¨ 2017å¹´05æ25æ¥ 18:54, Daniel P. Berrange åé:
&gt;&gt;&gt; On Thu, May 25, 2017 at 06:51:40PM +0800, dw wrote:
&gt;&gt;&gt;&gt; å¨ 2017å¹´05æ25æ¥ 18:37, Daniel P. Berrange åé:
&gt;&gt;&gt;&gt;&gt; On Thu, May 25, 2017 at 06:20:51PM +0800, dw wrote:
&gt;&gt;&gt;&gt;&gt;&gt; Hi:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       I'm trying to connect with libvirtd with virsh from a remote PC,but only
&gt;&gt;&gt;&gt;&gt;&gt; can establish 1000 connections.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       If try more connections,prompt:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       "error: failed to connect to the hypervisor
&gt;&gt;&gt;&gt;&gt;&gt;       error: Failed to open file '/etc/libvirt/libvirt.conf': Too many open
&gt;&gt;&gt;&gt;&gt;&gt; files"
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       I tried in another PC,also get the same prompt.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       Anybody know why?
&gt;&gt;&gt;&gt;&gt; There's a limit of 1024 open file handles by default on Linux. You would
&gt;&gt;&gt;&gt;&gt; have to raise that limit in /etc/security/limits.d/ for your user.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; In /etc/security/limits.d/,there is only 20-nproc.conf.
&gt;&gt;&gt; You can create any files you want in that sub-directory - they just
&gt;&gt;&gt; use the same syntax as limits.conf. It means that if RPM upgrades
&gt;&gt;&gt; limits.conf it doesn't interfere with your changes in limits.d/custom.conf
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I modified /etc/security/limits.conf,what I added is:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;          "*       soft nofile 81920
&gt;&gt;&gt;&gt;          *       hard nofile 81920"
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I also modified /etc/pam.d/login,that I added is:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;      "session required        pam_limits.so"
&gt;&gt;&gt; I don't think that's needed - its already activated via
&gt;&gt;&gt; pam.d/system-auth which is included from login.
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; The output of "ulimit -a" is:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;      core file size          (blocks, -c) 0
&gt;&gt;&gt;&gt;      data seg size           (kbytes, -d) unlimited
&gt;&gt;&gt;&gt;      scheduling priority             (-e) 0
&gt;&gt;&gt;&gt;      file size               (blocks, -f) unlimited
&gt;&gt;&gt;&gt;      pending signals                 (-i) 385898
&gt;&gt;&gt;&gt;      max locked memory       (kbytes, -l) 64
&gt;&gt;&gt;&gt;      max memory size         (kbytes, -m) unlimited
&gt;&gt;&gt;&gt;      open files                      (-n) 81920
&gt;&gt;&gt;&gt;      pipe size            (512 bytes, -p) 8
&gt;&gt;&gt;&gt;      POSIX message queues     (bytes, -q) 819200
&gt;&gt;&gt;&gt;      real-time priority              (-r) 0
&gt;&gt;&gt;&gt;      stack size              (kbytes, -s) 8192
&gt;&gt;&gt;&gt;      cpu time               (seconds, -t) unlimited
&gt;&gt;&gt;&gt;      max user processes              (-u) 385898
&gt;&gt;&gt;&gt;      virtual memory          (kbytes, -v) unlimited
&gt;&gt;&gt;&gt;      file locks                      (-x) unlimited
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; What I did is right?
&gt;&gt;&gt; That at least shows the new limit is active
&gt;&gt;&gt;
&gt;&gt;&gt; Regards,
&gt;&gt;&gt; Daniel
&gt;&gt;
&gt;&gt; I restored  /etc/security/limits.conf and /etc/pam.d/login.
&gt;&gt;
&gt;&gt; And added file /etc/security/limits.d/21-nofile.conf, the content is
&gt;&gt;
&gt;&gt;      *       soft    nofile      10240
&gt;&gt;      *       hard    nofile      10240"
&gt;&gt;
&gt;&gt; The output of "ulimit -a" now is:
&gt;&gt;
&gt;&gt;     core file size          (blocks, -c) 0
&gt;&gt;     data seg size           (kbytes, -d) unlimited
&gt;&gt;     scheduling priority             (-e) 0
&gt;&gt;     file size               (blocks, -f) unlimited
&gt;&gt;     pending signals                 (-i) 385898
&gt;&gt;     max locked memory       (kbytes, -l) 64
&gt;&gt;     max memory size         (kbytes, -m) unlimited
&gt;&gt;     open files                      (-n) 10240
&gt;&gt;     pipe size            (512 bytes, -p) 8
&gt;&gt;     POSIX message queues     (bytes, -q) 819200
&gt;&gt;     real-time priority              (-r) 0
&gt;&gt;     stack size              (kbytes, -s) 8192
&gt;&gt;     cpu time               (seconds, -t) unlimited
&gt;&gt;     max user processes              (-u) 385898
&gt;&gt;     virtual memory          (kbytes, -v) unlimited
&gt;&gt;     file locks                      (-x) unlimited
&gt;&gt;
&gt;&gt;
&gt;&gt; The related config of /etc/libvirt/libvirtd.conf is:
&gt;&gt;
&gt;&gt;     max_clients = 5000
&gt;&gt;     max_queued_clients = 2000
&gt;&gt;     min_workers = 200
&gt;&gt;     max_workers = 2000
&gt;&gt;     max_requests = 5000
&gt;&gt;     max_client_requests = 2000
&gt;&gt;
&gt;&gt;
&gt;&gt; Now I still get the error:
&gt;&gt;
&gt;&gt;     error: failed to connect to the hypervisor
&gt;&gt;     error: Failed to open file '/etc/libvirt/libvirt.conf': Too many open files
&gt;&gt;
&gt;&gt;
&gt; I tried twice,and the result is:
&gt;
&gt;     virsh -c qemu+tcp://remote_pc/system
&gt;     error: failed to connect to the hypervisor
&gt;     error: Failed to open file '/etc/libvirt/libvirt.conf': Too many
&gt;     open files
&gt;
&gt;      virsh -c qemu+ssh://remote_pc/system
&gt;     error: failed to connect to the hypervisor
&gt;     error: Failed to open file '/proc/4931/stat': Too many open files
&gt;

Hi Daniel:

      I have solved the problem.
     Not anything above need to do in my PC, the only need to do is:

    Create /etc/systemd/system/libvirtd.service.d/openfiles.conf, and
    write the following two lines in it:

        [Service]
        LimitNOFILE=2048

    then run "service libvirtd restart",and if needed,run "systemctl
    daemon-reload"

     If need more connections, increase LimitNOFILE, and also need to 
modify /etc/libvirt/libvirtd.conf.

     Thank you for your help!

Regards,
dw


[Attachment #3 (text/html)]

&lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
  &lt;/head&gt;
  &lt;body text="#000000" bgcolor="#FFFFFF"&gt;
    &lt;div class="moz-cite-prefix"&gt;在 2017年05月26日 09:48, dw 写道:&lt;br&gt;
    &lt;/div&gt;
    &lt;blockquote type="cite"
      cite="mid:bc1edcda-cef7-b15a-aa95-00a07c53d68c@163.com"&gt;
      &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
      &lt;div class="moz-cite-prefix"&gt;在 2017年05月26日 09:42, dw 写道:&lt;br&gt;
      &lt;/div&gt;
      &lt;blockquote type="cite"
        cite="mid:a1ff4a2c-6038-76b3-2671-af547d86a111@163.com"&gt;
        &lt;meta http-equiv="Content-Type" content="text/html;
          charset=utf-8"&gt;
        &lt;div class="moz-cite-prefix"&gt;在 2017年05月25日 18:54, Daniel P.
          Berrange 写道:&lt;br&gt;
        &lt;/div&gt;
        &lt;blockquote type="cite"
          cite="mid:20170525105419.GD18049@redhat.com"&gt;
          &lt;pre wrap=""&gt;On Thu, May 25, 2017 at 06:51:40PM +0800, dw wrote:
&lt;/pre&gt;
          &lt;blockquote type="cite"&gt;
            &lt;pre wrap=""&gt;在 2017年05月25日 18:37, Daniel P. Berrange 写道:
&lt;/pre&gt;
            &lt;blockquote type="cite"&gt;
              &lt;pre wrap=""&gt;On Thu, May 25, 2017 at 06:20:51PM +0800, dw wrote:
&lt;/pre&gt;
              &lt;blockquote type="cite"&gt;
                &lt;pre wrap=""&gt;Hi:

     I'm trying to connect with libvirtd with virsh from a remote PC,but only
can establish 1000 connections.

     If try more connections,prompt:

     "error: failed to connect to the hypervisor
     error: Failed to open file '/etc/libvirt/libvirt.conf': Too many open
files"

     I tried in another PC,also get the same prompt.

     Anybody know why?
&lt;/pre&gt;
              &lt;/blockquote&gt;
              &lt;pre wrap=""&gt;There's a limit of 1024 open file handles by default on Linux. You would
have to raise that limit in /etc/security/limits.d/ for your user.

&lt;/pre&gt;
            &lt;/blockquote&gt;
            &lt;pre wrap=""&gt;In /etc/security/limits.d/,there is only 20-nproc.conf.
&lt;/pre&gt;
          &lt;/blockquote&gt;
          &lt;pre wrap=""&gt;You can create any files you want in that sub-directory - they just
use the same syntax as limits.conf. It means that if RPM upgrades
limits.conf it doesn't interfere with your changes in limits.d/custom.conf

&lt;/pre&gt;
          &lt;blockquote type="cite"&gt;
            &lt;pre wrap=""&gt;I modified /etc/security/limits.conf,what I added is:

        "*       soft nofile 81920
        *       hard nofile 81920"

I also modified /etc/pam.d/login,that I added is:

    "session required        pam_limits.so"
&lt;/pre&gt;
          &lt;/blockquote&gt;
          &lt;pre wrap=""&gt;I don't think that's needed - its already activated via
pam.d/system-auth which is included from login.

&lt;/pre&gt;
          &lt;blockquote type="cite"&gt;
            &lt;pre wrap=""&gt;The output of "ulimit -a" is:

    core file size          (blocks, -c) 0
    data seg size           (kbytes, -d) unlimited
    scheduling priority             (-e) 0
    file size               (blocks, -f) unlimited
    pending signals                 (-i) 385898
    max locked memory       (kbytes, -l) 64
    max memory size         (kbytes, -m) unlimited
    open files                      (-n) 81920
    pipe size            (512 bytes, -p) 8
    POSIX message queues     (bytes, -q) 819200
    real-time priority              (-r) 0
    stack size              (kbytes, -s) 8192
    cpu time               (seconds, -t) unlimited
    max user processes              (-u) 385898
    virtual memory          (kbytes, -v) unlimited
    file locks                      (-x) unlimited


What I did is right?
&lt;/pre&gt;
          &lt;/blockquote&gt;
          &lt;pre wrap=""&gt;That at least shows the new limit is active

Regards,
Daniel
&lt;/pre&gt;
        &lt;/blockquote&gt;
        &lt;p&gt;I restored  /etc/security/limits.conf and /etc/pam.d/login.&lt;/p&gt;
        &lt;p&gt;And added file /etc/security/limits.d/21-nofile.conf, the
          content is&lt;/p&gt;
        &lt;blockquote&gt;
          &lt;p&gt; *       soft    nofile      10240&lt;br&gt;
             *       hard    nofile      10240"&lt;/p&gt;
        &lt;/blockquote&gt;
        &lt;p align="justify"&gt;The output of "ulimit -a" now is:&lt;/p&gt;
        &lt;blockquote&gt;
          &lt;p&gt;core file size          (blocks, -c) 0&lt;br&gt;
            data seg size           (kbytes, -d) unlimited&lt;br&gt;
            scheduling priority             (-e) 0&lt;br&gt;
            file size               (blocks, -f) unlimited&lt;br&gt;
            pending signals                 (-i) 385898&lt;br&gt;
            max locked memory       (kbytes, -l) 64&lt;br&gt;
            max memory size         (kbytes, -m) unlimited&lt;br&gt;
            open files                      (-n) 10240&lt;br&gt;
            pipe size            (512 bytes, -p) 8&lt;br&gt;
            POSIX message queues     (bytes, -q) 819200&lt;br&gt;
            real-time priority              (-r) 0&lt;br&gt;
            stack size              (kbytes, -s) 8192&lt;br&gt;
            cpu time               (seconds, -t) unlimited    &lt;br&gt;
            max user processes              (-u) 385898&lt;br&gt;
            virtual memory          (kbytes, -v) unlimited&lt;br&gt;
            file locks                      (-x) unlimited&lt;br&gt;
          &lt;/p&gt;
        &lt;/blockquote&gt;
        &lt;br&gt;
        &lt;p&gt;The related config of /etc/libvirt/libvirtd.conf is:&lt;/p&gt;
        &lt;blockquote&gt;max_clients = 5000&lt;br&gt;
          max_queued_clients = 2000&lt;br&gt;
          min_workers = 200&lt;br&gt;
          max_workers = 2000&lt;br&gt;
          max_requests = 5000&lt;br&gt;
          max_client_requests = 2000&lt;br&gt;
        &lt;/blockquote&gt;
        &lt;br&gt;
        Now I still get the error:&lt;br&gt;
        &lt;blockquote&gt;
          &lt;pre wrap=""&gt;error: failed to connect to the hypervisor
error: Failed to open file '/etc/libvirt/libvirt.conf': Too many open files&lt;/pre&gt;
        &lt;/blockquote&gt;
        &lt;br&gt;
      &lt;/blockquote&gt;
      &lt;p&gt;I tried twice,and the result is:&lt;/p&gt;
      &lt;blockquote&gt;
        &lt;p&gt;virsh -c qemu+tcp://remote_pc/system&lt;br&gt;
          error: failed to connect to the hypervisor&lt;br&gt;
          error: Failed to open file '/etc/libvirt/libvirt.conf': Too
          many open files&lt;br&gt;
          &lt;br&gt;
           virsh -c qemu+ssh://remote_pc/system&lt;br&gt;
          error: failed to connect to the hypervisor&lt;br&gt;
          error: Failed to open file '/proc/4931/stat': Too many open
          files&lt;br&gt;
        &lt;/p&gt;
      &lt;/blockquote&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
    Hi Daniel:&lt;br&gt;
    &lt;br&gt;
         I have solved the problem.&lt;br&gt;
        Not anything above need to do in my PC, the only need to do is:&lt;br&gt;
        &lt;br&gt;
    &lt;blockquote&gt;Create
      /etc/systemd/system/libvirtd.service.d/openfiles.conf, and write
      the following two lines in it:&lt;br&gt;
      &lt;blockquote&gt;[Service]&lt;br&gt;
        LimitNOFILE=2048&lt;br&gt;
      &lt;/blockquote&gt;
      then run "service libvirtd restart",and if needed,run "systemctl
      daemon-reload"&lt;br&gt;
      &lt;br&gt;
    &lt;/blockquote&gt;
        If need more connections, increase LimitNOFILE, and also need to
    modify /etc/libvirt/libvirtd.conf.&lt;br&gt;
    &lt;br&gt;
        Thank you for your help!&lt;br&gt;
    &lt;br&gt;
    &lt;pre wrap=""&gt;Regards,
dw
&lt;/pre&gt;
  &lt;/body&gt;
&lt;/html&gt;


</body></email><email><emailId>20170531140833</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-05-31 14:08:33-0400</timestampReceived><subject>Re: [libvirt-users] Another hopefully simple question</subject><body>

On 05/28/2017 04:29 AM, Leroy Tennison wrote:
&gt; Actually the last for now.  Is there a way to determine from the
&gt; hypervisor (kvm/libvirt/qemu) if a VM has unmounted a partition?

Not really. This is completely OS matter. You can always ssh into the
guest and run mount to find out. Maybe if you share your use case with
us we can find a better solution?

Michal

</body></email><email><emailId>20170531141520</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-05-31 14:15:20-0400</timestampReceived><subject>Re: [libvirt-users] Hopefully simple question</subject><body>

On 05/28/2017 04:27 AM, Leroy Tennison wrote:
&gt; Is there a way to determine what the hypervisor default NIC is? I'm
&gt; using kvm/libvirt/qemu.  If this is the wrong forum please please reply
&gt; with that.

Long story short, depending on what your quemu supports libvirt has a
preference function that tries to pick the most widely supported NIC model:

http://libvirt.org/git/?p=libvirt.git;a=blob;f=src/qemu/qemu_domain.c;h=0a85ee9d74f6c69a10275dbed5e4d9800d073ffb;hb=HEAD#l3180


We don't query the OS in any way for the list of supported NIC models.
However, looks like virt-install has some logic on this matter too which
actually consults the guests OS (well, libosinfo):

https://github.com/virt-manager/virt-manager/blob/master/virtinst/osdict.py#L450

Michal


</body></email><email><emailId>20170403020208</emailId><senderName>Spike</senderName><senderEmail>spike@drba.org</senderEmail><timestampReceived>2017-04-03 02:02:08-0400</timestampReceived><subject>[libvirt-users] libvirt-lxc: good for production?</subject><body>

Dear all,

I'm a happy lxc (lxd) user with a need to add a bunch of KVM images to the
mix. More importantly I need to have some simple frontend to give users the
ability to quickly run some VMs for testing.

Researching the topic brought me to virt-manager and from there libvirt.
I've had however a hard time to answer a few questions that I hope this
list can help me with:

1) is the libvirt-lxc driver actively developed? there's been a lot of
upgrades to lxc and there seems to be relatively little activity on the lxc
driver
2) is libvirt-lxc to be used in production to begin with? every single
guide I found about libvirt pretty much points to KVM usage, with simple
/bin/sh examples with lxc.  Furthermore stuff like virt-install seems to be
exclusively catered to full os/KVM images creation, with no obvious way to
create a container image.

thanks for any input, even just docs I missed that explain the avove would
be most helpful.

Spike

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Dear all,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I'm a happy lxc (lxd) user with a \
need to add a bunch of KVM images to the mix. More importantly I need to have some \
simple frontend to give users the ability to quickly run some VMs for \
testing.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Researching the topic brought me to virt-manager \
and from there libvirt. I've had however a hard time to answer a few questions \
that I hope this list can help me with:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1) is the \
libvirt-lxc driver actively developed? there's been a lot of upgrades to lxc and \
there seems to be relatively little activity on the lxc driver&lt;/div&gt;&lt;div&gt;2) is \
libvirt-lxc to be used in production to begin with? every single guide I found about \
libvirt pretty much points to KVM usage, with simple /bin/sh examples with lxc.   \
Furthermore stuff like virt-install seems to be exclusively catered to full os/KVM \
images creation, with no obvious way to create a container \
image.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;thanks for any input, even just docs I missed that \
explain the avove would be most helpful.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Spike&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170403175233</emailId><senderName>Spike</senderName><senderEmail>spike@drba.org</senderEmail><timestampReceived>2017-04-03 17:52:33-0400</timestampReceived><subject>[libvirt-users] creating a lxc image to be used with libvirt-lxc</subject><body>

Dear all,

I'm moving my first baby steps with libvirt-lxc trying to convert over from
an LXD installation and one of the hurdles is putting together an image.

All the examples I found about libvirt-lxc refer to running /bin/sh in a
container, almost as if it was docker, as opposed to run a "full system"
like I've been doing with lxd. Also virt-install, often referred in libvirt
docs, seems to be specific/only for kvm.

Can anybody point me to any documentation to achieve the same as you'd do
with lxd? would it even just work to use those images (
https://cloud-images.ubuntu.com/) with libvirt? Last but not least, is
there any way to "publish" a modified image so that I could make changes to
any of the above and then reuse the modified one as a base for other
containers?

thank you,

spike

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Dear all,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I'm moving my first baby steps with \
libvirt-lxc trying to convert over from an LXD installation and one of the hurdles is \
putting together an image.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;All the examples I found about \
libvirt-lxc refer to running /bin/sh in a container, almost as if it was docker, as \
opposed to run a "full system" like I've been doing with lxd. Also \
virt-install, often referred in libvirt docs, seems to be specific/only for \
kvm.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Can anybody point me to any documentation to achieve \
the same as you'd do with lxd? would it even just work to use those images (&lt;a \
href="https://cloud-images.ubuntu.com/"&gt;https://cloud-images.ubuntu.com/&lt;/a&gt;) with \
libvirt? Last but not least, is there any way to "publish" a modified image \
so that I could make changes to any of the above and then reuse the modified one as a \
base for other containers?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;thank \
you,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;spike&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170402100523</emailId><senderName>Tony Arnold</senderName><senderEmail>tony.arnold@manchester.ac.uk</senderEmail><timestampReceived>2017-04-02 10:05:23-0400</timestampReceived><subject>[libvirt-users] Cannot save domain</subject><body>

I have a domain running a Windows 10 system on an Ubuntu 16.10 host
system. The domain has 4096MiB of memory. When I try to save the
domain, or managedsave the domain, I get an error when it's about 96%
complete. The terminal session looks like this:

virsh # save Windows10 windows10-20170402.save --bypass-cache --verbose
Save: [ 95 %]error: Failed to save domain Windows10 to windows10-
0170402.save
error: operation failed: domain is not running

It seems the domain closes before the save has completed.

libvirt is at version 2.1.0

Should I submit this as a bug, or is there something I can change to
fix this?

Regards,
Tony.
-- 
Tony Arnold  MBCS, CITP | Senior IT Security Analyst | Directorate of IT
Services | G64, Kilburn Building | The University of Manchester |
Manchester M13 9PL | T: +44 161 275 6093 | M: +44 773 330 0039

</body></email><email><emailId>20170412125818</emailId><senderName>Marko Weber | 8000</senderName><senderEmail>weber@zbfmail.de</senderEmail><timestampReceived>2017-04-12 12:58:18-0400</timestampReceived><subject>[libvirt-users] Windows Guest Server 2016, bad performance of whole virtualisation system</subject><body>


hello list,
i did a kvm guest with virt-manager and installed windows server 2016.
performance settings for the disk: hypervisor default  for cache &amp; io 
mode

i added a 2nd disk to the guest , also with hypervisor default settings 
on cache &amp; io mode
Under disk settings in windows server 2016 i set "format whole disk 
NTFS"
i did not choose the "quick format" option.

when windows is formatting this 1TB drive the performance on the 
virtualisation host goes down
loging via ssh take ages, top take 2 mins to start up.

the physical disks are connected to a raid controller LSI and FS on 
virtualisation server where the qcow2 files are is XFS.

DO i have to set another options for "performance options" as 
"hypervisor default" to keep the system performant on formatting the 
disk?

thanks for any hints.

marko



-- 
zbfmail - Mittendrin statt nur Datei!

</body></email><email><emailId>20170415001631</emailId><senderName>spiperac</senderName><senderEmail>spiperac.dev@gmail.com</senderEmail><timestampReceived>2017-04-15 00:16:31-0400</timestampReceived><subject>[libvirt-users] Libvirt and libssh2 with openauth</subject><body>

Hi all,
 i have same question as this one
https://www.redhat.com/archives/libvirt-users/2014-March/msg00158.html. (
Only im using python)
Is there any new follow-up on this?
Thanks

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi all,&lt;div&gt;  i have same question as this one  &lt;a \
href="https://www.redhat.com/archives/libvirt-users/2014-March/msg00158.html"&gt;https://www.redhat.com/archives/libvirt-users/2014-March/msg00158.html&lt;/a&gt;. \
( Only im using python)&lt;br&gt;Is there any new follow-up on this?&lt;br&gt;Thanks&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170420082611</emailId><senderName>mailing lists</senderName><senderEmail>listas.correo@yahoo.es</senderEmail><timestampReceived>2017-04-20 08:26:11-0400</timestampReceived><subject>[libvirt-users] understanding --idmap for containers (v2.5.0)</subject><body>

Hello,
I'm testing containers on a host machine without selinux so I'm trying use the idmap \
feature, but I must be missing something because all that I get is a readonly \
container for the root user.

# virsh version --daemon
Compiled against library: libvirt 2.5.0
Using library: libvirt 2.5.0
Using API: QEMU 2.5.0
Running hypervisor: QEMU 2.8.1
Running against daemon: 2.5.0

# virsh --connect lxc:/// dumpxml lab-gentoo-01
&lt;domain type='lxc'&gt;
   &lt;name&gt;lab-gentoo-01&lt;/name&gt;
   &lt;uuid&gt;a9f73091-b716-4b61-95ad-fa1d0c061bef&lt;/uuid&gt;
   &lt;memory unit='KiB'&gt;524288&lt;/memory&gt;
   &lt;currentMemory unit='KiB'&gt;524288&lt;/currentMemory&gt;
   &lt;vcpu placement='static'&gt;2&lt;/vcpu&gt;
   &lt;resource&gt;
       &lt;partition&gt;/machine&lt;/partition&gt;
   &lt;/resource&gt;
   &lt;os&gt;
       &lt;type arch='x86_64'&gt;exe&lt;/type&gt;
       &lt;init&gt;/bin/sh&lt;/init&gt;
   &lt;/os&gt;
   &lt;idmap&gt;
       &lt;uid start='0' target='900' count='10'/&gt;
       &lt;gid start='0' target='900' count='10'/&gt;
   &lt;/idmap&gt;
   &lt;features&gt;
       &lt;privnet/&gt;
   &lt;/features&gt;
   &lt;cpu mode='host-model'&gt;
       &lt;model fallback='allow'/&gt;
   &lt;/cpu&gt;
   &lt;clock offset='utc'/&gt;
   &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
   &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
   &lt;on_crash&gt;destroy&lt;/on_crash&gt;
   &lt;devices&gt;
       &lt;emulator&gt;/usr/libexec/libvirt_lxc&lt;/emulator&gt;
       &lt;filesystem type='mount' accessmode='passthrough'&gt;
           &lt;source dir='/media/containers/lab-gentoo-01/'/&gt;
           &lt;target dir='/'/&gt;
       &lt;/filesystem&gt;
       &lt;interface type='bridge'&gt;
           &lt;mac address='00:16:3e:c8:13:14'/&gt;
           &lt;source bridge='bridge-01'/&gt;
       &lt;/interface&gt;
       &lt;console type='pty'&gt;
           &lt;target type='lxc' port='0'/&gt;
       &lt;/console&gt;
   &lt;/devices&gt;
&lt;/domain&gt;


# ls -l /media/containers/lab-gentoo-01/
total 36
drwxr-xr-x   2 root root 4096 Apr 13 07:33 bin
drwxr-xr-x   2 root root     18 Apr 13 03:28 boot
drwxr-xr-x   7 root root 4096 Apr 18 12:45 dev
drwxr-xr-x 31 root root 4096 Apr 18 12:49 etc
drwxr-xr-x   2 root root     18 Apr 13 03:28 home
lrwxrwxrwx   1 root root       5 Apr 13 06:13 lib -&gt; lib64
drwxr-xr-x   2 root root 4096 Apr 13 06:14 lib32
drwxr-xr-x   9 root root 4096 Apr 13 07:33 lib64
drwxr-xr-x   2 root root     18 Apr 13 03:28 media
drwxr-xr-x   2 root root     18 Apr 13 03:28 mnt
drwxr-xr-x   2 root root     18 Apr 13 03:28 opt
drwxr-xr-x   2 root root       6 Apr 13 03:18 proc
drwx------   2 root root     18 Apr 13 03:28 root
drwxr-xr-x   2 root root     31 Apr 13 07:32 run
drwxr-xr-x   2 root root 4096 Apr 13 07:36 sbin
drwxr-xr-x   2 root root     18 Apr 13 03:28 sys
drwxrwxrwt   2 root root     18 Apr 13 07:36 tmp
drwxr-xr-x 13 root root 4096 Apr 18 12:49 usr
drwxr-xr-x   9 root root   102 Apr 13 03:28 var


# virsh --connect lxc:/// start --console lab-gentoo-01
Domain lab-gentoo-01 started
Connected to domain lab-gentoo-01
Escape character is ^]
sh-4.3# /usr/bin/id
uid=0(root) gid=0(root) groups=0(root)
sh-4.3# pwd
/
sh-4.3# touch asdf
touch: cannot touch 'asdf': Permission denied
sh-4.3# 

indeed the container is using the idmap feature because the efective uid/gid map \
(900/900) is not allowing writes in the filesystem, but it doesn't seems very \
usefull. 

is it possible to have read/write containers while using idmap?


[Attachment #3 (text/html)]

&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;div style="color:#000; background-color:#fff; \
font-family:Helvetica Neue, Helvetica, Arial, Lucida Grande, \
sans-serif;font-size:16px"&gt;&lt;div \
id="yui_3_16_0_ym19_1_1492675728065_7834"&gt;Hello,&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1492675728065_7835"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1492675728065_7836"&gt;I'm testing containers on a host machine \
without selinux so I'm trying use the idmap feature, but I must be missing something \
because all that I get is a readonly container for the root user.&lt;br&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1492675728065_14662"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1492675728065_14664" dir="ltr"&gt;# virsh version --daemon&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_14677"&gt;Compiled against library: libvirt 2.5.0&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_14678"&gt;Using library: libvirt 2.5.0&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_14679"&gt;Using API: QEMU 2.5.0&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_14680"&gt;Running hypervisor: QEMU 2.8.1&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_14681"&gt;Running against daemon: 2.5.0&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_14682"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1492675728065_8000"&gt;# virsh --connect lxc:/// dumpxml \
lab-gentoo-01&lt;br id="yui_3_16_0_ym19_1_1492675728065_7950"&gt;&lt;domain \
type='lxc'&gt;&lt;br id="yui_3_16_0_ym19_1_1492675728065_7951"&gt;  \
&lt;name&gt;lab-gentoo-01&lt;/name&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7952"&gt;  \
&lt;uuid&gt;a9f73091-b716-4b61-95ad-fa1d0c061bef&lt;/uuid&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7953"&gt;  &lt;memory \
unit='KiB'&gt;524288&lt;/memory&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7954"&gt;  &lt;currentMemory \
unit='KiB'&gt;524288&lt;/currentMemory&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7955"&gt;  &lt;vcpu \
placement='static'&gt;2&lt;/vcpu&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7956"&gt;  &lt;resource&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7957"&gt;    \
&lt;partition&gt;/machine&lt;/partition&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7958"&gt;  &lt;/resource&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7959"&gt;  &lt;os&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7960"&gt;    &lt;type \
arch='x86_64'&gt;exe&lt;/type&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7961"&gt;    \
&lt;init&gt;/bin/sh&lt;/init&gt;&lt;br id="yui_3_16_0_ym19_1_1492675728065_7962"&gt;  \
&lt;/os&gt;&lt;br id="yui_3_16_0_ym19_1_1492675728065_7963"&gt;  &lt;idmap&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7964"&gt;    &lt;uid start='0' \
target='900' count='10'/&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7965"&gt;    &lt;gid start='0' \
target='900' count='10'/&gt;&lt;br id="yui_3_16_0_ym19_1_1492675728065_7966"&gt;  \
&lt;/idmap&gt;&lt;br id="yui_3_16_0_ym19_1_1492675728065_7967"&gt;  \
&lt;features&gt;&lt;br id="yui_3_16_0_ym19_1_1492675728065_7968"&gt;    \
&lt;privnet/&gt;&lt;br id="yui_3_16_0_ym19_1_1492675728065_7969"&gt;  \
&lt;/features&gt;&lt;br id="yui_3_16_0_ym19_1_1492675728065_7970"&gt;  &lt;cpu \
mode='host-model'&gt;&lt;br id="yui_3_16_0_ym19_1_1492675728065_7971"&gt;    \
&lt;model fallback='allow'/&gt;&lt;br id="yui_3_16_0_ym19_1_1492675728065_7972"&gt;  \
&lt;/cpu&gt;&lt;br id="yui_3_16_0_ym19_1_1492675728065_7973"&gt;  &lt;clock \
offset='utc'/&gt;&lt;br id="yui_3_16_0_ym19_1_1492675728065_7974"&gt;  \
&lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7975"&gt;  \
&lt;on_reboot&gt;restart&lt;/on_reboot&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7976"&gt;  \
&lt;on_crash&gt;destroy&lt;/on_crash&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7977"&gt;  &lt;devices&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7978"&gt;    \
&lt;emulator&gt;/usr/libexec/libvirt_lxc&lt;/emulator&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7979"&gt;    &lt;filesystem \
type='mount' accessmode='passthrough'&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7980"&gt;      &lt;source \
dir='/media/containers/lab-gentoo-01/'/&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7981"&gt;      &lt;target \
dir='/'/&gt;&lt;br id="yui_3_16_0_ym19_1_1492675728065_7982"&gt;    \
&lt;/filesystem&gt;&lt;br id="yui_3_16_0_ym19_1_1492675728065_7983"&gt;    \
&lt;interface type='bridge'&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7984"&gt;      &lt;mac \
address='00:16:3e:c8:13:14'/&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7985"&gt;      &lt;source \
bridge='bridge-01'/&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7986"&gt;    &lt;/interface&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7987"&gt;    &lt;console \
type='pty'&gt;&lt;br id="yui_3_16_0_ym19_1_1492675728065_7988"&gt;      \
&lt;target type='lxc' port='0'/&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7989"&gt;    &lt;/console&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7990"&gt;  &lt;/devices&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7991"&gt;&lt;/domain&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7992"&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1492675728065_9625"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1492675728065_24487"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1492675728065_24548"&gt;# ls -l \
/media/containers/lab-gentoo-01/&lt;br id="yui_3_16_0_ym19_1_1492675728065_24528"&gt;total \
36&lt;br id="yui_3_16_0_ym19_1_1492675728065_24529"&gt;drwxr-xr-x  2 root root 4096 \
Apr 13 07:33 bin&lt;br id="yui_3_16_0_ym19_1_1492675728065_24530"&gt;drwxr-xr-x  2 \
root root   18 Apr 13 03:28 boot&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_24531"&gt;drwxr-xr-x  7 root root 4096 Apr 18 \
12:45 dev&lt;br id="yui_3_16_0_ym19_1_1492675728065_24532"&gt;drwxr-xr-x 31 root root 4096 \
Apr 18 12:49 etc&lt;br id="yui_3_16_0_ym19_1_1492675728065_24533"&gt;drwxr-xr-x  2 \
root root   18 Apr 13 03:28 home&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_24534"&gt;lrwxrwxrwx  1 root \
root    5 Apr 13 06:13 lib -&gt; lib64&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_24535"&gt;drwxr-xr-x  2 root root 4096 Apr 13 \
06:14 lib32&lt;br id="yui_3_16_0_ym19_1_1492675728065_24536"&gt;drwxr-xr-x  9 root \
root 4096 Apr 13 07:33 lib64&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_24537"&gt;drwxr-xr-x  2 root root   \
18 Apr 13 03:28 media&lt;br id="yui_3_16_0_ym19_1_1492675728065_24538"&gt;drwxr-xr-x  \
2 root root   18 Apr 13 03:28 mnt&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_24539"&gt;drwxr-xr-x  2 root root   \
18 Apr 13 03:28 opt&lt;br id="yui_3_16_0_ym19_1_1492675728065_24540"&gt;drwxr-xr-x  2 \
root root    6 Apr 13 03:18 proc&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_24541"&gt;drwx------  2 root root   \
18 Apr 13 03:28 root&lt;br id="yui_3_16_0_ym19_1_1492675728065_24542"&gt;drwxr-xr-x  2 \
root root   31 Apr 13 07:32 run&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_24543"&gt;drwxr-xr-x  2 root root 4096 Apr 13 \
07:36 sbin&lt;br id="yui_3_16_0_ym19_1_1492675728065_24544"&gt;drwxr-xr-x  2 root \
root   18 Apr 13 03:28 sys&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_24545"&gt;drwxrwxrwt  2 root root   \
18 Apr 13 07:36 tmp&lt;br id="yui_3_16_0_ym19_1_1492675728065_24546"&gt;drwxr-xr-x 13 root \
root 4096 Apr 18 12:49 usr&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_24547"&gt;drwxr-xr-x  9 root root  102 Apr \
13 03:28 var&lt;br&gt;&lt;/div&gt;&lt;div dir="ltr"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="ltr"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
dir="ltr" id="yui_3_16_0_ym19_1_1492675728065_9624"&gt;# virsh --connect lxc:/// start \
--console lab-gentoo-01&lt;br id="yui_3_16_0_ym19_1_1492675728065_9681"&gt;Domain \
lab-gentoo-01 started&lt;br id="yui_3_16_0_ym19_1_1492675728065_9682"&gt;Connected to \
domain lab-gentoo-01&lt;br id="yui_3_16_0_ym19_1_1492675728065_9683"&gt;Escape character is \
^]&lt;br id="yui_3_16_0_ym19_1_1492675728065_9684"&gt;sh-4.3# /usr/bin/id&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_9685"&gt;uid=0(root) gid=0(root) groups=0(root)&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_9686"&gt;sh-4.3# pwd&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_9687"&gt;/&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_9688"&gt;sh-4.3# touch asdf&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_9689"&gt;touch: cannot touch 'asdf': Permission \
denied&lt;br id="yui_3_16_0_ym19_1_1492675728065_9690"&gt;sh-4.3# &lt;br \
id="yui_3_16_0_ym19_1_1492675728065_9691"&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1492675728065_11330"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1492675728065_11331"&gt;indeed the container is using the idmap \
feature because the efective uid/gid map (900/900) is not allowing writes in the \
filesystem, but it doesn't seems very usefull. &lt;br&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1492675728065_17946"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1492675728065_17961"&gt;is it possible to have read/write \
containers while using idmap?&lt;br&gt;&lt;/div&gt;&lt;div dir="ltr"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="ltr"&gt;&lt;br \
id="yui_3_16_0_ym19_1_1492675728065_7993"&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;



</body></email><email><emailId>20170421071647</emailId><senderName>Anastasiya Ruzhanskaya</senderName><senderEmail>anastasiya.ruzhanskaya@frtk.ru</senderEmail><timestampReceived>2017-04-21 07:16:47-0400</timestampReceived><subject>[libvirt-users] libvirt remote connection</subject><body>

Hello,
I have some questions about libvirt remote connection.
Am I right that internally libvirt uses only tcp ( ssh and tls are only
encryption based on this) + ftp ( when working with image itself)? Also I
have found that  it uses RPC. However, as I know RPC runs above tcp but I
cannot capture these packets with wireshark when I am connecting remotely
to the host with vm? Is it somehow possible to find out, what data, what
messages, in what format are send from my server to the remote libvirt
(daemon I suppose?)?

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;Hello,&lt;br&gt;&lt;/div&gt;I have some questions about libvirt remote \
connection. &lt;br&gt;&lt;/div&gt;Am I right that internally libvirt uses only tcp ( ssh and tls \
are only encryption based on this) + ftp ( when working with image itself)? Also I \
have found that   it uses RPC. However, as I know RPC runs above tcp but I cannot \
capture these packets with wireshark when I am connecting remotely to the host with \
vm? Is it somehow possible to find out, what data, what messages, in what format are \
send from my server to the remote libvirt (daemon I suppose?)?&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170420053642</emailId><senderName>Rafał_Wojciechowski</senderName><senderEmail>it@rafalwojciechowski.pl</senderEmail><timestampReceived>2017-04-20 05:36:42-0400</timestampReceived><subject>[libvirt-users] libvirtd segfault when using oVirt 4.1 with graphic console - CentOS7.3</subject><body>

hello,

I am getting such error:
libvirtd[27218]: segfault at 0 ip 00007f4940725721 sp 00007f4930711740 
error 4 in libvirt.so.0.2000.0[7f4940678000+353000]

when I am trying to start VM with graphic spice/vnc console - in 
headless mode(without graphic console) it is running
I noticed this after update oVirt 4.0 to oVirt 4.1 however I noticed 
that also libvirtd and related packages were upgraded from 1.2.7 to 2.0.0:
libvirt-daemon-kvm-2.0.0-10.el7_3.5.x86_64
libvirt-daemon-driver-qemu-2.0.0-10.el7_3.5.x86_64

I am running up to date CentOS7.3 with 3.10.0-514.16.1.el7.x86_64
I have same issue with SELinux and without SELinux(checked after reboot 
with permissive mode)


I tried to get information about this issue from oVirt team, but after 
mail conversation both me and oVirt team thinks that it might be issue 
in libvirtd

in below link I am putting xmls generated by vdsm which are passing to 
the libvirtd to run the VMs
first one is from vdsm log and second one is extracted from dump after 
segfault of libvirtd

https://paste.fedoraproject.org/paste/eqpe8Byu2l-3SRdXc6LTLl5M1UNdIGYhyRLivL9gydE=

Regards,

Rafal Wojciechowski

</body></email><email><emailId>20170421184004</emailId><senderName>Vasiliy Tolstov</senderName><senderEmail>v.tolstov@selfip.ru</senderEmail><timestampReceived>2017-04-21 18:40:04-0400</timestampReceived><subject>[libvirt-users] subscribe to domain start/stop/panic events</subject><body>

Hi! How can i'm subscribe in my app to domain lifecycle messages?
Does it possible to subscribe for all domains and not just one?

-- 
Vasiliy Tolstov,
e-mail: v.tolstov@selfip.ru

</body></email><email><emailId>20170421060100</emailId><senderName>Daniel Pocock</senderName><senderEmail>daniel@pocock.pro</senderEmail><timestampReceived>2017-04-21 06:01:00-0400</timestampReceived><subject>[libvirt-users] virt-manager, Network Manager and bridged networking</subject><body>


The wiki suggests that Network Manager doesn't support bridges[1] but I
think that is out-of-date.  Other documents like this[2] show how to set
up bridges in Network Manager.

For users wanting to run libvirt/KVM on their desktop system, can they
now configure a bridge through Network Manager and then use it in
virt-manager to create a guest without editing any of their
configuration files by hand?

Would it be possible for virsh or virt-manager to be enhanced to go one
step further and automatically create bridges in Network Manager (using
some API) on demand so the user doesn't have to do anything outside of
virt-manager?

Regards,

Daniel



1. https://wiki.libvirt.org/page/Networking#Fedora.2FRHEL_Bridging
2. http://ask.xmodulo.com/configure-linux-bridge-network-manager-ubuntu.html

</body></email><email><emailId>20170414114529</emailId><senderName>"Thies C. Arntzen"</senderName><senderEmail>thieso@gmail.com</senderEmail><timestampReceived>2017-04-14 11:45:29-0400</timestampReceived><subject>[libvirt-users] ZFS: creating a pool in a created zfs does not work, only when using the whole zfs-p</subject><body>

Hi,

I'm new here so apologies if this has been answered before.

I have a box that uses ZFS for everything (ubuntu 17.04) and I want to
create a libvirt pool on that. My ZFS pool is named „big"

So i do:

&gt; zfs create big/zpool
&gt; virsh pool-define-as --name zpool --source-name big/zpool --type zfs
&gt; virsh pool-start zpool
&gt; virsh pool-autostart zpool
&gt; virsh pool-list
&gt; virsh vol-create-as --pool zpool --name test1 --capacity 1G
&gt; virsh vol-list zpool

Everything seems to work (no error message, vol-list shows the created
volume, I can see the volume
via zfs list -t all). -BUT- I cannot use that volume via virt-manager
and after a short while it's
no longer listed via virsh vol-list zpool. The very same thing works
as expected if I create a new zfs
pool which I hand into libvirt. So instead of creating a pool from
"big/zpool" I create a pool names
„somepool" on a free device and -voila- everything works.

Hope I did make myself clear?

Best regards,
thies

</body></email><email><emailId>20170423042617</emailId><senderName>Leroy Tennison</senderName><senderEmail>leroy.tennison@verizon.net</senderEmail><timestampReceived>2017-04-23 04:26:17-0400</timestampReceived><subject>[libvirt-users] External snapshot issue</subject><body>

I have used

    virsh snapshot-create-as &lt;VM name&gt; &lt;snapshot name&gt; "&lt;snapshot
    description&gt;" --diskspec
    "vda,snapshot=external,file=/path/to/external-snapshot" --disk-only
    --atomic

to create an external snapshot of a running VM.  I followed it with

    virsh blockpull &lt;VM name&gt; --path /path/to/external-snapshot

and monitored it until done.  I confirmed it with

    qemu-img info /path/to/external-snapshot

which shows no backing store.

However, when I do

    grep {/etc,/run}/libvirt/qemu/&lt;VM name&gt;.xml

the xml for the VM still shows a backing store in the /run/... 
definition (but not in the /etc/... definition, my understanding is that 
the /etc/... definition won't be updated until the VM is shut down):

       &lt;disk type='file' device='disk'&gt;
         &lt;driver name='qemu' type='qcow2'/&gt;
         &lt;source file='/var/lib/libvirt/images/external-snapshot.qcow2'/&gt;
         &lt;backingStore type='file' index='1'&gt;
           &lt;format type='qcow2'/&gt;
           &lt;source file='/var/lib/libvirt/images/original-image-file.qcow'/&gt;
           &lt;backingStore/&gt;
         &lt;/backingStore&gt;
         &lt;target dev='hda' bus='ide'/&gt;
         &lt;alias name='ide0-0-0'/&gt;
         &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
       &lt;/disk&gt;

This is using libvirtd version 1.3.1 and qemu-img version 2.5.0.

How do I resolve this situation?  I don't want to have to rely on a 
backing store permanently.  Thanks for any help or pointers.


[Attachment #3 (text/html)]

&lt;html&gt;
  &lt;head&gt;

    &lt;meta http-equiv="content-type" content="text/html; charset=utf-8"&gt;
  &lt;/head&gt;
  &lt;body bgcolor="#FFFFFF" text="#000000"&gt;
    &lt;p&gt;I have used&lt;/p&gt;
    &lt;blockquote&gt;
      &lt;p&gt;virsh snapshot-create-as &lt;VM name&gt; &lt;snapshot name&gt;
        "&lt;snapshot description&gt;" --diskspec
        "vda,snapshot=external,file=/path/to/external-snapshot"
        --disk-only --atomic&lt;/p&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;to create an external snapshot of a running VM.   I followed it
      with&lt;/p&gt;
    &lt;blockquote&gt;
      &lt;p&gt;virsh blockpull &lt;VM name&gt; --path
        /path/to/external-snapshot&lt;/p&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;and monitored it until done.   I confirmed it with&lt;/p&gt;
    &lt;blockquote&gt;
      &lt;p&gt;qemu-img info /path/to/external-snapshot&lt;br&gt;
      &lt;/p&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;which shows no backing store.&lt;/p&gt;
    &lt;p&gt;However, when I do&lt;/p&gt;
    &lt;blockquote&gt;
      &lt;p&gt;grep {/etc,/run}/libvirt/qemu/&lt;VM name&gt;.xml&lt;br&gt;
      &lt;/p&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;the xml for the VM still shows a backing store in the /run/...
      definition (but not in the /etc/... definition, my understanding
      is that the /etc/... definition won't be updated until the VM is
      shut down):&lt;/p&gt;
    &lt;p&gt;           &lt;disk type='file' device='disk'&gt;&lt;br&gt;
                     &lt;driver name='qemu' type='qcow2'/&gt;&lt;br&gt;
                     &lt;source
      file='/var/lib/libvirt/images/external-snapshot.qcow2'/&gt;&lt;br&gt;
                     &lt;backingStore type='file' index='1'&gt;&lt;br&gt;
                         &lt;format type='qcow2'/&gt;&lt;br&gt;
                         &lt;source
      file='/var/lib/libvirt/images/original-image-file.qcow'/&gt;&lt;br&gt;
                         &lt;backingStore/&gt;&lt;br&gt;
                     &lt;/backingStore&gt;&lt;br&gt;
                     &lt;target dev='hda' bus='ide'/&gt;&lt;br&gt;
                     &lt;alias name='ide0-0-0'/&gt;&lt;br&gt;
                     &lt;address type='drive' controller='0' bus='0' target='0'
      unit='0'/&gt;&lt;br&gt;
                 &lt;/disk&gt;&lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;This is using libvirtd version 1.3.1 and qemu-img version 2.5.0.&lt;/p&gt;
    &lt;p&gt;How do I resolve this situation?   I don't want to have to rely on
      a backing store permanently.   Thanks for any help or pointers.&lt;br&gt;
    &lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;


</body></email><email><emailId>20170424165432</emailId><senderName>Hui Jing</senderName><senderEmail>h.jingict@gmail.com</senderEmail><timestampReceived>2017-04-24 16:54:32-0400</timestampReceived><subject>[libvirt-users] Performance monotoring: Perf Event support</subject><body>

Hi everyone,

I am using libvirt 2.5.0. I'd like to enable the "perf events" to
monitoring my vm performance such as l3 cache. But it failed with "error:
argument unsupported: unable to enable host cpu perf event for cmt".
1. Could you please give some hints on how to check if my host CPU supports
cmt,mbm, is it displayed in /proc/cpuinfo?
2. Does the kernel version matters as well to support it?

Thanks,
Hui

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi everyone,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I am using libvirt 2.5.0. I'd like \
to enable the "perf events" to monitoring my vm performance such as l3 \
cache. But it failed with "error: argument unsupported: unable to enable host \
cpu perf event for cmt".&lt;/div&gt;&lt;div&gt;1. Could you please give some hints on how to \
check if my host CPU supports cmt,mbm, is it displayed in /proc/cpuinfo?&lt;/div&gt;&lt;div&gt;2. \
Does the kernel version matters as well to support it?&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail-m_4072804311946155898gmail_signature"&gt;&lt;div \
dir="ltr"&gt;Thanks,&lt;div&gt;Hui&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170426135139</emailId><senderName>Eric Blake</senderName><senderEmail>eblake@redhat.com</senderEmail><timestampReceived>2017-04-26 13:51:39-0400</timestampReceived><subject>[libvirt-users] Tunnelled migrate Windows7 VMs halted</subject><body>

[Attachment #2 (multipart/mixed)]


[moderator note: I'm forwarding a stripped down version of the original
mail which was rejected in the moderator queue. I stripped the 3.3
megabyte .tar.bz2 of the log file attachment, which is inappropriate for
a technical list. Either trim the log to the relevant portion, or host
the log externally and have your list email merely give a URL of the
externally-hosted file]

&gt; ForwardedMessage.eml
&gt; 
&gt; Subject:
&gt; Tunnelled migrate Windows7 VMs halted
&gt; From:
&gt; 邓林文 &lt;dlworld0@163.com&gt;
&gt; Date:
&gt; 04/25/2017 11:12 PM
&gt; 
&gt; To:
&gt; libvirt-users@redhat.com
&gt; 
&gt; 
&gt; 
&gt; I migrated a Windows 7 VM with libvirtd tunnelled, the VM halted on the target \
&gt; although the status is running.  
&gt; 
&gt; [root@test15 ~]# virsh migrate --live --p2p --tunnelled i-000000ac \
&gt; qemu+tcp://192.168.65.13/system 
&gt; 
&gt; But when migrated with qemu native mode, the VM runs well.
&gt; 
&gt; 
&gt; [root@test15 ~]# virsh migrate --live --p2p i-000000ac \
&gt; qemu+tcp://192.168.65.13/system 
&gt; 
&gt; System Info:
&gt; Release: Centos 7.2
&gt; Kernel: 3.10.0-327.28.3.el7.x86_64
&gt; Qemu: qemu-kvm-rhev-2.3.0
&gt; Libvirt: libvirt-1.2.17/libvirt-2.0.0
&gt; CPU: AMD Opteron(TM) Processor 6212
&gt; 
&gt; 
&gt; As CPUFrequency may lead windows migrate halt, I have disabled Power Management. 
&gt; 
&gt; 
&gt; Does anyone have some sugestions?
&gt; 
&gt; 
&gt; Thanks,
&gt; Linwen Deng
&gt; 
&gt; 
&gt; vm.xml
&gt; 
&gt; 
&gt; &lt;domain type='kvm' id='8'&gt;
&gt; &lt;name&gt;i-000000ac&lt;/name&gt;
&gt; &lt;uuid&gt;53f0710f-b25e-4f47-a7cf-c15a9409fdc3&lt;/uuid&gt;
&gt; &lt;metadata&gt;
&gt; &lt;nova:instance xmlns:nova="http://openstack.org/xmlns/libvirt/nova/1.0"&gt;
&gt; &lt;nova:package version="12.0.0-4"/&gt;
&gt; &lt;nova:name&gt;c7-vm15-test15-7&lt;/nova:name&gt;
&gt; &lt;nova:creationTime&gt;2017-04-14 06:48:54&lt;/nova:creationTime&gt;
&gt; &lt;nova:flavor name="oeflavor-4-2048-20"&gt;
&gt; &lt;nova:memory&gt;2048&lt;/nova:memory&gt;
&gt; &lt;nova:disk&gt;20&lt;/nova:disk&gt;
&gt; &lt;nova:swap&gt;0&lt;/nova:swap&gt;
&gt; &lt;nova:ephemeral&gt;0&lt;/nova:ephemeral&gt;
&gt; &lt;nova:vcpus&gt;4&lt;/nova:vcpus&gt;
&gt; &lt;/nova:flavor&gt;
&gt; &lt;nova:owner&gt;
&gt; &lt;nova:user uuid="b0f21b1d16b147ffb3f7713716cc894a"&gt;admin&lt;/nova:user&gt;
&gt; &lt;nova:project uuid="ae883f160c3c41db850d5cde8de8208b"&gt;service&lt;/nova:project&gt;
&gt; &lt;/nova:owner&gt;
&gt; &lt;/nova:instance&gt;
&gt; &lt;/metadata&gt;
&gt; &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;
&gt; &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMemory&gt;
&gt; &lt;memoryBacking&gt;
&gt; &lt;hugepages&gt;
&gt; &lt;page size='2048' unit='KiB' nodeset='0'/&gt;
&gt; &lt;/hugepages&gt;
&gt; &lt;/memoryBacking&gt;
&gt; &lt;vcpu placement='static'&gt;2&lt;/vcpu&gt;
&gt; &lt;cputune&gt;
&gt; &lt;shares&gt;4096&lt;/shares&gt;
&gt; &lt;vcpupin vcpu='0' cpuset='4-7'/&gt;
&gt; &lt;vcpupin vcpu='1' cpuset='4-7'/&gt;
&gt; &lt;emulatorpin cpuset='4-7'/&gt;
&gt; &lt;/cputune&gt;
&gt; &lt;resource&gt;
&gt; &lt;partition&gt;/machine&lt;/partition&gt;
&gt; &lt;/resource&gt;
&gt; &lt;sysinfo type='smbios'&gt;
&gt; &lt;system&gt;
&gt; &lt;entry name='manufacturer'&gt;Fedora Project&lt;/entry&gt;
&gt; &lt;entry name='product'&gt;OpenStack Nova&lt;/entry&gt;
&gt; &lt;entry name='version'&gt;12.0.0-4&lt;/entry&gt;
&gt; &lt;entry name='serial'&gt;95637afe-453f-42a8-b198-df673ab59c91&lt;/entry&gt;
&gt; &lt;entry name='uuid'&gt;53f0710f-b25e-4f47-a7cf-c15a9409fdc3&lt;/entry&gt;
&gt; &lt;entry name='family'&gt;Virtual Machine&lt;/entry&gt;
&gt; &lt;/system&gt;
&gt; &lt;/sysinfo&gt;
&gt; &lt;os&gt;
&gt; &lt;type arch='x86_64' machine='pc-i440fx-rhel7.2.0'&gt;hvm&lt;/type&gt;
&gt; &lt;boot dev='cdrom'/&gt;
&gt; &lt;boot dev='hd'/&gt;
&gt; &lt;boot dev='fd'/&gt;
&gt; &lt;smbios mode='sysinfo'/&gt;
&gt; &lt;/os&gt;
&gt; &lt;features&gt;
&gt; &lt;acpi/&gt;
&gt; &lt;apic/&gt;
&gt; &lt;/features&gt;
&gt; &lt;cpu mode='host-model'&gt;
&gt; &lt;model fallback='allow'/&gt;
&gt; &lt;topology sockets='2' cores='1' threads='1'/&gt;
&gt; &lt;/cpu&gt;
&gt; &lt;clock offset='utc'&gt;
&gt; &lt;timer name='pit' tickpolicy='delay'/&gt;
&gt; &lt;timer name='rtc' tickpolicy='catchup'/&gt;
&gt; &lt;timer name='hpet' present='no'/&gt;
&gt; &lt;/clock&gt;
&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
&gt; &lt;on_crash&gt;destroy&lt;/on_crash&gt;
&gt; &lt;devices&gt;
&gt; &lt;emulator&gt;/usr/libexec/qemu-kvm&lt;/emulator&gt;
&gt; &lt;disk type='file' device='disk'&gt;
&gt; &lt;driver name='qemu' type='qcow2' cache='none'/&gt;
&gt; &lt;source file='/opt/ssd/win7.qcow2'/&gt;
&gt; &lt;backingStore type='file' index='1'&gt;
&gt; &lt;format type='raw'/&gt;
&gt; &lt;source file='/opt/ssd/_base/win7.qcow2'/&gt;
&gt; &lt;backingStore/&gt;
&gt; &lt;/backingStore&gt;
&gt; &lt;target dev='vda' bus='virtio'/&gt;
&gt; &lt;serial&gt;8164a82d-6066-46d7-8a92-8391620fc58c&lt;/serial&gt;
&gt; &lt;alias name='virtio-disk0'/&gt;
&gt; &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x07' function='0x0'/&gt;
&gt; &lt;/disk&gt;
&gt; &lt;controller type='usb' index='0' model='ich9-ehci1'&gt;
&gt; &lt;alias name='usb'/&gt;
&gt; &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x06' function='0x7'/&gt;
&gt; &lt;/controller&gt;
&gt; &lt;controller type='usb' index='0' model='ich9-uhci1'&gt;
&gt; &lt;alias name='usb'/&gt;
&gt; &lt;master startport='0'/&gt;
&gt; &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x06' function='0x0' \
&gt; multifunction='on'/&gt; &lt;/controller&gt;
&gt; &lt;controller type='usb' index='0' model='ich9-uhci2'&gt;
&gt; &lt;alias name='usb'/&gt;
&gt; &lt;master startport='2'/&gt;
&gt; &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x06' function='0x1'/&gt;
&gt; &lt;/controller&gt;
&gt; &lt;controller type='usb' index='0' model='ich9-uhci3'&gt;
&gt; &lt;alias name='usb'/&gt;
&gt; &lt;master startport='4'/&gt;
&gt; &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x06' function='0x2'/&gt;
&gt; &lt;/controller&gt;
&gt; &lt;controller type='pci' index='0' model='pci-root'&gt;
&gt; &lt;alias name='pci.0'/&gt;
&gt; &lt;/controller&gt;
&gt; &lt;controller type='virtio-serial' index='0'&gt;
&gt; &lt;alias name='virtio-serial0'/&gt;
&gt; &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/&gt;
&gt; &lt;/controller&gt;
&gt; &lt;serial type='file'&gt;
&gt; &lt;source path='/var/lib/nova/instances/53f0710f-b25e-4f47-a7cf-c15a9409fdc3/console.log'/&gt;
&gt;  &lt;target port='0'/&gt;
&gt; &lt;alias name='serial0'/&gt;
&gt; &lt;/serial&gt;
&gt; &lt;serial type='pty'&gt;
&gt; &lt;source path='/dev/pts/2'/&gt;
&gt; &lt;target port='1'/&gt;
&gt; &lt;alias name='serial1'/&gt;
&gt; &lt;/serial&gt;
&gt; &lt;console type='file'&gt;
&gt; &lt;source path='/var/lib/nova/instances/53f0710f-b25e-4f47-a7cf-c15a9409fdc3/console.log'/&gt;
&gt;  &lt;target type='serial' port='0'/&gt;
&gt; &lt;alias name='serial0'/&gt;
&gt; &lt;/console&gt;
&gt; &lt;channel type='spicevmc'&gt;
&gt; &lt;target type='virtio' name='com.redhat.spice.0' state='connected'/&gt;
&gt; &lt;alias name='channel0'/&gt;
&gt; &lt;address type='virtio-serial' controller='0' bus='0' port='1'/&gt;
&gt; &lt;/channel&gt;
&gt; &lt;input type='tablet' bus='usb'&gt;
&gt; &lt;alias name='input0'/&gt;
&gt; &lt;/input&gt;
&gt; &lt;input type='mouse' bus='ps2'&gt;
&gt; &lt;alias name='input1'/&gt;
&gt; &lt;/input&gt;
&gt; &lt;input type='keyboard' bus='ps2'&gt;
&gt; &lt;alias name='input2'/&gt;
&gt; &lt;/input&gt;
&gt; &lt;graphics type='vnc' port='5900' autoport='yes' listen='0.0.0.0' keymap='en-us'&gt;
&gt; &lt;listen type='address' address='0.0.0.0'/&gt;
&gt; &lt;/graphics&gt;
&gt; &lt;graphics type='spice' port='5901' autoport='yes' listen='0.0.0.0' keymap='en-us'&gt;
&gt; &lt;listen type='address' address='0.0.0.0'/&gt;
&gt; &lt;image compression='auto_glz'/&gt;
&gt; &lt;streaming mode='filter'/&gt;
&gt; &lt;mouse mode='client'/&gt;
&gt; &lt;/graphics&gt;
&gt; &lt;sound model='ich6'&gt;
&gt; &lt;alias name='sound0'/&gt;
&gt; &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/&gt;
&gt; &lt;/sound&gt;
&gt; &lt;video&gt;
&gt; &lt;model type='qxl' ram='65536' vram='65536' vgamem='16384' primary='yes'/&gt;
&gt; &lt;alias name='video0'/&gt;
&gt; &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/&gt;
&gt; &lt;/video&gt;
&gt; &lt;memballoon model='virtio'&gt;
&gt; &lt;stats period='10'/&gt;
&gt; &lt;alias name='balloon0'/&gt;
&gt; &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08' function='0x0'/&gt;
&gt; &lt;/memballoon&gt;
&gt; &lt;/devices&gt;
&gt; &lt;seclabel type='none' model='none'/&gt;
&gt; &lt;seclabel type='dynamic' model='dac' relabel='yes'&gt;
&gt; &lt;label&gt;+0:+107&lt;/label&gt;
&gt; &lt;imagelabel&gt;+0:+107&lt;/imagelabel&gt;
&gt; &lt;/seclabel&gt;
&gt; &lt;/domain&gt;
&gt; 


-- 
Eric Blake, Principal Software Engineer
Red Hat, Inc.           +1-919-301-3266
Virtualization:  qemu.org | libvirt.org


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170428063307</emailId><senderName>Anastasiya Ruzhanskaya</senderName><senderEmail>anastasiya.ruzhanskaya@frtk.ru</senderEmail><timestampReceived>2017-04-28 06:33:07-0400</timestampReceived><subject>[libvirt-users] Data format</subject><body>

What is exactly the format of data being sent across remote connection (
from client to server with RPC protocol)? I see, there is XML but converted
to string.

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;What is exactly the format of data being sent across remote connection \
( from client to server with RPC protocol)? I see, there is XML but converted to \
string. &lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170404100442</emailId><senderName>Daniel_Kučera</senderName><senderEmail>libvirt@danman.eu</senderEmail><timestampReceived>2017-04-04 10:04:42-0400</timestampReceived><subject>[libvirt-users] Live migration with non-shared ZFS volume</subject><body>

Hi all,

I'm using ZFS on Linux block volumes as my VM storage and want to do live
migrations between hypervisors.

If I create ZFS snapshot of used volume on source host, send it do
destination host (zfs send/recv) and then run live migration with
VIR_MIGRATE_NON_SHARED_DISK
flag, the migration works OK.

But this procedure copies the whole disk twice which is a huge downside.

The best solution would be, if libvirt could send the incremental data
since last snapshot itself but this feature is not there (AFAIK).

So I am thinking about a workaround:
1. Create snapshot using: "virsh snapshot-create --xmlfile snap.xml
--disk-only --no-metadata test-domain" which will start writing snapshot
data into temporary qcow2 file

&lt;domainsnapshot&gt;
  &lt;disks&gt;
    &lt;disk name='/dev/zstore/test-volume'&gt;
      &lt;source file='/tmp/test-volume.qcow2'/&gt;
    &lt;/disk&gt;
  &lt;/disks&gt;
&lt;/domainsnapshot&gt;


2. Create snapshot of backing ZFS volume and send it to destination host.
3. Migrate the domain

Currently, in step 3 I need to create empty qcow snapshot file on the
destination host, otherwise the migration fails with: "Operation not
supported: pre-creation of storage targets for incremental storage
migration is not supported"

My question is: Is it possible to do live migration with blockcommit
operation? If not, would it be hard to implement?

I imagine it like I would start migration with some special parameter (e.g.
VIR_MIGRATE_NON_SHARED_INC_COMMIT) which would only migrate data from qcow
snapshot to destination storage.

This would ensure the disk consistency and avoid useless whole disk copy.

Or do you have any other idea how to solve this?

BR.
Daniel Kucera.

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hi \
all,&lt;br&gt;&lt;br&gt;&lt;/div&gt;I'm using ZFS on Linux block volumes as my VM storage and want \
to do live migrations between hypervisors.&lt;br&gt;&lt;br&gt;&lt;/div&gt;If I create ZFS snapshot of \
used volume on source host, send it do destination host (zfs send/recv) and then run \
live migration with &lt;span class="gmail-pl-smi"&gt;VIR_MIGRATE_NON_SHARED_DISK flag, the \
migration works OK.&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;span class="gmail-pl-smi"&gt;But this procedure \
copies the whole disk twice which is a huge downside.&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;span \
class="gmail-pl-smi"&gt;The best solution would be, if libvirt could send the \
incremental data since last snapshot itself but this feature is not there \
(AFAIK).&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;span class="gmail-pl-smi"&gt;So I am thinking about a \
workaround:&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;span class="gmail-pl-smi"&gt;1. Create snapshot using: \
"virsh snapshot-create --xmlfile snap.xml --disk-only --no-metadata \
test-domain" which will start writing snapshot data into temporary qcow2 \
file&lt;br&gt;&lt;br&gt;&lt;domainsnapshot&gt;&lt;br&gt;   &lt;disks&gt;&lt;br&gt;       &lt;disk \
name='/dev/zstore/test-volume'&gt;&lt;br&gt;           &lt;source \
file='/tmp/test-volume.qcow2'/&gt;&lt;br&gt;       &lt;/disk&gt;&lt;br&gt;   \
&lt;/disks&gt;&lt;br&gt;&lt;/domainsnapshot&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;span \
class="gmail-pl-smi"&gt;2. Create snapshot of backing ZFS volume and send it to \
destination host.&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;span class="gmail-pl-smi"&gt;3. Migrate the \
domain&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;span class="gmail-pl-smi"&gt;Currently, in step 3 I need to \
create empty qcow snapshot file on the destination host, otherwise the migration \
fails with: "Operation not supported: pre-creation of storage targets for \
incremental storage migration is not supported"&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;span \
class="gmail-pl-smi"&gt;My question is: Is it possible to do live migration with \
blockcommit operation? If not, would it be hard to \
implement?&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;span class="gmail-pl-smi"&gt;I imagine it like I would \
start migration with some special parameter (e.g. &lt;/span&gt;&lt;br&gt;&lt;span \
class="gmail-pl-smi"&gt;VIR_MIGRATE_NON_SHARED_INC_COMMIT) which would only migrate data \
from qcow snapshot to destination storage.&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;span \
class="gmail-pl-smi"&gt;This would ensure the disk consistency and avoid useless whole \
disk copy.&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;span class="gmail-pl-smi"&gt;Or do you have any other \
idea how to solve this?&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;span \
class="gmail-pl-smi"&gt;BR.&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;span class="gmail-pl-smi"&gt;Daniel \
Kucera.&lt;br&gt;&lt;/span&gt;&lt;/div&gt;



</body></email><email><emailId>20170428090325</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-04-28 09:03:25-0400</timestampReceived><subject>Re: [libvirt-users] Live migration with non-shared ZFS volume</subject><body>


On Tue, Apr 04, 2017 at 12:04:42PM +0200, Daniel Kučera wrote:
&gt;Hi all,
&gt;

Hi,

I caught your mail in my Spam folder for some reason, maybe the same
happened for others.  I don't have that deep knowledge of the snapshots,
but I'm replying so that if someone else has it in Spam and they have
more insight, they can reply.

&gt;I'm using ZFS on Linux block volumes as my VM storage and want to do live
&gt;migrations between hypervisors.
&gt;
&gt;If I create ZFS snapshot of used volume on source host, send it do
&gt;destination host (zfs send/recv) and then run live migration with
&gt;VIR_MIGRATE_NON_SHARED_DISK
&gt;flag, the migration works OK.
&gt;
&gt;But this procedure copies the whole disk twice which is a huge downside.
&gt;
&gt;The best solution would be, if libvirt could send the incremental data
&gt;since last snapshot itself but this feature is not there (AFAIK).
&gt;
&gt;So I am thinking about a workaround:
&gt;1. Create snapshot using: "virsh snapshot-create --xmlfile snap.xml
&gt;--disk-only --no-metadata test-domain" which will start writing snapshot
&gt;data into temporary qcow2 file
&gt;
&gt;&lt;domainsnapshot&gt;
&gt;  &lt;disks&gt;
&gt;    &lt;disk name='/dev/zstore/test-volume'&gt;
&gt;      &lt;source file='/tmp/test-volume.qcow2'/&gt;
&gt;    &lt;/disk&gt;
&gt;  &lt;/disks&gt;
&gt;&lt;/domainsnapshot&gt;
&gt;
&gt;
&gt;2. Create snapshot of backing ZFS volume and send it to destination host.
&gt;3. Migrate the domain
&gt;
&gt;Currently, in step 3 I need to create empty qcow snapshot file on the
&gt;destination host, otherwise the migration fails with: "Operation not
&gt;supported: pre-creation of storage targets for incremental storage
&gt;migration is not supported"
&gt;

So apart from this it does exactly what you want, right?

&gt;My question is: Is it possible to do live migration with blockcommit
&gt;operation? If not, would it be hard to implement?
&gt;
&gt;I imagine it like I would start migration with some special parameter (e.g.
&gt;VIR_MIGRATE_NON_SHARED_INC_COMMIT) which would only migrate data from qcow
&gt;snapshot to destination storage.
&gt;
&gt;This would ensure the disk consistency and avoid useless whole disk copy.
&gt;

What would be the difference compared to what you are doing now (plus a
block commit)?  VIR_MIGRATE_NON_SHARED_INC should already migrate only
the topmost disk of the whole chain.

Of course lot can be added to the project, but I, for one, am not *that*
welcoming with regards to things that are meant for pretty narrow use
case while at the same time they are doable already, using libvirt's API.

&gt;Or do you have any other idea how to solve this?
&gt;
&gt;BR.
&gt;Daniel Kucera.

&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170428100611</emailId><senderName>Daniel_Kučera</senderName><senderEmail>libvirt@danman.eu</senderEmail><timestampReceived>2017-04-28 10:06:11-0400</timestampReceived><subject>Re: [libvirt-users] Live migration with non-shared ZFS volume</subject><body>

Hi Martin,

in the meantime, I've found a solution which I consider at least acceptable:

1. create zfs snapshot of domain disk (/dev/zstore/test-volume)

2. save original XML domain definition

3. create snapshot in libvirt like this:
virsh snapshot-create --xmlfile snap.xml --disk-only --no-metadata
test-domain
snap.xml:
&lt;domainsnapshot&gt;
  &lt;disks&gt;
    &lt;disk name='/dev/zstore/test-volume'&gt;
      &lt;source file='/tmp/test-volume.qcow2'/&gt;
    &lt;/disk&gt;
  &lt;/disks&gt;
&lt;/domainsnapshot&gt;

This creates overlay qcow snapshot on top of my base ZFS volume

3. Transfer ZFS volume (with last snapshot) to remote host

4. Run live migration with setting XML from step 1 as DestXML and PersistXML
parameter and with VIR_MIGRATE_NON_SHARED_INC flag

This creates domain without snapshot on the remote host and migrates only
data from qcow overlay and commits them to the ZFS base volume.

What I don't like about this, is that I need to create and care about qcow
image.

The best solution for me would be to only create dirty block map in qemu
(block-dirty-bitmap-add) in step 3 and then migrate just changed blocks
without creating qcow snapshot.

Do you think it would be possible to implement it like this?

S pozdravom / Best regards
Daniel Kucera

2017-04-28 11:03 GMT+02:00 Martin Kletzander &lt;mkletzan@redhat.com&gt;:

&gt; On Tue, Apr 04, 2017 at 12:04:42PM +0200, Daniel Kučera wrote:
&gt;
&gt;&gt; Hi all,
&gt;&gt;
&gt;&gt;
&gt; Hi,
&gt;
&gt; I caught your mail in my Spam folder for some reason, maybe the same
&gt; happened for others.  I don't have that deep knowledge of the snapshots,
&gt; but I'm replying so that if someone else has it in Spam and they have
&gt; more insight, they can reply.
&gt;
&gt;
&gt; I'm using ZFS on Linux block volumes as my VM storage and want to do live
&gt;&gt; migrations between hypervisors.
&gt;&gt;
&gt;&gt; If I create ZFS snapshot of used volume on source host, send it do
&gt;&gt; destination host (zfs send/recv) and then run live migration with
&gt;&gt; VIR_MIGRATE_NON_SHARED_DISK
&gt;&gt; flag, the migration works OK.
&gt;&gt;
&gt;&gt; But this procedure copies the whole disk twice which is a huge downside.
&gt;&gt;
&gt;&gt; The best solution would be, if libvirt could send the incremental data
&gt;&gt; since last snapshot itself but this feature is not there (AFAIK).
&gt;&gt;
&gt;&gt; So I am thinking about a workaround:
&gt;&gt; 1. Create snapshot using: "virsh snapshot-create --xmlfile snap.xml
&gt;&gt; --disk-only --no-metadata test-domain" which will start writing snapshot
&gt;&gt; data into temporary qcow2 file
&gt;&gt;
&gt;&gt; &lt;domainsnapshot&gt;
&gt;&gt;  &lt;disks&gt;
&gt;&gt;    &lt;disk name='/dev/zstore/test-volume'&gt;
&gt;&gt;      &lt;source file='/tmp/test-volume.qcow2'/&gt;
&gt;&gt;    &lt;/disk&gt;
&gt;&gt;  &lt;/disks&gt;
&gt;&gt; &lt;/domainsnapshot&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; 2. Create snapshot of backing ZFS volume and send it to destination host.
&gt;&gt; 3. Migrate the domain
&gt;&gt;
&gt;&gt; Currently, in step 3 I need to create empty qcow snapshot file on the
&gt;&gt; destination host, otherwise the migration fails with: "Operation not
&gt;&gt; supported: pre-creation of storage targets for incremental storage
&gt;&gt; migration is not supported"
&gt;&gt;
&gt;&gt;
&gt; So apart from this it does exactly what you want, right?
&gt;
&gt; My question is: Is it possible to do live migration with blockcommit
&gt;&gt; operation? If not, would it be hard to implement?
&gt;&gt;
&gt;&gt; I imagine it like I would start migration with some special parameter
&gt;&gt; (e.g.
&gt;&gt; VIR_MIGRATE_NON_SHARED_INC_COMMIT) which would only migrate data from
&gt;&gt; qcow
&gt;&gt; snapshot to destination storage.
&gt;&gt;
&gt;&gt; This would ensure the disk consistency and avoid useless whole disk copy.
&gt;&gt;
&gt;&gt;
&gt; What would be the difference compared to what you are doing now (plus a
&gt; block commit)?  VIR_MIGRATE_NON_SHARED_INC should already migrate only
&gt; the topmost disk of the whole chain.
&gt;
&gt; Of course lot can be added to the project, but I, for one, am not *that*
&gt; welcoming with regards to things that are meant for pretty narrow use
&gt; case while at the same time they are doable already, using libvirt's API.
&gt;
&gt; Or do you have any other idea how to solve this?
&gt;&gt;
&gt;&gt; BR.
&gt;&gt; Daniel Kucera.
&gt;&gt;
&gt;
&gt; _______________________________________________
&gt;&gt; libvirt-users mailing list
&gt;&gt; libvirt-users@redhat.com
&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;Hi Martin,&lt;br&gt;&lt;br&gt;&lt;/div&gt;in the meantime, I've found a \
solution which I consider at least acceptable:&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1. create zfs \
snapshot of domain disk (/dev/zstore/test-volume)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2. save \
original XML domain definition &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;3. create snapshot in libvirt like \
this:&lt;br&gt;virsh snapshot-create --xmlfile snap.xml --disk-only --no-metadata \
test-domain&lt;br&gt;snap.xml:&lt;br&gt;&lt;domainsnapshot&gt;&lt;br&gt;   &lt;disks&gt;&lt;br&gt;       \
&lt;disk name='/dev/zstore/test-volume'&lt;wbr&gt;&gt;&lt;br&gt;           &lt;source \
file='/tmp/test-volume.qcow2'/&lt;wbr&gt;&gt;&lt;br&gt;       &lt;/disk&gt;&lt;br&gt;   \
&lt;/disks&gt;&lt;br&gt;&lt;/domainsnapshot&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This creates overlay qcow \
snapshot on top of my base ZFS volume&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3. Transfer ZFS volume (with \
last snapshot) to remote host&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;4. Run live migration with setting \
XML from step 1 as &lt;span class="m_4219621850565719916gmail-pl-smi"&gt;DestXML and \
&lt;/span&gt;&lt;span class="m_4219621850565719916gmail-pl-smi"&gt;PersistXML&lt;/span&gt; parameter \
and with VIR_MIGRATE_NON_SHARED_INC flag&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This creates domain \
without snapshot on the remote host and migrates only data from qcow overlay and \
commits them to the ZFS base volume.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What I don't like about \
this, is that I need to create and care about qcow image.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The best \
solution for me would be to only create dirty block map in qemu \
(block-dirty-bitmap-add) in step 3 and then migrate just changed blocks without \
creating qcow snapshot.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Do you think it would be possible to \
implement it like this?&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;S pozdravom / Best \
regards&lt;br&gt;&lt;/div&gt;&lt;div&gt;Daniel Kucera&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-04-28 11:03 GMT+02:00 Martin \
Kletzander &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:mkletzan@redhat.com" \
target="_blank"&gt;mkletzan@redhat.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;On Tue, Apr 04, 2017 at 12:04:42PM +0200, Daniel Kučera \
wrote:&lt;br&gt; &lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px \
#ccc solid;padding-left:1ex"&gt; Hi all,&lt;br&gt;
&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;
Hi,&lt;br&gt;
&lt;br&gt;
I caught your mail in my Spam folder for some reason, maybe the same&lt;br&gt;
happened for others.   I don't have that deep knowledge of the snapshots,&lt;br&gt;
but I'm replying so that if someone else has it in Spam and they have&lt;br&gt;
more insight, they can reply.&lt;div&gt;&lt;div class="m_4219621850565719916h5"&gt;&lt;br&gt;
&lt;br&gt;
&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt; I'm using ZFS on Linux block volumes as my VM storage \
and want to do live&lt;br&gt; migrations between hypervisors.&lt;br&gt;
&lt;br&gt;
If I create ZFS snapshot of used volume on source host, send it do&lt;br&gt;
destination host (zfs send/recv) and then run live migration with&lt;br&gt;
VIR_MIGRATE_NON_SHARED_DISK&lt;br&gt;
flag, the migration works OK.&lt;br&gt;
&lt;br&gt;
But this procedure copies the whole disk twice which is a huge downside.&lt;br&gt;
&lt;br&gt;
The best solution would be, if libvirt could send the incremental data&lt;br&gt;
since last snapshot itself but this feature is not there (AFAIK).&lt;br&gt;
&lt;br&gt;
So I am thinking about a workaround:&lt;br&gt;
1. Create snapshot using: "virsh snapshot-create --xmlfile snap.xml&lt;br&gt;
--disk-only --no-metadata test-domain" which will start writing snapshot&lt;br&gt;
data into temporary qcow2 file&lt;br&gt;
&lt;br&gt;
&lt;domainsnapshot&gt;&lt;br&gt;
  &lt;disks&gt;&lt;br&gt;
     &lt;disk name='/dev/zstore/test-volume'&lt;wbr&gt;&gt;&lt;br&gt;
        &lt;source file='/tmp/test-volume.qcow2'/&lt;wbr&gt;&gt;&lt;br&gt;
     &lt;/disk&gt;&lt;br&gt;
  &lt;/disks&gt;&lt;br&gt;
&lt;/domainsnapshot&gt;&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
2. Create snapshot of backing ZFS volume and send it to destination host.&lt;br&gt;
3. Migrate the domain&lt;br&gt;
&lt;br&gt;
Currently, in step 3 I need to create empty qcow snapshot file on the&lt;br&gt;
destination host, otherwise the migration fails with: "Operation not&lt;br&gt;
supported: pre-creation of storage targets for incremental storage&lt;br&gt;
migration is not supported"&lt;br&gt;
&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;&lt;/div&gt;&lt;/div&gt;
So apart from this it does exactly what you want, right?&lt;span&gt;&lt;br&gt;
&lt;br&gt;
&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt; My question is: Is it possible to do live migration with \
blockcommit&lt;br&gt; operation? If not, would it be hard to implement?&lt;br&gt;
&lt;br&gt;
I imagine it like I would start migration with some special parameter (e.g.&lt;br&gt;
VIR_MIGRATE_NON_SHARED_INC_COM&lt;wbr&gt;MIT) which would only migrate data from qcow&lt;br&gt;
snapshot to destination storage.&lt;br&gt;
&lt;br&gt;
This would ensure the disk consistency and avoid useless whole disk copy.&lt;br&gt;
&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;&lt;/span&gt;
What would be the difference compared to what you are doing now (plus a&lt;br&gt;
block commit)?   VIR_MIGRATE_NON_SHARED_INC should already migrate only&lt;br&gt;
the topmost disk of the whole chain.&lt;br&gt;
&lt;br&gt;
Of course lot can be added to the project, but I, for one, am not *that*&lt;br&gt;
welcoming with regards to things that are meant for pretty narrow use&lt;br&gt;
case while at the same time they are doable already, using libvirt's \
API.&lt;span&gt;&lt;br&gt; &lt;br&gt;
&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt; Or do you have any other idea how to solve this?&lt;br&gt;
&lt;br&gt;
BR.&lt;br&gt;
Daniel Kucera.&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;
&lt;/span&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt; ______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt; \
&lt;/blockquote&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170426135946</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-04-26 13:59:46-0400</timestampReceived><subject>Re: [libvirt-users] Tunnelled migrate Windows7 VMs halted</subject><body>

On Wed, Apr 26, 2017 at 08:51:39AM -0500, Eric Blake wrote:
&gt; &gt; 
&gt; &gt; I migrated a Windows 7 VM with libvirtd tunnelled, the VM halted
&gt; &gt; on the target although the status is running.

What do you mean by halted ? The guest OS has shutdown, or QEMU
has crashed, or something else ?

&gt; &gt; 
&gt; &gt; 
&gt; &gt; [root@test15 ~]# virsh migrate --live --p2p --tunnelled i-000000ac \
&gt; &gt; qemu+tcp://192.168.65.13/system 
&gt; &gt; 
&gt; &gt; But when migrated with qemu native mode, the VM runs well.
&gt; &gt; 
&gt; &gt; 
&gt; &gt; [root@test15 ~]# virsh migrate --live --p2p i-000000ac \
&gt; &gt; qemu+tcp://192.168.65.13/system

&gt; From QEMU's POV there's no difference between these modes - in both cases
QEMU is just getting a file descriptor from libvirt.

So any problems with the guest after migration are 

&gt; &gt; System Info:
&gt; &gt; Release: Centos 7.2
&gt; &gt; Kernel: 3.10.0-327.28.3.el7.x86_64
&gt; &gt; Qemu: qemu-kvm-rhev-2.3.0
&gt; &gt; Libvirt: libvirt-1.2.17/libvirt-2.0.0

Does the 2 libvirt versions mean you are live-migrating between two different
versions of CentOS ?  If so, this also likely means two different versions
of QEMU involved.

&gt; &gt; CPU: AMD Opteron(TM) Processor 6212
&gt; &gt; 
&gt; &gt; 
&gt; &gt; As CPUFrequency may lead windows migrate halt, I have disabled Power Management. 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; Does anyone have some sugestions?
&gt; &gt; 
&gt; &gt; 
&gt; &gt; Thanks,
&gt; &gt; Linwen Deng
&gt; &gt; 
&gt; &gt; 
&gt; &gt; vm.xml
&gt; &gt; 
&gt; &gt; 
&gt; &gt; &lt;domain type='kvm' id='8'&gt;
&gt; &gt; &lt;name&gt;i-000000ac&lt;/name&gt;
&gt; &gt; &lt;uuid&gt;53f0710f-b25e-4f47-a7cf-c15a9409fdc3&lt;/uuid&gt;
&gt; &gt; &lt;metadata&gt;
&gt; &gt; &lt;nova:instance xmlns:nova="http://openstack.org/xmlns/libvirt/nova/1.0"&gt;
&gt; &gt; &lt;nova:package version="12.0.0-4"/&gt;
&gt; &gt; &lt;nova:name&gt;c7-vm15-test15-7&lt;/nova:name&gt;
&gt; &gt; &lt;nova:creationTime&gt;2017-04-14 06:48:54&lt;/nova:creationTime&gt;
&gt; &gt; &lt;nova:flavor name="oeflavor-4-2048-20"&gt;
&gt; &gt; &lt;nova:memory&gt;2048&lt;/nova:memory&gt;
&gt; &gt; &lt;nova:disk&gt;20&lt;/nova:disk&gt;
&gt; &gt; &lt;nova:swap&gt;0&lt;/nova:swap&gt;
&gt; &gt; &lt;nova:ephemeral&gt;0&lt;/nova:ephemeral&gt;
&gt; &gt; &lt;nova:vcpus&gt;4&lt;/nova:vcpus&gt;
&gt; &gt; &lt;/nova:flavor&gt;
&gt; &gt; &lt;nova:owner&gt;
&gt; &gt; &lt;nova:user uuid="b0f21b1d16b147ffb3f7713716cc894a"&gt;admin&lt;/nova:user&gt;
&gt; &gt; &lt;nova:project uuid="ae883f160c3c41db850d5cde8de8208b"&gt;service&lt;/nova:project&gt;
&gt; &gt; &lt;/nova:owner&gt;
&gt; &gt; &lt;/nova:instance&gt;
&gt; &gt; &lt;/metadata&gt;
&gt; &gt; &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;
&gt; &gt; &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMemory&gt;
&gt; &gt; &lt;memoryBacking&gt;
&gt; &gt; &lt;hugepages&gt;
&gt; &gt; &lt;page size='2048' unit='KiB' nodeset='0'/&gt;
&gt; &gt; &lt;/hugepages&gt;
&gt; &gt; &lt;/memoryBacking&gt;
&gt; &gt; &lt;vcpu placement='static'&gt;2&lt;/vcpu&gt;
&gt; &gt; &lt;cputune&gt;
&gt; &gt; &lt;shares&gt;4096&lt;/shares&gt;
&gt; &gt; &lt;vcpupin vcpu='0' cpuset='4-7'/&gt;
&gt; &gt; &lt;vcpupin vcpu='1' cpuset='4-7'/&gt;
&gt; &gt; &lt;emulatorpin cpuset='4-7'/&gt;
&gt; &gt; &lt;/cputune&gt;
&gt; &gt; &lt;resource&gt;
&gt; &gt; &lt;partition&gt;/machine&lt;/partition&gt;
&gt; &gt; &lt;/resource&gt;
&gt; &gt; &lt;sysinfo type='smbios'&gt;
&gt; &gt; &lt;system&gt;
&gt; &gt; &lt;entry name='manufacturer'&gt;Fedora Project&lt;/entry&gt;
&gt; &gt; &lt;entry name='product'&gt;OpenStack Nova&lt;/entry&gt;
&gt; &gt; &lt;entry name='version'&gt;12.0.0-4&lt;/entry&gt;
&gt; &gt; &lt;entry name='serial'&gt;95637afe-453f-42a8-b198-df673ab59c91&lt;/entry&gt;
&gt; &gt; &lt;entry name='uuid'&gt;53f0710f-b25e-4f47-a7cf-c15a9409fdc3&lt;/entry&gt;
&gt; &gt; &lt;entry name='family'&gt;Virtual Machine&lt;/entry&gt;
&gt; &gt; &lt;/system&gt;
&gt; &gt; &lt;/sysinfo&gt;
&gt; &gt; &lt;os&gt;
&gt; &gt; &lt;type arch='x86_64' machine='pc-i440fx-rhel7.2.0'&gt;hvm&lt;/type&gt;
&gt; &gt; &lt;boot dev='cdrom'/&gt;
&gt; &gt; &lt;boot dev='hd'/&gt;
&gt; &gt; &lt;boot dev='fd'/&gt;
&gt; &gt; &lt;smbios mode='sysinfo'/&gt;
&gt; &gt; &lt;/os&gt;
&gt; &gt; &lt;features&gt;
&gt; &gt; &lt;acpi/&gt;
&gt; &gt; &lt;apic/&gt;
&gt; &gt; &lt;/features&gt;
&gt; &gt; &lt;cpu mode='host-model'&gt;
&gt; &gt; &lt;model fallback='allow'/&gt;
&gt; &gt; &lt;topology sockets='2' cores='1' threads='1'/&gt;
&gt; &gt; &lt;/cpu&gt;
&gt; &gt; &lt;clock offset='utc'&gt;
&gt; &gt; &lt;timer name='pit' tickpolicy='delay'/&gt;
&gt; &gt; &lt;timer name='rtc' tickpolicy='catchup'/&gt;
&gt; &gt; &lt;timer name='hpet' present='no'/&gt;
&gt; &gt; &lt;/clock&gt;

If nothing else, this guest is incorrectly configured for running
the Windows OS. I suspect you forget to set the Glance image
property needed to tell Nova that it is windows.

Specifically it is missing hyperv paravirt &lt;timer&gt;, and many hyperv
paravirt &lt;feature&gt; elements.

This will make Windows guests unstable and liable to hit BSOD


Regards,
Daniel
-- 
&gt; &gt; https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
&gt; &gt; https://libvirt.org         -o-            https://fstop138.berrange.com :|
&gt; &gt; https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|


</body></email><email><emailId>20170427014901</emailId><senderName></senderName><senderEmail>dlworld0@163.com</senderEmail><timestampReceived>2017-04-27 01:49:01-0400</timestampReceived><subject>Re: [libvirt-users] Tunnelled migrate Windows7 VMs halted</subject><body>

[Attachment #2 (multipart/alternative)]

[Attachment #4 (text/plain)]

At 2017-04-26 21:59:46, "Daniel P. Berrange" &lt;berrange@redhat.com&gt; wrote:
&gt; On Wed, Apr 26, 2017 at 08:51:39AM -0500, Eric Blake wrote:
&gt; &gt; &gt; 
&gt; &gt; &gt; I migrated a Windows 7 VM with libvirtd tunnelled, the VM halted
&gt; &gt; &gt; on the target although the status is running.
&gt; 
&gt; What do you mean by halted ? The guest OS has shutdown, or QEMU
&gt; has crashed, or something else ?
&gt; 

I can still connect to the guest OS and see the windows opened before migrate on the \
target, but cann't click any more, and there's no effect when send "ctrl+alt+del" \
keys by virsh.


&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; [root@test15 ~]# virsh migrate --live --p2p --tunnelled i-000000ac \
&gt; &gt; &gt; qemu+tcp://192.168.65.13/system 
&gt; &gt; &gt; 
&gt; &gt; &gt; But when migrated with qemu native mode, the VM runs well.
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; [root@test15 ~]# virsh migrate --live --p2p i-000000ac \
&gt; &gt; &gt; qemu+tcp://192.168.65.13/system
&gt; 
&gt; From QEMU's POV there's no difference between these modes - in both cases
&gt; QEMU is just getting a file descriptor from libvirt.
&gt; 
&gt; So any problems with the guest after migration are 

&gt; 


When I destroy the guest and restart, the guest OS works well.


The attachment is a stripped version log.




&gt; &gt; &gt; System Info:
&gt; &gt; &gt; Release: Centos 7.2
&gt; &gt; &gt; Kernel: 3.10.0-327.28.3.el7.x86_64
&gt; &gt; &gt; Qemu: qemu-kvm-rhev-2.3.0
&gt; &gt; &gt; Libvirt: libvirt-1.2.17/libvirt-2.0.0
&gt; 
&gt; Does the 2 libvirt versions mean you are live-migrating between two different
&gt; versions of CentOS ?  If so, this also likely means two different versions
&gt; of QEMU involved.
&gt; 
&gt; &gt; &gt; CPU: AMD Opteron(TM) Processor 6212
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; As CPUFrequency may lead windows migrate halt, I have disabled Power \
&gt; &gt; &gt; Management.  
&gt; &gt; &gt; 
&gt; &gt; &gt; Does anyone have some sugestions?
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; Thanks,
&gt; &gt; &gt; Linwen Deng
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; vm.xml
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; &lt;domain type='kvm' id='8'&gt;
&gt; &gt; &gt; &lt;name&gt;i-000000ac&lt;/name&gt;
&gt; &gt; &gt; &lt;uuid&gt;53f0710f-b25e-4f47-a7cf-c15a9409fdc3&lt;/uuid&gt;
&gt; &gt; &gt; &lt;metadata&gt;
&gt; &gt; &gt; &lt;nova:instance xmlns:nova="http://openstack.org/xmlns/libvirt/nova/1.0"&gt;
&gt; &gt; &gt; &lt;nova:package version="12.0.0-4"/&gt;
&gt; &gt; &gt; &lt;nova:name&gt;c7-vm15-test15-7&lt;/nova:name&gt;
&gt; &gt; &gt; &lt;nova:creationTime&gt;2017-04-14 06:48:54&lt;/nova:creationTime&gt;
&gt; &gt; &gt; &lt;nova:flavor name="oeflavor-4-2048-20"&gt;
&gt; &gt; &gt; &lt;nova:memory&gt;2048&lt;/nova:memory&gt;
&gt; &gt; &gt; &lt;nova:disk&gt;20&lt;/nova:disk&gt;
&gt; &gt; &gt; &lt;nova:swap&gt;0&lt;/nova:swap&gt;
&gt; &gt; &gt; &lt;nova:ephemeral&gt;0&lt;/nova:ephemeral&gt;
&gt; &gt; &gt; &lt;nova:vcpus&gt;4&lt;/nova:vcpus&gt;
&gt; &gt; &gt; &lt;/nova:flavor&gt;
&gt; &gt; &gt; &lt;nova:owner&gt;
&gt; &gt; &gt; &lt;nova:user uuid="b0f21b1d16b147ffb3f7713716cc894a"&gt;admin&lt;/nova:user&gt;
&gt; &gt; &gt; &lt;nova:project uuid="ae883f160c3c41db850d5cde8de8208b"&gt;service&lt;/nova:project&gt;
&gt; &gt; &gt; &lt;/nova:owner&gt;
&gt; &gt; &gt; &lt;/nova:instance&gt;
&gt; &gt; &gt; &lt;/metadata&gt;
&gt; &gt; &gt; &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;
&gt; &gt; &gt; &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMemory&gt;
&gt; &gt; &gt; &lt;memoryBacking&gt;
&gt; &gt; &gt; &lt;hugepages&gt;
&gt; &gt; &gt; &lt;page size='2048' unit='KiB' nodeset='0'/&gt;
&gt; &gt; &gt; &lt;/hugepages&gt;
&gt; &gt; &gt; &lt;/memoryBacking&gt;
&gt; &gt; &gt; &lt;vcpu placement='static'&gt;2&lt;/vcpu&gt;
&gt; &gt; &gt; &lt;cputune&gt;
&gt; &gt; &gt; &lt;shares&gt;4096&lt;/shares&gt;
&gt; &gt; &gt; &lt;vcpupin vcpu='0' cpuset='4-7'/&gt;
&gt; &gt; &gt; &lt;vcpupin vcpu='1' cpuset='4-7'/&gt;
&gt; &gt; &gt; &lt;emulatorpin cpuset='4-7'/&gt;
&gt; &gt; &gt; &lt;/cputune&gt;
&gt; &gt; &gt; &lt;resource&gt;
&gt; &gt; &gt; &lt;partition&gt;/machine&lt;/partition&gt;
&gt; &gt; &gt; &lt;/resource&gt;
&gt; &gt; &gt; &lt;sysinfo type='smbios'&gt;
&gt; &gt; &gt; &lt;system&gt;
&gt; &gt; &gt; &lt;entry name='manufacturer'&gt;Fedora Project&lt;/entry&gt;
&gt; &gt; &gt; &lt;entry name='product'&gt;OpenStack Nova&lt;/entry&gt;
&gt; &gt; &gt; &lt;entry name='version'&gt;12.0.0-4&lt;/entry&gt;
&gt; &gt; &gt; &lt;entry name='serial'&gt;95637afe-453f-42a8-b198-df673ab59c91&lt;/entry&gt;
&gt; &gt; &gt; &lt;entry name='uuid'&gt;53f0710f-b25e-4f47-a7cf-c15a9409fdc3&lt;/entry&gt;
&gt; &gt; &gt; &lt;entry name='family'&gt;Virtual Machine&lt;/entry&gt;
&gt; &gt; &gt; &lt;/system&gt;
&gt; &gt; &gt; &lt;/sysinfo&gt;
&gt; &gt; &gt; &lt;os&gt;
&gt; &gt; &gt; &lt;type arch='x86_64' machine='pc-i440fx-rhel7.2.0'&gt;hvm&lt;/type&gt;
&gt; &gt; &gt; &lt;boot dev='cdrom'/&gt;
&gt; &gt; &gt; &lt;boot dev='hd'/&gt;
&gt; &gt; &gt; &lt;boot dev='fd'/&gt;
&gt; &gt; &gt; &lt;smbios mode='sysinfo'/&gt;
&gt; &gt; &gt; &lt;/os&gt;
&gt; &gt; &gt; &lt;features&gt;
&gt; &gt; &gt; &lt;acpi/&gt;
&gt; &gt; &gt; &lt;apic/&gt;
&gt; &gt; &gt; &lt;/features&gt;
&gt; &gt; &gt; &lt;cpu mode='host-model'&gt;
&gt; &gt; &gt; &lt;model fallback='allow'/&gt;
&gt; &gt; &gt; &lt;topology sockets='2' cores='1' threads='1'/&gt;
&gt; &gt; &gt; &lt;/cpu&gt;
&gt; &gt; &gt; &lt;clock offset='utc'&gt;
&gt; &gt; &gt; &lt;timer name='pit' tickpolicy='delay'/&gt;
&gt; &gt; &gt; &lt;timer name='rtc' tickpolicy='catchup'/&gt;
&gt; &gt; &gt; &lt;timer name='hpet' present='no'/&gt;
&gt; &gt; &gt; &lt;/clock&gt;
&gt; 
&gt; If nothing else, this guest is incorrectly configured for running
&gt; the Windows OS. I suspect you forget to set the Glance image
&gt; property needed to tell Nova that it is windows.
&gt; 
&gt; Specifically it is missing hyperv paravirt &lt;timer&gt;, and many hyperv
&gt; paravirt &lt;feature&gt; elements.
&gt; 
&gt; This will make Windows guests unstable and liable to hit BSOD
&gt; 
&gt; 
&gt; Regards,
&gt; Daniel
&gt; -- 
&gt; &gt; &gt; https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
&gt; &gt; &gt; https://libvirt.org         -o-            https://fstop138.berrange.com :|
&gt; &gt; &gt; https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|


[Attachment #5 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;pre&gt;At \
2017-04-26 21:59:46, "Daniel P. Berrange" &lt;berrange@redhat.com&gt; wrote: &gt;On \
Wed, Apr 26, 2017 at 08:51:39AM -0500, Eric Blake wrote: &gt;&gt; &gt; 
&gt;&gt; &gt; I migrated a Windows 7 VM with libvirtd tunnelled, the VM halted
&gt;&gt; &gt; on the target although the status is running.
&gt;
&gt;What do you mean by halted ? The guest OS has shutdown, or QEMU
&gt;has crashed, or something else ?
&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I can still connect to the guest OS and see the \
windows opened before migrate on the target, but cann't click any more,&lt;/div&gt;&lt;div&gt;and \
there's no effect when send "ctrl+alt+del" keys by \
virsh.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&gt;&gt; &gt;  &gt;&gt; &gt; 
&gt;&gt; &gt;     [root@test15 ~]# virsh migrate --live --p2p --tunnelled i-000000ac \
qemu+tcp://192.168.65.13/system &gt;&gt; &gt; 
&gt;&gt; &gt; 
&gt;&gt; &gt; But when migrated with qemu native mode, the VM runs well.
&gt;&gt; &gt; 
&gt;&gt; &gt; 
&gt;&gt; &gt;     [root@test15 ~]# virsh migrate --live --p2p i-000000ac \
qemu+tcp://192.168.65.13/system &gt;
&gt;From QEMU's POV there's no difference between these modes - in both cases
&gt;QEMU is just getting a file descriptor from libvirt.
&gt;
&gt;So any problems with the guest after migration are 
&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When I destroy the guest and restart, the guest OS \
works well.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The attachment is a stripped version \
log.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&gt;&gt; &gt; System Info: &gt;&gt; &gt;     \
Release: Centos 7.2 &gt;&gt; &gt;     Kernel: 3.10.0-327.28.3.el7.x86_64
&gt;&gt; &gt;     Qemu: qemu-kvm-rhev-2.3.0
&gt;&gt; &gt;     Libvirt: libvirt-1.2.17/libvirt-2.0.0
&gt;
&gt;Does the 2 libvirt versions mean you are live-migrating between two different
&gt;versions of CentOS ?  If so, this also likely means two different versions
&gt;of QEMU involved.
&gt;
&gt;&gt; &gt;     CPU: AMD Opteron(TM) Processor 6212
&gt;&gt; &gt; 
&gt;&gt; &gt; 
&gt;&gt; &gt; As CPUFrequency may lead windows migrate halt, I have disabled Power \
Management.  &gt;&gt; &gt; 
&gt;&gt; &gt; 
&gt;&gt; &gt; Does anyone have some sugestions?
&gt;&gt; &gt; 
&gt;&gt; &gt; 
&gt;&gt; &gt; Thanks,
&gt;&gt; &gt; Linwen Deng
&gt;&gt; &gt; 
&gt;&gt; &gt; 
&gt;&gt; &gt; vm.xml
&gt;&gt; &gt; 
&gt;&gt; &gt; 
&gt;&gt; &gt; &lt;domain type='kvm' id='8'&gt;
&gt;&gt; &gt;   &lt;name&gt;i-000000ac&lt;/name&gt;
&gt;&gt; &gt;   &lt;uuid&gt;53f0710f-b25e-4f47-a7cf-c15a9409fdc3&lt;/uuid&gt;
&gt;&gt; &gt;   &lt;metadata&gt;
&gt;&gt; &gt;     &lt;nova:instance \
xmlns:nova="http://openstack.org/xmlns/libvirt/nova/1.0"&gt; &gt;&gt; &gt;       \
&lt;nova:package version="12.0.0-4"/&gt; &gt;&gt; &gt;       \
&lt;nova:name&gt;c7-vm15-test15-7&lt;/nova:name&gt; &gt;&gt; &gt;       \
&lt;nova:creationTime&gt;2017-04-14 06:48:54&lt;/nova:creationTime&gt; &gt;&gt; &gt;  \
&lt;nova:flavor name="oeflavor-4-2048-20"&gt; &gt;&gt; &gt;         \
&lt;nova:memory&gt;2048&lt;/nova:memory&gt; &gt;&gt; &gt;         \
&lt;nova:disk&gt;20&lt;/nova:disk&gt; &gt;&gt; &gt;         \
&lt;nova:swap&gt;0&lt;/nova:swap&gt; &gt;&gt; &gt;         \
&lt;nova:ephemeral&gt;0&lt;/nova:ephemeral&gt; &gt;&gt; &gt;         \
&lt;nova:vcpus&gt;4&lt;/nova:vcpus&gt; &gt;&gt; &gt;       &lt;/nova:flavor&gt;
&gt;&gt; &gt;       &lt;nova:owner&gt;
&gt;&gt; &gt;         &lt;nova:user \
uuid="b0f21b1d16b147ffb3f7713716cc894a"&gt;admin&lt;/nova:user&gt; &gt;&gt; &gt;      \
&lt;nova:project uuid="ae883f160c3c41db850d5cde8de8208b"&gt;service&lt;/nova:project&gt;
 &gt;&gt; &gt;       &lt;/nova:owner&gt;
&gt;&gt; &gt;     &lt;/nova:instance&gt;
&gt;&gt; &gt;   &lt;/metadata&gt;
&gt;&gt; &gt;   &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;
&gt;&gt; &gt;   &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMemory&gt;
&gt;&gt; &gt;   &lt;memoryBacking&gt;
&gt;&gt; &gt;     &lt;hugepages&gt;
&gt;&gt; &gt;       &lt;page size='2048' unit='KiB' nodeset='0'/&gt;
&gt;&gt; &gt;     &lt;/hugepages&gt;
&gt;&gt; &gt;   &lt;/memoryBacking&gt;
&gt;&gt; &gt;   &lt;vcpu placement='static'&gt;2&lt;/vcpu&gt;
&gt;&gt; &gt;   &lt;cputune&gt;
&gt;&gt; &gt;     &lt;shares&gt;4096&lt;/shares&gt;
&gt;&gt; &gt;     &lt;vcpupin vcpu='0' cpuset='4-7'/&gt;
&gt;&gt; &gt;     &lt;vcpupin vcpu='1' cpuset='4-7'/&gt;
&gt;&gt; &gt;     &lt;emulatorpin cpuset='4-7'/&gt;
&gt;&gt; &gt;   &lt;/cputune&gt;
&gt;&gt; &gt;   &lt;resource&gt;
&gt;&gt; &gt;     &lt;partition&gt;/machine&lt;/partition&gt;
&gt;&gt; &gt;   &lt;/resource&gt;
&gt;&gt; &gt;   &lt;sysinfo type='smbios'&gt;
&gt;&gt; &gt;     &lt;system&gt;
&gt;&gt; &gt;       &lt;entry name='manufacturer'&gt;Fedora Project&lt;/entry&gt;
&gt;&gt; &gt;       &lt;entry name='product'&gt;OpenStack Nova&lt;/entry&gt;
&gt;&gt; &gt;       &lt;entry name='version'&gt;12.0.0-4&lt;/entry&gt;
&gt;&gt; &gt;       &lt;entry \
name='serial'&gt;95637afe-453f-42a8-b198-df673ab59c91&lt;/entry&gt; &gt;&gt; &gt;     \
&lt;entry name='uuid'&gt;53f0710f-b25e-4f47-a7cf-c15a9409fdc3&lt;/entry&gt; &gt;&gt; \
&gt;       &lt;entry name='family'&gt;Virtual Machine&lt;/entry&gt; &gt;&gt; &gt;     \
&lt;/system&gt; &gt;&gt; &gt;   &lt;/sysinfo&gt;
&gt;&gt; &gt;   &lt;os&gt;
&gt;&gt; &gt;     &lt;type arch='x86_64' \
machine='pc-i440fx-rhel7.2.0'&gt;hvm&lt;/type&gt; &gt;&gt; &gt;     &lt;boot \
dev='cdrom'/&gt; &gt;&gt; &gt;     &lt;boot dev='hd'/&gt;
&gt;&gt; &gt;     &lt;boot dev='fd'/&gt;
&gt;&gt; &gt;     &lt;smbios mode='sysinfo'/&gt;
&gt;&gt; &gt;   &lt;/os&gt;
&gt;&gt; &gt;   &lt;features&gt;
&gt;&gt; &gt;     &lt;acpi/&gt;
&gt;&gt; &gt;     &lt;apic/&gt;
&gt;&gt; &gt;   &lt;/features&gt;
&gt;&gt; &gt;   &lt;cpu mode='host-model'&gt;
&gt;&gt; &gt;     &lt;model fallback='allow'/&gt;
&gt;&gt; &gt;     &lt;topology sockets='2' cores='1' threads='1'/&gt;
&gt;&gt; &gt;   &lt;/cpu&gt;
&gt;&gt; &gt;   &lt;clock offset='utc'&gt;
&gt;&gt; &gt;     &lt;timer name='pit' tickpolicy='delay'/&gt;
&gt;&gt; &gt;     &lt;timer name='rtc' tickpolicy='catchup'/&gt;
&gt;&gt; &gt;     &lt;timer name='hpet' present='no'/&gt;
&gt;&gt; &gt;   &lt;/clock&gt;
&gt;
&gt;If nothing else, this guest is incorrectly configured for running
&gt;the Windows OS. I suspect you forget to set the Glance image
&gt;property needed to tell Nova that it is windows.
&gt;
&gt;Specifically it is missing hyperv paravirt &lt;timer&gt;, and many hyperv
&gt;paravirt &lt;feature&gt; elements.
&gt;
&gt;This will make Windows guests unstable and liable to hit BSOD
&gt;
&gt;
&gt;Regards,
&gt;Daniel
&gt;-- 
&gt;|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
&gt;|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
&gt;|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|
&lt;/pre&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;span title="neteasefooter"&gt;&lt;p&gt; &lt;/p&gt;&lt;/span&gt;


["libvirtd-log.tar.bz2" (application/octet-stream)]

</body></email><email><emailId>20170423131451</emailId><senderName>Roman Bogorodskiy</senderName><senderEmail>bogorodskiy@gmail.com</senderEmail><timestampReceived>2017-04-23 13:14:51-0400</timestampReceived><subject>Re: [libvirt-users] ZFS: creating a pool in a created zfs does not work, only when using the whole z</subject><body>


  Thies C. Arntzen wrote:

&gt; Hi,
&gt; 
&gt; I'm new here so apologies if this has been answered before.
&gt; 
&gt; I have a box that uses ZFS for everything (ubuntu 17.04) and I want to
&gt; create a libvirt pool on that. My ZFS pool is named „big"
&gt; 
&gt; So i do:
&gt; 
&gt; &gt; zfs create big/zpool
&gt; &gt; virsh pool-define-as --name zpool --source-name big/zpool --type zfs
&gt; &gt; virsh pool-start zpool
&gt; &gt; virsh pool-autostart zpool
&gt; &gt; virsh pool-list
&gt; &gt; virsh vol-create-as --pool zpool --name test1 --capacity 1G
&gt; &gt; virsh vol-list zpool
&gt; 
&gt; Everything seems to work (no error message, vol-list shows the created
&gt; volume, I can see the volume
&gt; via zfs list -t all). -BUT- I cannot use that volume via virt-manager

Could you check if you can use this volume via virsh, and paste an error
message in case if it provides one? Or maybe an error message if
virt-manager gives one.

&gt; and after a short while it's
&gt; no longer listed via virsh vol-list zpool. The very same thing works

Does "after a short while" involve host reboots, libvirtd restarts or
anything like that?

Anyway, I've just checked the scenario you provided on FreeBSD and I was
able to create a VM using this new 'test1' volume. I was using just
virsh though.

I'll try to setup Ubutun 17.04 VM and check there.

&gt; as expected if I create a new zfs
&gt; pool which I hand into libvirt. So instead of creating a pool from
&gt; "big/zpool" I create a pool names
&gt; „somepool" on a free device and -voila- everything works.
&gt; 
&gt; Hope I did make myself clear?
&gt; 
&gt; Best regards,
&gt; thies
&gt; 
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users

Roman Bogorodskiy

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170424125102</emailId><senderName>"Thies C. Arntzen"</senderName><senderEmail>thieso@gmail.com</senderEmail><timestampReceived>2017-04-24 12:51:02-0400</timestampReceived><subject>Re: [libvirt-users] ZFS: creating a pool in a created zfs does not work, only when using the whole z</subject><body>

Thank you for your reply.

I have managed to create a virtual machine on my ZFS-filesystem using
virt-install:-) It seems to me that my version of libvirt (Ubuntu 17.04)
has problems enumerating the devices when "virsh vol-list" is used. The
volumes are available for virt-install but not thru virsh or virt-manager.

As to when the volumes disappear in virsh vol-list - I have no idea. I'm
not restarting libvirtd. It *seems* to me that (wild guess) they can be
listed as long as they are fresh and  in some in memory cache and never get
displayed if you have to enumerate from the filesystem. There are no
error-messages that I can see - the volumes are simply not displayed.

Best regards,
thies






Am 23. April 2017 um 15:14:55, Roman Bogorodskiy (bogorodskiy@gmail.com)
schrieb:

Thies C. Arntzen wrote:

&gt; Hi,
&gt;
&gt; I'm new here so apologies if this has been answered before.
&gt;
&gt; I have a box that uses ZFS for everything (ubuntu 17.04) and I want to
&gt; create a libvirt pool on that. My ZFS pool is named „big"
&gt;
&gt; So i do:
&gt;
&gt; &gt; zfs create big/zpool
&gt; &gt; virsh pool-define-as --name zpool --source-name big/zpool --type zfs
&gt; &gt; virsh pool-start zpool
&gt; &gt; virsh pool-autostart zpool
&gt; &gt; virsh pool-list
&gt; &gt; virsh vol-create-as --pool zpool --name test1 --capacity 1G
&gt; &gt; virsh vol-list zpool
&gt;
&gt; Everything seems to work (no error message, vol-list shows the created
&gt; volume, I can see the volume
&gt; via zfs list -t all). -BUT- I cannot use that volume via virt-manager

Could you check if you can use this volume via virsh, and paste an error
message in case if it provides one? Or maybe an error message if
virt-manager gives one.

&gt; and after a short while it's
&gt; no longer listed via virsh vol-list zpool. The very same thing works

Does "after a short while" involve host reboots, libvirtd restarts or
anything like that?

Anyway, I've just checked the scenario you provided on FreeBSD and I was
able to create a VM using this new 'test1' volume. I was using just
virsh though.

I'll try to setup Ubutun 17.04 VM and check there.

&gt; as expected if I create a new zfs
&gt; pool which I hand into libvirt. So instead of creating a pool from
&gt; "big/zpool" I create a pool names
&gt; „somepool" on a free device and -voila- everything works.
&gt;
&gt; Hope I did make myself clear?
&gt;
&gt; Best regards,
&gt; thies
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users

Roman Bogorodskiy

[Attachment #3 (text/html)]

&lt;html&gt;&lt;head&gt;&lt;style&gt;body{font-family:Helvetica,Arial;font-size:13px}&lt;/style&gt;&lt;/head&gt;&lt;body \
style="word-wrap:break-word"&gt;&lt;div id="bloop_customfont" \
style="font-family:Helvetica,Arial;font-size:13px;color:rgba(0,0,0,1.0);margin:0px;line-height:auto"&gt;Thank \
you for your reply.&lt;/div&gt;&lt;div id="bloop_customfont" \
style="font-family:Helvetica,Arial;font-size:13px;color:rgba(0,0,0,1.0);margin:0px;line-height:auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
id="bloop_customfont" \
style="font-family:Helvetica,Arial;font-size:13px;color:rgba(0,0,0,1.0);margin:0px;line-height:auto"&gt;I \
have managed to create a virtual machine on my ZFS-filesystem using virt-install:-) \
It seems to me that my version of libvirt (Ubuntu 17.04) has problems enumerating the \
devices when "virsh vol-list" is used. The volumes are available for \
virt-install but not thru virsh or virt-manager.&lt;/div&gt;&lt;div id="bloop_customfont" \
style="font-family:Helvetica,Arial;font-size:13px;color:rgba(0,0,0,1.0);margin:0px;line-height:auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
id="bloop_customfont" \
style="font-family:Helvetica,Arial;font-size:13px;color:rgba(0,0,0,1.0);margin:0px;line-height:auto"&gt;As \
to when the volumes disappear in virsh vol-list - I have no idea. I'm not restarting \
libvirtd. It *seems* to me that (wild guess) they can be listed as long as they are \
fresh and   in some in memory cache and never get displayed if you have to enumerate \
from the filesystem. There are no error-messages that I can see - the volumes are \
simply not displayed.&lt;/div&gt;&lt;div id="bloop_customfont" \
style="font-family:Helvetica,Arial;font-size:13px;color:rgba(0,0,0,1.0);margin:0px;line-height:auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
id="bloop_customfont" \
style="font-family:Helvetica,Arial;font-size:13px;color:rgba(0,0,0,1.0);margin:0px;line-height:auto"&gt;Best \
regards,&lt;/div&gt;&lt;div id="bloop_customfont" \
style="font-family:Helvetica,Arial;font-size:13px;color:rgba(0,0,0,1.0);margin:0px;line-height:auto"&gt;thies&lt;/div&gt;&lt;div \
id="bloop_customfont" \
style="font-family:Helvetica,Arial;font-size:13px;color:rgba(0,0,0,1.0);margin:0px;line-height:auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
id="bloop_customfont" \
style="font-family:Helvetica,Arial;font-size:13px;color:rgba(0,0,0,1.0);margin:0px;line-height:auto"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
id="bloop_customfont" \
style="font-family:Helvetica,Arial;font-size:13px;color:rgba(0,0,0,1.0);margin:0px;line-height:auto"&gt;&lt;br&gt;&lt;/div&gt; \
&lt;br&gt; &lt;div id="bloop_sign_1493037807714317056" class="bloop_sign"&gt;&lt;div \
style="font-family:helvetica,arial;font-size:13px"&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;p \
class="airmail_on"&gt;Am 23. April 2017 um 15:14:55, Roman Bogorodskiy (&lt;a \
href="mailto:bogorodskiy@gmail.com"&gt;bogorodskiy@gmail.com&lt;/a&gt;) schrieb:&lt;/p&gt; \
&lt;blockquote type="cite" class="clean_bq"&gt;&lt;span&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;  Thies C. \
Arntzen wrote: &lt;br&gt;
&lt;br&gt;&gt; Hi,
&lt;br&gt;&gt;  
&lt;br&gt;&gt; I'm new here so apologies if this has been answered before.
&lt;br&gt;&gt;  
&lt;br&gt;&gt; I have a box that uses ZFS for everything (ubuntu 17.04) and I want to
&lt;br&gt;&gt; create a libvirt pool on that. My ZFS pool is named „big"
&lt;br&gt;&gt;  
&lt;br&gt;&gt; So i do:
&lt;br&gt;&gt;  
&lt;br&gt;&gt; &gt; zfs create big/zpool
&lt;br&gt;&gt; &gt; virsh pool-define-as --name zpool --source-name big/zpool --type zfs
&lt;br&gt;&gt; &gt; virsh pool-start zpool
&lt;br&gt;&gt; &gt; virsh pool-autostart zpool
&lt;br&gt;&gt; &gt; virsh pool-list
&lt;br&gt;&gt; &gt; virsh vol-create-as --pool zpool --name test1 --capacity 1G
&lt;br&gt;&gt; &gt; virsh vol-list zpool
&lt;br&gt;&gt;  
&lt;br&gt;&gt; Everything seems to work (no error message, vol-list shows the created
&lt;br&gt;&gt; volume, I can see the volume
&lt;br&gt;&gt; via zfs list -t all). -BUT- I cannot use that volume via virt-manager
&lt;br&gt;
&lt;br&gt;Could you check if you can use this volume via virsh, and paste an error
&lt;br&gt;message in case if it provides one? Or maybe an error message if
&lt;br&gt;virt-manager gives one.
&lt;br&gt;
&lt;br&gt;&gt; and after a short while it's
&lt;br&gt;&gt; no longer listed via virsh vol-list zpool. The very same thing works
&lt;br&gt;
&lt;br&gt;Does "after a short while" involve host reboots, libvirtd restarts or
&lt;br&gt;anything like that?
&lt;br&gt;
&lt;br&gt;Anyway, I've just checked the scenario you provided on FreeBSD and I was
&lt;br&gt;able to create a VM using this new 'test1' volume. I was using just
&lt;br&gt;virsh though.
&lt;br&gt;
&lt;br&gt;I'll try to setup Ubutun 17.04 VM and check there.
&lt;br&gt;
&lt;br&gt;&gt; as expected if I create a new zfs
&lt;br&gt;&gt; pool which I hand into libvirt. So instead of creating a pool from
&lt;br&gt;&gt; "big/zpool" I create a pool names
&lt;br&gt;&gt; „somepool" on a free device and -voila- everything works.
&lt;br&gt;&gt;  
&lt;br&gt;&gt; Hope I did make myself clear?
&lt;br&gt;&gt;  
&lt;br&gt;&gt; Best regards,
&lt;br&gt;&gt; thies
&lt;br&gt;&gt;  
&lt;br&gt;&gt; _______________________________________________
&lt;br&gt;&gt; libvirt-users mailing list
&lt;br&gt;&gt; &lt;a href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt;
&lt;br&gt;&gt; &lt;a href="https://www.redhat.com/mailman/listinfo/libvirt-users"&gt;https://www.redhat.com/mailman/listinfo/libvirt-users&lt;/a&gt;
 &lt;br&gt;
&lt;br&gt;Roman Bogorodskiy
&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/body&gt;&lt;/html&gt;



</body></email><email><emailId>20170420144413</emailId><senderName>Pavel Hrdina</senderName><senderEmail>phrdina@redhat.com</senderEmail><timestampReceived>2017-04-20 14:44:13-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd segfault when using oVirt 4.1 with graphic console - CentOS7.3</subject><body>


On Thu, Apr 20, 2017 at 07:36:42AM +0200, Rafał Wojciechowski wrote:
&gt; hello,
&gt; 
&gt; I am getting such error:
&gt; libvirtd[27218]: segfault at 0 ip 00007f4940725721 sp 00007f4930711740 
&gt; error 4 in libvirt.so.0.2000.0[7f4940678000+353000]
&gt; 
&gt; when I am trying to start VM with graphic spice/vnc console - in 
&gt; headless mode(without graphic console) it is running
&gt; I noticed this after update oVirt 4.0 to oVirt 4.1 however I noticed 
&gt; that also libvirtd and related packages were upgraded from 1.2.7 to 2.0.0:
&gt; libvirt-daemon-kvm-2.0.0-10.el7_3.5.x86_64
&gt; libvirt-daemon-driver-qemu-2.0.0-10.el7_3.5.x86_64
&gt; 
&gt; I am running up to date CentOS7.3 with 3.10.0-514.16.1.el7.x86_64
&gt; I have same issue with SELinux and without SELinux(checked after reboot 
&gt; with permissive mode)
&gt; 
&gt; 
&gt; I tried to get information about this issue from oVirt team, but after 
&gt; mail conversation both me and oVirt team thinks that it might be issue 
&gt; in libvirtd
&gt; 
&gt; in below link I am putting xmls generated by vdsm which are passing to 
&gt; the libvirtd to run the VMs
&gt; first one is from vdsm log and second one is extracted from dump after 
&gt; segfault of libvirtd
&gt; 
&gt; https://paste.fedoraproject.org/paste/eqpe8Byu2l-3SRdXc6LTLl5M1UNdIGYhyRLivL9gydE=

Hi,

could you please provide core backtrace? I've tried to reproduce it on
CentOS 7.3 with the same graphics configuration but the guest started
and there was no segfault.

Thanks,

Pavel

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170420161004</emailId><senderName>Rafał_Wojciechowski</senderName><senderEmail>it@rafalwojciechowski.pl</senderEmail><timestampReceived>2017-04-20 16:10:04-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd segfault when using oVirt 4.1 with graphic console - CentOS7.3</subject><body>

hello,

I attached core dump - not sure if it was what you have asked for
I am rather just admin not developer :)

Regards,

Rafal Wojciechowski


W dniu 20.04.2017 o 16:44, Pavel Hrdina pisze:
&gt; On Thu, Apr 20, 2017 at 07:36:42AM +0200, Rafał Wojciechowski wrote:
&gt;&gt; hello,
&gt;&gt;
&gt;&gt; I am getting such error:
&gt;&gt; libvirtd[27218]: segfault at 0 ip 00007f4940725721 sp 00007f4930711740
&gt;&gt; error 4 in libvirt.so.0.2000.0[7f4940678000+353000]
&gt;&gt;
&gt;&gt; when I am trying to start VM with graphic spice/vnc console - in
&gt;&gt; headless mode(without graphic console) it is running
&gt;&gt; I noticed this after update oVirt 4.0 to oVirt 4.1 however I noticed
&gt;&gt; that also libvirtd and related packages were upgraded from 1.2.7 to 2.0.0:
&gt;&gt; libvirt-daemon-kvm-2.0.0-10.el7_3.5.x86_64
&gt;&gt; libvirt-daemon-driver-qemu-2.0.0-10.el7_3.5.x86_64
&gt;&gt;
&gt;&gt; I am running up to date CentOS7.3 with 3.10.0-514.16.1.el7.x86_64
&gt;&gt; I have same issue with SELinux and without SELinux(checked after reboot
&gt;&gt; with permissive mode)
&gt;&gt;
&gt;&gt;
&gt;&gt; I tried to get information about this issue from oVirt team, but after
&gt;&gt; mail conversation both me and oVirt team thinks that it might be issue
&gt;&gt; in libvirtd
&gt;&gt;
&gt;&gt; in below link I am putting xmls generated by vdsm which are passing to
&gt;&gt; the libvirtd to run the VMs
&gt;&gt; first one is from vdsm log and second one is extracted from dump after
&gt;&gt; segfault of libvirtd
&gt;&gt;
&gt;&gt; https://paste.fedoraproject.org/paste/eqpe8Byu2l-3SRdXc6LTLl5M1UNdIGYhyRLivL9gydE=
&gt; Hi,
&gt;
&gt; could you please provide core backtrace? I've tried to reproduce it on
&gt; CentOS 7.3 with the same graphics configuration but the guest started
&gt; and there was no segfault.
&gt;
&gt; Thanks,
&gt;
&gt; Pavel

</body></email><email><emailId>20170427204041</emailId><senderName>Peter Steele</senderName><senderEmail>pwsteele@gmail.com</senderEmail><timestampReceived>2017-04-27 20:40:41-0400</timestampReceived><subject>[libvirt-users] Does lxc support cputune/vcpusched option</subject><body>

I need a container that supports real time threads. According to the 
documentation, I can do something like this:

&lt;domain type='lxc'&gt;
   &lt;name&gt;test1&lt;/name&gt;
   &lt;uuid&gt;e7446f55-3d59-4af0-90b2-d1498ac4370d&lt;/uuid&gt;
...
   &lt;vcpu placement='auto'&gt;2&lt;/vcpu&gt;
   &lt;cputune&gt;
     &lt;vcpusched vcpus='0-1' scheduler='fifo' priority='1'/&gt;
   &lt;/cputune&gt;
...
&lt;/domain&gt;

The document describes the vcpusched element as follows:

The optional |vcpusched| elements specifies the scheduler type (values 
|batch|, |idle|, |fifo|, |rr|) for particular vCPU/IOThread threads 
(based on |vcpus| and |iothreads|, leaving out |vcpus|/|iothreads| sets 
the default). Valid |vcpus| values start at 0 through one less than the 
number of vCPU's defined for the domain. Valid |iothreads| values are 
described in the |iothreadids| |description| 
&lt;https://libvirt.org/formatdomain.html#elementsIOThreadsAllocation&gt;. If 
no |iothreadids| are defined, then libvirt numbers IOThreads from 1 to 
the number of |iothreads| available for the domain. For real-time 
schedulers (|fifo|, |rr|), priority must be specified as well (and is 
ignored for non-real-time ones). The value range for the priority 
depends on the host kernel (usually 1-99).

So I *think* my xml is correct for this, but it doesn't seem to work--I 
still can't create real time threads in my container. Am I missing 
another configuration step somewhere?

Peter


[Attachment #3 (text/html)]

&lt;html&gt;
  &lt;head&gt;

    &lt;meta http-equiv="content-type" content="text/html; charset=utf-8"&gt;
  &lt;/head&gt;
  &lt;body text="#000000" bgcolor="#FFFFFF"&gt;
    I need a container that supports real time threads. According to the
    documentation, I can do something like this:&lt;br&gt;
    &lt;br&gt;
    &lt;domain type='lxc'&gt;&lt;br&gt;
      &lt;name&gt;test1&lt;/name&gt;&lt;br&gt;
      &lt;uuid&gt;e7446f55-3d59-4af0-90b2-d1498ac4370d&lt;/uuid&gt;&lt;br&gt;
    ...&lt;br&gt;
      &lt;vcpu placement='auto'&gt;2&lt;/vcpu&gt;&lt;br&gt;
      &lt;cputune&gt;&lt;br&gt;
        &lt;vcpusched vcpus='0-1' scheduler='fifo' priority='1'/&gt;&lt;br&gt;
      &lt;/cputune&gt;&lt;br&gt;
    ...&lt;br&gt;
    &lt;/domain&gt;&lt;br&gt;
    &lt;br&gt;
    The document describes the vcpusched element as follows:&lt;br&gt;
    &lt;br&gt;
    The optional &lt;code&gt;vcpusched&lt;/code&gt; elements specifies the
    scheduler type (values &lt;code&gt;batch&lt;/code&gt;, &lt;code&gt;idle&lt;/code&gt;, &lt;code&gt;fifo&lt;/code&gt;,
    &lt;code&gt;rr&lt;/code&gt;) for particular vCPU/IOThread threads (based on &lt;code&gt;vcpus&lt;/code&gt;
    and &lt;code&gt;iothreads&lt;/code&gt;, leaving out &lt;code&gt;vcpus&lt;/code&gt;/&lt;code&gt;iothreads&lt;/code&gt;
    sets the default). Valid &lt;code&gt;vcpus&lt;/code&gt; values start at 0
    through one less than the number of vCPU's defined for the domain.
    Valid &lt;code&gt;iothreads&lt;/code&gt; values are described in the &lt;code&gt;iothreadids&lt;/code&gt;
    &lt;a
      href="https://libvirt.org/formatdomain.html#elementsIOThreadsAllocation"
      shape="rect"&gt;&lt;code&gt;description&lt;/code&gt;&lt;/a&gt;. If no &lt;code&gt;iothreadids&lt;/code&gt;
    are defined, then libvirt numbers IOThreads from 1 to the number of
    &lt;code&gt;iothreads&lt;/code&gt; available for the domain. For real-time
    schedulers (&lt;code&gt;fifo&lt;/code&gt;, &lt;code&gt;rr&lt;/code&gt;), priority must be
    specified as well (and is ignored for non-real-time ones). The value
    range for the priority depends on the host kernel (usually 1-99).&lt;br&gt;
    &lt;br&gt;
    So I *think* my xml is correct for this, but it doesn't seem to
    work--I still can't create real time threads in my container. Am I
    missing another configuration step somewhere?&lt;br&gt;
    &lt;br&gt;
    Peter&lt;br&gt;
    &lt;br&gt;
  &lt;/body&gt;
&lt;/html&gt;


</body></email><email><emailId>20170421085333</emailId><senderName>Pavel Hrdina</senderName><senderEmail>phrdina@redhat.com</senderEmail><timestampReceived>2017-04-21 08:53:33-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd segfault when using oVirt 4.1 with graphic console - CentOS7.3</subject><body>


On Thu, Apr 20, 2017 at 06:10:04PM +0200, Rafał Wojciechowski wrote:
&gt; hello,
&gt; 
&gt; I attached core dump - not sure if it was what you have asked for
&gt; I am rather just admin not developer :)
&gt; 
&gt; Regards,
&gt; 
&gt; Rafal Wojciechowski

The attached core send in private mail helped to figure out where the crash
happened.  Backtrace:

Thread 1 (Thread 0x7f194b99d700 (LWP 5631)):
#0  virNetDevGetifaddrsAddress (addr=0x7f194b99c7c0, ifname=0x7f193400e2b0 \
"ovirtmgmt") at util/virnetdevip.c:738 #1  virNetDevIPAddrGet (ifname=0x7f193400e2b0 \
"ovirtmgmt", addr=addr@entry=0x7f194b99c7c0) at util/virnetdevip.c:795 #2  \
0x00007f19467800d6 in networkGetNetworkAddress (netname=&lt;optimized out&gt;, \
netaddr=netaddr@entry=0x7f1924013f18) at network/bridge_driver.c:4780 #3  \
0x00007f193e43a33c in qemuProcessGraphicsSetupNetworkAddress \
(listenAddr=0x7f19340f7650 "127.0.0.1", glisten=0x7f1924013f10) at \
qemu/qemu_process.c:4062 #4  qemuProcessGraphicsSetupListen (vm=&lt;optimized out&gt;, \
graphics=0x7f1924014f10, cfg=0x7f1934119f00) at qemu/qemu_process.c:4133 #5  \
qemuProcessSetupGraphics (flags=17, vm=0x7f19240155d0, driver=0x7f193411f1d0) at \
qemu/qemu_process.c:4196 #6  qemuProcessPrepareDomain \
(conn=conn@entry=0x7f192c00ab50, driver=driver@entry=0x7f193411f1d0, \
vm=vm@entry=0x7f19240155d0, flags=flags@entry=17) at qemu/qemu_process.c:4969 #7  \
0x00007f193e4417c0 in qemuProcessStart (conn=conn@entry=0x7f192c00ab50, \
driver=driver@entry=0x7f193411f1d0, vm=0x7f19240155d0, \
asyncJob=asyncJob@entry=QEMU_ASYNC_JOB_START, migrateFrom=migrateFrom@entry=0x0, \
migrateFd=migrateFd@entry=-1, migratePath=migratePath@entry=0x0, \
snapshot=snapshot@entry=0x0, vmop=vmop@entry=VIR_NETDEV_VPORT_PROFILE_OP_CREATE, \
flags=17, flags@entry=1) at qemu/qemu_process.c:5553 #8  0x00007f193e490030 in \
qemuDomainCreateXML (conn=0x7f192c00ab50, xml=&lt;optimized out&gt;, flags=&lt;optimized out&gt;) \
at qemu/qemu_driver.c:1774 #9  0x00007f195aa6af81 in virDomainCreateXML \
(conn=0x7f192c00ab50, xmlDesc=0x7f1924003f00 "&lt;?xml version='1.0' \
encoding='UTF-8'?&gt;\n&lt;domain xmlns:ovirt=\"http://ovirt.org/vm/tune/1.0\" \
type=\"kvm\"&gt;\n    &lt;name&gt;zzzzz&lt;/name&gt;\n    \
&lt;uuid&gt;7d14f6e2-978b-47a5-875d-be5d6b28af2c&lt;/uuid&gt;\n    &lt;memory&gt;1048576&lt;/"..., \
flags=0) at libvirt-domain.c:180 #10 0x00007f195b6e8dfa in \
remoteDispatchDomainCreateXML (server=0x7f195bc4eb40, msg=0x7f195bc73ee0, \
ret=0x7f19240038b0, args=0x7f1924003a70, rerr=0x7f194b99cc50, client=0x7f195bc71e90) \
at remote_dispatch.h:4257 #11 remoteDispatchDomainCreateXMLHelper \
(server=0x7f195bc4eb40, client=0x7f195bc71e90, msg=0x7f195bc73ee0, \
rerr=0x7f194b99cc50, args=0x7f1924003a70, ret=0x7f19240038b0) at \
remote_dispatch.h:4235 #12 0x00007f195aaea002 in virNetServerProgramDispatchCall \
(msg=0x7f195bc73ee0, client=0x7f195bc71e90, server=0x7f195bc4eb40, \
prog=0x7f195bc62fa0) at rpc/virnetserverprogram.c:437 #13 virNetServerProgramDispatch \
(prog=0x7f195bc62fa0, server=server@entry=0x7f195bc4eb40, client=0x7f195bc71e90, \
msg=0x7f195bc73ee0) at rpc/virnetserverprogram.c:307 #14 0x00007f195b6f9c6d in \
virNetServerProcessMsg (msg=&lt;optimized out&gt;, prog=&lt;optimized out&gt;, client=&lt;optimized \
out&gt;, srv=0x7f195bc4eb40) at rpc/virnetserver.c:148 #15 virNetServerHandleJob \
(jobOpaque=&lt;optimized out&gt;, opaque=0x7f195bc4eb40) at rpc/virnetserver.c:169 #16 \
0x00007f195a9d6d41 in virThreadPoolWorker (opaque=opaque@entry=0x7f195bc44160) at \
util/virthreadpool.c:167 #17 0x00007f195a9d60c8 in virThreadHelper (data=&lt;optimized \
out&gt;) at util/virthread.c:206 #18 0x00007f1957ff9dc5 in start_thread \
(arg=0x7f194b99d700) at pthread_create.c:308 #19 0x00007f1957d2873d in clone () at \
../sysdeps/unix/sysv/linux/x86_64/clone.S:113

I'll send a patch to upstream libvirt to fix this crash.  However it can take
a while to get it back to CentOS/RHEL.  The source of this crash is that you
have a "tun0" network interface without IP address and that interface is
checked before "ovirtmgmt" and it causes the crash.  You can workaround it
by removing the "tun0" interface if it doesn't have any IP address.

Pavel

&gt; W dniu 20.04.2017 o 16:44, Pavel Hrdina pisze:
&gt; &gt; On Thu, Apr 20, 2017 at 07:36:42AM +0200, Rafał Wojciechowski wrote:
&gt; &gt; &gt; hello,
&gt; &gt; &gt; 
&gt; &gt; &gt; I am getting such error:
&gt; &gt; &gt; libvirtd[27218]: segfault at 0 ip 00007f4940725721 sp 00007f4930711740
&gt; &gt; &gt; error 4 in libvirt.so.0.2000.0[7f4940678000+353000]
&gt; &gt; &gt; 
&gt; &gt; &gt; when I am trying to start VM with graphic spice/vnc console - in
&gt; &gt; &gt; headless mode(without graphic console) it is running
&gt; &gt; &gt; I noticed this after update oVirt 4.0 to oVirt 4.1 however I noticed
&gt; &gt; &gt; that also libvirtd and related packages were upgraded from 1.2.7 to 2.0.0:
&gt; &gt; &gt; libvirt-daemon-kvm-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; libvirt-daemon-driver-qemu-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; 
&gt; &gt; &gt; I am running up to date CentOS7.3 with 3.10.0-514.16.1.el7.x86_64
&gt; &gt; &gt; I have same issue with SELinux and without SELinux(checked after reboot
&gt; &gt; &gt; with permissive mode)
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; I tried to get information about this issue from oVirt team, but after
&gt; &gt; &gt; mail conversation both me and oVirt team thinks that it might be issue
&gt; &gt; &gt; in libvirtd
&gt; &gt; &gt; 
&gt; &gt; &gt; in below link I am putting xmls generated by vdsm which are passing to
&gt; &gt; &gt; the libvirtd to run the VMs
&gt; &gt; &gt; first one is from vdsm log and second one is extracted from dump after
&gt; &gt; &gt; segfault of libvirtd
&gt; &gt; &gt; 
&gt; &gt; &gt; https://paste.fedoraproject.org/paste/eqpe8Byu2l-3SRdXc6LTLl5M1UNdIGYhyRLivL9gydE=
&gt; &gt; &gt; 
&gt; &gt; Hi,
&gt; &gt; 
&gt; &gt; could you please provide core backtrace? I've tried to reproduce it on
&gt; &gt; CentOS 7.3 with the same graphics configuration but the guest started
&gt; &gt; and there was no segfault.
&gt; &gt; 
&gt; &gt; Thanks,
&gt; &gt; 
&gt; &gt; Pavel
&gt; 


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170421082353</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-04-21 08:23:53-0400</timestampReceived><subject>Re: [libvirt-users] libvirt remote connection</subject><body>

On Fri, Apr 21, 2017 at 10:16:47AM +0300, Anastasiya Ruzhanskaya wrote:
&gt; Hello,
&gt; I have some questions about libvirt remote connection.
&gt; Am I right that internally libvirt uses only tcp ( ssh and tls are only
&gt; encryption based on this) + ftp ( when working with image itself)? Also I
&gt; have found that  it uses RPC. However, as I know RPC runs above tcp but I
&gt; cannot capture these packets with wireshark when I am connecting remotely
&gt; to the host with vm? Is it somehow possible to find out, what data, what
&gt; messages, in what format are send from my server to the remote libvirt
&gt; (daemon I suppose?)?

Libvirt uses a custom RPC protocol running above a number of different
transports (TCP with SASL, TCP with TLS, SSH tunnel, etc, etc). Libvirt
ships a wireshark plugin that can be used to analyse the network stream
but you would have to turn off all authentication and use plain TCP
to be able to see it otherwise it'll be encrypted and wireshark won;t
see anything


Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170421091454</emailId><senderName>Anastasiya Ruzhanskaya</senderName><senderEmail>anastasiya.ruzhanskaya@frtk.ru</senderEmail><timestampReceived>2017-04-21 09:14:54-0400</timestampReceived><subject>Re: [libvirt-users] libvirt remote connection</subject><body>

It seems, that I have turned off all encryption for tcp in libvirt.conf,
but still rpc packets are not showed, only tcp. I suppose, that I don't
need to add additional plugins to wirehark for libvirt and rpc, am I right?

2017-04-21 11:23 GMT+03:00 Daniel P. Berrange &lt;berrange@redhat.com&gt;:

&gt; On Fri, Apr 21, 2017 at 10:16:47AM +0300, Anastasiya Ruzhanskaya wrote:
&gt; &gt; Hello,
&gt; &gt; I have some questions about libvirt remote connection.
&gt; &gt; Am I right that internally libvirt uses only tcp ( ssh and tls are only
&gt; &gt; encryption based on this) + ftp ( when working with image itself)? Also I
&gt; &gt; have found that  it uses RPC. However, as I know RPC runs above tcp but I
&gt; &gt; cannot capture these packets with wireshark when I am connecting remotely
&gt; &gt; to the host with vm? Is it somehow possible to find out, what data, what
&gt; &gt; messages, in what format are send from my server to the remote libvirt
&gt; &gt; (daemon I suppose?)?
&gt;
&gt; Libvirt uses a custom RPC protocol running above a number of different
&gt; transports (TCP with SASL, TCP with TLS, SSH tunnel, etc, etc). Libvirt
&gt; ships a wireshark plugin that can be used to analyse the network stream
&gt; but you would have to turn off all authentication and use plain TCP
&gt; to be able to see it otherwise it'll be encrypted and wireshark won;t
&gt; see anything
&gt;
&gt;
&gt; Regards,
&gt; Daniel
&gt; --
&gt; |: https://berrange.com      -o-    https://www.flickr.com/photos/
&gt; dberrange :|
&gt; |: https://libvirt.org         -o-
&gt; https://fstop138.berrange.com :|
&gt; |: https://entangle-photo.org    -o-    https://www.instagram.com/
&gt; dberrange :|
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;It seems, that I have turned off all encryption for tcp in \
libvirt.conf, but still rpc packets are not showed, only tcp. I suppose, that I \
don't need to add additional plugins to wirehark for libvirt and rpc, am I \
right?&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-04-21 \
11:23 GMT+03:00 Daniel P. Berrange &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:berrange@redhat.com" \
target="_blank"&gt;berrange@redhat.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div class="HOEnZb"&gt;&lt;div class="h5"&gt;On Fri, Apr 21, 2017 at \
10:16:47AM +0300, Anastasiya Ruzhanskaya wrote:&lt;br&gt; &gt; Hello,&lt;br&gt;
&gt; I have some questions about libvirt remote connection.&lt;br&gt;
&gt; Am I right that internally libvirt uses only tcp ( ssh and tls are only&lt;br&gt;
&gt; encryption based on this) + ftp ( when working with image itself)? Also I&lt;br&gt;
&gt; have found that   it uses RPC. However, as I know RPC runs above tcp but I&lt;br&gt;
&gt; cannot capture these packets with wireshark when I am connecting remotely&lt;br&gt;
&gt; to the host with vm? Is it somehow possible to find out, what data, what&lt;br&gt;
&gt; messages, in what format are send from my server to the remote libvirt&lt;br&gt;
&gt; (daemon I suppose?)?&lt;br&gt;
&lt;br&gt;
&lt;/div&gt;&lt;/div&gt;Libvirt uses a custom RPC protocol running above a number of \
different&lt;br&gt; transports (TCP with SASL, TCP with TLS, SSH tunnel, etc, etc). \
Libvirt&lt;br&gt; ships a wireshark plugin that can be used to analyse the network \
stream&lt;br&gt; but you would have to turn off all authentication and use plain TCP&lt;br&gt;
to be able to see it otherwise it'll be encrypted and wireshark won;t&lt;br&gt;
see anything&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
Regards,&lt;br&gt;
Daniel&lt;br&gt;
&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;--&lt;br&gt;
&gt; &gt; &lt;a href="https://berrange.com" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://berrange.com&lt;/a&gt;         -o-      &lt;a \
&gt; &gt; href="https://www.flickr.com/photos/dberrange" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://www.flickr.com/photos/&lt;wbr&gt;dberrange&lt;/a&gt; :|&lt;br&gt;
&gt; &gt; &lt;a href="https://libvirt.org" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://libvirt.org&lt;/a&gt;              -o-                  &lt;a \
&gt; &gt; href="https://fstop138.berrange.com" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://fstop138.berrange.com&lt;/a&gt; :|&lt;br&gt;
&gt; &gt; &lt;a href="https://entangle-photo.org" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://entangle-photo.org&lt;/a&gt;      -o-      &lt;a \
&gt; &gt; href="https://www.instagram.com/dberrange" rel="noreferrer" \
&gt; &gt; target="_blank"&gt;https://www.instagram.com/&lt;wbr&gt;dberrange&lt;/a&gt; :|&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170420084358</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-04-20 08:43:58-0400</timestampReceived><subject>Re: [libvirt-users] understanding --idmap for containers (v2.5.0)</subject><body>

On Thu, Apr 20, 2017 at 08:26:11AM +0000, mailing lists wrote:
&gt; Hello,
&gt; I'm testing containers on a host machine without selinux so I'm trying use the \
&gt; idmap feature, but I must be missing something because all that I get is a readonly \
&gt; container for the root user. 
&gt; # virsh version --daemon
&gt; Compiled against library: libvirt 2.5.0
&gt; Using library: libvirt 2.5.0
&gt; Using API: QEMU 2.5.0
&gt; Running hypervisor: QEMU 2.8.1
&gt; Running against daemon: 2.5.0
&gt; 
&gt; # virsh --connect lxc:/// dumpxml lab-gentoo-01
&gt; &lt;domain type='lxc'&gt;
&gt; &lt;name&gt;lab-gentoo-01&lt;/name&gt;
&gt; &lt;uuid&gt;a9f73091-b716-4b61-95ad-fa1d0c061bef&lt;/uuid&gt;
&gt; &lt;memory unit='KiB'&gt;524288&lt;/memory&gt;
&gt; &lt;currentMemory unit='KiB'&gt;524288&lt;/currentMemory&gt;
&gt; &lt;vcpu placement='static'&gt;2&lt;/vcpu&gt;
&gt; &lt;resource&gt;
&gt; &lt;partition&gt;/machine&lt;/partition&gt;
&gt; &lt;/resource&gt;
&gt; &lt;os&gt;
&gt; &lt;type arch='x86_64'&gt;exe&lt;/type&gt;
&gt; &lt;init&gt;/bin/sh&lt;/init&gt;
&gt; &lt;/os&gt;
&gt; &lt;idmap&gt;
&gt; &lt;uid start='0' target='900' count='10'/&gt;
&gt; &lt;gid start='0' target='900' count='10'/&gt;

Ok, so UID 0 in the container is being mapped to UID 900 in the
host.


&gt; &lt;filesystem type='mount' accessmode='passthrough'&gt;
&gt; &lt;source dir='/media/containers/lab-gentoo-01/'/&gt;
&gt; &lt;target dir='/'/&gt;
&gt; &lt;/filesystem&gt;


&gt; # ls -l /media/containers/lab-gentoo-01/
&gt; total 36
&gt; drwxr-xr-x  2 root root 4096 Apr 13 07:33 bin
&gt; drwxr-xr-x  2 root root   18 Apr 13 03:28 boot
&gt; drwxr-xr-x  7 root root 4096 Apr 18 12:45 dev
&gt; drwxr-xr-x 31 root root 4096 Apr 18 12:49 etc
&gt; drwxr-xr-x  2 root root   18 Apr 13 03:28 home
&gt; lrwxrwxrwx  1 root root    5 Apr 13 06:13 lib -&gt; lib64
&gt; drwxr-xr-x  2 root root 4096 Apr 13 06:14 lib32
&gt; drwxr-xr-x  9 root root 4096 Apr 13 07:33 lib64
&gt; drwxr-xr-x  2 root root   18 Apr 13 03:28 media
&gt; drwxr-xr-x  2 root root   18 Apr 13 03:28 mnt
&gt; drwxr-xr-x  2 root root   18 Apr 13 03:28 opt
&gt; drwxr-xr-x  2 root root    6 Apr 13 03:18 proc
&gt; drwx------  2 root root   18 Apr 13 03:28 root
&gt; drwxr-xr-x  2 root root   31 Apr 13 07:32 run
&gt; drwxr-xr-x  2 root root 4096 Apr 13 07:36 sbin
&gt; drwxr-xr-x  2 root root   18 Apr 13 03:28 sys
&gt; drwxrwxrwt  2 root root   18 Apr 13 07:36 tmp
&gt; drwxr-xr-x 13 root root 4096 Apr 18 12:49 usr
&gt; drwxr-xr-x  9 root root  102 Apr 13 03:28 var

THis is showing that the container's root filesystem is owned by
UID 0 in the *host*.

&gt; # virsh --connect lxc:/// start --console lab-gentoo-01
&gt; Domain lab-gentoo-01 started
&gt; Connected to domain lab-gentoo-01
&gt; Escape character is ^]
&gt; sh-4.3# /usr/bin/id
&gt; uid=0(root) gid=0(root) groups=0(root)
&gt; sh-4.3# pwd
&gt; /
&gt; sh-4.3# touch asdf
&gt; touch: cannot touch 'asdf': Permission denied

This is expected, because UID 0 in container is remapped to
uid 900 in host, and is thus denied ability to write to
a directory owned by uid 0 in the host

&gt; indeed the container is using the idmap feature because the
&gt; efective uid/gid map (900/900) is not allowing writes in the
&gt; filesystem, but it doesn't seems very usefull.
&gt; 
&gt; is it possible to have read/write containers while using idmap?

You need to change the UIDs in your container's filesystem to be
offset by 900


Regards,
Daniel
-- 
&gt; &gt; https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
&gt; &gt; https://libvirt.org         -o-            https://fstop138.berrange.com :|
&gt; &gt; https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|


</body></email><email><emailId>20170404095923</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-04-04 09:59:23-0400</timestampReceived><subject>Re: [libvirt-users] creating a lxc image to be used with libvirt-lxc</subject><body>

On Mon, Apr 03, 2017 at 05:52:33PM +0000, Spike wrote:
&gt; Dear all,
&gt; 
&gt; I'm moving my first baby steps with libvirt-lxc trying to convert over from
&gt; an LXD installation and one of the hurdles is putting together an image.
&gt; 
&gt; All the examples I found about libvirt-lxc refer to running /bin/sh in a
&gt; container, almost as if it was docker, as opposed to run a "full system"
&gt; like I've been doing with lxd. Also virt-install, often referred in libvirt
&gt; docs, seems to be specific/only for kvm.
&gt; 
&gt; Can anybody point me to any documentation to achieve the same as you'd do
&gt; with lxd? would it even just work to use those images (
&gt; https://cloud-images.ubuntu.com/) with libvirt? Last but not least, is
&gt; there any way to "publish" a modified image so that I could make changes to
&gt; any of the above and then reuse the modified one as a base for other
&gt; containers?

Libvirt LXC doesn't really care what you run inside the containedr - it is
possible to use it to run a single application (docker style), or to run a
full operating system. You essentially just need to populate a chroot with
the operating system install you want to run.

I've previously tested with a Fedora chroot:

  https://www.berrange.com/posts/2013/08/12/running-a-full-fedora-os-inside-a-libvirt-lxc-guest/

If you want to have layered modifications, then the best bet is probably
to make use of overlayfs with your chroots. ie populate a base chroot
and treat it as read-only thereafter. Then create a new directory mounted
with overlayfs to add a writable layer on top.


Regards,
Daniel
-- 
|: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
|: http://libvirt.org              -o-             http://virt-manager.org :|
|: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|

</body></email><email><emailId>20170404172019</emailId><senderName>Spike</senderName><senderEmail>spike@drba.org</senderEmail><timestampReceived>2017-04-04 17:20:19-0400</timestampReceived><subject>Re: [libvirt-users] creating a lxc image to be used with libvirt-lxc</subject><body>

ok, thank you Daniel, that helps, I'll see if I can adapt it to other OS
and figure out the docker style stuff, it would be useful to run a few
things I have in mind.

Btw, Daniel, have you ever tried to run libvirt inside a container? I was
trying to do so to test things since I didn't want to get all the stuff
installed on the host, but I got a whole bunch of errors and virt-manager
would not connect no matter what.

Also, some more examples, if anybody on the list has them, would be most
appreciated to help a noob get started.

best,

Spike

On Tue, Apr 4, 2017 at 2:59 AM Daniel P. Berrange &lt;berrange@redhat.com&gt;
wrote:

&gt; On Mon, Apr 03, 2017 at 05:52:33PM +0000, Spike wrote:
&gt; &gt; Dear all,
&gt; &gt;
&gt; &gt; I'm moving my first baby steps with libvirt-lxc trying to convert over
&gt; from
&gt; &gt; an LXD installation and one of the hurdles is putting together an image.
&gt; &gt;
&gt; &gt; All the examples I found about libvirt-lxc refer to running /bin/sh in a
&gt; &gt; container, almost as if it was docker, as opposed to run a "full system"
&gt; &gt; like I've been doing with lxd. Also virt-install, often referred in
&gt; libvirt
&gt; &gt; docs, seems to be specific/only for kvm.
&gt; &gt;
&gt; &gt; Can anybody point me to any documentation to achieve the same as you'd do
&gt; &gt; with lxd? would it even just work to use those images (
&gt; &gt; https://cloud-images.ubuntu.com/) with libvirt? Last but not least, is
&gt; &gt; there any way to "publish" a modified image so that I could make changes
&gt; to
&gt; &gt; any of the above and then reuse the modified one as a base for other
&gt; &gt; containers?
&gt;
&gt; Libvirt LXC doesn't really care what you run inside the containedr - it is
&gt; possible to use it to run a single application (docker style), or to run a
&gt; full operating system. You essentially just need to populate a chroot with
&gt; the operating system install you want to run.
&gt;
&gt; I've previously tested with a Fedora chroot:
&gt;
&gt;
&gt; https://www.berrange.com/posts/2013/08/12/running-a-full-fedora-os-inside-a-libvirt-lxc-guest/
&gt;
&gt; If you want to have layered modifications, then the best bet is probably
&gt; to make use of overlayfs with your chroots. ie populate a base chroot
&gt; and treat it as read-only thereafter. Then create a new directory mounted
&gt; with overlayfs to add a writable layer on top.
&gt;
&gt;
&gt; Regards,
&gt; Daniel
&gt; --
&gt; |: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/
&gt; :|
&gt; |: http://libvirt.org              -o-             http://virt-manager.org
&gt; :|
&gt; |: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/
&gt; :|
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;ok, thank you Daniel, that helps, I'll see if I can adapt it to \
other OS and figure out the docker style stuff, it would be useful to run a few \
things I have in mind.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Btw, Daniel, have you ever tried to run \
libvirt inside a container? I was trying to do so to test things since I didn't \
want to get all the stuff installed on the host, but I got a whole bunch of errors \
and virt-manager would not connect no matter what.&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also, some \
more examples, if anybody on the list has them, would be most appreciated to help a \
noob get started.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;best,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Spike&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;&lt;div dir="ltr"&gt;On Tue, Apr 4, 2017 at 2:59 AM Daniel P. Berrange \
&lt;&lt;a href="mailto:berrange@redhat.com"&gt;berrange@redhat.com&lt;/a&gt;&gt; \
wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;On Mon, Apr 03, 2017 at 05:52:33PM \
+0000, Spike wrote:&lt;br class="gmail_msg"&gt; &gt; Dear all,&lt;br class="gmail_msg"&gt;
&gt;&lt;br class="gmail_msg"&gt;
&gt; I'm moving my first baby steps with libvirt-lxc trying to convert over \
from&lt;br class="gmail_msg"&gt; &gt; an LXD installation and one of the hurdles is putting \
together an image.&lt;br class="gmail_msg"&gt; &gt;&lt;br class="gmail_msg"&gt;
&gt; All the examples I found about libvirt-lxc refer to running /bin/sh in a&lt;br \
class="gmail_msg"&gt; &gt; container, almost as if it was docker, as opposed to run a \
"full system"&lt;br class="gmail_msg"&gt; &gt; like I've been doing with lxd. \
Also virt-install, often referred in libvirt&lt;br class="gmail_msg"&gt; &gt; docs, seems \
to be specific/only for kvm.&lt;br class="gmail_msg"&gt; &gt;&lt;br class="gmail_msg"&gt;
&gt; Can anybody point me to any documentation to achieve the same as you'd do&lt;br \
class="gmail_msg"&gt; &gt; with lxd? would it even just work to use those images (&lt;br \
class="gmail_msg"&gt; &gt; &lt;a href="https://cloud-images.ubuntu.com/" rel="noreferrer" \
class="gmail_msg" target="_blank"&gt;https://cloud-images.ubuntu.com/&lt;/a&gt;) with libvirt? \
Last but not least, is&lt;br class="gmail_msg"&gt; &gt; there any way to \
"publish" a modified image so that I could make changes to&lt;br \
class="gmail_msg"&gt; &gt; any of the above and then reuse the modified one as a base \
for other&lt;br class="gmail_msg"&gt; &gt; containers?&lt;br class="gmail_msg"&gt;
&lt;br class="gmail_msg"&gt;
Libvirt LXC doesn't really care what you run inside the containedr - it is&lt;br \
class="gmail_msg"&gt; possible to use it to run a single application (docker style), or \
to run a&lt;br class="gmail_msg"&gt; full operating system. You essentially just need to \
populate a chroot with&lt;br class="gmail_msg"&gt; the operating system install you want to \
run.&lt;br class="gmail_msg"&gt; &lt;br class="gmail_msg"&gt;
I've previously tested with a Fedora chroot:&lt;br class="gmail_msg"&gt;
&lt;br class="gmail_msg"&gt;
   &lt;a href="https://www.berrange.com/posts/2013/08/12/running-a-full-fedora-os-inside-a-libvirt-lxc-guest/" \
rel="noreferrer" class="gmail_msg" \
target="_blank"&gt;https://www.berrange.com/posts/2013/08/12/running-a-full-fedora-os-inside-a-libvirt-lxc-guest/&lt;/a&gt;&lt;br \
class="gmail_msg"&gt; &lt;br class="gmail_msg"&gt;
If you want to have layered modifications, then the best bet is probably&lt;br \
class="gmail_msg"&gt; to make use of overlayfs with your chroots. ie populate a base \
chroot&lt;br class="gmail_msg"&gt; and treat it as read-only thereafter. Then create a new \
directory mounted&lt;br class="gmail_msg"&gt; with overlayfs to add a writable layer on \
top.&lt;br class="gmail_msg"&gt; &lt;br class="gmail_msg"&gt;
&lt;br class="gmail_msg"&gt;
Regards,&lt;br class="gmail_msg"&gt;
Daniel&lt;br class="gmail_msg"&gt;
--&lt;br class="gmail_msg"&gt;
&gt; &gt; &lt;a href="http://berrange.com" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://berrange.com&lt;/a&gt;         -o-      &lt;a \
&gt; &gt; href="http://www.flickr.com/photos/dberrange/" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://www.flickr.com/photos/dberrange/&lt;/a&gt; :|&lt;br \
&gt; &gt; class="gmail_msg"&gt;
&gt; &gt; &lt;a href="http://libvirt.org" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://libvirt.org&lt;/a&gt;                     -o-                    \
&gt; &gt; &lt;a href="http://virt-manager.org" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://virt-manager.org&lt;/a&gt; :|&lt;br class="gmail_msg"&gt;
&gt; &gt; &lt;a href="http://entangle-photo.org" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://entangle-photo.org&lt;/a&gt;           -o-      &lt;a \
&gt; &gt; href="http://search.cpan.org/~danberr/" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://search.cpan.org/~danberr/&lt;/a&gt; :|&lt;br class="gmail_msg"&gt;
&lt;/blockquote&gt;&lt;/div&gt;



</body></email><email><emailId>20170405091044</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-04-05 09:10:44-0400</timestampReceived><subject>Re: [libvirt-users] creating a lxc image to be used with libvirt-lxc</subject><body>

On Tue, Apr 04, 2017 at 05:20:19PM +0000, Spike wrote:
&gt; ok, thank you Daniel, that helps, I'll see if I can adapt it to other OS
&gt; and figure out the docker style stuff, it would be useful to run a few
&gt; things I have in mind.
&gt; 
&gt; Btw, Daniel, have you ever tried to run libvirt inside a container? I was
&gt; trying to do so to test things since I didn't want to get all the stuff
&gt; installed on the host, but I got a whole bunch of errors and virt-manager
&gt; would not connect no matter what.

You can run libvirt inside a container - I've done that the same reasons
as you when i wanted to test stuff without messing up my host. It sounds
like you were trying to connect using a virt-manager outside the container,
talking to libvirtd inside the container.

This gets more complicated - virt-manager connects over a UNIX domain
socket at /var/run/libvirt by default. If you're running libvirtd inside
a container, then the /var/run seen by libvirtd will be in the container
filesystem, while the /var/run seen by virt-manager will be the host
filesystem. You'd need to figure out a way for the /var/run/libvirt/libvirt-sock
in the container to be exposed to virt-manager in the host.

Alternatively you would have to make libvirtd listen on a TCP address and
connect over TCP with suitable auth.


Regards,
Daniel
-- 
|: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
|: http://libvirt.org              -o-             http://virt-manager.org :|
|: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|

</body></email><email><emailId>20170403091142</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-04-03 09:11:42-0400</timestampReceived><subject>Re: [libvirt-users] libvirt-lxc: good for production?</subject><body>

On 04/03/2017 04:02 AM, Spike wrote:
&gt; Dear all,
&gt;
&gt; I'm a happy lxc (lxd) user with a need to add a bunch of KVM images to the
&gt; mix. More importantly I need to have some simple frontend to give users the
&gt; ability to quickly run some VMs for testing.
&gt;
&gt; Researching the topic brought me to virt-manager and from there libvirt.
&gt; I've had however a hard time to answer a few questions that I hope this
&gt; list can help me with:
&gt;
&gt; 1) is the libvirt-lxc driver actively developed? there's been a lot of
&gt; upgrades to lxc and there seems to be relatively little activity on the lxc
&gt; driver

Yes it is. I don't know what are the features that lxc-tools introduced 
and looking into their news files it seems like they are mostly fixing 
bugs rather than introducing new functionality. Moreover, lxc-tools come 
with some infrastructure (e.g. prepared images for containers). Libvirt 
doesn't have those.

&gt; 2) is libvirt-lxc to be used in production to begin with? every single
&gt; guide I found about libvirt pretty much points to KVM usage, with simple
&gt; /bin/sh examples with lxc.  Furthermore stuff like virt-install seems to be
&gt; exclusively catered to full os/KVM images creation, with no obvious way to
&gt; create a container image.

That's because KVM (well, qemu) is our most intense developed driver. 
But LXC gets some attention too. I think it is production ready and if 
you give it some testing you'll find the same.

Michal

</body></email><email><emailId>20170403084106</emailId><senderName>Daniel Pocock</senderName><senderEmail>daniel@pocock.pro</senderEmail><timestampReceived>2017-04-03 08:41:06-0400</timestampReceived><subject>Re: [libvirt-users] migrated RHEL7/CentsOS7 VMs fail to boot</subject><body>



On 20/03/17 15:02, Martin Kletzander wrote:
&gt; On Mon, Mar 20, 2017 at 10:18:35AM +0100, Daniel Pocock wrote:
&gt;&gt; 
&gt;&gt; I migrated a CentOS7 VM (the fedrtc.org site) from an XCP
&gt;&gt; environment to a libvirt/KVM environment.
&gt;&gt; 
&gt;&gt; This involved using qemu-img to convert the image from VHD to
&gt;&gt; qcow2 and then using virt-install --import to define the VM in
&gt;&gt; libvirt.
&gt;&gt; 
&gt; 
&gt; I have little to no idea how to help with the rest, but have you
&gt; tried using virt-v2v for the switch?  It could help you a lot with
&gt; some of these things.  I hope your use case is supported, I haven't
&gt; really had many use cases for if myself.
&gt; 

All my test migrations had worked successfully with "virt-install
--import ..." so I never looked into virt-v2v.  Thanks for pointing
this out though.

Nonetheless, is there a reason the RHEL/CentOS VM requires the dracut
command to be run but the Debian/Ubuntu VMs don't need
update-initramfs to be run?  Should I open a bug or feature request
against dracut to make this easier, or has it been discussed previously?

Regards,

Daniel

</body></email><email><emailId>20170403091529</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-04-03 09:15:29-0400</timestampReceived><subject>Re: [libvirt-users] (Live) Migration safe vs. unsafe</subject><body>

On 04/03/2017 10:07 AM, Michael Hierweck wrote:
&gt; Hi all,
&gt;
&gt; virsh checks whether a (live) migration is safe or unsafe. When a
&gt; migration is considered to be unsafe it is rejected unless the --unsafe
&gt; option is prodivided.
&gt;
&gt; As a part of those checks virsh considers the cache settings for the
&gt; underlying storage resources. In this context only cache="none" is
&gt; considered to be safe.
&gt;
&gt; I wonder why cache="directsync" might be harmfull as it bypasses the
&gt; host page cache completely.

That's a good question. I too think it isn't harmful. Maybe it's a bug 
in our code?

Michal

</body></email><email><emailId>20170403171601</emailId><senderName>Spike</senderName><senderEmail>spike@drba.org</senderEmail><timestampReceived>2017-04-03 17:16:01-0400</timestampReceived><subject>Re: [libvirt-users] libvirt-lxc: good for production?</subject><body>

thank you Michal, appreciate your input, I'll invest some more time and set
up a full test system mirroring our prod and see how it works out. I'm
gonna start another thread on images/templates because that's another area
where I've found a lack of information and could do with some input. thanks.

Spike

On Mon, Apr 3, 2017 at 2:11 AM Michal Privoznik &lt;mprivozn@redhat.com&gt; wrote:

&gt; On 04/03/2017 04:02 AM, Spike wrote:
&gt; &gt; Dear all,
&gt; &gt;
&gt; &gt; I'm a happy lxc (lxd) user with a need to add a bunch of KVM images to
&gt; the
&gt; &gt; mix. More importantly I need to have some simple frontend to give users
&gt; the
&gt; &gt; ability to quickly run some VMs for testing.
&gt; &gt;
&gt; &gt; Researching the topic brought me to virt-manager and from there libvirt.
&gt; &gt; I've had however a hard time to answer a few questions that I hope this
&gt; &gt; list can help me with:
&gt; &gt;
&gt; &gt; 1) is the libvirt-lxc driver actively developed? there's been a lot of
&gt; &gt; upgrades to lxc and there seems to be relatively little activity on the
&gt; lxc
&gt; &gt; driver
&gt;
&gt; Yes it is. I don't know what are the features that lxc-tools introduced
&gt; and looking into their news files it seems like they are mostly fixing
&gt; bugs rather than introducing new functionality. Moreover, lxc-tools come
&gt; with some infrastructure (e.g. prepared images for containers). Libvirt
&gt; doesn't have those.
&gt;
&gt; &gt; 2) is libvirt-lxc to be used in production to begin with? every single
&gt; &gt; guide I found about libvirt pretty much points to KVM usage, with simple
&gt; &gt; /bin/sh examples with lxc.  Furthermore stuff like virt-install seems to
&gt; be
&gt; &gt; exclusively catered to full os/KVM images creation, with no obvious way
&gt; to
&gt; &gt; create a container image.
&gt;
&gt; That's because KVM (well, qemu) is our most intense developed driver.
&gt; But LXC gets some attention too. I think it is production ready and if
&gt; you give it some testing you'll find the same.
&gt;
&gt; Michal
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;thank you Michal, appreciate your input, I'll invest some more \
time and set up a full test system mirroring our prod and see how it works out. \
I'm gonna start another thread on images/templates because that's another \
area where I've found a lack of information and could do with some input. \
thanks.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Spike&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;&lt;div \
dir="ltr"&gt;On Mon, Apr 3, 2017 at 2:11 AM Michal Privoznik &lt;&lt;a \
href="mailto:mprivozn@redhat.com"&gt;mprivozn@redhat.com&lt;/a&gt;&gt; \
wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;On 04/03/2017 04:02 AM, Spike \
wrote:&lt;br class="gmail_msg"&gt; &gt; Dear all,&lt;br class="gmail_msg"&gt;
&gt;&lt;br class="gmail_msg"&gt;
&gt; I'm a happy lxc (lxd) user with a need to add a bunch of KVM images to \
the&lt;br class="gmail_msg"&gt; &gt; mix. More importantly I need to have some simple \
frontend to give users the&lt;br class="gmail_msg"&gt; &gt; ability to quickly run some VMs \
for testing.&lt;br class="gmail_msg"&gt; &gt;&lt;br class="gmail_msg"&gt;
&gt; Researching the topic brought me to virt-manager and from there libvirt.&lt;br \
class="gmail_msg"&gt; &gt; I've had however a hard time to answer a few questions \
that I hope this&lt;br class="gmail_msg"&gt; &gt; list can help me with:&lt;br \
class="gmail_msg"&gt; &gt;&lt;br class="gmail_msg"&gt;
&gt; 1) is the libvirt-lxc driver actively developed? there's been a lot of&lt;br \
class="gmail_msg"&gt; &gt; upgrades to lxc and there seems to be relatively little \
activity on the lxc&lt;br class="gmail_msg"&gt; &gt; driver&lt;br class="gmail_msg"&gt;
&lt;br class="gmail_msg"&gt;
Yes it is. I don't know what are the features that lxc-tools introduced&lt;br \
class="gmail_msg"&gt; and looking into their news files it seems like they are mostly \
fixing&lt;br class="gmail_msg"&gt; bugs rather than introducing new functionality. \
Moreover, lxc-tools come&lt;br class="gmail_msg"&gt; with some infrastructure (e.g. \
prepared images for containers). Libvirt&lt;br class="gmail_msg"&gt; doesn't have \
those.&lt;br class="gmail_msg"&gt; &lt;br class="gmail_msg"&gt;
&gt; 2) is libvirt-lxc to be used in production to begin with? every single&lt;br \
class="gmail_msg"&gt; &gt; guide I found about libvirt pretty much points to KVM usage, \
with simple&lt;br class="gmail_msg"&gt; &gt; /bin/sh examples with lxc.   Furthermore stuff \
like virt-install seems to be&lt;br class="gmail_msg"&gt; &gt; exclusively catered to full \
os/KVM images creation, with no obvious way to&lt;br class="gmail_msg"&gt; &gt; create a \
container image.&lt;br class="gmail_msg"&gt; &lt;br class="gmail_msg"&gt;
That's because KVM (well, qemu) is our most intense developed driver.&lt;br \
class="gmail_msg"&gt; But LXC gets some attention too. I think it is production ready \
and if&lt;br class="gmail_msg"&gt; you give it some testing you'll find the same.&lt;br \
class="gmail_msg"&gt; &lt;br class="gmail_msg"&gt;
Michal&lt;br class="gmail_msg"&gt;
&lt;/blockquote&gt;&lt;/div&gt;



</body></email><email><emailId>20170405183122</emailId><senderName>Spike</senderName><senderEmail>spike@drba.org</senderEmail><timestampReceived>2017-04-05 18:31:22-0400</timestampReceived><subject>Re: [libvirt-users] creating a lxc image to be used with libvirt-lxc</subject><body>

thank you for your help Daniel. I don't get why virt-manager would see a
different /var/run. My container has an ip/ssh, so when I connect with
qemu+ssh from my desktop I shuould end up in the same "space/filesystem" of
libvirtd, not the host one. And I canc onfirm that because I see the logs
of ssh of virt-manager trying to log in. In any case I will try TLS/TCP,
that's fine with me. I seem to also be having another problem: for some
reason I can't get rid of virbr0 and make libvirt use the existing bridge
in the container, even after changing the default net-define virt-manager
still sees a virbr0 and fails to start a VM.

thanks,

Spike

On Wed, Apr 5, 2017 at 2:10 AM Daniel P. Berrange &lt;berrange@redhat.com&gt;
wrote:

&gt; On Tue, Apr 04, 2017 at 05:20:19PM +0000, Spike wrote:
&gt; &gt; ok, thank you Daniel, that helps, I'll see if I can adapt it to other OS
&gt; &gt; and figure out the docker style stuff, it would be useful to run a few
&gt; &gt; things I have in mind.
&gt; &gt;
&gt; &gt; Btw, Daniel, have you ever tried to run libvirt inside a container? I was
&gt; &gt; trying to do so to test things since I didn't want to get all the stuff
&gt; &gt; installed on the host, but I got a whole bunch of errors and virt-manager
&gt; &gt; would not connect no matter what.
&gt;
&gt; You can run libvirt inside a container - I've done that the same reasons
&gt; as you when i wanted to test stuff without messing up my host. It sounds
&gt; like you were trying to connect using a virt-manager outside the container,
&gt; talking to libvirtd inside the container.
&gt;
&gt; This gets more complicated - virt-manager connects over a UNIX domain
&gt; socket at /var/run/libvirt by default. If you're running libvirtd inside
&gt; a container, then the /var/run seen by libvirtd will be in the container
&gt; filesystem, while the /var/run seen by virt-manager will be the host
&gt; filesystem. You'd need to figure out a way for the
&gt; /var/run/libvirt/libvirt-sock
&gt; in the container to be exposed to virt-manager in the host.
&gt;
&gt; Alternatively you would have to make libvirtd listen on a TCP address and
&gt; connect over TCP with suitable auth.
&gt;
&gt;
&gt; Regards,
&gt; Daniel
&gt; --
&gt; |: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/
&gt; :|
&gt; |: http://libvirt.org              -o-             http://virt-manager.org
&gt; :|
&gt; |: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/
&gt; :|
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;thank you for your help Daniel. I don't get why virt-manager would \
see a different /var/run. My container has an ip/ssh, so when I connect with qemu+ssh \
from my desktop I shuould end up in the same "space/filesystem" of \
libvirtd, not the host one. And I canc onfirm that because I see the logs of ssh of \
virt-manager trying to log in. In any case I will try TLS/TCP, that's fine with \
me. I seem to also be having another problem: for some reason I can't get rid of \
virbr0 and make libvirt use the existing bridge in the container, even after changing \
the default net-define virt-manager still sees a virbr0 and fails to start a \
VM.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;thanks,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Spike&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;&lt;div dir="ltr"&gt;On Wed, Apr 5, 2017 at 2:10 AM Daniel P. Berrange \
&lt;&lt;a href="mailto:berrange@redhat.com"&gt;berrange@redhat.com&lt;/a&gt;&gt; \
wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;On Tue, Apr 04, 2017 at 05:20:19PM \
+0000, Spike wrote:&lt;br class="gmail_msg"&gt; &gt; ok, thank you Daniel, that helps, \
I'll see if I can adapt it to other OS&lt;br class="gmail_msg"&gt; &gt; and figure out \
the docker style stuff, it would be useful to run a few&lt;br class="gmail_msg"&gt; &gt; \
things I have in mind.&lt;br class="gmail_msg"&gt; &gt;&lt;br class="gmail_msg"&gt;
&gt; Btw, Daniel, have you ever tried to run libvirt inside a container? I was&lt;br \
class="gmail_msg"&gt; &gt; trying to do so to test things since I didn't want to get \
all the stuff&lt;br class="gmail_msg"&gt; &gt; installed on the host, but I got a whole \
bunch of errors and virt-manager&lt;br class="gmail_msg"&gt; &gt; would not connect no \
matter what.&lt;br class="gmail_msg"&gt; &lt;br class="gmail_msg"&gt;
You can run libvirt inside a container - I've done that the same reasons&lt;br \
class="gmail_msg"&gt; as you when i wanted to test stuff without messing up my host. It \
sounds&lt;br class="gmail_msg"&gt; like you were trying to connect using a virt-manager \
outside the container,&lt;br class="gmail_msg"&gt; talking to libvirtd inside the \
container.&lt;br class="gmail_msg"&gt; &lt;br class="gmail_msg"&gt;
This gets more complicated - virt-manager connects over a UNIX domain&lt;br \
class="gmail_msg"&gt; socket at /var/run/libvirt by default. If you're running \
libvirtd inside&lt;br class="gmail_msg"&gt; a container, then the /var/run seen by libvirtd \
will be in the container&lt;br class="gmail_msg"&gt; filesystem, while the /var/run seen by \
virt-manager will be the host&lt;br class="gmail_msg"&gt; filesystem. You'd need to \
figure out a way for the /var/run/libvirt/libvirt-sock&lt;br class="gmail_msg"&gt; in the \
container to be exposed to virt-manager in the host.&lt;br class="gmail_msg"&gt; &lt;br \
class="gmail_msg"&gt; Alternatively you would have to make libvirtd listen on a TCP \
address and&lt;br class="gmail_msg"&gt; connect over TCP with suitable auth.&lt;br \
class="gmail_msg"&gt; &lt;br class="gmail_msg"&gt;
&lt;br class="gmail_msg"&gt;
Regards,&lt;br class="gmail_msg"&gt;
Daniel&lt;br class="gmail_msg"&gt;
--&lt;br class="gmail_msg"&gt;
&gt; &gt; &lt;a href="http://berrange.com" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://berrange.com&lt;/a&gt;         -o-      &lt;a \
&gt; &gt; href="http://www.flickr.com/photos/dberrange/" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://www.flickr.com/photos/dberrange/&lt;/a&gt; :|&lt;br \
&gt; &gt; class="gmail_msg"&gt;
&gt; &gt; &lt;a href="http://libvirt.org" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://libvirt.org&lt;/a&gt;                     -o-                    \
&gt; &gt; &lt;a href="http://virt-manager.org" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://virt-manager.org&lt;/a&gt; :|&lt;br class="gmail_msg"&gt;
&gt; &gt; &lt;a href="http://entangle-photo.org" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://entangle-photo.org&lt;/a&gt;           -o-      &lt;a \
&gt; &gt; href="http://search.cpan.org/~danberr/" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://search.cpan.org/~danberr/&lt;/a&gt; :|&lt;br class="gmail_msg"&gt;
&lt;/blockquote&gt;&lt;/div&gt;



</body></email><email><emailId>20170406061022</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-04-06 06:10:22-0400</timestampReceived><subject>Re: [libvirt-users] Cannot save domain</subject><body>

On 04/02/2017 12:05 PM, Tony Arnold wrote:
&gt; I have a domain running a Windows 10 system on an Ubuntu 16.10 host
&gt; system. The domain has 4096MiB of memory. When I try to save the
&gt; domain, or managedsave the domain, I get an error when it's about 96%
&gt; complete. The terminal session looks like this:
&gt;
&gt; virsh # save Windows10 windows10-20170402.save --bypass-cache --verbose
&gt; Save: [ 95 %]error: Failed to save domain Windows10 to windows10-
&gt; 0170402.save
&gt; error: operation failed: domain is not running
&gt;
&gt; It seems the domain closes before the save has completed.
&gt;
&gt; libvirt is at version 2.1.0
&gt;
&gt; Should I submit this as a bug, or is there something I can change to
&gt; fix this?

Is there an error log probably in the debug logs? I mean besides this one.

http://wiki.libvirt.org/page/DebugLogs

Michal

</body></email><email><emailId>20170413072611</emailId><senderName>Marko Weber | 8000</senderName><senderEmail>weber@zbfmail.de</senderEmail><timestampReceived>2017-04-13 07:26:11-0400</timestampReceived><subject>[libvirt-users] Windows Guest Server 2016, bad performance of whole virtualisation system</subject><body>


hello ,
i did a kvm guest with virt-manager and installed windows server 2016.
performance settings for the disk: hypervisor default  for cache &amp; io 
mode

i added a 2nd disk to the guest , also with hypervisor default settings 
on cache &amp; io mode
Under disk settings in windows server 2016 i set "format whole disk 
NTFS"
i did not choose the "quick format" option.

when windows is formatting this 1TB drive the performance on the 
virtualisation host goes down
loging via ssh take ages, top take 2 mins to start up.

the physical disks are connected to a raid controller LSI and FS on 
virtualisation server where the qcow2 files are is XFS.

DO i have to set another options for "performance options" as 
"hypervisor default" to keep the system performant on formatting the 
disk?

thanks for any hints.

marko

-- 
zbfmail - Mittendrin statt nur Datei!

</body></email><email><emailId>20170416103832</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-04-16 10:38:32-0400</timestampReceived><subject>Re: [libvirt-users] Libvirt and libssh2 with openauth</subject><body>

On 04/15/2017 02:16 AM, spiperac wrote:
&gt; Hi all,
&gt;  i have same question as this one
&gt; https://www.redhat.com/archives/libvirt-users/2014-March/msg00158.html. (
&gt; Only im using python)
&gt; Is there any new follow-up on this?

The bug was fixed in the 1.2.21 release. So unless you're using 1.5
years old libvirt you should be all set. Or are you still experiencing
the issue?

Michal

</body></email><email><emailId>20170418174507</emailId><senderName>VHPC 17</senderName><senderEmail>vhpc.dist@gmail.com</senderEmail><timestampReceived>2017-04-18 17:45:07-0400</timestampReceived><subject>[libvirt-users] VHPC at ISC extension - Papers due May 2</subject><body>

====================================================================

CALL FOR PAPERS


12th Workshop on Virtualization in High ­-Performance Cloud Computing  (VHPC
'17)

held in conjunction with the International Supercomputing Conference - High
Performance,

June 18-22, 2017, Frankfurt, Germany.

(Springer LNCS Proceedings)

====================================================================

Date: June 22, 2017

Workshop URL: http://vhpc.org

Paper Submission Deadline: May 2, 2017 (extended), Springer LNCS, rolling
abstract submission

Abstract/Paper Submission Link: https://edas.info/newPaper.php?c=23179

Keynotes:

Satoshi Matsuoka, Professor of Computer Science, Tokyo Institute of
Technology and

John Goodacre, Professor in Computer Architectures University of
Manchester, Director of Technology and Systems ARM Ltd. Research Group and
Chief Scientific Officer Kaleao Ltd.



Call for Papers

Virtualization technologies constitute a key enabling factor for flexible
resource management

in modern data centers, and particularly in cloud environments. Cloud
providers need to

manage complex infrastructures in a seamless fashion to support the highly
dynamic and

heterogeneous workloads and hosted applications customers deploy.
Similarly, HPC

environments have been increasingly adopting techniques that enable
flexible management of vast computing and networking resources, close to
marginal provisioning cost, which is

unprecedented in the history of scientific and commercial computing.

Various virtualization technologies contribute to the overall picture in
different ways: machine

virtualization, with its capability to enable consolidation of multiple
under ­utilized servers with

heterogeneous software and operating systems (OSes), and its capability to
live ­-migrate a

fully operating virtual machine (VM) with a very short downtime, enables
novel and dynamic

ways to manage physical servers; OS- ­level virtualization (i.e.,
containerization), with its

capability to isolate multiple user ­-space environments and to allow for
their co ­existence within

the same OS kernel, promises to provide many of the advantages of machine
virtualization

with high levels of responsiveness and performance; I/O Virtualization
allows physical

NICs/HBAs to take traffic from multiple VMs or containers; network
virtualization, with its

capability to create logical network overlays that are independent of the
underlying physical

topology and IP addressing, provides the fundamental ground on top of which
evolved

network services can be realized with an unprecedented level of dynamicity
and flexibility; the

increasingly adopted paradigm of Software- ­Defined Networking (SDN)
 promises to extend

this flexibility to the control and data planes of network paths.

Publication

Accepted papers will be published in a Springer LNCS proceedings volume.


Topics of Interest

The VHPC program committee solicits original, high-quality submissions
related to

virtualization across the entire software stack with a special focus on the
intersection of HPC

and the cloud.

Major Topics

- Virtualization in supercomputing environments, HPC clusters, HPC in the
cloud and grids
- OS-level virtualization and containers (Docker, rkt, Singularity,
Shifter, i.a.)
- Lightweight/specialized operating systems, unikernels
- Optimizations of virtual machine monitor platforms and hypervisors
- Hypervisor support for heterogenous resources (GPUs, co-processors,
FPGAs, etc.)
- Virtualization support for emerging memory technologies

- Virtualization in enterprise HPC and microvisors
- Software defined networks and network virtualization
- Management, deployment of virtualized environments and orchestration
(Kubernetes i.a.),
- Workflow-pipeline container-based composability
- Performance measurement, modelling and monitoring of virtualized/cloud
workloads
- Virtualization in data intensive computing and Big Data processing - HPC
convergence
- Adaptation of HPC technologies in the cloud (high performance networks,
RDMA, etc.)

- ARM-based hypervisors, ARM virtualization extensions
- I/O virtualization and cloud based storage systems

- GPU, FPGA and many-core accelerator virtualization
- Job scheduling/control/policy and container placement in virtualized
environments
- Cloud reliability, fault-tolerance and high-availability
- QoS and SLA in virtualized environments
- IaaS platforms, cloud frameworks and APIs

- Large-scale virtualization in domains such as finance and government
- Energy-efficient and power-aware virtualization

- Container security

- Configuration management tools for containers (including CFEngine,
Puppet, i.a.)

- Emerging topics including multi-kernel approaches and,NUMA in hypervisors




The Workshop on Virtualization in High ­-Performance Cloud Computing (VHPC)
aims to

bring together researchers and industrial practitioners facing the
challenges

posed by virtualization in order to foster discussion, collaboration,
mutual exchange

of knowledge and experience, enabling research to ultimately provide novel

solutions for virtualized computing systems of tomorrow.

The workshop will be one day in length, composed of 20 min paper
presentations, each

followed by 10 min discussion sections, plus lightning talks that are
limited to 5 minutes.

Presentations may be accompanied by interactive demonstrations.

Important Dates

Rolling Abstract Submission

May 2, 2017 - Paper submission deadline (extended)

May 30, 2017 - Acceptance notification

June 22, 2017 - Workshop Day

July 18, 2017 - Camera-ready version due


Chair

Michael Alexander (chair), scaledinfra technologies, Austria

Anastassios Nanos (co- ­chair), NTUA, Greece

Balazs Gerofi (co- ­chair), â€‹RIKEN Advanced Institute for Computational
Scienceâ€‹, Japan


Program committee

Stergios Anastasiadis, University of Ioannina, Greece

Jakob Blomer, CERN, Europe

Ron Brightwell, Sandia National Laboratories, USA

Eduardo CÃ©sar, Universidad Autonoma de Barcelona, Spain

Julian Chesterfield, OnApp, UK

Stephen Crago, USC ISI, USA

Christoffer Dall, Columbia University, USA

Patrick Dreher, MIT, USA

Robert Futrick, Cycle Computing, USA

Maria Girone, CERN, Europe

Kyle Hale, Northwestern University, USA

Romeo Kinzler, IBM, Switzerland

Brian Kocoloski, University of Pittsburgh, USA

Nectarios Koziris, National Technical University of Athens, Greece

John Lange, University of Pittsburgh, USA

Che-Rung Lee, National Tsing Hua University, Taiwan

Giuseppe Lettieri, University of Pisa, Italy

Qing Liu, Oak Ridge National Laboratory, USA

Nikos Parlavantzas, IRISA, France

Kevin Pedretti, Sandia National Laboratories, USA

Amer Qouneh, University of Florida, USA

Carlos ReaÃ±o, Technical University of Valencia, Spain

Thomas Ryd, CFEngine, Norway

Na Zhang, VMWare, USA

Borja Sotomayor, University of Chicago, USA

Craig Stewart, Indiana University, USA

Anata Tiwari, San Diego Supercomputer Center, USA

Kurt Tutschku, Blekinge Institute of Technology, Sweden

Yasuhiro Watashiba, Osaka University, Japan

Nicholas Wright, Lawrence Berkeley National Laboratory, USA

Chao-Tung Yang, Tunghai University, Taiwan


Paper Submission-Publication

Papers submitted to the workshop will be reviewed by at least two

members of the program committee and external reviewers. Submissions

should include abstract, key words, the e-mail address of the

corresponding author, and must not exceed 10 pages, including tables

and figures at a main font size no smaller than 11 point. Submission

of a paper should be regarded as a commitment that, should the paper

be accepted, at least one of the authors will register and attend the

conference to present the work. Accepted papers will be published in a

Springer LNCS volume. .

The format must be according to the Springer LNCS Style. Initial

submissions are in PDF; authors of accepted papers will be requested

to provide source files.

Format Guidelines:

ftp://ftp.springer.de/pub/tex/latex/llncs/latex2e/llncs2e.zip

Abstract, Paper Submission Link:

https://edas.info/newPaper.php?c=23179



Lightning Talks

Lightning Talks are non-paper track, synoptical in nature and are strictly
limited to 5 minutes.

They can be used to gain early feedback on ongoing research, for
demonstrations, to present research results, early research ideas,
perspectives and positions of interest to the community. Submit abstract
via the main submission link.


General Information

The workshop is one day in length and will be held in conjunction with the
International

Supercomputing Conference - High Performance (ISC) 2017, June 18-22,
Frankfurt,

Germany.

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;span \
id="gmail-docs-internal-guid-d69b397b-8224-f8dd-c779-896839f61f30"&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;color:rgb(0,0,0);background-color:transparent; \
font-variant-ligatures:normal;font-variant-east-asian:normal;vertical-align:baseline;w \
hite-space:pre-wrap"&gt;====================================================================&lt;/span&gt;&lt;/p&gt;&lt;p \
dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;color:rgb(0,0,0);background-color:transparent; \
font-variant-ligatures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;CALL \
FOR PAPERS &lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;br&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;color:rgb(0,0,0);background-color:transparent; \
font-weight:700;font-variant-ligatures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;12th \
Workshop on Virtualization in High ­-Performance Cloud Computing   (VHPC \
'17)&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;color:rgb(0,0,0);background-color:transparent; \
font-variant-ligatures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;held \
in conjunction with the International Supercomputing Conference - High \
Performance,&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;color:rgb(0,0,0);background-color:transparent; \
font-variant-ligatures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;June \
18-22, 2017, Frankfurt, Germany.&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;color:rgb(0,0,0);background-color:transparent; \
font-variant-ligatures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;(Springer \
LNCS Proceedings) &lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;color:rgb(0,0,0);background-color:transparent; \
font-variant-ligatures:normal;font-variant-east-asian:normal;vertical-align:baseline;w \
hite-space:pre-wrap"&gt;====================================================================&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p \
dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;color:rgb(0,0,0);background-color:transparent; \
font-variant-ligatures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;Date: \
June 22, 2017&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;color:rgb(0,0,0);background-color:transparent; \
font-variant-ligatures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;Workshop \
URL: &lt;a href="http://vhpc.org"&gt;http://vhpc.org&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;color:rgb(0,0,0);background-color:transparent; \
font-variant-ligatures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;Paper \
Submission Deadline: May 2, 2017 (extended), Springer LNCS, rolling abstract \
submission&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;color:rgb(0,0,0);background-color:transparent; \
font-variant-ligatures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;Abstract/Paper \
Submission Link: &lt;a href="https://edas.info/newPaper.php?c=23179"&gt;https://edas.info/newPaper.php?c=23179&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p \
dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;color:rgb(0,0,0);background-color:transparent; \
font-variant-ligatures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;Keynotes: \
&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;color:rgb(0,0,0);background-color:transparent; \
font-variant-ligatures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;Satoshi \
Matsuoka, Professor of Computer Science, Tokyo Institute of Technology \
and&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;color:rgb(0,0,0);background-color:transparent; \
font-variant-ligatures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;John \
Goodacre, Professor in Computer Architectures University of Manchester, Director of \
Technology and Systems ARM Ltd. Research Group and Chief Scientific Officer Kaleao \
Ltd.&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;color:rgb(0,0,0);background-color:transparent; \
font-weight:700;font-variant-ligatures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;Call \
for Papers&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;Virtualization \
technologies constitute a key enabling factor for flexible resource \
management&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;in \
modern data centers, and particularly in cloud environments. Cloud providers need \
to&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;manage \
complex infrastructures in a seamless fashion to support the highly dynamic \
and&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;heterogeneous \
workloads and hosted applications customers deploy. Similarly, HPC&lt;/span&gt;&lt;/p&gt;&lt;p \
dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;environments \
have been increasingly adopting techniques that enable flexible management of vast \
computing and networking resources, close to marginal provisioning cost, which \
is&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;unprecedented \
in the history of scientific and commercial computing.&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;Various \
virtualization technologies contribute to the overall picture in different ways: \
machine&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;virtualization, \
with its capability to enable consolidation of multiple under ­utilized servers \
with&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;heterogeneous \
software and operating systems (OSes), and its capability to live ­-migrate \
a&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;fully \
operating virtual machine (VM) with a very short downtime, enables novel and \
dynamic&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;ways \
to manage physical servers; OS- ­level virtualization (i.e., containerization), with \
its&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;capability \
to isolate multiple user ­-space environments and to allow for their co ­existence \
within&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;the \
same OS kernel, promises to provide many of the advantages of machine \
virtualization&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;with \
high levels of responsiveness and performance; I/O Virtualization allows \
physical&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;NICs/HBAs \
to take traffic from multiple VMs or containers; network virtualization, with \
its&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;capability \
to create logical network overlays that are independent of the underlying \
physical&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;topology \
and IP addressing, provides the fundamental ground on top of which \
evolved&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;network \
services can be realized with an unprecedented level of dynamicity and flexibility; \
the&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;increasingly \
adopted paradigm of Software- ­Defined Networking (SDN)   promises to \
extend&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;this \
flexibility to the control and data planes of network paths. &lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p \
dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-weight:700;f \
ont-variant-ligatures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;Publication&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p \
dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;Accepted \
papers will be published in a Springer LNCS proceedings volume.&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;br&gt;&lt;p \
dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-weight:700;f \
ont-variant-ligatures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;Topics \
of Interest&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;The \
VHPC program committee solicits original, high-quality submissions related \
to&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;virtualization \
across the entire software stack with a special focus on the intersection of \
HPC&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;and \
the cloud.&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;Major \
Topics&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:11pt;font-family:arial;background-color:transparent;font-variant-liga \
tures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;- \
Virtualization in supercomputing environments, HPC clusters, HPC in the cloud and \
grids&lt;/span&gt;&lt;span style="font-size:11pt;font-family:arial;background-color:transparent \
;font-variant-ligatures:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap"&gt;&lt;br \
class="gmail-kix-line-break"&gt;&lt;/span&gt;&lt;span \



</body></email><email><emailId>20170420091849</emailId><senderName>mailing lists</senderName><senderEmail>listas.correo@yahoo.es</senderEmail><timestampReceived>2017-04-20 09:18:49-0400</timestampReceived><subject>Re: [libvirt-users] understanding --idmap for containers (v2.5.0)</subject><body>

On Thursday, April 20, 2017 10:44 AM, Daniel P. Berrange &lt;berrange@redhat.com&gt; \
wrote:

&gt; &gt; indeed the container is using the idmap feature because the
&gt; &gt; efective uid/gid map (900/900) is not allowing writes in the
&gt; &gt; filesystem, but it doesn't seems very usefull.
&gt; &gt; 
&gt; &gt; is it possible to have read/write containers while using idmap?
&gt; 
&gt; You need to change the UIDs in your container's filesystem to be
&gt; offset by 900

yes, that was my first thought but I was unsure if it was the correct way. 

running these commands did the trick (not all files are root:root):

# find /media/containers/lab-gentoo-01 -uid 0 -exec chown --no-dereference 900 -- {}  \
\;# find /media/containers/lab-gentoo-01 -gid 0 -exec chgrp --no-dereference 900 -- \
{}   \; # ls -l /media/containers/lab-gentoo-01/
total 36
-rw-r--r--   1 900 900       0 Apr 20 11:16 a
drwxr-xr-x   2 900 900 4096 Apr 13 07:33 bin
drwxr-xr-x   2 900 900     18 Apr 13 03:28 boot
drwxr-xr-x   7 900 900 4096 Apr 18 12:45 dev
drwxr-xr-x 31 900 900 4096 Apr 18 12:49 etc
drwxr-xr-x   2 900 900     18 Apr 13 03:28 home
lrwxrwxrwx   1 900 900       5 Apr 13 06:13 lib -&gt; lib64
drwxr-xr-x   2 900 900 4096 Apr 13 06:14 lib32
drwxr-xr-x   9 900 900 4096 Apr 13 07:33 lib64
drwxr-xr-x   2 900 900     18 Apr 13 03:28 media
drwxr-xr-x   2 900 900     18 Apr 13 03:28 mnt
drwxr-xr-x   2 900 900     18 Apr 13 03:28 opt
drwxr-xr-x   2 900 900       6 Apr 13 03:18 proc
drwx------   2 900 900     18 Apr 13 03:28 root
drwxr-xr-x   2 900 900     31 Apr 13 07:32 run
drwxr-xr-x   2 900 900 4096 Apr 13 07:36 sbin
drwxr-xr-x   2 900 900     18 Apr 13 03:28 sys
drwxrwxrwt   2 900 900     18 Apr 13 07:36 tmp
drwxr-xr-x 13 900 900 4096 Apr 18 12:49 usr
drwxr-xr-x   9 900 900   102 Apr 13 03:28 var


# virsh --connect lxc:/// start --console lab-gentoo-01
Domain lab-gentoo-01 started
Connected to domain lab-gentoo-01
Escape character is ^]
sh-4.3# /usr/bin/id
uid=0(root) gid=0(root) groups=0(root)sh-4.3# pwd
/
sh-4.3# ls -la
total 40
drwxr-xr-x   21 root     root     4096 Apr 20 10:36 .
drwxr-xr-x   21 root     root     4096 Apr 20 10:36 ..
-rw-------     1 root     root         45 Apr 20 11:15 .bash_history
drwxr-xr-x     2 root     root           6 Apr 18 13:41 .oldroot
drwxr-xr-x     2 root     root     4096 Apr 13 07:33 bin
drwxr-xr-x     2 root     root         18 Apr 13 03:28 boot
drwxr-xr-x     3 root     root       320 Apr 20 11:15 dev
drwxr-xr-x   31 root     root     4096 Apr 18 12:49 etc
drwxr-xr-x     2 root     root         18 Apr 13 03:28 home
lrwxrwxrwx     1 root     root           5 Apr 13 06:13 lib -&gt; lib64
drwxr-xr-x     2 root     root     4096 Apr 13 06:14 lib32
drwxr-xr-x     9 root     root     4096 Apr 13 07:33 lib64
drwxr-xr-x     2 root     root         18 Apr 13 03:28 media
drwxr-xr-x     2 root     root         18 Apr 13 03:28 mnt
drwxr-xr-x     2 root     root         18 Apr 13 03:28 opt
dr-xr-xr-x 249 nobody nobody       0 Apr 20 11:15 proc
drwx------     2 root     root         18 Apr 13 03:28 root
drwxr-xr-x     2 root     root         31 Apr 13 07:32 run
drwxr-xr-x     2 root     root     4096 Apr 13 07:36 sbin
dr-xr-xr-x   12 nobody nobody       0 Mar 24 23:11 sys
drwxrwxrwt     2 root     root         18 Apr 13 07:36 tmp
drwxr-xr-x   13 root     root     4096 Apr 18 12:49 usr
drwxr-xr-x     9 root     root       102 Apr 13 03:28 var
sh-4.3# touch asdfsh-4.3#

Thank you Daniel !!



   


[Attachment #3 (text/html)]

&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;div style="color:#000; background-color:#fff; \
font-family:Helvetica Neue, Helvetica, Arial, Lucida Grande, \
sans-serif;font-size:16px"&gt;&lt;div&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt; &lt;div class="qtdSeparateBR" \
id="yui_3_16_0_ym19_1_1492678184081_10726"&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="yahoo_quoted" \
id="yui_3_16_0_ym19_1_1492678184081_6057" style="display: block;"&gt; &lt;div \
style="font-family: Helvetica Neue, Helvetica, Arial, Lucida Grande, sans-serif; \
font-size: 16px;" id="yui_3_16_0_ym19_1_1492678184081_6056"&gt; &lt;div style="font-family: \
HelveticaNeue, Helvetica Neue, Helvetica, Arial, Lucida Grande, sans-serif; \
font-size: 16px;" id="yui_3_16_0_ym19_1_1492678184081_6055"&gt; &lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1492678184081_6058"&gt;&lt;font size="2" face="Arial"&gt; On Thursday, \
April 20, 2017 10:44 AM, Daniel P. Berrange &lt;berrange@redhat.com&gt; \
wrote:&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;br clear="none"&gt;&lt;div class="y_msg_container" \
id="yui_3_16_0_ym19_1_1492678184081_6054"&gt;&gt; &gt; indeed the container is using the \
idmap feature because the&lt;br clear="none"&gt;&gt; &gt; efective uid/gid map (900/900) is \
not allowing writes in the&lt;br clear="none"&gt;&gt; &gt; filesystem, but it doesn't seems \
very usefull.&lt;br clear="none"&gt;&gt; &gt; &lt;br clear="none"&gt;&gt; &gt; is it possible to \
have read/write containers while using idmap?&lt;br clear="none"&gt;&gt; &lt;br \
clear="none"&gt;&gt; You need to change the UIDs in your container's filesystem to be&lt;br \
clear="none"&gt;&gt; offset by 900&lt;br clear="none"&gt;&lt;br clear="none"&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1492678184081_6104"&gt;yes, that was my first thought but I was \
unsure if it was the correct way. &lt;br&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1492678184081_12559"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1492678184081_12560"&gt;running these commands did the trick (not \
all files are root:root):&lt;br&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1492678184081_24341"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1492678184081_12561"&gt;# find /media/containers/lab-gentoo-01 \
-uid 0 -exec chown --no-dereference 900 -- {}  \;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1492678184081_24308"&gt;# find /media/containers/lab-gentoo-01 \
-gid 0 -exec chgrp --no-dereference 900 -- {}  \;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1492678184081_28038"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1492678184081_35044"&gt;# ls -l \
/media/containers/lab-gentoo-01/&lt;br id="yui_3_16_0_ym19_1_1492678184081_36777"&gt;total \
36&lt;br id="yui_3_16_0_ym19_1_1492678184081_36778"&gt;-rw-r--r--  1 900 \
900    0 Apr 20 11:16 a&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_36779"&gt;drwxr-xr-x  2 900 900 4096 Apr 13 \
07:33 bin&lt;br id="yui_3_16_0_ym19_1_1492678184081_36780"&gt;drwxr-xr-x  2 900 \
900   18 Apr 13 03:28 boot&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_36781"&gt;drwxr-xr-x  7 900 900 4096 Apr 18 \
12:45 dev&lt;br id="yui_3_16_0_ym19_1_1492678184081_36782"&gt;drwxr-xr-x 31 900 900 4096 \
Apr 18 12:49 etc&lt;br id="yui_3_16_0_ym19_1_1492678184081_36783"&gt;drwxr-xr-x  2 900 \
900   18 Apr 13 03:28 home&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_36784"&gt;lrwxrwxrwx  1 900 \
900    5 Apr 13 06:13 lib -&gt; lib64&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_36785"&gt;drwxr-xr-x  2 900 900 4096 Apr 13 \
06:14 lib32&lt;br id="yui_3_16_0_ym19_1_1492678184081_36786"&gt;drwxr-xr-x  9 900 900 \
4096 Apr 13 07:33 lib64&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_36787"&gt;drwxr-xr-x  2 900 900   18 \
Apr 13 03:28 media&lt;br id="yui_3_16_0_ym19_1_1492678184081_36788"&gt;drwxr-xr-x  2 \
900 900   18 Apr 13 03:28 mnt&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_36789"&gt;drwxr-xr-x  2 900 900   18 \
Apr 13 03:28 opt&lt;br id="yui_3_16_0_ym19_1_1492678184081_36790"&gt;drwxr-xr-x  2 900 \
900    6 Apr 13 03:18 proc&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_36791"&gt;drwx------  2 900 900   18 \
Apr 13 03:28 root&lt;br id="yui_3_16_0_ym19_1_1492678184081_36792"&gt;drwxr-xr-x  2 \
900 900   31 Apr 13 07:32 run&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_36793"&gt;drwxr-xr-x  2 900 900 4096 Apr 13 \
07:36 sbin&lt;br id="yui_3_16_0_ym19_1_1492678184081_36794"&gt;drwxr-xr-x  2 900 \
900   18 Apr 13 03:28 sys&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_36795"&gt;drwxrwxrwt  2 900 900   18 \
Apr 13 07:36 tmp&lt;br id="yui_3_16_0_ym19_1_1492678184081_36796"&gt;drwxr-xr-x 13 900 900 \
4096 Apr 18 12:49 usr&lt;br id="yui_3_16_0_ym19_1_1492678184081_36797"&gt;drwxr-xr-x  \
9 900 900  102 Apr 13 03:28 var&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_36798"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="ltr"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
dir="ltr" id="yui_3_16_0_ym19_1_1492678184081_28039"&gt;# virsh --connect lxc:/// start \
--console lab-gentoo-01&lt;br id="yui_3_16_0_ym19_1_1492678184081_30035"&gt;Domain \
lab-gentoo-01 started&lt;br id="yui_3_16_0_ym19_1_1492678184081_30036"&gt;Connected to \
domain lab-gentoo-01&lt;br id="yui_3_16_0_ym19_1_1492678184081_30037"&gt;Escape character \
is ^]&lt;br id="yui_3_16_0_ym19_1_1492678184081_30038"&gt;sh-4.3# /usr/bin/id&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30039"&gt;uid=0(root) gid=0(root) \
groups=0(root)&lt;/div&gt;&lt;div dir="ltr" id="yui_3_16_0_ym19_1_1492678184081_38496"&gt;sh-4.3# \
pwd&lt;br id="yui_3_16_0_ym19_1_1492678184081_38506"&gt;/&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_38507"&gt;sh-4.3# ls -la&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30041"&gt;total 40&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30042"&gt;drwxr-xr-x  21 root   \
root   4096 Apr 20 10:36 .&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30043"&gt;drwxr-xr-x  21 root   \
root   4096 Apr 20 10:36 ..&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30044"&gt;-rw-------   1 root   \
root     45 Apr 20 11:15 .bash_history&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30045"&gt;drwxr-xr-x   2 root   \
root      6 Apr 18 13:41 .oldroot&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30046"&gt;drwxr-xr-x   2 root   \
root   4096 Apr 13 07:33 bin&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30047"&gt;drwxr-xr-x   2 root   \
root     18 Apr 13 03:28 boot&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30048"&gt;drwxr-xr-x   3 root   \
root    320 Apr 20 11:15 dev&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30049"&gt;drwxr-xr-x  31 root   \
root   4096 Apr 18 12:49 etc&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30050"&gt;drwxr-xr-x   2 root   \
root     18 Apr 13 03:28 home&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30051"&gt;lrwxrwxrwx   1 root   \
root      5 Apr 13 06:13 lib -&gt; lib64&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30052"&gt;drwxr-xr-x   2 root   \
root   4096 Apr 13 06:14 lib32&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30053"&gt;drwxr-xr-x   9 root   \
root   4096 Apr 13 07:33 lib64&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30054"&gt;drwxr-xr-x   2 root   \
root     18 Apr 13 03:28 media&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30055"&gt;drwxr-xr-x   2 root   \
root     18 Apr 13 03:28 mnt&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30056"&gt;drwxr-xr-x   2 root   \
root     18 Apr 13 03:28 opt&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30057"&gt;dr-xr-xr-x 249 nobody \
nobody    0 Apr 20 11:15 proc&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30058"&gt;drwx------   2 root   \
root     18 Apr 13 03:28 root&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30059"&gt;drwxr-xr-x   2 root   \
root     31 Apr 13 07:32 run&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30060"&gt;drwxr-xr-x   2 root   \
root   4096 Apr 13 07:36 sbin&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30061"&gt;dr-xr-xr-x  12 nobody \
nobody    0 Mar 24 23:11 sys&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30062"&gt;drwxrwxrwt   2 root   \
root     18 Apr 13 07:36 tmp&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30063"&gt;drwxr-xr-x  13 root   \
root   4096 Apr 18 12:49 usr&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30064"&gt;drwxr-xr-x   9 root   \
root    102 Apr 13 03:28 var&lt;br \
id="yui_3_16_0_ym19_1_1492678184081_30065"&gt;sh-4.3# touch asdf&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1492678184081_31695"&gt;sh-4.3#&lt;br&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1492678184081_12562"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1492678184081_12563"&gt;Thank you Daniel !!&lt;br&gt;&lt;/div&gt;&lt;div \
class="yqt8984201952" id="yqtfd74262"&gt;&lt;br clear="none"&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;  &lt;/div&gt; \
&lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;



</body></email><email><emailId>20170421092108</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-04-21 09:21:08-0400</timestampReceived><subject>Re: [libvirt-users] libvirt remote connection</subject><body>

On Fri, Apr 21, 2017 at 12:14:54PM +0300, Anastasiya Ruzhanskaya wrote:
&gt; It seems, that I have turned off all encryption for tcp in libvirt.conf,
&gt; but still rpc packets are not showed, only tcp. I suppose, that I don't
&gt; need to add additional plugins to wirehark for libvirt and rpc, am I right?

Libvirt provides a wireshark plugin - you need to make sure you've actually
intsalled that bit though, as its a separate rpm.


&gt; 
&gt; 2017-04-21 11:23 GMT+03:00 Daniel P. Berrange &lt;berrange@redhat.com&gt;:
&gt; 
&gt; &gt; On Fri, Apr 21, 2017 at 10:16:47AM +0300, Anastasiya Ruzhanskaya wrote:
&gt; &gt; &gt; Hello,
&gt; &gt; &gt; I have some questions about libvirt remote connection.
&gt; &gt; &gt; Am I right that internally libvirt uses only tcp ( ssh and tls are only
&gt; &gt; &gt; encryption based on this) + ftp ( when working with image itself)? Also I
&gt; &gt; &gt; have found that  it uses RPC. However, as I know RPC runs above tcp but I
&gt; &gt; &gt; cannot capture these packets with wireshark when I am connecting remotely
&gt; &gt; &gt; to the host with vm? Is it somehow possible to find out, what data, what
&gt; &gt; &gt; messages, in what format are send from my server to the remote libvirt
&gt; &gt; &gt; (daemon I suppose?)?
&gt; &gt;
&gt; &gt; Libvirt uses a custom RPC protocol running above a number of different
&gt; &gt; transports (TCP with SASL, TCP with TLS, SSH tunnel, etc, etc). Libvirt
&gt; &gt; ships a wireshark plugin that can be used to analyse the network stream
&gt; &gt; but you would have to turn off all authentication and use plain TCP
&gt; &gt; to be able to see it otherwise it'll be encrypted and wireshark won;t
&gt; &gt; see anything
&gt; &gt;
&gt; &gt;
&gt; &gt; Regards,
&gt; &gt; Daniel
&gt; &gt; --
&gt; &gt; |: https://berrange.com      -o-    https://www.flickr.com/photos/
&gt; &gt; dberrange :|
&gt; &gt; |: https://libvirt.org         -o-
&gt; &gt; https://fstop138.berrange.com :|
&gt; &gt; |: https://entangle-photo.org    -o-    https://www.instagram.com/
&gt; &gt; dberrange :|
&gt; &gt;

Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170421133412</emailId><senderName>Rafał_Wojciechowski</senderName><senderEmail>it@rafalwojciechowski.pl</senderEmail><timestampReceived>2017-04-21 13:34:12-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd segfault when using oVirt 4.1 with graphic console - CentOS7.3</subject><body>

Hi,

I can confirm. without tun0 after reboot it is working fine. it was not 
so obvious. thanks


Regards,

Rafal Wojciechowski


W dniu 21.04.2017 o 10:53, Pavel Hrdina pisze:
&gt; On Thu, Apr 20, 2017 at 06:10:04PM +0200, Rafał Wojciechowski wrote:
&gt; &gt; hello,
&gt; &gt; 
&gt; &gt; I attached core dump - not sure if it was what you have asked for
&gt; &gt; I am rather just admin not developer :)
&gt; &gt; 
&gt; &gt; Regards,
&gt; &gt; 
&gt; &gt; Rafal Wojciechowski
&gt; The attached core send in private mail helped to figure out where the crash
&gt; happened.  Backtrace:
&gt; 
&gt; Thread 1 (Thread 0x7f194b99d700 (LWP 5631)):
&gt; #0  virNetDevGetifaddrsAddress (addr=0x7f194b99c7c0, ifname=0x7f193400e2b0 \
&gt; "ovirtmgmt") at util/virnetdevip.c:738 #1  virNetDevIPAddrGet \
&gt; (ifname=0x7f193400e2b0 "ovirtmgmt", addr=addr@entry=0x7f194b99c7c0) at \
&gt; util/virnetdevip.c:795 #2  0x00007f19467800d6 in networkGetNetworkAddress \
&gt; (netname=&lt;optimized out&gt;, netaddr=netaddr@entry=0x7f1924013f18) at \
&gt; network/bridge_driver.c:4780 #3  0x00007f193e43a33c in \
&gt; qemuProcessGraphicsSetupNetworkAddress (listenAddr=0x7f19340f7650 "127.0.0.1", \
&gt; glisten=0x7f1924013f10) at qemu/qemu_process.c:4062 #4  \
&gt; qemuProcessGraphicsSetupListen (vm=&lt;optimized out&gt;, graphics=0x7f1924014f10, \
&gt; cfg=0x7f1934119f00) at qemu/qemu_process.c:4133 #5  qemuProcessSetupGraphics \
&gt; (flags=17, vm=0x7f19240155d0, driver=0x7f193411f1d0) at qemu/qemu_process.c:4196 #6 \
&gt; qemuProcessPrepareDomain (conn=conn@entry=0x7f192c00ab50, \
&gt; driver=driver@entry=0x7f193411f1d0, vm=vm@entry=0x7f19240155d0, \
&gt; flags=flags@entry=17) at qemu/qemu_process.c:4969 #7  0x00007f193e4417c0 in \
&gt; qemuProcessStart (conn=conn@entry=0x7f192c00ab50, \
&gt; driver=driver@entry=0x7f193411f1d0, vm=0x7f19240155d0, \
&gt; asyncJob=asyncJob@entry=QEMU_ASYNC_JOB_START, migrateFrom=migrateFrom@entry=0x0, \
&gt; migrateFd=migrateFd@entry=-1, migratePath=migratePath@entry=0x0, \
&gt; snapshot=snapshot@entry=0x0, vmop=vmop@entry=VIR_NETDEV_VPORT_PROFILE_OP_CREATE, \
&gt; flags=17, flags@entry=1) at qemu/qemu_process.c:5553 #8  0x00007f193e490030 in \
&gt; qemuDomainCreateXML (conn=0x7f192c00ab50, xml=&lt;optimized out&gt;, flags=&lt;optimized \
&gt; out&gt;) at qemu/qemu_driver.c:1774 #9  0x00007f195aa6af81 in virDomainCreateXML \
&gt; (conn=0x7f192c00ab50, xmlDesc=0x7f1924003f00 "&lt;?xml version='1.0' \
&gt; encoding='UTF-8'?&gt;\n&lt;domain xmlns:ovirt=\"http://ovirt.org/vm/tune/1.0\" \
&gt; type=\"kvm\"&gt;\n    &lt;name&gt;zzzzz&lt;/name&gt;\n    \
&gt; &lt;uuid&gt;7d14f6e2-978b-47a5-875d-be5d6b28af2c&lt;/uuid&gt;\n    &lt;memory&gt;1048576&lt;/"..., \
&gt; flags=0) at libvirt-domain.c:180 #10 0x00007f195b6e8dfa in \
&gt; remoteDispatchDomainCreateXML (server=0x7f195bc4eb40, msg=0x7f195bc73ee0, \
&gt; ret=0x7f19240038b0, args=0x7f1924003a70, rerr=0x7f194b99cc50, \
&gt; client=0x7f195bc71e90) at remote_dispatch.h:4257 #11 \
&gt; remoteDispatchDomainCreateXMLHelper (server=0x7f195bc4eb40, client=0x7f195bc71e90, \
&gt; msg=0x7f195bc73ee0, rerr=0x7f194b99cc50, args=0x7f1924003a70, ret=0x7f19240038b0) \
&gt; at remote_dispatch.h:4235 #12 0x00007f195aaea002 in virNetServerProgramDispatchCall \
&gt; (msg=0x7f195bc73ee0, client=0x7f195bc71e90, server=0x7f195bc4eb40, \
&gt; prog=0x7f195bc62fa0) at rpc/virnetserverprogram.c:437 #13 \
&gt; virNetServerProgramDispatch (prog=0x7f195bc62fa0, \
&gt; server=server@entry=0x7f195bc4eb40, client=0x7f195bc71e90, msg=0x7f195bc73ee0) at \
&gt; rpc/virnetserverprogram.c:307 #14 0x00007f195b6f9c6d in virNetServerProcessMsg \
&gt; (msg=&lt;optimized out&gt;, prog=&lt;optimized out&gt;, client=&lt;optimized out&gt;, \
&gt; srv=0x7f195bc4eb40) at rpc/virnetserver.c:148 #15 virNetServerHandleJob \
&gt; (jobOpaque=&lt;optimized out&gt;, opaque=0x7f195bc4eb40) at rpc/virnetserver.c:169 #16 \
&gt; 0x00007f195a9d6d41 in virThreadPoolWorker (opaque=opaque@entry=0x7f195bc44160) at \
&gt; util/virthreadpool.c:167 #17 0x00007f195a9d60c8 in virThreadHelper (data=&lt;optimized \
&gt; out&gt;) at util/virthread.c:206 #18 0x00007f1957ff9dc5 in start_thread \
&gt; (arg=0x7f194b99d700) at pthread_create.c:308 #19 0x00007f1957d2873d in clone () at \
&gt; ../sysdeps/unix/sysv/linux/x86_64/clone.S:113 
&gt; I'll send a patch to upstream libvirt to fix this crash.  However it can take
&gt; a while to get it back to CentOS/RHEL.  The source of this crash is that you
&gt; have a "tun0" network interface without IP address and that interface is
&gt; checked before "ovirtmgmt" and it causes the crash.  You can workaround it
&gt; by removing the "tun0" interface if it doesn't have any IP address.
&gt; 
&gt; Pavel
&gt; 
&gt; &gt; W dniu 20.04.2017 o 16:44, Pavel Hrdina pisze:
&gt; &gt; &gt; On Thu, Apr 20, 2017 at 07:36:42AM +0200, Rafał Wojciechowski wrote:
&gt; &gt; &gt; &gt; hello,
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; I am getting such error:
&gt; &gt; &gt; &gt; libvirtd[27218]: segfault at 0 ip 00007f4940725721 sp 00007f4930711740
&gt; &gt; &gt; &gt; error 4 in libvirt.so.0.2000.0[7f4940678000+353000]
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; when I am trying to start VM with graphic spice/vnc console - in
&gt; &gt; &gt; &gt; headless mode(without graphic console) it is running
&gt; &gt; &gt; &gt; I noticed this after update oVirt 4.0 to oVirt 4.1 however I noticed
&gt; &gt; &gt; &gt; that also libvirtd and related packages were upgraded from 1.2.7 to 2.0.0:
&gt; &gt; &gt; &gt; libvirt-daemon-kvm-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; &gt; libvirt-daemon-driver-qemu-2.0.0-10.el7_3.5.x86_64
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; I am running up to date CentOS7.3 with 3.10.0-514.16.1.el7.x86_64
&gt; &gt; &gt; &gt; I have same issue with SELinux and without SELinux(checked after reboot
&gt; &gt; &gt; &gt; with permissive mode)
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; I tried to get information about this issue from oVirt team, but after
&gt; &gt; &gt; &gt; mail conversation both me and oVirt team thinks that it might be issue
&gt; &gt; &gt; &gt; in libvirtd
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; in below link I am putting xmls generated by vdsm which are passing to
&gt; &gt; &gt; &gt; the libvirtd to run the VMs
&gt; &gt; &gt; &gt; first one is from vdsm log and second one is extracted from dump after
&gt; &gt; &gt; &gt; segfault of libvirtd
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; https://paste.fedoraproject.org/paste/eqpe8Byu2l-3SRdXc6LTLl5M1UNdIGYhyRLivL9gydE=
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; Hi,
&gt; &gt; &gt; 
&gt; &gt; &gt; could you please provide core backtrace? I've tried to reproduce it on
&gt; &gt; &gt; CentOS 7.3 with the same graphics configuration but the guest started
&gt; &gt; &gt; and there was no segfault.
&gt; &gt; &gt; 
&gt; &gt; &gt; Thanks,
&gt; &gt; &gt; 
&gt; &gt; &gt; Pavel


</body></email><email><emailId>20170422084843</emailId><senderName>Vasiliy Tolstov</senderName><senderEmail>v.tolstov@selfip.ru</senderEmail><timestampReceived>2017-04-22 08:48:43-0400</timestampReceived><subject>Re: [libvirt-users] subscribe to domain start/stop/panic events</subject><body>

Already find it DomainEventRegisterCallbackAny works finen if pass
domain as null (found via wireshark dissector)

2017-04-21 21:40 GMT+03:00 Vasiliy Tolstov &lt;v.tolstov@selfip.ru&gt;:
&gt; Hi! How can i'm subscribe in my app to domain lifecycle messages?
&gt; Does it possible to subscribe for all domains and not just one?
&gt;
&gt; --
&gt; Vasiliy Tolstov,
&gt; e-mail: v.tolstov@selfip.ru



-- 
Vasiliy Tolstov,
e-mail: v.tolstov@selfip.ru

</body></email><email><emailId>20170423034724</emailId><senderName>Leroy Tennison</senderName><senderEmail>leroy.tennison@verizon.net</senderEmail><timestampReceived>2017-04-23 03:47:24-0400</timestampReceived><subject>[libvirt-users] Proper way to remove a qemu-nbd-mounted volume usnig lvm</subject><body>

I either haven't searched for the right thing or the web doesn't contain 
the answer.

I have used the following to mount an image and now I need to know the 
proper way to reverse the process.

    qemu-nbd -c /dev/nbd0 &lt;qcow2 image using lvm&gt;

    vgscan --cache    (had to use --cache to get the qemu-nbd volume to
    be recognized, lvmetad is running)

    vgchange -ay

    lvdisplay

    mount &lt;selected qemu-nbd related 'LV Path' found from lvdisplay
    above&gt; &lt;mount point&gt;

I have done the following:

    umount &lt;mount point&gt;

    lvchange -an &lt;all qemu-nbd related 'LV Path's found from lvdisplay
    above&gt;

    vgchange -an &lt;qemu-nbd related volume&gt;

Now what?  How do I get the volume out of the list so I can use 
'qemu-nbd -d /dev/nbd0' to dis-associate the image with /dev/nbd0?  
vgreduce seems to be for volumes which have multiple underlying 
devices.  I started to use vgremove but, when it started prompting for 
confirmation about removing logical volumes, I wasn't sure exactly what 
it was going to do and responded 'no'.

If there is a web reference explaining this specific situation just 
point me to it - I'm not opposed to reading.  Thanks for the help.


[Attachment #3 (text/html)]

&lt;html&gt;
  &lt;head&gt;

    &lt;meta http-equiv="content-type" content="text/html; charset=utf-8"&gt;
  &lt;/head&gt;
  &lt;body bgcolor="#FFFFFF" text="#000000"&gt;
    &lt;p&gt;I either haven't searched for the right thing or the web doesn't
      contain the answer.&lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;I have used the following to mount an image and now I need to
      know the proper way to reverse the process.&lt;/p&gt;
    &lt;blockquote&gt;
      &lt;p&gt;qemu-nbd -c /dev/nbd0 &lt;qcow2 image using lvm&gt;&lt;/p&gt;
      &lt;p&gt;vgscan --cache       (had to use --cache to get the qemu-nbd
        volume to be recognized, lvmetad is running)&lt;/p&gt;
      &lt;p&gt;vgchange -ay&lt;/p&gt;
      &lt;p&gt;lvdisplay&lt;/p&gt;
      &lt;p&gt;mount &lt;selected qemu-nbd related 'LV Path' found from
        lvdisplay above&gt; &lt;mount point&gt;&lt;/p&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;I have done the following:&lt;/p&gt;
    &lt;blockquote&gt;
      &lt;p&gt;umount &lt;mount point&gt;&lt;/p&gt;
      &lt;p&gt;lvchange -an &lt;all qemu-nbd related 'LV Path's found from
        lvdisplay above&gt;&lt;/p&gt;
      &lt;p&gt;vgchange -an &lt;qemu-nbd related volume&gt;&lt;/p&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;Now what?   How do I get the volume out of the list so I can use
      'qemu-nbd -d /dev/nbd0' to dis-associate the image with
      /dev/nbd0?   vgreduce seems to be for volumes which have multiple
      underlying devices.   I started to use vgremove but, when it
      started prompting for confirmation about removing logical volumes,
      I wasn't sure exactly what it was going to do and responded 'no'.&lt;/p&gt;
    &lt;p&gt;If there is a web reference explaining this specific situation
      just point me to it - I'm not opposed to reading.   Thanks for the
      help.&lt;br&gt;
    &lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;


</body></email><email><emailId>20170423043545</emailId><senderName>Leroy Tennison</senderName><senderEmail>leroy.tennison@verizon.net</senderEmail><timestampReceived>2017-04-23 04:35:45-0400</timestampReceived><subject>[libvirt-users] External snapshot issue addendum</subject><body>

I made a mistake in my original post, --diskspec in snapshot-create-as 
should have shown "hda ...".

I also just noticed that 'virsh edit &lt;VM name&gt;' has the correct 
information (no backing store, only the external snapshot file shown), I 
was under the impression that /run/... showed the current state, incorrect?

</body></email><email><emailId>20170424143254</emailId><senderName>Kashyap Chamarthy</senderName><senderEmail>kchamart@redhat.com</senderEmail><timestampReceived>2017-04-24 14:32:54-0400</timestampReceived><subject>Re: [libvirt-users] virt-manager, Network Manager and bridged networking</subject><body>

On Fri, Apr 21, 2017 at 08:01:00AM +0200, Daniel Pocock wrote:
&gt; 
&gt; The wiki suggests that Network Manager doesn't support bridges[1] but I
&gt; think that is out-of-date.  Other documents like this[2] show how to set
&gt; up bridges in Network Manager.
&gt; 
&gt; For users wanting to run libvirt/KVM on their desktop system, can they
&gt; now configure a bridge through Network Manager and then use it in
&gt; virt-manager to create a guest without editing any of their
&gt; configuration files by hand?

Not that I know of.

However, here's the most through write-up I've seen on this matter (from
JUL 2014) 

    https://www.happyassassin.net/2014/07/23/bridged-networking-for-libvirt-with-networkmanager-2014-fedora-21/
  
Yes, it requires about 13 steps...

&gt; Would it be possible for virsh or virt-manager to be enhanced to go one
&gt; step further and automatically create bridges in Network Manager (using
&gt; some API) on demand so the user doesn't have to do anything outside of
&gt; virt-manager?
&gt; 
&gt; Regards,
&gt; 
&gt; Daniel
&gt; 
&gt; 
&gt; 
&gt; 1. https://wiki.libvirt.org/page/Networking#Fedora.2FRHEL_Bridging
&gt; 2. http://ask.xmodulo.com/configure-linux-bridge-network-manager-ubuntu.html
&gt; 
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users

-- 
/kashyap


</body></email><email><emailId>20170424143739</emailId><senderName>Roman Bogorodskiy</senderName><senderEmail>bogorodskiy@gmail.com</senderEmail><timestampReceived>2017-04-24 14:37:39-0400</timestampReceived><subject>Re: [libvirt-users] ZFS: creating a pool in a created zfs does not work, only when using the whole z</subject><body>


  Thies C. Arntzen wrote:

&gt; Thank you for your reply.
&gt; 
&gt; I have managed to create a virtual machine on my ZFS-filesystem using
&gt; virt-install:-) It seems to me that my version of libvirt (Ubuntu 17.04)
&gt; has problems enumerating the devices when "virsh vol-list" is used. The
&gt; volumes are available for virt-install but not thru virsh or virt-manager.
&gt; 
&gt; As to when the volumes disappear in virsh vol-list - I have no idea. I'm
&gt; not restarting libvirtd. It *seems* to me that (wild guess) they can be
&gt; listed as long as they are fresh and  in some in memory cache and never get
&gt; displayed if you have to enumerate from the filesystem. There are no
&gt; error-messages that I can see - the volumes are simply not displayed.

I see what's the error. When I try to manually call 'pool-refresh', I can
see the error message:

2017-04-24 14:20:32.102+0000: 34500342784: error : virCommandWait:2572 : internal \
error: Child process (/sbin/zpool get -Hp health,size,free,allocated testpool0/zpool) \
unexpected exit status 1: cannot open 'testp ool0/zpool': invalid character '/' in \
pool name

So, apparently, things work as expected only when the source pool is really
a pool (such as listed by e.g. 'zpool list'). Just like you described in
your original message.

I need to think if I can make this work in this nested scenario or at
least forbid source pool with "/" in it.


&gt; Best regards,
&gt; thies
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; Am 23. April 2017 um 15:14:55, Roman Bogorodskiy (bogorodskiy@gmail.com)
&gt; schrieb:
&gt; 
&gt; Thies C. Arntzen wrote:
&gt; 
&gt; &gt; Hi,
&gt; &gt; 
&gt; &gt; I'm new here so apologies if this has been answered before.
&gt; &gt; 
&gt; &gt; I have a box that uses ZFS for everything (ubuntu 17.04) and I want to
&gt; &gt; create a libvirt pool on that. My ZFS pool is named „big"
&gt; &gt; 
&gt; &gt; So i do:
&gt; &gt; 
&gt; &gt; &gt; zfs create big/zpool
&gt; &gt; &gt; virsh pool-define-as --name zpool --source-name big/zpool --type zfs
&gt; &gt; &gt; virsh pool-start zpool
&gt; &gt; &gt; virsh pool-autostart zpool
&gt; &gt; &gt; virsh pool-list
&gt; &gt; &gt; virsh vol-create-as --pool zpool --name test1 --capacity 1G
&gt; &gt; &gt; virsh vol-list zpool
&gt; &gt; 
&gt; &gt; Everything seems to work (no error message, vol-list shows the created
&gt; &gt; volume, I can see the volume
&gt; &gt; via zfs list -t all). -BUT- I cannot use that volume via virt-manager
&gt; 
&gt; Could you check if you can use this volume via virsh, and paste an error
&gt; message in case if it provides one? Or maybe an error message if
&gt; virt-manager gives one.
&gt; 
&gt; &gt; and after a short while it's
&gt; &gt; no longer listed via virsh vol-list zpool. The very same thing works
&gt; 
&gt; Does "after a short while" involve host reboots, libvirtd restarts or
&gt; anything like that?
&gt; 
&gt; Anyway, I've just checked the scenario you provided on FreeBSD and I was
&gt; able to create a VM using this new 'test1' volume. I was using just
&gt; virsh though.
&gt; 
&gt; I'll try to setup Ubutun 17.04 VM and check there.
&gt; 
&gt; &gt; as expected if I create a new zfs
&gt; &gt; pool which I hand into libvirt. So instead of creating a pool from
&gt; &gt; "big/zpool" I create a pool names
&gt; &gt; „somepool" on a free device and -voila- everything works.
&gt; &gt; 
&gt; &gt; Hope I did make myself clear?
&gt; &gt; 
&gt; &gt; Best regards,
&gt; &gt; thies
&gt; &gt; 
&gt; &gt; _______________________________________________
&gt; &gt; libvirt-users mailing list
&gt; &gt; libvirt-users@redhat.com
&gt; &gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt; 
&gt; Roman Bogorodskiy

Roman Bogorodskiy


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170424144527</emailId><senderName>Kashyap Chamarthy</senderName><senderEmail>kchamart@redhat.com</senderEmail><timestampReceived>2017-04-24 14:45:27-0400</timestampReceived><subject>Re: [libvirt-users] External snapshot issue</subject><body>

On Sat, Apr 22, 2017 at 11:26:17PM -0500, Leroy Tennison wrote:
&gt; I have used
&gt; 
&gt;    virsh snapshot-create-as &lt;VM name&gt; &lt;snapshot name&gt; "&lt;snapshot
&gt;    description&gt;" --diskspec
&gt;    "vda,snapshot=external,file=/path/to/external-snapshot" --disk-only
&gt;    --atomic

To avoid creating libvirt metadata for external snapshots, here you can
provide the option '--no-metadata' to `virsh snapshot-create-as` so that
libvirt won't track the metadata anymore.  This avoids having to delete
it manually (which you can do as I outlined further down below).

&gt; to create an external snapshot of a running VM.  I followed it with
&gt; 
&gt;    virsh blockpull &lt;VM name&gt; --path /path/to/external-snapshot

Slightly related: `blockcommit` is relatively faster than `blockpull` in
this case -- because your base image ("original-image-file.qcow") should
have the bulk of the content, so `blockcommit` will copy only the
_delta_ from the original, which was stored in your
'external-snapshot.qcow2', so it'll be a shorter copy operation.

Here's some notes related to it:

    http://wiki.libvirt.org/page/Live-disk-backup-with-active-blockcommit

&gt; and monitored it until done.  I confirmed it with
&gt; 
&gt;    qemu-img info /path/to/external-snapshot
&gt; 
&gt; which shows no backing store.
&gt; 
&gt; However, when I do
&gt; 
&gt;    grep {/etc,/run}/libvirt/qemu/&lt;VM name&gt;.xml
&gt; 
&gt; the xml for the VM still shows a backing store in the /run/... definition
&gt; (but not in the /etc/... definition, my understanding is that the /etc/...
&gt; definition won't be updated until the VM is shut down):
&gt; 
&gt;       &lt;disk type='file' device='disk'&gt;
&gt;         &lt;driver name='qemu' type='qcow2'/&gt;
&gt;         &lt;source file='/var/lib/libvirt/images/external-snapshot.qcow2'/&gt;
&gt;         &lt;backingStore type='file' index='1'&gt;
&gt;           &lt;format type='qcow2'/&gt;
&gt;           &lt;source file='/var/lib/libvirt/images/original-image-file.qcow'/&gt;
&gt;           &lt;backingStore/&gt;
&gt;         &lt;/backingStore&gt;
&gt;         &lt;target dev='hda' bus='ide'/&gt;
&gt;         &lt;alias name='ide0-0-0'/&gt;
&gt;         &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&gt;       &lt;/disk&gt;
&gt; 
&gt; This is using libvirtd version 1.3.1 and qemu-img version 2.5.0.
&gt; 
&gt; How do I resolve this situation?  I don't want to have to rely on a backing
&gt; store permanently.  Thanks for any help or pointers.

You can look at the existing snapshot metadata libvirt is tracking:

    $ virsh snapshot-list --tree vm1

And then delete the metadata (the below command does that) for a named
snapshot:

    $ virsh snapshot-delete vm1 --metadata snap1


-- 
/kashyap

</body></email><email><emailId>20170426144919</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-04-26 14:49:19-0400</timestampReceived><subject>Re: [libvirt-users] Performance monotoring: Perf Event support</subject><body>

On Mon, Apr 24, 2017 at 06:54:32PM +0200, Hui Jing wrote:
&gt; Hi everyone,
&gt; 
&gt; I am using libvirt 2.5.0. I'd like to enable the "perf events" to
&gt; monitoring my vm performance such as l3 cache. But it failed with "error:
&gt; argument unsupported: unable to enable host cpu perf event for cmt".
&gt; 1. Could you please give some hints on how to check if my host CPU supports
&gt; cmt,mbm, is it displayed in /proc/cpuinfo?

It would be listed by 'virsh capabilities' as 'cmt', or in /proc/cpuinfo
as 'cqm'.

You need pretty particular CPU models too - many Intel models don't
support this even brand new ones.

&gt; 2. Does the kernel version matters as well to support it?

Yes, but I don't recall which version


Regards,
Daniel
-- 
|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|

</body></email><email><emailId>20170427030444</emailId><senderName></senderName><senderEmail>dlworld0@163.com</senderEmail><timestampReceived>2017-04-27 03:04:44-0400</timestampReceived><subject>Re: [libvirt-users] Tunnelled migrate Windows7 VMs halted</subject><body>

[Attachment #2 (text/plain)]




At 2017-04-26 21:59:46, "Daniel P. Berrange" &lt;berrange@redhat.com&gt; wrote:
&gt; On Wed, Apr 26, 2017 at 08:51:39AM -0500, Eric Blake wrote:
&gt; &gt; &gt; 
&gt; &gt; &gt; I migrated a Windows 7 VM with libvirtd tunnelled, the VM halted
&gt; &gt; &gt; on the target although the status is running.
&gt; 
&gt; What do you mean by halted ? The guest OS has shutdown, or QEMU
&gt; has crashed, or something else ?
&gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; [root@test15 ~]# virsh migrate --live --p2p --tunnelled i-000000ac \
&gt; &gt; &gt; qemu+tcp://192.168.65.13/system 
&gt; &gt; &gt; 
&gt; &gt; &gt; But when migrated with qemu native mode, the VM runs well.
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; [root@test15 ~]# virsh migrate --live --p2p i-000000ac \
&gt; &gt; &gt; qemu+tcp://192.168.65.13/system
&gt; 
&gt; From QEMU's POV there's no difference between these modes - in both cases
&gt; QEMU is just getting a file descriptor from libvirt.
&gt; 
&gt; So any problems with the guest after migration are 
&gt; 
&gt; &gt; &gt; System Info:
&gt; &gt; &gt; Release: Centos 7.2
&gt; &gt; &gt; Kernel: 3.10.0-327.28.3.el7.x86_64
&gt; &gt; &gt; Qemu: qemu-kvm-rhev-2.3.0
&gt; &gt; &gt; Libvirt: libvirt-1.2.17/libvirt-2.0.0
&gt; 
&gt; Does the 2 libvirt versions mean you are live-migrating between two different
&gt; versions of CentOS ?  If so, this also likely means two different versions
&gt; of QEMU involved.

&gt; 


Migrate between 2 same version, and tried to upgrade the libvirt version.


&gt; &gt; &gt; CPU: AMD Opteron(TM) Processor 6212
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; As CPUFrequency may lead windows migrate halt, I have disabled Power \
&gt; &gt; &gt; Management.  
&gt; &gt; &gt; 
&gt; &gt; &gt; Does anyone have some sugestions?
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; Thanks,
&gt; &gt; &gt; Linwen Deng
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; vm.xml
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; &lt;domain type='kvm' id='8'&gt;
&gt; &gt; &gt; &lt;name&gt;i-000000ac&lt;/name&gt;
&gt; &gt; &gt; &lt;uuid&gt;53f0710f-b25e-4f47-a7cf-c15a9409fdc3&lt;/uuid&gt;
&gt; &gt; &gt; &lt;metadata&gt;
&gt; &gt; &gt; &lt;nova:instance xmlns:nova="http://openstack.org/xmlns/libvirt/nova/1.0"&gt;
&gt; &gt; &gt; &lt;nova:package version="12.0.0-4"/&gt;
&gt; &gt; &gt; &lt;nova:name&gt;c7-vm15-test15-7&lt;/nova:name&gt;
&gt; &gt; &gt; &lt;nova:creationTime&gt;2017-04-14 06:48:54&lt;/nova:creationTime&gt;
&gt; &gt; &gt; &lt;nova:flavor name="oeflavor-4-2048-20"&gt;
&gt; &gt; &gt; &lt;nova:memory&gt;2048&lt;/nova:memory&gt;
&gt; &gt; &gt; &lt;nova:disk&gt;20&lt;/nova:disk&gt;
&gt; &gt; &gt; &lt;nova:swap&gt;0&lt;/nova:swap&gt;
&gt; &gt; &gt; &lt;nova:ephemeral&gt;0&lt;/nova:ephemeral&gt;
&gt; &gt; &gt; &lt;nova:vcpus&gt;4&lt;/nova:vcpus&gt;
&gt; &gt; &gt; &lt;/nova:flavor&gt;
&gt; &gt; &gt; &lt;nova:owner&gt;
&gt; &gt; &gt; &lt;nova:user uuid="b0f21b1d16b147ffb3f7713716cc894a"&gt;admin&lt;/nova:user&gt;
&gt; &gt; &gt; &lt;nova:project uuid="ae883f160c3c41db850d5cde8de8208b"&gt;service&lt;/nova:project&gt;
&gt; &gt; &gt; &lt;/nova:owner&gt;
&gt; &gt; &gt; &lt;/nova:instance&gt;
&gt; &gt; &gt; &lt;/metadata&gt;
&gt; &gt; &gt; &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;
&gt; &gt; &gt; &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMemory&gt;
&gt; &gt; &gt; &lt;memoryBacking&gt;
&gt; &gt; &gt; &lt;hugepages&gt;
&gt; &gt; &gt; &lt;page size='2048' unit='KiB' nodeset='0'/&gt;
&gt; &gt; &gt; &lt;/hugepages&gt;
&gt; &gt; &gt; &lt;/memoryBacking&gt;
&gt; &gt; &gt; &lt;vcpu placement='static'&gt;2&lt;/vcpu&gt;
&gt; &gt; &gt; &lt;cputune&gt;
&gt; &gt; &gt; &lt;shares&gt;4096&lt;/shares&gt;
&gt; &gt; &gt; &lt;vcpupin vcpu='0' cpuset='4-7'/&gt;
&gt; &gt; &gt; &lt;vcpupin vcpu='1' cpuset='4-7'/&gt;
&gt; &gt; &gt; &lt;emulatorpin cpuset='4-7'/&gt;
&gt; &gt; &gt; &lt;/cputune&gt;
&gt; &gt; &gt; &lt;resource&gt;
&gt; &gt; &gt; &lt;partition&gt;/machine&lt;/partition&gt;
&gt; &gt; &gt; &lt;/resource&gt;
&gt; &gt; &gt; &lt;sysinfo type='smbios'&gt;
&gt; &gt; &gt; &lt;system&gt;
&gt; &gt; &gt; &lt;entry name='manufacturer'&gt;Fedora Project&lt;/entry&gt;
&gt; &gt; &gt; &lt;entry name='product'&gt;OpenStack Nova&lt;/entry&gt;
&gt; &gt; &gt; &lt;entry name='version'&gt;12.0.0-4&lt;/entry&gt;
&gt; &gt; &gt; &lt;entry name='serial'&gt;95637afe-453f-42a8-b198-df673ab59c91&lt;/entry&gt;
&gt; &gt; &gt; &lt;entry name='uuid'&gt;53f0710f-b25e-4f47-a7cf-c15a9409fdc3&lt;/entry&gt;
&gt; &gt; &gt; &lt;entry name='family'&gt;Virtual Machine&lt;/entry&gt;
&gt; &gt; &gt; &lt;/system&gt;
&gt; &gt; &gt; &lt;/sysinfo&gt;
&gt; &gt; &gt; &lt;os&gt;
&gt; &gt; &gt; &lt;type arch='x86_64' machine='pc-i440fx-rhel7.2.0'&gt;hvm&lt;/type&gt;
&gt; &gt; &gt; &lt;boot dev='cdrom'/&gt;
&gt; &gt; &gt; &lt;boot dev='hd'/&gt;
&gt; &gt; &gt; &lt;boot dev='fd'/&gt;
&gt; &gt; &gt; &lt;smbios mode='sysinfo'/&gt;
&gt; &gt; &gt; &lt;/os&gt;
&gt; &gt; &gt; &lt;features&gt;
&gt; &gt; &gt; &lt;acpi/&gt;
&gt; &gt; &gt; &lt;apic/&gt;
&gt; &gt; &gt; &lt;/features&gt;
&gt; &gt; &gt; &lt;cpu mode='host-model'&gt;
&gt; &gt; &gt; &lt;model fallback='allow'/&gt;
&gt; &gt; &gt; &lt;topology sockets='2' cores='1' threads='1'/&gt;
&gt; &gt; &gt; &lt;/cpu&gt;
&gt; &gt; &gt; &lt;clock offset='utc'&gt;
&gt; &gt; &gt; &lt;timer name='pit' tickpolicy='delay'/&gt;
&gt; &gt; &gt; &lt;timer name='rtc' tickpolicy='catchup'/&gt;
&gt; &gt; &gt; &lt;timer name='hpet' present='no'/&gt;
&gt; &gt; &gt; &lt;/clock&gt;
&gt; 
&gt; If nothing else, this guest is incorrectly configured for running
&gt; the Windows OS. I suspect you forget to set the Glance image
&gt; property needed to tell Nova that it is windows.
&gt; 
&gt; Specifically it is missing hyperv paravirt &lt;timer&gt;, and many hyperv
&gt; paravirt &lt;feature&gt; elements.
&gt; 
&gt; This will make Windows guests unstable and liable to hit BSOD

&gt; 


I have tried to update the xml, the problem also exists, although there's one
success in 5 tries. But the guest can accept ctrl-alt-delete, further operations \
still not available. 


 &lt;features&gt;
    &lt;acpi/&gt;
    &lt;apic/&gt;
    &lt;hyperv&gt;
      &lt;relaxed state='on'/&gt;
      &lt;vapic state='on'/&gt;
      &lt;spinlocks state='on' retries='8191'/&gt;
    &lt;/hyperv&gt;
  &lt;/features&gt;
  &lt;cpu mode='host-model'&gt;
    &lt;model fallback='allow'/&gt;
    &lt;topology sockets='1' cores='2' threads='1'/&gt;
  &lt;/cpu&gt;
  &lt;clock offset='utc'&gt;
    &lt;timer name='pit' tickpolicy='delay'/&gt;
    &lt;timer name='rtc' tickpolicy='catchup'/&gt;
    &lt;timer name='hpet' present='no'/&gt;
    &lt;timer name='hypervclock' present='yes'/&gt;
  &lt;/clock&gt;





&gt; 
&gt; Regards,
&gt; Daniel
&gt; -- 
&gt; &gt; &gt; https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
&gt; &gt; &gt; https://libvirt.org         -o-            https://fstop138.berrange.com :|
&gt; &gt; &gt; https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|


[Attachment #3 (text/html)]

&lt;div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"&gt;&lt;br&gt;&lt;pre&gt;&lt;br&gt;At \
2017-04-26 21:59:46, "Daniel P. Berrange" &lt;berrange@redhat.com&gt; wrote: &gt;On \
Wed, Apr 26, 2017 at 08:51:39AM -0500, Eric Blake wrote: &gt;&gt; &gt; 
&gt;&gt; &gt; I migrated a Windows 7 VM with libvirtd tunnelled, the VM halted
&gt;&gt; &gt; on the target although the status is running.
&gt;
&gt;What do you mean by halted ? The guest OS has shutdown, or QEMU
&gt;has crashed, or something else ?
&gt;
&gt;&gt; &gt; 
&gt;&gt; &gt; 
&gt;&gt; &gt;     [root@test15 ~]# virsh migrate --live --p2p --tunnelled i-000000ac \
qemu+tcp://192.168.65.13/system &gt;&gt; &gt; 
&gt;&gt; &gt; 
&gt;&gt; &gt; But when migrated with qemu native mode, the VM runs well.
&gt;&gt; &gt; 
&gt;&gt; &gt; 
&gt;&gt; &gt;     [root@test15 ~]# virsh migrate --live --p2p i-000000ac \
qemu+tcp://192.168.65.13/system &gt;
&gt;From QEMU's POV there's no difference between these modes - in both cases
&gt;QEMU is just getting a file descriptor from libvirt.
&gt;
&gt;So any problems with the guest after migration are 
&gt;
&gt;&gt; &gt; System Info:
&gt;&gt; &gt;     Release: Centos 7.2
&gt;&gt; &gt;     Kernel: 3.10.0-327.28.3.el7.x86_64
&gt;&gt; &gt;     Qemu: qemu-kvm-rhev-2.3.0
&gt;&gt; &gt;     Libvirt: libvirt-1.2.17/libvirt-2.0.0
&gt;
&gt;Does the 2 libvirt versions mean you are live-migrating between two different
&gt;versions of CentOS ?  If so, this also likely means two different versions
&gt;of QEMU involved.
&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Migrate between 2 same version, and tried to \
upgrade the libvirt version.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&gt;&gt; &gt;     CPU: AMD \
Opteron(TM) Processor 6212 &gt;&gt; &gt; 
&gt;&gt; &gt; 
&gt;&gt; &gt; As CPUFrequency may lead windows migrate halt, I have disabled Power \
Management.  &gt;&gt; &gt; 
&gt;&gt; &gt; 
&gt;&gt; &gt; Does anyone have some sugestions?
&gt;&gt; &gt; 
&gt;&gt; &gt; 
&gt;&gt; &gt; Thanks,
&gt;&gt; &gt; Linwen Deng
&gt;&gt; &gt; 
&gt;&gt; &gt; 
&gt;&gt; &gt; vm.xml
&gt;&gt; &gt; 
&gt;&gt; &gt; 
&gt;&gt; &gt; &lt;domain type='kvm' id='8'&gt;
&gt;&gt; &gt;   &lt;name&gt;i-000000ac&lt;/name&gt;
&gt;&gt; &gt;   &lt;uuid&gt;53f0710f-b25e-4f47-a7cf-c15a9409fdc3&lt;/uuid&gt;
&gt;&gt; &gt;   &lt;metadata&gt;
&gt;&gt; &gt;     &lt;nova:instance \
xmlns:nova="http://openstack.org/xmlns/libvirt/nova/1.0"&gt; &gt;&gt; &gt;       \
&lt;nova:package version="12.0.0-4"/&gt; &gt;&gt; &gt;       \
&lt;nova:name&gt;c7-vm15-test15-7&lt;/nova:name&gt; &gt;&gt; &gt;       \
&lt;nova:creationTime&gt;2017-04-14 06:48:54&lt;/nova:creationTime&gt; &gt;&gt; &gt;  \
&lt;nova:flavor name="oeflavor-4-2048-20"&gt; &gt;&gt; &gt;         \
&lt;nova:memory&gt;2048&lt;/nova:memory&gt; &gt;&gt; &gt;         \
&lt;nova:disk&gt;20&lt;/nova:disk&gt; &gt;&gt; &gt;         \
&lt;nova:swap&gt;0&lt;/nova:swap&gt; &gt;&gt; &gt;         \
&lt;nova:ephemeral&gt;0&lt;/nova:ephemeral&gt; &gt;&gt; &gt;         \
&lt;nova:vcpus&gt;4&lt;/nova:vcpus&gt; &gt;&gt; &gt;       &lt;/nova:flavor&gt;
&gt;&gt; &gt;       &lt;nova:owner&gt;
&gt;&gt; &gt;         &lt;nova:user \
uuid="b0f21b1d16b147ffb3f7713716cc894a"&gt;admin&lt;/nova:user&gt; &gt;&gt; &gt;      \
&lt;nova:project uuid="ae883f160c3c41db850d5cde8de8208b"&gt;service&lt;/nova:project&gt;
 &gt;&gt; &gt;       &lt;/nova:owner&gt;
&gt;&gt; &gt;     &lt;/nova:instance&gt;
&gt;&gt; &gt;   &lt;/metadata&gt;
&gt;&gt; &gt;   &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;
&gt;&gt; &gt;   &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMemory&gt;
&gt;&gt; &gt;   &lt;memoryBacking&gt;
&gt;&gt; &gt;     &lt;hugepages&gt;
&gt;&gt; &gt;       &lt;page size='2048' unit='KiB' nodeset='0'/&gt;
&gt;&gt; &gt;     &lt;/hugepages&gt;
&gt;&gt; &gt;   &lt;/memoryBacking&gt;
&gt;&gt; &gt;   &lt;vcpu placement='static'&gt;2&lt;/vcpu&gt;
&gt;&gt; &gt;   &lt;cputune&gt;
&gt;&gt; &gt;     &lt;shares&gt;4096&lt;/shares&gt;
&gt;&gt; &gt;     &lt;vcpupin vcpu='0' cpuset='4-7'/&gt;
&gt;&gt; &gt;     &lt;vcpupin vcpu='1' cpuset='4-7'/&gt;
&gt;&gt; &gt;     &lt;emulatorpin cpuset='4-7'/&gt;
&gt;&gt; &gt;   &lt;/cputune&gt;
&gt;&gt; &gt;   &lt;resource&gt;
&gt;&gt; &gt;     &lt;partition&gt;/machine&lt;/partition&gt;
&gt;&gt; &gt;   &lt;/resource&gt;
&gt;&gt; &gt;   &lt;sysinfo type='smbios'&gt;
&gt;&gt; &gt;     &lt;system&gt;
&gt;&gt; &gt;       &lt;entry name='manufacturer'&gt;Fedora Project&lt;/entry&gt;
&gt;&gt; &gt;       &lt;entry name='product'&gt;OpenStack Nova&lt;/entry&gt;
&gt;&gt; &gt;       &lt;entry name='version'&gt;12.0.0-4&lt;/entry&gt;
&gt;&gt; &gt;       &lt;entry \
name='serial'&gt;95637afe-453f-42a8-b198-df673ab59c91&lt;/entry&gt; &gt;&gt; &gt;     \
&lt;entry name='uuid'&gt;53f0710f-b25e-4f47-a7cf-c15a9409fdc3&lt;/entry&gt; &gt;&gt; \
&gt;       &lt;entry name='family'&gt;Virtual Machine&lt;/entry&gt; &gt;&gt; &gt;     \
&lt;/system&gt; &gt;&gt; &gt;   &lt;/sysinfo&gt;
&gt;&gt; &gt;   &lt;os&gt;
&gt;&gt; &gt;     &lt;type arch='x86_64' \
machine='pc-i440fx-rhel7.2.0'&gt;hvm&lt;/type&gt; &gt;&gt; &gt;     &lt;boot \
dev='cdrom'/&gt; &gt;&gt; &gt;     &lt;boot dev='hd'/&gt;
&gt;&gt; &gt;     &lt;boot dev='fd'/&gt;
&gt;&gt; &gt;     &lt;smbios mode='sysinfo'/&gt;
&gt;&gt; &gt;   &lt;/os&gt;
&gt;&gt; &gt;   &lt;features&gt;
&gt;&gt; &gt;     &lt;acpi/&gt;
&gt;&gt; &gt;     &lt;apic/&gt;
&gt;&gt; &gt;   &lt;/features&gt;
&gt;&gt; &gt;   &lt;cpu mode='host-model'&gt;
&gt;&gt; &gt;     &lt;model fallback='allow'/&gt;
&gt;&gt; &gt;     &lt;topology sockets='2' cores='1' threads='1'/&gt;
&gt;&gt; &gt;   &lt;/cpu&gt;
&gt;&gt; &gt;   &lt;clock offset='utc'&gt;
&gt;&gt; &gt;     &lt;timer name='pit' tickpolicy='delay'/&gt;
&gt;&gt; &gt;     &lt;timer name='rtc' tickpolicy='catchup'/&gt;
&gt;&gt; &gt;     &lt;timer name='hpet' present='no'/&gt;
&gt;&gt; &gt;   &lt;/clock&gt;
&gt;
&gt;If nothing else, this guest is incorrectly configured for running
&gt;the Windows OS. I suspect you forget to set the Glance image
&gt;property needed to tell Nova that it is windows.
&gt;
&gt;Specifically it is missing hyperv paravirt &lt;timer&gt;, and many hyperv
&gt;paravirt &lt;feature&gt; elements.
&gt;
&gt;This will make Windows guests unstable and liable to hit BSOD
&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I have tried to update the xml, the problem also \
exists, although there's one&lt;/div&gt;&lt;div&gt;success in 5 tries. But the guest can accept \
ctrl-alt-delete, further operations still not available. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; \
&lt;features&gt;  &lt;acpi/&gt;
    &lt;apic/&gt;
    &lt;hyperv&gt;
      &lt;relaxed state='on'/&gt;
      &lt;vapic state='on'/&gt;
      &lt;spinlocks state='on' retries='8191'/&gt;
    &lt;/hyperv&gt;
  &lt;/features&gt;
  &lt;cpu mode='host-model'&gt;
    &lt;model fallback='allow'/&gt;
    &lt;topology sockets='1' cores='2' threads='1'/&gt;
  &lt;/cpu&gt;
  &lt;clock offset='utc'&gt;
    &lt;timer name='pit' tickpolicy='delay'/&gt;
    &lt;timer name='rtc' tickpolicy='catchup'/&gt;
    &lt;timer name='hpet' present='no'/&gt;
    &lt;timer name='hypervclock' present='yes'/&gt;
  &lt;/clock&gt;
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&gt;
&gt;Regards,
&gt;Daniel
&gt;-- 
&gt;|: https://berrange.com      -o-    https://www.flickr.com/photos/dberrange :|
&gt;|: https://libvirt.org         -o-            https://fstop138.berrange.com :|
&gt;|: https://entangle-photo.org    -o-    https://www.instagram.com/dberrange :|
&lt;/pre&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;span title="neteasefooter"&gt;&lt;p&gt; &lt;/p&gt;&lt;/span&gt;



</body></email><email><emailId>20170428073110</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-04-28 07:31:10-0400</timestampReceived><subject>Re: [libvirt-users] Data format</subject><body>


On Fri, Apr 28, 2017 at 09:33:07AM +0300, Anastasiya Ruzhanskaya wrote:
&gt;What is exactly the format of data being sent across remote connection (
&gt;from client to server with RPC protocol)? I see, there is XML but converted
&gt;to string.

http://libvirt.org/internals/rpc.html

&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170428122218</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-04-28 12:22:18-0400</timestampReceived><subject>Re: [libvirt-users] Live migration with non-shared ZFS volume</subject><body>


On Fri, Apr 28, 2017 at 12:06:11PM +0200, Daniel Kučera wrote:
&gt;Hi Martin,
&gt;
&gt;in the meantime, I've found a solution which I consider at least acceptable:
&gt;
&gt;1. create zfs snapshot of domain disk (/dev/zstore/test-volume)
&gt;
&gt;2. save original XML domain definition
&gt;
&gt;3. create snapshot in libvirt like this:
&gt;virsh snapshot-create --xmlfile snap.xml --disk-only --no-metadata
&gt;test-domain
&gt;snap.xml:
&gt;&lt;domainsnapshot&gt;
&gt;  &lt;disks&gt;
&gt;    &lt;disk name='/dev/zstore/test-volume'&gt;
&gt;      &lt;source file='/tmp/test-volume.qcow2'/&gt;
&gt;    &lt;/disk&gt;
&gt;  &lt;/disks&gt;
&gt;&lt;/domainsnapshot&gt;
&gt;
&gt;This creates overlay qcow snapshot on top of my base ZFS volume
&gt;
&gt;3. Transfer ZFS volume (with last snapshot) to remote host
&gt;
&gt;4. Run live migration with setting XML from step 1 as DestXML and PersistXML
&gt;parameter and with VIR_MIGRATE_NON_SHARED_INC flag
&gt;
&gt;This creates domain without snapshot on the remote host and migrates only
&gt;data from qcow overlay and commits them to the ZFS base volume.
&gt;
&gt;What I don't like about this, is that I need to create and care about qcow
&gt;image.
&gt;
&gt;The best solution for me would be to only create dirty block map in qemu
&gt;(block-dirty-bitmap-add) in step 3 and then migrate just changed blocks
&gt;without creating qcow snapshot.
&gt;
&gt;Do you think it would be possible to implement it like this?
&gt;

I'm not sure.  What would you mark as dirty?  There is no cache in qemu,
because you are probably running with cache='none'.  So what you would
have to do is basically creating a virtual, memory-based incremental
snapshot on top of the image, then migrate that...

But as I said before, I'm not that familiar with this part of libvirt,
so maybe others will have way easier solution.

&gt;S pozdravom / Best regards
&gt;Daniel Kucera
&gt;
&gt;2017-04-28 11:03 GMT+02:00 Martin Kletzander &lt;mkletzan@redhat.com&gt;:
&gt;
&gt;&gt; On Tue, Apr 04, 2017 at 12:04:42PM +0200, Daniel Kučera wrote:
&gt;&gt;
&gt;&gt;&gt; Hi all,
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; I caught your mail in my Spam folder for some reason, maybe the same
&gt;&gt; happened for others.  I don't have that deep knowledge of the snapshots,
&gt;&gt; but I'm replying so that if someone else has it in Spam and they have
&gt;&gt; more insight, they can reply.
&gt;&gt;
&gt;&gt;
&gt;&gt; I'm using ZFS on Linux block volumes as my VM storage and want to do live
&gt;&gt;&gt; migrations between hypervisors.
&gt;&gt;&gt;
&gt;&gt;&gt; If I create ZFS snapshot of used volume on source host, send it do
&gt;&gt;&gt; destination host (zfs send/recv) and then run live migration with
&gt;&gt;&gt; VIR_MIGRATE_NON_SHARED_DISK
&gt;&gt;&gt; flag, the migration works OK.
&gt;&gt;&gt;
&gt;&gt;&gt; But this procedure copies the whole disk twice which is a huge downside.
&gt;&gt;&gt;
&gt;&gt;&gt; The best solution would be, if libvirt could send the incremental data
&gt;&gt;&gt; since last snapshot itself but this feature is not there (AFAIK).
&gt;&gt;&gt;
&gt;&gt;&gt; So I am thinking about a workaround:
&gt;&gt;&gt; 1. Create snapshot using: "virsh snapshot-create --xmlfile snap.xml
&gt;&gt;&gt; --disk-only --no-metadata test-domain" which will start writing snapshot
&gt;&gt;&gt; data into temporary qcow2 file
&gt;&gt;&gt;
&gt;&gt;&gt; &lt;domainsnapshot&gt;
&gt;&gt;&gt;  &lt;disks&gt;
&gt;&gt;&gt;    &lt;disk name='/dev/zstore/test-volume'&gt;
&gt;&gt;&gt;      &lt;source file='/tmp/test-volume.qcow2'/&gt;
&gt;&gt;&gt;    &lt;/disk&gt;
&gt;&gt;&gt;  &lt;/disks&gt;
&gt;&gt;&gt; &lt;/domainsnapshot&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; 2. Create snapshot of backing ZFS volume and send it to destination host.
&gt;&gt;&gt; 3. Migrate the domain
&gt;&gt;&gt;
&gt;&gt;&gt; Currently, in step 3 I need to create empty qcow snapshot file on the
&gt;&gt;&gt; destination host, otherwise the migration fails with: "Operation not
&gt;&gt;&gt; supported: pre-creation of storage targets for incremental storage
&gt;&gt;&gt; migration is not supported"
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt; So apart from this it does exactly what you want, right?
&gt;&gt;
&gt;&gt; My question is: Is it possible to do live migration with blockcommit
&gt;&gt;&gt; operation? If not, would it be hard to implement?
&gt;&gt;&gt;
&gt;&gt;&gt; I imagine it like I would start migration with some special parameter
&gt;&gt;&gt; (e.g.
&gt;&gt;&gt; VIR_MIGRATE_NON_SHARED_INC_COMMIT) which would only migrate data from
&gt;&gt;&gt; qcow
&gt;&gt;&gt; snapshot to destination storage.
&gt;&gt;&gt;
&gt;&gt;&gt; This would ensure the disk consistency and avoid useless whole disk copy.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt; What would be the difference compared to what you are doing now (plus a
&gt;&gt; block commit)?  VIR_MIGRATE_NON_SHARED_INC should already migrate only
&gt;&gt; the topmost disk of the whole chain.
&gt;&gt;
&gt;&gt; Of course lot can be added to the project, but I, for one, am not *that*
&gt;&gt; welcoming with regards to things that are meant for pretty narrow use
&gt;&gt; case while at the same time they are doable already, using libvirt's API.
&gt;&gt;
&gt;&gt; Or do you have any other idea how to solve this?
&gt;&gt;&gt;
&gt;&gt;&gt; BR.
&gt;&gt;&gt; Daniel Kucera.
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt;&gt; libvirt-users mailing list
&gt;&gt;&gt; libvirt-users@redhat.com
&gt;&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;&gt;
&gt;&gt;

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170428180408</emailId><senderName>Daniel Pocock</senderName><senderEmail>daniel@pocock.pro</senderEmail><timestampReceived>2017-04-28 18:04:08-0400</timestampReceived><subject>[libvirt-users] virt-manager / remote desktop latency issues</subject><body>



Hi,

I'm using virt-viewer to launch remote desktop connections

The connection to the KVM host is using ssh

The virtual machines/guests are running a GNOME desktop

I've observed some latency issues, for example, changing focus from one
terminal to another is a bit sluggish.  Typing isn't too bad.

The WAN connection is gigabit fibre from my home into a local data
center.  Ping times are about 0.8ms to the physical server.

Smokeping shows there is no packet loss and the latency is constant.

Can I do anything to tweak the .ssh/config to make it better?  It
occurred to me that adding "IPQoS lowdelay" might be useful as it
defaults to "throughput" for non-interactive connections.  Maybe
virt-manager should add that on the ssh command line?

Is there any way to see SPICE latency statistics in the virt-manager GUI?

Would any other SPICE viewer make a difference?

Are there any changes I should make to the GNOME desktop configuration
to make it work better through SPICE?

Can anybody make any other suggestions?

Regards,

Daniel

</body></email><email><emailId>20170428202743</emailId><senderName>Peter Steele</senderName><senderEmail>pwsteele@gmail.com</senderEmail><timestampReceived>2017-04-28 20:27:43-0400</timestampReceived><subject>Re: [libvirt-users] Does lxc support cputune/vcpusched option</subject><body>

I should add that I am running under CentOS 7.3 with kernel version 
3.10.0-514.6.2.

On 04/27/2017 01:40 PM, Peter Steele wrote:
&gt; I need a container that supports real time threads. According to the 
&gt; documentation, I can do something like this:
&gt;
&gt; &lt;domain type='lxc'&gt;
&gt;   &lt;name&gt;test1&lt;/name&gt;
&gt;   &lt;uuid&gt;e7446f55-3d59-4af0-90b2-d1498ac4370d&lt;/uuid&gt;
&gt; ...
&gt;   &lt;vcpu placement='auto'&gt;2&lt;/vcpu&gt;
&gt;   &lt;cputune&gt;
&gt;     &lt;vcpusched vcpus='0-1' scheduler='fifo' priority='1'/&gt;
&gt;   &lt;/cputune&gt;
&gt; ...
&gt; &lt;/domain&gt;
&gt;
&gt; The document describes the vcpusched element as follows:
&gt;
&gt; The optional |vcpusched| elements specifies the scheduler type (values 
&gt; |batch|, |idle|, |fifo|, |rr|) for particular vCPU/IOThread threads 
&gt; (based on |vcpus| and |iothreads|, leaving out |vcpus|/|iothreads| 
&gt; sets the default). Valid |vcpus| values start at 0 through one less 
&gt; than the number of vCPU's defined for the domain. Valid |iothreads| 
&gt; values are described in the |iothreadids| |description| 
&gt; &lt;https://libvirt.org/formatdomain.html#elementsIOThreadsAllocation&gt;. 
&gt; If no |iothreadids| are defined, then libvirt numbers IOThreads from 1 
&gt; to the number of |iothreads| available for the domain. For real-time 
&gt; schedulers (|fifo|, |rr|), priority must be specified as well (and is 
&gt; ignored for non-real-time ones). The value range for the priority 
&gt; depends on the host kernel (usually 1-99).
&gt;
&gt; So I *think* my xml is correct for this, but it doesn't seem to 
&gt; work--I still can't create real time threads in my container. Am I 
&gt; missing another configuration step somewhere?
&gt;
&gt; Peter
&gt;


[Attachment #3 (text/html)]

&lt;html&gt;
  &lt;head&gt;
    &lt;meta content="text/html; charset=utf-8" http-equiv="Content-Type"&gt;
  &lt;/head&gt;
  &lt;body text="#000000" bgcolor="#FFFFFF"&gt;
    I should add that I am running under CentOS 7.3 with kernel version
    3.10.0-514.6.2. &lt;br&gt;
    &lt;br&gt;
    &lt;div class="moz-cite-prefix"&gt;On 04/27/2017 01:40 PM, Peter Steele
      wrote:&lt;br&gt;
    &lt;/div&gt;
    &lt;blockquote cite="mid:59025749.7050102@gmail.com" type="cite"&gt;
      &lt;meta http-equiv="content-type" content="text/html; charset=utf-8"&gt;
      I need a container that supports real time threads. According to
      the documentation, I can do something like this:&lt;br&gt;
      &lt;br&gt;
      &lt;domain type='lxc'&gt;&lt;br&gt;
        &lt;name&gt;test1&lt;/name&gt;&lt;br&gt;
        &lt;uuid&gt;e7446f55-3d59-4af0-90b2-d1498ac4370d&lt;/uuid&gt;&lt;br&gt;
      ...&lt;br&gt;
        &lt;vcpu placement='auto'&gt;2&lt;/vcpu&gt;&lt;br&gt;
        &lt;cputune&gt;&lt;br&gt;
          &lt;vcpusched vcpus='0-1' scheduler='fifo' priority='1'/&gt;&lt;br&gt;
        &lt;/cputune&gt;&lt;br&gt;
      ...&lt;br&gt;
      &lt;/domain&gt;&lt;br&gt;
      &lt;br&gt;
      The document describes the vcpusched element as follows:&lt;br&gt;
      &lt;br&gt;
      The optional &lt;code&gt;vcpusched&lt;/code&gt; elements specifies the
      scheduler type (values &lt;code&gt;batch&lt;/code&gt;, &lt;code&gt;idle&lt;/code&gt;, &lt;code&gt;fifo&lt;/code&gt;,
      &lt;code&gt;rr&lt;/code&gt;) for particular vCPU/IOThread threads (based on &lt;code&gt;vcpus&lt;/code&gt;
      and &lt;code&gt;iothreads&lt;/code&gt;, leaving out &lt;code&gt;vcpus&lt;/code&gt;/&lt;code&gt;iothreads&lt;/code&gt;
      sets the default). Valid &lt;code&gt;vcpus&lt;/code&gt; values start at 0
      through one less than the number of vCPU's defined for the domain.
      Valid &lt;code&gt;iothreads&lt;/code&gt; values are described in the &lt;code&gt;iothreadids&lt;/code&gt;
      &lt;a moz-do-not-send="true"
        href="https://libvirt.org/formatdomain.html#elementsIOThreadsAllocation"
        shape="rect"&gt;&lt;code&gt;description&lt;/code&gt;&lt;/a&gt;. If no &lt;code&gt;iothreadids&lt;/code&gt;
      are defined, then libvirt numbers IOThreads from 1 to the number
      of &lt;code&gt;iothreads&lt;/code&gt; available for the domain. For real-time
      schedulers (&lt;code&gt;fifo&lt;/code&gt;, &lt;code&gt;rr&lt;/code&gt;), priority must be
      specified as well (and is ignored for non-real-time ones). The
      value range for the priority depends on the host kernel (usually
      1-99).&lt;br&gt;
      &lt;br&gt;
      So I *think* my xml is correct for this, but it doesn't seem to
      work--I still can't create real time threads in my container. Am I
      missing another configuration step somewhere?&lt;br&gt;
      &lt;br&gt;
      Peter&lt;br&gt;
      &lt;br&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
  &lt;/body&gt;
&lt;/html&gt;


</body></email><email><emailId>20170428230118</emailId><senderName>JosÉ_Luis_Valencia_Gutierrez</senderName><senderEmail>jvalencia@id.uff.br</senderEmail><timestampReceived>2017-04-28 23:01:18-0400</timestampReceived><subject>[libvirt-users] No way to stop virStream error after guest stop</subject><body>

Hello everyone,
I am opening a virChannel(unix) to a domain and receiving data with a
non-blocking virStream using events, when the connected domain gets
stopped(which deletes the channel unix socket) by calling destroy,
shutdown, pause or migrate on that domain, with the stream open the read
event is triggered repeatedly, and virStreamRecv returns 0 bytes indicating
 EOF but neither  virStreamFinish nor virStreamFinish is working to stop
the stream to trigger the event . Each time the event is called I got this
errors.

libvirt: I/O Stream Utils error : this function is not supported by
the connection driver: virStreamRecv

libvirt: I/O Stream Utils error : this function is not supported by
the connection driver: virStreamFinish

libvirt: I/O Stream Utils error : this function is not supported by
the connection driver: virStreamEventRemoveCallback


Is there other way to stop getting this errors? or perhaps this is a bug.

Thanks in advance.

Jose Valencia

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hello everyone,&lt;div&gt;I am opening a virChannel(unix) to a domain and \
receiving data with a non-blocking virStream using events, when the connected domain \
gets stopped(which deletes the channel unix socket) by calling destroy, shutdown, \
pause or migrate on that domain, with the stream open the read event is triggered \
repeatedly, and virStreamRecv returns 0 bytes indicating   EOF but neither   \
virStreamFinish nor virStreamFinish  is working to stop the stream to trigger the \
event . Each time the event is called I got this \
errors.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;pre&gt;libvirt: I/O Stream Utils error : this function \
is not supported by the connection driver: virStreamRecv&lt;/pre&gt;&lt;pre&gt;libvirt: I/O \
Stream Utils error : this function is not supported by the connection driver: \
virStreamFinish&lt;/pre&gt;&lt;pre&gt;libvirt: I/O Stream Utils error : this function is not \
supported by the connection driver: \
virStreamEventRemoveCallback&lt;/pre&gt;&lt;pre&gt;&lt;br&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font face="sans-serif"&gt;Is \
there other way to stop getting this errors? or perhaps this is a \
bug.&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font face="sans-serif"&gt;Thanks in \
advance.&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font face="sans-serif"&gt;Jose Valencia&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt; \
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170430171215</emailId><senderName>Stefano Ricci</senderName><senderEmail>sfn.rcc@gmail.com</senderEmail><timestampReceived>2017-04-30 17:12:15-0400</timestampReceived><subject>Re: [libvirt-users] Libvirtd freezes</subject><body>

2017-04-29 7:24 GMT+02:00 Michal Privoznik &lt;mprivozn@redhat.com&gt;:
&gt; On 04/29/2017 04:38 AM, Stefano Ricci wrote:
&gt;&gt; 2017-04-28 14:33 GMT+02:00 Michal Privoznik &lt;mprivozn@redhat.com&gt;:
&gt;&gt;&gt; On 04/27/2017 04:31 PM, Stefano Ricci wrote:
&gt;&gt;&gt;&gt; Here is the backtrace of the libvirt process just started
&gt;&gt;&gt;
&gt;&gt;&gt; [Just a side note, you shouldn't top post on technical lists. Gmail
&gt;&gt;&gt; sucks at this.]
&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; https://pastebin.com/R66myzFp
&gt;&gt;&gt;
&gt;&gt;&gt; Looks like libvirtd is trying to spawn /usr/bin/qemu-system-x86_64 but
&gt;&gt;&gt; it takes ages to init. In the debug logs you might see the actual
&gt;&gt;&gt; command line that libvirt tries to execute. You can try running it by
&gt;&gt;&gt; hand and see if it takes about the same time. If so, then it's a qemu bug.
&gt;&gt;&gt;
&gt;&gt;&gt; http://wiki.libvirt.org/page/DebugLogs
&gt;&gt;&gt;
&gt;&gt;&gt; Michal
&gt;&gt;
&gt;&gt; The line that comes from the libvirt log is as follows:
&gt;&gt; LC_ALL=C PATH=/bin:/usr/bin:/sbin:/usr/sbin HOME=/ USER=root
&gt;&gt; /usr/bin/qemu-system-x86_64 -S -no-user-config -nodefaults -nographic
&gt;&gt; -M none -qmp unix:/var/lib/libvirt/qemu/capabilities.monitor.sock,server,nowait
&gt;&gt; -pidfile /var/lib/libvirt/qemu/capabilities.pidfile -daemonize
&gt;&gt; Before I run the command manually I added the -D parameter to write
&gt;&gt; the qemu process stderr in a log file.
&gt;&gt; Once the command is executed, the log file is blank then error-free
&gt;&gt; and the process seems to respond correctly.
&gt;&gt; I have connected with the following command: nc -U
&gt;&gt; /var/lib/libvirt/qemu/capabilities.monitor.sock
&gt;&gt; and this is an extract of qemu output to my requests:
&gt;&gt; {"QMP": {"version": {"qemu": {"micro": 1, "minor": 8, "major": 2},
&gt;&gt; "package": ""}, "capabilities": []}}
&gt;&gt; { "execute": "qmp_capabilities" }
&gt;&gt; {"return": {}}
&gt;&gt; { "execute": "query-commands" }
&gt;&gt; {"return": [{"name": "xen-set-global-dirty-log"}, {"name":
&gt;&gt; "xen-save-devices-state"}, {"name": "xen-load-devices-state"},
&gt;&gt; {"name": "x-colo-lost-heartbeat"}, {"name":
&gt;&gt; "x-blockdev-remove-medium"}, {"name": "x-blockdev-insert-medium"},
&gt;&gt; {"name": "x-blockdev-del"}, {"name": "x-blockdev-change"}, {"name":
&gt;&gt; "transaction"}, {"name": "trace-event-set-state"}, {"name":
&gt;&gt; "trace-event-get-state"}, {"name": "system_wakeup"}, {"name":
&gt;&gt; "system_reset"}, {"name": "system_powerdown"}, {"name": "stop"},
&gt;&gt; {"name": "set_password"}, {"name": "set_link"}, {"name": "send-key"},
&gt;&gt; {"name": "screendump"}, {"name": "rtc-reset-reinjection"}, {"name":
&gt;&gt; "ringbuf-write"}, {"name": "ringbuf-read"}, {"name": "remove-fd"},
&gt;&gt; {"name": "quit"}, {"name": "query-vnc-servers"}, {"name":
&gt;&gt; "query-vnc"}, {"name": "query-version"}, {"name": "query-uuid"},
&gt;&gt; {"name": "query-tpm-types"}, {"name": "query-tpm-models"}, {"name":
&gt;&gt; "query-tpm"}, {"name": "query-target"}, {"name": "query-status"},
&gt;&gt; {"name": "query-spice"}, {"name": "query-rx-filter"}, {"name":
&gt;&gt; "query-rocker-ports"}, {"name": "query-rocker-of-dpa-groups"},
&gt;&gt; {"name": "query-rocker-of-dpa-flows"}, {"name": "query-rocker"},
&gt;&gt; {"name": "query-pci"}, {"name": "query-named-block-nodes"}, {"name":
&gt;&gt; "query-name"}, {"name": "query-migrate-parameters"}, {"name":
&gt;&gt; "query-migrate-capabilities"}, {"name": "query-migrate-cache-size"},
&gt;&gt; {"name": "query-migrate"}, {"name": "query-mice"}, {"name":
&gt;&gt; "query-memory-devices"}, {"name": "query-memdev"}, {"name":
&gt;&gt; "query-machines"}, {"name": "query-kvm"}, {"name": "query-iothreads"},
&gt;&gt; {"name": "query-hotpluggable-cpus"}, {"name": "query-fdsets"},
&gt;&gt; {"name": "query-events"}, {"name":
&gt;&gt; "query-dump-guest-memory-capability"}, {"name": "query-dump"},
&gt;&gt; {"name": "query-cpus"}, {"name": "query-cpu-definitions"}, {"name":
&gt;&gt; "query-commands"}, {"name": "query-command-line-options"}, {"name":
&gt;&gt; "query-chardev-backends"}, {"name": "query-chardev"}, {"name":
&gt;&gt; "query-blockstats"}, {"name": "query-block-jobs"}, {"name":
&gt;&gt; "query-block"}, {"name": "query-balloon"}, {"name":
&gt;&gt; "query-acpi-ospm-status"}, {"name": "qom-set"}, {"name":
&gt;&gt; "qom-list-types"}, {"name": "qom-list"}, {"name": "qom-get"}, {"name":
&gt;&gt; "qmp_capabilities"}, {"name": "pmemsave"}, {"name": "object-del"},
&gt;&gt; {"name": "object-add"}, {"name": "netdev_del"} .......
&gt;&gt; So it would not look like a qemu bug.
&gt;
&gt; Well, this does not prove that qemu replies to all commands issued by
&gt; libvirt. For that we would need debug logs as referred to above.
&gt;
&gt; BTW: The stack trace looks a bit old (the line number do not match with
&gt; the current git HEAD) - what's the release you're running and does the
&gt; problem occur with the current git HEAD too?
&gt;
&gt; Michal

The version used for backtrace is 3.2.0, now I have also tried the
current downloaded with git but the problem is always present.
This is the current version log file, set as shown on the DebugLogs page:

https://drive.google.com/open?id=0By9lwQyveHENdEt4aEtZcUV3ZEU

Stefano

</body></email><email><emailId>20170103220628</emailId><senderName>Laine Stump</senderName><senderEmail>laine@laine.org</senderEmail><timestampReceived>2017-01-03 22:06:28-0400</timestampReceived><subject>Re: [libvirt-users] Default firewall rules and forwarding to a guest</subject><body>

On 12/22/2016 09:48 AM, Omer Aldemir wrote:
&gt;
&gt; Hello,
&gt;
&gt;
&gt; I am trying to understand how libvirt firewall rules are loaded as I 
&gt; have firewalld and iptables services are disabled.
&gt;

libvirt will add its iptables rules via firewalld if firewalld is 
enabled and running, otherwise it executes iptables commands directly.

w
&gt;
&gt;
&gt; Where is the configuration files for firewall and NAT  rules for libvirt?
&gt;

There are no configuration files for the iptables rules that libvirt 
adds. The simple set of rules that is added is fixed for each type of 
libvirt network - NAT, routed, and isolated. Here is a description of 
exactly what is added for each of these types of network:

    https://libvirt.org/firewall.html

(actually I just realized that I forgot to add information there about a 
new network forwarding type I recently added - "open", which doesn't add 
*any* iptables rules - this is intended for those who want to do their 
own iptables setup for libvirt networks, outside of libvirt.)

&gt; How can I load default firewall rules if I mess things up
&gt;

To reload all the iptables rules for all active libvirt networks, just 
restart the libvirtd service.

&gt;
&gt; Also I have realized that followings is default
&gt;
&gt;
&gt; ACCEPT     all  --  0.0.0.0/0 192.168.122.0/24     ctstate 
&gt; RELATED,ESTABLISHED
&gt;
&gt;
&gt; but If I am to forward a port for a real IP to internal guest 
&gt; machine I need
&gt;
&gt;
&gt; ACCEPT     all  --  0.0.0.0/0 192.168.122.0/24     state 
&gt; NEW,RELATED,ESTABLISHED
&gt;
&gt;
&gt; (NEW state is required) and also of course a forwarding rule
&gt;
&gt;
&gt; iptables -t nat -I PREROUTING -p tcp --dport 3389 -j DNAT 
&gt; --to-destination 192.168.122.16:3389
&gt;
&gt;
&gt; Is there a place I can make this rules static with LibVirt (not 
&gt; playing with firewalld  and/or iptables service for Centos 7)
&gt;

The best that can be done with current libvirt is to create a "hook" 
script similar to the one described here:

https://wiki.libvirt.org/page/Networking#Forwarding_Incoming_Connections

(That worked the last time I tried it, but that was at least 3 years 
ago. The python script available as a link from that page is newer and 
promises to be easier to understand (maybe))

[Attachment #3 (text/html)]

&lt;html&gt;
  &lt;head&gt;
    &lt;meta content="text/html; charset=utf-8" http-equiv="Content-Type"&gt;
  &lt;/head&gt;
  &lt;body bgcolor="#FFFFFF" text="#000000"&gt;
    &lt;div class="moz-cite-prefix"&gt;On 12/22/2016 09:48 AM, Omer Aldemir
      wrote:&lt;br&gt;
    &lt;/div&gt;
    &lt;blockquote
cite="mid:AMSPR06MB277EBC427FC12F38F37BA32B8920@AMSPR06MB277.eurprd06.prod.outlook.com"
  type="cite"&gt;
      &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
      &lt;style type="text/css" style="display:none;"&gt;&lt;!-- P \
{margin-top:0;margin-bottom:0;} --&gt;&lt;/style&gt;  &lt;div id="divtagdefaultwrapper"
style="font-size:12pt;color:#000000;font-family:Calibri,Arial,Helvetica,sans-serif;"
        dir="ltr"&gt;
        &lt;p&gt;Hello,&lt;/p&gt;
        &lt;p&gt;&lt;br&gt;
        &lt;/p&gt;
        &lt;p&gt;I am trying to understand how libvirt firewall rules are
          loaded as I have firewalld and iptables services are disabled.&lt;/p&gt;
      &lt;/div&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
    libvirt will add its iptables rules via firewalld if firewalld is
    enabled and running, otherwise it executes iptables commands
    directly.&lt;br&gt;
    &lt;br&gt;
    w&lt;br&gt;
    &lt;blockquote
cite="mid:AMSPR06MB277EBC427FC12F38F37BA32B8920@AMSPR06MB277.eurprd06.prod.outlook.com"
  type="cite"&gt;
      &lt;div id="divtagdefaultwrapper"
style="font-size:12pt;color:#000000;font-family:Calibri,Arial,Helvetica,sans-serif;"
        dir="ltr"&gt;
        &lt;p&gt;&lt;br&gt;
        &lt;/p&gt;
        &lt;p&gt;Where is the configuration files for firewall and NAT  rules
          for libvirt?&lt;/p&gt;
      &lt;/div&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
    There are no configuration files for the iptables rules that libvirt
    adds. The simple set of rules that is added is fixed for each type
    of libvirt network - NAT, routed, and isolated. Here is a
    description of exactly what is added for each of these types of
    network:&lt;br&gt;
    &lt;br&gt;
       &lt;a class="moz-txt-link-freetext" \
href="https://libvirt.org/firewall.html"&gt;https://libvirt.org/firewall.html&lt;/a&gt;&lt;br&gt;  \
&lt;br&gt;  (actually I just realized that I forgot to add information there
    about a new network forwarding type I recently added - "open", which
    doesn't add *any* iptables rules - this is intended for those who
    want to do their own iptables setup for libvirt networks, outside of
    libvirt.)&lt;br&gt;
    &lt;br&gt;
    &lt;blockquote
cite="mid:AMSPR06MB277EBC427FC12F38F37BA32B8920@AMSPR06MB277.eurprd06.prod.outlook.com"
  type="cite"&gt;
      &lt;div id="divtagdefaultwrapper"
style="font-size:12pt;color:#000000;font-family:Calibri,Arial,Helvetica,sans-serif;"
        dir="ltr"&gt;
        &lt;p&gt;How can I load default firewall rules if I mess things up&lt;/p&gt;
      &lt;/div&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
    To reload all the iptables rules for all active libvirt networks,
    just restart the libvirtd service.&lt;br&gt;
    &lt;br&gt;
    &lt;blockquote
cite="mid:AMSPR06MB277EBC427FC12F38F37BA32B8920@AMSPR06MB277.eurprd06.prod.outlook.com"
  type="cite"&gt;
      &lt;div id="divtagdefaultwrapper"
style="font-size:12pt;color:#000000;font-family:Calibri,Arial,Helvetica,sans-serif;"
        dir="ltr"&gt;
        &lt;p&gt;&lt;br&gt;
        &lt;/p&gt;
        &lt;p&gt;Also I have realized that followings is default &lt;/p&gt;
        &lt;p&gt;&lt;br&gt;
        &lt;/p&gt;
        &lt;p&gt;&lt;span&gt;ACCEPT     all  --  0.0.0.0/0           
            192.168.122.0/24     ctstate RELATED,ESTABLISHED&lt;/span&gt;&lt;/p&gt;
        &lt;p&gt;&lt;span&gt;&lt;br&gt;
          &lt;/span&gt;&lt;/p&gt;
        &lt;p&gt;&lt;span&gt;but If I am to forward a port for a real IP to internal
            guest machine I need
          &lt;/span&gt;&lt;/p&gt;
        &lt;p&gt;&lt;span&gt;&lt;br&gt;
          &lt;/span&gt;&lt;/p&gt;
        &lt;p&gt;&lt;span&gt;&lt;span&gt;ACCEPT     all  --  0.0.0.0/0           
              192.168.122.0/24     state NEW,RELATED,ESTABLISHED&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
        &lt;p&gt;&lt;span&gt;&lt;br&gt;
          &lt;/span&gt;&lt;/p&gt;
        &lt;p&gt;&lt;span&gt;(NEW state is required) and also of course a forwarding
            rule&lt;/span&gt;&lt;/p&gt;
        &lt;p&gt;&lt;span&gt;&lt;br&gt;
          &lt;/span&gt;&lt;/p&gt;
        &lt;p&gt;&lt;span&gt;&lt;span&gt;iptables -t nat -I PREROUTING -p tcp --dport 3389
              -j DNAT --to-destination 192.168.122.16:3389&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
        &lt;p&gt;&lt;span&gt;&lt;br&gt;
          &lt;/span&gt;&lt;/p&gt;
        &lt;p&gt;&lt;span&gt;Is there a place I can make this rules static with
            LibVirt (not playing with firewalld  and/or iptables service
            for Centos 7)&lt;/span&gt;&lt;/p&gt;
      &lt;/div&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
    The best that can be done with current libvirt is to create a "hook"
    script similar to the one described here:&lt;br&gt;
    &lt;br&gt;
&lt;a class="moz-txt-link-freetext" \
href="https://wiki.libvirt.org/page/Networking#Forwarding_Incoming_Connections"&gt;https://wiki.libvirt.org/page/Networking#Forwarding_Incoming_Connections&lt;/a&gt;&lt;br&gt;
  &lt;br&gt;
    (That worked the last time I tried it, but that was at least 3 years
    ago. The python script available as a link from that page is newer
    and promises to be easier to understand (maybe))&lt;br&gt;
  &lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170201153234</emailId><senderName>"Richard W.M. Jones"</senderName><senderEmail>rjones@redhat.com</senderEmail><timestampReceived>2017-02-01 15:32:34-0400</timestampReceived><subject>Re: [libvirt-users] virt-p2v - Windows 10 guest hangs at boot after successful P2V</subject><body>

On Mon, Jan 09, 2017 at 09:17:47AM -0600, JT Edwards wrote:
&gt; Hi all,
&gt; 
&gt; I successfully virt-p2v'ed a Windows 10 laptop to my Centos 7.3 instance
&gt; running KVM. However, on boot, the guest hangs. Is there a registry fix
&gt; that is needed after the P2V is done? Here is what is in the guest's
&gt; logfile:

We don't normally check this mailing list for virt-p2v problems which
is why I didn't see this message before.

If you are still having issues, then you'll need to find the full
debug logs, post them on a web server somewhere else, and send a
message pointing to them to libguestfs@redhat.com.  (See also
http://libguestfs.org/virt-p2v.1.html#how-virt-p2v-works )

Rich.

-- 
Richard Jones, Virtualization Group, Red Hat http://people.redhat.com/~rjones
Read my programming and virtualization blog: http://rwmj.wordpress.com
virt-builder quickly builds VMs from scratch
http://libguestfs.org/virt-builder.1.html

</body></email><email><emailId>20170301091146</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-03-01 09:11:46-0400</timestampReceived><subject>Re: [libvirt-users] Bluetooth Device Support</subject><body>

On Tue, Feb 28, 2017 at 09:33:16PM +0000, Max Ehrlich wrote:
&gt; Hi,
&gt; 
&gt; I want to create a virtual hci device on my virtual machine. I have seen
&gt; that qemu has options supporting this
&gt; 
&gt; https://qemu.weilnetz.de/doc/qemu-doc.html#Bluetooth_0028R_0029-options
&gt; 
&gt; and
&gt; 
&gt; https://qemu.weilnetz.de/doc/qemu-doc.html#pcsys_005fusb
&gt; 
&gt; Is there any support for these options in libvirt? I was not able to find

No, libvirt doesn't have explicit support for bluetooh at this time.

&gt; anything in documentation so I added the qemu command line xml as follows
&gt; &lt;qemu:commandline&gt;
&gt;     &lt;qemu:arg value='-usbdevice'/&gt;
&gt;     &lt;qemu:arg value='bt:hci'/&gt;
&gt;     &lt;qemu:arg value='-bt'/&gt;
&gt;     &lt;qemu:arg value='hci,host'/&gt;
&gt;   &lt;/qemu:commandline&gt;
&gt; 
&gt; but when I try to run my machine from virt-manager i get the following
&gt; error:
&gt; 
&gt; Error starting domain: internal error: process exited while connecting to
&gt; monitor: 2017-02-28T21:25:51.735987Z qemu-system-x86_64: -device
&gt; ich9-usb-ehci1,id=usb,bus=pcie.0,addr=0x1d.0x7: PCI: slot 29 function 7 not
&gt; available for ich9-usb-ehci1, in use by ich9-usb-ehci1
&gt; 
&gt; this error does not appear if I remove the commandline xml nodes
&gt; 
&gt; Does anyone have any guidance for troubleshooting this?

Libvirt assigns PCI addresses for every device it adds. QEMU will assign
addresses for any device that doesn't have an address present. Your
custom device is missing an address and QEMU is asigning one, unaware that
the address it picks will clash with one assigned by libvirt.

To fix this you probably need to add addressing to your device addition,
but I'm unclear about exactly how the bluetooth devices work in QEMU so
can't give an explicit recommendation


Regards,
Daniel
-- 
|: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
|: http://libvirt.org              -o-             http://virt-manager.org :|
|: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|

</body></email><email><emailId>20170301122259</emailId><senderName>Max Ehrlich</senderName><senderEmail>max.ehr@gmail.com</senderEmail><timestampReceived>2017-03-01 12:22:59-0400</timestampReceived><subject>Re: [libvirt-users] Bluetooth Device Support</subject><body>

Daniel,

Thanks for the reply.

This is pretty much what I had assumed. I would guess that assigning any
free address, or telling qemu to plug the bt device into a controller that
libvirt creates, might work, but I cant find anything in the documentation
for qemu that would assign an address via command line. Do you know how to
do it?

thanks,
Max

On Wed, Mar 1, 2017 at 4:11 AM Daniel P. Berrange &lt;berrange@redhat.com&gt;
wrote:

&gt; On Tue, Feb 28, 2017 at 09:33:16PM +0000, Max Ehrlich wrote:
&gt; &gt; Hi,
&gt; &gt;
&gt; &gt; I want to create a virtual hci device on my virtual machine. I have seen
&gt; &gt; that qemu has options supporting this
&gt; &gt;
&gt; &gt; https://qemu.weilnetz.de/doc/qemu-doc.html#Bluetooth_0028R_0029-options
&gt; &gt;
&gt; &gt; and
&gt; &gt;
&gt; &gt; https://qemu.weilnetz.de/doc/qemu-doc.html#pcsys_005fusb
&gt; &gt;
&gt; &gt; Is there any support for these options in libvirt? I was not able to find
&gt;
&gt; No, libvirt doesn't have explicit support for bluetooh at this time.
&gt;
&gt; &gt; anything in documentation so I added the qemu command line xml as follows
&gt; &gt; &lt;qemu:commandline&gt;
&gt; &gt;     &lt;qemu:arg value='-usbdevice'/&gt;
&gt; &gt;     &lt;qemu:arg value='bt:hci'/&gt;
&gt; &gt;     &lt;qemu:arg value='-bt'/&gt;
&gt; &gt;     &lt;qemu:arg value='hci,host'/&gt;
&gt; &gt;   &lt;/qemu:commandline&gt;
&gt; &gt;
&gt; &gt; but when I try to run my machine from virt-manager i get the following
&gt; &gt; error:
&gt; &gt;
&gt; &gt; Error starting domain: internal error: process exited while connecting to
&gt; &gt; monitor: 2017-02-28T21:25:51.735987Z qemu-system-x86_64: -device
&gt; &gt; ich9-usb-ehci1,id=usb,bus=pcie.0,addr=0x1d.0x7: PCI: slot 29 function 7
&gt; not
&gt; &gt; available for ich9-usb-ehci1, in use by ich9-usb-ehci1
&gt; &gt;
&gt; &gt; this error does not appear if I remove the commandline xml nodes
&gt; &gt;
&gt; &gt; Does anyone have any guidance for troubleshooting this?
&gt;
&gt; Libvirt assigns PCI addresses for every device it adds. QEMU will assign
&gt; addresses for any device that doesn't have an address present. Your
&gt; custom device is missing an address and QEMU is asigning one, unaware that
&gt; the address it picks will clash with one assigned by libvirt.
&gt;
&gt; To fix this you probably need to add addressing to your device addition,
&gt; but I'm unclear about exactly how the bluetooth devices work in QEMU so
&gt; can't give an explicit recommendation
&gt;
&gt;
&gt; Regards,
&gt; Daniel
&gt; --
&gt; |: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/
&gt; :|
&gt; |: http://libvirt.org              -o-             http://virt-manager.org
&gt; :|
&gt; |: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/
&gt; :|
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Daniel,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks for the \
reply.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This is pretty much what I had assumed. I would guess \
that assigning any free address, or telling qemu to plug the bt device into a \
controller that libvirt creates, might work, but I cant find anything in the \
documentation for qemu that would assign an address via command line. Do you know how \
to do it?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;thanks,&lt;/div&gt;&lt;div&gt;Max&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;&lt;div dir="ltr"&gt;On Wed, Mar 1, 2017 at 4:11 AM Daniel P. Berrange \
&lt;&lt;a href="mailto:berrange@redhat.com"&gt;berrange@redhat.com&lt;/a&gt;&gt; \
wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;On Tue, Feb 28, 2017 at 09:33:16PM \
+0000, Max Ehrlich wrote:&lt;br class="gmail_msg"&gt; &gt; Hi,&lt;br class="gmail_msg"&gt;
&gt;&lt;br class="gmail_msg"&gt;
&gt; I want to create a virtual hci device on my virtual machine. I have seen&lt;br \
class="gmail_msg"&gt; &gt; that qemu has options supporting this&lt;br class="gmail_msg"&gt;
&gt;&lt;br class="gmail_msg"&gt;
&gt; &lt;a href="https://qemu.weilnetz.de/doc/qemu-doc.html#Bluetooth_0028R_0029-options" \
rel="noreferrer" class="gmail_msg" \
target="_blank"&gt;https://qemu.weilnetz.de/doc/qemu-doc.html#Bluetooth_0028R_0029-options&lt;/a&gt;&lt;br \
class="gmail_msg"&gt; &gt;&lt;br class="gmail_msg"&gt;
&gt; and&lt;br class="gmail_msg"&gt;
&gt;&lt;br class="gmail_msg"&gt;
&gt; &lt;a href="https://qemu.weilnetz.de/doc/qemu-doc.html#pcsys_005fusb" \
rel="noreferrer" class="gmail_msg" \
target="_blank"&gt;https://qemu.weilnetz.de/doc/qemu-doc.html#pcsys_005fusb&lt;/a&gt;&lt;br \
class="gmail_msg"&gt; &gt;&lt;br class="gmail_msg"&gt;
&gt; Is there any support for these options in libvirt? I was not able to find&lt;br \
class="gmail_msg"&gt; &lt;br class="gmail_msg"&gt;
No, libvirt doesn't have explicit support for bluetooh at this time.&lt;br \
class="gmail_msg"&gt; &lt;br class="gmail_msg"&gt;
&gt; anything in documentation so I added the qemu command line xml as follows&lt;br \
class="gmail_msg"&gt; &gt; &lt;qemu:commandline&gt;&lt;br class="gmail_msg"&gt;
&gt;        &lt;qemu:arg value='-usbdevice'/&gt;&lt;br class="gmail_msg"&gt;
&gt;        &lt;qemu:arg value='bt:hci'/&gt;&lt;br class="gmail_msg"&gt;
&gt;        &lt;qemu:arg value='-bt'/&gt;&lt;br class="gmail_msg"&gt;
&gt;        &lt;qemu:arg value='hci,host'/&gt;&lt;br class="gmail_msg"&gt;
&gt;     &lt;/qemu:commandline&gt;&lt;br class="gmail_msg"&gt;
&gt;&lt;br class="gmail_msg"&gt;
&gt; but when I try to run my machine from virt-manager i get the following&lt;br \
class="gmail_msg"&gt; &gt; error:&lt;br class="gmail_msg"&gt;
&gt;&lt;br class="gmail_msg"&gt;
&gt; Error starting domain: internal error: process exited while connecting to&lt;br \
class="gmail_msg"&gt; &gt; monitor: 2017-02-28T21:25:51.735987Z qemu-system-x86_64: \
-device&lt;br class="gmail_msg"&gt; &gt; ich9-usb-ehci1,id=usb,bus=pcie.0,addr=0x1d.0x7: \
PCI: slot 29 function 7 not&lt;br class="gmail_msg"&gt; &gt; available for ich9-usb-ehci1, \
in use by ich9-usb-ehci1&lt;br class="gmail_msg"&gt; &gt;&lt;br class="gmail_msg"&gt;
&gt; this error does not appear if I remove the commandline xml nodes&lt;br \
class="gmail_msg"&gt; &gt;&lt;br class="gmail_msg"&gt;
&gt; Does anyone have any guidance for troubleshooting this?&lt;br class="gmail_msg"&gt;
&lt;br class="gmail_msg"&gt;
Libvirt assigns PCI addresses for every device it adds. QEMU will assign&lt;br \
class="gmail_msg"&gt; addresses for any device that doesn't have an address present. \
Your&lt;br class="gmail_msg"&gt; custom device is missing an address and QEMU is asigning \
one, unaware that&lt;br class="gmail_msg"&gt; the address it picks will clash with one \
assigned by libvirt.&lt;br class="gmail_msg"&gt; &lt;br class="gmail_msg"&gt;
To fix this you probably need to add addressing to your device addition,&lt;br \
class="gmail_msg"&gt; but I'm unclear about exactly how the bluetooth devices work \
in QEMU so&lt;br class="gmail_msg"&gt; can't give an explicit recommendation&lt;br \
class="gmail_msg"&gt; &lt;br class="gmail_msg"&gt;
&lt;br class="gmail_msg"&gt;
Regards,&lt;br class="gmail_msg"&gt;
Daniel&lt;br class="gmail_msg"&gt;
--&lt;br class="gmail_msg"&gt;
&gt; &gt; &lt;a href="http://berrange.com" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://berrange.com&lt;/a&gt;         -o-      &lt;a \
&gt; &gt; href="http://www.flickr.com/photos/dberrange/" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://www.flickr.com/photos/dberrange/&lt;/a&gt; :|&lt;br \
&gt; &gt; class="gmail_msg"&gt;
&gt; &gt; &lt;a href="http://libvirt.org" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://libvirt.org&lt;/a&gt;                     -o-                    \
&gt; &gt; &lt;a href="http://virt-manager.org" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://virt-manager.org&lt;/a&gt; :|&lt;br class="gmail_msg"&gt;
&gt; &gt; &lt;a href="http://entangle-photo.org" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://entangle-photo.org&lt;/a&gt;           -o-      &lt;a \
&gt; &gt; href="http://search.cpan.org/~danberr/" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://search.cpan.org/~danberr/&lt;/a&gt; :|&lt;br class="gmail_msg"&gt;
&lt;/blockquote&gt;&lt;/div&gt;



</body></email><email><emailId>20170103234424</emailId><senderName>Omer Aldemir</senderName><senderEmail>omeraldemir83@outlook.com</senderEmail><timestampReceived>2017-01-03 23:44:24-0400</timestampReceived><subject>Re: [libvirt-users] Default firewall rules and forwarding to a guest</subject><body>

Thanks for the answers i think open network type is not available yet on th=
e version that comes with rhel7

On 3 Jan 2017, at 22:06, Laine Stump &lt;laine@laine.org&lt;mailto:laine@laine.or=
g&gt;&gt; wrote:

On 12/22/2016 09:48 AM, Omer Aldemir wrote:

Hello,


I am trying to understand how libvirt firewall rules are loaded as I have f=
irewalld and iptables services are disabled.

libvirt will add its iptables rules via firewalld if firewalld is enabled a=
nd running, otherwise it executes iptables commands directly.

w


Where is the configuration files for firewall and NAT  rules for libvirt?

There are no configuration files for the iptables rules that libvirt adds. =
The simple set of rules that is added is fixed for each type of libvirt net=
work - NAT, routed, and isolated. Here is a description of exactly what is =
added for each of these types of network:

   https://libvirt.org/firewall.html

(actually I just realized that I forgot to add information there about a ne=
w network forwarding type I recently added - "open", which doesn't add *any=
* iptables rules - this is intended for those who want to do their own ipta=
bles setup for libvirt networks, outside of libvirt.)


How can I load default firewall rules if I mess things up

To reload all the iptables rules for all active libvirt networks, just rest=
art the libvirtd service.



Also I have realized that followings is default


ACCEPT     all  --  0.0.0.0/0            192.168.122.0/24     ctstate RELAT=
ED,ESTABLISHED


but If I am to forward a port for a real IP to internal guest machine I nee=
d


ACCEPT     all  --  0.0.0.0/0            192.168.122.0/24     state NEW,REL=
ATED,ESTABLISHED


(NEW state is required) and also of course a forwarding rule


iptables -t nat -I PREROUTING -p tcp --dport 3389 -j DNAT --to-destination =
192.168.122.16:3389


Is there a place I can make this rules static with LibVirt (not playing wit=
h firewalld  and/or iptables service for Centos 7)

The best that can be done with current libvirt is to create a "hook" script=
 similar to the one described here:

https://wiki.libvirt.org/page/Networking#Forwarding_Incoming_Connections

(That worked the last time I tried it, but that was at least 3 years ago. T=
he python script available as a link from that page is newer and promises t=
o be easier to understand (maybe))

[Attachment #3 (text/html)]

&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=us-ascii"&gt;
&lt;/head&gt;
&lt;body dir="auto"&gt;
&lt;div&gt;Thanks for the answers i think open network type is not available yet on the \
version that comes with rhel7&lt;br&gt; &lt;/div&gt;
&lt;div&gt;&lt;br&gt;
On 3 Jan 2017, at 22:06, Laine Stump &lt;&lt;a \
href="mailto:laine@laine.org"&gt;laine@laine.org&lt;/a&gt;&gt; wrote:&lt;br&gt; &lt;br&gt;
&lt;/div&gt;
&lt;blockquote type="cite"&gt;
&lt;div&gt;
&lt;div class="moz-cite-prefix"&gt;On 12/22/2016 09:48 AM, Omer Aldemir wrote:&lt;br&gt;
&lt;/div&gt;
&lt;blockquote cite="mid:AMSPR06MB277EBC427FC12F38F37BA32B8920@AMSPR06MB277.eurprd06.prod.outlook.com" \
type="cite"&gt; &lt;div id="divtagdefaultwrapper" \
style="font-size:12pt;color:#000000;font-family:Calibri,Arial,Helvetica,sans-serif;" \
dir="ltr"&gt; &lt;p&gt;Hello,&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;p&gt;I am trying to understand how libvirt firewall rules are loaded as I have \
firewalld and iptables services are disabled.&lt;/p&gt; &lt;/div&gt;
&lt;/blockquote&gt;
&lt;br&gt;
libvirt will add its iptables rules via firewalld if firewalld is enabled and \
running, otherwise it executes iptables commands directly.&lt;br&gt; &lt;br&gt;
w&lt;br&gt;
&lt;blockquote cite="mid:AMSPR06MB277EBC427FC12F38F37BA32B8920@AMSPR06MB277.eurprd06.prod.outlook.com" \
type="cite"&gt; &lt;div id="divtagdefaultwrapper" \
style="font-size:12pt;color:#000000;font-family:Calibri,Arial,Helvetica,sans-serif;" \
dir="ltr"&gt; &lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;p&gt;Where is the configuration files for firewall and NAT  rules for libvirt?&lt;/p&gt;
&lt;/div&gt;
&lt;/blockquote&gt;
&lt;br&gt;
There are no configuration files for the iptables rules that libvirt adds. The simple \
set of rules that is added is fixed for each type of libvirt network - NAT, routed, \
and isolated. Here is a description of exactly what is added for each of these types \
of  network:&lt;br&gt;
&lt;br&gt;
   &lt;a class="moz-txt-link-freetext" \
href="https://libvirt.org/firewall.html"&gt;https://libvirt.org/firewall.html&lt;/a&gt;&lt;br&gt; \
&lt;br&gt; (actually I just realized that I forgot to add information there about a new \
network forwarding type I recently added - "open", which doesn't add *any* \
iptables rules - this is intended for those who want to do their own iptables setup \
for libvirt networks,  outside of libvirt.)&lt;br&gt;
&lt;br&gt;
&lt;blockquote cite="mid:AMSPR06MB277EBC427FC12F38F37BA32B8920@AMSPR06MB277.eurprd06.prod.outlook.com" \
type="cite"&gt; &lt;div id="divtagdefaultwrapper" \
style="font-size:12pt;color:#000000;font-family:Calibri,Arial,Helvetica,sans-serif;" \
dir="ltr"&gt; &lt;p&gt;How can I load default firewall rules if I mess things up&lt;/p&gt;
&lt;/div&gt;
&lt;/blockquote&gt;
&lt;br&gt;
To reload all the iptables rules for all active libvirt networks, just restart the \
libvirtd service.&lt;br&gt; &lt;br&gt;
&lt;blockquote cite="mid:AMSPR06MB277EBC427FC12F38F37BA32B8920@AMSPR06MB277.eurprd06.prod.outlook.com" \
type="cite"&gt; &lt;div id="divtagdefaultwrapper" \
style="font-size:12pt;color:#000000;font-family:Calibri,Arial,Helvetica,sans-serif;" \
dir="ltr"&gt; &lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;p&gt;Also I have realized that followings is default &lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;p&gt;&lt;span&gt;ACCEPT     all  --  \
0.0.0.0/0            \
192.168.122.0/24     ctstate RELATED,ESTABLISHED&lt;/span&gt;&lt;/p&gt; \
&lt;p&gt;&lt;span&gt;&lt;br&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;but If I am to forward a port for a real IP to internal guest machine I \
need &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;br&gt;
&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;ACCEPT     all  --  \
0.0.0.0/0            \
192.168.122.0/24     state \
NEW,RELATED,ESTABLISHED&lt;/span&gt;&lt;/span&gt;&lt;/p&gt; &lt;p&gt;&lt;span&gt;&lt;br&gt;
&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;(NEW state is required) and also of course a forwarding rule&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;br&gt;
&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;iptables -t nat -I PREROUTING -p tcp --dport 3389 -j DNAT \
--to-destination 192.168.122.16:3389&lt;/span&gt;&lt;/span&gt;&lt;/p&gt; &lt;p&gt;&lt;span&gt;&lt;br&gt;
&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Is there a place I can make this rules static with LibVirt (not playing with \
firewalld  and/or iptables service for Centos 7)&lt;/span&gt;&lt;/p&gt; &lt;/div&gt;
&lt;/blockquote&gt;
&lt;br&gt;
The best that can be done with current libvirt is to create a "hook" script \
similar to the one described here:&lt;br&gt; &lt;br&gt;
&lt;a class="moz-txt-link-freetext" \
href="https://wiki.libvirt.org/page/Networking#Forwarding_Incoming_Connections"&gt;https://wiki.libvirt.org/page/Networking#Forwarding_Incoming_Connections&lt;/a&gt;&lt;br&gt;
 &lt;br&gt;
(That worked the last time I tried it, but that was at least 3 years ago. The python \
script available as a link from that page is newer and promises to be easier to \
understand (maybe))&lt;br&gt; &lt;/div&gt;
&lt;/blockquote&gt;
&lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170306131422</emailId><senderName>"Matczak, KrzysztofX"</senderName><senderEmail>krzysztofx.matczak@intel.com</senderEmail><timestampReceived>2017-03-06 13:14:22-0400</timestampReceived><subject>[libvirt-users] domain reinitalization detection</subject><body>

Hello

I'm trying to find out how to detect if domain was destroyed and brought up between \
two time moments,  let's call it reads.  So far the best approach I could find is to \
compare domain ID from previous and current read.   And this is my first question : \
is that reliable solution ? Or do you know any better  ?

And related question is how to  resolve virDomainPtr into domain ID ?
The only verified  way  of getting domain ID I know is  to memorize it's UUID, then  \
call virConnectListDomains , then iterate over all returned domain IDs and resolve \
each one's pointer  using virDomainLookupByID , then  get  UUID  by \
virDomainGetUUIDString  get domain ID of matching UUID's .   It seems too complex  \
and I  expect noticeable performance overhead, so looking for something lighter.  

I'm trying to get current domain ID using  API function : 

char *    virDomainGetMetadata (virDomainPtr domain,  int type,  const char * uri, \
unsigned int flags)

I'm  not sure it's  relevant  function, since domain ID is contained not in metadata \
subsection but in opening &lt;domain&gt; markup.  In fact  I wasn't even able to get any \
data using that function call since I don't know how to construct valid URI. Do you \
know any doc or examples explaining that ?  

Any help appreciated
Krzysztof
--------------------------------------------------------------
Intel Research and Development Ireland Limited
Registered in Ireland
Registered Office: Collinstown Industrial Park, Leixlip, County Kildare
Registered Number: 308263


This e-mail and any attachments may contain confidential material for the sole
use of the intended recipient(s). Any review or distribution by others is
strictly prohibited. If you are not the intended recipient, please contact the
sender and delete all copies.


</body></email><email><emailId>20170304071439</emailId><senderName>Leroy Tennison</senderName><senderEmail>leroy.tennison@verizon.net</senderEmail><timestampReceived>2017-03-04 07:14:39-0400</timestampReceived><subject>[libvirt-users] Insert/eject USB</subject><body>

Is it possible to insert and eject a USB image in kvm/qemu/libvirt or 
are the only dynamically changeable devices cdroms and floppies?  I've 
searched the web and I'm either not looking for the right terms or it's 
obscure.  I should mention that I'm not talking about a connecting a 
physical host USB drive to a guest image, I want to be able to use a 
qcow image as the source.

The context is that I want to be able to revert a VM image back to a 
prior state (internal snapshot) when testing but be able to retain some 
data without having to go to the effort of transferring it across the 
network.  I've excluded cdroms as an option because they are read-only 
(correct me if I'm wrong on this) and require some effort to (re)build.  
Floppy drives appear to be limited to 1.44M which makes sense but is 
very limiting. Network mounts (NFS, Samba, etc.) require a server 
supporting the selected style of filesystem sharing over the network.  
I'm not sure I want to find out what happens to filesystem passthrough 
when a revert is done (unless someone knows and it's beneficial).

I tried creating a partition associated with the VM but not 
auto-mounted, even if I unmounted the partition before reverting its 
state was rolled back.  I possibly could get exotic here by setting the 
immutable attribute after unmounting the partition but, again, I'm 
hoping for something a little simpler and more straightforward.  If 
there's a workable option I haven't considered I'm open to that.

Thanks for any input.

</body></email><email><emailId>20170306071808</emailId><senderName>Kartik Vaishnav</senderName><senderEmail>kartikvaishnav@gmail.com</senderEmail><timestampReceived>2017-03-06 07:18:08-0400</timestampReceived><subject>Re: [libvirt-users] Compile DLL for Windows</subject><body>

I would like to know if there is a proper documentation for compiling
libvirt for Windows.
This is in regard to the latest versions of libvirt.

Also, most answers are outdated and the scripts by Matthias Bolte on github
don't use the latest versions and patches for libvirt.



Regards,
Kartik Vaishnav

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;I would like to know if there is a proper documentation for compiling \
libvirt for Windows.&lt;div&gt;This is in regard to the latest versions of \
libvirt.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also, most answers are outdated and the scripts by \
Matthias Bolte on github don't use the latest versions and patches for \
libvirt.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regards,&lt;/div&gt;&lt;div&gt;Kartik \
Vaishnav&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170308112717</emailId><senderName>"Matczak, KrzysztofX"</senderName><senderEmail>krzysztofx.matczak@intel.com</senderEmail><timestampReceived>2017-03-08 11:27:17-0400</timestampReceived><subject>[libvirt-users] events dispatching in  synchronous mode</subject><body>

Hi
Is there any way to get events dispatching in synchronous mode ?
I mean I'm running  my own events polling loop which calls  virEventRunDefa=
ultImpl  each turn . I'd expect to get my callback function called synchron=
ously , but it's not . Seems that's async call.
Maybe it's my general misunderstanding and I shouldn't use virEventRunDefau=
ltImpl for that ?

Thanks in advance for any guidance

Krzysztof
--------------------------------------------------------------
Intel Research and Development Ireland Limited
Registered in Ireland
Registered Office: Collinstown Industrial Park, Leixlip, County Kildare
Registered Number: 308263


This e-mail and any attachments may contain confidential material for the s=
ole
use of the intended recipient(s). Any review or distribution by others is
strictly prohibited. If you are not the intended recipient, please contact =
the
sender and delete all copies.

[Attachment #3 (text/html)]

&lt;html xmlns:v="urn:schemas-microsoft-com:vml" \
xmlns:o="urn:schemas-microsoft-com:office:office" \
xmlns:w="urn:schemas-microsoft-com:office:word" \
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" \
xmlns="http://www.w3.org/TR/REC-html40"&gt; &lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=us-ascii"&gt;
&lt;meta name="Generator" content="Microsoft Word 15 (filtered medium)"&gt;
&lt;style&gt;&lt;!--
/* Font Definitions */
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:#0563C1;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:#954F72;
	text-decoration:underline;}
span.EmailStyle17
	{mso-style-type:personal-compose;
	font-family:"Calibri",sans-serif;
	color:windowtext;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-family:"Calibri",sans-serif;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
--&gt;&lt;/style&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapedefaults v:ext="edit" spidmax="1026" /&gt;
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapelayout v:ext="edit"&gt;
&lt;o:idmap v:ext="edit" data="1" /&gt;
&lt;/o:shapelayout&gt;&lt;/xml&gt;&lt;![endif]--&gt;
&lt;/head&gt;
&lt;body lang="EN-US" link="#0563C1" vlink="#954F72"&gt;
&lt;div class="WordSection1"&gt;
&lt;p class="MsoNormal"&gt;Hi &lt;b&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/b&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;Is there any way to get events dispatching in synchronous mode ?
&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;I mean I’m running  my own events polling loop which \
calls  virEventRunDefaultImpl  each turn . I’d expect to get my \
callback function called synchronously , but it’s not . Seems that’s \
async call.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;Maybe it’s my general \
misunderstanding and I shouldn’t use virEventRunDefaultImpl for that ? \
&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;Thanks in advance for any guidance &lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;Krzysztof&lt;b&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/b&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;--------------------------------------------------------------&lt;br&gt;
Intel Research and Development Ireland Limited&lt;br&gt;
Registered in Ireland&lt;br&gt;
Registered Office: Collinstown Industrial Park, Leixlip, County Kildare&lt;br&gt;
Registered Number: 308263&lt;/p&gt;


&lt;p&gt;This e-mail and any attachments may contain confidential material for the
sole use of the intended recipient(s). Any review or distribution by others is
strictly prohibited. If you are not the intended recipient, please contact the
sender and delete all copies.&lt;/p&gt;

&lt;p&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170307094906</emailId><senderName>Marko Weber | 8000</senderName><senderEmail>weber@zbfmail.de</senderEmail><timestampReceived>2017-03-07 09:49:06-0400</timestampReceived><subject>[libvirt-users] Help needed on a gentoo system after update to libvirtd 3.1.0</subject><body>



Hello list,

i updated on a gentoo system from libvirtd 2.5 to 3.1.0
Now my windows machines cant access internet.
I did a virbr1 with virt-manager and route it to the eth0, works fine on 
2.5



on install i get this:



Important: The openrc libvirtd init script is now broken up into two
separate services: libvirtd, that solely handles the daemon, and
libvirt-guests, that takes care of clients during shutdown/restart of 
the
host. In order to reenable client handling, edit 
/etc/conf.d/libvirt-guests
and enable the service and start it:

         $ rc-update add libvirt-guests
         $ service libvirt-guests start


For the basic networking support (bridged and routed networks) you don't
need any extra software. For more complex network modes including but 
not
limited to NATed network, you can enable the 'virt-network' USE flag. It
will pull in required runtime dependencies


If you are using dnsmasq on your system, you will have to configure
/etc/dnsmasq.conf to enable the following settings:

         bind-interfaces
         interface or except-interface

Otherwise you might have issues with your existing DNS server.


For openrc users:

         Please use /etc/conf.d/libvirtd to control the '--listen' 
parameter for
         libvirtd.

         Use /etc/init.d/libvirt-guests to manage clients on 
restart/shutdown of
         the host. The default configuration will suspend and resume 
running kvm
         guests with 'managedsave'. This behavior can be changed under
         /etc/conf.d/libvirt-guests


virt-manager starts fine and shows my vm ´s. i dont touched /etc/dnsmasq 
cause i dont used it. so left untouched.
yes, i added libvirt-guests with rc-update

the virbr1 has 192.168.18.1 as address, and is reachable via ping from 
vm guest.
but it cant resolve hostnames and cant ping ip ´s outside the 
virtualisation host.

anyone knows this effect after update?
do i have to change some more things?
or is this a bug?

any help and hints are welcome

thank you

marko weber



</body></email><email><emailId>20170308202229</emailId><senderName>DS DS</senderName><senderEmail>dsvirt17@gmail.com</senderEmail><timestampReceived>2017-03-08 20:22:29-0400</timestampReceived><subject>[libvirt-users] qemu-attach fails</subject><body>

Hi,

I am using "qemu-attach" in virsh to attach to an existing qemu process so
I can send monitor commands to it.

the VM is started using
qemu-kvm -net none -hda ./out.img -m 4G -nographic

The VM gets started and the OS boots fine.

Then, I start virsh and do a "qemu-attach 44273" which is the PID of the
qemu process.
virsh # qemu-attach 44273
error: Failed to attach to pid 44273
error: Cannot check QEMU binary qemu-kvm: No such file or directory

qemu-kvm is in /usr/libexec. There is a symlink to it from /usr/bin and
/bin.

The virsh command "create" (for a different VM) works fine.

What could be missing? Are there any debug/log messages/config files that
can shed some light.

Thanks.

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I am using "qemu-attach" in virsh to \
attach to an existing qemu process so I can send monitor commands to \
it.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;the VM is started using&lt;/div&gt;&lt;div&gt;qemu-kvm -net none \
-hda ./out.img -m 4G -nographic&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The VM gets started and \
the OS boots fine.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Then, I start virsh and do a \
"qemu-attach 44273" which is the PID of the qemu \
process.&lt;/div&gt;&lt;div&gt;&lt;div&gt;virsh # qemu-attach 44273&lt;/div&gt;&lt;div&gt;error: Failed to attach \
to pid 44273&lt;/div&gt;&lt;div&gt;error: Cannot check QEMU binary qemu-kvm: No such file or \
directory&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;qemu-kvm is in /usr/libexec. There is a \
symlink to it from /usr/bin and /bin.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The virsh command \
"create" (for a different VM) works fine.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What \
could be missing? Are there any debug/log messages/config files that can shed some \
light.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks.&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170310233104</emailId><senderName>Chris Friesen</senderName><senderEmail>chris.friesen@windriver.com</senderEmail><timestampReceived>2017-03-10 23:31:04-0400</timestampReceived><subject>[libvirt-users] question about libvirt and suspending guests during live migration</subject><body>

Hi,

I hope someone can help me out.

I'm running into an issue with libvirt 1.2.12 reporting "operation failed: 
domain is no longer running" for a migration when qemu thinks it was fine.

The steps are:
1) create guest with stress test running in it to dirty memory at a high rate 
(fast enough that it would not normally complete live-migration)
2) trigger live migration with dom.migrateToURI2()
3) while migration is in progress, call dom.suspend() on the migrating domain.

What I see at this point is the following:

a) At time 50.465 the monitoring code sees a VIR_DOMAIN_EVENT_SUSPENDED event, 
as expected.
b) An instrumented qemu logs the following:
51.143: done transferring state
51.143: done migration
51.144: qmp_query_migrate reporting state completed
c) At time 51.468 the monitoring code sees a VIR_DOMAIN_EVENT_RESUMED event, 
with detail of VIR_DOMAIN_EVENT_RESUMED_UNPAUSED
c) At time 51.469 the the monitoring code sees a VIR_DOMAIN_EVENT_RESUMED event, 
with detail of VIR_DOMAIN_EVENT_RESUMED_MIGRATED

e) At time 51.471 the dom.migrateToURI2() call raises an exception (this is 
python).  The corresponding libvirt log file shows:
	"error : virNetClientProgramDispatchError:177 : operation failed: domain is no 
longer running"


For what it's worth, the problem seems to be fixed in libvirt 1.2.17.  In that 
version and later I don't see the VIR_DOMAIN_EVENT_RESUMED event, the migration 
just completes.

I'm looking at the libvirt history, but I figured I'd ask here too...

Thanks,
Chris

</body></email><email><emailId>20170314095145</emailId><senderName>Michael_Ströder</senderName><senderEmail>michael@stroeder.com</senderEmail><timestampReceived>2017-03-14 09:51:45-0400</timestampReceived><subject>[libvirt-users] trouble after upgrading from 3.0.0 to 3.1.0</subject><body>


HI!

After the last OS update (openSUSE Tumbleweed) with libvirt being updated=
 from 3.0.0 to
3.1.0 starting the VMs (qemu-kvm) does not work anymore:

error: internal error: child reported: Kernel does not provide mount name=
space:
Permission denied

Kernel was updated before to 4.10.1 and worked just fine with libvirt 3.0=
=2E0 packages.

Any clue how to work around that?

Ciao, Michael.


["smime.p7s" (application/pkcs7-signature)]

</body></email><email><emailId>20170314115627</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-03-14 11:56:27-0400</timestampReceived><subject>Re: [libvirt-users] trouble after upgrading from 3.0.0 to 3.1.0</subject><body>

On 03/14/2017 10:51 AM, Michael Ströder wrote:
&gt; HI!
&gt; 
&gt; After the last OS update (openSUSE Tumbleweed) with libvirt being updated from 3.0.0 to
&gt; 3.1.0 starting the VMs (qemu-kvm) does not work anymore:
&gt; 
&gt; error: internal error: child reported: Kernel does not provide mount namespace:
&gt; Permission denied

Hey, this is definitely a libvirt bug. Since 3.1.0 libvirt spawns each
qemu in its own mount namespace so that it can have private /dev mount.
I've heard that there are some issues with AppArmor - is that what are
you using? Can you try the current git HEAD - there were some fixes
applied after 3.1.0 release.

Meanwhile, you can disable namespaces by setting:

  namespaces=[]

in qemu.conf. However, that should be just temporary solution until we
fix all the bugs.

Michal

</body></email><email><emailId>20170314160311</emailId><senderName>Michael_StrÃ¶der</senderName><senderEmail>michael@stroeder.com</senderEmail><timestampReceived>2017-03-14 16:03:11-0400</timestampReceived><subject>Re: [libvirt-users] trouble after upgrading from 3.0.0 to 3.1.0</subject><body>


Michal Privoznik wrote:
&gt; On 03/14/2017 10:51 AM, Michael Ströder wrote:
&gt;&gt; HI!
&gt;&gt;
&gt;&gt; After the last OS update (openSUSE Tumbleweed) with libvirt being updated from 3.0.0 to
&gt;&gt; 3.1.0 starting the VMs (qemu-kvm) does not work anymore:
&gt;&gt;
&gt;&gt; error: internal error: child reported: Kernel does not provide mount namespace:
&gt;&gt; Permission denied
&gt; 
&gt; Hey, this is definitely a libvirt bug. Since 3.1.0 libvirt spawns each
&gt; qemu in its own mount namespace so that it can have private /dev mount.
&gt; I've heard that there are some issues with AppArmor - is that what are
&gt; you using?

Hmm, yes. I was using AppArmor. Disabling it helped. I will point the author of the
AppArmor profiles in this direction.

&gt; Meanwhile, you can disable namespaces by setting:
&gt; 
&gt;   namespaces=[]
&gt; 
&gt; in qemu.conf.

Only setting this did not help.

Ciao, Michael.


["smime.p7s" (application/pkcs7-signature)]

</body></email><email><emailId>20170313212338</emailId><senderName>Ian Pilcher</senderName><senderEmail>arequipeno@gmail.com</senderEmail><timestampReceived>2017-03-13 21:23:38-0400</timestampReceived><subject>[libvirt-users] MIPS emulation broken - No PCI buses available</subject><body>

I am trying to create a QEMU MIPS guest, so that I can test some code
for big-endian safety.

Every attempt to create a MIPS guest is giving me an error:

   Unable to complete install: 'XML error: No PCI buses available'

It seems like this is a known issue.

   https://www.redhat.com/archives/libvir-list/2016-May/msg00197.html

However, I am still getting this on a fully updated Fedora 25 system
with libvirt-2.2.0-2.fc25.x86_64.

-- 
========================================================================
Ian Pilcher                                         arequipeno@gmail.com
-------- "I grew up before Mark Zuckerberg invented friendship" --------
========================================================================

</body></email><email><emailId>20170315101036</emailId><senderName>Daniel Pocock</senderName><senderEmail>daniel@pocock.pro</senderEmail><timestampReceived>2017-03-15 10:10:36-0400</timestampReceived><subject>[libvirt-users] migrating from XenServer / XCP to libvirt/KVM</subject><body>


I've been using XenServer / XCP (with the "xe" toolset) for a number of
years for hosting servers used for development and free software
projects and I'm now looking at migrating all those environments to
libvirt / KVM.

I had a look at the wiki[1] already and didn't see XenServer mentioned
there.

Could anybody help comment on or explain a few things:

- comparison between XenServer and libvirt: I notice many similar
concepts, for example, XenServer has storage repositories and libvirt
has storage pools.  However, in many examples such as this[2] it appears
that libvirt requires more manual effort.  For example, when you create
a storage repository in XenServer, the tool takes a physical block
device as input and creates the necessary volume group, logical volume
and a filesystem.  In that libvirt example, it appears each of those
steps must be done manually.  The networking examples are similar: the
XenServer tools do all the Open vSwitch stuff behind the scenes but in
the libvirt examples it appears necessary to create the bridge manually
before telling libvirt about it.  Is this all correct or are the
examples I've seen out of date?  Do more recent (or future) releases of
libvirt aim to automate/hide more of these things?

- what is best practice for virtual disk images?  Does libvirt always
use files (like XenServer) or can/should block devices be used
directly?  If using files, is any special care needed to avoid block
alignment problems?

- are there any guides or tools recommended for migrating small
XenServer environments (less than 50 domains on a single physical node)
to libvirt + KVM?

- is there a list of small things that need to change in a VM before
running it under libvirt / KVM?  I'm guessing this might include
bootloader config, updating the kernel, changing block device names in
/etc/fstab and changing network device names in scripts - are there any
others?

- can anybody comment on more tricky issues that may arise in such a
migration, for example, will a Windows VM be likely to run without
modification when migrated from XenServer to libvirt/KVM or will it need
extra drivers added or anything else before the migration?

Regards,

Daniel


1. http://wiki.libvirt.org/page/Main_Page
2. https://keepingitclassless.net/2014/01/libvirt-intro-basic-configuration/



</body></email><email><emailId>20170317105513</emailId><senderName>Milan Zamazal</senderName><senderEmail>mzamazal@redhat.com</senderEmail><timestampReceived>2017-03-17 10:55:13-0400</timestampReceived><subject>[libvirt-users] VIR_ERR_OPERATION_INVALID from virDomainDestroyFlags call</subject><body>

Hi, we experienced a strange, non-reproducible error after a successful
migration to another host.  When we called virDomainDestroyFlags with
VIR_DOMAIN_DESTROY_GRACEFUL flag after the migration on the source host,
we got VIR_ERR_OPERATION_INVALID (code 55) error.  The same with
repeated virDomainDestroyFlags calls.  Normally, we would expect either
success or VIR_ERR_NO_DOMAIN error.  `virsh list' didn't show the VM.

Can anybody please explain to us when this can happen and what the error
means in this context?  When we have good reasons to believe that the VM
is down (e.g. after a migration call successfully finishes) and we
receive such an error from virDomainDestroyFlags, is it safe to assume
the VM is basically gone and can we perform standard cleanup actions
(like removing related files from the host file system)?

Thank you,
Milan

</body></email><email><emailId>20170315102620</emailId><senderName>Daniel Pocock</senderName><senderEmail>daniel@pocock.pro</senderEmail><timestampReceived>2017-03-15 10:26:20-0400</timestampReceived><subject>[libvirt-users] building virtual desktops with libvirt, KVM, SPICE and GNOME</subject><body>


Can anybody comment on how to host virtual desktops on a headless server
using libvirt and KVM on the server and a SPICE client to access the
virtual desktop?  Is there a standard way of doing this?

I've seen many fragments of information about how to do this but I
didn't come across a single guide describing the entire solution. 
Search engines also return a lot of information about gaining remote
access to a real physical desktop but that is not what I'm looking for. 
I've also come across many real-world scenarios where people are
manually starting VNC server processes for each user on different ports
but I was hoping to find out if there is a more standard way of doing
this now.

When I say "virtual desktop", the type of user experience I'm thinking
about is that named users can run a SPICE client anywhere and always
connect to the same host/desktop.  E.g. if they leave some windows open,
disconnect, go to another physical machine and reconnect with the same
username they will see the same desktop with the same windows open.

Regards,

Daniel


</body></email><email><emailId>20170317112335</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-03-17 11:23:35-0400</timestampReceived><subject>Re: [libvirt-users] VIR_ERR_OPERATION_INVALID from virDomainDestroyFlags call</subject><body>

On Fri, Mar 17, 2017 at 11:55:13AM +0100, Milan Zamazal wrote:
&gt; Hi, we experienced a strange, non-reproducible error after a successful
&gt; migration to another host.  When we called virDomainDestroyFlags with
&gt; VIR_DOMAIN_DESTROY_GRACEFUL flag after the migration on the source host,
&gt; we got VIR_ERR_OPERATION_INVALID (code 55) error.  The same with
&gt; repeated virDomainDestroyFlags calls.  Normally, we would expect either
&gt; success or VIR_ERR_NO_DOMAIN error.  `virsh list' didn't show the VM.

What about 'virsh list --all' - i expect you have an inactive guest
present, as calling destory on an inactive guest triggers OPERATION_INVALID

Regards,
Daniel
-- 
|: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
|: http://libvirt.org              -o-             http://virt-manager.org :|
|: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|

</body></email><email><emailId>20170317130711</emailId><senderName>Milan Zamazal</senderName><senderEmail>mzamazal@redhat.com</senderEmail><timestampReceived>2017-03-17 13:07:11-0400</timestampReceived><subject>Re: [libvirt-users] VIR_ERR_OPERATION_INVALID from virDomainDestroyFlags call</subject><body>

"Daniel P. Berrange" &lt;berrange@redhat.com&gt; writes:

&gt; On Fri, Mar 17, 2017 at 11:55:13AM +0100, Milan Zamazal wrote:
&gt;&gt; Hi, we experienced a strange, non-reproducible error after a successful
&gt;&gt; migration to another host.  When we called virDomainDestroyFlags with
&gt;&gt; VIR_DOMAIN_DESTROY_GRACEFUL flag after the migration on the source host,
&gt;&gt; we got VIR_ERR_OPERATION_INVALID (code 55) error.  The same with
&gt;&gt; repeated virDomainDestroyFlags calls.  Normally, we would expect either
&gt;&gt; success or VIR_ERR_NO_DOMAIN error.  `virsh list' didn't show the VM.
&gt;
&gt; What about 'virsh list --all' - i expect you have an inactive guest
&gt; present, as calling destory on an inactive guest triggers OPERATION_INVALID

I see.  It's interesting, since we use transient domains.  Are there
known circumstances when OPERATION_INVALID could be returned for a
transient domain?  Can we assume that we never receive that error when
trying to destroy a running domain?

Thanks,
Milan

</body></email><email><emailId>20170317131222</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-03-17 13:12:22-0400</timestampReceived><subject>Re: [libvirt-users] VIR_ERR_OPERATION_INVALID from virDomainDestroyFlags call</subject><body>

On Fri, Mar 17, 2017 at 02:07:11PM +0100, Milan Zamazal wrote:
&gt; "Daniel P. Berrange" &lt;berrange@redhat.com&gt; writes:
&gt; 
&gt; &gt; On Fri, Mar 17, 2017 at 11:55:13AM +0100, Milan Zamazal wrote:
&gt; &gt;&gt; Hi, we experienced a strange, non-reproducible error after a successful
&gt; &gt;&gt; migration to another host.  When we called virDomainDestroyFlags with
&gt; &gt;&gt; VIR_DOMAIN_DESTROY_GRACEFUL flag after the migration on the source host,
&gt; &gt;&gt; we got VIR_ERR_OPERATION_INVALID (code 55) error.  The same with
&gt; &gt;&gt; repeated virDomainDestroyFlags calls.  Normally, we would expect either
&gt; &gt;&gt; success or VIR_ERR_NO_DOMAIN error.  `virsh list' didn't show the VM.
&gt; &gt;
&gt; &gt; What about 'virsh list --all' - i expect you have an inactive guest
&gt; &gt; present, as calling destory on an inactive guest triggers OPERATION_INVALID
&gt; 
&gt; I see.  It's interesting, since we use transient domains.  Are there
&gt; known circumstances when OPERATION_INVALID could be returned for a
&gt; transient domain?  Can we assume that we never receive that error when
&gt; trying to destroy a running domain?

Cleanup &amp; destruction of domains is an area where there is relatively
high level of concurrency in libvirt. So it is conceivable that you
would see OPERATION_INVALID for a transient guest if libvirt is part
way through cleaning it up - it shouldn't be in that state for very
long though

You'll never see OPERATION_INVALID if the guest is truely running - it
will either be shutoff, or in the process of becoming shutoff very soon.

Regards,
Daniel
-- 
|: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
|: http://libvirt.org              -o-             http://virt-manager.org :|
|: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|

</body></email><email><emailId>20170315102201</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-03-15 10:22:01-0400</timestampReceived><subject>Re: [libvirt-users] migrating from XenServer / XCP to libvirt/KVM</subject><body>

On Wed, Mar 15, 2017 at 10:10:36AM +0000, Daniel Pocock wrote:
&gt; 
&gt; I've been using XenServer / XCP (with the "xe" toolset) for a number of
&gt; years for hosting servers used for development and free software
&gt; projects and I'm now looking at migrating all those environments to
&gt; libvirt / KVM.
&gt; 
&gt; I had a look at the wiki[1] already and didn't see XenServer mentioned
&gt; there.

Yeah, there was a tiny bit of work done to support the XenServer API,
but the person working on it changed jobs and no one else stepped
forward to continue it.

&gt; 
&gt; Could anybody help comment on or explain a few things:
&gt; 
&gt; - comparison between XenServer and libvirt: I notice many similar
&gt; concepts, for example, XenServer has storage repositories and libvirt
&gt; has storage pools.  However, in many examples such as this[2] it appears
&gt; that libvirt requires more manual effort.  For example, when you create
&gt; a storage repository in XenServer, the tool takes a physical block
&gt; device as input and creates the necessary volume group, logical volume
&gt; and a filesystem.  In that libvirt example, it appears each of those
&gt; steps must be done manually.  The networking examples are similar: the
&gt; XenServer tools do all the Open vSwitch stuff behind the scenes but in
&gt; the libvirt examples it appears necessary to create the bridge manually
&gt; before telling libvirt about it.  Is this all correct or are the
&gt; examples I've seen out of date?  Do more recent (or future) releases of
&gt; libvirt aim to automate/hide more of these things?

NB, comparing XenServer with libvirt is a bit of an apples &amp; oranges
comparison, as they have different goals. So yeah, libvirt requires
more steps in managing the storage, but this also allows you todo
things you can't do with XenServer. Also, note that most administrators
would not use libvirt directly, but rather use it indirectly via some
management app that introduces higher level abstractions (eg, oVirt,
OpenStack, or in simpler cases virt-manager etc). 

&gt; - what is best practice for virtual disk images?  Does libvirt always
&gt; use files (like XenServer) or can/should block devices be used
&gt; directly?  If using files, is any special care needed to avoid block
&gt; alignment problems?

This is a matter for the individual hypervisor beneath libvirt. Each
has its own set of supported virtual disk image backends. QEMU/KVM
can run on prettty much anything, file, block device, network storage,
etc

&gt; - are there any guides or tools recommended for migrating small
&gt; XenServer environments (less than 50 domains on a single physical node)
&gt; to libvirt + KVM?
&gt; 
&gt; - is there a list of small things that need to change in a VM before
&gt; running it under libvirt / KVM?  I'm guessing this might include
&gt; bootloader config, updating the kernel, changing block device names in
&gt; /etc/fstab and changing network device names in scripts - are there any
&gt; others?
&gt; 
&gt; - can anybody comment on more tricky issues that may arise in such a
&gt; migration, for example, will a Windows VM be likely to run without
&gt; modification when migrated from XenServer to libvirt/KVM or will it need
&gt; extra drivers added or anything else before the migration?

Yes, there are lots of things which need changing when moving an existing
guest to a new hypervisor. The best thing is to try to use a pre-existing
tool for conversion. eg virt-v2v

   http://libguestfs.org/virt-v2v.1.html

though I'm not sure on the level of support for XenServer there. You
probably just have to give it a try on a guest and see how it works.
It clones the disk image, so your original guest won't be broken.

Regards,
Daniel
-- 
|: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
|: http://libvirt.org              -o-             http://virt-manager.org :|
|: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|

</body></email><email><emailId>20170314105923</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-03-14 10:59:23-0400</timestampReceived><subject>Re: [libvirt-users] MIPS emulation broken - No PCI buses available</subject><body>

On Mon, Mar 13, 2017 at 04:23:38PM -0500, Ian Pilcher wrote:
&gt; I am trying to create a QEMU MIPS guest, so that I can test some code
&gt; for big-endian safety.

You are probably better off using PPC64 which is big-endian and much more
widely tested in libvirt than MIPS, so actually likely to work reliably.

&gt; Every attempt to create a MIPS guest is giving me an error:
&gt; 
&gt;   Unable to complete install: 'XML error: No PCI buses available'
&gt; 
&gt; It seems like this is a known issue.
&gt; 
&gt;   https://www.redhat.com/archives/libvir-list/2016-May/msg00197.html
&gt; 
&gt; However, I am still getting this on a fully updated Fedora 25 system
&gt; with libvirt-2.2.0-2.fc25.x86_64.

It seems that patch you quote was never applied to libvirt. There was
some debate in the thread that follows and it seems it was never
resolved.

Please do file a bug against libvirt so this doesn't get lost again.


Regards,
Daniel
-- 
|: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
|: http://libvirt.org              -o-             http://virt-manager.org :|
|: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|

</body></email><email><emailId>20170314141814</emailId><senderName>Ian Pilcher</senderName><senderEmail>arequipeno@gmail.com</senderEmail><timestampReceived>2017-03-14 14:18:14-0400</timestampReceived><subject>Re: [libvirt-users] MIPS emulation broken - No PCI buses available</subject><body>

On 03/14/2017 05:59 AM, Daniel P. Berrange wrote:
&gt; You are probably better off using PPC64 which is big-endian and much more
&gt; widely tested in libvirt than MIPS, so actually likely to work reliably.

I did try that, but I wasn't able to get past errors about the
machine type not supporting IDE (or something like that).  I finally
just gave up and use qemu-system-ppc directly, along with an older
Debian QCOW image that I found somewhere.

&gt; Please do file a bug against libvirt so this doesn't get lost again.

https://bugzilla.redhat.com/show_bug.cgi?id=1432101

-- 
========================================================================
Ian Pilcher                                         arequipeno@gmail.com
-------- "I grew up before Mark Zuckerberg invented friendship" --------
========================================================================

</body></email><email><emailId>20170314191822</emailId><senderName>Andrea Bolognani</senderName><senderEmail>abologna@redhat.com</senderEmail><timestampReceived>2017-03-14 19:18:22-0400</timestampReceived><subject>Re: [libvirt-users] MIPS emulation broken - No PCI buses available</subject><body>

On Tue, 2017-03-14 at 09:18 -0500, Ian Pilcher wrote:
&gt; &gt; You are probably better off using PPC64 which is big-endian and much more
&gt; &gt; widely tested in libvirt than MIPS, so actually likely to work reliably.
&gt; 
&gt; I did try that, but I wasn't able to get past errors about the
&gt; machine type not supporting IDE (or something like that).  I finally
&gt; just gave up and use qemu-system-ppc directly, along with an older
&gt; Debian QCOW image that I found somewhere.

You keep referring to ppc instead of ppc64, so I'm not sure
you're trying exactly the same thing, but you can create a
ppc64 guest with recent software quite easily by using
virt-builder:

  $ virt-builder \
    fedora-25 \
    --arch ppc64 \
    --output f25-ppc64.qcow2 \
    --format qcow2 \
    --root-password password:dangerzone

This is a minimal guest XML that will allow you to import
the image generated above into libvirt:

  &lt;domain type='qemu'&gt;
    &lt;name&gt;f25-ppc64&lt;/name&gt;
    &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;
    &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMemory&gt;
    &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
    &lt;os&gt;
      &lt;type arch='ppc64' machine='pseries'&gt;hvm&lt;/type&gt;
    &lt;/os&gt;
    &lt;devices&gt;
      &lt;emulator&gt;/usr/bin/qemu-system-ppc64&lt;/emulator&gt;
      &lt;disk type='file' device='disk'&gt;
        &lt;driver name='qemu' type='qcow2'/&gt;
        &lt;source file='/var/lib/libvirt/images/f25-ppc64.qcow2'/&gt;
        &lt;target dev='sda' bus='scsi'/&gt;
        &lt;address type='drive'/&gt;
      &lt;/disk&gt;
      &lt;controller type='scsi' model='virtio-scsi'/&gt;
      &lt;controller type='usb' model='nec-xhci'/&gt;
      &lt;interface type='network'&gt;
        &lt;source network='default'/&gt;
        &lt;model type='virtio'/&gt;
      &lt;/interface&gt;
      &lt;console type='pty'/&gt;
      &lt;channel type='unix'&gt;
        &lt;target type='virtio' name='org.qemu.guest_agent.0'/&gt;
        &lt;address type='virtio-serial'/&gt;
      &lt;/channel&gt;
      &lt;memballoon model='virtio'/&gt;
    &lt;/devices&gt;
  &lt;/domain&gt;

I just tried the steps on my Fedora 24/x86_64 laptop and
I didn't run into any issues: if the experience is not quite
as seamless for you, I'd be interested in having the details.

-- 
Andrea Bolognani / Red Hat / Virtualization

</body></email><email><emailId>20170320091835</emailId><senderName>Daniel Pocock</senderName><senderEmail>daniel@pocock.pro</senderEmail><timestampReceived>2017-03-20 09:18:35-0400</timestampReceived><subject>[libvirt-users] migrated RHEL7/CentsOS7 VMs fail to boot</subject><body>


I migrated a CentOS7 VM (the fedrtc.org site) from an XCP environment to
a libvirt/KVM environment.

This involved using qemu-img to convert the image from VHD to qcow2 and
then using virt-install --import to define the VM in libvirt.

Three problems occurred during boot:

a) on the first boot, the BIOS screen and grub screen don't appear at
all, the screen is blank for a couple of seconds and then the message
about loading a kernel appears.  Hard reset and on the second and
subsequent attempts I see the grub screen and have the opportunity to
interact with it.  This actually happened with many of my VMs, not just
the CentOS7 VM.

b) with console=hvc0 in the grub config, the kernel refused to boot, no
error appeared on the screen.  I was able to remove that easily enough
by pressing "e" in grub.  Rather than halting, should the kernel fall
back to VGA perhaps when the console= argument is not valid?  Or could
KVM emulate the Xen console device to make migrations easier?

c) after that, the boot proceeds up to about the point where I see
systemd messages about starting basic system.  Then it sits there for a
few minutes and then these messages appear:
  warning: dracut-initqueue timeout - starting timeout scripts
and after that I see "A start job is running for dev-mapp...oot.device
(X min Ys/ no limit)
Rebooting and choosing the "rescue" image from the bottom of the grub
menu got me past that, I was able to log in and then I ran:

   dracut --kver 3.10.0-514.10.2.el7.x86_64 --force

and on the next attempt it was able to boot successfully.  The block
device for the root FS is an LVM volume (so the name should have been
constant) and the block device for the /boot filesystem listed in
/etc/fstab was mounted by UUID (the block device name itself changed
from xvda1 (XCP) to vda1 (KVM)).  All my Debian VMs were able to cope
with this device name changing.  The CentOS7 system was originally
installed using default settings for just about everything.

Why does dracut need to be re-run in this situation?  Should a bug
report be filed about this?

["2017-03-19-fedrtc-centos7-boot-failure.png" (image/png)]

</body></email><email><emailId>20170315090046</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-03-15 09:00:46-0400</timestampReceived><subject>Re: [libvirt-users] trouble after upgrading from 3.0.0 to 3.1.0</subject><body>

On 03/14/2017 05:03 PM, Michael Ströder wrote:
&gt; Michal Privoznik wrote:
&gt;&gt; On 03/14/2017 10:51 AM, Michael Ströder wrote:
&gt;&gt;&gt; HI!
&gt;&gt;&gt;
&gt;&gt;&gt; After the last OS update (openSUSE Tumbleweed) with libvirt being updated from 3.0.0 to
&gt;&gt;&gt; 3.1.0 starting the VMs (qemu-kvm) does not work anymore:
&gt;&gt;&gt;
&gt;&gt;&gt; error: internal error: child reported: Kernel does not provide mount namespace:
&gt;&gt;&gt; Permission denied
&gt;&gt;
&gt;&gt; Hey, this is definitely a libvirt bug. Since 3.1.0 libvirt spawns each
&gt;&gt; qemu in its own mount namespace so that it can have private /dev mount.
&gt;&gt; I've heard that there are some issues with AppArmor - is that what are
&gt;&gt; you using?
&gt; 
&gt; Hmm, yes. I was using AppArmor. Disabling it helped. I will point the author of the
&gt; AppArmor profiles in this direction.

Yeah, I still know that AppArmor is preventing our namespaces code from
working properly. Unfortunately, I don't know much about it, and
certainly not enough to fix it. But maybe I can find somebody who does.

&gt; 
&gt;&gt; Meanwhile, you can disable namespaces by setting:
&gt;&gt;
&gt;&gt;   namespaces=[]
&gt;&gt;
&gt;&gt; in qemu.conf.
&gt; 
&gt; Only setting this did not help.

Have you restarted libvirtd afterwards? Maybe I should have written that
explicitly instead of assuming it. Also, this is meant as a temporary
workaround. Disabling namespaces does not enable the full security
features. Ideally, users would use namespaces without even noticing it.

Michal

</body></email><email><emailId>20170307104416</emailId><senderName>Marko Weber | 8000</senderName><senderEmail>weber@zbfmail.de</senderEmail><timestampReceived>2017-03-07 10:44:16-0400</timestampReceived><subject>[libvirt-users] Help needed on a gentoo system after update to libvirtd 3.1.0</subject><body>



(sorry, dont know how i put my posting into an reply to an other issue 
before,
  new posting to sepearte it, big sorry)




Hello list,

i updated on a gentoo system from libvirtd 2.5 to 3.1.0
Now my windows machines cant access internet.
I did a virbr1 with virt-manager and route it to the eth0, works fine on 
2.5
Hello list,

i updated on a gentoo system from libvirtd 2.5 to 3.1.0
Now my windows machines cant access internet.
I did a virbr1 with virt-manager and route it to the eth0, works fine on 
2.5



on install i get this:



Important: The openrc libvirtd init script is now broken up into two
separate services: libvirtd, that solely handles the daemon, and
libvirt-guests, that takes care of clients during shutdown/restart of 
the
host. In order to reenable client handling, edit 
/etc/conf.d/libvirt-guests
and enable the service and start it:

         $ rc-update add libvirt-guests
         $ service libvirt-guests start


For the basic networking support (bridged and routed networks) you don't
need any extra software. For more complex network modes including but 
not
limited to NATed network, you can enable the 'virt-network' USE flag. It
will pull in required runtime dependencies


If you are using dnsmasq on your system, you will have to configure
/etc/dnsmasq.conf to enable the following settings:

         bind-interfaces
         interface or except-interface

Otherwise you might have issues with your existing DNS server.


For openrc users:

         Please use /etc/conf.d/libvirtd to control the '--listen' 
parameter for
         libvirtd.

         Use /etc/init.d/libvirt-guests to manage clients on 
restart/shutdown of
         the host. The default configuration will suspend and resume 
running kvm
         guests with 'managedsave'. This behavior can be changed under
         /etc/conf.d/libvirt-guests


virt-manager starts fine and shows my vm ´s. i dont touched /etc/dnsmasq 
cause i dont used it. so left untouched.
yes, i added libvirt-guests with rc-update

the virbr1 has 192.168.18.1 as address, and is reachable via ping from 
vm guest.
but it cant resolve hostnames and cant ping ip ´s outside the 
virtualisation host.

anyone knows this effect after update?
do i have to change some more things?
or is this a bug?

any help and hints are welcome

thank you

marko weber





on install i get this:



Important: The openrc libvirtd init script is now broken up into two
separate services: libvirtd, that solely handles the daemon, and
libvirt-guests, that takes care of clients during shutdown/restart of 
the
host. In order to reenable client handling, edit 
/etc/conf.d/libvirt-guests
and enable the service and start it:

         $ rc-update add libvirt-guests
         $ service libvirt-guests start


For the basic networking support (bridged and routed networks) you don't
need any extra software. For more complex network modes including but 
not
limited to NATed network, you can enable the 'virt-network' USE flag. It
will pull in required runtime dependencies


If you are using dnsmasq on your system, you will have to configure
/etc/dnsmasq.conf to enable the following settings:

         bind-interfaces
         interface or except-interface

Otherwise you might have issues with your existing DNS server.


For openrc users:

         Please use /etc/conf.d/libvirtd to control the '--listen' 
parameter for
         libvirtd.

         Use /etc/init.d/libvirt-guests to manage clients on 
restart/shutdown of
         the host. The default configuration will suspend and resume 
running kvm
         guests with 'managedsave'. This behavior can be changed under
         /etc/conf.d/libvirt-guests


virt-manager starts fine and shows my vm ´s. i dont touched /etc/dnsmasq 
cause i dont used it. so left untouched.
yes, i added libvirt-guests with rc-update

the virbr1 has 192.168.18.1 as address, and is reachable via ping from 
vm guest.
but it cant resolve hostnames and cant ping ip ´s outside the 
virtualisation host.

anyone knows this effect after update?
do i have to change some more things?
or is this a bug?

any help and hints are welcome

thank you

marko weber




-- 
zbfmail - Mittendrin statt nur Datei!

OpenDKIM, SPF, DSPAM, Greylisting, POSTSCREEN, AMAVIS, Mailgateways
Mailfiltering, SMTP Service, Spam Abwehr, MX-Backup, Mailserver Backup
Redundante Mailgateways, HA Mailserver, Secure Mailserver

</body></email><email><emailId>20170320131121</emailId><senderName>Thibaut SAUTEREAU</senderName><senderEmail>thibaut.sautereau@telecom-sudparis.eu</senderEmail><timestampReceived>2017-03-20 13:11:21-0400</timestampReceived><subject>[libvirt-users] Get PID of a domain's QEMU instance from its domain ID</subject><body>

Hello,

I cannot find a way to retrieve PIDs of QEMU instances from libvirt domains'
IDs (I'm using libvirt C API). I recognize it sounds like a bad idea doing so
(and I know PIDs are explicitly made not available, as I gathered from the
source code and on your IRC channel) but I need that to use the perf_event_open
syscall in order to gather statistics on my QEMU/KVM guests. I also know
libvirt now supports some perf events but only a few and I need more. I could
submit patches to add them and I will definitely consider that but in the
meantime...

What would be the best way to get those PIDs? I tried using the XML file but
PID is hidden in there too. I took a look at QEMU Machine Protocol. Now I'm
going to walk /proc and match on guests names but it is not that elegant.
Any ideas?

Thanks,

Thibaut S.

</body></email><email><emailId>20170308112003</emailId><senderName>Francesco Romani</senderName><senderEmail>fromani@redhat.com</senderEmail><timestampReceived>2017-03-08 11:20:03-0400</timestampReceived><subject>Re: [libvirt-users] [RFC] per-device metadata</subject><body>

Ping?


Would it be feasible? Or is the very basic idea unfit?


bests,


On 02/27/2017 04:41 PM, Francesco Romani wrote:
&gt; Hi,
&gt;
&gt;
&gt; Currently libvirt supports metadata in the domain XML. This is very
&gt; convenient for data related to the VM, but it is a little awkward for
&gt; devices. Let's pretend I want to have extradata (say, a specific port
&gt; for a virtual switch) related to a device (say, a NIC). Nowadays I can
&gt; store that data in the metadata section, but I need some kind of mapping
&gt; to correlate this piece of information to the specific device.
&gt;
&gt; I can use the device alias, but this is not available when the device is
&gt; created. This is also more complex when doing hotplug/hotunplug, because
&gt; I need to do update device and update metadata; if either fails, the
&gt; entire operation must be considered failed.
&gt;
&gt; It would be nice to be able to attach metadata to the device, and this
&gt; is what I'm asking for/proposing in this mail.
&gt;
&gt; Would it be possible in a future libvirt release?
&gt;
&gt;
&gt; If this is not possible, what's the best way to do the aforementioned
&gt; mapping? If it's alias (or device address), how can I be sure than I'm
&gt; addressing (no pun intended) the right device when I don't have them?
&gt; (e.g. hotplug new device, or just first time VM created)?
&gt;
&gt;
&gt; Thanks,
&gt;
&gt;

-- 
Francesco Romani
Red Hat Engineering Virtualization R &amp; D
IRC: fromani

</body></email><email><emailId>20170316124638</emailId><senderName>Peter Krempa</senderName><senderEmail>pkrempa@redhat.com</senderEmail><timestampReceived>2017-03-16 12:46:38-0400</timestampReceived><subject>Re: [libvirt-users] [RFC] per-device metadata</subject><body>


For techincal discussions on design it's better to post to the
development list.

On Mon, Feb 27, 2017 at 16:41:28 +0100, Francesco Romani wrote:
&gt; Hi,

Hi,

&gt; 
&gt; 
&gt; Currently libvirt supports metadata in the domain XML. This is very
&gt; convenient for data related to the VM, but it is a little awkward for
&gt; devices. Let's pretend I want to have extradata (say, a specific port
&gt; for a virtual switch) related to a device (say, a NIC). Nowadays I can
&gt; store that data in the metadata section, but I need some kind of mapping
&gt; to correlate this piece of information to the specific device.
&gt; 
&gt; I can use the device alias, but this is not available when the device is
&gt; created. This is also more complex when doing hotplug/hotunplug, because
&gt; I need to do update device and update metadata; if either fails, the
&gt; entire operation must be considered failed.
&gt; 
&gt; It would be nice to be able to attach metadata to the device, and this
&gt; is what I'm asking for/proposing in this mail.
&gt; 
&gt; Would it be possible in a future libvirt release?

In general I don't have a problem with this and if it would make the
life of mgmt tools easier I don't see a reason why not.

There's one problem though. For setter (or getter) APIs for the metadata
you need a way how to uniquely identify a device on which you want to
operate. There's no such way currently in use in libvirt so you need to
come up with something to do it.

The identifier is also desired for the metadata change event which would
go with the APIs.

It might be possible to do this even without APIs but the usefulnes
would be rather limited as it was with the domain metadata.

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170316144230</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-03-16 14:42:30-0400</timestampReceived><subject>Re: [libvirt-users] [RFC] per-device metadata</subject><body>

On Thu, Mar 16, 2017 at 01:46:38PM +0100, Peter Krempa wrote:
&gt; 
&gt; For techincal discussions on design it's better to post to the
&gt; development list.
&gt; 
&gt; On Mon, Feb 27, 2017 at 16:41:28 +0100, Francesco Romani wrote:
&gt; &gt; Hi,
&gt; 
&gt; Hi,
&gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; Currently libvirt supports metadata in the domain XML. This is very
&gt; &gt; convenient for data related to the VM, but it is a little awkward for
&gt; &gt; devices. Let's pretend I want to have extradata (say, a specific port
&gt; &gt; for a virtual switch) related to a device (say, a NIC). Nowadays I can
&gt; &gt; store that data in the metadata section, but I need some kind of mapping
&gt; &gt; to correlate this piece of information to the specific device.
&gt; &gt; 
&gt; &gt; I can use the device alias, but this is not available when the device is
&gt; &gt; created. This is also more complex when doing hotplug/hotunplug, because
&gt; &gt; I need to do update device and update metadata; if either fails, the
&gt; &gt; entire operation must be considered failed.
&gt; &gt; 
&gt; &gt; It would be nice to be able to attach metadata to the device, and this
&gt; &gt; is what I'm asking for/proposing in this mail.
&gt; &gt; 
&gt; &gt; Would it be possible in a future libvirt release?
&gt; 
&gt; In general I don't have a problem with this and if it would make the
&gt; life of mgmt tools easier I don't see a reason why not.
&gt; 
&gt; There's one problem though. For setter (or getter) APIs for the metadata
&gt; you need a way how to uniquely identify a device on which you want to
&gt; operate. There's no such way currently in use in libvirt so you need to
&gt; come up with something to do it.

Once you have a reliable identifier for a device, it is not compelling
to store metadata against each device as you can reliably identify the
device from data in the existing metadata block. I don't find the
atomicity argument very compelling, because even if hidden behind a
single libvirt API, it is still fundamentally multiple operations in
libvirt which are just as likely to fail as if the app did multiple
libvirt API calls as we're not able to provide any kind of transactional
guarantees here.

IOW, we could effectively solve this by assigning the device alias
names at XML define time, instead of VM launch time. We historically
didn't do this since we wanted to cope with old QEMU which didn't
allow custom device aliases. We now mandate a new QEMU that supports
-device, so that's no longer a problem. So I'd prefer to see us just
define device aliases persistently and let apps use those to track
metadata in the global metadata section.

Regards,
Daniel
-- 
|: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
|: http://libvirt.org              -o-             http://virt-manager.org :|
|: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|

</body></email><email><emailId>20170316145051</emailId><senderName>Peter Krempa</senderName><senderEmail>pkrempa@redhat.com</senderEmail><timestampReceived>2017-03-16 14:50:51-0400</timestampReceived><subject>Re: [libvirt-users] [RFC] per-device metadata</subject><body>


On Thu, Mar 16, 2017 at 14:42:30 +0000, Daniel Berrange wrote:
&gt; On Thu, Mar 16, 2017 at 01:46:38PM +0100, Peter Krempa wrote:
&gt; &gt; On Mon, Feb 27, 2017 at 16:41:28 +0100, Francesco Romani wrote:

[...]

&gt; &gt; In general I don't have a problem with this and if it would make the
&gt; &gt; life of mgmt tools easier I don't see a reason why not.
&gt; &gt; 
&gt; &gt; There's one problem though. For setter (or getter) APIs for the metadata
&gt; &gt; you need a way how to uniquely identify a device on which you want to
&gt; &gt; operate. There's no such way currently in use in libvirt so you need to
&gt; &gt; come up with something to do it.
&gt; 
&gt; Once you have a reliable identifier for a device, it is not compelling
&gt; to store metadata against each device as you can reliably identify the
&gt; device from data in the existing metadata block. I don't find the
&gt; atomicity argument very compelling, because even if hidden behind a
&gt; single libvirt API, it is still fundamentally multiple operations in
&gt; libvirt which are just as likely to fail as if the app did multiple

You get the atomicity for free if you store the metadata in the device
object and parse it along with the device definition.

We parse the XML at first (which would include the metadata). If the
device attach fails during hotplug we will free the device definition
(including the metadata).

The same applies for unplug. Once unplug finishes we will free the
device data structure and thus the metadata with it.

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170316145247</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-03-16 14:52:47-0400</timestampReceived><subject>Re: [libvirt-users] [RFC] per-device metadata</subject><body>

On Thu, Mar 16, 2017 at 03:50:51PM +0100, Peter Krempa wrote:
&gt; On Thu, Mar 16, 2017 at 14:42:30 +0000, Daniel Berrange wrote:
&gt; &gt; On Thu, Mar 16, 2017 at 01:46:38PM +0100, Peter Krempa wrote:
&gt; &gt; &gt; On Mon, Feb 27, 2017 at 16:41:28 +0100, Francesco Romani wrote:
&gt; 
&gt; [...]
&gt; 
&gt; &gt; &gt; In general I don't have a problem with this and if it would make the
&gt; &gt; &gt; life of mgmt tools easier I don't see a reason why not.
&gt; &gt; &gt; 
&gt; &gt; &gt; There's one problem though. For setter (or getter) APIs for the metadata
&gt; &gt; &gt; you need a way how to uniquely identify a device on which you want to
&gt; &gt; &gt; operate. There's no such way currently in use in libvirt so you need to
&gt; &gt; &gt; come up with something to do it.
&gt; &gt; 
&gt; &gt; Once you have a reliable identifier for a device, it is not compelling
&gt; &gt; to store metadata against each device as you can reliably identify the
&gt; &gt; device from data in the existing metadata block. I don't find the
&gt; &gt; atomicity argument very compelling, because even if hidden behind a
&gt; &gt; single libvirt API, it is still fundamentally multiple operations in
&gt; &gt; libvirt which are just as likely to fail as if the app did multiple
&gt; 
&gt; You get the atomicity for free if you store the metadata in the device
&gt; object and parse it along with the device definition.
&gt; 
&gt; We parse the XML at first (which would include the metadata). If the
&gt; device attach fails during hotplug we will free the device definition
&gt; (including the metadata).
&gt; 
&gt; The same applies for unplug. Once unplug finishes we will free the
&gt; device data structure and thus the metadata with it.

The scenario where device attach fails is not the problem - you can
get the same level of reliabilty to that by simply updating the
global metadata before &amp; after hotplug in the same way. What is
difficult is when libvirt fails to persist the XML config on disk
or when libvirt crashes part way through the operation, and other
akward failure scenarios unrelated to QEMU itself.


Regards,
Daniel
-- 
|: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
|: http://libvirt.org              -o-             http://virt-manager.org :|
|: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|

</body></email><email><emailId>20170316151751</emailId><senderName>Peter Krempa</senderName><senderEmail>pkrempa@redhat.com</senderEmail><timestampReceived>2017-03-16 15:17:51-0400</timestampReceived><subject>Re: [libvirt-users] [RFC] per-device metadata</subject><body>


On Thu, Mar 16, 2017 at 14:52:47 +0000, Daniel Berrange wrote:
&gt; On Thu, Mar 16, 2017 at 03:50:51PM +0100, Peter Krempa wrote:
&gt; &gt; On Thu, Mar 16, 2017 at 14:42:30 +0000, Daniel Berrange wrote:
&gt; &gt; &gt; On Thu, Mar 16, 2017 at 01:46:38PM +0100, Peter Krempa wrote:
&gt; &gt; &gt; &gt; On Mon, Feb 27, 2017 at 16:41:28 +0100, Francesco Romani wrote:

[...]

&gt; The scenario where device attach fails is not the problem - you can
&gt; get the same level of reliabilty to that by simply updating the
&gt; global metadata before &amp; after hotplug in the same way. What is
&gt; difficult is when libvirt fails to persist the XML config on disk
&gt; or when libvirt crashes part way through the operation, and other
&gt; akward failure scenarios unrelated to QEMU itself.

In that case you lose the device definition too, since saving the XML is
the integral part of the hotplug operation.

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170316152309</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-03-16 15:23:09-0400</timestampReceived><subject>Re: [libvirt-users] [RFC] per-device metadata</subject><body>

On Thu, Mar 16, 2017 at 04:17:51PM +0100, Peter Krempa wrote:
&gt; On Thu, Mar 16, 2017 at 14:52:47 +0000, Daniel Berrange wrote:
&gt; &gt; On Thu, Mar 16, 2017 at 03:50:51PM +0100, Peter Krempa wrote:
&gt; &gt; &gt; On Thu, Mar 16, 2017 at 14:42:30 +0000, Daniel Berrange wrote:
&gt; &gt; &gt; &gt; On Thu, Mar 16, 2017 at 01:46:38PM +0100, Peter Krempa wrote:
&gt; &gt; &gt; &gt; &gt; On Mon, Feb 27, 2017 at 16:41:28 +0100, Francesco Romani wrote:
&gt; 
&gt; [...]
&gt; 
&gt; &gt; The scenario where device attach fails is not the problem - you can
&gt; &gt; get the same level of reliabilty to that by simply updating the
&gt; &gt; global metadata before &amp; after hotplug in the same way. What is
&gt; &gt; difficult is when libvirt fails to persist the XML config on disk
&gt; &gt; or when libvirt crashes part way through the operation, and other
&gt; &gt; akward failure scenarios unrelated to QEMU itself.
&gt; 
&gt; In that case you lose the device definition too, since saving the XML is
&gt; the integral part of the hotplug operation.

Agreed, but that just re-inforces my view that we don't need to provide
extra metadata against the device for sake of atomicity. Even the existing
hotplug doesn't guarantee any kind of atomicity, so you're not making life
worse by performing a separate API call to update the global metadata.


Regards,
Daniel
-- 
|: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
|: http://libvirt.org              -o-             http://virt-manager.org :|
|: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|

</body></email><email><emailId>20170317150840</emailId><senderName>Francesco Romani</senderName><senderEmail>fromani@redhat.com</senderEmail><timestampReceived>2017-03-17 15:08:40-0400</timestampReceived><subject>Re: [libvirt-users] [RFC] per-device metadata</subject><body>

(sorry for the wrong list, I was unsure and I choose the wrong one :\)


On 03/16/2017 03:42 PM, Daniel P. Berrange wrote:
&gt; On Thu, Mar 16, 2017 at 01:46:38PM +0100, Peter Krempa wrote:
&gt;&gt; For techincal discussions on design it's better to post to the
&gt;&gt; development list.
&gt;&gt;
&gt;&gt; On Mon, Feb 27, 2017 at 16:41:28 +0100, Francesco Romani wrote:
&gt;&gt;&gt; Hi,
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Currently libvirt supports metadata in the domain XML. This is very
&gt;&gt;&gt; convenient for data related to the VM, but it is a little awkward for
&gt;&gt;&gt; devices. Let's pretend I want to have extradata (say, a specific port
&gt;&gt;&gt; for a virtual switch) related to a device (say, a NIC). Nowadays I can
&gt;&gt;&gt; store that data in the metadata section, but I need some kind of mapping
&gt;&gt;&gt; to correlate this piece of information to the specific device.
&gt;&gt;&gt;
&gt;&gt;&gt; I can use the device alias, but this is not available when the device is
&gt;&gt;&gt; created. This is also more complex when doing hotplug/hotunplug, because
&gt;&gt;&gt; I need to do update device and update metadata; if either fails, the
&gt;&gt;&gt; entire operation must be considered failed.
&gt;&gt;&gt;
&gt;&gt;&gt; It would be nice to be able to attach metadata to the device, and this
&gt;&gt;&gt; is what I'm asking for/proposing in this mail.
&gt;&gt;&gt;
&gt;&gt;&gt; Would it be possible in a future libvirt release?
&gt;&gt; In general I don't have a problem with this and if it would make the
&gt;&gt; life of mgmt tools easier I don't see a reason why not.
&gt;&gt;
&gt;&gt; There's one problem though. For setter (or getter) APIs for the metadata
&gt;&gt; you need a way how to uniquely identify a device on which you want to
&gt;&gt; operate. There's no such way currently in use in libvirt so you need to
&gt;&gt; come up with something to do it.
&gt; Once you have a reliable identifier for a device, it is not compelling
&gt; to store metadata against each device as you can reliably identify the
&gt; device from data in the existing metadata block. I don't find the
&gt; atomicity argument very compelling, because even if hidden behind a
&gt; single libvirt API, it is still fundamentally multiple operations in
&gt; libvirt which are just as likely to fail as if the app did multiple
&gt; libvirt API calls as we're not able to provide any kind of transactional
&gt; guarantees here.

I see. From the consumer API perspective, it is still much more
convenient, but I understand this point.

&gt; IOW, we could effectively solve this by assigning the device alias
&gt; names at XML define time, instead of VM launch time. We historically
&gt; didn't do this since we wanted to cope with old QEMU which didn't
&gt; allow custom device aliases. We now mandate a new QEMU that supports
&gt; -device, so that's no longer a problem. So I'd prefer to see us just
&gt; define device aliases persistently and let apps use those to track
&gt; metadata in the global metadata section.

For oVirt, being able to set aliases at XML define time is definitely
great news.

Currently we must resort to some heuristic after the first run to match
aliases with devices,
and we look forward to have a more reliable way.

Thanks,

-- 
Francesco Romani
Red Hat Engineering Virtualization R &amp; D
IRC: fromani

</body></email><email><emailId>20170321110625</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-03-21 11:06:25-0400</timestampReceived><subject>Re: [libvirt-users] Get PID of a domain's QEMU instance from its domain ID</subject><body>


On Mon, Mar 20, 2017 at 02:11:21PM +0100, Thibaut SAUTEREAU wrote:
&gt;Hello,
&gt;
&gt;I cannot find a way to retrieve PIDs of QEMU instances from libvirt domains'
&gt;IDs (I'm using libvirt C API). I recognize it sounds like a bad idea doing so
&gt;(and I know PIDs are explicitly made not available, as I gathered from the
&gt;source code and on your IRC channel) but I need that to use the perf_event_open
&gt;syscall in order to gather statistics on my QEMU/KVM guests. I also know
&gt;libvirt now supports some perf events but only a few and I need more. I could
&gt;submit patches to add them and I will definitely consider that but in the
&gt;meantime...
&gt;
&gt;What would be the best way to get those PIDs? I tried using the XML file but
&gt;PID is hidden in there too. I took a look at QEMU Machine Protocol. Now I'm
&gt;going to walk /proc and match on guests names but it is not that elegant.
&gt;Any ideas?
&gt;

`ps aux | grep $UUID | grep -v grep` ??

&gt;Thanks,
&gt;
&gt;Thibaut S.
&gt;
&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170321115039</emailId><senderName>Peter Krempa</senderName><senderEmail>pkrempa@redhat.com</senderEmail><timestampReceived>2017-03-21 11:50:39-0400</timestampReceived><subject>Re: [libvirt-users] Get PID of a domain's QEMU instance from its domain ID</subject><body>


On Tue, Mar 21, 2017 at 12:06:25 +0100, Martin Kletzander wrote:
&gt; On Mon, Mar 20, 2017 at 02:11:21PM +0100, Thibaut SAUTEREAU wrote:
&gt; &gt; Hello,
&gt; &gt; 
&gt; &gt; I cannot find a way to retrieve PIDs of QEMU instances from libvirt domains'
&gt; &gt; IDs (I'm using libvirt C API). I recognize it sounds like a bad idea doing so
&gt; &gt; (and I know PIDs are explicitly made not available, as I gathered from the
&gt; &gt; source code and on your IRC channel) but I need that to use the perf_event_open
&gt; &gt; syscall in order to gather statistics on my QEMU/KVM guests. I also know
&gt; &gt; libvirt now supports some perf events but only a few and I need more. I could
&gt; &gt; submit patches to add them and I will definitely consider that but in the
&gt; &gt; meantime...

Looks like you are looking for:
http://libvirt.org/formatdomain.html#elementsPerf

and 

http://libvirt.org/html/libvirt-libvirt-domain.html#virDomainGetPerfEvents

&gt; &gt; 
&gt; &gt; What would be the best way to get those PIDs? I tried using the XML file but
&gt; &gt; PID is hidden in there too. I took a look at QEMU Machine Protocol. Now I'm
&gt; &gt; going to walk /proc and match on guests names but it is not that elegant.
&gt; &gt; Any ideas?

Just to re-iterate. We hide it because users should not fiddle with the
VMs behind our backs.

&gt; &gt; 
&gt; 
&gt; `ps aux | grep $UUID | grep -v grep` ??

This will obviously work, but we won't give you an elegant way since we
don't want you to know the pid.

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170307120123</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-03-07 12:01:23-0400</timestampReceived><subject>Re: [libvirt-users] Help needed on a gentoo system after update to libvirtd 3.1.0</subject><body>

On 03/07/2017 11:44 AM, Marko Weber | 8000 wrote:
&gt; 
&gt; 
&gt; (sorry, dont know how i put my posting into an reply to an other issue
&gt; before,
&gt;  new posting to sepearte it, big sorry)
&gt; 
&gt; 
&gt; 
&gt; 
&gt; Hello list,
&gt; 
&gt; i updated on a gentoo system from libvirtd 2.5 to 3.1.0
&gt; Now my windows machines cant access internet.
&gt; I did a virbr1 with virt-manager and route it to the eth0, works fine on
&gt; 2.5
&gt; Hello list,
&gt; 


&gt; anyone knows this effect after update?
&gt; do i have to change some more things?
&gt; or is this a bug?

What is your domain configuration? What is your firewall setting? I use
gentoo too, but hasn't experienced this. On the other hand, I don't use
the same setting as you do.

Michal

</body></email><email><emailId>20170307165345</emailId><senderName>Marko Weber | 8000</senderName><senderEmail>weber@zbfmail.de</senderEmail><timestampReceived>2017-03-07 16:53:45-0400</timestampReceived><subject>Re: [libvirt-users] Help needed on a gentoo system after update to libvirtd 3.1.0</subject><body>



Am 2017-03-07 13:01, schrieb Michal Privoznik:
&gt; On 03/07/2017 11:44 AM, Marko Weber | 8000 wrote:
&gt;&gt; 
&gt;&gt; 
&gt;&gt; (sorry, dont know how i put my posting into an reply to an other issue
&gt;&gt; before,
&gt;&gt;  new posting to sepearte it, big sorry)
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Hello list,
&gt;&gt; 
&gt;&gt; i updated on a gentoo system from libvirtd 2.5 to 3.1.0
&gt;&gt; Now my windows machines cant access internet.
&gt;&gt; I did a virbr1 with virt-manager and route it to the eth0, works fine 
&gt;&gt; on
&gt;&gt; 2.5
&gt;&gt; Hello list,
&gt;&gt; 
&gt; 
&gt; 
&gt;&gt; anyone knows this effect after update?
&gt;&gt; do i have to change some more things?
&gt;&gt; or is this a bug?
&gt; 
&gt; What is your domain configuration? What is your firewall setting? I use
&gt; gentoo too, but hasn't experienced this. On the other hand, I don't use
&gt; the same setting as you do.
&gt; 
&gt; Michal

Hello Michal,
what do you mean with "domain config"? i can do a virsh xml dump of the 
domain.
Firewall, i dont used an nw* from libvirt, i do all via iptables &amp; 
shorewall

i paste it here
tell me if you need more

the domain:

&lt;domain type='kvm' id='4'&gt;
   &lt;name&gt;PAC-DC&lt;/name&gt;
   &lt;uuid&gt;47d0e291-ff7f-47af-98ef-ee8b8124af0d&lt;/uuid&gt;
   &lt;title&gt;PAC-DC&lt;/title&gt;
   &lt;memory unit='KiB'&gt;16777216&lt;/memory&gt;
   &lt;currentMemory unit='KiB'&gt;16777216&lt;/currentMemory&gt;
   &lt;vcpu placement='static' current='2'&gt;12&lt;/vcpu&gt;
   &lt;resource&gt;
     &lt;partition&gt;/machine&lt;/partition&gt;
   &lt;/resource&gt;
   &lt;os&gt;
     &lt;type arch='x86_64' machine='pc-i440fx-2.8'&gt;hvm&lt;/type&gt;
     &lt;bootmenu enable='yes'/&gt;
   &lt;/os&gt;
   &lt;features&gt;
     &lt;acpi/&gt;
     &lt;apic/&gt;
     &lt;hyperv&gt;
       &lt;relaxed state='on'/&gt;
       &lt;vapic state='on'/&gt;
       &lt;spinlocks state='on' retries='8191'/&gt;
     &lt;/hyperv&gt;
   &lt;/features&gt;
   &lt;cpu mode='custom' match='exact'&gt;
     &lt;model fallback='forbid'&gt;Broadwell&lt;/model&gt;
     &lt;vendor&gt;Intel&lt;/vendor&gt;
     &lt;topology sockets='1' cores='6' threads='2'/&gt;
     &lt;feature policy='require' name='vme'/&gt;
     &lt;feature policy='require' name='ds'/&gt;
     &lt;feature policy='require' name='acpi'/&gt;
     &lt;feature policy='require' name='ss'/&gt;
     &lt;feature policy='require' name='ht'/&gt;
     &lt;feature policy='require' name='tm'/&gt;
     &lt;feature policy='require' name='pbe'/&gt;
     &lt;feature policy='require' name='dtes64'/&gt;
     &lt;feature policy='require' name='monitor'/&gt;
     &lt;feature policy='require' name='ds_cpl'/&gt;
     &lt;feature policy='require' name='vmx'/&gt;
     &lt;feature policy='require' name='smx'/&gt;
     &lt;feature policy='require' name='est'/&gt;
     &lt;feature policy='require' name='tm2'/&gt;
     &lt;feature policy='require' name='xtpr'/&gt;
     &lt;feature policy='require' name='pdcm'/&gt;
     &lt;feature policy='require' name='dca'/&gt;
     &lt;feature policy='require' name='osxsave'/&gt;
     &lt;feature policy='require' name='f16c'/&gt;
     &lt;feature policy='require' name='rdrand'/&gt;
     &lt;feature policy='require' name='arat'/&gt;
     &lt;feature policy='require' name='tsc_adjust'/&gt;
     &lt;feature policy='require' name='xsaveopt'/&gt;
     &lt;feature policy='require' name='pdpe1gb'/&gt;
     &lt;feature policy='require' name='abm'/&gt;
   &lt;/cpu&gt;
   &lt;clock offset='localtime'&gt;
     &lt;timer name='rtc' tickpolicy='catchup'/&gt;
     &lt;timer name='pit' tickpolicy='delay'/&gt;
     &lt;timer name='hpet' present='no'/&gt;
     &lt;timer name='hypervclock' present='yes'/&gt;
   &lt;/clock&gt;
   &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
   &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
   &lt;on_crash&gt;restart&lt;/on_crash&gt;
   &lt;pm&gt;
     &lt;suspend-to-mem enabled='no'/&gt;
     &lt;suspend-to-disk enabled='no'/&gt;
   &lt;/pm&gt;
   &lt;devices&gt;
     &lt;emulator&gt;/usr/bin/qemu-system-x86_64&lt;/emulator&gt;
     &lt;disk type='file' device='disk'&gt;
       &lt;driver name='qemu' type='qcow2'/&gt;
       &lt;source file='/vm/windows-2016-_DC.qcow2'/&gt;
       &lt;backingStore/&gt;
       &lt;target dev='vda' bus='virtio'/&gt;
       &lt;boot order='2'/&gt;
       &lt;alias name='virtio-disk0'/&gt;
       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x06' 
function='0x0'/&gt;
     &lt;/disk&gt;
     &lt;disk type='file' device='cdrom'&gt;
       &lt;driver name='qemu' type='raw'/&gt;
       &lt;backingStore/&gt;
       &lt;target dev='hdb' bus='ide'/&gt;
       &lt;readonly/&gt;
       &lt;boot order='1'/&gt;
       &lt;alias name='ide0-0-1'/&gt;
       &lt;address type='drive' controller='0' bus='0' target='0' unit='1'/&gt;
     &lt;/disk&gt;
     &lt;disk type='file' device='cdrom'&gt;
       &lt;driver name='qemu' type='raw'/&gt;
       &lt;source file='/store/virtio-win.iso'/&gt;
       &lt;backingStore/&gt;
       &lt;target dev='hdc' bus='ide'/&gt;
       &lt;readonly/&gt;
       &lt;alias name='ide0-1-0'/&gt;
       &lt;address type='drive' controller='0' bus='1' target='0' unit='0'/&gt;
     &lt;/disk&gt;
     &lt;controller type='usb' index='0' model='ich9-ehci1'&gt;
       &lt;alias name='usb'/&gt;
       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x04' 
function='0x7'/&gt;
     &lt;/controller&gt;
     &lt;controller type='usb' index='0' model='ich9-uhci1'&gt;
       &lt;alias name='usb'/&gt;
       &lt;master startport='0'/&gt;
       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x04' 
function='0x0' multifunction='on'/&gt;
     &lt;/controller&gt;
     &lt;controller type='usb' index='0' model='ich9-uhci2'&gt;
       &lt;alias name='usb'/&gt;
       &lt;master startport='2'/&gt;
       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x04' 
function='0x1'/&gt;
     &lt;/controller&gt;
     &lt;controller type='usb' index='0' model='ich9-uhci3'&gt;
       &lt;alias name='usb'/&gt;
       &lt;master startport='4'/&gt;
       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x04' 
function='0x2'/&gt;
     &lt;/controller&gt;
     &lt;controller type='pci' index='0' model='pci-root'&gt;
       &lt;alias name='pci.0'/&gt;
     &lt;/controller&gt;
     &lt;controller type='ide' index='0'&gt;
       &lt;alias name='ide'/&gt;
       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x01' 
function='0x1'/&gt;
     &lt;/controller&gt;
     &lt;controller type='virtio-serial' index='0'&gt;
       &lt;alias name='virtio-serial0'/&gt;
       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05' 
function='0x0'/&gt;
     &lt;/controller&gt;
     &lt;interface type='network'&gt;
       &lt;mac address='52:54:00:0f:69:2b'/&gt;
       &lt;source network='br1' bridge='virbr1'/&gt;
       &lt;target dev='vnet0'/&gt;
       &lt;model type='virtio'/&gt;
       &lt;alias name='net0'/&gt;
       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03' 
function='0x0'/&gt;
     &lt;/interface&gt;
     &lt;serial type='pty'&gt;
       &lt;source path='/dev/pts/1'/&gt;
       &lt;target port='0'/&gt;
       &lt;alias name='serial0'/&gt;
     &lt;/serial&gt;
     &lt;console type='pty' tty='/dev/pts/1'&gt;
       &lt;source path='/dev/pts/1'/&gt;
       &lt;target type='serial' port='0'/&gt;
       &lt;alias name='serial0'/&gt;
     &lt;/console&gt;
     &lt;console type='pty'&gt;
       &lt;source path='/dev/pts/2'/&gt;
       &lt;target type='virtio' port='1'/&gt;
       &lt;alias name='console1'/&gt;
     &lt;/console&gt;
     &lt;channel type='unix'&gt;
       &lt;source mode='bind' 
path='/var/lib/libvirt/qemu/channel/target/domain-4-PAC-DC/org.qemu.guest_agent.0'/&gt;
       &lt;target type='virtio' name='org.qemu.guest_agent.0' 
state='connected'/&gt;
       &lt;alias name='channel0'/&gt;
       &lt;address type='virtio-serial' controller='0' bus='0' port='1'/&gt;
     &lt;/channel&gt;
     &lt;input type='tablet' bus='usb'&gt;
       &lt;alias name='input0'/&gt;
       &lt;address type='usb' bus='0' port='1'/&gt;
     &lt;/input&gt;
     &lt;input type='mouse' bus='ps2'&gt;
       &lt;alias name='input1'/&gt;
     &lt;/input&gt;
     &lt;input type='keyboard' bus='ps2'&gt;
       &lt;alias name='input2'/&gt;
     &lt;/input&gt;
     &lt;graphics type='vnc' port='5900' autoport='yes' listen='127.0.0.1'&gt;
       &lt;listen type='address' address='127.0.0.1'/&gt;
     &lt;/graphics&gt;
     &lt;video&gt;
       &lt;model type='virtio' heads='1' primary='yes'/&gt;
       &lt;alias name='video0'/&gt;
       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02' 
function='0x0'/&gt;
     &lt;/video&gt;
     &lt;memballoon model='virtio'&gt;
       &lt;stats period='5'/&gt;
       &lt;alias name='balloon0'/&gt;
       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x07' 
function='0x0'/&gt;
     &lt;/memballoon&gt;
     &lt;rng model='virtio'&gt;
       &lt;backend model='random'&gt;/dev/random&lt;/backend&gt;
       &lt;alias name='rng0'/&gt;
       &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08' 
function='0x0'/&gt;
     &lt;/rng&gt;
   &lt;/devices&gt;
   &lt;seclabel type='none' model='none'/&gt;
   &lt;seclabel type='dynamic' model='dac' relabel='yes'&gt;
     &lt;label&gt;+77:+77&lt;/label&gt;
     &lt;imagelabel&gt;+77:+77&lt;/imagelabel&gt;
   &lt;/seclabel&gt;
&lt;/domain&gt;


networking br1 (virbr1):
and routed to existing br0

virsh # net-dumpxml br1
&lt;network connections='2'&gt;
   &lt;name&gt;br1&lt;/name&gt;
   &lt;uuid&gt;990cd005-c551-4f5e-86f9-9b718f3b810b&lt;/uuid&gt;
   &lt;forward dev='br0' mode='route'&gt;
     &lt;interface dev='br0'/&gt;
   &lt;/forward&gt;
   &lt;bridge name='virbr1' stp='on' delay='0'/&gt;
   &lt;mac address='52:54:00:75:a4:2f'/&gt;
   &lt;domain name='br1'/&gt;
   &lt;ip address='192.168.18.1' netmask='255.255.255.0'&gt;
   &lt;/ip&gt;
&lt;/network&gt;


you need more info?

hmm i also had an "host-bridge" defined network to br0 on my gentoo 
machine

# ifconfig
br0: flags=4419&lt;UP,BROADCAST,RUNNING,PROMISC,MULTICAST&gt;  mtu 1500
         inet 192.168.17.1  netmask 255.255.255.0  broadcast 
192.168.17.255
         ether f6:6a:1c:5a:e8:93  txqueuelen 1000  (Ethernet)
         RX packets 67984  bytes 5401548 (5.1 MiB)
         RX errors 0  dropped 0  overruns 0  frame 0
         TX packets 33143  bytes 45362855 (43.2 MiB)
         TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
         inet 88.198.185.235  netmask 255.255.255.192  broadcast 
88.198.185.255
         ether 18:66:da:88:0d:37  txqueuelen 1000  (Ethernet)
         RX packets 1080633  bytes 990840130 (944.9 MiB)
         RX errors 0  dropped 0  overruns 0  frame 0
         TX packets 1735305  bytes 2045606964 (1.9 GiB)
         TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
         device interrupt 18

lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536
         inet 127.0.0.1  netmask 255.0.0.0
         loop  txqueuelen 1000  (Local Loopback)
         RX packets 607097  bytes 1883581534 (1.7 GiB)
         RX errors 0  dropped 0  overruns 0  frame 0
         TX packets 607097  bytes 1883581534 (1.7 GiB)
         TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

tap0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
         ether f6:6a:1c:5a:e8:93  txqueuelen 100  (Ethernet)
         RX packets 67984  bytes 6353324 (6.0 MiB)
         RX errors 0  dropped 0  overruns 0  frame 0
         TX packets 85353  bytes 48259222 (46.0 MiB)
         TX errors 0  dropped 188 overruns 0  carrier 0  collisions 0

virbr1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
         inet 192.168.18.1  netmask 255.255.255.0  broadcast 
192.168.18.255
         ether 52:54:00:75:a4:2f  txqueuelen 1000  (Ethernet)
         RX packets 178002  bytes 54585053 (52.0 MiB)
         RX errors 0  dropped 0  overruns 0  frame 0
         TX packets 241542  bytes 899962475 (858.2 MiB)
         TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

vnet0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
         ether fe:54:00:0f:69:2b  txqueuelen 1000  (Ethernet)
         RX packets 3692  bytes 3461678 (3.3 MiB)
         RX errors 0  dropped 0  overruns 0  frame 0
         TX packets 14142  bytes 1201183 (1.1 MiB)
         TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

vnet1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
         ether fe:54:00:0a:34:1e  txqueuelen 1000  (Ethernet)
         RX packets 79661  bytes 18343744 (17.4 MiB)
         RX errors 0  dropped 0  overruns 0  frame 0
         TX packets 112365  bytes 437957368 (417.6 MiB)
         TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0


or do i have to set via virt-manager the br1 (virbr1) routed to eth0?

thanks

Marko

</body></email><email><emailId>20170307170631</emailId><senderName>Marko Weber | 8000</senderName><senderEmail>weber@zbfmail.de</senderEmail><timestampReceived>2017-03-07 17:06:31-0400</timestampReceived><subject>Re: [libvirt-users] Help needed on a gentoo system after update to libvirtd 3.1.0</subject><body>



Am 2017-03-07 13:01, schrieb Michal Privoznik:
&gt; On 03/07/2017 11:44 AM, Marko Weber | 8000 wrote:
&gt;&gt; 
&gt;&gt; 
&gt;&gt; (sorry, dont know how i put my posting into an reply to an other issue
&gt;&gt; before,
&gt;&gt;  new posting to sepearte it, big sorry)
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Hello list,
&gt;&gt; 
&gt;&gt; i updated on a gentoo system from libvirtd 2.5 to 3.1.0
&gt;&gt; Now my windows machines cant access internet.
&gt;&gt; I did a virbr1 with virt-manager and route it to the eth0, works fine 
&gt;&gt; on
&gt;&gt; 2.5
&gt;&gt; Hello list,
&gt;&gt; 
&gt; 
&gt; 
&gt;&gt; anyone knows this effect after update?
&gt;&gt; do i have to change some more things?
&gt;&gt; or is this a bug?
&gt; 
&gt; What is your domain configuration? What is your firewall setting? I use
&gt; gentoo too, but hasn't experienced this. On the other hand, I don't use
&gt; the same setting as you do.
&gt; 
&gt; Michal


Michal,
here is also the 'host-bridge' i defined via a short xml

virsh # net-dumpxml host-bridge
&lt;network&gt;
   &lt;name&gt;host-bridge&lt;/name&gt;
   &lt;uuid&gt;51a0a2b0-a568-4e5d-bd2b-c4315bbb7cbf&lt;/uuid&gt;
   &lt;forward mode='bridge'/&gt;
   &lt;bridge name='br0'/&gt;
&lt;/network&gt;

idea in email before was, to route virbr1 to eth0 instead br0.
is that a better way?

marko

</body></email><email><emailId>20170308100528</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-03-08 10:05:28-0400</timestampReceived><subject>Re: [libvirt-users] Help needed on a gentoo system after update to libvirtd 3.1.0</subject><body>


On Tue, Mar 07, 2017 at 10:49:06AM +0100, Marko Weber | 8000 wrote:
&gt;
&gt;
&gt;Hello list,
&gt;
&gt;i updated on a gentoo system from libvirtd 2.5 to 3.1.0
&gt;Now my windows machines cant access internet.
&gt;I did a virbr1 with virt-manager and route it to the eth0, works fine on
&gt;2.5
&gt;

Firstly, you replied to a message that has nothing to do with this, you
should fix your client if that wasn't just a mistake (which it could've
been, it happens).

I'm not precisely sure what you mean by just 'routing' it.  Can you
attach XMLs of the network and the domain?  Just the interface for the
domain would be enough.

&gt;
&gt;
&gt;on install i get this:
&gt;

[...]

&gt;For the basic networking support (bridged and routed networks) you don't
&gt;need any extra software. For more complex network modes including but
&gt;not
&gt;limited to NATed network, you can enable the 'virt-network' USE flag. It
&gt;will pull in required runtime dependencies
&gt;

[...]

&gt;
&gt;virt-manager starts fine and shows my vm´s. i dont touched /etc/dnsmasq
&gt;cause i dont used it. so left untouched.
&gt;yes, i added libvirt-guests with rc-update
&gt;

From all the above, only the virt-network USE flag is related.  Do you
have it enabled?

&gt;the virbr1 has 192.168.18.1 as address, and is reachable via ping from
&gt;vm guest.
&gt;but it cant resolve hostnames and cant ping ip´s outside the
&gt;virtualisation host.
&gt;

So this is why I had a feeling it's not just routed out.  It's NATted
network, OK.  So for DNS resolution you need dnsmasq running on the host
or setup nameservers to point to outside ones if you are using just
static IPs.  For accessing outside networks there should be iptables
rules for all that to work.  Can you check if they changed during the
update?

Also, did you restart the network?  You shouldn't (need to) do that when
the domain is running.

&gt;anyone knows this effect after update?
&gt;do i have to change some more things?
&gt;or is this a bug?
&gt;

There should be no need to change anything.

&gt;any help and hints are welcome
&gt;
&gt;thank you
&gt;
&gt;marko weber
&gt;
&gt;
&gt;
&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170308101133</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-03-08 10:11:33-0400</timestampReceived><subject>Re: [libvirt-users] Help needed on a gentoo system after update to libvirtd 3.1.0</subject><body>


On Tue, Mar 07, 2017 at 05:53:45PM +0100, Marko Weber | 8000 wrote:
&gt;
&gt;
&gt;Am 2017-03-07 13:01, schrieb Michal Privoznik:
&gt;&gt; On 03/07/2017 11:44 AM, Marko Weber | 8000 wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; (sorry, dont know how i put my posting into an reply to an other issue
&gt;&gt;&gt; before,
&gt;&gt;&gt;  new posting to sepearte it, big sorry)
&gt;&gt;&gt;

Oh yeah, sorry for my previous mail, I replied to the other one before
noticing this one :)

In addition to what you posted here, can you also attach the output of
`brctl show`?

Thanks and sorry once more,
Martin

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170308113522</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-03-08 11:35:22-0400</timestampReceived><subject>Re: [libvirt-users] events dispatching in  synchronous mode</subject><body>

On Wed, Mar 08, 2017 at 11:27:17AM +0000, Matczak, KrzysztofX wrote:
&gt; Hi
&gt; Is there any way to get events dispatching in synchronous mode ?
&gt; I mean I'm running  my own events polling loop which calls
&gt; virEventRunDefaultImpl  each turn . I'd expect to get my callback
&gt; function called synchronously , but it's not . Seems that's async
&gt; call.
&gt; Maybe it's my general misunderstanding and I shouldn't use
&gt; virEventRunDefaultImpl for that ?

By design, all libvirt event dispatch is asynchronous wrt API calls
which trigger the events. The only guarantee we can make is that
events are dispatched in the order in which they occurr.


Regards,
Daniel
-- 
|: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
|: http://libvirt.org              -o-             http://virt-manager.org :|
|: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|

</body></email><email><emailId>20170308094331</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-03-08 09:43:31-0400</timestampReceived><subject>Re: [libvirt-users] Insert/eject USB</subject><body>


On Sat, Mar 04, 2017 at 01:14:39AM -0600, Leroy Tennison wrote:
&gt;Is it possible to insert and eject a USB image in kvm/qemu/libvirt or
&gt;are the only dynamically changeable devices cdroms and floppies?  I've
&gt;searched the web and I'm either not looking for the right terms or it's
&gt;obscure.  I should mention that I'm not talking about a connecting a
&gt;physical host USB drive to a guest image, I want to be able to use a
&gt;qcow image as the source.
&gt;
&gt;The context is that I want to be able to revert a VM image back to a
&gt;prior state (internal snapshot) when testing but be able to retain some
&gt;data without having to go to the effort of transferring it across the
&gt;network.  I've excluded cdroms as an option because they are read-only
&gt;(correct me if I'm wrong on this) and require some effort to (re)build.
&gt;Floppy drives appear to be limited to 1.44M which makes sense but is
&gt;very limiting. Network mounts (NFS, Samba, etc.) require a server
&gt;supporting the selected style of filesystem sharing over the network.
&gt;I'm not sure I want to find out what happens to filesystem passthrough
&gt;when a revert is done (unless someone knows and it's beneficial).
&gt;

I'm probably misunderstanding what you want precisely.  What I
understood at first was that you just want to get some data back from a
VM before restoring it to a previous state.  And I wondered what's the
effort there since you can just use scp, rsync or just netcat =)

Reading the mail third time I think I got it, but I need you to confirm
so that I'm sure I did understand it right.  You probably want to have a
filesystem attached all the time, do stuff on the machine, have stuff
saved on that filesystem and then revert it without the aforementioned
filesystem being touched in any way.  And probably doing this multiple
times, that's why copying it every time is time-consuming in a long run.

&gt;I tried creating a partition associated with the VM but not
&gt;auto-mounted, even if I unmounted the partition before reverting its
&gt;state was rolled back.  I possibly could get exotic here by setting the
&gt;immutable attribute after unmounting the partition but, again, I'm
&gt;hoping for something a little simpler and more straightforward.  If
&gt;there's a workable option I haven't considered I'm open to that.
&gt;

How are you "reverting back" the state?  If you have a snapshot for the
machine you can specify which disks are supposed to be part of that
snapshot so that you can revert everything except one disk that you use
for some results, for example.  Would that be an option for you?

&gt;Thanks for any input.
&gt;
&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170306133821</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-03-06 13:38:21-0400</timestampReceived><subject>Re: [libvirt-users] domain reinitalization detection</subject><body>

On 06.03.2017 14:14, Matczak, KrzysztofX wrote:
&gt; Hello
&gt; 
&gt; I'm trying to find out how to detect if domain was destroyed and brought up between \
&gt; two time moments,  let's call it reads.  So far the best approach I could find is \
&gt; to compare domain ID from previous and current read.  And this is my first question \
&gt; : is that reliable solution ? Or do you know any better  ?

Listen to the events. If domain is destroyed/started libvirt fires up an
event. The domain ID is not necessarily unique. For instance:

a) start a domain and assume it's the first one started. It will have ID=1.
b) destroy it.
c) restart libvirtd.
d) start the domain again - it will have ID=1.

This applies to qemu driver, other drivers might have different meaning
for domain IDs - e.g. LXC driver reports PID of the container's init in
which case you can make no assumptions about it.

&gt; 
&gt; And related question is how to  resolve virDomainPtr into domain ID ?

virDomainGetID().

&gt; The only verified  way  of getting domain ID I know is  to memorize it's UUID, then \
&gt; call virConnectListDomains , then iterate over all returned domain IDs and resolve \
&gt; each one's pointer  using virDomainLookupByID , then  get  UUID  by \
&gt; virDomainGetUUIDString  get domain ID of matching UUID's .   It seems too complex  \
&gt; and I  expect noticeable performance overhead, so looking for something lighter.   
&gt; I'm trying to get current domain ID using  API function : 
&gt; 
&gt; char *    virDomainGetMetadata (virDomainPtr domain,  int type,  const char * uri, \
&gt; unsigned int flags) 
&gt; I'm  not sure it's  relevant  function, since domain ID is contained not in \
&gt; metadata subsection but in opening &lt;domain&gt; markup.  In fact  I wasn't even able to \
&gt; get any data using that function call since I don't know how to construct valid \
&gt; URI. Do you know any doc or examples explaining that ?  

Documentation might come handy:

http://libvirt.org/html/libvirt-libvirt-domain.html#virDomainSetMetadata
http://libvirt.org/html/libvirt-libvirt-domain.html#virDomainGetMetadata

or just look into our test suite:

http://libvirt.org/git/?p=libvirt.git;a=blob;f=tests/metadatatest.c;h=55dc841254bcfda0742d22580723bf4acac172b4;hb=HEAD


Michal


</body></email><email><emailId>20170306135153</emailId><senderName>"Matczak, KrzysztofX"</senderName><senderEmail>krzysztofx.matczak@intel.com</senderEmail><timestampReceived>2017-03-06 13:51:53-0400</timestampReceived><subject>Re: [libvirt-users] domain reinitalization detection</subject><body>

&gt; Listen to the events
I guess that would require running my own polling thread, right ? I wanted to avoid \
that ...

Thanks for help


On 06.03.2017 14:14, Matczak, KrzysztofX wrote:
&gt; Hello
&gt; 
&gt; I'm trying to find out how to detect if domain was destroyed and brought up between \
&gt; two time moments,  let's call it reads.  So far the best approach I could find is \
&gt; to compare domain ID from previous and current read.  And this is my first question \
&gt; : is that reliable solution ? Or do you know any better  ?

Listen to the events. If domain is destroyed/started libvirt fires up an event. The \
domain ID is not necessarily unique. For instance:

a) start a domain and assume it's the first one started. It will have ID=1.
b) destroy it.
c) restart libvirtd.
d) start the domain again - it will have ID=1.

This applies to qemu driver, other drivers might have different meaning for domain \
IDs - e.g. LXC driver reports PID of the container's init in which case you can make \
no assumptions about it.

&gt; 
&gt; And related question is how to  resolve virDomainPtr into domain ID ?

virDomainGetID().

&gt; The only verified  way  of getting domain ID I know is  to memorize it's UUID, then \
&gt; call virConnectListDomains , then iterate over all returned domain IDs and resolve \
&gt; each one's pointer  using virDomainLookupByID , then  get  UUID  by \
&gt; virDomainGetUUIDString  get domain ID of matching UUID's .   It seems too complex  \
&gt; and I  expect noticeable performance overhead, so looking for something lighter.   
&gt; I'm trying to get current domain ID using  API function : 
&gt; 
&gt; char *    virDomainGetMetadata (virDomainPtr domain,  int type,  const char * uri, \
&gt; unsigned int flags) 
&gt; I'm  not sure it's  relevant  function, since domain ID is contained not in \
&gt; metadata subsection but in opening &lt;domain&gt; markup.  In fact  I wasn't even able to \
&gt; get any data using that function call since I don't know how to construct valid \
&gt; URI. Do you know any doc or examples explaining that ?  

Documentation might come handy:

http://libvirt.org/html/libvirt-libvirt-domain.html#virDomainSetMetadata
http://libvirt.org/html/libvirt-libvirt-domain.html#virDomainGetMetadata

or just look into our test suite:

http://libvirt.org/git/?p=libvirt.git;a=blob;f=tests/metadatatest.c;h=55dc841254bcfda0742d22580723bf4acac172b4;hb=HEAD


Michal
--------------------------------------------------------------
Intel Research and Development Ireland Limited
Registered in Ireland
Registered Office: Collinstown Industrial Park, Leixlip, County Kildare
Registered Number: 308263


This e-mail and any attachments may contain confidential material for the sole
use of the intended recipient(s). Any review or distribution by others is
strictly prohibited. If you are not the intended recipient, please contact the
sender and delete all copies.


</body></email><email><emailId>20170302023804</emailId><senderName>Max Ehrlich</senderName><senderEmail>max.ehr@gmail.com</senderEmail><timestampReceived>2017-03-02 02:38:04-0400</timestampReceived><subject>Re: [libvirt-users] Bluetooth Device Support</subject><body>

I managed to make some progress on this

I remember reading that the -usbdevice command line option can only create
uhci connections. When I opened my virtual machine settings in virt-manager
I found that I had a single USB controller configured (apparently exactly 1
is allowed) and it was set to USB1.

I should have done this earlier beacuse USB1 is slow so I set it to USB3.
Now, when I boot with the same XML, I have a bluetooth radio in the windows
device manager. So what I think is happening is that qemu is free to add a
uhci adapter for the emulated bluetooth since the only connected adapter
from libvirt is xhci.

Only problem left is, it has the little yellow arrow and its status
indicates "Windows has stopped this device because it has reported
problems. (Code 43)" . So either the thing isn't meant to work on Windows
10 (ss it was added some time ago), I need to find a driver (google was no
help), or I have the wrong command line options.

Guidance from anyone is appreciated, it feels like I am close to solving
this but somehow still frustratingly far away

On Wed, Mar 1, 2017 at 7:22 AM Max Ehrlich &lt;max.ehr@gmail.com&gt; wrote:

&gt; Daniel,
&gt;
&gt; Thanks for the reply.
&gt;
&gt; This is pretty much what I had assumed. I would guess that assigning any
&gt; free address, or telling qemu to plug the bt device into a controller that
&gt; libvirt creates, might work, but I cant find anything in the documentation
&gt; for qemu that would assign an address via command line. Do you know how to
&gt; do it?
&gt;
&gt; thanks,
&gt; Max
&gt;
&gt; On Wed, Mar 1, 2017 at 4:11 AM Daniel P. Berrange &lt;berrange@redhat.com&gt;
&gt; wrote:
&gt;
&gt; On Tue, Feb 28, 2017 at 09:33:16PM +0000, Max Ehrlich wrote:
&gt; &gt; Hi,
&gt; &gt;
&gt; &gt; I want to create a virtual hci device on my virtual machine. I have seen
&gt; &gt; that qemu has options supporting this
&gt; &gt;
&gt; &gt; https://qemu.weilnetz.de/doc/qemu-doc.html#Bluetooth_0028R_0029-options
&gt; &gt;
&gt; &gt; and
&gt; &gt;
&gt; &gt; https://qemu.weilnetz.de/doc/qemu-doc.html#pcsys_005fusb
&gt; &gt;
&gt; &gt; Is there any support for these options in libvirt? I was not able to find
&gt;
&gt; No, libvirt doesn't have explicit support for bluetooh at this time.
&gt;
&gt; &gt; anything in documentation so I added the qemu command line xml as follows
&gt; &gt; &lt;qemu:commandline&gt;
&gt; &gt;     &lt;qemu:arg value='-usbdevice'/&gt;
&gt; &gt;     &lt;qemu:arg value='bt:hci'/&gt;
&gt; &gt;     &lt;qemu:arg value='-bt'/&gt;
&gt; &gt;     &lt;qemu:arg value='hci,host'/&gt;
&gt; &gt;   &lt;/qemu:commandline&gt;
&gt; &gt;
&gt; &gt; but when I try to run my machine from virt-manager i get the following
&gt; &gt; error:
&gt; &gt;
&gt; &gt; Error starting domain: internal error: process exited while connecting to
&gt; &gt; monitor: 2017-02-28T21:25:51.735987Z qemu-system-x86_64: -device
&gt; &gt; ich9-usb-ehci1,id=usb,bus=pcie.0,addr=0x1d.0x7: PCI: slot 29 function 7
&gt; not
&gt; &gt; available for ich9-usb-ehci1, in use by ich9-usb-ehci1
&gt; &gt;
&gt; &gt; this error does not appear if I remove the commandline xml nodes
&gt; &gt;
&gt; &gt; Does anyone have any guidance for troubleshooting this?
&gt;
&gt; Libvirt assigns PCI addresses for every device it adds. QEMU will assign
&gt; addresses for any device that doesn't have an address present. Your
&gt; custom device is missing an address and QEMU is asigning one, unaware that
&gt; the address it picks will clash with one assigned by libvirt.
&gt;
&gt; To fix this you probably need to add addressing to your device addition,
&gt; but I'm unclear about exactly how the bluetooth devices work in QEMU so
&gt; can't give an explicit recommendation
&gt;
&gt;
&gt; Regards,
&gt; Daniel
&gt; --
&gt; |: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/
&gt; :|
&gt; |: http://libvirt.org              -o-             http://virt-manager.org
&gt; :|
&gt; |: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/
&gt; :|
&gt;
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;I managed to make some progress on this&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I remember \
reading that the -usbdevice command line option can only create uhci connections. \
When I opened my virtual machine settings in virt-manager I found that I had a single \
USB controller configured (apparently exactly 1 is allowed) and it was set to USB1.  \
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I should have done this earlier beacuse USB1 is slow so I \
set it to USB3. Now, when I boot with the same XML, I have a bluetooth radio in the \
windows device manager. So what I think is happening is that qemu is free to add a \
uhci adapter for the emulated bluetooth since the only connected adapter from libvirt \
is xhci.  &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Only problem left is, it has the little yellow \
arrow and its status indicates "Windows has stopped this device because it has \
reported problems. (Code 43)" . So either the thing isn't meant to work on \
Windows 10 (ss it was added some time ago), I need to find a driver (google was no \
help), or I have the wrong command line options.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Guidance \
from anyone is appreciated, it feels like I am close to solving this but somehow \
still frustratingly far away&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;&lt;div \
dir="ltr"&gt;On Wed, Mar 1, 2017 at 7:22 AM Max Ehrlich &lt;&lt;a \
href="mailto:max.ehr@gmail.com"&gt;max.ehr@gmail.com&lt;/a&gt;&gt; wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr" class="gmail_msg"&gt;Daniel,&lt;div \
class="gmail_msg"&gt;&lt;br class="gmail_msg"&gt;&lt;/div&gt;&lt;div class="gmail_msg"&gt;Thanks for the \
reply.&lt;/div&gt;&lt;div class="gmail_msg"&gt;&lt;br class="gmail_msg"&gt;&lt;/div&gt;&lt;div \
class="gmail_msg"&gt;This is pretty much what I had assumed. I would guess that \
assigning any free address, or telling qemu to plug the bt device into a controller \
that libvirt creates, might work, but I cant find anything in the documentation for \
qemu that would assign an address via command line. Do you know how to do \
it?&lt;/div&gt;&lt;div class="gmail_msg"&gt;&lt;br class="gmail_msg"&gt;&lt;/div&gt;&lt;div \
class="gmail_msg"&gt;thanks,&lt;/div&gt;&lt;div class="gmail_msg"&gt;Max&lt;/div&gt;&lt;/div&gt;&lt;br \
class="gmail_msg"&gt;&lt;div class="gmail_quote gmail_msg"&gt;&lt;div dir="ltr" \
class="gmail_msg"&gt;On Wed, Mar 1, 2017 at 4:11 AM Daniel P. Berrange &lt;&lt;a \
href="mailto:berrange@redhat.com" class="gmail_msg" \
target="_blank"&gt;berrange@redhat.com&lt;/a&gt;&gt; wrote:&lt;br \
class="gmail_msg"&gt;&lt;/div&gt;&lt;blockquote class="gmail_quote gmail_msg" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;On Tue, Feb 28, 2017 at 09:33:16PM \
+0000, Max Ehrlich wrote:&lt;br class="gmail_msg"&gt; &gt; Hi,&lt;br class="gmail_msg"&gt;
&gt;&lt;br class="gmail_msg"&gt;
&gt; I want to create a virtual hci device on my virtual machine. I have seen&lt;br \
class="gmail_msg"&gt; &gt; that qemu has options supporting this&lt;br class="gmail_msg"&gt;
&gt;&lt;br class="gmail_msg"&gt;
&gt; &lt;a href="https://qemu.weilnetz.de/doc/qemu-doc.html#Bluetooth_0028R_0029-options" \
rel="noreferrer" class="gmail_msg" \
target="_blank"&gt;https://qemu.weilnetz.de/doc/qemu-doc.html#Bluetooth_0028R_0029-options&lt;/a&gt;&lt;br \
class="gmail_msg"&gt; &gt;&lt;br class="gmail_msg"&gt;
&gt; and&lt;br class="gmail_msg"&gt;
&gt;&lt;br class="gmail_msg"&gt;
&gt; &lt;a href="https://qemu.weilnetz.de/doc/qemu-doc.html#pcsys_005fusb" \
rel="noreferrer" class="gmail_msg" \
target="_blank"&gt;https://qemu.weilnetz.de/doc/qemu-doc.html#pcsys_005fusb&lt;/a&gt;&lt;br \
class="gmail_msg"&gt; &gt;&lt;br class="gmail_msg"&gt;
&gt; Is there any support for these options in libvirt? I was not able to find&lt;br \
class="gmail_msg"&gt; &lt;br class="gmail_msg"&gt;
No, libvirt doesn't have explicit support for bluetooh at this time.&lt;br \
class="gmail_msg"&gt; &lt;br class="gmail_msg"&gt;
&gt; anything in documentation so I added the qemu command line xml as follows&lt;br \
class="gmail_msg"&gt; &gt; &lt;qemu:commandline&gt;&lt;br class="gmail_msg"&gt;
&gt;        &lt;qemu:arg value='-usbdevice'/&gt;&lt;br class="gmail_msg"&gt;
&gt;        &lt;qemu:arg value='bt:hci'/&gt;&lt;br class="gmail_msg"&gt;
&gt;        &lt;qemu:arg value='-bt'/&gt;&lt;br class="gmail_msg"&gt;
&gt;        &lt;qemu:arg value='hci,host'/&gt;&lt;br class="gmail_msg"&gt;
&gt;     &lt;/qemu:commandline&gt;&lt;br class="gmail_msg"&gt;
&gt;&lt;br class="gmail_msg"&gt;
&gt; but when I try to run my machine from virt-manager i get the following&lt;br \
class="gmail_msg"&gt; &gt; error:&lt;br class="gmail_msg"&gt;
&gt;&lt;br class="gmail_msg"&gt;
&gt; Error starting domain: internal error: process exited while connecting to&lt;br \
class="gmail_msg"&gt; &gt; monitor: 2017-02-28T21:25:51.735987Z qemu-system-x86_64: \
-device&lt;br class="gmail_msg"&gt; &gt; ich9-usb-ehci1,id=usb,bus=pcie.0,addr=0x1d.0x7: \
PCI: slot 29 function 7 not&lt;br class="gmail_msg"&gt; &gt; available for ich9-usb-ehci1, \
in use by ich9-usb-ehci1&lt;br class="gmail_msg"&gt; &gt;&lt;br class="gmail_msg"&gt;
&gt; this error does not appear if I remove the commandline xml nodes&lt;br \
class="gmail_msg"&gt; &gt;&lt;br class="gmail_msg"&gt;
&gt; Does anyone have any guidance for troubleshooting this?&lt;br class="gmail_msg"&gt;
&lt;br class="gmail_msg"&gt;
Libvirt assigns PCI addresses for every device it adds. QEMU will assign&lt;br \
class="gmail_msg"&gt; addresses for any device that doesn't have an address present. \
Your&lt;br class="gmail_msg"&gt; custom device is missing an address and QEMU is asigning \
one, unaware that&lt;br class="gmail_msg"&gt; the address it picks will clash with one \
assigned by libvirt.&lt;br class="gmail_msg"&gt; &lt;br class="gmail_msg"&gt;
To fix this you probably need to add addressing to your device addition,&lt;br \
class="gmail_msg"&gt; but I'm unclear about exactly how the bluetooth devices work \
in QEMU so&lt;br class="gmail_msg"&gt; can't give an explicit recommendation&lt;br \
class="gmail_msg"&gt; &lt;br class="gmail_msg"&gt;
&lt;br class="gmail_msg"&gt;
Regards,&lt;br class="gmail_msg"&gt;
Daniel&lt;br class="gmail_msg"&gt;
--&lt;br class="gmail_msg"&gt;
&gt; &gt; &lt;a href="http://berrange.com" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://berrange.com&lt;/a&gt;         -o-      &lt;a \
&gt; &gt; href="http://www.flickr.com/photos/dberrange/" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://www.flickr.com/photos/dberrange/&lt;/a&gt; :|&lt;br \
&gt; &gt; class="gmail_msg"&gt;
&gt; &gt; &lt;a href="http://libvirt.org" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://libvirt.org&lt;/a&gt;                     -o-                    \
&gt; &gt; &lt;a href="http://virt-manager.org" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://virt-manager.org&lt;/a&gt; :|&lt;br class="gmail_msg"&gt;
&gt; &gt; &lt;a href="http://entangle-photo.org" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://entangle-photo.org&lt;/a&gt;           -o-      &lt;a \
&gt; &gt; href="http://search.cpan.org/~danberr/" rel="noreferrer" class="gmail_msg" \
&gt; &gt; target="_blank"&gt;http://search.cpan.org/~danberr/&lt;/a&gt; :|&lt;br class="gmail_msg"&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;



</body></email><email><emailId>20170307133033</emailId><senderName>Piotr Rybicki</senderName><senderEmail>piotr.rybicki@innervision.pl</senderEmail><timestampReceived>2017-03-07 13:30:33-0400</timestampReceived><subject>[libvirt-users] external snapshots freezes block device since qemu 2.8</subject><body>

Hello there.

I discovered, that since qemu 2.8 , external snapshots (very similar to: 
http://wiki.libvirt.org/page/Live-disk-backup-with-active-blockcommit), 
freezes block device after:

# virsh blockcommit (...)

There is no error message after completion of the command above.
I'm using gluster + ZFS fuse mount as a storage for a VM on gentoo.
libvirt debug showed nothing helpful.
With qemu &lt;2.8 -: snapshots are working as expected.

Is this a known issue?
Is it qemu or libvirt ?

If it helps, how can i diagnose this further?

Thank You &amp; Best regards
Piotr Rybicki

</body></email><email><emailId>20170307202102</emailId><senderName>"Matczak, KrzysztofX"</senderName><senderEmail>krzysztofx.matczak@intel.com</senderEmail><timestampReceived>2017-03-07 20:21:02-0400</timestampReceived><subject>Re: [libvirt-users] domain reinitalization detection</subject><body>

One additional question regarding event listening:  
How to control timeout on call to   virEventRunDefaultImpl  in event loop ? Default \
timeout  when there are no events is something like 5s , which is way too much for my \
application. I can't find related examples and API docs are not quite straightforward \
in that matter

thanks
Krzysztof

&gt; Listen to the events
I guess that would require running my own polling thread, right ? I wanted to avoid \
that ...

Thanks for help


On 06.03.2017 14:14, Matczak, KrzysztofX wrote:
&gt; Hello
&gt; 
&gt; I'm trying to find out how to detect if domain was destroyed and brought up between \
&gt; two time moments,  let's call it reads.  So far the best approach I could find is \
&gt; to compare domain ID from previous and current read.  And this is my first question \
&gt; : is that reliable solution ? Or do you know any better  ?

Listen to the events. If domain is destroyed/started libvirt fires up an event. The \
domain ID is not necessarily unique. For instance:

a) start a domain and assume it's the first one started. It will have ID=1.
b) destroy it.
c) restart libvirtd.
d) start the domain again - it will have ID=1.

This applies to qemu driver, other drivers might have different meaning for domain \
IDs - e.g. LXC driver reports PID of the container's init in which case you can make \
no assumptions about it.

&gt; 
&gt; And related question is how to  resolve virDomainPtr into domain ID ?

virDomainGetID().

&gt; The only verified  way  of getting domain ID I know is  to memorize it's UUID, then \
&gt; call virConnectListDomains , then iterate over all returned domain IDs and resolve \
&gt; each one's pointer  using virDomainLookupByID , then  get  UUID  by \
&gt; virDomainGetUUIDString  get domain ID of matching UUID's .   It seems too complex  \
&gt; and I  expect noticeable performance overhead, so looking for something lighter.   
&gt; I'm trying to get current domain ID using  API function : 
&gt; 
&gt; char *    virDomainGetMetadata (virDomainPtr domain,  int type,  const char * uri, \
&gt; unsigned int flags) 
&gt; I'm  not sure it's  relevant  function, since domain ID is contained not in \
&gt; metadata subsection but in opening &lt;domain&gt; markup.  In fact  I wasn't even able to \
&gt; get any data using that function call since I don't know how to construct valid \
&gt; URI. Do you know any doc or examples explaining that ?  

Documentation might come handy:

http://libvirt.org/html/libvirt-libvirt-domain.html#virDomainSetMetadata
http://libvirt.org/html/libvirt-libvirt-domain.html#virDomainGetMetadata

or just look into our test suite:

http://libvirt.org/git/?p=libvirt.git;a=blob;f=tests/metadatatest.c;h=55dc841254bcfda0742d22580723bf4acac172b4;hb=HEAD


Michal
--------------------------------------------------------------
Intel Research and Development Ireland Limited Registered in Ireland Registered \
Office: Collinstown Industrial Park, Leixlip, County Kildare Registered Number: \
308263


This e-mail and any attachments may contain confidential material for the sole use of \
the intended recipient(s). Any review or distribution by others is strictly \
prohibited. If you are not the intended recipient, please contact the sender and \
delete all copies.


_______________________________________________
libvirt-users mailing list
libvirt-users@redhat.com
https://www.redhat.com/mailman/listinfo/libvirt-users
--------------------------------------------------------------
Intel Research and Development Ireland Limited
Registered in Ireland
Registered Office: Collinstown Industrial Park, Leixlip, County Kildare
Registered Number: 308263


This e-mail and any attachments may contain confidential material for the sole
use of the intended recipient(s). Any review or distribution by others is
strictly prohibited. If you are not the intended recipient, please contact the
sender and delete all copies.


</body></email><email><emailId>20170308094756</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-03-08 09:47:56-0400</timestampReceived><subject>Re: [libvirt-users] Insert/eject USB</subject><body>

On Sat, Mar 04, 2017 at 01:14:39AM -0600, Leroy Tennison wrote:
&gt; Is it possible to insert and eject a USB image in kvm/qemu/libvirt or are
&gt; the only dynamically changeable devices cdroms and floppies?  I've searched
&gt; the web and I'm either not looking for the right terms or it's obscure.  I
&gt; should mention that I'm not talking about a connecting a physical host USB
&gt; drive to a guest image, I want to be able to use a qcow image as the source.

It depends on what kind of USB device you attach. If you attach a USB hard
disk, then to dynamically change the backing store image, you would need to
do USB hotunplug+hotplug to remove the "old" drive &amp; add a "new" drive. If
you were to attacha USB cdrom, then you have the choice of simply ejecting
the media, but can still also do hotunplug+hotplug.

&gt; 
&gt; The context is that I want to be able to revert a VM image back to a prior
&gt; state (internal snapshot) when testing but be able to retain some data
&gt; without having to go to the effort of transferring it across the network.
&gt; I've excluded cdroms as an option because they are read-only (correct me if
&gt; I'm wrong on this) and require some effort to (re)build.  Floppy drives
&gt; appear to be limited to 1.44M which makes sense but is very limiting.

Correct wrt cdroms &amp; floppies.

&gt; Network mounts (NFS, Samba, etc.) require a server supporting the selected
&gt; style of filesystem sharing over the network.  I'm not sure I want to find
&gt; out what happens to filesystem passthrough when a revert is done (unless
&gt; someone knows and it's beneficial).
&gt; 
&gt; I tried creating a partition associated with the VM but not auto-mounted,
&gt; even if I unmounted the partition before reverting its state was rolled
&gt; back.  I possibly could get exotic here by setting the immutable attribute
&gt; after unmounting the partition but, again, I'm hoping for something a little
&gt; simpler and more straightforward.  If there's a workable option I haven't
&gt; considered I'm open to that.

It sounds like you should want to be using qcow2 internals snapshots to
capture memory+disk state, or if you wnt to get more advanced libvirt has
APIs to allow fine grained creation of snapshots in standalone files.

Regards,
Daniel
-- 
|: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
|: http://libvirt.org              -o-             http://virt-manager.org :|
|: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|

</body></email><email><emailId>20170308095302</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-03-08 09:53:02-0400</timestampReceived><subject>Re: [libvirt-users] Compile DLL for Windows</subject><body>


On Mon, Mar 06, 2017 at 12:36:08PM +0530, Kartik Vaishnav wrote:
&gt;I would like to know if there is a proper documentation for compiling
&gt;libvirt for Windows.
&gt;This is in regard to the latest versions of libvirt.
&gt;
&gt;Also, most answers are outdated and the scripts by Matthias Bolte on github
&gt;don't use the latest versions and patches for libvirt.
&gt;

For testing I use mingw, that's what the code is prepared for.  I see
some checks for MSVC there as well, so I guess it will work as well.

Anyway, I haven't tried building *on* windows machine, I'm building the
binaries normally as I build for my system as well, just with some
configure options.  Specifically what I do from clean git is:

./autogen.sh --host=i686-w64-mingw32 --without-sasl --without-avahi \
             --without-polkit --without-xen --without-qemu --without-lxc \
             --without-openvz --without-libvirtd --without-dbus \
             --without-systemd-daemon

and then just make.  If you have a tarball you should be able to just
use ./configure instead of ./autogen.sh with the same options.

&gt;
&gt;
&gt;Regards,
&gt;Kartik Vaishnav

&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170308103617</emailId><senderName>Marko Weber | 8000</senderName><senderEmail>weber@zbfmail.de</senderEmail><timestampReceived>2017-03-08 10:36:17-0400</timestampReceived><subject>[libvirt-users] Cache / IO Setting for qcow2 disks with prealloc=metadata?</subject><body>



Hello,
i ´ve done 2 vm with qcow2 disks and created them with qemu-img with 
prealloc=metadata.
Virt-Manager shows me under the performance settings for the Storage,  
Cache= Hypervisor Default  IO= Hypervisor Default
Is this the best setting? Or do i choose "native" IO on 
prealloc=metadata created disks? And do i have to change Cache too?
The Virtualisation Host is gento linux, the qcow2 files are stored on a 
xfs partition, qemu is build with "xfs" Flag.

thanks for hints and tipps

marko

-- 
zbfmail - Mittendrin statt nur Datei!

OpenDKIM, SPF, DSPAM, Greylisting, POSTSCREEN, AMAVIS, Mailgateways
Mailfiltering, SMTP Service, Spam Abwehr, MX-Backup, Mailserver Backup
Redundante Mailgateways, HA Mailserver, Secure Mailserver

</body></email><email><emailId>20170308115059</emailId><senderName>"Matczak, KrzysztofX"</senderName><senderEmail>krzysztofx.matczak@intel.com</senderEmail><timestampReceived>2017-03-08 11:50:59-0400</timestampReceived><subject>Re: [libvirt-users] events dispatching in  synchronous mode</subject><body>

Ok, thanks for quick response . 

Krzysztof
--------------------------------------------------------------
Intel Research and Development Ireland Limited
Registered in Ireland
Registered Office: Collinstown Industrial Park, Leixlip, County Kildare
Registered Number: 308263


This e-mail and any attachments may contain confidential material for the sole
use of the intended recipient(s). Any review or distribution by others is
strictly prohibited. If you are not the intended recipient, please contact the
sender and delete all copies.

</body></email><email><emailId>20170308150915</emailId><senderName>Marko Weber | 8000</senderName><senderEmail>weber@zbfmail.de</senderEmail><timestampReceived>2017-03-08 15:09:15-0400</timestampReceived><subject>Re: [libvirt-users] Help needed on a gentoo system after update to libvirtd 3.1.0</subject><body>



Am 2017-03-08 11:11, schrieb Martin Kletzander:
&gt; On Tue, Mar 07, 2017 at 05:53:45PM +0100, Marko Weber | 8000 wrote:
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Am 2017-03-07 13:01, schrieb Michal Privoznik:
&gt;&gt;&gt; On 03/07/2017 11:44 AM, Marko Weber | 8000 wrote:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; (sorry, dont know how i put my posting into an reply to an other 
&gt;&gt;&gt;&gt; issue
&gt;&gt;&gt;&gt; before,
&gt;&gt;&gt;&gt;  new posting to sepearte it, big sorry)
&gt;&gt;&gt;&gt; 
&gt; 
&gt; Oh yeah, sorry for my previous mail, I replied to the other one before
&gt; noticing this one :)
&gt; 
&gt; In addition to what you posted here, can you also attach the output of
&gt; `brctl show`?
&gt; 
&gt; Thanks and sorry once more,
&gt; Martin

Hi Martin,

# brctl show
bridge name     bridge id               STP enabled     interfaces
br0             8000.f66a1c5ae893       yes             tap0
virbr1          8000.52540075a42f       yes             virbr1-nic
                                                         vnet0
                                                         vnet1


this is output, of brctl show

marko

</body></email><email><emailId>20170308203244</emailId><senderName>DS DS</senderName><senderEmail>dsvirt17@gmail.com</senderEmail><timestampReceived>2017-03-08 20:32:44-0400</timestampReceived><subject>Re: [libvirt-users] qemu-attach fails</subject><body>

Nm, turns out qemu-kvm needs to be started with the full path
(/usr/libexec/qemu-kvm -hda....) then virsh goes past this error.

On Wed, Mar 8, 2017 at 12:22 PM, DS DS &lt;dsvirt17@gmail.com&gt; wrote:

&gt; Hi,
&gt;
&gt; I am using "qemu-attach" in virsh to attach to an existing qemu process so
&gt; I can send monitor commands to it.
&gt;
&gt; the VM is started using
&gt; qemu-kvm -net none -hda ./out.img -m 4G -nographic
&gt;
&gt; The VM gets started and the OS boots fine.
&gt;
&gt; Then, I start virsh and do a "qemu-attach 44273" which is the PID of the
&gt; qemu process.
&gt; virsh # qemu-attach 44273
&gt; error: Failed to attach to pid 44273
&gt; error: Cannot check QEMU binary qemu-kvm: No such file or directory
&gt;
&gt; qemu-kvm is in /usr/libexec. There is a symlink to it from /usr/bin and
&gt; /bin.
&gt;
&gt; The virsh command "create" (for a different VM) works fine.
&gt;
&gt; What could be missing? Are there any debug/log messages/config files that
&gt; can shed some light.
&gt;
&gt; Thanks.
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Nm, turns out qemu-kvm needs to be started with the full path \
(/usr/libexec/qemu-kvm -hda....) then virsh goes past this error.&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;On Wed, Mar 8, 2017 at 12:22 PM, DS \
DS &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:dsvirt17@gmail.com" \
target="_blank"&gt;dsvirt17@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;div dir="ltr"&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I am using \
"qemu-attach" in virsh to attach to an existing qemu process so I can send \
monitor commands to it.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;the VM is started \
using&lt;/div&gt;&lt;div&gt;qemu-kvm -net none -hda ./out.img -m 4G \
-nographic&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The VM gets started and the OS boots \
fine.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Then, I start virsh and do a "qemu-attach \
44273" which is the PID of the qemu process.&lt;/div&gt;&lt;div&gt;&lt;div&gt;virsh # qemu-attach \
44273&lt;/div&gt;&lt;div&gt;error: Failed to attach to pid 44273&lt;/div&gt;&lt;div&gt;error: Cannot check \
QEMU binary qemu-kvm: No such file or \
directory&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;qemu-kvm is in /usr/libexec. There is a \
symlink to it from /usr/bin and /bin.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The virsh command \
"create" (for a different VM) works fine.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What \
could be missing? Are there any debug/log messages/config files that can shed some \
light.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks.&lt;/div&gt;&lt;/div&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170313123831</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-03-13 12:38:31-0400</timestampReceived><subject>Re: [libvirt-users] question about libvirt and suspending guests during live migration</subject><body>


On Fri, Mar 10, 2017 at 05:31:04PM -0600, Chris Friesen wrote:
&gt;Hi,
&gt;
&gt;I hope someone can help me out.
&gt;
&gt;I'm running into an issue with libvirt 1.2.12 reporting "operation failed:
&gt;domain is no longer running" for a migration when qemu thinks it was fine.
&gt;
&gt;The steps are:
&gt;1) create guest with stress test running in it to dirty memory at a high rate
&gt;(fast enough that it would not normally complete live-migration)
&gt;2) trigger live migration with dom.migrateToURI2()
&gt;3) while migration is in progress, call dom.suspend() on the migrating domain.
&gt;
&gt;What I see at this point is the following:
&gt;
&gt;a) At time 50.465 the monitoring code sees a VIR_DOMAIN_EVENT_SUSPENDED event,
&gt;as expected.
&gt;b) An instrumented qemu logs the following:
&gt;51.143: done transferring state
&gt;51.143: done migration
&gt;51.144: qmp_query_migrate reporting state completed
&gt;c) At time 51.468 the monitoring code sees a VIR_DOMAIN_EVENT_RESUMED event,
&gt;with detail of VIR_DOMAIN_EVENT_RESUMED_UNPAUSED
&gt;c) At time 51.469 the the monitoring code sees a VIR_DOMAIN_EVENT_RESUMED event,
&gt;with detail of VIR_DOMAIN_EVENT_RESUMED_MIGRATED
&gt;
&gt;e) At time 51.471 the dom.migrateToURI2() call raises an exception (this is
&gt;python).  The corresponding libvirt log file shows:
&gt;	"error : virNetClientProgramDispatchError:177 : operation failed: domain is no
&gt;longer running"
&gt;
&gt;
&gt;For what it's worth, the problem seems to be fixed in libvirt 1.2.17.  In that
&gt;version and later I don't see the VIR_DOMAIN_EVENT_RESUMED event, the migration
&gt;just completes.
&gt;
&gt;I'm looking at the libvirt history, but I figured I'd ask here too...
&gt;

I briefly looked at `g log v1.2.12..v1.2.17` and I haven't found
anything fixing this particular bug.  So it was probably fixed during
some refactor.

It could've been c1a7f199e82e201e4f6f9401f65b9edc80f98349 or the fact
that we started using migration events or just some block drive refactors
(as it looks like there were many).  But since that version is so old
nobody will remember what happened exactly, I think.

Sorry I can't help more than that,
Martin

&gt;Thanks,
&gt;Chris
&gt;
&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170315085315</emailId><senderName>Cedric Bosdonnat</senderName><senderEmail>cbosdonnat@suse.com</senderEmail><timestampReceived>2017-03-15 08:53:15-0400</timestampReceived><subject>Re: [libvirt-users] [libvirt] libvirt and dmesg</subject><body>

Hello Pierre-Jacques,

First note that you posted your message on the developer's mailing list.
For such user questions, rather email: https://www.redhat.com/mailman/listinfo/libvirt-users

According to https://linuxcontainers.org/lxc/manpages//man5/lxc.container.conf.5.html
lxc.kmsg is only used to symlink /dev/kmsg to /dev/console. Thus setting
this to 0 only results in the lack of that symlink. libvirt doesn't setup
this link at all, may be it is coming from the lxc domain root file system.

On Wed, 2017-03-15 at 08:49 +0100, Michel Pierre-Jacques wrote:
&gt; Hi all, il try to find the way to obtain the same use as in the
&gt; lxc config file lxc.kmsg=0
&gt; 
&gt; how to do that, with the xml of a lxc domain, i make lot of try without
&gt; success . 
&gt; 
&gt; is there another way to deny access to the dmesg for a libvirt lxc
&gt; domain ? 

&gt;From what I see, dmesg doesn't necessarily requires /dev/kmsg (at least
on opensuse). So blocking it may be more tricky. May be you should tell
us more how you setup your container.

--
Cedric

</body></email><email><emailId>20170315101347</emailId><senderName>Michael_StrÃ¶der</senderName><senderEmail>michael@stroeder.com</senderEmail><timestampReceived>2017-03-15 10:13:47-0400</timestampReceived><subject>Re: [libvirt-users] trouble after upgrading from 3.0.0 to 3.1.0</subject><body>


Michal Privoznik wrote:
&gt; On 03/14/2017 05:03 PM, Michael Ströder wrote:
&gt;&gt; Michal Privoznik wrote:
&gt;&gt;&gt; Meanwhile, you can disable namespaces by setting:
&gt;&gt;&gt;
&gt;&gt;&gt;   namespaces=[]
&gt;&gt;&gt;
&gt;&gt;&gt; in qemu.conf.
&gt;&gt;
&gt;&gt; Only setting this did not help.
&gt; 
&gt; Have you restarted libvirtd afterwards?

Yes.

&gt; Also, this is meant as a temporary workaround. Disabling namespaces does not enable
&gt; the full security features.

Ok, noted.

Ciao, Michael.


["smime.p7s" (application/pkcs7-signature)]

</body></email><email><emailId>20170315152732</emailId><senderName>Ian Pilcher</senderName><senderEmail>arequipeno@gmail.com</senderEmail><timestampReceived>2017-03-15 15:27:32-0400</timestampReceived><subject>Re: [libvirt-users] MIPS emulation broken - No PCI buses available</subject><body>

On 03/14/2017 02:18 PM, Andrea Bolognani wrote:
&gt; You keep referring to ppc instead of ppc64, so I'm not sure
&gt; you're trying exactly the same thing, but you can create a
&gt; ppc64 guest with recent software quite easily by using
&gt; virt-builder:

Perfect!  I was unaware that this existed.

Thank you!

-- 
========================================================================
Ian Pilcher                                         arequipeno@gmail.com
-------- "I grew up before Mark Zuckerberg invented friendship" --------
========================================================================

</body></email><email><emailId>20170315164851</emailId><senderName>Daniel Pocock</senderName><senderEmail>daniel@pocock.pro</senderEmail><timestampReceived>2017-03-15 16:48:51-0400</timestampReceived><subject>Re: [libvirt-users] migrating from XenServer / XCP to libvirt/KVM</subject><body>

On 15/03/17 10:22, Daniel P. Berrange wrote:
&gt; On Wed, Mar 15, 2017 at 10:10:36AM +0000, Daniel Pocock wrote:
&gt;&gt; I've been using XenServer / XCP (with the "xe" toolset) for a number of
&gt;&gt; years for hosting servers used for development and free software
&gt;&gt; projects and I'm now looking at migrating all those environments to
&gt;&gt; libvirt / KVM.
&gt;&gt;
&gt;&gt; I had a look at the wiki[1] already and didn't see XenServer mentioned
&gt;&gt; there.
&gt; Yeah, there was a tiny bit of work done to support the XenServer API,
&gt; but the person working on it changed jobs and no one else stepped
&gt; forward to continue it.

libvirt doesn't need to interact directly with XenServer in this case,
using the XenServer "xe" commands to extract any information from the
old system and then copying the settings over to XML files for libvirt /
virsh is fine

&gt;&gt; Could anybody help comment on or explain a few things:
&gt;&gt;
&gt;&gt; - comparison between XenServer and libvirt: I notice many similar
&gt;&gt; concepts, for example, XenServer has storage repositories and libvirt
&gt;&gt; has storage pools.  However, in many examples such as this[2] it appears
&gt;&gt; that libvirt requires more manual effort.  For example, when you create
&gt;&gt; a storage repository in XenServer, the tool takes a physical block
&gt;&gt; device as input and creates the necessary volume group, logical volume
&gt;&gt; and a filesystem.  In that libvirt example, it appears each of those
&gt;&gt; steps must be done manually.  The networking examples are similar: the
&gt;&gt; XenServer tools do all the Open vSwitch stuff behind the scenes but in
&gt;&gt; the libvirt examples it appears necessary to create the bridge manually
&gt;&gt; before telling libvirt about it.  Is this all correct or are the
&gt;&gt; examples I've seen out of date?  Do more recent (or future) releases of
&gt;&gt; libvirt aim to automate/hide more of these things?
&gt; NB, comparing XenServer with libvirt is a bit of an apples &amp; oranges
&gt; comparison, as they have different goals. So yeah, libvirt requires

I wasn't suggesting a comparison to suggest one might be better, rather,
I was just thinking about a cheat sheet to help somebody who knows one
platform to quickly discover the basics of the other.

E.g. a list of the "xe" commands to create a storage repository, create
a network segment and create a VM and some equivalent libvirt
terminology and commands.

&gt; more steps in managing the storage, but this also allows you todo
&gt; things you can't do with XenServer. Also, note that most administrators
&gt; would not use libvirt directly, but rather use it indirectly via some
&gt; management app that introduces higher level abstractions (eg, oVirt,
&gt; OpenStack, or in simpler cases virt-manager etc). 

Some of the goals with this setup:

- using utilities that are already packaged in Debian so security
updates and backports can be used, e.g. virt-manager and virsh are
available in official packages, the old XenServer setup is also based on
the XCP packages on Debian wheezy (now discontinued unfortunately). 
oVirt doesn't appear to be available in Debian yet and OpenStack may not
be right for this use case.

- keeping a fairly basic setup that any other sysadmin who knows basic
virsh commands will be comfortable with

For somebody wanting to run a "vanilla" installation of libvirt / KVM,
are there any patterns that are suggested, for example, keeping all the
images as disk images like in XenServer?  Is there a somewhat standard
place to put all the commands for setting up any network bridges, can
that be done automatically by libvirt or does each site put them in
/etc/rc.local?


&gt;&gt; - what is best practice for virtual disk images?  Does libvirt always
&gt;&gt; use files (like XenServer) or can/should block devices be used
&gt;&gt; directly?  If using files, is any special care needed to avoid block
&gt;&gt; alignment problems?
&gt; This is a matter for the individual hypervisor beneath libvirt. Each
&gt; has its own set of supported virtual disk image backends. QEMU/KVM
&gt; can run on prettty much anything, file, block device, network storage,
&gt; etc
&gt;
&gt;&gt; - are there any guides or tools recommended for migrating small
&gt;&gt; XenServer environments (less than 50 domains on a single physical node)
&gt;&gt; to libvirt + KVM?
&gt;&gt;
&gt;&gt; - is there a list of small things that need to change in a VM before
&gt;&gt; running it under libvirt / KVM?  I'm guessing this might include
&gt;&gt; bootloader config, updating the kernel, changing block device names in
&gt;&gt; /etc/fstab and changing network device names in scripts - are there any
&gt;&gt; others?
&gt;&gt;
&gt;&gt; - can anybody comment on more tricky issues that may arise in such a
&gt;&gt; migration, for example, will a Windows VM be likely to run without
&gt;&gt; modification when migrated from XenServer to libvirt/KVM or will it need
&gt;&gt; extra drivers added or anything else before the migration?
&gt; Yes, there are lots of things which need changing when moving an existing
&gt; guest to a new hypervisor. The best thing is to try to use a pre-existing
&gt; tool for conversion. eg virt-v2v
&gt;
&gt;    http://libguestfs.org/virt-v2v.1.html
&gt;
&gt; though I'm not sure on the level of support for XenServer there. You
&gt; probably just have to give it a try on a guest and see how it works.
&gt; It clones the disk image, so your original guest won't be broken.

OK, thanks for suggesting that.  I have a spare server for the migration
so I will probably make a trial run using copies of all the virtual
machines and hopefully discover all the little things I have to change.

Regards,

Daniel




</body></email><email><emailId>20170317142917</emailId><senderName>Milan Zamazal</senderName><senderEmail>mzamazal@redhat.com</senderEmail><timestampReceived>2017-03-17 14:29:17-0400</timestampReceived><subject>Re: [libvirt-users] VIR_ERR_OPERATION_INVALID from virDomainDestroyFlags call</subject><body>

"Daniel P. Berrange" &lt;berrange@redhat.com&gt; writes:

&gt; On Fri, Mar 17, 2017 at 02:07:11PM +0100, Milan Zamazal wrote:
&gt;&gt; "Daniel P. Berrange" &lt;berrange@redhat.com&gt; writes:
&gt;&gt; 
&gt;&gt; &gt; On Fri, Mar 17, 2017 at 11:55:13AM +0100, Milan Zamazal wrote:
&gt;&gt; &gt;&gt; Hi, we experienced a strange, non-reproducible error after a successful
&gt;&gt; &gt;&gt; migration to another host.  When we called virDomainDestroyFlags with
&gt;&gt; &gt;&gt; VIR_DOMAIN_DESTROY_GRACEFUL flag after the migration on the source host,
&gt;&gt; &gt;&gt; we got VIR_ERR_OPERATION_INVALID (code 55) error.  The same with
&gt;&gt; &gt;&gt; repeated virDomainDestroyFlags calls.  Normally, we would expect either
&gt;&gt; &gt;&gt; success or VIR_ERR_NO_DOMAIN error.  `virsh list' didn't show the VM.
&gt;&gt; &gt;
&gt;&gt; &gt; What about 'virsh list --all' - i expect you have an inactive guest
&gt;&gt; &gt; present, as calling destory on an inactive guest triggers OPERATION_INVALID
&gt;&gt; 
&gt;&gt; I see.  It's interesting, since we use transient domains.  Are there
&gt;&gt; known circumstances when OPERATION_INVALID could be returned for a
&gt;&gt; transient domain?  Can we assume that we never receive that error when
&gt;&gt; trying to destroy a running domain?
&gt;
&gt; Cleanup &amp; destruction of domains is an area where there is relatively
&gt; high level of concurrency in libvirt. So it is conceivable that you
&gt; would see OPERATION_INVALID for a transient guest if libvirt is part
&gt; way through cleaning it up - it shouldn't be in that state for very
&gt; long though

We had the state returning OPERATION_INVALID for "infinite" time.  That
could be caused by some bug or maybe problems with storage or whatever,
we don't know.

&gt; You'll never see OPERATION_INVALID if the guest is truely running - it
&gt; will either be shutoff, or in the process of becoming shutoff very soon.

OK, thank you for explanation and clarification.

Regards,
Milan

</body></email><email><emailId>20170320073720</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-03-20 07:37:20-0400</timestampReceived><subject>Re: [libvirt-users] building virtual desktops with libvirt, KVM, SPICE and GNOME</subject><body>


On Wed, Mar 15, 2017 at 10:26:20AM +0000, Daniel Pocock wrote:
&gt;
&gt;Can anybody comment on how to host virtual desktops on a headless server
&gt;using libvirt and KVM on the server and a SPICE client to access the
&gt;virtual desktop?  Is there a standard way of doing this?
&gt;
&gt;I've seen many fragments of information about how to do this but I
&gt;didn't come across a single guide describing the entire solution.
&gt;Search engines also return a lot of information about gaining remote
&gt;access to a real physical desktop but that is not what I'm looking for.
&gt;I've also come across many real-world scenarios where people are
&gt;manually starting VNC server processes for each user on different ports
&gt;but I was hoping to find out if there is a more standard way of doing
&gt;this now.
&gt;
&gt;When I say "virtual desktop", the type of user experience I'm thinking
&gt;about is that named users can run a SPICE client anywhere and always
&gt;connect to the same host/desktop.  E.g. if they leave some windows open,
&gt;disconnect, go to another physical machine and reconnect with the same
&gt;username they will see the same desktop with the same windows open.
&gt;

How is it different to just having VM per user on that host and having
people connect to their VMs (using TLS and passwords, for example, just
to make sure).  Each VM will have its own spice (or VNC) server and
users can connect to them either directly (if there is access and open
ports etc.) or through libvirt (if they are not).  If latter is the
case, you can use ACLs to restrict particular users to connect only to
their machines.

&gt;Regards,
&gt;
&gt;Daniel
&gt;
&gt;
&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170320140229</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-03-20 14:02:29-0400</timestampReceived><subject>Re: [libvirt-users] migrated RHEL7/CentsOS7 VMs fail to boot</subject><body>


On Mon, Mar 20, 2017 at 10:18:35AM +0100, Daniel Pocock wrote:
&gt;
&gt;I migrated a CentOS7 VM (the fedrtc.org site) from an XCP environment to
&gt;a libvirt/KVM environment.
&gt;
&gt;This involved using qemu-img to convert the image from VHD to qcow2 and
&gt;then using virt-install --import to define the VM in libvirt.
&gt;

I have little to no idea how to help with the rest, but have you tried
using virt-v2v for the switch?  It could help you a lot with some of
these things.  I hope your use case is supported, I haven't really had
many use cases for if myself.

&gt;Three problems occurred during boot:
&gt;
&gt;a) on the first boot, the BIOS screen and grub screen don't appear at
&gt;all, the screen is blank for a couple of seconds and then the message
&gt;about loading a kernel appears.  Hard reset and on the second and
&gt;subsequent attempts I see the grub screen and have the opportunity to
&gt;interact with it.  This actually happened with many of my VMs, not just
&gt;the CentOS7 VM.
&gt;
&gt;b) with console=hvc0 in the grub config, the kernel refused to boot, no
&gt;error appeared on the screen.  I was able to remove that easily enough
&gt;by pressing "e" in grub.  Rather than halting, should the kernel fall
&gt;back to VGA perhaps when the console= argument is not valid?  Or could
&gt;KVM emulate the Xen console device to make migrations easier?
&gt;
&gt;c) after that, the boot proceeds up to about the point where I see
&gt;systemd messages about starting basic system.  Then it sits there for a
&gt;few minutes and then these messages appear:
&gt;  warning: dracut-initqueue timeout - starting timeout scripts
&gt;and after that I see "A start job is running for dev-mapp...oot.device
&gt;(X min Ys/ no limit)
&gt;Rebooting and choosing the "rescue" image from the bottom of the grub
&gt;menu got me past that, I was able to log in and then I ran:
&gt;
&gt;   dracut --kver 3.10.0-514.10.2.el7.x86_64 --force
&gt;
&gt;and on the next attempt it was able to boot successfully.  The block
&gt;device for the root FS is an LVM volume (so the name should have been
&gt;constant) and the block device for the /boot filesystem listed in
&gt;/etc/fstab was mounted by UUID (the block device name itself changed
&gt;from xvda1 (XCP) to vda1 (KVM)).  All my Debian VMs were able to cope
&gt;with this device name changing.  The CentOS7 system was originally
&gt;installed using default settings for just about everything.
&gt;
&gt;Why does dracut need to be re-run in this situation?  Should a bug
&gt;report be filed about this?


&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170320015422</emailId><senderName></senderName><senderEmail>arrakis@tsiom.com</senderEmail><timestampReceived>2017-03-20 01:54:22-0400</timestampReceived><subject>[libvirt-users] CPU Pinning Help</subject><body>

&lt;html&gt;&lt;body&gt;&lt;span style="font-family:Verdana; color:#000; font-size:10pt;"&gt;&lt;div class="linestyle2 colourline"&gt;Hello, I was hoping &lt;span style="font-size: 10pt;" mce_style="font-size: 10pt;"&gt;someone help me regarding my KVM Domain XML file. I have a 1 socket, 6 core processor with hyperthreading. I wanted to pin 3 full cores (6 threads on 3 cores) to my KVM instance with a 1-1 mapping (so that the KVM instance has 3 cores and 6 total threads). I thus used the following in my xml file:&lt;/span&gt;&lt;/div&gt;&lt;div class="linestyle1 colourline"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="linestyle1 colourline"&gt;&lt;cpu mode='host-model&gt; &lt;topology sockets='1' cores='3' threads='2'/&gt; &lt;/cpu&gt;&lt;/div&gt;&lt;div class="linestyle1 colourline"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="linestyle1 colourline"&gt;&lt;span style="font-size: 10pt;" mce_style="font-size: 10pt;"&gt;I know what physical cpu ids are siblings (share the same processor cores) through $(cat /proc/cpu) or $(&lt;/span&gt;&lt;span style=""&gt;virsh capabilities).  &lt;/span&gt;&lt;span style="font-size: 10pt;"&gt;However, in the &lt;cputune&gt; section, when pinning vcpus ids to physical cpus, I need to know which vcpu ids are "siblings" (which vcpu ids share the same virtual core). I would imagine vcpu ids 0 &amp; 1 are siblings, 2 &amp; 3 are siblings etc, but I cannot find anywhere in the documentation which confirms this.&lt;/span&gt;&lt;/div&gt;&lt;div class="linestyle1 colourline"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="linestyle1 colourline"&gt;&lt;span style="font-size: 10pt;"&gt;Could someone please help?&lt;br&gt;Many thanks! &lt;/span&gt;&lt;/div&gt;&lt;div class="linestyle1 colourline"&gt;&lt;span style="font-size: 10pt;"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class="linestyle1 colourline"&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;/body&gt;&lt;/html&gt;

</body></email><email><emailId>20170321011306</emailId><senderName>Ram Krishna</senderName><senderEmail>krishna.ubuntu@gmail.com</senderEmail><timestampReceived>2017-03-21 01:13:06-0400</timestampReceived><subject>Re: [libvirt-users] CPU Pinning Help</subject><body>

can you try lstopo command

&gt; On Mar 19, 2017, at 9:54 PM, &lt;arrakis@tsiom.com&gt; &lt;arrakis@tsiom.com&gt; wrote:
&gt; 
&gt; Hello, I was hoping someone help me regarding my KVM Domain XML file. I have a 1 \
&gt; socket, 6 core processor with hyperthreading. I wanted to pin 3 full cores (6 \
&gt; threads on 3 cores) to my KVM instance with a 1-1 mapping (so that the KVM instance \
&gt; has 3 cores and 6 total threads). I thus used the following in my xml file: 
&gt; &lt;cpu mode='host-model&gt; &lt;topology sockets='1' cores='3' threads='2'/&gt; &lt;/cpu&gt;
&gt; 
&gt; I know what physical cpu ids are siblings (share the same processor cores) through \
&gt; $(cat /proc/cpu) or $(virsh capabilities).  However, in the &lt;cputune&gt; section, when \
&gt; pinning vcpus ids to physical cpus, I need to know which vcpu ids are "siblings" \
&gt; (which vcpu ids share the same virtual core). I would imagine vcpu ids 0 &amp; 1 are \
&gt; siblings, 2 &amp; 3 are siblings etc, but I cannot find anywhere in the documentation \
&gt; which confirms this. 
&gt; Could someone please help?
&gt; Many thanks! 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users


[Attachment #3 (unknown)]

&lt;html&gt;&lt;head&gt;&lt;meta http-equiv="Content-Type" content="text/html \
charset=us-ascii"&gt;&lt;/head&gt;&lt;body style="word-wrap: break-word; -webkit-nbsp-mode: \
space; -webkit-line-break: after-white-space;" class=""&gt;can you try lstopo \
command&lt;div class=""&gt;&lt;br class=""&gt;&lt;div&gt;&lt;blockquote type="cite" class=""&gt;&lt;div \
class=""&gt;On Mar 19, 2017, at 9:54 PM, &lt;&lt;a href="mailto:arrakis@tsiom.com" \
class=""&gt;arrakis@tsiom.com&lt;/a&gt;&gt; &lt;&lt;a href="mailto:arrakis@tsiom.com" \
class=""&gt;arrakis@tsiom.com&lt;/a&gt;&gt; wrote:&lt;/div&gt;&lt;br \
class="Apple-interchange-newline"&gt;&lt;div class=""&gt;&lt;div class=""&gt;&lt;span \
style="font-family: Verdana; font-size: 10pt;" class=""&gt;&lt;div class="colourline \
linestyle2"&gt;Hello, I was hoping &lt;span style="font-size: 10pt;" \
mce_style="font-size: 10pt;" class=""&gt;someone help me regarding my KVM Domain XML \
file. I have a 1 socket, 6 core processor with hyperthreading. I wanted to pin 3 full \
cores (6 threads on 3 cores) to my KVM instance with a 1-1 mapping (so that the KVM \
instance has 3 cores and 6 total threads). I thus used the following in my xml \
file:&lt;/span&gt;&lt;/div&gt;&lt;div class="linestyle1 colourline"&gt;&lt;br class=""&gt;&lt;/div&gt;&lt;div \
class="linestyle1 colourline"&gt;&lt;cpu mode='host-model&gt; &lt;topology sockets='1' \
cores='3' threads='2'/&gt; &lt;/cpu&gt;&lt;/div&gt;&lt;div class="linestyle1 colourline"&gt;&lt;br \
class=""&gt;&lt;/div&gt;&lt;div class="linestyle1 colourline"&gt;&lt;span style="font-size: 10pt;" \
mce_style="font-size: 10pt;" class=""&gt;I know what physical cpu ids are siblings \
(share the same processor cores) through $(cat /proc/cpu) or $(&lt;/span&gt;&lt;span style="" \
class=""&gt;virsh capabilities).  &lt;/span&gt;&lt;span style="font-size: 10pt;" \
class=""&gt;However, in the &lt;cputune&gt; section, when pinning vcpus ids to physical \
cpus, I need to know which vcpu ids are "siblings" (which vcpu ids share the same \
virtual core). I would imagine vcpu ids 0 &amp; 1 are siblings, 2 &amp; 3 are \
siblings etc, but I cannot find anywhere in the documentation which confirms \
this.&lt;/span&gt;&lt;/div&gt;&lt;div class="linestyle1 colourline"&gt;&lt;br class=""&gt;&lt;/div&gt;&lt;div \
class="linestyle1 colourline"&gt;&lt;span style="font-size: 10pt;" class=""&gt;Could someone \
please help?&lt;br class=""&gt;Many thanks! &lt;/span&gt;&lt;/div&gt;&lt;div class="linestyle1 \
colourline"&gt;&lt;span style="font-size: 10pt;" class=""&gt;&lt;br class=""&gt;&lt;/span&gt;&lt;/div&gt;&lt;div \
class="linestyle1 colourline"&gt;&lt;br class=""&gt;&lt;/div&gt;&lt;/span&gt;&lt;/div&gt;

_______________________________________________&lt;br class=""&gt;libvirt-users mailing \
list&lt;br class=""&gt;&lt;a href="mailto:libvirt-users@redhat.com" \
class=""&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br \
class=""&gt;https://www.redhat.com/mailman/listinfo/libvirt-users&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br \
class=""&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;



</body></email><email><emailId>20170320032830</emailId><senderName>ıuoʎ</senderName><senderEmail>yonjah@gmail.com</senderEmail><timestampReceived>2017-03-20 03:28:30-0400</timestampReceived><subject>[libvirt-users] libvirt-guests and time sync on autostart vms</subject><body>

I have a host running a few guests all configured to autostart.
I'm also using libvirt-guests to suspend the guests when the host
restarts or shuts down
When the host comes back up I see a bunch of log messages  -
Resuming guest vm01 already active
Resuming guest vm02 already active

I guess this is because libvirt autostarts the guests when it starts
and before libvirt-guests has a chance
to start them.
I didn't think this is an issue until I noticed the time on the guests
is totally out of sync.
SYNC_TIME=1 is enabled in the conf file but this doesn't seem to work
I can see from the code at libvirt-guests.sh that the time sync
function will only run if the guest is started by libvirt-guests ans
will be skipped for guests that are already running

So I'm not sure if this is a bug in libvirt-guests.sh or if I'm doing
something wrong by using both libvirt-guests and autostart.
I assume libvirt-guests will always resume guests on proper reboot but
I'm think if there is any unexpected failure where guests weren't
properly suspended before boot I still want them to come backup when
the server boots

Regards,
Yoni

</body></email><email><emailId>20170321152520</emailId><senderName>Ram Krishna</senderName><senderEmail>krishna.ubuntu@gmail.com</senderEmail><timestampReceived>2017-03-21 15:25:20-0400</timestampReceived><subject>Re: [libvirt-users] [Libguestfs] Running virConnectGetCapabilities / virsh capabilities without a da</subject><body>

lstopo, lstopo --output-format xml 

These commands might be helpful

&gt; On Mar 21, 2017, at 10:35 AM, Richard W.M. Jones &lt;rjones@redhat.com&gt; wrote:
&gt; 
&gt; 
&gt; For virt-p2v we want to get the host CPU model, topology etc, and the
&gt; best way we found to do that was to pull it from libvirt
&gt; capabilities[1].  Since libvirt is already parsing the host CPU
&gt; information, and because /proc/cpuinfo is such a stupid format to
&gt; parse, this is very convenient.
&gt; 
&gt; Unfortunately it doesn't work unless libvirtd _and_ KVM are both
&gt; installed.
&gt; 
&gt; Without libvirtd installed:
&gt; 
&gt;  # virsh capabilities
&gt;  error: failed to connect to the hypervisor
&gt;  error: Failed to connect socket to '/var/run/libvirt/libvirt-sock': No such file or directory
&gt; 
&gt; With libvirt-daemon installed, but not QEMU:
&gt; 
&gt;  # virsh capabilities
&gt;  error: failed to connect to the hypervisor
&gt;  error: no connection driver available for &lt;null&gt;
&gt; 
&gt; I feel I should be able to fiddle with the connection URI in some way
&gt; to make this possible, at least in the second case.  However there's
&gt; not a concept of "no hypervisor", and I couldn't find any other way to
&gt; make it work.  Using "test:///default" seems tempting, but it
&gt; substitutes some imaginary host (i686) so that's no good.
&gt; 
&gt; Installing KVM isn't really an option for us since we are trying to
&gt; build a minimal bootable ISO.  Just installing qemu-system-x86_64
&gt; pulls in half the world.  (Even installing libvirtd is difficult, and
&gt; we'd prefer to avoid it).
&gt; 
&gt; Any ideas?
&gt; 
&gt; Rich.
&gt; 
&gt; [1] https://github.com/libguestfs/libguestfs/commit/963d6c3be7cd91c0373f67cfdd95c4f1dad1452f
&gt; 
&gt; -- 
&gt; Richard Jones, Virtualization Group, Red Hat http://people.redhat.com/~rjones
&gt; Read my programming and virtualization blog: http://rwmj.wordpress.com
&gt; Fedora Windows cross-compiler. Compile Windows programs, test, and
&gt; build Windows installers. Over 100 libraries supported.
&gt; http://fedoraproject.org/wiki/MinGW
&gt; 
&gt; _______________________________________________
&gt; Libguestfs mailing list
&gt; Libguestfs@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libguestfs


</body></email><email><emailId>20170321143524</emailId><senderName>"Richard W.M. Jones"</senderName><senderEmail>rjones@redhat.com</senderEmail><timestampReceived>2017-03-21 14:35:24-0400</timestampReceived><subject>[libvirt-users] Running virConnectGetCapabilities / virsh capabilities without a daemon or KVM</subject><body>


For virt-p2v we want to get the host CPU model, topology etc, and the
best way we found to do that was to pull it from libvirt
capabilities[1].  Since libvirt is already parsing the host CPU
information, and because /proc/cpuinfo is such a stupid format to
parse, this is very convenient.

Unfortunately it doesn't work unless libvirtd _and_ KVM are both
installed.

Without libvirtd installed:

  # virsh capabilities
  error: failed to connect to the hypervisor
  error: Failed to connect socket to '/var/run/libvirt/libvirt-sock': No such file or directory

With libvirt-daemon installed, but not QEMU:

  # virsh capabilities
  error: failed to connect to the hypervisor
  error: no connection driver available for &lt;null&gt;

I feel I should be able to fiddle with the connection URI in some way
to make this possible, at least in the second case.  However there's
not a concept of "no hypervisor", and I couldn't find any other way to
make it work.  Using "test:///default" seems tempting, but it
substitutes some imaginary host (i686) so that's no good.

Installing KVM isn't really an option for us since we are trying to
build a minimal bootable ISO.  Just installing qemu-system-x86_64
pulls in half the world.  (Even installing libvirtd is difficult, and
we'd prefer to avoid it).

Any ideas?

Rich.

[1] https://github.com/libguestfs/libguestfs/commit/963d6c3be7cd91c0373f67cfdd95c4f1dad1452f

-- 
Richard Jones, Virtualization Group, Red Hat http://people.redhat.com/~rjones
Read my programming and virtualization blog: http://rwmj.wordpress.com
Fedora Windows cross-compiler. Compile Windows programs, test, and
build Windows installers. Over 100 libraries supported.
http://fedoraproject.org/wiki/MinGW

</body></email><email><emailId>20170322143922</emailId><senderName>Leon Goldberg</senderName><senderEmail>lgoldber@redhat.com</senderEmail><timestampReceived>2017-03-22 14:39:22-0400</timestampReceived><subject>[libvirt-users] libvirtd firewalld support</subject><body>

Hey,

I've been wondering about the extent libvirt makes use of firewalld.
I'm looking to use firewalld exclusively and wonder about the ports
libvirt takes care of for me via firewalld (e.g. will console/vnc
ports, qemu migration ports, etc, will be handled for me?)

I have only done a little bit of testing, but it seems like I can't
connect to a vm via vnc without explicitly opening ports beforehand.

Thanks,
Leon

</body></email><email><emailId>20170330140901</emailId><senderName>Anton Gorlov</senderName><senderEmail>stalker@altlinux.ru</senderEmail><timestampReceived>2017-03-30 14:09:01-0400</timestampReceived><subject>[libvirt-users] different bios file per guest</subject><body>

Can I set different bios file per guest?

For some guest need UEFI.

By default using  bios-256k.bin

</body></email><email><emailId>20170322161134</emailId><senderName>Cole Robinson</senderName><senderEmail>crobinso@redhat.com</senderEmail><timestampReceived>2017-03-22 16:11:34-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd firewalld support</subject><body>

On 03/22/2017 10:39 AM, Leon Goldberg wrote:
&gt; Hey,
&gt; 
&gt; I've been wondering about the extent libvirt makes use of firewalld.
&gt; I'm looking to use firewalld exclusively and wonder about the ports
&gt; libvirt takes care of for me via firewalld (e.g. will console/vnc
&gt; ports, qemu migration ports, etc, will be handled for me?)
&gt; 
&gt; I have only done a little bit of testing, but it seems like I can't
&gt; connect to a vm via vnc without explicitly opening ports beforehand.
&gt; 

Libvirt doesn't do stuff like that automatically. It's usage of firewalld and
firewalls in general is for 1) virtual networks (for example the 'default'
network that sets up NAT equivalent for your VMs) and 2) nwfilter config (
https://libvirt.org/formatnwfilter.html )

- Cole

</body></email><email><emailId>20170320135851</emailId><senderName>Timo Juhani Lindfors</senderName><senderEmail>timo.lindfors@iki.fi</senderEmail><timestampReceived>2017-03-20 13:58:51-0400</timestampReceived><subject>Re: [libvirt-users] libvirt-guests and time sync on autostart vms</subject><body>

ıuoʎ &lt;yonjah@gmail.com&gt; writes:
&gt; I have a host running a few guests all configured to autostart.
&gt; I'm also using libvirt-guests to suspend the guests when the host
&gt; restarts or shuts down

I have a similar setup. I solved it by writing a small daemon that syncs
system time from RTC time if the error is larger than 10 seconds. This
guarantees that my VM time will be in sync with the host very fast. If
I'd run ntpd it would take minutes for the resumed VM to notice that
something happened.

</body></email><email><emailId>20170321003728</emailId><senderName>ıuoʎ</senderName><senderEmail>yonjah@gmail.com</senderEmail><timestampReceived>2017-03-21 00:37:28-0400</timestampReceived><subject>Re: [libvirt-users] libvirt-guests and time sync on autostart vms</subject><body>

On Mon, Mar 20, 2017 at 9:58 PM, Timo Juhani Lindfors
&lt;timo.lindfors@iki.fi&gt; wrote:
&gt; ıuoʎ &lt;yonjah@gmail.com&gt; writes:
&gt;&gt; I have a host running a few guests all configured to autostart.
&gt;&gt; I'm also using libvirt-guests to suspend the guests when the host
&gt;&gt; restarts or shuts down
&gt;
&gt; I have a similar setup. I solved it by writing a small daemon that syncs
&gt; system time from RTC time if the error is larger than 10 seconds. This
&gt; guarantees that my VM time will be in sync with the host very fast. If
&gt; I'd run ntpd it would take minutes for the resumed VM to notice that
&gt; something happened.

Yea I created another systemd service that will sync the time of all
running machines on host boot.
I was just wondering if I was missing something with libvirt-guests
and autostart.
I haven't noticed any issues with the time discrepancies on running
guests so I hope this will be enough.

</body></email><email><emailId>20170321131225</emailId><senderName>Gianluca Cecchi</senderName><senderEmail>gianluca.cecchi@gmail.com</senderEmail><timestampReceived>2017-03-21 13:12:25-0400</timestampReceived><subject>Re: [libvirt-users] libvirt-guests and time sync on autostart vms</subject><body>

On Tue, Mar 21, 2017 at 1:37 AM, ıuoʎ &lt;yonjah@gmail.com&gt; wrote:

&gt; On Mon, Mar 20, 2017 at 9:58 PM, Timo Juhani Lindfors
&gt; &lt;timo.lindfors@iki.fi&gt; wrote:
&gt; &gt; ıuoʎ &lt;yonjah@gmail.com&gt; writes:
&gt; &gt;&gt; I have a host running a few guests all configured to autostart.
&gt; &gt;&gt; I'm also using libvirt-guests to suspend the guests when the host
&gt; &gt;&gt; restarts or shuts down
&gt; &gt;
&gt; &gt; I have a similar setup. I solved it by writing a small daemon that syncs
&gt; &gt; system time from RTC time if the error is larger than 10 seconds. This
&gt; &gt; guarantees that my VM time will be in sync with the host very fast. If
&gt; &gt; I'd run ntpd it would take minutes for the resumed VM to notice that
&gt; &gt; something happened.
&gt;
&gt; Yea I created another systemd service that will sync the time of all
&gt; running machines on host boot.
&gt; I was just wondering if I was missing something with libvirt-guests
&gt; and autostart.
&gt; I haven't noticed any issues with the time discrepancies on running
&gt; guests so I hope this will be enough.
&gt;
&gt;
Not tested myself, but in  /etc/sysconfig/libvirt-guests there is at the
end this:

# If non-zero, try to sync guest time on domain resume. Be aware, that
# this requires guest agent with support for time synchronization
# running in the guest. For instance, qemu-ga doesn't support guest time
# synchronization on Windows guests, but Linux ones. By default, this
# functionality is turned off.
#SYNC_TIME=1

&gt;From the comment contents it seems the default is actually 0, so if you
have not already done it, you can put
SYNC_TIME=1

This I think requires also to install inside the guest the qemu-guest-agent
package and enabling qemu-guest-agent service.
HIH,
Gianluca

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div class="gmail_extra"&gt;&lt;div class="gmail_quote"&gt;On Tue, Mar 21, 2017 \
at 1:37 AM, ıuoʎ &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:yonjah@gmail.com" \
target="_blank"&gt;yonjah@gmail.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt;&lt;span class="gmail-"&gt;On Mon, Mar 20, 2017 at 9:58 \
PM, Timo Juhani Lindfors&lt;br&gt; &lt;&lt;a \
href="mailto:timo.lindfors@iki.fi"&gt;timo.lindfors@iki.fi&lt;/a&gt;&gt; wrote:&lt;br&gt; &gt; \
ıuoʎ &lt;&lt;a href="mailto:yonjah@gmail.com"&gt;yonjah@gmail.com&lt;/a&gt;&gt; writes:&lt;br&gt; \
&gt;&gt; I have a host running a few guests all configured to autostart.&lt;br&gt; &gt;&gt; \
I'm also using libvirt-guests to suspend the guests when the host&lt;br&gt; &gt;&gt; \
restarts or shuts down&lt;br&gt; &gt;&lt;br&gt;
&gt; I have a similar setup. I solved it by writing a small daemon that syncs&lt;br&gt;
&gt; system time from RTC time if the error is larger than 10 seconds. This&lt;br&gt;
&gt; guarantees that my VM time will be in sync with the host very fast. If&lt;br&gt;
&gt; I'd run ntpd it would take minutes for the resumed VM to notice that&lt;br&gt;
&gt; something happened.&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;Yea I created another systemd service that will sync the time of all&lt;br&gt;
running machines on host boot.&lt;br&gt;
I was just wondering if I was missing something with libvirt-guests&lt;br&gt;
and autostart.&lt;br&gt;
I haven't noticed any issues with the time discrepancies on running&lt;br&gt;
guests so I hope this will be enough.&lt;br&gt;
&lt;div class="gmail-HOEnZb"&gt;&lt;div \
class="gmail-h5"&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Not tested myself, \
but in   /etc/sysconfig/libvirt-guests there is at the end \
this:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;# If non-zero, try to sync guest time on domain \
resume. Be aware, that&lt;/div&gt;&lt;div&gt;# this requires guest agent with support for time \
synchronization&lt;/div&gt;&lt;div&gt;# running in the guest. For instance, qemu-ga doesn't \
support guest time&lt;/div&gt;&lt;div&gt;# synchronization on Windows guests, but Linux ones. By \
default, this&lt;/div&gt;&lt;div&gt;# functionality is turned \
off.&lt;/div&gt;&lt;div&gt;#SYNC_TIME=1&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;From the comment contents \
it seems the default is actually 0, so if you have not already done it, you can \
put&lt;/div&gt;&lt;div&gt;SYNC_TIME=1&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This I think requires also to \
install inside the guest the  qemu-guest-agent package and enabling  qemu-guest-agent \
service.&lt;/div&gt;&lt;div&gt;HIH,&lt;/div&gt;&lt;div&gt;Gianluca&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170321115555</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-03-21 11:55:55-0400</timestampReceived><subject>Re: [libvirt-users] Get PID of a domain's QEMU instance from its domain ID</subject><body>


On Tue, Mar 21, 2017 at 12:50:39PM +0100, Peter Krempa wrote:
&gt;On Tue, Mar 21, 2017 at 12:06:25 +0100, Martin Kletzander wrote:
&gt;&gt; On Mon, Mar 20, 2017 at 02:11:21PM +0100, Thibaut SAUTEREAU wrote:
&gt;&gt; &gt; Hello,
&gt;&gt; &gt;
&gt;&gt; &gt; I cannot find a way to retrieve PIDs of QEMU instances from libvirt domains'
&gt;&gt; &gt; IDs (I'm using libvirt C API). I recognize it sounds like a bad idea doing so
&gt;&gt; &gt; (and I know PIDs are explicitly made not available, as I gathered from the
&gt;&gt; &gt; source code and on your IRC channel) but I need that to use the perf_event_open
&gt;&gt; &gt; syscall in order to gather statistics on my QEMU/KVM guests. I also know
&gt;&gt; &gt; libvirt now supports some perf events but only a few and I need more. I could
&gt;&gt; &gt; submit patches to add them and I will definitely consider that but in the
&gt;&gt; &gt; meantime...
&gt;
&gt;Looks like you are looking for:
&gt;http://libvirt.org/formatdomain.html#elementsPerf
&gt;
&gt;and
&gt;
&gt;http://libvirt.org/html/libvirt-libvirt-domain.html#virDomainGetPerfEvents
&gt;
&gt;&gt; &gt;
&gt;&gt; &gt; What would be the best way to get those PIDs? I tried using the XML file but
&gt;&gt; &gt; PID is hidden in there too. I took a look at QEMU Machine Protocol. Now I'm
&gt;&gt; &gt; going to walk /proc and match on guests names but it is not that elegant.
&gt;&gt; &gt; Any ideas?
&gt;
&gt;Just to re-iterate. We hide it because users should not fiddle with the
&gt;VMs behind our backs.
&gt;
&gt;&gt; &gt;
&gt;&gt;
&gt;&gt; `ps aux | grep $UUID | grep -v grep` ??
&gt;
&gt;This will obviously work, but we won't give you an elegant way since we
&gt;don't want you to know the pid.

I mentioned that since Thibaut knows about why we hide that, how to get
the current perf events as well as how to add new ones (at least
according to how I understood the message).

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170321135932</emailId><senderName>Francesco Romani</senderName><senderEmail>fromani@redhat.com</senderEmail><timestampReceived>2017-03-21 13:59:32-0400</timestampReceived><subject>Re: [libvirt-users] [RFC] per-device metadata</subject><body>

(CC devel list - better late than never)


On 03/16/2017 04:23 PM, Daniel P. Berrange wrote:
&gt; On Thu, Mar 16, 2017 at 04:17:51PM +0100, Peter Krempa wrote:
&gt;&gt; On Thu, Mar 16, 2017 at 14:52:47 +0000, Daniel Berrange wrote:
&gt;&gt;&gt; On Thu, Mar 16, 2017 at 03:50:51PM +0100, Peter Krempa wrote:
&gt;&gt;&gt;&gt; On Thu, Mar 16, 2017 at 14:42:30 +0000, Daniel Berrange wrote:
&gt;&gt;&gt;&gt;&gt; On Thu, Mar 16, 2017 at 01:46:38PM +0100, Peter Krempa wrote:
&gt;&gt;&gt;&gt;&gt;&gt; On Mon, Feb 27, 2017 at 16:41:28 +0100, Francesco Romani wrote:
&gt;&gt; [...]
&gt;&gt;
&gt;&gt;&gt; The scenario where device attach fails is not the problem - you can
&gt;&gt;&gt; get the same level of reliabilty to that by simply updating the
&gt;&gt;&gt; global metadata before &amp; after hotplug in the same way. What is
&gt;&gt;&gt; difficult is when libvirt fails to persist the XML config on disk
&gt;&gt;&gt; or when libvirt crashes part way through the operation, and other
&gt;&gt;&gt; akward failure scenarios unrelated to QEMU itself.
&gt;&gt; In that case you lose the device definition too, since saving the XML is
&gt;&gt; the integral part of the hotplug operation.
&gt; Agreed, but that just re-inforces my view that we don't need to provide
&gt; extra metadata against the device for sake of atomicity. Even the existing
&gt; hotplug doesn't guarantee any kind of atomicity, so you're not making life
&gt; worse by performing a separate API call to update the global metadata.
&gt;
&gt;
&gt; Regards,
&gt; Daniel

Thanks everyone,  I will file a bug so we can move forward on this.

Bests,

-- 
Francesco Romani
Red Hat Engineering Virtualization R &amp; D
IRC: fromani

</body></email><email><emailId>20170321145518</emailId><senderName></senderName><senderEmail>arrakis@tsiom.com</senderEmail><timestampReceived>2017-03-21 14:55:18-0400</timestampReceived><subject>Re: [libvirt-users] CPU Pinning Help</subject><body>

&lt;html&gt;&lt;body&gt;&lt;span style="font-family:Verdana; color:#000; font-size:10pt;"&gt;&lt;span style="font-family:Verdana; color:#000; font-size:10pt;"&gt;&lt;div style="font-family: verdana, geneva; color: rgb(0, 0, 0); font-size: 10pt;" mce_style="color: #000000; font-family: verdana, geneva; font-size: 10pt;"&gt;Thanks for the reply, this is the output&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva" style=""&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;Machine (31GB)&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;  Package L#0 + L3 L#0 (15MB)&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;    L2 L#0 (256KB) + L1d L#0 (32KB) + L1i L#0 (32KB) + Core L#0&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;      PU L#0 (P#0)&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;      PU L#1 (P#6)&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;    L2 L#1 (256KB) + L1d L#1 (32KB) + L1i L#1 (32KB) + Core L#1&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;      PU L#2 (P#1)&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;      PU L#3 (P#7)&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;    L2 L#2 (256KB) + L1d L#2 (32KB) + L1i L#2 (32KB) + Core L#2&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;      PU L#4 (P#2)&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;      PU L#5 (P#8)&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;    L2 L#3 (256KB) + L1d L#3 (32KB) + L1i L#3 (32KB) + Core L#3&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;      PU L#6 (P#3)&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;      PU L#7 (P#9)&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;    L2 L#4 (256KB) + L1d L#4 (32KB) + L1i L#4 (32KB) + Core L#4&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;      PU L#8 (P#4)&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;      PU L#9 (P#10)&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;    L2 L#5 (256KB) + L1d L#5 (32KB) + L1i L#5 (32KB) + Core L#5&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;      PU L#10 (P#5)&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;      PU L#11 (P#11)&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;br&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;At the moment I have the following in my Domain XML, to pin the first physical 3 cores to corresponding virtual cores. My question though, is how do I know which vcpus are siblings for a given topology specified in &lt;cpu&gt;&lt;topology&gt;...&lt;/font&gt;&lt;span&gt;&lt;/cpu&gt;&lt;/topology&gt;?&lt;/span&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;&lt;br&gt;&lt;/font&gt;&lt;span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 9pt;" mce_style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 9pt;"&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size: 9pt;" mce_style="font-size: 9pt;"&gt;&lt;span style="font-size: 10pt;" mce_style="font-size: 10pt;"&gt;&lt;vcpu placement='static' cpuset="1-6"&gt;6&lt;/vcpu&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size: 10pt;" mce_style="font-size: 10pt;"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size: 9pt;" mce_style="font-size: 9pt;"&gt;&lt;span style="font-size: 10pt;" mce_style="font-size: 10pt;"&gt;&lt;cputune&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size: 10pt;" mce_style="font-size: 10pt;"&gt;    &lt;vcpupin vcpu="0" cpuset="0"/&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size: 10pt;" mce_style="font-size: 10pt;"&gt;    &lt;vcpupin vcpu="1" cpuset="6"/&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;span mce_style="font-size: 10pt;"&gt;    &lt;vcpupin vcpu="2" cpuset="1"/&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span mce_style="font-size: 10pt;"&gt;    &lt;vcpupin vcpu="3" cpuset="7"/&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size: 10pt;" mce_style="font-size: 10pt;"&gt;    &lt;vcpupin vcpu="4" cpuset="2"/&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size: 10pt;" mce_style="font-size: 10pt;"&gt;&lt;span style=""&gt;    &lt;vcpupin vcpu="5" cpuset="8"/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style="font-size: 10pt;" mce_style="font-size: 10pt;"&gt;&lt;/cputune&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;Thanks for the help!&lt;/font&gt;&lt;/div&gt;&lt;div style="font-family: verdana, geneva;"&gt;&lt;font face="verdana, geneva"&gt;&lt;br&gt;&lt;/font&gt; &lt;div id="wmQuoteWrapper"&gt; -------- Original Message --------&lt;br&gt; Subject: Re: [libvirt-users] CPU Pinning Help&lt;br&gt; From: Ram Krishna &lt;&lt;a target="_blank" href="mailto:krishna.ubuntu@gmail.com" mce_onclick="if(window.location==top.location){Popup.composeWindow('pcompose.php?sendto=krishna.ubuntu%40gmail.com');}else{top.Popup.composeWindow('pcompose.php?sendto=krishna.ubuntu%40gmail.com');}; return false;"&gt;krishna.ubuntu@gmail.com&lt;/a&gt;&gt;&lt;br&gt; Date: Tue, March 21, 2017 1:13 am&lt;br&gt; To: &lt;a target="_blank" href="mailto:arrakis@tsiom.com" mce_onclick="if(window.location==top.location){Popup.composeWindow('pcompose.php?sendto=arrakis%40tsiom.com');}else{top.Popup.composeWindow('pcompose.php?sendto=arrakis%40tsiom.com');}; return false;"&gt;arrakis@tsiom.com&lt;/a&gt;&lt;br&gt; Cc: &lt;a target="_blank" href="mailto:libvirt-users@redhat.com" mce_onclick="if(window.location==top.location){Popup.composeWindow('pcompose.php?sendto=libvirt-users%40redhat.com');}else{top.Popup.composeWindow('pcompose.php?sendto=libvirt-users%40redhat.com');}; return false;"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;br&gt; can you try lstopo command&lt;div class=""&gt;&lt;br class=""&gt;&lt;div&gt;&lt;blockquote type="cite" class=""&gt;&lt;div class=""&gt;On Mar 19, 2017, at 9:54 PM, &lt;&lt;a target="_blank" href="mailto:arrakis@tsiom.com" mce_onclick="if(window.location==top.location){Popup.composeWindow('pcompose.php?sendto=arrakis%40tsiom.com');}else{top.Popup.composeWindow('pcompose.php?sendto=arrakis%40tsiom.com');}; return false;" class=""&gt;arrakis@tsiom.com&lt;/a&gt;&gt; &lt;&lt;a target="_blank" href="mailto:arrakis@tsiom.com" mce_onclick="if(window.location==top.location){Popup.composeWindow('pcompose.php?sendto=arrakis%40tsiom.com');}else{top.Popup.composeWindow('pcompose.php?sendto=arrakis%40tsiom.com');}; return false;" class=""&gt;arrakis@tsiom.com&lt;/a&gt;&gt; wrote:&lt;/div&gt;&lt;br class="Apple-interchange-newline"&gt;&lt;div class=""&gt;&lt;div class=""&gt;&lt;span style="font-family: Verdana; font-size: 10pt;" mce_style="font-family: Verdana; font-size: 10pt;" class=""&gt;&lt;div class="colourline linestyle2"&gt;Hello, I was hoping &lt;span style="font-size: 10pt;" mce_style="font-size: 10pt;" class=""&gt;someone help me regarding my KVM Domain XML file. I have a 1 socket, 6 core processor with hyperthreading. I wanted to pin 3 full cores (6 threads on 3 cores) to my KVM instance with a 1-1 mapping (so that the KVM instance has 3 cores and 6 total threads). I thus used the following in my xml file:&lt;/span&gt;&lt;/div&gt;&lt;div class="linestyle1 colourline"&gt;&lt;br class=""&gt;&lt;/div&gt;&lt;cpu mode='host-model&gt; &lt;topology sockets='1' cores='3' threads='2'/&gt; &lt;/cpu&gt;&lt;div class="linestyle1 colourline"&gt;&lt;br class=""&gt;&lt;/div&gt;&lt;div class="linestyle1 colourline"&gt;&lt;span style="font-size: 10pt;" mce_style="font-size: 10pt;" class=""&gt;I know what physical cpu ids are siblings (share the same processor cores) through $(cat /proc/cpu) or $(&lt;/span&gt;virsh capabilities).  &lt;span style="font-size: 10pt;" mce_style="font-size: 10pt;" class=""&gt;However, in the &lt;cputune&gt; section, when pinning vcpus ids to physical cpus, I need to know which vcpu ids are "siblings" (which vcpu ids share the same virtual core). I would imagine vcpu ids 0 &amp; 1 are siblings, 2 &amp; 3 are siblings etc, but I cannot find anywhere in the documentation which confirms this.&lt;/span&gt;&lt;/div&gt;&lt;div class="linestyle1 colourline"&gt;&lt;br class=""&gt;&lt;/div&gt;&lt;div class="linestyle1 colourline"&gt;&lt;span style="font-size: 10pt;" mce_style="font-size: 10pt;" class=""&gt;Could someone please help?&lt;br class=""&gt;Many thanks! &lt;/span&gt;&lt;/div&gt;&lt;div class="linestyle1 colourline"&gt;&lt;span style="font-size: 10pt;" mce_style="font-size: 10pt;" class=""&gt;&lt;br class=""&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class="linestyle1 colourline"&gt;&lt;br class=""&gt;&lt;/div&gt;&lt;/span&gt;&lt;/div&gt; _______________________________________________&lt;br class=""&gt;libvirt-users mailing list&lt;br class=""&gt;&lt;a target="_blank" href="mailto:libvirt-users@redhat.com" mce_onclick="if(window.location==top.location){Popup.composeWindow('pcompose.php?sendto=libvirt-users%40redhat.com');}else{top.Popup.composeWindow('pcompose.php?sendto=libvirt-users%40redhat.com');}; return false;" class=""&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br class=""&gt;&lt;a target="_blank" href="https://www.redhat.com/mailman/listinfo/libvirt-users" mce_href="https://www.redhat.com/mailman/listinfo/libvirt-users"&gt;https://www.redhat.com/mailman/listinfo/libvirt-users&lt;/a&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br class=""&gt;&lt;/div&gt; &lt;/div&gt;  &lt;/div&gt;&lt;/span&gt;&lt;/span&gt;&lt;/body&gt;&lt;/html&gt;

</body></email><email><emailId>20170321153413</emailId><senderName>Timo Juhani Lindfors</senderName><senderEmail>timo.lindfors@iki.fi</senderEmail><timestampReceived>2017-03-21 15:34:13-0400</timestampReceived><subject>Re: [libvirt-users] libvirt-guests and time sync on autostart vms</subject><body>

Gianluca Cecchi &lt;gianluca.cecchi@gmail.com&gt; writes:
&gt; # running in the guest. For instance, qemu-ga doesn't support guest time
&gt; # synchronization on Windows guests, but Linux ones. By default, this
&gt; # functionality is turned off.

I observed this too but the agent sounded too dangerous to me since
changelog mentioned some denial of service issues with JSON parsing in
the past.

</body></email><email><emailId>20170321170642</emailId><senderName>"Richard W.M. Jones"</senderName><senderEmail>rjones@redhat.com</senderEmail><timestampReceived>2017-03-21 17:06:42-0400</timestampReceived><subject>Re: [libvirt-users] [Libguestfs] Running virConnectGetCapabilities / virsh capabilities without a da</subject><body>

On Tue, Mar 21, 2017 at 11:25:20AM -0400, Ram Krishna wrote:
&gt; lstopo, lstopo --output-format xml 

Yes that's interesting, although it's unfortunate that it doesn't
include the CPU model (eg. "Broadwell" etc) in a form which libvirt
can understand.  Also the topology is rather difficult to parse.

Rich.

-- 
Richard Jones, Virtualization Group, Red Hat http://people.redhat.com/~rjones
Read my programming and virtualization blog: http://rwmj.wordpress.com
virt-p2v converts physical machines to virtual machines.  Boot with a
live CD or over the network (PXE) and turn machines into KVM guests.
http://libguestfs.org/virt-v2v

</body></email><email><emailId>20170322092209</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-03-22 09:22:09-0400</timestampReceived><subject>Re: [libvirt-users] Running virConnectGetCapabilities / virsh capabilities without a daemon or KVM</subject><body>


On Tue, Mar 21, 2017 at 02:35:24PM +0000, Richard W.M. Jones wrote:
&gt;
&gt;For virt-p2v we want to get the host CPU model, topology etc, and the
&gt;best way we found to do that was to pull it from libvirt
&gt;capabilities[1].  Since libvirt is already parsing the host CPU
&gt;information, and because /proc/cpuinfo is such a stupid format to
&gt;parse, this is very convenient.
&gt;

Yeah, but we don't really parse more than the cpu frequency from that
file.

&gt;Unfortunately it doesn't work unless libvirtd _and_ KVM are both
&gt;installed.
&gt;
&gt;Without libvirtd installed:
&gt;
&gt;  # virsh capabilities
&gt;  error: failed to connect to the hypervisor
&gt;  error: Failed to connect socket to '/var/run/libvirt/libvirt-sock': No such file or directory
&gt;

We could theoretically add some "local hypervisor" driver that could
expose only host-related APIs and would have no hypervisor capabilities,
but that seems hacky.

&gt;With libvirt-daemon installed, but not QEMU:
&gt;
&gt;  # virsh capabilities
&gt;  error: failed to connect to the hypervisor
&gt;  error: no connection driver available for &lt;null&gt;
&gt;
&gt;I feel I should be able to fiddle with the connection URI in some way
&gt;to make this possible, at least in the second case.  However there's
&gt;not a concept of "no hypervisor", and I couldn't find any other way to
&gt;make it work.  Using "test:///default" seems tempting, but it
&gt;substitutes some imaginary host (i686) so that's no good.
&gt;

test:///default is purposefully not touching the host, it would have to
be something like local:// or none:///local

&gt;Installing KVM isn't really an option for us since we are trying to
&gt;build a minimal bootable ISO.  Just installing qemu-system-x86_64
&gt;pulls in half the world.  (Even installing libvirtd is difficult, and
&gt;we'd prefer to avoid it).
&gt;

So when you install virsh, it uses libvirt-libs and all the stuff that's
used for parsing and providing that information is already there
(almost, though), so it seems possible to provide the information.
However, that doesn't really fit into how virsh is trying to work/look.
You could use the internals directly, or parse the cpu_map.xml yourself,
but that's not supported and so on.  We could provide a helper in
/usr/libexec that would tell you the capabilities, but there's still one
caveat.

You want to describe the CPU model for QEMU to emulate it as closely as
possible.  Long story short, for that we were trying to mimic QEMU's
behaviour and due to various inconsistencies the best thing to do was
ask the QEMU binary itself directly about this stuff.  So if you
currently want to use libvirt for this, I can't think of a reliable way
to do it without QEMU.  We can get "close enough" without QEMU, but so
can you:

  - uname() to have the architecture,
  - check the flags from /proc/cpuinfo:
     - ARM =&gt; Features:
     - x86 =&gt; flags:
  - do a mapping between cpuinfo flags and QEMU features (my guess is
    there's around 10 features that might have different spelling)
  - get all the topology from /sys/devices/system/{node,cpu}, there's
    lot more info nowadays in newer kernels exposed in there, so you
    don't need to go searching anywhere else much

Of course this will only work on linux, but I'm guessing that's not a
problem in this case, right?

&gt;Any ideas?
&gt;
&gt;Rich.
&gt;
&gt;[1] https://github.com/libguestfs/libguestfs/commit/963d6c3be7cd91c0373f67cfdd95c4f1dad1452f
&gt;
&gt;--
&gt;Richard Jones, Virtualization Group, Red Hat http://people.redhat.com/~rjones
&gt;Read my programming and virtualization blog: http://rwmj.wordpress.com
&gt;Fedora Windows cross-compiler. Compile Windows programs, test, and
&gt;build Windows installers. Over 100 libraries supported.
&gt;http://fedoraproject.org/wiki/MinGW
&gt;
&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170322134938</emailId><senderName>"Szczerbik, PrzemyslawX"</senderName><senderEmail>przemyslawx.szczerbik@intel.com</senderEmail><timestampReceived>2017-03-22 13:49:38-0400</timestampReceived><subject>[libvirt-users] Memory statistics for a domain</subject><body>

Hi,

I'm wondering whether there is any difference between VIR_DOMAIN_MEMORY_STA=
T_ACTUAL_BALLOON and 'memory' member from virDomainInfo structure.
Based on the documentation those values should correspond to current balloo=
n and memory used by the domain respectively.
Is it always the case that those values will be equal?

Is there a reason why maximum memory allowed ('maxMem' from virDomainInfo s=
tructure) cannot be retrieved from virDomainMemoryStats API?
It seems that it's required to call 2 different APIs to get all memory metr=
ics for a domain.

Regards,
Przemek



--------------------------------------------------------------
Intel Research and Development Ireland Limited
Registered in Ireland
Registered Office: Collinstown Industrial Park, Leixlip, County Kildare
Registered Number: 308263


This e-mail and any attachments may contain confidential material for the s=
ole
use of the intended recipient(s). Any review or distribution by others is
strictly prohibited. If you are not the intended recipient, please contact =
the
sender and delete all copies.

[Attachment #3 (text/html)]

&lt;html xmlns:v="urn:schemas-microsoft-com:vml" \
xmlns:o="urn:schemas-microsoft-com:office:office" \
xmlns:w="urn:schemas-microsoft-com:office:word" \
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" \
xmlns="http://www.w3.org/TR/REC-html40"&gt; &lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"&gt;
&lt;meta name="ProgId" content="Word.Document"&gt;
&lt;meta name="Generator" content="Microsoft Word 15"&gt;
&lt;meta name="Originator" content="Microsoft Word 15"&gt;
&lt;link rel="File-List" href="cid:filelist.xml@01D2A313.23B2C430"&gt;&lt;!--[if gte mso \
9]&gt;&lt;xml&gt; &lt;o:OfficeDocumentSettings&gt;
&lt;o:AllowPNG/&gt;
&lt;/o:OfficeDocumentSettings&gt;
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;w:WordDocument&gt;
&lt;w:SpellingState&gt;Clean&lt;/w:SpellingState&gt;
&lt;w:TrackMoves/&gt;
&lt;w:TrackFormatting/&gt;
&lt;w:EnvelopeVis/&gt;
&lt;w:PunctuationKerning/&gt;
&lt;w:ValidateAgainstSchemas/&gt;
&lt;w:SaveIfXMLInvalid&gt;false&lt;/w:SaveIfXMLInvalid&gt;
&lt;w:IgnoreMixedContent&gt;false&lt;/w:IgnoreMixedContent&gt;
&lt;w:AlwaysShowPlaceholderText&gt;false&lt;/w:AlwaysShowPlaceholderText&gt;
&lt;w:DoNotPromoteQF/&gt;
&lt;w:LidThemeOther&gt;EN-US&lt;/w:LidThemeOther&gt;
&lt;w:LidThemeAsian&gt;X-NONE&lt;/w:LidThemeAsian&gt;
&lt;w:LidThemeComplexScript&gt;X-NONE&lt;/w:LidThemeComplexScript&gt;
&lt;w:Compatibility&gt;
&lt;w:BreakWrappedTables/&gt;
&lt;w:SnapToGridInCell/&gt;
&lt;w:WrapTextWithPunct/&gt;
&lt;w:UseAsianBreakRules/&gt;
&lt;w:DontGrowAutofit/&gt;
&lt;w:SplitPgBreakAndParaMark/&gt;
&lt;w:EnableOpenTypeKerning/&gt;
&lt;w:DontFlipMirrorIndents/&gt;
&lt;w:OverrideTableStyleHps/&gt;
&lt;/w:Compatibility&gt;
&lt;m:mathPr&gt;
&lt;m:mathFont m:val="Cambria Math"/&gt;
&lt;m:brkBin m:val="before"/&gt;
&lt;m:brkBinSub m:val="--"/&gt;
&lt;m:smallFrac m:val="off"/&gt;
&lt;m:dispDef/&gt;
&lt;m:lMargin m:val="0"/&gt;
&lt;m:rMargin m:val="0"/&gt;
&lt;m:defJc m:val="centerGroup"/&gt;
&lt;m:wrapIndent m:val="1440"/&gt;
&lt;m:intLim m:val="subSup"/&gt;
&lt;m:naryLim m:val="undOvr"/&gt;
&lt;/m:mathPr&gt;&lt;/w:WordDocument&gt;
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;w:LatentStyles DefLockedState="false" DefUnhideWhenUsed="false" \
DefSemiHidden="false" DefQFormat="false" DefPriority="99" LatentStyleCount="371"&gt; \
&lt;w:LsdException Locked="false" Priority="0" QFormat="true" Name="Normal"/&gt; \
&lt;w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 1"/&gt; \
&lt;w:LsdException Locked="false" Priority="9" SemiHidden="true" UnhideWhenUsed="true" \
QFormat="true" Name="heading 2"/&gt; &lt;w:LsdException Locked="false" Priority="9" \
SemiHidden="true" UnhideWhenUsed="true" QFormat="true" Name="heading 3"/&gt; \
&lt;w:LsdException Locked="false" Priority="9" SemiHidden="true" UnhideWhenUsed="true" \
QFormat="true" Name="heading 4"/&gt; &lt;w:LsdException Locked="false" Priority="9" \
SemiHidden="true" UnhideWhenUsed="true" QFormat="true" Name="heading 5"/&gt; \
&lt;w:LsdException Locked="false" Priority="9" SemiHidden="true" UnhideWhenUsed="true" \
QFormat="true" Name="heading 6"/&gt; &lt;w:LsdException Locked="false" Priority="9" \
SemiHidden="true" UnhideWhenUsed="true" QFormat="true" Name="heading 7"/&gt; \
&lt;w:LsdException Locked="false" Priority="9" SemiHidden="true" UnhideWhenUsed="true" \
QFormat="true" Name="heading 8"/&gt; &lt;w:LsdException Locked="false" Priority="9" \
SemiHidden="true" UnhideWhenUsed="true" QFormat="true" Name="heading 9"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="index \
1"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="index 2"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="index 3"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="index 4"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="index 5"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="index \
6"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="index 7"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="index 8"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="index 9"/&gt; &lt;w:LsdException \
Locked="false" Priority="39" SemiHidden="true" UnhideWhenUsed="true" Name="toc 1"/&gt; \
&lt;w:LsdException Locked="false" Priority="39" SemiHidden="true" UnhideWhenUsed="true" \
Name="toc 2"/&gt; &lt;w:LsdException Locked="false" Priority="39" SemiHidden="true" \
UnhideWhenUsed="true" Name="toc 3"/&gt; &lt;w:LsdException Locked="false" Priority="39" \
SemiHidden="true" UnhideWhenUsed="true" Name="toc 4"/&gt; &lt;w:LsdException Locked="false" \
Priority="39" SemiHidden="true" UnhideWhenUsed="true" Name="toc 5"/&gt; &lt;w:LsdException \
Locked="false" Priority="39" SemiHidden="true" UnhideWhenUsed="true" Name="toc 6"/&gt; \
&lt;w:LsdException Locked="false" Priority="39" SemiHidden="true" UnhideWhenUsed="true" \
Name="toc 7"/&gt; &lt;w:LsdException Locked="false" Priority="39" SemiHidden="true" \
UnhideWhenUsed="true" Name="toc 8"/&gt; &lt;w:LsdException Locked="false" Priority="39" \
SemiHidden="true" UnhideWhenUsed="true" Name="toc 9"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="Normal Indent"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="footnote text"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="annotation text"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="header"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="footer"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="index heading"/&gt; \
&lt;w:LsdException Locked="false" Priority="35" SemiHidden="true" UnhideWhenUsed="true" \
QFormat="true" Name="caption"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="table of figures"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="envelope address"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="envelope return"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="footnote \
reference"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="annotation reference"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="line number"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="page number"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="endnote reference"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="endnote \
text"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="table of authorities"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="macro"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="toa heading"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="List"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="List Bullet"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="List Number"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="List \
2"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="List 3"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="List 4"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="List 5"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="List Bullet 2"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="List \
Bullet 3"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="List Bullet 4"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="List Bullet 5"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="List Number 2"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="List Number 3"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="List \
Number 4"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="List Number 5"/&gt; &lt;w:LsdException Locked="false" Priority="10" QFormat="true" \
Name="Title"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="Closing"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="Signature"/&gt; &lt;w:LsdException Locked="false" Priority="1" \
SemiHidden="true" UnhideWhenUsed="true" Name="Default Paragraph Font"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Body \
Text"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="Body Text Indent"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="List Continue"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="List Continue 2"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="List Continue 3"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="List \
Continue 4"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="List Continue 5"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="Message Header"/&gt; &lt;w:LsdException Locked="false" \
Priority="11" QFormat="true" Name="Subtitle"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="Salutation"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Date"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Body Text First \
Indent"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="Body Text First Indent 2"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="Note Heading"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="Body Text 2"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Body Text 3"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Body \
Text Indent 2"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="Body Text Indent 3"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="Block Text"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Hyperlink"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="FollowedHyperlink"/&gt; &lt;w:LsdException Locked="false" Priority="22" \
QFormat="true" Name="Strong"/&gt; &lt;w:LsdException Locked="false" Priority="20" \
QFormat="true" Name="Emphasis"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="Document Map"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="Plain Text"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="E-mail Signature"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="HTML Top \
of Form"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="HTML Bottom of Form"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="Normal (Web)"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="HTML Acronym"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="HTML Address"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="HTML \
Cite"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="HTML Code"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="HTML Definition"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="HTML Keyboard"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="HTML Preformatted"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="HTML \
Sample"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="HTML Typewriter"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="HTML Variable"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="Normal Table"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="annotation subject"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="No \
List"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="Outline List 1"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="Outline List 2"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="Outline List 3"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Table Simple 1"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Table \
Simple 2"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="Table Simple 3"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="Table Classic 1"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="Table Classic 2"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Table Classic 3"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Table \
Classic 4"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="Table Colorful 1"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="Table Colorful 2"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="Table Colorful 3"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Table Columns 1"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Table \
Columns 2"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="Table Columns 3"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="Table Columns 4"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="Table Columns 5"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Table Grid 1"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Table \
Grid 2"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="Table Grid 3"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="Table Grid 4"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="Table Grid 5"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Table Grid 6"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Table \
Grid 7"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="Table Grid 8"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="Table List 1"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="Table List 2"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Table List 3"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Table \
List 4"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="Table List 5"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="Table List 6"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="Table List 7"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Table List 8"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Table 3D \
effects 1"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="Table 3D effects 2"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="Table 3D effects 3"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="Table Contemporary"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Table Elegant"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Table \
Professional"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="Table Subtle 1"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" UnhideWhenUsed="true" Name="Table Subtle 2"/&gt; &lt;w:LsdException \
Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Table Web 1"/&gt; \
&lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" Name="Table \
Web 2"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true" \
Name="Table Web 3"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="Balloon Text"/&gt; &lt;w:LsdException Locked="false" \
Priority="39" Name="Table Grid"/&gt; &lt;w:LsdException Locked="false" SemiHidden="true" \
UnhideWhenUsed="true" Name="Table Theme"/&gt; &lt;w:LsdException Locked="false" \
SemiHidden="true" Name="Placeholder Text"/&gt; &lt;w:LsdException Locked="false" \
Priority="1" QFormat="true" Name="No Spacing"/&gt; &lt;w:LsdException Locked="false" \
Priority="60" Name="Light Shading"/&gt; &lt;w:LsdException Locked="false" Priority="61" \
Name="Light List"/&gt; &lt;w:LsdException Locked="false" Priority="62" Name="Light Grid"/&gt;
&lt;w:LsdException Locked="false" Priority="63" Name="Medium Shading 1"/&gt;
&lt;w:LsdException Locked="false" Priority="64" Name="Medium Shading 2"/&gt;
&lt;w:LsdException Locked="false" Priority="65" Name="Medium List 1"/&gt;
&lt;w:LsdException Locked="false" Priority="66" Name="Medium List 2"/&gt;
&lt;w:LsdException Locked="false" Priority="67" Name="Medium Grid 1"/&gt;
&lt;w:LsdException Locked="false" Priority="68" Name="Medium Grid 2"/&gt;
&lt;w:LsdException Locked="false" Priority="69" Name="Medium Grid 3"/&gt;
&lt;w:LsdException Locked="false" Priority="70" Name="Dark List"/&gt;
&lt;w:LsdException Locked="false" Priority="71" Name="Colorful Shading"/&gt;
&lt;w:LsdException Locked="false" Priority="72" Name="Colorful List"/&gt;
&lt;w:LsdException Locked="false" Priority="73" Name="Colorful Grid"/&gt;
&lt;w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="61" Name="Light List Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 1"/&gt;
&lt;w:LsdException Locked="false" SemiHidden="true" Name="Revision"/&gt;
&lt;w:LsdException Locked="false" Priority="34" QFormat="true" Name="List Paragraph"/&gt;
&lt;w:LsdException Locked="false" Priority="29" QFormat="true" Name="Quote"/&gt;
&lt;w:LsdException Locked="false" Priority="30" QFormat="true" Name="Intense Quote"/&gt;
&lt;w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="70" Name="Dark List Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="61" Name="Light List Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="70" Name="Dark List Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="61" Name="Light List Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="70" Name="Dark List Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="61" Name="Light List Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="70" Name="Dark List Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="61" Name="Light List Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="70" Name="Dark List Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="61" Name="Light List Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="70" Name="Dark List Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="19" QFormat="true" Name="Subtle Emphasis"/&gt;
&lt;w:LsdException Locked="false" Priority="21" QFormat="true" Name="Intense Emphasis"/&gt;
&lt;w:LsdException Locked="false" Priority="31" QFormat="true" Name="Subtle Reference"/&gt;
&lt;w:LsdException Locked="false" Priority="32" QFormat="true" Name="Intense \
Reference"/&gt; &lt;w:LsdException Locked="false" Priority="33" QFormat="true" Name="Book \
Title"/&gt; &lt;w:LsdException Locked="false" Priority="37" SemiHidden="true" \
UnhideWhenUsed="true" Name="Bibliography"/&gt; &lt;w:LsdException Locked="false" \
Priority="39" SemiHidden="true" UnhideWhenUsed="true" QFormat="true" Name="TOC \
Heading"/&gt; &lt;w:LsdException Locked="false" Priority="41" Name="Plain Table 1"/&gt;
&lt;w:LsdException Locked="false" Priority="42" Name="Plain Table 2"/&gt;
&lt;w:LsdException Locked="false" Priority="43" Name="Plain Table 3"/&gt;
&lt;w:LsdException Locked="false" Priority="44" Name="Plain Table 4"/&gt;
&lt;w:LsdException Locked="false" Priority="45" Name="Plain Table 5"/&gt;
&lt;w:LsdException Locked="false" Priority="40" Name="Grid Table Light"/&gt;
&lt;w:LsdException Locked="false" Priority="46" Name="Grid Table 1 Light"/&gt;
&lt;w:LsdException Locked="false" Priority="47" Name="Grid Table 2"/&gt;
&lt;w:LsdException Locked="false" Priority="48" Name="Grid Table 3"/&gt;
&lt;w:LsdException Locked="false" Priority="49" Name="Grid Table 4"/&gt;
&lt;w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark"/&gt;
&lt;w:LsdException Locked="false" Priority="51" Name="Grid Table 6 Colorful"/&gt;
&lt;w:LsdException Locked="false" Priority="52" Name="Grid Table 7 Colorful"/&gt;
&lt;w:LsdException Locked="false" Priority="46" Name="Grid Table 1 Light Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="51" Name="Grid Table 6 Colorful Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="52" Name="Grid Table 7 Colorful Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="46" Name="Grid Table 1 Light Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="51" Name="Grid Table 6 Colorful Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="52" Name="Grid Table 7 Colorful Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="46" Name="Grid Table 1 Light Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="51" Name="Grid Table 6 Colorful Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="52" Name="Grid Table 7 Colorful Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="46" Name="Grid Table 1 Light Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="51" Name="Grid Table 6 Colorful Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="52" Name="Grid Table 7 Colorful Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="46" Name="Grid Table 1 Light Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="51" Name="Grid Table 6 Colorful Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="52" Name="Grid Table 7 Colorful Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="46" Name="Grid Table 1 Light Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="51" Name="Grid Table 6 Colorful Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="52" Name="Grid Table 7 Colorful Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="46" Name="List Table 1 Light"/&gt;
&lt;w:LsdException Locked="false" Priority="47" Name="List Table 2"/&gt;
&lt;w:LsdException Locked="false" Priority="48" Name="List Table 3"/&gt;
&lt;w:LsdException Locked="false" Priority="49" Name="List Table 4"/&gt;
&lt;w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark"/&gt;
&lt;w:LsdException Locked="false" Priority="51" Name="List Table 6 Colorful"/&gt;
&lt;w:LsdException Locked="false" Priority="52" Name="List Table 7 Colorful"/&gt;
&lt;w:LsdException Locked="false" Priority="46" Name="List Table 1 Light Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="51" Name="List Table 6 Colorful Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="52" Name="List Table 7 Colorful Accent 1"/&gt;
&lt;w:LsdException Locked="false" Priority="46" Name="List Table 1 Light Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="51" Name="List Table 6 Colorful Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="52" Name="List Table 7 Colorful Accent 2"/&gt;
&lt;w:LsdException Locked="false" Priority="46" Name="List Table 1 Light Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="51" Name="List Table 6 Colorful Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="52" Name="List Table 7 Colorful Accent 3"/&gt;
&lt;w:LsdException Locked="false" Priority="46" Name="List Table 1 Light Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="51" Name="List Table 6 Colorful Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="52" Name="List Table 7 Colorful Accent 4"/&gt;
&lt;w:LsdException Locked="false" Priority="46" Name="List Table 1 Light Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="51" Name="List Table 6 Colorful Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="52" Name="List Table 7 Colorful Accent 5"/&gt;
&lt;w:LsdException Locked="false" Priority="46" Name="List Table 1 Light Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="51" Name="List Table 6 Colorful Accent 6"/&gt;
&lt;w:LsdException Locked="false" Priority="52" Name="List Table 7 Colorful Accent 6"/&gt;
&lt;/w:LatentStyles&gt;
&lt;/xml&gt;&lt;![endif]--&gt;&lt;style&gt;&lt;!--
/* Font Definitions */
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;
	mso-font-alt:"Calisto MT";
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:-536870145 1107305727 0 0 415 0;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;
	mso-font-alt:"Times New Roman";
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-536870145 1073786111 1 0 415 0;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;
	mso-ascii-font-family:Calibri;
	mso-fareast-font-family:Calibri;
	mso-hansi-font-family:Calibri;
	mso-bidi-font-family:"Times New Roman";}
h3
	{mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-link:"Heading 3 Char";
	mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:3;
	font-size:13.5pt;
	font-family:"Times New Roman",serif;
	mso-fareast-font-family:"Times New Roman";}
a:link, span.MsoHyperlink
	{mso-style-noshow:yes;
	mso-style-priority:99;
	color:#0563C1;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-noshow:yes;
	mso-style-priority:99;
	color:#954F72;
	text-decoration:underline;
	text-underline:single;}
code
	{mso-style-noshow:yes;
	mso-style-priority:99;
	font-family:"Courier New";
	mso-ascii-font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:"Courier New";
	mso-bidi-font-family:"Courier New";}
pre
	{mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-link:"HTML Preformatted Char";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";}
span.EmailStyle17
	{mso-style-type:personal-compose;
	mso-style-noshow:yes;
	mso-style-unhide:no;
	mso-ansi-font-size:11.0pt;
	mso-bidi-font-size:11.0pt;
	font-family:"Calibri",sans-serif;
	mso-ascii-font-family:Calibri;
	mso-fareast-font-family:Calibri;
	mso-hansi-font-family:Calibri;
	mso-bidi-font-family:"Times New Roman";
	color:windowtext;}
span.HTMLPreformattedChar
	{mso-style-name:"HTML Preformatted Char";
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"HTML Preformatted";
	mso-ansi-font-size:10.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Courier New";
	mso-ascii-font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:"Courier New";
	mso-bidi-font-family:"Courier New";}
span.Heading3Char
	{mso-style-name:"Heading 3 Char";
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"Heading 3";
	mso-ansi-font-size:13.5pt;
	mso-bidi-font-size:13.5pt;
	font-family:"Times New Roman",serif;
	mso-ascii-font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";
	font-weight:bold;}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
.MsoChpDefault
	{mso-style-type:export-only;
	mso-default-props:yes;
	font-family:"Calibri",sans-serif;
	mso-ascii-font-family:Calibri;
	mso-fareast-font-family:Calibri;
	mso-hansi-font-family:Calibri;
	mso-bidi-font-family:"Times New Roman";}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.WordSection1
	{page:WordSection1;}
--&gt;&lt;/style&gt;&lt;!--[if gte mso 10]&gt;&lt;style&gt;/* Style Definitions */
table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;
	mso-ascii-font-family:Calibri;
	mso-hansi-font-family:Calibri;}
&lt;/style&gt;&lt;![endif]--&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapedefaults v:ext="edit" spidmax="1026" /&gt;
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapelayout v:ext="edit"&gt;
&lt;o:idmap v:ext="edit" data="1" /&gt;
&lt;/o:shapelayout&gt;&lt;/xml&gt;&lt;![endif]--&gt;
&lt;/head&gt;
&lt;body lang="EN-US" link="#0563C1" vlink="#954F72" style="tab-interval:.5in"&gt;
&lt;div class="WordSection1"&gt;
&lt;p class="MsoNormal"&gt;Hi,&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;I&lt;a name="VIR_DOMAIN_MEMORY_STAT_ACTUAL_BALLOON"&gt;’m \
wondering whether there is any difference between &lt;i \
style="mso-bidi-font-style:normal"&gt;VIR_DOMAIN_MEMORY_STAT_ACTUAL_BALLOON&lt;/i&gt;&lt;/a&gt; and \
‘memory’ member from &lt;span class="SpellE"&gt;&lt;i \
style="mso-bidi-font-style:normal"&gt;virDomainInfo&lt;/i&gt;&lt;/span&gt; structure.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; \
&lt;p class="MsoNormal"&gt;Based on the documentation those values should correspond to \
current balloon and memory used by the domain respectively.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;Is it always the case that those values will be \
equal?&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;Is there a reason why maximum memory allowed (‘&lt;span \
class="SpellE"&gt;maxMem&lt;/span&gt;’ from &lt;span class="SpellE"&gt;&lt;i \
style="mso-bidi-font-style:normal"&gt;virDomainInfo&lt;/i&gt;&lt;/span&gt; structure) cannot be \
retrieved from &lt;a name="virDomainMemoryStats"&gt;&lt;/a&gt;&lt;span class="SpellE"&gt;&lt;span \
style="mso-bookmark:virDomainMemoryStats"&gt;&lt;i \
style="mso-bidi-font-style:normal"&gt;virDomainMemoryStats&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;&lt;span \
style="mso-bookmark:virDomainMemoryStats"&gt;&lt;/span&gt; API?&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;It seems that it’s required to call 2 different APIs to get \
all memory metrics for a domain.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;Regards,&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span class="SpellE"&gt;Przemek&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;--------------------------------------------------------------&lt;br&gt;
Intel Research and Development Ireland Limited&lt;br&gt;
Registered in Ireland&lt;br&gt;
Registered Office: Collinstown Industrial Park, Leixlip, County Kildare&lt;br&gt;
Registered Number: 308263&lt;/p&gt;


&lt;p&gt;This e-mail and any attachments may contain confidential material for the
sole use of the intended recipient(s). Any review or distribution by others is
strictly prohibited. If you are not the intended recipient, please contact the
sender and delete all copies.&lt;/p&gt;

&lt;p&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170322190123</emailId><senderName>Laine Stump</senderName><senderEmail>laine@laine.org</senderEmail><timestampReceived>2017-03-22 19:01:23-0400</timestampReceived><subject>Re: [libvirt-users] libvirtd firewalld support</subject><body>

On 03/22/2017 12:11 PM, Cole Robinson wrote:
&gt; On 03/22/2017 10:39 AM, Leon Goldberg wrote:
&gt;&gt; Hey,
&gt;&gt;
&gt;&gt; I've been wondering about the extent libvirt makes use of firewalld.
&gt;&gt; I'm looking to use firewalld exclusively and wonder about the ports
&gt;&gt; libvirt takes care of for me via firewalld (e.g. will console/vnc
&gt;&gt; ports, qemu migration ports, etc, will be handled for me?)
&gt;&gt;
&gt;&gt; I have only done a little bit of testing, but it seems like I can't
&gt;&gt; connect to a vm via vnc without explicitly opening ports beforehand.
&gt;&gt;
&gt; 
&gt; Libvirt doesn't do stuff like that automatically. It's usage of firewalld and
&gt; firewalls in general is for 1) virtual networks (for example the 'default'
&gt; network that sets up NAT equivalent for your VMs) and 2) nwfilter config (
&gt; https://libvirt.org/formatnwfilter.html )

Yeah, it would be problematic for libvirt to try and automatically add
rules to allow incoming connections to VNC ports with the current
information it has available. It's likely that even if you did want to
allow it, you might want it limited to only come from certain addresses,
for example. There might be some reasonable way to do it by adding a
"firewallZone" attribute that could integrate with firewalld's concept
of zones, but that would require somebody stepping up to advocate for it
and do the work :-)

A more practical solution to your problem with the existing versions of
tools may be to hardcode a port for the VNC listener (since you're
already in there hardcoding an IP address), then add a rule to firewalld
directly for that hardcoded port.

</body></email><email><emailId>20170322191901</emailId><senderName>"Pyles, Andy"</senderName><senderEmail>apyles@mitre.org</senderEmail><timestampReceived>2017-03-22 19:19:01-0400</timestampReceived><subject>[libvirt-users] libvirt + lxc + cgroups mounting</subject><body>

[Attachment #2 (text/plain)]

All,

Within: https://libvirt.org/drvlxc.html#cgroups it mentions that :
"/sys/fs/cgroup/NNNN the host cgroups controllers bind-mounted to only expose the \
sub-tree associated with the container"


In my environment, the host contains:

$ls –l /sys/fs/cgroup/
cpu -&gt; cpu,acct
cpu,cpuacct
cpuacct -&gt; cpu,cpuacct
cpuset
debug
devices
freezer
memory
net_cls
systemd
-
but on my LXC container, I have only:
$ls –l /sys/fs/cgroup
memory
--
How do I add additional host cgroup controllers to the set which is bind-mounted \
within the container?

Thanks,
Andy Pyles


[Attachment #3 (text/html)]

&lt;html xmlns:o="urn:schemas-microsoft-com:office:office" \
xmlns:w="urn:schemas-microsoft-com:office:word" \
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" \
xmlns="http://www.w3.org/TR/REC-html40"&gt; &lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
&lt;meta name="Title" content=""&gt;
&lt;meta name="Keywords" content=""&gt;
&lt;meta name="Generator" content="Microsoft Word 15 (filtered medium)"&gt;
&lt;style&gt;&lt;!--
/* Font Definitions */
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:Calibri;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:#0563C1;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:#954F72;
	text-decoration:underline;}
span.EmailStyle17
	{mso-style-type:personal-compose;
	font-family:Calibri;
	color:windowtext;}
span.msoIns
	{mso-style-type:export-only;
	mso-style-name:"";
	text-decoration:underline;
	color:teal;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-family:Calibri;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
--&gt;&lt;/style&gt;
&lt;/head&gt;
&lt;body bgcolor="white" lang="EN-US" link="#0563C1" vlink="#954F72"&gt;
&lt;div class="WordSection1"&gt;
&lt;p class="MsoNormal"&gt;&lt;span style="font-size:11.0pt"&gt;All,&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span style="font-size:11.0pt"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span style="font-size:11.0pt"&gt;Within: &lt;a \
href="https://libvirt.org/drvlxc.html#cgroups"&gt; \
https://libvirt.org/drvlxc.html#cgroups&lt;/a&gt; it mentions that :&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; \
&lt;p class="MsoNormal"&gt;&lt;span style="font-size:11.0pt"&gt;"/sys/fs/cgroup/NNNN the host \
cgroups controllers bind-mounted to only expose the sub-tree associated with the \
container"&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
style="font-size:11.0pt"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
style="font-size:11.0pt"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
style="font-size:11.0pt"&gt;In my environment, the host contains:&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; \
&lt;p class="MsoNormal"&gt;&lt;span style="font-size:11.0pt"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;&lt;span style="font-size:11.0pt"&gt;$ls –l \
/sys/fs/cgroup/&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
style="font-size:11.0pt"&gt;cpu -&gt; cpu,acct&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;&lt;span style="font-size:11.0pt"&gt;cpu,cpuacct&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;&lt;span style="font-size:11.0pt"&gt;cpuacct -&gt; \
cpu,cpuacct&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
style="font-size:11.0pt"&gt;cpuset&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
style="font-size:11.0pt"&gt;debug&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
style="font-size:11.0pt"&gt;devices&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
style="font-size:11.0pt"&gt;freezer&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
style="font-size:11.0pt"&gt;memory&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
style="font-size:11.0pt"&gt;net_cls&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
style="font-size:11.0pt"&gt;systemd&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
style="font-size:11.0pt"&gt;-&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
style="font-size:11.0pt"&gt;but on my LXC container, I have only:&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; \
&lt;p class="MsoNormal"&gt;&lt;span style="font-size:11.0pt"&gt;$ls –l \
/sys/fs/cgroup&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
style="font-size:11.0pt"&gt;memory&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
style="font-size:11.0pt"&gt;--&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
style="font-size:11.0pt"&gt;How do I add additional host cgroup controllers to the set \
which is bind-mounted within the container? &lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span style="font-size:11.0pt"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span style="font-size:11.0pt"&gt;Thanks,&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span style="font-size:11.0pt"&gt;Andy Pyles&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span style="font-size:11.0pt"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span style="font-size:11.0pt"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span style="font-size:11.0pt"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170331084955</emailId><senderName>Peter Krempa</senderName><senderEmail>pkrempa@redhat.com</senderEmail><timestampReceived>2017-03-31 08:49:55-0400</timestampReceived><subject>Re: [libvirt-users] different bios file per guest</subject><body>


On Thu, Mar 30, 2017 at 17:09:01 +0300, Anton Gorlov wrote:
&gt; Can I set different bios file per guest?
&gt;=20
&gt; For some guest need UEFI.

http://libvirt.org/formatdomain.html#elementsOSBIOS

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170201045401</emailId><senderName>abhishek jain</senderName><senderEmail>abhish_jain@yahoo.com</senderEmail><timestampReceived>2017-02-01 04:54:01-0400</timestampReceived><subject>[libvirt-users] Libvirt and Virt-manager compatibility</subject><body>

Hi,
I am using Libvirt (1.2.2) on RHEL6. I want to use the compatible virt-manager for \
it. When I tried 1.4.0 and 1.3.0 there is an insatllation issue on RHLE6 for gtk3.   \
Is there any virt-manager version which works with 1.2.2 and RHLE6 too. Also what is \
the compatibility matrix for libvirt and virt-manager version.

Thanks &amp; RegardsAbhishek

      From: "libvirt-users-request@redhat.com" &lt;libvirt-users-request@redhat.com&gt;
 To: libvirt-users@redhat.com 
 Sent: Wednesday, 1 February 2017 3:12 AM
 Subject: libvirt-users Digest, Vol 85, Issue 24
   
Send libvirt-users mailing list submissions to
       libvirt-users@redhat.com

To subscribe or unsubscribe via the World Wide Web, visit
       https://www.redhat.com/mailman/listinfo/libvirt-users
or, via email, send a message with subject or body 'help' to
       libvirt-users-request@redhat.com

You can reach the person managing the list at
       libvirt-users-owner@redhat.com

When replying, please edit your Subject line so it is more specific
than "Re: Contents of libvirt-users digest..."


Today's Topics:

   1. CfP 12th Virtualization in High?-Performance Cloud Computing
         Workshop (VHPC '17) (VHPC 17)


----------------------------------------------------------------------

Message: 1
Date: Tue, 31 Jan 2017 22:42:50 +0100
From: VHPC 17 &lt;vhpc.dist@gmail.com&gt;
To: libvirt-users@redhat.com
Subject: [libvirt-users] CfP 12th Virtualization in High?-Performance
       Cloud Computing Workshop (VHPC '17)
Message-ID:
       &lt;CAF05tLM1bPf=R6rF7WF+EgAJoJxB6=U3QMzczJRRxozydGu9qQ@mail.gmail.com&gt;
Content-Type: text/plain; charset="utf-8"

====================================================================

CALL FOR PAPERS


12th Workshop on Virtualization in High?-Performance Cloud Computing   (VHPC
'17)

held in conjunction with the International Supercomputing Conference - High
Performance,

June 18-22, 2017, Frankfurt, Germany.

(Springer LNCS Proceedings)

====================================================================

Date: June 22, 2017

Workshop URL: http://vhpc.org

Abstract Submission Deadline: February 28, 2017

Paper Submission Deadline: April 25, 2017   (Springer LNCS)

Abstract/Paper Submission Link: https://edas.info/newPaper.php?c=23179



Call for Papers

Virtualization technologies constitute a key enabling factor for flexible
resource management

in modern data centers, and particularly in cloud environments. Cloud
providers need to

manage complex infrastructures in a seamless fashion to support the highly
dynamic and

heterogeneous workloads and hosted applications customers deploy.
Similarly, HPC

environments have been increasingly adopting techniques that enable
flexible management of

vast computing and networking resources, close to marginal provisioning
cost, which is

unprecedented in the history of scientific and commercial computing.

Various virtualization technologies contribute to the overall picture in
different ways: machine

virtualization, with its capability to enable consolidation of multiple
under?utilized servers with

heterogeneous software and operating systems (OSes), and its capability to
live?-migrate a

fully operating virtual machine (VM) with a very short downtime, enables
novel and dynamic

ways to manage physical servers; OS-?level virtualization (i.e.,
containerization), with its

capability to isolate multiple user?-space environments and to allow for
their co?existence within

the same OS kernel, promises to provide many of the advantages of machine
virtualization

with high levels of responsiveness and performance; I/O Virtualization
allows physical

NICs/HBAs to take traffic from multiple VMs or containers; network
virtualization, with its

capability to create logical network overlays that are independent of the
underlying physical

topology and IP addressing, provides the fundamental ground on top of which
evolved

network services can be realized with an unprecedented level of dynamicity
and flexibility; the

increasingly adopted paradigm of Software-?Defined Networking (SDN)
 promises to extend

this flexibility to the control and data planes of network paths.

Publication

Accepted papers will be published in a Springer LNCS proceedings volume.


Topics of Interest

The VHPC program committee solicits original, high-quality submissions
related to

virtualization across the entire software stack with a special focus on the
intersection of HPC

and the cloud.

Major Topics

- Virtualization in supercomputing environments, HPC clusters, HPC in the
cloud and grids
- OS-level virtualization and containers (Docker, rkt, Singularity,
Shifter, i.a.)
- Lightweight/specialized operating systems, unikernels
- Optimizations of virtual machine monitor platforms and hypervisors
- Hypervisor support for heterogenous resources (GPUs, co-processors,
FPGAs, etc.)
- Virtualization support for emerging memory technologies

- Virtualization in enterprise HPC and microvisors
- Software defined networks and network virtualization
- Management, deployment of virtualized environments and orchestration
(Kubernetes i.a.),
- Workflow-pipeline container-based composability
- Performance measurement, modelling and monitoring of virtualized/cloud
workloads
- Virtualization in data intensive computing and Big Data processing - HPC
convergence
- Adaptation of HPC technologies in the cloud (high performance networks,
RDMA, etc.)

- ARM-based hypervisors, ARM virtualization extensions
- I/O virtualization and cloud based storage systems

- GPU, FPGA and many-core accelerator virtualization
- Job scheduling/control/policy and container placement in virtualized
environments
- Cloud reliability, fault-tolerance and high-availability
- QoS and SLA in virtualized environments
- IaaS platforms, cloud frameworks and APIs

- Large-scale virtualization in domains such as finance and government
- Energy-efficient and power-aware virtualization

- Container security

- Configuration management tools for containers (including CFEngine,
Puppet, i.a.)

- Emerging topics including multi-kernel approaches and,NUMA in hypervisors




The Workshop on Virtualization in High?-Performance Cloud Computing (VHPC)
aims to

bring together researchers and industrial practitioners facing the
challenges

posed by virtualization in order to foster discussion, collaboration,
mutual exchange

of knowledge and experience, enabling research to ultimately provide novel

solutions for virtualized computing systems of tomorrow.

The workshop will be one day in length, composed of 20 min paper
presentations, each

followed by 10 min discussion sections, plus lightning talks that are
limited to 5 minutes.

Presentations may be accompanied by interactive demonstrations.

Important Dates

February 28, 2017 - Abstract Submission Deadline

April 25, 2017 - Paper submission deadline

May 30, 2017 - Acceptance notification

June 22, 2017 - Workshop Day

June 25, 2017 - Camera-ready version due


Chair

Michael Alexander (chair), scaledinfra technologies, Austria

Anastassios Nanos (co-?chair), NTUA, Greece

Balazs Gerofi (co-?chair), ?RIKEN Advanced Institute for Computational
Science?, Japan


Program committee

Stergios Anastasiadis, University of Ioannina, Greece

Jakob Blomer, CERN, Europe

Ron Brightwell, Sandia National Laboratories, USA

Eduardo C?sar, Universidad Autonoma de Barcelona, Spain

Julian Chesterfield, OnApp, UK

Stephen Crago, USC ISI, USA

Christoffer Dall, Columbia University, USA

Patrick Dreher, MIT, USA

Robert Futrick, Cycle Computing, USA

Maria Girone, CERN, Europe

Kyle Hale, Northwestern University, USA

Romeo Kinzler, IBM, Switzerland

Brian Kocoloski, University of Pittsburgh, USA

Nectarios Koziris, National Technical University of Athens, Greece

John Lange, University of Pittsburgh, USA

Che-Rung Lee, National Tsing Hua University, Taiwan

Giuseppe Lettieri, University of Pisa, Italy

Qing Liu, Oak Ridge National Laboratory, USA

Nikos Parlavantzas, IRISA, France

Kevin Pedretti, Sandia National Laboratories, USA

Amer Qouneh, University of Florida, USA

Carlos Rea?o, Technical University of Valencia, Spain

Thomas Ryd, CFEngine, Norway

Josh Simons, VMWare, USA

Borja Sotomayor, University of Chicago, USA

Craig Stewart, Indiana University, USA

Anata Tiwari, San Diego Supercomputer Center, USA

Kurt Tutschku, Blekinge Institute of Technology, Sweden

Yasuhiro Watashiba, Osaka University, Japan

Nicholas Wright, Lawrence Berkeley National Laboratory, USA

Chao-Tung Yang, Tunghai University, Taiwan


Paper Submission-Publication

Papers submitted to the workshop will be reviewed by at least two

members of the program committee and external reviewers. Submissions

should include abstract, key words, the e-mail address of the

corresponding author, and must not exceed 10 pages, including tables

and figures at a main font size no smaller than 11 point. Submission

of a paper should be regarded as a commitment that, should the paper

be accepted, at least one of the authors will register and attend the

conference to present the work. Accepted papers will be published in a

Springer LNCS volume. .

The format must be according to the Springer LNCS Style. Initial

submissions are in PDF; authors of accepted papers will be requested

to provide source files.

Format Guidelines:

ftp://ftp.springer.de/pub/tex/latex/llncs/latex2e/llncs2e.zip

Abstract, Paper Submission Link:

https://edas.info/newPaper.php?c=23179



Lightning Talks

Lightning Talks are non-paper track, synoptical in nature and are strictly
limited to 5 minutes.

They can be used to gain early feedback on ongoing research, for
demonstrations, to present

research results, early research ideas, perspectives and positions of
interest to the community.

Submit abstract via the main submission link.


General Information

The workshop is one day in length and will be held in conjunction with the
International

Supercomputing Conference - High Performance (ISC) 2017, June 18-22,
Frankfurt,

Germany.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;https://www.redhat.com/archives/libvirt-users/attachments/20170131/4024ae3d/attachment.html&gt;


------------------------------

_______________________________________________
libvirt-users mailing list
libvirt-users@redhat.com
https://www.redhat.com/mailman/listinfo/libvirt-users

End of libvirt-users Digest, Vol 85, Issue 24
*********************************************


   


[Attachment #3 (text/html)]

&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;div style="color:#000; background-color:#fff; \
font-family:HelveticaNeue, Helvetica Neue, Helvetica, Arial, Lucida Grande, \
Sans-Serif;font-size:12px"&gt;&lt;div \
id="yui_3_16_0_ym19_1_1485864721720_13431"&gt;Hi,&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1485864721720_13432"&gt;&lt;br \
id="yui_3_16_0_ym19_1_1485864721720_13433"&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1485864721720_13434"&gt;I am using Libvirt (1.2.2) on RHEL6. I \
want to use the compatible virt-manager for it.&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1485864721720_13435"&gt;&lt;br \
id="yui_3_16_0_ym19_1_1485864721720_13436"&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1485864721720_13437"&gt;When I tried 1.4.0 and 1.3.0 there is an \
insatllation issue on RHLE6 for gtk3.  Is there any virt-manager version which \
works with 1.2.2 and RHLE6 too.&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1485864721720_13437"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1485864721720_13437"&gt;Also what is the compatibility matrix for \
libvirt and virt-manager version.&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1485864721720_13437"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1485864721720_13438"&gt;&lt;br \
id="yui_3_16_0_ym19_1_1485864721720_13439"&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1485864721720_13440"&gt;Thanks &amp; Regards&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1485864721720_13441"&gt;Abhishek&lt;/div&gt;&lt;div class="qtdSeparateBR" \
id="yui_3_16_0_ym19_1_1485864721720_13508"&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="yahoo_quoted" \
id="yui_3_16_0_ym19_1_1485864721720_13513" style="display: block;"&gt;  &lt;div \
style="font-family: HelveticaNeue, Helvetica Neue, Helvetica, Arial, Lucida Grande, \
Sans-Serif; font-size: 12px;" id="yui_3_16_0_ym19_1_1485864721720_13512"&gt; &lt;div \
style="font-family: HelveticaNeue, Helvetica Neue, Helvetica, Arial, Lucida Grande, \
Sans-Serif; font-size: 16px;" id="yui_3_16_0_ym19_1_1485864721720_13511"&gt; &lt;div \
dir="ltr" id="yui_3_16_0_ym19_1_1485864721720_13510"&gt; &lt;font size="2" face="Arial" \
id="yui_3_16_0_ym19_1_1485864721720_13509"&gt; &lt;hr size="1"&gt; &lt;b&gt;&lt;span \
style="font-weight:bold;"&gt;From:&lt;/span&gt;&lt;/b&gt; "libvirt-users-request@redhat.com" \
&lt;libvirt-users-request@redhat.com&gt;&lt;br&gt; &lt;b&gt;&lt;span style="font-weight: \
bold;"&gt;To:&lt;/span&gt;&lt;/b&gt; libvirt-users@redhat.com &lt;br&gt; &lt;b&gt;&lt;span style="font-weight: \
bold;"&gt;Sent:&lt;/span&gt;&lt;/b&gt; Wednesday, 1 February 2017 3:12 AM&lt;br&gt; &lt;b&gt;&lt;span \
style="font-weight: bold;"&gt;Subject:&lt;/span&gt;&lt;/b&gt; libvirt-users Digest, Vol 85, Issue \
24&lt;br&gt; &lt;/font&gt; &lt;/div&gt; &lt;div class="y_msg_container" \
id="yui_3_16_0_ym19_1_1485864721720_13515"&gt;&lt;br&gt;Send libvirt-users mailing list \
submissions to&lt;br&gt;    &lt;a ymailto="mailto:libvirt-users@redhat.com" \
href="mailto:libvirt-users@redhat.com" \
id="yui_3_16_0_ym19_1_1485864721720_13706"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;&lt;br&gt;To \
subscribe or unsubscribe via the World Wide Web, visit&lt;br&gt;    &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" target="_blank" \
id="yui_3_16_0_ym19_1_1485864721720_13679"&gt;https://www.redhat.com/mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;or, \
via email, send a message with subject or body 'help' to&lt;br&gt;    &lt;a \
ymailto="mailto:libvirt-users-request@redhat.com" \
href="mailto:libvirt-users-request@redhat.com" \
id="yui_3_16_0_ym19_1_1485864721720_13517"&gt;libvirt-users-request@redhat.com&lt;/a&gt;&lt;br&gt;&lt;br&gt;You \
can reach the person managing the list at&lt;br&gt;    &lt;a \
ymailto="mailto:libvirt-users-owner@redhat.com" \
href="mailto:libvirt-users-owner@redhat.com" \
id="yui_3_16_0_ym19_1_1485864721720_13681"&gt;libvirt-users-owner@redhat.com&lt;/a&gt;&lt;br&gt;&lt;br&gt;When \
replying, please edit your Subject line so it is more specific&lt;br&gt;than "Re: Contents \
of libvirt-users digest..."&lt;br&gt;&lt;br&gt;&lt;br&gt;Today's Topics:&lt;br&gt;&lt;br&gt;   1. CfP 12th \
Virtualization in High?-Performance Cloud Computing&lt;br&gt;      Workshop \
(VHPC '17) (VHPC 17)&lt;br&gt;&lt;br&gt;&lt;br&gt;----------------------------------------------------------------------&lt;br&gt;&lt;br&gt;Message: \
1&lt;br&gt;Date: Tue, 31 Jan 2017 22:42:50 +0100&lt;br&gt;From: VHPC 17 &lt;&lt;a \
ymailto="mailto:vhpc.dist@gmail.com" \
href="mailto:vhpc.dist@gmail.com"&gt;vhpc.dist@gmail.com&lt;/a&gt;&gt;&lt;br&gt;To: &lt;a \
ymailto="mailto:libvirt-users@redhat.com" \
href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;Subject: \
[libvirt-users] CfP 12th Virtualization in High?-Performance&lt;br&gt;    \
Cloud Computing Workshop (VHPC '17)&lt;br&gt;Message-ID:&lt;br&gt;    \
&lt;CAF05tLM1bPf=R6rF7WF+EgAJoJxB6=&lt;a \
ymailto="mailto:U3QMzczJRRxozydGu9qQ@mail.gmail.com" \
href="mailto:U3QMzczJRRxozydGu9qQ@mail.gmail.com"&gt;U3QMzczJRRxozydGu9qQ@mail.gmail.com&lt;/a&gt;&gt;&lt;br&gt;Content-Type: \
text/plain; charset="utf-8"&lt;br&gt;&lt;br&gt;====================================================================&lt;br&gt;&lt;br&gt;CALL \
FOR PAPERS&lt;br&gt;&lt;br&gt;&lt;br&gt;12th Workshop on Virtualization in High?-Performance Cloud \
Computing  (VHPC&lt;br&gt;'17)&lt;br&gt;&lt;br&gt;held in conjunction with the International \
Supercomputing Conference - High&lt;br&gt;Performance,&lt;br&gt;&lt;br&gt;June 18-22, 2017, Frankfurt, \
Germany.&lt;br&gt;&lt;br&gt;(Springer LNCS \
Proceedings)&lt;br&gt;&lt;br&gt;====================================================================&lt;br&gt;&lt;br&gt;Date: \
June 22, 2017&lt;br&gt;&lt;br&gt;Workshop URL: &lt;a href="http://vhpc.org/" \
target="_blank"&gt;http://vhpc.org&lt;/a&gt;&lt;br&gt;&lt;br&gt;Abstract Submission Deadline: February 28, \
2017&lt;br&gt;&lt;br&gt;Paper Submission Deadline: April 25, 2017  (Springer \
LNCS)&lt;br&gt;&lt;br&gt;Abstract/Paper Submission Link: &lt;a \
href="https://edas.info/newPaper.php?c=23179" \
target="_blank"&gt;https://edas.info/newPaper.php?c=23179&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;Call for \
Papers&lt;br&gt;&lt;br&gt;Virtualization technologies constitute a key enabling factor for \
flexible&lt;br&gt;resource management&lt;br&gt;&lt;br&gt;in modern data centers, and particularly in \
cloud environments. Cloud&lt;br&gt;providers need to&lt;br&gt;&lt;br&gt;manage complex infrastructures \
in a seamless fashion to support the highly&lt;br&gt;dynamic and&lt;br&gt;&lt;br&gt;heterogeneous \
workloads and hosted applications customers deploy.&lt;br&gt;Similarly, \
HPC&lt;br&gt;&lt;br&gt;environments have been increasingly adopting techniques that \
enable&lt;br&gt;flexible management of&lt;br&gt;&lt;br&gt;vast computing and networking resources, \
close to marginal provisioning&lt;br&gt;cost, which is&lt;br&gt;&lt;br&gt;unprecedented in the history \
of scientific and commercial computing.&lt;br&gt;&lt;br&gt;Various virtualization technologies \
contribute to the overall picture in&lt;br&gt;different ways: \
machine&lt;br&gt;&lt;br&gt;virtualization, with its capability to enable consolidation of \
multiple&lt;br&gt;under?utilized servers with&lt;br&gt;&lt;br&gt;heterogeneous software and operating \
systems (OSes), and its capability to&lt;br&gt;live?-migrate a&lt;br&gt;&lt;br&gt;fully operating \
virtual machine (VM) with a very short downtime, enables&lt;br&gt;novel and \
dynamic&lt;br&gt;&lt;br&gt;ways to manage physical servers; OS-?level virtualization \
(i.e.,&lt;br&gt;containerization), with its&lt;br&gt;&lt;br&gt;capability to isolate multiple \
user?-space environments and to allow for&lt;br&gt;their co?existence within&lt;br&gt;&lt;br&gt;the \
same OS kernel, promises to provide many of the advantages of \
machine&lt;br&gt;virtualization&lt;br&gt;&lt;br&gt;with high levels of responsiveness and performance; \
I/O Virtualization&lt;br&gt;allows physical&lt;br&gt;&lt;br&gt;NICs/HBAs to take traffic from multiple \
VMs or containers; network&lt;br&gt;virtualization, with its&lt;br&gt;&lt;br&gt;capability to create \
logical network overlays that are independent of the&lt;br&gt;underlying \
physical&lt;br&gt;&lt;br&gt;topology and IP addressing, provides the fundamental ground on top of \
which&lt;br&gt;evolved&lt;br&gt;&lt;br&gt;network services can be realized with an unprecedented level \
of dynamicity&lt;br&gt;and flexibility; the&lt;br&gt;&lt;br&gt;increasingly adopted paradigm of \
Software-?Defined Networking (SDN)&lt;br&gt; promises to extend&lt;br&gt;&lt;br&gt;this flexibility to \
the control and data planes of network paths.&lt;br&gt;&lt;br&gt;Publication&lt;br&gt;&lt;br&gt;Accepted \
papers will be published in a Springer LNCS proceedings volume.&lt;br&gt;&lt;br&gt;&lt;br&gt;Topics of \
Interest&lt;br&gt;&lt;br&gt;The VHPC program committee solicits original, high-quality \
submissions&lt;br&gt;related to&lt;br&gt;&lt;br&gt;virtualization across the entire software stack with \
a special focus on the&lt;br&gt;intersection of HPC&lt;br&gt;&lt;br&gt;and the cloud.&lt;br&gt;&lt;br&gt;Major \
Topics&lt;br&gt;&lt;br&gt;- Virtualization in supercomputing environments, HPC clusters, HPC in \
the&lt;br&gt;cloud and grids&lt;br&gt;- OS-level virtualization and containers (Docker, rkt, \
Singularity,&lt;br&gt;Shifter, i.a.)&lt;br&gt;- Lightweight/specialized operating systems, \
unikernels&lt;br&gt;- Optimizations of virtual machine monitor platforms and \
hypervisors&lt;br&gt;- Hypervisor support for heterogenous resources (GPUs, \
co-processors,&lt;br&gt;FPGAs, etc.)&lt;br&gt;- Virtualization support for emerging memory \
technologies&lt;br&gt;&lt;br&gt;- Virtualization in enterprise HPC and microvisors&lt;br&gt;- Software \
defined networks and network virtualization&lt;br&gt;- Management, deployment of \
virtualized environments and orchestration&lt;br&gt;(Kubernetes i.a.),&lt;br&gt;- \
Workflow-pipeline container-based composability&lt;br&gt;- Performance measurement, \
modelling and monitoring of virtualized/cloud&lt;br&gt;workloads&lt;br&gt;- Virtualization in \
data intensive computing and Big Data processing - HPC&lt;br&gt;convergence&lt;br&gt;- Adaptation \
of HPC technologies in the cloud (high performance networks,&lt;br&gt;RDMA, etc.)&lt;br&gt;&lt;br&gt;- \
ARM-based hypervisors, ARM virtualization extensions&lt;br&gt;- I/O virtualization and \
cloud based storage systems&lt;br&gt;&lt;br&gt;- GPU, FPGA and many-core accelerator \
virtualization&lt;br&gt;- Job scheduling/control/policy and container placement in \
virtualized&lt;br&gt;environments&lt;br&gt;- Cloud reliability, fault-tolerance and \
high-availability&lt;br&gt;- QoS and SLA in virtualized environments&lt;br&gt;- IaaS platforms, \
cloud frameworks and APIs&lt;br&gt;&lt;br&gt;- Large-scale virtualization in domains such as \
finance and government&lt;br&gt;- Energy-efficient and power-aware virtualization&lt;br&gt;&lt;br&gt;- \
Container security&lt;br&gt;&lt;br&gt;- Configuration management tools for containers (including \
CFEngine,&lt;br&gt;Puppet, i.a.)&lt;br&gt;&lt;br&gt;- Emerging topics including multi-kernel approaches \
and,NUMA in hypervisors&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;The Workshop on Virtualization in \
High?-Performance Cloud Computing (VHPC)&lt;br&gt;aims to&lt;br&gt;&lt;br&gt;bring together researchers \
and industrial practitioners facing the&lt;br&gt;challenges&lt;br&gt;&lt;br&gt;posed by virtualization \
in order to foster discussion, collaboration,&lt;br&gt;mutual exchange&lt;br&gt;&lt;br&gt;of knowledge \
and experience, enabling research to ultimately provide novel&lt;br&gt;&lt;br&gt;solutions for \
virtualized computing systems of tomorrow.&lt;br&gt;&lt;br&gt;The workshop will be one day in \
length, composed of 20 min paper&lt;br&gt;presentations, each&lt;br&gt;&lt;br&gt;followed by 10 min \
discussion sections, plus lightning talks that are&lt;br&gt;limited to 5 \
minutes.&lt;br&gt;&lt;br&gt;Presentations may be accompanied by interactive \
demonstrations.&lt;br&gt;&lt;br&gt;Important Dates&lt;br&gt;&lt;br&gt;February 28, 2017 - Abstract Submission \
Deadline&lt;br&gt;&lt;br&gt;April 25, 2017 - Paper submission deadline&lt;br&gt;&lt;br&gt;May 30, 2017 - \
Acceptance notification&lt;br&gt;&lt;br&gt;June 22, 2017 - Workshop Day&lt;br&gt;&lt;br&gt;June 25, 2017 - \
Camera-ready version due&lt;br&gt;&lt;br&gt;&lt;br&gt;Chair&lt;br&gt;&lt;br&gt;Michael Alexander (chair), \
scaledinfra technologies, Austria&lt;br&gt;&lt;br&gt;Anastassios Nanos (co-?chair), NTUA, \
Greece&lt;br&gt;&lt;br&gt;Balazs Gerofi (co-?chair), ?RIKEN Advanced Institute for \
Computational&lt;br&gt;Science?, Japan&lt;br&gt;&lt;br&gt;&lt;br&gt;Program committee&lt;br&gt;&lt;br&gt;Stergios \
Anastasiadis, University of Ioannina, Greece&lt;br&gt;&lt;br&gt;Jakob Blomer, CERN, \
Europe&lt;br&gt;&lt;br&gt;Ron Brightwell, Sandia National Laboratories, USA&lt;br&gt;&lt;br&gt;Eduardo C?sar, \
Universidad Autonoma de Barcelona, Spain&lt;br&gt;&lt;br&gt;Julian Chesterfield, OnApp, \
UK&lt;br&gt;&lt;br&gt;Stephen Crago, USC ISI, USA&lt;br&gt;&lt;br&gt;Christoffer Dall, Columbia University, \
USA&lt;br&gt;&lt;br&gt;Patrick Dreher, MIT, USA&lt;br&gt;&lt;br&gt;Robert Futrick, Cycle Computing, \
USA&lt;br&gt;&lt;br&gt;Maria Girone, CERN, Europe&lt;br&gt;&lt;br&gt;Kyle Hale, Northwestern University, \
USA&lt;br&gt;&lt;br&gt;Romeo Kinzler, IBM, Switzerland&lt;br&gt;&lt;br&gt;Brian Kocoloski, University of \
Pittsburgh, USA&lt;br&gt;&lt;br&gt;Nectarios Koziris, National Technical University of Athens, \
Greece&lt;br&gt;&lt;br&gt;John Lange, University of Pittsburgh, USA&lt;br&gt;&lt;br&gt;Che-Rung Lee, National \
Tsing Hua University, Taiwan&lt;br&gt;&lt;br&gt;Giuseppe Lettieri, University of Pisa, \
Italy&lt;br&gt;&lt;br&gt;Qing Liu, Oak Ridge National Laboratory, USA&lt;br&gt;&lt;br&gt;Nikos Parlavantzas, \
IRISA, France&lt;br&gt;&lt;br&gt;Kevin Pedretti, Sandia National Laboratories, USA&lt;br&gt;&lt;br&gt;Amer \
Qouneh, University of Florida, USA&lt;br&gt;&lt;br&gt;Carlos Rea?o, Technical University of \
Valencia, Spain&lt;br&gt;&lt;br&gt;Thomas Ryd, CFEngine, Norway&lt;br&gt;&lt;br&gt;Josh Simons, VMWare, \
USA&lt;br&gt;&lt;br&gt;Borja Sotomayor, University of Chicago, USA&lt;br&gt;&lt;br&gt;Craig Stewart, Indiana \
University, USA&lt;br&gt;&lt;br&gt;Anata Tiwari, San Diego Supercomputer Center, USA&lt;br&gt;&lt;br&gt;Kurt \
Tutschku, Blekinge Institute of Technology, Sweden&lt;br&gt;&lt;br&gt;Yasuhiro Watashiba, Osaka \
University, Japan&lt;br&gt;&lt;br&gt;Nicholas Wright, Lawrence Berkeley National Laboratory, \
USA&lt;br&gt;&lt;br&gt;Chao-Tung Yang, Tunghai University, Taiwan&lt;br&gt;&lt;br&gt;&lt;br&gt;Paper \
Submission-Publication&lt;br&gt;&lt;br&gt;Papers submitted to the workshop will be reviewed by at \
least two&lt;br&gt;&lt;br&gt;members of the program committee and external reviewers. \
Submissions&lt;br&gt;&lt;br&gt;should include abstract, key words, the e-mail address of \
the&lt;br&gt;&lt;br&gt;corresponding author, and must not exceed 10 pages, including \
tables&lt;br&gt;&lt;br&gt;and figures at a main font size no smaller than 11 point. \
Submission&lt;br&gt;&lt;br&gt;of a paper should be regarded as a commitment that, should the \
paper&lt;br&gt;&lt;br&gt;be accepted, at least one of the authors will register and attend \
the&lt;br&gt;&lt;br&gt;conference to present the work. Accepted papers will be published in \
a&lt;br&gt;&lt;br&gt;Springer LNCS volume. .&lt;br&gt;&lt;br&gt;The format must be according to the Springer \
LNCS Style. Initial&lt;br&gt;&lt;br&gt;submissions are in PDF; authors of accepted papers will be \
requested&lt;br&gt;&lt;br&gt;to provide source files.&lt;br&gt;&lt;br&gt;Format Guidelines:&lt;br&gt;&lt;br&gt;&lt;a \
href="ftp://ftp.springer.de/pub/tex/latex/llncs/latex2e/llncs2e.zip" \
target="_blank"&gt;ftp://ftp.springer.de/pub/tex/latex/llncs/latex2e/llncs2e.zip&lt;/a&gt;&lt;br&gt;&lt;br&gt;Abstract, \
Paper Submission Link:&lt;br&gt;&lt;br&gt;&lt;a href="https://edas.info/newPaper.php?c=23179" \
target="_blank"&gt;https://edas.info/newPaper.php?c=23179&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;Lightning \
Talks&lt;br&gt;&lt;br&gt;Lightning Talks are non-paper track, synoptical in nature and are \
strictly&lt;br&gt;limited to 5 minutes.&lt;br&gt;&lt;br&gt;They can be used to gain early feedback on \
ongoing research, for&lt;br&gt;demonstrations, to present&lt;br&gt;&lt;br&gt;research results, early \
research ideas, perspectives and positions of&lt;br&gt;interest to the \
community.&lt;br&gt;&lt;br&gt;Submit abstract via the main submission link.&lt;br&gt;&lt;br&gt;&lt;br&gt;General \
Information&lt;br&gt;&lt;br&gt;The workshop is one day in length and will be held in conjunction \
with the&lt;br&gt;International&lt;br&gt;&lt;br&gt;Supercomputing Conference - High Performance (ISC) \
2017, June 18-22,&lt;br&gt;Frankfurt,&lt;br&gt;&lt;br&gt;Germany.&lt;br&gt;-------------- next part \
--------------&lt;br&gt;An HTML attachment was scrubbed...&lt;br&gt;URL: &lt;&lt;a \
href="https://www.redhat.com/archives/libvirt-users/attachments/20170131/4024ae3d/attachment.html" \
target="_blank"&gt;https://www.redhat.com/archives/libvirt-users/attachments/20170131/402 \
4ae3d/attachment.html&lt;/a&gt;&gt;&lt;br&gt;&lt;br&gt;------------------------------&lt;br&gt;&lt;br&gt;_______________________________________________&lt;br&gt;libvirt-users \
mailing list&lt;br&gt;&lt;a ymailto="mailto:libvirt-users@redhat.com" \
href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt;&lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" \
target="_blank"&gt;https://www.redhat.com/mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;&lt;br&gt;End \
of libvirt-users Digest, Vol 85, Issue \
24&lt;br&gt;*********************************************&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt;  \
&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;



</body></email><email><emailId>20170206173229</emailId><senderName>Peter Steele</senderName><senderEmail>pwsteele@gmail.com</senderEmail><timestampReceived>2017-02-06 17:32:29-0400</timestampReceived><subject>[libvirt-users] Real time threads don't work in libvirt containers under CentOS 7.3</subject><body>

We've been using libvirt based containers under CentOS 7 and everything 
has been working fine. One application we run in our containers is ctdb, 
which uses SCHED_FIFO (real time) threads. This has been working without 
problems until our recent upgrade to CentOS 7.3. For some reason, ctdb 
is no longer able to create real time threads, and I've tried a simple 
program myself that confirms this. The same program works fine on the 
hypervisor so I know the kernel supports real time. Does anyone know 
what may have changed in CentOS 7.3 that breaks real time threads in 
libvirt containers?

This is the simple test program I created to verify the real time 
threads are failing. This same program works in a libvirt container in 
CentOS 7.2.

#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;pthread.h&gt;

pthread_t test_thread;

void *test(void *arg)
{
     printf("Starting thread\n");
     sleep(1);
     printf("Thread complete\n");
     return 0;
}


int main(int argc, char *argv[])
{
     int rc;
     printf("Starting main\n");
     struct sched_param tsparam;
     pthread_attr_t tattr;
     memset(&amp;tsparam, 0, sizeof(tsparam));
     pthread_attr_init(&amp;tattr);
     pthread_attr_setinheritsched(&amp;tattr, PTHREAD_EXPLICIT_SCHED);
     pthread_attr_setschedpolicy(&amp;tattr, SCHED_FIFO);
     tsparam.sched_priority = sched_get_priority_max(SCHED_FIFO) - 7;
     pthread_attr_setschedparam(&amp;tattr, &amp;tsparam);
     if ((rc = pthread_create(&amp;test_thread, &amp;tattr, test, NULL)) != 0) {
         printf("Unable to start rt thread\n");
     }
     return 0;
}

</body></email><email><emailId>20170203023024</emailId><senderName>ravi mh</senderName><senderEmail>ravi.zombie@gmail.com</senderEmail><timestampReceived>2017-02-03 02:30:24-0400</timestampReceived><subject>[libvirt-users] accessing USB as storage device through lxc container.</subject><body>

Hi all,

I am not able to access USB as storage device in the lxc container.
Having tried to pass the usb device with the product and vendor id, not
able to see the device mounted in the lxc file system.

However, they are seen as char devices in the container at the location.
There is no issue of ACL, as the capabilities restrictions have been
dropped.

Has anyone successfully mounted the storage device in the libvirt.  Having
gone through the libvirt documentation, couldnt find further information of
enabling the usb as storage device.  Any pointers towards that would be
useful.


Host OS:

IR800-GOS-1:~# lsusb
Bus 001 Device 003: ID 8644:800b
Bus 001 Device 001: ID 1d6b:0002
Bus 002 Device 001: ID 1d6b:0001
IR800-GOS-1:~#

Lxc app container:

root@ir800-lxc:/mnt/usb# ls -la  /dev/bus/usb/001/003
*crwx-*-----    1 root     root      189,   2 Feb  3 01:44
/dev/bus/usb/001/003



----------libvirt xml snippet ------------

    &lt;hostdev mode='subsystem' type='usb' managed='yes'&gt;
      &lt;source&gt;
        &lt;vendor id='0x8644'/&gt;
        &lt;product id='0x800b'/&gt;
      &lt;/source&gt;
    &lt;/hostdev&gt;

-----------------------------
while changing the mode from subsystem to capabilities, it issues error for
validating against the schema.

---------------while changing the hostdev mode='capabilities'----------

virsh # edit n01_1
*error: XML document failed to validate against schema: Unable to validate
doc against /usr/share/libvirt/schemas/domain.rng*
Extra element devices in interleave
Element domain failed to validate content

Failed. Try again? [y,n,i,f,?]:
error: XML document failed to validate against schema: Unable to validate
doc against /usr/share/libvirt/schemas/domain.rng

--------------------------------------------


Regards,
*Ravi*

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;Hi all,&lt;br&gt;&lt;br&gt;&lt;/div&gt;I am not able to access USB as storage \
device in the lxc container.&lt;br&gt;&lt;/div&gt;&lt;div&gt;Having tried to pass the usb device with \
the product and vendor id, not able to see the device mounted in the lxc file \
system.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;However, they are seen as char devices in the container at \
the location. There is no issue of ACL, as the capabilities restrictions have been \
dropped.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Has anyone successfully mounted the storage device in the \
libvirt.   Having gone through the libvirt documentation, couldnt find further \
information of enabling the usb as storage device.   Any pointers towards that would \
be useful.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Host OS:&lt;br&gt;&lt;br&gt;&lt;div \
style="margin-left:40px"&gt;IR800-GOS-1:~# lsusb&lt;br&gt;Bus 001 Device 003: ID \
8644:800b&lt;br&gt;Bus 001 Device 001: ID 1d6b:0002&lt;br&gt;Bus 002 Device 001: ID \
1d6b:0001&lt;br&gt;IR800-GOS-1:~# &lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Lxc app container:&lt;br&gt;&lt;br&gt;&lt;div \
style="margin-left:40px"&gt;root@ir800-lxc:/mnt/usb# ls -la   /dev/bus/usb/001/003 \
&lt;br&gt;&lt;b&gt;crwx-&lt;/b&gt;-----       1 root         root           189,     2 Feb   3 01:44 \
/dev/bus/usb/001/003&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;----------libvirt xml \
snippet ------------&lt;br&gt;&lt;br&gt;&lt;div&gt;       &lt;hostdev mode='subsystem' \
type='usb' managed='yes'&gt;&lt;br&gt;           &lt;source&gt;             \
&lt;br&gt;               &lt;vendor id='0x8644'/&gt;                                \
&lt;br&gt;               &lt;product id='0x800b'/&gt;                               \
&lt;br&gt;           &lt;/source&gt;                             &lt;br&gt;       \
&lt;/hostdev&gt;                 \
&lt;br&gt;&lt;br&gt;-----------------------------&lt;br&gt;&lt;/div&gt;&lt;div&gt;while changing the mode from \
subsystem to capabilities, it issues error for validating against the \
schema.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;---------------while changing the hostdev \
mode='capabilities'----------&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;virsh # edit \
n01_1&lt;br&gt;&lt;b&gt;error: XML document failed to validate against schema: Unable to validate \
doc against /usr/share/libvirt/schemas/domain.rng&lt;/b&gt;&lt;br&gt;Extra element devices in \
interleave&lt;br&gt;Element domain failed to validate content&lt;br&gt;&lt;br&gt;Failed. Try again? \
[y,n,i,f,?]: &lt;br&gt;error: XML document failed to validate against schema: Unable to \
validate doc against \
/usr/share/libvirt/schemas/domain.rng&lt;br&gt;&lt;br&gt;--------------------------------------------&lt;br&gt;&lt;br&gt;&lt;br \
clear="all"&gt;&lt;div&gt;&lt;div class="gmail_signature"&gt;&lt;div dir="ltr"&gt;&lt;font face="georgia, \
serif" color="#444444"&gt;&lt;span \
style="font-family:arial,helvetica,sans-serif"&gt;Regards,&lt;/span&gt;&lt;/font&gt;&lt;font \
face="georgia, serif" color="#444444"&gt;&lt;font face="georgia, serif" \
color="#444444"&gt;&lt;i&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/i&gt;&lt;/font&gt;&lt;i&gt;&lt;b&gt;Ravi&lt;/b&gt;&lt;/i&gt;&lt;/font&gt;&lt;br&gt;&lt;font \
size="1"&gt;&lt;span style="font-family:tahoma,sans-serif"&gt;&lt;span \
style="color:rgb(0,0,153)"&gt;&lt;/span&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; \
&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170208165321</emailId><senderName>"Bashe, Joe"</senderName><senderEmail>joe@bashedev.com</senderEmail><timestampReceived>2017-02-08 16:53:21-0400</timestampReceived><subject>[libvirt-users] Trouble moving OVMF guest to new host</subject><body>

Hello,

I recently had to reinstall my operating system on my computer. I made a
backup of the entire partition beforehand onto an external drive. Now I am
trying to import a VM from that backup onto the newly installed system.

What I've done so far:

   - copied over the qcow2 disk image
   - copied over the XML config file
   - copied over the OVMF files under /usr/share/edk2.git/ovmf-x64/

I am getting this error whenever I try to boot the VM:

Error starting domain: operation failed: unable to find any master var
store for loader: /usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd

The file /usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd does exist.

Where would the "master var store" be located?

Thank you,

Joe
--
Joseph Bashe
Technical Director
Bashe Development
+1 (323) 999-1731

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Hello,&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;I recently had to reinstall my \
operating system on my computer. I made a backup of the entire partition beforehand \
onto an external drive. Now I am trying to import a VM from that backup onto the \
newly installed system.&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;What I've done so far:&lt;/div&gt;&lt;div \
class="gmail_default"&gt;&lt;ul&gt;&lt;li&gt;&lt;font face="arial, helvetica, sans-serif"&gt;copied over \
the qcow2 disk image&lt;/font&gt;&lt;/li&gt;&lt;li \
style="font-family:arial,helvetica,sans-serif"&gt;copied over  the XML config \
file&lt;/li&gt;&lt;li style="font-family:arial,helvetica,sans-serif"&gt;copied over the OVMF \
files under /usr/share/edk2.git/ovmf-x64/&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;I am getting this error whenever I try \
to boot the VM:&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default"&gt;&lt;font face="monospace, monospace"&gt;Error starting domain: \
operation failed: unable to find any master var store for loader: \
/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div \
class="gmail_default"&gt;&lt;font face="arial, helvetica, sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div \
class="gmail_default"&gt;&lt;font face="arial, helvetica, sans-serif"&gt;The file  \
&lt;/font&gt;&lt;span style="font-family:monospace,monospace"&gt;/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd&lt;/span&gt;&lt;span \
style="font-family:arial,helvetica,sans-serif"&gt;  does exist.  &lt;/span&gt;&lt;/div&gt;&lt;div \
class="gmail_default"&gt;&lt;span \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div \
class="gmail_default"&gt;&lt;span style="font-family:arial,helvetica,sans-serif"&gt;Where \
would the "master var store" be located?&lt;/span&gt;&lt;/div&gt;&lt;div \
class="gmail_default"&gt;&lt;font face="arial, helvetica, sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div \
class="gmail_default"&gt;&lt;span style="font-family:arial,helvetica,sans-serif"&gt;Thank \
you,&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div class="gmail_default"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;Joe&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;div class="gmail_signature"&gt;&lt;div \
dir="ltr"&gt;&lt;div&gt;&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div dir="ltr"&gt;&lt;font face="arial, helvetica, \
sans-serif"&gt;--&lt;br&gt;Joseph Bashe&lt;br&gt;Technical Director&lt;/font&gt;&lt;div&gt;&lt;font face="arial, \
helvetica, sans-serif"&gt;Bashe Development&lt;br&gt;+1 (323) \
999-1731&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;



</body></email><email><emailId>20170215051938</emailId><senderName>abhishek jain</senderName><senderEmail>abhish_jain@yahoo.com</senderEmail><timestampReceived>2017-02-15 05:19:38-0400</timestampReceived><subject>[libvirt-users] Error in libvirt-GUI</subject><body>

[Attachment #2 (multipart/alternative)]


Hi,
I am using libvirt --&gt; 0.10.2   and virt-manager --&gt; 0.9.0 version (RHEL 6).
Very rare I get following error message dialogue box. (Image is attached for the \
error dialogue box ) Error saysError polling connection:'qemu+ssh......' Internal \
error client socket is closed TraceBack (most recent calls)engine.py: 440   \
conn.tickconnection.py: 1433    self.hostinfo() = self.vmm.getinfo() Is it a problem \
with libvirt or with my environment Thanks in advance.
RegardsAbhishek


[Attachment #5 (text/html)]

&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;div style="color:#000; background-color:#fff; \
font-family:HelveticaNeue, Helvetica Neue, Helvetica, Arial, Lucida Grande, \
Sans-Serif;font-size:12px"&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487135386546_3617"&gt;Hi,&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487135386546_3618"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487135386546_3619"&gt;I am using libvirt --&gt; 0.10.2  and \
virt-manager --&gt; 0.9.0 version (RHEL 6).&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487135386546_3620"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487135386546_3621"&gt;Very rare I get following error message \
dialogue box. (Image is attached for the error dialogue box )&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487135386546_3621"&gt;&lt;b&gt;&lt;br \
id="yui_3_16_0_ym19_1_1487135386546_4231"&gt;&lt;/b&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487135386546_3621"&gt;&lt;b&gt;Error says&lt;/b&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487135386546_3621"&gt;&lt;b \
id="yui_3_16_0_ym19_1_1487135386546_4241"&gt;Error polling connection:'qemu+ssh......' \
Internal error client socket is closed&lt;/b&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487135386546_3621"&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487135386546_3621"&gt;&lt;b \
id="yui_3_16_0_ym19_1_1487135386546_4239"&gt;TraceBack (most recent calls)&lt;/b&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487135386546_3621" dir="ltr"&gt;&lt;b&gt;engine.py: 440 \
 conn.tick&lt;/b&gt;&lt;/div&gt;&lt;div id="yui_3_16_0_ym19_1_1487135386546_3621" dir="ltr"&gt;&lt;b \
id="yui_3_16_0_ym19_1_1487135386546_4240"&gt;connection.py: 1433   self.hostinfo() \
= self.vmm.getinfo()&lt;/b&gt;&lt;/div&gt;&lt;div id="yui_3_16_0_ym19_1_1487135386546_3621" \
dir="ltr"&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div id="yui_3_16_0_ym19_1_1487135386546_3621" \
dir="ltr"&gt;Is it a problem with libvirt or with my environment&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487135386546_3621" dir="ltr"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487135386546_3621" dir="ltr"&gt;Thanks in advance.&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487135386546_3621" dir="ltr"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487135386546_3621" dir="ltr"&gt;Regards&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487135386546_3621" dir="ltr"&gt;Abhishek&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487135386546_3621"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487135386546_3621"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487135386546_3621" dir="ltr"&gt;&lt;span \
style="font-size:11.0pt;font-family:"Calibri","sans-serif";mso-far \
east-font-family:Calibri;mso-fareast-theme-font:minor-latin;mso-bidi-font-family:"Times \
New Roman";color:#1F497D;mso-ansi-language:EN-US;mso-fareast-language:EN-US;mso-bidi-language:AR-SA" \
id="yui_3_16_0_ym19_1_1487135386546_3679"&gt;&lt;!--[if gte vml 1]&gt;&lt;v:shapetype \
id="_x0000_t75"  coordsize="21600,21600" o:spt="75" o:preferrelative="t" \
path="m@4@5l@4@11@9@11@9@5xe"  filled="f" stroked="f"&gt;
 &lt;v:stroke joinstyle="miter"/&gt;
 &lt;v:formulas&gt;
  &lt;v:f eqn="if lineDrawn pixelLineWidth 0"/&gt;
  &lt;v:f eqn="sum @0 1 0"/&gt;
  &lt;v:f eqn="sum 0 0 @1"/&gt;
  &lt;v:f eqn="prod @2 1 2"/&gt;
  &lt;v:f eqn="prod @3 21600 pixelWidth"/&gt;
  &lt;v:f eqn="prod @3 21600 pixelHeight"/&gt;
  &lt;v:f eqn="sum @0 0 1"/&gt;
  &lt;v:f eqn="prod @6 1 2"/&gt;
  &lt;v:f eqn="prod @7 21600 pixelWidth"/&gt;
  &lt;v:f eqn="sum @8 21600 0"/&gt;
  &lt;v:f eqn="prod @7 21600 pixelHeight"/&gt;
  &lt;v:f eqn="sum @10 21600 0"/&gt;
 &lt;/v:formulas&gt;
 &lt;v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/&gt;
 &lt;o:lock v:ext="edit" aspectratio="t"/&gt;
&lt;/v:shapetype&gt;&lt;v:shape id="Picture_x0020_2" o:spid="_x0000_i1025" type="#_x0000_t75"
 alt="" style='width:571.5pt;height:385.5pt'&gt;
 &lt;v:imagedata src="file:///C:\Users\abhishej\AppData\Local\Temp\msohtmlclip1\01\clip_image001.jpg"
  o:href="cid:image001.jpg@01D2822F.BF912540"/&gt;
&lt;/v:shape&gt;&lt;![endif]--&gt;&lt;!--[if \
!vml]--&gt;&lt;!--[endif]--&gt;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;


["err.jpg" (image/jpeg)]

</body></email><email><emailId>20170214071320</emailId><senderName>Blair Bethwaite</senderName><senderEmail>blair.bethwaite@gmail.com</senderEmail><timestampReceived>2017-02-14 07:13:20-0400</timestampReceived><subject>[libvirt-users] high memory guest issues - virsh start and QEMU_JOB_WAIT_TIME</subject><body>

Hi all,

In IRC last night Dan helpfully confirmed my analysis of an issue we are
seeing attempting to launch high memory KVM guests backed by hugepages...

In this case the guests have 240GB of memory allocated from two host NUMA
nodes to two guest NUMA nodes. The trouble is that allocating the hugepage
backed qemu process seems to take longer than the 30s QEMU_JOB_WAIT_TIME
and so libvirt then most unhelpfully kills the barely spawned guest. Dan
said there was currently no workaround available so I'm now looking at
building a custom libvirt which sets QEMU_JOB_WAIT_TIME=60s.

I have two related questions:
1) will this change have any untoward side-effects?
2) if not, then is there any reason not to change it in master until a
better solution comes along (or possibly better, alter
qemuDomainObjBeginJobInternal
to give a domain start job a little longer compared to other jobs)?

-- 
Cheers,
~Blairo

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi all,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In IRC last night Dan helpfully confirmed \
my analysis of an issue we are seeing attempting to launch high memory KVM guests \
backed by hugepages...&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In this case the guests have 240GB of \
memory allocated from two host NUMA nodes to two guest NUMA nodes. The trouble is \
that allocating the hugepage backed qemu process seems to take longer than the 30s  \
QEMU_JOB_WAIT_TIME and so libvirt then most unhelpfully kills the barely spawned \
guest. Dan said there was currently no workaround available so I'm now looking at \
building a custom libvirt which sets  \
QEMU_JOB_WAIT_TIME=60s.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I have two related \
questions:&lt;/div&gt;&lt;div&gt;1) will this change have any untoward side-effects?&lt;/div&gt;&lt;div&gt;2) \
if not, then is there any reason not to change it in master until a better solution \
comes along (or possibly better, alter  &lt;wbr&gt;qemuDomainObjBeginJobInternal to give a \
domain start job a little longer compared to other jobs)?&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- \
&lt;br&gt;&lt;div class="m_-5105112348117956699gmail_signature"&gt;Cheers,&lt;br&gt;~Blairo&lt;/div&gt; \
&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170215132512</emailId><senderName>Hans-Christoph Steiner</senderName><senderEmail>hans@guardianproject.info</senderEmail><timestampReceived>2017-02-15 13:25:12-0400</timestampReceived><subject>[libvirt-users] provisioning with vagrant-libvirt leaves .img file only readable by root</subject><body>


I'm using libvirt on Debian/stretch (testing) with vagrant and the
vagrant-libvirt plugin.  When I import a vagrant box (jessie64.box), the
resulting file permssions let anyone in the "kvm" group read the img.
But when I build upon that box, only root can read it:

-rw------- 1 root         root 20198785024 Sep 19 18:19
buildserver_default.img
-rwxr--r-- 1 libvirt-qemu kvm   2148663296 Sep  5 22:55
jessie64_vagrant_box_image_0.img

How can I control those file permissions as a regular user in the
libvirtd group?  I need to read that image in order to use qemu-img to
rebase and create a new vagrant box.  The current `vagrant package`
command only works with VirtualBox VMs, but its easy to make a .box if
you have read access to the libvirt QEMU .img file.

/etc/libvirt/storage/default.xml says:
  &lt;target&gt;
    &lt;path&gt;/var/lib/libvirt/images&lt;/path&gt;
    &lt;permissions&gt;
      &lt;mode&gt;0755&lt;/mode&gt;
    &lt;/permissions&gt;
  &lt;/target&gt;


You can find the context for this work here:
https://gitlab.com/fdroid/fdroidserver/issues/238

.hc

-- 
PGP fingerprint: EE66 20C7 136B 0D2C 456C  0A4D E9E2 8DEA 00AA 5556
https://pgp.mit.edu/pks/lookup?op=vindex&amp;search=0xE9E28DEA00AA5556

</body></email><email><emailId>20170206043306</emailId><senderName>akhilesh rawat</senderName><senderEmail>akhileshrawat007@gmail.com</senderEmail><timestampReceived>2017-02-06 04:33:06-0400</timestampReceived><subject>[libvirt-users] Why Guest does not retain Host CPU flags</subject><body>

hi ,

I am creating Guest by Libvirt tool " virt-install"  with cpu model as
host.

After Guest creation i see Guest Missing quite no of flags which Host was
having .

What could be the reason for this ?  I am expecting all flags of Host to e
present in Guest as well when choosing cpu model as host .

Guest :


processor    : 19
vendor_id    : GenuineIntel
cpu family    : 6
model        : 42
model name    : Intel Xeon E312xx (Sandy Bridge)
stepping    : 1
microcode    : 0x1
cpu MHz        : 1995.266
cache size    : 4096 KB
fpu        : yes
fpu_exception    : yes
cpuid level    : 13
wp        : yes
flags        : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca
cmov pat pse36 clflush mmx fxsr sse sse2 ss syscall nx pdpe1gb rdtscp lm
constant_tsc rep_good nopl eagerfpu pni pclmulqdq vmx ssse3 cx16 pcid
sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer aes xsave avx hypervisor
lahf_lm xsaveopt tpr_shadow vnmi flexpriority ept vpid
bogomips    : 4013.27
clflush size    : 64
cache_alignment    : 64
address sizes    : 46 bits physical, 48 bits virtual
power management:

HOst :

processor    : 23
vendor_id    : GenuineIntel
cpu family    : 6
model        : 45
model name    : Intel(R) Xeon(R) CPU E5-2620 0 @ 2.00GHz
stepping    : 7
microcode    : 0x710
cpu MHz        : 1400.000
cache size    : 15360 KB
physical id    : 1
siblings    : 12
core id        : 5
cpu cores    : 6
apicid        : 43
initial apicid    : 43
fpu        : yes
fpu_exception    : yes
cpuid level    : 13
wp        : yes
flags        : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca
cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx
pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl
xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor
ds_cpl vmx smx est tm2 ssse3 cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic
popcnt tsc_deadline_timer aes xsave avx lahf_lm ida arat epb pln pts dtherm
tpr_shadow vnmi flexpriority ept vpid xsaveopt
bogomips    : 4004.01
clflush size    : 64
cache_alignment    : 64
address sizes    : 46 bits physical, 48 bits virtual
power management:


br aki

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;hi ,&lt;br&gt;&lt;br&gt;&lt;/div&gt;I am creating Guest by \
Libvirt tool " virt-install"   with cpu model as host. &lt;br&gt;&lt;br&gt;&lt;/div&gt;After \
Guest creation i see Guest Missing quite no of flags which Host was having . \
&lt;br&gt;&lt;br&gt;&lt;/div&gt;What could be the reason for this ?   I am expecting all flags of Host \
to e present in Guest as well when choosing cpu model as host . &lt;br&gt;&lt;br&gt;&lt;/div&gt;Guest \
:&lt;br&gt;&lt;br&gt;&lt;br&gt;processor       : 19&lt;br&gt;vendor_id       : GenuineIntel&lt;br&gt;cpu family     \
: 6&lt;br&gt;model              : 42&lt;br&gt;model name       : Intel Xeon E312xx (Sandy \
Bridge)&lt;br&gt;stepping       : 1&lt;br&gt;microcode       : 0x1&lt;br&gt;cpu MHz              : \
1995.266&lt;br&gt;cache size       : 4096 KB&lt;br&gt;fpu              : yes&lt;br&gt;fpu_exception     \
: yes&lt;br&gt;cpuid level       : 13&lt;br&gt;wp              : yes&lt;br&gt;flags              : fpu \
vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr \
sse sse2 ss syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl eagerfpu pni \
pclmulqdq vmx ssse3 cx16 pcid sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer aes \
xsave avx hypervisor lahf_lm xsaveopt tpr_shadow vnmi flexpriority ept \
vpid&lt;br&gt;bogomips       : 4013.27&lt;br&gt;clflush size       : 64&lt;br&gt;cache_alignment       \
: 64&lt;br&gt;address sizes       : 46 bits physical, 48 bits virtual&lt;br&gt;power \
management:&lt;br&gt;&lt;br&gt;&lt;/div&gt;HOst :&lt;br&gt;&lt;br&gt;processor       : 23&lt;br&gt;vendor_id       : \
GenuineIntel&lt;br&gt;cpu family       : 6&lt;br&gt;model              : 45&lt;br&gt;model name       : \
Intel(R) Xeon(R) CPU E5-2620 0 @ 2.00GHz&lt;br&gt;stepping       : 7&lt;br&gt;microcode       : \
0x710&lt;br&gt;cpu MHz              : 1400.000&lt;br&gt;cache size       : 15360 KB&lt;br&gt;physical \
id       : 1&lt;br&gt;siblings       : 12&lt;br&gt;core id              : 5&lt;br&gt;cpu cores       : \
6&lt;br&gt;apicid              : 43&lt;br&gt;initial apicid       : 43&lt;br&gt;fpu              : \
yes&lt;br&gt;fpu_exception       : yes&lt;br&gt;cpuid level       : 13&lt;br&gt;wp              : \
yes&lt;br&gt;flags              : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca \
cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb \
rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc \
aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 cx16 \
xtpr pdcm pcid dca sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer aes xsave avx \
lahf_lm ida arat epb pln pts dtherm tpr_shadow vnmi flexpriority ept vpid \
xsaveopt&lt;br&gt;bogomips       : 4004.01&lt;br&gt;clflush size       : 64&lt;br&gt;cache_alignment    \
: 64&lt;br&gt;address sizes       : 46 bits physical, 48 bits virtual&lt;br&gt;power \
management:&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;br aki&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170217135206</emailId><senderName>Gionatan Danti</senderName><senderEmail>g.danti@assyoma.it</senderEmail><timestampReceived>2017-02-17 13:52:06-0400</timestampReceived><subject>[libvirt-users] Libvirt behavior when mixing io=native and cache=writeback</subject><body>

Hi all,
I write about libvirt inconsistent behavior when mixing io=native and 
cache=writeback. This post can be regarded as an extension, or 
clarification request, of BZ 1086704 
(https://bugzilla.redhat.com/show_bug.cgi?id=1086704)

On a fully upgraded CentOS6 x86-64 machine, starting a guest with 
io=native and cache=writeback is permitted: no errors are raised and the 
VM (qemu, really) silently use "io=threads" instead. A warning should be 
raised, but I find reasonable that the VM is permitted to run.

On a fully upgraded CentOS7 x86-64 machine, starting a guest with 
io=native and cache=writeback is *not* permitted: an error is raised and 
the guest is not started. While it is absolutely OK to alert the user 
about the configuration error, I feel the VM should be started as on 
CentOS6. Anyway, this is not a big problem when dealing with a single host.

A more concerning behavior is that when trying to migrate a guest from 
the very first CentOS6 machine, which starts and runs such a guest with 
io=native and cache=writeback without problems, to a CentOS7 host, live 
migration aborts with an error:

[root@source] virsh migrate Totem --live --copy-storage-all --persistent 
--verbose --unsafe qemu+ssh://root@172.31.255.11/system

error: unsupported configuration: native I/O needs either no disk cache 
or directsync cache mode, QEMU will fallback to aio=threads

This error persists even if the VM config file is changed to use 
"io=threads". Of course, the running image continue to have "io=native" 
on its parameters list, but it does not really honor the "io=native" 
directive, so I find strange that live migration can not proceed. I 
think it is very reasonable to raise an error, but such error should not 
block the live migration process.

In short: there is some method to live migrate a running VM configured 
with "io=native" (but which is really using "io=threads" internally) and 
"cache=writeback"?

Thanks.

-- 
Danti Gionatan
Supporto Tecnico
Assyoma S.r.l. - www.assyoma.it
email: g.danti@assyoma.it - info@assyoma.it
GPG public key ID: FF5F32A8

</body></email><email><emailId>20170217162131</emailId><senderName>Yunchih Chen</senderName><senderEmail>yunchih@csie.ntu.edu.tw</senderEmail><timestampReceived>2017-02-17 16:21:31-0400</timestampReceived><subject>[libvirt-users] "virsh list" ahngs</subject><body>

`virsh list` hangs on my server that hosts a bunch of VMs.
This might be due to the Debian upgrade I did on Feb 15, which upgrades 
`libvirt` from 2.4.0-1 to 3.0.0-2.
I have tried restarting libvirtd for a few times, without luck.

Attached below are some relevant logs; let me know if you need some more 
for debugging.
Thanks for your help!!

root@vm-host:~# uname -a
Linux vm-host 4.6.0-1-amd64 #1 SMP Debian 4.6.4-1 (2016-07-18) x86_64 
GNU/Linux

root@vm-host:~# apt-cache policy libvirt-daemon
libvirt-daemon:
   Installed: 3.0.0-2
   Candidate: 3.0.0-2
   Version table:
  *** 3.0.0-2 500
         500 http://debian.csie.ntu.edu.tw/debian testing/main amd64 
Packages
         100 /var/lib/dpkg/status

root@vm-host:~# strace -o /tmp/trace -e trace=network,file,poll virsh 
list  # hangs forever .....
^C
root@vm-host:~# tail -10 /tmp/trace
access("/etc/libvirt/libvirt.conf", F_OK) = 0
open("/etc/libvirt/libvirt.conf", O_RDONLY) = 5
access("/proc/vz", F_OK)                = -1 ENOENT (No such file or 
directory)
socket(AF_UNIX, SOCK_STREAM, 0)         = 5
connect(5, {sa_family=AF_UNIX, 
sun_path="/var/run/libvirt/libvirt-sock"}, 110) = 0
getsockname(5, {sa_family=AF_UNIX}, [128-&gt;2]) = 0
poll([{fd=5, events=POLLOUT}, {fd=6, events=POLLIN}], 2, -1) = 1 
([{fd=5, revents=POLLOUT}])
poll([{fd=5, events=POLLIN}, {fd=6, events=POLLIN}], 2, -1) = ? 
ERESTART_RESTARTBLOCK (Interrupted by signal)
--- SIGINT {si_signo=SIGINT, si_code=SI_KERNEL} ---
+++ killed by SIGINT +++

root@vm-host:~# lsof /var/run/libvirt/libvirt-sock # hangs too ...
^C

root@vm-host:~# LIBVIRT_DEBUG=1 virsh list
2017-02-17 15:58:36.126+0000: 18505: info : libvirt version: 3.0.0, 
package: 2 (Guido GÃ¼nther &lt;agx@sigxcpu.org&gt; Wed, 25 Jan 2017 07:04:08 
+0100)
2017-02-17 15:58:36.126+0000: 18505: info : hostname: vm-host
2017-02-17 15:58:36.126+0000: 18505: debug : virGlobalInit:386 : 
register drivers
2017-02-17 15:58:36.127+0000: 18505: debug : 
virRegisterConnectDriver:684 : driver=0x7f1e5aca2c40 name=Test
2017-02-17 15:58:36.127+0000: 18505: debug : 
virRegisterConnectDriver:695 : registering Test as driver 0
2017-02-17 15:58:36.127+0000: 18505: debug : 
virRegisterConnectDriver:684 : driver=0x7f1e5aca4ac0 name=OPENVZ
2017-02-17 15:58:36.127+0000: 18505: debug : 
virRegisterConnectDriver:695 : registering OPENVZ as driver 1
2017-02-17 15:58:36.127+0000: 18505: debug : 
virRegisterConnectDriver:684 : driver=0x7f1e5aca5260 name=VMWARE
2017-02-17 15:58:36.127+0000: 18505: debug : 
virRegisterConnectDriver:695 : registering VMWARE as driver 2
2017-02-17 15:58:36.127+0000: 18505: debug : 
virRegisterConnectDriver:684 : driver=0x7f1e5aca3720 name=remote
2017-02-17 15:58:36.127+0000: 18505: debug : 
virRegisterConnectDriver:695 : registering remote as driver 3
2017-02-17 15:58:36.127+0000: 18505: debug : 
virEventRegisterDefaultImpl:267 : registering default event implementation
2017-02-17 15:58:36.127+0000: 18505: debug : virEventPollAddHandle:115 : 
Used 0 handle slots, adding at least 10 more
2017-02-17 15:58:36.127+0000: 18505: debug : 
virEventPollInterruptLocked:722 : Skip interrupt, 0 0
2017-02-17 15:58:36.127+0000: 18505: info : virEventPollAddHandle:140 : 
EVENT_POLL_ADD_HANDLE: watch=1 fd=3 events=1 cb=0x7f1e5a7fc140 
opaque=(nil) ff=(nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virEventRegisterImpl:234 : 
addHandle=0x7f1e5a7fc860 updateHandle=0x7f1e5a7fcb90 
removeHandle=0x7f1e5a7fc1a0 addTimeout=0x7f1e5a7fc310 
updateTimeout=0x7f1e5a7fc510 removeTimeout=0x7f1e5a7fc6e0
2017-02-17 15:58:36.127+0000: 18505: debug : virEventPollAddTimeout:230 
: Used 0 timeout slots, adding at least 10 more
2017-02-17 15:58:36.127+0000: 18505: debug : 
virEventPollInterruptLocked:722 : Skip interrupt, 0 0
2017-02-17 15:58:36.127+0000: 18505: info : virEventPollAddTimeout:253 : 
EVENT_POLL_ADD_TIMEOUT: timer=1 frequency=-1 cb=0x563a29758360 
opaque=0x7fff70941380 ff=(nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConnectOpenAuth:1245 : 
name=&lt;null&gt;, auth=0x7f1e5aca2a00, flags=0
2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 : 
OBJECT_NEW: obj=0x563a2a7f5f50 classname=virConnect
2017-02-17 15:58:36.127+0000: 18505: debug : virConfLoadConfig:1604 : 
Loading config file '/etc/libvirt/libvirt.conf'
2017-02-17 15:58:36.127+0000: 18505: debug : virConfReadFile:778 : 
filename=/etc/libvirt/libvirt.conf
2017-02-17 15:58:36.127+0000: 18506: debug : virThreadJobSet:99 : Thread 
18506 is now running job vshEventLoop
2017-02-17 15:58:36.127+0000: 18506: debug : virEventRunDefaultImpl:311 
: running default event implementation
2017-02-17 15:58:36.127+0000: 18505: debug : virFileClose:108 : Closed fd 5
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCleanupTimeouts:525 : Cleanup 1
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCleanupHandles:574 : Cleanup 1
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18506: debug : virEventPollMakePollFDs:401 
: Prepare n=0 w=1, f=3 e=1 d=0
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCalculateTimeout:338 : Calculate expiry of 1 timers
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCalculateTimeout:371 : No timeout is pending
2017-02-17 15:58:36.127+0000: 18506: info : virEventPollRunOnce:640 : 
EVENT_POLL_RUN: nhandles=1 timeout=-1
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfGetValueString:932 : 
Get value string (nil) 0
2017-02-17 15:58:36.127+0000: 18505: debug : virConnectOpenInternal:1040 
: no name, allowing driver auto-select
2017-02-17 15:58:36.127+0000: 18505: debug : virConnectOpenInternal:1083 
: trying driver 0 (Test) ...
2017-02-17 15:58:36.127+0000: 18505: debug : virConnectOpenInternal:1098 
: driver 0 Test returned DECLINED
2017-02-17 15:58:36.127+0000: 18505: debug : virConnectOpenInternal:1083 
: trying driver 1 (OPENVZ) ...
2017-02-17 15:58:36.127+0000: 18505: debug : virConnectOpenInternal:1098 
: driver 1 OPENVZ returned DECLINED
2017-02-17 15:58:36.127+0000: 18505: debug : virConnectOpenInternal:1083 
: trying driver 2 (VMWARE) ...
2017-02-17 15:58:36.127+0000: 18505: debug : virConnectOpenInternal:1098 
: driver 2 VMWARE returned DECLINED
2017-02-17 15:58:36.127+0000: 18505: debug : virConnectOpenInternal:1083 
: trying driver 3 (remote) ...
2017-02-17 15:58:36.127+0000: 18505: debug : remoteConnectOpen:1343 : 
Auto-probe remote URI
2017-02-17 15:58:36.127+0000: 18505: debug : doRemoteOpen:907 : 
proceeding with name =
2017-02-17 15:58:36.127+0000: 18505: debug : doRemoteOpen:916 : 
Connecting with transport 1
2017-02-17 15:58:36.127+0000: 18505: debug : doRemoteOpen:1051 : 
Proceeding with sockname /var/run/libvirt/libvirt-sock
2017-02-17 15:58:36.127+0000: 18505: debug : 
virNetSocketNewConnectUNIX:639 : path=/var/run/libvirt/libvirt-sock 
spawnDaemon=0 binary=&lt;null&gt;
2017-02-17 15:58:36.127+0000: 18505: debug : 
virNetSocketNewConnectUNIX:703 : connect() succeeded
2017-02-17 15:58:36.127+0000: 18505: debug : virNetSocketNew:235 : 
localAddr=0x7fff70940d00 remoteAddr=0x7fff70940d90 fd=5 errfd=-1 pid=0
2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 : 
OBJECT_NEW: obj=0x563a2a7f7980 classname=virNetSocket
2017-02-17 15:58:36.127+0000: 18505: info : virNetSocketNew:291 : 
RPC_SOCKET_NEW: sock=0x563a2a7f7980 fd=5 errfd=-1 pid=0 
localAddr=127.0.0.1;0, remoteAddr=127.0.0.1;0
2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 : 
OBJECT_NEW: obj=0x563a2a7f7d80 classname=virNetClient
2017-02-17 15:58:36.127+0000: 18505: info : virNetClientNew:328 : 
RPC_CLIENT_NEW: client=0x563a2a7f7d80 sock=0x563a2a7f7980
2017-02-17 15:58:36.127+0000: 18505: info : virObjectRef:296 : 
OBJECT_REF: obj=0x563a2a7f7d80
2017-02-17 15:58:36.127+0000: 18505: info : virObjectRef:296 : 
OBJECT_REF: obj=0x563a2a7f7980
2017-02-17 15:58:36.127+0000: 18505: debug : 
virEventPollInterruptLocked:726 : Interrupting
2017-02-17 15:58:36.127+0000: 18505: info : virEventPollAddHandle:140 : 
EVENT_POLL_ADD_HANDLE: watch=2 fd=5 events=1 cb=0x7f1e5a96cd10 
opaque=0x563a2a7f7980 ff=0x7f1e5a96ccc0
2017-02-17 15:58:36.127+0000: 18505: debug : virKeepAliveNew:199 : 
client=0x563a2a7f7d80, interval=-1, count=0
2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 : 
OBJECT_NEW: obj=0x563a2a7f8080 classname=virKeepAlive
2017-02-17 15:58:36.127+0000: 18505: info : virKeepAliveNew:218 : 
RPC_KEEPALIVE_NEW: ka=0x563a2a7f8080 client=0x563a2a7f7d80
2017-02-17 15:58:36.127+0000: 18505: info : virObjectRef:296 : 
OBJECT_REF: obj=0x563a2a7f7d80
2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 : 
OBJECT_NEW: obj=0x563a2a7f6740 classname=virConnectCloseCallbackData
2017-02-17 15:58:36.127+0000: 18506: debug : virEventPollRunOnce:650 : 
Poll got 1 event(s)
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollDispatchTimeouts:432 : Dispatch 1
2017-02-17 15:58:36.127+0000: 18505: info : virObjectRef:296 : 
OBJECT_REF: obj=0x563a2a7f6740
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollDispatchHandles:478 : Dispatch 1
2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 : 
OBJECT_NEW: obj=0x563a2a7f7fa0 classname=virNetClientProgram
2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 : 
OBJECT_NEW: obj=0x563a2a7f7b60 classname=virNetClientProgram
2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 : 
OBJECT_NEW: obj=0x563a2a7f7910 classname=virNetClientProgram
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollDispatchHandles:492 : i=0 w=1
2017-02-17 15:58:36.127+0000: 18505: info : virObjectRef:296 : 
OBJECT_REF: obj=0x563a2a7f7fa0
2017-02-17 15:58:36.127+0000: 18506: info : 
virEventPollDispatchHandles:506 : EVENT_POLL_DISPATCH_HANDLE: watch=1 
events=1
2017-02-17 15:58:36.127+0000: 18505: info : virObjectRef:296 : 
OBJECT_REF: obj=0x563a2a7f7b60
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCleanupTimeouts:525 : Cleanup 1
2017-02-17 15:58:36.127+0000: 18505: info : virObjectRef:296 : 
OBJECT_REF: obj=0x563a2a7f7910
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCleanupHandles:574 : Cleanup 2
2017-02-17 15:58:36.127+0000: 18505: debug : doRemoteOpen:1170 : Trying 
authentication
2017-02-17 15:58:36.127+0000: 18506: debug : virEventRunDefaultImpl:311 
: running default event implementation
2017-02-17 15:58:36.127+0000: 18505: debug : virNetMessageNew:46 : 
msg=0x563a2a7fa470 tracked=0
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCleanupTimeouts:525 : Cleanup 1
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCleanupHandles:574 : Cleanup 2
2017-02-17 15:58:36.127+0000: 18506: debug : virEventPollMakePollFDs:401 
: Prepare n=0 w=1, f=3 e=1 d=0
2017-02-17 15:58:36.127+0000: 18505: debug : 
virNetMessageEncodePayload:386 : Encode length as 28
2017-02-17 15:58:36.127+0000: 18506: debug : virEventPollMakePollFDs:401 
: Prepare n=1 w=2, f=5 e=1 d=0
2017-02-17 15:58:36.127+0000: 18505: info : 
virNetClientSendInternal:2104 : RPC_CLIENT_MSG_TX_QUEUE: 
client=0x563a2a7f7d80 len=28 prog=536903814 vers=1 proc=66 type=0 
status=0 serial=0
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCalculateTimeout:338 : Calculate expiry of 1 timers
2017-02-17 15:58:36.127+0000: 18505: debug : virNetClientCallNew:2057 : 
New call 0x563a2a7f7340: msg=0x563a2a7fa470, expectReply=1, nonBlock=0
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCalculateTimeout:371 : No timeout is pending
2017-02-17 15:58:36.127+0000: 18505: debug : virNetClientIO:1866 : 
Outgoing message prog=536903814 version=1 serial=0 proc=66 type=0 
length=28 dispatch=(nil)
2017-02-17 15:58:36.127+0000: 18506: info : virEventPollRunOnce:640 : 
EVENT_POLL_RUN: nhandles=2 timeout=-1
2017-02-17 15:58:36.127+0000: 18505: debug : virNetClientIO:1925 : We 
have the buck head=0x563a2a7f7340 call=0x563a2a7f7340
2017-02-17 15:58:36.127+0000: 18505: info : virEventPollUpdateHandle:152 
: EVENT_POLL_UPDATE_HANDLE: watch=2 events=0
2017-02-17 15:58:36.127+0000: 18505: debug : 
virEventPollInterruptLocked:726 : Interrupting
2017-02-17 15:58:36.127+0000: 18506: debug : virEventPollRunOnce:650 : 
Poll got 1 event(s)
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollDispatchTimeouts:432 : Dispatch 1
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollDispatchHandles:478 : Dispatch 2
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollDispatchHandles:492 : i=0 w=1
2017-02-17 15:58:36.127+0000: 18506: info : 
virEventPollDispatchHandles:506 : EVENT_POLL_DISPATCH_HANDLE: watch=1 
events=1
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCleanupTimeouts:525 : Cleanup 1
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCleanupHandles:574 : Cleanup 2
2017-02-17 15:58:36.127+0000: 18506: debug : virEventRunDefaultImpl:311 
: running default event implementation
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCleanupTimeouts:525 : Cleanup 1
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCleanupHandles:574 : Cleanup 2
2017-02-17 15:58:36.127+0000: 18506: debug : virEventPollMakePollFDs:401 
: Prepare n=0 w=1, f=3 e=1 d=0
2017-02-17 15:58:36.127+0000: 18506: debug : virEventPollMakePollFDs:401 
: Prepare n=1 w=2, f=5 e=0 d=0
2017-02-17 15:58:36.128+0000: 18506: debug : 
virEventPollCalculateTimeout:338 : Calculate expiry of 1 timers
2017-02-17 15:58:36.128+0000: 18506: debug : 
virEventPollCalculateTimeout:371 : No timeout is pending
2017-02-17 15:58:36.128+0000: 18506: info : virEventPollRunOnce:640 : 
EVENT_POLL_RUN: nhandles=1 timeout=-1
^C


-- 
-- 
Yun-Chih Chen é³èå¿
Network/Workstation Assistant
Dept. of Computer Science and Information Engineering
National Taiwan University
Tel: +886-2-33664888 ext. 217/204
Email: ta217@csie.ntu.edu.tw
Website: http://wslab.csie.ntu.edu.tw/


[Attachment #3 (text/html)]

&lt;html&gt;
  &lt;head&gt;

    &lt;meta http-equiv="content-type" content="text/html; charset=utf-8"&gt;
  &lt;/head&gt;
  &lt;body bgcolor="#FFFFFF" text="#000000"&gt;
    &lt;div class="moz-text-flowed" style="font-family: -moz-fixed;
      font-size: 12px;" lang="x-unicode"&gt;
      &lt;br&gt;
      `virsh list` hangs on my server that hosts a bunch of VMs.
      &lt;br&gt;
      This might be due to the Debian upgrade I did on Feb 15, which
      upgrades `libvirt` from 2.4.0-1 to 3.0.0-2.
      &lt;br&gt;
      I have tried restarting libvirtd for a few times, without luck.
      &lt;br&gt;
      &lt;br&gt;
      Attached below are some relevant logs; let me know if you need
      some more for debugging.
      &lt;br&gt;
      Thanks for your help!!
      &lt;br&gt;
      &lt;br&gt;
      root@vm-host:~# uname -a
      &lt;br&gt;
      Linux vm-host 4.6.0-1-amd64 #1 SMP Debian 4.6.4-1 (2016-07-18)
      x86_64 GNU/Linux
      &lt;br&gt;
      &lt;br&gt;
      root@vm-host:~# apt-cache policy libvirt-daemon
      &lt;br&gt;
      libvirt-daemon:
      &lt;br&gt;
        Installed: 3.0.0-2
      &lt;br&gt;
        Candidate: 3.0.0-2
      &lt;br&gt;
        Version table:
      &lt;br&gt;
       *** 3.0.0-2 500
      &lt;br&gt;
              500 &lt;a class="moz-txt-link-freetext"
        href="http://debian.csie.ntu.edu.tw/debian"&gt;http://debian.csie.ntu.edu.tw/debian&lt;/a&gt;
      testing/main amd64 Packages
      &lt;br&gt;
              100 /var/lib/dpkg/status
      &lt;br&gt;
      &lt;br&gt;
      root@vm-host:~# strace -o /tmp/trace -e trace=network,file,poll
      virsh list  # hangs forever .....
      &lt;br&gt;
      ^C
      &lt;br&gt;
      root@vm-host:~# tail -10 /tmp/trace
      &lt;br&gt;
      access("/etc/libvirt/libvirt.conf", F_OK) = 0
      &lt;br&gt;
      open("/etc/libvirt/libvirt.conf", O_RDONLY) = 5
      &lt;br&gt;
      access("/proc/vz", F_OK)                = -1 ENOENT (No such file
      or directory)
      &lt;br&gt;
      socket(AF_UNIX, SOCK_STREAM, 0)         = 5
      &lt;br&gt;
      connect(5, {sa_family=AF_UNIX,
      sun_path="/var/run/libvirt/libvirt-sock"}, 110) = 0
      &lt;br&gt;
      getsockname(5, {sa_family=AF_UNIX}, [128-&gt;2]) = 0
      &lt;br&gt;
      poll([{fd=5, events=POLLOUT}, {fd=6, events=POLLIN}], 2, -1) = 1
      ([{fd=5, revents=POLLOUT}])
      &lt;br&gt;
      poll([{fd=5, events=POLLIN}, {fd=6, events=POLLIN}], 2, -1) = ?
      ERESTART_RESTARTBLOCK (Interrupted by signal)
      &lt;br&gt;
      --- SIGINT {si_signo=SIGINT, si_code=SI_KERNEL} ---
      &lt;br&gt;
      +++ killed by SIGINT +++
      &lt;br&gt;
      &lt;br&gt;
      root@vm-host:~# lsof /var/run/libvirt/libvirt-sock # hangs too ...
      &lt;br&gt;
      ^C
      &lt;br&gt;
      &lt;br&gt;
      root@vm-host:~# LIBVIRT_DEBUG=1 virsh list
      &lt;br&gt;
      2017-02-17 15:58:36.126+0000: 18505: info : libvirt version:
      3.0.0, package: 2 (Guido Günther &lt;a class="moz-txt-link-rfc2396E"
        href="mailto:agx@sigxcpu.org"&gt;&lt;agx@sigxcpu.org&gt;&lt;/a&gt; Wed,
      25 Jan 2017 07:04:08 +0100)
      &lt;br&gt;
      2017-02-17 15:58:36.126+0000: 18505: info : hostname: vm-host
      &lt;br&gt;
      2017-02-17 15:58:36.126+0000: 18505: debug : virGlobalInit:386 :
      register drivers
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virRegisterConnectDriver:684 : driver=0x7f1e5aca2c40 name=Test
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virRegisterConnectDriver:695 : registering Test as driver 0
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virRegisterConnectDriver:684 : driver=0x7f1e5aca4ac0 name=OPENVZ
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virRegisterConnectDriver:695 : registering OPENVZ as driver 1
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virRegisterConnectDriver:684 : driver=0x7f1e5aca5260 name=VMWARE
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virRegisterConnectDriver:695 : registering VMWARE as driver 2
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virRegisterConnectDriver:684 : driver=0x7f1e5aca3720 name=remote
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virRegisterConnectDriver:695 : registering remote as driver 3
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virEventRegisterDefaultImpl:267 : registering default event
      implementation
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virEventPollAddHandle:115 : Used 0 handle slots, adding at least
      10 more
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virEventPollInterruptLocked:722 : Skip interrupt, 0 0
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info :
      virEventPollAddHandle:140 : EVENT_POLL_ADD_HANDLE: watch=1 fd=3
      events=1 cb=0x7f1e5a7fc140 opaque=(nil) ff=(nil)
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virEventRegisterImpl:234 : addHandle=0x7f1e5a7fc860
      updateHandle=0x7f1e5a7fcb90 removeHandle=0x7f1e5a7fc1a0
      addTimeout=0x7f1e5a7fc310 updateTimeout=0x7f1e5a7fc510
      removeTimeout=0x7f1e5a7fc6e0
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virEventPollAddTimeout:230 : Used 0 timeout slots, adding at least
      10 more
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virEventPollInterruptLocked:722 : Skip interrupt, 0 0
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info :
      virEventPollAddTimeout:253 : EVENT_POLL_ADD_TIMEOUT: timer=1
      frequency=-1 cb=0x563a29758360 opaque=0x7fff70941380 ff=(nil)
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virConnectOpenAuth:1245 : name=&lt;null&gt;, auth=0x7f1e5aca2a00,
      flags=0
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 :
      OBJECT_NEW: obj=0x563a2a7f5f50 classname=virConnect
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virConfLoadConfig:1604 : Loading config file
      '/etc/libvirt/libvirt.conf'
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virConfReadFile:778 :
      filename=/etc/libvirt/libvirt.conf
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug : virThreadJobSet:99 :
      Thread 18506 is now running job vshEventLoop
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventRunDefaultImpl:311 : running default event implementation
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virFileClose:108 :
      Closed fd 5
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollCleanupTimeouts:525 : Cleanup 1
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollCleanupHandles:574 : Cleanup 1
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 :
      Add entry (null) (nil)
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 :
      Add entry (null) (nil)
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 :
      Add entry (null) (nil)
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollMakePollFDs:401 : Prepare n=0 w=1, f=3 e=1 d=0
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollCalculateTimeout:338 : Calculate expiry of 1 timers
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 :
      Add entry (null) (nil)
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 :
      Add entry (null) (nil)
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 :
      Add entry (null) (nil)
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollCalculateTimeout:371 : No timeout is pending
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: info :
      virEventPollRunOnce:640 : EVENT_POLL_RUN: nhandles=1 timeout=-1
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 :
      Add entry (null) (nil)
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 :
      Add entry (null) (nil)
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 :
      Add entry (null) (nil)
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 :
      Add entry (null) (nil)
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 :
      Add entry (null) (nil)
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 :
      Add entry (null) (nil)
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 :
      Add entry (null) (nil)
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 :
      Add entry (null) (nil)
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 :
      Add entry (null) (nil)
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 :
      Add entry (null) (nil)
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virConfGetValueString:932 : Get value string (nil) 0
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virConnectOpenInternal:1040 : no name, allowing driver auto-select
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virConnectOpenInternal:1083 : trying driver 0 (Test) ...
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virConnectOpenInternal:1098 : driver 0 Test returned DECLINED
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virConnectOpenInternal:1083 : trying driver 1 (OPENVZ) ...
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virConnectOpenInternal:1098 : driver 1 OPENVZ returned DECLINED
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virConnectOpenInternal:1083 : trying driver 2 (VMWARE) ...
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virConnectOpenInternal:1098 : driver 2 VMWARE returned DECLINED
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virConnectOpenInternal:1083 : trying driver 3 (remote) ...
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      remoteConnectOpen:1343 : Auto-probe remote URI
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : doRemoteOpen:907 :
      proceeding with name =
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : doRemoteOpen:916 :
      Connecting with transport 1
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : doRemoteOpen:1051 :
      Proceeding with sockname /var/run/libvirt/libvirt-sock
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virNetSocketNewConnectUNIX:639 :
      path=/var/run/libvirt/libvirt-sock spawnDaemon=0
      binary=&lt;null&gt;
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virNetSocketNewConnectUNIX:703 : connect() succeeded
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virNetSocketNew:235 :
      localAddr=0x7fff70940d00 remoteAddr=0x7fff70940d90 fd=5 errfd=-1
      pid=0
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 :
      OBJECT_NEW: obj=0x563a2a7f7980 classname=virNetSocket
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info : virNetSocketNew:291 :
      RPC_SOCKET_NEW: sock=0x563a2a7f7980 fd=5 errfd=-1 pid=0
      localAddr=127.0.0.1;0, remoteAddr=127.0.0.1;0
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 :
      OBJECT_NEW: obj=0x563a2a7f7d80 classname=virNetClient
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info : virNetClientNew:328 :
      RPC_CLIENT_NEW: client=0x563a2a7f7d80 sock=0x563a2a7f7980
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info : virObjectRef:296 :
      OBJECT_REF: obj=0x563a2a7f7d80
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info : virObjectRef:296 :
      OBJECT_REF: obj=0x563a2a7f7980
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virEventPollInterruptLocked:726 : Interrupting
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info :
      virEventPollAddHandle:140 : EVENT_POLL_ADD_HANDLE: watch=2 fd=5
      events=1 cb=0x7f1e5a96cd10 opaque=0x563a2a7f7980 ff=0x7f1e5a96ccc0
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virKeepAliveNew:199 :
      client=0x563a2a7f7d80, interval=-1, count=0
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 :
      OBJECT_NEW: obj=0x563a2a7f8080 classname=virKeepAlive
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info : virKeepAliveNew:218 :
      RPC_KEEPALIVE_NEW: ka=0x563a2a7f8080 client=0x563a2a7f7d80
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info : virObjectRef:296 :
      OBJECT_REF: obj=0x563a2a7f7d80
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 :
      OBJECT_NEW: obj=0x563a2a7f6740
      classname=virConnectCloseCallbackData
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollRunOnce:650 : Poll got 1 event(s)
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollDispatchTimeouts:432 : Dispatch 1
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info : virObjectRef:296 :
      OBJECT_REF: obj=0x563a2a7f6740
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollDispatchHandles:478 : Dispatch 1
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 :
      OBJECT_NEW: obj=0x563a2a7f7fa0 classname=virNetClientProgram
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 :
      OBJECT_NEW: obj=0x563a2a7f7b60 classname=virNetClientProgram
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 :
      OBJECT_NEW: obj=0x563a2a7f7910 classname=virNetClientProgram
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollDispatchHandles:492 : i=0 w=1
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info : virObjectRef:296 :
      OBJECT_REF: obj=0x563a2a7f7fa0
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: info :
      virEventPollDispatchHandles:506 : EVENT_POLL_DISPATCH_HANDLE:
      watch=1 events=1
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info : virObjectRef:296 :
      OBJECT_REF: obj=0x563a2a7f7b60
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollCleanupTimeouts:525 : Cleanup 1
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info : virObjectRef:296 :
      OBJECT_REF: obj=0x563a2a7f7910
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollCleanupHandles:574 : Cleanup 2
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : doRemoteOpen:1170 :
      Trying authentication
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventRunDefaultImpl:311 : running default event implementation
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virNetMessageNew:46 :
      msg=0x563a2a7fa470 tracked=0
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollCleanupTimeouts:525 : Cleanup 1
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollCleanupHandles:574 : Cleanup 2
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollMakePollFDs:401 : Prepare n=0 w=1, f=3 e=1 d=0
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virNetMessageEncodePayload:386 : Encode length as 28
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollMakePollFDs:401 : Prepare n=1 w=2, f=5 e=1 d=0
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info :
      virNetClientSendInternal:2104 : RPC_CLIENT_MSG_TX_QUEUE:
      client=0x563a2a7f7d80 len=28 prog=536903814 vers=1 proc=66 type=0
      status=0 serial=0
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollCalculateTimeout:338 : Calculate expiry of 1 timers
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virNetClientCallNew:2057 : New call 0x563a2a7f7340:
      msg=0x563a2a7fa470, expectReply=1, nonBlock=0
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollCalculateTimeout:371 : No timeout is pending
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virNetClientIO:1866 :
      Outgoing message prog=536903814 version=1 serial=0 proc=66 type=0
      length=28 dispatch=(nil)
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: info :
      virEventPollRunOnce:640 : EVENT_POLL_RUN: nhandles=2 timeout=-1
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug : virNetClientIO:1925 :
      We have the buck head=0x563a2a7f7340 call=0x563a2a7f7340
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: info :
      virEventPollUpdateHandle:152 : EVENT_POLL_UPDATE_HANDLE: watch=2
      events=0
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18505: debug :
      virEventPollInterruptLocked:726 : Interrupting
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollRunOnce:650 : Poll got 1 event(s)
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollDispatchTimeouts:432 : Dispatch 1
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollDispatchHandles:478 : Dispatch 2
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollDispatchHandles:492 : i=0 w=1
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: info :
      virEventPollDispatchHandles:506 : EVENT_POLL_DISPATCH_HANDLE:
      watch=1 events=1
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollCleanupTimeouts:525 : Cleanup 1
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollCleanupHandles:574 : Cleanup 2
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventRunDefaultImpl:311 : running default event implementation
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollCleanupTimeouts:525 : Cleanup 1
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollCleanupHandles:574 : Cleanup 2
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollMakePollFDs:401 : Prepare n=0 w=1, f=3 e=1 d=0
      &lt;br&gt;
      2017-02-17 15:58:36.127+0000: 18506: debug :
      virEventPollMakePollFDs:401 : Prepare n=1 w=2, f=5 e=0 d=0
      &lt;br&gt;
      2017-02-17 15:58:36.128+0000: 18506: debug :
      virEventPollCalculateTimeout:338 : Calculate expiry of 1 timers
      &lt;br&gt;
      2017-02-17 15:58:36.128+0000: 18506: debug :
      virEventPollCalculateTimeout:371 : No timeout is pending
      &lt;br&gt;
      2017-02-17 15:58:36.128+0000: 18506: info :
      virEventPollRunOnce:640 : EVENT_POLL_RUN: nhandles=1 timeout=-1
      &lt;br&gt;
      ^C
      &lt;br&gt;
      &lt;br&gt;
      &lt;br&gt;
      &lt;div class="moz-txt-sig"&gt;&lt;span class="moz-txt-tag"&gt;-- &lt;br&gt;
        &lt;/span&gt;--
        &lt;br&gt;
        Yun-Chih Chen 陳耘志
        &lt;br&gt;
        Network/Workstation Assistant
        &lt;br&gt;
        Dept. of Computer Science and Information Engineering
        &lt;br&gt;
        National Taiwan University
        &lt;br&gt;
        Tel: +886-2-33664888 ext. 217/204
        &lt;br&gt;
        Email: &lt;a class="moz-txt-link-abbreviated"
          href="mailto:ta217@csie.ntu.edu.tw"&gt;ta217@csie.ntu.edu.tw&lt;/a&gt;
        &lt;br&gt;
        Website: &lt;a class="moz-txt-link-freetext"
          href="http://wslab.csie.ntu.edu.tw/"&gt;http://wslab.csie.ntu.edu.tw/&lt;/a&gt;
        &lt;br&gt;
        &lt;br&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;


</body></email><email><emailId>20170217113328</emailId><senderName>Gionatan Danti</senderName><senderEmail>g.danti@assyoma.it</senderEmail><timestampReceived>2017-02-17 11:33:28-0400</timestampReceived><subject>[libvirt-users] Unsafe migration with copy-storage-all (non shared storage) and writeback cache</subject><body>

Hi list,
I would like to understand if, and why, the --unsafe flag is needed when 
using --copy-storage-all when migrating guests which uses writeback 
cache mode.

Background: I want to live migrate guests with writeback cache from host 
A to host B and these hosts only have local storage (ie: no shared 
storage at all).

 From my understanding, --unsafe should be only required when migrating 
writeback-enabled guests between two hosts which share non-cluster-aware 
storage (ie: NFS), but it should not be necessary when not sharing storage.

However, when trying to migrate from a CentOS6 host to a CentOS7 machine 
with command

[root@source ~]# virsh migrate Totem --live --copy-storage-all 
--persistent --verbose qemu+ssh://root@172.31.255.11/system

I have the following error:
error: Unsafe migration: Migration may lead to data corruption if disks 
use cache != none

So, my questions are:

1) it is safe to do a live migration with --copy-storage-all when guests 
are using writeback cache mode?

2) if so, why libvirt complains about that?

3) if not, what is the best method to migrate a running quest using 
writeback cache mode?

Thanks.

-- 
Danti Gionatan
Supporto Tecnico
Assyoma S.r.l. - www.assyoma.it
email: g.danti@assyoma.it - info@assyoma.it
GPG public key ID: FF5F32A8

</body></email><email><emailId>20170221062440</emailId><senderName>王李明</senderName><senderEmail>wanglm@certusnet.com.cn</senderEmail><timestampReceived>2017-02-21 06:24:40-0400</timestampReceived><subject>[libvirt-users] =?utf-8?b?562U5aSNOiAgVmlyc2ggY29tbWFuZCBoYW5n?= =?utf-8?q?ing?=</subject><body>

UbJGR;7b MIME 8qJ=5D6`2?7VSJ&lt;~!#


I have this problem in centos6.5

when I upgrade to centos 7.1 this problem is soluted

maybe you can upgrade your os version

 

 

 

发件人: libvirt-users-bounces@redhat.com [mailto:libvirt-users-bounces@redhat.com] \
代表 abhishek jain 发送时间: 2017年2月21日 13:51
收件人: libvirt-users@redhat.com
主题: [libvirt-users] Virsh command hanging

 

Hi,

 

I started the VMs with libvirt 3 days ago (17th Feb).  Now when I am trying to \
shutdown the domain, all my virsh command is hanging even  virt-manager remains in \
"connecting.."  mode and is not showing active domains.

When   I set  the libvirt debug env and call "virsh list"  it hangs in poll. Here is \
the log

setenv LIBVIRT_DEBUG 1 virsh list

2017-02-21 05:31:09.241+0000: 125812: debug : virEventPollCalculateTimeout:320 : \
Calculate expiry of 0 timers

2017-02-21 05:31:09.241+0000: 125811: debug : virEventPollUpdateHandle:146 : \
EVENT_POLL_UPDATE_HANDLE: watch=2 events=0

2017-02-21 05:31:09.241+0000: 125812: debug : virEventPollCalculateTimeout:346 : \
Timeout at 0 due in -1 ms

2017-02-21 05:31:09.241+0000: 125812: debug : virEventPollRunOnce:614 : \
EVENT_POLL_RUN: nhandles=2 timeout=-1

2017-02-21 05:31:09.241+0000: 125811: debug : virEventPollInterruptLocked:701 : \
Interrupting

2017-02-21 05:31:09.241+0000: 125812: debug : virEventPollRunOnce:625 : Poll got 1 \
event(s)

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollDispatchTimeouts:410 : \
Dispatch 0

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollDispatchHandles:455 : \
Dispatch 2

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollDispatchHandles:469 : i=0 \
w=1

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollDispatchHandles:483 : \
EVENT_POLL_DISPATCH_HANDLE: watch=1 events=1

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollCleanupTimeouts:501 : \
Cleanup 0

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollCleanupTimeouts:537 : Found \
0 out of 0 timeout slots used, releasing 0

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollCleanupHandles:549 : \
Cleanup 2

2017-02-21 05:31:09.242+0000: 125812: debug : virEventRunDefaultImpl:244 : running \
default event implementation

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollCleanupTimeouts:501 : \
Cleanup 0

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollCleanupTimeouts:537 : Found \
0 out of 0 timeout slots used, releasing 0

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollCleanupHandles:549 : \
Cleanup 2

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollMakePollFDs:378 : Prepare \
n=0 w=1, f=4 e=1 d=0

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollMakePollFDs:378 : Prepare \
n=1 w=2, f=6 e=0 d=0

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollCalculateTimeout:320 : \
Calculate expiry of 0 timers

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollCalculateTimeout:346 : \
Timeout at 0 due in -1 ms

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollRunOnce:614 : \
EVENT_POLL_RUN: nhandles=1 timeout=-1 &lt;&lt;hang&gt;&gt;

 

 

here is the log snippet of  /var/log/libvirt/libvirtd.log

2017-02-17 06:18:26.198+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:18:41.022+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:18:56.017+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:19:11.019+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:19:26.016+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:19:41.021+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:19:56.014+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:20:11.021+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:20:26.014+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:20:41.014+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:20:56.016+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:21:11.019+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:21:26.018+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:21:41.022+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:21:56.019+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:22:11.020+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:22:26.012+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-18 01:53:36.308+0000: 5052: warning : virKeepAliveTimerInternal:156 : No \
response from client 0xe14160 after 5 keepalive messages in 30 seconds

2017-02-18 01:53:47.346+0000: 5052: warning : virKeepAliveTimerInternal:156 : No \
response from client 0xe14c70 after 5 keepalive messages in 30 seconds \
/var/log/libvirt/libvirtd.log

 

What could be the problem. I am running virsh (0.10.2) on RHEL6

 

Thanks for your help in advance.

 

Regards

Abhishek


[Attachment #3 (text/html)]

&lt;html xmlns:v="urn:schemas-microsoft-com:vml" \
xmlns:o="urn:schemas-microsoft-com:office:office" \
xmlns:w="urn:schemas-microsoft-com:office:word" \
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" \
xmlns="http://www.w3.org/TR/REC-html40"&gt;

&lt;head&gt;
&lt;meta http-equiv=Content-Type content="text/html; charset=utf-8"&gt;
&lt;meta name=Generator content="Microsoft Word 12 (filtered medium)"&gt;
&lt;style&gt;
&lt;!--
 /* Font Definitions */
 @font-face
	{font-family:Helvetica;
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:宋体;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:"\@宋体";
	panose-1:2 1 6 0 3 1 1 1 1 1;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:宋体;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:purple;
	text-decoration:underline;}
span.EmailStyle17
	{mso-style-type:personal-reply;
	font-family:"Calibri","sans-serif";
	color:black;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-size:10.0pt;}
@page Section1
	{size:612.0pt 792.0pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;}
div.Section1
	{page:Section1;}
--&gt;
&lt;/style&gt;
&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
 &lt;o:shapedefaults v:ext="edit" spidmax="1026" /&gt;
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
 &lt;o:shapelayout v:ext="edit"&gt;
  &lt;o:idmap v:ext="edit" data="1" /&gt;
 &lt;/o:shapelayout&gt;&lt;/xml&gt;&lt;![endif]--&gt;
&lt;/head&gt;

&lt;body lang=ZH-CN link=blue vlink=purple&gt;

&lt;div class=Section1&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='font-family:"Calibri","sans-serif";
color:black'&gt;I have this problem in centos6.5&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='font-family:"Calibri","sans-serif";
color:black'&gt;when I upgrade to centos 7.1 this problem is \
soluted&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='font-family:"Calibri","sans-serif";
color:black'&gt;maybe you can upgrade your os version&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph'&gt;&lt;span
lang=EN-US style='font-size:10.5pt;font-family:"Calibri","sans-serif";
color:black'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph'&gt;&lt;span
lang=EN-US style='font-size:10.5pt;font-family:"Calibri","sans-serif";
color:black'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='font-family:"Calibri","sans-serif";
color:black'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div style='border:none;border-top:solid #B5C4DF 1.0pt;padding:3.0pt 0cm 0cm 0cm'&gt;

&lt;p class=MsoNormal&gt;&lt;b&gt;&lt;span style='font-size:10.0pt'&gt;发件人&lt;span \
lang=EN-US&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;span lang=EN-US style='font-size:10.0pt'&gt; \
libvirt-users-bounces@redhat.com [mailto:libvirt-users-bounces@redhat.com] \
&lt;/span&gt;&lt;b&gt;&lt;span style='font-size: 10.0pt'&gt;代表 &lt;/span&gt;&lt;/b&gt;&lt;span lang=EN-US \
style='font-size:10.0pt'&gt;abhishek jain&lt;br&gt; &lt;/span&gt;&lt;b&gt;&lt;span \
style='font-size:10.0pt'&gt;发送时间&lt;span lang=EN-US&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;span \
lang=EN-US style='font-size:10.0pt'&gt; 2017&lt;/span&gt;&lt;span \
style='font-size:10.0pt'&gt;年&lt;span lang=EN-US&gt;2&lt;/span&gt;月&lt;span \
lang=EN-US&gt;21&lt;/span&gt;日&lt;span lang=EN-US&gt; 13:51&lt;br&gt; &lt;/span&gt;&lt;b&gt;收件人&lt;span \
lang=EN-US&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang=EN-US&gt; libvirt-users@redhat.com&lt;br&gt;
&lt;/span&gt;&lt;b&gt;主题&lt;span lang=EN-US&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang=EN-US&gt; [libvirt-users]
Virsh command hanging&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3018"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;Hi,&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3018"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3018"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;I started the VMs with
libvirt 3 days ago (17th Feb).  Now when I am trying to shutdown the
domain, all my virsh command is hanging even  virt-manager remains in
"connecting.."  mode and is not showing active \
domains.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3018"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;When   I set
 the libvirt debug env and call "virsh list"  it hangs in
poll. Here is the log&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3203"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;setenv LIBVIRT_DEBUG 1
virsh list&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3205"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.241+0000: 125812: debug : virEventPollCalculateTimeout:320 : Calculate
expiry of 0 timers&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3207"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.241+0000: 125811: debug : virEventPollUpdateHandle:146 :
EVENT_POLL_UPDATE_HANDLE: watch=2 events=0&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3209"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.241+0000: 125812: debug : virEventPollCalculateTimeout:346 : Timeout
at 0 due in -1 ms&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3211"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.241+0000: 125812: debug : virEventPollRunOnce:614 : EVENT_POLL_RUN:
nhandles=2 timeout=-1&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3213"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.241+0000: 125811: debug : virEventPollInterruptLocked:701 :
Interrupting&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3215"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21 05:31:09.241+0000:
125812: debug : virEventPollRunOnce:625 : Poll got 1 event(s)&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3217"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollDispatchTimeouts:410 : Dispatch \
0&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3219"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollDispatchHandles:455 : Dispatch \
2&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3221"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollDispatchHandles:469 : i=0 \
w=1&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3223"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollDispatchHandles:483 :
EVENT_POLL_DISPATCH_HANDLE: watch=1 events=1&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3225"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollCleanupTimeouts:501 : Cleanup \
0&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3227"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollCleanupTimeouts:537 : Found 0
out of 0 timeout slots used, releasing 0&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3229"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollCleanupHandles:549 : Cleanup \
2&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3231"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventRunDefaultImpl:244 : running default
event implementation&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3233"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollCleanupTimeouts:501 : Cleanup \
0&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3235"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollCleanupTimeouts:537 : Found 0
out of 0 timeout slots used, releasing 0&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3237"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollCleanupHandles:549 : Cleanup \
2&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3239"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollMakePollFDs:378 : Prepare n=0
w=1, f=4 e=1 d=0&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3241"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollMakePollFDs:378 : Prepare n=1
w=2, f=6 e=0 d=0&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3243"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollCalculateTimeout:320 : Calculate
expiry of 0 timers&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3245"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21 05:31:09.242+0000:
125812: debug : virEventPollCalculateTimeout:346 : Timeout at 0 due in -1 \
ms&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3247"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;b&gt;&lt;span lang=EN-US
style='font-size:9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollRunOnce:614 : EVENT_POLL_RUN:
nhandles=1 timeout=-1 &lt;&lt;hang&gt;&gt;&lt;/span&gt;&lt;/b&gt;&lt;span lang=EN-US
style='font-size:9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;


&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3247"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3247"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3247"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;b&gt;&lt;span lang=EN-US
style='font-size:9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;here
is the log snippet of  /var/log/libvirt/libvirtd.log&lt;/span&gt;&lt;/b&gt;&lt;span
lang=EN-US style='font-size:9.0pt;font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3397"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:18:26.198+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3399"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:18:41.022+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3401"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:18:56.017+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3403"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:19:11.019+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3405"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:19:26.016+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3407"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:19:41.021+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3409"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:19:56.014+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3411"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:20:11.021+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3413"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:20:26.014+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3415"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17 06:20:41.014+0000:
5052: error : daemonStreamHandleAbort:609 : stream aborted at client \
request&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3417"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:20:56.016+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3419"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:21:11.019+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3421"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:21:26.018+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3423"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:21:41.022+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3425"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:21:56.019+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3427"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:22:11.020+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3429"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:22:26.012+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3431"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-18
01:53:36.308+0000: 5052: warning : virKeepAliveTimerInternal:156 : No response
from client 0xe14160 after 5 keepalive messages in 30 seconds&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;b&gt;&lt;span lang=EN-US
style='font-size:9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-18
01:53:47.346+0000: 5052: warning : virKeepAliveTimerInternal:156 : No response
from client 0xe14c70 after 5 keepalive messages in 30 seconds
/var/log/libvirt/libvirtd.log&lt;/span&gt;&lt;/b&gt;&lt;span lang=EN-US style='font-size:9.0pt;
font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;What could be the
problem. I am running virsh (0.10.2) on RHEL6&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;Thanks for your help in
advance.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;Regards&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;Abhishek&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;


&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/body&gt;

&lt;/html&gt;



</body></email><email><emailId>20170221110705</emailId><senderName>Matt Xtlm</senderName><senderEmail>mattxtlm@gmail.com</senderEmail><timestampReceived>2017-02-21 11:07:05-0400</timestampReceived><subject>[libvirt-users] How to set manually starting date/time for guest kvm</subject><body>

Hi there,

is there a way to set a guest to start with a specific date and time. (e.g.
when guest boots, starting guest time should always be
(2017-02-05T12:00:00)).

I've tried something like this in my kvm domain:

  &lt;clock offset='variable' adjustment='-86400' basis='localtime'&gt;
    &lt;timer name='rtc' tickpolicy='delay' track='guest'/&gt;
    &lt;timer name='pit' tickpolicy='delay'/&gt;
    &lt;timer name='hpet' present='no'/&gt;
  &lt;/clock&gt;

However, i can't insert a specific date and time statement (like starting
kvm with -rtc base="2017-02-05T12:00:00").

The date/time must be set before starting the vm and must always be the
same.

Cheers,
Matt

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi there,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;is there a way to set a guest to start \
with a specific date and time. (e.g. when guest boots, starting guest time should \
always be (2017-02-05T12:00:00)).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I've tried something \
like this in my kvm domain:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;   &lt;clock \
offset='variable' adjustment='-86400' \
basis='localtime'&gt;&lt;/div&gt;&lt;div&gt;      &lt;timer name='rtc' \
tickpolicy='delay' track='guest'/&gt;&lt;/div&gt;&lt;div&gt;      &lt;timer \
name='pit' tickpolicy='delay'/&gt;&lt;/div&gt;&lt;div&gt;      &lt;timer \
name='hpet' present='no'/&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;/clock&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;However, i can't insert a specific \
date and time statement (like starting kvm with -rtc \
base="2017-02-05T12:00:00").&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The date/time must be \
set before starting the vm and must always be the \
same.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;Matt&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;




</body></email><email><emailId>20170221133607</emailId><senderName>王李明</senderName><senderEmail>wanglm@certusnet.com.cn</senderEmail><timestampReceived>2017-02-21 13:36:07-0400</timestampReceived><subject>[libvirt-users] =?utf-8?b?562U5aSNOiDnrZTlpI06ICBWaXJzaCBjb21t?= =?utf-8?q?and_hanging?=</subject><body>

UbJGR;7b MIME 8qJ=5D6`2?7VSJ&lt;~!#


I don't know whether this is a bug

because I have tried a lot of method to soluted this problem

but I alway failed

at last I have to upgrade our os version 

 

发件人: abhishek jain [mailto:abhish_jain@yahoo.com] 
发送时间: 2017年2月21日 21:33
收件人: 王李明; libvirt-users@redhat.com
主题: Re: 答复: [libvirt-users] Virsh command hanging

 

I can only use RHEL6.

 

Is it a bug in libvirt ??

 

Regards

Abhishek

 

  _____  

From: 王李明 &lt;wanglm@certusnet.com.cn&gt;
To: 'abhishek jain' &lt;abhish_jain@yahoo.com&gt;; libvirt-users@redhat.com 
Sent: Tuesday, 21 February 2017 11:54 AM
Subject: 答复: [libvirt-users] Virsh command hanging

 

I have this problem in centos6.5

when I upgrade to centos 7.1 this problem is soluted

maybe you can upgrade your os version

 

 

 

发件人: libvirt-users-bounces@redhat.com [mailto:libvirt-users-bounces@redhat.com] \
代表 abhishek jain 发送时间: 2017年2月21日 13:51
收件人: libvirt-users@redhat.com
主题: [libvirt-users] Virsh command hanging

 

Hi,

 

I started the VMs with libvirt 3 days ago (17th Feb).  Now when I am trying to \
shutdown the domain, all my virsh command is hanging even  virt-manager remains in \
"connecting.."  mode and is not showing active domains.

When   I set  the libvirt debug env and call "virsh list"  it hangs in poll. Here is \
the log

setenv LIBVIRT_DEBUG 1 virsh list

2017-02-21 05:31:09.241+0000: 125812: debug : virEventPollCalculateTimeout:320 : \
Calculate expiry of 0 timers

2017-02-21 05:31:09.241+0000: 125811: debug : virEventPollUpdateHandle:146 : \
EVENT_POLL_UPDATE_HANDLE: watch=2 events=0

2017-02-21 05:31:09.241+0000: 125812: debug : virEventPollCalculateTimeout:346 : \
Timeout at 0 due in -1 ms

2017-02-21 05:31:09.241+0000: 125812: debug : virEventPollRunOnce:614 : \
EVENT_POLL_RUN: nhandles=2 timeout=-1

2017-02-21 05:31:09.241+0000: 125811: debug : virEventPollInterruptLocked:701 : \
Interrupting

2017-02-21 05:31:09.241+0000: 125812: debug : virEventPollRunOnce:625 : Poll got 1 \
event(s)

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollDispatchTimeouts:410 : \
Dispatch 0

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollDispatchHandles:455 : \
Dispatch 2

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollDispatchHandles:469 : i=0 \
w=1

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollDispatchHandles:483 : \
EVENT_POLL_DISPATCH_HANDLE: watch=1 events=1

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollCleanupTimeouts:501 : \
Cleanup 0

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollCleanupTimeouts:537 : Found \
0 out of 0 timeout slots used, releasing 0

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollCleanupHandles:549 : \
Cleanup 2

2017-02-21 05:31:09.242+0000: 125812: debug : virEventRunDefaultImpl:244 : running \
default event implementation

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollCleanupTimeouts:501 : \
Cleanup 0

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollCleanupTimeouts:537 : Found \
0 out of 0 timeout slots used, releasing 0

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollCleanupHandles:549 : \
Cleanup 2

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollMakePollFDs:378 : Prepare \
n=0 w=1, f=4 e=1 d=0

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollMakePollFDs:378 : Prepare \
n=1 w=2, f=6 e=0 d=0

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollCalculateTimeout:320 : \
Calculate expiry of 0 timers

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollCalculateTimeout:346 : \
Timeout at 0 due in -1 ms

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollRunOnce:614 : \
EVENT_POLL_RUN: nhandles=1 timeout=-1 &lt;&lt;hang&gt;&gt;

 

 

here is the log snippet of  /var/log/libvirt/libvirtd.log

2017-02-17 06:18:26.198+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:18:41.022+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:18:56.017+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:19:11.019+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:19:26.016+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:19:41.021+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:19:56.014+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:20:11.021+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:20:26.014+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:20:41.014+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:20:56.016+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:21:11.019+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:21:26.018+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:21:41.022+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:21:56.019+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:22:11.020+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:22:26.012+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-18 01:53:36.308+0000: 5052: warning : virKeepAliveTimerInternal:156 : No \
response from client 0xe14160 after 5 keepalive messages in 30 seconds

2017-02-18 01:53:47.346+0000: 5052: warning : virKeepAliveTimerInternal:156 : No \
response from client 0xe14c70 after 5 keepalive messages in 30 seconds \
/var/log/libvirt/libvirtd.log

 

What could be the problem. I am running virsh (0.10.2) on RHEL6

 

Thanks for your help in advance.

 

Regards

Abhishek

 


[Attachment #3 (text/html)]

&lt;html xmlns:v="urn:schemas-microsoft-com:vml" \
xmlns:o="urn:schemas-microsoft-com:office:office" \
xmlns:w="urn:schemas-microsoft-com:office:word" \
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" \
xmlns="http://www.w3.org/TR/REC-html40"&gt;

&lt;head&gt;
&lt;meta http-equiv=Content-Type content="text/html; charset=utf-8"&gt;
&lt;meta name=Generator content="Microsoft Word 12 (filtered medium)"&gt;
&lt;!--[if !mso]&gt;
&lt;style&gt;
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
&lt;/style&gt;
&lt;![endif]--&gt;
&lt;style&gt;
&lt;!--
 /* Font Definitions */
 @font-face
	{font-family:Helvetica;
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:宋体;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:"\@宋体";
	panose-1:2 1 6 0 3 1 1 1 1 1;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:宋体;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:purple;
	text-decoration:underline;}
p.yiv0252501574msonormal, li.yiv0252501574msonormal, div.yiv0252501574msonormal
	{mso-style-name:yiv0252501574msonormal;
	mso-margin-top-alt:auto;
	margin-right:0cm;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	font-size:12.0pt;
	font-family:宋体;}
p.yiv0252501574msochpdefault, li.yiv0252501574msochpdefault, \
div.yiv0252501574msochpdefault  {mso-style-name:yiv0252501574msochpdefault;
	mso-margin-top-alt:auto;
	margin-right:0cm;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	font-size:12.0pt;
	font-family:宋体;}
span.yiv0252501574msohyperlink
	{mso-style-name:yiv0252501574msohyperlink;}
span.yiv0252501574msohyperlinkfollowed
	{mso-style-name:yiv0252501574msohyperlinkfollowed;}
span.yiv0252501574emailstyle17
	{mso-style-name:yiv0252501574emailstyle17;}
p.yiv0252501574msonormal1, li.yiv0252501574msonormal1, div.yiv0252501574msonormal1
	{mso-style-name:yiv0252501574msonormal1;
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:宋体;}
span.yiv0252501574msohyperlink1
	{mso-style-name:yiv0252501574msohyperlink1;
	color:blue;
	text-decoration:underline;}
span.yiv0252501574msohyperlinkfollowed1
	{mso-style-name:yiv0252501574msohyperlinkfollowed1;
	color:purple;
	text-decoration:underline;}
span.yiv0252501574emailstyle171
	{mso-style-name:yiv0252501574emailstyle171;
	color:black;}
p.yiv0252501574msochpdefault1, li.yiv0252501574msochpdefault1, \
div.yiv0252501574msochpdefault1  {mso-style-name:yiv0252501574msochpdefault1;
	mso-margin-top-alt:auto;
	margin-right:0cm;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	font-size:10.0pt;
	font-family:宋体;}
span.EmailStyle27
	{mso-style-type:personal-reply;
	font-family:"Calibri","sans-serif";
	color:black;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-size:10.0pt;}
@page Section1
	{size:612.0pt 792.0pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;}
div.Section1
	{page:Section1;}
--&gt;
&lt;/style&gt;
&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
 &lt;o:shapedefaults v:ext="edit" spidmax="1026" /&gt;
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
 &lt;o:shapelayout v:ext="edit"&gt;
  &lt;o:idmap v:ext="edit" data="1" /&gt;
 &lt;/o:shapelayout&gt;&lt;/xml&gt;&lt;![endif]--&gt;
&lt;/head&gt;

&lt;body lang=ZH-CN link=blue vlink=purple&gt;

&lt;div class=Section1&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='font-family:"Calibri","sans-serif";
color:black'&gt;I don't know whether this is a bug&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='font-family:"Calibri","sans-serif";
color:black'&gt;because I have tried a lot of method to soluted this \
problem&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='font-family:"Calibri","sans-serif";
color:black'&gt;but I alway failed&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='font-family:"Calibri","sans-serif";
color:black'&gt;at last I have to upgrade our os version &lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US style='font-family:"Calibri","sans-serif";
color:black'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div style='border:none;border-top:solid #B5C4DF 1.0pt;padding:3.0pt 0cm 0cm 0cm'&gt;

&lt;p class=MsoNormal&gt;&lt;b&gt;&lt;span style='font-size:10.0pt'&gt;发件人&lt;span \
lang=EN-US&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;span lang=EN-US style='font-size:10.0pt'&gt; abhishek \
jain [mailto:abhish_jain@yahoo.com] &lt;br&gt;
&lt;/span&gt;&lt;b&gt;&lt;span style='font-size:10.0pt'&gt;发送时间&lt;span \
lang=EN-US&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;span lang=EN-US style='font-size:10.0pt'&gt; \
2017&lt;/span&gt;&lt;span style='font-size:10.0pt'&gt;年&lt;span lang=EN-US&gt;2&lt;/span&gt;月&lt;span \
lang=EN-US&gt;21&lt;/span&gt;日&lt;span lang=EN-US&gt; 21:33&lt;br&gt; &lt;/span&gt;&lt;b&gt;收件人&lt;span \
lang=EN-US&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang=EN-US&gt; &lt;/span&gt;王李明&lt;span lang=EN-US&gt;; \
libvirt-users@redhat.com&lt;br&gt; &lt;/span&gt;&lt;b&gt;主题&lt;span lang=EN-US&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span \
lang=EN-US&gt; Re: &lt;/span&gt;答复&lt;span lang=EN-US&gt;: [libvirt-users] Virsh command \
hanging&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;p class=MsoNormal&gt;&lt;span lang=EN-US&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3770"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;I can only use \
RHEL6.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3771"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3773"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;Is it a bug in libvirt
??&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3774"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3779"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;Regards&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3780"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;Abhishek&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;


&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3781"&gt;

&lt;p class=MsoNormal style='margin-bottom:12.0pt;background:white'&gt;&lt;span
lang=EN-US style='font-size:9.0pt;font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3786"&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3785"&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3784"&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3783"&gt;

&lt;div class=MsoNormal align=center style='text-align:center;background:white'&gt;&lt;span
lang=EN-US style='font-size:10.0pt;font-family:"Arial","sans-serif";color:black'&gt;

&lt;hr size=1 width="100%" align=center&gt;

&lt;/span&gt;&lt;/div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;b&gt;&lt;span lang=EN-US
style='font-size:10.0pt;font-family:"Arial","sans-serif";color:black'&gt;From:&lt;/span&gt;&lt;/b&gt;&lt;span
 lang=EN-US style='font-size:10.0pt;font-family:"Arial","sans-serif";color:black'&gt;
&lt;/span&gt;&lt;span style='font-size:10.0pt;color:black'&gt;王李明&lt;/span&gt;&lt;span lang=EN-US
style='font-size:10.0pt;font-family:"Arial","sans-serif";color:black'&gt;
&lt;wanglm@certusnet.com.cn&gt;&lt;br&gt;
&lt;b&gt;To:&lt;/b&gt; 'abhishek jain' &lt;abhish_jain@yahoo.com&gt;;
libvirt-users@redhat.com &lt;br&gt;
&lt;b&gt;Sent:&lt;/b&gt; Tuesday, 21 February 2017 11:54 AM&lt;br&gt;
&lt;b&gt;Subject:&lt;/b&gt; &lt;/span&gt;&lt;span style='font-size:10.0pt;color:black'&gt;答复&lt;/span&gt;&lt;span
lang=EN-US style='font-size:10.0pt;font-family:"Arial","sans-serif";color:black'&gt;:
[libvirt-users] Virsh command hanging&lt;/span&gt;&lt;span lang=EN-US style='font-family:
"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3787"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-family:
"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div id=yiv0252501574&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3791"&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3790"&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3789"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-family:
"Helvetica","sans-serif";color:black'&gt;I have this problem in \
centos6.5&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3793"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-family:
"Helvetica","sans-serif";color:black'&gt;when I upgrade to centos 7.1 this problem
is soluted&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3795"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-family:
"Helvetica","sans-serif";color:black'&gt;maybe you can upgrade your os \
version&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3797"&gt;

&lt;p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
background:white'&gt;&lt;span lang=EN-US \
style='font-size:10.5pt;font-family:"Helvetica","sans-serif"; \
color:black'&gt; &lt;/span&gt;&lt;span lang=EN-US \
style='font-family:"Helvetica","sans-serif"; color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
background:white'&gt;&lt;span lang=EN-US \
style='font-size:10.5pt;font-family:"Helvetica","sans-serif"; \
color:black'&gt; &lt;/span&gt;&lt;span lang=EN-US \
style='font-family:"Helvetica","sans-serif"; color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3799"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-family:
"Helvetica","sans-serif";color:black'&gt; &lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id=yiv0252501574yqt06297&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3803"&gt;

&lt;div style='border:none;border-top:solid #B5C4DF 1.0pt;padding:3.0pt 0cm 0cm 0cm'
id="yui_3_16_0_ym19_1_1487683874205_3802"&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3801"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;b&gt;&lt;span style='font-size:10.0pt;
color:black'&gt;发件人&lt;/span&gt;&lt;/b&gt;&lt;b&gt;&lt;span lang=EN-US style='font-size:10.0pt;
font-family:"Helvetica","sans-serif";color:black'&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang=EN-US
style='font-size:10.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;
libvirt-users-bounces@redhat.com [mailto:libvirt-users-bounces@redhat.com] \
&lt;/span&gt;&lt;b&gt;&lt;span style='font-size:10.0pt;color:black'&gt;代表&lt;/span&gt;&lt;/b&gt;&lt;b&gt;&lt;span \
style='font-size: 10.0pt;font-family:"Helvetica","sans-serif";color:black'&gt; \
&lt;/span&gt;&lt;/b&gt;&lt;span lang=EN-US \
style='font-size:10.0pt;font-family:"Helvetica","sans-serif"; color:black'&gt;abhishek \
jain&lt;br&gt; &lt;/span&gt;&lt;b&gt;&lt;span \
style='font-size:10.0pt;color:black'&gt;发送时间&lt;/span&gt;&lt;/b&gt;&lt;b&gt;&lt;span lang=EN-US \
style='font-size:10.0pt;font-family:"Helvetica","sans-serif"; \
color:black'&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang=EN-US style='font-size:10.0pt;font-family: \
"Helvetica","sans-serif";color:black'&gt; 2017&lt;/span&gt;&lt;span style='font-size:10.0pt; \
color:black'&gt;年&lt;/span&gt;&lt;span lang=EN-US \
style='font-size:10.0pt;font-family:"Helvetica","sans-serif"; \
color:black'&gt;2&lt;/span&gt;&lt;span style='font-size:10.0pt;color:black'&gt;月&lt;/span&gt;&lt;span \
lang=EN-US style='font-size:10.0pt;font-family:"Helvetica","sans-serif"; \
color:black'&gt;21&lt;/span&gt;&lt;span style='font-size:10.0pt;color:black'&gt;日&lt;/span&gt;&lt;span \
lang=EN-US style='font-size:10.0pt;font-family:"Helvetica","sans-serif"; \
color:black'&gt; 13:51&lt;br&gt; &lt;/span&gt;&lt;b&gt;&lt;span \
style='font-size:10.0pt;color:black'&gt;收件人&lt;/span&gt;&lt;/b&gt;&lt;b&gt;&lt;span lang=EN-US \
style='font-size:10.0pt;font-family:"Helvetica","sans-serif"; \
color:black'&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang=EN-US style='font-size:10.0pt;font-family: \
"Helvetica","sans-serif";color:black'&gt; libvirt-users@redhat.com&lt;br&gt; &lt;/span&gt;&lt;b&gt;&lt;span \
style='font-size:10.0pt;color:black'&gt;主题&lt;/span&gt;&lt;/b&gt;&lt;b&gt;&lt;span lang=EN-US \
style='font-size:10.0pt;font-family:"Helvetica","sans-serif"; \
color:black'&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang=EN-US style='font-size:10.0pt;font-family: \
"Helvetica","sans-serif";color:black'&gt; [libvirt-users] Virsh command \
hanging&lt;/span&gt;&lt;span lang=EN-US \
style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3807"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-family:
"Helvetica","sans-serif";color:black'&gt; &lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3809"&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3018"&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3808"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;Hi,&lt;/span&gt;&lt;span
lang=EN-US style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;


&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3018"&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3810"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt; &lt;/span&gt;&lt;span
lang=EN-US style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;


&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3018"&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3812"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;I started the VMs with
libvirt 3 days ago (17th Feb).  Now when I am trying to shutdown the
domain, all my virsh command is hanging even  virt-manager remains in
"connecting.."  mode and is not showing active domains.&lt;/span&gt;&lt;span
lang=EN-US style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;


&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3018"&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3813"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;When   I set
 the libvirt debug env and call "virsh list"  it hangs in
poll. Here is the log&lt;/span&gt;&lt;span lang=EN-US \
style='font-family:"Helvetica","sans-serif"; color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3203"&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3815"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;setenv LIBVIRT_DEBUG 1
virsh list&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3205"&gt;

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3817"&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21 05:31:09.241+0000:
125812: debug : virEventPollCalculateTimeout:320 : Calculate expiry of 0 \
timers&lt;/span&gt;&lt;span lang=EN-US \
style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3207"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.241+0000: 125811: debug : virEventPollUpdateHandle:146 :
EVENT_POLL_UPDATE_HANDLE: watch=2 events=0&lt;/span&gt;&lt;span lang=EN-US
style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3209"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.241+0000: 125812: debug : virEventPollCalculateTimeout:346 : Timeout
at 0 due in -1 ms&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3211"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.241+0000: 125812: debug : virEventPollRunOnce:614 : EVENT_POLL_RUN:
nhandles=2 timeout=-1&lt;/span&gt;&lt;span lang=EN-US \
style='font-family:"Helvetica","sans-serif"; color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3213"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.241+0000: 125811: debug : virEventPollInterruptLocked:701 :
Interrupting&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3215"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.241+0000: 125812: debug : virEventPollRunOnce:625 : Poll got 1
event(s)&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3217"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollDispatchTimeouts:410 : Dispatch
0&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3219"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollDispatchHandles:455 : Dispatch \
2&lt;/span&gt;&lt;span lang=EN-US \
style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3221"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollDispatchHandles:469 : i=0 \
w=1&lt;/span&gt;&lt;span lang=EN-US \
style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3223"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollDispatchHandles:483 :
EVENT_POLL_DISPATCH_HANDLE: watch=1 events=1&lt;/span&gt;&lt;span lang=EN-US
style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3225"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollCleanupTimeouts:501 : Cleanup \
0&lt;/span&gt;&lt;span lang=EN-US \
style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3227"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollCleanupTimeouts:537 : Found 0
out of 0 timeout slots used, releasing 0&lt;/span&gt;&lt;span lang=EN-US
style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3229"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollCleanupHandles:549 : Cleanup \
2&lt;/span&gt;&lt;span lang=EN-US \
style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3231"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventRunDefaultImpl:244 : running default
event implementation&lt;/span&gt;&lt;span lang=EN-US \
style='font-family:"Helvetica","sans-serif"; color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3233"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollCleanupTimeouts:501 : Cleanup \
0&lt;/span&gt;&lt;span lang=EN-US \
style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3235"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollCleanupTimeouts:537 : Found 0
out of 0 timeout slots used, releasing 0&lt;/span&gt;&lt;span lang=EN-US
style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3237"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollCleanupHandles:549 : Cleanup \
2&lt;/span&gt;&lt;span lang=EN-US \
style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3239"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollMakePollFDs:378 : Prepare n=0
w=1, f=4 e=1 d=0&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3241"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollMakePollFDs:378 : Prepare n=1
w=2, f=6 e=0 d=0&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3243"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollCalculateTimeout:320 : Calculate
expiry of 0 timers&lt;/span&gt;&lt;span lang=EN-US \
style='font-family:"Helvetica","sans-serif"; color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3245"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollCalculateTimeout:346 : Timeout
at 0 due in -1 ms&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3247"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;b&gt;&lt;span lang=EN-US
style='font-size:9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-21
05:31:09.242+0000: 125812: debug : virEventPollRunOnce:614 : EVENT_POLL_RUN:
nhandles=1 timeout=-1 &lt;&lt;hang&gt;&gt;&lt;/span&gt;&lt;/b&gt;&lt;span lang=EN-US
style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3247"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt; &lt;/span&gt;&lt;span
lang=EN-US style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;


&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3247"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt; &lt;/span&gt;&lt;span
lang=EN-US style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;


&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3247"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;b&gt;&lt;span lang=EN-US
style='font-size:9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;here
is the log snippet of  /var/log/libvirt/libvirtd.log&lt;/span&gt;&lt;/b&gt;&lt;span
lang=EN-US style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;


&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3397"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:18:26.198+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3399"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:18:41.022+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted at
client request&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3401"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:18:56.017+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3403"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:19:11.019+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3405"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:19:26.016+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3407"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:19:41.021+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3409"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:19:56.014+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3411"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:20:11.021+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3413"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:20:26.014+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3415"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:20:41.014+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3417"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:20:56.016+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3419"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:21:11.019+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3421"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:21:26.018+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3423"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:21:41.022+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3425"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:21:56.019+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3427"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17
06:22:11.020+0000: 5052: error : daemonStreamHandleAbort:609 : stream aborted
at client request&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3429"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-17 06:22:26.012+0000:
5052: error : daemonStreamHandleAbort:609 : stream aborted at client \
request&lt;/span&gt;&lt;span lang=EN-US \
style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3431"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-18
01:53:36.308+0000: 5052: warning : virKeepAliveTimerInternal:156 : No response
from client 0xe14160 after 5 keepalive messages in 30 seconds&lt;/span&gt;&lt;span
lang=EN-US style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;


&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;b&gt;&lt;span lang=EN-US
style='font-size:9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;2017-02-18
01:53:47.346+0000: 5052: warning : virKeepAliveTimerInternal:156 : No response
from client 0xe14c70 after 5 keepalive messages in 30 seconds
/var/log/libvirt/libvirtd.log&lt;/span&gt;&lt;/b&gt;&lt;span lang=EN-US style='font-family:
"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt; &lt;/span&gt;&lt;span
lang=EN-US style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;


&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;What could be the
problem. I am running virsh (0.10.2) on RHEL6&lt;/span&gt;&lt;span lang=EN-US
style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt; &lt;/span&gt;&lt;span
lang=EN-US style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;


&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;Thanks for your help in
advance.&lt;/span&gt;&lt;span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt; &lt;/span&gt;&lt;span
lang=EN-US style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;


&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;Regards&lt;/span&gt;&lt;span
lang=EN-US style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;


&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div&gt;

&lt;p class=MsoNormal style='background:white'&gt;&lt;span lang=EN-US style='font-size:
9.0pt;font-family:"Helvetica","sans-serif";color:black'&gt;Abhishek&lt;/span&gt;&lt;span
lang=EN-US style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;


&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;p class=MsoNormal style='margin-bottom:12.0pt;background:white'&gt;&lt;span
lang=EN-US style='font-family:"Helvetica","sans-serif";color:black'&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;


&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/body&gt;

&lt;/html&gt;



</body></email><email><emailId>20170210205019</emailId><senderName>Milan Zamazal</senderName><senderEmail>mzamazal@redhat.com</senderEmail><timestampReceived>2017-02-10 20:50:19-0400</timestampReceived><subject>[libvirt-users] Determining domain job kind from job stats?</subject><body>

Hi, is there a reliable way to find out to what kind of job does the
information returned from virDomainGetJobStats or provided in
VIR_DOMAIN_EVENT_ID_JOB_COMPLETED event callback belong to?

I'm specifically interested in distinguishing host-to-host migration
jobs (e.g. those started by virDomainMigrateToUri* functions) from other
jobs.  If there is no better way, I'm thinking about examining presence
or values of certain fields in the stats.  I'd be fine with that as long
as I can be sure it's a reliable way to identify the job kind.

Thanks,
Milan

</body></email><email><emailId>20170217161801</emailId><senderName>Yunchih Chen</senderName><senderEmail>yunchih@csie.ntu.edu.tw</senderEmail><timestampReceived>2017-02-17 16:18:01-0400</timestampReceived><subject>[libvirt-users] "virsh list" hangs</subject><body>


`virsh list` hangs on my server that hosts a bunch of VMs.
This might be due to the Debian upgrade I did on Feb 15, which upgrades 
`libvirt` from 2.4.0-1 to 3.0.0-2.
I have tried restarting libvirtd for a few times, without luck.

Attached below are some relevant logs; let me know if you need some more 
for debugging.
Thanks for your help!!

root@vm-host:~# uname -a
Linux vm-host 4.6.0-1-amd64 #1 SMP Debian 4.6.4-1 (2016-07-18) x86_64 
GNU/Linux

root@vm-host:~# apt-cache policy libvirt-daemon
libvirt-daemon:
   Installed: 3.0.0-2
   Candidate: 3.0.0-2
   Version table:
  *** 3.0.0-2 500
         500 http://debian.csie.ntu.edu.tw/debian testing/main amd64 
Packages
         100 /var/lib/dpkg/status

root@vm-host:~# strace -o /tmp/trace -e trace=network,file,poll virsh 
list  # hangs forever .....
^C
root@vm-host:~# tail -10 /tmp/trace
access("/etc/libvirt/libvirt.conf", F_OK) = 0
open("/etc/libvirt/libvirt.conf", O_RDONLY) = 5
access("/proc/vz", F_OK)                = -1 ENOENT (No such file or 
directory)
socket(AF_UNIX, SOCK_STREAM, 0)         = 5
connect(5, {sa_family=AF_UNIX, 
sun_path="/var/run/libvirt/libvirt-sock"}, 110) = 0
getsockname(5, {sa_family=AF_UNIX}, [128-&gt;2]) = 0
poll([{fd=5, events=POLLOUT}, {fd=6, events=POLLIN}], 2, -1) = 1 
([{fd=5, revents=POLLOUT}])
poll([{fd=5, events=POLLIN}, {fd=6, events=POLLIN}], 2, -1) = ? 
ERESTART_RESTARTBLOCK (Interrupted by signal)
--- SIGINT {si_signo=SIGINT, si_code=SI_KERNEL} ---
+++ killed by SIGINT +++

root@vm-host:~# lsof /var/run/libvirt/libvirt-sock # hangs too ...
^C

root@vm-host:~# LIBVIRT_DEBUG=1 virsh list
2017-02-17 15:58:36.126+0000: 18505: info : libvirt version: 3.0.0, 
package: 2 (Guido Günther &lt;agx@sigxcpu.org&gt; Wed, 25 Jan 2017 07:04:08 +0100)
2017-02-17 15:58:36.126+0000: 18505: info : hostname: vm-host
2017-02-17 15:58:36.126+0000: 18505: debug : virGlobalInit:386 : 
register drivers
2017-02-17 15:58:36.127+0000: 18505: debug : 
virRegisterConnectDriver:684 : driver=0x7f1e5aca2c40 name=Test
2017-02-17 15:58:36.127+0000: 18505: debug : 
virRegisterConnectDriver:695 : registering Test as driver 0
2017-02-17 15:58:36.127+0000: 18505: debug : 
virRegisterConnectDriver:684 : driver=0x7f1e5aca4ac0 name=OPENVZ
2017-02-17 15:58:36.127+0000: 18505: debug : 
virRegisterConnectDriver:695 : registering OPENVZ as driver 1
2017-02-17 15:58:36.127+0000: 18505: debug : 
virRegisterConnectDriver:684 : driver=0x7f1e5aca5260 name=VMWARE
2017-02-17 15:58:36.127+0000: 18505: debug : 
virRegisterConnectDriver:695 : registering VMWARE as driver 2
2017-02-17 15:58:36.127+0000: 18505: debug : 
virRegisterConnectDriver:684 : driver=0x7f1e5aca3720 name=remote
2017-02-17 15:58:36.127+0000: 18505: debug : 
virRegisterConnectDriver:695 : registering remote as driver 3
2017-02-17 15:58:36.127+0000: 18505: debug : 
virEventRegisterDefaultImpl:267 : registering default event implementation
2017-02-17 15:58:36.127+0000: 18505: debug : virEventPollAddHandle:115 : 
Used 0 handle slots, adding at least 10 more
2017-02-17 15:58:36.127+0000: 18505: debug : 
virEventPollInterruptLocked:722 : Skip interrupt, 0 0
2017-02-17 15:58:36.127+0000: 18505: info : virEventPollAddHandle:140 : 
EVENT_POLL_ADD_HANDLE: watch=1 fd=3 events=1 cb=0x7f1e5a7fc140 
opaque=(nil) ff=(nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virEventRegisterImpl:234 : 
addHandle=0x7f1e5a7fc860 updateHandle=0x7f1e5a7fcb90 
removeHandle=0x7f1e5a7fc1a0 addTimeout=0x7f1e5a7fc310 
updateTimeout=0x7f1e5a7fc510 removeTimeout=0x7f1e5a7fc6e0
2017-02-17 15:58:36.127+0000: 18505: debug : virEventPollAddTimeout:230 
: Used 0 timeout slots, adding at least 10 more
2017-02-17 15:58:36.127+0000: 18505: debug : 
virEventPollInterruptLocked:722 : Skip interrupt, 0 0
2017-02-17 15:58:36.127+0000: 18505: info : virEventPollAddTimeout:253 : 
EVENT_POLL_ADD_TIMEOUT: timer=1 frequency=-1 cb=0x563a29758360 
opaque=0x7fff70941380 ff=(nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConnectOpenAuth:1245 : 
name=&lt;null&gt;, auth=0x7f1e5aca2a00, flags=0
2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 : 
OBJECT_NEW: obj=0x563a2a7f5f50 classname=virConnect
2017-02-17 15:58:36.127+0000: 18505: debug : virConfLoadConfig:1604 : 
Loading config file '/etc/libvirt/libvirt.conf'
2017-02-17 15:58:36.127+0000: 18505: debug : virConfReadFile:778 : 
filename=/etc/libvirt/libvirt.conf
2017-02-17 15:58:36.127+0000: 18506: debug : virThreadJobSet:99 : Thread 
18506 is now running job vshEventLoop
2017-02-17 15:58:36.127+0000: 18506: debug : virEventRunDefaultImpl:311 
: running default event implementation
2017-02-17 15:58:36.127+0000: 18505: debug : virFileClose:108 : Closed fd 5
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCleanupTimeouts:525 : Cleanup 1
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCleanupHandles:574 : Cleanup 1
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18506: debug : virEventPollMakePollFDs:401 
: Prepare n=0 w=1, f=3 e=1 d=0
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCalculateTimeout:338 : Calculate expiry of 1 timers
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCalculateTimeout:371 : No timeout is pending
2017-02-17 15:58:36.127+0000: 18506: info : virEventPollRunOnce:640 : 
EVENT_POLL_RUN: nhandles=1 timeout=-1
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfAddEntry:241 : Add 
entry (null) (nil)
2017-02-17 15:58:36.127+0000: 18505: debug : virConfGetValueString:932 : 
Get value string (nil) 0
2017-02-17 15:58:36.127+0000: 18505: debug : virConnectOpenInternal:1040 
: no name, allowing driver auto-select
2017-02-17 15:58:36.127+0000: 18505: debug : virConnectOpenInternal:1083 
: trying driver 0 (Test) ...
2017-02-17 15:58:36.127+0000: 18505: debug : virConnectOpenInternal:1098 
: driver 0 Test returned DECLINED
2017-02-17 15:58:36.127+0000: 18505: debug : virConnectOpenInternal:1083 
: trying driver 1 (OPENVZ) ...
2017-02-17 15:58:36.127+0000: 18505: debug : virConnectOpenInternal:1098 
: driver 1 OPENVZ returned DECLINED
2017-02-17 15:58:36.127+0000: 18505: debug : virConnectOpenInternal:1083 
: trying driver 2 (VMWARE) ...
2017-02-17 15:58:36.127+0000: 18505: debug : virConnectOpenInternal:1098 
: driver 2 VMWARE returned DECLINED
2017-02-17 15:58:36.127+0000: 18505: debug : virConnectOpenInternal:1083 
: trying driver 3 (remote) ...
2017-02-17 15:58:36.127+0000: 18505: debug : remoteConnectOpen:1343 : 
Auto-probe remote URI
2017-02-17 15:58:36.127+0000: 18505: debug : doRemoteOpen:907 : 
proceeding with name =
2017-02-17 15:58:36.127+0000: 18505: debug : doRemoteOpen:916 : 
Connecting with transport 1
2017-02-17 15:58:36.127+0000: 18505: debug : doRemoteOpen:1051 : 
Proceeding with sockname /var/run/libvirt/libvirt-sock
2017-02-17 15:58:36.127+0000: 18505: debug : 
virNetSocketNewConnectUNIX:639 : path=/var/run/libvirt/libvirt-sock 
spawnDaemon=0 binary=&lt;null&gt;
2017-02-17 15:58:36.127+0000: 18505: debug : 
virNetSocketNewConnectUNIX:703 : connect() succeeded
2017-02-17 15:58:36.127+0000: 18505: debug : virNetSocketNew:235 : 
localAddr=0x7fff70940d00 remoteAddr=0x7fff70940d90 fd=5 errfd=-1 pid=0
2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 : 
OBJECT_NEW: obj=0x563a2a7f7980 classname=virNetSocket
2017-02-17 15:58:36.127+0000: 18505: info : virNetSocketNew:291 : 
RPC_SOCKET_NEW: sock=0x563a2a7f7980 fd=5 errfd=-1 pid=0 
localAddr=127.0.0.1;0, remoteAddr=127.0.0.1;0
2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 : 
OBJECT_NEW: obj=0x563a2a7f7d80 classname=virNetClient
2017-02-17 15:58:36.127+0000: 18505: info : virNetClientNew:328 : 
RPC_CLIENT_NEW: client=0x563a2a7f7d80 sock=0x563a2a7f7980
2017-02-17 15:58:36.127+0000: 18505: info : virObjectRef:296 : 
OBJECT_REF: obj=0x563a2a7f7d80
2017-02-17 15:58:36.127+0000: 18505: info : virObjectRef:296 : 
OBJECT_REF: obj=0x563a2a7f7980
2017-02-17 15:58:36.127+0000: 18505: debug : 
virEventPollInterruptLocked:726 : Interrupting
2017-02-17 15:58:36.127+0000: 18505: info : virEventPollAddHandle:140 : 
EVENT_POLL_ADD_HANDLE: watch=2 fd=5 events=1 cb=0x7f1e5a96cd10 
opaque=0x563a2a7f7980 ff=0x7f1e5a96ccc0
2017-02-17 15:58:36.127+0000: 18505: debug : virKeepAliveNew:199 : 
client=0x563a2a7f7d80, interval=-1, count=0
2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 : 
OBJECT_NEW: obj=0x563a2a7f8080 classname=virKeepAlive
2017-02-17 15:58:36.127+0000: 18505: info : virKeepAliveNew:218 : 
RPC_KEEPALIVE_NEW: ka=0x563a2a7f8080 client=0x563a2a7f7d80
2017-02-17 15:58:36.127+0000: 18505: info : virObjectRef:296 : 
OBJECT_REF: obj=0x563a2a7f7d80
2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 : 
OBJECT_NEW: obj=0x563a2a7f6740 classname=virConnectCloseCallbackData
2017-02-17 15:58:36.127+0000: 18506: debug : virEventPollRunOnce:650 : 
Poll got 1 event(s)
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollDispatchTimeouts:432 : Dispatch 1
2017-02-17 15:58:36.127+0000: 18505: info : virObjectRef:296 : 
OBJECT_REF: obj=0x563a2a7f6740
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollDispatchHandles:478 : Dispatch 1
2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 : 
OBJECT_NEW: obj=0x563a2a7f7fa0 classname=virNetClientProgram
2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 : 
OBJECT_NEW: obj=0x563a2a7f7b60 classname=virNetClientProgram
2017-02-17 15:58:36.127+0000: 18505: info : virObjectNew:202 : 
OBJECT_NEW: obj=0x563a2a7f7910 classname=virNetClientProgram
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollDispatchHandles:492 : i=0 w=1
2017-02-17 15:58:36.127+0000: 18505: info : virObjectRef:296 : 
OBJECT_REF: obj=0x563a2a7f7fa0
2017-02-17 15:58:36.127+0000: 18506: info : 
virEventPollDispatchHandles:506 : EVENT_POLL_DISPATCH_HANDLE: watch=1 
events=1
2017-02-17 15:58:36.127+0000: 18505: info : virObjectRef:296 : 
OBJECT_REF: obj=0x563a2a7f7b60
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCleanupTimeouts:525 : Cleanup 1
2017-02-17 15:58:36.127+0000: 18505: info : virObjectRef:296 : 
OBJECT_REF: obj=0x563a2a7f7910
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCleanupHandles:574 : Cleanup 2
2017-02-17 15:58:36.127+0000: 18505: debug : doRemoteOpen:1170 : Trying 
authentication
2017-02-17 15:58:36.127+0000: 18506: debug : virEventRunDefaultImpl:311 
: running default event implementation
2017-02-17 15:58:36.127+0000: 18505: debug : virNetMessageNew:46 : 
msg=0x563a2a7fa470 tracked=0
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCleanupTimeouts:525 : Cleanup 1
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCleanupHandles:574 : Cleanup 2
2017-02-17 15:58:36.127+0000: 18506: debug : virEventPollMakePollFDs:401 
: Prepare n=0 w=1, f=3 e=1 d=0
2017-02-17 15:58:36.127+0000: 18505: debug : 
virNetMessageEncodePayload:386 : Encode length as 28
2017-02-17 15:58:36.127+0000: 18506: debug : virEventPollMakePollFDs:401 
: Prepare n=1 w=2, f=5 e=1 d=0
2017-02-17 15:58:36.127+0000: 18505: info : 
virNetClientSendInternal:2104 : RPC_CLIENT_MSG_TX_QUEUE: 
client=0x563a2a7f7d80 len=28 prog=536903814 vers=1 proc=66 type=0 
status=0 serial=0
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCalculateTimeout:338 : Calculate expiry of 1 timers
2017-02-17 15:58:36.127+0000: 18505: debug : virNetClientCallNew:2057 : 
New call 0x563a2a7f7340: msg=0x563a2a7fa470, expectReply=1, nonBlock=0
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCalculateTimeout:371 : No timeout is pending
2017-02-17 15:58:36.127+0000: 18505: debug : virNetClientIO:1866 : 
Outgoing message prog=536903814 version=1 serial=0 proc=66 type=0 
length=28 dispatch=(nil)
2017-02-17 15:58:36.127+0000: 18506: info : virEventPollRunOnce:640 : 
EVENT_POLL_RUN: nhandles=2 timeout=-1
2017-02-17 15:58:36.127+0000: 18505: debug : virNetClientIO:1925 : We 
have the buck head=0x563a2a7f7340 call=0x563a2a7f7340
2017-02-17 15:58:36.127+0000: 18505: info : virEventPollUpdateHandle:152 
: EVENT_POLL_UPDATE_HANDLE: watch=2 events=0
2017-02-17 15:58:36.127+0000: 18505: debug : 
virEventPollInterruptLocked:726 : Interrupting
2017-02-17 15:58:36.127+0000: 18506: debug : virEventPollRunOnce:650 : 
Poll got 1 event(s)
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollDispatchTimeouts:432 : Dispatch 1
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollDispatchHandles:478 : Dispatch 2
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollDispatchHandles:492 : i=0 w=1
2017-02-17 15:58:36.127+0000: 18506: info : 
virEventPollDispatchHandles:506 : EVENT_POLL_DISPATCH_HANDLE: watch=1 
events=1
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCleanupTimeouts:525 : Cleanup 1
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCleanupHandles:574 : Cleanup 2
2017-02-17 15:58:36.127+0000: 18506: debug : virEventRunDefaultImpl:311 
: running default event implementation
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCleanupTimeouts:525 : Cleanup 1
2017-02-17 15:58:36.127+0000: 18506: debug : 
virEventPollCleanupHandles:574 : Cleanup 2
2017-02-17 15:58:36.127+0000: 18506: debug : virEventPollMakePollFDs:401 
: Prepare n=0 w=1, f=3 e=1 d=0
2017-02-17 15:58:36.127+0000: 18506: debug : virEventPollMakePollFDs:401 
: Prepare n=1 w=2, f=5 e=0 d=0
2017-02-17 15:58:36.128+0000: 18506: debug : 
virEventPollCalculateTimeout:338 : Calculate expiry of 1 timers
2017-02-17 15:58:36.128+0000: 18506: debug : 
virEventPollCalculateTimeout:371 : No timeout is pending
2017-02-17 15:58:36.128+0000: 18506: info : virEventPollRunOnce:640 : 
EVENT_POLL_RUN: nhandles=1 timeout=-1
^C


-- 
--
Yun-Chih Chen 陳耘志
Network/Workstation Assistant
Dept. of Computer Science and Information Engineering
National Taiwan University
Tel: +886-2-33664888 ext. 217/204
Email: ta217@csie.ntu.edu.tw
Website: http://wslab.csie.ntu.edu.tw/

</body></email><email><emailId>20170220131048</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-02-20 13:10:48-0400</timestampReceived><subject>Re: [libvirt-users] "virsh list" hangs</subject><body>

On 17.02.2017 17:18, Yunchih Chen wrote:
&gt; 
&gt; `virsh list` hangs on my server that hosts a bunch of VMs.
&gt; This might be due to the Debian upgrade I did on Feb 15, which upgrades
&gt; `libvirt` from 2.4.0-1 to 3.0.0-2.
&gt; I have tried restarting libvirtd for a few times, without luck.
&gt; 
&gt; Attached below are some relevant logs; let me know if you need some more
&gt; for debugging.
&gt; Thanks for your help!!
&gt; 
&gt; root@vm-host:~# uname -a
&gt; Linux vm-host 4.6.0-1-amd64 #1 SMP Debian 4.6.4-1 (2016-07-18) x86_64
&gt; GNU/Linux
&gt; 
&gt; root@vm-host:~# apt-cache policy libvirt-daemon
&gt; libvirt-daemon:
&gt;   Installed: 3.0.0-2
&gt;   Candidate: 3.0.0-2
&gt;   Version table:
&gt;  *** 3.0.0-2 500
&gt;         500 http://debian.csie.ntu.edu.tw/debian testing/main amd64
&gt; Packages
&gt;         100 /var/lib/dpkg/status
&gt; 
&gt; root@vm-host:~# strace -o /tmp/trace -e trace=network,file,poll virsh
&gt; list  # hangs forever .....
&gt; ^C
&gt; root@vm-host:~# tail -10 /tmp/trace
&gt; access("/etc/libvirt/libvirt.conf", F_OK) = 0
&gt; open("/etc/libvirt/libvirt.conf", O_RDONLY) = 5
&gt; access("/proc/vz", F_OK)                = -1 ENOENT (No such file or
&gt; directory)
&gt; socket(AF_UNIX, SOCK_STREAM, 0)         = 5
&gt; connect(5, {sa_family=AF_UNIX,
&gt; sun_path="/var/run/libvirt/libvirt-sock"}, 110) = 0
&gt; getsockname(5, {sa_family=AF_UNIX}, [128-&gt;2]) = 0
&gt; poll([{fd=5, events=POLLOUT}, {fd=6, events=POLLIN}], 2, -1) = 1
&gt; ([{fd=5, revents=POLLOUT}])
&gt; poll([{fd=5, events=POLLIN}, {fd=6, events=POLLIN}], 2, -1) = ?
&gt; ERESTART_RESTARTBLOCK (Interrupted by signal)
&gt; --- SIGINT {si_signo=SIGINT, si_code=SI_KERNEL} ---
&gt; +++ killed by SIGINT +++
&gt; 
&gt; root@vm-host:~# lsof /var/run/libvirt/libvirt-sock # hangs too ...

This is very suspicious. Looks like the daemon is in some weird state
and hence virsh is unable to get list of domains.

# ps axf | grep libvirtd
# gdb -p $(pgrep libvirtd)
(gdb) t a a bt

if you could run those commands and share the output that might shed
more light.

Michal

</body></email><email><emailId>20170221040741</emailId><senderName>Yunchih Chen</senderName><senderEmail>yunchih@csie.ntu.edu.tw</senderEmail><timestampReceived>2017-02-21 04:07:41-0400</timestampReceived><subject>Re: [libvirt-users] "virsh list" hangs</subject><body>

On 02/20/2017 09:10 PM, Michal Privoznik wrote:
&gt; On 17.02.2017 17:18, Yunchih Chen wrote:
&gt;&gt; `virsh list` hangs on my server that hosts a bunch of VMs.
&gt;&gt; This might be due to the Debian upgrade I did on Feb 15, which upgrades
&gt;&gt; `libvirt` from 2.4.0-1 to 3.0.0-2.
&gt;&gt; I have tried restarting libvirtd for a few times, without luck.
&gt;&gt;
&gt;&gt; Attached below are some relevant logs; let me know if you need some more
&gt;&gt; for debugging.
&gt;&gt; Thanks for your help!!
&gt;&gt;
&gt;&gt; root@vm-host:~# uname -a
&gt;&gt; Linux vm-host 4.6.0-1-amd64 #1 SMP Debian 4.6.4-1 (2016-07-18) x86_64
&gt;&gt; GNU/Linux
&gt;&gt;
&gt;&gt; root@vm-host:~# apt-cache policy libvirt-daemon
&gt;&gt; libvirt-daemon:
&gt;&gt;    Installed: 3.0.0-2
&gt;&gt;    Candidate: 3.0.0-2
&gt;&gt;    Version table:
&gt;&gt;   *** 3.0.0-2 500
&gt;&gt;          500 http://debian.csie.ntu.edu.tw/debian testing/main amd64
&gt;&gt; Packages
&gt;&gt;          100 /var/lib/dpkg/status
&gt;&gt;
&gt;&gt; root@vm-host:~# strace -o /tmp/trace -e trace=network,file,poll virsh
&gt;&gt; list  # hangs forever .....
&gt;&gt; ^C
&gt;&gt; root@vm-host:~# tail -10 /tmp/trace
&gt;&gt; access("/etc/libvirt/libvirt.conf", F_OK) = 0
&gt;&gt; open("/etc/libvirt/libvirt.conf", O_RDONLY) = 5
&gt;&gt; access("/proc/vz", F_OK)                = -1 ENOENT (No such file or
&gt;&gt; directory)
&gt;&gt; socket(AF_UNIX, SOCK_STREAM, 0)         = 5
&gt;&gt; connect(5, {sa_family=AF_UNIX,
&gt;&gt; sun_path="/var/run/libvirt/libvirt-sock"}, 110) = 0
&gt;&gt; getsockname(5, {sa_family=AF_UNIX}, [128-&gt;2]) = 0
&gt;&gt; poll([{fd=5, events=POLLOUT}, {fd=6, events=POLLIN}], 2, -1) = 1
&gt;&gt; ([{fd=5, revents=POLLOUT}])
&gt;&gt; poll([{fd=5, events=POLLIN}, {fd=6, events=POLLIN}], 2, -1) = ?
&gt;&gt; ERESTART_RESTARTBLOCK (Interrupted by signal)
&gt;&gt; --- SIGINT {si_signo=SIGINT, si_code=SI_KERNEL} ---
&gt;&gt; +++ killed by SIGINT +++
&gt;&gt;
&gt;&gt; root@vm-host:~# lsof /var/run/libvirt/libvirt-sock # hangs too ...
&gt; This is very suspicious. Looks like the daemon is in some weird state
&gt; and hence virsh is unable to get list of domains.
&gt;
&gt; # ps axf | grep libvirtd
&gt; # gdb -p $(pgrep libvirtd)
&gt; (gdb) t a a bt
&gt;
&gt; if you could run those commands and share the output that might shed
&gt; more light.
&gt;
&gt; Michal

Unfortunately, gdb also hangs when attaching to libvirt ....

root@vm-host:~# gdb -q -p $(pgrep libvirtd)
Attaching to process 9556
[New LWP 9557]
[New LWP 9558]
[New LWP 9559]
[New LWP 9560]
[New LWP 9561]
[New LWP 9562]
[New LWP 9563]
[New LWP 9564]
[New LWP 9565]
[New LWP 9566]
[New LWP 9567]
[New LWP 9568]
[New LWP 9569]
[New LWP 9570]
[New LWP 9571]
[New LWP 9572]
^C^C^C^C^C^C^C^C^C^C^C

It must be killed with SIGKILL, and libvirtd will die with gdb.

Here[1] is the output of the following command:

strace -o /tmp/gdb-full-trace.txt -s 1024 -f gdb -q -p $(pgrep libvirtd)

Thanks for your help : )

[1] https://www.csie.ntu.edu.tw/~yunchih/s/gdb-full-trace.txt

-- 
--
Yun-Chih Chen 陳耘志
Network/Workstation Assistant
Dept. of Computer Science and Information Engineering
National Taiwan University
Tel: +886-2-33664888 ext. 217/204
Email: ta217@csie.ntu.edu.tw
Website: http://wslab.csie.ntu.edu.tw/

</body></email><email><emailId>20170224152416</emailId><senderName>Yunchih Chen</senderName><senderEmail>yunchih@csie.ntu.edu.tw</senderEmail><timestampReceived>2017-02-24 15:24:16-0400</timestampReceived><subject>Re: [libvirt-users] "virsh list" hangs</subject><body>

On 02/21/2017 12:07 PM, Yunchih Chen wrote:
&gt; On 02/20/2017 09:10 PM, Michal Privoznik wrote:
&gt;&gt; On 17.02.2017 17:18, Yunchih Chen wrote:
&gt;&gt;&gt; `virsh list` hangs on my server that hosts a bunch of VMs.
&gt;&gt;&gt; This might be due to the Debian upgrade I did on Feb 15, which upgrades
&gt;&gt;&gt; `libvirt` from 2.4.0-1 to 3.0.0-2.
&gt;&gt;&gt; I have tried restarting libvirtd for a few times, without luck.
&gt;&gt;&gt;
&gt;&gt;&gt; Attached below are some relevant logs; let me know if you need some 
&gt;&gt;&gt; more
&gt;&gt;&gt; for debugging.
&gt;&gt;&gt; Thanks for your help!!
&gt;&gt;&gt;
&gt;&gt;&gt; root@vm-host:~# uname -a
&gt;&gt;&gt; Linux vm-host 4.6.0-1-amd64 #1 SMP Debian 4.6.4-1 (2016-07-18) x86_64
&gt;&gt;&gt; GNU/Linux
&gt;&gt;&gt;
&gt;&gt;&gt; root@vm-host:~# apt-cache policy libvirt-daemon
&gt;&gt;&gt; libvirt-daemon:
&gt;&gt;&gt;    Installed: 3.0.0-2
&gt;&gt;&gt;    Candidate: 3.0.0-2
&gt;&gt;&gt;    Version table:
&gt;&gt;&gt;   *** 3.0.0-2 500
&gt;&gt;&gt;          500 http://debian.csie.ntu.edu.tw/debian testing/main amd64
&gt;&gt;&gt; Packages
&gt;&gt;&gt;          100 /var/lib/dpkg/status
&gt;&gt;&gt;
&gt;&gt;&gt; root@vm-host:~# strace -o /tmp/trace -e trace=network,file,poll virsh
&gt;&gt;&gt; list  # hangs forever .....
&gt;&gt;&gt; ^C
&gt;&gt;&gt; root@vm-host:~# tail -10 /tmp/trace
&gt;&gt;&gt; access("/etc/libvirt/libvirt.conf", F_OK) = 0
&gt;&gt;&gt; open("/etc/libvirt/libvirt.conf", O_RDONLY) = 5
&gt;&gt;&gt; access("/proc/vz", F_OK)                = -1 ENOENT (No such file or
&gt;&gt;&gt; directory)
&gt;&gt;&gt; socket(AF_UNIX, SOCK_STREAM, 0)         = 5
&gt;&gt;&gt; connect(5, {sa_family=AF_UNIX,
&gt;&gt;&gt; sun_path="/var/run/libvirt/libvirt-sock"}, 110) = 0
&gt;&gt;&gt; getsockname(5, {sa_family=AF_UNIX}, [128-&gt;2]) = 0
&gt;&gt;&gt; poll([{fd=5, events=POLLOUT}, {fd=6, events=POLLIN}], 2, -1) = 1
&gt;&gt;&gt; ([{fd=5, revents=POLLOUT}])
&gt;&gt;&gt; poll([{fd=5, events=POLLIN}, {fd=6, events=POLLIN}], 2, -1) = ?
&gt;&gt;&gt; ERESTART_RESTARTBLOCK (Interrupted by signal)
&gt;&gt;&gt; --- SIGINT {si_signo=SIGINT, si_code=SI_KERNEL} ---
&gt;&gt;&gt; +++ killed by SIGINT +++
&gt;&gt;&gt;
&gt;&gt;&gt; root@vm-host:~# lsof /var/run/libvirt/libvirt-sock # hangs too ...
&gt;&gt; This is very suspicious. Looks like the daemon is in some weird state
&gt;&gt; and hence virsh is unable to get list of domains.
&gt;&gt;
&gt;&gt; # ps axf | grep libvirtd
&gt;&gt; # gdb -p $(pgrep libvirtd)
&gt;&gt; (gdb) t a a bt
&gt;&gt;
&gt;&gt; if you could run those commands and share the output that might shed
&gt;&gt; more light.
&gt;&gt;
&gt;&gt; Michal
&gt;
&gt; Unfortunately, gdb also hangs when attaching to libvirt ....
&gt;
&gt; root@vm-host:~# gdb -q -p $(pgrep libvirtd)
&gt; Attaching to process 9556
&gt; [New LWP 9557]
&gt; [New LWP 9558]
&gt; [New LWP 9559]
&gt; [New LWP 9560]
&gt; [New LWP 9561]
&gt; [New LWP 9562]
&gt; [New LWP 9563]
&gt; [New LWP 9564]
&gt; [New LWP 9565]
&gt; [New LWP 9566]
&gt; [New LWP 9567]
&gt; [New LWP 9568]
&gt; [New LWP 9569]
&gt; [New LWP 9570]
&gt; [New LWP 9571]
&gt; [New LWP 9572]
&gt; ^C^C^C^C^C^C^C^C^C^C^C
&gt;
&gt; It must be killed with SIGKILL, and libvirtd will die with gdb.
&gt;
&gt; Here[1] is the output of the following command:
&gt;
&gt; strace -o /tmp/gdb-full-trace.txt -s 1024 -f gdb -q -p $(pgrep libvirtd)
&gt;
&gt; Thanks for your help : )
&gt;
&gt; [1] https://www.csie.ntu.edu.tw/~yunchih/s/gdb-full-trace.txt
&gt;
Any update on this?  What other debug info could I provide?

I just enable libvirtd's debug option and here[1] is the output.

[1] https://www.csie.ntu.edu.tw/~yunchih/s/libvirtd-debug.log


-- 
--
Yun-Chih Chen 陳耘志
Network/Workstation Assistant
Dept. of Computer Science and Information Engineering
National Taiwan University
Tel: +886-2-33664888 ext. 217/204
Email: ta217@csie.ntu.edu.tw
Website: http://wslab.csie.ntu.edu.tw/

</body></email><email><emailId>20170226172959</emailId><senderName>Kyle Peterson</senderName><senderEmail>kyle.peterson1@gmail.com</senderEmail><timestampReceived>2017-02-26 17:29:59-0400</timestampReceived><subject>[libvirt-users] error : Failed to switch root mount into slave mode: Permission denied</subject><body>

libvirt-3.0.0

When attemping to create a virtual machine I receive the error "error : Failed to \
switch root mount into slave mode: Permission denied".

I'm attempting to run qemu/libvirt/virt-manager in an Arch Linux lxc container on a \
Ubuntu 16.04 host.  The host uses zfs for its containers.  The arch container is set \
up as a priveleged container.  I do already have kvm/qemu/libvirt working in a Ubuntu \
container.  The reason for the arch container is because I want to try a newer \
version of qemu/libvirt.

I'm not finding anything on google about this error message.  Any way to get around \
it?

[root@arch ~]# uname -a
Linux arch 4.8.0-39-generic #42~16.04.1-Ubuntu SMP Mon Feb 20 15:06:07 UTC 2017 \
x86_64 GNU/Linux

[root@arch ~]# cat /proc/mounts
storage/lxd_root/containers/arch / zfs rw,noatime,xattr,posixacl 0 0
none /dev tmpfs rw,relatime,size=492k,mode=755 0 0
proc /proc proc rw,nosuid,nodev,noexec,relatime 0 0
proc /proc/sys/net proc rw,nosuid,nodev,noexec,relatime 0 0
proc /proc/sys proc ro,nosuid,nodev,noexec,relatime 0 0
proc /proc/sysrq-trigger proc ro,nosuid,nodev,noexec,relatime 0 0
sysfs /sys sysfs rw,nosuid,nodev,noexec,relatime 0 0
sysfs /sys sysfs ro,nosuid,nodev,noexec,relatime 0 0
sysfs /sys/devices/virtual/net sysfs rw,relatime 0 0
sysfs /sys/devices/virtual/net sysfs rw,nosuid,nodev,noexec,relatime 0 0
mqueue /dev/mqueue mqueue rw,relatime 0 0
udev /dev/fuse devtmpfs rw,nosuid,relatime,size=8179548k,nr_inodes=2044887,mode=755 0 \
0 udev /dev/net/tun devtmpfs \
rw,nosuid,relatime,size=8179548k,nr_inodes=2044887,mode=755 0 0 binfmt_misc \
/proc/sys/fs/binfmt_misc binfmt_misc rw,relatime 0 0 fusectl /sys/fs/fuse/connections \
fusectl rw,relatime 0 0 pstore /sys/fs/pstore pstore rw,nosuid,nodev,noexec,relatime \
0 0 debugfs /sys/kernel/debug debugfs rw,relatime 0 0
securityfs /sys/kernel/security securityfs rw,nosuid,nodev,noexec,relatime 0 0
rpool/ROOT/ubuntu /dev/lxd zfs rw,relatime,xattr,noacl 0 0
rpool/ROOT/ubuntu /dev/kvm zfs rw,relatime,xattr,noacl 0 0
rpool/ROOT/ubuntu /dev/mem zfs rw,relatime,xattr,noacl 0 0
storage/downloads /mnt/downloads zfs rw,noatime,xattr,posixacl 0 0
storage/kvm_root/iso /mnt/iso zfs rw,noatime,xattr,posixacl 0 0
rpool/ROOT/ubuntu /dev/.lxd-mounts zfs rw,relatime,xattr,noacl 0 0
lxcfs /proc/cpuinfo fuse.lxcfs \
rw,nosuid,nodev,relatime,user_id=0,group_id=0,allow_other 0 0 lxcfs /proc/diskstats \
fuse.lxcfs rw,nosuid,nodev,relatime,user_id=0,group_id=0,allow_other 0 0 lxcfs \
/proc/meminfo fuse.lxcfs rw,nosuid,nodev,relatime,user_id=0,group_id=0,allow_other 0 \
0 lxcfs /proc/stat fuse.lxcfs \
rw,nosuid,nodev,relatime,user_id=0,group_id=0,allow_other 0 0 lxcfs /proc/swaps \
fuse.lxcfs rw,nosuid,nodev,relatime,user_id=0,group_id=0,allow_other 0 0 lxcfs \
/proc/uptime fuse.lxcfs rw,nosuid,nodev,relatime,user_id=0,group_id=0,allow_other 0 0 \
devpts /dev/console devpts rw,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=000 0 0 \
devpts /dev/pts devpts rw,relatime,gid=5,mode=620,ptmxmode=666 0 0 tmpfs /dev/shm \
tmpfs rw,nosuid,nodev 0 0 tmpfs /run tmpfs rw,nosuid,nodev,mode=755 0 0
tmpfs /sys/fs/cgroup tmpfs ro,nosuid,nodev,noexec,mode=755 0 0
cgroup /sys/fs/cgroup/systemd cgroup \
rw,nosuid,nodev,noexec,relatime,xattr,release_agent=/lib/systemd/systemd-cgroups-agent,name=systemd \
0 0 cgroup /sys/fs/cgroup/memory cgroup rw,nosuid,nodev,noexec,relatime,memory 0 0
cgroup /sys/fs/cgroup/cpu,cpuacct cgroup rw,nosuid,nodev,noexec,relatime,cpu,cpuacct \
0 0 cgroup /sys/fs/cgroup/net_cls,net_prio cgroup \
rw,nosuid,nodev,noexec,relatime,net_cls,net_prio 0 0 cgroup /sys/fs/cgroup/cpuset \
cgroup rw,nosuid,nodev,noexec,relatime,cpuset 0 0 cgroup /sys/fs/cgroup/perf_event \
cgroup rw,nosuid,nodev,noexec,relatime,perf_event 0 0 cgroup /sys/fs/cgroup/pids \
cgroup rw,nosuid,nodev,noexec,relatime,pids 0 0 cgroup /sys/fs/cgroup/devices cgroup \
rw,nosuid,nodev,noexec,relatime,devices 0 0 cgroup /sys/fs/cgroup/blkio cgroup \
rw,nosuid,nodev,noexec,relatime,blkio 0 0 cgroup /sys/fs/cgroup/freezer cgroup \
rw,nosuid,nodev,noexec,relatime,freezer 0 0 cgroup /sys/fs/cgroup/hugetlb cgroup \
rw,nosuid,nodev,noexec,relatime,hugetlb 0 0 hugetlbfs /dev/hugepages hugetlbfs \
rw,relatime 0 0 tmpfs /tmp tmpfs rw,nosuid,nodev 0 0
tmpfs /run/user/0 tmpfs rw,nosuid,nodev,relatime,size=1646852k,mode=700 0 0


</body></email><email><emailId>20170224153019</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-02-24 15:30:19-0400</timestampReceived><subject>Re: [libvirt-users] "virsh list" hangs</subject><body>

On Tue, Feb 21, 2017 at 12:07:41PM +0800, Yunchih Chen wrote:
&gt; On 02/20/2017 09:10 PM, Michal Privoznik wrote:
&gt; &gt; On 17.02.2017 17:18, Yunchih Chen wrote:
&gt; &gt; &gt; `virsh list` hangs on my server that hosts a bunch of VMs.
&gt; &gt; &gt; This might be due to the Debian upgrade I did on Feb 15, which upgrades
&gt; &gt; &gt; `libvirt` from 2.4.0-1 to 3.0.0-2.
&gt; &gt; &gt; I have tried restarting libvirtd for a few times, without luck.
&gt; &gt; &gt; 
&gt; &gt; &gt; Attached below are some relevant logs; let me know if you need some more
&gt; &gt; &gt; for debugging.
&gt; &gt; &gt; Thanks for your help!!
&gt; &gt; &gt; 
&gt; &gt; &gt; root@vm-host:~# uname -a
&gt; &gt; &gt; Linux vm-host 4.6.0-1-amd64 #1 SMP Debian 4.6.4-1 (2016-07-18) x86_64
&gt; &gt; &gt; GNU/Linux
&gt; &gt; &gt; 
&gt; &gt; &gt; root@vm-host:~# apt-cache policy libvirt-daemon
&gt; &gt; &gt; libvirt-daemon:
&gt; &gt; &gt;    Installed: 3.0.0-2
&gt; &gt; &gt;    Candidate: 3.0.0-2
&gt; &gt; &gt;    Version table:
&gt; &gt; &gt;   *** 3.0.0-2 500
&gt; &gt; &gt;          500 http://debian.csie.ntu.edu.tw/debian testing/main amd64
&gt; &gt; &gt; Packages
&gt; &gt; &gt;          100 /var/lib/dpkg/status
&gt; &gt; &gt; 
&gt; &gt; &gt; root@vm-host:~# strace -o /tmp/trace -e trace=network,file,poll virsh
&gt; &gt; &gt; list  # hangs forever .....
&gt; &gt; &gt; ^C
&gt; &gt; &gt; root@vm-host:~# tail -10 /tmp/trace
&gt; &gt; &gt; access("/etc/libvirt/libvirt.conf", F_OK) = 0
&gt; &gt; &gt; open("/etc/libvirt/libvirt.conf", O_RDONLY) = 5
&gt; &gt; &gt; access("/proc/vz", F_OK)                = -1 ENOENT (No such file or
&gt; &gt; &gt; directory)
&gt; &gt; &gt; socket(AF_UNIX, SOCK_STREAM, 0)         = 5
&gt; &gt; &gt; connect(5, {sa_family=AF_UNIX,
&gt; &gt; &gt; sun_path="/var/run/libvirt/libvirt-sock"}, 110) = 0
&gt; &gt; &gt; getsockname(5, {sa_family=AF_UNIX}, [128-&gt;2]) = 0
&gt; &gt; &gt; poll([{fd=5, events=POLLOUT}, {fd=6, events=POLLIN}], 2, -1) = 1
&gt; &gt; &gt; ([{fd=5, revents=POLLOUT}])
&gt; &gt; &gt; poll([{fd=5, events=POLLIN}, {fd=6, events=POLLIN}], 2, -1) = ?
&gt; &gt; &gt; ERESTART_RESTARTBLOCK (Interrupted by signal)
&gt; &gt; &gt; --- SIGINT {si_signo=SIGINT, si_code=SI_KERNEL} ---
&gt; &gt; &gt; +++ killed by SIGINT +++
&gt; &gt; &gt; 
&gt; &gt; &gt; root@vm-host:~# lsof /var/run/libvirt/libvirt-sock # hangs too ...
&gt; &gt; This is very suspicious. Looks like the daemon is in some weird state
&gt; &gt; and hence virsh is unable to get list of domains.
&gt; &gt; 
&gt; &gt; # ps axf | grep libvirtd
&gt; &gt; # gdb -p $(pgrep libvirtd)
&gt; &gt; (gdb) t a a bt
&gt; &gt; 
&gt; &gt; if you could run those commands and share the output that might shed
&gt; &gt; more light.
&gt; &gt; 
&gt; &gt; Michal
&gt; 
&gt; Unfortunately, gdb also hangs when attaching to libvirt ....
&gt; 
&gt; root@vm-host:~# gdb -q -p $(pgrep libvirtd)
&gt; Attaching to process 9556
&gt; [New LWP 9557]
&gt; [New LWP 9558]
&gt; [New LWP 9559]
&gt; [New LWP 9560]
&gt; [New LWP 9561]
&gt; [New LWP 9562]
&gt; [New LWP 9563]
&gt; [New LWP 9564]
&gt; [New LWP 9565]
&gt; [New LWP 9566]
&gt; [New LWP 9567]
&gt; [New LWP 9568]
&gt; [New LWP 9569]
&gt; [New LWP 9570]
&gt; [New LWP 9571]
&gt; [New LWP 9572]
&gt; ^C^C^C^C^C^C^C^C^C^C^C
&gt; 
&gt; It must be killed with SIGKILL, and libvirtd will die with gdb.
&gt; 
&gt; Here[1] is the output of the following command:
&gt;
&gt; strace -o /tmp/gdb-full-trace.txt -s 1024 -f gdb -q -p $(pgrep libvirtd)

Err, that is useless - you've just straced GDB, not libvirtd

You need to strace libvirtd as it starts

   strace -o libvirt.log -f -s 1000 /usr/sbin/libvirtd

Regards,
Daniel
-- 
|: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
|: http://libvirt.org              -o-             http://virt-manager.org :|
|: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|

</body></email><email><emailId>20170224153248</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-02-24 15:32:48-0400</timestampReceived><subject>Re: [libvirt-users] "virsh list" hangs</subject><body>

On Fri, Feb 24, 2017 at 11:24:16PM +0800, Yunchih Chen wrote:
&gt; On 02/21/2017 12:07 PM, Yunchih Chen wrote:
&gt; &gt; On 02/20/2017 09:10 PM, Michal Privoznik wrote:
&gt; &gt; &gt; On 17.02.2017 17:18, Yunchih Chen wrote:
&gt; &gt; &gt; &gt; `virsh list` hangs on my server that hosts a bunch of VMs.
&gt; &gt; &gt; &gt; This might be due to the Debian upgrade I did on Feb 15, which upgrades
&gt; &gt; &gt; &gt; `libvirt` from 2.4.0-1 to 3.0.0-2.
&gt; &gt; &gt; &gt; I have tried restarting libvirtd for a few times, without luck.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Attached below are some relevant logs; let me know if you need
&gt; &gt; &gt; &gt; some more
&gt; &gt; &gt; &gt; for debugging.
&gt; &gt; &gt; &gt; Thanks for your help!!
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; root@vm-host:~# uname -a
&gt; &gt; &gt; &gt; Linux vm-host 4.6.0-1-amd64 #1 SMP Debian 4.6.4-1 (2016-07-18) x86_64
&gt; &gt; &gt; &gt; GNU/Linux
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; root@vm-host:~# apt-cache policy libvirt-daemon
&gt; &gt; &gt; &gt; libvirt-daemon:
&gt; &gt; &gt; &gt; Installed: 3.0.0-2
&gt; &gt; &gt; &gt; Candidate: 3.0.0-2
&gt; &gt; &gt; &gt; Version table:
&gt; &gt; &gt; &gt; *** 3.0.0-2 500
&gt; &gt; &gt; &gt; 500 http://debian.csie.ntu.edu.tw/debian testing/main amd64
&gt; &gt; &gt; &gt; Packages
&gt; &gt; &gt; &gt; 100 /var/lib/dpkg/status
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; root@vm-host:~# strace -o /tmp/trace -e trace=network,file,poll virsh
&gt; &gt; &gt; &gt; list  # hangs forever .....
&gt; &gt; &gt; &gt; ^C
&gt; &gt; &gt; &gt; root@vm-host:~# tail -10 /tmp/trace
&gt; &gt; &gt; &gt; access("/etc/libvirt/libvirt.conf", F_OK) = 0
&gt; &gt; &gt; &gt; open("/etc/libvirt/libvirt.conf", O_RDONLY) = 5
&gt; &gt; &gt; &gt; access("/proc/vz", F_OK)                = -1 ENOENT (No such file or
&gt; &gt; &gt; &gt; directory)
&gt; &gt; &gt; &gt; socket(AF_UNIX, SOCK_STREAM, 0)         = 5
&gt; &gt; &gt; &gt; connect(5, {sa_family=AF_UNIX,
&gt; &gt; &gt; &gt; sun_path="/var/run/libvirt/libvirt-sock"}, 110) = 0
&gt; &gt; &gt; &gt; getsockname(5, {sa_family=AF_UNIX}, [128-&gt;2]) = 0
&gt; &gt; &gt; &gt; poll([{fd=5, events=POLLOUT}, {fd=6, events=POLLIN}], 2, -1) = 1
&gt; &gt; &gt; &gt; ([{fd=5, revents=POLLOUT}])
&gt; &gt; &gt; &gt; poll([{fd=5, events=POLLIN}, {fd=6, events=POLLIN}], 2, -1) = ?
&gt; &gt; &gt; &gt; ERESTART_RESTARTBLOCK (Interrupted by signal)
&gt; &gt; &gt; &gt; --- SIGINT {si_signo=SIGINT, si_code=SI_KERNEL} ---
&gt; &gt; &gt; &gt; +++ killed by SIGINT +++
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; root@vm-host:~# lsof /var/run/libvirt/libvirt-sock # hangs too ...
&gt; &gt; &gt; This is very suspicious. Looks like the daemon is in some weird state
&gt; &gt; &gt; and hence virsh is unable to get list of domains.
&gt; &gt; &gt; 
&gt; &gt; &gt; # ps axf | grep libvirtd
&gt; &gt; &gt; # gdb -p $(pgrep libvirtd)
&gt; &gt; &gt; (gdb) t a a bt
&gt; &gt; &gt; 
&gt; &gt; &gt; if you could run those commands and share the output that might shed
&gt; &gt; &gt; more light.
&gt; &gt; &gt; 
&gt; &gt; &gt; Michal
&gt; &gt; 
&gt; &gt; Unfortunately, gdb also hangs when attaching to libvirt ....
&gt; &gt; 
&gt; &gt; root@vm-host:~# gdb -q -p $(pgrep libvirtd)
&gt; &gt; Attaching to process 9556
&gt; &gt; [New LWP 9557]
&gt; &gt; [New LWP 9558]
&gt; &gt; [New LWP 9559]
&gt; &gt; [New LWP 9560]
&gt; &gt; [New LWP 9561]
&gt; &gt; [New LWP 9562]
&gt; &gt; [New LWP 9563]
&gt; &gt; [New LWP 9564]
&gt; &gt; [New LWP 9565]
&gt; &gt; [New LWP 9566]
&gt; &gt; [New LWP 9567]
&gt; &gt; [New LWP 9568]
&gt; &gt; [New LWP 9569]
&gt; &gt; [New LWP 9570]
&gt; &gt; [New LWP 9571]
&gt; &gt; [New LWP 9572]
&gt; &gt; ^C^C^C^C^C^C^C^C^C^C^C
&gt; &gt; 
&gt; &gt; It must be killed with SIGKILL, and libvirtd will die with gdb.
&gt; &gt; 
&gt; &gt; Here[1] is the output of the following command:
&gt; &gt; 
&gt; &gt; strace -o /tmp/gdb-full-trace.txt -s 1024 -f gdb -q -p $(pgrep libvirtd)
&gt; &gt; 
&gt; &gt; Thanks for your help : )
&gt; &gt; 
&gt; &gt; [1] https://www.csie.ntu.edu.tw/~yunchih/s/gdb-full-trace.txt
&gt; &gt; 
&gt; Any update on this?  What other debug info could I provide?
&gt; 
&gt; I just enable libvirtd's debug option and here[1] is the output.
&gt; 
&gt; [1] https://www.csie.ntu.edu.tw/~yunchih/s/libvirtd-debug.log

So that shows many lines like:

2017-02-24 15:20:47.667+0000: 15887: debug : virStorageFileGetMetadataInternal:939 : \
path=/home/xxxx/install-virt.sh, buf=0x7f1d3810e580, len=1237, meta-&gt;format=-1 \
2017-02-24 15:20:47.667+0000: 15887: debug : virStorageFileProbeFormatFromBuf:808 : \
path=/home/xxxx/install-virt.sh, buf=0x7f1d3810e580, buflen=1237 2017-02-24 \
15:20:47.667+0000: 15887: debug : virStorageFileProbeFormatFromBuf:845 : format=1 \
2017-02-24 15:20:47.667+0000: 15887: debug : virFileClose:108 : Closed fd 19


It looks like you have configured a libvirt storage pool against your
home directory, which is a pretty unusual thing todo. That shoudln't
break things though but it will make the storage pool list 100's of
irrelevant file that aren't VM disk images.

Regards,
Daniel
-- 
&gt; &gt; http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
&gt; &gt; http://libvirt.org              -o-             http://virt-manager.org :|
&gt; &gt; http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|


</body></email><email><emailId>20170224155243</emailId><senderName>Yunchih Chen</senderName><senderEmail>yunchih@csie.ntu.edu.tw</senderEmail><timestampReceived>2017-02-24 15:52:43-0400</timestampReceived><subject>Re: [libvirt-users] "virsh list" hangs</subject><body>

On 02/24/2017 11:30 PM, Daniel P. Berrange wrote:
&gt; On Tue, Feb 21, 2017 at 12:07:41PM +0800, Yunchih Chen wrote:
&gt;&gt; On 02/20/2017 09:10 PM, Michal Privoznik wrote:
&gt;&gt;&gt; On 17.02.2017 17:18, Yunchih Chen wrote:
&gt;&gt;&gt;&gt; `virsh list` hangs on my server that hosts a bunch of VMs.
&gt;&gt;&gt;&gt; This might be due to the Debian upgrade I did on Feb 15, which upgrades
&gt;&gt;&gt;&gt; `libvirt` from 2.4.0-1 to 3.0.0-2.
&gt;&gt;&gt;&gt; I have tried restarting libvirtd for a few times, without luck.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Attached below are some relevant logs; let me know if you need some more
&gt;&gt;&gt;&gt; for debugging.
&gt;&gt;&gt;&gt; Thanks for your help!!
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; root@vm-host:~# uname -a
&gt;&gt;&gt;&gt; Linux vm-host 4.6.0-1-amd64 #1 SMP Debian 4.6.4-1 (2016-07-18) x86_64
&gt;&gt;&gt;&gt; GNU/Linux
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; root@vm-host:~# apt-cache policy libvirt-daemon
&gt;&gt;&gt;&gt; libvirt-daemon:
&gt;&gt;&gt;&gt;     Installed: 3.0.0-2
&gt;&gt;&gt;&gt;     Candidate: 3.0.0-2
&gt;&gt;&gt;&gt;     Version table:
&gt;&gt;&gt;&gt;    *** 3.0.0-2 500
&gt;&gt;&gt;&gt;           500 http://debian.csie.ntu.edu.tw/debian testing/main amd64
&gt;&gt;&gt;&gt; Packages
&gt;&gt;&gt;&gt;           100 /var/lib/dpkg/status
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; root@vm-host:~# strace -o /tmp/trace -e trace=network,file,poll virsh
&gt;&gt;&gt;&gt; list  # hangs forever .....
&gt;&gt;&gt;&gt; ^C
&gt;&gt;&gt;&gt; root@vm-host:~# tail -10 /tmp/trace
&gt;&gt;&gt;&gt; access("/etc/libvirt/libvirt.conf", F_OK) = 0
&gt;&gt;&gt;&gt; open("/etc/libvirt/libvirt.conf", O_RDONLY) = 5
&gt;&gt;&gt;&gt; access("/proc/vz", F_OK)                = -1 ENOENT (No such file or
&gt;&gt;&gt;&gt; directory)
&gt;&gt;&gt;&gt; socket(AF_UNIX, SOCK_STREAM, 0)         = 5
&gt;&gt;&gt;&gt; connect(5, {sa_family=AF_UNIX,
&gt;&gt;&gt;&gt; sun_path="/var/run/libvirt/libvirt-sock"}, 110) = 0
&gt;&gt;&gt;&gt; getsockname(5, {sa_family=AF_UNIX}, [128-&gt;2]) = 0
&gt;&gt;&gt;&gt; poll([{fd=5, events=POLLOUT}, {fd=6, events=POLLIN}], 2, -1) = 1
&gt;&gt;&gt;&gt; ([{fd=5, revents=POLLOUT}])
&gt;&gt;&gt;&gt; poll([{fd=5, events=POLLIN}, {fd=6, events=POLLIN}], 2, -1) = ?
&gt;&gt;&gt;&gt; ERESTART_RESTARTBLOCK (Interrupted by signal)
&gt;&gt;&gt;&gt; --- SIGINT {si_signo=SIGINT, si_code=SI_KERNEL} ---
&gt;&gt;&gt;&gt; +++ killed by SIGINT +++
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; root@vm-host:~# lsof /var/run/libvirt/libvirt-sock # hangs too ...
&gt;&gt;&gt; This is very suspicious. Looks like the daemon is in some weird state
&gt;&gt;&gt; and hence virsh is unable to get list of domains.
&gt;&gt;&gt;
&gt;&gt;&gt; # ps axf | grep libvirtd
&gt;&gt;&gt; # gdb -p $(pgrep libvirtd)
&gt;&gt;&gt; (gdb) t a a bt
&gt;&gt;&gt;
&gt;&gt;&gt; if you could run those commands and share the output that might shed
&gt;&gt;&gt; more light.
&gt;&gt;&gt;
&gt;&gt;&gt; Michal
&gt;&gt; Unfortunately, gdb also hangs when attaching to libvirt ....
&gt;&gt;
&gt;&gt; root@vm-host:~# gdb -q -p $(pgrep libvirtd)
&gt;&gt; Attaching to process 9556
&gt;&gt; [New LWP 9557]
&gt;&gt; [New LWP 9558]
&gt;&gt; [New LWP 9559]
&gt;&gt; [New LWP 9560]
&gt;&gt; [New LWP 9561]
&gt;&gt; [New LWP 9562]
&gt;&gt; [New LWP 9563]
&gt;&gt; [New LWP 9564]
&gt;&gt; [New LWP 9565]
&gt;&gt; [New LWP 9566]
&gt;&gt; [New LWP 9567]
&gt;&gt; [New LWP 9568]
&gt;&gt; [New LWP 9569]
&gt;&gt; [New LWP 9570]
&gt;&gt; [New LWP 9571]
&gt;&gt; [New LWP 9572]
&gt;&gt; ^C^C^C^C^C^C^C^C^C^C^C
&gt;&gt;
&gt;&gt; It must be killed with SIGKILL, and libvirtd will die with gdb.
&gt;&gt;
&gt;&gt; Here[1] is the output of the following command:
&gt;&gt;
&gt;&gt; strace -o /tmp/gdb-full-trace.txt -s 1024 -f gdb -q -p $(pgrep libvirtd)
&gt; Err, that is useless - you've just straced GDB, not libvirtd
&gt;
&gt; You need to strace libvirtd as it starts
&gt;
&gt;     strace -o libvirt.log -f -s 1000 /usr/sbin/libvirtd
&gt;
&gt; Regards,
&gt; Daniel
Here[1] is the output of the above command.

[1] https://www.csie.ntu.edu.tw/~yunchih/s/libvirtd-strace.log

-- 
--
Yun-Chih Chen 陳耘志
Network/Workstation Assistant
Dept. of Computer Science and Information Engineering
National Taiwan University
Tel: +886-2-33664888 ext. 217/204
Email: ta217@csie.ntu.edu.tw
Website: http://wslab.csie.ntu.edu.tw/


[Attachment #3 (text/html)]

&lt;html&gt;
  &lt;head&gt;
    &lt;meta content="text/html; charset=utf-8" http-equiv="Content-Type"&gt;
  &lt;/head&gt;
  &lt;body bgcolor="#FFFFFF" text="#000000"&gt;
    &lt;p&gt;&lt;br&gt;
    &lt;/p&gt;
    &lt;br&gt;
    &lt;div class="moz-cite-prefix"&gt;On 02/24/2017 11:30 PM, Daniel P.
      Berrange wrote:&lt;br&gt;
    &lt;/div&gt;
    &lt;blockquote cite="mid:20170224153019.GB17452@redhat.com" type="cite"&gt;
      &lt;pre wrap=""&gt;On Tue, Feb 21, 2017 at 12:07:41PM +0800, Yunchih Chen wrote:
&lt;/pre&gt;
      &lt;blockquote type="cite"&gt;
        &lt;pre wrap=""&gt;On 02/20/2017 09:10 PM, Michal Privoznik wrote:
&lt;/pre&gt;
        &lt;blockquote type="cite"&gt;
          &lt;pre wrap=""&gt;On 17.02.2017 17:18, Yunchih Chen wrote:
&lt;/pre&gt;
          &lt;blockquote type="cite"&gt;
            &lt;pre wrap=""&gt;`virsh list` hangs on my server that hosts a bunch of VMs.
This might be due to the Debian upgrade I did on Feb 15, which upgrades
`libvirt` from 2.4.0-1 to 3.0.0-2.
I have tried restarting libvirtd for a few times, without luck.

Attached below are some relevant logs; let me know if you need some more
for debugging.
Thanks for your help!!

root@vm-host:~# uname -a
Linux vm-host 4.6.0-1-amd64 #1 SMP Debian 4.6.4-1 (2016-07-18) x86_64
GNU/Linux

root@vm-host:~# apt-cache policy libvirt-daemon
libvirt-daemon:
   Installed: 3.0.0-2
   Candidate: 3.0.0-2
   Version table:
  *** 3.0.0-2 500
         500 &lt;a class="moz-txt-link-freetext" \
href="http://debian.csie.ntu.edu.tw/debian"&gt;http://debian.csie.ntu.edu.tw/debian&lt;/a&gt; \
testing/main amd64 Packages
         100 /var/lib/dpkg/status

root@vm-host:~# strace -o /tmp/trace -e trace=network,file,poll virsh
list  # hangs forever .....
^C
root@vm-host:~# tail -10 /tmp/trace
access("/etc/libvirt/libvirt.conf", F_OK) = 0
open("/etc/libvirt/libvirt.conf", O_RDONLY) = 5
access("/proc/vz", F_OK)                = -1 ENOENT (No such file or
directory)
socket(AF_UNIX, SOCK_STREAM, 0)         = 5
connect(5, {sa_family=AF_UNIX,
sun_path="/var/run/libvirt/libvirt-sock"}, 110) = 0
getsockname(5, {sa_family=AF_UNIX}, [128-&gt;2]) = 0
poll([{fd=5, events=POLLOUT}, {fd=6, events=POLLIN}], 2, -1) = 1
([{fd=5, revents=POLLOUT}])
poll([{fd=5, events=POLLIN}, {fd=6, events=POLLIN}], 2, -1) = ?
ERESTART_RESTARTBLOCK (Interrupted by signal)
--- SIGINT {si_signo=SIGINT, si_code=SI_KERNEL} ---
+++ killed by SIGINT +++

root@vm-host:~# lsof /var/run/libvirt/libvirt-sock # hangs too ...
&lt;/pre&gt;
          &lt;/blockquote&gt;
          &lt;pre wrap=""&gt;This is very suspicious. Looks like the daemon is in some \
weird state and hence virsh is unable to get list of domains.

# ps axf | grep libvirtd
# gdb -p $(pgrep libvirtd)
(gdb) t a a bt

if you could run those commands and share the output that might shed
more light.

Michal
&lt;/pre&gt;
        &lt;/blockquote&gt;
        &lt;pre wrap=""&gt;
Unfortunately, gdb also hangs when attaching to libvirt ....

root@vm-host:~# gdb -q -p $(pgrep libvirtd)
Attaching to process 9556
[New LWP 9557]
[New LWP 9558]
[New LWP 9559]
[New LWP 9560]
[New LWP 9561]
[New LWP 9562]
[New LWP 9563]
[New LWP 9564]
[New LWP 9565]
[New LWP 9566]
[New LWP 9567]
[New LWP 9568]
[New LWP 9569]
[New LWP 9570]
[New LWP 9571]
[New LWP 9572]
^C^C^C^C^C^C^C^C^C^C^C

It must be killed with SIGKILL, and libvirtd will die with gdb.

Here[1] is the output of the following command:

strace -o /tmp/gdb-full-trace.txt -s 1024 -f gdb -q -p $(pgrep libvirtd)
&lt;/pre&gt;
      &lt;/blockquote&gt;
      &lt;pre wrap=""&gt;
Err, that is useless - you've just straced GDB, not libvirtd

You need to strace libvirtd as it starts

   strace -o libvirt.log -f -s 1000 /usr/sbin/libvirtd

Regards,
Daniel
&lt;/pre&gt;
    &lt;/blockquote&gt;
    Here[1] is the output of the above command.&lt;br&gt;
    &lt;br&gt;
    [1] &lt;a class="moz-txt-link-freetext"
      href="https://www.csie.ntu.edu.tw/%7Eyunchih/s/libvirtd-debug.log"&gt;https://www.csie.ntu.edu.tw/~yunchih/s/libvirtd-strace.log&lt;/a&gt;&lt;br&gt;
  &lt;pre class="moz-signature" cols="72"&gt;-- 
--
Yun-Chih Chen 陳耘志
Network/Workstation Assistant
Dept. of Computer Science and Information Engineering
National Taiwan University
Tel: +886-2-33664888 ext. 217/204
Email: &lt;a class="moz-txt-link-abbreviated" \
                href="mailto:ta217@csie.ntu.edu.tw"&gt;ta217@csie.ntu.edu.tw&lt;/a&gt;
Website: &lt;a class="moz-txt-link-freetext" \
href="http://wslab.csie.ntu.edu.tw/"&gt;http://wslab.csie.ntu.edu.tw/&lt;/a&gt;&lt;/pre&gt;  &lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170224155900</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-02-24 15:59:00-0400</timestampReceived><subject>Re: [libvirt-users] "virsh list" hangs</subject><body>

On Fri, Feb 24, 2017 at 11:52:43PM +0800, Yunchih Chen wrote:
&gt; 
&gt; 
&gt; On 02/24/2017 11:30 PM, Daniel P. Berrange wrote:
&gt; &gt; On Tue, Feb 21, 2017 at 12:07:41PM +0800, Yunchih Chen wrote:
&gt; &gt; &gt; On 02/20/2017 09:10 PM, Michal Privoznik wrote:
&gt; &gt; &gt; &gt; On 17.02.2017 17:18, Yunchih Chen wrote:
&gt; &gt; &gt; &gt; &gt; `virsh list` hangs on my server that hosts a bunch of VMs.
&gt; &gt; &gt; &gt; &gt; This might be due to the Debian upgrade I did on Feb 15, which upgrades
&gt; &gt; &gt; &gt; &gt; `libvirt` from 2.4.0-1 to 3.0.0-2.
&gt; &gt; &gt; &gt; &gt; I have tried restarting libvirtd for a few times, without luck.
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; Attached below are some relevant logs; let me know if you need some more
&gt; &gt; &gt; &gt; &gt; for debugging.
&gt; &gt; &gt; &gt; &gt; Thanks for your help!!
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; root@vm-host:~# uname -a
&gt; &gt; &gt; &gt; &gt; Linux vm-host 4.6.0-1-amd64 #1 SMP Debian 4.6.4-1 (2016-07-18) x86_64
&gt; &gt; &gt; &gt; &gt; GNU/Linux
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; root@vm-host:~# apt-cache policy libvirt-daemon
&gt; &gt; &gt; &gt; &gt; libvirt-daemon:
&gt; &gt; &gt; &gt; &gt;     Installed: 3.0.0-2
&gt; &gt; &gt; &gt; &gt;     Candidate: 3.0.0-2
&gt; &gt; &gt; &gt; &gt;     Version table:
&gt; &gt; &gt; &gt; &gt;    *** 3.0.0-2 500
&gt; &gt; &gt; &gt; &gt;           500 http://debian.csie.ntu.edu.tw/debian testing/main amd64
&gt; &gt; &gt; &gt; &gt; Packages
&gt; &gt; &gt; &gt; &gt;           100 /var/lib/dpkg/status
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; root@vm-host:~# strace -o /tmp/trace -e trace=network,file,poll virsh
&gt; &gt; &gt; &gt; &gt; list  # hangs forever .....
&gt; &gt; &gt; &gt; &gt; ^C
&gt; &gt; &gt; &gt; &gt; root@vm-host:~# tail -10 /tmp/trace
&gt; &gt; &gt; &gt; &gt; access("/etc/libvirt/libvirt.conf", F_OK) = 0
&gt; &gt; &gt; &gt; &gt; open("/etc/libvirt/libvirt.conf", O_RDONLY) = 5
&gt; &gt; &gt; &gt; &gt; access("/proc/vz", F_OK)                = -1 ENOENT (No such file or
&gt; &gt; &gt; &gt; &gt; directory)
&gt; &gt; &gt; &gt; &gt; socket(AF_UNIX, SOCK_STREAM, 0)         = 5
&gt; &gt; &gt; &gt; &gt; connect(5, {sa_family=AF_UNIX,
&gt; &gt; &gt; &gt; &gt; sun_path="/var/run/libvirt/libvirt-sock"}, 110) = 0
&gt; &gt; &gt; &gt; &gt; getsockname(5, {sa_family=AF_UNIX}, [128-&gt;2]) = 0
&gt; &gt; &gt; &gt; &gt; poll([{fd=5, events=POLLOUT}, {fd=6, events=POLLIN}], 2, -1) = 1
&gt; &gt; &gt; &gt; &gt; ([{fd=5, revents=POLLOUT}])
&gt; &gt; &gt; &gt; &gt; poll([{fd=5, events=POLLIN}, {fd=6, events=POLLIN}], 2, -1) = ?
&gt; &gt; &gt; &gt; &gt; ERESTART_RESTARTBLOCK (Interrupted by signal)
&gt; &gt; &gt; &gt; &gt; --- SIGINT {si_signo=SIGINT, si_code=SI_KERNEL} ---
&gt; &gt; &gt; &gt; &gt; +++ killed by SIGINT +++
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; root@vm-host:~# lsof /var/run/libvirt/libvirt-sock # hangs too ...
&gt; &gt; &gt; &gt; This is very suspicious. Looks like the daemon is in some weird state
&gt; &gt; &gt; &gt; and hence virsh is unable to get list of domains.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; # ps axf | grep libvirtd
&gt; &gt; &gt; &gt; # gdb -p $(pgrep libvirtd)
&gt; &gt; &gt; &gt; (gdb) t a a bt
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; if you could run those commands and share the output that might shed
&gt; &gt; &gt; &gt; more light.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Michal
&gt; &gt; &gt; Unfortunately, gdb also hangs when attaching to libvirt ....
&gt; &gt; &gt; 
&gt; &gt; &gt; root@vm-host:~# gdb -q -p $(pgrep libvirtd)
&gt; &gt; &gt; Attaching to process 9556
&gt; &gt; &gt; [New LWP 9557]
&gt; &gt; &gt; [New LWP 9558]
&gt; &gt; &gt; [New LWP 9559]
&gt; &gt; &gt; [New LWP 9560]
&gt; &gt; &gt; [New LWP 9561]
&gt; &gt; &gt; [New LWP 9562]
&gt; &gt; &gt; [New LWP 9563]
&gt; &gt; &gt; [New LWP 9564]
&gt; &gt; &gt; [New LWP 9565]
&gt; &gt; &gt; [New LWP 9566]
&gt; &gt; &gt; [New LWP 9567]
&gt; &gt; &gt; [New LWP 9568]
&gt; &gt; &gt; [New LWP 9569]
&gt; &gt; &gt; [New LWP 9570]
&gt; &gt; &gt; [New LWP 9571]
&gt; &gt; &gt; [New LWP 9572]
&gt; &gt; &gt; ^C^C^C^C^C^C^C^C^C^C^C
&gt; &gt; &gt; 
&gt; &gt; &gt; It must be killed with SIGKILL, and libvirtd will die with gdb.
&gt; &gt; &gt; 
&gt; &gt; &gt; Here[1] is the output of the following command:
&gt; &gt; &gt; 
&gt; &gt; &gt; strace -o /tmp/gdb-full-trace.txt -s 1024 -f gdb -q -p $(pgrep libvirtd)
&gt; &gt; Err, that is useless - you've just straced GDB, not libvirtd
&gt; &gt; 
&gt; &gt; You need to strace libvirtd as it starts
&gt; &gt; 
&gt; &gt;     strace -o libvirt.log -f -s 1000 /usr/sbin/libvirtd
&gt; &gt; 
&gt; Here[1] is the output of the above command.
&gt; 
&gt; [1] https://www.csie.ntu.edu.tw/~yunchih/s/libvirtd-strace.log

So this appears to show it hanging on the following:

   17082 lstat("/home/xxxx/mnt",  &lt;unfinished ...&gt;

Presumably '/home/xxx/mnt/' is a mount point and whatever storage is
behind there appears to be dead / nonresponsive.

You'll need to either fix this mount point, or delete the XML config
for the storage pool that is associated with /home/xxxx/ from the
/etc/libvirt/storage/ directory.


Regards,
Daniel
-- 
|: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
|: http://libvirt.org              -o-             http://virt-manager.org :|
|: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|

</body></email><email><emailId>20170216100652</emailId><senderName>Jiri Denemark</senderName><senderEmail>jdenemar@redhat.com</senderEmail><timestampReceived>2017-02-16 10:06:52-0400</timestampReceived><subject>Re: [libvirt-users] Determining domain job kind from job stats?</subject><body>

On Fri, Feb 10, 2017 at 21:50:19 +0100, Milan Zamazal wrote:
&gt; Hi, is there a reliable way to find out to what kind of job does the
&gt; information returned from virDomainGetJobStats or provided in
&gt; VIR_DOMAIN_EVENT_ID_JOB_COMPLETED event callback belong to?

No, libvirt expects that the caller knows what job it started. All jobs
currently reported using virDomainGetJobStats API or
VIR_DOMAIN_EVENT_ID_JOB_COMPLETED event are internally implemented as
migration in QEMU driver (either to a file or to a network socket),
which may confuse any heuristics for detecting the job type from the set
of fields returned by libvirt.

What is the problem you are trying to solve?

Jirka

</body></email><email><emailId>20170217113824</emailId><senderName>Milan Zamazal</senderName><senderEmail>mzamazal@redhat.com</senderEmail><timestampReceived>2017-02-17 11:38:24-0400</timestampReceived><subject>Re: [libvirt-users] Determining domain job kind from job stats?</subject><body>

Jiri Denemark &lt;jdenemar@redhat.com&gt; writes:

&gt; On Fri, Feb 10, 2017 at 21:50:19 +0100, Milan Zamazal wrote:
&gt;&gt; Hi, is there a reliable way to find out to what kind of job does the
&gt;&gt; information returned from virDomainGetJobStats or provided in
&gt;&gt; VIR_DOMAIN_EVENT_ID_JOB_COMPLETED event callback belong to?
&gt;
&gt; No, libvirt expects that the caller knows what job it started. All jobs
&gt; currently reported using virDomainGetJobStats API or
&gt; VIR_DOMAIN_EVENT_ID_JOB_COMPLETED event are internally implemented as
&gt; migration in QEMU driver (either to a file or to a network socket),
&gt; which may confuse any heuristics for detecting the job type from the set
&gt; of fields returned by libvirt.

I see, thank you for explanation.

&gt; What is the problem you are trying to solve?

There are basically two problems:

- When the job completion callback is called, I need to distinguish what
  kind of job was it to perform the appropriate actions.  It would be
  easier if I knew the job type directly in the callback (no need to
  coordinate anything), but "external" job tracking is also possible.

- If I lost track of my jobs (e.g. because of a crash and restart), I'd
  like to find out whether a given VM is migrating.  Examining the job
  looked like a good candidate to get the information, but apparently
  it's not.  Again, I can probably arrange things to handle that, but to
  get the information directly from libvirt (not necessarily via job
  info) would be easier and more reliable.

Thanks,
Milan

</body></email><email><emailId>20170217183148</emailId><senderName>Jiri Denemark</senderName><senderEmail>jdenemar@redhat.com</senderEmail><timestampReceived>2017-02-17 18:31:48-0400</timestampReceived><subject>Re: [libvirt-users] Determining domain job kind from job stats?</subject><body>

On Fri, Feb 17, 2017 at 12:38:24 +0100, Milan Zamazal wrote:
&gt; Jiri Denemark &lt;jdenemar@redhat.com&gt; writes:
&gt; 
&gt; &gt; On Fri, Feb 10, 2017 at 21:50:19 +0100, Milan Zamazal wrote:
&gt; &gt;&gt; Hi, is there a reliable way to find out to what kind of job does the
&gt; &gt;&gt; information returned from virDomainGetJobStats or provided in
&gt; &gt;&gt; VIR_DOMAIN_EVENT_ID_JOB_COMPLETED event callback belong to?
&gt; &gt;
&gt; &gt; No, libvirt expects that the caller knows what job it started. All jobs
&gt; &gt; currently reported using virDomainGetJobStats API or
&gt; &gt; VIR_DOMAIN_EVENT_ID_JOB_COMPLETED event are internally implemented as
&gt; &gt; migration in QEMU driver (either to a file or to a network socket),
&gt; &gt; which may confuse any heuristics for detecting the job type from the set
&gt; &gt; of fields returned by libvirt.
&gt; 
&gt; I see, thank you for explanation.
&gt; 
&gt; &gt; What is the problem you are trying to solve?
&gt; 
&gt; There are basically two problems:
&gt; 
&gt; - When the job completion callback is called, I need to distinguish what
&gt;   kind of job was it to perform the appropriate actions.  It would be
&gt;   easier if I knew the job type directly in the callback (no need to
&gt;   coordinate anything), but "external" job tracking is also possible.

An immediate answer would be: "don't rely on the completion callback and
just check the return value of the API which started the job", but I
guess you want it because checking the return value is not possible when
the process which started the job is not running anymore as described
below.

&gt; - If I lost track of my jobs (e.g. because of a crash and restart), I'd
&gt;   like to find out whether a given VM is migrating.  Examining the job
&gt;   looked like a good candidate to get the information, but apparently
&gt;   it's not.  Again, I can probably arrange things to handle that, but to
&gt;   get the information directly from libvirt (not necessarily via job
&gt;   info) would be easier and more reliable.

Apparently you are talking about peer-to-peer migration, otherwise the
migration would be automatically canceled when the process which started
it disappears. I'm afraid this is not currently possible in general. You
might be able to get something by checking the domain's status, but it
won't work in all cases.

Jirka

</body></email><email><emailId>20170220095443</emailId><senderName>Milan Zamazal</senderName><senderEmail>mzamazal@redhat.com</senderEmail><timestampReceived>2017-02-20 09:54:43-0400</timestampReceived><subject>Re: [libvirt-users] Determining domain job kind from job stats?</subject><body>

Jiri Denemark &lt;jdenemar@redhat.com&gt; writes:

&gt; On Fri, Feb 17, 2017 at 12:38:24 +0100, Milan Zamazal wrote:
&gt;&gt; Jiri Denemark &lt;jdenemar@redhat.com&gt; writes:
&gt;&gt; 
&gt;&gt; &gt; On Fri, Feb 10, 2017 at 21:50:19 +0100, Milan Zamazal wrote:
&gt;&gt; &gt;&gt; Hi, is there a reliable way to find out to what kind of job does the
&gt;&gt; &gt;&gt; information returned from virDomainGetJobStats or provided in
&gt;&gt; &gt;&gt; VIR_DOMAIN_EVENT_ID_JOB_COMPLETED event callback belong to?
&gt;&gt; &gt;
&gt;&gt; &gt; No, libvirt expects that the caller knows what job it started. All jobs
&gt;&gt; &gt; currently reported using virDomainGetJobStats API or
&gt;&gt; &gt; VIR_DOMAIN_EVENT_ID_JOB_COMPLETED event are internally implemented as
&gt;&gt; &gt; migration in QEMU driver (either to a file or to a network socket),
&gt;&gt; &gt; which may confuse any heuristics for detecting the job type from the set
&gt;&gt; &gt; of fields returned by libvirt.
&gt;&gt; 
&gt;&gt; I see, thank you for explanation.
&gt;&gt; 
&gt;&gt; &gt; What is the problem you are trying to solve?
&gt;&gt; 
&gt;&gt; There are basically two problems:
&gt;&gt; 
&gt;&gt; - When the job completion callback is called, I need to distinguish what
&gt;&gt;   kind of job was it to perform the appropriate actions.  It would be
&gt;&gt;   easier if I knew the job type directly in the callback (no need to
&gt;&gt;   coordinate anything), but "external" job tracking is also possible.
&gt;
&gt; An immediate answer would be: "don't rely on the completion callback and
&gt; just check the return value of the API which started the job", but I
&gt; guess you want it because checking the return value is not possible when
&gt; the process which started the job is not running anymore as described
&gt; below.

Well, avoiding using the completion callback is probably OK for me.
(In case of the process restart, I don't expect having everything
perfectly working, just some basic sanity.)

&gt;&gt; - If I lost track of my jobs (e.g. because of a crash and restart), I'd
&gt;&gt;   like to find out whether a given VM is migrating.  Examining the job
&gt;&gt;   looked like a good candidate to get the information, but apparently
&gt;&gt;   it's not.  Again, I can probably arrange things to handle that, but to
&gt;&gt;   get the information directly from libvirt (not necessarily via job
&gt;&gt;   info) would be easier and more reliable.
&gt;
&gt; Apparently you are talking about peer-to-peer migration, 

Yes.

&gt; otherwise the migration would be automatically canceled when the
&gt; process which started it disappears. I'm afraid this is not currently
&gt; possible in general. You might be able to get something by checking
&gt; the domain's status, but it won't work in all cases.

Too bad.  Could some future libvirt version provide that information?

Thank you for clarification,
Milan

</body></email><email><emailId>20170221143822</emailId><senderName>Milan Zamazal</senderName><senderEmail>mzamazal@redhat.com</senderEmail><timestampReceived>2017-02-21 14:38:22-0400</timestampReceived><subject>Re: [libvirt-users] Determining domain job kind from job stats?</subject><body>

[Starting to move to the development list.]

Milan Zamazal &lt;mzamazal@redhat.com&gt; writes:

&gt; Jiri Denemark &lt;jdenemar@redhat.com&gt; writes:
&gt;
&gt;&gt; On Fri, Feb 17, 2017 at 12:38:24 +0100, Milan Zamazal wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt; There are basically two problems:
&gt;&gt;&gt; 
&gt;&gt;&gt; - When the job completion callback is called, I need to distinguish what
&gt;&gt;&gt;   kind of job was it to perform the appropriate actions.  It would be
&gt;&gt;&gt;   easier if I knew the job type directly in the callback (no need to
&gt;&gt;&gt;   coordinate anything), but "external" job tracking is also possible.
&gt;&gt;
&gt;&gt; An immediate answer would be: "don't rely on the completion callback and
&gt;&gt; just check the return value of the API which started the job", but I
&gt;&gt; guess you want it because checking the return value is not possible when
&gt;&gt; the process which started the job is not running anymore as described
&gt;&gt; below.
&gt;
&gt; Well, avoiding using the completion callback is probably OK for me.

Thinking about it more, it's not very nice: I have to use the callback
to get the completed job stats (I'm not guaranteed the domain still
exists on the source host when I ask it for the stats explicitly) *and*
to track the jobs outside the callback to know whether the callback is
related to the type of domain jobs I'm going to handle.

Although not absolutely necessary, it would be much nicer if the job
type was identified in the callback.

&gt; (In case of the process restart, I don't expect having everything
&gt; perfectly working, just some basic sanity.)
&gt;
&gt;&gt;&gt; - If I lost track of my jobs (e.g. because of a crash and restart), I'd
&gt;&gt;&gt;   like to find out whether a given VM is migrating.  Examining the job
&gt;&gt;&gt;   looked like a good candidate to get the information, but apparently
&gt;&gt;&gt;   it's not.  Again, I can probably arrange things to handle that, but to
&gt;&gt;&gt;   get the information directly from libvirt (not necessarily via job
&gt;&gt;&gt;   info) would be easier and more reliable.
&gt;&gt;
&gt;&gt; Apparently you are talking about peer-to-peer migration, 
&gt;
&gt; Yes.
&gt;
&gt;&gt; otherwise the migration would be automatically canceled when the
&gt;&gt; process which started it disappears. I'm afraid this is not currently
&gt;&gt; possible in general. You might be able to get something by checking
&gt;&gt; the domain's status, but it won't work in all cases.
&gt;
&gt; Too bad.  Could some future libvirt version provide that information?

If libvirt provided information about the job type, it would help with
several things, for instance: With the callback problem above, with
using libvirt as the ultimate single source of information about the
VMs, or with handling VMs not running under complete control of a
particular piece of software.

If some piece of information about a VM is missing from libvirt I need
to store it somewhere.  Domain metadata is a natural place for that,
since it's closely bound to the corresponding VM and keeps libvirt as
the ultimate single source of information.  But putting there
information about migration is weird at best.

Based on those thoughts I think libvirt should really provide a simple
way to find out whether the VM is migrating to another host and to
identify the domain job type in the job completed callback.  Is there
anything preventing to add that information?

Thanks,
Milan

</body></email><email><emailId>20170221180240</emailId><senderName>Aleksei</senderName><senderEmail>alex3kov@zoho.com</senderEmail><timestampReceived>2017-02-21 18:02:40-0400</timestampReceived><subject>Re: [libvirt-users] How to set manually starting date/time for guest kvm</subject><body>

It doesn't seem to be implemented in libvirt's XML.

You can still try and hack it though:

&lt;domain type='kvm' xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'&gt;
&lt;qemu:commandline&gt;
     &lt;qemu:arg value='-rtc base="xxx"'/&gt;
   &lt;/qemu:commandline&gt;
&lt;/domain&gt;

It will mark this domain "tainted" in libvirt's log.


/--Regards, Aleksei/

------------------------------------------------------------------------

*From:* Matt Xtlm
*Sent:* Tuesday, February 21, 2017 2:07PM
*To:* Libvirt-users
*Subject:* [libvirt-users] How to set manually starting date/time for 
guest kvm
&gt; Hi there,
&gt;
&gt; is there a way to set a guest to start with a specific date and time. 
&gt; (e.g. when guest boots, starting guest time should always be 
&gt; (2017-02-05T12:00:00)).
&gt;
&gt; I've tried something like this in my kvm domain:
&gt;
&gt;   &lt;clock offset='variable' adjustment='-86400' basis='localtime'&gt;
&gt;     &lt;timer name='rtc' tickpolicy='delay' track='guest'/&gt;
&gt;     &lt;timer name='pit' tickpolicy='delay'/&gt;
&gt;     &lt;timer name='hpet' present='no'/&gt;
&gt;   &lt;/clock&gt;
&gt;
&gt; However, i can't insert a specific date and time statement (like 
&gt; starting kvm with -rtc base="2017-02-05T12:00:00").
&gt;
&gt; The date/time must be set before starting the vm and must always be 
&gt; the same.
&gt;
&gt; Cheers,
&gt; Matt
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users


[Attachment #3 (text/html)]

&lt;html&gt;
  &lt;head&gt;
    &lt;meta content="text/html; charset=windows-1252"
      http-equiv="Content-Type"&gt;
  &lt;/head&gt;
  &lt;body smarttemplateinserted="true" bgcolor="#FFFFFF" text="#000000"&gt;
    &lt;div id="smartTemplate4-template"&gt;
      &lt;p&gt;It doesn't seem to be implemented in libvirt's XML.&lt;/p&gt;
      &lt;p&gt;You can still try and hack it though:&lt;/p&gt;
      &lt;domain type='kvm'
      xmlns:qemu='&lt;a class="moz-txt-link-freetext" \
href="http://libvirt.org/schemas/domain/qemu/1.0"&gt;http://libvirt.org/schemas/domain/qemu/1.0&lt;/a&gt;'&gt;&lt;br&gt;
  &lt;qemu:commandline&gt;&lt;br&gt;
          &lt;qemu:arg value='-rtc base="xxx"'/&gt;&lt;br&gt;
        &lt;/qemu:commandline&gt;&lt;br&gt;
      &lt;/domain&gt;&lt;br&gt;
      &lt;p&gt;It will mark this domain "tainted" in libvirt's log.&lt;br&gt;
      &lt;/p&gt;
    &lt;/div&gt;
    &lt;br&gt;
    &lt;div class="moz-signature"&gt;&lt;i&gt;--Regards, Aleksei&lt;/i&gt;
    &lt;/div&gt;
    &lt;br&gt;
    &lt;div id="smartTemplate4-quoteHeader"&gt;
      &lt;hr&gt;&lt;br&gt;
      &lt;b&gt;From:&lt;/b&gt; Matt Xtlm&lt;br&gt;
      &lt;b&gt;Sent:&lt;/b&gt; Tuesday, February 21, 2017 2:07PM&lt;br&gt;
      &lt;b&gt;To:&lt;/b&gt; Libvirt-users&lt;br&gt;
      &lt;b&gt;Subject:&lt;/b&gt; [libvirt-users] How to set manually starting
      date/time for guest kvm&lt;/div&gt;
    &lt;blockquote
cite="mid:CANW-rPapbcihDAE2qaVQjSk9B6usXeG7SFPbM7Bdt0igJwOxrQ@mail.gmail.com"
      type="cite"&gt;
      &lt;div dir="ltr"&gt;Hi there,
        &lt;div&gt;&lt;br&gt;
        &lt;/div&gt;
        &lt;div&gt;is there a way to set a guest to start with a specific date
          and time. (e.g. when guest boots, starting guest time should
          always be (2017-02-05T12:00:00)).&lt;/div&gt;
        &lt;div&gt;&lt;br&gt;
        &lt;/div&gt;
        &lt;div&gt;I've tried something like this in my kvm domain:&lt;/div&gt;
        &lt;div&gt;&lt;br&gt;
        &lt;/div&gt;
        &lt;div&gt;
          &lt;div&gt;  &lt;clock offset='variable' adjustment='-86400'
            basis='localtime'&gt;&lt;/div&gt;
          &lt;div&gt;    &lt;timer name='rtc' tickpolicy='delay'
            track='guest'/&gt;&lt;/div&gt;
          &lt;div&gt;    &lt;timer name='pit' tickpolicy='delay'/&gt;&lt;/div&gt;
          &lt;div&gt;    &lt;timer name='hpet' present='no'/&gt;&lt;/div&gt;
          &lt;div&gt;  &lt;/clock&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;div&gt;&lt;br&gt;
        &lt;/div&gt;
        &lt;div&gt;However, i can't insert a specific date and time statement
          (like starting kvm with -rtc base="2017-02-05T12:00:00").&lt;/div&gt;
        &lt;div&gt;&lt;br&gt;
        &lt;/div&gt;
        &lt;div&gt;The date/time must be set before starting the vm and must
          always be the same.&lt;/div&gt;
        &lt;div&gt;&lt;br&gt;
        &lt;/div&gt;
        &lt;div&gt;Cheers,&lt;/div&gt;
        &lt;div&gt;Matt&lt;/div&gt;
        &lt;div&gt;&lt;br&gt;
        &lt;/div&gt;
        &lt;div&gt;&lt;br&gt;
        &lt;/div&gt;
        &lt;div&gt;&lt;br&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;br&gt;
      &lt;fieldset class="mimeAttachmentHeader"&gt;&lt;/fieldset&gt;
      &lt;br&gt;
      &lt;pre wrap=""&gt;_______________________________________________
libvirt-users mailing list
&lt;a class="moz-txt-link-abbreviated" \
href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt; &lt;a \
class="moz-txt-link-freetext" \
href="https://www.redhat.com/mailman/listinfo/libvirt-users"&gt;https://www.redhat.com/mailman/listinfo/libvirt-users&lt;/a&gt;&lt;/pre&gt;
  &lt;/blockquote&gt;
    &lt;br&gt;
  &lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170217185008</emailId><senderName>Jiri Denemark</senderName><senderEmail>jdenemar@redhat.com</senderEmail><timestampReceived>2017-02-17 18:50:08-0400</timestampReceived><subject>Re: [libvirt-users] Unsafe migration with copy-storage-all (non shared storage) and writeback cache</subject><body>

On Fri, Feb 17, 2017 at 12:33:28 +0100, Gionatan Danti wrote:
&gt; Hi list,
&gt; I would like to understand if, and why, the --unsafe flag is needed when 
&gt; using --copy-storage-all when migrating guests which uses writeback 
&gt; cache mode.
&gt; 
&gt; Background: I want to live migrate guests with writeback cache from host 
&gt; A to host B and these hosts only have local storage (ie: no shared 
&gt; storage at all).
&gt; 
&gt;  From my understanding, --unsafe should be only required when migrating 
&gt; writeback-enabled guests between two hosts which share non-cluster-aware 
&gt; storage (ie: NFS), but it should not be necessary when not sharing storage.

I think your understanding is correct.

&gt; 1) it is safe to do a live migration with --copy-storage-all when guests 
&gt; are using writeback cache mode?

Yeah storage migration should be safe regardless of the cache mode used.

&gt; 2) if so, why libvirt complains about that?

This looks like a bug in libvirt. The code doesn't check whether an
affected disk is going to be migrated (--copy-storage-all) or accessed
on the shared storage.

Jirka

</body></email><email><emailId>20170221093208</emailId><senderName>Gionatan Danti</senderName><senderEmail>g.danti@assyoma.it</senderEmail><timestampReceived>2017-02-21 09:32:08-0400</timestampReceived><subject>Re: [libvirt-users] Unsafe migration with copy-storage-all (non shared storage) and writeback cache</subject><body>

On 17/02/2017 19:50, Jiri Denemark wrote:
&gt;
&gt; Yeah storage migration should be safe regardless of the cache mode used.
&gt;

Very good news, thanks. Let me be paranoid: is it *surely* safe?

&gt;
&gt; This looks like a bug in libvirt. The code doesn't check whether an
&gt; affected disk is going to be migrated (--copy-storage-all) or accessed
&gt; on the shared storage.
&gt;
&gt; Jirka
&gt;

Any chances the bug will be corrected? Should I open a BZ against it?

Thanks.

-- 
Danti Gionatan
Supporto Tecnico
Assyoma S.r.l. - www.assyoma.it
email: g.danti@assyoma.it - info@assyoma.it
GPG public key ID: FF5F32A8

</body></email><email><emailId>20170220130735</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-02-20 13:07:35-0400</timestampReceived><subject>Re: [libvirt-users] "virsh list" ahngs</subject><body>


On Sat, Feb 18, 2017 at 12:21:31AM +0800, Yunchih Chen wrote:
&gt;
&gt;`virsh list` hangs on my server that hosts a bunch of VMs.
&gt;This might be due to the Debian upgrade I did on Feb 15, which upgrades
&gt;`libvirt` from 2.4.0-1 to 3.0.0-2.
&gt;I have tried restarting libvirtd for a few times, without luck.
&gt;
&gt;Attached below are some relevant logs; let me know if you need some more
&gt;for debugging.
&gt;Thanks for your help!!
&gt;
&gt;root@vm-host:~# uname -a
&gt;Linux vm-host 4.6.0-1-amd64 #1 SMP Debian 4.6.4-1 (2016-07-18) x86_64
&gt;GNU/Linux
&gt;
&gt;root@vm-host:~# apt-cache policy libvirt-daemon
&gt;libvirt-daemon:
&gt;   Installed: 3.0.0-2
&gt;   Candidate: 3.0.0-2
&gt;   Version table:
&gt;  *** 3.0.0-2 500
&gt;         500 http://debian.csie.ntu.edu.tw/debian testing/main amd64
&gt;Packages
&gt;         100 /var/lib/dpkg/status
&gt;
&gt;root@vm-host:~# strace -o /tmp/trace -e trace=network,file,poll virsh
&gt;list  # hangs forever .....
&gt;^C
&gt;root@vm-host:~# tail -10 /tmp/trace
&gt;access("/etc/libvirt/libvirt.conf", F_OK) = 0
&gt;open("/etc/libvirt/libvirt.conf", O_RDONLY) = 5
&gt;access("/proc/vz", F_OK)                = -1 ENOENT (No such file or
&gt;directory)
&gt;socket(AF_UNIX, SOCK_STREAM, 0)         = 5
&gt;connect(5, {sa_family=AF_UNIX,
&gt;sun_path="/var/run/libvirt/libvirt-sock"}, 110) = 0
&gt;getsockname(5, {sa_family=AF_UNIX}, [128-&gt;2]) = 0
&gt;poll([{fd=5, events=POLLOUT}, {fd=6, events=POLLIN}], 2, -1) = 1
&gt;([{fd=5, revents=POLLOUT}])
&gt;poll([{fd=5, events=POLLIN}, {fd=6, events=POLLIN}], 2, -1) = ?
&gt;ERESTART_RESTARTBLOCK (Interrupted by signal)
&gt;--- SIGINT {si_signo=SIGINT, si_code=SI_KERNEL} ---
&gt;+++ killed by SIGINT +++
&gt;
&gt;root@vm-host:~# lsof /var/run/libvirt/libvirt-sock # hangs too ...
&gt;^C
&gt;

This is weird =)  Can you attach to libvirtd using gdb (with installed
debuginfo) and run 't a a bt' to see where the daemon hangs?  I think
it's not accepting connections and that's what virsh is waiting for.

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170220130253</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-02-20 13:02:53-0400</timestampReceived><subject>Re: [libvirt-users] Libvirt behavior when mixing io=native and cache=writeback</subject><body>


On Fri, Feb 17, 2017 at 02:52:06PM +0100, Gionatan Danti wrote:
&gt;Hi all,
&gt;I write about libvirt inconsistent behavior when mixing io=native and
&gt;cache=writeback. This post can be regarded as an extension, or
&gt;clarification request, of BZ 1086704
&gt;(https://bugzilla.redhat.com/show_bug.cgi?id=1086704)
&gt;
&gt;On a fully upgraded CentOS6 x86-64 machine, starting a guest with
&gt;io=native and cache=writeback is permitted: no errors are raised and the
&gt;VM (qemu, really) silently use "io=threads" instead. A warning should be
&gt;raised, but I find reasonable that the VM is permitted to run.
&gt;
&gt;On a fully upgraded CentOS7 x86-64 machine, starting a guest with
&gt;io=native and cache=writeback is *not* permitted: an error is raised and
&gt;the guest is not started. While it is absolutely OK to alert the user
&gt;about the configuration error, I feel the VM should be started as on
&gt;CentOS6. Anyway, this is not a big problem when dealing with a single host.
&gt;
&gt;A more concerning behavior is that when trying to migrate a guest from
&gt;the very first CentOS6 machine, which starts and runs such a guest with
&gt;io=native and cache=writeback without problems, to a CentOS7 host, live
&gt;migration aborts with an error:
&gt;
&gt;[root@source] virsh migrate Totem --live --copy-storage-all --persistent
&gt;--verbose --unsafe qemu+ssh://root@172.31.255.11/system
&gt;

How about using --xml to supply the destination XML which would have
io="threads" specified?

&gt;error: unsupported configuration: native I/O needs either no disk cache
&gt;or directsync cache mode, QEMU will fallback to aio=threads
&gt;
&gt;This error persists even if the VM config file is changed to use
&gt;"io=threads". Of course, the running image continue to have "io=native"
&gt;on its parameters list, but it does not really honor the "io=native"
&gt;directive, so I find strange that live migration can not proceed. I
&gt;think it is very reasonable to raise an error, but such error should not
&gt;block the live migration process.
&gt;
&gt;In short: there is some method to live migrate a running VM configured
&gt;with "io=native" (but which is really using "io=threads" internally) and
&gt;"cache=writeback"?
&gt;
&gt;Thanks.
&gt;
&gt;--
&gt;Danti Gionatan
&gt;Supporto Tecnico
&gt;Assyoma S.r.l. - www.assyoma.it
&gt;email: g.danti@assyoma.it - info@assyoma.it
&gt;GPG public key ID: FF5F32A8
&gt;
&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170216101227</emailId><senderName>Jiri Denemark</senderName><senderEmail>jdenemar@redhat.com</senderEmail><timestampReceived>2017-02-16 10:12:27-0400</timestampReceived><subject>Re: [libvirt-users] Why Guest does not retain Host CPU flags</subject><body>

On Mon, Feb 06, 2017 at 09:51:06 +0530, akhilesh rawat wrote:
&gt; hi ,
&gt; 
&gt; I am creating Guest by Libvirt tool " virt-install"  with cpu model as
&gt; host.
&gt; 
&gt; After Guest creation i see Guest Missing quite no of flags which Host was
&gt; having .
&gt; 
&gt; What could be the reason for this ?  I am expecting all flags of Host to e
&gt; present in Guest as well when choosing cpu model as host .

Even if you request "host" CPU model, the guest will always see only a
subset of features the host supports. Not all features can be used in a
virtual machine and even if they can be used they usually need some
support form KVM or QEMU or both. That is both KVM and QEMU will filter
out features they cannot currently virtualize and thus you will get a
smaller set in comparison to the host CPU.

Jirka

</body></email><email><emailId>20170217060554</emailId><senderName>akhilesh rawat</senderName><senderEmail>akhileshrawat007@gmail.com</senderEmail><timestampReceived>2017-02-17 06:05:54-0400</timestampReceived><subject>Re: [libvirt-users] Why Guest does not retain Host CPU flags</subject><body>

ok thanks , but then can we know which all list of feature are supported by
QEMU/KVM release.
http://www.linux-kvm.org/page/KVM_Features
Does not seem to be all corect .



On Thu, Feb 16, 2017 at 3:42 PM, Jiri Denemark &lt;jdenemar@redhat.com&gt; wrote:

&gt; On Mon, Feb 06, 2017 at 09:51:06 +0530, akhilesh rawat wrote:
&gt; &gt; hi ,
&gt; &gt;
&gt; &gt; I am creating Guest by Libvirt tool " virt-install"  with cpu model as
&gt; &gt; host.
&gt; &gt;
&gt; &gt; After Guest creation i see Guest Missing quite no of flags which Host was
&gt; &gt; having .
&gt; &gt;
&gt; &gt; What could be the reason for this ?  I am expecting all flags of Host to
&gt; e
&gt; &gt; present in Guest as well when choosing cpu model as host .
&gt;
&gt; Even if you request "host" CPU model, the guest will always see only a
&gt; subset of features the host supports. Not all features can be used in a
&gt; virtual machine and even if they can be used they usually need some
&gt; support form KVM or QEMU or both. That is both KVM and QEMU will filter
&gt; out features they cannot currently virtualize and thus you will get a
&gt; smaller set in comparison to the host CPU.
&gt;
&gt; Jirka
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;ok thanks , but then can we know which all list of feature are \
supported by QEMU/KVM release. &lt;br&gt;&lt;a \
href="http://www.linux-kvm.org/page/KVM_Features"&gt;http://www.linux-kvm.org/page/KVM_Features&lt;/a&gt;&lt;br&gt;&lt;/div&gt;Does \
not seem to be all corect . &lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Thu, Feb 16, 2017 at 3:42 PM, Jiri Denemark &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:jdenemar@redhat.com" \
target="_blank"&gt;jdenemar@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span class=""&gt;On Mon, Feb 06, 2017 at 09:51:06 +0530, \
akhilesh rawat wrote:&lt;br&gt; &gt; hi ,&lt;br&gt;
&gt;&lt;br&gt;
&gt; I am creating Guest by Libvirt tool " virt-install"   with cpu model \
as&lt;br&gt; &gt; host.&lt;br&gt;
&gt;&lt;br&gt;
&gt; After Guest creation i see Guest Missing quite no of flags which Host was&lt;br&gt;
&gt; having .&lt;br&gt;
&gt;&lt;br&gt;
&gt; What could be the reason for this ?   I am expecting all flags of Host to e&lt;br&gt;
&gt; present in Guest as well when choosing cpu model as host .&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;Even if you request "host" CPU model, the guest will always see only \
a&lt;br&gt; subset of features the host supports. Not all features can be used in a&lt;br&gt;
virtual machine and even if they can be used they usually need some&lt;br&gt;
support form KVM or QEMU or both. That is both KVM and QEMU will filter&lt;br&gt;
out features they cannot currently virtualize and thus you will get a&lt;br&gt;
smaller set in comparison to the host CPU.&lt;br&gt;
&lt;br&gt;
Jirka&lt;br&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170214134754</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-02-14 13:47:54-0400</timestampReceived><subject>Re: [libvirt-users] high memory guest issues - virsh start and QEMU_JOB_WAIT_TIME</subject><body>

On 02/14/2017 08:13 AM, Blair Bethwaite wrote:
&gt; Hi all,
&gt; 
&gt; In IRC last night Dan helpfully confirmed my analysis of an issue we are
&gt; seeing attempting to launch high memory KVM guests backed by hugepages...
&gt; 
&gt; In this case the guests have 240GB of memory allocated from two host NUMA
&gt; nodes to two guest NUMA nodes. The trouble is that allocating the hugepage
&gt; backed qemu process seems to take longer than the 30s QEMU_JOB_WAIT_TIME
&gt; and so libvirt then most unhelpfully kills the barely spawned guest. Dan
&gt; said there was currently no workaround available so I'm now looking at
&gt; building a custom libvirt which sets QEMU_JOB_WAIT_TIME=60s.

I don't think I understand this. Who is running the other job? I mean,
I'd expect qemu fail to create the socket and thus hitting 30s timeout
in qemuMonitorOpenUnix().

&gt; 
&gt; I have two related questions:
&gt; 1) will this change have any untoward side-effects?

Since this timeout is shared with other jobs, you might have to wait a
bit longer for an API to return with error if a domain is stuck and
unresponsive.

&gt; 2) if not, then is there any reason not to change it in master until a
&gt; better solution comes along (or possibly better, alter
&gt; qemuDomainObjBeginJobInternal
&gt; to give a domain start job a little longer compared to other jobs)?

It's a trade off between "responsiveness" of a libvirt API and being
able to talk to qemu which is under heavy load. From libvirt's POV we
are unable to tell whether qemu is doing something or is stuck (e.g.
looping endlessly). So far, we felt like 30 seconds is a good choice.
But I don't mind being proven wrong.

Michal

</body></email><email><emailId>20170214135750</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-02-14 13:57:50-0400</timestampReceived><subject>Re: [libvirt-users] high memory guest issues - virsh start and QEMU_JOB_WAIT_TIME</subject><body>

On Tue, Feb 14, 2017 at 06:13:20PM +1100, Blair Bethwaite wrote:
&gt; Hi all,
&gt; 
&gt; In IRC last night Dan helpfully confirmed my analysis of an issue we are
&gt; seeing attempting to launch high memory KVM guests backed by hugepages...
&gt; 
&gt; In this case the guests have 240GB of memory allocated from two host NUMA
&gt; nodes to two guest NUMA nodes. The trouble is that allocating the hugepage
&gt; backed qemu process seems to take longer than the 30s QEMU_JOB_WAIT_TIME
&gt; and so libvirt then most unhelpfully kills the barely spawned guest. Dan
&gt; said there was currently no workaround available so I'm now looking at
&gt; building a custom libvirt which sets QEMU_JOB_WAIT_TIME=60s.
&gt; 
&gt; I have two related questions:
&gt; 1) will this change have any untoward side-effects?
&gt; 2) if not, then is there any reason not to change it in master until a
&gt; better solution comes along (or possibly better, alter
&gt; qemuDomainObjBeginJobInternal
&gt; to give a domain start job a little longer compared to other jobs)?

What is the actual error you're getting during startup.

I'm not entirely sure QEMU_JOB_WAIT_TIME is the thing that's the problem.
IIRC, the job wait time only comes into play when 2 threads are contending
on the same QEMU process. ie one has an existing job running and a second
comes along and tries to run a second job. The second will timeout after
the QEMU_JOB_WAIT_TIME is reached. The first job which holds the lock will
never timeout.

During guest startup I didn't believe we had contending jobs in this
way - all the jobs needed to startup QEMU should be serialized, so
I'm not sure why QEMU_JOB_WAIT_TIME would even get hit.

Regards,
Daniel
-- 
|: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
|: http://libvirt.org              -o-             http://virt-manager.org :|
|: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|

</body></email><email><emailId>20170215024321</emailId><senderName>Blair Bethwaite</senderName><senderEmail>blair.bethwaite@gmail.com</senderEmail><timestampReceived>2017-02-15 02:43:21-0400</timestampReceived><subject>Re: [libvirt-users] high memory guest issues - virsh start and QEMU_JOB_WAIT_TIME</subject><body>

On 15 February 2017 at 00:57, Daniel P. Berrange &lt;berrange@redhat.com&gt; wrote:
&gt; What is the actual error you're getting during startup.

# virsh -d0 start instance-0000037c
start: domain(optdata): instance-0000037c
start: found option &lt;domain&gt;: instance-0000037c
start: &lt;domain&gt; trying as domain NAME
error: Failed to start domain instance-0000037c
error: monitor socket did not show up: No such file or directory

Full libvirtd debug log at
https://gist.github.com/bmb/08fbb6b6136c758d027e90ff139d5701

On 15 February 2017 at 00:47, Michal Privoznik &lt;mprivozn@redhat.com&gt; wrote:
&gt; I don't think I understand this. Who is running the other job? I mean,
&gt; I'd expect qemu fail to create the socket and thus hitting 30s timeout
&gt; in qemuMonitorOpenUnix().

Yes you're right, I just blindly started looking for 30s constants in
the code and that one seemed the most obvious but I had not tried to
trace it all the way back to the domain start job or checked the debug
logs yet, sorry. So looking a bit more carefully I see the real issue
is in src/qemu/qemu_monitor.c:

321 static int
322 qemuMonitorOpenUnix(const char *monitor, pid_t cpid)
323 {
324     struct sockaddr_un addr;
325     int monfd;
326     int timeout = 30; /* In seconds */

Is this safe to increase? Is there any reason to keep it at 30s given
(from what I'm seeing on a fast 2-socket Haswell system) that hugepage
backed guests larger than ~160GB memory will not be able to start in
that time?

-- 
Cheers,
~Blairo

</body></email><email><emailId>20170215092746</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-02-15 09:27:46-0400</timestampReceived><subject>Re: [libvirt-users] high memory guest issues - virsh start and QEMU_JOB_WAIT_TIME</subject><body>

On 02/15/2017 03:43 AM, Blair Bethwaite wrote:
&gt; On 15 February 2017 at 00:57, Daniel P. Berrange &lt;berrange@redhat.com&gt; wrote:
&gt;&gt; What is the actual error you're getting during startup.
&gt; 
&gt; # virsh -d0 start instance-0000037c
&gt; start: domain(optdata): instance-0000037c
&gt; start: found option &lt;domain&gt;: instance-0000037c
&gt; start: &lt;domain&gt; trying as domain NAME
&gt; error: Failed to start domain instance-0000037c
&gt; error: monitor socket did not show up: No such file or directory
&gt; 
&gt; Full libvirtd debug log at
&gt; https://gist.github.com/bmb/08fbb6b6136c758d027e90ff139d5701
&gt; 
&gt; On 15 February 2017 at 00:47, Michal Privoznik &lt;mprivozn@redhat.com&gt; wrote:
&gt;&gt; I don't think I understand this. Who is running the other job? I mean,
&gt;&gt; I'd expect qemu fail to create the socket and thus hitting 30s timeout
&gt;&gt; in qemuMonitorOpenUnix().
&gt; 
&gt; Yes you're right, I just blindly started looking for 30s constants in
&gt; the code and that one seemed the most obvious but I had not tried to
&gt; trace it all the way back to the domain start job or checked the debug
&gt; logs yet, sorry. So looking a bit more carefully I see the real issue
&gt; is in src/qemu/qemu_monitor.c:
&gt; 
&gt; 321 static int
&gt; 322 qemuMonitorOpenUnix(const char *monitor, pid_t cpid)
&gt; 323 {
&gt; 324     struct sockaddr_un addr;
&gt; 325     int monfd;
&gt; 326     int timeout = 30; /* In seconds */
&gt; 
&gt; Is this safe to increase? Is there any reason to keep it at 30s given
&gt; (from what I'm seeing on a fast 2-socket Haswell system) that hugepage
&gt; backed guests larger than ~160GB memory will not be able to start in
&gt; that time?
&gt; 

I recall some similar discussion took place in the past. But I just
cannot find it now. I think the problem was that kernel is zeroing the
pages on huge page allocation. Anyway, this timeout used to be 3 seconds
and inly in fe89b687a0 it has been changed to 30 seconds.

We can increase the limit, but that would solve just this case until
somebody tries to assign even more RAM to their domain. What if we would
instead make this configurable? Have yet another variable living inside
qemu.conf that by default has value of 30 and specifies how long should
libvirt wait for qemu monitor to show up?

But frankly, on one hand I like this approach. But on the other I
dislike it at the same time - we have just too much variables in
qemu.conf because that's our answer to problems like these. We don't
know so we offload the setting to the sys admin.

Michal

</body></email><email><emailId>20170215094009</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-02-15 09:40:09-0400</timestampReceived><subject>Re: [libvirt-users] high memory guest issues - virsh start and QEMU_JOB_WAIT_TIME</subject><body>

On Wed, Feb 15, 2017 at 10:27:46AM +0100, Michal Privoznik wrote:
&gt; On 02/15/2017 03:43 AM, Blair Bethwaite wrote:
&gt; &gt; On 15 February 2017 at 00:57, Daniel P. Berrange &lt;berrange@redhat.com&gt; wrote:
&gt; &gt;&gt; What is the actual error you're getting during startup.
&gt; &gt; 
&gt; &gt; # virsh -d0 start instance-0000037c
&gt; &gt; start: domain(optdata): instance-0000037c
&gt; &gt; start: found option &lt;domain&gt;: instance-0000037c
&gt; &gt; start: &lt;domain&gt; trying as domain NAME
&gt; &gt; error: Failed to start domain instance-0000037c
&gt; &gt; error: monitor socket did not show up: No such file or directory
&gt; &gt; 
&gt; &gt; Full libvirtd debug log at
&gt; &gt; https://gist.github.com/bmb/08fbb6b6136c758d027e90ff139d5701
&gt; &gt; 
&gt; &gt; On 15 February 2017 at 00:47, Michal Privoznik &lt;mprivozn@redhat.com&gt; wrote:
&gt; &gt;&gt; I don't think I understand this. Who is running the other job? I mean,
&gt; &gt;&gt; I'd expect qemu fail to create the socket and thus hitting 30s timeout
&gt; &gt;&gt; in qemuMonitorOpenUnix().
&gt; &gt; 
&gt; &gt; Yes you're right, I just blindly started looking for 30s constants in
&gt; &gt; the code and that one seemed the most obvious but I had not tried to
&gt; &gt; trace it all the way back to the domain start job or checked the debug
&gt; &gt; logs yet, sorry. So looking a bit more carefully I see the real issue
&gt; &gt; is in src/qemu/qemu_monitor.c:
&gt; &gt; 
&gt; &gt; 321 static int
&gt; &gt; 322 qemuMonitorOpenUnix(const char *monitor, pid_t cpid)
&gt; &gt; 323 {
&gt; &gt; 324     struct sockaddr_un addr;
&gt; &gt; 325     int monfd;
&gt; &gt; 326     int timeout = 30; /* In seconds */
&gt; &gt; 
&gt; &gt; Is this safe to increase? Is there any reason to keep it at 30s given
&gt; &gt; (from what I'm seeing on a fast 2-socket Haswell system) that hugepage
&gt; &gt; backed guests larger than ~160GB memory will not be able to start in
&gt; &gt; that time?
&gt; &gt; 
&gt; 
&gt; I recall some similar discussion took place in the past. But I just
&gt; cannot find it now. I think the problem was that kernel is zeroing the
&gt; pages on huge page allocation. Anyway, this timeout used to be 3 seconds
&gt; and inly in fe89b687a0 it has been changed to 30 seconds.
&gt; 
&gt; We can increase the limit, but that would solve just this case until
&gt; somebody tries to assign even more RAM to their domain. What if we would
&gt; instead make this configurable? Have yet another variable living inside
&gt; qemu.conf that by default has value of 30 and specifies how long should
&gt; libvirt wait for qemu monitor to show up?
&gt; 
&gt; But frankly, on one hand I like this approach. But on the other I
&gt; dislike it at the same time - we have just too much variables in
&gt; qemu.conf because that's our answer to problems like these. We don't
&gt; know so we offload the setting to the sys admin.

Honestly it is well overdue for us to come up with an improvement to
QEMU that lets us start QEMU &amp; open the monitor in a race-free manner.
The obvious answer to this is to allow us to pass down a pre-opened
UNIX listener socket FD to QEMU. We can thus connect() immediately
with no race and then simply away the QMP greeting with no timeout,
safely getting EOF if QEMU fails to start.


Regards,
Daniel
-- 
|: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
|: http://libvirt.org              -o-             http://virt-manager.org :|
|: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|

</body></email><email><emailId>20170215130328</emailId><senderName>Blair Bethwaite</senderName><senderEmail>blair.bethwaite@gmail.com</senderEmail><timestampReceived>2017-02-15 13:03:28-0400</timestampReceived><subject>Re: [libvirt-users] high memory guest issues - virsh start and QEMU_JOB_WAIT_TIME</subject><body>

On 15 February 2017 at 20:40, Daniel P. Berrange &lt;berrange@redhat.com&gt; wrote:
&gt; On Wed, Feb 15, 2017 at 10:27:46AM +0100, Michal Privoznik wrote:
&gt;&gt; On 02/15/2017 03:43 AM, Blair Bethwaite wrote:
&gt;&gt; &gt; On 15 February 2017 at 00:57, Daniel P. Berrange &lt;berrange@redhat.com&gt; wrote:
&gt;&gt; &gt;&gt; What is the actual error you're getting during startup.
&gt;&gt; &gt;
&gt;&gt; &gt; # virsh -d0 start instance-0000037c
&gt;&gt; &gt; start: domain(optdata): instance-0000037c
&gt;&gt; &gt; start: found option &lt;domain&gt;: instance-0000037c
&gt;&gt; &gt; start: &lt;domain&gt; trying as domain NAME
&gt;&gt; &gt; error: Failed to start domain instance-0000037c
&gt;&gt; &gt; error: monitor socket did not show up: No such file or directory
&gt;&gt; &gt;
&gt;&gt; &gt; Full libvirtd debug log at
&gt;&gt; &gt; https://gist.github.com/bmb/08fbb6b6136c758d027e90ff139d5701
&gt;&gt; &gt;
&gt;&gt; &gt; On 15 February 2017 at 00:47, Michal Privoznik &lt;mprivozn@redhat.com&gt; wrote:
&gt;&gt; &gt;&gt; I don't think I understand this. Who is running the other job? I mean,
&gt;&gt; &gt;&gt; I'd expect qemu fail to create the socket and thus hitting 30s timeout
&gt;&gt; &gt;&gt; in qemuMonitorOpenUnix().
&gt;&gt; &gt;
&gt;&gt; &gt; Yes you're right, I just blindly started looking for 30s constants in
&gt;&gt; &gt; the code and that one seemed the most obvious but I had not tried to
&gt;&gt; &gt; trace it all the way back to the domain start job or checked the debug
&gt;&gt; &gt; logs yet, sorry. So looking a bit more carefully I see the real issue
&gt;&gt; &gt; is in src/qemu/qemu_monitor.c:
&gt;&gt; &gt;
&gt;&gt; &gt; 321 static int
&gt;&gt; &gt; 322 qemuMonitorOpenUnix(const char *monitor, pid_t cpid)
&gt;&gt; &gt; 323 {
&gt;&gt; &gt; 324     struct sockaddr_un addr;
&gt;&gt; &gt; 325     int monfd;
&gt;&gt; &gt; 326     int timeout = 30; /* In seconds */
&gt;&gt; &gt;
&gt;&gt; &gt; Is this safe to increase? Is there any reason to keep it at 30s given
&gt;&gt; &gt; (from what I'm seeing on a fast 2-socket Haswell system) that hugepage
&gt;&gt; &gt; backed guests larger than ~160GB memory will not be able to start in
&gt;&gt; &gt; that time?
&gt;&gt; &gt;
&gt;&gt;
&gt;&gt; I recall some similar discussion took place in the past. But I just
&gt;&gt; cannot find it now. I think the problem was that kernel is zeroing the
&gt;&gt; pages on huge page allocation. Anyway, this timeout used to be 3 seconds
&gt;&gt; and inly in fe89b687a0 it has been changed to 30 seconds.
&gt;&gt;
&gt;&gt; We can increase the limit, but that would solve just this case until
&gt;&gt; somebody tries to assign even more RAM to their domain. What if we would
&gt;&gt; instead make this configurable? Have yet another variable living inside
&gt;&gt; qemu.conf that by default has value of 30 and specifies how long should
&gt;&gt; libvirt wait for qemu monitor to show up?
&gt;&gt;
&gt;&gt; But frankly, on one hand I like this approach. But on the other I
&gt;&gt; dislike it at the same time - we have just too much variables in
&gt;&gt; qemu.conf because that's our answer to problems like these. We don't
&gt;&gt; know so we offload the setting to the sys admin.
&gt;
&gt; Honestly it is well overdue for us to come up with an improvement to
&gt; QEMU that lets us start QEMU &amp; open the monitor in a race-free manner.
&gt; The obvious answer to this is to allow us to pass down a pre-opened
&gt; UNIX listener socket FD to QEMU. We can thus connect() immediately
&gt; with no race and then simply away the QMP greeting with no timeout,
&gt; safely getting EOF if QEMU fails to start.

Wish I could volunteer to work on that but am afraid my day job has me
now thinking about building a custom package to work around this for
the moment, or even attempting to find the right hexedit against the
existing shared object o_0... probably a line of thinking I should
squash now. Would it be helpful to have this registered as a customer
RFE with Red Hat?

Cheers,
~Blairo

</body></email><email><emailId>20170215090312</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-02-15 09:03:12-0400</timestampReceived><subject>Re: [libvirt-users] Error in libvirt-GUI</subject><body>


On Wed, Feb 15, 2017 at 05:19:38AM +0000, abhishek jain wrote:
&gt; Hi,
&gt; I am using libvirt --&gt; 0.10.2  and virt-manager --&gt; 0.9.0 version (RHEL 6).
&gt; Very rare I get following error message dialogue box. (Image is attached for the \
&gt; error dialogue box ) Error saysError polling connection:'qemu+ssh......' Internal \
&gt; error client socket is closed TraceBack (most recent calls)engine.py: 440  \
&gt; conn.tickconnection.py: 1433   self.hostinfo() = self.vmm.getinfo() Is it a problem \
&gt; with libvirt or with my environment

It might be that the connection was interrupted due to keepalive or just
disconnected.  It is hard to remember how the code looked like back then
because libvirt 0.10.2 and virt-manager 0.9.0 are very VERY _VERY_ super
old and this is upstream list, so meybe you could try newer versions?

HTH,
Martin

&gt; Thanks in advance.
&gt; RegardsAbhishek
&gt; 
&gt; 


&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170215110148</emailId><senderName>abhishek jain</senderName><senderEmail>abhish_jain@yahoo.com</senderEmail><timestampReceived>2017-02-15 11:01:48-0400</timestampReceived><subject>Re: [libvirt-users] Error in libvirt-GUI</subject><body>

Thanks Martin.
I can only use RHEL6 so upgrading libvirt Version is not a choice.

RegardsAbhishek

      From: Martin Kletzander &lt;mkletzan@redhat.com&gt;
 To: abhishek jain &lt;abhish_jain@yahoo.com&gt; 
Cc: "libvirt-users@redhat.com" &lt;libvirt-users@redhat.com&gt;
 Sent: Wednesday, 15 February 2017 2:33 PM
 Subject: Re: [libvirt-users] Error in libvirt-GUI
   
On Wed, Feb 15, 2017 at 05:19:38AM +0000, abhishek jain wrote:
&gt; Hi,
&gt; I am using libvirt --&gt; 0.10.2   and virt-manager --&gt; 0.9.0 version (RHEL 6).
&gt; Very rare I get following error message dialogue box. (Image is attached for the \
&gt; error dialogue box ) Error saysError polling connection:'qemu+ssh......' Internal \
&gt; error client socket is closed TraceBack (most recent calls)engine.py: 440   \
&gt; conn.tickconnection.py: 1433    self.hostinfo() = self.vmm.getinfo() Is it a \
&gt; problem with libvirt or with my environment

It might be that the connection was interrupted due to keepalive or just
disconnected.   It is hard to remember how the code looked like back then
because libvirt 0.10.2 and virt-manager 0.9.0 are very VERY _VERY_ super
old and this is upstream list, so meybe you could try newer versions?

HTH,
Martin

&gt; Thanks in advance.
&gt; RegardsAbhishek
&gt; 
&gt; 


&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users

   


[Attachment #3 (text/html)]

&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;div style="color:#000; background-color:#fff; \
font-family:HelveticaNeue, Helvetica Neue, Helvetica, Arial, Lucida Grande, \
Sans-Serif;font-size:12px"&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487156341652_3871"&gt;&lt;span&gt;Thanks Martin.&lt;/span&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487156341652_3872"&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1487156341652_3874"&gt;&lt;span \
id="yui_3_16_0_ym19_1_1487156341652_3873"&gt;I can only use RHEL6 so upgrading libvirt \
Version is not a choice.&lt;/span&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1487156341652_3889"&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1487156341652_3892"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1487156341652_3893"&gt;&lt;span&gt;Regards&lt;/span&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1487156341652_3894"&gt;&lt;span&gt;Abhishek&lt;/span&gt;&lt;/div&gt;&lt;div \
class="qtdSeparateBR" id="yui_3_16_0_ym19_1_1487156341652_3895"&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="yahoo_quoted" id="yui_3_16_0_ym19_1_1487156341652_3900" style="display: \
block;"&gt;  &lt;div style="font-family: HelveticaNeue, Helvetica Neue, Helvetica, Arial, \
Lucida Grande, Sans-Serif; font-size: 12px;" \
id="yui_3_16_0_ym19_1_1487156341652_3899"&gt; &lt;div style="font-family: HelveticaNeue, \
Helvetica Neue, Helvetica, Arial, Lucida Grande, Sans-Serif; font-size: 16px;" \
id="yui_3_16_0_ym19_1_1487156341652_3898"&gt; &lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1487156341652_3897"&gt; &lt;font size="2" face="Arial" \
id="yui_3_16_0_ym19_1_1487156341652_3896"&gt; &lt;hr size="1"&gt; &lt;b&gt;&lt;span \
style="font-weight:bold;"&gt;From:&lt;/span&gt;&lt;/b&gt; Martin Kletzander \
&lt;mkletzan@redhat.com&gt;&lt;br&gt; &lt;b&gt;&lt;span style="font-weight: bold;"&gt;To:&lt;/span&gt;&lt;/b&gt; \
abhishek jain &lt;abhish_jain@yahoo.com&gt; &lt;br&gt;&lt;b&gt;&lt;span style="font-weight: \
bold;"&gt;Cc:&lt;/span&gt;&lt;/b&gt; "libvirt-users@redhat.com" &lt;libvirt-users@redhat.com&gt;&lt;br&gt; \
&lt;b&gt;&lt;span style="font-weight: bold;"&gt;Sent:&lt;/span&gt;&lt;/b&gt; Wednesday, 15 February 2017 2:33 \
PM&lt;br&gt; &lt;b&gt;&lt;span style="font-weight: bold;"&gt;Subject:&lt;/span&gt;&lt;/b&gt; Re: [libvirt-users] \
Error in libvirt-GUI&lt;br&gt; &lt;/font&gt; &lt;/div&gt; &lt;div class="y_msg_container" \
id="yui_3_16_0_ym19_1_1487156341652_3901"&gt;&lt;br&gt;On Wed, Feb 15, 2017 at 05:19:38AM \
+0000, abhishek jain wrote:&lt;br clear="none"&gt;&gt;Hi,&lt;br clear="none"&gt;&gt;I am using \
libvirt --&gt; 0.10.2  and virt-manager --&gt; 0.9.0 version (RHEL 6).&lt;br \
clear="none"&gt;&gt;Very rare I get following error message dialogue box. (Image is \
attached for the error dialogue box )&lt;br clear="none"&gt;&gt;Error saysError polling \
connection:'qemu+ssh......' Internal error client socket is closed&lt;br \
clear="none"&gt;&gt;TraceBack (most recent calls)engine.py: 440 \
 conn.tickconnection.py: 1433   self.hostinfo() = self.vmm.getinfo()&lt;br \
clear="none"&gt;&gt;Is it a problem with libvirt or with my environment&lt;br \
clear="none"&gt;&lt;br clear="none"&gt;It might be that the connection was interrupted due to \
keepalive or just&lt;br clear="none"&gt;disconnected.  It is hard to remember how the \
code looked like back then&lt;br clear="none"&gt;because libvirt 0.10.2 and virt-manager \
0.9.0 are very VERY _VERY_ super&lt;br clear="none"&gt;old and this is upstream list, so \
meybe you could try newer versions?&lt;br clear="none"&gt;&lt;br clear="none"&gt;HTH,&lt;br \
clear="none"&gt;Martin&lt;div class="yqt4665024846" id="yqtfd51016"&gt;&lt;br clear="none"&gt;&lt;br \
clear="none"&gt;&gt;Thanks in advance.&lt;br clear="none"&gt;&gt;RegardsAbhishek&lt;/div&gt;&lt;br \
clear="none"&gt;&gt;&lt;br clear="none"&gt;&gt;&lt;br clear="none"&gt;&lt;br clear="none"&gt;&lt;br \
clear="none"&gt;&gt;_______________________________________________&lt;br \
clear="none"&gt;&gt;libvirt-users mailing list&lt;br clear="none"&gt;&gt;&lt;a shape="rect" \
ymailto="mailto:libvirt-users@redhat.com" \
href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br \
clear="none"&gt;&gt;&lt;a shape="rect" \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" \
target="_blank"&gt;https://www.redhat.com/mailman/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt; \
&lt;/div&gt; &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;



</body></email><email><emailId>20170208171311</emailId><senderName>Aleksei</senderName><senderEmail>alex3kov@zoho.com</senderEmail><timestampReceived>2017-02-08 17:13:11-0400</timestampReceived><subject>Re: [libvirt-users] Trouble moving OVMF guest to new host</subject><body>

I'm running libvirt in user session and libvirt creates VARS part of 
OVMF in ~/.config/libvirt/qemu/nvram/

Check your xml, there should be lines like this:

&lt;os&gt;
     &lt;type arch='x86_64' machine='pc-q35-2.7'&gt;hvm&lt;/type&gt;
     &lt;loader readonly='yes' type='pflash'&gt;/UEFI_OVMF/OVMF_CODE.fd&lt;/loader&gt;
&lt;nvram&gt;/home/username/.config/libvirt/qemu/nvram/vm_VARS.fd&lt;/nvram&gt;


/--Regards, Aleksei/

------------------------------------------------------------------------

*From:* Bashe, Joe
*Sent:* Wednesday, February 08, 2017 7:53PM
*To:* Libvirt-users
*Subject:* [libvirt-users] Trouble moving OVMF guest to new host
&gt; Hello,
&gt;
&gt; I recently had to reinstall my operating system on my computer. I made 
&gt; a backup of the entire partition beforehand onto an external drive. 
&gt; Now I am trying to import a VM from that backup onto the newly 
&gt; installed system.
&gt;
&gt; What I've done so far:
&gt;
&gt;   * copied over the qcow2 disk image
&gt;   * copied over the XML config file
&gt;   * copied over the OVMF files under /usr/share/edk2.git/ovmf-x64/
&gt;
&gt; I am getting this error whenever I try to boot the VM:
&gt;
&gt; Error starting domain: operation failed: unable to find any master var 
&gt; store for loader: /usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd
&gt;
&gt; The file /usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd does exist.
&gt;
&gt; Where would the "master var store" be located?
&gt;
&gt; Thank you,
&gt;
&gt; Joe
&gt; --
&gt; Joseph Bashe
&gt; Technical Director
&gt; Bashe Development
&gt; +1 (323) 999-1731
&gt;
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users


[Attachment #3 (text/html)]

&lt;html&gt;
  &lt;head&gt;
    &lt;meta content="text/html; charset=windows-1252"
      http-equiv="Content-Type"&gt;
  &lt;/head&gt;
  &lt;body smarttemplateinserted="true" bgcolor="#FFFFFF" text="#000000"&gt;
    &lt;div id="smartTemplate4-template"&gt;
      &lt;p&gt;I'm running libvirt in user session and libvirt creates VARS
        part of OVMF in ~/.config/libvirt/qemu/nvram/&lt;/p&gt;
      &lt;p&gt;Check your xml, there should be lines like this:&lt;/p&gt;
      &lt;p&gt;&lt;os&gt;&lt;br&gt;
            &lt;type arch='x86_64'
        machine='pc-q35-2.7'&gt;hvm&lt;/type&gt;&lt;br&gt;
            &lt;loader readonly='yes'
        type='pflash'&gt;/UEFI_OVMF/OVMF_CODE.fd&lt;/loader&gt;&lt;br&gt;
           
&lt;nvram&gt;/home/username/.config/libvirt/qemu/nvram/vm_VARS.fd&lt;/nvram&gt;&lt;br&gt;
        &lt;br&gt;
      &lt;/p&gt;
    &lt;/div&gt;
    &lt;br&gt;
    &lt;div class="moz-signature"&gt;&lt;i&gt;--Regards, Aleksei&lt;/i&gt;
    &lt;/div&gt;
    &lt;br&gt;
    &lt;div id="smartTemplate4-quoteHeader"&gt;
      &lt;hr&gt;&lt;br&gt;
      &lt;b&gt;From:&lt;/b&gt; Bashe, Joe&lt;br&gt;
      &lt;b&gt;Sent:&lt;/b&gt; Wednesday, February 08, 2017 7:53PM&lt;br&gt;
      &lt;b&gt;To:&lt;/b&gt; Libvirt-users&lt;br&gt;
      &lt;b&gt;Subject:&lt;/b&gt; [libvirt-users] Trouble moving OVMF guest to new
      host&lt;/div&gt;
    &lt;blockquote
cite="mid:CAM-MuP8PD4ad7R0ZRkiD+Gn72CABStWh2Rm4YDtmTdDL4BaQ4Q@mail.gmail.com"
      type="cite"&gt;
      &lt;div dir="ltr"&gt;
        &lt;div class="gmail_default"
          style="font-family:arial,helvetica,sans-serif"&gt;Hello,&lt;/div&gt;
        &lt;div class="gmail_default"
          style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;
        &lt;/div&gt;
        &lt;div class="gmail_default"
          style="font-family:arial,helvetica,sans-serif"&gt;I recently had
          to reinstall my operating system on my computer. I made a
          backup of the entire partition beforehand onto an external
          drive. Now I am trying to import a VM from that backup onto
          the newly installed system.&lt;/div&gt;
        &lt;div class="gmail_default"
          style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;
        &lt;/div&gt;
        &lt;div class="gmail_default"
          style="font-family:arial,helvetica,sans-serif"&gt;What I've done
          so far:&lt;/div&gt;
        &lt;div class="gmail_default"&gt;
          &lt;ul&gt;
            &lt;li&gt;&lt;font face="arial, helvetica, sans-serif"&gt;copied over
                the qcow2 disk image&lt;/font&gt;&lt;/li&gt;
            &lt;li style="font-family:arial,helvetica,sans-serif"&gt;copied
              over the XML config file&lt;/li&gt;
            &lt;li style="font-family:arial,helvetica,sans-serif"&gt;copied
              over the OVMF files under /usr/share/edk2.git/ovmf-x64/&lt;/li&gt;
          &lt;/ul&gt;
        &lt;/div&gt;
        &lt;div class="gmail_default"
          style="font-family:arial,helvetica,sans-serif"&gt;I am getting
          this error whenever I try to boot the VM:&lt;br&gt;
        &lt;/div&gt;
        &lt;div class="gmail_default"
          style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;
        &lt;/div&gt;
        &lt;div class="gmail_default"&gt;&lt;font face="monospace, monospace"&gt;Error
            starting domain: operation failed: unable to find any master
            var store for loader:
            /usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd&lt;br&gt;
          &lt;/font&gt;&lt;/div&gt;
        &lt;div class="gmail_default"&gt;&lt;font face="arial, helvetica,
            sans-serif"&gt;&lt;br&gt;
          &lt;/font&gt;&lt;/div&gt;
        &lt;div class="gmail_default"&gt;&lt;font face="arial, helvetica,
            sans-serif"&gt;The file &lt;/font&gt;&lt;span
            style="font-family:monospace,monospace"&gt;/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd&lt;/span&gt;&lt;span
                
            style="font-family:arial,helvetica,sans-serif"&gt; does exist. &lt;/span&gt;&lt;/div&gt;
        &lt;div class="gmail_default"&gt;&lt;span
            style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;
          &lt;/span&gt;&lt;/div&gt;
        &lt;div class="gmail_default"&gt;&lt;span
            style="font-family:arial,helvetica,sans-serif"&gt;Where would
            the "master var store" be located?&lt;/span&gt;&lt;/div&gt;
        &lt;div class="gmail_default"&gt;&lt;font face="arial, helvetica,
            sans-serif"&gt;&lt;br&gt;
          &lt;/font&gt;&lt;/div&gt;
        &lt;div class="gmail_default"&gt;&lt;span
            style="font-family:arial,helvetica,sans-serif"&gt;Thank you,&lt;/span&gt;&lt;br&gt;
        &lt;/div&gt;
        &lt;div class="gmail_default"&gt;&lt;font face="arial, helvetica,
            sans-serif"&gt;&lt;br&gt;
          &lt;/font&gt;&lt;/div&gt;
        &lt;div class="gmail_default"&gt;&lt;font face="arial, helvetica,
            sans-serif"&gt;Joe&lt;/font&gt;&lt;/div&gt;
        &lt;div&gt;
          &lt;div class="gmail_signature"&gt;
            &lt;div dir="ltr"&gt;
              &lt;div&gt;
                &lt;div dir="ltr"&gt;
                  &lt;div&gt;
                    &lt;div dir="ltr"&gt;&lt;font face="arial, helvetica,
                        sans-serif"&gt;--&lt;br&gt;
                        Joseph Bashe&lt;br&gt;
                        Technical Director&lt;/font&gt;
                      &lt;div&gt;&lt;font face="arial, helvetica, sans-serif"&gt;Bashe
                          Development&lt;br&gt;
                          +1 (323) 999-1731&lt;/font&gt;&lt;/div&gt;
                    &lt;/div&gt;
                  &lt;/div&gt;
                &lt;/div&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;br&gt;
      &lt;fieldset class="mimeAttachmentHeader"&gt;&lt;/fieldset&gt;
      &lt;br&gt;
      &lt;pre wrap=""&gt;_______________________________________________
libvirt-users mailing list
&lt;a class="moz-txt-link-abbreviated" \
href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt; &lt;a \
class="moz-txt-link-freetext" \
href="https://www.redhat.com/mailman/listinfo/libvirt-users"&gt;https://www.redhat.com/mailman/listinfo/libvirt-users&lt;/a&gt;&lt;/pre&gt;
  &lt;/blockquote&gt;
    &lt;br&gt;
  &lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170208172938</emailId><senderName>Žilvinas_Žaltiena</senderName><senderEmail>zaltys@inbox.ru</senderEmail><timestampReceived>2017-02-08 17:29:38-0400</timestampReceived><subject>Re: [libvirt-users] Trouble moving OVMF guest to new host</subject><body>

Hello,

I suppose OVMF_CODE-pure-efi.fd is likely your firmware (CODE in name). 
There should also be firmware's variable template file (used for the 1st 
startup, usually there is VARS in file name) and firmware variable file, 
where firmware's actual settings are stored.

Those 3 files can be designated in domain's XML or qemu.conf, so try 
looking there for paths. On my system, it is /var/lib/libvirt/qemu/nvram/

On 2017.02.08 18:53, Bashe, Joe wrote:
&gt; Hello,
&gt;
&gt; I recently had to reinstall my operating system on my computer. I made a
&gt; backup of the entire partition beforehand onto an external drive. Now I
&gt; am trying to import a VM from that backup onto the newly installed system.
&gt;
&gt; What I've done so far:
&gt;
&gt;   * copied over the qcow2 disk image
&gt;   * copied over the XML config file
&gt;   * copied over the OVMF files under /usr/share/edk2.git/ovmf-x64/
&gt;
&gt; I am getting this error whenever I try to boot the VM:
&gt;
&gt; Error starting domain: operation failed: unable to find any master var
&gt; store for loader: /usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd
&gt;
&gt; The file /usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd does exist.
&gt;
&gt; Where would the "master var store" be located?
&gt;
&gt; Thank you,
&gt;
&gt; Joe
&gt; --
&gt; Joseph Bashe
&gt; Technical Director
&gt; Bashe Development
&gt; +1 (323) 999-1731
&gt;
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;

</body></email><email><emailId>20170208181240</emailId><senderName>Andrea Bolognani</senderName><senderEmail>abologna@redhat.com</senderEmail><timestampReceived>2017-02-08 18:12:40-0400</timestampReceived><subject>Re: [libvirt-users] Trouble moving OVMF guest to new host</subject><body>

On Wed, 2017-02-08 at 20:13 +0300, Aleksei wrote:
&gt; I'm running libvirt in user session and libvirt creates VARS part of OVMF in \
&gt; ~/.config/libvirt/qemu/nvram/ Check your xml, there should be lines like this:
&gt; &lt;os&gt;
&gt; &lt;type arch='x86_64' machine='pc-q35-2.7'&gt;hvm&lt;/type&gt;
&gt; &lt;loader readonly='yes' type='pflash'&gt;/UEFI_OVMF/OVMF_CODE.fd&lt;/loader&gt;
&gt; &lt;nvram&gt;/home/username/.config/libvirt/qemu/nvram/vm_VARS.fd&lt;/nvram&gt;

... or in /var/lib/libvirt/qemu/nvram, if you're using
the system-wide libvirtd instance.

Anyway, Aleksei is right that you should copy over the
variable store (vm_VARS.fd) along with the disk image
and the XML configuration: some guest operating systems
are able to cope with its absence and recreate the
correct EFI variables automatically, but that's not
always the case.

Moreover, you should make sure your /etc/libvirt/qemu.conf
file contains something along the lines of

  nvram = [
    "/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd:/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd/OVMF_VARS-pure-efi.fd"
  ]

so that, in case the variable store for the guest is missing
or your simply creating a new guest, libvirt will be able to
create a new one by copying over the template (the "master
var store" the error was referring to).

By the way, edk2-ovmf is included in Fedora proper these
days, you don't need to use edk2.git-ovmf-x64 any longer ;)

-- 
Andrea Bolognani / Red Hat / Virtualization


</body></email><email><emailId>20170203050959</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-02-03 05:09:59-0400</timestampReceived><subject>Re: [libvirt-users] accessing USB as storage device through lxc container.</subject><body>


On Thu, Feb 02, 2017 at 06:30:24PM -0800, ravi mh wrote:
&gt;Hi all,
&gt;
&gt;I am not able to access USB as storage device in the lxc container.
&gt;Having tried to pass the usb device with the product and vendor id, not
&gt;able to see the device mounted in the lxc file system.
&gt;

It won't be mounted, it will just be passed through as a device,
i.e. you will see it in the lsusb output.  If you need to mount it, then
it needs to be done either in the container (for which you might need
some capability) or mounted on the host and just using device
&lt;filesystem/&gt; instead.

&gt;However, they are seen as char devices in the container at the location.
&gt;There is no issue of ACL, as the capabilities restrictions have been
&gt;dropped.
&gt;
&gt;Has anyone successfully mounted the storage device in the libvirt.  Having
&gt;gone through the libvirt documentation, couldnt find further information of
&gt;enabling the usb as storage device.  Any pointers towards that would be
&gt;useful.
&gt;
&gt;
&gt;Host OS:
&gt;
&gt;IR800-GOS-1:~# lsusb
&gt;Bus 001 Device 003: ID 8644:800b
&gt;Bus 001 Device 001: ID 1d6b:0002
&gt;Bus 002 Device 001: ID 1d6b:0001
&gt;IR800-GOS-1:~#
&gt;
&gt;Lxc app container:
&gt;
&gt;root@ir800-lxc:/mnt/usb# ls -la  /dev/bus/usb/001/003
&gt;*crwx-*-----    1 root     root      189,   2 Feb  3 01:44
&gt;/dev/bus/usb/001/003
&gt;
&gt;
&gt;
&gt;----------libvirt xml snippet ------------
&gt;
&gt;    &lt;hostdev mode='subsystem' type='usb' managed='yes'&gt;
&gt;      &lt;source&gt;
&gt;        &lt;vendor id='0x8644'/&gt;
&gt;        &lt;product id='0x800b'/&gt;
&gt;      &lt;/source&gt;
&gt;    &lt;/hostdev&gt;
&gt;
&gt;-----------------------------
&gt;while changing the mode from subsystem to capabilities, it issues error for
&gt;validating against the schema.
&gt;
&gt;---------------while changing the hostdev mode='capabilities'----------
&gt;
&gt;virsh # edit n01_1
&gt;*error: XML document failed to validate against schema: Unable to validate
&gt;doc against /usr/share/libvirt/schemas/domain.rng*
&gt;Extra element devices in interleave
&gt;Element domain failed to validate content
&gt;
&gt;Failed. Try again? [y,n,i,f,?]:
&gt;error: XML document failed to validate against schema: Unable to validate
&gt;doc against /usr/share/libvirt/schemas/domain.rng
&gt;
&gt;--------------------------------------------
&gt;
&gt;
&gt;Regards,
&gt;*Ravi*

&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170207190054</emailId><senderName>ravi mh</senderName><senderEmail>ravi.zombie@gmail.com</senderEmail><timestampReceived>2017-02-07 19:00:54-0400</timestampReceived><subject>Re: [libvirt-users] accessing USB as storage device through lxc container.</subject><body>

Thanks Martin for the info.



I have tried the below snippet in the libvirt xml.

 &lt;hostdev mode='capabilities' type='storage'&gt;
      &lt;source&gt;
        &lt;block&gt;/dev/sdc1&lt;/block&gt;
      &lt;/source&gt;
    &lt;/hostdev&gt;

------------

root@ir800-lxc:~# mount /dev/sdc1 /mnt/usbdr/

mount: permission denied (are you root?)

----------

It works if the usernamespace is not enabled.



The reason being, we have enabled the username and hence its unprivileged
container.

As per this patch:
https://www.redhat.com/archives/libvir-list/2012-November/msg01555.html,
the capabilities with USB as storage is available for mounting if its
privileged container.

Is there a way to mount this inside the container with usernamespace
enabled and with some capabilities turned on?



Regards,
*Ravi M H*



On Thu, Feb 2, 2017 at 9:09 PM, Martin Kletzander &lt;mkletzan@redhat.com&gt;
wrote:

&gt; On Thu, Feb 02, 2017 at 06:30:24PM -0800, ravi mh wrote:
&gt;
&gt;&gt; Hi all,
&gt;&gt;
&gt;&gt; I am not able to access USB as storage device in the lxc container.
&gt;&gt; Having tried to pass the usb device with the product and vendor id, not
&gt;&gt; able to see the device mounted in the lxc file system.
&gt;&gt;
&gt;&gt;
&gt; It won't be mounted, it will just be passed through as a device,
&gt; i.e. you will see it in the lsusb output.  If you need to mount it, then
&gt; it needs to be done either in the container (for which you might need
&gt; some capability) or mounted on the host and just using device
&gt; &lt;filesystem/&gt; instead.
&gt;
&gt; However, they are seen as char devices in the container at the location.
&gt;&gt; There is no issue of ACL, as the capabilities restrictions have been
&gt;&gt; dropped.
&gt;&gt;
&gt;&gt; Has anyone successfully mounted the storage device in the libvirt.  Having
&gt;&gt; gone through the libvirt documentation, couldnt find further information
&gt;&gt; of
&gt;&gt; enabling the usb as storage device.  Any pointers towards that would be
&gt;&gt; useful.
&gt;&gt;
&gt;&gt;
&gt;&gt; Host OS:
&gt;&gt;
&gt;&gt; IR800-GOS-1:~# lsusb
&gt;&gt; Bus 001 Device 003: ID 8644:800b
&gt;&gt; Bus 001 Device 001: ID 1d6b:0002
&gt;&gt; Bus 002 Device 001: ID 1d6b:0001
&gt;&gt; IR800-GOS-1:~#
&gt;&gt;
&gt;&gt; Lxc app container:
&gt;&gt;
&gt;&gt; root@ir800-lxc:/mnt/usb# ls -la  /dev/bus/usb/001/003
&gt;&gt; *crwx-*-----    1 root     root      189,   2 Feb  3 01:44
&gt;&gt; /dev/bus/usb/001/003
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; ----------libvirt xml snippet ------------
&gt;&gt;
&gt;&gt;    &lt;hostdev mode='subsystem' type='usb' managed='yes'&gt;
&gt;&gt;      &lt;source&gt;
&gt;&gt;        &lt;vendor id='0x8644'/&gt;
&gt;&gt;        &lt;product id='0x800b'/&gt;
&gt;&gt;      &lt;/source&gt;
&gt;&gt;    &lt;/hostdev&gt;
&gt;&gt;
&gt;&gt; -----------------------------
&gt;&gt; while changing the mode from subsystem to capabilities, it issues error
&gt;&gt; for
&gt;&gt; validating against the schema.
&gt;&gt;
&gt;&gt; ---------------while changing the hostdev mode='capabilities'----------
&gt;&gt;
&gt;&gt; virsh # edit n01_1
&gt;&gt; *error: XML document failed to validate against schema: Unable to validate
&gt;&gt; doc against /usr/share/libvirt/schemas/domain.rng*
&gt;&gt; Extra element devices in interleave
&gt;&gt; Element domain failed to validate content
&gt;&gt;
&gt;&gt; Failed. Try again? [y,n,i,f,?]:
&gt;&gt; error: XML document failed to validate against schema: Unable to validate
&gt;&gt; doc against /usr/share/libvirt/schemas/domain.rng
&gt;&gt;
&gt;&gt; --------------------------------------------
&gt;&gt;
&gt;&gt;
&gt;&gt; Regards,
&gt;&gt; *Ravi*
&gt;&gt;
&gt;
&gt; _______________________________________________
&gt;&gt; libvirt-users mailing list
&gt;&gt; libvirt-users@redhat.com
&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;










&lt;p style="margin:0in;font-family:calibri;font-size:11pt"&gt;Thanks Martin for
the info.&lt;/p&gt;

&lt;p style="margin:0in;font-family:calibri;font-size:11pt"&gt;  &lt;/p&gt;

&lt;p style="margin:0in;font-family:calibri;font-size:11pt"&gt;I have tried the
below snippet in the libvirt xml. &lt;/p&gt;

&lt;p style="margin:0in;font-family:calibri;font-size:11pt;color:black"&gt;&lt;span&gt;  \
&lt;/span&gt;&lt;hostdev mode='capabilities' type='storage'&gt;&lt;br&gt;
&lt;span&gt;           &lt;/span&gt;&lt;source&gt;&lt;br&gt;
&lt;span&gt;              
&lt;/span&gt;&lt;block&gt;/dev/sdc1&lt;/block&gt;&lt;br&gt;
&lt;span&gt;           &lt;/span&gt;&lt;/source&gt;&lt;br&gt;
&lt;span&gt;       &lt;/span&gt;&lt;/hostdev&gt;&lt;/p&gt;

&lt;p style="margin:0in;font-family:calibri;font-size:11pt;color:black"&gt;------------&lt;/p&gt;

&lt;p style="margin:0in;font-family:calibri;font-size:11pt"&gt;root@ir800-lxc:~#
mount /dev/sdc1 /mnt/usbdr/&lt;/p&gt;

&lt;p style="margin:0in;font-family:calibri;font-size:11pt"&gt;mount: permission
denied (are you root?)&lt;/p&gt;

&lt;p style="margin:0in;font-family:calibri;font-size:11pt"&gt;----------&lt;/p&gt;

&lt;p style="margin:0in;font-family:calibri;font-size:11pt;color:black"&gt;It works
if the usernamespace is not enabled.&lt;/p&gt;

&lt;p style="margin:0in;font-family:calibri;font-size:11pt"&gt;  &lt;/p&gt;

&lt;p style="margin:0in;font-family:calibri;font-size:11pt;color:black"&gt;The
reason being, we have enabled the username and hence its unprivileged
container.&lt;/p&gt;

&lt;p style="margin:0in;font-family:calibri;font-size:11pt"&gt;&lt;span style="color:black"&gt;As \
per this patch: &lt;/span&gt;&lt;a \
href="https://www.redhat.com/archives/libvir-list/2012-November/msg01555.html"&gt;https://www.redhat.com/archives/libvir-list/2012-November/msg01555.html&lt;/a&gt;&lt;span \
style="color:black"&gt;, the capabilities with USB as storage is available for mounting \
if its privileged container.&lt;/span&gt;&lt;/p&gt;

&lt;p style="margin:0in;font-family:calibri;font-size:11pt;color:black"&gt;Is there
a way to mount this inside the container with usernamespace enabled and with
some capabilities turned on?&lt;/p&gt;





&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;div class="gmail_extra"&gt;&lt;div&gt;&lt;div \
class="gmail-m_1197162739027565547gmail_signature"&gt;&lt;div dir="ltr"&gt;&lt;font \
face="georgia, serif" color="#444444"&gt;&lt;span \
style="font-family:arial,helvetica,sans-serif"&gt;Regards,&lt;/span&gt;&lt;/font&gt;&lt;font \
face="georgia, serif" color="#444444"&gt;&lt;font face="georgia, serif" \
color="#444444"&gt;&lt;i&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/i&gt;&lt;/font&gt;&lt;i&gt;&lt;b&gt;Ravi M H&lt;/b&gt;&lt;/i&gt;&lt;/font&gt;&lt;br&gt;&lt;font \
size="1"&gt;&lt;span style="font-family:tahoma,sans-serif"&gt;&lt;span \
style="color:rgb(0,0,153)"&gt;&lt;/span&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Thu, Feb 2, 2017 at 9:09 PM, Martin Kletzander &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:mkletzan@redhat.com" \
target="_blank"&gt;mkletzan@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt;&lt;span class="gmail-m_1197162739027565547gmail-"&gt;On \
Thu, Feb 02, 2017 at 06:30:24PM -0800, ravi mh wrote:&lt;br&gt; &lt;blockquote \
class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt; Hi all,&lt;br&gt;
&lt;br&gt;
I am not able to access USB as storage device in the lxc container.&lt;br&gt;
Having tried to pass the usb device with the product and vendor id, not&lt;br&gt;
able to see the device mounted in the lxc file system.&lt;br&gt;
&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;&lt;/span&gt;
It won't be mounted, it will just be passed through as a device,&lt;br&gt;
i.e. you will see it in the lsusb output.   If you need to mount it, then&lt;br&gt;
it needs to be done either in the container (for which you might need&lt;br&gt;
some capability) or mounted on the host and just using device&lt;br&gt;
&lt;filesystem/&gt; instead.&lt;br&gt;
&lt;br&gt;
&lt;blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt;&lt;span class="gmail-m_1197162739027565547gmail-"&gt; \
However, they are seen as char devices in the container at the location.&lt;br&gt; There is \
no issue of ACL, as the capabilities restrictions have been&lt;br&gt; dropped.&lt;br&gt;
&lt;br&gt;
Has anyone successfully mounted the storage device in the libvirt.   Having&lt;br&gt;
gone through the libvirt documentation, couldnt find further information of&lt;br&gt;
enabling the usb as storage device.   Any pointers towards that would be&lt;br&gt;
useful.&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
Host OS:&lt;br&gt;
&lt;br&gt;
IR800-GOS-1:~# lsusb&lt;br&gt;
Bus 001 Device 003: ID 8644:800b&lt;br&gt;
Bus 001 Device 001: ID 1d6b:0002&lt;br&gt;
Bus 002 Device 001: ID 1d6b:0001&lt;br&gt;
IR800-GOS-1:~#&lt;br&gt;
&lt;br&gt;
Lxc app container:&lt;br&gt;
&lt;br&gt;
root@ir800-lxc:/mnt/usb# ls -la   /dev/bus/usb/001/003&lt;br&gt;&lt;/span&gt;
*crwx-*-----      1 root        root         189,     2 Feb   3 01:44&lt;span \
                class="gmail-m_1197162739027565547gmail-"&gt;&lt;br&gt;
/dev/bus/usb/001/003&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
----------libvirt xml snippet ------------&lt;br&gt;
&lt;br&gt;
     &lt;hostdev mode='subsystem' type='usb' \
managed='yes'&gt;&lt;br&gt;  &lt;source&gt;&lt;br&gt;
           &lt;vendor id='0x8644'/&gt;&lt;br&gt;
           &lt;product id='0x800b'/&gt;&lt;br&gt;
        &lt;/source&gt;&lt;br&gt;
     &lt;/hostdev&gt;&lt;br&gt;
&lt;br&gt;
-----------------------------&lt;br&gt;
while changing the mode from subsystem to capabilities, it issues error for&lt;br&gt;
validating against the schema.&lt;br&gt;
&lt;br&gt;
---------------while changing the hostdev mode='capabilities'----------&lt;br&gt;
&lt;br&gt;
virsh # edit n01_1&lt;br&gt;&lt;/span&gt;
*error: XML document failed to validate against schema: Unable to validate&lt;br&gt;
doc against /usr/share/libvirt/schemas/dom&lt;wbr&gt;ain.rng*&lt;span \
class="gmail-m_1197162739027565547gmail-"&gt;&lt;br&gt; Extra element devices in \
interleave&lt;br&gt; Element domain failed to validate content&lt;br&gt;
&lt;br&gt;
Failed. Try again? [y,n,i,f,?]:&lt;br&gt;
error: XML document failed to validate against schema: Unable to validate&lt;br&gt;
doc against /usr/share/libvirt/schemas/dom&lt;wbr&gt;ain.rng&lt;br&gt;
&lt;br&gt;
------------------------------&lt;wbr&gt;--------------&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
Regards,&lt;br&gt;&lt;/span&gt;
*Ravi*&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;
&lt;blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt; \
______________________________&lt;wbr&gt;_________________&lt;br&gt; libvirt-users mailing \
list&lt;br&gt; &lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt; \
&lt;/blockquote&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170206174727</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-02-06 17:47:27-0400</timestampReceived><subject>Re: [libvirt-users] Real time threads don't work in libvirt containers under CentOS 7.3</subject><body>

On Mon, Feb 06, 2017 at 09:32:29AM -0800, Peter Steele wrote:
&gt; We've been using libvirt based containers under CentOS 7 and everything has
&gt; been working fine. One application we run in our containers is ctdb, which
&gt; uses SCHED_FIFO (real time) threads. This has been working without problems
&gt; until our recent upgrade to CentOS 7.3. For some reason, ctdb is no longer
&gt; able to create real time threads, and I've tried a simple program myself
&gt; that confirms this. The same program works fine on the hypervisor so I know
&gt; the kernel supports real time. Does anyone know what may have changed in
&gt; CentOS 7.3 that breaks real time threads in libvirt containers?

If I had to guess, perhaps some tunable in cgroups is denying execution
time ?


Regards,
Daniel
-- 
|: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
|: http://libvirt.org              -o-             http://virt-manager.org :|
|: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|

</body></email><email><emailId>20170201092202</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-02-01 09:22:02-0400</timestampReceived><subject>Re: [libvirt-users] Libvirt and Virt-manager compatibility</subject><body>

On 02/01/2017 05:54 AM, abhishek jain wrote:
&gt; Hi,
&gt; I am using Libvirt (1.2.2) on RHEL6. I want to use the compatible virt-manager for \
&gt; it. When I tried 1.4.0 and 1.3.0 there is an insatllation issue on RHLE6 for gtk3.  \
&gt; Is there any virt-manager version which works with 1.2.2 and RHLE6 too. Also what \
&gt; is the compatibility matrix for libvirt and virt-manager version.

Doesn't

# yum install virt-manager

install the right one? Looking into RHEL6 repo I see virt-manager-0.9.0
built for RHEL6. And after looking into virt-manager's repo I found this
commit 3c3237b9510 which reworked it into using gtk3. The commit is part
of 0.10.0 release. So I guess you're stuck with 0.9.0 on RHEL6.

Michal


</body></email><email><emailId>20170201094521</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-02-01 09:45:21-0400</timestampReceived><subject>Re: [libvirt-users] Libvirt and Virt-manager compatibility</subject><body>

On Wed, Feb 01, 2017 at 04:54:01AM +0000, abhishek jain wrote:
&gt; Hi,
&gt; I am using Libvirt (1.2.2) on RHEL6. I want to use the compatible
&gt; virt-manager for it.
&gt; When I tried 1.4.0 and 1.3.0 there is an insatllation issue on RHLE6
&gt; for gtk3.   Is there any virt-manager version which works with 1.2.2
&gt; and RHLE6 too.

The current releases of virt-manager all require GTK3 and thus RHEL6
is no longer a supported platform for running virt-manager.

You can, however, run virt-manager on a modern desktop (Fedora, or
RHEL-7) and have it connect to libvirt on a RHEL-6 host remotely.

Regards,
Daniel
-- 
|: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
|: http://libvirt.org              -o-             http://virt-manager.org :|
|: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|

</body></email><email><emailId>20170201130924</emailId><senderName>abhishek jain</senderName><senderEmail>abhish_jain@yahoo.com</senderEmail><timestampReceived>2017-02-01 13:09:24-0400</timestampReceived><subject>Re: [libvirt-users] Libvirt and Virt-manager compatibility</subject><body>

Thanks Michal.
Yes I am stuck with 0.9.0 virt-manager version.
Is this compatible with libvirt 1.2.2 release?  From where I get such compatibility \
matrix Regards  Abhishek  

Sent from Yahoo Mail on Android 
 
  On Wed, 1 Feb, 2017 at 2:52 PM, Michal Privoznik&lt;mprivozn@redhat.com&gt; wrote:   On \
02/01/2017 05:54 AM, abhishek jain wrote:
&gt; Hi,
&gt; I am using Libvirt (1.2.2) on RHEL6. I want to use the compatible virt-manager for \
&gt; it. When I tried 1.4.0 and 1.3.0 there is an insatllation issue on RHLE6 for gtk3.  \
&gt; Is there any virt-manager version which works with 1.2.2 and RHLE6 too. Also what \
&gt; is the compatibility matrix for libvirt and virt-manager version.

Doesn't

# yum install virt-manager

install the right one? Looking into RHEL6 repo I see virt-manager-0.9.0
built for RHEL6. And after looking into virt-manager's repo I found this
commit 3c3237b9510 which reworked it into using gtk3. The commit is part
of 0.10.0 release. So I guess you're stuck with 0.9.0 on RHEL6.

Michal
  


[Attachment #3 (text/html)]

Thanks Michal.&lt;div id="yMail_cursorElementTracker_1485954451133"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
id="yMail_cursorElementTracker_1485954452152"&gt;Yes I am stuck with 0.9.0 virt-manager \
version.&lt;/div&gt;&lt;div id="yMail_cursorElementTracker_1485954483988"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
id="yMail_cursorElementTracker_1485954486156"&gt;Is this compatible with libvirt 1.2.2 \
release? &lt;/div&gt;&lt;div id="yMail_cursorElementTracker_1485954526898"&gt;From where I \
get such compatibility matrix&lt;/div&gt;&lt;div \
id="yMail_cursorElementTracker_1485954544977"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
id="yMail_cursorElementTracker_1485954545704"&gt;Regards &lt;/div&gt;&lt;div \
id="yMail_cursorElementTracker_1485954549324"&gt;Abhishek &lt;br&gt;&lt;br&gt;&lt;div \
id="ymail_android_signature"&gt;&lt;a \
href="https://overview.mail.yahoo.com/mobile/?.src=Android"&gt;Sent from Yahoo Mail on \
Android&lt;/a&gt;&lt;/div&gt; &lt;br&gt; &lt;blockquote style="margin: 0 0 20px 0;"&gt; &lt;header \
style="font-family:Roboto, sans-serif; color:#6D00F6;"&gt; &lt;div&gt;On Wed, 1 Feb, 2017 at \
2:52 PM, Michal Privoznik&lt;/div&gt;&lt;div&gt;&lt;mprivozn@redhat.com&gt; wrote:&lt;/div&gt; \
&lt;/header&gt; &lt;div style="padding: 10px 0 0 20px; margin: 10px 0 0 0; border-left: 1px \
solid #6D00F6;"&gt; &lt;div id="msgSandbox_AB2vCmoAAB6sWJGovg3LQMGtCIQ_TEXT" \
class="msgSandbox" style="padding: 1.5em 0.5em 0.5em 1.2em; word-wrap: \
break-word;"&gt;On 02/01/2017 05:54 AM, abhishek jain wrote:&lt;div class="yQTDBase \
yqt5869496971" id="yqtfd76635"&gt;&lt;br clear="none"&gt;&gt; Hi,&lt;br clear="none"&gt;&gt; I am \
using Libvirt (1.2.2) on RHEL6. I want to use the compatible virt-manager for it.&lt;br \
clear="none"&gt;&gt; When I tried 1.4.0 and 1.3.0 there is an insatllation issue on \
RHLE6 for gtk3.  Is there any virt-manager version which works with 1.2.2 and \
RHLE6 too.&lt;br clear="none"&gt;&gt; Also what is the compatibility matrix for libvirt and \
virt-manager version.&lt;/div&gt;&lt;br clear="none"&gt;&lt;br clear="none"&gt;Doesn't&lt;br \
clear="none"&gt;&lt;br clear="none"&gt;# yum install virt-manager&lt;br clear="none"&gt;&lt;br \
clear="none"&gt;install the right one? Looking into RHEL6 repo I see \
virt-manager-0.9.0&lt;br clear="none"&gt;built for RHEL6. And after looking into \
virt-manager's repo I found this&lt;br clear="none"&gt;commit 3c3237b9510 which reworked it \
into using gtk3. The commit is part&lt;br clear="none"&gt;of 0.10.0 release. So I guess \
you're stuck with 0.9.0 on RHEL6.&lt;br clear="none"&gt;&lt;br clear="none"&gt;Michal&lt;div \
class="yQTDBase yqt5869496971" id="yqtfd00040"&gt;&lt;br clear="none"&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt; \
&lt;/blockquote&gt;&lt;/div&gt;



</body></email><email><emailId>20170201153435</emailId><senderName>JT Edwards</senderName><senderEmail>tstrike34@gmail.com</senderEmail><timestampReceived>2017-02-01 15:34:35-0400</timestampReceived><subject>Re: [libvirt-users] virt-p2v - Windows 10 guest hangs at boot after successful P2V</subject><body>

Rich,

I got this resolved by making sure that the P2V Windows 10 image's CPU
signature matches that as the host system.

Thank you in advance,
JT



On Wed, Feb 1, 2017 at 9:32 AM, Richard W.M. Jones &lt;rjones@redhat.com&gt;
wrote:

&gt; On Mon, Jan 09, 2017 at 09:17:47AM -0600, JT Edwards wrote:
&gt; &gt; Hi all,
&gt; &gt;
&gt; &gt; I successfully virt-p2v'ed a Windows 10 laptop to my Centos 7.3 instance
&gt; &gt; running KVM. However, on boot, the guest hangs. Is there a registry fix
&gt; &gt; that is needed after the P2V is done? Here is what is in the guest's
&gt; &gt; logfile:
&gt;
&gt; We don't normally check this mailing list for virt-p2v problems which
&gt; is why I didn't see this message before.
&gt;
&gt; If you are still having issues, then you'll need to find the full
&gt; debug logs, post them on a web server somewhere else, and send a
&gt; message pointing to them to libguestfs@redhat.com.  (See also
&gt; http://libguestfs.org/virt-p2v.1.html#how-virt-p2v-works )
&gt;
&gt; Rich.
&gt;
&gt; --
&gt; Richard Jones, Virtualization Group, Red Hat http://people.redhat.com/~
&gt; rjones
&gt; Read my programming and virtualization blog: http://rwmj.wordpress.com
&gt; virt-builder quickly builds VMs from scratch
&gt; http://libguestfs.org/virt-builder.1.html
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Rich,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I got this resolved by making sure that the \
P2V Windows 10 image's CPU signature matches that as the host system.  \
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank you in advance,&lt;/div&gt;&lt;div&gt;JT&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;div&gt;&lt;div class="gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div \
dir="ltr"&gt;&lt;div&gt;&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div \
dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/di \
v&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
 &lt;br&gt;&lt;div class="gmail_quote"&gt;On Wed, Feb 1, 2017 at 9:32 AM, Richard W.M. Jones \
&lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:rjones@redhat.com" \
target="_blank"&gt;rjones@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span class=""&gt;On Mon, Jan 09, 2017 at 09:17:47AM -0600, JT \
Edwards wrote:&lt;br&gt; &gt; Hi all,&lt;br&gt;
&gt;&lt;br&gt;
&gt; I successfully virt-p2v'ed a Windows 10 laptop to my Centos 7.3 instance&lt;br&gt;
&gt; running KVM. However, on boot, the guest hangs. Is there a registry fix&lt;br&gt;
&gt; that is needed after the P2V is done? Here is what is in the guest's&lt;br&gt;
&gt; logfile:&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;We don't normally check this mailing list for virt-p2v problems which&lt;br&gt;
is why I didn't see this message before.&lt;br&gt;
&lt;br&gt;
If you are still having issues, then you'll need to find the full&lt;br&gt;
debug logs, post them on a web server somewhere else, and send a&lt;br&gt;
message pointing to them to &lt;a \
href="mailto:libguestfs@redhat.com"&gt;libguestfs@redhat.com&lt;/a&gt;.   (See also&lt;br&gt; &lt;a \
href="http://libguestfs.org/virt-p2v.1.html#how-virt-p2v-works" rel="noreferrer" \
target="_blank"&gt;http://libguestfs.org/virt-&lt;wbr&gt;p2v.1.html#how-virt-p2v-works&lt;/a&gt; \
)&lt;br&gt; &lt;br&gt;
Rich.&lt;br&gt;
&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;br&gt;
--&lt;br&gt;
Richard Jones, Virtualization Group, Red Hat &lt;a \
href="http://people.redhat.com/~rjones" rel="noreferrer" \
target="_blank"&gt;http://people.redhat.com/~&lt;wbr&gt;rjones&lt;/a&gt;&lt;br&gt; Read my programming and \
virtualization blog: &lt;a href="http://rwmj.wordpress.com" rel="noreferrer" \
target="_blank"&gt;http://rwmj.wordpress.com&lt;/a&gt;&lt;br&gt; virt-builder quickly builds VMs \
from scratch&lt;br&gt; &lt;a href="http://libguestfs.org/virt-builder.1.html" rel="noreferrer" \
target="_blank"&gt;http://libguestfs.org/virt-&lt;wbr&gt;builder.1.html&lt;/a&gt;&lt;br&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170202072925</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-02-02 07:29:25-0400</timestampReceived><subject>Re: [libvirt-users] Libvirt and Virt-manager compatibility</subject><body>

On 02/01/2017 02:09 PM, abhishek jain wrote:
&gt; Thanks Michal.
&gt; Yes I am stuck with 0.9.0 virt-manager version.
&gt; Is this compatible with libvirt 1.2.2 release?

Sure. The aim of libvirt is to provide a stable API to manage domains.
Domain XML is considered an API too. Thus we don't break it (TM). Hence,
if a program learns how to talk to libvirt (parse/define XML), libvirt
upgrade will not break it. Obviously, new features will not be
available, but that's with every other software out there.

&gt; From where I get such compatibility matrix

Due to reasons described above, there's no such thing. Any virt-manager
should work with any libvirt and vice versa. Of course, there might be
some bugs here and there. But they are not intentional. In general it
should work.

Michal

</body></email><email><emailId>20170202134532</emailId><senderName>lejeczek</senderName><senderEmail>peljasz@yahoo.co.uk</senderEmail><timestampReceived>2017-02-02 13:45:32-0400</timestampReceived><subject>Re: [libvirt-users] dhcp &lt;option&gt; element - is this included yet?</subject><body>



On 26/01/17 20:47, Laine Stump wrote:
&gt; On 01/20/2017 12:14 PM, lejeczek wrote:
&gt;&gt; hi all,
&gt;&gt; I've seen this: 
&gt;&gt; https://www.redhat.com/archives/libvir-list/2013-March/msg00822.html 
&gt;&gt;
&gt;&gt; it's a few years old and I wonder (I hope) - implemented 
&gt;&gt; yet? 
&gt;
&gt; Sorry, but no. Nobody has managed the intersection of 
&gt; time, desire, and knowledge. Volunteers?
&gt;
&gt; Which option do you need?

dns would be very useful, to be able to specify dns servers.
many thanks,
L.

</body></email><email><emailId>20170203080340</emailId><senderName>WANG Cheng D</senderName><senderEmail>cheng.d.wang@alcatel-sbell.com.cn</senderEmail><timestampReceived>2017-02-03 08:03:40-0400</timestampReceived><subject>[libvirt-users] How to pin an libvirt lxc to a specific physical CPU core in openstack?</subject><body>

Dear all,

In my applications, the real-time performance is very important, so I used 4 \
containers, with only one application running in each container and a physical CPU \
core is only dedicated to one lxc. and I must know which container is hosted by which \
CPU core. That is, I need to pin a specific lxc to a specific CPU core.

I can achieve this in a native linux system by the following xml script (to pin a \
libvirt lxc to core #3 of a machine). It works fine.

&lt;vcpu placement='static' cpuset='3'&gt;1&lt;/vcpu&gt;


Now I want to realize this on openstack platform, I carefully read the instruction on \
CPU pinning in nova and found that openstack flavor can only support pinning an \
lxc(instance) onto a set of CPU cores. I cannot allocate a specific pCPU to an lxc. \
After the lxc is started, "dumpxml" only shows the following statement, I even don't \
know to which CPU core the lxc is pinned.

&lt;vcpu placement='static' &gt;1&lt;/vcpu&gt;

I tried to edit the libvirt.xml for the lxc which locates at nova/instances/#INSTANCE \
ID#/libvirt.xml and manually inserted cpuset='3', but this didn't take effect. After \
the lxc is restarted, the libvirt.xml is recovered and the modification was not there \
anymore.

I googled the question on Internet, but no solution was found. I hope the libvirt \
people can help me on this.

Thank you in advance.
Cheng


[Attachment #3 (text/html)]

&lt;html xmlns:v="urn:schemas-microsoft-com:vml" \
xmlns:o="urn:schemas-microsoft-com:office:office" \
xmlns:w="urn:schemas-microsoft-com:office:word" \
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" \
xmlns="http://www.w3.org/TR/REC-html40"&gt; &lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=us-ascii"&gt;
&lt;meta name="Generator" content="Microsoft Word 14 (filtered medium)"&gt;
&lt;style&gt;&lt;!--
/* Font Definitions */
@font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:10.5pt;
	font-family:"Calibri","sans-serif";}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:purple;
	text-decoration:underline;}
span.EmailStyle17
	{mso-style-type:personal-compose;
	font-family:"Calibri","sans-serif";
	color:windowtext;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-family:"Calibri","sans-serif";}
/* Page Definitions */
@page WordSection1
	{size:612.0pt 792.0pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;}
div.WordSection1
	{page:WordSection1;}
--&gt;&lt;/style&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapedefaults v:ext="edit" spidmax="1026" /&gt;
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapelayout v:ext="edit"&gt;
&lt;o:idmap v:ext="edit" data="1" /&gt;
&lt;/o:shapelayout&gt;&lt;/xml&gt;&lt;![endif]--&gt;
&lt;/head&gt;
&lt;body lang="ZH-CN" link="blue" vlink="purple" style="text-justify-trim:punctuation"&gt;
&lt;div class="WordSection1"&gt;
&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Dear all,&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;In my applications, the real-time performance \
is very important, so I used 4 containers, with only one application running in each \
container and a physical CPU core is only dedicated to one lxc. and I must know which \
container is hosted by which CPU core. That is, I need to pin a specific lxc to a \
specific CPU core.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;I \
can achieve this in a native linux system by the following xml script (to pin a \
libvirt lxc to core #3 of a machine). It works fine.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;vcpu placement='static' \
cpuset='3'&gt;1&lt;/vcpu&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Now \
I want to realize this on openstack platform, I carefully read the instruction on CPU \
pinning in nova and found that openstack flavor can only support pinning an \
lxc(instance) onto a set of CPU cores. I cannot allocate  a specific pCPU to an lxc. \
After the lxc is started, “dumpxml" only shows the following statement, I \
even don’t know to which CPU core the lxc is pinned.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p \
class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;vcpu placement='static' \
&gt;1&lt;/vcpu&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;I \
tried to edit the libvirt.xml for the lxc which locates at nova/instances/#INSTANCE \
ID#/libvirt.xml and manually inserted cpuset='3', but this didn't take effect. After \
the lxc is restarted, the libvirt.xml is recovered  and the modification was not \
there anymore.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;I \
googled the question on Internet, but no solution was found. I hope the libvirt \
people can help me on this.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;Thank you in advance.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;Cheng&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170203184901</emailId><senderName>Peter Steele</senderName><senderEmail>pwsteele@gmail.com</senderEmail><timestampReceived>2017-02-03 18:49:01-0400</timestampReceived><subject>[libvirt-users] Communicating between libvirt contains on separate hosts</subject><body>

I have a group of CentOS 7.2 servers running as VMs under VMware's ESXi 
6.0. These all reside on the same subnet and we have no problem 
communicating between the different virtual servers. In addition, each 
of these servers run a number of libvirt-based LXC containers, also 
based on CentOS 7.2. The hosts can communicate with their containers 
without issues and the containers on a given server can communicate with 
each other. However, containers hosted on two different servers cannot 
communicate with each other or with other servers.

If we duplicate this setup using KVM based VMs instead of ESXi VMs 
everything works fine--there is no problem communicating between LXC 
containers regardless of which VM hosts them.

I assume this is not a libvirt issue but if anyone has encountered this 
issue in running libvirt containers under a VMware environment and has 
found a solution, I'd appreciate hearing from you.

Thanks very much,

Peter

</body></email><email><emailId>20170206215838</emailId><senderName>Peter Steele</senderName><senderEmail>pwsteele@gmail.com</senderEmail><timestampReceived>2017-02-06 21:58:38-0400</timestampReceived><subject>Re: [libvirt-users] Real time threads don't work in libvirt containers under CentOS 7.3</subject><body>

On 02/06/2017 09:47 AM, Daniel P. Berrange wrote:
&gt; On Mon, Feb 06, 2017 at 09:32:29AM -0800, Peter Steele wrote:
&gt;&gt; We've been using libvirt based containers under CentOS 7 and everything has
&gt;&gt; been working fine. One application we run in our containers is ctdb, which
&gt;&gt; uses SCHED_FIFO (real time) threads. This has been working without problems
&gt;&gt; until our recent upgrade to CentOS 7.3. For some reason, ctdb is no longer
&gt;&gt; able to create real time threads, and I've tried a simple program myself
&gt;&gt; that confirms this. The same program works fine on the hypervisor so I know
&gt;&gt; the kernel supports real time. Does anyone know what may have changed in
&gt;&gt; CentOS 7.3 that breaks real time threads in libvirt containers?
&gt; If I had to guess, perhaps some tunable in cgroups is denying execution
&gt; time ?
&gt;
In CentOS 7.2 the path /sys/fs/cgroup/cpu/cpu.rt_runtime_us is zero by 
default and I had to set it to a non-zero value, e.g.

echo 25000 &gt;/sys/fs/cgroup/cpu/cpu.rt_runtime_us

in order to use real time threads in containers. In CentOS 7.3, this 
path is non-zero already (950000 on my system) and it doesn't even let 
me write a new value to it. For some reason though, real time threads 
are still not allowed. Apparently some other cgroup param has to be set 
in 7.3. The question is which one?

Peter

</body></email><email><emailId>20170208131842</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-02-08 13:18:42-0400</timestampReceived><subject>Re: [libvirt-users] accessing USB as storage device through lxc container.</subject><body>


On Tue, Feb 07, 2017 at 11:00:54AM -0800, ravi mh wrote:
&gt;Thanks Martin for the info.
&gt;
&gt;
&gt;
&gt;I have tried the below snippet in the libvirt xml.
&gt;
&gt; &lt;hostdev mode='capabilities' type='storage'&gt;
&gt;      &lt;source&gt;
&gt;        &lt;block&gt;/dev/sdc1&lt;/block&gt;
&gt;      &lt;/source&gt;
&gt;    &lt;/hostdev&gt;
&gt;

I meant &lt;filesystem/&gt; not &lt;hostdev/&gt;

&gt;------------
&gt;
&gt;root@ir800-lxc:~# mount /dev/sdc1 /mnt/usbdr/
&gt;
&gt;mount: permission denied (are you root?)
&gt;

I meant you do this in the host.

&gt;----------
&gt;
&gt;It works if the usernamespace is not enabled.
&gt;

This is probably the problem.  Your root in the container is essentially
just a regular user in the host, so it can't mount it.  If you want to
pass the /dev/sdc into the container and mount it there with the user
namespace turned on, I don't know if there is a way to do this without
FUSE or other userspace utilities.

&gt;
&gt;
&gt;The reason being, we have enabled the username and hence its unprivileged
&gt;container.
&gt;
&gt;As per this patch:
&gt;https://www.redhat.com/archives/libvir-list/2012-November/msg01555.html,
&gt;the capabilities with USB as storage is available for mounting if its
&gt;privileged container.
&gt;
&gt;Is there a way to mount this inside the container with usernamespace
&gt;enabled and with some capabilities turned on?
&gt;

I think you have to have CAP_SYS_ADMIN (for mount(2)) and also be root.

Maybe Daniel will know, since he implemented the possibility for
mode='capabilities' hostdevs for LXCs.

&gt;
&gt;
&gt;Regards,
&gt;*Ravi M H*
&gt;
&gt;
&gt;
&gt;On Thu, Feb 2, 2017 at 9:09 PM, Martin Kletzander &lt;mkletzan@redhat.com&gt;
&gt;wrote:
&gt;
&gt;&gt; On Thu, Feb 02, 2017 at 06:30:24PM -0800, ravi mh wrote:
&gt;&gt;
&gt;&gt;&gt; Hi all,
&gt;&gt;&gt;
&gt;&gt;&gt; I am not able to access USB as storage device in the lxc container.
&gt;&gt;&gt; Having tried to pass the usb device with the product and vendor id, not
&gt;&gt;&gt; able to see the device mounted in the lxc file system.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt; It won't be mounted, it will just be passed through as a device,
&gt;&gt; i.e. you will see it in the lsusb output.  If you need to mount it, then
&gt;&gt; it needs to be done either in the container (for which you might need
&gt;&gt; some capability) or mounted on the host and just using device
&gt;&gt; &lt;filesystem/&gt; instead.
&gt;&gt;
&gt;&gt; However, they are seen as char devices in the container at the location.
&gt;&gt;&gt; There is no issue of ACL, as the capabilities restrictions have been
&gt;&gt;&gt; dropped.
&gt;&gt;&gt;
&gt;&gt;&gt; Has anyone successfully mounted the storage device in the libvirt.  Having
&gt;&gt;&gt; gone through the libvirt documentation, couldnt find further information
&gt;&gt;&gt; of
&gt;&gt;&gt; enabling the usb as storage device.  Any pointers towards that would be
&gt;&gt;&gt; useful.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Host OS:
&gt;&gt;&gt;
&gt;&gt;&gt; IR800-GOS-1:~# lsusb
&gt;&gt;&gt; Bus 001 Device 003: ID 8644:800b
&gt;&gt;&gt; Bus 001 Device 001: ID 1d6b:0002
&gt;&gt;&gt; Bus 002 Device 001: ID 1d6b:0001
&gt;&gt;&gt; IR800-GOS-1:~#
&gt;&gt;&gt;
&gt;&gt;&gt; Lxc app container:
&gt;&gt;&gt;
&gt;&gt;&gt; root@ir800-lxc:/mnt/usb# ls -la  /dev/bus/usb/001/003
&gt;&gt;&gt; *crwx-*-----    1 root     root      189,   2 Feb  3 01:44
&gt;&gt;&gt; /dev/bus/usb/001/003
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; ----------libvirt xml snippet ------------
&gt;&gt;&gt;
&gt;&gt;&gt;    &lt;hostdev mode='subsystem' type='usb' managed='yes'&gt;
&gt;&gt;&gt;      &lt;source&gt;
&gt;&gt;&gt;        &lt;vendor id='0x8644'/&gt;
&gt;&gt;&gt;        &lt;product id='0x800b'/&gt;
&gt;&gt;&gt;      &lt;/source&gt;
&gt;&gt;&gt;    &lt;/hostdev&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; -----------------------------
&gt;&gt;&gt; while changing the mode from subsystem to capabilities, it issues error
&gt;&gt;&gt; for
&gt;&gt;&gt; validating against the schema.
&gt;&gt;&gt;
&gt;&gt;&gt; ---------------while changing the hostdev mode='capabilities'----------
&gt;&gt;&gt;
&gt;&gt;&gt; virsh # edit n01_1
&gt;&gt;&gt; *error: XML document failed to validate against schema: Unable to validate
&gt;&gt;&gt; doc against /usr/share/libvirt/schemas/domain.rng*
&gt;&gt;&gt; Extra element devices in interleave
&gt;&gt;&gt; Element domain failed to validate content
&gt;&gt;&gt;
&gt;&gt;&gt; Failed. Try again? [y,n,i,f,?]:
&gt;&gt;&gt; error: XML document failed to validate against schema: Unable to validate
&gt;&gt;&gt; doc against /usr/share/libvirt/schemas/domain.rng
&gt;&gt;&gt;
&gt;&gt;&gt; --------------------------------------------
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Regards,
&gt;&gt;&gt; *Ravi*
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt;&gt; libvirt-users mailing list
&gt;&gt;&gt; libvirt-users@redhat.com
&gt;&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;&gt;
&gt;&gt;

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170208182133</emailId><senderName>"Bashe, Joe"</senderName><senderEmail>joe@bashedev.com</senderEmail><timestampReceived>2017-02-08 18:21:33-0400</timestampReceived><subject>Re: [libvirt-users] Trouble moving OVMF guest to new host</subject><body>

Awesome, that worked perfectly. I just had to copy the variable store (it
was in /var/lib/libvirt/qemu/nvram), and the VM booted right up!

Thank you for the help!

Best regards,

Joe

​

--
Joseph Bashe
Technical Director
Bashe Development
+1 (323) 999-1731

On Wed, Feb 8, 2017 at 4:12 PM, Andrea Bolognani &lt;abologna@redhat.com&gt;
wrote:

&gt; On Wed, 2017-02-08 at 20:13 +0300, Aleksei wrote:
&gt; &gt; I'm running libvirt in user session and libvirt creates VARS part of
&gt; OVMF in ~/.config/libvirt/qemu/nvram/
&gt; &gt; Check your xml, there should be lines like this:
&gt; &gt; &lt;os&gt;
&gt; &gt;     &lt;type arch='x86_64' machine='pc-q35-2.7'&gt;hvm&lt;/type&gt;
&gt; &gt;     &lt;loader readonly='yes' type='pflash'&gt;/UEFI_OVMF/OVMF_
&gt; CODE.fd&lt;/loader&gt;
&gt; &gt;     &lt;nvram&gt;/home/username/.config/libvirt/qemu/nvram/vm_VARS.fd&lt;/nvram&gt;
&gt;
&gt; ... or in /var/lib/libvirt/qemu/nvram, if you're using
&gt; the system-wide libvirtd instance.
&gt;
&gt; Anyway, Aleksei is right that you should copy over the
&gt; variable store (vm_VARS.fd) along with the disk image
&gt; and the XML configuration: some guest operating systems
&gt; are able to cope with its absence and recreate the
&gt; correct EFI variables automatically, but that's not
&gt; always the case.
&gt;
&gt; Moreover, you should make sure your /etc/libvirt/qemu.conf
&gt; file contains something along the lines of
&gt;
&gt;   nvram = [
&gt;     "/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd:/
&gt; usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd/OVMF_VARS-pure-efi.fd"
&gt;   ]
&gt;
&gt; so that, in case the variable store for the guest is missing
&gt; or your simply creating a new guest, libvirt will be able to
&gt; create a new one by copying over the template (the "master
&gt; var store" the error was referring to).
&gt;
&gt; By the way, edk2-ovmf is included in Fedora proper these
&gt; days, you don't need to use edk2.git-ovmf-x64 any longer ;)
&gt;
&gt; --
&gt; Andrea Bolognani / Red Hat / Virtualization
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Awesome, that worked perfectly. I just \
had to copy the variable store (it was in  /var/lib/libvirt/qemu/nvram), and the VM \
booted right up!&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Thank you for the help!&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_default" style="font-family:arial,helvetica,sans-serif"&gt;Best \
regards,&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;Joe&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_default" \
style="font-family:arial,helvetica,sans-serif"&gt;​&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div class="gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div \
dir="ltr"&gt;&lt;font face="arial, helvetica, sans-serif"&gt;--&lt;br&gt;Joseph Bashe&lt;br&gt;Technical \
Director&lt;/font&gt;&lt;div&gt;&lt;font face="arial, helvetica, sans-serif"&gt;Bashe Development&lt;br&gt;+1 \
(323) 999-1731&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Wed, Feb 8, 2017 at 4:12 PM, Andrea Bolognani &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:abologna@redhat.com" \
target="_blank"&gt;abologna@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;On Wed, 2017-02-08 at 20:13 +0300, Aleksei wrote:&lt;br&gt; &gt; \
I'm running libvirt in user session and libvirt creates VARS part of OVMF in \
~/.config/libvirt/qemu/nvram/&lt;br&gt; &gt; Check your xml, there should be lines like \
this:&lt;br&gt; &gt; &lt;os&gt;&lt;br&gt;
&gt;          &lt;type arch='x86_64' \
machine='pc-q35-2.7'&gt;hvm&lt;/&lt;wbr&gt;type&gt;&lt;br&gt; &gt;          &lt;loader \
readonly='yes' \
type='pflash'&gt;/UEFI_OVMF/OVMF_&lt;wbr&gt;CODE.fd&lt;/loader&gt;&lt;br&gt; &gt;         \
&lt;nvram&gt;/home/username/.&lt;wbr&gt;config/libvirt/qemu/nvram/vm_&lt;wbr&gt;VARS.fd&lt;/nvram&gt;&lt;br&gt;
 &lt;br&gt;
... or in /var/lib/libvirt/qemu/nvram, if you're using&lt;br&gt;
the system-wide libvirtd instance.&lt;br&gt;
&lt;br&gt;
Anyway, Aleksei is right that you should copy over the&lt;br&gt;
variable store (vm_VARS.fd) along with the disk image&lt;br&gt;
and the XML configuration: some guest operating systems&lt;br&gt;
are able to cope with its absence and recreate the&lt;br&gt;
correct EFI variables automatically, but that's not&lt;br&gt;
always the case.&lt;br&gt;
&lt;br&gt;
Moreover, you should make sure your /etc/libvirt/qemu.conf&lt;br&gt;
file contains something along the lines of&lt;br&gt;
&lt;br&gt;
   nvram = [&lt;br&gt;
        "/usr/share/edk2.git/ovmf-&lt;wbr&gt;x64/OVMF_CODE-pure-efi.fd:/&lt;wbr&gt;usr/share/ \
edk2.git/ovmf-x64/&lt;wbr&gt;OVMF_CODE-pure-efi.fd/OVMF_&lt;wbr&gt;VARS-pure-efi.fd"&lt;br&gt;  \
]&lt;br&gt; &lt;br&gt;
so that, in case the variable store for the guest is missing&lt;br&gt;
or your simply creating a new guest, libvirt will be able to&lt;br&gt;
create a new one by copying over the template (the "master&lt;br&gt;
var store" the error was referring to).&lt;br&gt;
&lt;br&gt;
By the way, edk2-ovmf is included in Fedora proper these&lt;br&gt;
days, you don't need to use edk2.git-ovmf-x64 any longer ;)&lt;br&gt;
&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;br&gt;
--  &lt;br&gt;
Andrea Bolognani / Red Hat / Virtualization&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170209084454</emailId><senderName>WANG Cheng D</senderName><senderEmail>cheng.d.wang@alcatel-sbell.com.cn</senderEmail><timestampReceived>2017-02-09 08:44:54-0400</timestampReceived><subject>[libvirt-users] How to achieve higher priority of a process in a lxc on CentOS machine</subject><body>

Dear all,

I use libvirt lxc to host a real-time application with priority of -50. The=
 native OS is fedora21 and lxc is also fedora21. Everything works fine. Lin=
ux "top" command shows the priority is -50).

Then I use Openstack to manage lxc. The native compute node OS is CentOS7.2=
. and the lxc is fedora. After the real-time application is started in the =
lxc. top command on the native machine sees the real-time application with =
priority of 20, which is not what I expect. If lxc is Ubuntu, the priority =
of real-time application is also 20.

Can anybody help me on this?

Cheng Wang

[Attachment #3 (text/html)]

&lt;html xmlns:v="urn:schemas-microsoft-com:vml" \
xmlns:o="urn:schemas-microsoft-com:office:office" \
xmlns:w="urn:schemas-microsoft-com:office:word" \
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" \
xmlns="http://www.w3.org/TR/REC-html40"&gt; &lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=us-ascii"&gt;
&lt;meta name="Generator" content="Microsoft Word 14 (filtered medium)"&gt;
&lt;style&gt;&lt;!--
/* Font Definitions */
@font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:10.5pt;
	font-family:"Calibri","sans-serif";}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:purple;
	text-decoration:underline;}
span.EmailStyle17
	{mso-style-type:personal-compose;
	font-family:"Calibri","sans-serif";
	color:windowtext;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-family:"Calibri","sans-serif";}
/* Page Definitions */
@page WordSection1
	{size:612.0pt 792.0pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;}
div.WordSection1
	{page:WordSection1;}
--&gt;&lt;/style&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapedefaults v:ext="edit" spidmax="1026" /&gt;
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt;
&lt;o:shapelayout v:ext="edit"&gt;
&lt;o:idmap v:ext="edit" data="1" /&gt;
&lt;/o:shapelayout&gt;&lt;/xml&gt;&lt;![endif]--&gt;
&lt;/head&gt;
&lt;body lang="ZH-CN" link="blue" vlink="purple" style="text-justify-trim:punctuation"&gt;
&lt;div class="WordSection1"&gt;
&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Dear all,&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;I use libvirt lxc to host a real-time \
application with priority of -50. The native OS is fedora21 and lxc is also fedora21. \
Everything works fine. Linux “top” command shows the priority is \
-50).&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;Then I use Openstack to manage lxc. The native compute node OS is \
CentOS7.2. and the lxc is fedora. After the real-time application is started in the \
lxc. top command on the native machine sees the real-time application  with priority \
of 20, which is not what I expect. If lxc is Ubuntu, the priority of real-time \
application is also 20.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span lang="EN-US"&gt;Can \
anybody help me on this?&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;p class="MsoNormal"&gt;&lt;span \
lang="EN-US"&gt;Cheng Wang&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt; &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170212215101</emailId><senderName></senderName><senderEmail>masaeedu@gmail.com</senderEmail><timestampReceived>2017-02-12 21:51:01-0400</timestampReceived><subject>[libvirt-users] Hyper-V support in Windows client</subject><body>

Hi there,

I'm trying to connect to Hyper-V on Windows using libvirt. It seems neither the \
libvirt binaries bundled with Virt Viewer, nor the libvirt binary in the \
mingw64-libvirt Rawhide RPM have support for Hyper-V. Is it likely that just \
downloading the source RPM and trying to build –with-hyperv would just work?

Thanks,
Asad


[Attachment #3 (unknown)]

&lt;html xmlns:o="urn:schemas-microsoft-com:office:office" \
xmlns:w="urn:schemas-microsoft-com:office:word" \
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" \
xmlns="http://www.w3.org/TR/REC-html40"&gt;&lt;head&gt;&lt;meta http-equiv=Content-Type \
content="text/html; charset=utf-8"&gt;&lt;meta name=Generator content="Microsoft Word 15 \
(filtered medium)"&gt;&lt;style&gt;&lt;!-- /* Font Definitions */
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
.MsoChpDefault
	{mso-style-type:export-only;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
--&gt;&lt;/style&gt;&lt;/head&gt;&lt;body lang=EN-US&gt;&lt;div class=WordSection1&gt;&lt;p class=MsoNormal&gt;Hi \
there,&lt;/p&gt;&lt;p class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;I'm trying to \
connect to Hyper-V on Windows using libvirt. It seems neither the libvirt binaries \
bundled with Virt Viewer, nor the libvirt binary in the mingw64-libvirt Rawhide RPM \
have support for Hyper-V. Is it likely that just downloading the source RPM and \
trying to build –with-hyperv would just work?&lt;/p&gt;&lt;p \
class=MsoNormal&gt;&lt;o:p&gt; &lt;/o:p&gt;&lt;/p&gt;&lt;p class=MsoNormal&gt;Thanks,&lt;/p&gt;&lt;p \
class=MsoNormal&gt;Asad&lt;/p&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;



</body></email><email><emailId>20170215125458</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-02-15 12:54:58-0400</timestampReceived><subject>Re: [libvirt-users] Error in libvirt-GUI</subject><body>


On Wed, Feb 15, 2017 at 11:01:48AM +0000, abhishek jain wrote:
&gt; Thanks Martin.
&gt; I can only use RHEL6 so upgrading libvirt Version is not a choice.
&gt; 

If it's RHEL6 and you can't install newer libvirt, then you should be
able to get a proper response from the support team.  If not, they can
create a BZ request for you, but RHEL6 is definitely not something we
would strive to support upstream (we merely try to compile there).

&gt; RegardsAbhishek
&gt; 
&gt; From: Martin Kletzander &lt;mkletzan@redhat.com&gt;
&gt; To: abhishek jain &lt;abhish_jain@yahoo.com&gt;
&gt; Cc: "libvirt-users@redhat.com" &lt;libvirt-users@redhat.com&gt;
&gt; Sent: Wednesday, 15 February 2017 2:33 PM
&gt; Subject: Re: [libvirt-users] Error in libvirt-GUI
&gt; 
&gt; On Wed, Feb 15, 2017 at 05:19:38AM +0000, abhishek jain wrote:
&gt; &gt; Hi,
&gt; &gt; I am using libvirt --&gt; 0.10.2  and virt-manager --&gt; 0.9.0 version (RHEL 6).
&gt; &gt; Very rare I get following error message dialogue box. (Image is attached for the \
&gt; &gt; error dialogue box ) Error saysError polling connection:'qemu+ssh......' Internal \
&gt; &gt; error client socket is closed TraceBack (most recent calls)engine.py: 440  \
&gt; &gt; conn.tickconnection.py: 1433   self.hostinfo() = self.vmm.getinfo() Is it a \
&gt; &gt; problem with libvirt or with my environment
&gt; 
&gt; It might be that the connection was interrupted due to keepalive or just
&gt; disconnected.  It is hard to remember how the code looked like back then
&gt; because libvirt 0.10.2 and virt-manager 0.9.0 are very VERY _VERY_ super
&gt; old and this is upstream list, so meybe you could try newer versions?
&gt; 
&gt; HTH,
&gt; Martin
&gt; 
&gt; &gt; Thanks in advance.
&gt; &gt; RegardsAbhishek
&gt; &gt; 
&gt; &gt; 
&gt; 
&gt; 
&gt; &gt; _______________________________________________
&gt; &gt; libvirt-users mailing list
&gt; &gt; libvirt-users@redhat.com
&gt; &gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt; 
&gt; 


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170215130612</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-02-15 13:06:12-0400</timestampReceived><subject>Re: [libvirt-users] high memory guest issues - virsh start and QEMU_JOB_WAIT_TIME</subject><body>

On Thu, Feb 16, 2017 at 12:03:28AM +1100, Blair Bethwaite wrote:
&gt; On 15 February 2017 at 20:40, Daniel P. Berrange &lt;berrange@redhat.com&gt; wrote:
&gt; &gt; On Wed, Feb 15, 2017 at 10:27:46AM +0100, Michal Privoznik wrote:
&gt; &gt;&gt; On 02/15/2017 03:43 AM, Blair Bethwaite wrote:
&gt; &gt;&gt; &gt; On 15 February 2017 at 00:57, Daniel P. Berrange &lt;berrange@redhat.com&gt; wrote:
&gt; &gt;&gt; &gt;&gt; What is the actual error you're getting during startup.
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; # virsh -d0 start instance-0000037c
&gt; &gt;&gt; &gt; start: domain(optdata): instance-0000037c
&gt; &gt;&gt; &gt; start: found option &lt;domain&gt;: instance-0000037c
&gt; &gt;&gt; &gt; start: &lt;domain&gt; trying as domain NAME
&gt; &gt;&gt; &gt; error: Failed to start domain instance-0000037c
&gt; &gt;&gt; &gt; error: monitor socket did not show up: No such file or directory
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; Full libvirtd debug log at
&gt; &gt;&gt; &gt; https://gist.github.com/bmb/08fbb6b6136c758d027e90ff139d5701
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; On 15 February 2017 at 00:47, Michal Privoznik &lt;mprivozn@redhat.com&gt; wrote:
&gt; &gt;&gt; &gt;&gt; I don't think I understand this. Who is running the other job? I mean,
&gt; &gt;&gt; &gt;&gt; I'd expect qemu fail to create the socket and thus hitting 30s timeout
&gt; &gt;&gt; &gt;&gt; in qemuMonitorOpenUnix().
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; Yes you're right, I just blindly started looking for 30s constants in
&gt; &gt;&gt; &gt; the code and that one seemed the most obvious but I had not tried to
&gt; &gt;&gt; &gt; trace it all the way back to the domain start job or checked the debug
&gt; &gt;&gt; &gt; logs yet, sorry. So looking a bit more carefully I see the real issue
&gt; &gt;&gt; &gt; is in src/qemu/qemu_monitor.c:
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; 321 static int
&gt; &gt;&gt; &gt; 322 qemuMonitorOpenUnix(const char *monitor, pid_t cpid)
&gt; &gt;&gt; &gt; 323 {
&gt; &gt;&gt; &gt; 324     struct sockaddr_un addr;
&gt; &gt;&gt; &gt; 325     int monfd;
&gt; &gt;&gt; &gt; 326     int timeout = 30; /* In seconds */
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; Is this safe to increase? Is there any reason to keep it at 30s given
&gt; &gt;&gt; &gt; (from what I'm seeing on a fast 2-socket Haswell system) that hugepage
&gt; &gt;&gt; &gt; backed guests larger than ~160GB memory will not be able to start in
&gt; &gt;&gt; &gt; that time?
&gt; &gt;&gt; &gt;
&gt; &gt;&gt;
&gt; &gt;&gt; I recall some similar discussion took place in the past. But I just
&gt; &gt;&gt; cannot find it now. I think the problem was that kernel is zeroing the
&gt; &gt;&gt; pages on huge page allocation. Anyway, this timeout used to be 3 seconds
&gt; &gt;&gt; and inly in fe89b687a0 it has been changed to 30 seconds.
&gt; &gt;&gt;
&gt; &gt;&gt; We can increase the limit, but that would solve just this case until
&gt; &gt;&gt; somebody tries to assign even more RAM to their domain. What if we would
&gt; &gt;&gt; instead make this configurable? Have yet another variable living inside
&gt; &gt;&gt; qemu.conf that by default has value of 30 and specifies how long should
&gt; &gt;&gt; libvirt wait for qemu monitor to show up?
&gt; &gt;&gt;
&gt; &gt;&gt; But frankly, on one hand I like this approach. But on the other I
&gt; &gt;&gt; dislike it at the same time - we have just too much variables in
&gt; &gt;&gt; qemu.conf because that's our answer to problems like these. We don't
&gt; &gt;&gt; know so we offload the setting to the sys admin.
&gt; &gt;
&gt; &gt; Honestly it is well overdue for us to come up with an improvement to
&gt; &gt; QEMU that lets us start QEMU &amp; open the monitor in a race-free manner.
&gt; &gt; The obvious answer to this is to allow us to pass down a pre-opened
&gt; &gt; UNIX listener socket FD to QEMU. We can thus connect() immediately
&gt; &gt; with no race and then simply away the QMP greeting with no timeout,
&gt; &gt; safely getting EOF if QEMU fails to start.
&gt; 
&gt; Wish I could volunteer to work on that but am afraid my day job has me
&gt; now thinking about building a custom package to work around this for
&gt; the moment, or even attempting to find the right hexedit against the
&gt; existing shared object o_0... probably a line of thinking I should
&gt; squash now. Would it be helpful to have this registered as a customer
&gt; RFE with Red Hat?

By all means file a bug report about this against RHEL if that's what
you're using. It'll help track &amp; priortize the issue for future updates.

Regards,
Daniel
-- 
|: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
|: http://libvirt.org              -o-             http://virt-manager.org :|
|: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|

</body></email><email><emailId>20170215164347</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-02-15 16:43:47-0400</timestampReceived><subject>Re: [libvirt-users] provisioning with vagrant-libvirt leaves .img file only readable by root</subject><body>


On Wed, Feb 15, 2017 at 02:25:12PM +0100, Hans-Christoph Steiner wrote:
&gt;
&gt;I'm using libvirt on Debian/stretch (testing) with vagrant and the
&gt;vagrant-libvirt plugin.  When I import a vagrant box (jessie64.box), the
&gt;resulting file permssions let anyone in the "kvm" group read the img.
&gt;But when I build upon that box, only root can read it:
&gt;

I don't have any Vagrant experience, but if you have a file that any VM
(with qemu://system) is using, by default libvirt will make sure the VM
can use it and after that, set it to root:root.  The proper way would be
setting it to permssions that it had before.  We're dealing with this
for a couple of years now.  It's still unfixed because we're trying to
fix every single corner-case and also there are so many things to
consider.

Anyway, if you will make sure that qemu can access it, you can disable
the automatic dynamic relabelling (either for the disk in the domain XML
by saying &lt;seclabel ... relabel="no"/&gt; for the disk or the whole domain
or all domains by setting dynamic_ownership to 0 in qemu.conf).

HTH,
Martin

&gt;-rw------- 1 root         root 20198785024 Sep 19 18:19
&gt;buildserver_default.img
&gt;-rwxr--r-- 1 libvirt-qemu kvm   2148663296 Sep  5 22:55
&gt;jessie64_vagrant_box_image_0.img
&gt;
&gt;How can I control those file permissions as a regular user in the
&gt;libvirtd group?  I need to read that image in order to use qemu-img to
&gt;rebase and create a new vagrant box.  The current `vagrant package`
&gt;command only works with VirtualBox VMs, but its easy to make a .box if
&gt;you have read access to the libvirt QEMU .img file.
&gt;
&gt;/etc/libvirt/storage/default.xml says:
&gt;  &lt;target&gt;
&gt;    &lt;path&gt;/var/lib/libvirt/images&lt;/path&gt;
&gt;    &lt;permissions&gt;
&gt;      &lt;mode&gt;0755&lt;/mode&gt;
&gt;    &lt;/permissions&gt;
&gt;  &lt;/target&gt;
&gt;
&gt;
&gt;You can find the context for this work here:
&gt;https://gitlab.com/fdroid/fdroidserver/issues/238
&gt;
&gt;.hc
&gt;
&gt;--
&gt;PGP fingerprint: EE66 20C7 136B 0D2C 456C  0A4D E9E2 8DEA 00AA 5556
&gt;https://pgp.mit.edu/pks/lookup?op=vindex&amp;search=0xE9E28DEA00AA5556
&gt;
&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170217145419</emailId><senderName>"Lentes, Bernd"</senderName><senderEmail>bernd.lentes@helmholtz-muenchen.de</senderEmail><timestampReceived>2017-02-17 14:54:19-0400</timestampReceived><subject>[libvirt-users] vm running slowly in powerful host</subject><body>

Hi,

i have a vm which has a poor performance.
E.g. top needs seconds to refresh its output on the console. Same with netstat.
The guest is hosting a MySQL DB with a webfrontend, its response is poor too.
I'm looking for the culprit.

Following top in the guest i get these hints:

Memory is free enough, system is not swapping.
System has 8GB RAM and two cpu's.
Cpu 0 is struggling with a lot of software interrupts, between 50% and 80%.
Cpu1 is often waiting for IO (wa), between 0% and 20%.

No application is consuming much cpu time.

Here is an example:

top - 11:19:18 up 18:19, 11 users,  load average: 1.44, 0.94, 0.66
Tasks:  95 total,   1 running,  94 sleeping,   0 stopped,   0 zombie
Cpu0  :  0.0%us,  0.0%sy,  0.0%ni, 20.0%id,  0.0%wa,  0.0%hi, 80.0%si,  0.0%st
Cpu1  :  1.9%us, 13.8%sy,  0.0%ni, 73.8%id, 10.5%wa,  0.0%hi,  0.0%si,  0.0%st
Mem:   7995216k total,  6385176k used,  1610040k free,   177772k buffers
Swap:  2104472k total,        0k used,  2104472k free,  5940884k cached

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
 6470 root      16   0 12844 1464  804 S   12  0.0   2:17.13 screen
 6022 root      15   0 41032 3052 2340 S    3  0.0   1:10.99 sshd
 8322 root       0 -20 10460 4976 2268 S    3  0.1  19:20.38 atop
10806 root      16   0  5540 1216  880 R    0  0.0   0:00.51 top
  126 root      15   0     0    0    0 S    0  0.0   0:23.33 pdflush
 3531 postgres  15   0 68616 1600  792 S    0  0.0   0:41.24 postmaster

The host in which the guest runs has 96GB RAM and 8 cores.

It does not seem to do much:

top - 11:21:19 up 15 days, 15:53, 14 users,  load average: 1.40, 1.39, 1.40
Tasks: 221 total,   2 running, 219 sleeping,   0 stopped,   0 zombie
Cpu0  : 15.9%us,  2.7%sy,  0.0%ni, 81.4%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st
Cpu1  :  5.0%us,  3.0%sy,  0.0%ni, 92.0%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st
Cpu2  :  2.0%us,  0.3%sy,  0.0%ni, 97.7%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st
Cpu3  :  0.3%us,  1.0%sy,  0.0%ni, 98.7%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st
Cpu4  :  1.3%us,  0.3%sy,  0.0%ni, 98.3%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st
Cpu5  :  0.0%us,  0.0%sy,  0.0%ni,100.0%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st
Cpu6  :  0.3%us,  0.0%sy,  0.0%ni, 99.7%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st
Cpu7  :  0.0%us,  0.0%sy,  0.0%ni,100.0%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st
Mem:     96738M total,    13466M used,    83272M free,        3M buffers
Swap:     2046M total,        0M used,     2046M free,     3887M cached

  PID USER      PR  NI  VIRT  RES  SHR S   %CPU %MEM    TIME+  COMMAND
21765 root      20   0  105m  15m 4244 S      5  0.0   0:00.15 crm
 3180 root      20   0 8572m 8.0g 8392 S      3  8.4  62:25.73 qemu-kvm
 8529 hacluste  10 -10 90820  14m 9400 S      0  0.0  29:52.48 cib
21329 root      20   0  9040 1364  940 R      0  0.0   0:00.16 top
28439 root      20   0     0    0    0 S      0  0.0   0:04.51 kworker/4:2
    1 root      20   0 10560  828  692 S      0  0.0   0:07.67 init
    2 root      20   0     0    0    0 S      0  0.0   0:00.28 kthreadd
    3 root      20   0     0    0    0 S      0  0.0   3:03.23 ksoftirqd/0
    6 root      RT   0     0    0    0 S      0  0.0   0:05.02 migration/0
    7 root      RT   0     0    0    0 S      0  0.0   0:02.82 watchdog/0
    8 root      RT   0     0    0    0 S      0  0.0   0:05.18 migration/1

I think the host is not the problem.

The vm resides on a SAN which is attached via FC. The whole system is a two node \
cluster. The vm resides in a raw partition without a FS, which i read should be good \
for the performance. It runs on the other node slow too. Inside the vm i have logical \
volumes  (it was a physical system i migrated to a vm). The partitions are formatted \
with reiserfs (The system is already some years old, at that time reiserfs was \
popular ...).

I use iostat on the guest:
This is a typical snapshot:

Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   \
await  svctm  %util vda               0.00     3.05    0.00    2.05     0.00    20.40 \
19.90     0.09   44.59  31.22   6.40 dm-0              0.00     0.00    0.00    4.55  \
0.00    18.20     8.00     0.24   52.31   7.74   3.52 dm-1              0.00     0.00 \
0.00    0.00     0.00     0.00     0.00     0.00    0.00   0.00   0.00 dm-2           \
0.00     0.00    0.00    0.10     0.00     0.40     8.00     0.01   92.00  56.00   \
0.56 dm-3              0.00     0.00    0.00    0.00     0.00     0.00     0.00     \
0.00    0.00   0.00   0.00 dm-4              0.00     0.00    0.00    0.00     0.00   \
0.00     0.00     0.00    0.00   0.00   0.00 dm-5              0.00     0.00    0.00  \
0.35     0.00     1.40     8.00     0.03   90.29  65.71   2.30 dm-6              0.00 \
0.00    0.00    0.00     0.00     0.00     0.00     0.00    0.00   0.00   0.00

vda has several partitions, one for /, one for swap, and two physical volumes for \
LVM.

Following "man iostat", the columns await and svctm  seem to be important. Man says:

await
The average time (in milliseconds) for I/O requests issued to the device to be \
served. This includes the time spent by the requests in queue and the time spent \
servicing them.

svctm
The average service time (in milliseconds) for I/O requests that were issued to the \
device.

It seems system is waiting a long time for IO. Although the amount of transfered data \
is small.

I have some suspicions:

- the lvm setup in the guest
- some hardware
- cache mode for the disk is "none". Otherwise i can't do a live migration.


What do you think ? How can i find out from where the high si comes ?

Network and disk are virtio devices (which should be fast):

vm58820-4:~ # lsmod|grep -i virt
virtio_balloon         22788  0
virtio_net             30464  0
virtio_pci             27264  0
virtio_ring            21376  1 virtio_pci
virtio_blk             25224  5
virtio                 22916  4 virtio_balloon,virtio_net,virtio_pci,virtio_blk

That's the config of the guest:

&lt;domain type='kvm'&gt;
  &lt;name&gt;mausdb_vm&lt;/name&gt;
  &lt;uuid&gt;f08c2f32-fe35-137a-0e9d-fa7485d57974&lt;/uuid&gt;
  &lt;memory unit='KiB'&gt;8198144&lt;/memory&gt;
  &lt;currentMemory unit='KiB'&gt;8197376&lt;/currentMemory&gt;
  &lt;vcpu placement='static'&gt;2&lt;/vcpu&gt;
  &lt;os&gt;
    &lt;type arch='x86_64' machine='pc-i440fx-1.4'&gt;hvm&lt;/type&gt;
    &lt;boot dev='cdrom'/&gt;
    &lt;bootmenu enable='yes'/&gt;
  &lt;/os&gt;
  &lt;features&gt;
    &lt;acpi/&gt;
    &lt;apic/&gt;
    &lt;pae/&gt;
  &lt;/features&gt;
  &lt;clock offset='utc'/&gt;
  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
  &lt;on_crash&gt;destroy&lt;/on_crash&gt;
  &lt;devices&gt;
    &lt;emulator&gt;/usr/bin/qemu-kvm&lt;/emulator&gt;
    &lt;disk type='block' device='disk'&gt;
      &lt;driver name='qemu' type='raw' cache='none'/&gt;
      &lt;source dev='/dev/vg_cluster_01/lv_cluster_01'/&gt;
      &lt;target dev='vda' bus='virtio'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/&gt;
    &lt;/disk&gt;
    &lt;controller type='usb' index='0'&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2'/&gt;
    &lt;/controller&gt;
    &lt;controller type='pci' index='0' model='pci-root'/&gt;
    &lt;controller type='ide' index='0'&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x1'/&gt;
    &lt;/controller&gt;
    &lt;interface type='bridge'&gt;
      &lt;mac address='52:54:00:37:92:01'/&gt;
      &lt;source bridge='br0'/&gt;
      &lt;model type='virtio'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/&gt;
    &lt;/interface&gt;
    &lt;input type='mouse' bus='ps2'/&gt;
    &lt;input type='keyboard' bus='ps2'/&gt;
    &lt;graphics type='vnc' port='-1' autoport='yes' listen='127.0.0.1'&gt;
      &lt;listen type='address' address='127.0.0.1'/&gt;
    &lt;/graphics&gt;
    &lt;video&gt;
      &lt;model type='cirrus' vram='9216' heads='1'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/&gt;
    &lt;/video&gt;
    &lt;memballoon model='virtio'&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/&gt;
    &lt;/memballoon&gt;
  &lt;/devices&gt;
  &lt;seclabel type='none'/&gt;
&lt;/domain&gt;

Host OS is SLES 11 SP4, guest os is SLES 10 SP4. Both 64bit.


Thanks for any hint.


Bernd



-- 

Bernd Lentes 

Systemadministration 
institute of developmental genetics 
Gebäude 35.34 - Raum 208 
HelmholtzZentrum München 
bernd.lentes@helmholtz-muenchen.de 
phone: +49 (0)89 3187 1241 
fax: +49 (0)89 3187 2294 

Erst wenn man sich auf etwas festlegt kann man Unrecht haben 
Scott Adams
 

Helmholtz Zentrum Muenchen
Deutsches Forschungszentrum fuer Gesundheit und Umwelt (GmbH)
Ingolstaedter Landstr. 1
85764 Neuherberg
www.helmholtz-muenchen.de
Aufsichtsratsvorsitzende: MinDir'in Baerbel Brumme-Bothe
Geschaeftsfuehrer: Prof. Dr. Guenther Wess, Heinrich Bassler, Dr. Alfons Enhsen
Registergericht: Amtsgericht Muenchen HRB 6466
USt-IdNr: DE 129521671


</body></email><email><emailId>20170217181859</emailId><senderName>Jiri Denemark</senderName><senderEmail>jdenemar@redhat.com</senderEmail><timestampReceived>2017-02-17 18:18:59-0400</timestampReceived><subject>Re: [libvirt-users] Why Guest does not retain Host CPU flags</subject><body>

On Fri, Feb 17, 2017 at 11:23:54 +0530, akhilesh rawat wrote:
&gt; ok thanks , but then can we know which all list of feature are supported by
&gt; QEMU/KVM release.
&gt; http://www.linux-kvm.org/page/KVM_Features

This page is not really about CPU features. It's not so easy to tell
whether a given CPU feature will be available to a guest or not as it
depends on a lot of things: QEMU and KVM version, machine type, hardware
settings, and even a specific revision of a given CPU model installed in
your host. Probably the simplest way to see the features is to check
them in a guest OS.

If everything goes well you should be able to get similar info from
libvirt via "virsh domcapabilities" command soon. Hopefully with QEMU
2.9.0 and libvirt 3.1.0.

Jirka

</body></email><email><emailId>20170220153741</emailId><senderName>Gionatan Danti</senderName><senderEmail>g.danti@assyoma.it</senderEmail><timestampReceived>2017-02-20 15:37:41-0400</timestampReceived><subject>Re: [libvirt-users] Libvirt behavior when mixing io=native and cache=writeback</subject><body>

On 20/02/2017 14:02, Martin Kletzander wrote:
&gt; On Fri, Feb 17, 2017 at 02:52:06PM +0100, Gionatan Danti wrote:
&gt;
&gt; How about using --xml to supply the destination XML which would have
&gt; io="threads" specified?
&gt;

This seems to work, excellent suggestion! Thank you.

-- 
Danti Gionatan
Supporto Tecnico
Assyoma S.r.l. - www.assyoma.it
email: g.danti@assyoma.it - info@assyoma.it
GPG public key ID: FF5F32A8

</body></email><email><emailId>20170221041524</emailId><senderName>Yunchih Chen</senderName><senderEmail>yunchih@csie.ntu.edu.tw</senderEmail><timestampReceived>2017-02-21 04:15:24-0400</timestampReceived><subject>Re: [libvirt-users] "virsh list" ahngs</subject><body>



On 02/20/2017 09:07 PM, Martin Kletzander wrote:
&gt; On Sat, Feb 18, 2017 at 12:21:31AM +0800, Yunchih Chen wrote:
&gt;&gt;
&gt;&gt; `virsh list` hangs on my server that hosts a bunch of VMs.
&gt;&gt; This might be due to the Debian upgrade I did on Feb 15, which upgrades
&gt;&gt; `libvirt` from 2.4.0-1 to 3.0.0-2.
&gt;&gt; I have tried restarting libvirtd for a few times, without luck.
&gt;&gt;
&gt;&gt; Attached below are some relevant logs; let me know if you need some more
&gt;&gt; for debugging.
&gt;&gt; Thanks for your help!!
&gt;&gt;
&gt;&gt; root@vm-host:~# uname -a
&gt;&gt; Linux vm-host 4.6.0-1-amd64 #1 SMP Debian 4.6.4-1 (2016-07-18) x86_64
&gt;&gt; GNU/Linux
&gt;&gt;
&gt;&gt; root@vm-host:~# apt-cache policy libvirt-daemon
&gt;&gt; libvirt-daemon:
&gt;&gt;   Installed: 3.0.0-2
&gt;&gt;   Candidate: 3.0.0-2
&gt;&gt;   Version table:
&gt;&gt;  *** 3.0.0-2 500
&gt;&gt;         500 http://debian.csie.ntu.edu.tw/debian testing/main amd64
&gt;&gt; Packages
&gt;&gt;         100 /var/lib/dpkg/status
&gt;&gt;
&gt;&gt; root@vm-host:~# strace -o /tmp/trace -e trace=network,file,poll virsh
&gt;&gt; list  # hangs forever .....
&gt;&gt; ^C
&gt;&gt; root@vm-host:~# tail -10 /tmp/trace
&gt;&gt; access("/etc/libvirt/libvirt.conf", F_OK) = 0
&gt;&gt; open("/etc/libvirt/libvirt.conf", O_RDONLY) = 5
&gt;&gt; access("/proc/vz", F_OK)                = -1 ENOENT (No such file or
&gt;&gt; directory)
&gt;&gt; socket(AF_UNIX, SOCK_STREAM, 0)         = 5
&gt;&gt; connect(5, {sa_family=AF_UNIX,
&gt;&gt; sun_path="/var/run/libvirt/libvirt-sock"}, 110) = 0
&gt;&gt; getsockname(5, {sa_family=AF_UNIX}, [128-&gt;2]) = 0
&gt;&gt; poll([{fd=5, events=POLLOUT}, {fd=6, events=POLLIN}], 2, -1) = 1
&gt;&gt; ([{fd=5, revents=POLLOUT}])
&gt;&gt; poll([{fd=5, events=POLLIN}, {fd=6, events=POLLIN}], 2, -1) = ?
&gt;&gt; ERESTART_RESTARTBLOCK (Interrupted by signal)
&gt;&gt; --- SIGINT {si_signo=SIGINT, si_code=SI_KERNEL} ---
&gt;&gt; +++ killed by SIGINT +++
&gt;&gt;
&gt;&gt; root@vm-host:~# lsof /var/run/libvirt/libvirt-sock # hangs too ...
&gt;&gt; ^C
&gt;&gt;
&gt;
&gt; This is weird =)  Can you attach to libvirtd using gdb (with installed
&gt; debuginfo) and run 't a a bt' to see where the daemon hangs?  I think
&gt; it's not accepting connections and that's what virsh is waiting for.

Thanks for your help!  Please refer to the previous thread.
https://www.redhat.com/archives/libvirt-users/2017-February/msg00057.html

-- 
--
Yun-Chih Chen 陳耘志
Network/Workstation Assistant
Dept. of Computer Science and Information Engineering
National Taiwan University
Tel: +886-2-33664888 ext. 217/204
Email: ta217@csie.ntu.edu.tw
Website: http://wslab.csie.ntu.edu.tw/

</body></email><email><emailId>20170221055106</emailId><senderName>abhishek jain</senderName><senderEmail>abhish_jain@yahoo.com</senderEmail><timestampReceived>2017-02-21 05:51:06-0400</timestampReceived><subject>[libvirt-users] Virsh command hanging</subject><body>

Hi,
I started the VMs with libvirt 3 days ago (17th Feb).   Now when I am trying to \
shutdown the domain, all my virsh command is hanging even   virt-manager remains in \
"connecting.."   mode and is not showing active domains.When    I set   the libvirt \
debug env and call "virsh list"   it hangs in poll. Here is the logsetenv \
LIBVIRT_DEBUG 1 virsh list

2017-02-21 05:31:09.241+0000: 125812: debug :virEventPollCalculateTimeout:320 : \
Calculate expiry of 0 timers

2017-02-21 05:31:09.241+0000: 125811: debug :virEventPollUpdateHandle:146 : \
EVENT_POLL_UPDATE_HANDLE: watch=2 events=0

2017-02-21 05:31:09.241+0000: 125812: debug :virEventPollCalculateTimeout:346 : \
Timeout at 0 due in -1 ms

2017-02-21 05:31:09.241+0000: 125812: debug :virEventPollRunOnce:614 : \
EVENT_POLL_RUN: nhandles=2 timeout=-1

2017-02-21 05:31:09.241+0000: 125811: debug :virEventPollInterruptLocked:701 : \
Interrupting

2017-02-21 05:31:09.241+0000: 125812: debug :virEventPollRunOnce:625 : Poll got 1 \
event(s)

2017-02-21 05:31:09.242+0000: 125812: debug :virEventPollDispatchTimeouts:410 : \
Dispatch 0

2017-02-21 05:31:09.242+0000: 125812: debug :virEventPollDispatchHandles:455 : \
Dispatch 2

2017-02-21 05:31:09.242+0000: 125812: debug :virEventPollDispatchHandles:469 : i=0 \
w=1

2017-02-21 05:31:09.242+0000: 125812: debug :virEventPollDispatchHandles:483 : \
EVENT_POLL_DISPATCH_HANDLE: watch=1 events=1

2017-02-21 05:31:09.242+0000: 125812: debug :virEventPollCleanupTimeouts:501 : \
Cleanup 0

2017-02-21 05:31:09.242+0000: 125812: debug :virEventPollCleanupTimeouts:537 : Found \
0 out of 0 timeout slots used,releasing 0

2017-02-21 05:31:09.242+0000: 125812: debug :virEventPollCleanupHandles:549 : Cleanup \
2

2017-02-21 05:31:09.242+0000: 125812: debug :virEventRunDefaultImpl:244 : running \
default event implementation

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollCleanupTimeouts:501: \
Cleanup 0

2017-02-21 05:31:09.242+0000: 125812: debug :virEventPollCleanupTimeouts:537 : Found \
0 out of 0 timeout slots used,releasing 0

2017-02-21 05:31:09.242+0000: 125812: debug :virEventPollCleanupHandles:549 : Cleanup \
2

2017-02-21 05:31:09.242+0000: 125812: debug :virEventPollMakePollFDs:378 : Prepare \
n=0 w=1, f=4 e=1 d=0

2017-02-21 05:31:09.242+0000: 125812: debug :virEventPollMakePollFDs:378 : Prepare \
n=1 w=2, f=6 e=0 d=0

2017-02-21 05:31:09.242+0000: 125812: debug : virEventPollCalculateTimeout:320: \
Calculate expiry of 0 timers

2017-02-21 05:31:09.242+0000: 125812: debug :virEventPollCalculateTimeout:346 : \
Timeout at 0 due in -1 ms

2017-02-21 05:31:09.242+0000: 125812: debug :virEventPollRunOnce:614 : \
EVENT_POLL_RUN: nhandles=1 timeout=-1&lt;&lt;hang&gt;&gt;



here is the log snippet of   /var/log/libvirt/libvirtd.log2017-02-17 \
06:18:26.198+0000: 5052: error :daemonStreamHandleAbort:609 : stream aborted at \
client request

2017-02-17 06:18:41.022+0000: 5052: error :daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:18:56.017+0000: 5052: error :daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:19:11.019+0000: 5052: error :daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:19:26.016+0000: 5052: error :daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:19:41.021+0000: 5052: error :daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:19:56.014+0000: 5052: error :daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:20:11.021+0000: 5052: error :daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:20:26.014+0000: 5052: error :daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:20:41.014+0000: 5052: error :daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:20:56.016+0000: 5052: error :daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:21:11.019+0000: 5052: error :daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:21:26.018+0000: 5052: error :daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:21:41.022+0000: 5052: error :daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:21:56.019+0000: 5052: error :daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:22:11.020+0000: 5052: error :daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-17 06:22:26.012+0000: 5052: error :daemonStreamHandleAbort:609 : stream \
aborted at client request

2017-02-18 01:53:36.308+0000: 5052: warning :virKeepAliveTimerInternal:156 : No \
response from client 0xe14160 after 5keepalive messages in 30 seconds

2017-02-18 01:53:47.346+0000: 5052: warning :virKeepAliveTimerInternal:156 : No \
response from client 0xe14c70 after 5 keepalivemessages in 30 seconds \
/var/log/libvirt/libvirtd.log


What could be the problem. I am running virsh (0.10.2) on RHEL6
Thanks for your help in advance.
RegardsAbhishek


[Attachment #3 (text/html)]

&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;div style="color:#000; background-color:#fff; \
font-family:HelveticaNeue, Helvetica Neue, Helvetica, Arial, Lucida Grande, \
Sans-Serif;font-size:12px"&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3018"&gt;Hi,&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3018"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3018" dir="ltr"&gt;I started the VMs with libvirt 3 \
days ago (17th Feb).  Now when I am trying to shutdown the domain, all my virsh \
command is hanging even  virt-manager remains in "connecting.."  mode and \
is not showing active domains.&lt;/div&gt;&lt;div id="yui_3_16_0_ym19_1_1487655384351_3018" \
dir="ltr"&gt;When   I set  the libvirt debug env and call "virsh list" \
 it hangs in poll. Here is the log&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3203"&gt;setenv LIBVIRT_DEBUG 1 virsh list&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3204"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3205"&gt;2017-02-21 05:31:09.241+0000: 125812: debug \
: virEventPollCalculateTimeout:320 : Calculate expiry of 0 timers&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3206"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3207"&gt;2017-02-21 05:31:09.241+0000: 125811: debug \
: virEventPollUpdateHandle:146 : EVENT_POLL_UPDATE_HANDLE: watch=2 events=0&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3208"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3209"&gt;2017-02-21 05:31:09.241+0000: 125812: debug \
: virEventPollCalculateTimeout:346 : Timeout at 0 due in -1 ms&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3210"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3211"&gt;2017-02-21 05:31:09.241+0000: 125812: debug \
: virEventPollRunOnce:614 : EVENT_POLL_RUN: nhandles=2 timeout=-1&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3212"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3213"&gt;2017-02-21 05:31:09.241+0000: 125811: debug \
: virEventPollInterruptLocked:701 : Interrupting&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3214"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3215"&gt;2017-02-21 05:31:09.241+0000: 125812: debug \
: virEventPollRunOnce:625 : Poll got 1 event(s)&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3216"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3217"&gt;2017-02-21 05:31:09.242+0000: 125812: debug \
: virEventPollDispatchTimeouts:410 : Dispatch 0&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3218"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3219"&gt;2017-02-21 05:31:09.242+0000: 125812: debug \
: virEventPollDispatchHandles:455 : Dispatch 2&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3220"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3221"&gt;2017-02-21 05:31:09.242+0000: 125812: debug \
: virEventPollDispatchHandles:469 : i=0 w=1&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3222"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3223"&gt;2017-02-21 05:31:09.242+0000: 125812: debug \
: virEventPollDispatchHandles:483 : EVENT_POLL_DISPATCH_HANDLE: watch=1 events=1&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3224"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3225"&gt;2017-02-21 05:31:09.242+0000: 125812: debug \
: virEventPollCleanupTimeouts:501 : Cleanup 0&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3226"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3227"&gt;2017-02-21 05:31:09.242+0000: 125812: debug \
: virEventPollCleanupTimeouts:537 : Found 0 out of 0 timeout slots used,
releasing 0&lt;o:p id="yui_3_16_0_ym19_1_1487655384351_3228"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3229"&gt;2017-02-21 05:31:09.242+0000: 125812: debug \
: virEventPollCleanupHandles:549 : Cleanup 2&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3230"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3231"&gt;2017-02-21 05:31:09.242+0000: 125812: debug \
: virEventRunDefaultImpl:244 : running default event implementation&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3232"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3233"&gt;2017-02-21 05:31:09.242+0000: 125812: debug \
: virEventPollCleanupTimeouts:501 : Cleanup 0&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3234"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3235"&gt;2017-02-21 05:31:09.242+0000: 125812: debug \
: virEventPollCleanupTimeouts:537 : Found 0 out of 0 timeout slots used,
releasing 0&lt;o:p id="yui_3_16_0_ym19_1_1487655384351_3236"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3237"&gt;2017-02-21 05:31:09.242+0000: 125812: debug \
: virEventPollCleanupHandles:549 : Cleanup 2&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3238"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3239"&gt;2017-02-21 05:31:09.242+0000: 125812: debug \
: virEventPollMakePollFDs:378 : Prepare n=0 w=1, f=4 e=1 d=0&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3240"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3241"&gt;2017-02-21 05:31:09.242+0000: 125812: debug \
: virEventPollMakePollFDs:378 : Prepare n=1 w=2, f=6 e=0 d=0&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3242"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3243"&gt;2017-02-21 05:31:09.242+0000: 125812: debug \
: virEventPollCalculateTimeout:320 : Calculate expiry of 0 timers&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3244"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3245"&gt;2017-02-21 05:31:09.242+0000: 125812: debug \
: virEventPollCalculateTimeout:346 : Timeout at 0 due in -1 ms&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3246"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3018" dir="ltr"&gt;











































&lt;/div&gt;&lt;div dir="ltr" id="yui_3_16_0_ym19_1_1487655384351_3247"&gt;&lt;b \
id="yui_3_16_0_ym19_1_1487655384351_3268"&gt;2017-02-21 05:31:09.242+0000: 125812: debug \
: virEventPollRunOnce:614 : EVENT_POLL_RUN: nhandles=1 timeout=-1
&lt;&lt;hang&gt;&gt;&lt;/b&gt;&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3248"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1487655384351_3247"&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1487655384351_3247"&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1487655384351_3247"&gt;&lt;b&gt;here is the log snippet of  &lt;/b&gt;&lt;b \
id="yui_3_16_0_ym19_1_1487655384351_3446"&gt;/var/log/libvirt/libvirtd.log&lt;/b&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3397"&gt;2017-02-17 06:18:26.198+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3398"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3399"&gt;2017-02-17 06:18:41.022+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3400"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3401"&gt;2017-02-17 06:18:56.017+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3402"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3403"&gt;2017-02-17 06:19:11.019+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3404"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3405"&gt;2017-02-17 06:19:26.016+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3406"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3407"&gt;2017-02-17 06:19:41.021+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3408"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3409"&gt;2017-02-17 06:19:56.014+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3410"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3411"&gt;2017-02-17 06:20:11.021+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3412"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3413"&gt;2017-02-17 06:20:26.014+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3414"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3415"&gt;2017-02-17 06:20:41.014+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3416"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3417"&gt;2017-02-17 06:20:56.016+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3418"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3419"&gt;2017-02-17 06:21:11.019+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3420"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3421"&gt;2017-02-17 06:21:26.018+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3422"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3423"&gt;2017-02-17 06:21:41.022+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3424"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3425"&gt;2017-02-17 06:21:56.019+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3426"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3427"&gt;2017-02-17 06:22:11.020+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3428"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3429"&gt;2017-02-17 06:22:26.012+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3430"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487655384351_3431"&gt;2017-02-18 01:53:36.308+0000: 5052: warning \
: virKeepAliveTimerInternal:156 : No response from client 0xe14160 after 5
keepalive messages in 30 seconds&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3432"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1487655384351_3247"&gt;



































&lt;/div&gt;&lt;div dir="ltr" id="yui_3_16_0_ym19_1_1487655384351_3433"&gt;&lt;b \
id="yui_3_16_0_ym19_1_1487655384351_3435"&gt;2017-02-18 01:53:47.346+0000: 5052: warning \
: virKeepAliveTimerInternal:156 : No response from client 0xe14c70 after 5 keepalive
messages in 30 seconds /var/log/libvirt/libvirtd.log&lt;/b&gt;&lt;o:p \
id="yui_3_16_0_ym19_1_1487655384351_3434"&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1487655384351_3433"&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1487655384351_3433"&gt;&lt;span \
id="yui_3_16_0_ym19_1_1487655384351_3467"&gt;What could be the problem. I am running \
virsh (0.10.2) on RHEL6&lt;/span&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1487655384351_3433"&gt;&lt;br&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1487655384351_3433"&gt;&lt;span \
id="yui_3_16_0_ym19_1_1487655384351_3465"&gt;Thanks for your help in \
advance.&lt;/span&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1487655384351_3433"&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1487655384351_3433"&gt;&lt;span&gt;Regards&lt;/span&gt;&lt;/div&gt;&lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1487655384351_3433"&gt;&lt;span \
id="yui_3_16_0_ym19_1_1487655384351_3623"&gt;Abhishek&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;



</body></email><email><emailId>20170221132014</emailId><senderName>Kashyap Chamarthy</senderName><senderEmail>kchamart@redhat.com</senderEmail><timestampReceived>2017-02-21 13:20:14-0400</timestampReceived><subject>Re: [libvirt-users] Unsafe migration with copy-storage-all (non shared storage) and writeback cache</subject><body>

On Tue, Feb 21, 2017 at 10:32:08AM +0100, Gionatan Danti wrote:
&gt; On 17/02/2017 19:50, Jiri Denemark wrote:

[...]

&gt; &gt; This looks like a bug in libvirt. The code doesn't check whether an
&gt; &gt; affected disk is going to be migrated (--copy-storage-all) or accessed
&gt; &gt; on the shared storage.
&gt; &gt; 
&gt; &gt; Jirka
&gt; &gt; 
&gt; 
&gt; Any chances the bug will be corrected? Should I open a BZ against it?

Sure, you can file the bug here (with as much complete details as
reasonably possible), and it should be triaged:

    https://bugzilla.redhat.com/enter_bug.cgi?product=Virtualization%20Tools&amp;component=libvirt


-- 
/kashyap

</body></email><email><emailId>20170221133256</emailId><senderName>abhishek jain</senderName><senderEmail>abhish_jain@yahoo.com</senderEmail><timestampReceived>2017-02-21 13:32:56-0400</timestampReceived><subject>Re: [libvirt-users] =?utf-8?b?562U5aSNOiAgVmlyc2ggY29tbWFuZCBoYW5n?= =?utf-8?q?ing?=</subject><body>

I can only use RHEL6.
Is it a bug in libvirt ??
RegardsAbhishek

      From: 王李明 &lt;wanglm@certusnet.com.cn&gt;
 To: 'abhishek jain' &lt;abhish_jain@yahoo.com&gt;; libvirt-users@redhat.com 
 Sent: Tuesday, 21 February 2017 11:54 AM
 Subject: 答复: [libvirt-users] Virsh command hanging
   
#yiv0252501574 #yiv0252501574 -- _filtered #yiv0252501574 \
{font-family:Helvetica;panose-1:2 11 6 4 2 2 2 2 2 4;} _filtered #yiv0252501574 \
{font-family:宋体;panose-1:2 1 6 0 3 1 1 1 1 1;} _filtered #yiv0252501574 \
{panose-1:2 4 5 3 5 4 6 3 2 4;} _filtered #yiv0252501574 \
{font-family:Calibri;panose-1:2 15 5 2 2 2 4 3 2 4;} _filtered #yiv0252501574 \
{panose-1:2 1 6 0 3 1 1 1 1 1;}#yiv0252501574 #yiv0252501574 \
p.yiv0252501574MsoNormal, #yiv0252501574 li.yiv0252501574MsoNormal, #yiv0252501574 \
div.yiv0252501574MsoNormal \
{margin:0cm;margin-bottom:.0001pt;font-size:12.0pt;font-family:宋体;}#yiv0252501574 \
a:link, #yiv0252501574 span.yiv0252501574MsoHyperlink \
{color:blue;text-decoration:underline;}#yiv0252501574 a:visited, #yiv0252501574 \
span.yiv0252501574MsoHyperlinkFollowed \
{color:purple;text-decoration:underline;}#yiv0252501574 \
span.yiv0252501574EmailStyle17 {color:black;}#yiv0252501574 \
.yiv0252501574MsoChpDefault {font-size:10.0pt;} _filtered #yiv0252501574 \
{margin:72.0pt 90.0pt 72.0pt 90.0pt;}#yiv0252501574 div.yiv0252501574Section1 \
{}#yiv0252501574 I have this problem in centos6.5 when I upgrade to centos 7.1 this \
problem is soluted maybe you can upgrade your os version             发件人: \
libvirt-users-bounces@redhat.com[mailto:libvirt-users-bounces@redhat.com] 代表 \
abhishek jain 发送时间: 2017年2月21日 13:51
收件人:libvirt-users@redhat.com
主题: [libvirt-users]Virsh command hanging     Hi,     I started the VMs \
withlibvirt 3 days ago (17th Feb).   Now when I am trying to shutdown thedomain, all \
my virsh command is hanging even   virt-manager remains in"connecting.."   mode and \
is not showing active domains. When    I set  the libvirt debug env and call "virsh \
list"   it hangs inpoll. Here is the log setenv LIBVIRT_DEBUG 1virsh list \
2017-02-2105:31:09.241+0000: 125812: debug : virEventPollCalculateTimeout:320 : \
Calculateexpiry of 0 timers 2017-02-2105:31:09.241+0000: 125811: debug : \
virEventPollUpdateHandle:146 :EVENT_POLL_UPDATE_HANDLE: watch=2 events=0 \
2017-02-2105:31:09.241+0000: 125812: debug : virEventPollCalculateTimeout:346 : \
Timeoutat 0 due in -1 ms 2017-02-2105:31:09.241+0000: 125812: debug : \
virEventPollRunOnce:614 : EVENT_POLL_RUN:nhandles=2 timeout=-1 \
2017-02-2105:31:09.241+0000: 125811: debug : virEventPollInterruptLocked:701 \
:Interrupting 2017-02-21 05:31:09.241+0000:125812: debug : virEventPollRunOnce:625 : \
Poll got 1 event(s) 2017-02-2105:31:09.242+0000: 125812: debug : \
virEventPollDispatchTimeouts:410 : Dispatch 0 2017-02-2105:31:09.242+0000: 125812: \
debug : virEventPollDispatchHandles:455 : Dispatch 2 2017-02-2105:31:09.242+0000: \
125812: debug : virEventPollDispatchHandles:469 : i=0 w=1 \
2017-02-2105:31:09.242+0000: 125812: debug : virEventPollDispatchHandles:483 \
:EVENT_POLL_DISPATCH_HANDLE: watch=1 events=1 2017-02-2105:31:09.242+0000: 125812: \
debug : virEventPollCleanupTimeouts:501 : Cleanup 0 2017-02-2105:31:09.242+0000: \
125812: debug : virEventPollCleanupTimeouts:537 : Found 0out of 0 timeout slots used, \
releasing 0 2017-02-2105:31:09.242+0000: 125812: debug : \
virEventPollCleanupHandles:549 : Cleanup 2 2017-02-2105:31:09.242+0000: 125812: debug \
: virEventRunDefaultImpl:244 : running defaultevent implementation \
2017-02-2105:31:09.242+0000: 125812: debug : virEventPollCleanupTimeouts:501 : \
Cleanup 0 2017-02-2105:31:09.242+0000: 125812: debug : \
virEventPollCleanupTimeouts:537 : Found 0out of 0 timeout slots used, releasing 0 \
2017-02-2105:31:09.242+0000: 125812: debug : virEventPollCleanupHandles:549 : Cleanup \
2 2017-02-2105:31:09.242+0000: 125812: debug : virEventPollMakePollFDs:378 : Prepare \
n=0w=1, f=4 e=1 d=0 2017-02-2105:31:09.242+0000: 125812: debug : \
virEventPollMakePollFDs:378 : Prepare n=1w=2, f=6 e=0 d=0 \
2017-02-2105:31:09.242+0000: 125812: debug : virEventPollCalculateTimeout:320 : \
Calculateexpiry of 0 timers 2017-02-21 05:31:09.242+0000:125812: debug : \
virEventPollCalculateTimeout:346 : Timeout at 0 due in -1 ms \
2017-02-2105:31:09.242+0000: 125812: debug : virEventPollRunOnce:614 : \
EVENT_POLL_RUN:nhandles=1 timeout=-1 &lt;&lt;hang&gt;&gt;         hereis the log snippet of   \
/var/log/libvirt/libvirtd.log 2017-02-1706:18:26.198+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream abortedat client request \
2017-02-1706:18:41.022+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
abortedat client request 2017-02-1706:18:56.017+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream abortedat client request \
2017-02-1706:19:11.019+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
abortedat client request 2017-02-1706:19:26.016+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream abortedat client request \
2017-02-1706:19:41.021+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
abortedat client request 2017-02-1706:19:56.014+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream abortedat client request \
2017-02-1706:20:11.021+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
abortedat client request 2017-02-1706:20:26.014+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream abortedat client request 2017-02-17 \
06:20:41.014+0000:5052: error : daemonStreamHandleAbort:609 : stream aborted at \
client request 2017-02-1706:20:56.016+0000: 5052: error : daemonStreamHandleAbort:609 \
: stream abortedat client request 2017-02-1706:21:11.019+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream abortedat client request \
2017-02-1706:21:26.018+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
abortedat client request 2017-02-1706:21:41.022+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream abortedat client request \
2017-02-1706:21:56.019+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
abortedat client request 2017-02-1706:22:11.020+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream abortedat client request \
2017-02-1706:22:26.012+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
abortedat client request 2017-02-1801:53:36.308+0000: 5052: warning : \
virKeepAliveTimerInternal:156 : No responsefrom client 0xe14160 after 5 keepalive \
messages in 30 seconds 2017-02-1801:53:47.346+0000: 5052: warning : \
virKeepAliveTimerInternal:156 : No responsefrom client 0xe14c70 after 5 keepalive \
messages in 30 seconds/var/log/libvirt/libvirtd.log     What could be theproblem. I \
am running virsh (0.10.2) on RHEL6     Thanks for your help inadvance.     Regards \
Abhishek 

   


[Attachment #3 (text/html)]

&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;div style="color:#000; background-color:#fff; \
font-family:HelveticaNeue, Helvetica Neue, Helvetica, Arial, Lucida Grande, \
Sans-Serif;font-size:12px"&gt;&lt;div id="yui_3_16_0_ym19_1_1487683874205_3770"&gt;&lt;span \
id="yui_3_16_0_ym19_1_1487683874205_3769"&gt;I can only use RHEL6.&lt;/span&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487683874205_3771"&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487683874205_3773"&gt;&lt;span \
id="yui_3_16_0_ym19_1_1487683874205_3772"&gt;Is it a bug in libvirt ??&lt;/span&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487683874205_3774"&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487683874205_3779"&gt;&lt;span&gt;Regards&lt;/span&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487683874205_3780"&gt;&lt;span&gt;Abhishek&lt;/span&gt;&lt;/div&gt;&lt;div \
class="qtdSeparateBR" id="yui_3_16_0_ym19_1_1487683874205_3781"&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="yahoo_quoted" id="yui_3_16_0_ym19_1_1487683874205_3786" style="display: \
block;"&gt;  &lt;div style="font-family: HelveticaNeue, Helvetica Neue, Helvetica, Arial, \
Lucida Grande, Sans-Serif; font-size: 12px;" \
id="yui_3_16_0_ym19_1_1487683874205_3785"&gt; &lt;div style="font-family: HelveticaNeue, \
Helvetica Neue, Helvetica, Arial, Lucida Grande, Sans-Serif; font-size: 16px;" \
id="yui_3_16_0_ym19_1_1487683874205_3784"&gt; &lt;div dir="ltr" \
id="yui_3_16_0_ym19_1_1487683874205_3783"&gt; &lt;font size="2" face="Arial" \
id="yui_3_16_0_ym19_1_1487683874205_3782"&gt; &lt;hr size="1"&gt; &lt;b&gt;&lt;span \
style="font-weight:bold;"&gt;From:&lt;/span&gt;&lt;/b&gt; 王李明 \
&lt;wanglm@certusnet.com.cn&gt;&lt;br&gt; &lt;b&gt;&lt;span style="font-weight: \
bold;"&gt;To:&lt;/span&gt;&lt;/b&gt; 'abhishek jain' &lt;abhish_jain@yahoo.com&gt;; \
libvirt-users@redhat.com &lt;br&gt; &lt;b&gt;&lt;span style="font-weight: bold;"&gt;Sent:&lt;/span&gt;&lt;/b&gt; \
Tuesday, 21 February 2017 11:54 AM&lt;br&gt; &lt;b&gt;&lt;span style="font-weight: \
bold;"&gt;Subject:&lt;/span&gt;&lt;/b&gt; 答复: [libvirt-users] Virsh command hanging&lt;br&gt; &lt;/font&gt; \
&lt;/div&gt; &lt;div class="y_msg_container" \
id="yui_3_16_0_ym19_1_1487683874205_3787"&gt;&lt;br&gt;&lt;div id="yiv0252501574"&gt;&lt;style&gt; \
#yiv0252501574 #yiv0252501574 --  
 _filtered #yiv0252501574 {font-family:Helvetica;panose-1:2 11 6 4 2 2 2 2 2 4;}
 _filtered #yiv0252501574 {font-family:宋体;panose-1:2 1 6 0 3 1 1 1 1 1;}
 _filtered #yiv0252501574 {panose-1:2 4 5 3 5 4 6 3 2 4;}
 _filtered #yiv0252501574 {font-family:Calibri;panose-1:2 15 5 2 2 2 4 3 2 4;}
 _filtered #yiv0252501574 {panose-1:2 1 6 0 3 1 1 1 1 1;}
#yiv0252501574  
#yiv0252501574 p.yiv0252501574MsoNormal, #yiv0252501574 li.yiv0252501574MsoNormal, \
#yiv0252501574 div.yiv0252501574MsoNormal  \
{margin:0cm;margin-bottom:.0001pt;font-size:12.0pt;font-family:宋体;} \
#yiv0252501574 a:link, #yiv0252501574 span.yiv0252501574MsoHyperlink  \
{color:blue;text-decoration:underline;} #yiv0252501574 a:visited, #yiv0252501574 \
span.yiv0252501574MsoHyperlinkFollowed  {color:purple;text-decoration:underline;}
#yiv0252501574 span.yiv0252501574EmailStyle17
	{color:black;}
#yiv0252501574 .yiv0252501574MsoChpDefault
	{font-size:10.0pt;}
 _filtered #yiv0252501574 {margin:72.0pt 90.0pt 72.0pt 90.0pt;}
#yiv0252501574 div.yiv0252501574Section1
	{}
#yiv0252501574 
&lt;/style&gt;&lt;div id="yui_3_16_0_ym19_1_1487683874205_3791"&gt;

&lt;div class="yiv0252501574Section1" id="yui_3_16_0_ym19_1_1487683874205_3790"&gt;

&lt;div class="yiv0252501574MsoNormal" id="yui_3_16_0_ym19_1_1487683874205_3789"&gt;&lt;span \
lang="EN-US" style="" id="yui_3_16_0_ym19_1_1487683874205_3788"&gt;I have this problem \
in centos6.5&lt;/span&gt;&lt;/div&gt; 

&lt;div class="yiv0252501574MsoNormal" id="yui_3_16_0_ym19_1_1487683874205_3793"&gt;&lt;span \
lang="EN-US" style="" id="yui_3_16_0_ym19_1_1487683874205_3792"&gt;when I upgrade to \
centos 7.1 this problem is soluted&lt;/span&gt;&lt;/div&gt; 

&lt;div class="yiv0252501574MsoNormal" id="yui_3_16_0_ym19_1_1487683874205_3795"&gt;&lt;span \
lang="EN-US" style="" id="yui_3_16_0_ym19_1_1487683874205_3794"&gt;maybe you can upgrade \
your os version&lt;/span&gt;&lt;/div&gt; 

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3797"&gt;

&lt;div class="yiv0252501574MsoNormal" \
style="text-align:justify;text-justify:inter-ideograph;" \
id="yui_3_16_0_ym19_1_1487683874205_3796"&gt;&lt;span lang="EN-US" \
style="font-size:10.5pt;"&gt;  &lt;/span&gt;&lt;/div&gt; 

&lt;div class="yiv0252501574MsoNormal" \
style="text-align:justify;text-justify:inter-ideograph;" \
id="yui_3_16_0_ym19_1_1487683874205_3798"&gt;&lt;span lang="EN-US" \
style="font-size:10.5pt;"&gt;  &lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div class="yiv0252501574MsoNormal" id="yui_3_16_0_ym19_1_1487683874205_3799"&gt;&lt;span \
lang="EN-US" style=""&gt;  &lt;/span&gt;&lt;/div&gt; 

&lt;div class="yiv0252501574yqt8238971437" id="yiv0252501574yqt06297"&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487683874205_3803"&gt;

&lt;div style="border:none;border-top:solid #B5C4DF 1.0pt;padding:3.0pt 0cm 0cm 0cm;" \
id="yui_3_16_0_ym19_1_1487683874205_3802"&gt;

&lt;div class="yiv0252501574MsoNormal" \
id="yui_3_16_0_ym19_1_1487683874205_3801"&gt;&lt;b&gt;&lt;span \
style="font-size:10.0pt;"&gt;发件人&lt;span lang="EN-US"&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;span \
lang="EN-US" style="font-size:10.0pt;" id="yui_3_16_0_ym19_1_1487683874205_3800"&gt; \
libvirt-users-bounces@redhat.com [mailto:libvirt-users-bounces@redhat.com] \
&lt;/span&gt;&lt;b&gt;&lt;span style="font-size:10.0pt;"&gt;代表 &lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US" \
style="font-size:10.0pt;"&gt;abhishek jain&lt;br clear="none"&gt; &lt;/span&gt;&lt;b&gt;&lt;span \
style="font-size:10.0pt;"&gt;发送时间&lt;span lang="EN-US"&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;span \
lang="EN-US" style="font-size:10.0pt;"&gt; 2017&lt;/span&gt;&lt;span style="font-size:10.0pt;" \
id="yui_3_16_0_ym19_1_1487683874205_3805"&gt;年&lt;span lang="EN-US"&gt;2&lt;/span&gt;月&lt;span \
lang="EN-US"&gt;21&lt;/span&gt;日&lt;span lang="EN-US"&gt; 13:51&lt;br clear="none"&gt; \
&lt;/span&gt;&lt;b&gt;收件人&lt;span lang="EN-US"&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US" \
id="yui_3_16_0_ym19_1_1487683874205_3804"&gt; libvirt-users@redhat.com&lt;br clear="none"&gt;
&lt;/span&gt;&lt;b&gt;主题&lt;span lang="EN-US"&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US" \
id="yui_3_16_0_ym19_1_1487683874205_3806"&gt; [libvirt-users] Virsh command \
hanging&lt;/span&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div class="yiv0252501574MsoNormal" id="yui_3_16_0_ym19_1_1487683874205_3807"&gt;&lt;span \
lang="EN-US"&gt;  &lt;/span&gt;&lt;/div&gt; 

&lt;div id="yui_3_16_0_ym19_1_1487683874205_3809"&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3018"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;" \
id="yui_3_16_0_ym19_1_1487683874205_3808"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;Hi,&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3018"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;" \
id="yui_3_16_0_ym19_1_1487683874205_3810"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;  &lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3018"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;" \
id="yui_3_16_0_ym19_1_1487683874205_3812"&gt;&lt;span lang="EN-US" style="font-size:9.0pt;" \
id="yui_3_16_0_ym19_1_1487683874205_3811"&gt;I started the VMs with libvirt 3 days ago \
(17th Feb).  Now when I am trying to shutdown the domain, all my virsh command \
is hanging even  virt-manager remains in "connecting.."  mode and is not \
showing active domains.&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3018"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;" \
id="yui_3_16_0_ym19_1_1487683874205_3813"&gt;&lt;span lang="EN-US" style="font-size:9.0pt;" \
id="yui_3_16_0_ym19_1_1487683874205_3814"&gt;When   I set  the libvirt debug \
env and call "virsh list"  it hangs in poll. Here is the log&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3203"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;" \
id="yui_3_16_0_ym19_1_1487683874205_3815"&gt;&lt;span lang="EN-US" style="font-size:9.0pt;" \
id="yui_3_16_0_ym19_1_1487683874205_3816"&gt;setenv LIBVIRT_DEBUG 1 virsh \
list&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3205"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;" \
id="yui_3_16_0_ym19_1_1487683874205_3817"&gt;&lt;span lang="EN-US" style="font-size:9.0pt;" \
id="yui_3_16_0_ym19_1_1487683874205_3818"&gt;2017-02-21 05:31:09.241+0000: 125812: debug \
: virEventPollCalculateTimeout:320 : Calculate expiry of 0 timers&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3207"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.241+0000: 125811: debug : \
                virEventPollUpdateHandle:146 :
EVENT_POLL_UPDATE_HANDLE: watch=2 events=0&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3209"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.241+0000: 125812: debug : \
virEventPollCalculateTimeout:346 : Timeout at 0 due in -1 ms&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3211"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.241+0000: 125812: debug : \
virEventPollRunOnce:614 : EVENT_POLL_RUN: nhandles=2 timeout=-1&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3213"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.241+0000: 125811: debug : \
virEventPollInterruptLocked:701 : Interrupting&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3215"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
                style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.241+0000:
125812: debug : virEventPollRunOnce:625 : Poll got 1 event(s)&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3217"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollDispatchTimeouts:410 : Dispatch 0&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3219"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollDispatchHandles:455 : Dispatch 2&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3221"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollDispatchHandles:469 : i=0 w=1&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3223"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
                virEventPollDispatchHandles:483 :
EVENT_POLL_DISPATCH_HANDLE: watch=1 events=1&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3225"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollCleanupTimeouts:501 : Cleanup 0&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3227"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollCleanupTimeouts:537 : Found 0 out of 0 timeout slots used, releasing \
0&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3229"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollCleanupHandles:549 : Cleanup 2&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3231"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventRunDefaultImpl:244 : running default event implementation&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3233"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollCleanupTimeouts:501 : Cleanup 0&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3235"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollCleanupTimeouts:537 : Found 0 out of 0 timeout slots used, releasing \
0&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3237"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollCleanupHandles:549 : Cleanup 2&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3239"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollMakePollFDs:378 : Prepare n=0 w=1, f=4 e=1 d=0&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3241"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollMakePollFDs:378 : Prepare n=1 w=2, f=6 e=0 d=0&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3243"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollCalculateTimeout:320 : Calculate expiry of 0 timers&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3245"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
                style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000:
125812: debug : virEventPollCalculateTimeout:346 : Timeout at 0 due in -1 \
ms&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3247"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;b&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollRunOnce:614 : EVENT_POLL_RUN: nhandles=1 timeout=-1 \
&lt;&lt;hang&gt;&gt;&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3247"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;  &lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3247"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;  &lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3247"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;b&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;here is the log snippet of \
 /var/log/libvirt/libvirtd.log&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3397"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:18:26.198+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3399"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:18:41.022+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3401"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:18:56.017+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3403"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:19:11.019+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3405"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:19:26.016+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3407"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:19:41.021+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3409"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:19:56.014+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3411"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:20:11.021+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3413"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:20:26.014+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3415"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
                style="font-size:9.0pt;"&gt;2017-02-17 06:20:41.014+0000:
5052: error : daemonStreamHandleAbort:609 : stream aborted at client \
request&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3417"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:20:56.016+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3419"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:21:11.019+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3421"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:21:26.018+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3423"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:21:41.022+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3425"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:21:56.019+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3427"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:22:11.020+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3429"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:22:26.012+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3431"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-18 01:53:36.308+0000: 5052: warning : \
virKeepAliveTimerInternal:156 : No response from client 0xe14160 after 5 keepalive \
messages in 30 seconds&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;b&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-18 01:53:47.346+0000: 5052: warning : \
virKeepAliveTimerInternal:156 : No response from client 0xe14c70 after 5 keepalive \
                messages in 30 seconds
/var/log/libvirt/libvirtd.log&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;  &lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;What could be the problem. I am running virsh (0.10.2) on \
RHEL6&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;  &lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;Thanks for your help in advance.&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;  &lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;Regards&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv0252501574yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div class="yiv0252501574MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;Abhishek&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;



</body></email><email><emailId>20170221203936</emailId><senderName>Marcos</senderName><senderEmail>mczueira@yahoo.com.br</senderEmail><timestampReceived>2017-02-21 20:39:36-0400</timestampReceived><subject>Re: [libvirt-users] How to set manually starting date/time for guest kvm</subject><body>

maybe it is easier to use cron
Marcos
 

    Em Terça-feira, 21 de Fevereiro de 2017 15:28, Aleksei &lt;alex3kov@zoho.com&gt; \
escreveu:  

   It doesn't seem to be implemented in libvirt's XML. You can still try and hack it \
though: &lt;domain type='kvm' xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'&gt;  \
&lt;qemu:commandline&gt;  &lt;qemu:arg value='-rtc base="xxx"'/&gt;
    &lt;/qemu:commandline&gt;
 &lt;/domain&gt;
 It will mark this domain "tainted" in libvirt's log.
   
 --Regards, Aleksei  
  
 From: Matt Xtlm
 Sent: Tuesday, February 21, 2017 2:07PM
 To: Libvirt-users
 Subject: [libvirt-users] How to set manually starting date/time for guest kvm 
 Hi there, 
  is there a way to set a guest to start with a specific date and time. (e.g. when \
guest boots, starting guest time should always be (2017-02-05T12:00:00)).   I've \
tried something like this in my kvm domain:   &lt;clock offset='variable' \
adjustment='-86400' basis='localtime'&gt;       &lt;timer name='rtc' tickpolicy='delay' \
track='guest'/&gt;       &lt;timer name='pit' tickpolicy='delay'/&gt;       &lt;timer name='hpet' \
present='no'/&gt;    &lt;/clock&gt;    However, i can't insert a specific date and time \
statement (like starting kvm with -rtc base="2017-02-05T12:00:00").   The date/time \
must be set before starting the vm and must always be the same.   Cheers, Matt 
  
  
   
  
 _______________________________________________
libvirt-users mailing list
libvirt-users@redhat.com
https://www.redhat.com/mailman/listinfo/libvirt-users 
 
 
_______________________________________________
libvirt-users mailing list
libvirt-users@redhat.com
https://www.redhat.com/mailman/listinfo/libvirt-users

   


[Attachment #3 (text/html)]

&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;div style="color:#000; background-color:#fff; \
font-family:Helvetica Neue, Helvetica, Arial, Lucida Grande, \
sans-serif;font-size:16px"&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487706134150_90734"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487706134150_90735"&gt;maybe it is easier to use cron&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487706134150_90738"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487706134150_90740"&gt;Marcos&lt;br&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487706134150_90700"&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt; &lt;div \
class="qtdSeparateBR"&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="yahoo_quoted" style="display: \
block;"&gt; &lt;div style="font-family: Helvetica Neue, Helvetica, Arial, Lucida Grande, \
sans-serif; font-size: 16px;"&gt; &lt;div style="font-family: HelveticaNeue, Helvetica \
Neue, Helvetica, Arial, Lucida Grande, sans-serif; font-size: 16px;"&gt; &lt;div \
dir="ltr"&gt;&lt;font size="2" face="Arial"&gt; Em Terça-feira, 21 de Fevereiro de 2017 \
15:28, Aleksei &lt;alex3kov@zoho.com&gt; escreveu:&lt;br&gt;&lt;/font&gt;&lt;/div&gt;  &lt;br&gt;&lt;br&gt; &lt;div \
class="y_msg_container"&gt;&lt;div id="yiv3601326256"&gt;&lt;div&gt;  &lt;div \
id="yiv3601326256smartTemplate4-template"&gt;  &lt;div&gt;It doesn't seem to be implemented in \
libvirt's XML.&lt;/div&gt;  &lt;div&gt;You can still try and hack it though:&lt;/div&gt;
      &lt;domain type='kvm'
      xmlns:qemu='&lt;a rel="nofollow" shape="rect" \
class="yiv3601326256moz-txt-link-freetext" target="_blank" \
href="http://libvirt.org/schemas/domain/qemu/1.0"&gt;http://libvirt.org/schemas/domain/qemu/1.0&lt;/a&gt;'&gt;&lt;br \
clear="none"&gt;  &lt;qemu:commandline&gt;&lt;br clear="none"&gt;
          &lt;qemu:arg value='-rtc base="xxx"'/&gt;&lt;br clear="none"&gt;
        &lt;/qemu:commandline&gt;&lt;br clear="none"&gt;
      &lt;/domain&gt;&lt;br clear="none"&gt;
      &lt;div&gt;It will mark this domain "tainted" in libvirt's log.&lt;br clear="none"&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;br clear="none"&gt;
    &lt;div class="yiv3601326256moz-signature"&gt;&lt;i&gt;--Regards, Aleksei&lt;/i&gt;
    &lt;/div&gt;
    &lt;br clear="none"&gt;
    &lt;div class="yiv3601326256yqt9641779816" id="yiv3601326256yqt20105"&gt;&lt;div \
id="yiv3601326256smartTemplate4-quoteHeader"&gt;  &lt;hr&gt;&lt;br clear="none"&gt;
      &lt;b&gt;From:&lt;/b&gt; Matt Xtlm&lt;br clear="none"&gt;
      &lt;b&gt;Sent:&lt;/b&gt; Tuesday, February 21, 2017 2:07PM&lt;br clear="none"&gt;
      &lt;b&gt;To:&lt;/b&gt; Libvirt-users&lt;br clear="none"&gt;
      &lt;b&gt;Subject:&lt;/b&gt; [libvirt-users] How to set manually starting
      date/time for guest kvm&lt;/div&gt;
    &lt;blockquote type="cite"&gt;
      &lt;div dir="ltr"&gt;Hi there,
        &lt;div&gt;&lt;br clear="none"&gt;
        &lt;/div&gt;
        &lt;div&gt;is there a way to set a guest to start with a specific date
          and time. (e.g. when guest boots, starting guest time should
          always be (2017-02-05T12:00:00)).&lt;/div&gt;
        &lt;div&gt;&lt;br clear="none"&gt;
        &lt;/div&gt;
        &lt;div&gt;I've tried something like this in my kvm domain:&lt;/div&gt;
        &lt;div&gt;&lt;br clear="none"&gt;
        &lt;/div&gt;
        &lt;div&gt;
          &lt;div&gt;  &lt;clock offset='variable' adjustment='-86400'
            basis='localtime'&gt;&lt;/div&gt;
          &lt;div&gt;    &lt;timer name='rtc' tickpolicy='delay'
            track='guest'/&gt;&lt;/div&gt;
          &lt;div&gt;    &lt;timer name='pit' tickpolicy='delay'/&gt;&lt;/div&gt;
          &lt;div&gt;    &lt;timer name='hpet' present='no'/&gt;&lt;/div&gt;
          &lt;div&gt;  &lt;/clock&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;div&gt;&lt;br clear="none"&gt;
        &lt;/div&gt;
        &lt;div&gt;However, i can't insert a specific date and time statement
          (like starting kvm with -rtc base="2017-02-05T12:00:00").&lt;/div&gt;
        &lt;div&gt;&lt;br clear="none"&gt;
        &lt;/div&gt;
        &lt;div&gt;The date/time must be set before starting the vm and must
          always be the same.&lt;/div&gt;
        &lt;div&gt;&lt;br clear="none"&gt;
        &lt;/div&gt;
        &lt;div&gt;Cheers,&lt;/div&gt;
        &lt;div&gt;Matt&lt;/div&gt;
        &lt;div&gt;&lt;br clear="none"&gt;
        &lt;/div&gt;
        &lt;div&gt;&lt;br clear="none"&gt;
        &lt;/div&gt;
        &lt;div&gt;&lt;br clear="none"&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;br clear="none"&gt;
      &lt;fieldset class="yiv3601326256mimeAttachmentHeader"&gt;&lt;/fieldset&gt;
      &lt;br clear="none"&gt;
      &lt;pre&gt;_______________________________________________
libvirt-users mailing list
&lt;a rel="nofollow" shape="rect" class="yiv3601326256moz-txt-link-abbreviated" \
ymailto="mailto:libvirt-users@redhat.com" target="_blank" \
href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt; &lt;a rel="nofollow" \
shape="rect" class="yiv3601326256moz-txt-link-freetext" target="_blank" \
href="https://www.redhat.com/mailman/listinfo/libvirt-users"&gt;https://www.redhat.com/mailman/listinfo/libvirt-users&lt;/a&gt;&lt;/pre&gt;
  &lt;/blockquote&gt;&lt;/div&gt;
    &lt;br clear="none"&gt;
  &lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div class="yqt9641779816" \
id="yqt92979"&gt;_______________________________________________&lt;br \
clear="none"&gt;libvirt-users mailing list&lt;br clear="none"&gt;&lt;a shape="rect" \
ymailto="mailto:libvirt-users@redhat.com" \
href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br \
clear="none"&gt;&lt;a shape="rect" \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" \
target="_blank"&gt;https://www.redhat.com/mailman/listinfo/libvirt-users&lt;/a&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt; \
&lt;/div&gt; &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;



</body></email><email><emailId>20170222102031</emailId><senderName>abhishek jain</senderName><senderEmail>abhish_jain@yahoo.com</senderEmail><timestampReceived>2017-02-22 10:20:31-0400</timestampReceived><subject>Re: [libvirt-users] =?utf-8?b?562U5aSNOiDnrZTlpI06ICBWaXJzaCBjb21t?= =?utf-8?q?and_hanging?=</subject><body>

Thanks Wanglm for your responses.
Can anyone else has any info about how to resolve such problems. Is this an issue \
fixed in higher version of libvirt ?   Here all my virsh commands are hanging which I \
think due to hang in libvirt-daemon. Can restarting libvirt-domain is fine ? What all \
it impacts ? RegardsAbhishek


      From: 王李明 &lt;wanglm@certusnet.com.cn&gt;
 To: 'abhishek jain' &lt;abhish_jain@yahoo.com&gt;; libvirt-users@redhat.com 
 Sent: Tuesday, 21 February 2017 7:06 PM
 Subject: 答复: 答复: [libvirt-users] Virsh command hanging
   
#yiv4132621194 #yiv4132621194 -- _filtered #yiv4132621194 \
{font-family:Helvetica;panose-1:2 11 6 4 2 2 2 2 2 4;} _filtered #yiv4132621194 \
{font-family:宋体;panose-1:2 1 6 0 3 1 1 1 1 1;} _filtered #yiv4132621194 \
{panose-1:2 4 5 3 5 4 6 3 2 4;} _filtered #yiv4132621194 \
{font-family:Calibri;panose-1:2 15 5 2 2 2 4 3 2 4;} _filtered #yiv4132621194 \
{panose-1:2 1 6 0 3 1 1 1 1 1;}#yiv4132621194 #yiv4132621194 \
p.yiv4132621194MsoNormal, #yiv4132621194 li.yiv4132621194MsoNormal, #yiv4132621194 \
div.yiv4132621194MsoNormal \
{margin:0cm;margin-bottom:.0001pt;font-size:12.0pt;font-family:宋体;}#yiv4132621194 \
a:link, #yiv4132621194 span.yiv4132621194MsoHyperlink \
{color:blue;text-decoration:underline;}#yiv4132621194 a:visited, #yiv4132621194 \
span.yiv4132621194MsoHyperlinkFollowed \
{color:purple;text-decoration:underline;}#yiv4132621194 p.yiv4132621194msonormal, \
#yiv4132621194 li.yiv4132621194msonormal, #yiv4132621194 div.yiv4132621194msonormal \
{margin-right:0cm;margin-left:0cm;font-size:12.0pt;font-family:宋体;}#yiv4132621194 \
p.yiv4132621194msochpdefault, #yiv4132621194 li.yiv4132621194msochpdefault, \
#yiv4132621194 div.yiv4132621194msochpdefault \
{margin-right:0cm;margin-left:0cm;font-size:12.0pt;font-family:宋体;}#yiv4132621194 \
span.yiv4132621194msohyperlink {}#yiv4132621194 \
span.yiv4132621194msohyperlinkfollowed {}#yiv4132621194 \
span.yiv4132621194emailstyle17 {}#yiv4132621194 p.yiv4132621194msonormal1, \
#yiv4132621194 li.yiv4132621194msonormal1, #yiv4132621194 div.yiv4132621194msonormal1 \
{margin:0cm;margin-bottom:.0001pt;font-size:12.0pt;font-family:宋体;}#yiv4132621194 \
span.yiv4132621194msohyperlink1 {color:blue;text-decoration:underline;}#yiv4132621194 \
span.yiv4132621194msohyperlinkfollowed1 \
{color:purple;text-decoration:underline;}#yiv4132621194 \
span.yiv4132621194emailstyle171 {color:black;}#yiv4132621194 \
p.yiv4132621194msochpdefault1, #yiv4132621194 li.yiv4132621194msochpdefault1, \
#yiv4132621194 div.yiv4132621194msochpdefault1 \
{margin-right:0cm;margin-left:0cm;font-size:10.0pt;font-family:宋体;}#yiv4132621194 \
span.yiv4132621194EmailStyle27 {color:black;}#yiv4132621194 \
.yiv4132621194MsoChpDefault {font-size:10.0pt;} _filtered #yiv4132621194 \
{margin:72.0pt 90.0pt 72.0pt 90.0pt;}#yiv4132621194 div.yiv4132621194Section1 \
{}#yiv4132621194 I don't know whether this is a bug because I have tried a lot of \
method to soluted this problem but I alway failed at last I have to upgrade our os \
version      发件人: abhishek jain[mailto:abhish_jain@yahoo.com]  发送时间: \
2017年2月21日 21:33 收件人: 王李明; libvirt-users@redhat.com
主题: Re: 答复: [libvirt-users] Virsh command hanging     I can only use RHEL6.   \
Is it a bug in libvirt??     Regards Abhishek     \
                From:王李明&lt;wanglm@certusnet.com.cn&gt;
To: 'abhishek jain' &lt;abhish_jain@yahoo.com&gt;;libvirt-users@redhat.com 
Sent: Tuesday, 21 February 2017 11:54 AM
Subject: 答复:[libvirt-users] Virsh command hanging     I have this problem in \
centos6.5 when I upgrade to centos 7.1 this problemis soluted maybe you can upgrade \
your os version          发件人:libvirt-users-bounces@redhat.com \
[mailto:libvirt-users-bounces@redhat.com] 代表 abhishek jain 发送时间: \
2017年2月21日 13:51 收件人: libvirt-users@redhat.com
主题: [libvirt-users] Virsh command hanging    Hi,    I started the VMs withlibvirt \
3 days ago (17th Feb).   Now when I am trying to shutdown thedomain, all my virsh \
command is hanging even   virt-manager remains in"connecting.."   mode and is not \
showing active domains. When    I set  the libvirt debug env and call "virsh list"   \
it hangs inpoll. Here is the log setenv LIBVIRT_DEBUG 1virsh list 2017-02-21 \
05:31:09.241+0000:125812: debug : virEventPollCalculateTimeout:320 : Calculate expiry \
of 0 timers 2017-02-2105:31:09.241+0000: 125811: debug : virEventPollUpdateHandle:146 \
:EVENT_POLL_UPDATE_HANDLE: watch=2 events=0 2017-02-2105:31:09.241+0000: 125812: \
debug : virEventPollCalculateTimeout:346 : Timeoutat 0 due in -1 ms \
2017-02-2105:31:09.241+0000: 125812: debug : virEventPollRunOnce:614 : \
EVENT_POLL_RUN:nhandles=2 timeout=-1 2017-02-2105:31:09.241+0000: 125811: debug : \
virEventPollInterruptLocked:701 :Interrupting 2017-02-2105:31:09.241+0000: 125812: \
debug : virEventPollRunOnce:625 : Poll got 1event(s) 2017-02-2105:31:09.242+0000: \
125812: debug : virEventPollDispatchTimeouts:410 : Dispatch0 \
2017-02-2105:31:09.242+0000: 125812: debug : virEventPollDispatchHandles:455 : \
Dispatch 2 2017-02-2105:31:09.242+0000: 125812: debug : \
virEventPollDispatchHandles:469 : i=0 w=1 2017-02-2105:31:09.242+0000: 125812: debug \
: virEventPollDispatchHandles:483 :EVENT_POLL_DISPATCH_HANDLE: watch=1 events=1 \
2017-02-2105:31:09.242+0000: 125812: debug : virEventPollCleanupTimeouts:501 : \
Cleanup 0 2017-02-2105:31:09.242+0000: 125812: debug : \
virEventPollCleanupTimeouts:537 : Found 0out of 0 timeout slots used, releasing 0 \
2017-02-2105:31:09.242+0000: 125812: debug : virEventPollCleanupHandles:549 : Cleanup \
2 2017-02-2105:31:09.242+0000: 125812: debug : virEventRunDefaultImpl:244 : running \
defaultevent implementation 2017-02-2105:31:09.242+0000: 125812: debug : \
virEventPollCleanupTimeouts:501 : Cleanup 0 2017-02-2105:31:09.242+0000: 125812: \
debug : virEventPollCleanupTimeouts:537 : Found 0out of 0 timeout slots used, \
releasing 0 2017-02-2105:31:09.242+0000: 125812: debug : \
virEventPollCleanupHandles:549 : Cleanup 2 2017-02-2105:31:09.242+0000: 125812: debug \
: virEventPollMakePollFDs:378 : Prepare n=0w=1, f=4 e=1 d=0 \
2017-02-2105:31:09.242+0000: 125812: debug : virEventPollMakePollFDs:378 : Prepare \
n=1w=2, f=6 e=0 d=0 2017-02-2105:31:09.242+0000: 125812: debug : \
virEventPollCalculateTimeout:320 : Calculateexpiry of 0 timers \
2017-02-2105:31:09.242+0000: 125812: debug : virEventPollCalculateTimeout:346 : \
Timeoutat 0 due in -1 ms 2017-02-2105:31:09.242+0000: 125812: debug : \
virEventPollRunOnce:614 : EVENT_POLL_RUN:nhandles=1 timeout=-1 &lt;&lt;hang&gt;&gt;       hereis \
the log snippet of   /var/log/libvirt/libvirtd.log 2017-02-1706:18:26.198+0000: 5052: \
error : daemonStreamHandleAbort:609 : stream abortedat client request \
2017-02-1706:18:41.022+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
aborted atclient request 2017-02-1706:18:56.017+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream abortedat client request \
2017-02-1706:19:11.019+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
abortedat client request 2017-02-1706:19:26.016+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream abortedat client request \
2017-02-1706:19:41.021+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
abortedat client request 2017-02-1706:19:56.014+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream abortedat client request \
2017-02-1706:20:11.021+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
abortedat client request 2017-02-1706:20:26.014+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream abortedat client request \
2017-02-1706:20:41.014+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
abortedat client request 2017-02-1706:20:56.016+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream abortedat client request \
2017-02-1706:21:11.019+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
abortedat client request 2017-02-1706:21:26.018+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream abortedat client request \
2017-02-1706:21:41.022+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
abortedat client request 2017-02-1706:21:56.019+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream abortedat client request \
2017-02-1706:22:11.020+0000: 5052: error : daemonStreamHandleAbort:609 : stream \
abortedat client request 2017-02-17 06:22:26.012+0000:5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request \
2017-02-1801:53:36.308+0000: 5052: warning : virKeepAliveTimerInternal:156 : No \
responsefrom client 0xe14160 after 5 keepalive messages in 30 seconds \
2017-02-1801:53:47.346+0000: 5052: warning : virKeepAliveTimerInternal:156 : No \
responsefrom client 0xe14c70 after 5 keepalive messages in 30 \
seconds/var/log/libvirt/libvirtd.log    What could be theproblem. I am running virsh \
(0.10.2) on RHEL6    Thanks for your help inadvance.    Regards Abhishek     

   


[Attachment #3 (text/html)]

&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;div style="color:#000; background-color:#fff; \
font-family:HelveticaNeue, Helvetica Neue, Helvetica, Arial, Lucida Grande, \
Sans-Serif;font-size:12px"&gt;&lt;div id="yui_3_16_0_ym19_1_1487758637283_3398"&gt;&lt;span \
id="yui_3_16_0_ym19_1_1487758637283_3461"&gt;Thanks Wanglm for your \
responses.&lt;/span&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487758637283_3398"&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487758637283_3398"&gt;Can anyone else has any info about how to \
resolve such problems. Is this an issue fixed in higher version of libvirt ? \
 Here all my virsh commands are hanging which I think due to hang in \
libvirt-daemon.&lt;/div&gt;&lt;div id="yui_3_16_0_ym19_1_1487758637283_3398"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487758637283_3398"&gt;Can restarting libvirt-domain is fine ? \
What all it impacts ?&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487758637283_3398"&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487758637283_3398"&gt;Regards&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487758637283_3398"&gt;Abhishek&lt;/div&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487758637283_3398"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="qtdSeparateBR" \
id="yui_3_16_0_ym19_1_1487758637283_3304"&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="yahoo_quoted" \
id="yui_3_16_0_ym19_1_1487758637283_3354" style="display: block;"&gt;  &lt;div \
style="font-family: HelveticaNeue, Helvetica Neue, Helvetica, Arial, Lucida Grande, \
Sans-Serif; font-size: 12px;" id="yui_3_16_0_ym19_1_1487758637283_3353"&gt; &lt;div \
style="font-family: HelveticaNeue, Helvetica Neue, Helvetica, Arial, Lucida Grande, \
Sans-Serif; font-size: 16px;" id="yui_3_16_0_ym19_1_1487758637283_3352"&gt; &lt;div \
dir="ltr" id="yui_3_16_0_ym19_1_1487758637283_3392"&gt; &lt;font size="2" face="Arial" \
id="yui_3_16_0_ym19_1_1487758637283_3391"&gt; &lt;hr size="1" \
id="yui_3_16_0_ym19_1_1487758637283_3397"&gt; &lt;b&gt;&lt;span \
style="font-weight:bold;"&gt;From:&lt;/span&gt;&lt;/b&gt; 王李明 \
&lt;wanglm@certusnet.com.cn&gt;&lt;br&gt; &lt;b&gt;&lt;span style="font-weight: \
bold;"&gt;To:&lt;/span&gt;&lt;/b&gt; 'abhishek jain' &lt;abhish_jain@yahoo.com&gt;; \
libvirt-users@redhat.com &lt;br&gt; &lt;b&gt;&lt;span style="font-weight: bold;"&gt;Sent:&lt;/span&gt;&lt;/b&gt; \
Tuesday, 21 February 2017 7:06 PM&lt;br&gt; &lt;b&gt;&lt;span style="font-weight: \
bold;"&gt;Subject:&lt;/span&gt;&lt;/b&gt; 答复: 答复: [libvirt-users] Virsh command hanging&lt;br&gt; \
&lt;/font&gt; &lt;/div&gt; &lt;div class="y_msg_container" \
id="yui_3_16_0_ym19_1_1487758637283_3351"&gt;&lt;br&gt;&lt;div id="yiv4132621194"&gt;&lt;style&gt; \
#yiv4132621194 #yiv4132621194 --  
 _filtered #yiv4132621194 {font-family:Helvetica;panose-1:2 11 6 4 2 2 2 2 2 4;}
 _filtered #yiv4132621194 {font-family:宋体;panose-1:2 1 6 0 3 1 1 1 1 1;}
 _filtered #yiv4132621194 {panose-1:2 4 5 3 5 4 6 3 2 4;}
 _filtered #yiv4132621194 {font-family:Calibri;panose-1:2 15 5 2 2 2 4 3 2 4;}
 _filtered #yiv4132621194 {panose-1:2 1 6 0 3 1 1 1 1 1;}
#yiv4132621194  
#yiv4132621194 p.yiv4132621194MsoNormal, #yiv4132621194 li.yiv4132621194MsoNormal, \
#yiv4132621194 div.yiv4132621194MsoNormal  \
{margin:0cm;margin-bottom:.0001pt;font-size:12.0pt;font-family:宋体;} \
#yiv4132621194 a:link, #yiv4132621194 span.yiv4132621194MsoHyperlink  \
{color:blue;text-decoration:underline;} #yiv4132621194 a:visited, #yiv4132621194 \
span.yiv4132621194MsoHyperlinkFollowed  {color:purple;text-decoration:underline;}
#yiv4132621194 p.yiv4132621194msonormal, #yiv4132621194 li.yiv4132621194msonormal, \
#yiv4132621194 div.yiv4132621194msonormal  \
{margin-right:0cm;margin-left:0cm;font-size:12.0pt;font-family:宋体;} \
#yiv4132621194 p.yiv4132621194msochpdefault, #yiv4132621194 \
li.yiv4132621194msochpdefault, #yiv4132621194 div.yiv4132621194msochpdefault  \
{margin-right:0cm;margin-left:0cm;font-size:12.0pt;font-family:宋体;} \
#yiv4132621194 span.yiv4132621194msohyperlink  {}
#yiv4132621194 span.yiv4132621194msohyperlinkfollowed
	{}
#yiv4132621194 span.yiv4132621194emailstyle17
	{}
#yiv4132621194 p.yiv4132621194msonormal1, #yiv4132621194 li.yiv4132621194msonormal1, \
#yiv4132621194 div.yiv4132621194msonormal1  \
{margin:0cm;margin-bottom:.0001pt;font-size:12.0pt;font-family:宋体;} \
#yiv4132621194 span.yiv4132621194msohyperlink1  \
{color:blue;text-decoration:underline;} #yiv4132621194 \
span.yiv4132621194msohyperlinkfollowed1  {color:purple;text-decoration:underline;}
#yiv4132621194 span.yiv4132621194emailstyle171
	{color:black;}
#yiv4132621194 p.yiv4132621194msochpdefault1, #yiv4132621194 \
li.yiv4132621194msochpdefault1, #yiv4132621194 div.yiv4132621194msochpdefault1  \
{margin-right:0cm;margin-left:0cm;font-size:10.0pt;font-family:宋体;} \
#yiv4132621194 span.yiv4132621194EmailStyle27  {color:black;}
#yiv4132621194 .yiv4132621194MsoChpDefault
	{font-size:10.0pt;}
 _filtered #yiv4132621194 {margin:72.0pt 90.0pt 72.0pt 90.0pt;}
#yiv4132621194 div.yiv4132621194Section1
	{}
#yiv4132621194 
&lt;/style&gt;&lt;div id="yui_3_16_0_ym19_1_1487758637283_3350"&gt;

&lt;div class="yiv4132621194Section1" id="yui_3_16_0_ym19_1_1487758637283_3349"&gt;

&lt;div class="yiv4132621194MsoNormal" id="yui_3_16_0_ym19_1_1487758637283_3390"&gt;&lt;span \
lang="EN-US" style="" id="yui_3_16_0_ym19_1_1487758637283_3389"&gt;I don't know whether \
this is a bug&lt;/span&gt;&lt;/div&gt; 

&lt;div class="yiv4132621194MsoNormal" id="yui_3_16_0_ym19_1_1487758637283_3463"&gt;&lt;span \
lang="EN-US" style="" id="yui_3_16_0_ym19_1_1487758637283_3462"&gt;because I have tried \
a lot of method to soluted this problem&lt;/span&gt;&lt;/div&gt; 

&lt;div class="yiv4132621194MsoNormal"&gt;&lt;span lang="EN-US" style=""&gt;but I alway \
failed&lt;/span&gt;&lt;/div&gt; 

&lt;div class="yiv4132621194MsoNormal"&gt;&lt;span lang="EN-US" style=""&gt;at last I have to \
upgrade our os version &lt;/span&gt;&lt;/div&gt; 

&lt;div class="yiv4132621194MsoNormal" id="yui_3_16_0_ym19_1_1487758637283_3464"&gt;&lt;span \
lang="EN-US" style=""&gt;  &lt;/span&gt;&lt;/div&gt; 

&lt;div class="yiv4132621194yqt3919072664" id="yiv4132621194yqt25429"&gt;&lt;div \
id="yui_3_16_0_ym19_1_1487758637283_3469"&gt;

&lt;div style="border:none;border-top:solid #B5C4DF 1.0pt;padding:3.0pt 0cm 0cm 0cm;" \
id="yui_3_16_0_ym19_1_1487758637283_3468"&gt;

&lt;div class="yiv4132621194MsoNormal" \
id="yui_3_16_0_ym19_1_1487758637283_3467"&gt;&lt;b&gt;&lt;span \
style="font-size:10.0pt;"&gt;发件人&lt;span lang="EN-US"&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;span \
lang="EN-US" style="font-size:10.0pt;"&gt; abhishek jain [mailto:abhish_jain@yahoo.com] \
&lt;br clear="none"&gt; &lt;/span&gt;&lt;b&gt;&lt;span style="font-size:10.0pt;"&gt;发送时间&lt;span \
lang="EN-US"&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US" style="font-size:10.0pt;"&gt; \
2017&lt;/span&gt;&lt;span style="font-size:10.0pt;" \
id="yui_3_16_0_ym19_1_1487758637283_3466"&gt;年&lt;span lang="EN-US"&gt;2&lt;/span&gt;月&lt;span \
lang="EN-US"&gt;21&lt;/span&gt;日&lt;span lang="EN-US"&gt; 21:33&lt;br clear="none"&gt; \
&lt;/span&gt;&lt;b&gt;收件人&lt;span lang="EN-US"&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US" \
id="yui_3_16_0_ym19_1_1487758637283_3465"&gt; &lt;/span&gt;王李明&lt;span lang="EN-US"&gt;; \
libvirt-users@redhat.com&lt;br clear="none"&gt; &lt;/span&gt;&lt;b&gt;主题&lt;span \
lang="EN-US"&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US"&gt; Re: &lt;/span&gt;答复&lt;span lang="EN-US"&gt;: \
[libvirt-users] Virsh command hanging&lt;/span&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div class="yiv4132621194MsoNormal"&gt;&lt;span lang="EN-US"&gt;  &lt;/span&gt;&lt;/div&gt; 

&lt;div id="yui_3_16_0_ym19_1_1487758637283_3348"&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3770"&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;" \
id="yui_3_16_0_ym19_1_1487758637283_3470"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;I can only use RHEL6.&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3771"&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;  &lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3773"&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;" \
id="yui_3_16_0_ym19_1_1487758637283_3471"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;Is it a bug in libvirt ??&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3774"&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;  &lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3779"&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;" \
id="yui_3_16_0_ym19_1_1487758637283_3388"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;Regards&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3780"&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;" \
id="yui_3_16_0_ym19_1_1487758637283_3347"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;Abhishek&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3781"&gt;

&lt;div class="yiv4132621194MsoNormal" \
style="margin-bottom:12.0pt;background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;  &lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3786"&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3785"&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3784"&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3783"&gt;

&lt;div align="center" class="yiv4132621194MsoNormal" \
style="text-align:center;background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:10.0pt;"&gt;

&lt;/span&gt;&lt;hr align="center" size="1" width="100%"&gt;

&lt;/div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;b&gt;&lt;span lang="EN-US" \
style="font-size:10.0pt;"&gt;From:&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US" \
style="font-size:10.0pt;"&gt; &lt;/span&gt;&lt;span \
style="font-size:10.0pt;color:black;"&gt;王李明&lt;/span&gt;&lt;span lang="EN-US" \
style="font-size:10.0pt;"&gt; &lt;wanglm@certusnet.com.cn&gt;&lt;br clear="none"&gt;
&lt;b&gt;To:&lt;/b&gt; 'abhishek jain' &lt;abhish_jain@yahoo.com&gt;;
libvirt-users@redhat.com &lt;br clear="none"&gt;
&lt;b&gt;Sent:&lt;/b&gt; Tuesday, 21 February 2017 11:54 AM&lt;br clear="none"&gt;
&lt;b&gt;Subject:&lt;/b&gt; &lt;/span&gt;&lt;span style="font-size:10.0pt;color:black;"&gt;答复&lt;/span&gt;&lt;span \
lang="EN-US" style="font-size:10.0pt;"&gt;: [libvirt-users] Virsh command \
hanging&lt;/span&gt;&lt;span lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3787"&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style=""&gt;  &lt;/span&gt;&lt;/div&gt; 

&lt;div id="yiv4132621194"&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3791"&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3790"&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3789"&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style=""&gt;I have this problem in centos6.5&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3793"&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style=""&gt;when I upgrade to centos 7.1 this problem is soluted&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3795"&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style=""&gt;maybe you can upgrade your os version&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3797"&gt;

&lt;div class="yiv4132621194MsoNormal" \
style="text-align:justify;text-justify:inter-ideograph;background:white;"&gt;&lt;span \
lang="EN-US" style="font-size:10.5pt;"&gt; &lt;/span&gt;&lt;span lang="EN-US" \
style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;div class="yiv4132621194MsoNormal" \
style="text-align:justify;text-justify:inter-ideograph;background:white;"&gt;&lt;span \
lang="EN-US" style="font-size:10.5pt;"&gt; &lt;/span&gt;&lt;span lang="EN-US" \
style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3799"&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style=""&gt; &lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv4132621194yqt06297"&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3803"&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3802" \
style="border:none;border-top:solid #B5C4DF 1.0pt;padding:3.0pt 0cm 0cm 0cm;"&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3801"&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;b&gt;&lt;span \
style="font-size:10.0pt;color:black;"&gt;发件人&lt;/span&gt;&lt;/b&gt;&lt;b&gt;&lt;span lang="EN-US" \
style="font-size:10.0pt;"&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US" style="font-size:10.0pt;"&gt; \
libvirt-users-bounces@redhat.com [mailto:libvirt-users-bounces@redhat.com] \
&lt;/span&gt;&lt;b&gt;&lt;span style="font-size:10.0pt;color:black;"&gt;代表&lt;/span&gt;&lt;/b&gt;&lt;b&gt;&lt;span \
style="font-size:10.0pt;"&gt; &lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US" \
style="font-size:10.0pt;"&gt;abhishek jain&lt;br clear="none"&gt; &lt;/span&gt;&lt;b&gt;&lt;span \
style="font-size:10.0pt;color:black;"&gt;发送时间&lt;/span&gt;&lt;/b&gt;&lt;b&gt;&lt;span lang="EN-US" \
style="font-size:10.0pt;"&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US" style="font-size:10.0pt;"&gt; \
2017&lt;/span&gt;&lt;span style="font-size:10.0pt;color:black;"&gt;年&lt;/span&gt;&lt;span lang="EN-US" \
style="font-size:10.0pt;"&gt;2&lt;/span&gt;&lt;span \
style="font-size:10.0pt;color:black;"&gt;月&lt;/span&gt;&lt;span lang="EN-US" \
style="font-size:10.0pt;"&gt;21&lt;/span&gt;&lt;span \
style="font-size:10.0pt;color:black;"&gt;日&lt;/span&gt;&lt;span lang="EN-US" \
style="font-size:10.0pt;"&gt; 13:51&lt;br clear="none"&gt; &lt;/span&gt;&lt;b&gt;&lt;span \
style="font-size:10.0pt;color:black;"&gt;收件人&lt;/span&gt;&lt;/b&gt;&lt;b&gt;&lt;span lang="EN-US" \
style="font-size:10.0pt;"&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US" style="font-size:10.0pt;"&gt; \
libvirt-users@redhat.com&lt;br clear="none"&gt; &lt;/span&gt;&lt;b&gt;&lt;span \
style="font-size:10.0pt;color:black;"&gt;主题&lt;/span&gt;&lt;/b&gt;&lt;b&gt;&lt;span lang="EN-US" \
style="font-size:10.0pt;"&gt;:&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US" style="font-size:10.0pt;"&gt; \
[libvirt-users] Virsh command hanging&lt;/span&gt;&lt;span lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; \


&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3807"&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style=""&gt; &lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3809"&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3018"&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3808"&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;Hi,&lt;/span&gt;&lt;span lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3018"&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3810"&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt; &lt;/span&gt;&lt;span lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3018"&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3812"&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;I started the VMs with libvirt 3 days ago (17th Feb). \
 Now when I am trying to shutdown the domain, all my virsh command is hanging \
even  virt-manager remains in "connecting.."  mode and is not showing \
active domains.&lt;/span&gt;&lt;span lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3018"&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3813"&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;When   I set  the libvirt debug env and call \
"virsh list"  it hangs in poll. Here is the log&lt;/span&gt;&lt;span lang="EN-US" \
style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3203"&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3815"&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;setenv LIBVIRT_DEBUG 1 virsh list&lt;/span&gt;&lt;span lang="EN-US" \
style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3205"&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487683874205_3817"&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
                style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.241+0000:
125812: debug : virEventPollCalculateTimeout:320 : Calculate expiry of 0 \
timers&lt;/span&gt;&lt;span lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3207"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.241+0000: 125811: debug : \
                virEventPollUpdateHandle:146 :
EVENT_POLL_UPDATE_HANDLE: watch=2 events=0&lt;/span&gt;&lt;span lang="EN-US" \
style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3209"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.241+0000: 125812: debug : \
virEventPollCalculateTimeout:346 : Timeout at 0 due in -1 ms&lt;/span&gt;&lt;span lang="EN-US" \
style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3211"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.241+0000: 125812: debug : \
virEventPollRunOnce:614 : EVENT_POLL_RUN: nhandles=2 timeout=-1&lt;/span&gt;&lt;span \
lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3213"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.241+0000: 125811: debug : \
virEventPollInterruptLocked:701 : Interrupting&lt;/span&gt;&lt;span lang="EN-US" \
style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3215"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.241+0000: 125812: debug : \
virEventPollRunOnce:625 : Poll got 1 event(s)&lt;/span&gt;&lt;span lang="EN-US" \
style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3217"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollDispatchTimeouts:410 : Dispatch 0&lt;/span&gt;&lt;span lang="EN-US" \
style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3219"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollDispatchHandles:455 : Dispatch 2&lt;/span&gt;&lt;span lang="EN-US" \
style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3221"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollDispatchHandles:469 : i=0 w=1&lt;/span&gt;&lt;span lang="EN-US" \
style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3223"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
                virEventPollDispatchHandles:483 :
EVENT_POLL_DISPATCH_HANDLE: watch=1 events=1&lt;/span&gt;&lt;span lang="EN-US" \
style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3225"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollCleanupTimeouts:501 : Cleanup 0&lt;/span&gt;&lt;span lang="EN-US" \
style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3227"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollCleanupTimeouts:537 : Found 0 out of 0 timeout slots used, releasing \
0&lt;/span&gt;&lt;span lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3229"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollCleanupHandles:549 : Cleanup 2&lt;/span&gt;&lt;span lang="EN-US" \
style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3231"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventRunDefaultImpl:244 : running default event implementation&lt;/span&gt;&lt;span \
lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3233"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollCleanupTimeouts:501 : Cleanup 0&lt;/span&gt;&lt;span lang="EN-US" \
style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3235"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollCleanupTimeouts:537 : Found 0 out of 0 timeout slots used, releasing \
0&lt;/span&gt;&lt;span lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3237"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollCleanupHandles:549 : Cleanup 2&lt;/span&gt;&lt;span lang="EN-US" \
style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3239"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollMakePollFDs:378 : Prepare n=0 w=1, f=4 e=1 d=0&lt;/span&gt;&lt;span lang="EN-US" \
style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3241"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollMakePollFDs:378 : Prepare n=1 w=2, f=6 e=0 d=0&lt;/span&gt;&lt;span lang="EN-US" \
style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3243"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollCalculateTimeout:320 : Calculate expiry of 0 timers&lt;/span&gt;&lt;span \
lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3245"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollCalculateTimeout:346 : Timeout at 0 due in -1 ms&lt;/span&gt;&lt;span lang="EN-US" \
style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3247"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;b&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-21 05:31:09.242+0000: 125812: debug : \
virEventPollRunOnce:614 : EVENT_POLL_RUN: nhandles=1 timeout=-1 \
&lt;&lt;hang&gt;&gt;&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3247"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt; &lt;/span&gt;&lt;span lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3247"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt; &lt;/span&gt;&lt;span lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3247"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;b&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;here is the log snippet of \
 /var/log/libvirt/libvirtd.log&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US" \
style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3397"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:18:26.198+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;span \
lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3399"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:18:41.022+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;span \
lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3401"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:18:56.017+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;span \
lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3403"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:19:11.019+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;span \
lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3405"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:19:26.016+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;span \
lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3407"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:19:41.021+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;span \
lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3409"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:19:56.014+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;span \
lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3411"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:20:11.021+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;span \
lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3413"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:20:26.014+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;span \
lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3415"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:20:41.014+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;span \
lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3417"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:20:56.016+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;span \
lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3419"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:21:11.019+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;span \
lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3421"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:21:26.018+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;span \
lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3423"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:21:41.022+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;span \
lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3425"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:21:56.019+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;span \
lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3427"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-17 06:22:11.020+0000: 5052: error : \
daemonStreamHandleAbort:609 : stream aborted at client request&lt;/span&gt;&lt;span \
lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3429"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
                style="font-size:9.0pt;"&gt;2017-02-17 06:22:26.012+0000:
5052: error : daemonStreamHandleAbort:609 : stream aborted at client \
request&lt;/span&gt;&lt;span lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3431"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-18 01:53:36.308+0000: 5052: warning : \
virKeepAliveTimerInternal:156 : No response from client 0xe14160 after 5 keepalive \
messages in 30 seconds&lt;/span&gt;&lt;span lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;b&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;2017-02-18 01:53:47.346+0000: 5052: warning : \
virKeepAliveTimerInternal:156 : No response from client 0xe14c70 after 5 keepalive \
                messages in 30 seconds
/var/log/libvirt/libvirtd.log&lt;/span&gt;&lt;/b&gt;&lt;span lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt; &lt;/span&gt;&lt;span lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;What could be the problem. I am running virsh (0.10.2) on \
RHEL6&lt;/span&gt;&lt;span lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt; &lt;/span&gt;&lt;span lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;Thanks for your help in advance.&lt;/span&gt;&lt;span lang="EN-US" \
style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt; &lt;/span&gt;&lt;span lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;Regards&lt;/span&gt;&lt;span lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;div id="yiv4132621194yui_3_16_0_ym19_1_1487655384351_3433"&gt;

&lt;div&gt;

&lt;div class="yiv4132621194MsoNormal" style="background:white;"&gt;&lt;span lang="EN-US" \
style="font-size:9.0pt;"&gt;Abhishek&lt;/span&gt;&lt;span lang="EN-US" style=""&gt;&lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;div class="yiv4132621194MsoNormal" \
style="margin-bottom:12.0pt;background:white;"&gt;&lt;span lang="EN-US" style=""&gt; \
 &lt;/span&gt;&lt;/div&gt; 

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;



</body></email><email><emailId>20170222113129</emailId><senderName>Jiri Denemark</senderName><senderEmail>jdenemar@redhat.com</senderEmail><timestampReceived>2017-02-22 11:31:29-0400</timestampReceived><subject>Re: [libvirt-users] Determining domain job kind from job stats?</subject><body>

On Tue, Feb 21, 2017 at 15:38:22 +0100, Milan Zamazal wrote:
&gt; [Starting to move to the development list.]
&gt; 
&gt; Milan Zamazal &lt;mzamazal@redhat.com&gt; writes:
&gt; 
&gt; &gt; Jiri Denemark &lt;jdenemar@redhat.com&gt; writes:
&gt; &gt;
&gt; &gt;&gt; On Fri, Feb 17, 2017 at 12:38:24 +0100, Milan Zamazal wrote:
&gt; &gt;&gt;&gt; 
&gt; &gt;&gt;&gt; There are basically two problems:
&gt; &gt;&gt;&gt; 
&gt; &gt;&gt;&gt; - When the job completion callback is called, I need to distinguish what
&gt; &gt;&gt;&gt;   kind of job was it to perform the appropriate actions.  It would be
&gt; &gt;&gt;&gt;   easier if I knew the job type directly in the callback (no need to
&gt; &gt;&gt;&gt;   coordinate anything), but "external" job tracking is also possible.
&gt; &gt;&gt;
&gt; &gt;&gt; An immediate answer would be: "don't rely on the completion callback and
&gt; &gt;&gt; just check the return value of the API which started the job", but I
&gt; &gt;&gt; guess you want it because checking the return value is not possible when
&gt; &gt;&gt; the process which started the job is not running anymore as described
&gt; &gt;&gt; below.
&gt; &gt;
&gt; &gt; Well, avoiding using the completion callback is probably OK for me.
&gt; 
&gt; Thinking about it more, it's not very nice: I have to use the callback
&gt; to get the completed job stats (I'm not guaranteed the domain still
&gt; exists on the source host when I ask it for the stats explicitly) *and*
&gt; to track the jobs outside the callback to know whether the callback is
&gt; related to the type of domain jobs I'm going to handle.
&gt; 
&gt; Although not absolutely necessary, it would be much nicer if the job
&gt; type was identified in the callback.

The job completed event uses type parameters so adding a new parameter
describing the just completed job should not be a problem.

Jirka

</body></email><email><emailId>20170227081231</emailId><senderName>Dan Johansson</senderName><senderEmail>kvm@dmj.nu</senderEmail><timestampReceived>2017-02-27 08:12:31-0400</timestampReceived><subject>[libvirt-users] shutdown -r now hangs in qemu-/kvm-vm</subject><body>

Since updating app-emulation/libvirt and/or app-emulation/qemu (both
were updated at the same time) I have a problem executing "shutdown -r
now" in the vm ("shutdown -h now" works fine).

When I execute "shutdown -r now" in the vm the shutdown process runs
perfect until "Remounting root-filesystem readonly" and than it hangs
and I have to "Force Power Off" to reboot.

Any suggestion what could be wrong and what I can do to solve it?

-- 
Dan Johansson,
***************************************************
This message is printed on 100% recycled electrons!
***************************************************

</body></email><email><emailId>20170227134444</emailId><senderName></senderName><senderEmail>youssef.elfathi@orange.com</senderEmail><timestampReceived>2017-02-27 13:44:44-0400</timestampReceived><subject>[libvirt-users] Redhat 7: cgroup CPUACCT controller is not mounted</subject><body>

Hi,

With a non-root user account, I am launching virtual machines and would like to get \
CPU stats for each Core (using python API or not) but face the following problem:

- When I issue the command "virsh --readonly cpu-stats MY_DOMAIN" I got the following \
error:

error: Failed to retrieve CPU statistics for domain 'MY_DOMAIN'
error: Requested operation is not valid: cgroup CPUACCT controller is not mounted

- I checked that cgroup is well mounted:

$ cat /proc/mounts | grep cgroup
tmpfs /sys/fs/cgroup tmpfs ro,nosuid,nodev,noexec,mode=755 0 0 cgroup \
/sys/fs/cgroup/systemd cgroup \
rw,nosuid,nodev,noexec,relatime,xattr,release_agent=/usr/lib/systemd/systemd-cgroups-agent,name=systemd \
0 0 cgroup /sys/fs/cgroup/devices cgroup rw,nosuid,nodev,noexec,relatime,devices 0 0 \
cgroup /sys/fs/cgroup/hugetlb cgroup rw,nosuid,nodev,noexec,relatime,hugetlb 0 0 \
cgroup /sys/fs/cgroup/pids cgroup rw,nosuid,nodev,noexec,relatime,pids 0 0 cgroup \
/sys/fs/cgroup/freezer cgroup rw,nosuid,nodev,noexec,relatime,freezer 0 0 cgroup \
/sys/fs/cgroup/cpuset cgroup rw,nosuid,nodev,noexec,relatime,cpuset 0 0 cgroup \
/sys/fs/cgroup/cpu,cpuacct cgroup rw,nosuid,nodev,noexec,relatime,cpuacct,cpu 0 0 \
cgroup /sys/fs/cgroup/net_cls,net_prio cgroup \
rw,nosuid,nodev,noexec,relatime,net_prio,net_cls 0 0 cgroup /sys/fs/cgroup/perf_event \
cgroup rw,nosuid,nodev,noexec,relatime,perf_event 0 0 cgroup /sys/fs/cgroup/blkio \
cgroup rw,nosuid,nodev,noexec,relatime,blkio 0 0 cgroup /sys/fs/cgroup/memory cgroup \
rw,nosuid,nodev,noexec,relatime,memory 0 0

$ cat /proc/cgroups 
#subsys_name    hierarchy       num_cgroups     enabled
cpuset  6       1       1
cpu     7       1       1
cpuacct 7       1       1
memory  11      1       1
devices 2       1       1
freezer 5       1       1
net_cls 8       1       1
blkio   10      1       1
perf_event      9       1       1
hugetlb 3       1       1
pids    4       1       1
net_prio        8       1       1

- I checked the system-cgtop but don't have no CPU info for my VMs (first line \
starting with /):

Path                                                                                  \
Tasks   %CPU   Memory  Input/s Output/s

/                                                                                     \
332  808.0    21.3G        -        - /system.slice/auditd.service                    \
1      -        -        -        - /system.slice/crond.service                       \
1      -        -        -        - /system.slice/dbus.service                        \
1      -        -        -        - /system.slice/gssproxy.service                    \
1      -        -        -        - /system.slice/irqbalance.service                  \
1      -        -        -        - /system.slice/ksmtuned.service                    \
2      -        -        -        - /system.slice/libvirtd.service                    \
1      -        -        -        - /system.slice/lvm2-lvmetad.service                \
1      -        -        -        - /system.slice/polkit.service                      \
1      -        -        -        - /system.slice/rhnsd.service                       \
1      -        -        -        - /system.slice/rhsmcertd.service                   \
1      -        -        -        - /system.slice/rsyslog.service                     \
1      -        -        -        - /system.slice/sshd.service                        \
1      -        -        -        - \
/system.slice/system-getty.slice/getty@tty1.service                                   \
1      -        -        -        - /system.slice/systemd-journald.service            \
1      -        -        -        - /system.slice/systemd-logind.service              \
1      -        -        -        - /system.slice/systemd-udevd.service               \
1      -        -        -        - /system.slice/tuned.service                       \
1      -        -        -        - /user.slice/user-3972.slice/session-15191.scope   \
3      -        -        -        - /user.slice/user-3972.slice/session-16005.scope   \
4      -        -        -        - /user.slice/user-3972.slice/session-16019.scope   \
10      -        -        -        -

Thanks by advance for your help!

Regards,

Youssef

_________________________________________________________________________________________________________________________


Ce message et ses pieces jointes peuvent contenir des informations confidentielles ou \
privilegiees et ne doivent donc pas etre diffuses, exploites ou copies sans \
autorisation. Si vous avez recu ce message par erreur, veuillez le signaler a \
l'expediteur et le detruire ainsi que les pieces jointes. Les messages electroniques \
etant susceptibles d'alteration, Orange decline toute responsabilite si ce message a \
ete altere, deforme ou falsifie. Merci.

This message and its attachments may contain confidential or privileged information \
that may be protected by law; they should not be distributed, used or copied without \
authorisation. If you have received this email in error, please notify the sender and \
delete this message and its attachments. As emails may be altered, Orange is not \
liable for messages that have been modified, changed or falsified. Thank you.


</body></email><email><emailId>20170228151742</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-02-28 15:17:42-0400</timestampReceived><subject>Re: [libvirt-users] Redhat 7: cgroup CPUACCT controller is not mounted</subject><body>


On Mon, Feb 27, 2017 at 01:44:44PM +0000, youssef.elfathi@orange.com wrote:
&gt; Hi,
&gt; 
&gt; With a non-root user account, I am launching virtual machines and would like to get \
&gt; CPU stats for each Core (using python API or not) but face the following problem: 
&gt; - When I issue the command "virsh --readonly cpu-stats MY_DOMAIN" I got the \
&gt; following error: 
&gt; error: Failed to retrieve CPU statistics for domain 'MY_DOMAIN'
&gt; error: Requested operation is not valid: cgroup CPUACCT controller is not mounted
&gt; 

Since you are running the domain in session mode (non-root), libvirtd
doesn't have the privileges for creating a mount point for the domain
and hence the controller is available to use.  So I guess it's just a
matter of the error message being ambiguous.


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170228152254</emailId><senderName></senderName><senderEmail>youssef.elfathi@orange.com</senderEmail><timestampReceived>2017-02-28 15:22:54-0400</timestampReceived><subject>Re: [libvirt-users] Redhat 7: cgroup CPUACCT controller is not mounted</subject><body>

Thanks Martin to confirm that the issue is due to privilege access. How can I run a \
domain as non-root and be able to access the cpu information?

-----Original Message-----
From: Martin Kletzander [mailto:mkletzan@redhat.com] 
Sent: Tuesday, February 28, 2017 16:18
To: EL FATHI Youssef OBS/OINIS
Cc: libvirt-users@redhat.com
Subject: Re: [libvirt-users] Redhat 7: cgroup CPUACCT controller is not mounted

On Mon, Feb 27, 2017 at 01:44:44PM +0000, youssef.elfathi@orange.com wrote:
&gt; Hi,
&gt; 
&gt; With a non-root user account, I am launching virtual machines and would like to get \
&gt; CPU stats for each Core (using python API or not) but face the following problem: 
&gt; - When I issue the command "virsh --readonly cpu-stats MY_DOMAIN" I got the \
&gt; following error: 
&gt; error: Failed to retrieve CPU statistics for domain 'MY_DOMAIN'
&gt; error: Requested operation is not valid: cgroup CPUACCT controller is 
&gt; not mounted
&gt; 

Since you are running the domain in session mode (non-root), libvirtd doesn't have \
the privileges for creating a mount point for the domain and hence the controller is \
available to use.  So I guess it's just a matter of the error message being \
ambiguous.

_________________________________________________________________________________________________________________________


Ce message et ses pieces jointes peuvent contenir des informations confidentielles ou \
privilegiees et ne doivent donc pas etre diffuses, exploites ou copies sans \
autorisation. Si vous avez recu ce message par erreur, veuillez le signaler a \
l'expediteur et le detruire ainsi que les pieces jointes. Les messages electroniques \
etant susceptibles d'alteration, Orange decline toute responsabilite si ce message a \
ete altere, deforme ou falsifie. Merci.

This message and its attachments may contain confidential or privileged information \
that may be protected by law; they should not be distributed, used or copied without \
authorisation. If you have received this email in error, please notify the sender and \
delete this message and its attachments. As emails may be altered, Orange is not \
liable for messages that have been modified, changed or falsified. Thank you.


</body></email><email><emailId>20170228180704</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-02-28 18:07:04-0400</timestampReceived><subject>Re: [libvirt-users] Redhat 7: cgroup CPUACCT controller is not mounted</subject><body>


On Tue, Feb 28, 2017 at 03:22:54PM +0000, youssef.elfathi@orange.com wrote:
&gt; Thanks Martin to confirm that the issue is due to privilege access. How can I run a \
&gt; domain as non-root and be able to access the cpu information? 

You need to use the system libvirt daemon, so you need to connect to
qemu:///system instead of qemu:///session.  Good write-up about the
differences is here:

  http://blog.wikichoon.com/2016/01/qemusystem-vs-qemusession.html

There are also links to more info.


["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170227085738</emailId><senderName>Han Han</senderName><senderEmail>hhan@redhat.com</senderEmail><timestampReceived>2017-02-27 08:57:38-0400</timestampReceived><subject>Re: [libvirt-users] shutdown -r now hangs in qemu-/kvm-vm</subject><body>

Please provide more info about the issue, such as your libvirt/qemu
version, your host OS version,
your VM OS version, your VM xml.

Thanks.

On Mon, Feb 27, 2017 at 4:12 PM, Dan Johansson &lt;kvm@dmj.nu&gt; wrote:

&gt; Since updating app-emulation/libvirt and/or app-emulation/qemu (both
&gt; were updated at the same time) I have a problem executing "shutdown -r
&gt; now" in the vm ("shutdown -h now" works fine).
&gt;
&gt; When I execute "shutdown -r now" in the vm the shutdown process runs
&gt; perfect until "Remounting root-filesystem readonly" and than it hangs
&gt; and I have to "Force Power Off" to reboot.
&gt;
&gt; Any suggestion what could be wrong and what I can do to solve it?
&gt;
&gt; --
&gt; Dan Johansson,
&gt; ***************************************************
&gt; This message is printed on 100% recycled electrons!
&gt; ***************************************************
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Please provide more info about the issue, such as your libvirt/qemu \
version, your host OS version, &lt;br&gt;your VM OS version, your VM \
xml.&lt;br&gt;&lt;br&gt;Thanks.&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;On \
Mon, Feb 27, 2017 at 4:12 PM, Dan Johansson &lt;span dir="ltr"&gt;&lt;&lt;a \
href="mailto:kvm@dmj.nu" target="_blank"&gt;kvm@dmj.nu&lt;/a&gt;&gt;&lt;/span&gt; \
wrote:&lt;br&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px \
#ccc solid;padding-left:1ex"&gt;Since updating app-emulation/libvirt and/or \
app-emulation/qemu (both&lt;br&gt; were updated at the same time) I have a problem \
executing "shutdown -r&lt;br&gt; now" in the vm ("shutdown -h now" \
works fine).&lt;br&gt; &lt;br&gt;
When I execute "shutdown -r now" in the vm the shutdown process runs&lt;br&gt;
perfect until "Remounting root-filesystem readonly" and than it hangs&lt;br&gt;
and I have to "Force Power Off" to reboot.&lt;br&gt;
&lt;br&gt;
Any suggestion what could be wrong and what I can do to solve it?&lt;span \
class="HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;br&gt; &lt;br&gt;
-- &lt;br&gt;
Dan Johansson,&lt;br&gt;
******************************&lt;wbr&gt;*********************&lt;br&gt;
This message is printed on 100% recycled electrons!&lt;br&gt;
******************************&lt;wbr&gt;*********************&lt;br&gt;
&lt;br&gt;
______________________________&lt;wbr&gt;_________________&lt;br&gt;
libvirt-users mailing list&lt;br&gt;
&lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt; \
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170224160343</emailId><senderName>Yunchih Chen</senderName><senderEmail>yunchih@csie.ntu.edu.tw</senderEmail><timestampReceived>2017-02-24 16:03:43-0400</timestampReceived><subject>Re: [libvirt-users] "virsh list" hangs</subject><body>



On 02/24/2017 11:59 PM, Daniel P. Berrange wrote:
&gt; On Fri, Feb 24, 2017 at 11:52:43PM +0800, Yunchih Chen wrote:
&gt;&gt;
&gt;&gt; On 02/24/2017 11:30 PM, Daniel P. Berrange wrote:
&gt;&gt;&gt; On Tue, Feb 21, 2017 at 12:07:41PM +0800, Yunchih Chen wrote:
&gt;&gt;&gt;&gt; On 02/20/2017 09:10 PM, Michal Privoznik wrote:
&gt;&gt;&gt;&gt;&gt; On 17.02.2017 17:18, Yunchih Chen wrote:
&gt;&gt;&gt;&gt;&gt;&gt; `virsh list` hangs on my server that hosts a bunch of VMs.
&gt;&gt;&gt;&gt;&gt;&gt; This might be due to the Debian upgrade I did on Feb 15, which upgrades
&gt;&gt;&gt;&gt;&gt;&gt; `libvirt` from 2.4.0-1 to 3.0.0-2.
&gt;&gt;&gt;&gt;&gt;&gt; I have tried restarting libvirtd for a few times, without luck.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Attached below are some relevant logs; let me know if you need some more
&gt;&gt;&gt;&gt;&gt;&gt; for debugging.
&gt;&gt;&gt;&gt;&gt;&gt; Thanks for your help!!
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; root@vm-host:~# uname -a
&gt;&gt;&gt;&gt;&gt;&gt; Linux vm-host 4.6.0-1-amd64 #1 SMP Debian 4.6.4-1 (2016-07-18) x86_64
&gt;&gt;&gt;&gt;&gt;&gt; GNU/Linux
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; root@vm-host:~# apt-cache policy libvirt-daemon
&gt;&gt;&gt;&gt;&gt;&gt; libvirt-daemon:
&gt;&gt;&gt;&gt;&gt;&gt;      Installed: 3.0.0-2
&gt;&gt;&gt;&gt;&gt;&gt;      Candidate: 3.0.0-2
&gt;&gt;&gt;&gt;&gt;&gt;      Version table:
&gt;&gt;&gt;&gt;&gt;&gt;     *** 3.0.0-2 500
&gt;&gt;&gt;&gt;&gt;&gt;            500 http://debian.csie.ntu.edu.tw/debian testing/main amd64
&gt;&gt;&gt;&gt;&gt;&gt; Packages
&gt;&gt;&gt;&gt;&gt;&gt;            100 /var/lib/dpkg/status
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; root@vm-host:~# strace -o /tmp/trace -e trace=network,file,poll virsh
&gt;&gt;&gt;&gt;&gt;&gt; list  # hangs forever .....
&gt;&gt;&gt;&gt;&gt;&gt; ^C
&gt;&gt;&gt;&gt;&gt;&gt; root@vm-host:~# tail -10 /tmp/trace
&gt;&gt;&gt;&gt;&gt;&gt; access("/etc/libvirt/libvirt.conf", F_OK) = 0
&gt;&gt;&gt;&gt;&gt;&gt; open("/etc/libvirt/libvirt.conf", O_RDONLY) = 5
&gt;&gt;&gt;&gt;&gt;&gt; access("/proc/vz", F_OK)                = -1 ENOENT (No such file or
&gt;&gt;&gt;&gt;&gt;&gt; directory)
&gt;&gt;&gt;&gt;&gt;&gt; socket(AF_UNIX, SOCK_STREAM, 0)         = 5
&gt;&gt;&gt;&gt;&gt;&gt; connect(5, {sa_family=AF_UNIX,
&gt;&gt;&gt;&gt;&gt;&gt; sun_path="/var/run/libvirt/libvirt-sock"}, 110) = 0
&gt;&gt;&gt;&gt;&gt;&gt; getsockname(5, {sa_family=AF_UNIX}, [128-&gt;2]) = 0
&gt;&gt;&gt;&gt;&gt;&gt; poll([{fd=5, events=POLLOUT}, {fd=6, events=POLLIN}], 2, -1) = 1
&gt;&gt;&gt;&gt;&gt;&gt; ([{fd=5, revents=POLLOUT}])
&gt;&gt;&gt;&gt;&gt;&gt; poll([{fd=5, events=POLLIN}, {fd=6, events=POLLIN}], 2, -1) = ?
&gt;&gt;&gt;&gt;&gt;&gt; ERESTART_RESTARTBLOCK (Interrupted by signal)
&gt;&gt;&gt;&gt;&gt;&gt; --- SIGINT {si_signo=SIGINT, si_code=SI_KERNEL} ---
&gt;&gt;&gt;&gt;&gt;&gt; +++ killed by SIGINT +++
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; root@vm-host:~# lsof /var/run/libvirt/libvirt-sock # hangs too ...
&gt;&gt;&gt;&gt;&gt; This is very suspicious. Looks like the daemon is in some weird state
&gt;&gt;&gt;&gt;&gt; and hence virsh is unable to get list of domains.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; # ps axf | grep libvirtd
&gt;&gt;&gt;&gt;&gt; # gdb -p $(pgrep libvirtd)
&gt;&gt;&gt;&gt;&gt; (gdb) t a a bt
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; if you could run those commands and share the output that might shed
&gt;&gt;&gt;&gt;&gt; more light.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Michal
&gt;&gt;&gt;&gt; Unfortunately, gdb also hangs when attaching to libvirt ....
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; root@vm-host:~# gdb -q -p $(pgrep libvirtd)
&gt;&gt;&gt;&gt; Attaching to process 9556
&gt;&gt;&gt;&gt; [New LWP 9557]
&gt;&gt;&gt;&gt; [New LWP 9558]
&gt;&gt;&gt;&gt; [New LWP 9559]
&gt;&gt;&gt;&gt; [New LWP 9560]
&gt;&gt;&gt;&gt; [New LWP 9561]
&gt;&gt;&gt;&gt; [New LWP 9562]
&gt;&gt;&gt;&gt; [New LWP 9563]
&gt;&gt;&gt;&gt; [New LWP 9564]
&gt;&gt;&gt;&gt; [New LWP 9565]
&gt;&gt;&gt;&gt; [New LWP 9566]
&gt;&gt;&gt;&gt; [New LWP 9567]
&gt;&gt;&gt;&gt; [New LWP 9568]
&gt;&gt;&gt;&gt; [New LWP 9569]
&gt;&gt;&gt;&gt; [New LWP 9570]
&gt;&gt;&gt;&gt; [New LWP 9571]
&gt;&gt;&gt;&gt; [New LWP 9572]
&gt;&gt;&gt;&gt; ^C^C^C^C^C^C^C^C^C^C^C
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; It must be killed with SIGKILL, and libvirtd will die with gdb.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Here[1] is the output of the following command:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; strace -o /tmp/gdb-full-trace.txt -s 1024 -f gdb -q -p $(pgrep libvirtd)
&gt;&gt;&gt; Err, that is useless - you've just straced GDB, not libvirtd
&gt;&gt;&gt;
&gt;&gt;&gt; You need to strace libvirtd as it starts
&gt;&gt;&gt;
&gt;&gt;&gt;      strace -o libvirt.log -f -s 1000 /usr/sbin/libvirtd
&gt;&gt;&gt;
&gt;&gt; Here[1] is the output of the above command.
&gt;&gt;
&gt;&gt; [1] https://www.csie.ntu.edu.tw/~yunchih/s/libvirtd-strace.log
&gt; So this appears to show it hanging on the following:
&gt;
&gt;     17082 lstat("/home/xxxx/mnt",  &lt;unfinished ...&gt;
&gt;
&gt; Presumably '/home/xxx/mnt/' is a mount point and whatever storage is
&gt; behind there appears to be dead / nonresponsive.
&gt;
&gt; You'll need to either fix this mount point, or delete the XML config
&gt; for the storage pool that is associated with /home/xxxx/ from the
&gt; /etc/libvirt/storage/ directory.
&gt;
&gt;
&gt; Regards,
&gt; Daniel
Thanks!  This fixes the hanging virsh!!!

-- 
--
Yun-Chih Chen 陳耘志
Network/Workstation Assistant
Dept. of Computer Science and Information Engineering
National Taiwan University
Tel: +886-2-33664888 ext. 217/204
Email: ta217@csie.ntu.edu.tw
Website: http://wslab.csie.ntu.edu.tw/

</body></email><email><emailId>20170227061442</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-02-27 06:14:42-0400</timestampReceived><subject>Re: [libvirt-users] error : Failed to switch root mount into slave mode: Permission denied</subject><body>

On 26.02.2017 18:29, Kyle Peterson wrote:
&gt; libvirt-3.0.0
&gt; 
&gt; When attemping to create a virtual machine I receive the error "error : Failed to \
&gt; switch root mount into slave mode: Permission denied". 
&gt; I'm attempting to run qemu/libvirt/virt-manager in an Arch Linux lxc container on a \
&gt; Ubuntu 16.04 host.  The host uses zfs for its containers.  The arch container is \
&gt; set up as a priveleged container.  I do already have kvm/qemu/libvirt working in a \
&gt; Ubuntu container.  The reason for the arch container is because I want to try a \
&gt; newer version of qemu/libvirt. 
&gt; I'm not finding anything on google about this error message.  Any way to get around \
&gt; it?

Hey,

with 3.0.0 release qemu domains are started under a namespace too
(because of the error message I assume you're trying to start a qemu
domain). So far, every domain has its own /dev managed by libvirt. There
were two reasons for it:
a) avoid relabelling race with udev
b) enhance security as only configured devices are created in the namespace.

Therefore, when starting new qemu domain, libvirt calls
unshare(CLONE_NEWNS) and then tries to remount the root "/" into slave
mode so that all mounts from the master (= parent ns) are visible in the
namespace but not vice versa. Since you mention Ubuntu - could it be
that it is AppArmor that is denying the operation? Because frankly, I've
read some bug reports that AppArmor was denying libvirt to create a new
namespace but I'm no AppArmor expert and I don't know how to fix it.
There is a workaround too, just set:

  namespaces = []

in qemu.conf, restart libvirtd and you should be all set.

BTW, the 3.1.0-rc1 release is out and it contains a lot of qemu
namespace fixes. So you might try that.


Michal


</body></email><email><emailId>20170227154128</emailId><senderName>Francesco Romani</senderName><senderEmail>fromani@redhat.com</senderEmail><timestampReceived>2017-02-27 15:41:28-0400</timestampReceived><subject>[libvirt-users] [RFC] per-device metadata</subject><body>

Hi,


Currently libvirt supports metadata in the domain XML. This is very
convenient for data related to the VM, but it is a little awkward for
devices. Let's pretend I want to have extradata (say, a specific port
for a virtual switch) related to a device (say, a NIC). Nowadays I can
store that data in the metadata section, but I need some kind of mapping
to correlate this piece of information to the specific device.

I can use the device alias, but this is not available when the device is
created. This is also more complex when doing hotplug/hotunplug, because
I need to do update device and update metadata; if either fails, the
entire operation must be considered failed.

It would be nice to be able to attach metadata to the device, and this
is what I'm asking for/proposing in this mail.

Would it be possible in a future libvirt release?


If this is not possible, what's the best way to do the aforementioned
mapping? If it's alias (or device address), how can I be sure than I'm
addressing (no pun intended) the right device when I don't have them?
(e.g. hotplug new device, or just first time VM created)?


Thanks,


-- 
Francesco Romani
Red Hat Engineering Virtualization R &amp; D
IRC: fromani

</body></email><email><emailId>20170227201625</emailId><senderName>Dan Johansson</senderName><senderEmail>kvm@dmj.nu</senderEmail><timestampReceived>2017-02-27 20:16:25-0400</timestampReceived><subject>Re: [libvirt-users] shutdown -r now hangs in qemu-/kvm-vm</subject><body>

On 27.02.2017 09:57, Han Han wrote:
&gt; Please provide more info about the issue, such as your libvirt/qemu
&gt; version, your host OS version,
&gt; your VM OS version, your VM xml.
&gt; 
&gt; Thanks.
&gt; 
&gt; On Mon, Feb 27, 2017 at 4:12 PM, Dan Johansson &lt;kvm@dmj.nu&gt; wrote:
&gt; 
&gt;&gt; Since updating app-emulation/libvirt and/or app-emulation/qemu (both
&gt;&gt; were updated at the same time) I have a problem executing "shutdown -r
&gt;&gt; now" in the vm ("shutdown -h now" works fine).
&gt;&gt;
&gt;&gt; When I execute "shutdown -r now" in the vm the shutdown process runs
&gt;&gt; perfect until "Remounting root-filesystem readonly" and than it hangs
&gt;&gt; and I have to "Force Power Off" to reboot.
&gt;&gt;
&gt;&gt; Any suggestion what could be wrong and what I can do to solve it?
&gt;&gt;

app-emulation/libvirt-2.5.0-r2
app-emulation/qemu-2.8.0-r3

Host-OS: Gentoo-Linux
VM-OS: Gentoo-Linux, SuSe-Openlinux (and I have noticed it with "Reboot"
in Windows 10 as well).

And one of the VM-xml's:

&lt;domain type='kvm'&gt;
  &lt;name&gt;abcd&lt;/name&gt;
  &lt;uuid&gt;25facbd9-41be-0dbd-d473-0bbb0e3a22d7&lt;/uuid&gt;
  &lt;title&gt;Abcd - SuSeLinux&lt;/title&gt;
  &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;
  &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMemory&gt;
  &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
  &lt;os&gt;
    &lt;type arch='x86_64' machine='pc-0.12'&gt;hvm&lt;/type&gt;
    &lt;boot dev='hd'/&gt;
  &lt;/os&gt;
  &lt;features&gt;
    &lt;acpi/&gt;
  &lt;/features&gt;
  &lt;clock offset='utc'/&gt;
  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
  &lt;on_crash&gt;destroy&lt;/on_crash&gt;
  &lt;devices&gt;
    &lt;emulator&gt;/usr/bin/qemu-system-x86_64&lt;/emulator&gt;
    &lt;disk type='file' device='disk'&gt;
      &lt;driver name='qemu' type='qcow2'/&gt;
      &lt;source file='/var/lib/kvm/Abcd/Abcd.qcow2'/&gt;
      &lt;target dev='hda' bus='ide'/&gt;
      &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
    &lt;/disk&gt;
    &lt;controller type='ide' index='0'&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x01'
function='0x1'/&gt;
    &lt;/controller&gt;
    &lt;controller type='usb' index='0' model='piix3-uhci'&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x01'
function='0x2'/&gt;
    &lt;/controller&gt;
    &lt;controller type='pci' index='0' model='pci-root'/&gt;
    &lt;interface type='bridge'&gt;
      &lt;mac address='de:ed:be:ef:04:08'/&gt;
      &lt;source bridge='br4'/&gt;
      &lt;model type='e1000'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03'
function='0x0'/&gt;
    &lt;/interface&gt;
    &lt;input type='mouse' bus='ps2'/&gt;
    &lt;input type='keyboard' bus='ps2'/&gt;
    &lt;graphics type='vnc' port='5908' autoport='no'&gt;
      &lt;listen type='address'/&gt;
    &lt;/graphics&gt;
    &lt;video&gt;
      &lt;model type='cirrus' vram='16384' heads='1' primary='yes'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02'
function='0x0'/&gt;
    &lt;/video&gt;
    &lt;memballoon model='virtio'&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05'
function='0x0'/&gt;
    &lt;/memballoon&gt;
  &lt;/devices&gt;
&lt;/domain&gt;


-- 
Dan Johansson,
***************************************************
This message is printed on 100% recycled electrons!
***************************************************

</body></email><email><emailId>20170228213316</emailId><senderName>Max Ehrlich</senderName><senderEmail>max.ehr@gmail.com</senderEmail><timestampReceived>2017-02-28 21:33:16-0400</timestampReceived><subject>[libvirt-users] Bluetooth Device Support</subject><body>

Hi,

I want to create a virtual hci device on my virtual machine. I have seen
that qemu has options supporting this

https://qemu.weilnetz.de/doc/qemu-doc.html#Bluetooth_0028R_0029-options

and

https://qemu.weilnetz.de/doc/qemu-doc.html#pcsys_005fusb

Is there any support for these options in libvirt? I was not able to find
anything in documentation so I added the qemu command line xml as follows
&lt;qemu:commandline&gt;
    &lt;qemu:arg value='-usbdevice'/&gt;
    &lt;qemu:arg value='bt:hci'/&gt;
    &lt;qemu:arg value='-bt'/&gt;
    &lt;qemu:arg value='hci,host'/&gt;
  &lt;/qemu:commandline&gt;

but when I try to run my machine from virt-manager i get the following
error:

Error starting domain: internal error: process exited while connecting to
monitor: 2017-02-28T21:25:51.735987Z qemu-system-x86_64: -device
ich9-usb-ehci1,id=usb,bus=pcie.0,addr=0x1d.0x7: PCI: slot 29 function 7 not
available for ich9-usb-ehci1, in use by ich9-usb-ehci1

this error does not appear if I remove the commandline xml nodes

Does anyone have any guidance for troubleshooting this?

If it helps at all, virsh -v gives 2.1.0, virt-manager about page lists
1.3.2 and qemu-system-x86_64 --help gives 2.6.1 I am running Ubuntu 16.10.

thanks,
Max Ehrlich

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div dir="ltr" class="gmail_msg"&gt;Hi,&lt;div class="gmail_msg"&gt;&lt;br \
class="gmail_msg"&gt;&lt;/div&gt;&lt;div class="gmail_msg"&gt;I want to create a virtual hci device \
on my virtual machine. I have seen that qemu has options supporting this  &lt;/div&gt;&lt;div \
class="gmail_msg"&gt;&lt;br class="gmail_msg"&gt;&lt;/div&gt;&lt;div class="gmail_msg"&gt;&lt;a \
rel="nofollow" href="https://qemu.weilnetz.de/doc/qemu-doc.html#Bluetooth_0028R_0029-options" \
style="color:rgb(102,17,204);font-family:"roboto slab","times new \
roman",serif;font-size:14px;font-variant-ligatures:none;white-space:pre-wrap;background-color:rgb(250,250,250)" \
class="gmail_msg" target="_blank"&gt;https://qemu.weilnetz.de/doc/qemu-doc.html#Bluetooth_0028R_0029-options&lt;/a&gt;&lt;br \
class="gmail_msg"&gt;&lt;/div&gt;&lt;div class="gmail_msg"&gt;&lt;br class="gmail_msg"&gt;&lt;/div&gt;&lt;div \
class="gmail_msg"&gt;and  &lt;/div&gt;&lt;div class="gmail_msg"&gt;&lt;br class="gmail_msg"&gt;&lt;/div&gt;&lt;div \
class="gmail_msg"&gt;&lt;a rel="nofollow" \
href="https://qemu.weilnetz.de/doc/qemu-doc.html#pcsys_005fusb" \
style="color:rgb(102,17,204);font-family:"roboto slab","times new \
roman",serif;font-size:14px;font-variant-ligatures:none;white-space:pre-wrap;background-color:rgb(250,250,250)" \
class="gmail_msg" target="_blank"&gt;https://qemu.weilnetz.de/doc/qemu-doc.html#pcsys_005fusb&lt;/a&gt;&lt;br \
class="gmail_msg"&gt;&lt;/div&gt;&lt;div class="gmail_msg"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_msg"&gt;Is \
there any support for these options in libvirt? I was not able to find anything in \
documentation so I added the qemu command line xml as follows&lt;/div&gt;&lt;div \
class="gmail_msg"&gt;&lt;div class="gmail_msg"&gt;&lt;qemu:commandline&gt;&lt;/div&gt;&lt;div \
class="gmail_msg"&gt;      &lt;qemu:arg value='-usbdevice'/&gt;&lt;/div&gt;&lt;div \
class="gmail_msg"&gt;      &lt;qemu:arg value='bt:hci'/&gt;&lt;/div&gt;&lt;div \
class="gmail_msg"&gt;      &lt;qemu:arg value='-bt'/&gt;&lt;/div&gt;&lt;div \
class="gmail_msg"&gt;      &lt;qemu:arg value='hci,host'/&gt;&lt;/div&gt;&lt;div \
class="gmail_msg"&gt;   &lt;/qemu:commandline&gt;&lt;/div&gt;&lt;div \
class="gmail_msg"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_msg"&gt;but when I try to run my machine \
from virt-manager i get the following error:&lt;/div&gt;&lt;div \
class="gmail_msg"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_msg"&gt;Error starting domain: internal \
error: process exited while connecting to monitor: 2017-02-28T21:25:51.735987Z \
qemu-system-x86_64: -device ich9-usb-ehci1,id=usb,bus=pcie.0,addr=0x1d.0x7: PCI: slot \
29 function 7 not available for ich9-usb-ehci1, in use by \
ich9-usb-ehci1&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_msg"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_msg"&gt;this \
error does not appear if I remove the commandline xml nodes&lt;/div&gt;&lt;div \
class="gmail_msg"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_msg"&gt;Does anyone have any guidance for \
troubleshooting this?&lt;/div&gt;&lt;div class="gmail_msg"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_msg"&gt;If \
it helps at all, virsh -v gives 2.1.0, virt-manager about page lists 1.3.2 and \
qemu-system-x86_64 --help gives 2.6.1 I am running Ubuntu 16.10.&lt;/div&gt;&lt;div \
class="gmail_msg"&gt;&lt;br&gt;&lt;/div&gt;&lt;div class="gmail_msg"&gt;thanks,&lt;/div&gt;&lt;div \
class="gmail_msg"&gt;Max Ehrlich&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_msg"&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170228221903</emailId><senderName></senderName><senderEmail>youssef.elfathi@orange.com</senderEmail><timestampReceived>2017-02-28 22:19:03-0400</timestampReceived><subject>Re: [libvirt-users] Redhat 7: cgroup CPUACCT controller is not mounted</subject><body>

Thanks Martin, it resolved my issue. I had to adapt my setup to allow the non-root \
user to use libvirt!

-----Original Message-----
From: Martin Kletzander [mailto:mkletzan@redhat.com] 
Sent: mardi 28 février 2017 19:07
To: EL FATHI Youssef OBS/OINIS &lt;youssef.elfathi@orange.com&gt;
Cc: libvirt-users@redhat.com
Subject: Re: [libvirt-users] Redhat 7: cgroup CPUACCT controller is not mounted

On Tue, Feb 28, 2017 at 03:22:54PM +0000, youssef.elfathi@orange.com wrote:
&gt; Thanks Martin to confirm that the issue is due to privilege access. How can I run a \
&gt; domain as non-root and be able to access the cpu information? 

You need to use the system libvirt daemon, so you need to connect to qemu:///system \
instead of qemu:///session.  Good write-up about the differences is here:

  http://blog.wikichoon.com/2016/01/qemusystem-vs-qemusession.html

There are also links to more info.

_________________________________________________________________________________________________________________________


Ce message et ses pieces jointes peuvent contenir des informations confidentielles ou \
privilegiees et ne doivent donc pas etre diffuses, exploites ou copies sans \
autorisation. Si vous avez recu ce message par erreur, veuillez le signaler a \
l'expediteur et le detruire ainsi que les pieces jointes. Les messages electroniques \
etant susceptibles d'alteration, Orange decline toute responsabilite si ce message a \
ete altere, deforme ou falsifie. Merci.

This message and its attachments may contain confidential or privileged information \
that may be protected by law; they should not be distributed, used or copied without \
authorisation. If you have received this email in error, please notify the sender and \
delete this message and its attachments. As emails may be altered, Orange is not \
liable for messages that have been modified, changed or falsified. Thank you.


</body></email><email><emailId>20170104010236</emailId><senderName>Laine Stump</senderName><senderEmail>laine@laine.org</senderEmail><timestampReceived>2017-01-04 01:02:36-0400</timestampReceived><subject>Re: [libvirt-users] Default firewall rules and forwarding to a guest</subject><body>

On 01/03/2017 06:44 PM, Omer Aldemir wrote:
&gt; Thanks for the answers i think open network type is not available yet 
&gt; on the version that comes with rhel7


Actually it is in RHEL 7.3. Although the feature is in upstream libvirt 
only starting in version 2.2.0, and RHEL7.3 libvirt is based on libvirt 
2.0.0, certain patches are backported into RHEL packages based on 
severity of bug vs. potential for introducing regressions vs. customer 
demand. This particular patch was backported into RHEL7.3 for 
https://bugzilla.redhat.com/846810


&gt; On 3 Jan 2017, at 22:06, Laine Stump &lt;laine@laine.org 
&gt; &lt;mailto:laine@laine.org&gt;&gt; wrote:
&gt;
&gt;&gt; On 12/22/2016 09:48 AM, Omer Aldemir wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Hello,
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; I am trying to understand how libvirt firewall rules are loaded as I 
&gt;&gt;&gt; have firewalld and iptables services are disabled.
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; libvirt will add its iptables rules via firewalld if firewalld is 
&gt;&gt; enabled and running, otherwise it executes iptables commands directly.
&gt;&gt;
&gt;&gt; w
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Where is the configuration files for firewall and NAT rules for libvirt?
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; There are no configuration files for the iptables rules that libvirt 
&gt;&gt; adds. The simple set of rules that is added is fixed for each type of 
&gt;&gt; libvirt network - NAT, routed, and isolated. Here is a description of 
&gt;&gt; exactly what is added for each of these types of network:
&gt;&gt;
&gt;&gt; https://libvirt.org/firewall.html
&gt;&gt;
&gt;&gt; (actually I just realized that I forgot to add information there 
&gt;&gt; about a new network forwarding type I recently added - "open", which 
&gt;&gt; doesn't add *any* iptables rules - this is intended for those who 
&gt;&gt; want to do their own iptables setup for libvirt networks, outside of 
&gt;&gt; libvirt.)
&gt;&gt;
&gt;&gt;&gt; How can I load default firewall rules if I mess things up
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; To reload all the iptables rules for all active libvirt networks, 
&gt;&gt; just restart the libvirtd service.
&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Also I have realized that followings is default
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; ACCEPT     all  --  0.0.0.0/0 192.168.122.0/24     ctstate 
&gt;&gt;&gt; RELATED,ESTABLISHED
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; but If I am to forward a port for a real IP to internal guest 
&gt;&gt;&gt; machine I need
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; ACCEPT     all  --  0.0.0.0/0 192.168.122.0/24     state 
&gt;&gt;&gt; NEW,RELATED,ESTABLISHED
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; (NEW state is required) and also of course a forwarding rule
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; iptables -t nat -I PREROUTING -p tcp --dport 3389 -j DNAT 
&gt;&gt;&gt; --to-destination 192.168.122.16:3389
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Is there a place I can make this rules static with LibVirt (not 
&gt;&gt;&gt; playing with firewalld  and/or iptables service for Centos 7)
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; The best that can be done with current libvirt is to create a "hook" 
&gt;&gt; script similar to the one described here:
&gt;&gt;
&gt;&gt; https://wiki.libvirt.org/page/Networking#Forwarding_Incoming_Connections
&gt;&gt;
&gt;&gt; (That worked the last time I tried it, but that was at least 3 years 
&gt;&gt; ago. The python script available as a link from that page is newer 
&gt;&gt; and promises to be easier to understand (maybe))
&gt;
&gt;
&gt; _______________________________________________
&gt; libvirt-users mailing list
&gt; libvirt-users@redhat.com
&gt; https://www.redhat.com/mailman/listinfo/libvirt-users



[Attachment #3 (text/html)]

&lt;html&gt;
  &lt;head&gt;
    &lt;meta content="text/html; charset=utf-8" http-equiv="Content-Type"&gt;
  &lt;/head&gt;
  &lt;body bgcolor="#FFFFFF" text="#000000"&gt;
    &lt;div class="moz-cite-prefix"&gt;On 01/03/2017 06:44 PM, Omer Aldemir
      wrote:&lt;br&gt;
    &lt;/div&gt;
    &lt;blockquote
cite="mid:AMSPR06MB27741C9A88F19B98D1F9554B86E0@AMSPR06MB277.eurprd06.prod.outlook.com"
  type="cite"&gt;
      &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
      &lt;div&gt;Thanks for the answers i think open network type is not
        available yet on the version that comes with rhel7&lt;br&gt;
      &lt;/div&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
    &lt;br&gt;
    Actually it is in RHEL 7.3. Although the feature is in upstream
    libvirt only starting in version 2.2.0, and RHEL7.3 libvirt is based
    on libvirt 2.0.0, certain patches are backported into RHEL packages
    based on severity of bug vs. potential for introducing regressions
    vs. customer demand. This particular patch was backported into
    RHEL7.3 for &lt;a class="moz-txt-link-freetext" \
href="https://bugzilla.redhat.com/846810"&gt;https://bugzilla.redhat.com/846810&lt;/a&gt;&lt;br&gt;  \
&lt;br&gt;  &lt;br&gt;
    &lt;blockquote
cite="mid:AMSPR06MB27741C9A88F19B98D1F9554B86E0@AMSPR06MB277.eurprd06.prod.outlook.com"
  type="cite"&gt;
      &lt;div&gt;
        On 3 Jan 2017, at 22:06, Laine Stump &lt;&lt;a
          moz-do-not-send="true" \
href="mailto:laine@laine.org"&gt;laine@laine.org&lt;/a&gt;&gt;  wrote:&lt;br&gt;
        &lt;br&gt;
      &lt;/div&gt;
      &lt;blockquote type="cite"&gt;
        &lt;div&gt;
          &lt;div class="moz-cite-prefix"&gt;On 12/22/2016 09:48 AM, Omer
            Aldemir wrote:&lt;br&gt;
          &lt;/div&gt;
          &lt;blockquote
cite="mid:AMSPR06MB277EBC427FC12F38F37BA32B8920@AMSPR06MB277.eurprd06.prod.outlook.com"
  type="cite"&gt;
            &lt;div id="divtagdefaultwrapper"
style="font-size:12pt;color:#000000;font-family:Calibri,Arial,Helvetica,sans-serif;"
              dir="ltr"&gt;
              &lt;p&gt;Hello,&lt;/p&gt;
              &lt;p&gt;&lt;br&gt;
              &lt;/p&gt;
              &lt;p&gt;I am trying to understand how libvirt firewall rules
                are loaded as I have firewalld and iptables services are
                disabled.&lt;/p&gt;
            &lt;/div&gt;
          &lt;/blockquote&gt;
          &lt;br&gt;
          libvirt will add its iptables rules via firewalld if firewalld
          is enabled and running, otherwise it executes iptables
          commands directly.&lt;br&gt;
          &lt;br&gt;
          w&lt;br&gt;
          &lt;blockquote
cite="mid:AMSPR06MB277EBC427FC12F38F37BA32B8920@AMSPR06MB277.eurprd06.prod.outlook.com"
  type="cite"&gt;
            &lt;div id="divtagdefaultwrapper"
style="font-size:12pt;color:#000000;font-family:Calibri,Arial,Helvetica,sans-serif;"
              dir="ltr"&gt;
              &lt;p&gt;&lt;br&gt;
              &lt;/p&gt;
              &lt;p&gt;Where is the configuration files for firewall and NAT 
                rules for libvirt?&lt;/p&gt;
            &lt;/div&gt;
          &lt;/blockquote&gt;
          &lt;br&gt;
          There are no configuration files for the iptables rules that
          libvirt adds. The simple set of rules that is added is fixed
          for each type of libvirt network - NAT, routed, and isolated.
          Here is a description of exactly what is added for each of
          these types of network:&lt;br&gt;
          &lt;br&gt;
             &lt;a moz-do-not-send="true" class="moz-txt-link-freetext"
            href="https://libvirt.org/firewall.html"&gt;https://libvirt.org/firewall.html&lt;/a&gt;&lt;br&gt;
  &lt;br&gt;
          (actually I just realized that I forgot to add information
          there about a new network forwarding type I recently added -
          "open", which doesn't add *any* iptables rules - this is
          intended for those who want to do their own iptables setup for
          libvirt networks, outside of libvirt.)&lt;br&gt;
          &lt;br&gt;
          &lt;blockquote
cite="mid:AMSPR06MB277EBC427FC12F38F37BA32B8920@AMSPR06MB277.eurprd06.prod.outlook.com"
  type="cite"&gt;
            &lt;div id="divtagdefaultwrapper"
style="font-size:12pt;color:#000000;font-family:Calibri,Arial,Helvetica,sans-serif;"
              dir="ltr"&gt;
              &lt;p&gt;How can I load default firewall rules if I mess things
                up&lt;/p&gt;
            &lt;/div&gt;
          &lt;/blockquote&gt;
          &lt;br&gt;
          To reload all the iptables rules for all active libvirt
          networks, just restart the libvirtd service.&lt;br&gt;
          &lt;br&gt;
          &lt;blockquote
cite="mid:AMSPR06MB277EBC427FC12F38F37BA32B8920@AMSPR06MB277.eurprd06.prod.outlook.com"
  type="cite"&gt;
            &lt;div id="divtagdefaultwrapper"
style="font-size:12pt;color:#000000;font-family:Calibri,Arial,Helvetica,sans-serif;"
              dir="ltr"&gt;
              &lt;p&gt;&lt;br&gt;
              &lt;/p&gt;
              &lt;p&gt;Also I have realized that followings is default &lt;/p&gt;
              &lt;p&gt;&lt;br&gt;
              &lt;/p&gt;
              &lt;p&gt;&lt;span&gt;ACCEPT     all  --  0.0.0.0/0           
                  192.168.122.0/24     ctstate RELATED,ESTABLISHED&lt;/span&gt;&lt;/p&gt;
              &lt;p&gt;&lt;span&gt;&lt;br&gt;
                &lt;/span&gt;&lt;/p&gt;
              &lt;p&gt;&lt;span&gt;but If I am to forward a port for a real IP to
                  internal guest machine I need
                &lt;/span&gt;&lt;/p&gt;
              &lt;p&gt;&lt;span&gt;&lt;br&gt;
                &lt;/span&gt;&lt;/p&gt;
              &lt;p&gt;&lt;span&gt;&lt;span&gt;ACCEPT     all  --  0.0.0.0/0           
                    192.168.122.0/24     state \
NEW,RELATED,ESTABLISHED&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;  &lt;p&gt;&lt;span&gt;&lt;br&gt;
                &lt;/span&gt;&lt;/p&gt;
              &lt;p&gt;&lt;span&gt;(NEW state is required) and also of course a
                  forwarding rule&lt;/span&gt;&lt;/p&gt;
              &lt;p&gt;&lt;span&gt;&lt;br&gt;
                &lt;/span&gt;&lt;/p&gt;
              &lt;p&gt;&lt;span&gt;&lt;span&gt;iptables -t nat -I PREROUTING -p tcp
                    --dport 3389 -j DNAT --to-destination
                    192.168.122.16:3389&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
              &lt;p&gt;&lt;span&gt;&lt;br&gt;
                &lt;/span&gt;&lt;/p&gt;
              &lt;p&gt;&lt;span&gt;Is there a place I can make this rules static
                  with LibVirt (not playing with firewalld  and/or
                  iptables service for Centos 7)&lt;/span&gt;&lt;/p&gt;
            &lt;/div&gt;
          &lt;/blockquote&gt;
          &lt;br&gt;
          The best that can be done with current libvirt is to create a
          "hook" script similar to the one described here:&lt;br&gt;
          &lt;br&gt;
          &lt;a moz-do-not-send="true" class="moz-txt-link-freetext"
href="https://wiki.libvirt.org/page/Networking#Forwarding_Incoming_Connections"&gt;https://wiki.libvirt.org/page/Networking#Forwarding_Incoming_Connections&lt;/a&gt;&lt;br&gt;
  &lt;br&gt;
          (That worked the last time I tried it, but that was at least 3
          years ago. The python script available as a link from that
          page is newer and promises to be easier to understand (maybe))&lt;br&gt;
        &lt;/div&gt;
      &lt;/blockquote&gt;
      &lt;br&gt;
      &lt;fieldset class="mimeAttachmentHeader"&gt;&lt;/fieldset&gt;
      &lt;br&gt;
      &lt;pre wrap=""&gt;_______________________________________________
libvirt-users mailing list
&lt;a class="moz-txt-link-abbreviated" \
href="mailto:libvirt-users@redhat.com"&gt;libvirt-users@redhat.com&lt;/a&gt; &lt;a \
class="moz-txt-link-freetext" \
href="https://www.redhat.com/mailman/listinfo/libvirt-users"&gt;https://www.redhat.com/mailman/listinfo/libvirt-users&lt;/a&gt;&lt;/pre&gt;
  &lt;/blockquote&gt;
    &lt;p&gt;&lt;br&gt;
    &lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170104172136</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-01-04 17:21:36-0400</timestampReceived><subject>Re: [libvirt-users] Virsh Fail to Connect to Hypervisor</subject><body>

On Wed, Jan 04, 2017 at 06:15:52AM +0000, Xu, Rongjie (Nokia - CN/Hangzhou) wrote:
&gt; Hi,
&gt; 
&gt; I am upgrading libvirt from 1.2.9 to 2.0.0 and I have successfully make the \
&gt; libvirtd running. However, virsh cannot connect to hypervisor with following \
&gt; errors: 
&gt; virsh # connect
&gt; error: failed to connect to the hypervisor
&gt; 
&gt; root@node-55:/usr/local# virsh -c 'qemu:///system' connect
&gt; error: failed to connect to the hypervisor
&gt; error: no connection driver available for qemu:///system
&gt; 
&gt; Can you give me some suggestion about where will be the problem. Thanks.

Either you didn't install the QEMU driver for libvirt, or the QEMU driver
failed to initialize during libvirtd startup. Check the libvirtd logs for
the latter case, and make sure libvirt-daemon-driver-qemu RPM is installed
for the former.


Regards,
Daniel
-- 
&gt; &gt; http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
&gt; &gt; http://libvirt.org              -o-             http://virt-manager.org :|
&gt; &gt; http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|


</body></email><email><emailId>20170105062307</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-01-05 06:23:07-0400</timestampReceived><subject>Re: [libvirt-users] how to configure seabios with libvirt</subject><body>

On 12/27/2016 11:36 AM, dw wrote:
&gt; Hi:
&gt; 
&gt;     Anyone knows how to configure seabios with libvirt?
&gt; 
&gt;     Or Can I configure seabios in XML file?

You want to use:

&lt;domain type='qemu'&gt;
  &lt;name&gt;test&lt;/name&gt;
  &lt;os&gt;
    &lt;type arch='i686' machine='pc'&gt;hvm&lt;/type&gt;
    &lt;loader&gt;/usr/share/seabios/bios.bin&lt;/loader&gt;
    &lt;boot dev='hd'/&gt;
    &lt;bootmenu enable='yes'/&gt;
    &lt;bios useserial='yes'/&gt;
  &lt;/os&gt;
  ...
&lt;/domain&gt;

http://libvirt.org/formatdomain.html#elementsOSBIOS

Michal

</body></email><email><emailId>20170104061552</emailId><senderName>"Xu, Rongjie (Nokia - CN/Hangzhou)"</senderName><senderEmail>rongjie.xu@nokia.com</senderEmail><timestampReceived>2017-01-04 06:15:52-0400</timestampReceived><subject>[libvirt-users] Virsh Fail to Connect to Hypervisor</subject><body>

Hi,

I am upgrading libvirt from 1.2.9 to 2.0.0 and I have successfully make the=
 libvirtd running. However, virsh cannot connect to hypervisor with followi=
ng errors:

virsh # connect
error: failed to connect to the hypervisor

root@node-55:/usr/local# virsh -c 'qemu:///system' connect
error: failed to connect to the hypervisor
error: no connection driver available for qemu:///system

Can you give me some suggestion about where will be the problem. Thanks.

libvirtd is running:
root@node-55:/usr/lib/python2.7/dist-packages# ps aux | grep -i libvirtd
root     1246963  0.0  0.0 1245780 3428 ?        Ssl  06:04   0:00 /usr/sbi=
n/libvirtd --config /etc/libvirt/libvirtd.conf -l


Best Regards
Xu Rongjie (Max)
Mobile:18658176819




[Attachment #3 (text/html)]

&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=us-ascii"&gt;
&lt;meta name="Generator" content="Microsoft Exchange Server"&gt;
&lt;!-- converted from rtf --&gt;
&lt;style&gt;&lt;!-- .EmailQuote { margin-left: 1pt; padding-left: 4pt; border-left: #800000 \
2px solid; } --&gt;&lt;/style&gt; &lt;/head&gt;
&lt;body&gt;
&lt;font face="Calibri" size="3"&gt;&lt;span style="font-size:12pt;"&gt;
&lt;div&gt;&lt;font color="#1F4E79"&gt;Hi,&lt;/font&gt;&lt;/div&gt;
&lt;div&gt;&lt;font color="#1F4E79"&gt; &lt;/font&gt;&lt;/div&gt;
&lt;div&gt;&lt;font color="#1F4E79"&gt;I am upgrading libvirt from 1.2.9 to 2.0.0 and I have \
successfully make the libvirtd running. However, virsh cannot connect to hypervisor \
with following errors:&lt;/font&gt;&lt;/div&gt; &lt;div&gt;&lt;font color="#1F4E79"&gt; &lt;/font&gt;&lt;/div&gt;
&lt;div&gt;&lt;font color="red"&gt;virsh # connect&lt;/font&gt;&lt;/div&gt;
&lt;div&gt;&lt;font color="red"&gt;error: failed to connect to the hypervisor&lt;/font&gt;&lt;/div&gt;
&lt;div&gt;&lt;font face="Times New Roman" size="2" color="#1F4E79"&gt;&lt;span \
style="font-size:11pt;"&gt; &lt;/span&gt;&lt;/font&gt;&lt;/div&gt; &lt;div&gt;&lt;font \
color="red"&gt;root@node-55:/usr/local# virsh -c 'qemu:///system' connect&lt;/font&gt;&lt;/div&gt; \
&lt;div&gt;&lt;font color="red"&gt;error: failed to connect to the hypervisor&lt;/font&gt;&lt;/div&gt; \
&lt;div&gt;&lt;font color="red"&gt;error: no connection driver available for \
qemu:///system&lt;/font&gt;&lt;/div&gt; &lt;div&gt;&lt;font face="Times New Roman" size="2" \
color="#1F4E79"&gt;&lt;span style="font-size:11pt;"&gt; &lt;/span&gt;&lt;/font&gt;&lt;/div&gt; &lt;div&gt;&lt;font \
color="#1F4E79"&gt;Can you give me some suggestion about where will be the problem. \
Thanks.&lt;/font&gt;&lt;/div&gt; &lt;div&gt;&lt;font color="#1F4E79"&gt; &lt;/font&gt;&lt;/div&gt;
&lt;div&gt;&lt;font color="#1F4E79"&gt;libvirtd is running: &lt;/font&gt;&lt;/div&gt;
&lt;div&gt;&lt;font color="#1F4E79"&gt;root@node-55:/usr/lib/python2.7/dist-packages# ps aux | \
grep -i libvirtd&lt;/font&gt;&lt;/div&gt; &lt;div&gt;&lt;font color="#1F4E79"&gt;root     \
1246963  0.0  0.0 1245780 3428 ?        \
Ssl  06:04   0:00 /usr/sbin/libvirtd --config \
/etc/libvirt/libvirtd.conf -l&lt;/font&gt;&lt;/div&gt; &lt;div&gt;&lt;font face="Times New Roman" size="2" \
color="#1F4E79"&gt;&lt;span style="font-size:11pt;"&gt; &lt;/span&gt;&lt;/font&gt;&lt;/div&gt; &lt;div&gt;&lt;font \
face="Times New Roman" size="2" color="#1F4E79"&gt;&lt;span \
style="font-size:11pt;"&gt; &lt;/span&gt;&lt;/font&gt;&lt;/div&gt; &lt;div&gt;&lt;font size="2" \
color="#1F4E79"&gt;&lt;span style="font-size:11pt;"&gt;Best Regards&lt;/span&gt;&lt;/font&gt;&lt;/div&gt; \
&lt;div&gt;&lt;font size="2" color="#1F4E79"&gt;&lt;span style="font-size:11pt;"&gt;Xu Rongjie \
(Max)&lt;/span&gt;&lt;/font&gt;&lt;/div&gt; &lt;div&gt;&lt;font size="2" color="#1F4E79"&gt;&lt;span \
style="font-size:11pt;"&gt;Mobile:18658176819&lt;/span&gt;&lt;/font&gt;&lt;/div&gt; &lt;div&gt;&lt;font face="Times \
New Roman" size="2" color="#1F4E79"&gt;&lt;span \
style="font-size:11pt;"&gt; &lt;/span&gt;&lt;/font&gt;&lt;/div&gt; &lt;div&gt;&lt;font face="Times New Roman" \
size="2"&gt;&lt;span style="font-size:11pt;"&gt; &lt;/span&gt;&lt;/font&gt;&lt;/div&gt; &lt;div&gt;&lt;font \
face="Times New Roman" size="2"&gt;&lt;span \
style="font-size:11pt;"&gt; &lt;/span&gt;&lt;/font&gt;&lt;/div&gt; &lt;/span&gt;&lt;/font&gt;
&lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170103162813</emailId><senderName>Kashyap Chamarthy</senderName><senderEmail>kchamart@redhat.com</senderEmail><timestampReceived>2017-01-03 16:28:13-0400</timestampReceived><subject>Re: [libvirt-users] libvirtError: block copy still active: disk not ready for pivot yet</subject><body>

On Wed, Dec 28, 2016 at 01:26:12PM +0200, Ala Hino wrote:
&gt; Hi guys,
&gt; 
&gt; When performing live merge, in few cases, we see the following exception:

[...]

&gt; libvirtError: block copy still active: disk 'vdb' not ready for pivot yet

You can see if the block operation is still in progress or not by doing:
`sudo virsh blockjob vm1 vdb --info`.

&gt; That exception observed in following BZs:
&gt; 
&gt; https://bugzilla.redhat.com/1376580
&gt; https://bugzilla.redhat.com/1397122

[I see, that the above are oVirt bugs.]

&gt; I am trying to understand what this exception indicates in order to handle
&gt; it appropriately when thrown by libvirt.

Here's the commit that adds the above error message.  In short: Until
the 'query-block-jobs' QMP command emits the flag BLOCK_JOB_READY, the
copy / mirror block operation is truly not complete.


    commit eae59247c59aa02147b2b4a50177e8e877fdb218
    Author: Peter Krempa &lt;pkrempa@redhat.com&gt;
    Date:   Wed Jul 15 15:11:02 2015 +0200
    
        qemu: Update state of block job to READY only if it actually is ready
        
        Few parts of the code looked at the current progress of and assumed that
        a two phase blockjob is in the _READY state as soon as the progress
        reached 100% (info.cur == info.end). In current versions of qemu this
        assumption is invalid and qemu exposes a new flag 'ready' in the
        query-block-jobs output that is set to true if the job is actually
        finished.
        
        This patch adds internal data handling for reading the 'ready' flag and
        acting appropriately as long as the flag is present.
        
        While this still doesn't fix the virsh client problem with two phase
        block jobs and the --pivot option, it at least improves the error
        message:
        
        $ virsh blockcommit  --wait --verbose vm vda  --base vda[1] --active --pivot
        Block commit: [100 %]error: failed to pivot job for disk vda
        error: internal error: unable to execute QEMU command 'block-job-complete': \
The active block job for device 'drive-virtio-disk0' cannot be completed  
        to
        
        $ virsh blockcommit  --wait --verbose VM vda  --base vda[1] --active --pivot
        Block commit: [100 %]error: failed to pivot job for disk vda
        error: block copy still active: disk 'vda' not ready for pivot yet


[...]

-- 
/kashyap


</body></email><email><emailId>20170105034429</emailId><senderName>"=?gb18030?B?t8XFo7DgtcS0uszs?="</senderName><senderEmail>446844717@qq.com</senderEmail><timestampReceived>2017-01-05 03:44:29-0400</timestampReceived><subject>[libvirt-users] xml config nested</subject><body>

[Attachment #2 (text/plain)]

How to configure libvirt, so qemu-kvm support nested virtualization, virtual machine \
installed operating system is windows_7_ultimate_sp1_x64_dvd_618537.iso, configure \
libvirt xml file is as follows:

 &lt;cpu mode='custom' match='exact'&gt;
    &lt;model fallback='allow'&gt;core2duo&lt;/model&gt;
    &lt;feature policy='require' name='vmx'/&gt;
  &lt;/cpu&gt;


or

  &lt;cpu mode='host-model'&gt;
    &lt;model fallback='allow'/&gt;
  &lt;/cpu&gt;

or
 &lt;cpu mode='host-passthrough'&gt;
    &lt;topology sockets='2' cores='2' threads='2'/&gt;
  &lt;/cpu&gt;

We install libvirt in centos 7, qemu-kvm version is:

[Root @ localhost libexec] # ./qemu-kvm --version

QEMU emulator version 2.6.0 (qemu-kvm-ev-2.6.0-27.1.el7), Copyright (c) 2003-2008 \
Fabrice Bellard

Above is the basic environment and libvirt configuration, but in this environment to \
install the internal implementation of the following windows7 virtual machine kernel \
interface calls are as follows:

	if (!FeatrueControlMsr.fields.enable_vmxon)

	{

		MyWriteFile(FileHanle, "BiosÉèÖÃÃ»ÓÐ¿ªÆôÐéÄâ»¯\n", \
strlen("BiosÉèÖÃÃ»ÓÐ¿ªÆôÐéÄâ»¯\n"), &amp;ReturnLen);

		MyCloseFile(FileHanle);

		KdPrint(("BiosÉèÖÃÃ»ÓÐ¿ªÆôÐéÄâ»¯"));

		return FALSE;



	}




in conclusion:

Through this kernel interface to determine the result is: Bios settings do not turn \
on virtualization

How to solve this problem? Hope to get your help.

thank you very much¡£


[Attachment #3 (text/html)]

&lt;div&gt;How to configure libvirt, so qemu-kvm support nested virtualization, virtual \
machine installed operating system is windows_7_ultimate_sp1_x64_dvd_618537.iso, \
configure libvirt xml file is as follows:&lt;/div&gt;&lt;div&gt;&lt;p style="color: rgb(51, 51, 51); \
font-family: tahoma, ËÎÌå; text-align: justify; background-color: rgb(250, 250, \
252);"&gt; &lt;cpu mode='custom' match='exact'&gt;&lt;br&gt;    &lt;model \
fallback='allow'&gt;core2duo&lt;/model&gt;&lt;br&gt;    &lt;feature \
policy='require' name='vmx'/&gt;&lt;br&gt;  &lt;/cpu&gt;&lt;br&gt;&lt;/p&gt;&lt;p style="color: \
rgb(51, 51, 51); font-family: tahoma, ËÎÌå; text-align: justify; background-color: \
rgb(250, 250, 252);"&gt;or&lt;/p&gt;&lt;p style="color: rgb(51, 51, 51); font-family: tahoma, \
ËÎÌå; text-align: justify; background-color: rgb(250, 250, 252);"&gt;  &lt;cpu \
mode='host-model'&gt;&lt;br&gt;    &lt;model fallback='allow'/&gt;&lt;br&gt;  \
&lt;/cpu&gt;&lt;/p&gt;&lt;p style="color: rgb(51, 51, 51); font-family: tahoma, ËÎÌå; \
text-align: justify; background-color: rgb(250, 250, 252);"&gt;or&lt;br&gt; &lt;cpu \
mode='host-passthrough'&gt;&lt;br&gt;    &lt;topology sockets='2' cores='2' \
threads='2'/&gt;&lt;br&gt;  &lt;/cpu&gt;&lt;/p&gt;&lt;p style="text-align: justify; \
background-color: rgb(250, 250, 252);"&gt;&lt;font color="#333333" face="tahoma, ËÎÌå"&gt;We \
install libvirt in centos 7, qemu-kvm version is:&lt;/font&gt;&lt;/p&gt;&lt;p style="text-align: \
justify; background-color: rgb(250, 250, 252);"&gt;&lt;font color="#333333" face="tahoma, \
ËÎÌå"&gt;[Root @ localhost libexec] # ./qemu-kvm --version&lt;/font&gt;&lt;/p&gt;&lt;p \
style="text-align: justify; background-color: rgb(250, 250, 252);"&gt;&lt;font \
color="#333333" face="tahoma, ËÎÌå"&gt;QEMU emulator version 2.6.0 \
(qemu-kvm-ev-2.6.0-27.1.el7), Copyright (c) 2003-2008 Fabrice Bellard&lt;/font&gt;&lt;/p&gt;&lt;p \
style="text-align: justify; background-color: rgb(250, 250, 252);"&gt;&lt;font \
color="#333333" face="tahoma, ËÎÌå"&gt;Above is the basic environment and libvirt \
configuration, but in this environment to install the internal implementation of the \
following windows7 virtual machine kernel interface calls are as \
follows:&lt;/font&gt;&lt;/p&gt;&lt;p style="text-align: justify; background-color: rgb(250, 250, \
252);"&gt;&lt;font color="#333333" face="tahoma, ËÎÌå"&gt;&lt;span class="Apple-tab-span" \
style="white-space:pre"&gt;	&lt;/span&gt;if \
(!FeatrueControlMsr.fields.enable_vmxon)&lt;/font&gt;&lt;/p&gt;&lt;p style="text-align: justify; \
background-color: rgb(250, 250, 252);"&gt;&lt;font color="#333333" face="tahoma, \
ËÎÌå"&gt;&lt;span class="Apple-tab-span" style="white-space:pre"&gt;	&lt;/span&gt;{&lt;/font&gt;&lt;/p&gt;&lt;p \
style="text-align: justify; background-color: rgb(250, 250, 252);"&gt;&lt;font \
color="#333333" face="tahoma, ËÎÌå"&gt;&lt;span class="Apple-tab-span" \
style="white-space:pre"&gt;		&lt;/span&gt;MyWriteFile(FileHanle, "BiosÉèÖÃÃ»ÓÐ¿ªÆôÐéÄâ»¯\n", \
strlen("BiosÉèÖÃÃ»ÓÐ¿ªÆôÐéÄâ»¯\n"), &amp;ReturnLen);&lt;/font&gt;&lt;/p&gt;&lt;p style="text-align: \
justify; background-color: rgb(250, 250, 252);"&gt;&lt;font color="#333333" face="tahoma, \
ËÎÌå"&gt;&lt;span class="Apple-tab-span" \
style="white-space:pre"&gt;		&lt;/span&gt;MyCloseFile(FileHanle);&lt;/font&gt;&lt;/p&gt;&lt;p \
style="text-align: justify; background-color: rgb(250, 250, 252);"&gt;&lt;font \
color="#333333" face="tahoma, ËÎÌå"&gt;&lt;span class="Apple-tab-span" \
style="white-space:pre"&gt;		&lt;/span&gt;KdPrint(("BiosÉèÖÃÃ»ÓÐ¿ªÆôÐéÄâ»¯"));&lt;/font&gt;&lt;/p&gt;&lt;p \
style="text-align: justify; background-color: rgb(250, 250, 252);"&gt;&lt;font \
color="#333333" face="tahoma, ËÎÌå"&gt;&lt;span class="Apple-tab-span" \
style="white-space:pre"&gt;		&lt;/span&gt;return FALSE;&lt;/font&gt;&lt;/p&gt;&lt;p style="text-align: \
justify; background-color: rgb(250, 250, 252);"&gt;&lt;font color="#333333" face="tahoma, \
ËÎÌå"&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style="text-align: justify; background-color: rgb(250, 250, \
252);"&gt;&lt;font color="#333333" face="tahoma, ËÎÌå"&gt;&lt;span class="Apple-tab-span" \
style="white-space:pre"&gt;	&lt;/span&gt;}&lt;/font&gt;&lt;/p&gt;&lt;p style="text-align: justify; \
background-color: rgb(250, 250, 252);"&gt;&lt;font color="#333333" face="tahoma, \
ËÎÌå"&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style="text-align: justify; background-color: rgb(250, 250, \
252);"&gt;&lt;font color="#333333" face="tahoma, ËÎÌå"&gt;in conclusion:&lt;/font&gt;&lt;/p&gt;&lt;p \
style="text-align: justify; background-color: rgb(250, 250, 252);"&gt;&lt;font \
color="#333333" face="tahoma, ËÎÌå"&gt;Through this kernel interface to determine the \
result is: Bios settings do not turn on virtualization&lt;/font&gt;&lt;/p&gt;&lt;p \
style="text-align: justify; background-color: rgb(250, 250, 252);"&gt;&lt;font \
color="#333333" face="tahoma, ËÎÌå"&gt;How to solve this problem? Hope to get your \
help.&lt;/font&gt;&lt;/p&gt;&lt;p style="text-align: justify; background-color: rgb(250, 250, \
252);"&gt;&lt;font color="#333333" face="tahoma, ËÎÌå"&gt;thank you very much¡£&lt;/font&gt;&lt;/p&gt;&lt;p \
style="color: rgb(51, 51, 51); font-family: tahoma, ËÎÌå; text-align: justify; \
background-color: rgb(250, 250, 252);"&gt;&lt;br&gt;&lt;/p&gt;&lt;/div&gt;



</body></email><email><emailId>20170107180720</emailId><senderName>Anubhav Guleria</senderName><senderEmail>anubhav.nitsri.it@gmail.com</senderEmail><timestampReceived>2017-01-07 18:07:20-0400</timestampReceived><subject>[libvirt-users] Regarding Migration Code</subject><body>

Greetings,

I was trying to understand the flow of Migration Code in libvirt and
have few doubts:

1)  libvirt talks to QEMU/KVM guests via QEMU API. So overall, in
order to manage QEMU/KVM guests I can either use libvirt (or tools
based on libvirt like virsh) or QEMU monitor. Is it so?

2) Since libvirt is Hypervisor neutral so actual migration
algorithm(precopy or postcopy) is present in the hypervisor ,i.e. in
case of QEMU it should be present in QEMU code base . I was going
through the code starting from libvirt-domain api and not able to
follow after virDomainMigrateVersion3Full(.....)  . Kindly help.

Thanks in advance. And sorry if that was too basic.

Anubhav

</body></email><email><emailId>20170110055651</emailId><senderName>"=?gb18030?B?t8XFo7DgtcS0uszs?="</senderName><senderEmail>446844717@qq.com</senderEmail><timestampReceived>2017-01-10 05:56:51-0400</timestampReceived><subject>[libvirt-users] =?gb18030?b?u9i4tKO6IFtsaWJ2aXJ0XSB4bWwgY29uZmln?= =?gb18030?q?_nested?=</subject><body>

[Attachment #2 (text/plain)]

thanks your mail£¬now below£º


If the KVM supports nested VMX and QEMU starts with the arguments -enable-kvm and
    -cpu ..., + vmx, then the LOCK bit of the guest MSR_IA32_FEATURE_CONTROL and
    Enable VMX out of SMX operation bit will be set.


Well, I should add -enable-kvm parameters of the document which xml position, the \
exact stresses, how Canada?





------------------ Ô­Ê¼ÓÊ¼þ ------------------
·¢¼þÈË: "Daniel P. Berrange";&lt;berrange@redhat.com&gt;;
·¢ËÍÊ±¼ä: 2017Äê1Ô 5ÈÕ(ÐÇÆÚËÄ) ÍíÉÏ8:53
ÊÕ¼þÈË: "·ÅÅ£°àµÄ´ºÌì"&lt;446844717@qq.com&gt;; 
³­ËÍ: "libvirt-users"&lt;libvirt-users@redhat.com&gt;; 
Ö÷Ìâ: Re: [libvirt] xml config nested



NB, in future please don't CC all possible mailing lists at once.
Just pick the most appropriate mailing list for your question. I've
dropped libvirt-list &amp; libvirt-announce from the CC, since this is
a question most suited for libvirt-users.

On Thu, Jan 05, 2017 at 11:44:29AM +0800, ·ÅÅ£°àµÄ´ºÌì wrote:
&gt; How to configure libvirt, so qemu-kvm support nested virtualization, virtual \
&gt; machine installed operating system is windows_7_ultimate_sp1_x64_dvd_618537.iso, \
&gt; configure libvirt xml file is as follows: 
&gt; &lt;cpu mode='custom' match='exact'&gt;
&gt; &lt;model fallback='allow'&gt;core2duo&lt;/model&gt;
&gt; &lt;feature policy='require' name='vmx'/&gt;
&gt; &lt;/cpu&gt;
&gt; 
&gt; 
&gt; or
&gt; 
&gt; &lt;cpu mode='host-model'&gt;
&gt; &lt;model fallback='allow'/&gt;
&gt; &lt;/cpu&gt;
&gt; 
&gt; or
&gt; &lt;cpu mode='host-passthrough'&gt;
&gt; &lt;topology sockets='2' cores='2' threads='2'/&gt;
&gt; &lt;/cpu&gt;

Yes, that's the key guest configuration step - exposing the 'vmx' feature
to the guest.

In addition to that though, you need to make sure the kvm-intel kernel
module in your host has the "nested=1" parameter set.

eg in /etc/modprobe.d/kvm.conf you want

 options kvm_intel nested=1

If loaded correctly you should see

# cat /sys/module/kvm_intel/parameters/nested 
Y

if it says "N", then nested VMX will be disabled.

Regards,
Daniel
-- 
&gt; &gt; http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
&gt; &gt; http://libvirt.org              -o-             http://virt-manager.org :|
&gt; &gt; http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|


[Attachment #3 (text/html)]

&lt;div&gt;&lt;div&gt;&lt;font face="lucida Grande, Verdana, Microsoft YaHei"&gt;thanks your mail£¬now \
below£º&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="lucida Grande, Verdana, Microsoft \
YaHei"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="lucida Grande, Verdana, Microsoft YaHei"&gt;If \
the KVM supports nested VMX and QEMU starts with the arguments -enable-kvm \
and&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="lucida Grande, Verdana, Microsoft YaHei"&gt;  \
  -cpu ..., + vmx, then the LOCK bit of the guest MSR_IA32_FEATURE_CONTROL \
and&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="lucida Grande, Verdana, Microsoft YaHei"&gt;  \
  Enable VMX out of SMX operation bit will be set.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="lucida Grande, Verdana, Microsoft YaHei"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="lucida Grande, Verdana, Microsoft YaHei"&gt;Well, I should add -enable-kvm \
parameters of the document which xml position, the exact stresses, how \
Canada?&lt;/font&gt;&lt;/div&gt;&lt;span style="font-family: "lucida Grande", Verdana, \
"Microsoft YaHei";"&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
style="font-size: 12px;font-family: Arial Narrow;padding:2px 0 2px \
0;"&gt;------------------ Ô­Ê¼ÓÊ¼þ ------------------&lt;/div&gt;&lt;div \
style="font-size: 12px;background:#efefef;padding:8px;"&gt;&lt;div&gt;&lt;b&gt;·¢¼þÈË:&lt;/b&gt; "Daniel \
P. Berrange";&lt;berrange@redhat.com&gt;;&lt;/div&gt;&lt;div&gt;&lt;b&gt;·¢ËÍÊ±¼ä:&lt;/b&gt; 2017Äê1Ô \
5ÈÕ(ÐÇÆÚËÄ) ÍíÉÏ8:53&lt;/div&gt;&lt;div&gt;&lt;b&gt;ÊÕ¼þÈË:&lt;/b&gt; "·ÅÅ£°àµÄ´ºÌì"&lt;446844717@qq.com&gt;; \
&lt;wbr&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;³­ËÍ:&lt;/b&gt; "libvirt-users"&lt;libvirt-users@redhat.com&gt;; \
&lt;wbr&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Ö÷Ìâ:&lt;/b&gt; Re: [libvirt] xml config \
nested&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;NB, in future please don't CC all possible mailing \
lists at once.&lt;br&gt;Just pick the most appropriate mailing list for your question. \
I've&lt;br&gt;dropped libvirt-list &amp; libvirt-announce from the CC, since this is&lt;br&gt;a \
question most suited for libvirt-users.&lt;br&gt;&lt;br&gt;On Thu, Jan 05, 2017 at 11:44:29AM \
+0800, ·ÅÅ£°àµÄ´ºÌì wrote:&lt;br&gt;&gt; How to configure libvirt, so qemu-kvm support \
nested virtualization, virtual machine installed operating system is \
windows_7_ultimate_sp1_x64_dvd_618537.iso, configure libvirt xml file is as \
follows:&lt;br&gt;&gt; &lt;br&gt;&gt;  &lt;cpu mode='custom' \
match='exact'&gt;&lt;br&gt;&gt;     &lt;model \
fallback='allow'&gt;core2duo&lt;/model&gt;&lt;br&gt;&gt;     \
&lt;feature policy='require' name='vmx'/&gt;&lt;br&gt;&gt;   &lt;/cpu&gt;&lt;br&gt;&gt; \
&lt;br&gt;&gt; &lt;br&gt;&gt; or&lt;br&gt;&gt; &lt;br&gt;&gt;   &lt;cpu \
mode='host-model'&gt;&lt;br&gt;&gt;     &lt;model \
fallback='allow'/&gt;&lt;br&gt;&gt;   &lt;/cpu&gt;&lt;br&gt;&gt; &lt;br&gt;&gt; \
or&lt;br&gt;&gt;  &lt;cpu mode='host-passthrough'&gt;&lt;br&gt;&gt;     \
&lt;topology sockets='2' cores='2' threads='2'/&gt;&lt;br&gt;&gt;   \
&lt;/cpu&gt;&lt;br&gt;&lt;br&gt;Yes, that's the key guest configuration step - exposing the 'vmx' \
feature&lt;br&gt;to the guest.&lt;br&gt;&lt;br&gt;In addition to that though, you need to make sure the \
kvm-intel kernel&lt;br&gt;module in your host has the "nested=1" parameter set.&lt;br&gt;&lt;br&gt;eg \
in /etc/modprobe.d/kvm.conf you want&lt;br&gt;&lt;br&gt; options kvm_intel \
nested=1&lt;br&gt;&lt;br&gt;If loaded correctly you should see&lt;br&gt;&lt;br&gt;# cat \
/sys/module/kvm_intel/parameters/nested &lt;br&gt;Y&lt;br&gt;&lt;br&gt;if it says "N", then nested VMX \
will be disabled.&lt;br&gt;&lt;br&gt;Regards,&lt;br&gt;Daniel&lt;br&gt;-- &lt;br&gt;|: \
http://berrange.com      -o-    \
http://www.flickr.com/photos/dberrange/ :|&lt;br&gt;|: \
http://libvirt.org              \
-o-             \
http://virt-manager.org :|&lt;br&gt;|: \
http://entangle-photo.org       -o-    \
http://search.cpan.org/~danberr/ :|&lt;/div&gt;



</body></email><email><emailId>20170109182901</emailId><senderName>W Kern</senderName><senderEmail>wkern@pixelgate.net</senderEmail><timestampReceived>2017-01-09 18:29:01-0400</timestampReceived><subject>[libvirt-users] changing to cache='none' on the fly?</subject><body>

As is already well documented, we find that we need cache='none' to 
support migration, otherwise there is the chance of a hang and/or 
failure to pivot.

However we prefer the default of cache=writethrough when operating in 
production.

Our practice is to 'shutdown' the VM completely make the change with 
virsh edit,  then restart.  Then we have to repeat the process to revert 
back once we migrate.

Is it possible to change that function on the fly and avoid the 
shutdown/start process?

Note: we have had inconsistent results with virsh edit first and then a 
reboot. A complete shutdown seems to be necessary, but I am hoping there 
is some other procedure available.

Our images are all qcow2 (1.1)

Sincerely,

W Kern

PixelGate Networks


</body></email><email><emailId>20170110144913</emailId><senderName>Anubhav Guleria</senderName><senderEmail>anubhav.nitsri.it@gmail.com</senderEmail><timestampReceived>2017-01-10 14:49:13-0400</timestampReceived><subject>[libvirt-users] Regarding Migration Statistics</subject><body>

Greetings,

I am writing a code using libvirt API to migrate VM between two physical
hosts *(QEMU/KVM) , *say some *n *number of times.

*1)* I am using right now* virDomainPtr virDomainMigrate (.......) *and to
calculate the total migration time I am using something like this:

*clock_gettime(CLOCK_MONOTONIC_RAW,&amp;begin);  *
 *migrate*(domainToMigrate,nodeToMigrate);

*clock_gettime(CLOCK_MONOTONIC_RAW,&amp;end);*



*Total Migration Time = end.tv_sec-begin.tv_sec*

Is this correct way to calculate total migration time. And is there some
way to calculate the downtime (not how to set it)?

*2) *I am interested in identifying in particular other statistics of
migration like :
*Number of iterations in Pre Copy*, *Memory transferred in each iteration*
etc.
I was going through the API and found* virDomainJobInfo
&lt;http://libvirt.org/html/libvirt-libvirt-domain.html#virDomainJobInfo&gt; and
virDomainGetJobStats
&lt;http://libvirt.org/html/libvirt-libvirt-domain.html#virDomainGetJobStats&gt;
*functions.But
how to use them is not very clear. Can anyone point me to right place to
achieve this objective?

Thanks in advance.
And sorry if that was too silly to ask.

Anubhav

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;Greetings,&lt;br&gt;&lt;br&gt;I am writing a code using libvirt API to \
migrate VM between two physical hosts &lt;b&gt;(QEMU/KVM) , &lt;/b&gt;say some &lt;b&gt;n &lt;/b&gt;number of \
times.&lt;br&gt;&lt;br&gt;&lt;b&gt;1)&lt;/b&gt; I am using right now&lt;b&gt; \
virDomainPtr	virDomainMigrate	(.......) &lt;/b&gt;and to calculate the total migration time \
I am using something like \
this:&lt;br&gt;&lt;br&gt;&lt;b&gt;clock_gettime(CLOCK_MONOTONIC_RAW,&amp;begin);    &lt;/b&gt;   &lt;br&gt;  \
&lt;b&gt;migrate&lt;/b&gt;(domainToMigrate,nodeToMigrate);&lt;br&gt;&lt;b&gt;clock_gettime(CLOCK_MONOTONIC_RAW,&amp;end);&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;div&gt;&lt;b&gt;Total \
Migration Time = end.tv_sec-begin.tv_sec&lt;br&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;Is \
this correct way to calculate total migration time. And is there some way to \
calculate the downtime (not how to set it)?&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;2) &lt;/b&gt;I am \
interested in identifying in particular other statistics of migration like \
:&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Number of iterations in Pre Copy&lt;/b&gt;, &lt;b&gt;Memory transferred in \
each iteration&lt;/b&gt; etc.&lt;br&gt;&lt;/div&gt;&lt;div&gt;I was going through the API and found&lt;b&gt; &lt;a \
href="http://libvirt.org/html/libvirt-libvirt-domain.html#virDomainJobInfo"&gt;virDomainJobInfo&lt;/a&gt; \
and &lt;a href="http://libvirt.org/html/libvirt-libvirt-domain.html#virDomainGetJobStats"&gt;virDomainGetJobStats&lt;/a&gt; \
&lt;/b&gt;functions.But how to use them is not very clear. Can anyone point me to right \
place to achieve this objective?&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks in \
advance.&lt;br&gt;&lt;/div&gt;&lt;div&gt;And sorry if that was too silly to \
ask.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Anubhav&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170116185208</emailId><senderName>W Kern</senderName><senderEmail>wkern@pixelgate.net</senderEmail><timestampReceived>2017-01-16 18:52:08-0400</timestampReceived><subject>[libvirt-users] io=native &amp; io=threads</subject><body>

Googling provides lots of interesting info on the use of these in 
various situations such as SSD, number of VMs in the pool etc.

What is the default in Libvirt (or is the default 'neither')

Sincerely

W Kern

</body></email><email><emailId>20170117095105</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-01-17 09:51:05-0400</timestampReceived><subject>Re: [libvirt-users] io=native &amp; io=threads</subject><body>

On Mon, Jan 16, 2017 at 10:52:08AM -0800, W Kern wrote:
&gt; Googling provides lots of interesting info on the use of these in various
&gt; situations such as SSD, number of VMs in the pool etc.
&gt; 
&gt; What is the default in Libvirt (or is the default 'neither')

Libvirt has no default policy - it just delegates to whatever
QEMU uses as the default.

The current recommendation from the QEMU developers is that
"native" is currently the best performing setting in most
scenarios.

The only time you should *not* use "native" is if you have
*not* pre-allocated images. eg if you use sparse raw images,
or have qcow2 images which did not have "preallocation" option
given to "qemu-img create". For these you should use "threads".
This is to avoid guest stalls when the host OS has to allocate
a filesystem block to grow the file.

Also note the io setting is only relevant for file/block device
backed disks. ie if using the in-QEMU network client for RBD,
Gluster, iSCSI, NFS, etc thenm the io setting has no effect at
all so can be ignored.

Regards,
Daniel
-- 
|: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
|: http://libvirt.org              -o-             http://virt-manager.org :|
|: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|

</body></email><email><emailId>20170110151811</emailId><senderName>Jiri Denemark</senderName><senderEmail>jdenemar@redhat.com</senderEmail><timestampReceived>2017-01-10 15:18:11-0400</timestampReceived><subject>Re: [libvirt-users] Regarding Migration Statistics</subject><body>

Please, do not post to several libvirt lists at once.

&gt; I am writing a code using libvirt API to migrate VM between two physical
&gt; hosts *(QEMU/KVM) , *say some *n *number of times.
&gt; 
&gt; *1)* I am using right now* virDomainPtr virDomainMigrate (.......) *and to
&gt; calculate the total migration time I am using something like this:
&gt; 
&gt; *clock_gettime(CLOCK_MONOTONIC_RAW,&amp;begin);  *
&gt; *migrate*(domainToMigrate,nodeToMigrate);
&gt; 
&gt; *clock_gettime(CLOCK_MONOTONIC_RAW,&amp;end);*
&gt; 
&gt; *Total Migration Time = end.tv_sec-begin.tv_sec*
&gt; 
&gt; Is this correct way to calculate total migration time. And is there some
&gt; way to calculate the downtime (not how to set it)?

Well, just call virDomainGetJobStats and you will get both total time
and downtime and many more.

&gt; virDomainGetJobStats
&gt; &lt;http://libvirt.org/html/libvirt-libvirt-domain.html#virDomainGetJobStats&gt;

Yes, this is the right API to get all the statistics you want. It
returns a list of (key, type, value) entires in params. The keys are
VIR_DOMAIN_JOB_* (see
http://libvirt.org/html/libvirt-libvirt-domain.html#VIR_DOMAIN_JOB_AUTO_CONVERGE_THROTTLE
 and a lot of other VIR_DOMAIN_JOB_* macros following this one for
details). You can look at
http://libvirt.org/git/?p=libvirt.git;a=blob;f=tools/virsh-domain.c;h=93587e8bc7c79cbb66b6ee107472dfec5f320dab;hb=HEAD


In short, just call

    virTypedParamsGetULLong(params, nparams, VIR_DOMAIN_JOB_DOWNTIME,
                            &amp;value)

to fetch downtime from params into value if it was present there (check
return value of the API). The exact API to call is different for each
type, although all migration statistics are unsigned long long so this
one is all you need.

BTW, you can call virDomainGetJobStats anytime while migration is
running to monitor its progress. To check statistics of a completed
migration it's easier to just register a callback for
VIR_DOMAIN_EVENT_ID_JOB_COMPLETED event. See
http://libvirt.org/git/?p=libvirt.git;a=blob;f=examples/object-events/event-test.c;h=55c004f93f40de628ae76221bb8ef9a13b2acb3d;hb=HEAD#l940
 for an example.

Jirka


</body></email><email><emailId>20170114113010</emailId><senderName>Govert</senderName><senderEmail>govert.br@gmail.com</senderEmail><timestampReceived>2017-01-14 11:30:10-0400</timestampReceived><subject>[libvirt-users] Controlling the name of the 'tap0' device, in a bridged networking setup</subject><body>

Hi,

I'm trying to control the name of the 'tap0' device that gets created as I
start a domain that uses bridged networking. The XML specification of the
domain contains the following configuration

    &lt;interface type='bridge'&gt;
      &lt;source bridge='br0'/&gt;
    &lt;/interface&gt;

The libvirt documentation (
http://libvirt.org/formatdomain.html#elementsNICSBridge) and other
discussions online tell me that I just need to include the &lt;target
dev='desired_dev_name'/&gt; tag in the XML specification of the domain under
the &lt;interface&gt; tag. Unfortunately doing so appears to have no effect; the
tun device created and 'enslaved' in the bridge is still called 'tap0'.
Interestingly, I never get a tun device with a name prefixed by 'vnet' or
'vif' which, according to the documentation, is the default behaviour (?).
The host is running CentOS 7, and virsh is used to start the domain.

Best,
Govert

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I'm trying to control the name of the \
'tap0' device that gets created as I start a domain that uses bridged \
networking. The XML specification of the domain contains the following \
configuration&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;      &lt;interface \
type='bridge'&gt;&lt;/div&gt;&lt;div&gt;         &lt;source \
bridge='br0'/&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/interface&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The libvirt documentation (&lt;a \
href="http://libvirt.org/formatdomain.html#elementsNICSBridge"&gt;http://libvirt.org/formatdomain.html#elementsNICSBridge&lt;/a&gt;) \
and other discussions online tell me that I just need to include the &lt;target \
dev='desired_dev_name'/&gt; tag in the XML specification of the domain under \
the &lt;interface&gt; tag. Unfortunately doing so appears to have no effect; the tun \
device created and 'enslaved' in the bridge is still called 'tap0'. \
Interestingly, I never get a tun device with a name prefixed by 'vnet' or \
'vif' which, according to the documentation, is the default behaviour (?). \
The host is running CentOS 7, and virsh is used to start the \
domain.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Best,&lt;/div&gt;&lt;div&gt;Govert&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170117112718</emailId><senderName>lejeczek</senderName><senderEmail>peljasz@yahoo.co.uk</senderEmail><timestampReceived>2017-01-17 11:27:18-0400</timestampReceived><subject>[libvirt-users] gluster store and autostart - but fails</subject><body>

hi all
I've a few guest which work/run perfectly fine, I believe, 
except for autostart.
Configuration of system, gluster and libvirt is pretty 
regular and not complex.
Errors I see:
...
failed to initialize gluster connection (src=0x7f9424266350 
priv=0x7f94242922b0): Transport endpoint is
internal error: Failed to autostart VM 'rhel-work2': failed 
to initialize gluster connection (src=0x7f9
failed to initialize gluster connection (src=0x7f942423fef0 
priv=0x7f9424256320): Transport endpoint is
internal error: Failed to autostart VM 'rhel-work3': failed 
to initialize gluster connection (src=0x7f9
failed to initialize gluster connection (src=0x7f9424261b20 
priv=0x7f94242a18b0): Transport endpoint is
internal error: Failed to autostart VM 'rhel-work1': failed 
to initialize gluster connection (src=0x7f9
...

I tried to make systemd libvirtd to wait for gluster:

After=glusterd.service

but if that's all required then, well, still fails.
Would you have any suggestions?
Many thanks,
L.

</body></email><email><emailId>20170120171424</emailId><senderName>lejeczek</senderName><senderEmail>peljasz@yahoo.co.uk</senderEmail><timestampReceived>2017-01-20 17:14:24-0400</timestampReceived><subject>[libvirt-users] dhcp &lt;option&gt; element - is this included yet?</subject><body>

hi all,
I've seen this: 
https://www.redhat.com/archives/libvir-list/2013-March/msg00822.html
it's a few years old and I wonder (I hope) - implemented yet?

cheers,
L.

</body></email><email><emailId>20170124045012</emailId><senderName>akhilesh rawat</senderName><senderEmail>akhileshrawat007@gmail.com</senderEmail><timestampReceived>2017-01-24 04:50:12-0400</timestampReceived><subject>[libvirt-users] LibVirt query CPU Model support and restore operation</subject><body>

Hello ,

It was working good working with kvm management tools using libvirt .
virsh/virt-manager .

But then i got annoyed when management tool did not allow me to change the
CPU model while creating new virtual machine .
error

root@kvm-server qemu]# virt-install --virt-type kvm --name compute-2 --cpu
Haswell-noTSX --rama440 --vcpus  --os-type=linux --os-variant=generic
--disk
compute2-disk0.qcow2,device=disk,bus=ide,size00,sparse=true,format=qcow2
--pxe --network bridge=virbr0,modelá000 --network
bridge=virbr0,modelá000 --network bridge=virbr0,model=virtio --network
bridge=virbr0,model=virtio --graphics vnc,portY06 --noautoconsole

Starting install...
ERROR    unsupported configuration: guest and host CPU are not compatible:
Host CPU does not provide required features: invpcid, erms, bmi2, smep,
avx2, bmi1, fsgsbase, movbe, fma
Domain installation does not appear to have been successful.

I could not resolve this error .

Finally i came across the post which say that libvirt cross verifies  flags
under CPU model present in
/usr/share/libvirt/cpu_map.xml and cat /proc/cpuinfo .

An yes the flag complained were not present in host proc/cpuinfo.

Question 1: Is it really needed for Libvirt to do this check .

AS KVM seems to allow support Haswell with native commands . Why libvirt is
doing this check then ?

As i was not sure where the problem lies and i was using libvirt 2.0.0
version i upgraded to 2.5.0 by compiling form source .
But then i faces issue using virsh/virt-manager as seem it was not
compatilble with upgarded version of libvirt.

Now my system is little messed  around libvirt . I did reinstall/reboot
Quite many things not working .

Question 2 : How can i restore original Libvirt 2.0.0 .


br aki

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;Hello ,&lt;br&gt;&lt;br&gt;It was working good working with kvm management \
tools using libvirt . virsh/virt-manager .&lt;br&gt;&lt;br&gt;But then i got annoyed when \
management tool did not allow me to change the CPU model while creating new virtual \
machine .&lt;br&gt;error &lt;br&gt;&lt;br&gt;root@kvm-server qemu]# virt-install --virt-type kvm --name \
compute-2 --cpu Haswell-noTSX --ram=61440 --vcpus=20 --os-type=linux \
--os-variant=generic --disk \
compute2-disk0.qcow2,device=disk,bus=ide,size=300,sparse=true,format=qcow2 --pxe \
--network bridge=virbr0,model=e1000 --network bridge=virbr0,model=e1000 --network \
bridge=virbr0,model=virtio --network bridge=virbr0,model=virtio --graphics \
vnc,port=5906 --noautoconsole&lt;br&gt;&lt;br&gt;Starting install...&lt;br&gt;ERROR       unsupported \
configuration: guest and host CPU are not compatible: Host CPU does not provide \
required features: invpcid, erms, bmi2, smep, avx2, bmi1, fsgsbase, movbe, \
fma&lt;br&gt;Domain installation does not appear to have been successful.&lt;br&gt;&lt;br&gt;I could \
not resolve this error . &lt;br&gt;&lt;br&gt;Finally i came across the post which say that \
libvirt cross verifies   flags under CPU model present in \
&lt;br&gt;/usr/share/libvirt/cpu_map.xml and cat /proc/cpuinfo . &lt;br&gt;&lt;br&gt;An yes the flag \
complained were not present in host proc/cpuinfo. &lt;br&gt;&lt;br&gt;Question 1: Is it really \
needed for Libvirt to do this check . &lt;br&gt;&lt;br&gt;AS KVM seems to allow support Haswell \
with native commands . Why libvirt is doing this check then ? &lt;br&gt;&lt;br&gt;As i was not \
sure where the problem lies and i was using libvirt 2.0.0 version i upgraded to 2.5.0 \
by compiling form source .&lt;br&gt;But then i faces issue using virsh/virt-manager as seem \
it was not compatilble with upgarded version of libvirt.&lt;br&gt;&lt;br&gt;Now my system is \
little messed   around libvirt . I did reinstall/reboot   Quite many things not \
working . &lt;br&gt;&lt;br&gt;Question 2 : How can i restore original Libvirt 2.0.0 \
.&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;br aki&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170128161111</emailId><senderName>akhilesh rawat</senderName><senderEmail>akhileshrawat007@gmail.com</senderEmail><timestampReceived>2017-01-28 16:11:11-0400</timestampReceived><subject>[libvirt-users] libvirt does not show same CPU Model as /proc/cpuinfo for CPU Model info.</subject><body>

Hi ,

Created new thread .


Environment:
Bare Metal server + CentOs with qemu/KVM +libvirt for virtualization
Guest Instantiated with virt-install with forced CPU model like below
 virt-install --virt-type kvm --name compute-0 --cpu
Haswell,+fma,+movbe,+fsgsbase,+bmi1,+hle,+avx2,+smep,+bmi2,+erms,+invpcid,+rtm
--rama440 --vcpus  --os-type=linux --os-variant=generic

After guest installation  /proc/cpuinfo show model name as Haswell .
However Libvirt virsh capabilities show CPU configuration as "SandyBridge .
"

1. Could I get explanation of the why inconsistency .

2. Is this expected behaviour

3. Why libvirt does not show same CPU Model as /proc/cpuinfo for CPU Model
info.

My Aim : Nested Virtualization and Nested Guest needs CPU model as Haswell
strictly .

4. IS it possible alternative to succeed in my aim ?

Thanks a lot for support. !



Guest CPU config:
processor    : 19
vendor_id    : GenuineIntel
cpu family    : 6
model        : 60
model name    : Intel Core Processor (Haswell)
stepping    : 1
microcode    : 0x1
cpu MHz        : 1995.144
cache size    : 4096 KB
fpu        : yes
fpu_exception    : yes
cpuid level    : 13
wp        : yes
flags        : fpu de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov
pat pse36 clflush mmx fxsr sse sse2 syscall nx rdtscp lm constant_tsc
rep_good nopl eagerfpu pni pclmulqdq ssse3 cx16 pcid sse4_1 sse4_2 x2apic
popcnt tsc_deadline_timer aes xsave avx hypervisor lahf_lm xsaveopt
bogomips    : 4105.33
clflush size    : 64
cache_alignment    : 64
address sizes    : 46 bits physical, 48 bits virtual
power management:

&lt;capabilities&gt;

  &lt;host&gt;
    &lt;uuid&gt;95c4e625-3383-4ec1-9ee4-c47a87d93b97&lt;/uuid&gt;
    &lt;cpu&gt;
      &lt;arch&gt;x86_64&lt;/arch&gt;
      &lt;model&gt;SandyBridge&lt;/model&gt;
      &lt;vendor&gt;Intel&lt;/vendor&gt;
      &lt;topology sockets='20' cores='1' threads='1'/&gt;
      &lt;feature name='hypervisor'/&gt;
      &lt;feature name='osxsave'/&gt;
      &lt;feature name='pcid'/&gt;
      &lt;pages unit='KiB' size='4'/&gt;
      &lt;pages unit='KiB' size='2048'/&gt;




Host CPU config:
processor    : 23
vendor_id    : GenuineIntel
cpu family    : 6
model        : 45
model name    : Intel(R) Xeon(R) CPU E5-2620 0 @ 2.00GHz
stepping    : 7
microcode    : 0x710
cpu MHz        : 1200.000
cache size    : 15360 KB
physical id    : 1
siblings    : 12
core id        : 5
cpu cores    : 6
apicid        : 43
initial apicid    : 43
fpu        : yes
fpu_exception    : yes
cpuid level    : 13
wp        : yes
flags        : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca
cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx
pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl
xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor
ds_cpl vmx smx est tm2 ssse3 cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic
popcnt tsc_deadline_timer aes xsave avx lahf_lm ida arat epb pln pts dtherm
tpr_shadow vnmi flexpriority ept vpid xsaveopt
bogomips    : 4004.01
clflush size    : 64
cache_alignment    : 64
address sizes    : 46 bits physical, 48 bits virtual
power management:





Br Aki

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;Hi ,&lt;br&gt;&lt;br&gt;Created new thread .&lt;br&gt;&lt;br&gt;&lt;br&gt;Environment:&lt;br&gt;Bare \
Metal server + CentOs with qemu/KVM +libvirt for virtualization&lt;br&gt;Guest Instantiated \
with virt-install with forced CPU model like below&lt;br&gt;  virt-install --virt-type kvm \
--name compute-0 --cpu \
Haswell,+fma,+movbe,+fsgsbase,+bmi1,+hle,+avx2,+smep,+bmi2,+erms,+invpcid,+rtm \
--ram=61440 --vcpus=20 --os-type=linux --os-variant=generic &lt;br&gt;&lt;br&gt;After guest \
installation   /proc/cpuinfo show model name as Haswell . However Libvirt virsh \
capabilities show CPU configuration as "SandyBridge . "&lt;br&gt;&lt;br&gt;1. Could I \
get explanation of the why inconsistency .&lt;br&gt;&lt;br&gt;2. Is this expected \
behaviour&lt;br&gt;&lt;br&gt;3. Why libvirt does not show same CPU Model as /proc/cpuinfo for CPU \
Model info.&lt;br&gt;&lt;br&gt;My Aim : Nested Virtualization and Nested Guest needs CPU model as \
Haswell strictly . &lt;br&gt;&lt;br&gt;4. IS it possible alternative to succeed in my aim \
?&lt;br&gt;&lt;br&gt;Thanks a lot for support. !&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;Guest CPU config: \
&lt;br&gt;processor       : 19&lt;br&gt;vendor_id       : GenuineIntel&lt;br&gt;cpu family       : \
6&lt;br&gt;model              : 60&lt;br&gt;model name       : Intel Core Processor \
(Haswell)&lt;br&gt;stepping       : 1&lt;br&gt;microcode       : 0x1&lt;br&gt;cpu MHz              : \
1995.144&lt;br&gt;cache size       : 4096 KB&lt;br&gt;fpu              : yes&lt;br&gt;fpu_exception     \
: yes&lt;br&gt;cpuid level       : 13&lt;br&gt;wp              : yes&lt;br&gt;flags              : fpu \
de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse \
sse2 syscall nx rdtscp lm constant_tsc rep_good nopl eagerfpu pni pclmulqdq ssse3 \
cx16 pcid sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer aes xsave avx hypervisor \
lahf_lm xsaveopt&lt;br&gt;bogomips       : 4105.33&lt;br&gt;clflush size       : \
64&lt;br&gt;cache_alignment       : 64&lt;br&gt;address sizes       : 46 bits physical, 48 bits \
virtual&lt;br&gt;power management:&lt;br&gt;&lt;br&gt;&lt;capabilities&gt;&lt;br&gt;&lt;br&gt;   &lt;host&gt;&lt;br&gt;   \
&lt;uuid&gt;95c4e625-3383-4ec1-9ee4-c47a87d93b97&lt;/uuid&gt;&lt;br&gt;       \
&lt;cpu&gt;&lt;br&gt;           &lt;arch&gt;x86_64&lt;/arch&gt;&lt;br&gt;           \
&lt;model&gt;SandyBridge&lt;/model&gt;&lt;br&gt;           \
&lt;vendor&gt;Intel&lt;/vendor&gt;&lt;br&gt;           &lt;topology sockets='20' \
cores='1' threads='1'/&gt;&lt;br&gt;           &lt;feature \
name='hypervisor'/&gt;&lt;br&gt;           &lt;feature \
name='osxsave'/&gt;&lt;br&gt;           &lt;feature name='pcid'/&gt;&lt;br&gt;    \
&lt;pages unit='KiB' size='4'/&gt;&lt;br&gt;           &lt;pages \
unit='KiB' size='2048'/&gt; &lt;br&gt;  &lt;br&gt;&lt;br&gt;  &lt;br&gt;&lt;br&gt;Host CPU config: \
&lt;br&gt;processor       : 23&lt;br&gt;vendor_id       : GenuineIntel&lt;br&gt;cpu family       : \
6&lt;br&gt;model              : 45&lt;br&gt;model name       : Intel(R) Xeon(R) CPU E5-2620 0 @ \
2.00GHz&lt;br&gt;stepping       : 7&lt;br&gt;microcode       : 0x710&lt;br&gt;cpu MHz              : \
1200.000&lt;br&gt;cache size       : 15360 KB&lt;br&gt;physical id       : 1&lt;br&gt;siblings       : \
12&lt;br&gt;core id              : 5&lt;br&gt;cpu cores       : 6&lt;br&gt;apicid              : \
43&lt;br&gt;initial apicid       : 43&lt;br&gt;fpu              : yes&lt;br&gt;fpu_exception       : \
yes&lt;br&gt;cpuid level       : 13&lt;br&gt;wp              : yes&lt;br&gt;flags              : fpu \
vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi \
mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon \
pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 \
monitor ds_cpl vmx smx est tm2 ssse3 cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic \
popcnt tsc_deadline_timer aes xsave avx lahf_lm ida arat epb pln pts dtherm \
tpr_shadow vnmi flexpriority ept vpid xsaveopt&lt;br&gt;bogomips       : 4004.01&lt;br&gt;clflush \
size       : 64&lt;br&gt;cache_alignment       : 64&lt;br&gt;address sizes       : 46 bits \
physical, 48 bits virtual&lt;br&gt;power management:&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;Br \
Aki&lt;br&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170126200718</emailId><senderName>Jeroen Hoekx</senderName><senderEmail>jeroen@hoekx.be</senderEmail><timestampReceived>2017-01-26 20:07:18-0400</timestampReceived><subject>[libvirt-users] Libvirt 3.0 machine start fails on LVM</subject><body>

Hello,

Since updating to libvirt 3.0 I am no longer able to create a virtual
machine that is backed by LVM storage on my two Arch machines.

This is the error in virt-manager:

Unable to complete install: 'An error occurred, but the cause is unknown'

Traceback (most recent call last):
  File "/usr/share/virt-manager/virtManager/asyncjob.py", line 88, in cb_wrapper
    callback(asyncjob, *args, **kwargs)
  File "/usr/share/virt-manager/virtManager/create.py", line 2288, in
_do_async_install
    guest.start_install(meter=meter)
  File "/usr/share/virt-manager/virtinst/guest.py", line 461, in start_install
    doboot, transient)
  File "/usr/share/virt-manager/virtinst/guest.py", line 396, in _create_guest
    self.domain = self.conn.createXML(install_xml or final_xml, 0)
  File "/usr/lib/python2.7/site-packages/libvirt.py", line 3773, in createXML
    if ret is None:raise libvirtError('virDomainCreateXML() failed', conn=self)
libvirtError: An error occurred, but the cause is unknown

I originally encountered the problem when running my Ansible modules
for libvirt in https://github.com/ansible-provisioning/ansible-provisioning
, so the issue is not virt-manager specific.

Steps to reproduce in virt-manager (1.4.0-3):
- create a new VM
- choose import existing disk image
- create a new logical volume when browsing to find the existing image
path or select a lv that was manually created before.
- click forward
- click forward
- click finish

When using qcow2 storage, both virt-manager and my modules work fine.
This was also working on previous versions of libvirt. I do not see
any changes in compilation flags in the Arch packages.

Is there anything I can do to help diagnose this issue?

Greetings,

Jeroen

</body></email><email><emailId>20170131120716</emailId><senderName>Michal Privoznik</senderName><senderEmail>mprivozn@redhat.com</senderEmail><timestampReceived>2017-01-31 12:07:16-0400</timestampReceived><subject>Re: [libvirt-users] Libvirt 3.0 machine start fails on LVM</subject><body>

On 01/26/2017 09:07 PM, Jeroen Hoekx wrote:
&gt; Hello,
&gt; 
&gt; Since updating to libvirt 3.0 I am no longer able to create a virtual
&gt; machine that is backed by LVM storage on my two Arch machines.
&gt; 
&gt; This is the error in virt-manager:
&gt; 
&gt; Unable to complete install: 'An error occurred, but the cause is unknown'

This is likely a namespace bug. There are patches on the list to fix the
issue [1], but lacking any review. Can you try applying them and see
whether they fix your problem?

1: https://www.redhat.com/archives/libvir-list/2017-January/msg01127.html

Michal

</body></email><email><emailId>20170130211343</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-01-30 21:13:43-0400</timestampReceived><subject>Re: [libvirt-users] libvirt does not show same CPU Model as /proc/cpuinfo for CPU Model info.</subject><body>


On Sat, Jan 28, 2017 at 09:29:11PM +0530, akhilesh rawat wrote:
&gt;Hi ,
&gt;
&gt;Created new thread .
&gt;
&gt;
&gt;Environment:
&gt;Bare Metal server + CentOs with qemu/KVM +libvirt for virtualization
&gt;Guest Instantiated with virt-install with forced CPU model like below
&gt; virt-install --virt-type kvm --name compute-0 --cpu
&gt;Haswell,+fma,+movbe,+fsgsbase,+bmi1,+hle,+avx2,+smep,+bmi2,+erms,+invpcid,+rtm
&gt;--rama440 --vcpus  --os-type=linux --os-variant=generic
&gt;
&gt;After guest installation  /proc/cpuinfo show model name as Haswell .
&gt;However Libvirt virsh capabilities show CPU configuration as "SandyBridge .
&gt;"
&gt;

You are running the 'virsh capablities' in the guest as well, right?

Make sure you have same versions of libvirt in the guest and the host
so that they have the same CPU specifications

&gt;1. Could I get explanation of the why inconsistency .
&gt;
&gt;2. Is this expected behaviour
&gt;
&gt;3. Why libvirt does not show same CPU Model as /proc/cpuinfo for CPU Model
&gt;info.
&gt;
&gt;My Aim : Nested Virtualization and Nested Guest needs CPU model as Haswell
&gt;strictly .
&gt;
&gt;4. IS it possible alternative to succeed in my aim ?
&gt;
&gt;Thanks a lot for support. !
&gt;
&gt;
&gt;
&gt;Guest CPU config:
&gt;processor    : 19
&gt;vendor_id    : GenuineIntel
&gt;cpu family    : 6
&gt;model        : 60
&gt;model name    : Intel Core Processor (Haswell)
&gt;stepping    : 1
&gt;microcode    : 0x1
&gt;cpu MHz        : 1995.144
&gt;cache size    : 4096 KB
&gt;fpu        : yes
&gt;fpu_exception    : yes
&gt;cpuid level    : 13
&gt;wp        : yes
&gt;flags        : fpu de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov
&gt;pat pse36 clflush mmx fxsr sse sse2 syscall nx rdtscp lm constant_tsc
&gt;rep_good nopl eagerfpu pni pclmulqdq ssse3 cx16 pcid sse4_1 sse4_2 x2apic
&gt;popcnt tsc_deadline_timer aes xsave avx hypervisor lahf_lm xsaveopt
&gt;bogomips    : 4105.33
&gt;clflush size    : 64
&gt;cache_alignment    : 64
&gt;address sizes    : 46 bits physical, 48 bits virtual
&gt;power management:
&gt;
&gt;&lt;capabilities&gt;
&gt;
&gt;  &lt;host&gt;
&gt;    &lt;uuid&gt;95c4e625-3383-4ec1-9ee4-c47a87d93b97&lt;/uuid&gt;
&gt;    &lt;cpu&gt;
&gt;      &lt;arch&gt;x86_64&lt;/arch&gt;
&gt;      &lt;model&gt;SandyBridge&lt;/model&gt;
&gt;      &lt;vendor&gt;Intel&lt;/vendor&gt;
&gt;      &lt;topology sockets='20' cores='1' threads='1'/&gt;
&gt;      &lt;feature name='hypervisor'/&gt;
&gt;      &lt;feature name='osxsave'/&gt;
&gt;      &lt;feature name='pcid'/&gt;
&gt;      &lt;pages unit='KiB' size='4'/&gt;
&gt;      &lt;pages unit='KiB' size='2048'/&gt;
&gt;
&gt;
&gt;
&gt;
&gt;Host CPU config:
&gt;processor    : 23
&gt;vendor_id    : GenuineIntel
&gt;cpu family    : 6
&gt;model        : 45
&gt;model name    : Intel(R) Xeon(R) CPU E5-2620 0 @ 2.00GHz
&gt;stepping    : 7
&gt;microcode    : 0x710
&gt;cpu MHz        : 1200.000
&gt;cache size    : 15360 KB
&gt;physical id    : 1
&gt;siblings    : 12
&gt;core id        : 5
&gt;cpu cores    : 6
&gt;apicid        : 43
&gt;initial apicid    : 43
&gt;fpu        : yes
&gt;fpu_exception    : yes
&gt;cpuid level    : 13
&gt;wp        : yes
&gt;flags        : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca
&gt;cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx
&gt;pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl
&gt;xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor
&gt;ds_cpl vmx smx est tm2 ssse3 cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic
&gt;popcnt tsc_deadline_timer aes xsave avx lahf_lm ida arat epb pln pts dtherm
&gt;tpr_shadow vnmi flexpriority ept vpid xsaveopt
&gt;bogomips    : 4004.01
&gt;clflush size    : 64
&gt;cache_alignment    : 64
&gt;address sizes    : 46 bits physical, 48 bits virtual
&gt;power management:
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;Br Aki

&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170124080241</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-01-24 08:02:41-0400</timestampReceived><subject>Re: [libvirt-users] LibVirt query CPU Model support and restore operation</subject><body>


On Tue, Jan 24, 2017 at 10:08:12AM +0530, akhilesh rawat wrote:
&gt;Hello ,
&gt;
&gt;It was working good working with kvm management tools using libvirt .
&gt;virsh/virt-manager .
&gt;
&gt;But then i got annoyed when management tool did not allow me to change the
&gt;CPU model while creating new virtual machine .
&gt;error
&gt;

Are we talking about the same host?

&gt;root@kvm-server qemu]# virt-install --virt-type kvm --name compute-2 --cpu
&gt;Haswell-noTSX --rama440 --vcpus  --os-type=linux --os-variant=generic
&gt;--disk
&gt;compute2-disk0.qcow2,device=disk,bus=ide,size00,sparse=true,format=qcow2
&gt;--pxe --network bridge=virbr0,modelá000 --network
&gt;bridge=virbr0,modelá000 --network bridge=virbr0,model=virtio --network
&gt;bridge=virbr0,model=virtio --graphics vnc,portY06 --noautoconsole
&gt;
&gt;Starting install...
&gt;ERROR    unsupported configuration: guest and host CPU are not compatible:
&gt;Host CPU does not provide required features: invpcid, erms, bmi2, smep,
&gt;avx2, bmi1, fsgsbase, movbe, fma
&gt;Domain installation does not appear to have been successful.
&gt;
&gt;I could not resolve this error .
&gt;

You could've just used -cpu host-model-only.

&gt;Finally i came across the post which say that libvirt cross verifies  flags
&gt;under CPU model present in
&gt;/usr/share/libvirt/cpu_map.xml and cat /proc/cpuinfo .
&gt;
&gt;An yes the flag complained were not present in host proc/cpuinfo.
&gt;
&gt;Question 1: Is it really needed for Libvirt to do this check .
&gt;

It is, otherwise users might not get what they asked for.  Or it might
be software-emulated.

&gt;AS KVM seems to allow support Haswell with native commands . Why libvirt is
&gt;doing this check then ?
&gt;
&gt;As i was not sure where the problem lies and i was using libvirt 2.0.0
&gt;version i upgraded to 2.5.0 by compiling form source .
&gt;But then i faces issue using virsh/virt-manager as seem it was not
&gt;compatilble with upgarded version of libvirt.
&gt;
&gt;Now my system is little messed  around libvirt . I did reinstall/reboot
&gt;Quite many things not working .
&gt;
&gt;Question 2 : How can i restore original Libvirt 2.0.0 .
&gt;

Depends on your distro.  You can just uninstall and install the older
version if your package managed doesn't support downgrading.  But try to
keep on the newer one and fix your workflow.

&gt;
&gt;br aki

&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170124110314</emailId><senderName>akhilesh rawat</senderName><senderEmail>akhileshrawat007@gmail.com</senderEmail><timestampReceived>2017-01-24 11:03:14-0400</timestampReceived><subject>Re: [libvirt-users] LibVirt query CPU Model support and restore operation</subject><body>

hi,

yes we are talking about same host here.

You could've just used -cpu host-model-only
&gt;&gt; I dont want to host model ( it is working with host model) .

AS KVM seems to allow support Haswell with native commands . Does this mean
in my case KVM is allowing software emulated cpu model.

Can libvirt allow  software-emulated for non host model ?  if yes how .

thanks





On Tue, Jan 24, 2017 at 1:32 PM, Martin Kletzander &lt;mkletzan@redhat.com&gt;
wrote:

&gt; On Tue, Jan 24, 2017 at 10:08:12AM +0530, akhilesh rawat wrote:
&gt;
&gt;&gt; Hello ,
&gt;&gt;
&gt;&gt; It was working good working with kvm management tools using libvirt .
&gt;&gt; virsh/virt-manager .
&gt;&gt;
&gt;&gt; But then i got annoyed when management tool did not allow me to change the
&gt;&gt; CPU model while creating new virtual machine .
&gt;&gt; error
&gt;&gt;
&gt;&gt;
&gt; Are we talking about the same host?
&gt;
&gt; root@kvm-server qemu]# virt-install --virt-type kvm --name compute-2 --cpu
&gt;&gt; Haswell-noTSX --rama440 --vcpus  --os-type=linux --os-variant=generic
&gt;&gt; --disk
&gt;&gt; compute2-disk0.qcow2,device=disk,bus=ide,size00,sparse=tru
&gt;&gt; e,format=qcow2
&gt;&gt; --pxe --network bridge=virbr0,modelá000 --network
&gt;&gt; bridge=virbr0,modelá000 --network bridge=virbr0,model=virtio --network
&gt;&gt; bridge=virbr0,model=virtio --graphics vnc,portY06 --noautoconsole
&gt;&gt;
&gt;&gt; Starting install...
&gt;&gt; ERROR    unsupported configuration: guest and host CPU are not compatible:
&gt;&gt; Host CPU does not provide required features: invpcid, erms, bmi2, smep,
&gt;&gt; avx2, bmi1, fsgsbase, movbe, fma
&gt;&gt; Domain installation does not appear to have been successful.
&gt;&gt;
&gt;&gt; I could not resolve this error .
&gt;&gt;
&gt;&gt;
&gt; You could've just used -cpu host-model-only.
&gt;
&gt; Finally i came across the post which say that libvirt cross verifies  flags
&gt;&gt; under CPU model present in
&gt;&gt; /usr/share/libvirt/cpu_map.xml and cat /proc/cpuinfo .
&gt;&gt;
&gt;&gt; An yes the flag complained were not present in host proc/cpuinfo.
&gt;&gt;
&gt;&gt; Question 1: Is it really needed for Libvirt to do this check .
&gt;&gt;
&gt;&gt;
&gt; It is, otherwise users might not get what they asked for.  Or it might
&gt; be software-emulated.
&gt;
&gt; AS KVM seems to allow support Haswell with native commands . Why libvirt is
&gt;&gt; doing this check then ?
&gt;&gt;
&gt;&gt; As i was not sure where the problem lies and i was using libvirt 2.0.0
&gt;&gt; version i upgraded to 2.5.0 by compiling form source .
&gt;&gt; But then i faces issue using virsh/virt-manager as seem it was not
&gt;&gt; compatilble with upgarded version of libvirt.
&gt;&gt;
&gt;&gt; Now my system is little messed  around libvirt . I did reinstall/reboot
&gt;&gt; Quite many things not working .
&gt;&gt;
&gt;&gt; Question 2 : How can i restore original Libvirt 2.0.0 .
&gt;&gt;
&gt;&gt;
&gt; Depends on your distro.  You can just uninstall and install the older
&gt; version if your package managed doesn't support downgrading.  But try to
&gt; keep on the newer one and fix your workflow.
&gt;
&gt;
&gt;&gt; br aki
&gt;&gt;
&gt;
&gt; _______________________________________________
&gt;&gt; libvirt-users mailing list
&gt;&gt; libvirt-users@redhat.com
&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;hi,&lt;br&gt;&lt;br&gt;&lt;/div&gt;yes we are talking about same \
host here. &lt;br&gt;&lt;br&gt;You could've just used -cpu host-model-only&lt;br&gt;&lt;/div&gt;&gt;&gt; \
I dont want to host model ( it is working with host model) .&lt;br&gt;&lt;br&gt;&lt;span \
class="gmail-"&gt;AS KVM seems to allow support Haswell with native commands . Does this \
mean in my case KVM is allowing software emulated cpu model.   \
&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;Can libvirt allow   software-emulated for non host model ?   if \
yes how .&lt;br&gt;&lt;br&gt;&lt;/div&gt;thanks&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;span \
class="gmail-"&gt;&lt;/span&gt;&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;On Tue, Jan 24, 2017 at 1:32 PM, \
Martin Kletzander &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:mkletzan@redhat.com" \
target="_blank"&gt;mkletzan@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt;&lt;span class="gmail-"&gt;On Tue, Jan 24, 2017 at \
10:08:12AM +0530, akhilesh rawat wrote:&lt;br&gt; &lt;blockquote class="gmail_quote" \
style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt; Hello ,&lt;br&gt;
&lt;br&gt;
It was working good working with kvm management tools using libvirt .&lt;br&gt;
virsh/virt-manager .&lt;br&gt;
&lt;br&gt;
But then i got annoyed when management tool did not allow me to change the&lt;br&gt;
CPU model while creating new virtual machine .&lt;br&gt;
error&lt;br&gt;
&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;&lt;/span&gt;
Are we talking about the same host?&lt;span class="gmail-"&gt;&lt;br&gt;
&lt;br&gt;
&lt;blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt; root@kvm-server qemu]# virt-install --virt-type \
kvm --name compute-2 --cpu&lt;br&gt; Haswell-noTSX --ram=61440 --vcpus=20 --os-type=linux \
                --os-variant=generic&lt;br&gt;
--disk&lt;br&gt;
compute2-disk0.qcow2,device=di&lt;wbr&gt;sk,bus=ide,size=300,sparse=tru&lt;wbr&gt;e,format=qcow2&lt;br&gt;
                
--pxe --network bridge=virbr0,model=e1000 --network&lt;br&gt;
bridge=virbr0,model=e1000 --network bridge=virbr0,model=virtio --network&lt;br&gt;
bridge=virbr0,model=virtio --graphics vnc,port=5906 --noautoconsole&lt;br&gt;
&lt;br&gt;
Starting install...&lt;br&gt;
ERROR      unsupported configuration: guest and host CPU are not compatible:&lt;br&gt;
Host CPU does not provide required features: invpcid, erms, bmi2, smep,&lt;br&gt;
avx2, bmi1, fsgsbase, movbe, fma&lt;br&gt;
Domain installation does not appear to have been successful.&lt;br&gt;
&lt;br&gt;
I could not resolve this error .&lt;br&gt;
&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;&lt;/span&gt;
You could've just used -cpu host-model-only.&lt;span class="gmail-"&gt;&lt;br&gt;
&lt;br&gt;
&lt;blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt; Finally i came across the post which say that \
libvirt cross verifies   flags&lt;br&gt; under CPU model present in&lt;br&gt;
/usr/share/libvirt/cpu_map.xml and cat /proc/cpuinfo .&lt;br&gt;
&lt;br&gt;
An yes the flag complained were not present in host proc/cpuinfo.&lt;br&gt;
&lt;br&gt;
Question 1: Is it really needed for Libvirt to do this check .&lt;br&gt;
&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;&lt;/span&gt;
It is, otherwise users might not get what they asked for.   Or it might&lt;br&gt;
be software-emulated.&lt;span class="gmail-"&gt;&lt;br&gt;
&lt;br&gt;
&lt;blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt; AS KVM seems to allow support Haswell with native \
commands . Why libvirt is&lt;br&gt; doing this check then ?&lt;br&gt;
&lt;br&gt;
As i was not sure where the problem lies and i was using libvirt 2.0.0&lt;br&gt;
version i upgraded to 2.5.0 by compiling form source .&lt;br&gt;
But then i faces issue using virsh/virt-manager as seem it was not&lt;br&gt;
compatilble with upgarded version of libvirt.&lt;br&gt;
&lt;br&gt;
Now my system is little messed   around libvirt . I did reinstall/reboot&lt;br&gt;
Quite many things not working .&lt;br&gt;
&lt;br&gt;
Question 2 : How can i restore original Libvirt 2.0.0 .&lt;br&gt;
&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;&lt;/span&gt;
Depends on your distro.   You can just uninstall and install the older&lt;br&gt;
version if your package managed doesn't support downgrading.   But try to&lt;br&gt;
keep on the newer one and fix your workflow.&lt;br&gt;
&lt;br&gt;
&lt;blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt; &lt;br&gt;
br aki&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;
&lt;blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid \
rgb(204,204,204);padding-left:1ex"&gt; \
______________________________&lt;wbr&gt;_________________&lt;br&gt; libvirt-users mailing \
list&lt;br&gt; &lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt; \
&lt;/blockquote&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;



</body></email><email><emailId>20170124115705</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-01-24 11:57:05-0400</timestampReceived><subject>Re: [libvirt-users] LibVirt query CPU Model support and restore operation</subject><body>


On Tue, Jan 24, 2017 at 04:21:14PM +0530, akhilesh rawat wrote:
&gt;hi,
&gt;
&gt;yes we are talking about same host here.
&gt;
&gt;You could've just used -cpu host-model-only
&gt;&gt;&gt; I dont want to host model ( it is working with host model) .
&gt;
&gt;AS KVM seems to allow support Haswell with native commands . Does this mean
&gt;in my case KVM is allowing software emulated cpu model.
&gt;

I don't remember if it gets emulated or just dropped.  Do you remember
if you saw those in /proc/cpuinfo in the guest?  Maybe QEMU just dropped
them on startup.  I believe that was why we added the code that checks
for it.

&gt;Can libvirt allow  software-emulated for non host model ?  if yes how .
&gt;

You can force each feature, that way it could work, but I'm not sure
with all the refactoring that was there.

&gt;thanks
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;On Tue, Jan 24, 2017 at 1:32 PM, Martin Kletzander &lt;mkletzan@redhat.com&gt;
&gt;wrote:
&gt;
&gt;&gt; On Tue, Jan 24, 2017 at 10:08:12AM +0530, akhilesh rawat wrote:
&gt;&gt;
&gt;&gt;&gt; Hello ,
&gt;&gt;&gt;
&gt;&gt;&gt; It was working good working with kvm management tools using libvirt .
&gt;&gt;&gt; virsh/virt-manager .
&gt;&gt;&gt;
&gt;&gt;&gt; But then i got annoyed when management tool did not allow me to change the
&gt;&gt;&gt; CPU model while creating new virtual machine .
&gt;&gt;&gt; error
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt; Are we talking about the same host?
&gt;&gt;
&gt;&gt; root@kvm-server qemu]# virt-install --virt-type kvm --name compute-2 --cpu
&gt;&gt;&gt; Haswell-noTSX --rama440 --vcpus  --os-type=linux --os-variant=generic
&gt;&gt;&gt; --disk
&gt;&gt;&gt; compute2-disk0.qcow2,device=disk,bus=ide,size00,sparse=tru
&gt;&gt;&gt; e,format=qcow2
&gt;&gt;&gt; --pxe --network bridge=virbr0,modelá000 --network
&gt;&gt;&gt; bridge=virbr0,modelá000 --network bridge=virbr0,model=virtio --network
&gt;&gt;&gt; bridge=virbr0,model=virtio --graphics vnc,portY06 --noautoconsole
&gt;&gt;&gt;
&gt;&gt;&gt; Starting install...
&gt;&gt;&gt; ERROR    unsupported configuration: guest and host CPU are not compatible:
&gt;&gt;&gt; Host CPU does not provide required features: invpcid, erms, bmi2, smep,
&gt;&gt;&gt; avx2, bmi1, fsgsbase, movbe, fma
&gt;&gt;&gt; Domain installation does not appear to have been successful.
&gt;&gt;&gt;
&gt;&gt;&gt; I could not resolve this error .
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt; You could've just used -cpu host-model-only.
&gt;&gt;
&gt;&gt; Finally i came across the post which say that libvirt cross verifies  flags
&gt;&gt;&gt; under CPU model present in
&gt;&gt;&gt; /usr/share/libvirt/cpu_map.xml and cat /proc/cpuinfo .
&gt;&gt;&gt;
&gt;&gt;&gt; An yes the flag complained were not present in host proc/cpuinfo.
&gt;&gt;&gt;
&gt;&gt;&gt; Question 1: Is it really needed for Libvirt to do this check .
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt; It is, otherwise users might not get what they asked for.  Or it might
&gt;&gt; be software-emulated.
&gt;&gt;
&gt;&gt; AS KVM seems to allow support Haswell with native commands . Why libvirt is
&gt;&gt;&gt; doing this check then ?
&gt;&gt;&gt;
&gt;&gt;&gt; As i was not sure where the problem lies and i was using libvirt 2.0.0
&gt;&gt;&gt; version i upgraded to 2.5.0 by compiling form source .
&gt;&gt;&gt; But then i faces issue using virsh/virt-manager as seem it was not
&gt;&gt;&gt; compatilble with upgarded version of libvirt.
&gt;&gt;&gt;
&gt;&gt;&gt; Now my system is little messed  around libvirt . I did reinstall/reboot
&gt;&gt;&gt; Quite many things not working .
&gt;&gt;&gt;
&gt;&gt;&gt; Question 2 : How can i restore original Libvirt 2.0.0 .
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt; Depends on your distro.  You can just uninstall and install the older
&gt;&gt; version if your package managed doesn't support downgrading.  But try to
&gt;&gt; keep on the newer one and fix your workflow.
&gt;&gt;
&gt;&gt;
&gt;&gt;&gt; br aki
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt;&gt; libvirt-users mailing list
&gt;&gt;&gt; libvirt-users@redhat.com
&gt;&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;&gt;
&gt;&gt;

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170125090600</emailId><senderName>Jiri Denemark</senderName><senderEmail>jdenemar@redhat.com</senderEmail><timestampReceived>2017-01-25 09:06:00-0400</timestampReceived><subject>Re: [libvirt-users] LibVirt query CPU Model support and restore operation</subject><body>

On Tue, Jan 24, 2017 at 16:21:14 +0530, akhilesh rawat wrote:
&gt; hi,
&gt; 
&gt; yes we are talking about same host here.
&gt; 
&gt; You could've just used -cpu host-model-only
&gt; &gt;&gt; I dont want to host model ( it is working with host model) .
&gt; 
&gt; AS KVM seems to allow support Haswell with native commands . Does this mean
&gt; in my case KVM is allowing software emulated cpu model.

No, QEMU will just drop the features which are not supported on your
host. Although there are some rare exceptions, such as x2apic, which can
be emulated even with KVM.

Anyway, starting QEMU directly should print several warnings about
features which are dropped. And when you start QEMU with
-cpu Haswell,enforce it should refuse to start.

&gt; Can libvirt allow  software-emulated for non host model ?  if yes how .

You can bypass the libvirt check for specific features by setting the
feature policy to "force" (no idea if this can be done with
virt-install), but QEMU will still do the check itself and either drop
the features or refuse to start (with enforce) if they cannot be used on
the host.

Jirka

</body></email><email><emailId>20170127083044</emailId><senderName>akhilesh rawat</senderName><senderEmail>akhileshrawat007@gmail.com</senderEmail><timestampReceived>2017-01-27 08:30:44-0400</timestampReceived><subject>Re: [libvirt-users] LibVirt query CPU Model support and restore operation</subject><body>

hello ,

thanks for comments .

I tried now with force options for CPU flag which were not supported . Now
the command with non fully supported CPU model gets executed ,  But i am
surprised to see that still Guest  cpu model is not changed and still same
as host cpu model(SAndy Bridge)

Why don't i see the model as HAswell now , could you please comment.

Command used :

virt-install --virt-type kvm --name controller-0  --cpu
Haswell-noTSX,+fma,+movbe,+fsgsbase,+bmi1,+avx2,+smep,+bmi2,+erms,+invpcid
--ram=8120 --vcpus=4,sockets=1

Linux process for KVM :

7479     1 37 10:13 ?        01:13:21 /usr/libexec/qemu-kvm -name
controller-0 -S -machine pc-i440fx-rhel7.0.0,accel=kvm,usb=off *-cpu
SandyBridge,*+fma,+pcid,+movbe,+fsgsbase,+bmi1,+avx2,+smep,+bmi2,+erms,+invpcid
-m 8120 -realtime mlock=off -smp 4,sockets=1,cores=4,threads=1



cpu guest :
processor    : 0
vendor_id    : GenuineIntel
cpu family    : 6
model        : 42
model name    : Intel Xeon E312xx (Sandy Bridge)
stepping    : 1
microcode    : 0x1
cpu MHz        : 1994.450
cache size    : 4096 KB
physical id    : 0
siblings    : 4
core id        : 0
cpu cores    : 4
apicid        : 0
initial apicid    : 0
fpu        : yes
fpu_exception    : yes
cpuid level    : 13
wp        : yes
flags        : fpu de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov
pat pse36 clflush mmx fxsr sse sse2 ht syscall nx rdtscp lm constant_tsc
rep_good nopl eagerfpu pni pclmulqdq ssse3 cx16 pcid sse4_1 sse4_2 x2apic
popcnt tsc_deadline_timer aes xsave avx hypervisor lahf_lm xsaveopt
bogomips    : 3988.90
clflush size    : 64
cache_alignment    : 64
address sizes    : 46 bits physical, 48 bits virtual
power management:


CPU Host :

processor    : 0
vendor_id    : GenuineIntel
cpu family    : 6
model        : 45
model name    : Intel(R) Xeon(R) CPU E5-2620 0 @ 2.00GHz
stepping    : 7
microcode    : 0x710
cpu MHz        : 1200.000
cache size    : 15360 KB
physical id    : 0
siblings    : 12
core id        : 0
cpu cores    : 6
apicid        : 0
initial apicid    : 0
fpu        : yes
fpu_exception    : yes
cpuid level    : 13
wp        : yes
flags        : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca
cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx
pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl
xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor
ds_cpl vmx smx est tm2 ssse3 cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic
popcnt tsc_deadline_timer aes xsave avx lahf_lm ida arat epb pln pts dtherm
tpr_shadow vnmi flexpriority ept vpid xsaveopt
bogomips    : 3990.17
clflush size    : 64
cache_alignment    : 64
address sizes    : 46 bits physical, 48 bits virtual
power management:


Thanks
Aki


On Wed, Jan 25, 2017 at 2:36 PM, Jiri Denemark &lt;jdenemar@redhat.com&gt; wrote:

&gt; On Tue, Jan 24, 2017 at 16:21:14 +0530, akhilesh rawat wrote:
&gt; &gt; hi,
&gt; &gt;
&gt; &gt; yes we are talking about same host here.
&gt; &gt;
&gt; &gt; You could've just used -cpu host-model-only
&gt; &gt; &gt;&gt; I dont want to host model ( it is working with host model) .
&gt; &gt;
&gt; &gt; AS KVM seems to allow support Haswell with native commands . Does this
&gt; mean
&gt; &gt; in my case KVM is allowing software emulated cpu model.
&gt;
&gt; No, QEMU will just drop the features which are not supported on your
&gt; host. Although there are some rare exceptions, such as x2apic, which can
&gt; be emulated even with KVM.
&gt;
&gt; Anyway, starting QEMU directly should print several warnings about
&gt; features which are dropped. And when you start QEMU with
&gt; -cpu Haswell,enforce it should refuse to start.
&gt;
&gt; &gt; Can libvirt allow  software-emulated for non host model ?  if yes how .
&gt;
&gt; You can bypass the libvirt check for specific features by setting the
&gt; feature policy to "force" (no idea if this can be done with
&gt; virt-install), but QEMU will still do the check itself and either drop
&gt; the features or refuse to start (with enforce) if they cannot be used on
&gt; the host.
&gt;
&gt; Jirka
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;hello , &lt;br&gt;&lt;br&gt;&lt;/div&gt;thanks for \
comments . &lt;br&gt;&lt;br&gt;&lt;/div&gt;I tried now with force options for CPU flag which were not \
supported . Now the command with non fully supported CPU model gets executed ,   But \
i am surprised to see that still Guest   cpu model is not changed and still same as \
host cpu model(SAndy Bridge) &lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Why don't i see the model as \
HAswell now , could you please comment. &lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Command used \
:&lt;br&gt;&lt;br&gt;&lt;/div&gt;virt-install --virt-type kvm --name controller-0   --cpu \
Haswell-noTSX,+fma,+movbe,+fsgsbase,+bmi1,+avx2,+smep,+bmi2,+erms,+invpcid --ram=8120 \
--vcpus=4,sockets=1 &lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Linux process for KVM : &lt;br&gt;&lt;br&gt;7479         1 \
37 10:13 ?               01:13:21 /usr/libexec/qemu-kvm -name controller-0 -S \
-machine pc-i440fx-rhel7.0.0,accel=kvm,usb=off &lt;b&gt;-cpu \
SandyBridge,&lt;/b&gt;+fma,+pcid,+movbe,+fsgsbase,+bmi1,+avx2,+smep,+bmi2,+erms,+invpcid -m \
8120 -realtime mlock=off -smp \
4,sockets=1,cores=4,threads=1&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;cpu guest \
:&lt;br&gt;processor       : 0&lt;br&gt;vendor_id       : GenuineIntel&lt;br&gt;cpu family       : \
6&lt;br&gt;model              : 42&lt;br&gt;model name       : Intel Xeon E312xx (Sandy \
Bridge)&lt;br&gt;stepping       : 1&lt;br&gt;microcode       : 0x1&lt;br&gt;cpu MHz              : \
1994.450&lt;br&gt;cache size       : 4096 KB&lt;br&gt;physical id       : 0&lt;br&gt;siblings       : \
4&lt;br&gt;core id              : 0&lt;br&gt;cpu cores       : 4&lt;br&gt;apicid              : \
0&lt;br&gt;initial apicid       : 0&lt;br&gt;fpu              : yes&lt;br&gt;fpu_exception       : \
yes&lt;br&gt;cpuid level       : 13&lt;br&gt;wp              : yes&lt;br&gt;flags              : fpu de \
pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse \
sse2 ht syscall nx rdtscp lm constant_tsc rep_good nopl eagerfpu pni pclmulqdq ssse3 \
cx16 pcid sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer aes xsave avx hypervisor \
lahf_lm xsaveopt&lt;br&gt;bogomips       : 3988.90&lt;br&gt;clflush size       : \
64&lt;br&gt;cache_alignment       : 64&lt;br&gt;address sizes       : 46 bits physical, 48 bits \
virtual&lt;br&gt;power management:&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;CPU Host :&lt;br&gt;&lt;br&gt;processor       : \
0&lt;br&gt;vendor_id       : GenuineIntel&lt;br&gt;cpu family       : 6&lt;br&gt;model              : \
45&lt;br&gt;model name       : Intel(R) Xeon(R) CPU E5-2620 0 @ 2.00GHz&lt;br&gt;stepping       : \
7&lt;br&gt;microcode       : 0x710&lt;br&gt;cpu MHz              : 1200.000&lt;br&gt;cache size       : \
15360 KB&lt;br&gt;physical id       : 0&lt;br&gt;siblings       : 12&lt;br&gt;core id              : \
0&lt;br&gt;cpu cores       : 6&lt;br&gt;apicid              : 0&lt;br&gt;initial apicid       : \
0&lt;br&gt;fpu              : yes&lt;br&gt;fpu_exception       : yes&lt;br&gt;cpuid level       : \
13&lt;br&gt;wp              : yes&lt;br&gt;flags              : fpu vme de pse tsc msr pae mce \
cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm \
pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl \
xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx \
est tm2 ssse3 cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer \
aes xsave avx lahf_lm ida arat epb pln pts dtherm tpr_shadow vnmi flexpriority ept \
vpid xsaveopt&lt;br&gt;bogomips       : 3990.17&lt;br&gt;clflush size       : \
64&lt;br&gt;cache_alignment       : 64&lt;br&gt;address sizes       : 46 bits physical, 48 bits \
virtual&lt;br&gt;power management:&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;Thanks \
&lt;br&gt;&lt;/div&gt;Aki&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="gmail_extra"&gt;&lt;br&gt;&lt;div \
class="gmail_quote"&gt;On Wed, Jan 25, 2017 at 2:36 PM, Jiri Denemark &lt;span \
dir="ltr"&gt;&lt;&lt;a href="mailto:jdenemar@redhat.com" \
target="_blank"&gt;jdenemar@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span class=""&gt;On Tue, Jan 24, 2017 at 16:21:14 +0530, \
akhilesh rawat wrote:&lt;br&gt; &gt; hi,&lt;br&gt;
&gt;&lt;br&gt;
&gt; yes we are talking about same host here.&lt;br&gt;
&gt;&lt;br&gt;
&gt; You could've just used -cpu host-model-only&lt;br&gt;
&gt; &gt;&gt; I dont want to host model ( it is working with host model) .&lt;br&gt;
&gt;&lt;br&gt;
&gt; AS KVM seems to allow support Haswell with native commands . Does this mean&lt;br&gt;
&gt; in my case KVM is allowing software emulated cpu model.&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;No, QEMU will just drop the features which are not supported on your&lt;br&gt;
host. Although there are some rare exceptions, such as x2apic, which can&lt;br&gt;
be emulated even with KVM.&lt;br&gt;
&lt;br&gt;
Anyway, starting QEMU directly should print several warnings about&lt;br&gt;
features which are dropped. And when you start QEMU with&lt;br&gt;
-cpu Haswell,enforce it should refuse to start.&lt;br&gt;
&lt;span class=""&gt;&lt;br&gt;
&gt; Can libvirt allow   software-emulated for non host model ?   if yes how .&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;You can bypass the libvirt check for specific features by setting the&lt;br&gt;
feature policy to "force" (no idea if this can be done with&lt;br&gt;
virt-install), but QEMU will still do the check itself and either drop&lt;br&gt;
the features or refuse to start (with enforce) if they cannot be used on&lt;br&gt;
the host.&lt;br&gt;
&lt;br&gt;
Jirka&lt;br&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170127094643</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-01-27 09:46:43-0400</timestampReceived><subject>Re: [libvirt-users] LibVirt query CPU Model support and restore operation</subject><body>


On Fri, Jan 27, 2017 at 01:48:44PM +0530, akhilesh rawat wrote:
&gt;hello ,
&gt;
&gt;thanks for comments .
&gt;
&gt;I tried now with force options for CPU flag which were not supported . Now
&gt;the command with non fully supported CPU model gets executed ,  But i am
&gt;surprised to see that still Guest  cpu model is not changed and still same
&gt;as host cpu model(SAndy Bridge)
&gt;
&gt;Why don't i see the model as HAswell now , could you please comment.
&gt;

That's because it's still missing some of the features.  QEMU dropped
them because it can't emulate all of them.  That's what both me and Jiri
told you before.

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170127095329</emailId><senderName>Jiri Denemark</senderName><senderEmail>jdenemar@redhat.com</senderEmail><timestampReceived>2017-01-27 09:53:29-0400</timestampReceived><subject>Re: [libvirt-users] LibVirt query CPU Model support and restore operation</subject><body>

On Fri, Jan 27, 2017 at 13:48:44 +0530, akhilesh rawat wrote:
&gt; hello ,
&gt; 
&gt; thanks for comments .
&gt; 
&gt; I tried now with force options for CPU flag which were not supported . Now
&gt; the command with non fully supported CPU model gets executed ,  But i am
&gt; surprised to see that still Guest  cpu model is not changed and still same
&gt; as host cpu model(SAndy Bridge)
&gt; 
&gt; Why don't i see the model as HAswell now , could you please comment.
&gt; 
&gt; Command used :
&gt; 
&gt; virt-install --virt-type kvm --name controller-0  --cpu
&gt; Haswell-noTSX,+fma,+movbe,+fsgsbase,+bmi1,+avx2,+smep,+bmi2,+erms,+invpcid
&gt; --ram=8120 --vcpus=4,sockets=1
&gt; 
&gt; Linux process for KVM :
&gt; 
&gt; 7479     1 37 10:13 ?        01:13:21 /usr/libexec/qemu-kvm -name
&gt; controller-0 -S -machine pc-i440fx-rhel7.0.0,accel=kvm,usb=off *-cpu
&gt; SandyBridge,*+fma,+pcid,+movbe,+fsgsbase,+bmi1,+avx2,+smep,+bmi2,+erms,+invpcid
&gt; -m 8120 -realtime mlock=off -smp 4,sockets=1,cores=4,threads=1

Your qemu-kvm binary apparently doesn't know what Haswell-noTSX is and
thus libvirt has to translate it to something QEMU understands. You can
check supported CPU models with "/usr/libexec/qemu-kvm -cpu ?" (make
sure the question mark is not expanded by the shell).

Jirka

</body></email><email><emailId>20170117194627</emailId><senderName>Laine Stump</senderName><senderEmail>laine@laine.org</senderEmail><timestampReceived>2017-01-17 19:46:27-0400</timestampReceived><subject>Re: [libvirt-users] Controlling the name of the 'tap0' device, in a bridged networking setup</subject><body>

On 01/14/2017 06:30 AM, Govert wrote:
&gt; Hi,
&gt;
&gt; I'm trying to control the name of the 'tap0' device that gets created 
&gt; as I start a domain that uses bridged networking. The XML 
&gt; specification of the domain contains the following configuration
&gt;
&gt;     &lt;interface type='bridge'&gt;
&gt;       &lt;source bridge='br0'/&gt;
&gt;     &lt;/interface&gt;
&gt;
&gt; The libvirt documentation 
&gt; (http://libvirt.org/formatdomain.html#elementsNICSBridge) and other 
&gt; discussions online tell me that I just need to include the &lt;target 
&gt; dev='desired_dev_name'/&gt; tag in the XML specification of the domain 
&gt; under the &lt;interface&gt; tag. Unfortunately doing so appears to have no 
&gt; effect; the tun device created and 'enslaved' in the bridge is still 
&gt; called 'tap0'. Interestingly, I never get a tun device with a name 
&gt; prefixed by 'vnet' or 'vif' which, according to the documentation, is 
&gt; the default behaviour (?). The host is running CentOS 7, and virsh is 
&gt; used to start the domain.

This is because you're running virsh as  a non-privileged user (rather 
than root) and so are connecting to that user's personal non-privileged 
libvirtd (aka qemu:///session) rather than the system's privileged 
libvirtd (qemu:///system). When using qemu:///session, libvirtd is 
unable to create tap devices itself (because it doesn't have sufficient 
privilege for it), so it executes qemu-bridge-helper (from the qemu 
package) requesting that a tap device be created and attached to the 
bridge device specified on its commandline. Unfortunately, 
qemu-bridge-helper doesn't provide any way to specify the tap device 
name, so you get what it decides to give you (which happens to be "tap%d").

If you want more control over the name of the tap device (and many other 
things), you should look into using qemu:///system. That may seem less 
secure, but libvirt actually does a very good job of confining the qemu 
process - after setting up all the resources that will be needed (which 
are labeled with an selinux context unique to this particular guest) and 
setting up cgroups to limit use of system resources, it switches to a 
different (non-privileged) uid and drops all capabilities before 
exec'ing qemu.

(Note that, even if you're using qemu:///system, any manually-specified 
tap device name that starts with "vnet" will be discarded (it assumes 
that it is an auto-generated name left over from a previous run, or from 
plugging a domain's status XML into virsh define)).

</body></email><email><emailId>20170120104759</emailId><senderName>Govert</senderName><senderEmail>govert.br@gmail.com</senderEmail><timestampReceived>2017-01-20 10:47:59-0400</timestampReceived><subject>Re: [libvirt-users] Controlling the name of the 'tap0' device, in a bridged networking setup</subject><body>

Thanks !! This clarifies completely what is happening. I'll look into
running virsh as root/attaching to qemu:///system. Or, perhaps I can
'statically' create tun devices, to which the domains attach when started
(although I have no idea weather this is possible).

Best,
Govert

2017-01-17 20:46 GMT+01:00 Laine Stump &lt;laine@laine.org&gt;:

&gt; On 01/14/2017 06:30 AM, Govert wrote:
&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; I'm trying to control the name of the 'tap0' device that gets created as
&gt;&gt; I start a domain that uses bridged networking. The XML specification of the
&gt;&gt; domain contains the following configuration
&gt;&gt;
&gt;&gt;     &lt;interface type='bridge'&gt;
&gt;&gt;       &lt;source bridge='br0'/&gt;
&gt;&gt;     &lt;/interface&gt;
&gt;&gt;
&gt;&gt; The libvirt documentation (http://libvirt.org/formatdoma
&gt;&gt; in.html#elementsNICSBridge) and other discussions online tell me that I
&gt;&gt; just need to include the &lt;target dev='desired_dev_name'/&gt; tag in the XML
&gt;&gt; specification of the domain under the &lt;interface&gt; tag. Unfortunately doing
&gt;&gt; so appears to have no effect; the tun device created and 'enslaved' in the
&gt;&gt; bridge is still called 'tap0'. Interestingly, I never get a tun device with
&gt;&gt; a name prefixed by 'vnet' or 'vif' which, according to the documentation,
&gt;&gt; is the default behaviour (?). The host is running CentOS 7, and virsh is
&gt;&gt; used to start the domain.
&gt;&gt;
&gt;
&gt; This is because you're running virsh as  a non-privileged user (rather
&gt; than root) and so are connecting to that user's personal non-privileged
&gt; libvirtd (aka qemu:///session) rather than the system's privileged libvirtd
&gt; (qemu:///system). When using qemu:///session, libvirtd is unable to create
&gt; tap devices itself (because it doesn't have sufficient privilege for it),
&gt; so it executes qemu-bridge-helper (from the qemu package) requesting that a
&gt; tap device be created and attached to the bridge device specified on its
&gt; commandline. Unfortunately, qemu-bridge-helper doesn't provide any way to
&gt; specify the tap device name, so you get what it decides to give you (which
&gt; happens to be "tap%d").
&gt;
&gt; If you want more control over the name of the tap device (and many other
&gt; things), you should look into using qemu:///system. That may seem less
&gt; secure, but libvirt actually does a very good job of confining the qemu
&gt; process - after setting up all the resources that will be needed (which are
&gt; labeled with an selinux context unique to this particular guest) and
&gt; setting up cgroups to limit use of system resources, it switches to a
&gt; different (non-privileged) uid and drops all capabilities before exec'ing
&gt; qemu.
&gt;
&gt; (Note that, even if you're using qemu:///system, any manually-specified
&gt; tap device name that starts with "vnet" will be discarded (it assumes that
&gt; it is an auto-generated name left over from a previous run, or from
&gt; plugging a domain's status XML into virsh define)).
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Thanks !! This clarifies completely what is happening. I'll look \
into running virsh as root/attaching to qemu:///system. Or, perhaps I can \
'statically' create tun devices, to which the domains attach when started \
(although I have no idea weather this is possible).  \
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Best,&lt;/div&gt;&lt;div&gt;Govert&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-01-17 20:46 GMT+01:00 Laine \
Stump &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:laine@laine.org" \
target="_blank"&gt;laine@laine.org&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;span \
class=""&gt;On 01/14/2017 06:30 AM, Govert wrote:&lt;br&gt; &lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt; Hi,&lt;br&gt;
&lt;br&gt;
I'm trying to control the name of the 'tap0' device that gets created as \
I start a domain that uses bridged networking. The XML specification of the domain \
contains the following configuration&lt;br&gt; &lt;br&gt;
      &lt;interface type='bridge'&gt;&lt;br&gt;
         &lt;source bridge='br0'/&gt;&lt;br&gt;
      &lt;/interface&gt;&lt;br&gt;
&lt;br&gt;
The libvirt documentation (&lt;a \
href="http://libvirt.org/formatdomain.html#elementsNICSBridge" rel="noreferrer" \
target="_blank"&gt;http://libvirt.org/formatdoma&lt;wbr&gt;in.html#elementsNICSBridge&lt;/a&gt;) and \
other discussions online tell me that I just need to include the &lt;target \
dev='desired_dev_name'/&gt; tag in the XML specification of the domain under \
the &lt;interface&gt; tag. Unfortunately doing so appears to have no effect; the tun \
device created and 'enslaved' in the bridge is still called 'tap0'. \
Interestingly, I never get a tun device with a name prefixed by 'vnet' or \
'vif' which, according to the documentation, is the default behaviour (?). \
The host is running CentOS 7, and virsh is used to start the domain.&lt;br&gt; \
&lt;/blockquote&gt; &lt;br&gt;&lt;/span&gt;
This is because you're running virsh as   a non-privileged user (rather than \
root) and so are connecting to that user's personal non-privileged libvirtd (aka \
qemu:///session) rather than the system's privileged libvirtd (qemu:///system). \
When using qemu:///session, libvirtd is unable to create tap devices itself (because \
it doesn't have sufficient privilege for it), so it executes qemu-bridge-helper \
(from the qemu package) requesting that a tap device be created and attached to the \
bridge device specified on its commandline. Unfortunately, qemu-bridge-helper \
doesn't provide any way to specify the tap device name, so you get what it \
decides to give you (which happens to be "tap%d").&lt;br&gt; &lt;br&gt;
If you want more control over the name of the tap device (and many other things), you \
should look into using qemu:///system. That may seem less secure, but libvirt \
actually does a very good job of confining the qemu process - after setting up all \
the resources that will be needed (which are labeled with an selinux context unique \
to this particular guest) and setting up cgroups to limit use of system resources, it \
switches to a different (non-privileged) uid and drops all capabilities before \
exec'ing qemu.&lt;br&gt; &lt;br&gt;
(Note that, even if you're using qemu:///system, any manually-specified tap \
device name that starts with "vnet" will be discarded (it assumes that it \
is an auto-generated name left over from a previous run, or from plugging a \
domain's status XML into virsh define)).&lt;br&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170120162030</emailId><senderName>Laine Stump</senderName><senderEmail>laine@laine.org</senderEmail><timestampReceived>2017-01-20 16:20:30-0400</timestampReceived><subject>Re: [libvirt-users] Controlling the name of the 'tap0' device, in a bridged networking setup</subject><body>

On 01/20/2017 05:47 AM, Govert wrote:
&gt; Thanks !! This clarifies completely what is happening. I'll look into 
&gt; running virsh as root/attaching to qemu:///system. Or, perhaps I can 
&gt; 'statically' create tun devices, to which the domains attach when 
&gt; started (although I have no idea weather this is possible).

It isn't just the creationof the tap device that requires privileges, 
it's also the opening of the tap, and attaching it to the bridge. There 
isn't any way to do the latter two from unprivileged libvirtd (except 
via qemu-bridge-helper, which insists on creating a new tap device), so 
I think you're going to have to switch to qemu:///system.

&gt;
&gt; Best,
&gt; Govert
&gt;
&gt; 2017-01-17 20:46 GMT+01:00 Laine Stump &lt;laine@laine.org 
&gt; &lt;mailto:laine@laine.org&gt;&gt;:
&gt;
&gt;     On 01/14/2017 06:30 AM, Govert wrote:
&gt;
&gt;         Hi,
&gt;
&gt;         I'm trying to control the name of the 'tap0' device that gets
&gt;         created as I start a domain that uses bridged networking. The
&gt;         XML specification of the domain contains the following
&gt;         configuration
&gt;
&gt;             &lt;interface type='bridge'&gt;
&gt;               &lt;source bridge='br0'/&gt;
&gt;             &lt;/interface&gt;
&gt;
&gt;         The libvirt documentation
&gt;         (http://libvirt.org/formatdomain.html#elementsNICSBridge
&gt;         &lt;http://libvirt.org/formatdomain.html#elementsNICSBridge&gt;) and
&gt;         other discussions online tell me that I just need to include
&gt;         the &lt;target dev='desired_dev_name'/&gt; tag in the XML
&gt;         specification of the domain under the &lt;interface&gt; tag.
&gt;         Unfortunately doing so appears to have no effect; the tun
&gt;         device created and 'enslaved' in the bridge is still called
&gt;         'tap0'. Interestingly, I never get a tun device with a name
&gt;         prefixed by 'vnet' or 'vif' which, according to the
&gt;         documentation, is the default behaviour (?). The host is
&gt;         running CentOS 7, and virsh is used to start the domain.
&gt;
&gt;
&gt;     This is because you're running virsh as  a non-privileged user
&gt;     (rather than root) and so are connecting to that user's personal
&gt;     non-privileged libvirtd (aka qemu:///session) rather than the
&gt;     system's privileged libvirtd (qemu:///system). When using
&gt;     qemu:///session, libvirtd is unable to create tap devices itself
&gt;     (because it doesn't have sufficient privilege for it), so it
&gt;     executes qemu-bridge-helper (from the qemu package) requesting
&gt;     that a tap device be created and attached to the bridge device
&gt;     specified on its commandline. Unfortunately, qemu-bridge-helper
&gt;     doesn't provide any way to specify the tap device name, so you get
&gt;     what it decides to give you (which happens to be "tap%d").
&gt;
&gt;     If you want more control over the name of the tap device (and many
&gt;     other things), you should look into using qemu:///system. That may
&gt;     seem less secure, but libvirt actually does a very good job of
&gt;     confining the qemu process - after setting up all the resources
&gt;     that will be needed (which are labeled with an selinux context
&gt;     unique to this particular guest) and setting up cgroups to limit
&gt;     use of system resources, it switches to a different
&gt;     (non-privileged) uid and drops all capabilities before exec'ing qemu.
&gt;
&gt;     (Note that, even if you're using qemu:///system, any
&gt;     manually-specified tap device name that starts with "vnet" will be
&gt;     discarded (it assumes that it is an auto-generated name left over
&gt;     from a previous run, or from plugging a domain's status XML into
&gt;     virsh define)).
&gt;
&gt;


[Attachment #3 (text/html)]

&lt;html&gt;
  &lt;head&gt;
    &lt;meta content="text/html; charset=utf-8" http-equiv="Content-Type"&gt;
  &lt;/head&gt;
  &lt;body bgcolor="#FFFFFF" text="#000000"&gt;
    &lt;div class="moz-cite-prefix"&gt;On 01/20/2017 05:47 AM, Govert wrote:&lt;br&gt;
    &lt;/div&gt;
    &lt;blockquote
cite="mid:CAOJqm9rryg_ymXnt345rj578r01qRsinZdfzN-OEXn=t8GxBoQ@mail.gmail.com"
      type="cite"&gt;
      &lt;div dir="ltr"&gt;Thanks !! This clarifies completely what is
        happening. I'll look into running virsh as root/attaching to
        qemu:///system. Or, perhaps I can 'statically' create tun
        devices, to which the domains attach when started (although I
        have no idea weather this is possible). &lt;br&gt;
      &lt;/div&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
    It isn't just the creationof the tap device that requires
    privileges, it's also the opening of the tap, and attaching it to
    the bridge. There isn't any way to do the latter two from
    unprivileged libvirtd (except via qemu-bridge-helper, which insists
    on creating a new tap device), so I think you're going to have to
    switch to qemu:///system.&lt;br&gt;
    &lt;br&gt;
    &lt;blockquote
cite="mid:CAOJqm9rryg_ymXnt345rj578r01qRsinZdfzN-OEXn=t8GxBoQ@mail.gmail.com"
      type="cite"&gt;
      &lt;div dir="ltr"&gt;
        &lt;div&gt;&lt;br&gt;
        &lt;/div&gt;
        &lt;div&gt;Best,&lt;/div&gt;
        &lt;div&gt;Govert&lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="gmail_extra"&gt;&lt;br&gt;
        &lt;div class="gmail_quote"&gt;2017-01-17 20:46 GMT+01:00 Laine Stump
          &lt;span dir="ltr"&gt;&lt;&lt;a moz-do-not-send="true"
              href="mailto:laine@laine.org" \
target="_blank"&gt;laine@laine.org&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;  &lt;blockquote class="gmail_quote" \
                style="margin:0 0 0
            .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;&lt;span
              class=""&gt;On 01/14/2017 06:30 AM, Govert wrote:&lt;br&gt;
              &lt;blockquote class="gmail_quote" style="margin:0 0 0
                .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;
                Hi,&lt;br&gt;
                &lt;br&gt;
                I'm trying to control the name of the 'tap0' device that
                gets created as I start a domain that uses bridged
                networking. The XML specification of the domain contains
                the following configuration&lt;br&gt;
                &lt;br&gt;
                    &lt;interface type='bridge'&gt;&lt;br&gt;
                      &lt;source bridge='br0'/&gt;&lt;br&gt;
                    &lt;/interface&gt;&lt;br&gt;
                &lt;br&gt;
                The libvirt documentation (&lt;a moz-do-not-send="true"
                  href="http://libvirt.org/formatdomain.html#elementsNICSBridge"
                  rel="noreferrer" \
target="_blank"&gt;http://libvirt.org/formatdoma&lt;wbr&gt;in.html#elementsNICSBridge&lt;/a&gt;)  \
and other discussions online tell me that I just need to  include the &lt;target \
dev='desired_dev_name'/&gt; tag  in the XML specification of the domain under the
                &lt;interface&gt; tag. Unfortunately doing so appears to
                have no effect; the tun device created and 'enslaved' in
                the bridge is still called 'tap0'. Interestingly, I
                never get a tun device with a name prefixed by 'vnet' or
                'vif' which, according to the documentation, is the
                default behaviour (?). The host is running CentOS 7, and
                virsh is used to start the domain.&lt;br&gt;
              &lt;/blockquote&gt;
              &lt;br&gt;
            &lt;/span&gt;
            This is because you're running virsh as  a non-privileged
            user (rather than root) and so are connecting to that user's
            personal non-privileged libvirtd (aka qemu:///session)
            rather than the system's privileged libvirtd
            (qemu:///system). When using qemu:///session, libvirtd is
            unable to create tap devices itself (because it doesn't have
            sufficient privilege for it), so it executes
            qemu-bridge-helper (from the qemu package) requesting that a
            tap device be created and attached to the bridge device
            specified on its commandline. Unfortunately,
            qemu-bridge-helper doesn't provide any way to specify the
            tap device name, so you get what it decides to give you
            (which happens to be "tap%d").&lt;br&gt;
            &lt;br&gt;
            If you want more control over the name of the tap device
            (and many other things), you should look into using
            qemu:///system. That may seem less secure, but libvirt
            actually does a very good job of confining the qemu process
            - after setting up all the resources that will be needed
            (which are labeled with an selinux context unique to this
            particular guest) and setting up cgroups to limit use of
            system resources, it switches to a different
            (non-privileged) uid and drops all capabilities before
            exec'ing qemu.&lt;br&gt;
            &lt;br&gt;
            (Note that, even if you're using qemu:///system, any
            manually-specified tap device name that starts with "vnet"
            will be discarded (it assumes that it is an auto-generated
            name left over from a previous run, or from plugging a
            domain's status XML into virsh define)).&lt;br&gt;
          &lt;/blockquote&gt;
        &lt;/div&gt;
        &lt;br&gt;
      &lt;/div&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;&lt;br&gt;
    &lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;



</body></email><email><emailId>20170112070634</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-01-12 07:06:34-0400</timestampReceived><subject>Re: [libvirt-users] [libvirt] Regarding Migration Statistics</subject><body>


On Tue, Jan 10, 2017 at 08:07:13PM +0530, Anubhav Guleria wrote:
&gt;Greetings,
&gt;
&gt;I am writing a code using libvirt API to migrate VM between two physical
&gt;hosts *(QEMU/KVM) , *say some *n *number of times.
&gt;
&gt;*1)* I am using right now* virDomainPtr virDomainMigrate (.......) *and to
&gt;calculate the total migration time I am using something like this:
&gt;
&gt;*clock_gettime(CLOCK_MONOTONIC_RAW,&amp;begin);  *
&gt; *migrate*(domainToMigrate,nodeToMigrate);
&gt;
&gt;*clock_gettime(CLOCK_MONOTONIC_RAW,&amp;end);*
&gt;
&gt;
&gt;
&gt;*Total Migration Time = end.tv_sec-begin.tv_sec*
&gt;
&gt;Is this correct way to calculate total migration time. And is there some
&gt;way to calculate the downtime (not how to set it)?
&gt;

Libvirt provides this information, I believe in virDomainGetJobStats().
If you call this function with flags |= VIR_DOMAIN_JOB_STATS_COMPLETED,
it will return various information on a recently completed job
(e.g. migration).

You can also register a callback for VIR_DOMAIN_EVENT_ID_JOB_COMPLETED
event, which will tell you all that right when the migration is completed.


&gt;*2) *I am interested in identifying in particular other statistics of
&gt;migration like :
&gt;*Number of iterations in Pre Copy*, *Memory transferred in each iteration*
&gt;etc.
&gt;I was going through the API and found* virDomainJobInfo
&gt;&lt;http://libvirt.org/html/libvirt-libvirt-domain.html#virDomainJobInfo&gt; and
&gt;virDomainGetJobStats
&gt;&lt;http://libvirt.org/html/libvirt-libvirt-domain.html#virDomainGetJobStats&gt;
&gt;*functions.But
&gt;how to use them is not very clear. Can anyone point me to right place to
&gt;achieve this objective?
&gt;

int type = -1, nparams = 0;
virTypedParameterPtr params = NULL;

virDomainGetJobStats(domain, &amp;type, &amp;params, &amp;nparams,
                     VIR_DOMAIN_JOB_STATS_COMPLETED)

This should be enough ^^.  Since migration should be a job on bothe
source and destination, it may return different data, I'm not too sure
about that.  You'll have to try that out or hope that someone else will
answer as well, sorry.

&gt;Thanks in advance.
&gt;And sorry if that was too silly to ask.
&gt;
&gt;Anubhav

&gt;--
&gt;libvir-list mailing list
&gt;libvir-list@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvir-list

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170108104803</emailId><senderName>Anubhav Guleria</senderName><senderEmail>anubhav.nitsri.it@gmail.com</senderEmail><timestampReceived>2017-01-08 10:48:03-0400</timestampReceived><subject>Re: [libvirt-users] Regarding Migration Code</subject><body>

Anybody?
"CODENAME FREAK -47"


On Sat, Jan 7, 2017 at 11:25 PM, Anubhav Guleria
&lt;anubhav.nitsri.it@gmail.com&gt; wrote:
&gt; Greetings,
&gt;
&gt; I was trying to understand the flow of Migration Code in libvirt and
&gt; have few doubts:
&gt;
&gt; 1)  libvirt talks to QEMU/KVM guests via QEMU API. So overall, in
&gt; order to manage QEMU/KVM guests I can either use libvirt (or tools
&gt; based on libvirt like virsh) or QEMU monitor. Is it so?
&gt;
&gt; 2) Since libvirt is Hypervisor neutral so actual migration
&gt; algorithm(precopy or postcopy) is present in the hypervisor ,i.e. in
&gt; case of QEMU it should be present in QEMU code base . I was going
&gt; through the code starting from libvirt-domain api and not able to
&gt; follow after virDomainMigrateVersion3Full(.....)  . Kindly help.
&gt;
&gt; Thanks in advance. And sorry if that was too basic.
&gt;
&gt; Anubhav

</body></email><email><emailId>20170104171603</emailId><senderName>Ala Hino</senderName><senderEmail>ahino@redhat.com</senderEmail><timestampReceived>2017-01-04 17:16:03-0400</timestampReceived><subject>Re: [libvirt-users] libvirtError: block copy still active: disk not ready for pivot yet</subject><body>

I understand that libvirt provides async events that are triggered once the
block job reaches ready state and successfully pivots as it is reported by
qemu.
Whats the event that is triggered and what's the handler that we have to
implement?
To be more specific, I am looking for the onEVENT callback method that is
invoked when the event is fired.

On Tue, Jan 3, 2017 at 6:28 PM, Kashyap Chamarthy &lt;kchamart@redhat.com&gt;
wrote:

&gt; On Wed, Dec 28, 2016 at 01:26:12PM +0200, Ala Hino wrote:
&gt; &gt; Hi guys,
&gt; &gt;
&gt; &gt; When performing live merge, in few cases, we see the following exception:
&gt;
&gt; [...]
&gt;
&gt; &gt; libvirtError: block copy still active: disk 'vdb' not ready for pivot yet
&gt;
&gt; You can see if the block operation is still in progress or not by doing:
&gt; `sudo virsh blockjob vm1 vdb --info`.
&gt;
&gt; &gt; That exception observed in following BZs:
&gt; &gt;
&gt; &gt; https://bugzilla.redhat.com/1376580
&gt; &gt; https://bugzilla.redhat.com/1397122
&gt;
&gt; [I see, that the above are oVirt bugs.]
&gt;
&gt; &gt; I am trying to understand what this exception indicates in order to
&gt; handle
&gt; &gt; it appropriately when thrown by libvirt.
&gt;
&gt; Here's the commit that adds the above error message.  In short: Until
&gt; the 'query-block-jobs' QMP command emits the flag BLOCK_JOB_READY, the
&gt; copy / mirror block operation is truly not complete.
&gt;
&gt;
&gt;     commit eae59247c59aa02147b2b4a50177e8e877fdb218
&gt;     Author: Peter Krempa &lt;pkrempa@redhat.com&gt;
&gt;     Date:   Wed Jul 15 15:11:02 2015 +0200
&gt;
&gt;         qemu: Update state of block job to READY only if it actually is
&gt; ready
&gt;
&gt;         Few parts of the code looked at the current progress of and
&gt; assumed that
&gt;         a two phase blockjob is in the _READY state as soon as the progress
&gt;         reached 100% (info.cur == info.end). In current versions of qemu
&gt; this
&gt;         assumption is invalid and qemu exposes a new flag 'ready' in the
&gt;         query-block-jobs output that is set to true if the job is actually
&gt;         finished.
&gt;
&gt;         This patch adds internal data handling for reading the 'ready'
&gt; flag and
&gt;         acting appropriately as long as the flag is present.
&gt;
&gt;         While this still doesn't fix the virsh client problem with two
&gt; phase
&gt;         block jobs and the --pivot option, it at least improves the error
&gt;         message:
&gt;
&gt;         $ virsh blockcommit  --wait --verbose vm vda  --base vda[1]
&gt; --active --pivot
&gt;         Block commit: [100 %]error: failed to pivot job for disk vda
&gt;         error: internal error: unable to execute QEMU command
&gt; 'block-job-complete': The active block job for device 'drive-virtio-disk0'
&gt; cannot be completed
&gt;
&gt;         to
&gt;
&gt;         $ virsh blockcommit  --wait --verbose VM vda  --base vda[1]
&gt; --active --pivot
&gt;         Block commit: [100 %]error: failed to pivot job for disk vda
&gt;         error: block copy still active: disk 'vda' not ready for pivot yet
&gt;
&gt;
&gt; [...]
&gt;
&gt; --
&gt; /kashyap
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;I understand that  libvirt provides async events that are triggered \
once the block job reaches ready state and successfully pivots as it is reported by \
qemu.&lt;div&gt;Whats the event that is triggered and what's the handler that we have \
to implement?&lt;/div&gt;&lt;div&gt;To be more specific, I am looking for the onEVENT callback \
method that is invoked when the event is fired.&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;On Tue, Jan 3, 2017 at 6:28 PM, \
Kashyap Chamarthy &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:kchamart@redhat.com" \
target="_blank"&gt;kchamart@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span class=""&gt;On Wed, Dec 28, 2016 at 01:26:12PM +0200, Ala \
Hino wrote:&lt;br&gt; &gt; Hi guys,&lt;br&gt;
&gt;&lt;br&gt;
&gt; When performing live merge, in few cases, we see the following exception:&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;[...]&lt;br&gt;
&lt;span class=""&gt;&lt;br&gt;
&gt; libvirtError: block copy still active: disk 'vdb' not ready for pivot \
yet&lt;br&gt; &lt;br&gt;
&lt;/span&gt;You can see if the block operation is still in progress or not by doing:&lt;br&gt;
`sudo virsh blockjob vm1 vdb --info`.&lt;br&gt;
&lt;span class=""&gt;&lt;br&gt;
&gt; That exception observed in following BZs:&lt;br&gt;
&gt;&lt;br&gt;
&gt; &lt;a href="https://bugzilla.redhat.com/1376580" rel="noreferrer" \
target="_blank"&gt;https://bugzilla.redhat.com/&lt;wbr&gt;1376580&lt;/a&gt;&lt;br&gt; &gt; &lt;a \
href="https://bugzilla.redhat.com/1397122" rel="noreferrer" \
target="_blank"&gt;https://bugzilla.redhat.com/&lt;wbr&gt;1397122&lt;/a&gt;&lt;br&gt; &lt;br&gt;
&lt;/span&gt;[I see, that the above are oVirt bugs.]&lt;br&gt;
&lt;span class=""&gt;&lt;br&gt;
&gt; I am trying to understand what this exception indicates in order to handle&lt;br&gt;
&gt; it appropriately when thrown by libvirt.&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;Here's the commit that adds the above error message.   In short: Until&lt;br&gt;
the 'query-block-jobs' QMP command emits the flag BLOCK_JOB_READY, the&lt;br&gt;
copy / mirror block operation is truly not complete.&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
      commit eae59247c59aa02147b2b4a50177e8&lt;wbr&gt;e877fdb218&lt;br&gt;
      Author: Peter Krempa &lt;&lt;a \
href="mailto:pkrempa@redhat.com"&gt;pkrempa@redhat.com&lt;/a&gt;&gt;&lt;br&gt;  Date:     Wed Jul 15 \
15:11:02 2015 +0200&lt;br&gt; &lt;br&gt;
            qemu: Update state of block job to READY only if it actually is ready&lt;br&gt;
&lt;br&gt;
            Few parts of the code looked at the current progress of and assumed \
                that&lt;br&gt;
            a two phase blockjob is in the _READY state as soon as the progress&lt;br&gt;
            reached 100% (info.cur == info.end). In current versions of qemu this&lt;br&gt;
            assumption is invalid and qemu exposes a new flag 'ready' in \
                the&lt;br&gt;
            query-block-jobs output that is set to true if the job is actually&lt;br&gt;
            finished.&lt;br&gt;
&lt;br&gt;
            This patch adds internal data handling for reading the 'ready' \
flag and&lt;br&gt;  acting appropriately as long as the flag is present.&lt;br&gt;
&lt;br&gt;
            While this still doesn't fix the virsh client problem with two \
                phase&lt;br&gt;
            block jobs and the --pivot option, it at least improves the error&lt;br&gt;
            message:&lt;br&gt;
&lt;br&gt;
            $ virsh blockcommit   --wait --verbose vm vda   --base vda[1] --active \
                --pivot&lt;br&gt;
            Block commit: [100 %]error: failed to pivot job for disk vda&lt;br&gt;
            error: internal error: unable to execute QEMU command \
'block-job-complete': The active block job for device \
'drive-virtio-disk0' cannot be completed&lt;br&gt; &lt;br&gt;
            to&lt;br&gt;
&lt;br&gt;
            $ virsh blockcommit   --wait --verbose VM vda   --base vda[1] --active \
                --pivot&lt;br&gt;
            Block commit: [100 %]error: failed to pivot job for disk vda&lt;br&gt;
            error: block copy still active: disk 'vda' not ready for pivot \
yet&lt;br&gt; &lt;br&gt;
&lt;br&gt;
[...]&lt;br&gt;
&lt;span class="HOEnZb"&gt;&lt;font color="#888888"&gt;&lt;br&gt;
--&lt;br&gt;
/kashyap&lt;br&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170105101642</emailId><senderName>Kashyap Chamarthy</senderName><senderEmail>kchamart@redhat.com</senderEmail><timestampReceived>2017-01-05 10:16:42-0400</timestampReceived><subject>Re: [libvirt-users] libvirtError: block copy still active: disk not ready for pivot yet</subject><body>

On Wed, Jan 04, 2017 at 07:16:03PM +0200, Ala Hino wrote:
&gt; I understand that libvirt provides async events that are triggered once the
&gt; block job reaches ready state and successfully pivots as it is reported by
&gt; qemu.
&gt; Whats the event that is triggered and what's the handler that we have to
&gt; implement?

The exact event is: BLOCK_JOB_READY

Also, as Peter Krempa once pointed out, the above is exposed via XML:

  Libvirt expose the state of the copy job in the XML and forward the
  READY event from qemu to the users.

  A running copy job exposes itself in the xml as:
  
      &lt;disk type='file' device='cdrom'&gt;
        &lt;driver name='qemu' type='raw'/&gt;
        &lt;source file='/var/lib/libvirt/images/systemrescuecd-x86-4.8.0.iso'/&gt;
        &lt;backingStore/&gt;
        &lt;mirror type='file' file='/tmp/ble.img' format='raw' job='copy'&gt;
          &lt;format type='raw'/&gt;
          &lt;source file='/tmp/ble.img'/&gt;
        &lt;/mirror&gt;
        [...]
      &lt;/disk&gt;
  
  While the ready copy job is exposed as:
  
      &lt;disk type='file' device='cdrom'&gt;
        &lt;driver name='qemu' type='raw'/&gt;
        &lt;source file='/var/lib/libvirt/images/systemrescuecd-x86-4.8.0.iso'/&gt;
        &lt;backingStore/&gt;
        &lt;mirror type='file' file='/tmp/ble.img' format='raw' job='copy' ready='yes'&gt;
          &lt;format type='raw'/&gt;
          &lt;source file='/tmp/ble.img'/&gt;
        &lt;/mirror&gt;
        [...]
      &lt;/disk&gt;

&gt; To be more specific, I am looking for the onEVENT callback method that is
&gt; invoked when the event is fired.

Afraid, I don't know the exact callback you have to implement.  Perhaps
Peter or Eric Blake can say.

But some more related context (lots of reading), as the issue is a bit
more complicated.

You might also want to look at the below two bugs:

    https://bugzilla.redhat.com/show_bug.cgi?id=1382165 --
    virDomainGetBlockJobInfo: Adjust job reporting based on QEMU stats &amp;
    the "ready" field of `query-block-jobs`

And (now fixed):

    https://bugzilla.redhat.com/show_bug.cgi?id=1372613 --  Improve live
    block device job status reporting via virDomainBlockJobInfo() 

And may want to go through this entire thread:

    https://www.redhat.com/archives/libvir-list/2016-October/msg00217.html
    -- RFC: Exposing "ready" bool (of `query-block-jobs`) or QMP
    BLOCK_JOB_READY event


[...]

-- 
/kashyap

</body></email><email><emailId>20170105125308</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-01-05 12:53:08-0400</timestampReceived><subject>Re: [libvirt-users] [libvirt] xml config nested</subject><body>

NB, in future please don't CC all possible mailing lists at once.
Just pick the most appropriate mailing list for your question. I've
dropped libvirt-list &amp; libvirt-announce from the CC, since this is
a question most suited for libvirt-users.

On Thu, Jan 05, 2017 at 11:44:29AM +0800, 放牛班的春天 wrote:
&gt; How to configure libvirt, so qemu-kvm support nested virtualization, virtual \
&gt; machine installed operating system is windows_7_ultimate_sp1_x64_dvd_618537.iso, \
&gt; configure libvirt xml file is as follows: 
&gt; &lt;cpu mode='custom' match='exact'&gt;
&gt; &lt;model fallback='allow'&gt;core2duo&lt;/model&gt;
&gt; &lt;feature policy='require' name='vmx'/&gt;
&gt; &lt;/cpu&gt;
&gt; 
&gt; 
&gt; or
&gt; 
&gt; &lt;cpu mode='host-model'&gt;
&gt; &lt;model fallback='allow'/&gt;
&gt; &lt;/cpu&gt;
&gt; 
&gt; or
&gt; &lt;cpu mode='host-passthrough'&gt;
&gt; &lt;topology sockets='2' cores='2' threads='2'/&gt;
&gt; &lt;/cpu&gt;

Yes, that's the key guest configuration step - exposing the 'vmx' feature
to the guest.

In addition to that though, you need to make sure the kvm-intel kernel
module in your host has the "nested=1" parameter set.

eg in /etc/modprobe.d/kvm.conf you want

 options kvm_intel nested=1

If loaded correctly you should see

# cat /sys/module/kvm_intel/parameters/nested 
Y

if it says "N", then nested VMX will be disabled.

Regards,
Daniel
-- 
&gt; &gt; http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
&gt; &gt; http://libvirt.org              -o-             http://virt-manager.org :|
&gt; &gt; http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|


</body></email><email><emailId>20170109085837</emailId><senderName>Martin Kletzander</senderName><senderEmail>mkletzan@redhat.com</senderEmail><timestampReceived>2017-01-09 08:58:37-0400</timestampReceived><subject>Re: [libvirt-users] Regarding Migration Code</subject><body>


On Sat, Jan 07, 2017 at 11:25:20PM +0530, Anubhav Guleria wrote:
&gt;Greetings,
&gt;
&gt;I was trying to understand the flow of Migration Code in libvirt and
&gt;have few doubts:
&gt;
&gt;1)  libvirt talks to QEMU/KVM guests via QEMU API. So overall, in
&gt;order to manage QEMU/KVM guests I can either use libvirt (or tools
&gt;based on libvirt like virsh) or QEMU monitor. Is it so?
&gt;

Yes.  But if you spawn it with libvirt, you should do everything through
libvirt.  You can use 'virsh qemu-monitor-command' for querying some
things that libvirt doesn't allow, but definitely not change anything.

&gt;2) Since libvirt is Hypervisor neutral so actual migration
&gt;algorithm(precopy or postcopy) is present in the hypervisor ,i.e. in
&gt;case of QEMU it should be present in QEMU code base . I was going
&gt;through the code starting from libvirt-domain api and not able to
&gt;follow after virDomainMigrateVersion3Full(.....)  . Kindly help.
&gt;

Search for "conn-&gt;driver", you will find "domain-&gt;conn-&gt;driver-&gt;" and
"dconn-&gt;driver-&gt;", that's how source and destination APIs are called.

I remember an image explaining the APIs called in different versions.

The migration API is "neutral", but at the same time the code needs to
know (and it knows) about all the options that will be used
(e.g. post-copy).

&gt;Thanks in advance. And sorry if that was too basic.
&gt;
&gt;Anubhav
&gt;
&gt;_______________________________________________
&gt;libvirt-users mailing list
&gt;libvirt-users@redhat.com
&gt;https://www.redhat.com/mailman/listinfo/libvirt-users

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170109151747</emailId><senderName>JT Edwards</senderName><senderEmail>tstrike34@gmail.com</senderEmail><timestampReceived>2017-01-09 15:17:47-0400</timestampReceived><subject>[libvirt-users] virt-p2v - Windows 10 guest hangs at boot after successful P2V</subject><body>

Hi all,

I successfully virt-p2v'ed a Windows 10 laptop to my Centos 7.3 instance
running KVM. However, on boot, the guest hangs. Is there a registry fix
that is needed after the P2V is done? Here is what is in the guest's
logfile:
017-01-08 03:20:37.508+0000: starting up libvirt version: 2.0.0, package:
10.el7_3.2 (CentOS BuildSystem &lt;http://bugs.centos.org&gt;,
2016-12-06-19:53:38, c1bm.rdu2.centos.org), qemu version: 1.5.3
(qemu-kvm-1.5.3-126.el7), hostname: torden40.me.org
LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
QEMU_AUDIO_DRV=spice /usr/libexec/qemu-kvm -name win10 -S -machine
pc-i440fx-rhel7.0.0,accel=kvm,usb=off -cpu
Conroe,hv_time,hv_relaxed,hv_vapic,hv_spinlocks=0x1fff -m 4096 -realtime
mlock=off -smp 2,sockets=2,cores=1,threads=1 -uuid
f72e7ad5-98d4-44ab-aa85-347fe232b4e5 -no-user-config -nodefaults -chardev
socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-9-win10/monitor.sock,server,nowait
-mon chardev=charmonitor,id=monitor,mode=control -rtc
base=localtime,driftfix=slew -global kvm-pit.lost_tick_policy=discard
-no-hpet -no-shutdown -global PIIX4_PM.disable_s3=1 -global
PIIX4_PM.disable_s4=1 -boot strict=on -device
ich9-usb-ehci1,id=usb,bus=pci.0,addr=0x6.0x7 -device
ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x6
-device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x6.0x1
-device ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x6.0x2
-device virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x5 -drive
file=/home/tstrike39/Virtuals/tordenmobile.img,format=qcow2,if=none,id=drive-ide0-0-0
-device
ide-hd,bus=ide.0,unit=0,drive=drive-ide0-0-0,id=ide0-0-0,bootindex=1
-netdev tap,fd=26,id=hostnet0 -device
rtl8139,netdev=hostnet0,id=net0,mac=52:54:00:d6:c8:67,bus=pci.0,addr=0x3
-chardev pty,id=charserial0 -device
isa-serial,chardev=charserial0,id=serial0 -chardev
spicevmc,id=charchannel0,name=vdagent -device
virtserialport,bus=virtio-serial0.0,nr=1,chardev=charchannel0,id=channel0,name=com.redhat.spice.0
-device usb-tablet,id=input0,bus=usb.0,port=1 -spice
port=5900,addr=127.0.0.1,disable-ticketing,image-compression=off,seamless-migration=on
-vga qxl -global qxl-vga.ram_size=67108864 -global
qxl-vga.vram_size=67108864 -global qxl-vga.vgamem_mb=16 -device
intel-hda,id=sound0,bus=pci.0,addr=0x4 -device
hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -chardev
spicevmc,id=charredir0,name=usbredir -device
usb-redir,chardev=charredir0,id=redir0,bus=usb.0,port=2 -chardev
spicevmc,id=charredir1,name=usbredir -device
usb-redir,chardev=charredir1,id=redir1,bus=usb.0,port=3 -device
virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x7 -msg timestamp=on
char device redirected to /dev/pts/2 (label charserial0)
main_channel_link: add main channel client
main_channel_handle_parsed: net test: latency 0.140000 ms, bitrate
14222222222 bps (13563.368055 Mbps)
((null):19947): Spice-Warning **:
red_channel.c:542:red_channel_client_send_ping: getsockopt failed,
Operation not supported
red_dispatcher_set_cursor_peer:
inputs_connect: inputs channel client create
((null):19947): Spice-Warning **:
red_channel.c:542:red_channel_client_send_ping: getsockopt failed,
Operation not supported
((null):19947): Spice-Warning **:
red_channel.c:542:red_channel_client_send_ping: getsockopt failed,
Operation not supported



Below is the XML of my migrated instance:

&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;domain type='kvm'&gt;
  &lt;!-- generated by virt-v2v 1.32.7rhel=7,release=3.el7.centos,libvirt --&gt;
  &lt;name&gt;localhost&lt;/name&gt;
  &lt;memory unit='KiB'&gt;4194304&lt;/memory&gt;
  &lt;currentMemory unit='KiB'&gt;4194304&lt;/currentMemory&gt;
  &lt;vcpu&gt;2&lt;/vcpu&gt;
  &lt;os&gt;
    &lt;type arch='x86_64'&gt;hvm&lt;/type&gt;
  &lt;/os&gt;
  &lt;features&gt;
    &lt;acpi/&gt;
    &lt;apic/&gt;
  &lt;/features&gt;
  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
  &lt;on_crash&gt;restart&lt;/on_crash&gt;
  &lt;devices&gt;
    &lt;disk type='file' device='disk'&gt;
      &lt;driver name='qemu' type='raw' cache='none'/&gt;
      &lt;source file='/home/tstrike39/Virtuals/localhost-sda'/&gt;
      &lt;target dev='vda' bus='virtio'/&gt;
    &lt;/disk&gt;
    &lt;interface type='network'&gt;
      &lt;source network='default'/&gt;
      &lt;model type='virtio'/&gt;
      &lt;mac address='f0:de:f1:08:9c:c4'/&gt;
    &lt;/interface&gt;
    &lt;video&gt;
      &lt;model type='cirrus' vram='9216' heads='1'/&gt;
    &lt;/video&gt;
    &lt;graphics type='vnc' autoport='yes' port='-1'/&gt;
    &lt;input type='tablet' bus='usb'/&gt;
    &lt;input type='mouse' bus='ps2'/&gt;
    &lt;console type='pty'/&gt;
  &lt;/devices&gt;
&lt;/domain&gt;


Any help would be appreciated!

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div class="gmail_signature"&gt;&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div \
dir="ltr"&gt;&lt;div&gt;&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div \
dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;div&gt;Hi \
all,&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I successfully \
virt-p2v'ed a Windows 10 laptop to my Centos 7.3 instance running KVM. However, \
on boot, the guest hangs. Is there a registry fix that is needed after the P2V is \
done? Here is what is in the guest's logfile:&lt;/div&gt;&lt;div&gt;&lt;div&gt;017-01-08 \
03:20:37.508+0000: starting up libvirt version: 2.0.0, package: 10.el7_3.2 (CentOS \
BuildSystem &lt;&lt;a href="http://bugs.centos.org"&gt;http://bugs.centos.org&lt;/a&gt;&gt;, \
2016-12-06-19:53:38, &lt;a href="http://c1bm.rdu2.centos.org"&gt;c1bm.rdu2.centos.org&lt;/a&gt;), \
qemu version: 1.5.3 (qemu-kvm-1.5.3-126.el7), hostname: &lt;a \
href="http://torden40.me.org"&gt;torden40.me.org&lt;/a&gt;&lt;/div&gt;&lt;div&gt;LC_ALL=C \
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin QEMU_AUDIO_DRV=spice \
/usr/libexec/qemu-kvm -name win10 -S -machine pc-i440fx-rhel7.0.0,accel=kvm,usb=off \
-cpu Conroe,hv_time,hv_relaxed,hv_vapic,hv_spinlocks=0x1fff -m 4096 -realtime \
mlock=off -smp 2,sockets=2,cores=1,threads=1 -uuid \
f72e7ad5-98d4-44ab-aa85-347fe232b4e5 -no-user-config -nodefaults -chardev \
socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-9-win10/monitor.sock,server,nowait \
-mon chardev=charmonitor,id=monitor,mode=control -rtc base=localtime,driftfix=slew \
-global kvm-pit.lost_tick_policy=discard -no-hpet -no-shutdown -global \
PIIX4_PM.disable_s3=1 -global PIIX4_PM.disable_s4=1 -boot strict=on -device \
ich9-usb-ehci1,id=usb,bus=pci.0,addr=0x6.0x7 -device \
ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x6 \
-device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x6.0x1 -device \
ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x6.0x2 -device \
virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x5 -drive \
file=/home/tstrike39/Virtuals/tordenmobile.img,format=qcow2,if=none,id=drive-ide0-0-0 \
-device ide-hd,bus=ide.0,unit=0,drive=drive-ide0-0-0,id=ide0-0-0,bootindex=1 -netdev \
tap,fd=26,id=hostnet0 -device \
rtl8139,netdev=hostnet0,id=net0,mac=52:54:00:d6:c8:67,bus=pci.0,addr=0x3 -chardev \
pty,id=charserial0 -device isa-serial,chardev=charserial0,id=serial0 -chardev \
spicevmc,id=charchannel0,name=vdagent -device \
virtserialport,bus=virtio-serial0.0,nr=1,chardev=charchannel0,id=channel0,name=com.redhat.spice.0 \
-device usb-tablet,id=input0,bus=usb.0,port=1 -spice \
port=5900,addr=127.0.0.1,disable-ticketing,image-compression=off,seamless-migration=on \
-vga qxl -global qxl-vga.ram_size=67108864 -global qxl-vga.vram_size=67108864 -global \
qxl-vga.vgamem_mb=16 -device intel-hda,id=sound0,bus=pci.0,addr=0x4 -device \
hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -chardev \
spicevmc,id=charredir0,name=usbredir -device \
usb-redir,chardev=charredir0,id=redir0,bus=usb.0,port=2 -chardev \
spicevmc,id=charredir1,name=usbredir -device \
usb-redir,chardev=charredir1,id=redir1,bus=usb.0,port=3 -device \
virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x7 -msg timestamp=on&lt;/div&gt;&lt;div&gt;char \
device redirected to /dev/pts/2 (label charserial0)&lt;/div&gt;&lt;div&gt;main_channel_link: add \
main channel client&lt;/div&gt;&lt;div&gt;main_channel_handle_parsed: net test: latency 0.140000 \
ms, bitrate 14222222222 bps (13563.368055 Mbps)&lt;/div&gt;&lt;div&gt;((null):19947): \
Spice-Warning **: red_channel.c:542:red_channel_client_send_ping: getsockopt failed, \
Operation not supported&lt;/div&gt;&lt;div&gt;red_dispatcher_set_cursor_peer:&lt;/div&gt;&lt;div&gt;inputs_connect: \
inputs channel client create&lt;/div&gt;&lt;div&gt;((null):19947): Spice-Warning **: \
red_channel.c:542:red_channel_client_send_ping: getsockopt failed, Operation not \
supported&lt;/div&gt;&lt;div&gt;((null):19947): Spice-Warning **: \
red_channel.c:542:red_channel_client_send_ping: getsockopt failed, Operation not \
supported&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Below is the \
XML of my migrated instance:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;?xml \
version='1.0' encoding='utf-8'?&gt;&lt;/div&gt;&lt;div&gt;&lt;domain \
type='kvm'&gt;&lt;/div&gt;&lt;div&gt;   &lt;!-- generated by virt-v2v \
1.32.7rhel=7,release=3.el7.centos,libvirt --&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;name&gt;localhost&lt;/name&gt;&lt;/div&gt;&lt;div&gt;   &lt;memory \
unit='KiB'&gt;4194304&lt;/memory&gt;&lt;/div&gt;&lt;div&gt;   &lt;currentMemory \
unit='KiB'&gt;4194304&lt;/currentMemory&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;vcpu&gt;2&lt;/vcpu&gt;&lt;/div&gt;&lt;div&gt;   &lt;os&gt;&lt;/div&gt;&lt;div&gt;      &lt;type \
arch='x86_64'&gt;hvm&lt;/type&gt;&lt;/div&gt;&lt;div&gt;   &lt;/os&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;features&gt;&lt;/div&gt;&lt;div&gt;      &lt;acpi/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;apic/&gt;&lt;/div&gt;&lt;div&gt;   &lt;/features&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;on_reboot&gt;restart&lt;/on_reboot&gt;&lt;/div&gt;&lt;div&gt;   \
&lt;on_crash&gt;restart&lt;/on_crash&gt;&lt;/div&gt;&lt;div&gt;   &lt;devices&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;disk type='file' device='disk'&gt;&lt;/div&gt;&lt;div&gt;         &lt;driver \
name='qemu' type='raw' cache='none'/&gt;&lt;/div&gt;&lt;div&gt;         \
&lt;source file='/home/tstrike39/Virtuals/localhost-sda'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;target dev='vda' bus='virtio'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/disk&gt;&lt;/div&gt;&lt;div&gt;      &lt;interface type='network'&gt;&lt;/div&gt;&lt;div&gt;     \
&lt;source network='default'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;model \
type='virtio'/&gt;&lt;/div&gt;&lt;div&gt;         &lt;mac \
address='f0:de:f1:08:9c:c4'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/interface&gt;&lt;/div&gt;&lt;div&gt;      &lt;video&gt;&lt;/div&gt;&lt;div&gt;         &lt;model \
type='cirrus' vram='9216' heads='1'/&gt;&lt;/div&gt;&lt;div&gt;      \
&lt;/video&gt;&lt;/div&gt;&lt;div&gt;      &lt;graphics type='vnc' autoport='yes' \
port='-1'/&gt;&lt;/div&gt;&lt;div&gt;      &lt;input type='tablet' \
bus='usb'/&gt;&lt;/div&gt;&lt;div&gt;      &lt;input type='mouse' \
bus='ps2'/&gt;&lt;/div&gt;&lt;div&gt;      &lt;console type='pty'/&gt;&lt;/div&gt;&lt;div&gt; \
&lt;/devices&gt;&lt;/div&gt;&lt;div&gt;&lt;/domain&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Any \
help would be appreciated!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
 &lt;/div&gt;



</body></email><email><emailId>20170110055944</emailId><senderName>"=?gb18030?B?t8XFo7DgtcS0uszs?="</senderName><senderEmail>446844717@qq.com</senderEmail><timestampReceived>2017-01-10 05:59:44-0400</timestampReceived><subject>[libvirt-users] =?gb18030?b?u9i4tKO6IFtsaWJ2aXJ0XSB4bWwgY29uZmln?= =?gb18030?q?_nested?=</subject><body>

[Attachment #2 (text/plain)]

thanks your mail£¬now below£º


If the KVM supports nested VMX and QEMU starts with the arguments -enable-kvm and
    -cpu ..., + vmx, then the LOCK bit of the guest MSR_IA32_FEATURE_CONTROL and
    Enable VMX out of SMX operation bit will be set.


Well, I should add -enable-kvm parameters of the document which xml position, Exactly \
speaking, how to amend xml configuration file?





------------------ Ô­Ê¼ÓÊ¼þ ------------------
·¢¼þÈË: "Daniel P. Berrange";&lt;berrange@redhat.com&gt;;
·¢ËÍÊ±¼ä: 2017Äê1Ô 5ÈÕ(ÐÇÆÚËÄ) ÍíÉÏ8:53
ÊÕ¼þÈË: "·ÅÅ£°àµÄ´ºÌì"&lt;446844717@qq.com&gt;; 
³­ËÍ: "libvirt-users"&lt;libvirt-users@redhat.com&gt;; 
Ö÷Ìâ: Re: [libvirt] xml config nested



NB, in future please don't CC all possible mailing lists at once.
Just pick the most appropriate mailing list for your question. I've
dropped libvirt-list &amp; libvirt-announce from the CC, since this is
a question most suited for libvirt-users.

On Thu, Jan 05, 2017 at 11:44:29AM +0800, ·ÅÅ£°àµÄ´ºÌì wrote:
&gt; How to configure libvirt, so qemu-kvm support nested virtualization, virtual \
&gt; machine installed operating system is windows_7_ultimate_sp1_x64_dvd_618537.iso, \
&gt; configure libvirt xml file is as follows: 
&gt; &lt;cpu mode='custom' match='exact'&gt;
&gt; &lt;model fallback='allow'&gt;core2duo&lt;/model&gt;
&gt; &lt;feature policy='require' name='vmx'/&gt;
&gt; &lt;/cpu&gt;
&gt; 
&gt; 
&gt; or
&gt; 
&gt; &lt;cpu mode='host-model'&gt;
&gt; &lt;model fallback='allow'/&gt;
&gt; &lt;/cpu&gt;
&gt; 
&gt; or
&gt; &lt;cpu mode='host-passthrough'&gt;
&gt; &lt;topology sockets='2' cores='2' threads='2'/&gt;
&gt; &lt;/cpu&gt;

Yes, that's the key guest configuration step - exposing the 'vmx' feature
to the guest.

In addition to that though, you need to make sure the kvm-intel kernel
module in your host has the "nested=1" parameter set.

eg in /etc/modprobe.d/kvm.conf you want

 options kvm_intel nested=1

If loaded correctly you should see

# cat /sys/module/kvm_intel/parameters/nested 
Y

if it says "N", then nested VMX will be disabled.

Regards,
Daniel
-- 
&gt; &gt; http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
&gt; &gt; http://libvirt.org              -o-             http://virt-manager.org :|
&gt; &gt; http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|


[Attachment #3 (text/html)]

&lt;div&gt;&lt;div&gt;&lt;font face="lucida Grande, Verdana, Microsoft YaHei"&gt;thanks your mail£¬now \
below£º&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="lucida Grande, Verdana, Microsoft \
YaHei"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="lucida Grande, Verdana, Microsoft YaHei"&gt;If \
the KVM supports nested VMX and QEMU starts with the arguments -enable-kvm \
and&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="lucida Grande, Verdana, Microsoft YaHei"&gt;  \
  -cpu ..., + vmx, then the LOCK bit of the guest MSR_IA32_FEATURE_CONTROL \
and&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face="lucida Grande, Verdana, Microsoft YaHei"&gt;  \
  Enable VMX out of SMX operation bit will be set.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="lucida Grande, Verdana, Microsoft YaHei"&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font \
face="lucida Grande, Verdana, Microsoft YaHei"&gt;Well, I should add -enable-kvm \
parameters of the document which xml position, Exactly speaking, how to amend \
xml configuration file?&lt;/font&gt;&lt;/div&gt;&lt;span style="  ; ; ;; \
"&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div style="font-size: \
12px;font-family: Arial Narrow;padding:2px 0 2px 0;"&gt;------------------ Ô­Ê¼ÓÊ¼þ \
------------------&lt;/div&gt;&lt;div style="font-size: \
12px;background:#efefef;padding:8px;"&gt;&lt;div&gt;&lt;b&gt;·¢¼þÈË:&lt;/b&gt; "Daniel P. \
Berrange";&lt;berrange@redhat.com&gt;;&lt;/div&gt;&lt;div&gt;&lt;b&gt;·¢ËÍÊ±¼ä:&lt;/b&gt; 2017Äê1Ô \
5ÈÕ(ÐÇÆÚËÄ) ÍíÉÏ8:53&lt;/div&gt;&lt;div&gt;&lt;b&gt;ÊÕ¼þÈË:&lt;/b&gt; "·ÅÅ£°àµÄ´ºÌì"&lt;446844717@qq.com&gt;; \
&lt;wbr&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;³­ËÍ:&lt;/b&gt; "libvirt-users"&lt;libvirt-users@redhat.com&gt;; \
&lt;wbr&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Ö÷Ìâ:&lt;/b&gt; Re: [libvirt] xml config \
nested&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;NB, in future please don't CC all possible mailing \
lists at once.&lt;br&gt;Just pick the most appropriate mailing list for your question. \
I've&lt;br&gt;dropped libvirt-list &amp; libvirt-announce from the CC, since this is&lt;br&gt;a \
question most suited for libvirt-users.&lt;br&gt;&lt;br&gt;On Thu, Jan 05, 2017 at 11:44:29AM \
+0800, ·ÅÅ£°àµÄ´ºÌì wrote:&lt;br&gt;&gt; How to configure libvirt, so qemu-kvm support \
nested virtualization, virtual machine installed operating system is \
windows_7_ultimate_sp1_x64_dvd_618537.iso, configure libvirt xml file is as \
follows:&lt;br&gt;&gt; &lt;br&gt;&gt;  &lt;cpu mode='custom' \
match='exact'&gt;&lt;br&gt;&gt;     &lt;model \
fallback='allow'&gt;core2duo&lt;/model&gt;&lt;br&gt;&gt;     &lt;feature \
policy='require' name='vmx'/&gt;&lt;br&gt;&gt;   &lt;/cpu&gt;&lt;br&gt;&gt; &lt;br&gt;&gt; \
&lt;br&gt;&gt; or&lt;br&gt;&gt; &lt;br&gt;&gt;   &lt;cpu mode='host-model'&gt;&lt;br&gt;&gt;   \
  &lt;model fallback='allow'/&gt;&lt;br&gt;&gt;   &lt;/cpu&gt;&lt;br&gt;&gt; &lt;br&gt;&gt; \
or&lt;br&gt;&gt;  &lt;cpu mode='host-passthrough'&gt;&lt;br&gt;&gt;     \
&lt;topology sockets='2' cores='2' threads='2'/&gt;&lt;br&gt;&gt;   \
&lt;/cpu&gt;&lt;br&gt;&lt;br&gt;Yes, that's the key guest configuration step - exposing the 'vmx' \
feature&lt;br&gt;to the guest.&lt;br&gt;&lt;br&gt;In addition to that though, you need to make sure the \
kvm-intel kernel&lt;br&gt;module in your host has the "nested=1" parameter set.&lt;br&gt;&lt;br&gt;eg \
in /etc/modprobe.d/kvm.conf you want&lt;br&gt;&lt;br&gt; options kvm_intel \
nested=1&lt;br&gt;&lt;br&gt;If loaded correctly you should see&lt;br&gt;&lt;br&gt;# cat \
/sys/module/kvm_intel/parameters/nested &lt;br&gt;Y&lt;br&gt;&lt;br&gt;if it says "N", then nested VMX \
will be disabled.&lt;br&gt;&lt;br&gt;Regards,&lt;br&gt;Daniel&lt;br&gt;-- &lt;br&gt;|: \
http://berrange.com      -o-    \
http://www.flickr.com/photos/dberrange/ :|&lt;br&gt;|: \
http://libvirt.org            \
  -o-             \
http://virt-manager.org :|&lt;br&gt;|: http://entangle-photo.org     \
  -o-    http://search.cpan.org/~danberr/ :|&lt;/div&gt;



</body></email><email><emailId>20170110094938</emailId><senderName>"Daniel P. Berrange"</senderName><senderEmail>berrange@redhat.com</senderEmail><timestampReceived>2017-01-10 09:49:38-0400</timestampReceived><subject>Re: [libvirt-users] changing to cache='none' on the fly?</subject><body>

On Mon, Jan 09, 2017 at 10:29:01AM -0800, W Kern wrote:
&gt; As is already well documented, we find that we need cache='none' to support
&gt; migration, otherwise there is the chance of a hang and/or failure to pivot.
&gt; 
&gt; However we prefer the default of cache=writethrough when operating in
&gt; production.
&gt; 
&gt; Our practice is to 'shutdown' the VM completely make the change with virsh
&gt; edit,  then restart.  Then we have to repeat the process to revert back once
&gt; we migrate.
&gt; 
&gt; Is it possible to change that function on the fly and avoid the
&gt; shutdown/start process?

Nope, there's no way to change the cache mode on the fly.

&gt; Note: we have had inconsistent results with virsh edit first and then a
&gt; reboot. A complete shutdown seems to be necessary, but I am hoping there is
&gt; some other procedure available.

"virsh edit" will always just change the offline persistent config.

This config will be used next time the guest is *cold* booted. If
you just do a reboot inside the guest, this is a warm reboot, and
so the QEMU process never stops running. This means we don't pick
up the new offline config you wrote.

Regards,
Daniel
-- 
|: http://berrange.com      -o-    http://www.flickr.com/photos/dberrange/ :|
|: http://libvirt.org              -o-             http://virt-manager.org :|
|: http://entangle-photo.org       -o-    http://search.cpan.org/~danberr/ :|

</body></email><email><emailId>20170114010905</emailId><senderName>Anubhav Guleria</senderName><senderEmail>anubhav.nitsri.it@gmail.com</senderEmail><timestampReceived>2017-01-14 01:09:05-0400</timestampReceived><subject>Re: [libvirt-users] Regarding Migration Statistics</subject><body>

Actually my setup is like this:

I have one controller host that do this migration between other two nodes
say A and B. Now where should this virDomainGetJobStats method should be
invoked from ?

If at present VM is migrated from A to B then should B call this method?

It's not clear.



"CODENAME FREAK -47"

On Tue, Jan 10, 2017 at 8:48 PM, Jiri Denemark &lt;jdenemar@redhat.com&gt; wrote:

&gt; Please, do not post to several libvirt lists at once.
&gt;
&gt; &gt; I am writing a code using libvirt API to migrate VM between two physical
&gt; &gt; hosts *(QEMU/KVM) , *say some *n *number of times.
&gt; &gt;
&gt; &gt; *1)* I am using right now* virDomainPtr virDomainMigrate (.......) *and
&gt; to
&gt; &gt; calculate the total migration time I am using something like this:
&gt; &gt;
&gt; &gt; *clock_gettime(CLOCK_MONOTONIC_RAW,&amp;begin);  *
&gt; &gt;  *migrate*(domainToMigrate,nodeToMigrate);
&gt; &gt;
&gt; &gt; *clock_gettime(CLOCK_MONOTONIC_RAW,&amp;end);*
&gt; &gt;
&gt; &gt; *Total Migration Time = end.tv_sec-begin.tv_sec*
&gt; &gt;
&gt; &gt; Is this correct way to calculate total migration time. And is there some
&gt; &gt; way to calculate the downtime (not how to set it)?
&gt;
&gt; Well, just call virDomainGetJobStats and you will get both total time
&gt; and downtime and many more.
&gt;
&gt; &gt; virDomainGetJobStats
&gt; &gt; &lt;http://libvirt.org/html/libvirt-libvirt-domain.html#
&gt; virDomainGetJobStats&gt;
&gt;
&gt; Yes, this is the right API to get all the statistics you want. It
&gt; returns a list of (key, type, value) entires in params. The keys are
&gt; VIR_DOMAIN_JOB_* (see
&gt; http://libvirt.org/html/libvirt-libvirt-domain.html#
&gt; VIR_DOMAIN_JOB_AUTO_CONVERGE_THROTTLE
&gt; and a lot of other VIR_DOMAIN_JOB_* macros following this one for
&gt; details). You can look at
&gt; http://libvirt.org/git/?p=libvirt.git;a=blob;f=tools/virsh-domain.c;h=
&gt; 93587e8bc7c79cbb66b6ee107472dfec5f320dab;hb=HEAD
&gt;
&gt; In short, just call
&gt;
&gt;     virTypedParamsGetULLong(params, nparams, VIR_DOMAIN_JOB_DOWNTIME,
&gt;                             &amp;value)
&gt;
&gt; to fetch downtime from params into value if it was present there (check
&gt; return value of the API). The exact API to call is different for each
&gt; type, although all migration statistics are unsigned long long so this
&gt; one is all you need.
&gt;
&gt; BTW, you can call virDomainGetJobStats anytime while migration is
&gt; running to monitor its progress. To check statistics of a completed
&gt; migration it's easier to just register a callback for
&gt; VIR_DOMAIN_EVENT_ID_JOB_COMPLETED event. See
&gt; http://libvirt.org/git/?p=libvirt.git;a=blob;f=examples/
&gt; object-events/event-test.c;h=55c004f93f40de628ae76221bb8ef9
&gt; a13b2acb3d;hb=HEAD#l940
&gt; for an example.
&gt;
&gt; Jirka
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Actually my setup is like this:&lt;br&gt;&lt;br&gt;&lt;/div&gt;I have one \
controller host that do this migration between other two nodes say A and B. Now where \
should this virDomainGetJobStats method should be invoked from ?&lt;br&gt;  &lt;br&gt;&lt;/div&gt;If at \
present VM is migrated from A to B then should B call this \
method?&lt;br&gt;&lt;br&gt;&lt;/div&gt;It's not clear.&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br clear="all"&gt;&lt;div&gt;&lt;div class="gmail_signature" \
data-smartmail="gmail_signature"&gt;&lt;div dir="ltr"&gt;"CODENAME FREAK \
-47"&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; &lt;br&gt;&lt;div class="gmail_quote"&gt;On Tue, Jan 10, 2017 at 8:48 \
PM, Jiri Denemark &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:jdenemar@redhat.com" \
target="_blank"&gt;jdenemar@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;Please, do not post to several libvirt lists at once.&lt;br&gt; \
&lt;span class=""&gt;&lt;br&gt; &gt; I am writing a code using libvirt API to migrate VM between \
two physical&lt;br&gt; &lt;/span&gt;&gt; hosts *(QEMU/KVM) , *say some *n *number of times.&lt;br&gt;
&gt;&lt;br&gt;
&gt; *1)* I am using right now* virDomainPtr virDomainMigrate (.......) *and to&lt;br&gt;
&lt;span class=""&gt;&gt; calculate the total migration time I am using something like \
this:&lt;br&gt; &gt;&lt;br&gt;
&lt;/span&gt;&gt; *clock_gettime(CLOCK_&lt;wbr&gt;MONOTONIC_RAW,&amp;begin);   *&lt;br&gt;
&gt;   *migrate*(domainToMigrate,&lt;wbr&gt;nodeToMigrate);&lt;br&gt;
&gt;&lt;br&gt;
&gt; *clock_gettime(CLOCK_&lt;wbr&gt;MONOTONIC_RAW,&amp;end);*&lt;br&gt;
&gt;&lt;br&gt;
&gt; *Total Migration Time = end.tv_sec-begin.tv_sec*&lt;br&gt;
&lt;span class=""&gt;&gt;&lt;br&gt;
&gt; Is this correct way to calculate total migration time. And is there some&lt;br&gt;
&gt; way to calculate the downtime (not how to set it)?&lt;br&gt;
&lt;br&gt;
&lt;/span&gt;Well, just call virDomainGetJobStats and you will get both total time&lt;br&gt;
and downtime and many more.&lt;br&gt;
&lt;br&gt;
&gt; virDomainGetJobStats&lt;br&gt;
&gt; &lt;&lt;a href="http://libvirt.org/html/libvirt-libvirt-domain.html#virDomainGetJobStats" \
rel="noreferrer" target="_blank"&gt;http://libvirt.org/html/&lt;wbr&gt;libvirt-libvirt-domain.html#&lt;wbr&gt;virDomainGetJobStats&lt;/a&gt;&gt;&lt;br&gt;
 &lt;br&gt;
Yes, this is the right API to get all the statistics you want. It&lt;br&gt;
returns a list of (key, type, value) entires in params. The keys are&lt;br&gt;
VIR_DOMAIN_JOB_* (see&lt;br&gt;
&lt;a href="http://libvirt.org/html/libvirt-libvirt-domain.html#VIR_DOMAIN_JOB_AUTO_CONVERGE_THROTTLE" \
rel="noreferrer" target="_blank"&gt;http://libvirt.org/html/&lt;wbr&gt;libvirt-libvirt-domain.html#&lt;wbr&gt;VIR_DOMAIN_JOB_AUTO_CONVERGE_&lt;wbr&gt;THROTTLE&lt;/a&gt;&lt;br&gt;
 and a lot of other VIR_DOMAIN_JOB_* macros following this one for&lt;br&gt;
details). You can look at&lt;br&gt;
&lt;a href="http://libvirt.org/git/?p=libvirt.git;a=blob;f=tools/virsh-domain.c;h=93587e8bc7c79cbb66b6ee107472dfec5f320dab;hb=HEAD" \
rel="noreferrer" target="_blank"&gt;http://libvirt.org/git/?p=&lt;wbr&gt;libvirt.git;a=blob;f=t \
ools/&lt;wbr&gt;virsh-domain.c;h=&lt;wbr&gt;93587e8bc7c79cbb66b6ee107472df&lt;wbr&gt;ec5f320dab;hb=HEAD&lt;/a&gt;&lt;br&gt;
 &lt;br&gt;
In short, just call&lt;br&gt;
&lt;br&gt;
      virTypedParamsGetULLong(&lt;wbr&gt;params, nparams, VIR_DOMAIN_JOB_DOWNTIME,&lt;br&gt;
                                          &amp;value)&lt;br&gt;
&lt;br&gt;
to fetch downtime from params into value if it was present there (check&lt;br&gt;
return value of the API). The exact API to call is different for each&lt;br&gt;
type, although all migration statistics are unsigned long long so this&lt;br&gt;
one is all you need.&lt;br&gt;
&lt;br&gt;
BTW, you can call virDomainGetJobStats anytime while migration is&lt;br&gt;
running to monitor its progress. To check statistics of a completed&lt;br&gt;
migration it's easier to just register a callback for&lt;br&gt;
VIR_DOMAIN_EVENT_ID_JOB_&lt;wbr&gt;COMPLETED event. See&lt;br&gt;
&lt;a href="http://libvirt.org/git/?p=libvirt.git;a=blob;f=examples/object-events/event-test.c;h=55c004f93f40de628ae76221bb8ef9a13b2acb3d;hb=HEAD#l940" \
rel="noreferrer" target="_blank"&gt;http://libvirt.org/git/?p=&lt;wbr&gt;libvirt.git;a=blob;f=e \
xamples/&lt;wbr&gt;object-events/event-test.c;h=&lt;wbr&gt;55c004f93f40de628ae76221bb8ef9&lt;wbr&gt;a13b2acb3d;hb=HEAD#l940&lt;/a&gt;&lt;br&gt;
 for an example.&lt;br&gt;
&lt;br&gt;
Jirka&lt;br&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170117172726</emailId><senderName>W Kern</senderName><senderEmail>wkern@pixelgate.net</senderEmail><timestampReceived>2017-01-17 17:27:26-0400</timestampReceived><subject>Re: [libvirt-users] io=native &amp; io=threads</subject><body>



On 1/17/2017 1:51 AM, Daniel P. Berrange wrote:
&gt;
&gt; Also note the io setting is only relevant for file/block device
&gt; backed disks. ie if using the in-QEMU network client for RBD,
&gt; Gluster, iSCSI, NFS, etc thenm the io setting has no effect at
&gt; all so can be ignored.


Ahh, that is important. We mostly use local storage just for the "must 
be fast" stuff.
All others are on shared storage (old-school Gluster, simple replication).

Much Thanks.

</body></email><email><emailId>20170121170245</emailId><senderName>Govert</senderName><senderEmail>govert.br@gmail.com</senderEmail><timestampReceived>2017-01-21 17:02:45-0400</timestampReceived><subject>Re: [libvirt-users] Controlling the name of the 'tap0' device, in a bridged networking setup</subject><body>

Ok, that indeed rules out this other option. Thanks for letting me know.
I'm still discovering the basics of libvirt/qemu/Linux networking, this
definitely prevents some unnecessary experimentation :)

Best,
Govert

2017-01-20 17:20 GMT+01:00 Laine Stump &lt;laine@laine.org&gt;:

&gt; On 01/20/2017 05:47 AM, Govert wrote:
&gt;
&gt; Thanks !! This clarifies completely what is happening. I'll look into
&gt; running virsh as root/attaching to qemu:///system. Or, perhaps I can
&gt; 'statically' create tun devices, to which the domains attach when started
&gt; (although I have no idea weather this is possible).
&gt;
&gt;
&gt; It isn't just the creationof the tap device that requires privileges, it's
&gt; also the opening of the tap, and attaching it to the bridge. There isn't
&gt; any way to do the latter two from unprivileged libvirtd (except via
&gt; qemu-bridge-helper, which insists on creating a new tap device), so I think
&gt; you're going to have to switch to qemu:///system.
&gt;
&gt;
&gt; Best,
&gt; Govert
&gt;
&gt; 2017-01-17 20:46 GMT+01:00 Laine Stump &lt;laine@laine.org&gt;:
&gt;
&gt;&gt; On 01/14/2017 06:30 AM, Govert wrote:
&gt;&gt;
&gt;&gt;&gt; Hi,
&gt;&gt;&gt;
&gt;&gt;&gt; I'm trying to control the name of the 'tap0' device that gets created as
&gt;&gt;&gt; I start a domain that uses bridged networking. The XML specification of the
&gt;&gt;&gt; domain contains the following configuration
&gt;&gt;&gt;
&gt;&gt;&gt;     &lt;interface type='bridge'&gt;
&gt;&gt;&gt;       &lt;source bridge='br0'/&gt;
&gt;&gt;&gt;     &lt;/interface&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; The libvirt documentation (http://libvirt.org/formatdoma
&gt;&gt;&gt; in.html#elementsNICSBridge) and other discussions online tell me that I
&gt;&gt;&gt; just need to include the &lt;target dev='desired_dev_name'/&gt; tag in the XML
&gt;&gt;&gt; specification of the domain under the &lt;interface&gt; tag. Unfortunately doing
&gt;&gt;&gt; so appears to have no effect; the tun device created and 'enslaved' in the
&gt;&gt;&gt; bridge is still called 'tap0'. Interestingly, I never get a tun device with
&gt;&gt;&gt; a name prefixed by 'vnet' or 'vif' which, according to the documentation,
&gt;&gt;&gt; is the default behaviour (?). The host is running CentOS 7, and virsh is
&gt;&gt;&gt; used to start the domain.
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; This is because you're running virsh as  a non-privileged user (rather
&gt;&gt; than root) and so are connecting to that user's personal non-privileged
&gt;&gt; libvirtd (aka qemu:///session) rather than the system's privileged libvirtd
&gt;&gt; (qemu:///system). When using qemu:///session, libvirtd is unable to create
&gt;&gt; tap devices itself (because it doesn't have sufficient privilege for it),
&gt;&gt; so it executes qemu-bridge-helper (from the qemu package) requesting that a
&gt;&gt; tap device be created and attached to the bridge device specified on its
&gt;&gt; commandline. Unfortunately, qemu-bridge-helper doesn't provide any way to
&gt;&gt; specify the tap device name, so you get what it decides to give you (which
&gt;&gt; happens to be "tap%d").
&gt;&gt;
&gt;&gt; If you want more control over the name of the tap device (and many other
&gt;&gt; things), you should look into using qemu:///system. That may seem less
&gt;&gt; secure, but libvirt actually does a very good job of confining the qemu
&gt;&gt; process - after setting up all the resources that will be needed (which are
&gt;&gt; labeled with an selinux context unique to this particular guest) and
&gt;&gt; setting up cgroups to limit use of system resources, it switches to a
&gt;&gt; different (non-privileged) uid and drops all capabilities before exec'ing
&gt;&gt; qemu.
&gt;&gt;
&gt;&gt; (Note that, even if you're using qemu:///system, any manually-specified
&gt;&gt; tap device name that starts with "vnet" will be discarded (it assumes that
&gt;&gt; it is an auto-generated name left over from a previous run, or from
&gt;&gt; plugging a domain's status XML into virsh define)).
&gt;&gt;
&gt;
&gt;
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;Ok, that indeed rules out this other option. Thanks for letting me \
know. I'm still discovering the basics of libvirt/qemu/Linux networking, this \
definitely prevents some unnecessary experimentation \
:)&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Best,&lt;/div&gt;&lt;div&gt;Govert&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;2017-01-20 17:20 GMT+01:00 Laine \
Stump &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:laine@laine.org" \
target="_blank"&gt;laine@laine.org&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote class="gmail_quote" \
style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;  
    
  
  &lt;div bgcolor="#FFFFFF" text="#000000"&gt;&lt;span class=""&gt;
    &lt;div class="m_8966006582885069863moz-cite-prefix"&gt;On 01/20/2017 05:47 AM, Govert \
wrote:&lt;br&gt;  &lt;/div&gt;
    &lt;blockquote type="cite"&gt;
      &lt;div dir="ltr"&gt;Thanks !! This clarifies completely what is
        happening. I'll look into running virsh as root/attaching to
        qemu:///system. Or, perhaps I can 'statically' create tun
        devices, to which the domains attach when started (although I
        have no idea weather this is possible). &lt;br&gt;
      &lt;/div&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;&lt;/span&gt;
    It isn't just the creationof the tap device that requires
    privileges, it's also the opening of the tap, and attaching it to
    the bridge. There isn't any way to do the latter two from
    unprivileged libvirtd (except via qemu-bridge-helper, which insists
    on creating a new tap device), so I think you're going to have to
    switch to qemu:///system.&lt;span class=""&gt;&lt;br&gt;
    &lt;br&gt;
    &lt;blockquote type="cite"&gt;
      &lt;div dir="ltr"&gt;
        &lt;div&gt;&lt;br&gt;
        &lt;/div&gt;
        &lt;div&gt;Best,&lt;/div&gt;
        &lt;div&gt;Govert&lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="gmail_extra"&gt;&lt;br&gt;
        &lt;div class="gmail_quote"&gt;2017-01-17 20:46 GMT+01:00 Laine Stump
          &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:laine@laine.org" \
                target="_blank"&gt;laine@laine.org&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;
          &lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px \
                #ccc solid;padding-left:1ex"&gt;&lt;span&gt;On 01/14/2017 06:30 AM, Govert \
                wrote:&lt;br&gt;
              &lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt;  Hi,&lt;br&gt;
                &lt;br&gt;
                I'm trying to control the name of the 'tap0' device that
                gets created as I start a domain that uses bridged
                networking. The XML specification of the domain contains
                the following configuration&lt;br&gt;
                &lt;br&gt;
                      &lt;interface type='bridge'&gt;&lt;br&gt;
                         &lt;source bridge='br0'/&gt;&lt;br&gt;
                      &lt;/interface&gt;&lt;br&gt;
                &lt;br&gt;
                The libvirt documentation (&lt;a \
href="http://libvirt.org/formatdomain.html#elementsNICSBridge" rel="noreferrer" \
target="_blank"&gt;http://libvirt.org/formatdoma&lt;wbr&gt;in.html#elementsNICSBridge&lt;/a&gt;)  \
                and other discussions online tell me that I just need to
                include the &lt;target dev='desired_dev_name'/&gt; tag
                in the XML specification of the domain under the
                &lt;interface&gt; tag. Unfortunately doing so appears to
                have no effect; the tun device created and 'enslaved' in
                the bridge is still called 'tap0'. Interestingly, I
                never get a tun device with a name prefixed by 'vnet' or
                'vif' which, according to the documentation, is the
                default behaviour (?). The host is running CentOS 7, and
                virsh is used to start the domain.&lt;br&gt;
              &lt;/blockquote&gt;
              &lt;br&gt;
            &lt;/span&gt;
            This is because you're running virsh as   a non-privileged
            user (rather than root) and so are connecting to that user's
            personal non-privileged libvirtd (aka qemu:///session)
            rather than the system's privileged libvirtd
            (qemu:///system). When using qemu:///session, libvirtd is
            unable to create tap devices itself (because it doesn't have
            sufficient privilege for it), so it executes
            qemu-bridge-helper (from the qemu package) requesting that a
            tap device be created and attached to the bridge device
            specified on its commandline. Unfortunately,
            qemu-bridge-helper doesn't provide any way to specify the
            tap device name, so you get what it decides to give you
            (which happens to be "tap%d").&lt;br&gt;
            &lt;br&gt;
            If you want more control over the name of the tap device
            (and many other things), you should look into using
            qemu:///system. That may seem less secure, but libvirt
            actually does a very good job of confining the qemu process
            - after setting up all the resources that will be needed
            (which are labeled with an selinux context unique to this
            particular guest) and setting up cgroups to limit use of
            system resources, it switches to a different
            (non-privileged) uid and drops all capabilities before
            exec'ing qemu.&lt;br&gt;
            &lt;br&gt;
            (Note that, even if you're using qemu:///system, any
            manually-specified tap device name that starts with "vnet"
            will be discarded (it assumes that it is an auto-generated
            name left over from a previous run, or from plugging a
            domain's status XML into virsh define)).&lt;br&gt;
          &lt;/blockquote&gt;
        &lt;/div&gt;
        &lt;br&gt;
      &lt;/div&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;&lt;br&gt;
    &lt;/p&gt;
  &lt;/span&gt;&lt;/div&gt;

&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170123125158</emailId><senderName>Peter Krempa</senderName><senderEmail>pkrempa@redhat.com</senderEmail><timestampReceived>2017-01-23 12:51:58-0400</timestampReceived><subject>Re: [libvirt-users] gluster store and autostart - but fails</subject><body>


On Tue, Jan 17, 2017 at 11:27:18 +0000, lejeczek wrote:
&gt; hi all
&gt; I've a few guest which work/run perfectly fine, I believe, except for
&gt; autostart.
&gt; Configuration of system, gluster and libvirt is pretty regular and not
&gt; complex.

Unfortunately the autostart facility for libvirt VMs is very unflexible
in regards to checking conditions whether certain VMs will work.

I'd suggest you create a unit file that starts the VM after it's certain
that all services that are required are available. That way you can
express the dependencies in a better way.

&gt; Errors I see:
&gt; ...
&gt; failed to initialize gluster connection (src=0x7f9424266350
&gt; priv=0x7f94242922b0): Transport endpoint is
&gt; internal error: Failed to autostart VM 'rhel-work2': failed to initialize
&gt; gluster connection (src=0x7f9
&gt; failed to initialize gluster connection (src=0x7f942423fef0
&gt; priv=0x7f9424256320): Transport endpoint is
&gt; internal error: Failed to autostart VM 'rhel-work3': failed to initialize
&gt; gluster connection (src=0x7f9
&gt; failed to initialize gluster connection (src=0x7f9424261b20
&gt; priv=0x7f94242a18b0): Transport endpoint is
&gt; internal error: Failed to autostart VM 'rhel-work1': failed to initialize
&gt; gluster connection (src=0x7f9
&gt; ...
&gt; 
&gt; I tried to make systemd libvirtd to wait for gluster:
&gt; 
&gt; After=glusterd.service
&gt; 
&gt; but if that's all required then, well, still fails.

Depends whether the glusterd service is able to receive connection right
after systemd thinks it's started. If a service takes some time to
initialize it has to tell systemd when it's ready, so this might be one
possible issue.

["signature.asc" (application/pgp-signature)]

</body></email><email><emailId>20170123133111</emailId><senderName>Fabrizio Soppelsa</senderName><senderEmail>fsoppelsa@mirantis.com</senderEmail><timestampReceived>2017-01-23 13:31:11-0400</timestampReceived><subject>[libvirt-users] KVM live migration issues for Windows guests</subject><body>

Hi,

  

We're repeatedly facing a live migration issue with Windows guests, would be
great if someone could send their thoughts/suggestions/experience on how to
further troubleshoot this.

  

When we live migrate a Windows instance, it gets migrated (guest is running on
the destination host), but it eventually internally hangs. From the Windows
logs, the operating system has tried to shut down during the live migration.

  

There is no info at all, even at debug level, in libvirt logs.

I'm thinking to go with perf kvm or maybe kernel upgrade, but it might be I'm
missing something obvious in Windows for this scenario?

  

QEMU 2.0.0  
Libvirtd 1.2.2  
Host kernel version : 3.13.0-40-generic  
Windows version: Windows 2012 R2  

Has RBD volumes attached driver name='qemu' type='raw' cache='writeback'/, but
reproduced also without.

  

Thanks!

![](https://link.nylas.com/open/bi1c6xnw46zc0gy4ozrqerfkk/local-e0bf2fff-
21e6?r=bGlidmlydC11c2Vyc0ByZWRoYXQuY29t)


[Attachment #3 (text/html)]

Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We're repeatedly facing a live migration issue with Windows \
guests, would be great if someone could send their thoughts/suggestions/experience on \
how to further troubleshoot this.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When we live migrate a \
Windows instance, it gets migrated (guest is running on the destination host), but it \
eventually internally hangs. From the Windows logs, the operating system has tried to \
shut down during the live migration.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;There is no info at \
all, even at debug level, in libvirt logs.&lt;/div&gt;&lt;div&gt;I'm thinking to go with \
perf kvm or maybe kernel upgrade, but it might be I'm missing something obvious in \
Windows for this scenario?&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;QEMU \
2.0.0 &lt;br&gt;Libvirtd 1.2.2&lt;br&gt;Host kernel version : \
3.13.0-40-generic&lt;br&gt;Windows version: Windows 2012 R2&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;Has \
RBD volumes attached driver name='qemu' type='raw' cache='writeback'/, but reproduced \
also without.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks!&lt;/div&gt;&lt;img class="n1-open" width="0" \
height="0" style="border:0; width:0; height:0;" \
src="https://link.nylas.com/open/bi1c6xnw46zc0gy4ozrqerfkk/local-e0bf2fff-21e6?r=bGlidmlydC11c2Vyc0ByZWRoYXQuY29t"&gt;




</body></email><email><emailId>20170125191058</emailId><senderName>Dennis Jacobfeuerborn</senderName><senderEmail>dennisml@conversis.de</senderEmail><timestampReceived>2017-01-25 19:10:58-0400</timestampReceived><subject>[libvirt-users] Unresticted guest trunk network interface</subject><body>

Hi,
is there way to create a network interface for a guest that just
forwards packets tagged with a vlan id?
Currrently I have a guest that has configured 10+ interfaces and for
each one I add I have to create a new vlan interface and a bridge on the
host which makes things rather cumbersome.
What I'd like to have is just one interface eth0 in the guest and then
be able to create eth0.2, eth0.3 in the guest and have the host just
pass them through without interference.
I found some guides on the internet but these always come with some
limitation such as that if you have a vlan interface on the host like
e.g. eth0.8 then the guest no longer receives packets in vlan 8 as there
apparently get consumed by the host.

Is there any solution for this?

Regards,
  Dennis

</body></email><email><emailId>20170126204739</emailId><senderName>Laine Stump</senderName><senderEmail>laine@laine.org</senderEmail><timestampReceived>2017-01-26 20:47:39-0400</timestampReceived><subject>Re: [libvirt-users] dhcp &lt;option&gt; element - is this included yet?</subject><body>

On 01/20/2017 12:14 PM, lejeczek wrote:
&gt; hi all,
&gt; I've seen this: 
&gt; https://www.redhat.com/archives/libvir-list/2013-March/msg00822.html
&gt; it's a few years old and I wonder (I hope) - implemented yet? 

Sorry, but no. Nobody has managed the intersection of time, desire, and 
knowledge. Volunteers?

Which option do you need?

</body></email><email><emailId>20170127104738</emailId><senderName>akhilesh rawat</senderName><senderEmail>akhileshrawat007@gmail.com</senderEmail><timestampReceived>2017-01-27 10:47:38-0400</timestampReceived><subject>Re: [libvirt-users] LibVirt query CPU Model support and restore operation</subject><body>

hi ,

yes you were correct . Model should as per qemu-kvm binary. thanks .
 /usr/libexec/qemu-kvm -name compute-0 -S -machine
pc-i440fx-rhel7.0.0,accel=kvm,usb=off -cpu Haswell,+rtm,+hle -m 61440
-realtime mlock=off

This time KVM is invked with cpu model HAswell.

Also  from proc

rocessor    : 19
vendor_id    : GenuineIntel
cpu family    : 6
model        : 60
*model name    : Intel Core Processor (Haswell)*
stepping    : 1
microcode    : 0x1
cpu MHz        : 1995.110
cache size    : 4096 KB
fpu        : yes
fpu_exception    : yes
cpuid level    : 13
wp        : yes
flags        : fpu de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov
pat pse36 clflush mmx fxsr sse sse2 syscall nx rdtscp lm constant_tsc
rep_good nopl eagerfpu pni pclmulqdq ssse3 cx16 pcid sse4_1 sse4_2 x2apic
popcnt tsc_deadline_timer aes xsave avx hypervisor lahf_lm xsaveopt



Akhilesh


On Fri, Jan 27, 2017 at 3:23 PM, Jiri Denemark &lt;jdenemar@redhat.com&gt; wrote:

&gt; On Fri, Jan 27, 2017 at 13:48:44 +0530, akhilesh rawat wrote:
&gt; &gt; hello ,
&gt; &gt;
&gt; &gt; thanks for comments .
&gt; &gt;
&gt; &gt; I tried now with force options for CPU flag which were not supported .
&gt; Now
&gt; &gt; the command with non fully supported CPU model gets executed ,  But i am
&gt; &gt; surprised to see that still Guest  cpu model is not changed and still
&gt; same
&gt; &gt; as host cpu model(SAndy Bridge)
&gt; &gt;
&gt; &gt; Why don't i see the model as HAswell now , could you please comment.
&gt; &gt;
&gt; &gt; Command used :
&gt; &gt;
&gt; &gt; virt-install --virt-type kvm --name controller-0  --cpu
&gt; &gt; Haswell-noTSX,+fma,+movbe,+fsgsbase,+bmi1,+avx2,+smep,+
&gt; bmi2,+erms,+invpcid
&gt; &gt; --ram=8120 --vcpus=4,sockets=1
&gt; &gt;
&gt; &gt; Linux process for KVM :
&gt; &gt;
&gt; &gt; 7479     1 37 10:13 ?        01:13:21 /usr/libexec/qemu-kvm -name
&gt; &gt; controller-0 -S -machine pc-i440fx-rhel7.0.0,accel=kvm,usb=off *-cpu
&gt; &gt; SandyBridge,*+fma,+pcid,+movbe,+fsgsbase,+bmi1,+avx2,+
&gt; smep,+bmi2,+erms,+invpcid
&gt; &gt; -m 8120 -realtime mlock=off -smp 4,sockets=1,cores=4,threads=1
&gt;
&gt; Your qemu-kvm binary apparently doesn't know what Haswell-noTSX is and
&gt; thus libvirt has to translate it to something QEMU understands. You can
&gt; check supported CPU models with "/usr/libexec/qemu-kvm -cpu ?" (make
&gt; sure the question mark is not expanded by the shell).
&gt;
&gt; Jirka
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;hi ,&lt;br&gt;&lt;br&gt;&lt;/div&gt;yes you were correct . Model \
should as per qemu-kvm binary. thanks . &lt;br&gt;  /usr/libexec/qemu-kvm -name compute-0 \
-S -machine pc-i440fx-rhel7.0.0,accel=kvm,usb=off -cpu Haswell,+rtm,+hle -m 61440 \
-realtime mlock=off &lt;br&gt;&lt;br&gt;&lt;/div&gt;This time KVM is invked with cpu model \
HAswell.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Also   from proc&lt;br&gt;&lt;br&gt;rocessor       : 19&lt;br&gt;vendor_id       \
: GenuineIntel&lt;br&gt;cpu family       : 6&lt;br&gt;model              : 60&lt;br&gt;&lt;b&gt;model name    \
: Intel Core Processor (Haswell)&lt;/b&gt;&lt;br&gt;stepping       : 1&lt;br&gt;microcode       : \
0x1&lt;br&gt;cpu MHz              : 1995.110&lt;br&gt;cache size       : 4096 KB&lt;br&gt;fpu           \
: yes&lt;br&gt;fpu_exception       : yes&lt;br&gt;cpuid level       : 13&lt;br&gt;wp              : \
yes&lt;br&gt;flags              : fpu de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov \
pat pse36 clflush mmx fxsr sse sse2 syscall nx rdtscp lm constant_tsc rep_good nopl \
eagerfpu pni pclmulqdq ssse3 cx16 pcid sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer \
aes xsave avx hypervisor lahf_lm \
xsaveopt&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Akhilesh&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;On Fri, Jan 27, 2017 at 3:23 PM, \
Jiri Denemark &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:jdenemar@redhat.com" \
target="_blank"&gt;jdenemar@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span class=""&gt;On Fri, Jan 27, 2017 at 13:48:44 +0530, \
akhilesh rawat wrote:&lt;br&gt; &gt; hello ,&lt;br&gt;
&gt;&lt;br&gt;
&gt; thanks for comments .&lt;br&gt;
&gt;&lt;br&gt;
&gt; I tried now with force options for CPU flag which were not supported . Now&lt;br&gt;
&gt; the command with non fully supported CPU model gets executed ,   But i am&lt;br&gt;
&gt; surprised to see that still Guest   cpu model is not changed and still same&lt;br&gt;
&gt; as host cpu model(SAndy Bridge)&lt;br&gt;
&gt;&lt;br&gt;
&gt; Why don't i see the model as HAswell now , could you please comment.&lt;br&gt;
&gt;&lt;br&gt;
&gt; Command used :&lt;br&gt;
&gt;&lt;br&gt;
&gt; virt-install --virt-type kvm --name controller-0   --cpu&lt;br&gt;
&gt; Haswell-noTSX,+fma,+movbe,+&lt;wbr&gt;fsgsbase,+bmi1,+avx2,+smep,+&lt;wbr&gt;bmi2,+erms,+invpcid&lt;br&gt;
 &gt; --ram=8120 --vcpus=4,sockets=1&lt;br&gt;
&gt;&lt;br&gt;
&gt; Linux process for KVM :&lt;br&gt;
&gt;&lt;br&gt;
&gt; 7479        1 37 10:13 ?            01:13:21 /usr/libexec/qemu-kvm -name&lt;br&gt;
&lt;/span&gt;&gt; controller-0 -S -machine pc-i440fx-rhel7.0.0,accel=kvm,&lt;wbr&gt;usb=off \
*-cpu&lt;br&gt; &gt; SandyBridge,*+fma,+pcid,+&lt;wbr&gt;movbe,+fsgsbase,+bmi1,+avx2,+&lt;wbr&gt;smep,+bmi2,+erms,+invpcid&lt;br&gt;
 &lt;span class=""&gt;&gt; -m 8120 -realtime mlock=off -smp \
4,sockets=1,cores=4,threads=1&lt;br&gt; &lt;br&gt;
&lt;/span&gt;Your qemu-kvm binary apparently doesn't know what Haswell-noTSX is and&lt;br&gt;
thus libvirt has to translate it to something QEMU understands. You can&lt;br&gt;
check supported CPU models with "/usr/libexec/qemu-kvm -cpu ?" (make&lt;br&gt;
sure the question mark is not expanded by the shell).&lt;br&gt;
&lt;br&gt;
Jirka&lt;br&gt;
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170131043108</emailId><senderName>akhilesh rawat</senderName><senderEmail>akhileshrawat007@gmail.com</senderEmail><timestampReceived>2017-01-31 04:31:08-0400</timestampReceived><subject>Re: [libvirt-users] libvirt does not show same CPU Model as /proc/cpuinfo for CPU Model info.</subject><body>

hi ,
yes there is Libvirt verison are not same as you pointed between Host
(2.0)and Guest (old version 1.2).

Not sure if this can fix the issue .Guest image is pre -compiled image ,let
me try if i can update the libvirt .

 Else i feel In practice it seems Guest CPU cannot simulate non supported
features  by Host CPU Model .


thanks





On Tue, Jan 31, 2017 at 2:43 AM, Martin Kletzander &lt;mkletzan@redhat.com&gt;
wrote:

&gt; On Sat, Jan 28, 2017 at 09:29:11PM +0530, akhilesh rawat wrote:
&gt;
&gt;&gt; Hi ,
&gt;&gt;
&gt;&gt; Created new thread .
&gt;&gt;
&gt;&gt;
&gt;&gt; Environment:
&gt;&gt; Bare Metal server + CentOs with qemu/KVM +libvirt for virtualization
&gt;&gt; Guest Instantiated with virt-install with forced CPU model like below
&gt;&gt; virt-install --virt-type kvm --name compute-0 --cpu
&gt;&gt; Haswell,+fma,+movbe,+fsgsbase,+bmi1,+hle,+avx2,+smep,+bmi2,+
&gt;&gt; erms,+invpcid,+rtm
&gt;&gt; --rama440 --vcpus  --os-type=linux --os-variant=generic
&gt;&gt;
&gt;&gt; After guest installation  /proc/cpuinfo show model name as Haswell .
&gt;&gt; However Libvirt virsh capabilities show CPU configuration as "SandyBridge
&gt;&gt; .
&gt;&gt; "
&gt;&gt;
&gt;&gt;
&gt; You are running the 'virsh capablities' in the guest as well, right?
&gt;
&gt; Make sure you have same versions of libvirt in the guest and the host
&gt; so that they have the same CPU specifications
&gt;
&gt;
&gt; 1. Could I get explanation of the why inconsistency .
&gt;&gt;
&gt;&gt; 2. Is this expected behaviour
&gt;&gt;
&gt;&gt; 3. Why libvirt does not show same CPU Model as /proc/cpuinfo for CPU Model
&gt;&gt; info.
&gt;&gt;
&gt;&gt; My Aim : Nested Virtualization and Nested Guest needs CPU model as Haswell
&gt;&gt; strictly .
&gt;&gt;
&gt;&gt; 4. IS it possible alternative to succeed in my aim ?
&gt;&gt;
&gt;&gt; Thanks a lot for support. !
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; Guest CPU config:
&gt;&gt; processor    : 19
&gt;&gt; vendor_id    : GenuineIntel
&gt;&gt; cpu family    : 6
&gt;&gt; model        : 60
&gt;&gt; model name    : Intel Core Processor (Haswell)
&gt;&gt; stepping    : 1
&gt;&gt; microcode    : 0x1
&gt;&gt; cpu MHz        : 1995.144
&gt;&gt; cache size    : 4096 KB
&gt;&gt; fpu        : yes
&gt;&gt; fpu_exception    : yes
&gt;&gt; cpuid level    : 13
&gt;&gt; wp        : yes
&gt;&gt; flags        : fpu de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov
&gt;&gt; pat pse36 clflush mmx fxsr sse sse2 syscall nx rdtscp lm constant_tsc
&gt;&gt; rep_good nopl eagerfpu pni pclmulqdq ssse3 cx16 pcid sse4_1 sse4_2 x2apic
&gt;&gt; popcnt tsc_deadline_timer aes xsave avx hypervisor lahf_lm xsaveopt
&gt;&gt; bogomips    : 4105.33
&gt;&gt; clflush size    : 64
&gt;&gt; cache_alignment    : 64
&gt;&gt; address sizes    : 46 bits physical, 48 bits virtual
&gt;&gt; power management:
&gt;&gt;
&gt;&gt; &lt;capabilities&gt;
&gt;&gt;
&gt;&gt;  &lt;host&gt;
&gt;&gt;    &lt;uuid&gt;95c4e625-3383-4ec1-9ee4-c47a87d93b97&lt;/uuid&gt;
&gt;&gt;    &lt;cpu&gt;
&gt;&gt;      &lt;arch&gt;x86_64&lt;/arch&gt;
&gt;&gt;      &lt;model&gt;SandyBridge&lt;/model&gt;
&gt;&gt;      &lt;vendor&gt;Intel&lt;/vendor&gt;
&gt;&gt;      &lt;topology sockets='20' cores='1' threads='1'/&gt;
&gt;&gt;      &lt;feature name='hypervisor'/&gt;
&gt;&gt;      &lt;feature name='osxsave'/&gt;
&gt;&gt;      &lt;feature name='pcid'/&gt;
&gt;&gt;      &lt;pages unit='KiB' size='4'/&gt;
&gt;&gt;      &lt;pages unit='KiB' size='2048'/&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; Host CPU config:
&gt;&gt; processor    : 23
&gt;&gt; vendor_id    : GenuineIntel
&gt;&gt; cpu family    : 6
&gt;&gt; model        : 45
&gt;&gt; model name    : Intel(R) Xeon(R) CPU E5-2620 0 @ 2.00GHz
&gt;&gt; stepping    : 7
&gt;&gt; microcode    : 0x710
&gt;&gt; cpu MHz        : 1200.000
&gt;&gt; cache size    : 15360 KB
&gt;&gt; physical id    : 1
&gt;&gt; siblings    : 12
&gt;&gt; core id        : 5
&gt;&gt; cpu cores    : 6
&gt;&gt; apicid        : 43
&gt;&gt; initial apicid    : 43
&gt;&gt; fpu        : yes
&gt;&gt; fpu_exception    : yes
&gt;&gt; cpuid level    : 13
&gt;&gt; wp        : yes
&gt;&gt; flags        : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca
&gt;&gt; cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx
&gt;&gt; pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl
&gt;&gt; xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor
&gt;&gt; ds_cpl vmx smx est tm2 ssse3 cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic
&gt;&gt; popcnt tsc_deadline_timer aes xsave avx lahf_lm ida arat epb pln pts
&gt;&gt; dtherm
&gt;&gt; tpr_shadow vnmi flexpriority ept vpid xsaveopt
&gt;&gt; bogomips    : 4004.01
&gt;&gt; clflush size    : 64
&gt;&gt; cache_alignment    : 64
&gt;&gt; address sizes    : 46 bits physical, 48 bits virtual
&gt;&gt; power management:
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; Br Aki
&gt;&gt;
&gt;
&gt; _______________________________________________
&gt;&gt; libvirt-users mailing list
&gt;&gt; libvirt-users@redhat.com
&gt;&gt; https://www.redhat.com/mailman/listinfo/libvirt-users
&gt;&gt;
&gt;

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;hi ,&lt;br&gt;&lt;/div&gt;yes there is Libvirt verison are not \
same as you pointed between Host (2.0)and Guest (old version 1.2). &lt;br&gt;&lt;br&gt;&lt;/div&gt;Not \
sure if this can fix the issue .Guest image is pre -compiled image ,let me try if i \
can update the libvirt . &lt;br&gt;&lt;br&gt;&lt;/div&gt;  Else i feel In practice it seems Guest CPU \
cannot simulate non supported features   by Host CPU Model .   \
&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;thanks&lt;/div&gt;&lt;div&gt;&lt;br&gt;  &lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div \
class="gmail_extra"&gt;&lt;br&gt;&lt;div class="gmail_quote"&gt;On Tue, Jan 31, 2017 at 2:43 AM, \
Martin Kletzander &lt;span dir="ltr"&gt;&lt;&lt;a href="mailto:mkletzan@redhat.com" \
target="_blank"&gt;mkletzan@redhat.com&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;&lt;blockquote \
class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt;&lt;span class=""&gt;On Sat, Jan 28, 2017 at 09:29:11PM +0530, \
akhilesh rawat wrote:&lt;br&gt; &lt;blockquote class="gmail_quote" style="margin:0 0 0 \
.8ex;border-left:1px #ccc solid;padding-left:1ex"&gt; Hi ,&lt;br&gt;
&lt;br&gt;
Created new thread .&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
Environment:&lt;br&gt;
Bare Metal server + CentOs with qemu/KVM +libvirt for virtualization&lt;br&gt;
Guest Instantiated with virt-install with forced CPU model like below&lt;br&gt;
virt-install --virt-type kvm --name compute-0 --cpu&lt;br&gt;
Haswell,+fma,+movbe,+fsgsbase,&lt;wbr&gt;+bmi1,+hle,+avx2,+smep,+bmi2,+&lt;wbr&gt;erms,+invpcid,+rtm&lt;br&gt;
                
--ram=61440 --vcpus=20 --os-type=linux --os-variant=generic&lt;br&gt;
&lt;br&gt;
After guest installation   /proc/cpuinfo show model name as Haswell .&lt;br&gt;
However Libvirt virsh capabilities show CPU configuration as "SandyBridge .&lt;br&gt;
"&lt;br&gt;
&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;&lt;/span&gt;
You are running the 'virsh capablities' in the guest as well, right?&lt;br&gt;
&lt;br&gt;
Make sure you have same versions of libvirt in the guest and the host&lt;br&gt;
so that they have the same CPU specifications&lt;div&gt;&lt;div class="h5"&gt;&lt;br&gt;
&lt;br&gt;
&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc \
solid;padding-left:1ex"&gt; 1. Could I get explanation of the why inconsistency .&lt;br&gt;
&lt;br&gt;
2. Is this expected behaviour&lt;br&gt;
&lt;br&gt;
3. Why libvirt does not show same CPU Model as /proc/cpuinfo for CPU Model&lt;br&gt;
info.&lt;br&gt;
&lt;br&gt;
My Aim : Nested Virtualization and Nested Guest needs CPU model as Haswell&lt;br&gt;
strictly .&lt;br&gt;
&lt;br&gt;
4. IS it possible alternative to succeed in my aim ?&lt;br&gt;
&lt;br&gt;
Thanks a lot for support. !&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
Guest CPU config:&lt;br&gt;
processor      : 19&lt;br&gt;
vendor_id      : GenuineIntel&lt;br&gt;
cpu family      : 6&lt;br&gt;
model            : 60&lt;br&gt;
model name      : Intel Core Processor (Haswell)&lt;br&gt;
stepping      : 1&lt;br&gt;
microcode      : 0x1&lt;br&gt;
cpu MHz            : 1995.144&lt;br&gt;
cache size      : 4096 KB&lt;br&gt;
fpu            : yes&lt;br&gt;
fpu_exception      : yes&lt;br&gt;
cpuid level      : 13&lt;br&gt;
wp            : yes&lt;br&gt;
flags            : fpu de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov&lt;br&gt;
pat pse36 clflush mmx fxsr sse sse2 syscall nx rdtscp lm constant_tsc&lt;br&gt;
rep_good nopl eagerfpu pni pclmulqdq ssse3 cx16 pcid sse4_1 sse4_2 x2apic&lt;br&gt;
popcnt tsc_deadline_timer aes xsave avx hypervisor lahf_lm xsaveopt&lt;br&gt;
bogomips      : 4105.33&lt;br&gt;
clflush size      : 64&lt;br&gt;
cache_alignment      : 64&lt;br&gt;
address sizes      : 46 bits physical, 48 bits virtual&lt;br&gt;
power management:&lt;br&gt;
&lt;br&gt;
&lt;capabilities&gt;&lt;br&gt;
&lt;br&gt;
  &lt;host&gt;&lt;br&gt;
     &lt;uuid&gt;95c4e625-3383-4ec1-&lt;wbr&gt;9ee4-c47a87d93b97&lt;/uuid&gt;&lt;br&gt;
     &lt;cpu&gt;&lt;br&gt;
        &lt;arch&gt;x86_64&lt;/arch&gt;&lt;br&gt;
        &lt;model&gt;SandyBridge&lt;/model&gt;&lt;br&gt;
        &lt;vendor&gt;Intel&lt;/vendor&gt;&lt;br&gt;
        &lt;topology sockets='20' cores='1' \
threads='1'/&gt;&lt;br&gt;  &lt;feature name='hypervisor'/&gt;&lt;br&gt;
        &lt;feature name='osxsave'/&gt;&lt;br&gt;
        &lt;feature name='pcid'/&gt;&lt;br&gt;
        &lt;pages unit='KiB' size='4'/&gt;&lt;br&gt;
        &lt;pages unit='KiB' size='2048'/&gt;&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
Host CPU config:&lt;br&gt;
processor      : 23&lt;br&gt;
vendor_id      : GenuineIntel&lt;br&gt;
cpu family      : 6&lt;br&gt;
model            : 45&lt;br&gt;
model name      : Intel(R) Xeon(R) CPU E5-2620 0 @ 2.00GHz&lt;br&gt;
stepping      : 7&lt;br&gt;
microcode      : 0x710&lt;br&gt;
cpu MHz            : 1200.000&lt;br&gt;
cache size      : 15360 KB&lt;br&gt;
physical id      : 1&lt;br&gt;
siblings      : 12&lt;br&gt;
core id            : 5&lt;br&gt;
cpu cores      : 6&lt;br&gt;
apicid            : 43&lt;br&gt;
initial apicid      : 43&lt;br&gt;
fpu            : yes&lt;br&gt;
fpu_exception      : yes&lt;br&gt;
cpuid level      : 13&lt;br&gt;
wp            : yes&lt;br&gt;
flags            : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca&lt;br&gt;
cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx&lt;br&gt;
pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl&lt;br&gt;
xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor&lt;br&gt;
ds_cpl vmx smx est tm2 ssse3 cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic&lt;br&gt;
popcnt tsc_deadline_timer aes xsave avx lahf_lm ida arat epb pln pts dtherm&lt;br&gt;
tpr_shadow vnmi flexpriority ept vpid xsaveopt&lt;br&gt;
bogomips      : 4004.01&lt;br&gt;
clflush size      : 64&lt;br&gt;
cache_alignment      : 64&lt;br&gt;
address sizes      : 46 bits physical, 48 bits virtual&lt;br&gt;
power management:&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
Br Aki&lt;br&gt;
&lt;/blockquote&gt;
&lt;br&gt;
&lt;/div&gt;&lt;/div&gt;&lt;blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px \
#ccc solid;padding-left:1ex"&gt; \
______________________________&lt;wbr&gt;_________________&lt;br&gt; libvirt-users mailing \
list&lt;br&gt; &lt;a href="mailto:libvirt-users@redhat.com" \
target="_blank"&gt;libvirt-users@redhat.com&lt;/a&gt;&lt;br&gt; &lt;a \
href="https://www.redhat.com/mailman/listinfo/libvirt-users" rel="noreferrer" \
target="_blank"&gt;https://www.redhat.com/mailman&lt;wbr&gt;/listinfo/libvirt-users&lt;/a&gt;&lt;br&gt; \
&lt;/blockquote&gt; &lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;



</body></email><email><emailId>20170131152147</emailId><senderName>Jeroen Hoekx</senderName><senderEmail>jeroen@hoekx.be</senderEmail><timestampReceived>2017-01-31 15:21:47-0400</timestampReceived><subject>Re: [libvirt-users] Libvirt 3.0 machine start fails on LVM</subject><body>

On 31 January 2017 at 13:07, Michal Privoznik &lt;mprivozn@redhat.com&gt; wrote:
&gt; On 01/26/2017 09:07 PM, Jeroen Hoekx wrote:
&gt;&gt; Since updating to libvirt 3.0 I am no longer able to create a virtual
&gt;&gt; machine that is backed by LVM storage on my two Arch machines.
&gt;&gt;
&gt;&gt; This is the error in virt-manager:
&gt;&gt;
&gt;&gt; Unable to complete install: 'An error occurred, but the cause is unknown'
&gt;
&gt; This is likely a namespace bug. There are patches on the list to fix the
&gt; issue [1], but lacking any review. Can you try applying them and see
&gt; whether they fix your problem?
&gt;
&gt; 1: https://www.redhat.com/archives/libvir-list/2017-January/msg01127.html

After applying these patches I could indeed create a VM on LVM storage again.

Thanks,

Jeroen

</body></email><email><emailId>20170131214250</emailId><senderName>VHPC 17</senderName><senderEmail>vhpc.dist@gmail.com</senderEmail><timestampReceived>2017-01-31 21:42:50-0400</timestampReceived><subject>[libvirt-users] =?utf-8?q?CfP_12th_Virtualization_in_High=C2=AD-P?= =?utf-8?q?erformance_Cloud_Compu</subject><body>

====================================================================

CALL FOR PAPERS


12th Workshop on Virtualization in High ­-Performance Cloud Computing  (VHPC
'17)

held in conjunction with the International Supercomputing Conference - High
Performance,

June 18-22, 2017, Frankfurt, Germany.

(Springer LNCS Proceedings)

====================================================================

Date: June 22, 2017

Workshop URL: http://vhpc.org

Abstract Submission Deadline: February 28, 2017

Paper Submission Deadline: April 25, 2017  (Springer LNCS)

Abstract/Paper Submission Link: https://edas.info/newPaper.php?c=23179



Call for Papers

Virtualization technologies constitute a key enabling factor for flexible
resource management

in modern data centers, and particularly in cloud environments. Cloud
providers need to

manage complex infrastructures in a seamless fashion to support the highly
dynamic and

heterogeneous workloads and hosted applications customers deploy.
Similarly, HPC

environments have been increasingly adopting techniques that enable
flexible management of

vast computing and networking resources, close to marginal provisioning
cost, which is

unprecedented in the history of scientific and commercial computing.

Various virtualization technologies contribute to the overall picture in
different ways: machine

virtualization, with its capability to enable consolidation of multiple
under ­utilized servers with

heterogeneous software and operating systems (OSes), and its capability to
live ­-migrate a

fully operating virtual machine (VM) with a very short downtime, enables
novel and dynamic

ways to manage physical servers; OS- ­level virtualization (i.e.,
containerization), with its

capability to isolate multiple user ­-space environments and to allow for
their co ­existence within

the same OS kernel, promises to provide many of the advantages of machine
virtualization

with high levels of responsiveness and performance; I/O Virtualization
allows physical

NICs/HBAs to take traffic from multiple VMs or containers; network
virtualization, with its

capability to create logical network overlays that are independent of the
underlying physical

topology and IP addressing, provides the fundamental ground on top of which
evolved

network services can be realized with an unprecedented level of dynamicity
and flexibility; the

increasingly adopted paradigm of Software- ­Defined Networking (SDN)
 promises to extend

this flexibility to the control and data planes of network paths.

Publication

Accepted papers will be published in a Springer LNCS proceedings volume.


Topics of Interest

The VHPC program committee solicits original, high-quality submissions
related to

virtualization across the entire software stack with a special focus on the
intersection of HPC

and the cloud.

Major Topics

- Virtualization in supercomputing environments, HPC clusters, HPC in the
cloud and grids
- OS-level virtualization and containers (Docker, rkt, Singularity,
Shifter, i.a.)
- Lightweight/specialized operating systems, unikernels
- Optimizations of virtual machine monitor platforms and hypervisors
- Hypervisor support for heterogenous resources (GPUs, co-processors,
FPGAs, etc.)
- Virtualization support for emerging memory technologies

- Virtualization in enterprise HPC and microvisors
- Software defined networks and network virtualization
- Management, deployment of virtualized environments and orchestration
(Kubernetes i.a.),
- Workflow-pipeline container-based composability
- Performance measurement, modelling and monitoring of virtualized/cloud
workloads
- Virtualization in data intensive computing and Big Data processing - HPC
convergence
- Adaptation of HPC technologies in the cloud (high performance networks,
RDMA, etc.)

- ARM-based hypervisors, ARM virtualization extensions
- I/O virtualization and cloud based storage systems

- GPU, FPGA and many-core accelerator virtualization
- Job scheduling/control/policy and container placement in virtualized
environments
- Cloud reliability, fault-tolerance and high-availability
- QoS and SLA in virtualized environments
- IaaS platforms, cloud frameworks and APIs

- Large-scale virtualization in domains such as finance and government
- Energy-efficient and power-aware virtualization

- Container security

- Configuration management tools for containers (including CFEngine,
Puppet, i.a.)

- Emerging topics including multi-kernel approaches and,NUMA in hypervisors




The Workshop on Virtualization in High ­-Performance Cloud Computing (VHPC)
aims to

bring together researchers and industrial practitioners facing the
challenges

posed by virtualization in order to foster discussion, collaboration,
mutual exchange

of knowledge and experience, enabling research to ultimately provide novel

solutions for virtualized computing systems of tomorrow.

The workshop will be one day in length, composed of 20 min paper
presentations, each

followed by 10 min discussion sections, plus lightning talks that are
limited to 5 minutes.

Presentations may be accompanied by interactive demonstrations.

Important Dates

February 28, 2017 - Abstract Submission Deadline

April 25, 2017 - Paper submission deadline

May 30, 2017 - Acceptance notification

June 22, 2017 - Workshop Day

June 25, 2017 - Camera-ready version due


Chair

Michael Alexander (chair), scaledinfra technologies, Austria

Anastassios Nanos (co- ­chair), NTUA, Greece

Balazs Gerofi (co- ­chair), â€‹RIKEN Advanced Institute for Computational
Scienceâ€‹, Japan


Program committee

Stergios Anastasiadis, University of Ioannina, Greece

Jakob Blomer, CERN, Europe

Ron Brightwell, Sandia National Laboratories, USA

Eduardo CÃ©sar, Universidad Autonoma de Barcelona, Spain

Julian Chesterfield, OnApp, UK

Stephen Crago, USC ISI, USA

Christoffer Dall, Columbia University, USA

Patrick Dreher, MIT, USA

Robert Futrick, Cycle Computing, USA

Maria Girone, CERN, Europe

Kyle Hale, Northwestern University, USA

Romeo Kinzler, IBM, Switzerland

Brian Kocoloski, University of Pittsburgh, USA

Nectarios Koziris, National Technical University of Athens, Greece

John Lange, University of Pittsburgh, USA

Che-Rung Lee, National Tsing Hua University, Taiwan

Giuseppe Lettieri, University of Pisa, Italy

Qing Liu, Oak Ridge National Laboratory, USA

Nikos Parlavantzas, IRISA, France

Kevin Pedretti, Sandia National Laboratories, USA

Amer Qouneh, University of Florida, USA

Carlos ReaÃ±o, Technical University of Valencia, Spain

Thomas Ryd, CFEngine, Norway

Josh Simons, VMWare, USA

Borja Sotomayor, University of Chicago, USA

Craig Stewart, Indiana University, USA

Anata Tiwari, San Diego Supercomputer Center, USA

Kurt Tutschku, Blekinge Institute of Technology, Sweden

Yasuhiro Watashiba, Osaka University, Japan

Nicholas Wright, Lawrence Berkeley National Laboratory, USA

Chao-Tung Yang, Tunghai University, Taiwan


Paper Submission-Publication

Papers submitted to the workshop will be reviewed by at least two

members of the program committee and external reviewers. Submissions

should include abstract, key words, the e-mail address of the

corresponding author, and must not exceed 10 pages, including tables

and figures at a main font size no smaller than 11 point. Submission

of a paper should be regarded as a commitment that, should the paper

be accepted, at least one of the authors will register and attend the

conference to present the work. Accepted papers will be published in a

Springer LNCS volume. .

The format must be according to the Springer LNCS Style. Initial

submissions are in PDF; authors of accepted papers will be requested

to provide source files.

Format Guidelines:

ftp://ftp.springer.de/pub/tex/latex/llncs/latex2e/llncs2e.zip

Abstract, Paper Submission Link:

https://edas.info/newPaper.php?c=23179



Lightning Talks

Lightning Talks are non-paper track, synoptical in nature and are strictly
limited to 5 minutes.

They can be used to gain early feedback on ongoing research, for
demonstrations, to present

research results, early research ideas, perspectives and positions of
interest to the community.

Submit abstract via the main submission link.


General Information

The workshop is one day in length and will be held in conjunction with the
International

Supercomputing Conference - High Performance (ISC) 2017, June 18-22,
Frankfurt,

Germany.

[Attachment #3 (text/html)]

&lt;div dir="ltr"&gt;&lt;span \
id="gmail-docs-internal-guid-c474eea6-f678-07d9-866c-6c4b54d42c2e"&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;color:rgb(0,0,0);background-color:transpa \
rent;vertical-align:baseline;white-space:pre-wrap"&gt;====================================================================&lt;/span&gt;&lt;/p&gt;&lt;p \
dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;color:rgb(0,0,0);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;CALL \
FOR PAPERS &lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;br&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;color:rgb(0,0,0);background-color:transparent;font-weight:700;vertical-align:baseline;white-space:pre-wrap"&gt;12th \
Workshop on Virtualization in High ­-Performance Cloud Computing   (VHPC \
'17)&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;color:rgb(0,0,0);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;held \
in conjunction with the International Supercomputing Conference - High \
Performance,&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;color:rgb(0,0,0);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;June \
18-22, 2017, Frankfurt, Germany.&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;color:rgb(0,0,0);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;(Springer \
LNCS Proceedings) &lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;color:rgb(0,0,0);background-color:transpa \
rent;vertical-align:baseline;white-space:pre-wrap"&gt;====================================================================&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p \
dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;color:rgb(0,0,0);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;Date: \
June 22, 2017&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;color:rgb(0,0,0);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;Workshop \
URL: &lt;a href="http://vhpc.org"&gt;http://vhpc.org&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;color:rgb(0,0,0);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;Abstract \
Submission Deadline: February 28, 2017&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;color:rgb(0,0,0);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;Paper \
Submission Deadline: April 25, 2017   (Springer LNCS) &lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;color:rgb(0,0,0);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;Abstract/Paper \
Submission Link: &lt;a href="https://edas.info/newPaper.php?c=23179"&gt;https://edas.info/newPaper.php?c=23179&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;p \
dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;color:rgb(0,0,0);background-color:transparent;font-weight:700;vertical-align:baseline;white-space:pre-wrap"&gt;Call \
for Papers&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;Virtualization \
technologies constitute a key enabling factor for flexible resource \
management&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;in \
modern data centers, and particularly in cloud environments. Cloud providers need \
to&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;manage \
complex infrastructures in a seamless fashion to support the highly dynamic \
and&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;heterogeneous \
workloads and hosted applications customers deploy. Similarly, HPC&lt;/span&gt;&lt;/p&gt;&lt;p \
dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;environments \
have been increasingly adopting techniques that enable flexible management \
of&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;vast \
computing and networking resources, close to marginal provisioning cost, which \
is&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;unprecedented \
in the history of scientific and commercial computing.&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;Various \
virtualization technologies contribute to the overall picture in different ways: \
machine&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;virtualization, \
with its capability to enable consolidation of multiple under ­utilized servers \
with&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;heterogeneous \
software and operating systems (OSes), and its capability to live ­-migrate \
a&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;fully \
operating virtual machine (VM) with a very short downtime, enables novel and \
dynamic&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;ways \
to manage physical servers; OS- ­level virtualization (i.e., containerization), with \
its&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;capability \
to isolate multiple user ­-space environments and to allow for their co ­existence \
within&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;the \
same OS kernel, promises to provide many of the advantages of machine \
virtualization&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;with \
high levels of responsiveness and performance; I/O Virtualization allows \
physical&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;NICs/HBAs \
to take traffic from multiple VMs or containers; network virtualization, with \
its&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;capability \
to create logical network overlays that are independent of the underlying \
physical&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;topology \
and IP addressing, provides the fundamental ground on top of which \
evolved&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;network \
services can be realized with an unprecedented level of dynamicity and flexibility; \
the&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;increasingly \
adopted paradigm of Software- ­Defined Networking (SDN)   promises to \
extend&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;this \
flexibility to the control and data planes of network paths. &lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p \
dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;font-weight:700;vertical-align:baseline;white-space:pre-wrap"&gt;Publication&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p \
dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;Accepted \
papers will be published in a Springer LNCS proceedings volume.&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;br&gt;&lt;p \
dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;font-weight:700;vertical-align:baseline;white-space:pre-wrap"&gt;Topics \
of Interest&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;The \
VHPC program committee solicits original, high-quality submissions related \
to&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;virtualization \
across the entire software stack with a special focus on the intersection of \
HPC&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;and \
the cloud.&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;Major \
Topics&lt;/span&gt;&lt;/p&gt;&lt;br&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;- \
Virtualization in supercomputing environments, HPC clusters, HPC in the cloud and \
grids&lt;/span&gt;&lt;span style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;&lt;br \
class="gmail-kix-line-break"&gt;&lt;/span&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;- \
OS-level virtualization and containers (Docker, rkt, Singularity, Shifter, \
i.a.)&lt;/span&gt;&lt;span style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;&lt;br \
class="gmail-kix-line-break"&gt;&lt;/span&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;- \
Lightweight/specialized operating systems, unikernels&lt;/span&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;&lt;br \
class="gmail-kix-line-break"&gt;&lt;/span&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;- \
Optimizations of virtual machine monitor platforms and hypervisors&lt;/span&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;&lt;br \
class="gmail-kix-line-break"&gt;&lt;/span&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;- \
Hypervisor support for heterogenous resources (GPUs, co-processors, FPGAs, \
etc.)&lt;/span&gt;&lt;span style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;&lt;br \
class="gmail-kix-line-break"&gt;&lt;/span&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;- \
Virtualization support for emerging memory technologies&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \
style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;- \
&lt;/span&gt;&lt;span style="font-size:14.6667px;font-family:arial;color:rgb(0,0,0);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;Virtualization \
in enterprise HPC and microvisors&lt;/span&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;&lt;br \
class="gmail-kix-line-break"&gt;&lt;/span&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;- \
Software defined networks and network virtualization&lt;/span&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;&lt;br \
class="gmail-kix-line-break"&gt;&lt;/span&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;- \
Management, deployment of virtualized environments and &lt;/span&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;color:rgb(0,0,0);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;orchestration \
(Kubernetes i.a.),&lt;/span&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;&lt;br \
class="gmail-kix-line-break"&gt;&lt;/span&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;- \
Workflow-pipeline container-based composability &lt;/span&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;&lt;br \
class="gmail-kix-line-break"&gt;&lt;/span&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;- \
Performance measurement, modelling and monitoring of virtualized/cloud \
workloads&lt;/span&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;&lt;br \
class="gmail-kix-line-break"&gt;&lt;/span&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;- \
Virtualization in data intensive computing and Big Data processing - HPC \
convergence&lt;/span&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;&lt;br \
class="gmail-kix-line-break"&gt;&lt;/span&gt;&lt;span \
style="font-size:14.6667px;font-family:arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"&gt;- \
Adaptation of HPC technologies in the cloud (high performance networks, RDMA, \
etc.)&lt;/span&gt;&lt;/p&gt;&lt;p dir="ltr" \



</body></email></emails>